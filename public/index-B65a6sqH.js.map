{"version":3,"mappings":"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","names":["draw","gl","payload","parameters","initPositionBuffer","width","height","positionBuffer","positions","initTextureBuffer","textureCoordBuffer","textureCoordinates","initShaderProgram","vsSource","fsSource","vertexShader","loadShader","fragmentShader","shaderProgram","log","type","source","shader","weakRefs","r","createVideoForDrawing","mediaSrc","options","currentTime","waitToSeek","muted","video","createVideo","timeout","promise","onMediaLoad","handleVideoLeak","deferred","deferredPromise","e","loadTexture","mediaType","videoTime","middleware","texture","media","image","initWebGL","vertexShaderSource","fragmentShaderSource","__vitePreload","buffers","adjustmentsConfig","uniform","_BrushPainter","targetCanvas","imageCanvas","blurAmount","line","ctx","shouldFinish","points","hexaToRgba","w","h","pointsX","p","pointsY","minX","maxX","minY","maxY","brushFn","i","cx","cy","arrowLength","i2","distance","angle","angle1","angle2","vec1","vec2","animateValue","length","BrushPainter","useNormalizePoint","editorState","useMediaEditorContext","size","createMemo","x","point","transform","useProcessPoint","densityAware","drawAdjustedImage","mediaState","flip","rotation","scale","translation","imageSize","Object","fromEntries","map","key","to100","value","adjustments","BrushCanvas","actions","fullImageGLPayload","setFullImageGLPayload","createSignal","normalizePoint","processPoint","processLine","finalTransform","processedLines","brushDrawnLines","lastLine","setLastLine","canvas","_el$","_tmpl$","_$effect","_p$","_v$","currentTab","_v$2","isAdjusting","_v$3","canvasSize","pixelRatio","_v$4","classList","toggle","style","setProperty","removeProperty","_$setAttribute","undefined","getContext","brushCanvas","fullImageMultiplier","Math","min","fullImageCanvas","_el$2","_tmpl$2","_v$5","_v$6","preserveDrawingBuffer","fullBrushesCanvas","_el$3","_v$7","_v$8","brushPainter","fullBrushPainter","onMount","createMiddleware","get","onCleanup","cleanupWebGl","createEffect","on","setTimeout","redrawFull","redraw","resetLastLine","color","currentBrush","brush","isMoving","clearRect","save","translate","rotate","drawImage","restore","clear","saveLastLine","forEach","drawLine","processLineForFullImage","defaultBlurAmount","redrawBrushes","initialPosition","builtUpDistance","push","pushToHistory","path","newValue","oldValue","HistoryItem","RemoveArrayItem","updateBlurredImage","startSwipe","y","bcr","getBoundingClientRect","left","top","prev","previewLine","selectedResizableLayer","endSwipe","addEventListener","clientX","clientY","touches","swipeHandler","SwipeHandler","element","cursor","onSwipe","xDiff","yDiff","_e","lastPoint","onReset","animateArrowBrush","removeListeners","useCropOffset","getConvenientPositioning","extendCrop","cropOffset","imageWidth","imageHeight","snapToViewport","imageLeftTop","imagePoints","sin","cos","r2","cropWidth","cropHeight","currentImageRatio","cropLeftTop","cropPoints","cropPointsX","cropPointsY","cropMinX","cropMaxX","max","cropMinY","cropMaxY","imageMinX","imageMaxX","imageMinY","imageMaxY","MAX_SCALE","CropHandles","isCropping","leftTop","setLeftTop","leftTopDiff","setLeftTopDiff","setSize","diff","setDiff","withCurrentOwner","_getConvenientPositioning","getNewLeftTopAndSize","cancelSizeAnimation","resetSizeWithAnimation","initialDiff","initialLeftTopDiff","initialLeftTop","initialSize","targetDiff","targetLeftTopDiff","targetLeftTop","targetSize","progress","batch","lerpArray","multipliers","el","leftTopHandle","rightTopHandle","leftBottomHandle","rightBottomHandle","leftHandle","topHandle","rightHandle","bottomHandle","boundDiff","initialScale","initialTranslation","firstTarget","resizeSwipeHandlers","setCursorTo","document","body","onStart","add","target","fixed","fixedImageRatioKey","ratio","minW","minH","xd","Number","halfImageWidth","halfImageHeight","imageCenter","additionalScaleX","additionalScaleY","additionalScale","newWidth","newHeight","newRatio","upScale","targetScale","targetTranslation","modifyMutable","produce","state","lerp","onEnd","remove","translationSwipeHandler","cropArea","resistance","prevTranslation","handler","right","bottom","croppedSizeFull","cw","ch","coverAnimatedStyle","controlsAnimatedStyle","_$p","_$style","background","position","_el$4","_el$5","_el$6","firstChild","_el$7","nextSibling","_el$8","_el$9","_el$10","_el$11","_el$12","_el$13","_el$14","_el$15","_el$16","_el$17","_el$18","_el$19","_ref$","_$use","_ref$2","_ref$3","_ref$4","_ref$5","_ref$6","_ref$7","_ref$8","_ref$9","overflow","initVideoPlayback","renderingPayload","pendingSeek","time","flags","SetVideoTimeFlags","seekListener","listener","event","frameCallbackId","playing","skip","frameCallback","animate","clamp","ImageCanvas","ownedDrawAdjustedImage","ownedInitVideoPlayback","init","currentVideoTime","setInitialImageRatio","isReady","createReaction","PreviewBrushSize","_$createComponent","Show","when","previewBrushSize","children","includes","hexToRgb","join","useMediaQuery","query","isMatch","setIsMatch","updateMatch","mediaQueryList","useIsMobile","StickerLayerContent","props","container","wrapSticker","div","doc","layer","sticker","group","play","loop","withThumb","stickersLayersInfo","id","destroy","ResizableContainer","TextLayerContent","textInfo","onFocus","currentTextLayerInfo","fontInfo","fontInfoMap","font","deleteThisLayer","layers","resizableLayers","idx","findIndex","deletedLayer","splice","textRenderingInfo","findBy","updateBackground","contentEditable","childNodes","childNode","HTMLDivElement","hasAttributes","querySelectorAll","node","createTextNode","textContent","replaceWith","createElement","innerHTML","child","range","createRange","sel","window","getSelection","setStart","collapse","removeAllRanges","addRange","selection","rangeCount","getRangeAt","startContainer","startOffset","innerDiv","innerDivRange","selectNodeContents","querySelector","lines","getLinesRenderingInfo","alignment","createTextBackgroundPath","updateBackgroundStyle","updateOutlineStyle","clientWidth","clientHeight","selectAll","isThisLayerSelected","innerText","trim","preventDefault","getContrastColor","intialContent","layerInfo","_$insert","content","i18n","$$input","fontFamily","fontWeight","flexAlignMap","linesContainer","Array","from","_child","offset","first","rounding","arcParams","s","prevPosition","prevY","diffSign","abs","currentRounding","last","info","svg","createElementFromMarkup","prepend","updateSvg","stretch","baseline","bgDiv","center","_$delegateEvents","ResizableLayers","context","isTextTab","canClick","moveSelectedLayerOnTop","addLayer","newResizableLayer","resizableLayersSeed","_$addEventListener","For","each","isMobile","handleTyping","store","createMutable","containerWidth","containerHeight","leftTopEl","rightTopEl","leftBottomEl","rightBottomEl","circleOffset","canShowHandles","resizeHandlesContainer","processedLayer","useResizeHandles","useContextMenu","unobserve","observeResize","$$click","_c$","_$memo","Portal","mount","_tmpl$3","_v$9","_v$10","_v$11","_v$12","PI","_v$13","_v$14","_v$15","_v$16","_v$17","_v$18","_v$19","_v$20","swipeStarted","_","__","getEvent","initialVector","resizedVector","rotationFromHorizon","atan2","hypot","moveHandler","find","onClick","otherLayer","contextMenu","createContextMenu","buttons","icon","className","text","listenTo","onElementReady","animateToNewRotationOrRatio","newRotation","snappedRotation90","isReversedRatio","snappedRotation","parts","originalRatio","w1","h1","w2","h2","initialRotation","targetRotation","DEGREE_DIST_PX","DEGREE_STEP","TOTAL_DEGREES_SIDE","MAX_DEGREES_DIST_PX","SNAP_DIST_PX","rotationFromMove","amount","RotationWheel","moved","setMoved","movedDiff","setMovedDiff","swiperEl","round","prevRotation","currentDiff","prevShouldSnap","getShouldSnap","isAnimating","isSnapped","cancelAnimation","timeoutId","handleDiffChange","removeSnapAfterTimeout","shouldSnap","clearTimeout","newMoved","rotationFromSwiper","rotationDiff","resetWheelWithAnimation","values","resetRotationWheel","isFirstEffect","rotateLeft","flipImage","snapTo1","targetFlip","toFixed","replace","ButtonIconTsx","fill","ArrowUp","_tmpl$4","useFinalTransform","cropTabAnimationProgress","setCropTabAnimationProgress","cancel","prevCanvasSize","setPrevCanvasSize","prevCropTranslation","setPrevCropTranslation","prevAdditionalScale","setPrevAdditionalScale","additionalImageScales","imageRatio","toCropScale","getSnappedViewportsScale","fromCroppedScale","snappedImageScale","cropTrnsl","cropTranslation","prevScale","updatePrevValues","prevSize","currentSize","currentAdditionalScale","scaleToChange","counterScale","totalScale","v","t","useVideoControlsCanvas","getCanvas","cleaned","chunkWidth","chunkHeight","fade","styles","HANDLE_WIDTH_PX","MOVE_ACTIVATION_THRESHOLD_PX","VideoControls","cropper","setCropper","isDraggingSomething","setIsDraggingSomething","cropperSize","useElementSize","strippedWidth","shouldShowTime","swiping","formattedResultingTime","totalSeconds","videoCropLength","duration","ts","hh","floor","padStart","mm","ss","decimal","minLength","initialStart","initialLength","leftHandleSwipeArgs","globalCursor","videoCropStart","isPlaying","onMove","setVideoTime","rightHandleSwipeArgs","maxLength","canMove","middleSwipeArgs","handleCursorMove","startDiff","self","cursorSwipeArgs","getPositionInCropper","onMiddlePartClick","showMutedTooltip","showTooltip","mountOn","parentElement","vertical","textElement","lighter","auto","closeTooltip","videoMuted","currentTarget","close","ripple","IconTsx","swipe","TimeStick","ThumbnailTrack","hidden","PausePlay","paused","Container","changed","InnerContainer","IconButton","MuteButton","Frames","Cropper","Images","CropperBg","CropperBgLeft","CropperBgRight","CropperHorizontalBorder","dragging","CropperHandle","CropperHandleLeft","CropperHandleRight","CroppedTime","_v$21","visible","_v$22","PlayButton","_v$23","PlayButtonInner","_$className","_$classList","ghostThumbnailPosition","setGhostThumbnailPosition","isDragging","setIsDragging","isGhostThumbnailVisible","isNaN","videoThumbnailPosition","canPreviewFrame","previewFrameTimeout","onPointerMove","UpdateVideo","Redraw","onPointerOut","swipeArgs","ThumbnailMark","withTransition","ghost","$$touchend","$$pointerout","$$touchmove","$$pointermove","_v$24","_v$25","disabled","_v$26","_v$27","_v$28","_tmpl$5","_el$20","_el$21","_el$22","_el$23","_el$24","_v$29","PausePlaySvg","_v$30","_v$31","PausePlaySvgPlay","_v$32","PausePlaySvgPause","_v$33","PausePlaySvgPauseLeft","_v$34","PausePlaySvgPauseRight","TouchEvent","changedTouches","pos","MainCanvas","removeEventListener","SIDE_MAX","SIDE_MIN","getResultSize","videoType","quality","scaledWidth","scaledHeight","willResultInVideo","defaultCodec","highResCodec","getResultTransform","initialCanvasWidth","initialCanvasHeight","canvasRatio","snappedCanvasWidth","snappedCanvasHeight","getScaledLayersAndLines","scaledLines","scaledLayers","layerStore","unwrap","FRAMES_PER_SECOND","STICKER_SIZE","drawStickerLayer","drawTextLayer","renderingInfo","multiply","newPath","part","boxLeft","yOffset","xOffset","generateVideoPreview","previewWidth","previewHeight","mirrorCanvas","previewCanvas","previewCtx","mirrorCtx","stickerChild","resolve","ImageStickerFrameByFrameRenderer","blob","appDownloadManager","LottieStickerFrameByFrameRenderer","animation","lottieLoader","frame","VideoStickerFrameByFrameRenderer","getMiddleware","apiManagerProxy","delay","IS_FIREFOX","EXPECTED_FPS","VIDEO_COMPARISON_ERROR","THUMBNAIL_MAX_SIZE","logger","renderToActualVideo","hasAnimatedStickers","drawToImageCanvas","resultCanvas","mediaBlob","owner","getOwner","startTime","endTime","creationProgress","createRoot","dispose","setProgress","renderers","thumbnailCanvas","thumbnailCtx","thumbnailTime","currentVideoFrameDeferred","encodingPausedDeferred","lastTime","drewThumbnail","canceled","progressRAF","listenerSetter","ListenerSetter","initMuxerAndEncoder","Muxer","ArrayBufferTarget","audioBuffer","supportsAudioEncoding","extractAudioFragment","muxer","encoder","chunk","meta","calcCodecAndBitrate","BITRATE_TARGET_FPS","drawToTexture","initStickerRenderers","stickerType","renderer","StickerType","ThrowReason","ThrowReason2","prepareAndRenderFrame","frameNo","callback","mediaTime","untilFrame","renderFrame","timestamp","appendToMuxer","promises","videoFrame","updateProgress","targetProgress","currentProgress","delta","cleanup","preview","runWithOwner","resultPromise","reject","firstFrameSeekDeferred","done","encodeAndMuxAudio","buffer","thumbBlob","MediaSize","result","noop","audioContext","arrayBuffer","fullAudioBuffer","sampleRate","startSample","endSample","frameCount","numChannels","fragmentBuffer","fullData","onChunk","totalFrames","interleaved","channelData","audioData","renderToImage","renderToVideoGIF","maxFrames","spawnAnimatedPreview","previewBlob","animatedImg","createFinalResult","checkIfHasAnimatedStickers","maxHeight","maxQuality","snapToAvailableQuality","renderResult","animatedPreview","FinishButton","hasModifications","RangeInput","normalizedValue","nMap","mappedCenter","brightShadow","hexaToHsla","l","prevValue","ref","label","onChangeFinish","valueAsNumber","onChange","passiveLabel","StepInput","stepIndex","steps","step","isActive","createSelector","a","b","isSelected","index","ADJUST_TIMEOUT","AdjustmentsTab","mediaSize","removeIsAdjusting","resultingSize","debugResultingSize","console","maxVideoQuality","availableQualityHeights","filter","canShowQualityInput","Space","videoQuality","item","setContainer","showGhost","setShowGhost","setValue","append","removeGhost","currentValue","PenBrush","ArrowBrush","MarkerBrush","NeonBrush","EraserBrush","BlurBrush","_tmpl$6","colorPickerSwatches","PICKER_WIDTH_PX","PICKER_HEIGHT_PX","SLIDER_WIDTH_PX","DEFAULT_SIZE_PX","ColorPicker","collapsed","setCollapsed","collapsing","setCollapsing","containerSize","setContainerSize","sizeContainer","swatch","hexColor","onCollapseToggle","previousColor","colorPicker","_ColorPicker","buildLayout","slider","pickerBox","hexInput","rgbInput","pickerBoxWidth","pickerBoxHeight","sliderWidth","thickSlider","hex","abortDrawerSlide","observer","ResizeObserver","observe","disconnect","colorKey","newCollapsed","then","doubleRaf","getCurrentColor","setColor","createStoredColor","defaultColor","savedColor","setSavedColor","fallback","LargeButton","_$spread","_$mergeProps","active","class","BrushTab","savedBrushColors","pen","arrow","neon","savedBrushSignal","updateCurrentBrush","brushButton","brushSvg","hasColor","removeSizePreview","previous","transition","ratioRects","1x1","3x2","4x3","5x4","7x5","16x9","ratioIcon","rotated","_tmpl$7","Item","inProps","buttonProps","splitProps","CropTab","what","onRatioClick","_tmpl$8","_tmpl$9","config","mediaEditorTabsOrder","Tabs","underline","tabs","onTabClick","tab","containerBR","targetBR","TabContentContext","createContext","TabContent","scrollAmount","setScrollAmount","prevElement","prevTab","scrollable","toRight","indexOf","newElement","Provider","setScrollable","cls","action","modifier","initialTab","Scrollable","setListeners","onScroll","scrollTop","onContainer","StickersTab","wrapStickerSetThumb","EmoticonsSearch","useHotReloadGuard","useContext","managers","recentStickers","createResource","appStickersManager","getRecentStickersStickers","stickerSets","getAllStickers","filteredStickers","setFilteredStickers","search","setSearch","setGroup","activeSet","setActiveSet","scrolling","setScrolling","intersectionObserver","setIntersectionObserver","recentLabel","setRecentLabel","lazyLoadQueue","LazyLoadQueue","stickerRenderer","SuperStickerRenderer","regularLazyLoadQueue","intersectionObserverInit","root","withLock","onStickerSetThumbClick","String","scrollIntoView","behavior","block","StickerSetThumb","renderContainer","autoplay","set","textColor","Sticker","renderSticker","observeAnimated","newLayer","StickerSetLabel","wrapEmojiText","title","StickerSetSection","stickers","getStickerSet","documents","ThumbList","thumbsListScrollable","ScrollableX","sets","IntersectionObserver","entries","entry","isIntersecting","dataset","setId","rootMargin","searchStickers","g","getPremiumStickers","getStickersByEmoticon","emoticon","emoticons","includeServerStickers","onValue","onGroup","categoryColor","animatedItemGroup","TextTab","untrack","setAlignment","setStyle","toggleButton","fontButton","textFont","Topbar","doneButton","processHistory","history","otherHistory","pop","processHistoryItem","onUndo","redoHistory","onRedo","removeListener","addShortcutListener","combo","onClose","onFinish","Toolbar","toolbar","move","setMove","isCollapsed","setIsCollapsed","setContainerHeight","extraMove","setExtraMove","shouldHide","setShouldHide","startY","isAborted","isResetting","resetMove","startDrag","dragMove","dragEnd","initialMove","initialExtraMove","targetExtraMove","totalMove","crop","MediaEditor","contextValue","createContextValue","overlay","navigationItem","onPop","handleClose","appNavigationController","pushItem","focus","removeItem","onCanvasReady","onImageRendered","performClose","hasGif","finished","confirmationPopup","description","button","isFinishing","MediaEditorContext","handleFinish","finally","onEditFinish","isVideo","openMediaEditor","HotReloadGuardProvider","render","openMediaEditorFromMedia","editingMediaState","animatedCanvas","sourceWidth","sourceHeight","canvasBcr","leftDiff","topDiff","SolidJSHotReloadGuardProvider"],"ignoreList":[],"sources":["../src/components/mediaEditor/webgl/draw.ts","../src/components/mediaEditor/webgl/initBuffers.ts","../src/components/mediaEditor/webgl/initShaderProgram.ts","../src/components/mediaEditor/canvas/createVideoForDrawing.ts","../src/components/mediaEditor/webgl/loadTexture.ts","../src/components/mediaEditor/webgl/initWebGL.ts","../src/components/mediaEditor/canvas/brushPainter.ts","../src/components/mediaEditor/canvas/useNormalizePoint.ts","../src/components/mediaEditor/canvas/useProcessPoint.ts","../src/components/mediaEditor/canvas/brushCanvas.tsx","../src/components/mediaEditor/canvas/useCropOffset.ts","../src/components/mediaEditor/canvas/getConvenientPositioning.tsx","../src/components/mediaEditor/canvas/cropHandles.tsx","../src/components/mediaEditor/canvas/initVideoPlayback.ts","../src/components/mediaEditor/canvas/imageCanvas.tsx","../src/components/mediaEditor/canvas/previewBrushSize.tsx","../src/components/mediaEditor/useIsMobile.ts","../src/components/mediaEditor/canvas/stickerLayerContent.tsx","../src/components/mediaEditor/canvas/textLayerContent.tsx","../src/components/mediaEditor/canvas/resizableLayers.tsx","../src/components/mediaEditor/canvas/animateToNewRotationOrRatio.ts","../src/components/mediaEditor/canvas/rotationWheel.tsx","../src/components/mediaEditor/canvas/useFinalTransform.ts","../src/components/mediaEditor/canvas/useVideoControlsCanvas.ts","../src/components/mediaEditor/canvas/videoControls.tsx","../src/components/mediaEditor/canvas/mainCanvas.tsx","../src/components/mediaEditor/finalRender/getResultSize.ts","../src/components/mediaEditor/finalRender/getResultTransform.ts","../src/components/mediaEditor/finalRender/getScaledLayersAndLines.ts","../src/components/mediaEditor/finalRender/constants.ts","../src/components/mediaEditor/finalRender/drawStickerLayer.ts","../src/components/mediaEditor/finalRender/drawTextLayer.ts","../src/components/mediaEditor/finalRender/generateVideoPreview.ts","../src/components/mediaEditor/finalRender/imageStickerFrameByFrameRenderer.ts","../src/components/mediaEditor/finalRender/lottieStickerFrameByFrameRenderer.ts","../src/components/mediaEditor/finalRender/videoStickerFrameByFrameRenderer.ts","../src/components/mediaEditor/finalRender/renderToActualVideo.ts","../src/components/mediaEditor/finalRender/renderToImage.ts","../src/components/mediaEditor/finalRender/renderToVideoGIF.ts","../src/components/mediaEditor/finalRender/spawnAnimatedPreview.ts","../src/components/mediaEditor/finalRender/createFinalResult.ts","../src/components/mediaEditor/finishButton.tsx","../src/components/mediaEditor/rangeInput.tsx","../src/components/mediaEditor/stepInput.tsx","../src/components/mediaEditor/tabs/adjustmentsTab.tsx","../src/components/mediaEditor/brushesSvg.tsx","../src/components/mediaEditor/colorPicker.tsx","../src/components/mediaEditor/createStoredColor.ts","../src/components/mediaEditor/largeButton.tsx","../src/components/mediaEditor/tabs/brushTab.tsx","../src/components/mediaEditor/tabs/cropTab.tsx","../src/components/mediaEditor/tabs/tabs.tsx","../src/components/mediaEditor/tabs/tabContent.tsx","../src/components/mediaEditor/tabs/stickersTab.tsx","../src/components/mediaEditor/tabs/textTab.tsx","../src/components/mediaEditor/topbar.tsx","../src/components/mediaEditor/toolbar.tsx","../src/components/mediaEditor/mediaEditor.tsx","../src/components/mediaEditor/index.ts"],"sourcesContent":["import {AdjustmentKey} from '@components/mediaEditor/adjustments';\nimport {NumberPair} from '@components/mediaEditor/types';\n\nimport {RenderingPayload} from '@components/mediaEditor/webgl/initWebGL';\n\n\ntype DrawingParameters = {\n  rotation: number;\n  scale: number;\n  translation: NumberPair;\n  imageSize: NumberPair;\n  flip: NumberPair;\n} & Record<AdjustmentKey, number>;\n\nexport function draw(gl: WebGLRenderingContext, payload: RenderingPayload, parameters: DrawingParameters) {\n  gl.viewport(0, 0, gl.canvas.width, gl.canvas.height);\n\n  gl.clearColor(0.0, 0.0, 0.0, 1.0);\n  gl.clear(gl.COLOR_BUFFER_BIT);\n\n  gl.bindBuffer(gl.ARRAY_BUFFER, payload.buffers.position);\n  gl.vertexAttribPointer(payload.attribs.vertexPosition, 2, gl.FLOAT, false, 0, 0);\n  gl.enableVertexAttribArray(payload.attribs.vertexPosition);\n\n  gl.bindBuffer(gl.ARRAY_BUFFER, payload.buffers.texture);\n  gl.vertexAttribPointer(payload.attribs.textureCoord, 2, gl.FLOAT, false, 0, 0);\n  gl.enableVertexAttribArray(payload.attribs.textureCoord);\n\n  gl.useProgram(payload.program);\n\n  gl.activeTexture(gl.TEXTURE0);\n  gl.bindTexture(gl.TEXTURE_2D, payload.texture);\n  gl.uniform1i(payload.uniforms.uSampler, 0);\n\n  gl.uniform1f(payload.uniforms.uAngle, -parameters.rotation);\n  gl.uniform2f(payload.uniforms.uResolution, gl.canvas.width, gl.canvas.height);\n  gl.uniform1f(payload.uniforms.uScale, parameters.scale);\n  gl.uniform2fv(payload.uniforms.uTranslation, parameters.translation);\n  gl.uniform2fv(payload.uniforms.uImageSize, parameters.imageSize);\n  gl.uniform2fv(payload.uniforms.uFlip, parameters.flip);\n\n  gl.uniform1f(payload.uniforms.uSaturation, parameters.saturation);\n  gl.uniform1f(payload.uniforms.uBrightness, parameters.brightness);\n  gl.uniform1f(payload.uniforms.uContrast, parameters.contrast);\n  gl.uniform1f(payload.uniforms.uWarmth, parameters.warmth);\n  gl.uniform1f(payload.uniforms.uFade, parameters.fade);\n  gl.uniform1f(payload.uniforms.uShadows, parameters.shadows);\n  gl.uniform1f(payload.uniforms.uHighlights, parameters.highlights);\n  gl.uniform1f(payload.uniforms.uVignette, parameters.vignette);\n  gl.uniform1f(payload.uniforms.uGrain, parameters.grain);\n  gl.uniform1f(payload.uniforms.uSharpen, parameters.sharpen);\n  gl.uniform1f(payload.uniforms.uEnhance, parameters.enhance);\n\n  gl.drawArrays(gl.TRIANGLE_STRIP, 0, 4);\n}\n","export function initPositionBuffer(gl: WebGLRenderingContext, width: number, height: number) {\n  const positionBuffer = gl.createBuffer();\n  gl.bindBuffer(gl.ARRAY_BUFFER, positionBuffer);\n\n  const positions = [0, 0, width, 0, 0, height, width, height];\n  gl.bufferData(gl.ARRAY_BUFFER, new Float32Array(positions), gl.STATIC_DRAW);\n\n  return positionBuffer;\n}\n\nexport function initTextureBuffer(gl: WebGLRenderingContext) {\n  const textureCoordBuffer = gl.createBuffer();\n  gl.bindBuffer(gl.ARRAY_BUFFER, textureCoordBuffer);\n\n  const textureCoordinates = [0.0, 0.0, 1.0, 0.0, 0.0, 1.0, 1.0, 1.0];\n  gl.bufferData(gl.ARRAY_BUFFER, new Float32Array(textureCoordinates), gl.STATIC_DRAW);\n\n  return textureCoordBuffer;\n}\n","import {log} from '@components/mediaEditor/utils';\n\nexport function initShaderProgram(gl: WebGLRenderingContext, vsSource: string, fsSource: string) {\n  const vertexShader = loadShader(gl, gl.VERTEX_SHADER, vsSource);\n  const fragmentShader = loadShader(gl, gl.FRAGMENT_SHADER, fsSource);\n\n  const shaderProgram = gl.createProgram();\n  gl.attachShader(shaderProgram, vertexShader);\n  gl.attachShader(shaderProgram, fragmentShader);\n  gl.linkProgram(shaderProgram);\n\n  if(!gl.getProgramParameter(shaderProgram, gl.LINK_STATUS)) {\n    log.error(`Unable to initialize the shader program: ${gl.getProgramInfoLog(shaderProgram)}`);\n    return null;\n  }\n\n  return shaderProgram;\n}\n\nfunction loadShader(gl: WebGLRenderingContext, type: GLenum, source: string) {\n  const shader = gl.createShader(type);\n\n  gl.shaderSource(shader, source);\n  gl.compileShader(shader);\n\n  if(!gl.getShaderParameter(shader, gl.COMPILE_STATUS)) {\n    log.error(`An error occurred compiling the shaders: ${gl.getShaderInfoLog(shader)}`);\n    gl.deleteShader(shader);\n    return null;\n  }\n\n  return shader;\n}\n","import deferredPromise from '@helpers/cancellablePromise';\nimport createVideo from '@helpers/dom/createVideo';\nimport handleVideoLeak from '@helpers/dom/handleVideoLeak';\nimport {Middleware} from '@helpers/middleware';\nimport onMediaLoad from '@helpers/onMediaLoad';\n\n\ntype Options = {\n  /**\n   * [0, 1] will be multiplied by duration\n   */\n  currentTime?: number;\n  muted?: boolean;\n  waitToSeek?: boolean;\n  middleware?: Middleware;\n};\n\nconst weakRefs: WeakRef<any>[] = [];\n\n\n// TODO: The video nodes themselves remain references somewhere, but they're src is cleaned up WTF\n(window as any).derefMediaEditorVideos = () => {\n  console.log('Dereffed weak refs ::>> ', weakRefs.map(r => r.deref()));\n}\n\nexport default async function createVideoForDrawing(mediaSrc: string, options: Options = {}) {\n  const currentTime = options.currentTime ?? 0;\n  const waitToSeek = options.waitToSeek ?? true;\n  const muted = options.muted ?? true;\n\n  const video = createVideo({pip: false, middleware: options.middleware});\n  video.src = mediaSrc;\n  video.autoplay = true;\n  video.controls = false;\n  video.muted = true; // prevent sound playing while we're waiting for metadata\n\n  weakRefs.push(new WeakRef(video));\n\n  let timeout: number;\n\n  video.addEventListener('timeupdate', () => {\n    video.pause();\n  }, {once: true});\n\n  // Theoretically we should not have any errors here as this is handled in the media popup\n  try {\n    const promise = onMediaLoad(video);\n    await handleVideoLeak(video, promise);\n\n    if(waitToSeek) {\n      const deferred = deferredPromise<void>();\n      video.addEventListener('seeked', () => void deferred.resolve(), {once: true});\n      timeout = self.setTimeout(() => deferred.resolve(), 500); // just in case\n\n      video.currentTime = video.duration * currentTime;\n\n      await deferred;\n      self.clearTimeout(timeout);\n    }\n  } catch(e) {\n    console.error(e);\n  }\n\n\n  if(!muted) video.muted = false;\n\n  return video;\n}\n","import deferredPromise from '@helpers/cancellablePromise';\nimport {Middleware} from '@helpers/middleware';\nimport createVideoForDrawing from '@components/mediaEditor/canvas/createVideoForDrawing';\nimport {MediaType} from '@components/mediaEditor/types';\n\n\ntype LoadTextureArgs = {\n  gl: WebGLRenderingContext;\n  mediaSrc: string;\n  mediaType: MediaType;\n  videoTime: number;\n  waitToSeek?: boolean;\n\n  middleware?: Middleware;\n};\n\ntype LoadTextureMedia = {\n  width: number;\n  height: number;\n  image?: HTMLImageElement;\n  video?: HTMLVideoElement;\n};\n\ntype LoadTextureResult = {\n  texture: WebGLTexture;\n  media: LoadTextureMedia;\n};\n\nexport async function loadTexture({gl, mediaSrc, mediaType, videoTime, waitToSeek, middleware}: LoadTextureArgs): Promise<LoadTextureResult> {\n  const texture = gl.createTexture();\n  gl.bindTexture(gl.TEXTURE_2D, texture);\n\n  let media: LoadTextureMedia;\n\n  if(mediaType === 'image') {\n    const image = new Image();\n    image.src = mediaSrc;\n\n    const deferred = deferredPromise<void>();\n    image.addEventListener('load', () => void deferred.resolve());\n    await deferred;\n\n    media = {\n      image,\n      width: image.naturalWidth,\n      height: image.naturalHeight\n    };\n  } else {\n    const video = await createVideoForDrawing(mediaSrc, {currentTime: videoTime, waitToSeek, middleware});\n\n    media = {\n      video,\n      width: video.videoWidth,\n      height: video.videoHeight\n    };\n  }\n\n  gl.bindTexture(gl.TEXTURE_2D, texture);\n  gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, gl.RGBA, gl.UNSIGNED_BYTE, media.video || media.image);\n\n  gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\n  gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\n  gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR);\n  gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.LINEAR);\n\n  return {media, texture};\n}\n","import {Middleware} from '@helpers/middleware';\nimport {adjustmentsConfig, AdjustmentsConfig} from '@components/mediaEditor/adjustments';\nimport {MediaType} from '@components/mediaEditor/types';\n\nimport {initPositionBuffer, initTextureBuffer} from '@components/mediaEditor/webgl/initBuffers';\nimport {initShaderProgram} from '@components/mediaEditor/webgl/initShaderProgram';\nimport {loadTexture} from '@components/mediaEditor/webgl/loadTexture';\n\nexport type RenderingPayload = Awaited<ReturnType<typeof initWebGL>>;\n\ntype InitWebGLArgs = {\n  gl: WebGLRenderingContext;\n  mediaSrc: string;\n  mediaType: MediaType;\n  videoTime: number;\n  waitToSeek?: boolean;\n\n  middleware?: Middleware;\n};\n\nexport async function initWebGL({gl, mediaSrc, mediaType, videoTime, waitToSeek, middleware}: InitWebGLArgs) {\n  const [{vertexShaderSource, fragmentShaderSource}, {texture, media}] = await Promise.all([\n    import('./shaderSources'),\n    loadTexture({gl, mediaSrc, mediaType, videoTime, waitToSeek, middleware})\n  ]);\n\n  const shaderProgram = initShaderProgram(gl, vertexShaderSource, fragmentShaderSource);\n\n  const buffers = {\n    position: initPositionBuffer(gl, media.width, media.height),\n    texture: initTextureBuffer(gl)\n  };\n\n  return {\n    program: shaderProgram,\n    buffers,\n    media,\n    texture,\n    attribs: {\n      vertexPosition: gl.getAttribLocation(shaderProgram, 'aVertexPosition'),\n      textureCoord: gl.getAttribLocation(shaderProgram, 'aTextureCoord')\n    },\n    uniforms: {\n      uSampler: gl.getUniformLocation(shaderProgram, 'uSampler'),\n      uFlip: gl.getUniformLocation(shaderProgram, 'uFlip'),\n      uAngle: gl.getUniformLocation(shaderProgram, 'uAngle'),\n      uResolution: gl.getUniformLocation(shaderProgram, 'uResolution'),\n      uTranslation: gl.getUniformLocation(shaderProgram, 'uTranslation'),\n      uScale: gl.getUniformLocation(shaderProgram, 'uScale'),\n      uImageSize: gl.getUniformLocation(shaderProgram, 'uImageSize'),\n      ...(Object.fromEntries(\n        adjustmentsConfig.map(({uniform}) => [uniform, gl.getUniformLocation(shaderProgram, uniform)])\n      ) as Record<AdjustmentsConfig[number]['uniform'], WebGLUniformLocation>)\n    }\n  };\n}\n","import {animateValue} from '@helpers/animateValue';\nimport deferredPromise from '@helpers/cancellablePromise';\nimport {hexaToRgba} from '@helpers/color';\nimport {NumberPair} from '@components/mediaEditor/types';\nimport {distance} from '@components/mediaEditor/utils';\n\n\nexport type BrushDrawnLine = {\n  color: string;\n  brush: string;\n  size: number;\n  points: NumberPair[];\n};\n\ntype BrushPainterOptions = {\n  targetCanvas: HTMLCanvasElement;\n  imageCanvas: HTMLCanvasElement;\n  blurAmount?: number;\n};\n\nexport default class BrushPainter {\n  private imageCanvas: HTMLCanvasElement;\n  private cacheCanvas: HTMLCanvasElement;\n  private blurredImageCanvas: HTMLCanvasElement;\n  private blurredLineCanvas: HTMLCanvasElement;\n\n  private targetCtx: CanvasRenderingContext2D;\n  private cacheCtx: CanvasRenderingContext2D;\n  private blurredImageCtx: CanvasRenderingContext2D;\n  private blurredLineCtx: CanvasRenderingContext2D;\n\n  private width: number;\n  private height: number;\n\n  private blurAmount: number;\n\n  static defaultBlurAmount = 10;\n\n  constructor({targetCanvas, imageCanvas, blurAmount = BrushPainter.defaultBlurAmount}: BrushPainterOptions) {\n    this.targetCtx = targetCanvas.getContext('2d');\n    this.imageCanvas = imageCanvas;\n    this.blurAmount = blurAmount;\n\n    this.cacheCanvas = document.createElement('canvas');\n    this.blurredImageCanvas = document.createElement('canvas');\n    this.blurredLineCanvas = document.createElement('canvas');\n\n    this.width =\n      this.cacheCanvas.width =\n      this.blurredImageCanvas.width =\n      this.blurredLineCanvas.width =\n        targetCanvas.width;\n    this.height =\n      this.cacheCanvas.height =\n      this.blurredImageCanvas.height =\n      this.blurredLineCanvas.height =\n        targetCanvas.height;\n\n    this.cacheCtx = this.cacheCanvas.getContext('2d');\n    this.blurredImageCtx = this.blurredImageCanvas.getContext('2d');\n    this.blurredLineCtx = this.blurredLineCanvas.getContext('2d');\n  }\n\n  previewLine(line: BrushDrawnLine, shouldFinish = false) {\n    this.targetCtx.clearRect(0, 0, this.width, this.height);\n\n    this.targetCtx.drawImage(this.cacheCanvas, 0, 0);\n    const brushFn = this.brushes[line.brush];\n    this.targetCtx.save();\n    brushFn(line, this.targetCtx, shouldFinish);\n    this.targetCtx.restore();\n  }\n\n  saveLastLine() {\n    this.cacheCtx.clearRect(0, 0, this.width, this.height);\n    this.cacheCtx.drawImage(this.targetCtx.canvas, 0, 0);\n    this.updateBlurredImage();\n  }\n\n  updateBlurredImage() {\n    this.blurredImageCtx.clearRect(0, 0, this.width, this.height);\n    this.blurredImageCtx.filter = `blur(${this.blurAmount}px)`;\n    this.blurredImageCtx.drawImage(this.imageCanvas, 0, 0, this.width, this.height);\n\n    this.blurredImageCtx.drawImage(this.cacheCanvas, 0, 0);\n  }\n\n  drawLine(line: BrushDrawnLine) {\n    this.previewLine(line, true);\n    this.saveLastLine();\n  }\n\n  clear() {\n    this.targetCtx.clearRect(0, 0, this.width, this.height);\n    this.cacheCtx.clearRect(0, 0, this.width, this.height);\n  }\n\n  private drawLinePath(line: BrushDrawnLine, ctx: CanvasRenderingContext2D) {\n    const {points} = line;\n    if(!points.length) return;\n\n    if(points.length === 1) {\n      ctx.fillStyle = ctx.strokeStyle;\n      ctx.beginPath();\n      ctx.arc(points[0][0], points[0][1], line.size / 2, 0, 2 * Math.PI);\n      ctx.fill();\n      return;\n    }\n\n    ctx.lineWidth = line.size;\n    ctx.lineCap = 'round';\n    ctx.lineJoin = 'round';\n\n    ctx.beginPath();\n    ctx.moveTo(points[0][0], points[0][1]);\n\n    for(let i = 1; i < points.length - 2; i++) {\n      const cx = (points[i][0] + points[i + 1][0]) / 2;\n      const cy = (points[i][1] + points[i + 1][1]) / 2;\n      ctx.quadraticCurveTo(points[i][0], points[i][1], cx, cy);\n    }\n\n    const i = points.length - 1;\n    ctx.quadraticCurveTo(points[i - 1][0], points[i - 1][1], points[i][0], points[i][1]);\n\n    ctx.stroke();\n  }\n\n  private getArrowHeadLength(line: BrushDrawnLine) {\n    return Math.sqrt(line.size) + line.size * 2.5;\n  }\n\n  private drawArrowHead(ctx: CanvasRenderingContext2D, line: BrushDrawnLine, arrowLength: number) {\n    const {points} = line;\n    if(points.length < 2) return;\n\n    const i = points.length - 1;\n\n    let i2 = i;\n    for(; i2 > 0; i2--) {\n      if(distance(points[i], points[i2]) > line.size * 0.5) break;\n    }\n\n    const angle = Math.atan2(points[i][0] - points[i2][0], points[i][1] - points[i2][1]) + Math.PI;\n\n    const angle1 = angle + Math.PI / 4;\n    const angle2 = angle - Math.PI / 4;\n\n    const vec1 = [arrowLength * Math.sin(angle1), arrowLength * Math.cos(angle1)];\n    const vec2 = [arrowLength * Math.sin(angle2), arrowLength * Math.cos(angle2)];\n\n    ctx.strokeStyle = line.color;\n    ctx.lineWidth = line.size;\n    ctx.lineCap = 'round';\n    ctx.lineJoin = 'round';\n\n    ctx.beginPath();\n    ctx.moveTo(points[i][0], points[i][1]);\n    ctx.lineTo(points[i][0] + vec1[0], points[i][1] + vec1[1]);\n    ctx.moveTo(points[i][0], points[i][1]);\n    ctx.lineTo(points[i][0] + vec2[0], points[i][1] + vec2[1]);\n    ctx.stroke();\n  }\n\n  async animateArrowBrush(line: BrushDrawnLine) {\n    const {points} = line;\n    if(points.length < 2) return;\n\n    const ctx = this.targetCtx;\n\n    const arrowLength = this.getArrowHeadLength(line);\n\n    const deferred = deferredPromise<void>();\n    animateValue(0.1, arrowLength, 120, (length) => this.drawArrowHead(ctx, line, length), {\n      onEnd: () => deferred.resolve()\n    });\n    await deferred;\n  }\n\n  private brushes: Record<\n    string,\n    (line: BrushDrawnLine, ctx: CanvasRenderingContext2D, shouldFinish: boolean) => void\n  > = {\n      pen: (line, ctx) => {\n        ctx.strokeStyle = line.color;\n        this.drawLinePath(line, ctx);\n      },\n      arrow: (line, ctx, shouldFinish) => {\n        const {points} = line;\n\n        ctx.strokeStyle = line.color;\n        this.drawLinePath(line, ctx);\n\n        if(!shouldFinish) return;\n        if(points.length < 2) return;\n\n        this.drawArrowHead(ctx, line, this.getArrowHeadLength(line));\n      },\n      brush: (line, ctx) => {\n        ctx.strokeStyle = `rgba(${hexaToRgba(line.color).join(',')},0.4)`;\n        this.drawLinePath(line, ctx);\n      },\n      neon: (line, ctx) => {\n        ctx.strokeStyle = '#ffffff';\n        ctx.shadowBlur = line.size;\n        ctx.shadowColor = line.color;\n        this.drawLinePath(line, ctx);\n      },\n      blur: (line, ctx) => {\n        const w = ctx.canvas.width,\n          h = ctx.canvas.height;\n\n        this.blurredLineCtx.clearRect(0, 0, w, h);\n\n        const {points} = line;\n        const pointsX = points.map((p) => p[0]);\n        const pointsY = points.map((p) => p[1]);\n        const minX = Math.max(Math.min(...pointsX) - line.size, 0),\n          maxX = Math.max(...pointsX) + line.size,\n          minY = Math.max(Math.min(...pointsY) - line.size, 0),\n          maxY = Math.max(...pointsY) + line.size;\n\n        this.blurredLineCtx.strokeStyle = 'white';\n        this.drawLinePath(line, this.blurredLineCtx);\n\n        this.blurredLineCtx.globalCompositeOperation = 'source-in';\n        this.blurredLineCtx.drawImage(this.blurredImageCanvas, 0, 0);\n\n        ctx.drawImage(this.blurredLineCanvas, minX, minY, maxX, maxY, minX, minY, maxX, maxY);\n        this.blurredLineCtx.globalCompositeOperation = 'source-over';\n      },\n      eraser: (line, ctx) => {\n        ctx.strokeStyle = 'white';\n        ctx.globalCompositeOperation = 'destination-out';\n        this.drawLinePath(line, ctx);\n        ctx.stroke();\n        ctx.globalCompositeOperation = 'source-over';\n      }\n    };\n}\n","import {createMemo} from 'solid-js';\n\nimport {useMediaEditorContext} from '@components/mediaEditor/context';\nimport {NumberPair} from '@components/mediaEditor/types';\n\n\nexport default function useNormalizePoint() {\n  const {editorState} = useMediaEditorContext();\n\n  const size = createMemo(() => editorState.canvasSize.map((x) => x * editorState.pixelRatio));\n\n  return (point: NumberPair) => {\n    const transform = editorState.finalTransform;\n    const [w, h] = size();\n\n    point = point.map((x) => x * editorState.pixelRatio) as NumberPair;\n\n    point = [\n      (point[0] - transform.translation[0] - w / 2) / transform.scale,\n      (point[1] - transform.translation[1] - h / 2) / transform.scale\n    ];\n    const r = [Math.sin(transform.rotation), Math.cos(transform.rotation)];\n    point = [point[0] * r[1] + point[1] * r[0], point[1] * r[1] - point[0] * r[0]];\n    return point;\n  };\n}\n","import {createMemo} from 'solid-js';\n\nimport {useMediaEditorContext} from '@components/mediaEditor/context';\nimport {NumberPair} from '@components/mediaEditor/types';\n\nexport default function useProcessPoint(densityAware = true) {\n  const {editorState} = useMediaEditorContext();\n\n  const size = createMemo(() => editorState.canvasSize.map((x) => x * editorState.pixelRatio));\n\n  return (point: NumberPair) => {\n    const [w, h] = size();\n\n    const transform = editorState.finalTransform;\n    const r = [Math.sin(-transform.rotation), Math.cos(-transform.rotation)];\n    point = [point[0] * r[1] + point[1] * r[0], point[1] * r[1] - point[0] * r[0]];\n    point = [\n      (point[0] * transform.scale + w / 2 + transform.translation[0]) / (densityAware ? 1 : editorState.pixelRatio),\n      (point[1] * transform.scale + h / 2 + transform.translation[1]) / (densityAware ? 1 : editorState.pixelRatio)\n    ];\n    return point;\n  };\n}\n","import {createEffect, createMemo, createSignal, on, onCleanup, onMount} from 'solid-js';\nimport createMiddleware from '@helpers/solid/createMiddleware';\nimport SwipeHandler from '@components/swipeHandler';\nimport {adjustmentsConfig, AdjustmentsConfig} from '@components/mediaEditor/adjustments';\nimport {HistoryItem, useMediaEditorContext} from '@components/mediaEditor/context';\nimport {NumberPair} from '@components/mediaEditor/types';\nimport {cleanupWebGl, distance} from '@components/mediaEditor/utils';\nimport {draw} from '@components/mediaEditor/webgl/draw';\nimport {initWebGL, RenderingPayload} from '@components/mediaEditor/webgl/initWebGL';\nimport BrushPainter, {BrushDrawnLine} from '@components/mediaEditor/canvas/brushPainter';\nimport useNormalizePoint from '@components/mediaEditor/canvas/useNormalizePoint';\nimport useProcessPoint from '@components/mediaEditor/canvas/useProcessPoint';\n\n\nfunction drawAdjustedImage(gl: WebGLRenderingContext, payload: RenderingPayload) {\n  const {mediaState} = useMediaEditorContext();\n\n  if(!payload) return;\n\n  draw(gl, payload, {\n    flip: mediaState.flip,\n    rotation: 0,\n    scale: 1,\n    translation: [0, 0],\n    imageSize: [payload.media.width, payload.media.height],\n    ...(Object.fromEntries(\n      adjustmentsConfig.map(({key, to100}) => {\n        const value = mediaState.adjustments[key];\n        return [key, value / (to100 ? 100 : 50)];\n      })\n    ) as Record<AdjustmentsConfig[number]['key'], number>)\n  });\n}\n\nexport default function BrushCanvas() {\n  const {editorState, mediaState, actions, mediaSrc, mediaType} = useMediaEditorContext();\n\n  const [fullImageGLPayload, setFullImageGLPayload] = createSignal<RenderingPayload>();\n\n  const normalizePoint = useNormalizePoint();\n  const processPoint = useProcessPoint();\n\n  function processLine(line: BrushDrawnLine): BrushDrawnLine {\n    const transform = editorState.finalTransform;\n    return {\n      ...line,\n      size: line.size * transform.scale,\n      points: line.points.map(processPoint)\n    };\n  }\n\n  const processedLines = createMemo(() => mediaState.brushDrawnLines.map(processLine));\n\n  const [lastLine, setLastLine] = createSignal<BrushDrawnLine>();\n\n  const canvas = (\n    <canvas\n      class=\"media-editor__brush-canvas\"\n      classList={{\n        'media-editor__brush-canvas--active': editorState.currentTab === 'brush'\n      }}\n      style={{\n        'opacity': editorState.isAdjusting ? 0 : 1\n      }}\n      width={editorState.canvasSize?.[0] * editorState.pixelRatio}\n      height={editorState.canvasSize?.[1] * editorState.pixelRatio}\n    ></canvas>\n  ) as HTMLCanvasElement;\n  const ctx = canvas.getContext('2d');\n\n  editorState.brushCanvas = canvas;\n\n  const fullImageMultiplier = () =>\n    Math.min(\n      editorState.canvasSize?.[0] / editorState.imageSize?.[0],\n      editorState.canvasSize?.[1] / editorState.imageSize?.[1]\n    ) * 2 * editorState.pixelRatio;\n\n  const fullImageCanvas = (<canvas width={editorState.imageSize?.[0]} height={editorState.imageSize?.[1]} />) as HTMLCanvasElement;\n  const gl = fullImageCanvas.getContext('webgl', {\n    preserveDrawingBuffer: true\n  });\n\n  const fullBrushesCanvas = (\n    <canvas width={editorState.imageSize?.[0] * fullImageMultiplier()} height={editorState.imageSize?.[1] * fullImageMultiplier()} />\n  ) as HTMLCanvasElement;\n\n  let brushPainter = new BrushPainter({\n    imageCanvas: editorState.imageCanvas,\n    targetCanvas: canvas\n  });\n\n  let fullBrushPainter: BrushPainter;\n\n  onMount(async() => {\n    if(mediaType !== 'image') return;\n    const middleware = createMiddleware().get();\n    setFullImageGLPayload(await initWebGL({gl, mediaSrc, mediaType, videoTime: 0, middleware}));\n  });\n\n  onCleanup(() => {\n    cleanupWebGl(gl);\n  });\n\n  createEffect(() => {\n    const payload = fullImageGLPayload();\n    drawAdjustedImage(gl, payload);\n  });\n\n  createEffect(on(fullImageGLPayload, () => {\n    const payload = fullImageGLPayload();\n    if(payload) setTimeout(() => redrawFull(), 100);\n  }));\n\n  createEffect(\n    on(() => editorState.canvasSize, () => {\n      brushPainter = new BrushPainter({\n        imageCanvas: editorState.imageCanvas,\n        targetCanvas: canvas\n      });\n      redraw();\n    })\n  );\n\n  function resetLastLine() {\n    setLastLine({\n      color: editorState.currentBrush.color,\n      brush: editorState.currentBrush.brush,\n      size: (editorState.currentBrush.size * editorState.pixelRatio) / editorState.finalTransform.scale,\n      points: []\n    });\n  }\n\n  createEffect(() => {\n    resetLastLine();\n  });\n\n  createEffect(() => {\n    if(editorState.isMoving) {\n      const transform = editorState.finalTransform;\n      ctx.clearRect(0, 0, canvas.width, canvas.height);\n      ctx.save();\n\n      ctx.translate(transform.translation[0] + canvas.width / 2, transform.translation[1] + canvas.height / 2);\n      ctx.rotate(transform.rotation);\n      ctx.scale(transform.scale, transform.scale);\n\n      const [w, h] = editorState.imageSize;\n      ctx.drawImage(fullBrushesCanvas, -(w / 2), -(h / 2), w, h);\n\n      ctx.restore();\n    } else {\n      redraw();\n      redrawFull();\n    }\n  });\n\n  function redraw() {\n    brushPainter.clear();\n    brushPainter.saveLastLine();\n    processedLines().forEach((line) => brushPainter.drawLine(line));\n  }\n\n  function processLineForFullImage(line: BrushDrawnLine) {\n    return {\n      ...line,\n      size: line.size * fullImageMultiplier(),\n      points: line.points.map(\n        (point) =>\n          [\n            (point[0] + editorState.imageSize?.[0] / 2) * fullImageMultiplier(),\n            (point[1] + editorState.imageSize?.[1] / 2) * fullImageMultiplier()\n          ] as NumberPair\n      )\n    };\n  }\n\n  function redrawFull() {\n    if(!fullBrushPainter) return;\n\n    fullBrushPainter.clear();\n    fullBrushPainter.saveLastLine();\n\n    mediaState.brushDrawnLines.forEach((line) => fullBrushPainter.drawLine(processLineForFullImage(line)));\n  }\n\n  createEffect(\n    on(() => editorState.imageSize, () => {\n      if(!editorState.imageSize?.[0]) return;\n      fullBrushPainter = new BrushPainter({\n        imageCanvas: fullImageCanvas,\n        targetCanvas: fullBrushesCanvas,\n        blurAmount: BrushPainter.defaultBlurAmount * fullImageMultiplier()\n      });\n\n      redraw();\n      redrawFull();\n    })\n  );\n\n  createEffect(() => {\n    if(editorState.isAdjusting) {\n      onCleanup(() => {\n        redraw();\n        redrawFull();\n      });\n    }\n  });\n\n  actions.redrawBrushes = () => {\n    redraw();\n    redrawFull();\n  };\n  onCleanup(() => {\n    actions.redrawBrushes = () => {};\n  });\n\n  onMount(() => {\n    let initialPosition: NumberPair;\n    let points: NumberPair[] = [];\n\n    let builtUpDistance = 0;\n\n    function saveLastLine() {\n      mediaState.brushDrawnLines.push(lastLine());\n      actions.pushToHistory({\n        path: ['brushDrawnLines', mediaState.brushDrawnLines.length - 1],\n        newValue: lastLine(),\n        oldValue: HistoryItem.RemoveArrayItem\n      });\n\n      fullBrushPainter.updateBlurredImage();\n      fullBrushPainter.drawLine(processLineForFullImage(lastLine()));\n      resetLastLine();\n      brushPainter.saveLastLine();\n\n      points = [];\n      initialPosition = undefined;\n    }\n\n    function startSwipe(x: number, y: number) {\n      const bcr = canvas.getBoundingClientRect();\n\n      initialPosition = [x - bcr.left, y - bcr.top];\n      const point = normalizePoint(initialPosition);\n      points = [point];\n\n      setLastLine((prev) => ({...prev, points}));\n      brushPainter.updateBlurredImage();\n      brushPainter.previewLine(processLine(lastLine()));\n\n      editorState.selectedResizableLayer = undefined;\n    }\n\n    function endSwipe() {\n      if(points.length === 1) {\n        saveLastLine();\n      }\n    }\n\n    canvas.addEventListener('mousedown', (e) => {\n      startSwipe(e.clientX, e.clientY);\n    });\n    canvas.addEventListener('touchstart', (e) => {\n      startSwipe(e.touches[0].clientX, e.touches[0].clientY);\n    });\n\n    canvas.addEventListener('mouseup', () => {\n      endSwipe();\n    });\n    canvas.addEventListener('touchend', () => {\n      endSwipe();\n    });\n\n    const swipeHandler = new SwipeHandler({\n      element: canvas,\n      cursor: '',\n      onSwipe: (xDiff, yDiff, _e) => {\n        const point = normalizePoint([initialPosition[0] + xDiff, initialPosition[1] + yDiff]);\n\n        if(points.length > 0) {\n          const lastPoint = points[points.length - 1];\n          builtUpDistance += distance(processPoint(lastPoint), processPoint(point));\n        }\n        if(builtUpDistance < Math.min(lastLine().size, 12) * editorState.pixelRatio && points.length > 1) {\n          points[points.length - 1] = point;\n        } else {\n          points.push(point);\n          builtUpDistance = 0;\n        }\n\n        setLastLine((prev) => ({...prev, points}));\n        brushPainter.previewLine(processLine(lastLine()));\n      },\n      onReset() {\n        (async() => {\n          builtUpDistance = 0;\n          if(lastLine().brush === 'arrow') {\n            await brushPainter.animateArrowBrush(processLine(lastLine()));\n          }\n          saveLastLine();\n        })();\n      }\n    });\n\n    onCleanup(() => {\n      swipeHandler.removeListeners();\n    })\n  });\n\n  return <>{canvas}</>;\n}\n","import {useMediaEditorContext} from '@components/mediaEditor/context';\n\nexport function useCropOffset() {\n  const {editorState} = useMediaEditorContext();\n\n  return () => {\n    const {canvasSize} = editorState;\n    if(!canvasSize) return {left: 0, top: 0, width: 0, height: 0};\n\n    const w = canvasSize[0],\n      h = canvasSize[1];\n\n    return {\n      left: 60,\n      top: 60,\n      width: w - 120,\n      height: h - 180\n    };\n  };\n}\n","import {useMediaEditorContext} from '@components/mediaEditor/context';\nimport {snapToViewport} from '@components/mediaEditor/utils';\nimport {NumberPair} from '@components/mediaEditor/types';\n\nimport {useCropOffset} from '@components/mediaEditor/canvas/useCropOffset';\n\ntype Options = {\n  rotation: number;\n  translation: NumberPair;\n  scale: number;\n  extendCrop?: [NumberPair, NumberPair];\n};\n\nexport default function getConvenientPositioning({\n  scale,\n  translation,\n  rotation,\n  extendCrop = [\n    [0, 0],\n    [0, 0]\n  ]\n}: Options) {\n  const {editorState, mediaState} = useMediaEditorContext();\n\n  const cropOffset = useCropOffset();\n\n  const [w, h] = editorState.imageSize;\n  const [imageWidth, imageHeight] = snapToViewport(w / h, cropOffset().width, cropOffset().height);\n\n  const imageLeftTop = [-imageWidth / 2, imageHeight / 2];\n\n  const imagePoints = [\n    [imageLeftTop[0], imageLeftTop[1]],\n    [imageLeftTop[0] + imageWidth, imageLeftTop[1]],\n    [imageLeftTop[0] + imageWidth, imageLeftTop[1] - imageHeight],\n    [imageLeftTop[0], imageLeftTop[1] - imageHeight]\n  ].map((point) => {\n    const r = [Math.sin(rotation), Math.cos(rotation)];\n    point = [point[0] * r[1] - point[1] * r[0], point[1] * r[1] + point[0] * r[0]].map((x) => x * scale);\n    point = [point[0] + translation[0], point[1] + translation[1]];\n    const r2 = [Math.sin(-rotation), Math.cos(-rotation)];\n    point = [point[0] * r2[1] - point[1] * r2[0], point[1] * r2[1] + point[0] * r2[0]];\n    return point;\n  });\n\n  const [cropWidth, cropHeight] = snapToViewport(mediaState.currentImageRatio, cropOffset().width, cropOffset().height);\n\n  const cropLeftTop = [-cropWidth / 2, cropHeight / 2];\n  const cropPoints = [\n    [cropLeftTop[0] + extendCrop[0][0], cropLeftTop[1] + extendCrop[0][1]],\n    [cropLeftTop[0] + cropWidth + extendCrop[1][0], cropLeftTop[1] + extendCrop[0][1]],\n    [cropLeftTop[0] + cropWidth + extendCrop[1][0], cropLeftTop[1] - cropHeight + extendCrop[1][1]],\n    [cropLeftTop[0] + extendCrop[0][0], cropLeftTop[1] - cropHeight + extendCrop[1][1]]\n  ].map((point) => {\n    const r = [Math.sin(-rotation), Math.cos(-rotation)];\n    return [point[0] * r[1] - point[1] * r[0], point[1] * r[1] + point[0] * r[0]];\n  });\n  const cropPointsX = cropPoints.map((p) => p[0]);\n  const cropPointsY = cropPoints.map((p) => p[1]);\n\n  return {\n    cropMinX: Math.min(...cropPointsX),\n    cropMaxX: Math.max(...cropPointsX),\n    cropMinY: Math.min(...cropPointsY),\n    cropMaxY: Math.max(...cropPointsY),\n    imageMinX: imagePoints[0][0],\n    imageMaxX: imagePoints[2][0],\n    imageMinY: imagePoints[2][1],\n    imageMaxY: imagePoints[0][1]\n  };\n}\n","import {batch, createEffect, createSignal, on, onCleanup, onMount} from 'solid-js';\nimport {modifyMutable, produce} from 'solid-js/store';\nimport {animateValue} from '@helpers/animateValue';\nimport {lerp, lerpArray} from '@helpers/lerp';\nimport SwipeHandler from '@components/swipeHandler';\nimport {useMediaEditorContext} from '@components/mediaEditor/context';\nimport {NumberPair} from '@components/mediaEditor/types';\nimport {snapToViewport, withCurrentOwner} from '@components/mediaEditor/utils';\nimport _getConvenientPositioning from '@components/mediaEditor/canvas/getConvenientPositioning';\nimport {useCropOffset} from '@components/mediaEditor/canvas/useCropOffset';\n\n\nconst MAX_SCALE = 20;\n\nexport default function CropHandles() {\n  const {editorState, mediaState} = useMediaEditorContext();\n\n  const isCropping = () => editorState.currentTab === 'crop';\n\n  const cropOffset = useCropOffset();\n\n  const [leftTop, setLeftTop] = createSignal([0, 0]);\n  const [leftTopDiff, setLeftTopDiff] = createSignal([0, 0]);\n  const [size, setSize] = createSignal([0, 0]);\n  const [diff, setDiff] = createSignal([0, 0]);\n\n  const getConvenientPositioning = withCurrentOwner(_getConvenientPositioning);\n\n  const getNewLeftTopAndSize = () => {\n    const [width, height] = snapToViewport(mediaState.currentImageRatio, cropOffset().width, cropOffset().height);\n\n    return {\n      leftTop: [\n        cropOffset().left + (cropOffset().width - width) / 2,\n        cropOffset().top + (cropOffset().height - height) / 2\n      ],\n      size: [width, height]\n    };\n  };\n\n  createEffect(\n    on(cropOffset, () => {\n      const {leftTop, size} = getNewLeftTopAndSize();\n      setLeftTop(leftTop);\n      setSize(size);\n    })\n  );\n\n  let cancelSizeAnimation: () => void;\n\n  function resetSizeWithAnimation() {\n    const initialDiff = diff();\n    const initialLeftTopDiff = leftTopDiff();\n    const initialLeftTop = leftTop();\n    const initialSize = size();\n\n    const targetDiff = [0, 0];\n    const targetLeftTopDiff = [0, 0];\n    const {leftTop: targetLeftTop, size: targetSize} = getNewLeftTopAndSize();\n\n    cancelSizeAnimation?.();\n\n    cancelSizeAnimation = animateValue(0, 1, 200, (progress) => {\n      batch(() => {\n        setDiff(lerpArray(initialDiff, targetDiff, progress) as NumberPair);\n        setLeftTopDiff(lerpArray(initialLeftTopDiff, targetLeftTopDiff, progress) as NumberPair);\n        setLeftTop(lerpArray(initialLeftTop, targetLeftTop, progress) as NumberPair);\n        setSize(lerpArray(initialSize, targetSize, progress) as NumberPair);\n      });\n    });\n  }\n\n  createEffect(\n    on(() => mediaState.currentImageRatio, () => {\n      resetSizeWithAnimation();\n    })\n  );\n\n  onMount(() => {\n    const multipliers = [\n      {el: leftTopHandle, left: -1, top: -1},\n      {el: rightTopHandle, left: 1, top: -1},\n      {el: leftBottomHandle, left: -1, top: 1},\n      {el: rightBottomHandle, left: 1, top: 1},\n\n      {el: leftHandle, left: -1, top: 0},\n      {el: topHandle, left: 0, top: -1},\n      {el: rightHandle, left: 1, top: 0},\n      {el: bottomHandle, left: 0, top: 1}\n    ];\n\n    let boundDiff: NumberPair;\n    let initialScale: number;\n    let initialTranslation: NumberPair;\n    let firstTarget: EventTarget;\n\n    const resizeSwipeHandlers = multipliers.map(({el, left, top}) => {\n      return new SwipeHandler({\n        element: el,\n        setCursorTo: document.body,\n        onStart() {\n          initialScale = mediaState.scale;\n          initialTranslation = mediaState.translation;\n          editorState.isMoving = true;\n\n          el.classList.add('media-editor__crop-handles-circle--anti-flicker');\n        },\n        onSwipe(xDiff, yDiff, e) {\n          if(!firstTarget) firstTarget = e.target;\n          if(firstTarget !== el) return;\n\n          const fixed = editorState.fixedImageRatioKey;\n          let ratio = mediaState.currentImageRatio;\n          if(left < 0) {\n            ratio = -ratio;\n          }\n          if(top < 0) {\n            ratio = -ratio;\n          }\n\n          const [w, h] = size();\n          const minW = Math.min(w, (cropOffset().width / MAX_SCALE) * Math.min(MAX_SCALE, initialScale));\n          const minH = Math.min(h, (cropOffset().height / MAX_SCALE) * Math.min(MAX_SCALE, initialScale));\n          xDiff = Math.max(xDiff * left, minW - w) * left;\n          yDiff = Math.max(yDiff * top, minH - h) * top;\n\n          if(fixed) {\n            if(top === 0) {\n              yDiff = xDiff / ratio;\n            } else if(left === 0) {\n              xDiff = yDiff * ratio;\n            } else {\n              const xd = xDiff;\n              xDiff = (xDiff + yDiff * ratio) / 2;\n              yDiff = (xd / ratio + yDiff) / 2;\n            }\n          }\n\n          if(fixed && top === 0) {\n            setDiff([left * xDiff, yDiff]);\n          } else if(fixed && left === 0) {\n            setDiff([xDiff, top * yDiff]);\n          } else {\n            setDiff([xDiff * left, yDiff * top]);\n          }\n\n          setLeftTopDiff([\n            fixed && left === 0 ? -xDiff / 2 : Number(left < 0) * xDiff,\n            fixed && top === 0 ? -yDiff / 2 : Number(top < 0) * yDiff\n          ]);\n          const {cropMinX, cropMaxX, cropMinY, cropMaxY, imageMinX, imageMaxX, imageMinY, imageMaxY} =\n            getConvenientPositioning({\n              scale: initialScale,\n              rotation: mediaState.rotation,\n              translation: initialTranslation,\n              extendCrop: [\n                [\n                  fixed && left === 0 ? -xDiff / 2 : left === -1 ? xDiff : 0,\n                  fixed && top === 0 ? yDiff / 2 : top === 1 ? yDiff : 0\n                ],\n                [\n                  fixed && left === 0 ? xDiff / 2 : left === 1 ? xDiff : 0,\n                  fixed && top === 0 ? -yDiff / 2 : top === -1 ? yDiff : 0\n                ]\n              ]\n            });\n          const halfImageWidth = (imageMaxX - imageMinX) / 2,\n            halfImageHeight = (imageMaxY - imageMinY) / 2;\n          const imageCenter = [imageMinX + halfImageWidth, imageMinY + halfImageHeight];\n\n          let additionalScaleX = 1;\n          let additionalScaleY = 1;\n\n          if(imageMinX > cropMinX) additionalScaleX *= 1 + ((imageCenter[0] - cropMinX) / halfImageWidth - 1) / 2;\n          if(imageMaxX < cropMaxX) additionalScaleX *= 1 + ((cropMaxX - imageCenter[0]) / halfImageWidth - 1) / 2;\n          if(imageMinY > cropMinY) additionalScaleY *= 1 + ((imageCenter[1] - cropMinY) / halfImageHeight - 1) / 2;\n          if(imageMaxY < cropMaxY) additionalScaleY *= 1 + ((cropMaxY - imageCenter[1]) / halfImageHeight - 1) / 2;\n\n          const additionalScale = Math.max(additionalScaleX, additionalScaleY);\n          if(additionalScale > 1) {\n            mediaState.scale = initialScale * additionalScale;\n          }\n\n          let boundDiff = [0, 0];\n\n          if(imageMinX > cropMinX) boundDiff[0] += imageMinX - cropMinX;\n          if(imageMaxX < cropMaxX) boundDiff[0] += imageMaxX - cropMaxX;\n          if(imageMinY > cropMinY) boundDiff[1] += imageMinY - cropMinY;\n          if(imageMaxY < cropMaxY) boundDiff[1] += imageMaxY - cropMaxY;\n\n          const r = [Math.sin(mediaState.rotation), Math.cos(mediaState.rotation)];\n\n          boundDiff = [boundDiff[0] * r[1] - boundDiff[1] * r[0], boundDiff[1] * r[1] + boundDiff[0] * r[0]];\n\n          mediaState.translation = [initialTranslation[0] - boundDiff[0] / 2, initialTranslation[1] - boundDiff[1] / 2];\n        },\n        onReset() {\n          if(firstTarget !== el) return (firstTarget = undefined);\n          firstTarget = undefined;\n\n          const newWidth = size()[0] + diff()[0],\n            newHeight = size()[1] + diff()[1];\n          const newRatio = newWidth / newHeight;\n\n          const upScale = Math.min(cropOffset().width / newWidth, cropOffset().height / newHeight);\n          mediaState.currentImageRatio = newRatio;\n          resetSizeWithAnimation();\n\n          const initialScale = mediaState.scale;\n          const initialTranslation = mediaState.translation;\n\n          const targetScale = mediaState.scale * upScale;\n          const targetTranslation = [\n            upScale * (mediaState.translation[0] + -diff()[0] * left * 0.5),\n            upScale * (mediaState.translation[1] + -diff()[1] * top * 0.5)\n          ];\n\n          animateValue(\n            0,\n            1,\n            200,\n            (progress) => {\n              modifyMutable(mediaState, produce((state) => {\n                state.scale = lerp(initialScale, targetScale, progress);\n                state.translation = lerpArray(initialTranslation, targetTranslation, progress) as NumberPair;\n              }));\n            },\n            {\n              onEnd: () => editorState.isMoving = false\n            }\n          );\n\n          el.classList.remove('media-editor__crop-handles-circle--anti-flicker');\n        }\n      });\n    });\n\n    const translationSwipeHandler = new SwipeHandler({\n      element: cropArea,\n      onStart() {\n        initialTranslation = mediaState.translation;\n        editorState.isMoving = true;\n      },\n      onSwipe(xDiff, yDiff, e) {\n        if(!firstTarget) firstTarget = e.target;\n        if(firstTarget !== cropArea) return;\n\n        const {cropMinX, cropMaxX, cropMinY, cropMaxY, imageMinX, imageMaxX, imageMinY, imageMaxY} =\n          getConvenientPositioning({\n            scale: mediaState.scale,\n            rotation: mediaState.rotation,\n            translation: [initialTranslation[0] + xDiff, initialTranslation[1] + yDiff]\n          });\n\n        boundDiff = [0, 0];\n\n        if(imageMinX > cropMinX) boundDiff[0] = imageMinX - cropMinX;\n        if(imageMaxX < cropMaxX) boundDiff[0] = imageMaxX - cropMaxX;\n        if(imageMinY > cropMinY) boundDiff[1] = imageMinY - cropMinY;\n        if(imageMaxY < cropMaxY) boundDiff[1] = imageMaxY - cropMaxY;\n\n        const r = [Math.sin(mediaState.rotation), Math.cos(mediaState.rotation)];\n\n        boundDiff = [boundDiff[0] * r[1] - boundDiff[1] * r[0], boundDiff[1] * r[1] + boundDiff[0] * r[0]];\n\n        const resistance = 4;\n        mediaState.translation = [\n          initialTranslation[0] + xDiff - (boundDiff[0] - boundDiff[0] / resistance),\n          initialTranslation[1] + yDiff - (boundDiff[1] - boundDiff[1] / resistance)\n        ]\n        boundDiff = [boundDiff[0] / resistance, boundDiff[1] / resistance];\n      },\n      onReset() {\n        if(firstTarget !== cropArea) return (firstTarget = undefined);\n        firstTarget = undefined;\n\n        const prevTranslation = mediaState.translation;\n        animateValue(\n          prevTranslation,\n          [prevTranslation[0] - boundDiff[0], prevTranslation[1] - boundDiff[1]] as const,\n          120,\n          (value) => mediaState.translation = value,\n          {\n            onEnd: () => editorState.isMoving = false\n          }\n        );\n      }\n    });\n\n    onCleanup(() => {\n      resizeSwipeHandlers.forEach((handler) => handler.removeListeners());\n      translationSwipeHandler.removeListeners();\n    });\n  });\n\n  const left = () => leftTop()[0] + leftTopDiff()[0];\n  const top = () => leftTop()[1] + leftTopDiff()[1];\n  const width = () => size()[0] + diff()[0];\n  const height = () => size()[1] + diff()[1];\n  const right = () => left() + width();\n  const bottom = () => top() + height();\n\n  const croppedSizeFull = () => {\n    const [cw, ch] = editorState.canvasSize;\n    let [w, h] = [cw, ch];\n    const ratio = mediaState.currentImageRatio;\n\n    if(w / ratio > h) w = h * ratio;\n    else h = w / ratio;\n\n    return [(cw - w) / 2, (ch - h) / 2];\n  };\n\n  let cropArea: HTMLDivElement;\n\n  let leftTopHandle: HTMLDivElement;\n  let rightTopHandle: HTMLDivElement;\n  let leftBottomHandle: HTMLDivElement;\n  let rightBottomHandle: HTMLDivElement;\n\n  let leftHandle: HTMLDivElement;\n  let topHandle: HTMLDivElement;\n  let rightHandle: HTMLDivElement;\n  let bottomHandle: HTMLDivElement;\n\n  const coverAnimatedStyle = () =>\n    ({\n      'transition': 'opacity 0.2s',\n      'transition-timing-function': isCropping() ? 'ease-in' : 'ease-out',\n      'pointer-events': isCropping() ? 'none' : undefined,\n      'opacity': isCropping() ? 0 : 1\n    }) as const;\n\n  const controlsAnimatedStyle = () =>\n    ({\n      'transition': 'transform 0.2s, opacity 0.2s',\n      'transition-timing-function': isCropping() ? 'ease-out' : 'ease-in',\n      'pointer-events': isCropping() ? undefined : 'none',\n      'opacity': isCropping() ? 1 : 0,\n      'transform': isCropping() ? undefined : 'scale(1.05)'\n    }) as const;\n\n  return (\n    <>\n      <div\n        style={{\n          background: 'black',\n          position: 'absolute',\n          left: '0px',\n          top: '0px',\n          width: '100%',\n          height: croppedSizeFull()[1] + 'px',\n          ...coverAnimatedStyle()\n        }}\n      ></div>\n      <div\n        style={{\n          background: 'black',\n          position: 'absolute',\n          left: '0px',\n          bottom: '0px',\n          width: '100%',\n          height: croppedSizeFull()[1] + 'px',\n          ...coverAnimatedStyle()\n        }}\n      ></div>\n      <div\n        style={{\n          background: 'black',\n          position: 'absolute',\n          left: '0px',\n          top: '0px',\n          height: '100%',\n          width: croppedSizeFull()[0] + 'px',\n          ...coverAnimatedStyle()\n        }}\n      ></div>\n      <div\n        style={{\n          background: 'black',\n          position: 'absolute',\n          right: '0px',\n          top: '0px',\n          height: '100%',\n          width: croppedSizeFull()[0] + 'px',\n          ...coverAnimatedStyle()\n        }}\n      ></div>\n      <div\n        style={{\n          position: 'absolute',\n          right: '0px',\n          top: '0px',\n          height: '100%',\n          width: '100%',\n          overflow: 'hidden',\n          ...controlsAnimatedStyle()\n        }}\n      >\n        <div\n          class=\"media-editor__crop-handles-backdrop\"\n          style={{\n            ['clip-path']: `polygon(\n              0 0, 0 100%,\n              ${left()}px 100%, ${left()}px ${top()}px, ${right()}px ${top()}px,\n              ${right()}px ${bottom()}px, ${left()}px ${bottom()}px, ${left()}px 100%,\n              100% 100%, 100% 0%\n            )`\n          }}\n        />\n        <div\n          ref={cropArea}\n          class=\"media-editor__crop-handles\"\n          style={{\n            left: left() + 'px',\n            top: top() + 'px',\n            width: width() + 'px',\n            height: height() + 'px'\n          }}\n        >\n          <div class=\"media-editor__crop-handles-line-h\" style={{top: '33%'}} />\n          <div class=\"media-editor__crop-handles-line-h\" style={{top: '66%'}} />\n          <div class=\"media-editor__crop-handles-line-v\" style={{left: '33%'}} />\n          <div class=\"media-editor__crop-handles-line-v\" style={{left: '66%'}} />\n\n          <div ref={leftHandle} class=\"media-editor__crop-handles-side media-editor__crop-handles-side--w\" />\n          <div ref={topHandle} class=\"media-editor__crop-handles-side media-editor__crop-handles-side--n\" />\n          <div ref={rightHandle} class=\"media-editor__crop-handles-side media-editor__crop-handles-side--e\" />\n          <div ref={bottomHandle} class=\"media-editor__crop-handles-side media-editor__crop-handles-side--s\" />\n\n          <div ref={leftTopHandle} class=\"media-editor__crop-handles-circle media-editor__crop-handles-circle--nw\" />\n          <div ref={rightTopHandle} class=\"media-editor__crop-handles-circle media-editor__crop-handles-circle--ne\" />\n          <div ref={leftBottomHandle} class=\"media-editor__crop-handles-circle media-editor__crop-handles-circle--sw\" />\n          <div\n            ref={rightBottomHandle}\n            class=\"media-editor__crop-handles-circle media-editor__crop-handles-circle--se\"\n          />\n        </div>\n      </div>\n    </>\n  );\n}\n","import {createEffect, onCleanup} from 'solid-js';\nimport {animate} from '@helpers/animation';\nimport clamp from '@helpers/number/clamp';\nimport {SetVideoTimeFlags, useMediaEditorContext} from '@components/mediaEditor/context';\n\n\ntype Args = {\n  gl: WebGLRenderingContext;\n  drawAdjustedImage: () => void;\n};\n\nexport default function initVideoPlayback({gl, drawAdjustedImage}: Args) {\n  const {editorState, mediaState, actions} = useMediaEditorContext();\n  const {renderingPayload} = editorState;\n  const video = renderingPayload.media.video;\n\n  if(!video) return;\n\n  // We don't want this 'seeked' event to be fired when generating the final result\n  let pendingSeek = false;\n\n  actions.setVideoTime = (time: number, flags = SetVideoTimeFlags.Redraw | SetVideoTimeFlags.UpdateVideo | SetVideoTimeFlags.UpdateCursor) => {\n    if(flags & SetVideoTimeFlags.UpdateCursor) mediaState.currentVideoTime = time;\n    if(flags & SetVideoTimeFlags.UpdateVideo) video.currentTime = time * video.duration;\n    if(flags & SetVideoTimeFlags.Redraw) pendingSeek = true;\n  };\n\n  const seekListener = () => {\n    if(!pendingSeek) return;\n    pendingSeek = false;\n\n    gl.bindTexture(gl.TEXTURE_2D, renderingPayload.texture);\n    gl.texSubImage2D(gl.TEXTURE_2D, 0, 0, 0, gl.RGBA, gl.UNSIGNED_BYTE, video);\n\n    drawAdjustedImage();\n  };\n\n  video.addEventListener('seeked', seekListener);\n  onCleanup(() => {\n    video.removeEventListener('seeked', seekListener);\n  });\n\n\n  createEffect(() => {\n    if(editorState.currentTab !== 'adjustments') return;\n\n    const listener = (event: KeyboardEvent) => {\n      const el = (event.target as HTMLElement);\n\n      if(event.code === 'Space' && !el.isContentEditable) {\n        event.preventDefault(); // stop page from scrolling, idk if needed\n        editorState.isPlaying = !editorState.isPlaying;\n      }\n    };\n\n    document.addEventListener('keydown', listener);\n\n    onCleanup(() => {\n      editorState.isPlaying = false;\n      document.removeEventListener('keydown', listener);\n    });\n  });\n\n  createEffect(() => {\n    video.muted = mediaState.videoMuted;\n  });\n\n  createEffect(() => {\n    if(!editorState.isPlaying) return;\n\n    let\n      frameCallbackId: number,\n      playing = true,\n      skip = 0\n    ;\n\n    function frameCallback() {\n      gl.bindTexture(gl.TEXTURE_2D, renderingPayload.texture);\n      gl.texSubImage2D(gl.TEXTURE_2D, 0, 0, 0, gl.RGBA, gl.UNSIGNED_BYTE, video);\n\n      drawAdjustedImage();\n\n      frameCallbackId = video.requestVideoFrameCallback(() => frameCallback());\n    }\n\n    const timeout = self.setTimeout(() => {\n      if(mediaState.currentVideoTime >= mediaState.videoCropStart + mediaState.videoCropLength)\n        actions.setVideoTime(mediaState.videoCropStart);\n\n      frameCallbackId = video.requestVideoFrameCallback(frameCallback);\n      video.play();\n\n      animate(() => {\n        skip = (skip + 1) % 3;\n\n        if(skip) return true;\n        if(!playing) return false;\n\n        mediaState.currentVideoTime = video.currentTime / video.duration || 0;\n\n        if(video.ended || video.paused || mediaState.currentVideoTime >= mediaState.videoCropStart + mediaState.videoCropLength) {\n          playing = false;\n          editorState.isPlaying = false;\n          mediaState.currentVideoTime = clamp(mediaState.currentVideoTime, mediaState.videoCropStart, mediaState.videoCropStart + mediaState.videoCropLength);\n        }\n\n        return playing;\n      });\n    }, 200); // Let the pause/play icon animation finish as it might lag without this\n\n    onCleanup(() => {\n      playing = false;\n      self.clearTimeout(timeout);\n      video.cancelVideoFrameCallback(frameCallbackId);\n      video.pause();\n    });\n  });\n};\n","import {createEffect, createReaction, onCleanup, onMount} from 'solid-js';\nimport {modifyMutable, produce} from 'solid-js/store';\nimport createMiddleware from '@helpers/solid/createMiddleware';\nimport {adjustmentsConfig, AdjustmentsConfig} from '@components/mediaEditor/adjustments';\nimport {useMediaEditorContext} from '@components/mediaEditor/context';\nimport {cleanupWebGl, withCurrentOwner} from '@components/mediaEditor/utils';\nimport {draw} from '@components/mediaEditor/webgl/draw';\nimport {initWebGL} from '@components/mediaEditor/webgl/initWebGL';\nimport initVideoPlayback from '@components/mediaEditor/canvas/initVideoPlayback';\n\n\nfunction drawAdjustedImage(gl: WebGLRenderingContext) {\n  const {editorState, mediaState} = useMediaEditorContext();\n\n  const payload = editorState.renderingPayload;\n  if(!payload) return;\n\n  draw(gl, payload, {\n    ...editorState.finalTransform,\n    imageSize: [payload.media.width, payload.media.height],\n    ...(Object.fromEntries(\n      adjustmentsConfig.map(({key, to100}) => {\n        const value = mediaState.adjustments[key];\n        return [key, value / (to100 ? 100 : 50)];\n      })\n    ) as Record<AdjustmentsConfig[number]['key'], number>)\n  });\n}\n\nexport default function ImageCanvas() {\n  const {editorState, mediaState, mediaSrc, mediaType, actions} = useMediaEditorContext();\n\n  const canvas = (\n    <canvas width={editorState.canvasSize[0] * editorState.pixelRatio} height={editorState.canvasSize[1] * editorState.pixelRatio} />\n  ) as HTMLCanvasElement;\n\n  const gl = canvas.getContext('webgl', {\n    preserveDrawingBuffer: true\n  });\n\n  editorState.imageCanvas = canvas;\n\n  const ownedDrawAdjustedImage = withCurrentOwner(() => drawAdjustedImage(gl));\n\n  const ownedInitVideoPlayback = withCurrentOwner(() =>\n    initVideoPlayback({gl, drawAdjustedImage: ownedDrawAdjustedImage})\n  );\n\n  const middleware = createMiddleware().get();\n\n  async function init() {\n    const payload = await initWebGL({gl, mediaSrc, mediaType, videoTime: mediaState.currentVideoTime, middleware});\n\n    modifyMutable(editorState, produce(state => {\n      state.renderingPayload = payload;\n      state.imageSize = [payload.media.width, payload.media.height];\n    }));\n\n    if(!mediaState.currentImageRatio) {\n      const ratio = payload.media.width / payload.media.height;\n      actions.setInitialImageRatio(ratio)\n      mediaState.currentImageRatio = ratio;\n    }\n\n    ownedInitVideoPlayback();\n  }\n\n  onMount(() => {\n    if(editorState.isReady) init(); // When hot reloading\n    else {\n      const track = createReaction(() => {\n        init();\n      });\n\n      track(() => editorState.isReady);\n    }\n  });\n\n  createEffect(() => {\n    drawAdjustedImage(gl);\n  });\n\n  onCleanup(() => {\n    cleanupWebGl(gl);\n  });\n\n  return <>{canvas}</>;\n}\n","import {Show} from 'solid-js';\n\nimport {hexToRgb} from '@helpers/color';\n\nimport {useMediaEditorContext} from '@components/mediaEditor/context';\n\n\nconst PreviewBrushSize = () => {\n  const {editorState} = useMediaEditorContext();\n\n  return (\n    <Show when={editorState.previewBrushSize}>\n      <div\n        class=\"media-editor__preview-brush-size\"\n        style={{\n          '--color': !['blur', 'eraser'].includes(editorState.currentBrush.brush) ?\n            hexToRgb(editorState.currentBrush.color).join(',') :\n            undefined,\n          'width': editorState.previewBrushSize + 'px',\n          'height': editorState.previewBrushSize + 'px'\n        }}\n      />\n    </Show>\n  );\n};\n\nexport default PreviewBrushSize;\n","import {createSignal, onCleanup} from 'solid-js';\n\nfunction useMediaQuery(query: string) {\n  const [isMatch, setIsMatch] = createSignal(false);\n\n  const updateMatch = () => {\n    setIsMatch(window.matchMedia(query).matches);\n  };\n\n  const mediaQueryList = window.matchMedia(query);\n  setIsMatch(mediaQueryList.matches);\n\n  mediaQueryList.addEventListener('change', updateMatch);\n  onCleanup(() => {\n    mediaQueryList.removeEventListener('change', updateMatch);\n  });\n\n  return isMatch;\n}\n\nexport default function useIsMobile() {\n  const isMobile = useMediaQuery('(max-width: 800px');\n  return isMobile;\n}\n","import {onCleanup, onMount} from 'solid-js';\n\nimport createMiddleware from '@helpers/solid/createMiddleware';\nimport wrapSticker from '@components/wrappers/sticker';\n\nimport {useMediaEditorContext} from '@components/mediaEditor/context';\nimport {ResizableLayerProps} from '@components/mediaEditor/types';\n\nimport {ResizableContainer} from '@components/mediaEditor/canvas/resizableLayers';\n\nexport default function StickerLayerContent(props: ResizableLayerProps) {\n  const {editorState} = useMediaEditorContext();\n\n  let container: HTMLDivElement;\n\n  onMount(() => {\n    const middleware = createMiddleware();\n\n    wrapSticker({\n      div: container,\n      doc: props.layer.sticker,\n      group: 'none',\n      width: 500,\n      height: 500,\n      play: true,\n      loop: true,\n      withThumb: false,\n      middleware: middleware.get()\n    });\n\n    editorState.stickersLayersInfo[props.layer.id] = {container};\n\n    onCleanup(() => {\n      middleware.destroy();\n    });\n  });\n\n  const children = (\n    <div ref={container} class=\"media-editor__sticker-layer-content\" />\n  ); // Needs to be rendered here for hot reload to work properly\n\n  return (\n    <ResizableContainer layer={props.layer}>\n      {children}\n    </ResizableContainer>\n  );\n}\n","import {batch, createEffect, createMemo, on, onCleanup, onMount} from 'solid-js';\n\nimport createElementFromMarkup from '@helpers/createElementFromMarkup';\nimport {i18n} from '@lib/langPack';\n\nimport {ResizableLayerProps, TextLayerInfo, TextRenderingInfoLine} from '@components/mediaEditor/types';\nimport {fontInfoMap, getContrastColor, log} from '@components/mediaEditor/utils';\nimport {HistoryItem, useMediaEditorContext} from '@components/mediaEditor/context';\n\nimport {ResizableContainer} from '@components/mediaEditor/canvas/resizableLayers';\n\nexport default function TextLayerContent(props: ResizableLayerProps) {\n  const {editorState, mediaState, actions} = useMediaEditorContext();\n\n  if(!props.layer.textInfo) return;\n\n  const onFocus = () => {\n    batch(() => {\n      editorState.selectedResizableLayer = props.layer.id;\n      editorState.currentTextLayerInfo = {...props.layer.textInfo};\n    });\n  };\n\n  const fontInfo = () => fontInfoMap[props.layer.textInfo.font];\n\n  function deleteThisLayer() {\n    const layers = mediaState.resizableLayers;\n    const idx = layers.findIndex(layer => layer.id === props.layer.id);\n    if(idx < 0) return;\n    const deletedLayer = layers.splice(idx, 1)[0];\n    deletedLayer.textRenderingInfo = undefined;\n\n    actions.pushToHistory({\n      path: ['resizableLayers', idx],\n      newValue: HistoryItem.RemoveArrayItem,\n      oldValue: deletedLayer,\n      findBy: {\n        id: deletedLayer.id\n      }\n    });\n  }\n\n  function updateBackground() {\n    contentEditable.childNodes.forEach((childNode) => {\n      if(childNode instanceof HTMLDivElement && !childNode.hasAttributes()) {\n        childNode.querySelectorAll('*').forEach((element) => {\n          const node = document.createTextNode(element.textContent);\n          element.replaceWith(node);\n        });\n      } else {\n        const div = document.createElement('div');\n        div.textContent = childNode.textContent;\n        childNode.replaceWith(div);\n      }\n    });\n    if(!contentEditable.textContent) {\n      contentEditable.innerHTML = '<div></div>';\n\n      // Firefox cursor reset\n      const child = contentEditable.children[0];\n      const range = document.createRange();\n      const sel = window.getSelection();\n\n      range.setStart(child, 0);\n      range.collapse(true);\n\n      sel.removeAllRanges();\n      sel.addRange(range);\n    }\n\n    // Firefox puts the cursor outside the inner divs and messes up everything\n    const selection = window.getSelection();\n    if(selection.rangeCount > 0) {\n      const range = selection.getRangeAt(0);\n      if(range.startContainer === contentEditable && range.startOffset === 0) {\n        const innerDiv = contentEditable.children[0];\n        const innerDivRange = document.createRange();\n        innerDivRange.selectNodeContents(innerDiv);\n        innerDivRange.collapse(false); // Collapse to the end of the inner div\n\n        selection.removeAllRanges();\n        selection.addRange(innerDivRange);\n      }\n    }\n\n    container.querySelector('.media-editor__text-layer-background')?.remove();\n    const lines = getLinesRenderingInfo(contentEditable, props.layer.textInfo.alignment);\n    const path = createTextBackgroundPath(lines);\n\n    if(props.layer.textInfo.style === 'background') updateBackgroundStyle(container, path.join(' '), props.layer.textInfo);\n    if(props.layer.textInfo.style === 'outline') updateOutlineStyle(container, contentEditable, props.layer.textInfo);\n\n    props.layer.textRenderingInfo =  {\n      width: container.clientWidth,\n      height: container.clientHeight,\n      path,\n      lines\n    };\n  }\n\n  function selectAll() {\n    const range = document.createRange();\n    range.selectNodeContents(contentEditable.children[0]);\n    const selection = window.getSelection();\n    selection.removeAllRanges();\n    selection.addRange(range);\n  }\n\n  createEffect(() => {\n    updateBackground();\n  });\n\n  const isThisLayerSelected = createMemo(() => props.layer.id === editorState.selectedResizableLayer);\n\n  onMount(() => {\n    if(isThisLayerSelected()) selectAll();\n  });\n\n\n  createEffect(() => {\n    if(isThisLayerSelected()) {\n      onCleanup(() => {\n        if(!contentEditable.innerText.trim()) {\n          deleteThisLayer();\n        }\n      })\n    }\n  });\n\n  createEffect(\n    on(() => ({...editorState.currentTextLayerInfo}), () => {\n      if(editorState.selectedResizableLayer !== props.layer.id) return;\n      props.layer.textInfo = {...editorState.currentTextLayerInfo};\n    })\n  );\n\n  onMount(() => {\n    container.addEventListener('dragstart', (e: Event) => {\n      e.preventDefault();\n    });\n  });\n\n  let container: HTMLDivElement;\n  let contentEditable: HTMLDivElement;\n\n  const color = () => {\n    if(props.layer.textInfo.style === 'normal') return props.layer.textInfo.color;\n    return getContrastColor(props.layer.textInfo.color);\n  };\n\n  const intialContent = (() => {\n    const layerInfo = props.layer.textRenderingInfo;\n    if(!layerInfo) return <div>{i18n('MediaEditor.TypeSomething')}</div>;\n    return layerInfo.lines.map((line) => <div>{line.content}</div>);\n  })();\n\n  const children = (\n    <div\n      ref={container}\n      class=\"media-editor__text-layer\"\n      classList={{\n        'media-editor__text-layer--with-bg': props.layer.textInfo.style === 'background'\n      }}\n      style={{\n        'color': color(),\n        'font-size': props.layer.textInfo.size + 'px',\n        'font-family': fontInfo().fontFamily,\n        'font-weight': fontInfo().fontWeight,\n        '--align-items': flexAlignMap[props.layer.textInfo.alignment]\n      }}\n    >\n      <div\n        ref={contentEditable}\n        class=\"media-editor__text-layer-layout\"\n        contenteditable\n        onInput={() => updateBackground()}\n        onFocus={onFocus}\n      >\n        {intialContent}\n      </div>\n    </div>\n  ); // Needs to be rendered here for hot reload to work properly\n\n  return (\n    <ResizableContainer layer={props.layer}>\n      {children}\n    </ResizableContainer>\n  );\n}\n\nfunction getLinesRenderingInfo(linesContainer: HTMLDivElement, alignment: string): TextRenderingInfoLine[] {\n  return Array.from(linesContainer.children).map((_child) => {\n    const child = _child as HTMLElement;\n    let offset = 0;\n    if(alignment === 'left') {\n      offset = 0;\n    } else if(alignment === 'center') {\n      offset = (linesContainer.clientWidth - child.clientWidth) / 2;\n    } else {\n      offset = linesContainer.clientWidth - child.clientWidth;\n    }\n    return {\n      left: offset,\n      right: offset + child.clientWidth,\n      content: child.innerText,\n      height: child.clientHeight\n    };\n  });\n}\n\nfunction createTextBackgroundPath(lines: TextRenderingInfoLine[]) {\n  const first = lines[0];\n\n  const rounding = first.height * 0.3;\n\n  const arcParams = (r: number, s: number = 1) => [r, r, 0, 0, s];\n\n  const path = [];\n  path.push('M', first.left, rounding);\n\n  path.push('A', ...arcParams(rounding), first.left + rounding, 0);\n  path.push('L', first.right - rounding, 0);\n  path.push('A', ...arcParams(rounding), first.right, rounding);\n\n  let prevPosition = first;\n  let prevY = first.height;\n\n  for(let i = 1; i < lines.length; i++) {\n    const position = lines[i];\n\n    const diffSign = position.right > prevPosition.right ? 1 : -1;\n    const diff = Math.min(Math.abs((position.right - prevPosition.right) / 2), rounding) * diffSign;\n    const currentRounding = Math.abs(diff);\n\n    path.push('L', prevPosition.right, prevY - currentRounding);\n    path.push('A', ...arcParams(currentRounding, diffSign === 1 ? 0 : 1), prevPosition.right + diff, prevY);\n    path.push('L', position.right - diff, prevY);\n    path.push('A', ...arcParams(currentRounding, diffSign === 1 ? 1 : 0), position.right, prevY + currentRounding);\n\n    prevY += position.height;\n    prevPosition = position;\n  }\n\n  path.push('L', prevPosition.right, prevY - rounding);\n  path.push('A', ...arcParams(rounding), prevPosition.right - rounding, prevY);\n  path.push('L', prevPosition.left + rounding, prevY);\n  path.push('A', ...arcParams(rounding), prevPosition.left, prevY - rounding);\n\n  const last = lines[lines.length - 1];\n  prevY -= last.height;\n  for(let i = lines.length - 2; i >= 0; i--) {\n    const position = lines[i];\n\n    const diffSign = position.left > prevPosition.left ? 1 : -1;\n    const diff = Math.min(Math.abs((position.left - prevPosition.left) / 2), rounding) * diffSign;\n    const currentRounding = Math.abs(diff);\n\n    path.push('L', prevPosition.left, prevY + currentRounding);\n    path.push('A', ...arcParams(currentRounding, diffSign !== 1 ? 0 : 1), prevPosition.left + diff, prevY);\n    path.push('L', position.left - diff, prevY);\n    path.push('A', ...arcParams(currentRounding, diffSign !== 1 ? 1 : 0), position.left, prevY - currentRounding);\n\n    prevY -= position.height;\n    prevPosition = position;\n  }\n\n  return path;\n}\n\nfunction updateBackgroundStyle(container: HTMLDivElement, path: string, info: TextLayerInfo) {\n  const svg = createElementFromMarkup(`\n    <svg width=\"${container.clientWidth}\" height=\"${container.clientHeight}\" viewBox=\"0 0 ${container.clientWidth} ${container.clientHeight}\">\n      <path d=\"${path}\" fill=\"${info.color}\" />\n    </svg>\n  `);\n  svg.classList.add('media-editor__text-layer-background');\n  container.prepend(svg);\n\n  return path;\n}\n\nfunction updateOutlineStyle(container: HTMLDivElement, contentEditable: HTMLDivElement, info: TextLayerInfo) {\n  const fontInfo = fontInfoMap[info.font];\n  function updateSvg(div: HTMLDivElement) {\n    div.querySelector('.media-editor__text-layer-svg-outline')?.remove();\n    const stretch = info.size * 0.5;\n    const w = div.clientWidth + stretch;\n    const h = div.clientHeight + stretch;\n    const svg = createElementFromMarkup(`\n      <div class=\"media-editor__text-layer-svg-outline\" style=\"width: ${w}px; height: ${h}px;\">\n        <svg style=\"width: ${w}px; height: ${h}px;\" viewBox=\"${-stretch / 2} 0 ${div.clientWidth + stretch / 2} ${div.clientHeight + stretch}\">\n          <text\n            x=\"${info.size * 0.2}\"\n            y=\"${info.size * 1.33 * fontInfo.baseline}\"\n            style=\"font-size:${info.size}px;stroke:${info.color};stroke-width:${div.clientHeight * 0.15}px;font-family:${fontInfo.fontFamily};font-weight:${fontInfo.fontWeight};\">\n            ${div.innerText}\n          </text>\n        </svg>\n      </div>\n    `);\n    div.prepend(svg);\n  }\n\n  const bgDiv = document.createElement('div');\n  bgDiv.classList.add('media-editor__text-layer-background', 'media-editor__text-layer-background--as-layout');\n  bgDiv.innerHTML = contentEditable.innerHTML;\n  container.prepend(bgDiv);\n  Array.from(bgDiv.children).forEach((line) => {\n    if(line instanceof HTMLDivElement) updateSvg(line);\n  });\n}\n\nconst flexAlignMap: Record<string, string> = {\n  left: 'start',\n  center: 'center',\n  right: 'end'\n};\n","import {Accessor, batch, createEffect, createMemo, For, on, onCleanup, onMount, ParentProps, Show} from 'solid-js';\nimport {createMutable, modifyMutable, produce} from 'solid-js/store';\nimport {Portal} from 'solid-js/web';\n\nimport createContextMenu from '@helpers/dom/createContextMenu';\n\nimport SwipeHandler, {getEvent} from '@components/swipeHandler';\nimport {observeResize} from '@components/resizeObserver';\n\nimport {NumberPair, ResizableLayer, ResizableLayerProps} from '@components/mediaEditor/types';\nimport {HistoryItem, useMediaEditorContext} from '@components/mediaEditor/context';\nimport {withCurrentOwner} from '@components/mediaEditor/utils';\nimport useIsMobile from '@components/mediaEditor/useIsMobile';\n\nimport StickerLayerContent from '@components/mediaEditor/canvas/stickerLayerContent';\nimport useNormalizePoint from '@components/mediaEditor/canvas/useNormalizePoint';\nimport TextLayerContent from '@components/mediaEditor/canvas/textLayerContent';\nimport useProcessPoint from '@components/mediaEditor/canvas/useProcessPoint';\n\n\ntype ProcessedLayer = {\n  position: NumberPair;\n  rotation: number;\n  scale: number;\n}\n\nexport default function ResizableLayers() {\n  const context = useMediaEditorContext();\n  const {editorState, mediaState, actions} = context;\n  const isTextTab = () => editorState.currentTab === 'text';\n  const canClick = () => ['stickers', 'text', 'adjustments'].includes(editorState.currentTab);\n\n\n  function moveSelectedLayerOnTop() {\n    const layers = mediaState.resizableLayers;\n    const idx = layers.findIndex(layer => layer.id === editorState.selectedResizableLayer);\n    if(idx < 0) return;\n    const layer = layers.splice(idx, 1)[0];\n    layer && layers.push(layer);\n  }\n\n  createEffect(\n    on(() => editorState.selectedResizableLayer, () => {\n      moveSelectedLayerOnTop();\n    })\n  );\n\n  createEffect(() => {\n    editorState.currentTab;\n    onCleanup(() => {\n      editorState.selectedResizableLayer = undefined;\n    });\n  });\n\n  let container: HTMLDivElement;\n\n  const normalizePoint = useNormalizePoint();\n\n  function addLayer(e: MouseEvent) {\n    if(e.target !== container) return;\n    if(editorState.selectedResizableLayer) {\n      editorState.selectedResizableLayer = undefined;\n      return;\n    }\n\n    if(!isTextTab()) return;\n\n    const bcr = container.getBoundingClientRect();\n    const transform = editorState.finalTransform;\n\n    const newResizableLayer = {\n      id: context.resizableLayersSeed++,\n      position: normalizePoint([e.clientX - bcr.left, e.clientY - bcr.top]),\n      rotation: -transform.rotation,\n      scale: 1 / transform.scale,\n      type: 'text',\n      textInfo: {...editorState.currentTextLayerInfo}\n    } as ResizableLayer;\n\n    batch(() => {\n      mediaState.resizableLayers.push(newResizableLayer);\n      editorState.selectedResizableLayer = newResizableLayer.id;\n\n      actions.pushToHistory({\n        path: ['resizableLayers', mediaState.resizableLayers.length - 1],\n        newValue: newResizableLayer,\n        oldValue: HistoryItem.RemoveArrayItem,\n        findBy: {\n          id: newResizableLayer.id\n        }\n      });\n    });\n  }\n\n  return (\n    <div\n      class=\"media-editor__resizable-layers\"\n      classList={{\n        'media-editor__resizable-layers--active': canClick()\n      }}\n      style={{\n        cursor: !editorState.selectedResizableLayer && isTextTab() ? 'text' : undefined\n      }}\n    >\n      <div\n        ref={container}\n        class=\"media-editor__resizable-layers-inner\"\n        onClick={withCurrentOwner(addLayer)}\n        style={{\n          'opacity': editorState.isAdjusting ? 0 : 1\n        }}\n      >\n        <For each={mediaState.resizableLayers}>\n          {(layer) => (\n            <>\n              <Show when={layer.type === 'text'}>\n                <TextLayerContent layer={layer} />\n              </Show>\n              <Show when={layer.type === 'sticker'}>\n                <StickerLayerContent layer={layer} />\n              </Show>\n            </>\n          )}\n        </For>\n      </div>\n    </div>\n  );\n}\n\nexport function ResizableContainer(props: ParentProps<ResizableLayerProps>) {\n  const {editorState, mediaState} = useMediaEditorContext();\n\n  const isMobile = useIsMobile();\n  const processPoint = useProcessPoint(false);\n\n\n  const handleTyping = (): HTMLDivElement | undefined => undefined;\n\n  const store = createMutable({\n    diff: [0, 0] as NumberPair,\n    containerWidth: 0,\n    containerHeight: 0,\n    leftTopEl: handleTyping(),\n    rightTopEl: handleTyping(),\n    leftBottomEl: handleTyping(),\n    rightBottomEl: handleTyping()\n  });\n\n  const circleOffset = () => (isMobile() ? '-6px' : '-4px');\n  const canShowHandles = () => editorState.resizeHandlesContainer && props.layer.id === editorState.selectedResizableLayer;\n\n  const processedLayer = createMemo(() => ({\n    position: processPoint(props.layer.position),\n    rotation: props.layer.rotation + mediaState.rotation,\n    scale: editorState.finalTransform.scale * props.layer.scale\n  }));\n\n\n  let container: HTMLDivElement;\n\n  onMount(() => {\n    useResizeHandles({\n      container,\n      leftBottomEl: () => store.leftBottomEl,\n      leftTopEl: () => store.leftTopEl,\n      rightBottomEl: () => store.rightBottomEl,\n      rightTopEl: () => store.rightTopEl,\n\n      layer: props.layer,\n      diff: store.diff,\n      processedLayer\n    });\n\n    useContextMenu({container, layer: props.layer});\n\n    const unobserve = observeResize(container, () => {\n      store.containerWidth = container.clientWidth;\n      store.containerHeight = container.clientHeight;\n    });\n\n    onCleanup(() => {\n      unobserve();\n    });\n  });\n\n  return (\n    <div\n      class=\"media-editor__resizable-container\"\n      style={{\n        'left': processedLayer().position[0] + store.diff[0] + 'px',\n        'top': processedLayer().position[1] + store.diff[1] + 'px',\n        '--rotation': (processedLayer().rotation / Math.PI) * 180 + 'deg',\n        '--scale': processedLayer().scale\n      }}\n      onClick={() => {\n        editorState.selectedResizableLayer = props.layer.id;\n      }}\n      ref={container}\n    >\n      {props.children}\n\n      {canShowHandles() && <Portal mount={editorState.resizeHandlesContainer}>\n        <div\n          class=\"media-editor__resizable-container-handles\"\n          style={{\n            'left': processedLayer().position[0] + store.diff[0] + 'px',\n            'top': processedLayer().position[1] + store.diff[1] + 'px',\n            'width': store.containerWidth * processedLayer().scale + 'px',\n            'height': store.containerHeight * processedLayer().scale + 'px',\n            '--rotation': (processedLayer().rotation / Math.PI) * 180 + 'deg'\n          }}\n        >\n          <div\n            class=\"media-editor__resizable-container-border media-editor__resizable-container-border--vertical\"\n            style={{left: 0}}\n          />\n          <div\n            class=\"media-editor__resizable-container-border media-editor__resizable-container-border--vertical\"\n            style={{right: 0}}\n          />\n          <div\n            class=\"media-editor__resizable-container-border media-editor__resizable-container-border--horizontal\"\n            style={{top: 0}}\n          />\n          <div\n            class=\"media-editor__resizable-container-border media-editor__resizable-container-border--horizontal\"\n            style={{bottom: 0}}\n          />\n          <div\n            ref={(el) => store.leftTopEl = el}\n            class=\"media-editor__resizable-container-circle\"\n            style={{left: circleOffset(), top: circleOffset()}}\n          />\n          <div\n            ref={(el) => store.rightTopEl = el}\n            class=\"media-editor__resizable-container-circle\"\n            style={{right: circleOffset(), top: circleOffset()}}\n          />\n          <div\n            ref={(el) => store.leftBottomEl = el}\n            class=\"media-editor__resizable-container-circle\"\n            style={{left: circleOffset(), bottom: circleOffset()}}\n          />\n          <div\n            ref={(el) => store.rightBottomEl = el}\n            class=\"media-editor__resizable-container-circle\"\n            style={{right: circleOffset(), bottom: circleOffset()}}\n          />\n        </div>\n      </Portal>}\n    </div>\n  );\n}\n\n\ntype UseResizeArgs = {\n  container: HTMLDivElement;\n  leftTopEl: () => HTMLDivElement;\n  rightTopEl: () => HTMLDivElement;\n  leftBottomEl: () => HTMLDivElement;\n  rightBottomEl: () => HTMLDivElement;\n\n  diff: NumberPair;\n  layer: ResizableLayer;\n  processedLayer: Accessor<ProcessedLayer>;\n};\n\nfunction useResizeHandles({\n  container,\n  leftTopEl,\n  rightTopEl,\n  leftBottomEl,\n  rightBottomEl,\n  diff,\n  layer,\n  processedLayer\n}: UseResizeArgs) {\n  const {editorState, mediaState} = useMediaEditorContext();\n\n  const normalizePoint = useNormalizePoint();\n\n\n  let firstTarget: EventTarget;\n  let swipeStarted = false;\n\n  const multipliers = [\n    {el: leftTopEl, x: -1, y: -1},\n    {el: rightTopEl, x: 1, y: -1},\n    {el: leftBottomEl, x: -1, y: 1},\n    {el: rightBottomEl, x: 1, y: 1}\n  ];\n\n  multipliers.forEach(({el, x, y}) => {\n    createEffect(() => {\n      const element = el();\n      if(!element) return;\n\n      const swipeHandler = new SwipeHandler({\n        element,\n        onStart() {\n          element.classList.add('media-editor__resizable-container-circle--anti-flicker');\n        },\n        onSwipe(_, __, _e) {\n          const e = getEvent(_e);\n\n          if(!firstTarget) firstTarget = e.target;\n          if(firstTarget !== element) return;\n\n          const initialVector = [\n            (container.clientWidth / 2) * x * editorState.finalTransform.scale,\n            (container.clientHeight / 2) * y * editorState.finalTransform.scale\n          ];\n          const bcr = container.getBoundingClientRect();\n          const resizedVector = [bcr.left + bcr.width / 2 - e.clientX, bcr.top + bcr.height / 2 - e.clientY];\n\n          const rotationFromHorizon =\n            Math.atan2(resizedVector[1], resizedVector[0]) - Math.atan2(initialVector[1], initialVector[0]) + Math.PI;\n          const scale = Math.hypot(resizedVector[0], resizedVector[1]) / Math.hypot(initialVector[0], initialVector[1]);\n\n          modifyMutable(layer, produce(s => {\n            s.rotation = rotationFromHorizon - mediaState.rotation;\n            s.scale = scale;\n          }));\n        },\n        onReset() {\n          element.classList.remove('media-editor__resizable-container-circle--anti-flicker');\n          firstTarget = undefined;\n        }\n      });\n      onCleanup(() => {\n        swipeHandler.removeListeners();\n      });\n    });\n  });\n\n\n  const moveHandler = new SwipeHandler({\n    element: container,\n    onSwipe(xDiff, yDiff, e) {\n      if(!firstTarget) firstTarget = e.target;\n      if(multipliers.find(({el}) => el() === firstTarget)) return;\n\n      if(!swipeStarted) {\n        // onStart messes up the typing\n        swipeStarted = true;\n        editorState.selectedResizableLayer = layer.id;\n      }\n\n      diff.splice(0, 2, xDiff, yDiff);\n    },\n    onReset() {\n      layer.position = normalizePoint([processedLayer().position[0] + diff[0], processedLayer().position[1] + diff[1]]);\n      diff.splice(0, 2, 0, 0);\n      swipeStarted = false;\n      firstTarget = undefined;\n    }\n  });\n\n  onCleanup(() => {\n    moveHandler.removeListeners();\n  });\n}\n\n\ntype UseContextMenuArgs = {\n  container: HTMLDivElement;\n  layer: ResizableLayer;\n}\n\nfunction useContextMenu({container, layer}: UseContextMenuArgs) {\n  const {editorState, mediaState, actions} = useMediaEditorContext();\n\n  function onClick() {\n    const layers = mediaState.resizableLayers;\n    const idx = layers.findIndex(otherLayer => otherLayer.id === layer.id);\n    if(idx < 0) return;\n\n    batch(() => {\n      editorState.selectedResizableLayer = undefined;\n      const deletedLayer = layers.splice(idx, 1)[0];\n\n      actions.pushToHistory({\n        path: ['resizableLayers', idx],\n        newValue: HistoryItem.RemoveArrayItem,\n        oldValue: deletedLayer,\n        findBy: {\n          id: deletedLayer.id\n        }\n      });\n    });\n  }\n\n  const contextMenu = createContextMenu({\n    buttons: [\n      {\n        icon: 'delete',\n        className: 'danger',\n        text: 'Delete',\n        onClick\n      }\n    ],\n    listenTo: container,\n    onElementReady: (element) => {\n      element.classList.add('night');\n    }\n  });\n\n  onCleanup(() => {\n    contextMenu.destroy();\n  });\n}\n","import {modifyMutable, produce} from 'solid-js/store';\nimport {animateValue} from '@helpers/animateValue';\nimport {lerp, lerpArray} from '@helpers/lerp';\nimport {useMediaEditorContext} from '@components/mediaEditor/context';\nimport {NumberPair} from '@components/mediaEditor/types';\nimport {snapToViewport} from '@components/mediaEditor/utils';\nimport {useCropOffset} from '@components/mediaEditor/canvas/useCropOffset';\n\n\nexport function animateToNewRotationOrRatio(newRotation: number) {\n  const {editorState, mediaState} = useMediaEditorContext();\n  if(!editorState.imageSize) return;\n\n  const cropOffset = useCropOffset();\n\n  const [w, h] = editorState.imageSize;\n\n  const snappedRotation90 = Math.round((newRotation / Math.PI) * 2);\n  const isReversedRatio = Math.abs(snappedRotation90) & 1;\n  const snappedRotation = (snappedRotation90 * Math.PI) / 2;\n\n  let ratio: number;\n\n  if(editorState.fixedImageRatioKey?.includes('x')) {\n    const parts = editorState.fixedImageRatioKey.split('x');\n    ratio = parseInt(parts[0]) / parseInt(parts[1]);\n  } else {\n    ratio = isReversedRatio ? h / w : w / h;\n  }\n\n  const originalRatio = w / h;\n\n  const [w1, h1] = snapToViewport(originalRatio, cropOffset().width, cropOffset().height);\n  const [w2, h2] = snapToViewport(ratio, cropOffset().width, cropOffset().height);\n\n  const initialScale = mediaState.scale;\n  const initialTranslation = mediaState.translation;\n  const initialRotation = mediaState.rotation;\n  const targetScale = isReversedRatio ? Math.max(w2 / h1, h2 / w1) : Math.max(w2 / w1, h2 / h1);\n  const targetTranslation = [0, 0];\n  const targetRotation = snappedRotation;\n\n  mediaState.currentImageRatio = ratio;\n  editorState.isMoving = true;\n\n  animateValue(\n    0,\n    1,\n    200,\n    (progress) => {\n      modifyMutable(mediaState, produce((state) => {\n        state.scale = lerp(initialScale, targetScale, progress);\n        state.translation = lerpArray(initialTranslation, targetTranslation, progress) as NumberPair;\n        state.rotation = lerp(initialRotation, targetRotation, progress);\n      }));\n    },\n    {\n      onEnd: () => {\n        editorState.isMoving = false;\n        mediaState.rotation = mediaState.rotation % (Math.PI * 2);\n      }\n    }\n  );\n}\n","import {batch, createEffect, createSignal, on, onCleanup, onMount} from 'solid-js';\nimport {modifyMutable, produce} from 'solid-js/store';\nimport {animateValue} from '@helpers/animateValue';\nimport {lerp} from '@helpers/lerp';\nimport clamp from '@helpers/number/clamp';\nimport {ButtonIconTsx} from '@components/buttonIconTsx';\nimport SwipeHandler from '@components/swipeHandler';\nimport {useMediaEditorContext} from '@components/mediaEditor/context';\nimport {NumberPair} from '@components/mediaEditor/types';\nimport {withCurrentOwner} from '@components/mediaEditor/utils';\nimport {animateToNewRotationOrRatio} from '@components/mediaEditor/canvas/animateToNewRotationOrRatio';\nimport getConvenientPositioning from '@components/mediaEditor/canvas/getConvenientPositioning';\n\n\nconst DEGREE_DIST_PX = 42;\nconst DEGREE_STEP = 15;\nconst TOTAL_DEGREES_SIDE = 90;\nconst MAX_DEGREES_DIST_PX = (TOTAL_DEGREES_SIDE / DEGREE_STEP) * DEGREE_DIST_PX;\nconst SNAP_DIST_PX = 40;\n\nfunction rotationFromMove(amount: number) {\n  return ((amount / DEGREE_DIST_PX) * DEGREE_STEP * Math.PI) / 180;\n}\n\nexport default function RotationWheel() {\n  const {editorState, mediaState, actions} = useMediaEditorContext();\n\n  const isCropping = () => editorState.currentTab === 'crop';\n\n  const [moved, setMoved] = createSignal(0);\n  const [movedDiff, setMovedDiff] = createSignal(0);\n\n  let swiperEl: HTMLDivElement;\n\n  onMount(() => {\n    const snappedRotation = (Math.round((mediaState.rotation / Math.PI) * 2) * Math.PI) / 2;\n    setMoved((((snappedRotation - mediaState.rotation) * 180) / Math.PI / DEGREE_STEP) * DEGREE_DIST_PX);\n    prevRotation = rotationFromMove(moved());\n\n    let currentDiff: number;\n    let targetDiff: number;\n    let prevShouldSnap = getShouldSnap();\n    let isAnimating = false;\n    let isSnapped = false;\n    let cancelAnimation: () => void;\n    let timeoutId: number;\n\n    function getShouldSnap() {\n      return Math.abs(moved() + currentDiff || 0) < SNAP_DIST_PX\n    }\n\n    function handleDiffChange(diff: number) {\n      setMovedDiff(diff);\n      onSwipe();\n    }\n\n    function removeSnapAfterTimeout() {\n      timeoutId = window.setTimeout(() => {\n        isSnapped = false;\n        isAnimating = true;\n\n        const initialDiff = movedDiff();\n        cancelAnimation?.();\n        cancelAnimation = animateValue(0, 1, 200, (progress) => {\n          handleDiffChange(lerp(initialDiff, currentDiff, progress));\n        }, {\n          onEnd: () => {\n            isAnimating = false\n          }\n        });\n      }, 750);\n    }\n\n    const swipeHandler = new SwipeHandler({\n      element: swiperEl,\n      onStart() {\n        initialScale = mediaState.scale;\n        currentDiff = movedDiff();\n        targetDiff = currentDiff;\n        isAnimating = false;\n        isSnapped = false;\n        prevShouldSnap = getShouldSnap();\n        editorState.isMoving = true;\n      },\n      onSwipe(xDiff) {\n        targetDiff = currentDiff = clamp(moved() + xDiff, -MAX_DEGREES_DIST_PX, MAX_DEGREES_DIST_PX) - moved();\n        const shouldSnap = getShouldSnap();\n        if(shouldSnap) targetDiff = -moved();\n\n        if(prevShouldSnap !== shouldSnap) {\n          window.clearTimeout(timeoutId);\n          timeoutId = window.setTimeout(() => {\n            const shouldSnapAfterTimeout = getShouldSnap();\n            if(shouldSnapAfterTimeout !== shouldSnap) return;\n            isAnimating = true;\n            const initialDiff = movedDiff();\n            cancelAnimation?.();\n            cancelAnimation = animateValue(0, 1, 200, (progress) => {\n              handleDiffChange(lerp(initialDiff, targetDiff, progress));\n            }, {\n              onEnd: () => {\n                isAnimating = false;\n                isSnapped = getShouldSnap();\n\n                if(!isSnapped) return;\n                removeSnapAfterTimeout();\n              }\n            });\n          }, 200);\n        }\n\n        prevShouldSnap = shouldSnap;\n\n        if(isAnimating || isSnapped) return;\n        handleDiffChange(currentDiff);\n      },\n      onReset() {\n        let newMoved = moved() + movedDiff();\n        if(Math.abs(newMoved) === MAX_DEGREES_DIST_PX) {\n          newMoved = 0;\n          prevRotation = 0;\n          prevShouldSnap = false;\n          isAnimating = false;\n        }\n        cancelAnimation?.();\n        window.clearTimeout(timeoutId);\n        batch(() => {\n          setMoved(newMoved);\n          setMovedDiff(0);\n          editorState.isMoving = false;\n          mediaState.rotation = mediaState.rotation % (Math.PI * 2)\n        });\n      }\n    });\n\n    onCleanup(() => {\n      swipeHandler.removeListeners();\n    });\n  });\n\n  let prevRotation = 0;\n  let initialScale = 0;\n\n  const onSwipe = withCurrentOwner(() => {\n    const rotationFromSwiper = rotationFromMove(moved() + movedDiff());\n    const rotationDiff = rotationFromSwiper - prevRotation;\n\n    const targetRotation = mediaState.rotation - rotationDiff;\n\n    const r = [Math.cos(rotationDiff), Math.sin(rotationDiff)];\n\n    const targetTranslation: NumberPair = [\n      mediaState.translation[0] * r[0] + mediaState.translation[1] * r[1],\n      mediaState.translation[1] * r[0] - mediaState.translation[0] * r[1]\n    ];\n\n    prevRotation = rotationFromSwiper;\n\n    if(!initialScale) return;\n    const {cropMinX, cropMaxX, cropMinY, cropMaxY, imageMinX, imageMaxX, imageMinY, imageMaxY} =\n      getConvenientPositioning({\n        scale: initialScale,\n        rotation: targetRotation,\n        translation: targetTranslation\n      });\n\n    const halfImageWidth = (imageMaxX - imageMinX) / 2,\n      halfImageHeight = (imageMaxY - imageMinY) / 2;\n    const imageCenter = [imageMinX + halfImageWidth, imageMinY + halfImageHeight];\n\n    let additionalScale = 1;\n\n    if(imageMinX > cropMinX) additionalScale = Math.max((imageCenter[0] - cropMinX) / halfImageWidth, additionalScale);\n    if(imageMaxX < cropMaxX) additionalScale = Math.max((cropMaxX - imageCenter[0]) / halfImageWidth, additionalScale);\n    if(imageMinY > cropMinY)\n      additionalScale = Math.max((imageCenter[1] - cropMinY) / halfImageHeight, additionalScale);\n    if(imageMaxY < cropMaxY)\n      additionalScale = Math.max((cropMaxY - imageCenter[1]) / halfImageHeight, additionalScale);\n\n\n    modifyMutable(mediaState, produce(s => {\n      s.rotation = targetRotation;\n      s.translation = targetTranslation;\n      if(additionalScale > 1) {\n        s.scale = initialScale * additionalScale;\n      }\n    }));\n  });\n\n  function resetWheelWithAnimation() {\n    prevRotation = 0;\n    animateValue([moved(), movedDiff()], [0, 0], 200, (values) => {\n      batch(() => {\n        setMoved(values[0]);\n        setMovedDiff(values[1]);\n      });\n    });\n  }\n\n  actions.resetRotationWheel = () => resetWheelWithAnimation();\n  onCleanup(() => {\n    actions.resetRotationWheel = () => {}\n  });\n\n  let isFirstEffect = true;\n  createEffect(\n    on(() => editorState.fixedImageRatioKey, () => {\n      if(isFirstEffect) {\n        isFirstEffect = false;\n        return;\n      }\n      resetWheelWithAnimation();\n    })\n  );\n\n  function rotateLeft() {\n    const newRotation = (Math.round((mediaState.rotation / Math.PI) * 2) * Math.PI) / 2 - Math.PI / 2;\n\n    animateToNewRotationOrRatio(newRotation);\n\n    resetWheelWithAnimation();\n  }\n\n  function flipImage() {\n    editorState.isMoving = true;\n    const isReversedRatio = Math.abs(Math.round((mediaState.rotation / Math.PI) * 2)) & 1;\n    const snapTo1 = (value: number) => value < 0 ? -1 : 1;\n    const targetFlip: NumberPair = [\n      snapTo1(mediaState.flip[0]) * (isReversedRatio ? 1 : -1),\n      snapTo1(mediaState.flip[1]) * (isReversedRatio ? -1 : 1)\n    ];\n    animateValue(mediaState.flip, targetFlip, 200, (value) => void (mediaState.flip = value), {\n      onEnd: () => void (editorState.isMoving = false)\n    });\n  }\n\n  const value = () =>\n    ((-(moved() + movedDiff()) / DEGREE_DIST_PX) * DEGREE_STEP)\n    .toFixed(1)\n    .replace(/\\.0$/, '')\n    .replace(/^-0$/, '0');\n\n  return (\n    <div class=\"media-editor__rotation-wheel\" style={{display: isCropping() ? undefined : 'none'}}>\n      <ButtonIconTsx onClick={withCurrentOwner(rotateLeft)} class=\"media-editor__rotation-wheel-button\" icon=\"rotate\" />\n      <div class=\"media-editor__rotation-wheel-swiper-wrapper\">\n        <div\n          ref={swiperEl}\n          style={{['--moved']: moved() + movedDiff() + 'px'}}\n          class=\"media-editor__rotation-wheel-swiper\"\n        >\n          <div class=\"media-editor__rotation-wheel-labels\">\n            {new Array(13).fill(null).map((_, i) => (\n              <div class=\"media-editor__rotation-wheel-label\">\n                <div class=\"media-editor__rotation-wheel-label-number\">{i * 15 - 90}</div>\n              </div>\n            ))}\n          </div>\n          <div class=\"media-editor__rotation-wheel-dots\">\n            {new Array(97).fill(null).map(() => (\n              <div class=\"media-editor__rotation-wheel-dot\" />\n            ))}\n          </div>\n        </div>\n      </div>\n      <div class=\"media-editor__rotation-wheel-value\">\n        <div class=\"media-editor__rotation-wheel-value-number\">{value()}</div>\n      </div>\n      <ArrowUp />\n      <ButtonIconTsx onClick={flipImage} class=\"media-editor__rotation-wheel-button\" icon=\"flip_image_horizontal\" />\n    </div>\n  );\n}\n\nfunction ArrowUp() {\n  return (\n    <svg\n      class=\"media-editor__rotation-wheel-arrow\"\n      width=\"6\"\n      height=\"4\"\n      viewBox=\"0 0 6 4\"\n      fill=\"none\"\n      xmlns=\"http://www.w3.org/2000/svg\"\n    >\n      <path\n        d=\"M2.29289 0.707106L0.28033 2.71967C-0.192143 3.19214 0.142482 4 0.81066 4H5.18934C5.85752 4 6.19214 3.19214 5.71967 2.71967L3.70711 0.707107C3.31658 0.316583 2.68342 0.316582 2.29289 0.707106Z\"\n        fill=\"white\"\n      />\n    </svg>\n  );\n}\n","import {batch, createEffect, createMemo, createSignal, on, onCleanup} from 'solid-js';\nimport {modifyMutable, produce} from 'solid-js/store';\nimport {animateValue} from '@helpers/animateValue';\nimport {lerp, lerpArray} from '@helpers/lerp';\nimport {useMediaEditorContext} from '@components/mediaEditor/context';\nimport {NumberPair} from '@components/mediaEditor/types';\nimport {getSnappedViewportsScale} from '@components/mediaEditor/utils';\nimport {useCropOffset} from '@components/mediaEditor/canvas/useCropOffset';\n\n\nexport type FinalTransform = {\n  flip: NumberPair;\n  translation: NumberPair;\n  rotation: number;\n  scale: number;\n};\n\nexport default function useFinalTransform() {\n  const {editorState, mediaState} = useMediaEditorContext();\n\n  const cropOffset = useCropOffset();\n\n  const isCropping = createMemo(() => editorState.currentTab === 'crop');\n\n  const [cropTabAnimationProgress, setCropTabAnimationProgress] = createSignal(0);\n\n  let isFirstEffect = true;\n  createEffect(\n    on(isCropping, () => {\n      if(isFirstEffect) {\n        isFirstEffect = false;\n        return;\n      }\n\n      editorState.isMoving = true;\n\n      const cancel = animateValue(cropTabAnimationProgress(), isCropping() ? 1 : 0, 200, setCropTabAnimationProgress, {\n        onEnd: () => editorState.isMoving = false\n      });\n\n      onCleanup(cancel);\n    })\n  );\n\n  const [prevCanvasSize, setPrevCanvasSize] = createSignal<NumberPair>();\n  const [prevCropTranslation, setPrevCropTranslation] = createSignal<NumberPair>();\n  const [prevAdditionalScale, setPrevAdditionalScale] = createSignal<number>();\n\n  const additionalImageScales = createMemo(() => {\n    const payload = editorState.renderingPayload;\n    if(!payload || !editorState.canvasSize) return;\n\n    const [w, h] = editorState.canvasSize;\n\n    const imageRatio = payload.media.width / payload.media.height;\n\n    const toCropScale = getSnappedViewportsScale(imageRatio, cropOffset().width, cropOffset().height, w, h);\n    const fromCroppedScale =\n      1 / getSnappedViewportsScale(mediaState.currentImageRatio, cropOffset().width, cropOffset().height, w, h);\n\n    const snappedImageScale = Math.min(w / payload.media.width, h / payload.media.height);\n\n    return {\n      toCropScale,\n      fromCroppedScale,\n      snappedImageScale\n    };\n  });\n\n  const cropTrnsl = createMemo(() => {\n    if(!editorState.canvasSize || !additionalImageScales()) return;\n    const {fromCroppedScale} = additionalImageScales();\n\n    return mediaState.translation.map((x) => x * fromCroppedScale - x) as NumberPair;\n  });\n\n  const cropTranslation = createMemo(() => {\n    if(!editorState.canvasSize || !additionalImageScales()) return;\n    const [, h] = editorState.canvasSize;\n    const {fromCroppedScale} = additionalImageScales();\n\n    return lerpArray(\n      mediaState.translation.map((x) => x * fromCroppedScale - x),\n      [0, cropOffset().left + cropOffset().height / 2 - h / 2],\n      cropTabAnimationProgress()\n    ) as NumberPair;\n  });\n\n  let prevScale: number;\n  let prevTranslation: NumberPair;\n\n  function updatePrevValues() {\n    if(!additionalImageScales() || !cropTrnsl()) return;\n    const {toCropScale, fromCroppedScale, snappedImageScale} = additionalImageScales();\n    prevScale = toCropScale * snappedImageScale * fromCroppedScale;\n    prevTranslation = cropTrnsl();\n  }\n\n  createEffect(\n    on(cropTabAnimationProgress, () => {\n      if([0, 1].includes(cropTabAnimationProgress())) updatePrevValues();\n    })\n  );\n  createEffect(\n    on(() => mediaState.currentImageRatio, () => {\n      updatePrevValues();\n    })\n  );\n\n  createEffect(\n    on(() => editorState.canvasSize, () => {\n      if(!editorState.canvasSize || !additionalImageScales()) return;\n      const prevSize = editorState.canvasSize;\n      const {toCropScale, fromCroppedScale, snappedImageScale} = additionalImageScales();\n      prevScale = toCropScale * snappedImageScale * fromCroppedScale;\n      prevTranslation = cropTrnsl();\n\n      onCleanup(() => {\n        batch(() => {\n          setPrevCanvasSize(prevSize);\n          setPrevAdditionalScale(prevScale);\n          setPrevCropTranslation(prevTranslation);\n        });\n      });\n    })\n  );\n\n  createEffect(\n    on(prevCanvasSize, () => {\n      if(!prevCanvasSize || !prevAdditionalScale()) return;\n      const currentSize = editorState.canvasSize;\n      const {toCropScale, fromCroppedScale, snappedImageScale} = additionalImageScales();\n      const currentAdditionalScale = toCropScale * snappedImageScale * fromCroppedScale;\n\n      const scaleToChange = getSnappedViewportsScale(\n        mediaState.currentImageRatio,\n        currentSize[0],\n        currentSize[1],\n        prevCanvasSize()[0],\n        prevCanvasSize()[1]\n      );\n      const counterScale = prevAdditionalScale() / currentAdditionalScale;\n\n      const totalScale = scaleToChange * counterScale;\n\n      // const translationDiff = [\n      //   prevCropTranslation()[0] - cropTrnsl()[0],\n      //   prevCropTranslation()[1] - cropTrnsl()[1]\n      // ];\n      // console.log('translationDiff', translationDiff)\n\n      modifyMutable(mediaState, produce((state) => {\n        state.scale = state.scale * totalScale,\n        state.translation = state.translation.map((v) => v * totalScale) as NumberPair\n      }));\n    })\n  );\n\n  createEffect(() => {\n    const payload = editorState.renderingPayload;\n    if(!payload) return;\n\n    let {fromCroppedScale, toCropScale, snappedImageScale} = additionalImageScales();\n\n    toCropScale *= lerp(fromCroppedScale, 1, cropTabAnimationProgress());\n\n    // const cropTranslation = lerpArray(\n    //   translation().map((x) => x * fromCroppedScale - x),\n    //   [0, cropOffset().left + cropOffset().height / 2 - h / 2],\n    //   cropTabAnimationProgress()\n    // );\n    // console.log('cropTranslation', cropTranslation)\n\n    modifyMutable(editorState.finalTransform, produce(t => {\n      t.flip = mediaState.flip,\n      t.rotation = mediaState.rotation,\n      t.scale = mediaState.scale * editorState.pixelRatio * snappedImageScale * toCropScale;\n      t.translation = [cropTranslation()[0] + mediaState.translation[0], cropTranslation()[1] + mediaState.translation[1]].map(\n        (v) => v * editorState.pixelRatio\n      ) as NumberPair\n    }));\n  });\n}\n","import {createEffect, onCleanup} from 'solid-js';\nimport deferredPromise from '@helpers/cancellablePromise';\nimport createMiddleware from '@helpers/solid/createMiddleware';\nimport {useMediaEditorContext} from '@components/mediaEditor/context';\nimport {snapToViewport} from '@components/mediaEditor/utils';\nimport createVideoForDrawing from '@components/mediaEditor/canvas/createVideoForDrawing';\nimport styles from '@components/mediaEditor/canvas/videoControls.module.scss';\n\ntype Args = {\n  getCanvas: () => HTMLCanvasElement;\n  size: {\n    width: number;\n    height: number;\n  };\n};\n\nexport default function useVideoControlsCanvas({getCanvas, size}: Args) {\n  const {editorState, mediaSrc} = useMediaEditorContext();\n\n  createEffect(() => {\n    const media = editorState.renderingPayload?.media;\n    const canvas = getCanvas();\n    if(!media || !canvas || !size.width || !size.height) return;\n\n    const ratio = media.width / media.height;\n\n    const ctx = canvas.getContext('2d');\n\n    let\n      deferred = deferredPromise<void>(),\n      cleaned = false\n    ;\n\n    onCleanup(() => {\n      cleaned = true;\n      deferred?.resolve();\n      ctx.clearRect(0, 0, canvas.width, canvas.height);\n    });\n\n    const middleware = createMiddleware().get();\n\n    (async() => {\n      const video = await createVideoForDrawing(mediaSrc, {currentTime: 0, middleware});\n      // (window as any).myWeakRef = new WeakRef(video); // works\n\n      if(cleaned) return;\n\n      video.addEventListener('seeked', () => {\n        deferred?.resolve();\n      });\n\n      const [chunkWidth, chunkHeight] = snapToViewport(ratio, size.width, size.height);\n\n      for(let x = 0; x < size.width; x += chunkWidth) {\n        deferred = deferredPromise();\n        video.currentTime = x / size.width * video.duration;\n\n        await deferred;\n        if(cleaned) return;\n\n        ctx.drawImage(video, x, 0, chunkWidth, chunkHeight);\n\n        const fade = document.createElement('div');\n\n        fade.classList.add(styles.FrameFade);\n        fade.style.top = '0px';\n        fade.style.left = x + 'px';\n        fade.style.width = chunkWidth + 0.5 + 'px'; // add a few px to prevent unexpected borders\n        fade.style.height = chunkHeight + 'px';\n\n        canvas.after(fade);\n\n        fade.animate({opacity: [1, 0]}, {duration: 500, easing: 'ease-in-out'}).finished\n        .then(() => fade.remove());\n      }\n    })();\n  });\n}\n","import {batch, Component, createMemo, createSignal} from 'solid-js';\n\nimport clamp from '@helpers/number/clamp';\nimport swipe, {SwipeDirectiveArgs} from '@helpers/useSwipe'; swipe; // keep\nimport useElementSize from '@hooks/useElementSize';\nimport {i18n} from '@lib/langPack';\n\nimport {IconTsx} from '@components/iconTsx';\nimport ripple from '@components/ripple'; ripple; // keep\nimport showTooltip from '@components/tooltip';\n\nimport {SetVideoTimeFlags, useMediaEditorContext} from '@components/mediaEditor/context';\n\nimport useVideoControlsCanvas from '@components/mediaEditor/canvas/useVideoControlsCanvas';\n\nimport styles from '@components/mediaEditor/canvas/videoControls.module.scss';\n\n\nconst HANDLE_WIDTH_PX = 9;\nconst MOVE_ACTIVATION_THRESHOLD_PX = 2;\n\nconst VideoControls: Component<{}> = () => {\n  const {editorState, mediaState, actions} = useMediaEditorContext();\n\n  const [cropper, setCropper] = createSignal<HTMLDivElement>();\n  const [isDraggingSomething, setIsDraggingSomething] = createSignal(false);\n\n  const cropperSize = useElementSize(cropper);\n  const strippedWidth = () => cropperSize.width - 2 * HANDLE_WIDTH_PX;\n\n  const shouldShowTime = () => isDraggingSomething() && (swiping === 'left' || swiping === 'right');\n\n  const formattedResultingTime = createMemo(() => {\n    if(!shouldShowTime()) return '';\n    const video = editorState.renderingPayload?.media?.video;\n    if(!video) return '';\n\n    const totalSeconds = mediaState.videoCropLength * video.duration;\n    let ts = totalSeconds;\n\n    const hh = (Math.floor(ts / 3600) + '').padStart(2, '0');\n    ts -= +hh * 3600;\n    const mm = (Math.floor(ts / 60) + '').padStart(2, '0');\n    ts -= +mm * 60;\n    const ss = (Math.floor(ts) + '').padStart(2, '0');\n    ts -= +ss;\n    const decimal = (Math.floor(ts * 4) * 25 + '').replace(/0$/, '');\n\n    return (+hh ? `${hh}:` : '') + `${mm}:${ss}` + (decimal && totalSeconds < 10 ? `.${decimal}` : '');\n  });\n\n  const minLength = createMemo(() => {\n    const duration = editorState.renderingPayload?.media?.video?.duration;\n    if(!duration) return 0;\n    return Math.min(1, 0.5 / duration);\n  });\n\n  let\n    canvas: HTMLCanvasElement,\n    initialStart: number,\n    initialLength: number,\n    swiping: 'left' | 'middle' | 'right' | 'cursor';\n  ;\n\n  useVideoControlsCanvas({\n    getCanvas: () => canvas,\n    size: cropperSize\n  });\n\n  const leftHandleSwipeArgs: SwipeDirectiveArgs = {\n    globalCursor: () => 'ew-resize',\n    onStart: () => {\n      swiping = 'left';\n      initialStart = mediaState.videoCropStart;\n      initialLength = mediaState.videoCropLength;\n\n      batch(() => {\n        setIsDraggingSomething(true);\n        editorState.isPlaying = false;\n      });\n    },\n    onMove: (xDiff) => void batch(() => {\n      if(swiping !== 'left') return;\n      const diff = clamp(initialStart + xDiff / strippedWidth(), 0, Math.max(0, initialStart + initialLength - minLength())) - initialStart;\n      batch(() => {\n        mediaState.videoCropStart = (initialStart + diff);\n        mediaState.videoCropLength = (initialLength - diff);\n        actions.setVideoTime(mediaState.videoCropStart);\n      });\n    }),\n    onEnd: () => void setIsDraggingSomething(false)\n  };\n\n  const rightHandleSwipeArgs: SwipeDirectiveArgs = {\n    globalCursor: () => 'ew-resize',\n    onStart: () => {\n      swiping = 'right';\n      initialLength = mediaState.videoCropLength;\n\n      batch(() => {\n        setIsDraggingSomething(true);\n        editorState.isPlaying = false;\n      });\n    },\n    onMove: (xDiff) => void batch(() => {\n      if(swiping !== 'right') return;\n      const maxLength = 1 - mediaState.videoCropStart;\n      mediaState.videoCropLength = (clamp(initialLength + xDiff / strippedWidth(), Math.min(minLength(), maxLength), maxLength));\n      actions.setVideoTime(mediaState.videoCropStart + mediaState.videoCropLength);\n    }),\n    onEnd: () => void setIsDraggingSomething(false)\n  };\n\n  let canMove = false;\n\n  const middleSwipeArgs: SwipeDirectiveArgs = {\n    globalCursor: () => initialLength === 1 ? 'col-resize' : 'grabbing',\n    onStart: (e) => {\n      swiping = 'middle';\n      initialStart = mediaState.videoCropStart;\n      initialLength = mediaState.videoCropLength;\n      canMove = false;\n\n      if(initialLength === 1) {\n        setIsDraggingSomething(true);\n        canMove = true;\n        handleCursorMove(e);\n      }\n    },\n    onMove: (xDiff, _, e) => void batch((): void => {\n      if(swiping !== 'middle') return;\n      if(initialLength === 1) return void handleCursorMove(e);\n\n      if(Math.abs(xDiff) > MOVE_ACTIVATION_THRESHOLD_PX) canMove = true;\n      if(!canMove) return;\n\n      const startDiff = clamp(initialStart + xDiff / strippedWidth(), 0, Math.max(0, 1 - Math.max(initialLength, minLength()))) - initialStart;\n      batch(() => {\n        setIsDraggingSomething(true);\n        editorState.isPlaying = false;\n\n        mediaState.videoCropStart = initialStart + startDiff;\n        // mediaState.videoCropLength = clamp(initialLength - startDiff + xDiff / strippedWidth(), Math.min(1, minLength()), 1 - mediaState.videoCropStart);\n\n        actions.setVideoTime(mediaState.videoCropStart);\n      });\n    }),\n    onEnd: () => {\n      self.setTimeout(() => {\n        setIsDraggingSomething(false);\n      }, 0); // prevent trigger click after finishing dragging\n    }\n  };\n\n  const cursorSwipeArgs: SwipeDirectiveArgs = {\n    globalCursor: () => 'col-resize',\n    onStart: () => {\n      swiping = 'cursor';\n      setIsDraggingSomething(true);\n    },\n    onMove: (xDiff, __, e) => {\n      if(swiping !== 'cursor') return;\n      // if(Math.abs(xDiff) > MOVE_ACTIVATION_THRESHOLD_PX)\n      editorState.isPlaying = false;\n      handleCursorMove(e);\n    },\n    onEnd: () => void setIsDraggingSomething(false)\n  };\n\n  const handleCursorMove = (e: PointerEvent | TouchEvent) => {\n    editorState.isPlaying = false;\n    actions.setVideoTime(clamp(getPositionInCropper(e, cropper()), mediaState.videoCropStart, mediaState.videoCropStart + mediaState.videoCropLength));\n  };\n\n  const onMiddlePartClick = (e: MouseEvent) => {\n    if(!cropper() || isDraggingSomething()) return;\n\n    actions.setVideoTime(clamp(getPositionInCropper(e, cropper()), mediaState.videoCropStart, mediaState.videoCropStart + mediaState.videoCropLength));\n  };\n\n  const showMutedTooltip = (el: HTMLElement) => showTooltip({\n    element: el,\n    mountOn: el.parentElement.parentElement.parentElement,\n    vertical: 'top',\n    textElement: i18n('MediaEditor.VideoMutedTooltip'),\n    lighter: true,\n    auto: true\n  });\n\n  let closeTooltip: () => void;\n\n  return (\n    <div\n      class={styles.Container}\n      classList={{\n        [styles.hidden]: editorState.currentTab !== 'adjustments',\n        [styles.changed]: mediaState.videoCropLength !== 1\n      }}\n      style={{\n        '--start': mediaState.videoCropStart,\n        '--length': mediaState.videoCropLength,\n        '--current-time': mediaState.currentVideoTime\n      }}\n    >\n      <div class={styles.InnerContainer}>\n        <button\n          use:ripple\n          class={`btn-icon ${styles.IconButton} ${styles.MuteButton}`}\n          classList={{\n            [styles.muted]: mediaState.videoMuted\n          }}\n          onClick={(e) => {\n            mediaState.videoMuted = !mediaState.videoMuted;\n            closeTooltip?.();\n            if(mediaState.videoMuted) closeTooltip = showMutedTooltip(e.currentTarget).close;\n          }}\n          tabIndex={-1}\n        >\n          <IconTsx icon={mediaState.videoMuted ? 'volume_off' : 'volume_up'} />\n        </button>\n\n        <div class={styles.Frames}>\n          <div ref={setCropper} class={styles.Cropper}>\n            <canvas ref={canvas} class={styles.Images} width={cropperSize.width} height={cropperSize.height} />\n\n            <div class={`${styles.CropperBg} ${styles.CropperBgLeft}`} />\n            <div class={`${styles.CropperBg} ${styles.CropperBgRight}`} />\n\n            <div\n              class={styles.CropperHorizontalBorder}\n              classList={{\n                [styles.dragging]: isDraggingSomething()\n              }}\n              use:swipe={middleSwipeArgs}\n              onClick={onMiddlePartClick}\n            />\n\n            <div class={`${styles.CropperHandle} ${styles.CropperHandleLeft}`} use:swipe={leftHandleSwipeArgs} />\n            <div class={`${styles.CropperHandle} ${styles.CropperHandleRight}`} use:swipe={rightHandleSwipeArgs} />\n          </div>\n\n          <TimeStick swipe={cursorSwipeArgs} />\n          <ThumbnailTrack\n            cropper={cropper()}\n            isDraggingSomething={isDraggingSomething()}\n            hidden={shouldShowTime()}\n          />\n          <div class={styles.CroppedTime} classList={{[styles.visible]: shouldShowTime()}}>\n            {formattedResultingTime()}\n          </div>\n\n        </div>\n\n        <button\n          use:ripple\n          class={`btn-icon ${styles.IconButton} ${styles.PlayButton}`}\n          onClick={() => {\n            editorState.isPlaying = !editorState.isPlaying;\n          }}\n          tabIndex={-1}\n        >\n          <span class={styles.PlayButtonInner}> {/* <span> prevents duplicating the svg on hot reload */}\n            <PausePlay paused={!editorState.isPlaying} />\n          </span>\n        </button>\n      </div>\n    </div>\n  );\n};\n\nconst ThumbnailTrack: Component<{\n  cropper: HTMLDivElement;\n  isDraggingSomething: boolean;\n  hidden: boolean;\n}> = (props) => {\n  const {actions, editorState, mediaState} = useMediaEditorContext();\n\n  const [ghostThumbnailPosition, setGhostThumbnailPosition] = createSignal<number>();\n\n  const [isDragging, setIsDragging] = createSignal(false);\n\n  const isGhostThumbnailVisible = createMemo(() => !props.isDraggingSomething && !isDragging() && !isNaN(ghostThumbnailPosition()));\n\n  const onClick = (e: MouseEvent) => {\n    if(!props.cropper) return;\n\n    mediaState.videoThumbnailPosition = getPositionInCropper(e, props.cropper);\n  };\n\n  let canPreviewFrame = false, previewFrameTimeout: number;\n\n  const onPointerMove = (e: PointerEvent | TouchEvent) => {\n    if(!props.cropper || editorState.isPlaying || props.isDraggingSomething) return;\n\n    if(!previewFrameTimeout) previewFrameTimeout = self.setTimeout(() => {\n      canPreviewFrame = true;\n    }, 200);\n\n    const position = getPositionInCropper(e, props.cropper);\n\n    setGhostThumbnailPosition(position);\n\n    if(canPreviewFrame) actions.setVideoTime(position, SetVideoTimeFlags.UpdateVideo | SetVideoTimeFlags.Redraw);\n  };\n\n  const onPointerOut = () => {\n    if(canPreviewFrame) actions.setVideoTime(mediaState.currentVideoTime, SetVideoTimeFlags.UpdateVideo | SetVideoTimeFlags.Redraw);\n\n    setGhostThumbnailPosition();\n    canPreviewFrame = false;\n    self.clearTimeout(previewFrameTimeout);\n    previewFrameTimeout = undefined;\n  };\n\n  const swipeArgs: SwipeDirectiveArgs = {\n    globalCursor: () => 'grabbing',\n    onStart: (e) => {\n      void setIsDragging(true);\n      if(!props.cropper) return;\n      mediaState.videoThumbnailPosition = getPositionInCropper(e, props.cropper);\n    },\n    onMove: (_, __, e) => {\n      if(!props.cropper) return;\n      mediaState.videoThumbnailPosition = getPositionInCropper(e, props.cropper);\n    },\n    onEnd: () => void setIsDragging(false)\n  };\n\n  return (\n    <>\n      <ThumbnailMark position={mediaState.videoThumbnailPosition} visible={!props.hidden} withTransition />\n      <ThumbnailMark position={ghostThumbnailPosition() || 0} ghost visible={!props.hidden && isGhostThumbnailVisible()} />\n\n      <div\n        class={styles.ThumbnailTrack}\n        classList={{\n          [styles.disabled]: props.isDraggingSomething\n        }}\n        use:swipe={swipeArgs}\n        onPointerMove={onPointerMove}\n        onTouchMove={onPointerMove}\n        onPointerOut={onPointerOut}\n        onTouchEnd={onPointerOut}\n        onClick={onClick}\n      />\n    </>\n  )\n};\n\nconst ThumbnailMark: Component<{\n  position: number;\n  visible: boolean;\n  ghost?: boolean;\n  withTransition?: boolean;\n}> = (props) => {\n  return (\n    <svg\n      class={styles.ThumbnailMark}\n      classList={{\n        [styles.ghost]: props.ghost,\n        [styles.visible]: props.visible,\n        [styles.withTransition]: props.withTransition\n      }}\n      style={{\n        '--position': props.position\n      }}\n      width=\"20\"\n      height=\"25\"\n      viewBox=\"0 0 20 25\"\n      fill=\"none\"\n      xmlns=\"http://www.w3.org/2000/svg\"\n    >\n      <path d=\"M0 10V10.9952C0 14.8798 2.58024 18.2044 5.87746 20.2583C7.46104 21.2448 8.92659 22.4551 9.61717 23.8212C9.70992 24.0047 10.2901 24.0047 10.3828 23.8212C11.0734 22.4551 12.539 21.2448 14.1225 20.2583C17.4198 18.2044 20 14.8798 20 10.9952V10C20 4.47715 15.5228 0 10 0C4.47715 0 0 4.47715 0 10Z\" fill=\"white\"/>\n      <path fill-rule=\"evenodd\" clip-rule=\"evenodd\" d=\"M8.45844 4.4165H8.48341H11.5167H11.5417C12.1739 4.4165 12.6838 4.41649 13.0968 4.45023C13.522 4.48497 13.8954 4.55836 14.2409 4.7344C14.7897 5.01403 15.2359 5.46023 15.5155 6.00903C15.6915 6.35454 15.7649 6.72798 15.7997 7.15314C15.8334 7.56605 15.8334 8.07595 15.8334 8.70813V8.73317V11.7665V11.7915C15.8334 12.4237 15.8334 12.9336 15.7997 13.3465C15.7649 13.7717 15.6915 14.1452 15.5155 14.4907C15.2359 15.0395 14.7897 15.4857 14.2409 15.7653C13.8954 15.9413 13.522 16.0147 13.0968 16.0495C12.6839 16.0832 12.174 16.0832 11.5418 16.0832H11.5167H8.48341H8.45843C7.82626 16.0832 7.3163 16.0832 6.90339 16.0495C6.47822 16.0147 6.10478 15.9413 5.75928 15.7653C5.21047 15.4857 4.76427 15.0395 4.48465 14.4907C4.3086 14.1452 4.23521 13.7717 4.20048 13.3465C4.16674 12.9336 4.16674 12.4237 4.16675 11.7915V11.7665V8.73317V8.7082C4.16674 8.07599 4.16674 7.56607 4.20048 7.15314C4.23521 6.72798 4.3086 6.35454 4.48465 6.00903C4.76427 5.46023 5.21047 5.01403 5.75928 4.7344C6.10478 4.55836 6.47822 4.48497 6.90339 4.45023C7.31631 4.41649 7.82624 4.4165 8.45844 4.4165ZM6.99839 5.61303C6.64537 5.64187 6.44255 5.69563 6.28893 5.77391C5.95965 5.94169 5.69193 6.2094 5.52415 6.53869C5.44588 6.69231 5.39211 6.89513 5.36327 7.24814C5.33387 7.60797 5.33341 8.07015 5.33341 8.73317V11.7665C5.33341 12.4295 5.33387 12.8917 5.36327 13.2516C5.36613 13.2866 5.36925 13.3203 5.37261 13.3525L6.26742 11.8925L6.28131 11.8699C6.46683 11.5672 6.62664 11.3064 6.77319 11.11C6.92275 10.9096 7.11058 10.7022 7.37928 10.5859C7.74882 10.4259 8.16801 10.4259 8.53755 10.5859C8.80625 10.7022 8.99406 10.9096 9.14363 11.11C9.26806 11.2767 9.40199 11.4898 9.55313 11.7356L10.3508 10.4342L10.3647 10.4115C10.5502 10.1088 10.7099 9.84804 10.8565 9.65169C11.0061 9.45131 11.1939 9.24382 11.4626 9.12756C11.8322 8.96764 12.2513 8.96764 12.6209 9.12756C12.8896 9.24382 13.0774 9.45131 13.227 9.65169C13.3736 9.84804 13.5333 10.1088 13.7188 10.4115L13.7327 10.4342L14.6667 11.958L14.6667 11.7665V8.73317C14.6667 8.07015 14.6663 7.60797 14.6369 7.24814C14.6081 6.89513 14.5543 6.69231 14.476 6.53869C14.3082 6.2094 14.0405 5.94169 13.7112 5.77391C13.5576 5.69563 13.3548 5.64187 13.0018 5.61303C12.6419 5.58363 12.1798 5.58317 11.5167 5.58317H8.48341C7.82039 5.58317 7.35821 5.58363 6.99839 5.61303ZM10.2374 12.8518L11.5028 14.9165H11.5167C12.1798 14.9165 12.6419 14.916 13.0018 14.8866C13.3548 14.8578 13.5576 14.804 13.7112 14.7258C14.0405 14.558 14.3082 14.2903 14.476 13.961C14.4835 13.9462 14.4908 13.931 14.4979 13.9152L12.738 11.0439C12.5347 10.7121 12.4027 10.4978 12.292 10.3495C12.2036 10.231 12.1614 10.2013 12.1553 10.1973C12.0827 10.1666 12.0008 10.1666 11.9282 10.1973C11.922 10.2013 11.8799 10.231 11.7915 10.3495C11.6808 10.4978 11.5488 10.7121 11.3455 11.0439L10.2374 12.8518ZM10.1344 14.9165L8.6547 12.5022C8.45134 12.1704 8.31936 11.9561 8.20867 11.8079C8.12021 11.6893 8.07814 11.6596 8.07199 11.6556C7.99939 11.6249 7.91744 11.6249 7.84484 11.6556C7.83869 11.6596 7.79662 11.6893 7.70816 11.8079C7.59747 11.9561 7.46548 12.1704 7.26212 12.5022L6.00854 14.5475C6.09569 14.6153 6.1895 14.6751 6.28893 14.7258C6.44255 14.804 6.64537 14.8578 6.99839 14.8866C7.35821 14.916 7.82039 14.9165 8.48341 14.9165H10.1344Z\" fill=\"#212121\"/>\n    </svg>\n  );\n}\n\nconst TimeStick = (props: {swipe: SwipeDirectiveArgs}) => {\n  return (\n    <svg class={styles.TimeStick} use:swipe={props.swipe} width=\"6\" height=\"60\" viewBox=\"0 0 6 60\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n      <path d=\"M4 0.75C4.69036 0.75 5.25 1.30964 5.25 2V3.29297C5.24998 3.812 5.04377 4.30975 4.67676 4.67676C4.40352 4.95 4.25002 5.32061 4.25 5.70703V54.293C4.25002 54.6794 4.40352 55.05 4.67676 55.3232C5.04377 55.6903 5.24998 56.188 5.25 56.707V58C5.25 58.6904 4.69036 59.25 4 59.25H2C1.30964 59.25 0.75 58.6904 0.75 58V56.707C0.75002 56.188 0.956231 55.6903 1.32324 55.3232C1.59648 55.05 1.74998 54.6794 1.75 54.293V5.70703C1.74998 5.32061 1.59648 4.95 1.32324 4.67676C0.956231 4.30975 0.75002 3.812 0.75 3.29297V2C0.75 1.30964 1.30964 0.75 2 0.75H4Z\" fill=\"white\" stroke=\"#212121\" stroke-width=\"0.5\"/>\n    </svg>\n  )\n};\n\nexport const PausePlay: Component<{\n  paused: boolean;\n}> = (props) => {\n  return (\n    <svg\n      class={styles.PausePlaySvg}\n      classList={{\n        [styles.paused]: props.paused\n      }}\n      width=\"24\"\n      height=\"24\"\n      viewBox=\"0 0 24 24\"\n      fill=\"none\"\n      xmlns=\"http://www.w3.org/2000/svg\"\n    >\n      <clipPath id=\"playSymbolClipPath\">\n        <path class={styles.PausePlaySvgPlay} d=\"M5 19.9138V4.0862C5 2.83455 6.44254 2.13342 7.42673 2.90672L17.4988 10.8205C18.2632 11.4211 18.2632 12.5789 17.4988 13.1795L7.42673 21.0933C6.44254 21.8666 5 21.1655 5 19.9138Z\" fill=\"black\" /* transform=\"translate(8, 12) scale(1.4) translate(-8, -12)\" */ />\n      </clipPath>\n\n      <g class={styles.PausePlaySvgPause} id=\"pauseSymbol\" clip-path='url(#playSymbolClipPath)'>\n        <path class={styles.PausePlaySvgPauseLeft} d=\"M8.5 3H5C4.44772 3 4 3.44772 4 4V20C4 20.5523 4.44772 21 5 21H8.5C9.05228 21 9.5 20.5523 9.5 20V4C9.5 3.44772 9.05228 3 8.5 3Z\" fill=\"white\" />\n        <path class={styles.PausePlaySvgPauseRight} d=\"M19 3H15.5C14.9477 3 14.5 3.44772 14.5 4V20C14.5 20.5523 14.9477 21 15.5 21H19C19.5523 21 20 20.5523 20 20V4C20 3.44772 19.5523 3 19 3Z\" fill=\"white\" />\n      </g>\n    </svg>\n  );\n};\n\nfunction getPositionInCropper(e: PointerEvent | MouseEvent | TouchEvent, cropper: HTMLDivElement) {\n  const clientX = e instanceof TouchEvent ? e.changedTouches[0].clientX : e.clientX;\n\n  const bcr = cropper.getBoundingClientRect();\n  const x = clientX - bcr.left - HANDLE_WIDTH_PX;\n  const pos = x / (bcr.width - 2 * HANDLE_WIDTH_PX);\n\n  return clamp(pos, 0, 1);\n}\n\nexport default VideoControls;\n","import {onCleanup, onMount, Show, JSX} from 'solid-js';\nimport {Transition} from 'solid-transition-group';\n\nimport {useMediaEditorContext} from '@components/mediaEditor/context';\n\nimport BrushCanvas from '@components/mediaEditor/canvas/brushCanvas';\nimport CropHandles from '@components/mediaEditor/canvas/cropHandles';\nimport ImageCanvas from '@components/mediaEditor/canvas/imageCanvas';\nimport PreviewBrushSize from '@components/mediaEditor/canvas/previewBrushSize';\nimport ResizableLayers from '@components/mediaEditor/canvas/resizableLayers';\nimport RotationWheel from '@components/mediaEditor/canvas/rotationWheel';\nimport useFinalTransform from '@components/mediaEditor/canvas/useFinalTransform';\nimport VideoControls from '@components/mediaEditor/canvas/videoControls';\n\n\nexport default function MainCanvas() {\n  let container: HTMLDivElement;\n  const {editorState, mediaType} = useMediaEditorContext();\n\n  useFinalTransform();\n\n  onMount(() => {\n    const listener = () => {\n      const bcr = container.getBoundingClientRect();\n      editorState.canvasSize = [bcr.width, bcr.height];\n    };\n    listener();\n    window.addEventListener('resize', listener);\n    onCleanup(() => {\n      window.removeEventListener('resize', listener);\n    });\n  });\n\n  return (\n    <div ref={container} class=\"media-editor__main-canvas\">\n      <Show when={editorState.canvasSize}>\n        <ImageCanvas />\n        <Show when={editorState.isReady}>\n          <BrushCanvas />\n          <ResizableLayers />\n          <PreviewBrushSize />\n          {/* WTF ref causes infinite loop when passed without callback */}\n          <div ref={(el) => void (editorState.resizeHandlesContainer = el)} class=\"media-editor__resize-handles-overlay\" />\n          <CropHandles />\n          <RotationWheel />\n          <Show when={mediaType === 'video' && !!editorState.renderingPayload}>\n            <VideoControls />\n          </Show>\n        </Show>\n      </Show>\n    </div>\n  );\n}\n","import {snapToViewport} from '@components/mediaEditor/utils';\nimport {defaultCodec, highResCodec} from '@components/mediaEditor/finalRender/calcCodecAndBitrate';\n\nconst SIDE_MAX = 2560;\nconst SIDE_MIN = 240;\n\n\ntype Args = {\n  videoType: 'video' | 'gif';\n  imageWidth: number;\n  imageRatio: number;\n  cropOffset: { width: number; height: number; };\n  newRatio: number;\n  scale: number;\n  quality?: number;\n};\n\nexport default function getResultSize({imageWidth, cropOffset, imageRatio, newRatio, scale, videoType, quality}: Args) {\n  const [w] = snapToViewport(imageRatio, cropOffset.width, cropOffset.height);\n  const [cw] = snapToViewport(newRatio, cropOffset.width, cropOffset.height);\n\n  let scaledWidth = cw / (w * scale) * imageWidth,\n    scaledHeight = scaledWidth / newRatio;\n\n  const willResultInVideo = !!videoType;\n\n  if(Math.max(scaledWidth, scaledHeight) < SIDE_MIN) {\n    [scaledWidth, scaledHeight] = snapToViewport(newRatio, SIDE_MIN, SIDE_MIN);\n  }\n  if(videoType === 'gif' && (scaledWidth > defaultCodec.width || scaledHeight > defaultCodec.height)) {\n    [scaledWidth, scaledHeight] = snapToViewport(newRatio, defaultCodec.width, defaultCodec.height);\n  }\n  if(videoType === 'video' && (scaledWidth > highResCodec.width || scaledHeight > highResCodec.height)) {\n    [scaledWidth, scaledHeight] = snapToViewport(newRatio, highResCodec.width, highResCodec.height);\n  }\n  if(!willResultInVideo && Math.max(scaledWidth, scaledHeight) > SIDE_MAX) {\n    [scaledWidth, scaledHeight] = snapToViewport(newRatio, SIDE_MAX, SIDE_MAX);\n  }\n\n  if(quality) {\n    scaledHeight = quality;\n    scaledWidth = quality * newRatio;\n  }\n\n  scaledWidth = Math.floor(scaledWidth);\n  scaledHeight = Math.floor(scaledHeight);\n  scaledWidth = scaledWidth % 2 == 0 ? scaledWidth : scaledWidth - 1;\n  scaledHeight = scaledHeight % 2 == 0 ? scaledHeight : scaledHeight - 1;\n\n  return [scaledWidth, scaledHeight];\n}\n","import {FinalTransform} from '@components/mediaEditor/canvas/useFinalTransform';\nimport {useCropOffset} from '@components/mediaEditor/canvas/useCropOffset';\nimport {MediaEditorContextValue} from '@components/mediaEditor/context';\nimport {getSnappedViewportsScale} from '@components/mediaEditor/utils';\n\nexport type GetResultTransformArgs = {\n  context: MediaEditorContextValue;\n  scaledWidth: number;\n  scaledHeight: number;\n  imageWidth: number;\n  imageHeight: number;\n  cropOffset: ReturnType<typeof useCropOffset>;\n};\n\nexport default function getResultTransform({\n  context,\n  scaledWidth,\n  scaledHeight,\n  imageWidth,\n  imageHeight,\n  cropOffset\n}: GetResultTransformArgs): FinalTransform {\n  const {\n    editorState: {canvasSize},\n    mediaState: {scale, translation, rotation, flip, currentImageRatio}\n  } = context;\n\n  const initialCanvasWidth = canvasSize[0];\n  const initialCanvasHeight = canvasSize[1];\n\n  const imageRatio = imageWidth / imageHeight;\n\n  const canvasRatio = initialCanvasWidth / initialCanvasHeight;\n  let snappedCanvasWidth = scaledWidth,\n    snappedCanvasHeight = scaledHeight;\n  if(scaledWidth / canvasRatio < scaledHeight) snappedCanvasWidth = scaledHeight * canvasRatio;\n  else snappedCanvasHeight = scaledWidth / canvasRatio;\n\n  let toCropScale = getSnappedViewportsScale(\n    imageRatio,\n    cropOffset().width,\n    cropOffset().height,\n    snappedCanvasWidth,\n    snappedCanvasHeight\n  );\n  const fromCroppedScale =\n    1 /\n    getSnappedViewportsScale(\n      currentImageRatio,\n      cropOffset().width,\n      cropOffset().height,\n      snappedCanvasWidth,\n      snappedCanvasHeight\n    );\n\n  toCropScale *= fromCroppedScale;\n\n  const snappedImageScale = Math.min(snappedCanvasWidth / imageWidth, snappedCanvasHeight / imageHeight);\n\n  const cropTranslation = translation.map((x) => x * fromCroppedScale - x);\n\n  return {\n    flip: flip,\n    rotation: rotation,\n    scale: scale * snappedImageScale * toCropScale,\n    translation: [cropTranslation[0] + translation[0], cropTranslation[1] + translation[1]]\n  };\n}\n","import {unwrap} from 'solid-js/store';\n\nimport {FinalTransform} from '@components/mediaEditor/canvas/useFinalTransform';\nimport {MediaEditorContextValue} from '@components/mediaEditor/context';\nimport {NumberPair} from '@components/mediaEditor/types';\n\nexport type ScaledLayersAndLines = ReturnType<typeof getScaledLayersAndLines>;\n\nexport default function getScaledLayersAndLines(\n  context: MediaEditorContextValue,\n  finalTransform: FinalTransform,\n  width: number,\n  height: number\n) {\n  const {mediaState: {resizableLayers, brushDrawnLines}, editorState: {pixelRatio}} = context;\n\n  function processPoint(point: NumberPair) {\n    const r = [Math.sin(-finalTransform.rotation), Math.cos(-finalTransform.rotation)];\n    point = [point[0] * r[1] + point[1] * r[0], point[1] * r[1] - point[0] * r[0]];\n    point = [\n      point[0] * finalTransform.scale + width / 2 + finalTransform.translation[0],\n      point[1] * finalTransform.scale + height / 2 + finalTransform.translation[1]\n    ];\n    return point;\n  }\n\n  const scaledLines = brushDrawnLines.map(({size, points, ...line}) => ({\n    ...line,\n    size: size * finalTransform.scale,\n    points: points.map(processPoint)\n  }));\n  const scaledLayers = resizableLayers.map((layerStore) => {\n    const layer = {...unwrap(layerStore)};\n\n    layer.position = processPoint(layer.position);\n    layer.rotation += finalTransform.rotation;\n    layer.scale *= finalTransform.scale;\n\n    if(layer.textInfo) {\n      layer.textInfo = {...layer.textInfo};\n      layer.textInfo.size *= layer.scale * pixelRatio;\n    }\n    return layer;\n  });\n\n  return {scaledLines, scaledLayers};\n}\n","export const FRAMES_PER_SECOND = 60;\nexport const STICKER_SIZE = 200;\n","import {MediaEditorContextValue} from '@components/mediaEditor/context';\nimport {snapToViewport} from '@components/mediaEditor/utils';\nimport {ResizableLayer} from '@components/mediaEditor/types';\n\nimport {STICKER_SIZE} from '@components/mediaEditor/finalRender/constants';\n\nexport default function drawStickerLayer(\n  context: MediaEditorContextValue,\n  ctx: CanvasRenderingContext2D,\n  layer: ResizableLayer,\n  source: CanvasImageSource,\n  ratio: number,\n  densityAware = true\n) {\n  const {editorState: {stickersLayersInfo, pixelRatio}} = context;\n\n  const {container} = stickersLayersInfo[layer.id];\n  const stickerChild = container?.lastElementChild;\n  if(!stickerChild) return;\n\n  const size = STICKER_SIZE * layer.scale * (densityAware ? pixelRatio : 1);\n\n  ctx.save();\n  ctx.translate(layer.position[0], layer.position[1]);\n  ctx.rotate(layer.rotation);\n\n  const [w, h] = snapToViewport(ratio, size, size);\n\n  ctx.drawImage(source, -size / 2 + (size - w) / 2, -size / 2 + (size - h) / 2, w, h);\n\n  ctx.restore();\n}\n","import {MediaEditorContextValue} from '@components/mediaEditor/context';\nimport {fontInfoMap, getContrastColor} from '@components/mediaEditor/utils';\nimport {ResizableLayer} from '@components/mediaEditor/types';\n\nexport default function drawTextLayer(\n  context: MediaEditorContextValue,\n  ctx: CanvasRenderingContext2D,\n  layer: ResizableLayer,\n  densityAware = true\n) {\n  if(layer.type !== 'text') return;\n\n  const {editorState: {pixelRatio}} = context;\n\n  const renderingInfo = {...layer.textRenderingInfo};\n  const scale = layer.scale * (densityAware ? pixelRatio : 1);\n  renderingInfo.height *= scale;\n  renderingInfo.width *= scale;\n  renderingInfo.lines = renderingInfo.lines.map((line) => ({\n    ...line,\n    height: line.height * scale,\n    left: line.left * scale,\n    right: line.right * scale\n  }));\n\n  if(renderingInfo.path) {\n    const newPath = [...renderingInfo.path];\n    function multiply(i: number) {\n      newPath[i] = (newPath[i] as number) * scale;\n    }\n    newPath.forEach((part, i) => {\n      if(part === 'M' || part === 'L') {\n        multiply(i + 1);\n        multiply(i + 2);\n      } else if(part === 'A') {\n        multiply(i + 1);\n        multiply(i + 2);\n        multiply(i + 6);\n        multiply(i + 7);\n      }\n    });\n    renderingInfo.path = newPath;\n  }\n\n  ctx.save();\n  ctx.translate(layer.position[0], layer.position[1]);\n  ctx.rotate(layer.rotation);\n\n  let prevY = -renderingInfo.height / 2;\n  const boxLeft = -renderingInfo.width / 2;\n  const fontInfo = fontInfoMap[layer.textInfo.font];\n\n  if(layer.textInfo.style === 'background') {\n    ctx.translate(boxLeft, prevY);\n\n    ctx.fillStyle = layer.textInfo.color;\n    const path = new Path2D(renderingInfo.path.join(' '));\n\n    ctx.fill(path);\n    ctx.translate(-boxLeft, -prevY);\n  }\n\n  renderingInfo.lines.forEach((line) => {\n    const yOffset = line.height * fontInfo.baseline;\n    let xOffset = 0.2 * layer.textInfo.size;\n    if(layer.textInfo.style === 'background') xOffset = 0.3 * layer.textInfo.size;\n\n    ctx.font = `${fontInfo.fontWeight} ${layer.textInfo.size}px ${fontInfo.fontFamily}`;\n\n    const x = boxLeft + xOffset + line.left,\n      y = prevY + yOffset;\n\n    if(layer.textInfo.style === 'outline') {\n      ctx.lineWidth = layer.textInfo.size * 0.15;\n      ctx.strokeStyle = layer.textInfo.color;\n      ctx.strokeText(line.content, x, y);\n      ctx.fillStyle = getContrastColor(layer.textInfo.color);\n      ctx.fillText(line.content, x, y);\n    } else if(layer.textInfo.style === 'background') {\n      ctx.fillStyle = getContrastColor(layer.textInfo.color);\n      ctx.fillText(line.content, x, y);\n    } else {\n      ctx.fillStyle = layer.textInfo.color;\n      ctx.fillText(line.content, x, y);\n    }\n    prevY += line.height;\n  });\n\n  ctx.restore();\n}\n","import {unwrap} from 'solid-js/store';\nimport {useCropOffset} from '@components/mediaEditor/canvas/useCropOffset';\nimport useProcessPoint from '@components/mediaEditor/canvas/useProcessPoint';\nimport {useMediaEditorContext} from '@components/mediaEditor/context';\nimport {snapToViewport} from '@components/mediaEditor/utils';\nimport drawStickerLayer from '@components/mediaEditor/finalRender/drawStickerLayer';\nimport drawTextLayer from '@components/mediaEditor/finalRender/drawTextLayer';\n\n\ntype Args = {\n  scaledWidth: number;\n  scaledHeight: number;\n};\n\nexport async function generateVideoPreview({scaledWidth, scaledHeight}: Args) {\n  const context = useMediaEditorContext();\n\n  const {\n    editorState: {\n      canvasSize: [cw, ch], imageCanvas, brushCanvas, currentTab, stickersLayersInfo, finalTransform: {scale}\n    },\n    mediaState: {\n      resizableLayers, rotation\n    }\n  } = context;\n\n  const processPoint = useProcessPoint(false);\n  const cropOffset = useCropOffset();\n\n  const isCropping = currentTab === 'crop';\n\n  const ratio = scaledWidth / scaledHeight;\n\n  const [previewWidth, previewHeight] = snapToViewport(ratio, isCropping ? cropOffset().width : cw, isCropping ? cropOffset().height : ch);\n\n  const mirrorCanvas = document.createElement('canvas');\n  [mirrorCanvas.width, mirrorCanvas.height] = [cw, ch];\n\n  const previewCanvas = document.createElement('canvas');\n  [previewCanvas.width, previewCanvas.height] = [previewWidth, previewHeight];\n\n\n  const previewCtx = previewCanvas.getContext('2d');\n  const mirrorCtx = mirrorCanvas.getContext('2d');\n\n  mirrorCtx.drawImage(imageCanvas, 0, 0, cw, ch);\n  mirrorCtx.drawImage(brushCanvas, 0, 0, cw, ch);\n\n  const processedLayers = unwrap(resizableLayers).map(layer => ({\n    ...layer,\n    position: processPoint(layer.position),\n    rotation: layer.rotation + rotation,\n    scale: layer.scale * scale,\n    textInfo: layer.textInfo ? {\n      ...layer.textInfo,\n      size: layer.textInfo.size * layer.scale * scale\n    } : undefined\n  }));\n\n  processedLayers.forEach((layer) => {\n    if(layer.type === 'text') drawTextLayer(context, mirrorCtx, layer, false);\n\n    if(layer.type === 'sticker') {\n      const {container} = stickersLayersInfo[layer.id];\n      const stickerChild = container?.lastElementChild;\n\n      let ratio: number;\n\n      if(stickerChild instanceof HTMLImageElement)\n        ratio = stickerChild.naturalWidth / stickerChild.naturalHeight;\n      else if(stickerChild instanceof HTMLCanvasElement)\n        ratio = 1;\n      else if(stickerChild instanceof HTMLVideoElement)\n        ratio = stickerChild.videoWidth / stickerChild.videoHeight;\n      else return;\n\n      drawStickerLayer(context, mirrorCtx, layer, stickerChild, ratio, false);\n    }\n  });\n\n  if(isCropping) {\n    previewCtx.drawImage(\n      mirrorCanvas,\n      cropOffset().left + (cropOffset().width - previewWidth) / 2, cropOffset().top + (cropOffset().height - previewHeight) / 2, previewWidth, previewHeight,\n      0, 0, previewWidth, previewHeight\n    );\n  } else {\n    previewCtx.drawImage(\n      mirrorCanvas,\n      (cw - previewWidth) / 2, (ch - previewHeight) / 2, previewWidth, previewHeight,\n      0, 0, previewWidth, previewHeight\n    );\n  }\n\n  const previewBlob = await new Promise<Blob>((resolve) => previewCanvas.toBlob(resolve));\n\n  return previewBlob;\n}\n","import deferredPromise, {CancellablePromise} from '@helpers/cancellablePromise';\nimport appDownloadManager from '@lib/appDownloadManager';\nimport {Document} from '@layer';\n\nimport {StickerFrameByFrameRenderer} from '@components/mediaEditor/finalRender/types';\n\nexport default class ImageStickerFrameByFrameRenderer implements StickerFrameByFrameRenderer {\n  private image: HTMLImageElement;\n\n  async init(doc: Document.document) {\n    const blob = await appDownloadManager.downloadMedia({\n      media: doc\n    });\n\n    const image = (this.image = new Image());\n    image.src = URL.createObjectURL(blob);\n\n    const deferred = deferredPromise<void>();\n\n    image.addEventListener('load', () => {\n      deferred.resolve();\n    });\n\n    await deferred;\n  }\n\n  getTotalFrames() {\n    return 1;\n  }\n\n  getRatio() {\n    return this.image.naturalWidth / this.image.naturalHeight;\n  }\n\n  async renderFrame() {}\n\n  getRenderedFrame() {\n    return this.image;\n  }\n\n  destroy() {\n    this.image = null;\n  }\n}\n","import deferredPromise, {CancellablePromise} from '@helpers/cancellablePromise';\nimport RLottiePlayer from '@lib/rlottie/rlottiePlayer';\nimport appDownloadManager from '@lib/appDownloadManager';\nimport lottieLoader from '@lib/rlottie/lottieLoader';\nimport {Document} from '@layer';\n\nimport {StickerFrameByFrameRenderer} from '@components/mediaEditor/finalRender/types';\n\nexport default class LottieStickerFrameByFrameRenderer implements StickerFrameByFrameRenderer {\n  private frameCount: number = 0;\n  private currentDeferredFrame: CancellablePromise<void>;\n  private container: HTMLDivElement;\n  private animation: RLottiePlayer;\n\n  async init(doc: Document.document, size: number) {\n    const blob = await appDownloadManager.downloadMedia({\n      media: doc\n    });\n    const container = (this.container = document.createElement('div'));\n    container.style.width = size + 'px';\n    container.style.height = size + 'px';\n    container.style.position = 'absolute';\n    container.style.opacity = '0';\n    container.style.pointerEvents = 'none';\n\n    document.body.append(container);\n    const animation = (this.animation = await lottieLoader.loadAnimationWorker({\n      container: container,\n      autoplay: false,\n      animationData: blob,\n      width: size,\n      height: size,\n      name: 'doc' + doc.id\n    }));\n\n    const deferred = deferredPromise<void>();\n\n    animation.addEventListener('ready', () => {\n      this.frameCount = animation.maxFrame + 1;\n      deferred.resolve();\n    });\n\n    animation.addEventListener('enterFrame', () => {\n      this.currentDeferredFrame?.resolve();\n    });\n\n    await deferred;\n  }\n\n  getTotalFrames() {\n    return this.frameCount;\n  }\n\n  getRatio() {\n    return 1 / 1;\n  }\n\n  async renderFrame(frame: number) {\n    this.currentDeferredFrame = deferredPromise<void>();\n    this.animation.requestFrame(frame);\n    await this.currentDeferredFrame;\n  }\n\n  getRenderedFrame() {\n    return this.animation.canvas[0];\n  }\n\n  destroy() {\n    this.container.remove();\n    this.animation.remove();\n  }\n}\n","import deferredPromise, {CancellablePromise} from '@helpers/cancellablePromise';\nimport appDownloadManager from '@lib/appDownloadManager';\nimport {getMiddleware} from '@helpers/middleware';\nimport {Document} from '@layer';\nimport createVideo from '@helpers/dom/createVideo';\nimport onMediaLoad from '@helpers/onMediaLoad';\nimport apiManagerProxy from '@lib/apiManagerProxy';\nimport handleVideoLeak from '@helpers/dom/handleVideoLeak';\nimport {IS_FIREFOX} from '@environment/userAgent';\n\nimport {delay} from '@components/mediaEditor/utils';\n\nimport {StickerFrameByFrameRenderer} from '@components/mediaEditor/finalRender/types';\nimport {FRAMES_PER_SECOND} from '@components/mediaEditor/finalRender/constants';\n\nexport default class VideoStickerFrameByFrameRenderer implements StickerFrameByFrameRenderer {\n  private duration: number = 0;\n  private currentDeferredFrame: CancellablePromise<void>;\n  private video: HTMLVideoElement;\n\n  private middleware = getMiddleware();\n\n  async init(doc: Document.document) {\n    const blob = await appDownloadManager.downloadMedia({\n      media: doc\n    });\n\n    const video = (this.video = createVideo({middleware: this.middleware.get()}));\n    video.src = await apiManagerProxy.invoke('createObjectURL', blob);\n    // video.autoplay = true;\n    video.controls = false;\n    video.muted = true;\n    // video.loop = true;\n    video.preload = 'auto';\n\n    const promise = onMediaLoad(video as HTMLMediaElement);\n    await handleVideoLeak(video, promise);\n    await delay(100); // Necessary\n    this.duration = video.duration;\n\n    video.addEventListener('seeked', () => {\n      this.currentDeferredFrame?.resolve();\n    });\n  }\n\n  getTotalFrames() {\n    return IS_FIREFOX ? 1 : Math.floor(this.duration * FRAMES_PER_SECOND);\n  }\n\n  async renderFrame(frame: number) {\n    if(IS_FIREFOX) return;\n    this.currentDeferredFrame = deferredPromise<void>();\n    this.video.currentTime = (1 / FRAMES_PER_SECOND) * frame;\n    await this.currentDeferredFrame;\n  }\n\n  getRatio() {\n    return this.video.videoWidth / this.video.videoHeight;\n  }\n\n  getRenderedFrame() {\n    return this.video;\n  }\n\n  destroy() {\n    this.middleware.destroy();\n    this.video = null;\n  }\n}\n","import {createRoot, createSignal, getOwner, runWithOwner} from 'solid-js';\nimport {animate} from '@helpers/animation';\nimport deferredPromise, {CancellablePromise} from '@helpers/cancellablePromise';\nimport ListenerSetter from '@helpers/listenerSetter';\nimport {MediaSize} from '@helpers/mediaSize';\nimport noop from '@helpers/noop';\nimport clamp from '@helpers/number/clamp';\nimport {logger} from '@lib/logger';\nimport {useMediaEditorContext} from '@components/mediaEditor/context';\nimport {supportsAudioEncoding} from '@components/mediaEditor/support';\nimport {delay, snapToViewport} from '@components/mediaEditor/utils';\nimport {RenderingPayload} from '@components/mediaEditor/webgl/initWebGL';\nimport calcCodecAndBitrate, {BITRATE_TARGET_FPS} from '@components/mediaEditor/finalRender/calcCodecAndBitrate';\nimport {FRAMES_PER_SECOND, STICKER_SIZE} from '@components/mediaEditor/finalRender/constants';\nimport {MediaEditorFinalResultPayload} from '@components/mediaEditor/finalRender/createFinalResult';\nimport drawStickerLayer from '@components/mediaEditor/finalRender/drawStickerLayer';\nimport drawTextLayer from '@components/mediaEditor/finalRender/drawTextLayer';\nimport {generateVideoPreview} from '@components/mediaEditor/finalRender/generateVideoPreview';\nimport {ScaledLayersAndLines} from '@components/mediaEditor/finalRender/getScaledLayersAndLines';\nimport ImageStickerFrameByFrameRenderer from '@components/mediaEditor/finalRender/imageStickerFrameByFrameRenderer';\nimport LottieStickerFrameByFrameRenderer from '@components/mediaEditor/finalRender/lottieStickerFrameByFrameRenderer';\nimport {StickerFrameByFrameRenderer} from '@components/mediaEditor/finalRender/types';\nimport VideoStickerFrameByFrameRenderer from '@components/mediaEditor/finalRender/videoStickerFrameByFrameRenderer';\nimport StickerType from '@config/stickerType';\n\n\ntype Args = {\n  renderingPayload: RenderingPayload;\n  hasAnimatedStickers: boolean;\n  scaledLayers: ScaledLayersAndLines['scaledLayers'];\n  scaledWidth: number;\n  scaledHeight: number;\n  ctx: CanvasRenderingContext2D;\n  imageCanvasGL: WebGLRenderingContext;\n  imageCanvas: HTMLCanvasElement;\n  drawToImageCanvas: () => void;\n  brushCanvas: HTMLCanvasElement;\n  resultCanvas: HTMLCanvasElement;\n};\n\nconst EXPECTED_FPS = 30;\nconst VIDEO_COMPARISON_ERROR = 0.0001;\n\nconst THUMBNAIL_MAX_SIZE = 720;\n\nconst log = logger('MediaEditor.createFinalResult.renderToActualVideo');\n\nexport default async function renderToActualVideo({\n  renderingPayload,\n  hasAnimatedStickers,\n  scaledWidth,\n  scaledHeight,\n  scaledLayers,\n  ctx,\n  imageCanvasGL: gl,\n  imageCanvas,\n  drawToImageCanvas,\n  brushCanvas,\n  resultCanvas\n}: Args) {\n  const context = useMediaEditorContext();\n\n  const {\n    editorState: {pixelRatio},\n    mediaState: {videoCropStart, videoCropLength, videoMuted, videoThumbnailPosition},\n    mediaBlob\n  } = context;\n\n  const {media: {video}} = renderingPayload;\n\n  const owner = getOwner();\n\n  video.muted = true;\n  const startTime = video.duration * videoCropStart;\n  const endTime = video.duration * (videoCropStart + videoCropLength);\n\n  const creationProgress = createRoot(dispose => {\n    const signal = createSignal(0);\n    return {signal, dispose};\n  });\n\n  const [progress, setProgress] = creationProgress.signal;\n\n  const renderers = new Map<number, StickerFrameByFrameRenderer>();\n\n  const thumbnailCanvas = document.createElement('canvas');\n  [thumbnailCanvas.width, thumbnailCanvas.height] = snapToViewport(scaledWidth / scaledHeight, Math.min(scaledWidth, THUMBNAIL_MAX_SIZE), Math.min(scaledHeight, THUMBNAIL_MAX_SIZE));\n  const thumbnailCtx = thumbnailCanvas.getContext('2d');\n\n  const thumbnailTime = videoThumbnailPosition * video.duration;\n\n  let\n    currentVideoFrameDeferred: CancellablePromise<number>,\n    encodingPausedDeferred: CancellablePromise<void>,\n    lastTime = 0,\n    frameCallbackId: number,\n    drewThumbnail = false,\n    canceled = false,\n    progressRAF = 0\n  ;\n\n  const listenerSetter = new ListenerSetter;\n\n  listenerSetter.add(window)('focus', () => {\n    log('window focus changed', 'focused');\n    encodingPausedDeferred?.resolve?.();\n    encodingPausedDeferred = undefined;\n  });\n\n  listenerSetter.add(window)('blur', () => {\n    log('window focus changed', 'blurred');\n    encodingPausedDeferred = deferredPromise();\n    currentVideoFrameDeferred?.reject(ThrowReason.EncodingPaused);\n  });\n\n  async function initMuxerAndEncoder() {\n    const {Muxer, ArrayBufferTarget} = await import('mp4-muxer');\n\n    let audioBuffer: AudioBuffer;\n\n    if(!videoMuted && await supportsAudioEncoding()) try {\n      audioBuffer = await extractAudioFragment(mediaBlob, startTime, endTime);\n    } catch{}\n\n    const muxer = new Muxer({\n      target: new ArrayBufferTarget(),\n      video: {\n        codec: 'avc',\n        width: scaledWidth,\n        height: scaledHeight\n      },\n      audio: audioBuffer ? {\n        codec: 'opus',\n        sampleRate: audioBuffer.sampleRate,\n        numberOfChannels: audioBuffer.numberOfChannels\n      } : undefined,\n      fastStart: 'in-memory'\n    });\n\n    const encoder = new VideoEncoder({\n      output: (chunk, meta) => muxer.addVideoChunk(chunk, meta),\n      error: (e) => console.error(e)\n    });\n\n    encoder.configure({\n      width: scaledWidth,\n      height: scaledHeight,\n      ...calcCodecAndBitrate(scaledWidth, scaledHeight, BITRATE_TARGET_FPS)\n    });\n\n    return {muxer, encoder, audioBuffer};\n  }\n\n  function drawToTexture() {\n    gl.bindTexture(gl.TEXTURE_2D, renderingPayload.texture);\n    gl.texSubImage2D(gl.TEXTURE_2D, 0, 0, 0, gl.RGBA, gl.UNSIGNED_BYTE, video);\n  }\n\n  async function initStickerRenderers() {\n    await Promise.all(\n      scaledLayers.map(async(layer) => {\n        if(!layer.sticker) return;\n\n        const stickerType = layer.sticker?.sticker;\n        let renderer: StickerFrameByFrameRenderer;\n\n        if(stickerType === StickerType.Static) renderer = new ImageStickerFrameByFrameRenderer();\n        if(stickerType === StickerType.Lottie) renderer = new LottieStickerFrameByFrameRenderer();\n        if(stickerType === StickerType.WebM) renderer = new VideoStickerFrameByFrameRenderer();\n        if(!renderer) return;\n\n        renderers.set(layer.id, renderer);\n        await renderer.init(layer.sticker!, STICKER_SIZE * layer.scale * pixelRatio);\n      })\n    );\n  }\n\n  enum ThrowReason {\n    EncodingPaused,\n    TimeLoopback\n  };\n\n  async function prepareAndRenderFrame(encoder: VideoEncoder, frameNo: number) {\n    currentVideoFrameDeferred = deferredPromise();\n\n    const callback = (mediaTime: number) => {\n      drawToTexture();\n      video.pause();\n\n      currentVideoFrameDeferred.resolve(mediaTime);\n    };\n\n    if(frameNo === 0) callback(0);\n    else {\n      frameCallbackId = video.requestVideoFrameCallback((_, {mediaTime}) => void callback(mediaTime));\n      if(video.paused) await video.play();\n    }\n\n    let mediaTime: number;\n    try {\n      mediaTime = await currentVideoFrameDeferred;\n    } catch(e: unknown) {\n      video.pause();\n      if(e === ThrowReason.EncodingPaused && encodingPausedDeferred) {\n        await encodingPausedDeferred;\n        log('paused case was playing', lastTime + startTime);\n        const deferred = deferredPromise<void>();\n\n        listenerSetter.add(video)('seeked', () => {\n          deferred.resolve();\n        }, {once: true});\n\n        video.currentTime = lastTime + startTime;\n\n        await deferred;\n      }\n      throw e;\n    }\n\n    const currentTime = frameNo === 0 ? 0 : mediaTime - startTime;\n    if(currentTime < lastTime) throw ThrowReason.TimeLoopback;\n\n    // Fill static frame with stickers frames\n    if(hasAnimatedStickers) {\n      const untilFrame = Math.round(currentTime * EXPECTED_FPS);\n      for(let frame = Math.round(lastTime * EXPECTED_FPS) + 1; frame < untilFrame; frame++) {\n        await renderFrame({\n          frameNo: frame / EXPECTED_FPS * FRAMES_PER_SECOND | 0,\n          timestamp: frame / EXPECTED_FPS * 1e6 | 0,\n          appendToMuxer: true,\n          encoder\n        });\n      }\n    }\n\n    lastTime = currentTime;\n\n    await renderFrame({\n      frameNo: currentTime * FRAMES_PER_SECOND | 0,\n      timestamp: currentTime * 1e6 | 0,\n      appendToMuxer: true,\n      encoder\n    });\n\n    // Save the thumbnail if it's more or less in the same frame as the current time\n    if(!drewThumbnail && thumbnailTime - 0.5 / EXPECTED_FPS <= currentTime && currentTime <= thumbnailTime + 0.5 / EXPECTED_FPS) {\n      drewThumbnail = true;\n      thumbnailCtx.drawImage(resultCanvas, 0, 0, thumbnailCanvas.width, thumbnailCanvas.height);\n    }\n  }\n\n  type RenderFrameArgs = {\n    frameNo: number;\n    timestamp: number;\n    appendToMuxer: boolean;\n    encoder: VideoEncoder;\n  };\n\n  async function renderFrame({frameNo, timestamp, appendToMuxer, encoder}: RenderFrameArgs) {\n    const promises = Array.from(renderers.values()).map((renderer) =>\n      renderer.renderFrame(frameNo % (renderer.getTotalFrames()))\n    );\n\n    await Promise.all(promises);\n\n    drawToImageCanvas();\n\n    ctx.clearRect(0, 0, scaledWidth, scaledHeight);\n    ctx.drawImage(imageCanvas, 0, 0);\n    ctx.drawImage(brushCanvas, 0, 0);\n\n    scaledLayers.forEach((layer) => {\n      if(layer.type === 'text') drawTextLayer(context, ctx, layer);\n      if(layer.type === 'sticker' && renderers.has(layer.id)) {\n        const renderer = renderers.get(layer.id);\n        drawStickerLayer(context, ctx, layer, renderer.getRenderedFrame(), renderer.getRatio());\n      }\n    });\n\n    if(!appendToMuxer) return;\n\n    const videoFrame = new VideoFrame(resultCanvas, {timestamp});\n\n    encoder.encode(videoFrame);\n    videoFrame.close();\n  }\n\n  function updateProgress(targetProgress: number) {\n    const speed = 0.05;\n    const currentProgress = progress();\n\n    const delta = targetProgress - currentProgress;\n\n    if(delta < 0.0025) { // fourth of a percent\n      setProgress(targetProgress);\n      return;\n    }\n\n    setProgress(currentProgress + delta * speed);\n\n    progressRAF = requestAnimationFrame(() => updateProgress(targetProgress));\n  }\n\n  function cleanup(encoder: VideoEncoder) {\n    encoder.close();\n    Array.from(renderers.values()).forEach((renderer) => renderer.destroy());\n    listenerSetter.removeAll();\n    cancelAnimationFrame(progressRAF);\n    video.src = '';\n    video.load();\n  }\n\n  setProgress(0);\n\n  const preview = await runWithOwner(owner, () => generateVideoPreview({scaledWidth, scaledHeight}));\n\n  const resultPromise = new Promise<MediaEditorFinalResultPayload>(async(resolve, reject) => {\n    const firstFrameSeekDeferred = deferredPromise<void>();\n    video.currentTime = video.duration * videoCropStart;\n    video.addEventListener('seeked', () => void firstFrameSeekDeferred.resolve(), {once: true});\n\n    const [{muxer, encoder, audioBuffer}] = await Promise.all([\n      initMuxerAndEncoder(),\n      delay(200),\n      firstFrameSeekDeferred,\n      initStickerRenderers()\n    ]);\n\n    let frameNo = 0;\n\n    let done = false;\n\n    animate(() => {\n      if(encodingPausedDeferred) return true;\n\n      if(video.currentTime >= endTime - VIDEO_COMPARISON_ERROR) {\n        done = true;\n        currentVideoFrameDeferred.resolve(endTime);\n      }\n      return !done;\n    });\n\n    // let avg = 0, cnt = 0;\n\n    // const startrendering = performance.now();\n\n    while(video.currentTime < endTime - VIDEO_COMPARISON_ERROR) {\n      if(canceled) {\n        reject();\n\n        done = true;\n        video.pause();\n\n        cleanup(encoder);\n        return;\n      }\n\n      try {\n        // const start = performance.now();\n        log('prepareAndRenderFrame', frameNo);\n        if(encodingPausedDeferred) {\n          log('paused case was paused', lastTime + startTime);\n          await encodingPausedDeferred;\n        }\n        await prepareAndRenderFrame(encoder, frameNo);\n        // const end = performance.now();\n        // const time = end - start;\n        // cnt++;\n        // avg += (time - avg) / cnt;\n      } catch(e: unknown) {\n        if(typeof e !== 'number') break;\n\n        if(e === ThrowReason.EncodingPaused) await encodingPausedDeferred;\n        else if(e === ThrowReason.TimeLoopback) break;\n      }\n\n      updateProgress(clamp((video.currentTime - startTime) / (endTime - startTime), 0, 1));\n      frameNo++;\n    }\n\n    done = true;\n    video.cancelVideoFrameCallback(frameCallbackId);\n    video.pause();\n\n    // const endrendering = performance.now();\n\n    if(!drewThumbnail) {\n      const deferred = deferredPromise<void>();\n\n      video.addEventListener('seeked', () => {\n        deferred.resolve();\n      }, {once: true});\n      video.currentTime = thumbnailTime;\n\n      await Promise.race([deferred, delay(2_000)]); // just in case you know\n\n      drawToTexture();\n      await renderFrame({frameNo: 0, timestamp: 0, appendToMuxer: false, encoder});\n\n      thumbnailCtx.drawImage(resultCanvas, 0, 0, thumbnailCanvas.width, thumbnailCanvas.height);\n    }\n\n    if(audioBuffer) await encodeAndMuxAudio(audioBuffer, (chunk) => muxer.addAudioChunk(chunk));\n\n    await encoder.flush();\n\n    muxer.finalize();\n\n    cleanup(encoder);\n\n    const {buffer} = muxer.target;\n\n    setProgress(1);\n\n    const thumbBlob = await new Promise<Blob>(resolve => thumbnailCanvas.toBlob(resolve));\n\n    resolve({\n      blob: new Blob([buffer], {type: 'video/mp4'}),\n      hasSound: !!audioBuffer,\n      thumb: {\n        blob: thumbBlob,\n        size: new MediaSize(thumbnailCanvas.width, thumbnailCanvas.height)\n      }\n    });\n\n    // alert(JSON.stringify({\n    //   avg,\n    //   total: endrendering - startrendering,\n    //   frameNo,\n    //   duration: video.duration\n    // }, null, 2));\n  });\n\n  let result: MediaEditorFinalResultPayload;\n\n  resultPromise.then((value) => (result = value)).catch(noop);\n\n  return {\n    preview,\n    isVideo: true,\n    getResult: () => {\n      return result ?? resultPromise;\n    },\n    cancel: () => {\n      canceled = true;\n    },\n    creationProgress\n  };\n\n  // const div = document.createElement('div')\n  // div.style.position = 'fixed';\n  // div.style.zIndex = '1000';\n  // div.style.top = '50%';\n  // div.style.left = '50%';\n  // div.style.transform = 'translate(-50%, -50%)';\n  // const img = document.createElement('video')\n  // img.src = URL.createObjectURL(blob)\n  // img.controls = true\n  // img.autoplay = true\n  // img.loop = true\n  // img.style.maxWidth = '450px'\n  // div.append(img)\n  // document.body.append(div)\n}\n\nasync function extractAudioFragment(blob: Blob, startTime: number, endTime: number) {\n  const audioContext: AudioContext = new (window.AudioContext || (window as any).webkitAudioContext)();\n  const arrayBuffer = await blob.arrayBuffer();\n  const fullAudioBuffer = await audioContext.decodeAudioData(arrayBuffer);\n\n  const sampleRate = fullAudioBuffer.sampleRate;\n  const startSample = Math.floor(startTime * sampleRate);\n  const endSample = Math.floor(endTime * sampleRate);\n  const frameCount = endSample - startSample;\n\n  const numChannels = fullAudioBuffer.numberOfChannels;\n\n  const fragmentBuffer = audioContext.createBuffer(numChannels, frameCount, sampleRate);\n\n  for(let ch = 0; ch < numChannels; ch++) {\n    const fullData = fullAudioBuffer.getChannelData(ch);\n    fragmentBuffer.copyToChannel(fullData.subarray(startSample, endSample), ch);\n  }\n\n  return fragmentBuffer;\n}\n\nasync function encodeAndMuxAudio(audioBuffer: AudioBuffer, onChunk: (ch: EncodedAudioChunk) => void) {\n  const sampleRate = audioBuffer.sampleRate;\n  const numChannels = audioBuffer.numberOfChannels;\n  const totalFrames = audioBuffer.length;\n\n\n  // Interleave audio for WebCodecs\n  const interleaved = new Float32Array(totalFrames * numChannels);\n  for(let ch = 0; ch < numChannels; ch++) {\n    const channelData = audioBuffer.getChannelData(ch);\n    for(let i = 0; i < totalFrames; i++) {\n      interleaved[i * numChannels + ch] = channelData[i];\n    }\n  }\n\n  const encoder = new AudioEncoder({\n    output: onChunk,\n    error: (e) => console.error('AudioEncoder error:', e)\n  });\n\n  encoder.configure({\n    codec: 'opus',\n    sampleRate,\n    numberOfChannels: audioBuffer.numberOfChannels,\n    bitrate: 128000\n  });\n\n  const audioData = new AudioData({\n    format: 'f32',\n    sampleRate,\n    numberOfFrames: audioBuffer.duration * audioBuffer.sampleRate,\n    numberOfChannels: audioBuffer.numberOfChannels,\n    timestamp: 0,\n    data: interleaved\n  });\n\n  encoder.encode(audioData);\n  audioData.close();\n\n  await encoder.flush();\n  encoder.close();\n}\n","import StickerType from '@config/stickerType';\nimport {MediaEditorContextValue} from '@components/mediaEditor/context';\nimport {MediaEditorFinalResultPayload} from '@components/mediaEditor/finalRender/createFinalResult';\n\nimport drawStickerLayer from '@components/mediaEditor/finalRender/drawStickerLayer';\nimport drawTextLayer from '@components/mediaEditor/finalRender/drawTextLayer';\nimport {ScaledLayersAndLines} from '@components/mediaEditor/finalRender/getScaledLayersAndLines';\n\nexport type RenderToImageArgs = {\n  context: MediaEditorContextValue;\n  scaledLayers: ScaledLayersAndLines['scaledLayers'];\n  ctx: CanvasRenderingContext2D;\n  imageCanvas: HTMLCanvasElement;\n  brushCanvas: HTMLCanvasElement;\n  resultCanvas: HTMLCanvasElement;\n};\n\nexport default async function renderToImage({\n  context,\n  scaledLayers,\n  ctx,\n  imageCanvas,\n  brushCanvas,\n  resultCanvas\n}: RenderToImageArgs) {\n  const {editorState: {stickersLayersInfo}} = context;\n\n  ctx.drawImage(imageCanvas, 0, 0);\n  ctx.drawImage(brushCanvas, 0, 0);\n\n  scaledLayers.forEach((layer) => {\n    if(layer.type === 'text') drawTextLayer(context, ctx, layer);\n    if(layer.type === 'sticker' && layer.sticker?.sticker === StickerType.Static) {\n      const {container} = stickersLayersInfo[layer.id];\n      const stickerChild = container?.lastElementChild;\n      if(!(stickerChild instanceof HTMLImageElement)) return;\n      const ratio = stickerChild.naturalWidth / stickerChild.naturalHeight;\n      drawStickerLayer(context, ctx, layer, stickerChild, ratio);\n    }\n  });\n\n  const result = await new Promise<MediaEditorFinalResultPayload>((resolve) =>\n    resultCanvas.toBlob(blob => resolve({\n      blob,\n      hasSound: false\n    }))\n  );\n\n  return {\n    preview: result.blob,\n    isVideo: false,\n    getResult: () => result\n  };\n}\n","import {createRoot, createSignal, getOwner, runWithOwner} from 'solid-js';\n\nimport noop from '@helpers/noop';\n\nimport {useMediaEditorContext} from '@components/mediaEditor/context';\nimport {delay} from '@components/mediaEditor/utils';\n\nimport {FRAMES_PER_SECOND, STICKER_SIZE} from '@components/mediaEditor/finalRender/constants';\nimport {MediaEditorFinalResultPayload} from '@components/mediaEditor/finalRender/createFinalResult';\nimport drawStickerLayer from '@components/mediaEditor/finalRender/drawStickerLayer';\nimport drawTextLayer from '@components/mediaEditor/finalRender/drawTextLayer';\nimport {generateVideoPreview} from '@components/mediaEditor/finalRender/generateVideoPreview';\nimport {ScaledLayersAndLines} from '@components/mediaEditor/finalRender/getScaledLayersAndLines';\nimport ImageStickerFrameByFrameRenderer from '@components/mediaEditor/finalRender/imageStickerFrameByFrameRenderer';\nimport LottieStickerFrameByFrameRenderer from '@components/mediaEditor/finalRender/lottieStickerFrameByFrameRenderer';\nimport {StickerFrameByFrameRenderer} from '@components/mediaEditor/finalRender/types';\nimport VideoStickerFrameByFrameRenderer from '@components/mediaEditor/finalRender/videoStickerFrameByFrameRenderer';\nimport calcCodecAndBitrate, {BITRATE_TARGET_FPS} from '@components/mediaEditor/finalRender/calcCodecAndBitrate';\nimport StickerType from '@config/stickerType';\n\ntype Args = {\n  scaledLayers: ScaledLayersAndLines['scaledLayers'];\n  scaledWidth: number;\n  scaledHeight: number;\n  ctx: CanvasRenderingContext2D;\n  imageCanvas: HTMLCanvasElement;\n  brushCanvas: HTMLCanvasElement;\n  resultCanvas: HTMLCanvasElement;\n};\n\nexport default async function renderToVideoGIF({\n  scaledWidth,\n  scaledHeight,\n  scaledLayers,\n  ctx,\n  imageCanvas,\n  brushCanvas,\n  resultCanvas\n}: Args) {\n  const owner = getOwner();\n  const context = useMediaEditorContext();\n\n  const {editorState: {pixelRatio}} = context;\n\n  const creationProgress = createRoot(dispose => {\n    const signal = createSignal(0);\n    return {signal, dispose};\n  });\n\n  const [, setProgress] = creationProgress.signal;\n\n  const renderers = new Map<number, StickerFrameByFrameRenderer>();\n\n  let canceled = false;\n\n  async function renderFrame(encoder: VideoEncoder, frameNo: number) {\n    const promises = Array.from(renderers.values()).map((renderer) =>\n      renderer.renderFrame(frameNo % (renderer.getTotalFrames() + 1))\n    );\n    await Promise.all(promises);\n\n    ctx.clearRect(0, 0, scaledWidth, scaledHeight);\n    ctx.drawImage(imageCanvas, 0, 0);\n    ctx.drawImage(brushCanvas, 0, 0);\n\n    scaledLayers.forEach((layer) => {\n      if(layer.type === 'text') drawTextLayer(context, ctx, layer);\n      if(layer.type === 'sticker' && renderers.has(layer.id)) {\n        const renderer = renderers.get(layer.id);\n        drawStickerLayer(context, ctx, layer, renderer.getRenderedFrame(), renderer.getRatio());\n      }\n    });\n\n    const videoFrame = new VideoFrame(resultCanvas, {\n      timestamp: (frameNo * 1e6) / FRAMES_PER_SECOND,\n      duration: 1e6 / FRAMES_PER_SECOND\n    });\n    encoder.encode(videoFrame);\n    videoFrame.close();\n  }\n\n  function cleanup(encoder: VideoEncoder) {\n    encoder.close();\n    Array.from(renderers.values()).forEach((renderer) => renderer.destroy());\n  }\n\n  const resultPromise = new Promise<MediaEditorFinalResultPayload>(async(resolve, reject) => {\n    let maxFrames = 0;\n\n    const [{ArrayBufferTarget, Muxer}] = await Promise.all([\n      import('mp4-muxer'),\n      ...scaledLayers.map(async(layer) => {\n        if(!layer.sticker) return;\n\n        const stickerType = layer.sticker?.sticker;\n        let renderer: StickerFrameByFrameRenderer;\n\n        if(stickerType === StickerType.Static) renderer = new ImageStickerFrameByFrameRenderer();\n        if(stickerType === StickerType.Lottie) renderer = new LottieStickerFrameByFrameRenderer();\n        if(stickerType === StickerType.WebM) renderer = new VideoStickerFrameByFrameRenderer();\n        if(!renderer) return;\n\n        renderers.set(layer.id, renderer);\n        await renderer.init(layer.sticker!, STICKER_SIZE * layer.scale * pixelRatio);\n        maxFrames = Math.max(maxFrames, renderer.getTotalFrames());\n      }),\n      delay(200)\n    ]);\n\n    const muxer = new Muxer({\n      target: new ArrayBufferTarget(),\n      video: {\n        codec: 'avc',\n        width: scaledWidth,\n        height: scaledHeight,\n        frameRate: FRAMES_PER_SECOND\n      },\n      fastStart: 'in-memory'\n    });\n\n    const encoder = new VideoEncoder({\n      output: (chunk, meta) => muxer.addVideoChunk(chunk, meta),\n      error: (e) => console.error(e)\n    });\n\n    encoder.configure({\n      width: scaledWidth,\n      height: scaledHeight,\n      ...calcCodecAndBitrate(scaledWidth, scaledHeight, BITRATE_TARGET_FPS)\n    });\n\n    for(let frameNo = 0; frameNo <= maxFrames; frameNo++) {\n      if(canceled) {\n        reject();\n        cleanup(encoder);\n      }\n\n      await renderFrame(encoder, frameNo);\n      setProgress(frameNo / maxFrames);\n    }\n\n    await encoder.flush();\n    muxer.finalize();\n\n    cleanup(encoder);\n\n    const {buffer} = muxer.target;\n    resolve({\n      blob: new Blob([buffer], {type: 'video/mp4'}),\n      hasSound: false\n    });\n  });\n\n  let result: MediaEditorFinalResultPayload;\n\n  resultPromise.then((value) => (result = value)).catch(noop);\n\n  return {\n    preview: await runWithOwner(owner, () => generateVideoPreview({scaledWidth, scaledHeight})),\n    isVideo: true,\n    getResult: () => {\n      return result ?? resultPromise;\n    },\n    cancel: () => {\n      canceled = true;\n    },\n    creationProgress\n  };\n\n  // const div = document.createElement('div')\n  // div.style.position = 'fixed';\n  // div.style.zIndex = '1000';\n  // div.style.top = '50%';\n  // div.style.left = '50%';\n  // div.style.transform = 'translate(-50%, -50%)';\n  // const img = document.createElement('video')\n  // img.src = URL.createObjectURL(blob)\n  // img.controls = true\n  // img.autoplay = true\n  // img.loop = true\n  // img.style.maxWidth = '450px'\n  // div.append(img)\n  // document.body.append(div)\n}\n","import apiManagerProxy from '@lib/apiManagerProxy';\nimport deferredPromise from '@helpers/cancellablePromise';\n\nimport {MediaEditorContextValue} from '@components/mediaEditor/context';\nimport {useCropOffset} from '@components/mediaEditor/canvas/useCropOffset';\nimport {delay, snapToViewport} from '@components/mediaEditor/utils';\n\n\ntype SpawnAnimatedPreviewOptions = {\n  context: MediaEditorContextValue;\n  cropOffset: ReturnType<typeof useCropOffset>;\n  scaledWidth: number;\n  scaledHeight: number;\n  previewBlob: Blob;\n}\n\nexport default async function spawnAnimatedPreview({\n  context,\n  cropOffset,\n  scaledWidth,\n  scaledHeight,\n  previewBlob\n}: SpawnAnimatedPreviewOptions) {\n  const {editorState: {currentTab, imageCanvas}} = context;\n\n  const isCropping = currentTab === 'crop';\n\n  const bcr = imageCanvas.getBoundingClientRect();\n  const animatedImg = new Image();\n  animatedImg.src = await apiManagerProxy.invoke('createObjectURL', previewBlob);\n  animatedImg.style.position = 'fixed';\n  const left = bcr.left + (isCropping ? cropOffset().left + cropOffset().width / 2 : bcr.width / 2),\n    top = bcr.top + (isCropping ? cropOffset().top + cropOffset().height / 2 : bcr.height / 2);\n\n  const [width, height] = snapToViewport(\n    scaledWidth / scaledHeight,\n    isCropping ? cropOffset().width : bcr.width,\n    isCropping ? cropOffset().height : bcr.height\n  );\n  animatedImg.style.left = left + 'px';\n  animatedImg.style.top = top + 'px';\n  animatedImg.style.width = width + 'px';\n  animatedImg.style.height = height + 'px';\n  animatedImg.style.transform = 'translate(-50%, -50%)';\n  animatedImg.style.objectFit = 'cover';\n  animatedImg.style.zIndex = '1000';\n\n  document.body.append(animatedImg);\n\n  const deferred = deferredPromise<void>();\n\n  animatedImg.addEventListener('load', () => deferred.resolve())\n\n  await Promise.race([delay(500), deferred]);\n\n  return animatedImg;\n}\n","import {getOwner, runWithOwner} from 'solid-js';\nimport {unwrap} from 'solid-js/store';\nimport {MediaSize} from '@helpers/mediaSize';\nimport noop from '@helpers/noop';\nimport {logger} from '@lib/logger';\nimport {adjustmentsConfig, AdjustmentsConfig} from '@components/mediaEditor/adjustments';\nimport BrushPainter from '@components/mediaEditor/canvas/brushPainter';\nimport {useCropOffset} from '@components/mediaEditor/canvas/useCropOffset';\nimport {EditingMediaState, useMediaEditorContext} from '@components/mediaEditor/context';\nimport {NumberPair, StandaloneSignal} from '@components/mediaEditor/types';\nimport {checkIfHasAnimatedStickers, cleanupWebGl, snapToAvailableQuality} from '@components/mediaEditor/utils';\nimport {draw} from '@components/mediaEditor/webgl/draw';\nimport {initWebGL} from '@components/mediaEditor/webgl/initWebGL';\nimport getResultSize from '@components/mediaEditor/finalRender/getResultSize';\nimport getResultTransform from '@components/mediaEditor/finalRender/getResultTransform';\nimport getScaledLayersAndLines from '@components/mediaEditor/finalRender/getScaledLayersAndLines';\nimport renderToActualVideo from '@components/mediaEditor/finalRender/renderToActualVideo';\nimport renderToImage from '@components/mediaEditor/finalRender/renderToImage';\nimport renderToVideoGIF from '@components/mediaEditor/finalRender/renderToVideoGIF';\nimport spawnAnimatedPreview from '@components/mediaEditor/finalRender/spawnAnimatedPreview';\n\n\nexport type MediaEditorFinalResultPayload = {\n  blob: Blob;\n  hasSound: boolean;\n  thumb?: {\n    blob: Blob;\n    size: MediaSize;\n  }\n};\n\nexport type MediaEditorFinalResult = {\n  preview: Blob;\n  getResult: () => MediaEditorFinalResultPayload | Promise<MediaEditorFinalResultPayload>;\n  cancel?: () => void;\n  isVideo: boolean;\n  width: number;\n  height: number;\n  originalSrc: string;\n  originalSize?: NumberPair;\n  editingMediaState: EditingMediaState;\n  animatedPreview?: HTMLImageElement;\n  creationProgress?: StandaloneSignal<number>;\n};\n\nconst log = logger('MediaEditor.createFinalResult');\n\nexport async function createFinalResult(): Promise<MediaEditorFinalResult> {\n  const context = useMediaEditorContext();\n  const {editorState, mediaState, mediaSrc, mediaType, imageRatio} = context;\n  const {resizableLayers, adjustments} = mediaState;\n\n  const owner = getOwner();\n\n  const cropOffset = useCropOffset();\n\n  const hasAnimatedStickers = checkIfHasAnimatedStickers(resizableLayers);\n\n  const willResultInVideo = hasAnimatedStickers || mediaType === 'video';\n\n  const videoType = mediaType === 'video' ? 'video' : hasAnimatedStickers ? 'gif' : undefined;\n\n  const [, maxHeight] = getResultSize({\n    imageWidth: editorState.renderingPayload?.media.width,\n    newRatio: mediaState.currentImageRatio,\n    scale: mediaState.scale,\n    videoType,\n    imageRatio: imageRatio,\n    cropOffset: cropOffset()\n  });\n\n  const maxQuality = snapToAvailableQuality(maxHeight);\n\n  const [scaledWidth, scaledHeight] = getResultSize({\n    imageWidth: editorState.renderingPayload?.media.width,\n    newRatio: mediaState.currentImageRatio,\n    scale: mediaState.scale,\n    videoType,\n    imageRatio,\n    cropOffset: cropOffset(),\n    quality: willResultInVideo ? Math.min(maxQuality, mediaState.videoQuality) : undefined\n  });\n\n  const imageCanvas = document.createElement('canvas');\n  imageCanvas.width = scaledWidth;\n  imageCanvas.height = scaledHeight;\n\n  const gl = imageCanvas.getContext('webgl', {\n    preserveDrawingBuffer: true\n  });\n\n  const payload = await initWebGL({gl, mediaSrc, mediaType, videoTime: mediaState.videoCropStart, waitToSeek: false});\n\n  const finalTransform = getResultTransform({\n    context,\n    scaledWidth,\n    scaledHeight,\n    imageWidth: payload.media.width,\n    imageHeight: payload.media.height,\n    cropOffset\n  });\n\n  const drawToImageCanvas = () => {\n    draw(gl, payload, {\n      ...finalTransform,\n      imageSize: [payload.media.width, payload.media.height],\n      ...(Object.fromEntries(\n        adjustmentsConfig.map(({key, to100}) => {\n          const value = adjustments[key];\n          return [key, value / (to100 ? 100 : 50)];\n        })\n      ) as Record<AdjustmentsConfig[number]['key'], number>)\n    });\n  };\n\n  if(mediaType === 'image') drawToImageCanvas();\n\n  const {scaledLayers, scaledLines} = getScaledLayersAndLines(context, finalTransform, scaledWidth, scaledHeight);\n\n  const brushCanvas = document.createElement('canvas');\n  brushCanvas.width = scaledWidth;\n  brushCanvas.height = scaledHeight;\n\n  const brushPainter = new BrushPainter({targetCanvas: brushCanvas, imageCanvas});\n  brushPainter.saveLastLine();\n  scaledLines.forEach((line) => brushPainter.drawLine(line));\n\n  const resultCanvas = document.createElement('canvas');\n  resultCanvas.width = scaledWidth;\n  resultCanvas.height = scaledHeight;\n  const ctx = resultCanvas.getContext('2d', {willReadFrequently: true});\n\n  const renderPromise = (() => {\n    if(mediaType === 'video')\n      return runWithOwner(owner, () => renderToActualVideo({\n        renderingPayload: payload,\n        hasAnimatedStickers,\n        scaledWidth,\n        scaledHeight,\n        scaledLayers,\n        imageCanvasGL: gl,\n        imageCanvas,\n        drawToImageCanvas,\n        resultCanvas,\n        brushCanvas,\n        ctx\n      }));\n\n    if(hasAnimatedStickers)\n      return runWithOwner(owner, () => renderToVideoGIF({\n        scaledWidth,\n        scaledHeight,\n        scaledLayers,\n        imageCanvas,\n        resultCanvas,\n        brushCanvas,\n        ctx\n      }));\n\n    return renderToImage({\n      context,\n      scaledLayers,\n      imageCanvas,\n      resultCanvas,\n      brushCanvas,\n      ctx\n    });\n  })();\n\n  const renderResult = await renderPromise;\n\n  const animatedPreview = await spawnAnimatedPreview({\n    context,\n    cropOffset,\n    scaledWidth,\n    scaledHeight,\n    previewBlob: renderResult.preview\n  });\n\n  Promise.resolve(renderResult.getResult())?.catch(noop)?.finally(() => {\n    cleanupWebGl(gl);\n    log('cleaning up webgl')\n  });\n\n  return {\n    ...renderResult,\n    animatedPreview,\n    width: scaledWidth,\n    height: scaledHeight,\n    originalSrc: context.mediaSrc,\n    originalSize: [payload.media.width, payload.media.height],\n    editingMediaState: structuredClone(unwrap(mediaState))\n  };\n}\n","import {onMount} from 'solid-js';\n\nimport ripple from '@components/ripple';\n\nimport {useMediaEditorContext} from '@components/mediaEditor/context';\n\n\nexport default function FinishButton(props: {onClick: () => void}) {\n  let container: HTMLDivElement;\n  const {hasModifications} = useMediaEditorContext();\n\n  onMount(() => {\n    ripple(container);\n  });\n\n  return (\n    <div\n      ref={container}\n      onClick={props.onClick}\n      class=\"media-editor__finish-button\"\n      classList={{\n        'media-editor__finish-button--hidden': !hasModifications()\n      }}\n    >\n      <svg width=\"18\" height=\"16\" viewBox=\"0 0 18 16\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n        <path d=\"M2 9L6.5 14L16 2\" stroke=\"white\" stroke-width=\"2.66\" stroke-linecap=\"round\" stroke-linejoin=\"round\" />\n      </svg>\n    </div>\n  );\n}\n","import {createMemo, JSX} from 'solid-js';\n\nimport clamp from '@helpers/number/clamp';\nimport {hexaToHsla} from '@helpers/color';\nimport nMap from '@helpers/number/nMap';\n\nexport default function RangeInput(props: {\n  ref?: (el: HTMLDivElement) => void;\n  style?: JSX.CSSProperties;\n  label: JSX.Element;\n  value: number;\n  min: number;\n  max: number;\n  onChange: (value: number) => void;\n  onChangeFinish?: (prevValue: number, currentValue: number) => void;\n  passiveLabel?: boolean;\n  color?: string;\n}) {\n  const normalizedValue = () => nMap(props.value, props.min, props.max, 0, 1);\n  const mappedCenter = createMemo(() => nMap(0, props.min, props.max, 0, 100));\n\n  const brightShadow = () => props.color && hexaToHsla(props.color).l < 32;\n\n  let prevValue: number | null = null;\n\n  return (\n    <div\n      ref={props.ref}\n      class=\"media-editor__range-input\"\n      classList={{\n        'media-editor__range-input--passive': props.passiveLabel,\n        'media-editor__range-input--has-value': !props.passiveLabel && !!props.value,\n        'media-editor__range-input--bright-shadow': brightShadow()\n      }}\n      style={{\n        '--color': props.color,\n        '--normalized': normalizedValue(),\n        '--w': (Math.abs(props.value - Math.max(0, props.min)) / (props.max - props.min)) * 100 + '%',\n        '--bar-left': props.value >= 0 ? Math.max(0, mappedCenter()) + '%' : undefined,\n        '--bar-right': props.value < 0 ? mappedCenter() + '%' : undefined,\n        ...props.style\n      }}\n    >\n      <div class=\"media-editor__range-input-row\">\n        <div class=\"media-editor__range-input-label\">{props.label}</div>\n        <div class=\"media-editor__range-input-value\">{props.value}</div>\n      </div>\n      <div class=\"media-editor__range-input-wrapper\">\n        <input\n          type=\"range\"\n          min={props.min}\n          max={props.max}\n          step=\"1\"\n          value={props.value}\n          onInput={(e) => {\n            if(prevValue === null) prevValue = props.value;\n            const newValue = clamp(e.currentTarget.valueAsNumber, props.min, props.max);\n            props.onChange(newValue);\n          }}\n          onChange={() => {\n            props.onChangeFinish?.(prevValue, props.value);\n            prevValue = null;\n          }}\n        />\n        <div class=\"media-editor__range-input-thumb media-editor__range-input-thumb--shadow\" />\n        <div class=\"media-editor__range-input-progress media-editor__range-input-progress--shadow\" />\n        <div class=\"media-editor__range-input-progress-background\" />\n        <div class=\"media-editor__range-input-thumb\" />\n        <div class=\"media-editor__range-input-progress\" />\n      </div>\n    </div>\n  );\n}\n","import {createMemo, createSelector, For, JSX} from 'solid-js';\nimport clamp from '@helpers/number/clamp';\n\n\nexport type StepInputStep<T = any> = {\n  value: T;\n  label: JSX.Element;\n};\n\nexport default function StepInput<T = any>(props: {\n  label: JSX.Element;\n  value: T;\n  steps: StepInputStep[];\n  onChange: (value: T) => void;\n}) {\n  const stepIndex = createMemo(() => props.steps.findIndex(step => step.value === props.value));\n  const step = createMemo(() => props.steps[stepIndex()]);\n\n  const isActive = createSelector(stepIndex, (a, b) => a <= b);\n  const isSelected = createSelector(stepIndex, (a, b) => a === b);\n\n  return (\n    <div\n      class=\"media-editor__step-input\"\n    >\n      <div class=\"media-editor__range-input-row\">\n        <div class=\"media-editor__range-input-label\">{props.label}</div>\n        <div class=\"media-editor__range-input-value\">{step().label}</div>\n      </div>\n\n      <div class=\"media-editor__step-input-wrapper\">\n        <input\n          type=\"range\"\n          min={0}\n          max={props.steps.length - 1}\n          step=\"1\"\n          value={stepIndex()}\n          onInput={(e) => {\n            const newValue = Math.round(clamp(e.currentTarget.valueAsNumber, 0, props.steps.length - 1)); // just in case\n            props.onChange(props.steps[newValue].value);\n          }}\n        />\n        <For each={props.steps}>\n          {(_, index) => <>\n            {index() && <div\n              class=\"media-editor__step-input-separator\"\n              classList={{\n                'media-editor__step-input-separator--active': isActive(index())\n              }}\n            />}\n            <div\n              class=\"media-editor__step-input-dot\"\n              classList={{\n                'media-editor__step-input-dot--active': isActive(index()),\n                'media-editor__step-input-dot--selected': isSelected(index())\n              }}\n            />\n          </>}\n        </For>\n      </div>\n    </div>\n  );\n}\n","import {createEffect, createMemo, createSignal, on, onCleanup, Show} from 'solid-js';\n\nimport {i18n} from '@lib/langPack';\n\nimport Space from '@components/space';\n\nimport {adjustmentsConfig} from '@components/mediaEditor/adjustments';\nimport {useCropOffset} from '@components/mediaEditor/canvas/useCropOffset';\nimport {useMediaEditorContext} from '@components/mediaEditor/context';\nimport getResultSize from '@components/mediaEditor/finalRender/getResultSize';\nimport RangeInput from '@components/mediaEditor/rangeInput';\nimport StepInput, {StepInputStep} from '@components/mediaEditor/stepInput';\nimport useIsMobile from '@components/mediaEditor/useIsMobile';\nimport {availableQualityHeights, checkIfHasAnimatedStickers, snapToAvailableQuality} from '@components/mediaEditor/utils';\n\n\nconst ADJUST_TIMEOUT = 800;\n\nexport default function AdjustmentsTab() {\n  const {editorState, mediaState, actions, mediaSize, mediaType, imageRatio} = useMediaEditorContext();\n\n  const isMobile = useIsMobile();\n  const cropOffset = useCropOffset();\n\n  let timeoutId = 0;\n  function removeIsAdjusting() {\n    window.clearTimeout(timeoutId);\n    timeoutId = window.setTimeout(() => {\n      editorState.isAdjusting = false;\n    }, ADJUST_TIMEOUT);\n  }\n\n  const resultingSize = createMemo(() =>\n    getResultSize({\n      imageWidth: mediaSize[0],\n      scale: mediaState.scale,\n      newRatio: mediaState.currentImageRatio || imageRatio,\n      videoType: mediaType === 'video' ? 'video' : 'gif',\n      imageRatio,\n      cropOffset: !cropOffset().width ? {width: 1, height: 1} : cropOffset()\n    })\n  );\n\n  createEffect(() => {\n    resultingSize();\n    (window as any).debugResultingSize && console.log('resultingSize', resultingSize());\n  });\n\n  const maxVideoQuality = createMemo(() => snapToAvailableQuality(resultingSize()[1]));\n\n  const steps = createMemo((): StepInputStep[] =>\n    availableQualityHeights\n    .filter(height => height <= maxVideoQuality())\n    .map(height => ({value: height, label: height + 'p'}))\n  );\n\n  const canShowQualityInput = createMemo(() => (mediaType === 'video' || checkIfHasAnimatedStickers(mediaState.resizableLayers)) && steps().length > 1);\n\n  return (\n    <>\n      <Space amount=\"16px\" />\n\n      <Show when={canShowQualityInput()}>\n        <StepInput\n          label={i18n('Quality')}\n          steps={steps()}\n          value={Math.min(maxVideoQuality(), mediaState.videoQuality)}\n          onChange={(value) => void(mediaState.videoQuality = value)}\n        />\n        <Space amount=\"32px\" />\n      </Show>\n\n      {adjustmentsConfig.map((item) => {\n        const [container, setContainer] = createSignal<HTMLDivElement>();\n\n        const [showGhost, setShowGhost] = createSignal(false);\n\n        const value = () => mediaState.adjustments[item.key];\n        const setValue = (v: number): void => void (mediaState.adjustments[item.key] = v);\n\n        createEffect(\n          on(showGhost, () => {\n            if(!container() || !isMobile() || !showGhost()) return;\n            const bcr = container().getBoundingClientRect();\n            const div = (\n              <div\n                class=\"night media-editor__inherit-color\"\n                style={{\n                  'position': 'fixed',\n                  'left': bcr.left + 'px',\n                  'top': bcr.top + 'px',\n                  'width': bcr.width + 'px',\n                  'height': bcr.height + 'px',\n                  'z-index': 100\n                }}\n              >\n                <RangeInput\n                  value={value()}\n                  onChange={() => {}}\n                  label={item.label()}\n                  min={item.to100 ? 0 : -50}\n                  max={item.to100 ? 100 : 50}\n                />\n              </div>\n            ) as HTMLDivElement;\n            document.body.append(div);\n\n            onCleanup(() => {\n              setTimeout(() => {\n                div.remove();\n              }, 200);\n            });\n          })\n        );\n\n        let timeoutId = 0;\n        const removeGhost = () => {\n          window.clearTimeout(timeoutId);\n          timeoutId = window.setTimeout(() => {\n            setShowGhost(false);\n          }, ADJUST_TIMEOUT);\n        };\n\n        return (\n          <>\n            <RangeInput\n              ref={setContainer}\n              value={value()}\n              onChange={(v) => {\n                setValue(v);\n                setShowGhost(true);\n                editorState.isAdjusting = true;\n                removeGhost();\n                removeIsAdjusting();\n              }}\n              label={item.label()}\n              onChangeFinish={(prevValue, currentValue) => {\n                setShowGhost(false);\n                editorState.isAdjusting = false;\n\n                actions.pushToHistory({\n                  path: ['adjustments', item.key],\n                  newValue: currentValue,\n                  oldValue: prevValue\n                });\n              }}\n              min={item.to100 ? 0 : -50}\n              max={item.to100 ? 100 : 50}\n            />\n            <Space amount=\"32px\" />\n          </>\n        );\n      })}\n    </>\n  );\n}\n","export function PenBrush() {\n  return (\n    <svg width=\"120\" height=\"48\" viewBox=\"0 0 120 48\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n      <g clip-path=\"url(#clip0_6102_2542)\">\n        <g filter=\"url(#filter0_iiii_6102_2542)\">\n          <path\n            d=\"M0 15H80L110.2 22.4465C112.048 22.9021 112.971 23.1299 113.185 23.4931C113.369 23.806 113.369 24.194 113.185 24.5069C112.971 24.8701 112.048 25.0979 110.2 25.5535L80 33H0V15Z\"\n            fill=\"#3E3F3F\"\n          />\n        </g>\n        <path\n          d=\"M112.564 24.9709L103.474 27.2132C103.21 27.2782 102.944 27.121 102.883 26.8566C102.736 26.2146 102.5 25.0296 102.5 24C102.5 22.9705 102.736 21.7855 102.883 21.1434C102.944 20.8791 103.21 20.7219 103.474 20.7868L112.564 23.0291C113.578 23.2792 113.578 24.7208 112.564 24.9709Z\"\n          fill=\"currentColor\"\n        />\n        <rect x=\"76\" y=\"15\" width=\"4\" height=\"18\" rx=\"0.5\" fill=\"currentColor\" />\n      </g>\n      <defs>\n        <filter\n          id=\"filter0_iiii_6102_2542\"\n          x=\"0\"\n          y=\"10\"\n          width=\"116.323\"\n          height=\"28\"\n          filterUnits=\"userSpaceOnUse\"\n          color-interpolation-filters=\"sRGB\"\n        >\n          <feFlood flood-opacity=\"0\" result=\"BackgroundImageFix\" />\n          <feBlend mode=\"normal\" in=\"SourceGraphic\" in2=\"BackgroundImageFix\" result=\"shape\" />\n          <feColorMatrix\n            in=\"SourceAlpha\"\n            type=\"matrix\"\n            values=\"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0\"\n            result=\"hardAlpha\"\n          />\n          <feOffset dx=\"1\" dy=\"5\" />\n          <feGaussianBlur stdDeviation=\"3\" />\n          <feComposite in2=\"hardAlpha\" operator=\"arithmetic\" k2=\"-1\" k3=\"1\" />\n          <feColorMatrix type=\"matrix\" values=\"0 0 0 0 0.137255 0 0 0 0 0.145098 0 0 0 0 0.14902 0 0 0 1 0\" />\n          <feBlend mode=\"normal\" in2=\"shape\" result=\"effect1_innerShadow_6102_2542\" />\n          <feColorMatrix\n            in=\"SourceAlpha\"\n            type=\"matrix\"\n            values=\"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0\"\n            result=\"hardAlpha\"\n          />\n          <feOffset dx=\"3\" dy=\"-5\" />\n          <feGaussianBlur stdDeviation=\"3\" />\n          <feComposite in2=\"hardAlpha\" operator=\"arithmetic\" k2=\"-1\" k3=\"1\" />\n          <feColorMatrix type=\"matrix\" values=\"0 0 0 0 0.137255 0 0 0 0 0.145098 0 0 0 0 0.14902 0 0 0 1 0\" />\n          <feBlend mode=\"normal\" in2=\"effect1_innerShadow_6102_2542\" result=\"effect2_innerShadow_6102_2542\" />\n          <feColorMatrix\n            in=\"SourceAlpha\"\n            type=\"matrix\"\n            values=\"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0\"\n            result=\"hardAlpha\"\n          />\n          <feOffset dx=\"1\" dy=\"-1\" />\n          <feGaussianBlur stdDeviation=\"0.5\" />\n          <feComposite in2=\"hardAlpha\" operator=\"arithmetic\" k2=\"-1\" k3=\"1\" />\n          <feColorMatrix type=\"matrix\" values=\"0 0 0 0 0.242217 0 0 0 0 0.247242 0 0 0 0 0.247101 0 0 0 1 0\" />\n          <feBlend mode=\"normal\" in2=\"effect2_innerShadow_6102_2542\" result=\"effect3_innerShadow_6102_2542\" />\n          <feColorMatrix\n            in=\"SourceAlpha\"\n            type=\"matrix\"\n            values=\"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0\"\n            result=\"hardAlpha\"\n          />\n          <feOffset dx=\"1\" dy=\"1\" />\n          <feGaussianBlur stdDeviation=\"0.5\" />\n          <feComposite in2=\"hardAlpha\" operator=\"arithmetic\" k2=\"-1\" k3=\"1\" />\n          <feColorMatrix type=\"matrix\" values=\"0 0 0 0 0.242217 0 0 0 0 0.247242 0 0 0 0 0.247101 0 0 0 1 0\" />\n          <feBlend mode=\"normal\" in2=\"effect3_innerShadow_6102_2542\" result=\"effect4_innerShadow_6102_2542\" />\n        </filter>\n        <clipPath id=\"clip0_6102_2542\">\n          <rect width=\"20\" height=\"120\" fill=\"white\" transform=\"matrix(0 1 -1 0 120 14)\" />\n        </clipPath>\n      </defs>\n    </svg>\n  );\n}\n\nexport function ArrowBrush() {\n  return (\n    <svg width=\"120\" height=\"48\" viewBox=\"0 0 120 48\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n      <g clip-path=\"url(#clip0_6102_2543)\">\n        <path\n          d=\"M94 24H110M110 24L104 18M110 24L104 30\"\n          stroke=\"url(#paint0_linear_6102_2543)\"\n          stroke-width=\"3\"\n          stroke-linecap=\"round\"\n          stroke-linejoin=\"round\"\n        />\n        <g filter=\"url(#filter0_iiii_6102_2543)\">\n          <path d=\"M0 15H92C94.2091 15 96 16.7909 96 19V29C96 31.2091 94.2091 33 92 33H0V15Z\" fill=\"#3E3F3F\" />\n        </g>\n        <path d=\"M92 15V15C94.2091 15 96 16.7909 96 19V29C96 31.2091 94.2091 33 92 33V33V15Z\" fill=\"currentColor\" />\n      </g>\n      <defs>\n        <filter\n          id=\"filter0_iiii_6102_2543\"\n          x=\"0\"\n          y=\"10\"\n          width=\"99\"\n          height=\"28\"\n          filterUnits=\"userSpaceOnUse\"\n          color-interpolation-filters=\"sRGB\"\n        >\n          <feFlood flood-opacity=\"0\" result=\"BackgroundImageFix\" />\n          <feBlend mode=\"normal\" in=\"SourceGraphic\" in2=\"BackgroundImageFix\" result=\"shape\" />\n          <feColorMatrix\n            in=\"SourceAlpha\"\n            type=\"matrix\"\n            values=\"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0\"\n            result=\"hardAlpha\"\n          />\n          <feOffset dx=\"1\" dy=\"5\" />\n          <feGaussianBlur stdDeviation=\"3\" />\n          <feComposite in2=\"hardAlpha\" operator=\"arithmetic\" k2=\"-1\" k3=\"1\" />\n          <feColorMatrix type=\"matrix\" values=\"0 0 0 0 0.137255 0 0 0 0 0.145098 0 0 0 0 0.14902 0 0 0 1 0\" />\n          <feBlend mode=\"normal\" in2=\"shape\" result=\"effect1_innerShadow_6102_2543\" />\n          <feColorMatrix\n            in=\"SourceAlpha\"\n            type=\"matrix\"\n            values=\"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0\"\n            result=\"hardAlpha\"\n          />\n          <feOffset dx=\"3\" dy=\"-5\" />\n          <feGaussianBlur stdDeviation=\"3\" />\n          <feComposite in2=\"hardAlpha\" operator=\"arithmetic\" k2=\"-1\" k3=\"1\" />\n          <feColorMatrix type=\"matrix\" values=\"0 0 0 0 0.137255 0 0 0 0 0.145098 0 0 0 0 0.14902 0 0 0 1 0\" />\n          <feBlend mode=\"normal\" in2=\"effect1_innerShadow_6102_2543\" result=\"effect2_innerShadow_6102_2543\" />\n          <feColorMatrix\n            in=\"SourceAlpha\"\n            type=\"matrix\"\n            values=\"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0\"\n            result=\"hardAlpha\"\n          />\n          <feOffset dx=\"1\" dy=\"-1\" />\n          <feGaussianBlur stdDeviation=\"0.5\" />\n          <feComposite in2=\"hardAlpha\" operator=\"arithmetic\" k2=\"-1\" k3=\"1\" />\n          <feColorMatrix type=\"matrix\" values=\"0 0 0 0 0.242217 0 0 0 0 0.247242 0 0 0 0 0.247101 0 0 0 1 0\" />\n          <feBlend mode=\"normal\" in2=\"effect2_innerShadow_6102_2543\" result=\"effect3_innerShadow_6102_2543\" />\n          <feColorMatrix\n            in=\"SourceAlpha\"\n            type=\"matrix\"\n            values=\"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0\"\n            result=\"hardAlpha\"\n          />\n          <feOffset dx=\"1\" dy=\"1\" />\n          <feGaussianBlur stdDeviation=\"0.5\" />\n          <feComposite in2=\"hardAlpha\" operator=\"arithmetic\" k2=\"-1\" k3=\"1\" />\n          <feColorMatrix type=\"matrix\" values=\"0 0 0 0 0.242217 0 0 0 0 0.247242 0 0 0 0 0.247101 0 0 0 1 0\" />\n          <feBlend mode=\"normal\" in2=\"effect3_innerShadow_6102_2543\" result=\"effect4_innerShadow_6102_2543\" />\n        </filter>\n        <linearGradient id=\"paint0_linear_6102_2543\" x1=\"110\" y1=\"24\" x2=\"94\" y2=\"24\" gradientUnits=\"userSpaceOnUse\">\n          <stop offset=\"0.755\" stop-color=\"currentColor\" />\n          <stop offset=\"1\" stop-color=\"currentColor\" stop-opacity=\"0\" />\n        </linearGradient>\n        <clipPath id=\"clip0_6102_2543\">\n          <rect width=\"20\" height=\"120\" fill=\"white\" transform=\"matrix(0 1 -1 0 120 14)\" />\n        </clipPath>\n      </defs>\n    </svg>\n  );\n}\n\nexport function MarkerBrush() {\n  return (\n    <svg width=\"120\" height=\"48\" viewBox=\"0 0 120 48\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n      <g clip-path=\"url(#clip0_6102_2546)\">\n        <g filter=\"url(#filter0_iiii_6102_2546)\">\n          <path\n            d=\"M0 15H82.3579C83.4414 15 84.5135 15.2201 85.5093 15.6468L91 18H101C101.552 18 102 18.4477 102 19V29C102 29.5523 101.552 30 101 30H91L85.5093 32.3532C84.5135 32.7799 83.4414 33 82.3579 33H0V15Z\"\n            fill=\"#3E3F3F\"\n          />\n        </g>\n        <rect x=\"76\" y=\"15\" width=\"4\" height=\"18\" rx=\"0.5\" fill=\"currentColor\" />\n        <path\n          d=\"M102 19H106.434C106.785 19 107.111 19.1843 107.291 19.4855L112.091 27.4855C112.491 28.152 112.011 29 111.234 29H102V19Z\"\n          fill=\"currentColor\"\n        />\n      </g>\n      <defs>\n        <filter\n          id=\"filter0_iiii_6102_2546\"\n          x=\"0\"\n          y=\"10\"\n          width=\"105\"\n          height=\"28\"\n          filterUnits=\"userSpaceOnUse\"\n          color-interpolation-filters=\"sRGB\"\n        >\n          <feFlood flood-opacity=\"0\" result=\"BackgroundImageFix\" />\n          <feBlend mode=\"normal\" in=\"SourceGraphic\" in2=\"BackgroundImageFix\" result=\"shape\" />\n          <feColorMatrix\n            in=\"SourceAlpha\"\n            type=\"matrix\"\n            values=\"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0\"\n            result=\"hardAlpha\"\n          />\n          <feOffset dx=\"1\" dy=\"5\" />\n          <feGaussianBlur stdDeviation=\"3\" />\n          <feComposite in2=\"hardAlpha\" operator=\"arithmetic\" k2=\"-1\" k3=\"1\" />\n          <feColorMatrix type=\"matrix\" values=\"0 0 0 0 0.137255 0 0 0 0 0.145098 0 0 0 0 0.14902 0 0 0 1 0\" />\n          <feBlend mode=\"normal\" in2=\"shape\" result=\"effect1_innerShadow_6102_2546\" />\n          <feColorMatrix\n            in=\"SourceAlpha\"\n            type=\"matrix\"\n            values=\"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0\"\n            result=\"hardAlpha\"\n          />\n          <feOffset dx=\"3\" dy=\"-5\" />\n          <feGaussianBlur stdDeviation=\"3\" />\n          <feComposite in2=\"hardAlpha\" operator=\"arithmetic\" k2=\"-1\" k3=\"1\" />\n          <feColorMatrix type=\"matrix\" values=\"0 0 0 0 0.137255 0 0 0 0 0.145098 0 0 0 0 0.14902 0 0 0 1 0\" />\n          <feBlend mode=\"normal\" in2=\"effect1_innerShadow_6102_2546\" result=\"effect2_innerShadow_6102_2546\" />\n          <feColorMatrix\n            in=\"SourceAlpha\"\n            type=\"matrix\"\n            values=\"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0\"\n            result=\"hardAlpha\"\n          />\n          <feOffset dx=\"1\" dy=\"-1\" />\n          <feGaussianBlur stdDeviation=\"0.5\" />\n          <feComposite in2=\"hardAlpha\" operator=\"arithmetic\" k2=\"-1\" k3=\"1\" />\n          <feColorMatrix type=\"matrix\" values=\"0 0 0 0 0.242217 0 0 0 0 0.247242 0 0 0 0 0.247101 0 0 0 1 0\" />\n          <feBlend mode=\"normal\" in2=\"effect2_innerShadow_6102_2546\" result=\"effect3_innerShadow_6102_2546\" />\n          <feColorMatrix\n            in=\"SourceAlpha\"\n            type=\"matrix\"\n            values=\"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0\"\n            result=\"hardAlpha\"\n          />\n          <feOffset dx=\"1\" dy=\"1\" />\n          <feGaussianBlur stdDeviation=\"0.5\" />\n          <feComposite in2=\"hardAlpha\" operator=\"arithmetic\" k2=\"-1\" k3=\"1\" />\n          <feColorMatrix type=\"matrix\" values=\"0 0 0 0 0.242217 0 0 0 0 0.247242 0 0 0 0 0.247101 0 0 0 1 0\" />\n          <feBlend mode=\"normal\" in2=\"effect3_innerShadow_6102_2546\" result=\"effect4_innerShadow_6102_2546\" />\n        </filter>\n        <clipPath id=\"clip0_6102_2546\">\n          <rect width=\"20\" height=\"120\" fill=\"white\" transform=\"matrix(0 1 -1 0 120 14)\" />\n        </clipPath>\n      </defs>\n    </svg>\n  );\n}\n\nexport function NeonBrush() {\n  return (\n    <svg width=\"120\" height=\"48\" viewBox=\"0 0 120 48\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n      <g clip-path=\"url(#clip0_6102_2547)\">\n        <g filter=\"url(#filter0_f_6102_2547)\">\n          <path\n            d=\"M102 19H107.146C108.282 19 109.323 19.6487 109.601 20.7506C109.813 21.593 110 22.703 110 24C110 25.297 109.813 26.407 109.601 27.2494C109.323 28.3513 108.282 29 107.146 29H102V19Z\"\n            fill=\"currentColor\"\n          />\n        </g>\n        <g filter=\"url(#filter1_f_6102_2547)\">\n          <path\n            d=\"M102 19H107.146C108.282 19 109.323 19.6487 109.601 20.7506C109.813 21.593 110 22.703 110 24C110 25.297 109.813 26.407 109.601 27.2494C109.323 28.3513 108.282 29 107.146 29H102V19Z\"\n            fill=\"currentColor\"\n          />\n        </g>\n        <g filter=\"url(#filter2_f_6102_2547)\">\n          <path\n            d=\"M102 19H107.146C108.282 19 109.323 19.6487 109.601 20.7506C109.813 21.593 110 22.703 110 24C110 25.297 109.813 26.407 109.601 27.2494C109.323 28.3513 108.282 29 107.146 29H102V19Z\"\n            fill=\"currentColor\"\n          />\n        </g>\n        <g filter=\"url(#filter3_iiii_6102_2547)\">\n          <path\n            d=\"M0 15H82.3579C83.4414 15 84.5135 15.2201 85.5093 15.6468L91 18H101C101.552 18 102 18.4477 102 19V29C102 29.5523 101.552 30 101 30H91L85.5093 32.3532C84.5135 32.7799 83.4414 33 82.3579 33H0V15Z\"\n            fill=\"#3E3F3F\"\n          />\n        </g>\n        <rect x=\"76\" y=\"15\" width=\"4\" height=\"18\" rx=\"0.5\" fill=\"currentCOlor\" />\n        <path\n          d=\"M102 19H107.146C108.282 19 109.323 19.6487 109.601 20.7506C109.813 21.593 110 22.703 110 24C110 25.297 109.813 26.407 109.601 27.2494C109.323 28.3513 108.282 29 107.146 29H102V19Z\"\n          fill=\"currentCOlor\"\n        />\n      </g>\n      <defs>\n        <filter\n          id=\"filter0_f_6102_2547\"\n          x=\"96\"\n          y=\"13\"\n          width=\"20\"\n          height=\"22\"\n          filterUnits=\"userSpaceOnUse\"\n          color-interpolation-filters=\"sRGB\"\n        >\n          <feFlood flood-opacity=\"0\" result=\"BackgroundImageFix\" />\n          <feBlend mode=\"normal\" in=\"SourceGraphic\" in2=\"BackgroundImageFix\" result=\"shape\" />\n          <feGaussianBlur stdDeviation=\"3\" result=\"effect1_foregroundBlur_6102_2547\" />\n        </filter>\n        <filter\n          id=\"filter1_f_6102_2547\"\n          x=\"96\"\n          y=\"13\"\n          width=\"20\"\n          height=\"22\"\n          filterUnits=\"userSpaceOnUse\"\n          color-interpolation-filters=\"sRGB\"\n        >\n          <feFlood flood-opacity=\"0\" result=\"BackgroundImageFix\" />\n          <feBlend mode=\"normal\" in=\"SourceGraphic\" in2=\"BackgroundImageFix\" result=\"shape\" />\n          <feGaussianBlur stdDeviation=\"3\" result=\"effect1_foregroundBlur_6102_2547\" />\n        </filter>\n        <filter\n          id=\"filter2_f_6102_2547\"\n          x=\"96\"\n          y=\"13\"\n          width=\"20\"\n          height=\"22\"\n          filterUnits=\"userSpaceOnUse\"\n          color-interpolation-filters=\"sRGB\"\n        >\n          <feFlood flood-opacity=\"0\" result=\"BackgroundImageFix\" />\n          <feBlend mode=\"normal\" in=\"SourceGraphic\" in2=\"BackgroundImageFix\" result=\"shape\" />\n          <feGaussianBlur stdDeviation=\"3\" result=\"effect1_foregroundBlur_6102_2547\" />\n        </filter>\n        <filter\n          id=\"filter3_iiii_6102_2547\"\n          x=\"0\"\n          y=\"10\"\n          width=\"105\"\n          height=\"28\"\n          filterUnits=\"userSpaceOnUse\"\n          color-interpolation-filters=\"sRGB\"\n        >\n          <feFlood flood-opacity=\"0\" result=\"BackgroundImageFix\" />\n          <feBlend mode=\"normal\" in=\"SourceGraphic\" in2=\"BackgroundImageFix\" result=\"shape\" />\n          <feColorMatrix\n            in=\"SourceAlpha\"\n            type=\"matrix\"\n            values=\"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0\"\n            result=\"hardAlpha\"\n          />\n          <feOffset dx=\"1\" dy=\"5\" />\n          <feGaussianBlur stdDeviation=\"3\" />\n          <feComposite in2=\"hardAlpha\" operator=\"arithmetic\" k2=\"-1\" k3=\"1\" />\n          <feColorMatrix type=\"matrix\" values=\"0 0 0 0 0.137255 0 0 0 0 0.145098 0 0 0 0 0.14902 0 0 0 1 0\" />\n          <feBlend mode=\"normal\" in2=\"shape\" result=\"effect1_innerShadow_6102_2547\" />\n          <feColorMatrix\n            in=\"SourceAlpha\"\n            type=\"matrix\"\n            values=\"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0\"\n            result=\"hardAlpha\"\n          />\n          <feOffset dx=\"3\" dy=\"-5\" />\n          <feGaussianBlur stdDeviation=\"3\" />\n          <feComposite in2=\"hardAlpha\" operator=\"arithmetic\" k2=\"-1\" k3=\"1\" />\n          <feColorMatrix type=\"matrix\" values=\"0 0 0 0 0.137255 0 0 0 0 0.145098 0 0 0 0 0.14902 0 0 0 1 0\" />\n          <feBlend mode=\"normal\" in2=\"effect1_innerShadow_6102_2547\" result=\"effect2_innerShadow_6102_2547\" />\n          <feColorMatrix\n            in=\"SourceAlpha\"\n            type=\"matrix\"\n            values=\"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0\"\n            result=\"hardAlpha\"\n          />\n          <feOffset dx=\"1\" dy=\"-1\" />\n          <feGaussianBlur stdDeviation=\"0.5\" />\n          <feComposite in2=\"hardAlpha\" operator=\"arithmetic\" k2=\"-1\" k3=\"1\" />\n          <feColorMatrix type=\"matrix\" values=\"0 0 0 0 0.242217 0 0 0 0 0.247242 0 0 0 0 0.247101 0 0 0 1 0\" />\n          <feBlend mode=\"normal\" in2=\"effect2_innerShadow_6102_2547\" result=\"effect3_innerShadow_6102_2547\" />\n          <feColorMatrix\n            in=\"SourceAlpha\"\n            type=\"matrix\"\n            values=\"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0\"\n            result=\"hardAlpha\"\n          />\n          <feOffset dx=\"1\" dy=\"1\" />\n          <feGaussianBlur stdDeviation=\"0.5\" />\n          <feComposite in2=\"hardAlpha\" operator=\"arithmetic\" k2=\"-1\" k3=\"1\" />\n          <feColorMatrix type=\"matrix\" values=\"0 0 0 0 0.242217 0 0 0 0 0.247242 0 0 0 0 0.247101 0 0 0 1 0\" />\n          <feBlend mode=\"normal\" in2=\"effect3_innerShadow_6102_2547\" result=\"effect4_innerShadow_6102_2547\" />\n        </filter>\n        <clipPath id=\"clip0_6102_2547\">\n          <rect width=\"20\" height=\"120\" fill=\"white\" transform=\"matrix(0 1 -1 0 120 14)\" />\n        </clipPath>\n      </defs>\n    </svg>\n  );\n}\n\nexport function EraserBrush() {\n  return (\n    <svg width=\"120\" height=\"48\" viewBox=\"0 0 120 48\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n      <g clip-path=\"url(#clip0_6102_2544)\">\n        <g filter=\"url(#filter0_i_6102_2544)\">\n          <path d=\"M95 15H108C110.209 15 112 16.7909 112 19V29C112 31.2091 110.209 33 108 33H95V15Z\" fill=\"#D9D9D9\" />\n          <path d=\"M95 15H108C110.209 15 112 16.7909 112 19V29C112 31.2091 110.209 33 108 33H95V15Z\" fill=\"#F09B99\" />\n        </g>\n        <g filter=\"url(#filter1_iiii_6102_2544)\">\n          <path\n            d=\"M0 15H77.6464C77.8728 15 78.0899 14.9101 78.25 14.75V14.75C78.4101 14.5899 78.6272 14.5 78.8536 14.5H96C97.1046 14.5 98 15.3954 98 16.5V31.5C98 32.6046 97.1046 33.5 96 33.5H78.8536C78.6272 33.5 78.4101 33.4101 78.25 33.25V33.25C78.0899 33.0899 77.8728 33 77.6464 33H0V15Z\"\n            fill=\"#3E3F3F\"\n          />\n        </g>\n        <path d=\"M79 33.5V14.5H78V33.5H79Z\" fill=\"black\" fill-opacity=\"0.33\" />\n      </g>\n      <defs>\n        <filter\n          id=\"filter0_i_6102_2544\"\n          x=\"95\"\n          y=\"13\"\n          width=\"19\"\n          height=\"20\"\n          filterUnits=\"userSpaceOnUse\"\n          color-interpolation-filters=\"sRGB\"\n        >\n          <feFlood flood-opacity=\"0\" result=\"BackgroundImageFix\" />\n          <feBlend mode=\"normal\" in=\"SourceGraphic\" in2=\"BackgroundImageFix\" result=\"shape\" />\n          <feColorMatrix\n            in=\"SourceAlpha\"\n            type=\"matrix\"\n            values=\"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0\"\n            result=\"hardAlpha\"\n          />\n          <feOffset dx=\"2\" dy=\"-2\" />\n          <feGaussianBlur stdDeviation=\"2\" />\n          <feComposite in2=\"hardAlpha\" operator=\"arithmetic\" k2=\"-1\" k3=\"1\" />\n          <feColorMatrix type=\"matrix\" values=\"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.33 0\" />\n          <feBlend mode=\"normal\" in2=\"shape\" result=\"effect1_innerShadow_6102_2544\" />\n        </filter>\n        <filter\n          id=\"filter1_iiii_6102_2544\"\n          x=\"0\"\n          y=\"9.5\"\n          width=\"101\"\n          height=\"29\"\n          filterUnits=\"userSpaceOnUse\"\n          color-interpolation-filters=\"sRGB\"\n        >\n          <feFlood flood-opacity=\"0\" result=\"BackgroundImageFix\" />\n          <feBlend mode=\"normal\" in=\"SourceGraphic\" in2=\"BackgroundImageFix\" result=\"shape\" />\n          <feColorMatrix\n            in=\"SourceAlpha\"\n            type=\"matrix\"\n            values=\"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0\"\n            result=\"hardAlpha\"\n          />\n          <feOffset dx=\"1\" dy=\"5\" />\n          <feGaussianBlur stdDeviation=\"3\" />\n          <feComposite in2=\"hardAlpha\" operator=\"arithmetic\" k2=\"-1\" k3=\"1\" />\n          <feColorMatrix type=\"matrix\" values=\"0 0 0 0 0.137255 0 0 0 0 0.145098 0 0 0 0 0.14902 0 0 0 1 0\" />\n          <feBlend mode=\"normal\" in2=\"shape\" result=\"effect1_innerShadow_6102_2544\" />\n          <feColorMatrix\n            in=\"SourceAlpha\"\n            type=\"matrix\"\n            values=\"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0\"\n            result=\"hardAlpha\"\n          />\n          <feOffset dx=\"3\" dy=\"-5\" />\n          <feGaussianBlur stdDeviation=\"3\" />\n          <feComposite in2=\"hardAlpha\" operator=\"arithmetic\" k2=\"-1\" k3=\"1\" />\n          <feColorMatrix type=\"matrix\" values=\"0 0 0 0 0.137255 0 0 0 0 0.145098 0 0 0 0 0.14902 0 0 0 1 0\" />\n          <feBlend mode=\"normal\" in2=\"effect1_innerShadow_6102_2544\" result=\"effect2_innerShadow_6102_2544\" />\n          <feColorMatrix\n            in=\"SourceAlpha\"\n            type=\"matrix\"\n            values=\"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0\"\n            result=\"hardAlpha\"\n          />\n          <feOffset dx=\"1\" dy=\"-1\" />\n          <feGaussianBlur stdDeviation=\"0.5\" />\n          <feComposite in2=\"hardAlpha\" operator=\"arithmetic\" k2=\"-1\" k3=\"1\" />\n          <feColorMatrix type=\"matrix\" values=\"0 0 0 0 0.242217 0 0 0 0 0.247242 0 0 0 0 0.247101 0 0 0 1 0\" />\n          <feBlend mode=\"normal\" in2=\"effect2_innerShadow_6102_2544\" result=\"effect3_innerShadow_6102_2544\" />\n          <feColorMatrix\n            in=\"SourceAlpha\"\n            type=\"matrix\"\n            values=\"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0\"\n            result=\"hardAlpha\"\n          />\n          <feOffset dx=\"1\" dy=\"1\" />\n          <feGaussianBlur stdDeviation=\"0.5\" />\n          <feComposite in2=\"hardAlpha\" operator=\"arithmetic\" k2=\"-1\" k3=\"1\" />\n          <feColorMatrix type=\"matrix\" values=\"0 0 0 0 0.242217 0 0 0 0 0.247242 0 0 0 0 0.247101 0 0 0 1 0\" />\n          <feBlend mode=\"normal\" in2=\"effect3_innerShadow_6102_2544\" result=\"effect4_innerShadow_6102_2544\" />\n        </filter>\n        <clipPath id=\"clip0_6102_2544\">\n          <rect width=\"20\" height=\"120\" fill=\"white\" transform=\"matrix(0 1 -1 0 120 14)\" />\n        </clipPath>\n      </defs>\n    </svg>\n  );\n}\n\nexport function BlurBrush() {\n  return (\n    <svg width=\"120\" height=\"48\" viewBox=\"0 0 120 48\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n      <g clip-path=\"url(#clip0_6102_2545)\">\n        <image href=\"assets/img/media-editor-blurred-color-wheel.png\" x=\"91\" y=\"12\" width=\"26\" height=\"24\" />\n        <image href=\"assets/img/media-editor-blurred-color-wheel.png\" x=\"91\" y=\"12\" width=\"26\" height=\"24\" />\n        <g filter=\"url(#filter3_iiii_6102_2545)\">\n          <path\n            d=\"M-2 15H75.441C75.7836 15 76.0968 15.1936 76.25 15.5V15.5C76.4032 15.8064 76.7164 16 77.059 16H92.941C93.2836 16 93.5968 15.8064 93.75 15.5V15.5C93.9032 15.1936 94.2164 15 94.559 15H98C99.1046 15 100 15.8954 100 17V31C100 32.1046 99.1046 33 98 33H94.559C94.2164 33 93.9032 32.8064 93.75 32.5V32.5C93.5968 32.1936 93.2836 32 92.941 32H77.059C76.7164 32 76.4032 32.1936 76.25 32.5V32.5C76.0968 32.8064 75.7836 33 75.441 33H-2V15Z\"\n            fill=\"#3E3F3F\"\n          />\n        </g>\n        <mask\n          id=\"mask0_6102_2545\"\n          style=\"mask-type:alpha\"\n          maskUnits=\"userSpaceOnUse\"\n          x=\"0\"\n          y=\"15\"\n          width=\"100\"\n          height=\"18\"\n        >\n          <path\n            d=\"M0 15H75.441C75.7836 15 76.0968 15.1936 76.25 15.5V15.5C76.4032 15.8064 76.7164 16 77.059 16H92.941C93.2836 16 93.5968 15.8064 93.75 15.5V15.5C93.9032 15.1936 94.2164 15 94.559 15H98C99.1046 15 100 15.8954 100 17V31C100 32.1046 99.1046 33 98 33H94.559C94.2164 33 93.9032 32.8064 93.75 32.5V32.5C93.5968 32.1936 93.2836 32 92.941 32H77.059C76.7164 32 76.4032 32.1936 76.25 32.5V32.5C76.0968 32.8064 75.7836 33 75.441 33H0V15Z\"\n            fill=\"#3E3F3F\"\n          />\n        </mask>\n        <image\n          opacity=\"1\"\n          href=\"assets/img/media-editor-blurred-color-wheel.png\"\n          x=\"91\"\n          y=\"12\"\n          width=\"26\"\n          height=\"24\"\n        />\n      </g>\n      <defs>\n        <filter\n          id=\"filter3_iiii_6102_2545\"\n          x=\"-2\"\n          y=\"10\"\n          width=\"105\"\n          height=\"28\"\n          filterUnits=\"userSpaceOnUse\"\n          color-interpolation-filters=\"sRGB\"\n        >\n          <feFlood flood-opacity=\"0\" result=\"BackgroundImageFix\" />\n          <feBlend mode=\"normal\" in=\"SourceGraphic\" in2=\"BackgroundImageFix\" result=\"shape\" />\n          <feColorMatrix\n            in=\"SourceAlpha\"\n            type=\"matrix\"\n            values=\"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0\"\n            result=\"hardAlpha\"\n          />\n          <feOffset dx=\"1\" dy=\"5\" />\n          <feGaussianBlur stdDeviation=\"3\" />\n          <feComposite in2=\"hardAlpha\" operator=\"arithmetic\" k2=\"-1\" k3=\"1\" />\n          <feColorMatrix type=\"matrix\" values=\"0 0 0 0 0.137255 0 0 0 0 0.145098 0 0 0 0 0.14902 0 0 0 1 0\" />\n          <feBlend mode=\"normal\" in2=\"shape\" result=\"effect1_innerShadow_6102_2545\" />\n          <feColorMatrix\n            in=\"SourceAlpha\"\n            type=\"matrix\"\n            values=\"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0\"\n            result=\"hardAlpha\"\n          />\n          <feOffset dx=\"3\" dy=\"-5\" />\n          <feGaussianBlur stdDeviation=\"3\" />\n          <feComposite in2=\"hardAlpha\" operator=\"arithmetic\" k2=\"-1\" k3=\"1\" />\n          <feColorMatrix type=\"matrix\" values=\"0 0 0 0 0.137255 0 0 0 0 0.145098 0 0 0 0 0.14902 0 0 0 1 0\" />\n          <feBlend mode=\"normal\" in2=\"effect1_innerShadow_6102_2545\" result=\"effect2_innerShadow_6102_2545\" />\n          <feColorMatrix\n            in=\"SourceAlpha\"\n            type=\"matrix\"\n            values=\"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0\"\n            result=\"hardAlpha\"\n          />\n          <feOffset dx=\"1\" dy=\"-1\" />\n          <feGaussianBlur stdDeviation=\"0.5\" />\n          <feComposite in2=\"hardAlpha\" operator=\"arithmetic\" k2=\"-1\" k3=\"1\" />\n          <feColorMatrix type=\"matrix\" values=\"0 0 0 0 0.242217 0 0 0 0 0.247242 0 0 0 0 0.247101 0 0 0 1 0\" />\n          <feBlend mode=\"normal\" in2=\"effect2_innerShadow_6102_2545\" result=\"effect3_innerShadow_6102_2545\" />\n          <feColorMatrix\n            in=\"SourceAlpha\"\n            type=\"matrix\"\n            values=\"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0\"\n            result=\"hardAlpha\"\n          />\n          <feOffset dx=\"1\" dy=\"1\" />\n          <feGaussianBlur stdDeviation=\"0.5\" />\n          <feComposite in2=\"hardAlpha\" operator=\"arithmetic\" k2=\"-1\" k3=\"1\" />\n          <feColorMatrix type=\"matrix\" values=\"0 0 0 0 0.242217 0 0 0 0 0.247242 0 0 0 0 0.247101 0 0 0 1 0\" />\n          <feBlend mode=\"normal\" in2=\"effect3_innerShadow_6102_2545\" result=\"effect4_innerShadow_6102_2545\" />\n        </filter>\n        <clipPath id=\"clip0_6102_2545\">\n          <rect width=\"120\" height=\"48\" fill=\"white\" />\n        </clipPath>\n      </defs>\n    </svg>\n  );\n}\n","import {createEffect, createMemo, createSignal, on, onCleanup, onMount} from 'solid-js';\n\nimport {doubleRaf} from '@helpers/schedulers';\nimport {hexToRgb} from '@helpers/color';\nimport _ColorPicker from '@components/colorPicker';\nimport ripple from '@components/ripple';\n\nimport {useMediaEditorContext} from '@components/mediaEditor/context';\nimport {delay} from '@components/mediaEditor/utils';\n\n\nexport const colorPickerSwatches = [\n  '#ffffff',\n  '#fe4438',\n  '#ff8901',\n  '#ffd60a',\n  '#33c759',\n  '#62e5e0',\n  '#0a84ff',\n  '#bd5cf3'\n];\n\nconst PICKER_WIDTH_PX = 200;\nconst PICKER_HEIGHT_PX = 120;\nconst SLIDER_WIDTH_PX = 304;\nconst DEFAULT_SIZE_PX = 384;\n\n\nexport default function ColorPicker(props: {\n  value: string;\n  onChange: (value: string) => void;\n  colorKey?: string; // Just for reaction, not used to access anything\n  previousColor?: string;\n}) {\n  const {actions} = useMediaEditorContext();\n\n  const [collapsed, setCollapsed] = createSignal(colorPickerSwatches.includes(props.value));\n  const [collapsing, setCollapsing] = createSignal(false);\n\n  const [containerSize, setContainerSize] = createSignal(DEFAULT_SIZE_PX);\n\n  let sizeContainer: HTMLDivElement;\n\n  const swatch = (hexColor: string, i: number) => (\n    <div\n      class=\"media-editor__color-picker-swatch\"\n      classList={{'media-editor__color-picker-swatch--active': props.value === hexColor && collapsed()}}\n      style={{\n        '--color-rgb': hexToRgb(hexColor).join(' '),\n        '--i': i\n      }}\n      onClick={() => props.onChange(hexColor)}\n    >\n      <div class=\"media-editor__color-picker-swatch-color\" />\n    </div>\n  );\n\n  const onCollapseToggle = async() => {\n    setCollapsed((prev) => !prev);\n    if(collapsed()) {\n      setCollapsing(true);\n      props.onChange(props.previousColor || colorPickerSwatches[0]);\n      await delay(200);\n      setCollapsing(false);\n    }\n  };\n\n  // let colorPicker: _ColorPicker;\n\n  const colorPicker = createMemo(\n    on(containerSize, () => {\n      const colorPicker = new _ColorPicker({\n        buildLayout: (parts) => {\n          return (\n            <div\n              class=\"media-editor__color-picker\"\n              classList={{'media-editor__color-picker--collapsed': collapsed()}}\n              style={{'--picker-height': PICKER_HEIGHT_PX + 'px'}}\n            >\n              <div class=\"media-editor__color-picker-swatches\">\n                {colorPickerSwatches.map(swatch)}\n                <div\n                  class=\"media-editor__color-picker-swatch media-editor__color-picker-swatch--gradient\"\n                  classList={{'media-editor__color-picker-swatch--active': !collapsed()}}\n                  onClick={onCollapseToggle}\n                >\n                  <div class=\"media-editor__color-picker-swatch-color\" />\n                </div>\n\n                <div class=\"media-editor__color-picker-slider\">{parts.slider}</div>\n              </div>\n\n              <div class=\"media-editor__color-picker-layout-wrapper\">\n                <div class=\"media-editor__color-picker-layout\">\n                  <div class=\"media-editor__color-picker-box\">{parts.pickerBox}</div>\n                  <div class=\"media-editor__color-picker-inputs\">\n                    {parts.hexInput}\n                    {parts.rgbInput}\n                  </div>\n                </div>\n              </div>\n            </div>\n          ) as HTMLDivElement;\n        },\n        pickerBoxWidth: PICKER_WIDTH_PX + containerSize() - DEFAULT_SIZE_PX,\n        pickerBoxHeight: PICKER_HEIGHT_PX,\n        sliderWidth: SLIDER_WIDTH_PX + containerSize() - DEFAULT_SIZE_PX,\n        thickSlider: true\n      });\n      colorPicker.onChange = (color) => {\n        if(color.hex !== props.value) props.onChange(color.hex);\n        actions.abortDrawerSlide();\n      };\n      colorPicker.container.querySelectorAll('.media-editor__color-picker-swatch').forEach((element) => {\n        ripple(element as HTMLElement);\n      });\n\n      return colorPicker;\n    })\n  );\n\n  onMount(() => {\n    setContainerSize(sizeContainer.clientWidth);\n\n    const observer = new ResizeObserver(() => {\n      setContainerSize(sizeContainer.clientWidth);\n    });\n\n    observer.observe(sizeContainer);\n\n    onCleanup(() => {\n      observer.disconnect();\n    });\n  });\n\n  createEffect(\n    on(\n      () => props.colorKey,\n      async() => {\n        await delay(0);\n        const newCollapsed = colorPickerSwatches.includes(props.value);\n        if(newCollapsed !== collapsed()) {\n          setCollapsed(newCollapsed);\n          if(newCollapsed) {\n            setCollapsing(true);\n            delay(200).then(() => setCollapsing(false));\n          }\n        }\n      }\n    )\n  );\n\n  createEffect(\n    on(\n      () => [collapsing(), colorPicker(), props.value],\n      async() => {\n        await doubleRaf();\n        if(!collapsing() && props.value !== colorPicker().getCurrentColor().hex) {\n          colorPicker().setColor(props.value);\n        }\n      }\n    )\n  );\n\n  return <div ref={sizeContainer}>{colorPicker().container}</div>;\n}\n","import {createSignal} from 'solid-js';\n\nimport {colorPickerSwatches} from '@components/mediaEditor/colorPicker';\n\nexport function createStoredColor(key: string, defaultColor: string) {\n  // (1 - use swatch, 2 - use picker color), (color from swatch), (color from picker)\n  type SavedColor = [1 | 2, string, string];\n\n  const [savedColor, setSavedColor] = createSignal<SavedColor>(\n    (() => {\n      const fallback = () => {\n        const value = [colorPickerSwatches.includes(defaultColor) ? 1 : 2, defaultColor, defaultColor] as SavedColor;\n        localStorage.setItem(key, JSON.stringify(value));\n        return value;\n      };\n      try {\n        const value: SavedColor = JSON.parse(localStorage.getItem(key));\n        if(\n          !(value instanceof Array) ||\n          typeof value[0] !== 'number' ||\n          typeof value[1] !== 'string' ||\n          typeof value[2] !== 'string'\n        ) {\n          return fallback();\n        }\n        return value;\n      } catch{}\n      return fallback();\n    })()\n  );\n\n  function setColor(color: string) {\n    let value: SavedColor;\n    if(colorPickerSwatches.includes(color)) {\n      value = [1, color, color];\n    } else {\n      value = [2, savedColor()[1], color];\n    }\n    setSavedColor(value);\n    localStorage.setItem(key, JSON.stringify(value));\n  }\n\n  return [\n    () => ({\n      value: savedColor()[savedColor()[0]],\n      previous: savedColor()[1]\n    }),\n    setColor\n  ] as const;\n}\n","import {JSX, onMount} from 'solid-js';\n\nimport ripple from '@components/ripple';\n\nexport type MediaEditorLargeButtonProps = JSX.HTMLAttributes<HTMLDivElement> & {\n  active?: boolean;\n};\n\nexport default function LargeButton(props: MediaEditorLargeButtonProps) {\n  let element: HTMLDivElement;\n\n  onMount(() => {\n    ripple(element);\n  });\n\n  return (\n    <div\n      {...props}\n      ref={element}\n      class=\"media-editor__large-button\"\n      classList={{\n        'media-editor__large-button--active': props.active,\n        [props.class]: !!props.class\n      }}\n    />\n  );\n}\n","import {createEffect, JSX} from 'solid-js';\n\nimport {i18n} from '@lib/langPack';\n\nimport Space from '@components/space';\n\nimport {ArrowBrush, BlurBrush, EraserBrush, MarkerBrush, NeonBrush, PenBrush} from '@components/mediaEditor/brushesSvg';\nimport {createStoredColor} from '@components/mediaEditor/createStoredColor';\nimport {useMediaEditorContext} from '@components/mediaEditor/context';\nimport ColorPicker from '@components/mediaEditor/colorPicker';\nimport LargeButton from '@components/mediaEditor/largeButton';\nimport RangeInput from '@components/mediaEditor/rangeInput';\n\nexport default function BrushTab() {\n  const {editorState, mediaType} = useMediaEditorContext();\n\n  const savedBrushColors = {\n    pen: createStoredColor('media-editor-pen-color', '#fe4438'),\n    arrow: createStoredColor('media-editor-arrow-color', '#ffd60a'),\n    brush: createStoredColor('media-editor-brush-color', '#ff8901'),\n    neon: createStoredColor('media-editor-neon-color', '#62e5e0')\n  };\n\n  function savedBrushSignal(brush: string) {\n    return savedBrushColors[brush as keyof typeof savedBrushColors];\n  }\n\n  function updateCurrentBrush() {\n    const [savedColor] = savedBrushSignal(editorState.currentBrush.brush) || [];\n    if(!savedColor || editorState.currentBrush.color === savedColor().value) return;\n\n    editorState.currentBrush.color = savedColor().value;\n  }\n\n  updateCurrentBrush(); // Change the brush before the ColorPicker is rendered\n  createEffect(() => {\n    updateCurrentBrush();\n  });\n\n  function setColor(color: string) {\n    const brush = editorState.currentBrush.brush;\n    const [, setSavedColor] = savedBrushSignal(brush) || [];\n    setSavedColor?.(color);\n  }\n\n  const brushButton = (text: JSX.Element, brushSvg: JSX.Element, brush: string) => (\n    <LargeButton\n      active={editorState.currentBrush.brush === brush}\n      onClick={() => void (editorState.currentBrush.brush = brush)}\n      class={`media-editor__brush-button`}\n    >\n      <div\n        class=\"media-editor__brush-button-svg-wrapper\"\n        style={{\n          color: savedBrushSignal(brush)?.[0]().value\n        }}\n      >\n        {brushSvg}\n      </div>\n      {text}\n    </LargeButton>\n  );\n\n  const hasColor = () => editorState.currentBrush.brush in savedBrushColors;\n\n  let timeoutId = 0;\n  function removeSizePreview() {\n    window.clearTimeout(timeoutId);\n    timeoutId = window.setTimeout(() => {\n      editorState.previewBrushSize = undefined;\n    }, 1000);\n  }\n\n  return (\n    <>\n      <div\n        style={{\n          transition: 'opacity .2s',\n          ...(!hasColor() ?\n            {\n              'opacity': 0.25,\n              'pointer-events': 'none'\n            } :\n            undefined\n          )\n        }\n        }\n      >\n        <ColorPicker\n          value={editorState.currentBrush.color}\n          onChange={setColor}\n          colorKey={editorState.currentBrush.brush}\n          previousColor={savedBrushSignal(editorState.currentBrush.brush)?.[0]().previous}\n        />\n      </div>\n      <Space amount=\"16px\" />\n      <RangeInput\n        label={i18n('MediaEditor.Size')}\n        min={2}\n        max={32}\n        value={editorState.currentBrush.size}\n        onChange={(size) => {\n          editorState.currentBrush.size = size;\n          editorState.previewBrushSize = size;\n          removeSizePreview();\n        }}\n        onChangeFinish={() => {\n          editorState.previewBrushSize = undefined;\n        }}\n        passiveLabel\n        color={hasColor() ? editorState.currentBrush.color : undefined}\n      />\n      <Space amount=\"16px\" />\n      <div class=\"media-editor__label\">{i18n('MediaEditor.Tool')}</div>\n      {brushButton(i18n('MediaEditor.Brushes.Pen'), <PenBrush />, 'pen')}\n      {brushButton(i18n('MediaEditor.Brushes.Arrow'), <ArrowBrush />, 'arrow')}\n      {brushButton(i18n('MediaEditor.Brushes.Brush'), <MarkerBrush />, 'brush')}\n      {brushButton(i18n('MediaEditor.Brushes.Neon'), <NeonBrush />, 'neon')}\n      {mediaType === 'image' && brushButton(i18n('MediaEditor.Brushes.Blur'), <BlurBrush />, 'blur')}\n      {brushButton(i18n('MediaEditor.Brushes.Eraser'), <EraserBrush />, 'eraser')}\n    </>\n  );\n}\n","import {JSX, splitProps} from 'solid-js';\n\nimport {i18n} from '@lib/langPack';\nimport {IconTsx} from '@components/iconTsx';\n\nimport {animateToNewRotationOrRatio} from '@components/mediaEditor/canvas/animateToNewRotationOrRatio';\nimport LargeButton, {MediaEditorLargeButtonProps} from '@components/mediaEditor/largeButton';\nimport {useMediaEditorContext} from '@components/mediaEditor/context';\nimport {withCurrentOwner} from '@components/mediaEditor/utils';\n\nconst ratioRects = {\n  '1x1': () => <rect x=\"4\" y=\"4\" width=\"16\" height=\"16\" rx=\"2\" stroke=\"white\" stroke-width=\"1.66\" />,\n  '3x2': () => <rect x=\"3\" y=\"6\" width=\"18\" height=\"12\" rx=\"2\" stroke=\"white\" stroke-width=\"1.66\" />,\n  '4x3': () => <rect x=\"3\" y=\"5\" width=\"18\" height=\"14\" rx=\"2\" stroke=\"white\" stroke-width=\"1.66\" />,\n  '5x4': () => <rect x=\"3\" y=\"4.5\" width=\"18\" height=\"15\" rx=\"2\" stroke=\"white\" stroke-width=\"1.66\" />,\n  '7x5': () => <rect x=\"3\" y=\"4\" width=\"18\" height=\"16\" rx=\"2\" stroke=\"white\" stroke-width=\"1.66\" />,\n  '16x9': () => <rect x=\"2.5\" y=\"6.5\" width=\"19\" height=\"11\" rx=\"2\" stroke=\"white\" stroke-width=\"1.66\" />\n};\n\nconst ratioIcon = (ratio: keyof typeof ratioRects, rotated?: boolean) => (\n  <svg\n    classList={{'media-editor__crop-item-icon--rotated': rotated}}\n    width=\"24\"\n    height=\"24\"\n    viewBox=\"0 0 24 24\"\n    fill=\"none\"\n    xmlns=\"http://www.w3.org/2000/svg\"\n  >\n    {ratioRects[ratio]()}\n  </svg>\n);\n\nfunction Item(\n  inProps: MediaEditorLargeButtonProps & {\n    icon: JSX.Element;\n    text: JSX.Element;\n  }\n) {\n  const [props, buttonProps] = splitProps(inProps, ['icon', 'text']);\n\n  return (\n    <LargeButton {...buttonProps} class=\"media-editor__crop-item\">\n      {props.icon}\n      {props.text}\n    </LargeButton>\n  );\n}\n\nexport default function CropTab() {\n  const {editorState, mediaState, actions} = useMediaEditorContext();\n\n  const isActive = (what?: string) => editorState.fixedImageRatioKey === what;\n\n  const onRatioClick = withCurrentOwner((ratio?: string) => {\n    editorState.fixedImageRatioKey = ratio;\n    animateToNewRotationOrRatio(mediaState.rotation);\n    actions.resetRotationWheel();\n  });\n\n  return (\n    <>\n      <div class=\"media-editor__label\">{i18n('MediaEditor.AspectRatio')}</div>\n\n      <Item\n        icon={<IconTsx icon=\"free_transform\" />}\n        text={i18n('MediaEditor.Free')}\n        active={isActive()}\n        onClick={() => onRatioClick()}\n      />\n      <Item\n        icon={<IconTsx icon=\"image_original\" />}\n        text={i18n('MediaEditor.Original')}\n        active={isActive('original')}\n        onClick={() => onRatioClick('original')}\n      />\n      <Item\n        icon={ratioIcon('1x1')}\n        text={i18n('MediaEditor.Square')}\n        active={isActive('1x1')}\n        onClick={() => onRatioClick('1x1')}\n      />\n\n      <div class=\"media-editor__crop-grid\">\n        <Item icon={ratioIcon('3x2')} text=\"3:2\" active={isActive('3x2')} onClick={() => onRatioClick('3x2')} />\n        <Item icon={ratioIcon('3x2', true)} text=\"2:3\" active={isActive('2x3')} onClick={() => onRatioClick('2x3')} />\n\n        <Item icon={ratioIcon('4x3')} text=\"4:3\" active={isActive('4x3')} onClick={() => onRatioClick('4x3')} />\n        <Item icon={ratioIcon('4x3', true)} text=\"3:4\" active={isActive('3x4')} onClick={() => onRatioClick('3x4')} />\n\n        <Item icon={ratioIcon('5x4')} text=\"5:4\" active={isActive('5x4')} onClick={() => onRatioClick('5x4')} />\n        <Item icon={ratioIcon('5x4', true)} text=\"4:5\" active={isActive('4x5')} onClick={() => onRatioClick('4x5')} />\n\n        <Item icon={ratioIcon('7x5')} text=\"7:5\" active={isActive('7x5')} onClick={() => onRatioClick('7x5')} />\n        <Item icon={ratioIcon('7x5', true)} text=\"5:7\" active={isActive('5x7')} onClick={() => onRatioClick('5x7')} />\n\n        <Item icon={ratioIcon('16x9')} text=\"16:9\" active={isActive('16x9')} onClick={() => onRatioClick('16x9')} />\n        <Item\n          icon={ratioIcon('16x9', true)}\n          text=\"9:16\"\n          active={isActive('9x16')}\n          onClick={() => onRatioClick('9x16')}\n        />\n      </div>\n    </>\n  );\n}\n","import {ButtonIconTsx} from '@components/buttonIconTsx';\n\nimport {useMediaEditorContext} from '@components/mediaEditor/context';\n\ntype ConfigItem = {\n  icon: Icon;\n  key: string;\n};\n\nconst config: ConfigItem[] = [\n  {icon: 'equalizer', key: 'adjustments'},\n  {icon: 'crop', key: 'crop'},\n  {icon: 'text', key: 'text'},\n  {icon: 'brush', key: 'brush'},\n  {icon: 'smile', key: 'stickers'}\n];\n\nexport const mediaEditorTabsOrder = config.map((item) => item.key);\n\nexport default function Tabs() {\n  const {editorState} = useMediaEditorContext();\n\n  let container: HTMLDivElement;\n  let underline: HTMLDivElement;\n\n  const tabs = config.map((item) => ({\n    ...item,\n    element: (\n      <div class=\"media-editor__tabs-item\" classList={{'media-editor__tabs-item--active': editorState.currentTab === item.key}}>\n        <ButtonIconTsx icon={item.icon} onClick={() => onTabClick(item.key)} />\n      </div>\n    ) as HTMLElement\n  }));\n\n  function onTabClick(key: string) {\n    const target = tabs.find((tab) => tab.key === key).element;\n    const containerBR = container.getBoundingClientRect();\n    const targetBR = target.getBoundingClientRect();\n\n    underline.style.setProperty('--left', targetBR.left + targetBR.width / 2 - containerBR.left + 'px');\n\n    editorState.currentTab = key;\n  }\n\n  return (\n    <div ref={container} class=\"media-editor__tabs\">\n      {tabs.map((tab) => tab.element)}\n      <div ref={underline} class=\"media-editor__tabs-underline\" />\n    </div>\n  );\n}\n","import {Accessor, createContext, createEffect, createSignal, JSX, onCleanup, onMount} from 'solid-js';\n\nimport {doubleRaf} from '@helpers/schedulers';\nimport Scrollable from '@components/scrollable';\n\nimport {useMediaEditorContext} from '@components/mediaEditor/context';\nimport {delay} from '@components/mediaEditor/utils';\n\nimport {mediaEditorTabsOrder} from '@components/mediaEditor/tabs/tabs';\n\ntype TabContentContextValue = {\n  container: Accessor<HTMLDivElement>;\n  scrollAmount: Accessor<number>;\n};\nexport const TabContentContext = createContext<TabContentContextValue>();\n\nexport default function TabContent(props: {\n  tabs: Record<string, () => JSX.Element>;\n  onContainer: (el: HTMLDivElement) => void;\n  onScroll: () => void;\n}) {\n  const {editorState} = useMediaEditorContext();\n\n  const [container, setContainer] = createSignal<HTMLDivElement>();\n  const [scrollAmount, setScrollAmount] = createSignal(0);\n  let prevElement: HTMLDivElement;\n  let prevTab = editorState.currentTab;\n  let scrollable: Scrollable;\n\n  createEffect(async() => {\n    if(prevTab === editorState.currentTab) return;\n\n    const toRight = mediaEditorTabsOrder.indexOf(editorState.currentTab) > mediaEditorTabsOrder.indexOf(prevTab);\n    prevTab = editorState.currentTab;\n\n    scrollable.destroy();\n    const newElement = (\n      <div>\n        <div class=\"media-editor__tab-content-scrollable-content\">\n          <TabContentContext.Provider value={{container, scrollAmount}}>\n            {props.tabs[editorState.currentTab]()}\n          </TabContentContext.Provider>\n        </div>\n      </div>\n    ) as HTMLDivElement;\n    setScrollable(newElement);\n\n    const cls = (element: HTMLElement, action: 'add' | 'remove', modifier: string) =>\n      element.classList[action]('media-editor__tab-content--' + modifier);\n\n    cls(prevElement, 'add', 'exit');\n\n    if(toRight) {\n      cls(newElement, 'add', 'go-right');\n      container().append(newElement);\n      await doubleRaf();\n      cls(prevElement, 'add', 'go-left');\n      cls(newElement, 'remove', 'go-right');\n    } else {\n      cls(newElement, 'add', 'go-left');\n      container().append(newElement);\n      await doubleRaf();\n      cls(prevElement, 'add', 'go-right');\n      cls(newElement, 'remove', 'go-left');\n    }\n\n    await delay(200);\n    prevElement.remove();\n\n    prevElement = newElement;\n  });\n\n  const initialTab = props.tabs[editorState.currentTab]();\n\n  function setScrollable(element: HTMLElement) {\n    // TODO: Scrollable thumb not showing\n    scrollable = new Scrollable(element);\n    scrollable.setListeners();\n    scrollable.container.addEventListener('scroll', () => {\n      props.onScroll();\n      setScrollAmount(scrollable.container.scrollTop);\n    });\n  }\n\n  onMount(() => {\n    setScrollable(prevElement);\n  });\n\n  onCleanup(() => {\n    scrollable.destroy();\n  });\n\n  return (\n    <div\n      ref={(el) => {\n        setContainer(el);\n        props.onContainer(el);\n      }}\n      class=\"media-editor__tab-content\"\n    >\n      <div ref={prevElement}>\n        <div class=\"media-editor__tab-content-scrollable-content\">\n          <TabContentContext.Provider value={{container, scrollAmount}}>{initialTab}</TabContentContext.Provider>\n        </div>\n      </div>\n    </div>\n  );\n}\n","import {batch, createEffect, createResource, createSignal, For, onCleanup, onMount, Show, useContext} from 'solid-js';\n\nimport wrapEmojiText from '@lib/richTextProcessor/wrapEmojiText';\nimport {useHotReloadGuard} from '@lib/solidjs/hotReloadGuard';\nimport {Document, EmojiGroup, StickerSet} from '@layer';\nimport {i18n} from '@lib/langPack';\n\nimport SuperStickerRenderer from '@components/emoticonsDropdown/tabs/SuperStickerRenderer';\nimport createMiddleware from '@helpers/solid/createMiddleware';\nimport LazyLoadQueue from '@components/lazyLoadQueue';\nimport {ScrollableX} from '@components/scrollable';\nimport {IconTsx} from '@components/iconTsx';\nimport Space from '@components/space';\n\nimport useNormalizePoint from '@components/mediaEditor/canvas/useNormalizePoint';\nimport {HistoryItem, useMediaEditorContext} from '@components/mediaEditor/context';\nimport {ResizableLayer} from '@components/mediaEditor/types';\nimport {delay} from '@components/mediaEditor/utils';\n\nimport {TabContentContext} from '@components/mediaEditor/tabs/tabContent';\n\nexport default function StickersTab() {\n  const {wrapStickerSetThumb, EmoticonsSearch} = useHotReloadGuard();\n  const context = useMediaEditorContext();\n  const {container, scrollAmount} = useContext(TabContentContext);\n\n  const {managers, editorState, mediaState, actions} = context;\n\n  const normalizePoint = useNormalizePoint();\n\n  const [recentStickers] = createResource(() => managers.appStickersManager.getRecentStickersStickers());\n  const [stickerSets] = createResource(() => managers.appStickersManager.getAllStickers());\n  const [filteredStickers, setFilteredStickers] = createSignal<Document.document[]>();\n\n  const [search, setSearch] = createSignal('');\n  const [group, setGroup] = createSignal<EmojiGroup>();\n  const [activeSet, setActiveSet] = createSignal('recent');\n  const [scrolling, setScrolling] = createSignal(false);\n\n  const [intersectionObserver, setIntersectionObserver] = createSignal<IntersectionObserver>();\n  const [recentLabel, setRecentLabel] = createSignal<HTMLDivElement>();\n\n  const lazyLoadQueue = new LazyLoadQueue();\n  const stickerRenderer = new SuperStickerRenderer({\n    regularLazyLoadQueue: lazyLoadQueue,\n    group: 'none',\n    managers,\n    intersectionObserverInit: {root: container()},\n    withLock: false\n  });\n\n  onCleanup(() => {\n    stickerRenderer.destroy();\n    lazyLoadQueue.clear();\n  });\n\n  async function onStickerSetThumbClick(id: string) {\n    setActiveSet(String(id));\n    setScrolling(true);\n    container()?.querySelector(`[data-set-id=\"${id}\"]`)?.scrollIntoView({\n      behavior: 'smooth',\n      block: 'start'\n    });\n    await delay(1000);\n    setScrolling(false);\n  }\n\n  function StickerSetThumb(props: {set: StickerSet.stickerSet}) {\n    let renderContainer: HTMLDivElement;\n\n\n    onMount(() => {\n      const middleware = createMiddleware();\n\n      wrapStickerSetThumb({\n        container: renderContainer,\n        group: 'none',\n        autoplay: true,\n        width: 30,\n        height: 30,\n        lazyLoadQueue,\n        middleware: middleware.get(),\n        set: props.set,\n        managers,\n        textColor: 'white'\n      });\n    });\n\n    const isActive = () => String(props.set.id) === activeSet();\n\n    return (\n      <div\n        ref={renderContainer}\n        class=\"media-editor__stickers-set-thumb\"\n        classList={{\n          'media-editor__stickers-set-thumb--active': isActive()\n        }}\n        onClick={() => onStickerSetThumbClick(String(props.set.id))}\n      />\n    );\n  }\n\n  function Sticker(props: {doc: Document.document}) {\n    let container: HTMLDivElement;\n\n    onMount(() => {\n      stickerRenderer.renderSticker(props.doc, container);\n      stickerRenderer.observeAnimated(container);\n    });\n\n    function onClick() {\n      const id = context.resizableLayersSeed++;\n      const transform = editorState.finalTransform;\n      const newLayer = {\n        id,\n        position: normalizePoint([editorState.canvasSize[0] / 2, editorState.canvasSize[1] / 2]),\n        rotation: -transform.rotation,\n        scale: 1 / transform.scale,\n        type: 'sticker',\n        sticker: props.doc\n      } as ResizableLayer;\n\n      batch(() => {\n        mediaState.resizableLayers.push(newLayer);\n        editorState.selectedResizableLayer = id;\n\n        actions.pushToHistory({\n          path: ['resizableLayers', mediaState.resizableLayers.length - 1],\n          newValue: newLayer,\n          oldValue: HistoryItem.RemoveArrayItem,\n          findBy: {\n            id: newLayer.id\n          }\n        })\n      });\n    }\n\n    return <div ref={container} class=\"media-editor__stickers-grid-item\" onClick={onClick} />;\n  }\n\n  function StickerSetLabel(props: {set: StickerSet.stickerSet}) {\n    let label: HTMLDivElement;\n\n    createEffect(() => {\n      if(intersectionObserver()) {\n        intersectionObserver().observe(label);\n        onCleanup(() => {\n          intersectionObserver()?.unobserve(label);\n        });\n      }\n    });\n\n    return (\n      <div ref={label} data-set-id={props.set.id} class=\"media-editor__label\">\n        {wrapEmojiText(props.set.title)}\n      </div>\n    );\n  }\n\n  function StickerSetSection(props: {set: StickerSet.stickerSet}) {\n    const [stickers] = createResource(() => managers.appStickersManager.getStickerSet(props.set));\n\n    return (\n      <Show when={stickers()}>\n        <Space amount=\"16px\" />\n        <StickerSetLabel set={props.set} />\n        <div class=\"media-editor__stickers-grid\">\n          <For each={stickers().documents}>{(doc) => <Sticker doc={doc as Document.document} />}</For>\n        </div>\n      </Show>\n    );\n  }\n\n  function ThumbList() {\n    let thumbsListScrollable: HTMLDivElement;\n\n    onMount(() => {\n      document.querySelector('.media-editor__tabs')?.append(thumbsListScrollable);\n      new ScrollableX(thumbsListScrollable);\n    });\n    onCleanup(() => {\n      thumbsListScrollable.remove();\n    });\n\n    const visible = () => stickerSets() && !filteredStickers();\n    <div\n      class=\"media-editor__stickers-thumb-list-scrollable\"\n      classList={{\n        'media-editor__stickers-thumb-list-scrollable--hidden': !visible(),\n        'media-editor__stickers-thumb-list-scrollable--has-scroll': scrollAmount() > 8\n      }}\n      ref={thumbsListScrollable}\n    >\n      <div class=\"media-editor__stickers-thumb-list\">\n        <Show when={recentStickers()?.length}>\n          <div\n            class=\"media-editor__stickers-recent-button\"\n            classList={{\n              'media-editor__stickers-recent-button--active': activeSet() === 'recent'\n            }}\n            onClick={() => onStickerSetThumbClick('recent')}\n          >\n            <IconTsx icon=\"recent\" />\n          </div>\n        </Show>\n        <For each={stickerSets()?.sets}>{(set) => <StickerSetThumb set={set} />}</For>\n      </div>\n    </div>;\n    return <></>;\n  }\n\n  createEffect(() => {\n    setIntersectionObserver(\n      new IntersectionObserver(\n        (entries) => {\n          entries.forEach((entry) => {\n            if(!scrolling() && entry.isIntersecting) {\n              const id = (entry.target as HTMLDivElement).dataset.setId;\n              if(id) setActiveSet(id);\n            }\n          });\n        },\n        {\n          root: container(),\n          rootMargin: `0px 0px -${container().clientHeight - 100}px 0px`\n        }\n      )\n    );\n\n    onCleanup(() => {\n      intersectionObserver()?.disconnect();\n    });\n  });\n\n  createEffect(() => {\n    if(intersectionObserver() && recentLabel()) {\n      intersectionObserver().observe(recentLabel());\n      onCleanup(() => {\n        intersectionObserver()?.unobserve(recentLabel());\n      });\n    }\n  });\n\n  createEffect(async() => {\n    if(search()) {\n      setFilteredStickers(await managers.appStickersManager.searchStickers(search()));\n      return;\n    }\n    if(group()) {\n      const g = group();\n      if(g._ === 'emojiGroupPremium') {\n        setFilteredStickers(await managers.appStickersManager.getPremiumStickers());\n        return;\n      }\n      setFilteredStickers(\n        await managers.appStickersManager.getStickersByEmoticon({\n          emoticon: g.emoticons,\n          includeServerStickers: true\n        })\n      );\n\n      return;\n    }\n    if(!group() && !search()) {\n      setFilteredStickers();\n    }\n  });\n\n  return (\n    <>\n      <ThumbList />\n\n      <Space amount={filteredStickers() ? '0px' : '48px'} />\n      <Space amount=\"8px\" />\n\n      <div class=\"media-editor__sticker-search\">\n        <EmoticonsSearch\n          type=\"stickers\"\n          onValue={(value) => {\n            setSearch(value);\n          }}\n          onGroup={(group) => {\n            setGroup(group);\n          }}\n          categoryColor=\"white\"\n          animatedItemGroup=\"none\"\n        />\n      </div>\n\n      {/* TODO: Favorties */}\n      <Space amount=\"16px\" />\n\n      <Show when={recentStickers()?.length > 0 && !filteredStickers()}>\n        <div ref={setRecentLabel} class=\"media-editor__label\" data-set-id=\"recent\">\n          {i18n('MediaEditor.RecentlyUsed')}\n        </div>\n\n        <div class=\"media-editor__stickers-grid\">\n          <For each={recentStickers()}>{(doc) => <Sticker doc={doc} />}</For>\n        </div>\n      </Show>\n\n      <Show when={filteredStickers()}>\n        <div class=\"media-editor__stickers-grid\">\n          <For each={filteredStickers()}>{(doc) => <Sticker doc={doc} />}</For>\n        </div>\n      </Show>\n\n      <Show when={stickerSets() && !filteredStickers()}>\n        <For each={stickerSets().sets}>{(set) => <StickerSetSection set={set} />}</For>\n      </Show>\n    </>\n  );\n}\n","import {onMount, Accessor, JSX, createEffect, untrack} from 'solid-js';\n\nimport {i18n} from '@lib/langPack';\n\nimport ripple from '@components/ripple';\nimport {IconTsx} from '@components/iconTsx';\nimport Space from '@components/space';\n\nimport {createStoredColor} from '@components/mediaEditor/createStoredColor';\nimport {useMediaEditorContext} from '@components/mediaEditor/context';\nimport ColorPicker from '@components/mediaEditor/colorPicker';\nimport LargeButton from '@components/mediaEditor/largeButton';\nimport RangeInput from '@components/mediaEditor/rangeInput';\nimport {fontInfoMap} from '@components/mediaEditor/utils';\nimport {FontKey} from '@components/mediaEditor/types';\n\nexport default function TextTab() {\n  const {editorState} = useMediaEditorContext();\n\n  const [savedColor, setSavedColor] = createStoredColor('media-editor-text-color', '#ffffff');\n\n  editorState.currentTextLayerInfo.color = savedColor().value;\n  createEffect(() => {\n    untrack(() => editorState.currentTextLayerInfo).color = savedColor().value;\n  });\n\n\n  function setSize(value: number) {\n    editorState.currentTextLayerInfo.size = value;\n  }\n  function setAlignment(value: string) {\n    editorState.currentTextLayerInfo.alignment = value;\n  }\n  function setStyle(value: string) {\n    editorState.currentTextLayerInfo.style = value;\n  }\n\n  const toggleButton = (\n    icon: Icon,\n    value: string,\n    currentValue: Accessor<string>,\n    setValue: (value: string) => void\n  ) => (\n    <div\n      class=\"media-editor__toggle-button\"\n      classList={{'media-editor__toggle-button--active': value === currentValue()}}\n      onClick={() => setValue(value)}\n    >\n      <IconTsx icon={icon} />\n    </div>\n  );\n\n  onMount(() => {\n    document.querySelectorAll('.media-editor__toggle-button').forEach((element) => {\n      ripple(element as HTMLElement);\n    });\n  });\n\n  const fontButton = (text: JSX.Element, textFont: FontKey) => (\n    <LargeButton\n      active={editorState.currentTextLayerInfo.font === textFont}\n      onClick={() => void (editorState.currentTextLayerInfo.font = textFont)}\n      style={{\n        'font-family': fontInfoMap[textFont].fontFamily,\n        'font-weight': fontInfoMap[textFont].fontWeight\n      }}\n    >\n      {text}\n    </LargeButton>\n  );\n\n  return (\n    <>\n      <ColorPicker\n        value={editorState.currentTextLayerInfo.color}\n        onChange={setSavedColor}\n        previousColor={savedColor().previous}\n        colorKey={(editorState.selectedResizableLayer ?? '') + ''}\n      />\n\n      <div class=\"media-editor__toggle-group-row\">\n        <div class=\"media-editor__toggle-group\">\n          {toggleButton('align_left', 'left', () => editorState.currentTextLayerInfo.alignment, setAlignment)}\n          {toggleButton('align_center', 'center', () => editorState.currentTextLayerInfo.alignment, setAlignment)}\n          {toggleButton('align_right', 'right', () => editorState.currentTextLayerInfo.alignment, setAlignment)}\n        </div>\n\n        <div class=\"media-editor__toggle-group\">\n          {toggleButton('fontframe', 'normal', () => editorState.currentTextLayerInfo.style, setStyle)}\n          {toggleButton('fontframe_outline', 'outline', () => editorState.currentTextLayerInfo.style, setStyle)}\n          {toggleButton('fontframe_bg', 'background', () => editorState.currentTextLayerInfo.style, setStyle)}\n        </div>\n      </div>\n\n      <RangeInput\n        label={i18n('MediaEditor.Size')}\n        min={16}\n        max={64}\n        value={editorState.currentTextLayerInfo.size}\n        onChange={setSize}\n        passiveLabel\n        color={editorState.currentTextLayerInfo.color}\n      />\n\n      <Space amount=\"16px\" />\n\n      <div class=\"media-editor__label\">{i18n('MediaEditor.Font')}</div>\n\n      {fontButton(i18n('MediaEditor.Fonts.Roboto'), 'roboto')}\n      {fontButton(i18n('MediaEditor.Fonts.SuezOne'), 'suez')}\n      {fontButton(i18n('MediaEditor.Fonts.FugazOne'), 'fugaz')}\n      {fontButton(i18n('MediaEditor.Fonts.CourierPrime'), 'courier')}\n      {fontButton(i18n('MediaEditor.Fonts.Chewy'), 'chewy')}\n      {fontButton(i18n('MediaEditor.Fonts.Sedan'), 'sedan')}\n      {fontButton(i18n('MediaEditor.Fonts.RubikBubbles'), 'bubbles')}\n      {fontButton(i18n('MediaEditor.Fonts.Playwrite'), 'playwrite')}\n    </>\n  );\n}\n","import {batch, onCleanup, onMount} from 'solid-js';\n\nimport {addShortcutListener} from '@helpers/shortcutListener';\nimport {i18n} from '@lib/langPack';\nimport {ButtonIconTsx} from '@components/buttonIconTsx';\nimport ripple from '@components/ripple';\n\nimport {HistoryItem, useMediaEditorContext} from '@components/mediaEditor/context';\nimport {processHistoryItem} from '@components/mediaEditor/utils';\n\nexport default function Topbar(props: {onClose: () => void; onFinish: () => void}) {\n  const {hasModifications, mediaState, editorState} = useMediaEditorContext();\n\n  let doneButton: HTMLDivElement;\n\n\n  function processHistory(history: HistoryItem[], otherHistory: HistoryItem[]) {\n    batch(() => {\n      const item = history.pop();\n      if(!item) return;\n\n      otherHistory.push({\n        ...item,\n        path: item.path,\n        newValue: item.oldValue,\n        oldValue: item.newValue\n      });\n\n      processHistoryItem(item, mediaState);\n\n      editorState.selectedResizableLayer = undefined;\n    });\n  }\n\n  function onUndo() {\n    processHistory(mediaState.history, mediaState.redoHistory);\n  }\n\n  function onRedo() {\n    processHistory(mediaState.redoHistory, mediaState.history);\n  }\n\n  onMount(() => {\n    ripple(doneButton);\n\n    const removeListener = addShortcutListener(['Ctrl+KeyZ', 'Ctrl+Shift+KeyZ', 'Ctrl+KeyY'], (combo) => {\n      if(combo === 'Ctrl+KeyZ') {\n        onUndo();\n      } else {\n        onRedo();\n      }\n    });\n\n    onCleanup(() => removeListener());\n  });\n\n  return (\n    <div class=\"media-editor__topbar\">\n      <ButtonIconTsx icon=\"cross\" onClick={props.onClose} />\n      <div class=\"media-editor__topbar-title\">{i18n('Edit')}</div>\n      <div class=\"media-editor__topbar-history-controls\">\n        <ButtonIconTsx disabled={!mediaState.history.length} onClick={onUndo} icon=\"undo\" />\n        <ButtonIconTsx disabled={!mediaState.redoHistory.length} onClick={onRedo} icon=\"redo\" />\n      </div>\n      <div\n        ref={doneButton}\n        class=\"media-editor__topbar-done\"\n        classList={{\n          'media-editor__topbar-done--disabled': !hasModifications()\n        }}\n        onClick={() => {\n          if(hasModifications()) props.onFinish();\n        }}\n      >\n        {i18n('Done')}\n      </div>\n    </div>\n  );\n}\n","import {batch, createEffect, createMemo, createSignal, JSX, on, onCleanup, onMount} from 'solid-js';\nimport {doubleRaf} from '@helpers/schedulers';\nimport {useMediaEditorContext} from '@components/mediaEditor/context';\nimport AdjustmentsTab from '@components/mediaEditor/tabs/adjustmentsTab';\nimport BrushTab from '@components/mediaEditor/tabs/brushTab';\nimport CropTab from '@components/mediaEditor/tabs/cropTab';\nimport StickersTab from '@components/mediaEditor/tabs/stickersTab';\nimport TabContent from '@components/mediaEditor/tabs/tabContent';\nimport Tabs from '@components/mediaEditor/tabs/tabs';\nimport TextTab from '@components/mediaEditor/tabs/textTab';\nimport Topbar from '@components/mediaEditor/topbar';\nimport useIsMobile from '@components/mediaEditor/useIsMobile';\nimport {delay} from '@components/mediaEditor/utils';\nimport {animateValue} from '@helpers/animateValue';\nimport {lerp} from '@helpers/lerp';\n\n\nexport default function Toolbar(props: {onFinish: () => void; onClose: () => void}) {\n  let toolbar: HTMLDivElement;\n\n  const {editorState, actions} = useMediaEditorContext();\n\n  const [move, setMove] = createSignal(0);\n  const [isCollapsed, setIsCollapsed] = createSignal(false);\n  const [container, setContainer] = createSignal<HTMLDivElement>();\n  const [containerHeight, setContainerHeight] = createSignal(0);\n  const [extraMove, setExtraMove] = createSignal(0);\n\n  const isMobile = useIsMobile();\n\n  const [shouldHide, setShouldHide] = createSignal(isMobile());\n\n  let startY = 0;\n  let isAborted = true;\n  let isResetting = false;\n  let canMove = false;\n\n  function resetMove() {\n    if(isResetting) return;\n    isResetting = true;\n\n    startY = 0;\n    isAborted = true;\n    animateValue(move(), 0, 200, setMove);\n    setTimeout(() => {\n      isResetting = false;\n    }, 200);\n  }\n  actions.abortDrawerSlide = () => resetMove();\n\n  onMount(() => {\n    function startDrag(y: number) {\n      if(!isMobile()) return;\n      startY = y;\n      isAborted = false;\n      canMove = false;\n      setTimeout(() => {\n        canMove = true;\n      }, 100); // wait for scroll to trigger first\n    }\n    function dragMove(y: number) {\n      if(!isMobile()) return;\n      if(isAborted) return;\n      if(!canMove) return;\n      const diff = y - startY;\n      if(isCollapsed()) setMove(Math.min(Math.max(-containerHeight(), diff), 0));\n      else setMove(Math.max(Math.min(containerHeight(), diff), 0));\n    }\n    function dragEnd() {\n      if(!isMobile()) return;\n      if(isAborted) return;\n      isAborted = true;\n      if(Math.abs(move()) > 100) {\n        setIsCollapsed((prev) => !prev);\n      } else {\n        resetMove();\n      }\n    }\n\n    container().addEventListener('input', () => {\n      resetMove();\n    });\n\n    toolbar.addEventListener('touchstart', (e) => {\n      startDrag(e.touches[0].clientY);\n    });\n    toolbar.addEventListener('touchmove', (e) => {\n      dragMove(e.touches[0].clientY);\n    });\n    toolbar.addEventListener('touchend', (e) => {\n      dragEnd();\n    });\n    toolbar.addEventListener('mousedown', (e) => {\n      startDrag(e.clientY);\n    });\n    toolbar.addEventListener('mousemove', (e) => {\n      dragMove(e.clientY);\n    });\n    toolbar.addEventListener('mouseup', (e) => {\n      dragEnd();\n    });\n    toolbar.addEventListener('mouseout', (e) => {\n      dragEnd();\n    });\n  });\n\n  createEffect(() => {\n    const observer = new ResizeObserver(() => {\n      setContainerHeight(container()?.clientHeight || 0);\n    });\n    observer.observe(container());\n    onCleanup(() => observer.disconnect());\n  });\n\n  createEffect(\n    on(isCollapsed, () => {\n      const initialMove = move();\n      const initialExtraMove = extraMove();\n      const targetExtraMove = isCollapsed() ? containerHeight() : 0;\n      animateValue(0, 1, 200, (progress) => {\n        batch(() => {\n          setMove(lerp(initialMove, 0, progress));\n          setExtraMove(lerp(initialExtraMove, targetExtraMove, progress));\n        });\n      });\n    })\n  );\n\n  createEffect(() => {\n    if(editorState.currentTab !== 'crop') setIsCollapsed(false);\n  });\n\n  createEffect(() => {\n    if(editorState.renderingPayload && shouldHide()) {\n      (async() => {\n        toolbar.style.transition = '.2s';\n        await doubleRaf();\n        setShouldHide(false);\n        await delay(200);\n        toolbar.style.removeProperty('transition');\n      })();\n    }\n  });\n\n  const totalMove = () => extraMove() + move();\n\n  const style = createMemo((): JSX.CSSProperties => {\n    if(isMobile()) return {\n      'opacity': editorState.isAdjusting ? 0 : 1,\n      'transform': shouldHide() ?\n        'translate(-50%, 100%)' :\n        `translate(-50%, ${totalMove()}px)`\n    };\n  });\n\n  return (\n    <div\n      ref={toolbar}\n      class=\"media-editor__toolbar\"\n      style={style()}\n    >\n      <div class=\"media-editor__toolbar-draggable\" />\n      <Topbar onClose={() => props.onClose()} onFinish={props.onFinish} />\n      <Tabs />\n      <TabContent\n        onContainer={setContainer}\n        onScroll={() => {\n          resetMove();\n        }}\n        tabs={{\n          adjustments: () => <AdjustmentsTab />,\n          crop: () => <CropTab />,\n          text: () => <TextTab />,\n          brush: () => <BrushTab />,\n          stickers: () => <StickersTab />\n        }}\n      />\n    </div>\n  );\n}\n","import {createEffect, onCleanup, onMount} from 'solid-js';\nimport {render} from 'solid-js/web';\n\nimport {doubleRaf} from '@helpers/schedulers';\nimport {AppManagers} from '@lib/managers';\nimport {i18n} from '@lib/langPack';\nimport type SolidJSHotReloadGuardProvider from '@lib/solidjs/hotReloadGuardProvider';\n\nimport appNavigationController, {NavigationItem} from '@components/appNavigationController';\nimport confirmationPopup from '@components/confirmationPopup';\n\nimport MainCanvas from '@components/mediaEditor/canvas/mainCanvas';\nimport MediaEditorContext, {createContextValue, EditingMediaState} from '@components/mediaEditor/context';\nimport {createFinalResult, MediaEditorFinalResult} from '@components/mediaEditor/finalRender/createFinalResult';\nimport FinishButton from '@components/mediaEditor/finishButton';\nimport Toolbar from '@components/mediaEditor/toolbar';\nimport {MediaType, NumberPair} from '@components/mediaEditor/types';\nimport {delay, withCurrentOwner} from '@components/mediaEditor/utils';\n\nimport '@components/mediaEditor/mediaEditor.scss';\n\n\nexport type MediaEditorProps = {\n  onClose: (hasGif: boolean) => void;\n  managers: AppManagers;\n  onEditFinish: (result: MediaEditorFinalResult) => void;\n  onCanvasReady: (canvas: HTMLCanvasElement) => Promise<void>;\n  onImageRendered: () => void;\n  mediaSrc: string;\n  mediaType: MediaType;\n  mediaBlob: Blob;\n  mediaSize: NumberPair;\n  editingMediaState?: EditingMediaState\n};\n\nexport function MediaEditor(props: MediaEditorProps) {\n  const contextValue = createContextValue(props);\n\n  const {editorState, hasModifications} = contextValue;\n\n  let overlay: HTMLDivElement;\n\n  onMount(() => {\n    (async() => {\n      overlay.classList.add('media-editor__overlay--hidden');\n      await doubleRaf();\n      overlay.classList.remove('media-editor__overlay--hidden');\n    })();\n\n    const navigationItem: NavigationItem = {\n      type: 'popup',\n      onPop: () => handleClose()\n    };\n    appNavigationController.pushItem(navigationItem);\n\n    overlay.focus();\n\n    onCleanup(() => {\n      appNavigationController.removeItem(navigationItem);\n    });\n  });\n\n  createEffect(() => {\n    if(!editorState.imageCanvas) return;\n\n    (async() =>{\n      await props.onCanvasReady(editorState.imageCanvas);\n      editorState.isReady = true;\n    })();\n  });\n\n  createEffect(() => {\n    if(!editorState.renderingPayload) return;\n    props.onImageRendered();\n  });\n\n  async function performClose(hasGif = false) {\n    overlay.classList.add('media-editor__overlay--hidden');\n    await delay(200);\n    props.onClose(hasGif);\n  }\n\n  function handleClose(finished = false, hasGif = false) {\n    if(finished || !hasModifications()) {\n      performClose(hasGif);\n      return;\n    }\n\n    confirmationPopup({\n      title: i18n('MediaEditor.DiscardChanges'),\n      description: i18n('MediaEditor.DiscardWarning'),\n      button: {\n        text: i18n('Discard')\n      }\n    }).then(() => performClose(), () => {});\n\n    return false;\n  }\n\n  let isFinishing = false;\n\n  return (\n    <MediaEditorContext.Provider value={contextValue}>\n      <div ref={overlay} class=\"media-editor__overlay night\">\n        <div class=\"media-editor__container\">\n          {(() => {\n            // Need to be inside context\n            const handleFinish = withCurrentOwner(async() => {\n              if(isFinishing) return;\n              isFinishing = true;\n\n              const result = await createFinalResult()\n              .finally(() => { isFinishing = false; });\n\n              props.onEditFinish(result);\n              handleClose(true, result.isVideo);\n            });\n\n            return (\n              <>\n                <MainCanvas />\n                <Toolbar onClose={handleClose} onFinish={handleFinish} />\n                <FinishButton onClick={handleFinish} />\n              </>\n            );\n          })()}\n        </div>\n      </div>\n    </MediaEditorContext.Provider>\n  );\n}\n\nexport function openMediaEditor(props: MediaEditorProps, HotReloadGuardProvider: typeof SolidJSHotReloadGuardProvider) {\n  const element = document.createElement('div');\n  document.body.append(element);\n\n  const dispose = render(() => (\n    <HotReloadGuardProvider>\n      <MediaEditor {...props} onClose={onClose} />\n    </HotReloadGuardProvider>\n  ), element);\n\n  function onClose(hasGif: boolean) {\n    props.onClose(hasGif);\n    dispose();\n    element.remove();\n  }\n}\n","import {animateValue} from '@helpers/animateValue';\nimport deferredPromise from '@helpers/cancellablePromise';\nimport {lerp} from '@helpers/lerp';\nimport {doubleRaf} from '@helpers/schedulers';\nimport type {AppManagers} from '@lib/managers';\nimport SolidJSHotReloadGuardProvider from '@lib/solidjs/hotReloadGuardProvider';\nimport {EditingMediaState} from '@components/mediaEditor/context';\nimport {MediaEditorFinalResult} from '@components/mediaEditor/finalRender/createFinalResult';\nimport {openMediaEditor} from '@components/mediaEditor/mediaEditor';\nimport {MediaType, NumberPair} from '@components/mediaEditor/types';\nimport {delay, snapToViewport} from '@components/mediaEditor/utils';\n\n\ntype Args = {\n  source: CanvasImageSource;\n  element: HTMLElement;\n  managers: AppManagers;\n\n  mediaType: MediaType;\n  mediaSrc: string;\n  mediaBlob: Blob;\n  mediaSize: NumberPair;\n\n  size: NumberPair;\n\n  editingMediaState: EditingMediaState;\n  onEditFinish: (result: MediaEditorFinalResult) => void;\n  onClose: (hasGif: boolean) => void;\n};\n\nexport function openMediaEditorFromMedia({\n  source,\n  element,\n  managers,\n  mediaType,\n  mediaSrc,\n  mediaBlob,\n  mediaSize,\n  size,\n  editingMediaState,\n  onEditFinish,\n  onClose\n}: Args) {\n  const animatedCanvas = document.createElement('canvas');\n  const [sourceWidth, sourceHeight] = [animatedCanvas.width, animatedCanvas.height] = size;\n\n  const ctx = animatedCanvas.getContext('2d');\n  ctx.drawImage(source, 0, 0, animatedCanvas.width, animatedCanvas.height);\n\n  const bcr = element.getBoundingClientRect();\n  animatedCanvas.style.position = 'fixed';\n\n  const left = bcr.left + bcr.width / 2, top = bcr.top + bcr.height / 2, width = bcr.width, height = bcr.height;\n\n  animatedCanvas.style.left = left + 'px';\n  animatedCanvas.style.top = top + 'px';\n  animatedCanvas.style.width = width + 'px';\n  animatedCanvas.style.height = height + 'px';\n  animatedCanvas.style.transform = 'translate(-50%, -50%)';\n  animatedCanvas.style.objectFit = 'cover';\n  animatedCanvas.style.zIndex = '1000';\n\n  document.body.append(animatedCanvas);\n\n  openMediaEditor({\n    mediaType,\n    mediaSrc,\n    mediaBlob,\n    managers,\n    mediaSize,\n    onEditFinish,\n\n    onCanvasReady: (canvas) => {\n      const canvasBcr = canvas.getBoundingClientRect();\n      const leftDiff = (canvasBcr.left + canvasBcr.width / 2) - left;\n      const topDiff = (canvasBcr.top + canvasBcr.height / 2) - top;\n      const [scaledWidth, scaledHeight] = snapToViewport(sourceWidth / sourceHeight, canvasBcr.width, canvasBcr.height);\n\n      const deferred = deferredPromise<void>();\n\n      animateValue(\n        0, 1, 200,\n        (progress) => {\n          animatedCanvas.style.transform = `translate(calc(${\n            progress * leftDiff\n          }px - 50%), calc(${\n            progress * topDiff\n          }px - 50%))`;\n          animatedCanvas.style.width = lerp(width, scaledWidth, progress) + 'px';\n          animatedCanvas.style.height = lerp(height, scaledHeight, progress) + 'px';\n        },\n        {\n          onEnd: () => deferred.resolve()\n        }\n      );\n\n      return deferred;\n    },\n\n    onImageRendered: async() => {\n      animatedCanvas.style.opacity = '1';\n      animatedCanvas.style.transition = '.12s';\n      await doubleRaf();\n      animatedCanvas.style.opacity = '0';\n      await delay(120);\n      animatedCanvas.remove();\n    },\n\n    editingMediaState: editingMediaState,\n    onClose\n  }, SolidJSHotReloadGuardProvider);\n}\n"],"file":"index-B65a6sqH.js"}