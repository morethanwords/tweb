{"version":3,"file":"channelDirectMessages-BcCetIwl.js","sources":["../src/components/sidebarRight/tabs/channelDirectMessages.tsx"],"sourcesContent":["import SaveButton from '@components/saveButton';\nimport Section from '@components/section';\nimport StarRangeInput from '@components/sidebarLeft/tabs/privacy/messages/starsRangeInput';\nimport useStarsCommissionAndWithdrawalPrice from '@components/sidebarLeft/tabs/privacy/messages/useStarsCommissionAndWithdrawalPrice';\nimport type {AppDirectMessagesTab} from '@components/solidJsTabs';\nimport {useSuperTab} from '@components/solidJsTabs/superTabProvider';\nimport StaticSwitch from '@components/staticSwitch';\nimport useIsConfirmationNeededOnClose from '@hooks/useIsConfirmationNeededOnClose';\nimport {i18n} from '@lib/langPack';\nimport {useHotReloadGuard} from '@lib/solidjs/hotReloadGuard';\nimport {createMemo, createSignal, Show} from 'solid-js';\nimport {Portal} from 'solid-js/web';\nimport {Transition} from 'solid-transition-group';\n\n\nconst ChannelDirectMessages = () => {\n  const [tab] = useSuperTab<typeof AppDirectMessagesTab>();\n  const {apiManagerProxy, rootScope, Row} = useHotReloadGuard();\n\n  const chat = tab.payload.chat;\n  if(!chat) return <></>;\n\n  const linkedChat = chat.linked_monoforum_id ? apiManagerProxy.getChat(chat.linked_monoforum_id) : undefined;\n\n  const initialEnabled = !!linkedChat;\n  const initialStars = linkedChat?._ === 'channel' ? +linkedChat.send_paid_messages_stars || 0 : 0\n\n  const [enabled, setEnabled] = createSignal(initialEnabled);\n  const [stars, setStars] = createSignal(initialStars);\n\n  const hasChanges = createMemo(() => initialEnabled !== enabled() || (enabled() && initialStars !== stars()));\n\n  const {commissionPercents, willReceiveDollars} = useStarsCommissionAndWithdrawalPrice(stars);\n\n  let isSaving = false;\n\n  async function saveSettings() {\n    if(isSaving) return;\n    isSaving = true;\n\n    try {\n      await rootScope.managers.appChatsManager.updateChannelPaidMessagesPrice(\n        chat.id,\n        enabled() ? stars() : 0,\n        enabled()\n      );\n      tab.close();\n    } finally {\n      isSaving = false;\n    }\n  }\n\n  tab.isConfirmationNeededOnClose = useIsConfirmationNeededOnClose({\n    saveAllSettings: saveSettings,\n    hasChanges,\n    descriptionLangKey: 'UnsavedChangesDescription.Channel'\n  });\n\n  return <>\n    <Portal mount={tab.header}>\n      <SaveButton hasChanges={hasChanges()} onClick={() => void saveSettings()} />\n    </Portal>\n\n    <Section caption='ChannelDirectMessages.Settings.SwitchLabelCaption'>\n      <Row clickable={() => {setEnabled(!enabled())}}>\n        <Row.Title>\n          {i18n('ChannelDirectMessages.Settings.SwitchLabel')}\n        </Row.Title>\n        <Row.RightContent>\n          <StaticSwitch checked={enabled()} />\n        </Row.RightContent>\n      </Row>\n    </Section>\n\n    <Transition name='fade'>\n      <Show when={enabled()}>\n        <Section\n          name='PaidMessages.SetPrice'\n          class='overflow-hidden'\n          caption='PaidMessages.SetPriceChannelDescription'\n          captionArgs={[commissionPercents(), willReceiveDollars()]}\n        >\n          <StarRangeInput value={stars()} onChange={setStars} startFromZero />\n        </Section>\n      </Show>\n    </Transition>\n  </>;\n};\n\nexport default ChannelDirectMessages;\n"],"names":["ChannelDirectMessages","tab","useSuperTab","apiManagerProxy","rootScope","Row","useHotReloadGuard","chat","payload","linkedChat","linked_monoforum_id","getChat","undefined","initialEnabled","initialStars","_","send_paid_messages_stars","enabled","setEnabled","createSignal","stars","setStars","hasChanges","createMemo","commissionPercents","willReceiveDollars","useStarsCommissionAndWithdrawalPrice","isSaving","saveSettings","managers","appChatsManager","updateChannelPaidMessagesPrice","id","close","isConfirmationNeededOnClose","useIsConfirmationNeededOnClose","saveAllSettings","descriptionLangKey","_$createComponent","Portal","mount","header","children","SaveButton","onClick","Section","caption","clickable","Title","i18n","RightContent","StaticSwitch","checked","Transition","name","Show","when","captionArgs","StarRangeInput","value","onChange","startFromZero"],"mappings":"86BAeMA,MAAAA,GAAwBA,IAAM,CAClC,KAAM,CAACC,CAAG,EAAIC,IACR,CAACC,gBAAAA,EAAiBC,UAAAA,EAAWC,IAAAA,CAAI,EAAGC,EAAiB,EAErDC,EAAON,EAAIO,QAAQD,KACzB,GAAG,CAACA,EAAM,MAAA,GAEV,MAAME,EAAaF,EAAKG,oBAAsBP,EAAgBQ,QAAQJ,EAAKG,mBAAmB,EAAIE,OAE5FC,EAAiB,CAAC,CAACJ,EACnBK,EAAeL,GAAYM,IAAM,WAAY,CAACN,EAAWO,0BAA4B,EAErF,CAACC,EAASC,CAAU,EAAIC,EAAaN,CAAc,EACnD,CAACO,EAAOC,CAAQ,EAAIF,EAAaL,CAAY,EAE7CQ,EAAaC,EAAW,IAAMV,IAAmBI,KAAcA,KAAaH,IAAiBM,EAAK,CAAG,EAErG,CAACI,mBAAAA,EAAoBC,mBAAAA,CAAkB,EAAIC,EAAqCN,CAAK,EAE3F,IAAIO,EAAW,GAEf,eAAeC,GAAe,CAC5B,GAAGD,CAAAA,EACHA,CAAAA,EAAW,GAEX,GAAI,CACF,MAAMvB,EAAUyB,SAASC,gBAAgBC,+BACvCxB,EAAKyB,GACLf,EAAO,EAAKG,EAAO,EAAG,EACtBH,EACF,CAAA,EACAhB,EAAIgC,MAAK,CACX,QAAU,CACRN,EAAW,EACb,EACF,CAEA1B,OAAAA,EAAIiC,4BAA8BC,EAA+B,CAC/DC,gBAAiBR,EACjBN,WAAAA,EACAe,mBAAoB,mCACtB,CAAC,EAEDC,CAAAA,EACGC,EAAM,CAAA,IAACC,OAAK,CAAA,OAAEvC,EAAIwC,MAAM,EAAA,IAAAC,UAAA,CAAA,OAAAJ,EACtBK,EAAU,CAAA,IAACrB,YAAU,CAAA,OAAEA,EAAU,CAAE,EAAEsB,QAASA,IAAM,KAAKhB,EAAa,CAAC,CAAA,CAAA,EAAAU,EAAAA,EAGzEO,EAAO,CAACC,QAAO,oDAAA,IAAAJ,UAAA,CAAA,OAAAJ,EACbjC,EAAG,CAAC0C,UAAWA,IAAM,CAAC7B,EAAW,CAACD,EAAO,CAAE,CAAE,EAAA,IAAAyB,UAAA,CAAA,MAAA,CAAAJ,EAC3CjC,EAAI2C,MAAK,CAAA,IAAAN,UAAA,CAAA,OACPO,EAAK,4CAA4C,CAAC,CAAA,CAAA,EAAAX,EAEpDjC,EAAI6C,aAAY,CAAA,IAAAR,UAAA,CAAA,OAAAJ,EACda,EAAY,CAAA,IAACC,SAAO,CAAA,OAAEnC,EAAO,CAAE,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,EAAAqB,EAAAA,EAKrCe,EAAU,CAACC,KAAI,OAAA,IAAAZ,UAAA,CAAA,OAAAJ,EACbiB,EAAI,CAAA,IAACC,MAAI,CAAA,OAAEvC,EAAO,CAAE,EAAA,IAAAyB,UAAA,CAAA,OAAAJ,EAClBO,EAAO,CACNS,KAAI,wBAAA,MAAA,kBAEJR,QAAO,0CAAA,IACPW,aAAW,CAAA,MAAE,CAACjC,EAAkB,EAAIC,EAAkB,CAAE,CAAC,EAAA,IAAAiB,UAAA,CAAA,OAAAJ,EAExDoB,EAAc,CAAA,IAACC,OAAK,CAAA,OAAEvC,EAAK,CAAE,EAAEwC,SAAUvC,EAAUwC,cAAa,EAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAK3E"}