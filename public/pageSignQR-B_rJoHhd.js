const __vite__fileDeps=["./pageSignIn-DZ-QgAtG.js","./index-KE8-Aw4R.js","./index-DauxdX1f.css","./putPreloader-xoyIUvgH.js","./page-T3b4UFno.js","./countryInputField-DLRFVrFP.js","./textToSvgURL-Cnw_Q8Rw.js","./qr-code-styling-CvBVNv73.js","./_commonjsHelpers-Cpj98o6Y.js","./pageIm-CEbuaauv.js","./pagePassword-BMu7NA0m.js","./loginPage-E3zdBJT7.js","./htmlToSpan-DhAls8qz.js"],__vite__mapDeps=i=>i.map(i=>__vite__fileDeps[i]);
import{I as d,B as A,l as V,r as c,e as $,n as F,j as z,g as H,i as j,_ as E,q as N,A as C,u as T}from"./index-KE8-Aw4R.js";import{P as W}from"./page-T3b4UFno.js";import{p as O}from"./putPreloader-xoyIUvgH.js";import{b as G,t as J}from"./textToSvgURL-Cnw_Q8Rw.js";let b=!1;function K(){return P||(P=c.managers.apiManager.getConfig().then(e=>e.suggested_lang_code!==d.lastRequestedLangCode?Promise.all([e,d.getStrings(e.suggested_lang_code,["Login.ContinueOnLanguage"]),d.getCacheLangPack()]):[]))}let P;function U(e){b||K().then(([t,u])=>{if(!t)return;const s=[];u.forEach(i=>{const m=d.strings.get(i.key);m&&(s.push(m),d.strings.set(i.key,i))});const o="Login.ContinueOnLanguage",a=A("btn-primary btn-secondary btn-primary-transparent primary",{text:o});a.lastElementChild.classList.remove("i18n"),V({text:[d.format(o,!0)]}).then(()=>{window.requestAnimationFrame(()=>{e.append(a)})}),c.addEventListener("language_change",()=>{a.remove()},{once:!0}),s.forEach(i=>{d.strings.set(i.key,i)}),$(a,i=>{F(i),b=!0,a.disabled=!0,O(a),d.getLangPack(t.suggested_lang_code)})})}function X(e,t){return e.replace(/\+/g,"-").replace(/\//g,"_").replace(/\=+$/,"")}function Y(e){let t,u="";for(let s=e.length,o=0,a=0;a<s;++a)t=a%3,o|=e[a]<<(16>>>t&24),(t===2||s-a===1)&&(u+=String.fromCharCode(L(o>>>18&63),L(o>>>12&63),L(o>>>6&63),L(o&63)),o=0);return u.replace(/A(?=A$|$)/g,"=")}function L(e){return e<26?e+65:e<52?e+71:e<62?e-4:e===62?43:e===63?47:65}const R=3,Z=async()=>{const t=I.pageEl.querySelector(".auth-image");let u=O(t,!0);const s=document.createElement("div");s.classList.add("input-wrapper");const o=A("btn-primary btn-secondary btn-primary-transparent primary",{text:"Login.QR.Cancel"});s.append(o),z()===1&&U(s);const a=t.parentElement,i=document.createElement("h4");H(i,"Login.QR.Title");const m=document.createElement("ol");m.classList.add("qr-description"),["Login.QR.Help1","Login.QR.Help2","Login.QR.Help3"].forEach(l=>{const g=document.createElement("li");g.append(j(l)),m.append(g)}),a.append(i,m,s),o.addEventListener("click",()=>{E(()=>import("./pageSignIn-DZ-QgAtG.js"),__vite__mapDeps([0,1,2,3,4,5,6]),import.meta.url).then(l=>l.default.mount()),f=!0});const x=(await Promise.all([E(()=>import("./qr-code-styling-CvBVNv73.js").then(l=>l.q),__vite__mapDeps([7,8]),import.meta.url)]))[0].default;let f=!1;c.addEventListener("user_auth",l=>{f=!0,_=null},{once:!0});const w={ignoreErrors:!0};let k;const q=async l=>{try{const g=await N.getUserIds();let n=await c.managers.apiManager.invokeApi("auth.exportLoginToken",{api_id:C.id,api_hash:C.hash,except_ids:g.map(p=>p.toUserId())},{ignoreErrors:!0});if(n._==="auth.loginTokenMigrateTo"&&(w.dcId||(w.dcId=n.dc_id,c.managers.apiManager.setBaseDcId(n.dc_id)),n=await c.managers.apiManager.invokeApi("auth.importLoginToken",{token:n.token},w)),n._==="auth.loginTokenSuccess"){const p=n.authorization;return await c.managers.apiManager.setUser(p.user),E(()=>import("./pageIm-CEbuaauv.js"),__vite__mapDeps([9,1,2,4]),import.meta.url).then(h=>h.default.mount()),!0}if(!k||!G(k,n.token)){k=n.token;const p=Y(n.token),h="tg://login?token="+X(p,!0),v=window.getComputedStyle(document.documentElement),B=v.getPropertyValue("--surface-color").trim(),D=v.getPropertyValue("--primary-text-color").trim(),M=v.getPropertyValue("--primary-color").trim(),Q=await fetch("assets/img/logo_padded.svg").then(r=>r.text()).then(r=>(r=r.replace(/(fill:).+?(;)/,`$1${M}$2`),J(r))),y=new x({width:240*window.devicePixelRatio,height:240*window.devicePixelRatio,data:h,image:Q,dotsOptions:{color:D,type:"rounded"},cornersSquareOptions:{type:"extra-rounded"},imageOptions:{imageSize:1,margin:0},backgroundOptions:{color:B},qrOptions:{errorCorrectionLevel:"L"}});y.append(t),t.lastChild.classList.add("qr-canvas");let S;y._drawingPromise?S=y._drawingPromise:S=Promise.race([T(1e3),new Promise(r=>{y._canvas._image.addEventListener("load",()=>{window.requestAnimationFrame(()=>r())},{once:!0})})]),await S.then(()=>{if(u){u.style.animation="hide-icon .4s forwards";const r=t.children[1];r.style.display="none",r.style.animation="grow-icon .4s forwards",setTimeout(()=>{r.style.display=""},150),setTimeout(()=>{r.style.animation=""},500),u=void 0}else Array.from(t.children).slice(0,-1).forEach(r=>{r.remove()})})}if(l){const p=Date.now()/1e3,h=n.expires-p-await c.managers.timeManager.getServerTimeOffset();await T(h>R?1e3*R:1e3*h|0)}}catch(g){switch(g.type){case"SESSION_PASSWORD_NEEDED":E(()=>import("./pagePassword-BMu7NA0m.js"),__vite__mapDeps([10,1,2,3,4,11,12]),import.meta.url).then(n=>n.default.mount()),f=!0,_=null;break;default:console.error("pageSignQR: default error:",g),f=!0;break}return!0}return!1};return async()=>{f=!1;do if(f||await q(!0))break;while(!0)}};let _;const I=new W("page-signQR",!0,()=>_,()=>{_||(_=Z()),_.then(e=>{e()}),c.managers.appStateManager.pushToState("authState",{_:"authStateSignQr"})}),oe=Object.freeze(Object.defineProperty({__proto__:null,default:I},Symbol.toStringTag,{value:"Module"}));export{oe as a,U as g,I as p};
//# sourceMappingURL=pageSignQR-B_rJoHhd.js.map
