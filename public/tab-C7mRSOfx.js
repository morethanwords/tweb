import{dR as v,b as n,ab as P,a2 as k,i as f,t as M,bB as I,af as _,aS as B,bn as N,aU as D,aQ as w,ce as O,c as G,bF as K,ah as V,ad as $}from"./index-BV2I1Jtp.js";import{u as q,S as L}from"./saveButton-Cb1fsvqF.js";import{ab as b,a5 as A,ad as j,a8 as H}from"./appDialogsManager-CWwr6pYf.js";import{T as U}from"./transition-RjVzGhLO.js";import{a as T}from"./wrapDuration-Dbmbo_XD.js";import{S as C}from"./staticRadio-g0LH5kyh.js";import{u as x}from"./useIsPremium-Db0UvXjK.js";import{S as Q}from"./starsRangeInput-DVTnqK4b.js";import{u as W}from"./useStarsCommissionAndWithdrawalPrice-Ncts0hjg.js";import"./iconTsx-WcVB6J0T.js";import"./classNames-CN4lTu6a.js";import"./page-CZapATw0.js";import"./putPreloader-D61QXpkQ.js";import"./avatar-CoF9jUXV.js";import"./htmlToSpan-DhAls8qz.js";import"./_commonjsHelpers-Cpj98o6Y.js";import"./toast-CKjmCNNt.js";import"./fastBlur-Co-79rP4.js";import"./emailSetup-DC47owN0.js";import"./countryInputField-DRrD4ZDI.js";import"./scrollable2-DFH8h4l4.js";import"./chatBackground-CE6wSm2q.js";import"./tracking-D9iSy3gB.js";import"./useAppConfig-Cl65m-A-.js";var p=(e=>(e[e.Everybody=1]="Everybody",e[e.ContactsAndPremium=2]="ContactsAndPremium",e[e.Paid=3]="Paid",e))(p||{});const F="inputPrivacyKeyNoPaidMessages",z=[{_:"inputPrivacyValueAllowContacts"}],y=120,J=10,X=e=>{const{PopupPremium:l,i18n:o,toastNew:c,hideToast:u,Row:s}=v(),i=x(),d=r=>()=>{if(i())return r();c({langPackKey:"PrivacySettings.Messages.PremiumError",langPackArguments:[T(()=>{u(),l.show({feature:"message_privacy"})})]})},m=n(U,{mode:"outin",onEnter:async(r,a)=>{await r.animate({opacity:[0,1]},{duration:y}).finished,a()},onExit:async(r,a)=>{const t=r.animate({opacity:[1,0]},{duration:y}).finished;e.onExitAnimationPromise(t),await t,a()},get children(){return P(()=>!e.isPaid)()?o("Privacy.MessagesInfo",[T(()=>void l.show())]):o("PaidMessages.ChargeForMessagesDescription")}});return n(b,{name:"PrivacyMessagesTitle",caption:m,get children(){return[n(s,{clickable:()=>{e.setStore("option",p.Everybody)},get children(){return[n(s.CheckboxField,{get children(){return n(C,{floating:!0,get checked(){return e.store.option===p.Everybody}})}}),n(s.Title,{get children(){return o("PrivacySettingsController.Everbody")}})]}}),n(s,{get clickable(){return d(()=>{e.setStore("option",p.ContactsAndPremium)})},get children(){return[P(()=>P(()=>!!i())()&&n(s.CheckboxField,{get children(){return n(C,{floating:!0,get checked(){return e.store.option===p.ContactsAndPremium}})}})),P(()=>P(()=>!i())()&&n(s.Icon,{icon:"premium_lock"})),n(s.Title,{get children(){return o("Privacy.ContactsAndPremium")}})]}}),n(s,{get clickable(){return d(()=>{e.setStore(r=>({option:p.Paid,stars:r.stars||J}))})},get children(){return[P(()=>P(()=>!!i())()&&n(s.CheckboxField,{get children(){return n(C,{floating:!0,get checked(){return e.isPaid}})}})),P(()=>P(()=>!i())()&&n(s.Icon,{icon:"premium_lock"})),n(s.Title,{get children(){return o("PaidMessages.ChargeForMessages")}})]}})]}})},Y=M("<span class=primary>"),Z=M("<div>"),ee=e=>{const[l,{AppAddMembersTab:o}]=A(),{i18n:c,join:u,Row:s}=v(),{commissionPercents:i,willReceiveDollars:d}=W(()=>e.store.stars),m=()=>{l.slider.createTab(o).open({type:"privacy",skippable:!0,title:"PaidMessages.RemoveFee",placeholder:"PrivacyModal.Search.Placeholder",takeOut:a=>{e.setStore("chosenPeers",a)},selectedPeerIds:[...e.store.chosenPeers]})},r=()=>{if(!e.store.chosenPeers.length)return c("PrivacySettingsController.AddUsers");const{users:a,chats:t}=e.chosenPeersByType;return u([a.length?c("Users",[a.length]):null,t.length?c("Chats",[t.length]):null].filter(Boolean),!1)};return n(U,{onEnter:async(a,t)=>{const g=a;g.style.opacity="0",await e.exitAnimationPromise,await g.animate({opacity:[0,1]},{duration:y}).finished,g.style.removeProperty("opacity"),t()},onExit:async(a,t)=>{await a.animate({opacity:[1,0]},{duration:y}).finished,t()},get children(){return n(k,{get when(){return e.isPaid},get children(){const a=Z();return f(a,n(b,{name:"PaidMessages.SetPrice",caption:"PaidMessages.SetPriceDescription",get captionArgs(){return[i(),d()]},get children(){return n(Q,{get value(){return e.store.stars},get onChange(){return e.setStore.bind(null,"stars")}})}}),null),f(a,n(b,{name:"PrivacyExceptions",caption:"PaidMessages.RemoveFeeDescription",get children(){return n(s,{clickable:m,get children(){return[n(s.Title,{get children(){return c("PaidMessages.RemoveFee")}}),n(s.RightContent,{get children(){const t=Y();return f(t,r),t}})]}})}}),null),a}})}})},R=I("useSaveSettings"),te=({store:e,globalPrivacy:l,isPaid:o,hasChanges:c,chosenPeersByType:u})=>{const{rootScope:s}=v(),[i]=A(),d=()=>{const t=structuredClone(l());t.noncontact_peers_paid_stars=o()?e.stars:0,t.pFlags??(t.pFlags={}),j(t.pFlags,"new_noncontact_peers_require_premium",e.option===p.ContactsAndPremium),R("saving settings :>> ",t);const g=s.managers.appPrivacyManager.setGlobalPrivacySettings(t);return i.payload.onSaved(g),g},m=async()=>{const t=[],{chats:g,users:h}=u();return t.push(...z),g.length&&t.push({_:"inputPrivacyValueAllowChatParticipants",chats:g}),h.length&&t.push({_:"inputPrivacyValueAllowUsers",users:await Promise.all(h.map(S=>s.managers.appUsersManager.getUserInput(S)))}),R("saving rules :>> ",t),s.managers.appPrivacyManager.setPrivacy(F,t)};let r=!1;return async()=>{if(!(r||!c())){r=!0;try{await Promise.all([d(),o()?m():void 0]),i.close()}finally{r=!1}}}},re=e=>e instanceof Object?e.user_id?.toPeerId(!0):e.toPeerId(!0),ne=()=>{const{rootScope:e}=v(),l=H(),o=x(),[c]=_(()=>{const r=e.managers.appPrivacyManager.getPrivacy(F);return l.collect(r),r}),[u]=_(()=>{const r=e.managers.appPrivacyManager.getGlobalPrivacySettings();return l.collect(r),r});return{isReady:()=>c.state==="ready"&&u.state==="ready",globalPrivacy:u,privacyRules:c,currentOption:()=>o()?u().noncontact_peers_paid_stars?p.Paid:u().pFlags.new_noncontact_peers_require_premium?p.ContactsAndPremium:p.Everybody:p.Everybody,currentAllowedUsers:()=>c()?.filter(r=>r._==="privacyValueAllowUsers")?.map(r=>r?.users).flat()?.map(r=>r.toPeerId())||[],currentAllowedChats:()=>c()?.find(r=>r._==="privacyValueAllowChatParticipants")?.chats?.map(re)?.filter(r=>r!==void 0)||[]}},se=({isReady:e,globalPrivacy:l,currentOption:o,currentAllowedChats:c,currentAllowedUsers:u})=>{let s={};const[i,d]=B({});N(()=>{e()&&(s={option:o(),stars:Number(l().noncontact_peers_paid_stars)||void 0,chosenPeers:[...u(),...c()]},d(D(structuredClone(s))))});const m=w(()=>i.option===p.Paid),r=w(()=>{const t=m()?[]:["chosenPeers","stars"];return!O(i,s,t)});return[i,d,{hasChanges:r,isPaid:m,chosenPeersByType:()=>({chats:i.chosenPeers.filter(t=>t.isAnyChat()).map(t=>t.toChatId()),users:i.chosenPeers.filter(t=>t.isUser())})}]},E=I("MessagesPrivacyTab"),ke=()=>{const[e]=A(),{isReady:l,globalPrivacy:o,privacyRules:c,currentOption:u,currentAllowedUsers:s,currentAllowedChats:i}=ne(),[d,m,{isPaid:r,hasChanges:a,chosenPeersByType:t}]=se({isReady:l,globalPrivacy:o,currentOption:u,currentAllowedChats:i,currentAllowedUsers:s}),g=te({store:d,globalPrivacy:o,isPaid:r,hasChanges:a,chosenPeersByType:t});e.isConfirmationNeededOnClose=q({hasChanges:a,saveAllSettings:g,descriptionLangKey:"UnsavedChangesDescription.Privacy"});const[h,S]=G();return K&&V(()=>{E("privacyRules() :>> ",c()),E("globalPrivacy() :>> ",o())}),n(k,{get when(){return l()},get children(){return[n($,{get mount(){return e.header},get children(){return n(L,{get hasChanges(){return a()},onClick:()=>void g()})}}),n(X,{get isPaid(){return r()},store:d,setStore:m,onExitAnimationPromise:S}),n(ee,{get isPaid(){return r()},store:d,setStore:m,get chosenPeersByType(){return t()},get exitAnimationPromise(){return h()}})]}})};export{ke as default};
//# sourceMappingURL=tab-C7mRSOfx.js.map
