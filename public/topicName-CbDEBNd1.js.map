{"version":3,"file":"topicName-CbDEBNd1.js","sources":["../src/lib/appManagers/utils/chats/isBannedParticipant.ts","../src/lib/appManagers/utils/chats/removeChatBannedRightsFromParticipant.ts","../src/components/sidebarRight/tabs/adminRecentActions/adminRightsI18nResolver.ts","../src/lib/appManagers/utils/chats/isParticipantAdmin.ts","../src/components/sidebarRight/tabs/adminRecentActions/utils.ts","../src/components/sidebarRight/tabs/adminRecentActions/participantRightsMap.ts","../src/components/sidebarRight/tabs/adminRecentActions/topicName.tsx"],"sourcesContent":["import {ChannelParticipant, ChatParticipant} from '@layer';\n\nexport const isBannedParticipant = (participant: ChatParticipant | ChannelParticipant | undefined) =>\n  participant?._ === 'channelParticipantBanned' && participant.pFlags?.left;\n;\n","import {ChatBannedRights, Chat} from '@layer';\n\nexport default function removeChatBannedRightsFromParticipant(chat: Chat.channel, rights: ChatBannedRights) {\n  if(chat.default_banned_rights && rights?.pFlags) {\n    rights = structuredClone(rights);\n\n    const defaultBannedRights = chat.default_banned_rights.pFlags;\n\n    for(const key in defaultBannedRights) {\n      const flagKey = key as keyof ChatBannedRights['pFlags'];\n      if(defaultBannedRights[flagKey]) delete rights.pFlags[flagKey];\n    }\n  }\n\n  return rights;\n}\n","import {ChatAdminRights} from '@layer';\nimport {LangPackKey} from '@lib/langPack';\n\n\ntype Args = { isBroadcast: boolean };\n\nconst adminRightToI18n: Record<keyof ChatAdminRights.chatAdminRights['pFlags'], (a: Args) => LangPackKey> = {\n  other: () => 'AdminRights.Other',\n  manage_call: () => 'Channel.EditAdmin.ManageCalls',\n  manage_direct_messages: () => 'Channel.EditAdmin.ManageDirectMessages',\n\n  change_info: ({isBroadcast}) =>\n    isBroadcast ? 'EditAdminChangeChannelInfo' : 'EditAdminChangeGroupInfo',\n\n  post_messages: () => 'EditAdminPostMessages',\n  edit_messages: () => 'EditAdminEditMessages',\n  delete_messages: ({isBroadcast}) =>\n    isBroadcast ? 'EditAdminDeleteMessages' : 'EditAdminGroupDeleteMessages',\n\n  ban_users: () => 'EditAdminBanUsers',\n  pin_messages: () => 'EditAdminPinMessages',\n  add_admins: () => 'EditAdminAddAdmins',\n  anonymous: () => 'EditAdminSendAnonymously',\n  manage_topics: () => 'ManageTopicsPermission',\n\n  invite_users: ({isBroadcast}) =>\n    isBroadcast ?\n      'Channel.EditAdmin.PermissionInviteSubscribers' :\n      'EditAdminAddUsersViaLink',\n\n  post_stories: () => 'AdminRights.PostStories',\n  edit_stories: () => 'AdminRights.EditStories',\n  delete_stories: () => 'AdminRights.DeleteStories'\n};\n\nexport function resolveAdminRightFlagI18n(flag: keyof ChatAdminRights.chatAdminRights['pFlags'], args: Args) {\n  const resolver = adminRightToI18n[flag];\n  return resolver(args);\n}\n","import {ChannelParticipant, ChatParticipant} from '@layer';\n\nexport const isParticipantAdmin = (participant: ChatParticipant | ChannelParticipant | undefined) =>\n  participant?._ === 'channelParticipantCreator' ||\n  participant?._ === 'channelParticipantAdmin' ||\n  participant?._ === 'chatParticipantAdmin' ||\n  participant?._ === 'chatParticipantCreator'\n;\n","import pause from '@helpers/schedulers/pause';\nimport {wrapAsyncClickHandler} from '@helpers/wrapAsyncClickHandler';\nimport {Message} from '@layer';\nimport {isParticipantAdmin} from '@appManagers/utils/chats/isParticipantAdmin';\nimport {useHotReloadGuard} from '@lib/solidjs/hotReloadGuard';\nimport {useSuperTab} from '@components/solidJsTabs/superTabProvider';\nimport {AppAdminRecentActionsTab} from '@components/solidJsTabs/tabs';\nimport {toastNew} from '@components/toast';\n\n\nexport const getPhoto = (message: Message) => {\n  if(message?._ !== 'message' || message?.media?._ !== 'messageMediaPhoto' || message?.media?.photo?._ !== 'photo') return;\n  return message.media.photo;\n};\n\nexport function diffFlags<T extends Record<string, true>>(\n  prev: T | undefined,\n  next: T | undefined\n) {\n  const prevNorm = (prev ?? {}) as Required<T>;\n  const nextNorm = (next ?? {}) as Required<T>;\n\n  const newFlags: (keyof T)[] = [];\n  const oldFlags: (keyof T)[] = [];\n\n  const allKeys = new Set<keyof T>([\n    ...Object.keys(prevNorm) as (keyof T)[],\n    ...Object.keys(nextNorm) as (keyof T)[]\n  ]);\n\n  for(const key of allKeys) {\n    const was = prevNorm[key];\n    const isNow = nextNorm[key];\n\n    if(!was && isNow) {\n      newFlags.push(key);\n    } else if(was && !isNow) {\n      oldFlags.push(key);\n    }\n  }\n\n  return {new: newFlags, old: oldFlags};\n}\n\nexport function useParticipantClickHandler(peerId: PeerId) {\n  const {rootScope} = useHotReloadGuard();\n  const [tab, allTabs] = useSuperTab<typeof AppAdminRecentActionsTab>();\n\n  return wrapAsyncClickHandler(async() => {\n    try {\n      const participant = await rootScope.managers.appProfileManager.getParticipant(tab.payload.channelId, peerId);\n\n      allTabs.AppUserPermissionsTab.openTab(\n        tab.slider,\n        tab.payload.channelId, participant, isParticipantAdmin(participant)\n      );\n\n      await pause(200); // wait the open animation too\n    } catch{\n      toastNew({\n        langPackKey: 'AdminRecentActions.UserNotMemberAnymore'\n      });\n    }\n  });\n}\n","import {ChatBannedRights} from '@layer';\nimport {LangPackKey} from '@lib/langPack';\n\nexport const participantRightsMap: Record<keyof ChatBannedRights.chatBannedRights['pFlags'], LangPackKey | null> = {\n  send_plain:        'UserRestrictionsSend',\n  send_media:        'UserRestrictionsSendMedia',\n  invite_users:      'UserRestrictionsInviteUsers',\n  pin_messages:      'UserRestrictionsPinMessages',\n  manage_topics:     'CreateTopicsPermission',\n  change_info:       'UserRestrictionsChangeInfo',\n  send_photos:       'UserRestrictionsSendPhotos',\n  send_videos:       'UserRestrictionsSendVideos',\n  send_stickers:     'UserRestrictionsSendStickersOnly',\n  send_gifs:         'UserRestrictionsSendGIFsOnly',\n  send_audios:       'UserRestrictionsSendMusic',\n  send_docs:         'UserRestrictionsSendFiles',\n  send_voices:       'UserRestrictionsSendVoices',\n  send_roundvideos:  'UserRestrictionsSendRound',\n  embed_links:       'UserRestrictionsEmbedLinks',\n  send_polls:        'UserRestrictionsSendPolls',\n  view_messages:     null,\n  send_messages:     null,\n  send_games:        null,\n  send_inline:       null\n};\n","import {createResource, Show} from 'solid-js';\nimport createMiddleware from '@helpers/solid/createMiddleware';\nimport {ForumTopic} from '@layer';\nimport {useHotReloadGuard} from '@lib/solidjs/hotReloadGuard';\nimport styles from '@components/sidebarRight/tabs/adminRecentActions/topicName.module.scss';\n\n\nexport const TopicName = (props: {\n  topic: ForumTopic;\n}) => {\n  const {wrapTopicIcon} = useHotReloadGuard();\n\n  const topic = () => props.topic._ === 'forumTopic' ? props.topic : null;\n\n  const [icon] = createResource(topic, (topic) => {\n    if(!topic) return null;\n    const middleware = createMiddleware().get();\n    return wrapTopicIcon({\n      topic,\n      middleware\n    });\n  });\n\n  return (\n    <Show when={topic()}>\n      <div class={styles.Container}>\n        {icon()} {topic().title}\n      </div>\n    </Show>\n  );\n}\n"],"names":["isBannedParticipant","participant","removeChatBannedRightsFromParticipant","chat","rights","defaultBannedRights","key","flagKey","adminRightToI18n","isBroadcast","resolveAdminRightFlagI18n","flag","args","resolver","isParticipantAdmin","getPhoto","message","diffFlags","prev","next","prevNorm","nextNorm","newFlags","oldFlags","allKeys","was","isNow","useParticipantClickHandler","peerId","rootScope","useHotReloadGuard","tab","allTabs","useSuperTab","wrapAsyncClickHandler","pause","toastNew","participantRightsMap","TopicName","props","wrapTopicIcon","topic","_","icon","createResource","middleware","createMiddleware","get","_$createComponent","Show","when","children","_el$","_tmpl$","_el$2","firstChild","_$insert","title","_$effect","_$className","styles","Container"],"mappings":"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"}