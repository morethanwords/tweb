{"version":3,"file":"index-lgH6Qkd9.js","sources":["../src/components/sidebarLeft/tabs/autoDeleteMessages/index.tsx"],"sourcesContent":["import {resolveFirst} from '@solid-primitives/refs';\nimport {createMemo, createSignal, For} from 'solid-js';\nimport {Portal} from 'solid-js/web';\nimport {I18nTsx} from '@helpers/solid/i18n';\nimport {wrapAsyncClickHandler} from '@helpers/wrapAsyncClickHandler';\nimport useIsConfirmationNeededOnClose from '@hooks/useIsConfirmationNeededOnClose';\nimport {useHotReloadGuard} from '@lib/solidjs/hotReloadGuard';\nimport SaveButton from '@components/saveButton';\nimport Section from '@components/section';\nimport SettingsTabLottieAnimation from '@components/settingsTabLottieAnimation';\nimport {useSuperTab} from '@components/solidJsTabs/superTabProvider';\nimport {AppMessagesAutoDeleteTab} from '@components/solidJsTabs/tabs';\nimport Space from '@components/space';\nimport StaticRadio from '@components/staticRadio';\nimport {findExistingOrCreateCustomOption, findMatchingCustomOption, getDefaultOptions, Option} from '@components/sidebarLeft/tabs/autoDeleteMessages/options';\nimport AutoDeleteMessagesCustomTimePopup from '@components/sidebarLeft/tabs/autoDeleteMessages/customTimePopup';\n\n\nconst AutoDeleteMessages = () => {\n  const {Row, rootScope, HotReloadGuard} = useHotReloadGuard();\n\n  const [tab] = useSuperTab<typeof AppMessagesAutoDeleteTab>();\n\n  const initialPeriod = findMatchingCustomOption(tab.payload.period)?.value || tab.payload.period;\n\n  const defaultOptions: Option[] = getDefaultOptions({\n    offLabel: () => resolveFirst(() => <I18nTsx key='Off' />, item => item instanceof Element)()\n  });\n\n  const [period, setPeriod] = createSignal(initialPeriod);\n\n  const hasChanges = createMemo(() => period() !== initialPeriod);\n\n  const options = createMemo(() => {\n    const result = [...defaultOptions];\n    const localPeriod = period();\n\n    for(let i = defaultOptions.length - 1; i >= 0; i--) {\n      const value = defaultOptions[i].value;\n\n      if(localPeriod === value) break;\n\n      if(localPeriod > value) {\n        result.splice(\n          i + 1, 0,\n          findExistingOrCreateCustomOption(localPeriod)\n        );\n        break;\n      }\n    }\n\n    return result;\n  });\n\n  const saveSettings = wrapAsyncClickHandler(async() => {\n    if(!hasChanges()) return;\n\n    try {\n      await rootScope.managers.appPrivacyManager.setDefaultAutoDeletePeriod(period());\n      tab.payload.onSaved(period());\n    } finally {\n      tab.close();\n    }\n  });\n\n  tab.isConfirmationNeededOnClose = useIsConfirmationNeededOnClose({\n    descriptionLangKey: 'UnsavedChangesDescription.Privacy',\n    hasChanges,\n    saveAllSettings: saveSettings\n  });\n\n  const onOptionClick = (option: Option) => {\n    setPeriod(option.value);\n  };\n\n  const onCustomOptionClick = () => {\n    new AutoDeleteMessagesCustomTimePopup({\n      HotReloadGuard,\n      descriptionLangKey: 'AutoDeleteMessages.InfoDefault',\n      onFinish: (value) => {\n        setPeriod(value);\n      },\n      period: period()\n    }).show();\n  };\n\n  return (\n    <>\n      <Portal mount={tab.header}>\n        <SaveButton hasChanges={hasChanges()} onClick={() => void saveSettings()} />\n      </Portal>\n\n\n      <Space amount='1rem' />\n      <SettingsTabLottieAnimation name=\"UtyanDisappear\" />\n      <Space amount='2rem' />\n\n      <Section name='AutoDeleteMessages.SectionTitle' caption='AutoDeleteMessages.SectionCaption'>\n        <For each={options()}>\n          {(option) => (\n            <Row clickable={[onOptionClick, option]}>\n              <Row.CheckboxField>\n                <StaticRadio\n                  floating\n                  checked={period() === option.value}\n                />\n              </Row.CheckboxField>\n              <Row.Title>\n                {option.label()}\n              </Row.Title>\n            </Row>\n          )}\n        </For>\n        <Row clickable={onCustomOptionClick}>\n          <Row.Icon icon='tools' />\n          <Row.Title>\n            <I18nTsx key='AutoDeleteMessages.SetOtherTime' />\n          </Row.Title>\n        </Row>\n      </Section>\n    </>\n  );\n};\n\nexport default AutoDeleteMessages;\n"],"names":["AutoDeleteMessages","Row","rootScope","HotReloadGuard","useHotReloadGuard","tab","useSuperTab","initialPeriod","findMatchingCustomOption","payload","period","value","defaultOptions","getDefaultOptions","offLabel","resolveFirst","_$createComponent","I18nTsx","key","item","Element","setPeriod","createSignal","hasChanges","createMemo","options","result","localPeriod","i","length","splice","findExistingOrCreateCustomOption","saveSettings","wrapAsyncClickHandler","managers","appPrivacyManager","setDefaultAutoDeletePeriod","onSaved","close","isConfirmationNeededOnClose","useIsConfirmationNeededOnClose","descriptionLangKey","saveAllSettings","onOptionClick","option","onCustomOptionClick","AutoDeleteMessagesCustomTimePopup","onFinish","show","Portal","mount","header","children","SaveButton","onClick","Space","amount","SettingsTabLottieAnimation","name","Section","caption","For","each","clickable","CheckboxField","StaticRadio","floating","checked","Title","label","Icon","icon"],"mappings":"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"}