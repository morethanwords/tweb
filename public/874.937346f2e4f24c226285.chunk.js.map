{"version":3,"file":"874.937346f2e4f24c226285.chunk.js","mappings":"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,MAAO,KAAO,MAAO,KAAO,MAAO,KAAO,MAAO,KAAO,MAAO,KAAO,MAAO,KAAO,KAAM,KAAO,MAAO,KAAO,KAAM,KAAO,MAAO,KAAO,MAAO,KAAO,MAAO,KAAO,MAAO,KAAO,MAAO,KAAO,MAAO,KAAO,KAAM,KAAO,MAAO,KAAO,MAAO,KAAO,MAAO,KAAO,MAAO,KAAO,MAAO,KAAO,MAAO,KAAO,MAAO,KAAO,MAAO,KAAO,MAAO,KAAO,MAAO,KAAO,MAAO,KAAO,MAAO,KAAO,MAAO,KAAO,MAAO,KAAO,KAAM,KAAO,KAAM,KAAO,MAAO,KAAO,MAAO,KAAO,MAAO,KAAO,MAAO,KAAO,MAAO,KAAO,MAAO,KAAO,MAAO,KAAO,MAAO,YAAY,MAAO,YAAY,MAAO,YAAY,MAAO,YAAY,MAAO,YAAY,MAAO,YAAY,MAAO,YAAY,MAAO,YAAY,MAAO,YAAY,MAAO,YAAY,MAAO,YAAY,MAAO,YAAY,MAAO,OAAO,MAAO,OAAO,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,KAAM,QAAQ,MAAO,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,MAAO,QAAQ,KAAM,QAAQ,MAAO,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,MAAO,QAAQ,MAAO,QAAQ,KAAM,QAAQ,MAAO,QAAQ,MAAO,QAAQ,KAAM,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,KAAM,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,KAAM,kBAAkB,KAAM,kBAAkB,KAAM,QAAQ,KAAM,kBAAkB,KAAM,kBAAkB,KAAM,QAAQ,KAAM,QAAQ,MAAO,QAAQ,MAAO,QAAQ,KAAM,QAAQ,MAAO,QAAQ,MAAO,kBAAkB,KAAM,kBAAkB,KAAM,QAAQ,KAAM,kBAAkB,KAAM,kBAAkB,KAAM,QAAQ,KAAM,kBAAkB,KAAM,kBAAkB,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,MAAO,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,MAAO,QAAQ,KAAM,QAAQ,KAAM,mBAAmB,MAAO,kBAAkB,MAAO,QAAQ,MAAO,kBAAkB,MAAO,4CAA4C,MAAO,4CAA4C,MAAO,4CAA4C,MAAO,QAAQ,MAAO,QAAQ,KAAM,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,kBAAkB,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,mBAAmB,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,kBAAkB,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,mBAAmB,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,mBAAmB,KAAM,mBAAmB,KAAM,mBAAmB,KAAM,mBAAmB,KAAM,mBAAmB,KAAM,mBAAmB,KAAM,mBAAmB,KAAM,mBAAmB,KAAM,8BAA8B,KAAM,mBAAmB,KAAM,8BAA8B,KAAM,8BAA8B,KAAM,mBAAmB,KAAM,8BAA8B,KAAM,yCAAyC,KAAM,8BAA8B,KAAM,yCAAyC,KAAM,yCAAyC,KAAM,8BAA8B,KAAM,yCAAyC,KAAM,8BAA8B,KAAM,yCAAyC,KAAM,yCAAyC,KAAM,mBAAmB,KAAM,mBAAmB,KAAM,mBAAmB,KAAM,mBAAmB,KAAM,mBAAmB,KAAM,mBAAmB,KAAM,mBAAmB,KAAM,mBAAmB,KAAM,mBAAmB,KAAM,mBAAmB,KAAM,mBAAmB,KAAM,mBAAmB,KAAM,mBAAmB,KAAM,kBAAkB,KAAM,kBAAkB,KAAM,kBAAkB,KAAM,6BAA6B,KAAM,wCAAwC,KAAM,QAAQ,KAAM,mBAAmB,KAAM,mBAAmB,KAAM,mBAAmB,KAAM,mBAAmB,KAAM,mBAAmB,KAAM,mBAAmB,KAAM,mBAAmB,KAAM,mBAAmB,KAAM,8BAA8B,KAAM,mBAAmB,KAAM,8BAA8B,KAAM,8BAA8B,KAAM,mBAAmB,KAAM,8BAA8B,KAAM,yCAAyC,KAAM,8BAA8B,KAAM,yCAAyC,KAAM,yCAAyC,KAAM,mBAAmB,KAAM,mBAAmB,KAAM,mBAAmB,KAAM,mBAAmB,KAAM,mBAAmB,KAAM,mBAAmB,KAAM,mBAAmB,KAAM,mBAAmB,KAAM,mBAAmB,KAAM,mBAAmB,KAAM,mBAAmB,KAAM,mBAAmB,KAAM,mBAAmB,KAAM,kBAAkB,KAAM,kBAAkB,KAAM,kBAAkB,KAAM,6BAA6B,KAAM,6BAA6B,KAAM,wCAAwC,KAAM,wCAAwC,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,kBAAkB,KAAM,kBAAkB,KAAM,QAAQ,KAAM,kBAAkB,KAAM,kBAAkB,KAAM,QAAQ,KAAM,kBAAkB,KAAM,kBAAkB,KAAM,QAAQ,KAAM,kBAAkB,KAAM,kBAAkB,KAAM,QAAQ,KAAM,QAAQ,KAAM,kBAAkB,KAAM,kBAAkB,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,kBAAkB,KAAM,kBAAkB,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,kBAAkB,KAAM,kBAAkB,KAAM,QAAQ,KAAM,kBAAkB,KAAM,kBAAkB,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,MAAO,QAAQ,KAAM,kBAAkB,KAAM,kBAAkB,KAAM,QAAQ,KAAM,kBAAkB,KAAM,kBAAkB,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,MAAO,QAAQ,MAAO,QAAQ,KAAM,QAAQ,KAAM,QAAQ,MAAO,QAAQ,MAAO,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,MAAO,QAAQ,MAAO,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,MAAO,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,KAAM,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,KAAM,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,MAAO,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,MAAO,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,kBAAkB,KAAM,kBAAkB,KAAM,QAAQ,KAAM,QAAQ,MAAO,QAAQ,KAAM,QAAQ,KAAM,QAAQ,MAAO,QAAQ,KAAM,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,MAAO,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,MAAO,QAAQ,GAAI,QAAQ,GAAI,QAAQ,GAAI,QAAQ,GAAI,QAAQ,GAAI,QAAQ,GAAI,QAAQ,GAAI,QAAQ,IAAK,QAAQ,KAAM,QAAQ,IAAK,QAAQ,IAAK,QAAQ,IAAK,QAAQ,IAAK,QAAQ,IAAK,QAAQ,IAAK,QAAQ,IAAK,QAAQ,IAAK,QAAQ,IAAK,QAAQ,IAAK,QAAQ,IAAK,QAAQ,IAAK,QAAQ,IAAK,QAAQ,IAAK,QAAQ,IAAK,QAAQ,IAAK,QAAQ,IAAK,QAAQ,IAAK,QAAQ,IAAK,QAAQ,IAAK,QAAQ,IAAK,QAAQ,IAAK,QAAQ,IAAK,QAAQ,KAAM,QAAQ,KAAM,QAAQ,IAAK,QAAQ,IAAK,QAAQ,IAAK,QAAQ,IAAK,QAAQ,IAAK,QAAQ,IAAK,QAAQ,IAAK,QAAQ,IAAK,QAAQ,IAAK,QAAQ,IAAK,QAAQ,IAAK,QAAQ,IAAK,mBAAmB,IAAK,QAAQ,IAAK,QAAQ,IAAK,QAAQ,IAAK,QAAQ,IAAK,QAAQ,IAAK,QAAQ,IAAK,QAAQ,IAAK,mBAAmB,IAAK,QAAQ,IAAK,mBAAmB,IAAK,QAAQ,IAAK,QAAQ,IAAK,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,IAAK,QAAQ,GAAI,QAAQ,IAAK,QAAQ,IAAK,kBAAkB,KAAM,kBAAkB,KAAM,QAAQ,KAAM,kBAAkB,KAAM,kBAAkB,KAAM,QAAQ,KAAM,kBAAkB,KAAM,kBAAkB,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,kBAAkB,KAAM,kBAAkB,KAAM,QAAQ,KAAM,QAAQ,KAAM,kBAAkB,KAAM,kBAAkB,KAAM,QAAQ,KAAM,kBAAkB,KAAM,kBAAkB,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,kBAAkB,KAAM,kBAAkB,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,KAAM,QAAQ,MAAO,kBAAkB,KAAM,kBAAkB,KAAM,QAAQ,KAAM,kBAAkB,KAAM,kBAAkB,KAAM,QAAQ,KAAM,kBAAkB,KAAM,kBAAkB,KAAM,QAAQ,KAAM,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,KAAM,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,KAAM,QAAQ,MAAO,QAAQ,KAAM,QAAQ,MAAO,QAAQ,MAAO,QAAQ,KAAM,QAAQ,MAAO,QAAQ,KAAM,QAAQ,KAAM,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,MAAO,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,IAAK,QAAQ,IAAK,QAAQ,IAAK,QAAQ,IAAK,QAAQ,IAAK,QAAQ,IAAK,QAAQ,KAAM,QAAQ,IAAK,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,IAAK,QAAQ,KAAM,QAAQ,IAAK,QAAQ,GAAI,QAAQ,IAAK,QAAQ,IAAK,kBAAkB,KAAM,kBAAkB,KAAM,QAAQ,KAAM,QAAQ,IAAK,QAAQ,IAAK,QAAQ,IAAK,QAAQ,IAAK,QAAQ,IAAK,QAAQ,KAAM,QAAQ,IAAK,QAAQ,IAAK,QAAQ,IAAK,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,kBAAkB,KAAM,kBAAkB,KAAM,QAAQ,KAAM,QAAQ,KAAM,kBAAkB,KAAM,kBAAkB,KAAM,QAAQ,KAAM,kBAAkB,KAAM,kBAAkB,KAAM,QAAQ,KAAM,kBAAkB,KAAM,kBAAkB,KAAM,QAAQ,KAAM,QAAQ,KAAM,kBAAkB,KAAM,kBAAkB,KAAM,QAAQ,KAAM,kBAAkB,KAAM,kBAAkB,KAAM,QAAQ,KAAM,kBAAkB,KAAM,kBAAkB,KAAM,QAAQ,KAAM,QAAQ,MAAO,QAAQ,KAAM,QAAQ,MAAO,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,IAAK,QAAQ,IAAK,QAAQ,IAAK,QAAQ,IAAK,QAAQ,IAAK,QAAQ,IAAK,QAAQ,IAAK,QAAQ,KAAM,QAAQ,IAAK,QAAQ,IAAK,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,MAAO,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,kBAAkB,KAAM,kBAAkB,KAAM,QAAQ,KAAM,kBAAkB,KAAM,kBAAkB,KAAM,QAAQ,KAAM,QAAQ,MAAO,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,kBAAkB,KAAM,kBAAkB,KAAM,QAAQ,KAAM,kBAAkB,KAAM,kBAAkB,KAAM,QAAQ,KAAM,kBAAkB,KAAM,kBAAkB,KAAM,QAAQ,KAAM,QAAQ,IAAK,mBAAmB,KAAM,mBAAmB,KAAM,mBAAmB,KAAM,mBAAmB,KAAM,mBAAmB,KAAM,mBAAmB,KAAM,mBAAmB,KAAM,mBAAmB,KAAM,mBAAmB,KAAM,mBAAmB,KAAM,mBAAmB,KAAM,mBAAmB,KAAM,mBAAmB,KAAM,mBAAmB,KAAM,mBAAmB,KAAM,8BAA8B,KAAM,mBAAmB,KAAM,mBAAmB,KAAM,mBAAmB,KAAM,mBAAmB,KAAM,mBAAmB,KAAM,mBAAmB,KAAM,mBAAmB,KAAM,kBAAkB,KAAM,kBAAkB,KAAM,kBAAkB,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,kBAAkB,KAAM,kBAAkB,KAAM,QAAQ,KAAM,QAAQ,KAAM,kBAAkB,KAAM,kBAAkB,KAAM,QAAQ,KAAM,kBAAkB,KAAM,kBAAkB,KAAM,QAAQ,KAAM,kBAAkB,KAAM,kBAAkB,KAAM,QAAQ,KAAM,kBAAkB,KAAM,kBAAkB,KAAM,QAAQ,KAAM,kBAAkB,KAAM,kBAAkB,KAAM,QAAQ,KAAM,kBAAkB,KAAM,kBAAkB,KAAM,QAAQ,KAAM,kBAAkB,KAAM,kBAAkB,KAAM,QAAQ,KAAM,kBAAkB,KAAM,kBAAkB,KAAM,QAAQ,KAAM,kBAAkB,KAAM,kBAAkB,KAAM,QAAQ,KAAM,kBAAkB,KAAM,kBAAkB,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,KAAM,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,KAAM,QAAQ,MAAO,QAAQ,KAAM,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,KAAM,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,KAAM,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,OAAO,MAAO,OAAO,MAAO,OAAO,MAAO,OAAO,KAAM,OAAO,KAAM,OAAO,MAAO,OAAO,MAAO,OAAO,MAAO,OAAO,MAAO,OAAO,MAAO,OAAO,MAAO,OAAO,MAAO,OAAO,MAAO,OAAO,KAAM,OAAO,KAAM,OAAO,KAAM,OAAO,KAAM,OAAO,MAAO,OAAO,MAAO,OAAO,MAAO,OAAO,MAAO,OAAO,MAAO,OAAO,MAAO,OAAO,MAAO,OAAO,MAAO,OAAO,MAAO,OAAO,MAAO,OAAO,MAAO,OAAO,MAAO,OAAO,MAAO,OAAO,KAAM,OAAO,MAAO,OAAO,MAAO,OAAO,MAAO,OAAO,IAAK,OAAO,MAAO,OAAO,MAAO,OAAO,MAAO,OAAO,MAAO,OAAO,MAAO,OAAO,MAAO,OAAO,MAAO,OAAO,MAAO,OAAO,MAAO,OAAO,MAAO,OAAO,MAAO,OAAO,MAAO,OAAO,MAAO,OAAO,MAAO,OAAO,MAAO,OAAO,MAAO,OAAO,MAAO,OAAO,MAAO,OAAO,MAAO,OAAO,MAAO,OAAO,MAAO,OAAO,MAAO,OAAO,KAAM,OAAO,KAAO,OAAO,MAAO,OAAO,MAAO,OAAO,MAAO,OAAO,MAAO,OAAO,MAAO,OAAO,KAAM,OAAO,KAAM,OAAO,KAAM,OAAO,MAAO,OAAO,KAAM,OAAO,MAAO,OAAO,KAAM,OAAO,KAAM,OAAO,KAAM,OAAO,MAAO,iBAAiB,KAAM,iBAAiB,KAAM,OAAO,KAAM,OAAO,KAAM,OAAO,KAAM,OAAO,KAAM,OAAO,KAAM,OAAO,KAAM,OAAO,KAAM,OAAO,MAAO,OAAO,MAAO,OAAO,MAAO,OAAO,MAAO,kBAAkB,KAAM,kBAAkB,KAAM,OAAO,MAAO,OAAO,MAAO,OAAO,MAAO,OAAO,MAAO,OAAO,MAAO,OAAO,MAAO,OAAO,MAAO,OAAO,MAAO,OAAO,KAAM,OAAO,MAAO,OAAO,MAAO,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,aAAa,EAAG,aAAa,EAAG,aAAa,EAAG,aAAa,EAAG,aAAa,EAAG,uBAAuB,EAA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","sources":["webpack://tweb/./src/components/animationIntersector.ts","webpack://tweb/./src/components/appMediaPlaybackController.ts","webpack://tweb/./src/components/appMediaViewer.ts","webpack://tweb/./src/lib/mediaPlayer.ts","webpack://tweb/./src/components/appMediaViewerBase.ts","webpack://tweb/./src/helpers/fillPropertyValue.ts","webpack://tweb/./src/components/appNavigationController.ts","webpack://tweb/./src/components/appSearch.ts","webpack://tweb/./src/components/appSearchSuper..ts","webpack://tweb/./src/helpers/dom/lockTouchScroll.ts","webpack://tweb/./src/components/appSelectPeers.ts","webpack://tweb/./src/components/audio.ts","webpack://tweb/./src/helpers/avatarListLoader.ts","webpack://tweb/./src/components/appMediaViewerAvatar.ts","webpack://tweb/./src/components/avatar.ts","webpack://tweb/./src/components/avatarEdit.ts","webpack://tweb/./src/components/button.ts","webpack://tweb/./src/components/buttonCorner.ts","webpack://tweb/./src/components/buttonIcon.ts","webpack://tweb/./src/components/buttonMenu.ts","webpack://tweb/./src/components/buttonMenuToggle.ts","webpack://tweb/./src/components/chat/gradientRenderer.ts","webpack://tweb/./src/components/chat/replyContainer.ts","webpack://tweb/./src/components/chat/selection.ts","webpack://tweb/./src/helpers/dom/getSelectedText.ts","webpack://tweb/./src/components/checkboxField.ts","webpack://tweb/./src/components/codeInputField.ts","webpack://tweb/./src/components/confirmationPopup.ts","webpack://tweb/./src/components/countryInputField.ts","webpack://tweb/./src/components/divAndCaption.ts","webpack://tweb/./src/components/editPeer.ts","webpack://tweb/./src/components/emoticonsDropdown/tabs/gifs.ts","webpack://tweb/./src/components/sidebarRight/tabs/gifs.ts","webpack://tweb/./src/components/sidebarRight/tabs/stickers.ts","webpack://tweb/./src/components/emoticonsDropdown/index.ts","webpack://tweb/./src/components/emoticonsDropdown/tabs/emoji.ts","webpack://tweb/./src/lib/richTextProcessor/wrapSingleEmoji.ts","webpack://tweb/./src/components/lazyLoadQueueRepeat.ts","webpack://tweb/./src/components/emoticonsDropdown/tabs/stickers.ts","webpack://tweb/./src/components/generateFakeIcon.ts","webpack://tweb/./src/components/lazyLoadQueueRepeat2.ts","webpack://tweb/./src/components/gifsMasonry.ts","webpack://tweb/./src/components/horizontalMenu.ts","webpack://tweb/./src/components/inputField.ts","webpack://tweb/./src/helpers/dom/selectElementContents.ts","webpack://tweb/./src/components/inputSearch.ts","webpack://tweb/./src/components/lazyLoadQueue.ts","webpack://tweb/./src/components/lazyLoadQueueIntersector.ts","webpack://tweb/./src/components/mediaProgressLine.ts","webpack://tweb/./src/components/middleEllipsis.ts","webpack://tweb/./src/components/monkeys/password.ts","webpack://tweb/./src/components/monkeys/tracking.ts","webpack://tweb/./src/components/passwordInputField.ts","webpack://tweb/./src/components/peerProfileAvatars.ts","webpack://tweb/./src/components/peerProfile.ts","webpack://tweb/./src/components/generateTitleIcons.ts","webpack://tweb/./src/components/generateVerifiedIcon.ts","webpack://tweb/./src/components/generatePremiumIcon.ts","webpack://tweb/./src/components/peerTitle.ts","webpack://tweb/./src/components/popups/avatar.ts","webpack://tweb/./src/lib/cropper.ts","webpack://tweb/./src/components/popups/deleteDialog.ts","webpack://tweb/./src/components/popups/deleteMessages.ts","webpack://tweb/./src/components/popups/forward.ts","webpack://tweb/./src/components/popups/index.ts","webpack://tweb/./src/components/popups/mute.ts","webpack://tweb/./src/components/popups/peer.ts","webpack://tweb/./src/components/popups/pickUser.ts","webpack://tweb/./src/components/popups/sendNow.ts","webpack://tweb/./src/components/popups/stickers.ts","webpack://tweb/./src/components/preloader.ts","webpack://tweb/./src/components/groupedLayout.ts","webpack://tweb/./src/components/prepareAlbum.ts","webpack://tweb/./src/components/putPhoto.ts","webpack://tweb/./src/components/wrappers/getPeerInitials.ts","webpack://tweb/./src/components/putPreloader.ts","webpack://tweb/./src/components/radioField.ts","webpack://tweb/./src/components/radioForm.ts","webpack://tweb/./src/components/rangeSelector.ts","webpack://tweb/./src/components/ripple.ts","webpack://tweb/./src/components/row.ts","webpack://tweb/./src/components/scrollable.ts","webpack://tweb/./src/components/sidebarLeft/tabs/newGroup.ts","webpack://tweb/./src/lib/appManagers/utils/privacy/privacyType.ts","webpack://tweb/./src/lib/appManagers/utils/privacy/getPrivacyRulesDetails.ts","webpack://tweb/./src/components/privacySection.ts","webpack://tweb/./src/components/sidebarLeft/tabs/privacy/phoneNumber.ts","webpack://tweb/./src/helpers/dom/anchorCopy.ts","webpack://tweb/./src/components/sidebarLeft/tabs/2fa/passwordSet.ts","webpack://tweb/./src/helpers/dom/canFocus.ts","webpack://tweb/./src/components/sidebarLeft/tabs/2fa/emailConfirmation.ts","webpack://tweb/./src/components/sidebarLeft/tabs/2fa/email.ts","webpack://tweb/./src/components/sidebarLeft/tabs/2fa/hint.ts","webpack://tweb/./src/components/sidebarLeft/tabs/2fa/reEnterPassword.ts","webpack://tweb/./src/components/sidebarLeft/tabs/2fa/enterPassword.ts","webpack://tweb/./src/components/sidebarLeft/tabs/2fa/index.ts","webpack://tweb/./src/components/sidebarLeft/tabs/privacy/lastSeen.ts","webpack://tweb/./src/components/sidebarLeft/tabs/privacy/profilePhoto.ts","webpack://tweb/./src/components/sidebarLeft/tabs/privacy/forwardMessages.ts","webpack://tweb/./src/components/sidebarLeft/tabs/privacy/addToGroups.ts","webpack://tweb/./src/components/sidebarLeft/tabs/privacy/calls.ts","webpack://tweb/./src/components/sidebarLeft/tabs/activeSessions.ts","webpack://tweb/./src/components/sidebarLeft/tabs/blockedUsers.ts","webpack://tweb/./src/helpers/string/convertKeyToInputKey.ts","webpack://tweb/./src/components/sidebarLeft/tabs/privacy/voices.ts","webpack://tweb/./src/components/sidebarLeft/tabs/privacyAndSecurity.ts","webpack://tweb/./src/helpers/averageColor.ts","webpack://tweb/./src/helpers/highlightningColor.ts","webpack://tweb/./src/components/colorPicker.ts","webpack://tweb/./src/components/sidebarLeft/tabs/backgroundColor.ts","webpack://tweb/./src/components/sidebarLeft/tabs/background.ts","webpack://tweb/./src/helpers/files/requestFile.ts","webpack://tweb/./src/components/sidebarLeft/tabs/quickReaction.ts","webpack://tweb/./src/components/sidebarLeft/tabs/generalSettings.ts","webpack://tweb/./src/helpers/eachMinute.ts","webpack://tweb/./src/helpers/eachTimeout.ts","webpack://tweb/./src/components/sidebarLeft/tabs/editProfile.ts","webpack://tweb/./src/components/sidebarLeft/tabs/notifications.ts","webpack://tweb/./src/components/sidebarLeft/tabs/language.ts","webpack://tweb/./src/components/sidebarLeft/tabs/autoDownload/photo.ts","webpack://tweb/./src/components/sidebarLeft/tabs/autoDownload/file.ts","webpack://tweb/./src/components/sidebarLeft/tabs/autoDownload/video.ts","webpack://tweb/./src/components/sidebarLeft/tabs/dataAndStorage.ts","webpack://tweb/./src/components/sidebarLeft/tabs/settings.ts","webpack://tweb/./src/components/sidebarLeft/tabs/newChannel.ts","webpack://tweb/./src/components/popups/createContact.ts","webpack://tweb/./src/components/sidebarLeft/tabs/contacts.ts","webpack://tweb/./src/components/sidebarLeft/tabs/archivedTab.ts","webpack://tweb/./src/components/sidebarLeft/tabs/peopleNearby.ts","webpack://tweb/./src/components/sidebarLeft/index.ts","webpack://tweb/./src/components/sidebarLeft/tabs/addMembers.ts","webpack://tweb/./src/components/sidebarLeft/tabs/chatFolders.ts","webpack://tweb/./src/components/sidebarLeft/tabs/includedChats.ts","webpack://tweb/./src/components/sidebarLeft/tabs/editFolder.ts","webpack://tweb/./src/components/sidebarRight/index.ts","webpack://tweb/./src/components/sidebarRight/tabs/editContact.ts","webpack://tweb/./src/components/sidebarRight/tabs/chatType.ts","webpack://tweb/./src/components/sidebarRight/tabs/userPermissions.ts","webpack://tweb/./src/components/sidebarRight/tabs/groupPermissions.ts","webpack://tweb/./src/lib/appManagers/utils/chats/combineParticipantBannedRights.ts","webpack://tweb/./src/components/sidebarRight/tabs/chatReactions.ts","webpack://tweb/./src/components/sidebarRight/tabs/editChat.ts","webpack://tweb/./src/components/sidebarRight/tabs/sharedMedia.ts","webpack://tweb/./src/components/singleTransition.ts","webpack://tweb/./src/components/slider.ts","webpack://tweb/./src/components/sliderTab.ts","webpack://tweb/./src/components/sortedUserList.ts","webpack://tweb/./src/components/stackedAvatars.ts","webpack://tweb/./src/components/stickerViewer.ts","webpack://tweb/./src/components/stickyIntersector.ts","webpack://tweb/./src/components/swipeHandler.ts","webpack://tweb/./src/components/telInputField.ts","webpack://tweb/./src/components/toast.ts","webpack://tweb/./src/components/transition.ts","webpack://tweb/./src/lib/richTextProcessor/isUsernameValid.ts","webpack://tweb/./src/components/usernameInputField.ts","webpack://tweb/./src/components/visibilityIntersector.ts","webpack://tweb/./src/components/volumeSelector.ts","webpack://tweb/./src/components/wrappers/photo.ts","webpack://tweb/./src/components/wrappers/video.ts","webpack://tweb/./src/components/wrappers/album.ts","webpack://tweb/./src/components/wrappers/document.ts","webpack://tweb/./src/components/wrappers/groupedDocuments.ts","webpack://tweb/./src/components/sidebarRight/tabs/pollResults.ts","webpack://tweb/./src/components/poll.ts","webpack://tweb/./src/components/wrappers/poll.ts","webpack://tweb/./src/components/wrappers/reply.ts","webpack://tweb/./src/components/wrappers/stickerSetThumb.ts","webpack://tweb/./src/components/wrappers/stickerToRow.ts","webpack://tweb/./src/components/wrappers/formatUserPhone.ts","webpack://tweb/./src/components/wrappers/getChatMembersString.ts","webpack://tweb/./src/components/wrappers/getPeerTitle.ts","webpack://tweb/./src/components/wrappers/getUserStatusString.ts","webpack://tweb/./src/components/wrappers/joinVoiceChatAnchor.ts","webpack://tweb/./src/components/wrappers/messageActionTextNewUnsafe.ts","webpack://tweb/./src/components/wrappers/messageActionTextNew.ts","webpack://tweb/./src/components/wrappers/messageForReply.ts","webpack://tweb/./src/components/wrappers/peerTitle.ts","webpack://tweb/./src/components/wrappers/senderToPeer.ts","webpack://tweb/./src/components/wrappers/sentTime.ts","webpack://tweb/./src/components/wrappers/sticker.ts","webpack://tweb/./src/helpers/bytes/getPathFromBytes.ts","webpack://tweb/./src/helpers/computeLockColor.ts","webpack://tweb/./src/components/wrappers/stickerAnimation.ts","webpack://tweb/./src/components/wrappers/stickerEmoji.ts","webpack://tweb/./src/components/wrappers/webPageDescription.ts","webpack://tweb/./src/components/wrappers/webPageTitle.ts","webpack://tweb/./src/config/currencies.ts","webpack://tweb/./src/config/emoji.ts","webpack://tweb/./src/config/font.ts","webpack://tweb/./src/helpers/animation.ts","webpack://tweb/./src/helpers/array/accumulate.ts","webpack://tweb/./src/helpers/array/filterAsync.ts","webpack://tweb/./src/helpers/array/findAndSpliceAll.ts","webpack://tweb/./src/helpers/audioAssetPlayer.ts","webpack://tweb/./src/helpers/blob/readBlobAsDataURL.ts","webpack://tweb/./src/helpers/heavyQueue.ts","webpack://tweb/./src/helpers/blur.ts","webpack://tweb/./src/helpers/bytes/getPreviewURLFromBytes.ts","webpack://tweb/./src/helpers/bytes/bytesToDataURL.ts","webpack://tweb/./src/helpers/calcImageInBox.ts","webpack://tweb/./src/helpers/canvas/getTextWidth.ts","webpack://tweb/./src/helpers/canvas/scaleMediaElement.ts","webpack://tweb/./src/helpers/cleanSearchText.ts","webpack://tweb/./src/helpers/clipboard.ts","webpack://tweb/./src/helpers/contextMenuController.ts","webpack://tweb/./src/helpers/date.ts","webpack://tweb/./src/helpers/dom/attachContextMenuListener.ts","webpack://tweb/./src/helpers/dom/attachGrabListeners.ts","webpack://tweb/./src/helpers/dom/cancelSelection.ts","webpack://tweb/./src/helpers/dom/clickEvent.ts","webpack://tweb/./src/helpers/dom/controlsHover.ts","webpack://tweb/./src/helpers/dom/createStickersContextMenu.ts","webpack://tweb/./src/helpers/dom/createContextMenu.ts","webpack://tweb/./src/helpers/dom/createVideo.ts","webpack://tweb/./src/helpers/dom/customProperties.ts","webpack://tweb/./src/helpers/dom/dispatchEvent.ts","webpack://tweb/./src/helpers/dom/documentFragmentToHTML.ts","webpack://tweb/./src/helpers/dom/findUpAsChild.ts","webpack://tweb/./src/helpers/dom/findUpAttribute.ts","webpack://tweb/./src/helpers/dom/findUpTag.ts","webpack://tweb/./src/helpers/dom/fullScreen.ts","webpack://tweb/./src/helpers/dom/getRichElementValue.ts","webpack://tweb/./src/helpers/dom/getRichValue.ts","webpack://tweb/./src/helpers/dom/getVisibleRect.ts","webpack://tweb/./src/helpers/dom/handleHorizontalSwipe.ts","webpack://tweb/./src/helpers/dom/handleTabSwipe.ts","webpack://tweb/./src/helpers/dom/htmlToDocumentFragment.ts","webpack://tweb/./src/helpers/dom/htmlToSpan.ts","webpack://tweb/./src/helpers/dom/isInDOM.ts","webpack://tweb/./src/helpers/dom/isInputEmpty.ts","webpack://tweb/./src/helpers/dom/isSendShortcutPressed.ts","webpack://tweb/./src/helpers/dom/isSwipingBackSafari.ts","webpack://tweb/./src/helpers/dom/placeCaretAtEnd.ts","webpack://tweb/./src/helpers/dom/positionElementByIndex.ts","webpack://tweb/./src/helpers/dom/renderImageFromUrl.ts","webpack://tweb/./src/helpers/dom/renderMediaWithFadeIn.ts","webpack://tweb/./src/helpers/dom/replaceContent.ts","webpack://tweb/./src/helpers/dom/setInnerHTML.ts","webpack://tweb/./src/helpers/dom/toggleDisability.ts","webpack://tweb/./src/helpers/dom/whichChild.ts","webpack://tweb/./src/helpers/dropdownHover.ts","webpack://tweb/./src/helpers/fastSmoothScroll.ts","webpack://tweb/./src/helpers/fileName.ts","webpack://tweb/./src/helpers/filterChatPhotosMessages.ts","webpack://tweb/./src/helpers/formatBytes.ts","webpack://tweb/./src/helpers/formatCallDuration.ts","webpack://tweb/./src/helpers/formatDuration.ts","webpack://tweb/./src/helpers/formatPhoneNumber.ts","webpack://tweb/./src/helpers/generatePathData.ts","webpack://tweb/./src/helpers/getImageFromStrippedThumb.ts","webpack://tweb/./src/helpers/getPreviewURLFromThumb.ts","webpack://tweb/./src/helpers/getStrippedThumbIfNeeded.ts","webpack://tweb/./src/helpers/listLoader.ts","webpack://tweb/./src/helpers/listenerSetter.ts","webpack://tweb/./src/helpers/mediaSize.ts","webpack://tweb/./src/helpers/mediaSizes.ts","webpack://tweb/./src/helpers/middlewarePromise.ts","webpack://tweb/./src/helpers/number/clamp.ts","webpack://tweb/./src/helpers/number/formatNumber.ts","webpack://tweb/./src/helpers/number/numberThousandSplitter.ts","webpack://tweb/./src/helpers/onMediaLoad.ts","webpack://tweb/./src/helpers/overlayClickHandler.ts","webpack://tweb/./src/helpers/paymentsWrapCurrencyAmount.ts","webpack://tweb/./src/helpers/positionMenu.ts","webpack://tweb/./src/helpers/restrictions.ts","webpack://tweb/./src/helpers/saveLottiePreview.ts","webpack://tweb/./src/helpers/schedulers/throttleWithRaf.ts","webpack://tweb/./src/helpers/schedulers/throttleWith.ts","webpack://tweb/./src/helpers/scrollableLoader.ts","webpack://tweb/./src/helpers/searchListLoader.ts","webpack://tweb/./src/lib/appManagers/utils/messageId/incrementMessageId.ts","webpack://tweb/./src/helpers/sequentialDom.ts","webpack://tweb/./src/helpers/setAttachmentSize.ts","webpack://tweb/./src/helpers/sortedList.ts","webpack://tweb/./src/helpers/string/encodeEntities.ts","webpack://tweb/./src/helpers/string/escapeRegExp.ts","webpack://tweb/./src/helpers/string/limitSymbols.ts","webpack://tweb/./src/helpers/string/toHHMMSS.ts","webpack://tweb/./src/helpers/windowSize.ts","webpack://tweb/./src/hooks/useHeavyAnimationCheck.ts","webpack://tweb/./src/components/dialogsContextMenu.ts","webpack://tweb/./src/components/connectionStatus.ts","webpack://tweb/./src/components/sendingStatus.ts","webpack://tweb/./src/helpers/easing/easeInOutSine.ts","webpack://tweb/./src/helpers/canvas/roundRect.ts","webpack://tweb/./src/components/groupCallActiveIcon.ts","webpack://tweb/./src/helpers/canvas/shimmer.ts","webpack://tweb/./src/helpers/dialogsPlaceholder.ts","webpack://tweb/./src/helpers/canvas/drawCircle.ts","webpack://tweb/./src/lib/appManagers/appDialogsManager.ts","webpack://tweb/./src/lib/appManagers/appDownloadManager.ts","webpack://tweb/./src/helpers/dom/createDownloadAnchor.ts","webpack://tweb/./src/components/chat/bubbleGroups.ts","webpack://tweb/./src/helpers/array/partition.ts","webpack://tweb/./src/components/popups/datePicker.ts","webpack://tweb/./src/components/chat/reaction.ts","webpack://tweb/./src/components/chat/reactions.ts","webpack://tweb/./src/components/chat/replies.ts","webpack://tweb/./src/components/chat/messageRender.ts","webpack://tweb/./src/helpers/dom/getElementByPoint.ts","webpack://tweb/./src/helpers/dom/reflowScrollableElement.ts","webpack://tweb/./src/lib/mtproto/constants.ts","webpack://tweb/./src/lib/appManagers/internalLink.ts","webpack://tweb/./src/components/popups/joinChatInvite.ts","webpack://tweb/./src/helpers/scrollSaver.ts","webpack://tweb/./src/helpers/dom/superIntersectionObserver.ts","webpack://tweb/./src/lib/appManagers/utils/messages/isMentionUnread.ts","webpack://tweb/./src/helpers/cacheCallback.ts","webpack://tweb/./src/helpers/string/replaceNonNumber.ts","webpack://tweb/./src/helpers/cards/cardBrands.ts","webpack://tweb/./src/helpers/array/createArray.ts","webpack://tweb/./src/helpers/string/buggedNumbers.ts","webpack://tweb/./src/helpers/cards/patternCharacters.ts","webpack://tweb/./src/helpers/cards/cardFormattingPatterns.ts","webpack://tweb/./src/helpers/cards/formatValueByPattern.ts","webpack://tweb/./src/helpers/cards/validateCard.ts","webpack://tweb/./src/helpers/string/nbsp.ts","webpack://tweb/./src/components/popups/paymentVerification.ts","webpack://tweb/./src/components/popups/paymentCard.ts","webpack://tweb/./src/helpers/cards/formatInputValueByPattern.ts","webpack://tweb/./src/components/popups/paymentCardConfirmation.ts","webpack://tweb/./src/components/popups/paymentShipping.ts","webpack://tweb/./src/components/popups/paymentShippingMethods.ts","webpack://tweb/./src/components/popups/payment.ts","webpack://tweb/./src/components/chat/bubbles.ts","webpack://tweb/./src/helpers/dom/copyFromElement.ts","webpack://tweb/./src/helpers/dom/getViewportSlice.ts","webpack://tweb/./src/components/popups/unpinMessage.ts","webpack://tweb/./src/helpers/dom/isSelectionEmpty.ts","webpack://tweb/./src/helpers/preloadAnimatedEmojiSticker.ts","webpack://tweb/./src/components/popups/reportMessagesConfirm.ts","webpack://tweb/./src/components/popups/reportMessages.ts","webpack://tweb/./src/components/popups/sponsored.ts","webpack://tweb/./src/components/popups/reactedList.ts","webpack://tweb/./src/components/chat/reactionsMenu.ts","webpack://tweb/./src/components/chat/contextMenu.ts","webpack://tweb/./src/components/chat/sendContextMenu.ts","webpack://tweb/./src/components/popups/createPoll.ts","webpack://tweb/./src/helpers/createPoster.ts","webpack://tweb/./src/helpers/getGifDuration.ts","webpack://tweb/./src/components/popups/newMedia.ts","webpack://tweb/./src/helpers/dom/attachListNavigation.ts","webpack://tweb/./src/components/chat/autocompleteHelper.ts","webpack://tweb/./src/components/chat/stickersHelper.ts","webpack://tweb/./src/components/popups/schedule.ts","webpack://tweb/./src/helpers/dom/getRichValueWithCaret.ts","webpack://tweb/./src/components/chat/emojiHelper.ts","webpack://tweb/./src/components/chat/autocompletePeerHelper.ts","webpack://tweb/./src/components/chat/commandsHelper.ts","webpack://tweb/./src/components/chat/autocompleteHelperController.ts","webpack://tweb/./src/components/chat/mentionsHelper.ts","webpack://tweb/./src/components/chat/replyKeyboard.ts","webpack://tweb/./src/components/chat/inlineHelper.ts","webpack://tweb/./src/components/chat/botCommands.ts","webpack://tweb/./src/helpers/modifyAckedResult.ts","webpack://tweb/./src/components/chat/sendAs.ts","webpack://tweb/./src/components/inputFieldAnimated.ts","webpack://tweb/./src/components/chat/input.ts","webpack://tweb/./src/components/wrappers/draft.ts","webpack://tweb/./src/helpers/dom/setCaretAt.ts","webpack://tweb/./src/components/chat/pinnedContainer.ts","webpack://tweb/./src/components/chat/pinnedMessageBorder.ts","webpack://tweb/./src/components/chat/audio.ts","webpack://tweb/./src/components/chat/pinnedMessage.ts","webpack://tweb/./src/helpers/dom/handleScrollSideEvent.ts","webpack://tweb/./src/components/chat/topbar.ts","webpack://tweb/./src/components/sidebarRight/tabs/search.ts","webpack://tweb/./src/components/chat/search.ts","webpack://tweb/./src/components/chat/patternRenderer.ts","webpack://tweb/./src/components/chat/chat.ts","webpack://tweb/./src/helpers/autoDownload.ts","webpack://tweb/./src/components/chat/markupTooltip.ts","webpack://tweb/./src/helpers/dom/getSelectedNodes.ts","webpack://tweb/./src/components/chat/dragAndDrop.ts","webpack://tweb/./src/helpers/dom/disableTransition.ts","webpack://tweb/./src/components/lineBlobDrawable.ts","webpack://tweb/./src/components/topbarWeave.ts","webpack://tweb/./src/lib/rlottie/rlottieIcon.ts","webpack://tweb/./src/components/superIcon.ts","webpack://tweb/./src/components/groupCall/microphoneIcon.ts","webpack://tweb/./src/components/groupCall/participantMutedIcon.ts","webpack://tweb/./src/components/groupCall/index.ts","webpack://tweb/./src/components/groupCall/participantStatus.ts","webpack://tweb/./src/components/groupCall/participantsList.ts","webpack://tweb/./src/components/call/videoCanvasBlur.ts","webpack://tweb/./src/components/groupCall/participantVideo.ts","webpack://tweb/./src/components/groupCall/participantVideos.ts","webpack://tweb/./src/components/groupCall/participants.ts","webpack://tweb/./src/components/groupCall/description.ts","webpack://tweb/./src/components/groupCall/title.ts","webpack://tweb/./src/components/call/button.ts","webpack://tweb/./src/components/movableElement.ts","webpack://tweb/./src/helpers/movablePanel.ts","webpack://tweb/./src/helpers/toggleClassName.ts","webpack://tweb/./src/components/call/description.ts","webpack://tweb/./src/components/groupCall/microphoneIconMini.ts","webpack://tweb/./src/components/call/index.ts","webpack://tweb/./src/components/topbarCall.ts","webpack://tweb/./src/lib/appManagers/uiNotificationsManager.ts","webpack://tweb/./src/helpers/files/getFilesFromEvent.ts","webpack://tweb/./src/lib/appManagers/appImManager.ts","webpack://tweb/./src/lib/appManagers/utils/messages/getMediaFromMessage.ts","webpack://tweb/./src/lib/appManagers/utils/messages/getMessageSenderPeerIdOrName.ts","webpack://tweb/./src/lib/appManagers/utils/messages/isMessageRestricted.ts","webpack://tweb/./src/lib/appManagers/utils/peers/getPeerColorById.ts","webpack://tweb/./src/lib/appManagers/utils/photos/choosePhotoSize.ts","webpack://tweb/./src/lib/calls/callConnectionInstanceBase.ts","webpack://tweb/./src/lib/calls/helpers/createPeerConnection.ts","webpack://tweb/./src/lib/calls/helpers/createDataChannel.ts","webpack://tweb/./src/lib/calls/helpers/parseSignalingData.ts","webpack://tweb/./src/lib/calls/callConnectionInstance.ts","webpack://tweb/./src/lib/crypto/subtle.ts","webpack://tweb/./src/lib/calls/p2P/p2PEncryptor.ts","webpack://tweb/./src/lib/crypto/utils/sha256.ts","webpack://tweb/./src/lib/calls/p2P/chromeP2PSdpBuilder.ts","webpack://tweb/./src/lib/calls/p2P/p2PSdpBuilder.js","webpack://tweb/./src/lib/calls/p2P/firefoxP2PSdpBuilder.js","webpack://tweb/./src/lib/calls/p2P/safariP2PSdpBuilder.js","webpack://tweb/./src/lib/calls/callInstance.ts","webpack://tweb/./src/lib/calls/p2P/getCallProtocol.ts","webpack://tweb/./src/lib/calls/p2P/getRtcConfiguration.ts","webpack://tweb/./src/lib/calls/helpers/getStreamCached.ts","webpack://tweb/./src/lib/calls/callInstanceBase.ts","webpack://tweb/./src/lib/calls/callState.ts","webpack://tweb/./src/components/call/getAudioAsset.ts","webpack://tweb/./src/lib/calls/callsController.ts","webpack://tweb/./src/lib/calls/constants.ts","webpack://tweb/./src/lib/calls/groupCallConnectionInstance.ts","webpack://tweb/./src/lib/calls/helpers/processMediaSection.ts","webpack://tweb/./src/lib/calls/helpers/filterServerCodecs.ts","webpack://tweb/./src/lib/calls/helpers/fixLocalOffer.ts","webpack://tweb/./src/lib/calls/groupCallInstance.ts","webpack://tweb/./src/lib/calls/groupCallState.ts","webpack://tweb/./src/components/groupCall/getAudioAsset.ts","webpack://tweb/./src/lib/calls/groupCallsController.ts","webpack://tweb/./src/lib/calls/helpers/createMainStreamManager.ts","webpack://tweb/./src/lib/calls/helpers/getAudioConstraints.ts","webpack://tweb/./src/environment/constraintSupport.ts","webpack://tweb/./src/lib/calls/helpers/getScreenConstraints.ts","webpack://tweb/./src/lib/calls/helpers/getScreenStream.ts","webpack://tweb/./src/lib/calls/helpers/getStream.ts","webpack://tweb/./src/lib/calls/helpers/getVideoConstraints.ts","webpack://tweb/./src/lib/calls/helpers/parseMediaSectionInfo.ts","webpack://tweb/./src/lib/calls/helpers/parseSourceGroups.ts","webpack://tweb/./src/lib/calls/helpers/stopTrack.ts","webpack://tweb/./src/lib/calls/localConferenceDescription.ts","webpack://tweb/./src/lib/calls/sdp/index.ts","webpack://tweb/./src/helpers/string/splitStringByLimitWithRest.ts","webpack://tweb/./src/helpers/uniqueNumberGenerator.ts","webpack://tweb/./src/lib/calls/sdp/attributeSplitted.ts","webpack://tweb/./src/lib/calls/sdp/mediaLineParts.ts","webpack://tweb/./src/lib/calls/sdp/line.ts","webpack://tweb/./src/lib/calls/sdp/attributeInner.ts","webpack://tweb/./src/lib/calls/sdp/attributes.ts","webpack://tweb/./src/lib/calls/sdp/mediaSection.ts","webpack://tweb/./src/lib/calls/sdp/sessionSection.ts","webpack://tweb/./src/lib/calls/sdp/utils.ts","webpack://tweb/./src/lib/calls/sdpBuilder.ts","webpack://tweb/./src/lib/calls/streamManager.ts","webpack://tweb/./src/lib/calls/stringFromLineBuilder.ts","webpack://tweb/./src/lib/calls/utils.ts","webpack://tweb/./src/lib/richTextProcessor/getAbbreviation.ts","webpack://tweb/./src/lib/richTextProcessor/getEmojiEntityFromEmoji.ts","webpack://tweb/./src/lib/richTextProcessor/matchEmail.ts","webpack://tweb/./src/lib/richTextProcessor/wrapDraftText.ts","webpack://tweb/./src/lib/richTextProcessor/wrapEmojiText.ts","webpack://tweb/./src/lib/richTextProcessor/setBlankToAnchor.ts","webpack://tweb/./src/environment/emojiVersionsSupport.ts","webpack://tweb/./src/lib/richTextProcessor/wrapRichText.ts","webpack://tweb/./src/helpers/buildURLHash.ts","webpack://tweb/./src/lib/rlottie/queryableWorker.ts","webpack://tweb/./src/environment/webAssemblySupport.ts","webpack://tweb/./src/lib/rlottie/lottieLoader.ts","webpack://tweb/./src/environment/imageBitmapSupport.ts","webpack://tweb/./src/lib/rlottie/rlottiePlayer.ts","webpack://tweb/./src/pages/pagesManager.ts","webpack://tweb/./src/pages/page.ts","webpack://tweb/./src/vendor/emoji/index.ts","webpack://tweb/./public/recorder.min.js"],"sourcesContent":["/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport type {CustomEmojiRendererElement} from '../lib/richTextProcessor/wrapRichText';\r\nimport rootScope from '../lib/rootScope';\r\nimport {IS_SAFARI} from '../environment/userAgent';\r\nimport {MOUNT_CLASS_TO} from '../config/debug';\r\nimport isInDOM from '../helpers/dom/isInDOM';\r\nimport RLottiePlayer from '../lib/rlottie/rlottiePlayer';\r\nimport indexOfAndSplice from '../helpers/array/indexOfAndSplice';\r\nimport forEachReverse from '../helpers/array/forEachReverse';\r\nimport idleController from '../helpers/idleController';\r\nimport appMediaPlaybackController from './appMediaPlaybackController';\r\nimport {fastRaf} from '../helpers/schedulers';\r\n\r\nexport type AnimationItemGroup = '' | 'none' | 'chat' | 'lock' |\r\n  'STICKERS-POPUP' | 'emoticons-dropdown' | 'STICKERS-SEARCH' | 'GIFS-SEARCH' |\r\n  `CHAT-MENU-REACTIONS-${number}` | 'INLINE-HELPER' | 'GENERAL-SETTINGS' | 'STICKER-VIEWER' | 'EMOJI';\r\nexport interface AnimationItem {\r\n  el: HTMLElement,\r\n  group: AnimationItemGroup,\r\n  animation: RLottiePlayer | HTMLVideoElement | CustomEmojiRendererElement\r\n};\r\n\r\nexport class AnimationIntersector {\r\n  private observer: IntersectionObserver;\r\n  private visible: Set<AnimationItem> = new Set();\r\n\r\n  private overrideIdleGroups: Set<string>;\r\n  private byGroups: {[group in AnimationItemGroup]?: AnimationItem[]} = {};\r\n  private lockedGroups: {[group in AnimationItemGroup]?: true} = {};\r\n  private onlyOnePlayableGroup: AnimationItemGroup = '';\r\n\r\n  private intersectionLockedGroups: {[group in AnimationItemGroup]?: true} = {};\r\n  private videosLocked = false;\r\n\r\n  constructor() {\r\n    this.observer = new IntersectionObserver((entries) => {\r\n      // if(rootScope.idle.isIDLE) return;\r\n\r\n      for(const entry of entries) {\r\n        const target = entry.target;\r\n\r\n        for(const group in this.byGroups) {\r\n          if(this.intersectionLockedGroups[group as AnimationItemGroup]) {\r\n            continue;\r\n          }\r\n\r\n          const animation = this.byGroups[group as AnimationItemGroup].find((p) => p.el === target);\r\n          if(!animation) {\r\n            continue;\r\n          }\r\n\r\n          if(entry.isIntersecting) {\r\n            this.visible.add(animation);\r\n            this.checkAnimation(animation, false);\r\n\r\n            /* if(animation instanceof HTMLVideoElement && animation.dataset.src) {\r\n              animation.src = animation.dataset.src;\r\n              animation.load();\r\n            } */\r\n          } else {\r\n            this.visible.delete(animation);\r\n            this.checkAnimation(animation, true);\r\n\r\n            const _animation = animation.animation;\r\n            if(_animation instanceof RLottiePlayer/*  && animation.cachingDelta === 2 */) {\r\n              // console.warn('will clear cache', player);\r\n              _animation.clearCache();\r\n            }/*  else if(animation instanceof HTMLVideoElement && animation.src) {\r\n              animation.dataset.src = animation.src;\r\n              animation.src = '';\r\n              animation.load();\r\n            } */\r\n          }\r\n\r\n          break;\r\n        }\r\n      }\r\n    });\r\n\r\n    this.overrideIdleGroups = new Set();\r\n\r\n    appMediaPlaybackController.addEventListener('play', ({doc}) => {\r\n      if(doc.type === 'round') {\r\n        this.videosLocked = true;\r\n        this.checkAnimations();\r\n      }\r\n    });\r\n\r\n    appMediaPlaybackController.addEventListener('pause', () => {\r\n      if(this.videosLocked) {\r\n        this.videosLocked = false;\r\n        this.checkAnimations();\r\n      }\r\n    });\r\n\r\n    idleController.addEventListener('change', (idle) => {\r\n      this.checkAnimations(idle);\r\n    });\r\n  }\r\n\r\n  public setOverrideIdleGroup(group: string, override: boolean) {\r\n    if(override) this.overrideIdleGroups.add(group);\r\n    else this.overrideIdleGroups.delete(group);\r\n  }\r\n\r\n  public getAnimations(element: HTMLElement) {\r\n    const found: AnimationItem[] = [];\r\n    for(const group in this.byGroups) {\r\n      for(const player of this.byGroups[group as AnimationItemGroup]) {\r\n        if(player.el === element) {\r\n          found.push(player);\r\n        }\r\n      }\r\n    }\r\n\r\n    return found;\r\n  }\r\n\r\n  public removeAnimation(player: AnimationItem) {\r\n    const {el, animation} = player;\r\n    animation.remove();\r\n\r\n    if(animation instanceof HTMLVideoElement && IS_SAFARI) {\r\n      setTimeout(() => { // TODO:   ,       \r\n        animation.src = '';\r\n        animation.load();\r\n      }, 1e3);\r\n    }\r\n\r\n    const group = this.byGroups[player.group];\r\n    if(group) {\r\n      indexOfAndSplice(group, player);\r\n      if(!group.length) {\r\n        delete this.byGroups[player.group];\r\n      }\r\n    }\r\n\r\n    this.observer.unobserve(el);\r\n    this.visible.delete(player);\r\n  }\r\n\r\n  public addAnimation(_animation: AnimationItem['animation'], group: AnimationItemGroup = '') {\r\n    const animation: AnimationItem = {\r\n      el: _animation instanceof RLottiePlayer ? _animation.el[0] : (_animation instanceof HTMLVideoElement ? _animation : _animation.canvas),\r\n      animation: _animation,\r\n      group\r\n    };\r\n\r\n    if(_animation instanceof RLottiePlayer) {\r\n      if(!rootScope.settings.stickers.loop && _animation.loop) {\r\n        _animation.loop = rootScope.settings.stickers.loop;\r\n      }\r\n    }\r\n\r\n    (this.byGroups[group as AnimationItemGroup] ??= []).push(animation);\r\n    this.observer.observe(animation.el);\r\n  }\r\n\r\n  public checkAnimations(blurred?: boolean, group?: AnimationItemGroup, destroy = false) {\r\n    // if(rootScope.idle.isIDLE) return;\r\n\r\n    if(group !== undefined && !this.byGroups[group]) {\r\n      // console.warn('no animation group:', group);\r\n      return;\r\n    }\r\n\r\n    const groups = group !== undefined /* && false */ ? [group] : Object.keys(this.byGroups) as AnimationItemGroup[];\r\n\r\n    for(const group of groups) {\r\n      const animations = this.byGroups[group];\r\n\r\n      forEachReverse(animations, (animation) => {\r\n        this.checkAnimation(animation, blurred, destroy);\r\n      });\r\n    }\r\n  }\r\n\r\n  public checkAnimation(player: AnimationItem, blurred = false, destroy = false) {\r\n    const {el, animation, group} = player;\r\n    // return;\r\n    if(destroy || (!this.lockedGroups[group] && !isInDOM(el))) {\r\n      this.removeAnimation(player);\r\n      return;\r\n    }\r\n\r\n    if(blurred || (this.onlyOnePlayableGroup && this.onlyOnePlayableGroup !== group) || (animation instanceof HTMLVideoElement && this.videosLocked)) {\r\n      if(!animation.paused) {\r\n        // console.warn('pause animation:', animation);\r\n        animation.pause();\r\n      }\r\n    } else if(animation.paused &&\r\n      this.visible.has(player) &&\r\n      animation.autoplay &&\r\n      (!this.onlyOnePlayableGroup || this.onlyOnePlayableGroup === group) &&\r\n      (!idleController.isIdle || this.overrideIdleGroups.has(player.group))\r\n    ) {\r\n      // console.warn('play animation:', animation);\r\n      animation.play();\r\n    }\r\n  }\r\n\r\n  public getOnlyOnePlayableGroup() {\r\n    return this.onlyOnePlayableGroup;\r\n  }\r\n\r\n  public setOnlyOnePlayableGroup(group: AnimationItemGroup = '') {\r\n    this.onlyOnePlayableGroup = group;\r\n  }\r\n\r\n  public lockGroup(group: AnimationItemGroup) {\r\n    this.lockedGroups[group] = true;\r\n  }\r\n\r\n  public unlockGroup(group: AnimationItemGroup) {\r\n    delete this.lockedGroups[group];\r\n    this.checkAnimations(undefined, group);\r\n  }\r\n\r\n  public refreshGroup(group: AnimationItemGroup) {\r\n    const animations = this.byGroups[group];\r\n    if(!animations?.length) {\r\n      return;\r\n    }\r\n\r\n    animations.forEach((animation) => {\r\n      this.observer.unobserve(animation.el);\r\n    });\r\n\r\n    fastRaf(() => {\r\n      animations.forEach((animation) => {\r\n        this.observer.observe(animation.el);\r\n      });\r\n    });\r\n  }\r\n\r\n  public lockIntersectionGroup(group: AnimationItemGroup) {\r\n    this.intersectionLockedGroups[group] = true;\r\n  }\r\n\r\n  public unlockIntersectionGroup(group: AnimationItemGroup) {\r\n    delete this.intersectionLockedGroups[group];\r\n    this.refreshGroup(group);\r\n  }\r\n}\r\n\r\nconst animationIntersector = new AnimationIntersector();\r\nMOUNT_CLASS_TO && (MOUNT_CLASS_TO.animationIntersector = animationIntersector);\r\nexport default animationIntersector;\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport rootScope from '../lib/rootScope';\r\nimport {MyDocument} from '../lib/appManagers/appDocsManager';\r\nimport deferredPromise, {CancellablePromise} from '../helpers/cancellablePromise';\r\nimport {IS_APPLE, IS_SAFARI} from '../environment/userAgent';\r\nimport {MOUNT_CLASS_TO} from '../config/debug';\r\nimport simulateEvent from '../helpers/dom/dispatchEvent';\r\nimport type {SearchSuperContext} from './appSearchSuper.';\r\nimport {Document, DocumentAttribute, Message, PhotoSize} from '../layer';\r\nimport IS_TOUCH_SUPPORTED from '../environment/touchSupport';\r\nimport I18n from '../lib/langPack';\r\nimport SearchListLoader from '../helpers/searchListLoader';\r\nimport copy from '../helpers/object/copy';\r\nimport deepEqual from '../helpers/object/deepEqual';\r\nimport ListenerSetter from '../helpers/listenerSetter';\r\nimport {AppManagers} from '../lib/appManagers/managers';\r\nimport getMediaFromMessage from '../lib/appManagers/utils/messages/getMediaFromMessage';\r\nimport getPeerTitle from './wrappers/getPeerTitle';\r\nimport appDownloadManager from '../lib/appManagers/appDownloadManager';\r\nimport onMediaLoad from '../helpers/onMediaLoad';\r\nimport EventListenerBase from '../helpers/eventListenerBase';\r\n\r\n// TODO: Safari:  ,          \r\n// TODO: Safari:     \r\n// TODO: Safari:  ,         -    \r\n\r\nexport type MediaItem = {mid: number, peerId: PeerId};\r\n\r\ntype HTMLMediaElement = HTMLAudioElement | HTMLVideoElement;\r\n\r\nconst SHOULD_USE_SAFARI_FIX = (() => {\r\n  try {\r\n    return IS_SAFARI && +navigator.userAgent.match(/ Version\\/(\\d+)/)[1] < 14;\r\n  } catch(err) {\r\n    return false;\r\n  }\r\n})();\r\n\r\nconst SEEK_OFFSET = 10;\r\n\r\nexport type MediaSearchContext = SearchSuperContext & Partial<{\r\n  isScheduled: boolean,\r\n  useSearch: boolean\r\n}>;\r\n\r\ntype MediaDetails = {\r\n  peerId: PeerId,\r\n  mid: number,\r\n  docId: DocId,\r\n  doc: MyDocument,\r\n  message: Message.message,\r\n  clean?: boolean,\r\n  isScheduled?: boolean,\r\n  isSingle?: boolean\r\n};\r\n\r\nexport type PlaybackMediaType = 'voice' | 'video' | 'audio';\r\n\r\nexport class AppMediaPlaybackController extends EventListenerBase<{\r\n  play: (details: ReturnType<AppMediaPlaybackController['getPlayingDetails']>) => void,\r\n  pause: () => void,\r\n  playbackParams: (params: ReturnType<AppMediaPlaybackController['getPlaybackParams']>) => void,\r\n  stop: () => void,\r\n}> {\r\n  private container: HTMLElement;\r\n  private media: Map<PeerId, Map<number, HTMLMediaElement>> = new Map();\r\n  private scheduled: AppMediaPlaybackController['media'] = new Map();\r\n  private mediaDetails: Map<HTMLMediaElement, MediaDetails> = new Map();\r\n  private playingMedia: HTMLMediaElement;\r\n  private playingMediaType: PlaybackMediaType;\r\n\r\n  private waitingMediaForLoad: Map<PeerId, Map<number, CancellablePromise<void>>> = new Map();\r\n  private waitingScheduledMediaForLoad: AppMediaPlaybackController['waitingMediaForLoad'] = new Map();\r\n  private waitingDocumentsForLoad: {[docId: string]: Set<HTMLMediaElement>} = {};\r\n\r\n  public willBePlayedMedia: HTMLMediaElement;\r\n  private searchContext: MediaSearchContext;\r\n\r\n  private listLoader: SearchListLoader<MediaItem>;\r\n\r\n  public volume: number;\r\n  public muted: boolean;\r\n  public playbackRate: number;\r\n  public loop: boolean;\r\n  public round: boolean;\r\n  private _volume: number;\r\n  private _muted: boolean;\r\n  private _playbackRate: number;\r\n  private _loop: boolean;\r\n  private _round: boolean;\r\n  private lockedSwitchers: boolean;\r\n  private playbackRates: Record<PlaybackMediaType, number> = {\r\n    voice: 1,\r\n    video: 1,\r\n    audio: 1\r\n  };\r\n\r\n  private pip: HTMLVideoElement;\r\n  private managers: AppManagers;\r\n  private skipMediaPlayEvent: boolean;\r\n\r\n  construct(managers: AppManagers) {\r\n    this.managers = managers;\r\n    this.container = document.createElement('div');\r\n    // this.container.style.cssText = 'position: absolute; top: -10000px; left: -10000px;';\r\n    this.container.style.cssText = 'display: none;';\r\n    document.body.append(this.container);\r\n\r\n    if(navigator.mediaSession) {\r\n      const actions: {[action in MediaSessionAction]?: MediaSessionActionHandler} = {\r\n        play: this.browserPlay,\r\n        pause: this.browserPause,\r\n        stop: this.browserStop,\r\n        seekbackward: this.browserSeekBackward,\r\n        seekforward: this.browserSeekForward,\r\n        seekto: this.browserSeekTo,\r\n        previoustrack: this.browserPrevious,\r\n        nexttrack: this.browserNext\r\n      };\r\n\r\n      for(const action in actions) {\r\n        try {\r\n          navigator.mediaSession.setActionHandler(action as MediaSessionAction, actions[action as MediaSessionAction]);\r\n        } catch(err) {\r\n          console.warn('MediaSession action is not supported:', action);\r\n        }\r\n      }\r\n    }\r\n\r\n    rootScope.addEventListener('document_downloaded', (docId) => {\r\n      const set = this.waitingDocumentsForLoad[docId];\r\n      if(set) {\r\n        for(const media of set) {\r\n          this.onMediaDocumentLoad(media);\r\n        }\r\n      }\r\n    });\r\n\r\n    rootScope.addEventListener('media_play', () => {\r\n      if(this.skipMediaPlayEvent) {\r\n        this.skipMediaPlayEvent = false;\r\n        return;\r\n      }\r\n\r\n      if(!this.pause() && this.pip) {\r\n        this.pip.pause();\r\n      }\r\n    });\r\n\r\n    const properties: {[key: PropertyKey]: PropertyDescriptor} = {};\r\n    const keys = [\r\n      'volume' as const,\r\n      'muted' as const,\r\n      'playbackRate' as const,\r\n      'loop' as const,\r\n      'round' as const\r\n    ];\r\n    keys.forEach((key) => {\r\n      const _key = ('_' + key) as `_${typeof key}`;\r\n      properties[key] = {\r\n        get: () => this[_key],\r\n        set: (value: number | boolean) => {\r\n          if(this[_key] === value) {\r\n            return;\r\n          }\r\n\r\n          // @ts-ignore\r\n          this[_key] = value;\r\n          if(this.playingMedia && (key !== 'loop' || this.playingMediaType === 'audio') && key !== 'round') {\r\n            // @ts-ignore\r\n            this.playingMedia[key] = value;\r\n          }\r\n\r\n          if(key === 'playbackRate' && this.playingMediaType !== undefined) {\r\n            this.playbackRates[this.playingMediaType] = value as number;\r\n          }\r\n\r\n          this.dispatchPlaybackParams();\r\n        }\r\n      };\r\n    });\r\n    Object.defineProperties(this, properties);\r\n  }\r\n\r\n  private dispatchPlaybackParams() {\r\n    this.dispatchEvent('playbackParams', this.getPlaybackParams());\r\n  }\r\n\r\n  public getPlaybackParams() {\r\n    const {volume, muted, playbackRate, playbackRates, loop, round} = this;\r\n    return {\r\n      volume,\r\n      muted,\r\n      playbackRate,\r\n      playbackRates,\r\n      loop,\r\n      round\r\n    };\r\n  }\r\n\r\n  public setPlaybackParams(params: ReturnType<AppMediaPlaybackController['getPlaybackParams']>) {\r\n    this.playbackRates = params.playbackRates;\r\n    this._volume = params.volume;\r\n    this._muted = params.muted;\r\n    this._playbackRate = params.playbackRate;\r\n    this._loop = params.loop;\r\n    this._round = params.round;\r\n  }\r\n\r\n  public seekBackward = (details: MediaSessionActionDetails, media = this.playingMedia) => {\r\n    if(media) {\r\n      media.currentTime = Math.max(0, media.currentTime - (details.seekOffset || SEEK_OFFSET));\r\n    }\r\n  };\r\n\r\n  public seekForward = (details: MediaSessionActionDetails, media = this.playingMedia) => {\r\n    if(media) {\r\n      media.currentTime = Math.min(media.duration, media.currentTime + (details.seekOffset || SEEK_OFFSET));\r\n    }\r\n  };\r\n\r\n  public seekTo = (details: MediaSessionActionDetails, media = this.playingMedia) => {\r\n    if(media) {\r\n      media.currentTime = details.seekTime;\r\n    }\r\n  };\r\n\r\n  public addMedia(message: Message.message, autoload: boolean, clean?: boolean): HTMLMediaElement {\r\n    const {peerId, mid} = message;\r\n\r\n    const isScheduled = !!message.pFlags.is_scheduled;\r\n    const s = isScheduled ? this.scheduled : this.media;\r\n    let storage = s.get(message.peerId);\r\n    if(!storage) {\r\n      s.set(message.peerId, storage = new Map());\r\n    }\r\n\r\n    let media = storage.get(mid);\r\n    if(media) {\r\n      return media;\r\n    }\r\n\r\n    const doc = getMediaFromMessage(message) as Document.document;\r\n    storage.set(mid, media = document.createElement(doc.type === 'round' || doc.type === 'video' ? 'video' : 'audio'));\r\n    // const source = document.createElement('source');\r\n    // source.type = doc.type === 'voice' && !opusDecodeController.isPlaySupported() ? 'audio/wav' : doc.mime_type;\r\n\r\n    if(doc.type === 'round') {\r\n      media.setAttribute('playsinline', 'true');\r\n      // media.muted = true;\r\n    }\r\n\r\n    const details: MediaDetails = {\r\n      peerId,\r\n      mid,\r\n      docId: doc.id,\r\n      doc,\r\n      message,\r\n      clean,\r\n      isScheduled: message.pFlags.is_scheduled\r\n    };\r\n\r\n    this.mediaDetails.set(media, details);\r\n\r\n    // media.autoplay = true;\r\n    media.volume = 1;\r\n    // media.append(source);\r\n\r\n    this.container.append(media);\r\n\r\n    media.addEventListener('play', this.onPlay);\r\n    media.addEventListener('pause', this.onPause);\r\n    media.addEventListener('ended', this.onEnded);\r\n\r\n    if(doc.type !== 'audio' && message?.pFlags.media_unread && message.fromId !== rootScope.myId) {\r\n      media.addEventListener('timeupdate', () => {\r\n        this.managers.appMessagesManager.readMessages(peerId, [mid]);\r\n      }, {once: true});\r\n    }\r\n\r\n    /* const onError = (e: Event) => {\r\n      //console.log('appMediaPlaybackController: video onError', e);\r\n\r\n      if(this.nextMid === mid) {\r\n        this.loadSiblingsMedia(peerId, doc.type as MediaType, mid).then(() => {\r\n          if(this.nextMid && storage[this.nextMid]) {\r\n            storage[this.nextMid].play();\r\n          }\r\n        });\r\n      }\r\n    };\r\n\r\n    media.addEventListener('error', onError); */\r\n\r\n    const deferred = deferredPromise<void>();\r\n    if(autoload) {\r\n      deferred.resolve();\r\n    } else {\r\n      const w = message.pFlags.is_scheduled ? this.waitingScheduledMediaForLoad : this.waitingMediaForLoad;\r\n      let waitingStorage = w.get(peerId);\r\n      if(!waitingStorage) {\r\n        w.set(peerId, waitingStorage = new Map());\r\n      }\r\n\r\n      waitingStorage.set(mid, deferred);\r\n    }\r\n\r\n    deferred.then(async() => {\r\n      // media.autoplay = true;\r\n      // console.log('will set media url:', media, doc, doc.type, doc.url);\r\n\r\n      if(doc.supportsStreaming || (await this.managers.thumbsStorage.getCacheContext(doc)).url) {\r\n        this.onMediaDocumentLoad(media);\r\n      } else {\r\n        let set = this.waitingDocumentsForLoad[doc.id];\r\n        if(!set) {\r\n          set = this.waitingDocumentsForLoad[doc.id] = new Set();\r\n        }\r\n\r\n        set.add(media);\r\n        appDownloadManager.downloadMediaURL({media: doc});\r\n      }\r\n    }/* , onError */);\r\n\r\n    return media;\r\n  }\r\n\r\n  public getMedia(peerId: PeerId, mid: number, isScheduled?: boolean) {\r\n    const s = (isScheduled ? this.scheduled : this.media).get(peerId);\r\n    return s?.get(mid);\r\n  }\r\n\r\n  private onMediaDocumentLoad = async(media: HTMLMediaElement) => {\r\n    const details = this.mediaDetails.get(media);\r\n    const doc = await this.managers.appDocsManager.getDoc(details.docId);\r\n    if(doc.type === 'audio' && doc.supportsStreaming && SHOULD_USE_SAFARI_FIX) {\r\n      this.handleSafariStreamable(media);\r\n    }\r\n\r\n    // setTimeout(() => {\r\n    const cacheContext = await this.managers.thumbsStorage.getCacheContext(doc);\r\n    media.src = cacheContext.url;\r\n\r\n    if(this.playingMedia === media) {\r\n      media.playbackRate = this.playbackRate;\r\n\r\n      if(doc.type === 'audio') {\r\n        media.loop = this.loop;\r\n      }\r\n    }\r\n    // }, doc.supportsStreaming ? 500e3 : 0);\r\n\r\n    const set = this.waitingDocumentsForLoad[doc.id];\r\n    if(set) {\r\n      set.delete(media);\r\n\r\n      if(!set.size) {\r\n        delete this.waitingDocumentsForLoad[doc.id];\r\n      }\r\n    }\r\n  };\r\n\r\n  // safari      ,\r\n  //         SW,     \r\n  private handleSafariStreamable(media: HTMLMediaElement) {\r\n    media.addEventListener('play', () => {\r\n      /* if(media.readyState === 4) { // https://developer.mozilla.org/ru/docs/Web/API/XMLHttpRequest/readyState\r\n        return;\r\n      } */\r\n\r\n      // media.volume = 0;\r\n      const currentTime = media.currentTime;\r\n      // this.setSafariBuffering(media, true);\r\n\r\n      media.addEventListener('progress', () => {\r\n        media.currentTime = media.duration - 1;\r\n\r\n        media.addEventListener('progress', () => {\r\n          media.currentTime = currentTime;\r\n          // media.volume = 1;\r\n          // this.setSafariBuffering(media, false);\r\n\r\n          if(!media.paused) {\r\n            media.play()/* .catch(() => {}) */;\r\n          }\r\n        }, {once: true});\r\n      }, {once: true});\r\n    }/* , {once: true} */);\r\n  }\r\n\r\n  public resolveWaitingForLoadMedia(peerId: PeerId, mid: number, isScheduled?: boolean) {\r\n    const w = isScheduled ? this.waitingScheduledMediaForLoad : this.waitingMediaForLoad;\r\n    const storage = w.get(peerId);\r\n    if(!storage) {\r\n      return;\r\n    }\r\n\r\n    const promise = storage.get(mid);\r\n    if(promise) {\r\n      promise.resolve();\r\n      storage.delete(mid);\r\n\r\n      if(!storage.size) {\r\n        w.delete(peerId);\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Only for audio\r\n   */\r\n  public isSafariBuffering(media: HTMLMediaElement) {\r\n    // @ts-ignore\r\n    return !!media.safariBuffering;\r\n  }\r\n\r\n  private setSafariBuffering(media: HTMLMediaElement, value: boolean) {\r\n    // @ts-ignore\r\n    media.safariBuffering = value;\r\n  }\r\n\r\n  private async setNewMediadata(message: Message.message, playingMedia = this.playingMedia) {\r\n    if(document.pictureInPictureElement) {\r\n      return;\r\n    }\r\n\r\n    await onMediaLoad(playingMedia, undefined, false); // have to wait for load, otherwise on macOS won't set\r\n\r\n    const doc = getMediaFromMessage(message) as MyDocument;\r\n\r\n    const artwork: MediaImage[] = [];\r\n\r\n    const isVoice = doc.type === 'voice' || doc.type === 'round';\r\n    let title = '', artist = '';\r\n\r\n    if(doc.thumbs?.length) {\r\n      const size = doc.thumbs[doc.thumbs.length - 1];\r\n      if(!(size as PhotoSize.photoStrippedSize).bytes) {\r\n        const cacheContext = await this.managers.thumbsStorage.getCacheContext(doc, size.type);\r\n\r\n        if(cacheContext.url) {\r\n          artwork.push({\r\n            src: cacheContext.url,\r\n            sizes: `${(size as PhotoSize.photoSize).w}x${(size as PhotoSize.photoSize).h}`,\r\n            type: 'image/jpeg'\r\n          });\r\n        } else {\r\n          const download = appDownloadManager.downloadMediaURL({media: doc, thumb: size});\r\n          download.then(() => {\r\n            if(this.playingMedia !== playingMedia || !cacheContext.url) {\r\n              return;\r\n            }\r\n\r\n            this.setNewMediadata(message);\r\n          });\r\n        }\r\n      }\r\n    } else if(isVoice) {\r\n      const peerId = message.fromId || message.peerId;\r\n      const peerPhoto = await this.managers.appPeersManager.getPeerPhoto(peerId);\r\n      if(peerPhoto) {\r\n        // const result = this.managers.appAvatarsManager.loadAvatar(peerId, peerPhoto, 'photo_small');\r\n        // if(result.cached) {\r\n        //   const url = await result.loadPromise;\r\n        //   artwork.push({\r\n        //     src: url,\r\n        //     sizes: '160x160',\r\n        //     type: 'image/jpeg'\r\n        //   });\r\n        // } else {\r\n        //   result.loadPromise.then((url) => {\r\n        //     if(this.playingMedia !== playingMedia || !url) {\r\n        //       return;\r\n        //     }\r\n\r\n        //     this.setNewMediadata(message);\r\n        //   });\r\n        // }\r\n      }\r\n\r\n      title = await getPeerTitle(peerId, true, false);\r\n      artist = I18n.format(doc.type === 'voice' ? 'AttachAudio' : 'AttachRound', true);\r\n    }\r\n\r\n    if(!isVoice) {\r\n      const attribute = doc.attributes.find((attribute) => attribute._ === 'documentAttributeAudio') as DocumentAttribute.documentAttributeAudio;\r\n      title = attribute?.title ?? doc.file_name;\r\n      artist = attribute?.performer;\r\n    }\r\n\r\n    if(!artwork.length) {\r\n      if(IS_APPLE) {\r\n        if(IS_TOUCH_SUPPORTED) {\r\n          artwork.push({\r\n            src: `assets/img/apple-touch-icon-precomposed.png`,\r\n            sizes: '180x180',\r\n            type: 'image/png'\r\n          });\r\n        } else {\r\n          artwork.push({\r\n            src: `assets/img/apple-touch-icon.png`,\r\n            sizes: '180x180',\r\n            type: 'image/png'\r\n          });\r\n        }\r\n      } else {\r\n        [72, 96, 144, 192, 256, 384, 512].forEach((size) => {\r\n          const sizes = `${size}x${size}`;\r\n          artwork.push({\r\n            src: `assets/img/android-chrome-${sizes}.png`,\r\n            sizes,\r\n            type: 'image/png'\r\n          });\r\n        });\r\n      }\r\n    }\r\n\r\n    const metadata = new MediaMetadata({\r\n      title,\r\n      artist,\r\n      artwork\r\n    });\r\n\r\n    navigator.mediaSession.metadata = metadata;\r\n  }\r\n\r\n  public setCurrentMediadata() {\r\n    const {playingMedia} = this;\r\n    if(!playingMedia) return;\r\n    const message = this.getMessageByMedia(playingMedia);\r\n    this.setNewMediadata(message, playingMedia);\r\n  }\r\n\r\n  private getMessageByMedia(media: HTMLMediaElement): Message.message {\r\n    const details = this.mediaDetails.get(media);\r\n    return details.message;\r\n    // const {peerId, mid} = details;\r\n    // const message = details.isScheduled ?\r\n    //   this.managers.appMessagesManager.getScheduledMessageByPeer(peerId, mid) :\r\n    //   this.managers.appMessagesManager.getMessageByPeer(peerId, mid);\r\n    // return message;\r\n  }\r\n\r\n  public getPlayingDetails() {\r\n    const {playingMedia} = this;\r\n    if(!playingMedia) {\r\n      return;\r\n    }\r\n\r\n    const message = this.getMessageByMedia(playingMedia);\r\n    return {\r\n      doc: getMediaFromMessage(message) as MyDocument,\r\n      message,\r\n      media: playingMedia,\r\n      playbackParams: this.getPlaybackParams()\r\n    };\r\n  }\r\n\r\n  private onPlay = (e?: Event) => {\r\n    const media = e.target as HTMLMediaElement;\r\n    const details = this.mediaDetails.get(media);\r\n    const {peerId, mid} = details;\r\n\r\n    // console.log('appMediaPlaybackController: video playing', this.currentPeerId, this.playingMedia, media);\r\n\r\n    const pip = this.pip;\r\n    if(pip) {\r\n      pip.pause();\r\n    }\r\n\r\n    const message = this.getMessageByMedia(media);\r\n\r\n    const previousMedia = this.playingMedia;\r\n    if(previousMedia !== media) {\r\n      this.stop();\r\n      this.setMedia(media, message);\r\n\r\n      const verify = (element: MediaItem) => element.mid === mid && element.peerId === peerId;\r\n      const listLoader = this.listLoader;\r\n      const current = listLoader.getCurrent();\r\n      if(!current || !verify(current)) {\r\n        let jumpLength: number;\r\n\r\n        for(const withOtherSide of [false, true]) {\r\n          const previous = listLoader.getPrevious(withOtherSide);\r\n\r\n          let idx = previous.findIndex(verify);\r\n          if(idx !== -1) {\r\n            jumpLength = -(previous.length - idx);\r\n          } else {\r\n            const next = listLoader.getNext(withOtherSide);\r\n            idx = next.findIndex(verify);\r\n            if(idx !== -1) {\r\n              jumpLength = idx + 1;\r\n            }\r\n          }\r\n\r\n          if(jumpLength !== undefined) {\r\n            break;\r\n          }\r\n        }\r\n\r\n        if(jumpLength) {\r\n          this.go(jumpLength, false);\r\n        } else {\r\n          this.setTargets({peerId, mid});\r\n        }\r\n      }\r\n    }\r\n\r\n    // audio_pause     \r\n    setTimeout(() => {\r\n      if(this.playingMedia !== media) {\r\n        return;\r\n      }\r\n\r\n      this.dispatchEvent('play', this.getPlayingDetails());\r\n      this.pauseMediaInOtherTabs();\r\n    }, 0);\r\n  };\r\n\r\n  private onPause = (e?: Event) => {\r\n    /* const target = e.target as HTMLMediaElement;\r\n    if(!isInDOM(target)) {\r\n      this.container.append(target);\r\n      target.play();\r\n      return;\r\n    } */\r\n\r\n    // if(this.pip) {\r\n    //   this.pip.play();\r\n    // }\r\n\r\n    this.dispatchEvent('pause');\r\n  };\r\n\r\n  private onEnded = (e?: Event) => {\r\n    if(!e.isTrusted) {\r\n      return;\r\n    }\r\n\r\n    this.onPause(e);\r\n\r\n    // console.log('on media end');\r\n\r\n    const listLoader = this.listLoader;\r\n    if(this.lockedSwitchers ||\r\n      (!this.round && listLoader.current && !listLoader.next.length) ||\r\n      !listLoader.getNext(true).length ||\r\n      !this.next()) {\r\n      this.stop();\r\n      this.dispatchEvent('stop');\r\n    }\r\n  };\r\n\r\n  public pauseMediaInOtherTabs() {\r\n    this.skipMediaPlayEvent = true;\r\n    rootScope.dispatchEvent('media_play');\r\n  }\r\n\r\n  // public get pip() {\r\n  //   return document.pictureInPictureElement as HTMLVideoElement;\r\n  // }\r\n\r\n  public toggle(play?: boolean, media = this.playingMedia) {\r\n    if(!media) {\r\n      return false;\r\n    }\r\n\r\n    if(play === undefined) {\r\n      play = media.paused;\r\n    }\r\n\r\n    if(media.paused !== play) {\r\n      return false;\r\n    }\r\n\r\n    if(play) {\r\n      media.play();\r\n    } else {\r\n      media.pause();\r\n    }\r\n\r\n    return true;\r\n  }\r\n\r\n  public play = () => {\r\n    return this.toggle(true);\r\n  };\r\n\r\n  public pause = () => {\r\n    return this.toggle(false);\r\n  };\r\n\r\n  public stop = (media = this.playingMedia) => {\r\n    if(!media) {\r\n      return false;\r\n    }\r\n\r\n    if(!media.paused) {\r\n      media.pause();\r\n    }\r\n\r\n    media.currentTime = 0;\r\n    simulateEvent(media, 'ended');\r\n\r\n    if(media === this.playingMedia) {\r\n      const details = this.mediaDetails.get(media);\r\n      if(details?.clean) {\r\n        media.src = '';\r\n        const peerId = details.peerId;\r\n        const s = details.isScheduled ? this.scheduled : this.media;\r\n        const storage = s.get(peerId);\r\n        if(storage) {\r\n          storage.delete(details.mid);\r\n\r\n          if(!storage.size) {\r\n            s.delete(peerId);\r\n          }\r\n        }\r\n\r\n        media.remove();\r\n\r\n        this.mediaDetails.delete(media);\r\n      }\r\n\r\n      this.playingMedia = undefined;\r\n      this.playingMediaType = undefined;\r\n    }\r\n\r\n    return true;\r\n  };\r\n\r\n  public playItem = (item: MediaItem) => {\r\n    const {peerId, mid} = item;\r\n    const isScheduled = this.searchContext.isScheduled;\r\n    const media = this.getMedia(peerId, mid, isScheduled);\r\n\r\n    /* if(isSafari) {\r\n      media.autoplay = true;\r\n    } */\r\n\r\n    media.play();\r\n\r\n    setTimeout(() => {\r\n      this.resolveWaitingForLoadMedia(peerId, mid, isScheduled);\r\n    }, 0);\r\n  };\r\n\r\n  public go = (length: number, dispatchJump?: boolean) => {\r\n    const listLoader = this.listLoader;\r\n    if(this.lockedSwitchers || !listLoader) {\r\n      return;\r\n    }\r\n\r\n    if(this.playingMediaType === 'audio') {\r\n      return listLoader.goRound(length, dispatchJump);\r\n    } else {\r\n      return listLoader.go(length, dispatchJump);\r\n    }\r\n  };\r\n\r\n  private bindBrowserCallback(cb: (video: HTMLVideoElement, details: MediaSessionActionDetails) => void) {\r\n    const handler: MediaSessionActionHandler = (details) => {\r\n      cb(this.pip, details);\r\n    };\r\n\r\n    return handler;\r\n  }\r\n\r\n  public browserPlay = this.bindBrowserCallback((video) => this.toggle(true, video));\r\n  public browserPause = this.bindBrowserCallback((video) => this.toggle(false, video));\r\n  public browserStop = this.bindBrowserCallback((video) => this.stop(video));\r\n  public browserSeekBackward = this.bindBrowserCallback((video, details) => this.seekBackward(details, video));\r\n  public browserSeekForward = this.bindBrowserCallback((video, details) => this.seekForward(details, video));\r\n  public browserSeekTo = this.bindBrowserCallback((video, details) => this.seekTo(details, video));\r\n  public browserNext = this.bindBrowserCallback((video) => video || this.next());\r\n  public browserPrevious = this.bindBrowserCallback((video) => video ? this.seekToStart(video) : this.previous());\r\n\r\n  public next = () => {\r\n    return this.go(1);\r\n  };\r\n\r\n  public previous = () => {\r\n    if(this.seekToStart(this.playingMedia)) {\r\n      return;\r\n    }\r\n\r\n    return this.go(-1);\r\n  };\r\n\r\n  public seekToStart(media: HTMLMediaElement) {\r\n    if(media?.currentTime > 5) {\r\n      media.currentTime = 0;\r\n      this.toggle(true, media);\r\n      return true;\r\n    }\r\n\r\n    return false;\r\n  }\r\n\r\n  public willBePlayed(media: HTMLMediaElement) {\r\n    this.willBePlayedMedia = media;\r\n  }\r\n\r\n  public setSearchContext(context: MediaSearchContext) {\r\n    if(deepEqual(this.searchContext, context)) {\r\n      return false;\r\n    }\r\n\r\n    this.searchContext = copy(context); // {_: type === 'audio' ? 'inputMessagesFilterMusic' : 'inputMessagesFilterRoundVoice'}\r\n    return true;\r\n  }\r\n\r\n  public getSearchContext() {\r\n    return this.searchContext;\r\n  }\r\n\r\n  public setTargets(current: MediaItem, prev?: MediaItem[], next?: MediaItem[]) {\r\n    let listLoader = this.listLoader;\r\n    if(!listLoader) {\r\n      listLoader = this.listLoader = new SearchListLoader({\r\n        loadCount: 10,\r\n        loadWhenLeft: 5,\r\n        processItem: (message: Message.message) => {\r\n          this.addMedia(message, false);\r\n          return {peerId: message.peerId, mid: message.mid};\r\n        },\r\n        onJump: (item, older) => {\r\n          this.playItem(item);\r\n        },\r\n        onEmptied: () => {\r\n          this.dispatchEvent('stop');\r\n          this.stop();\r\n        }\r\n      });\r\n    } else {\r\n      listLoader.reset();\r\n    }\r\n\r\n    const reverse = this.searchContext.folderId !== undefined ? false : true;\r\n    if(prev) {\r\n      listLoader.setTargets(prev, next, reverse);\r\n    } else {\r\n      listLoader.reverse = reverse;\r\n    }\r\n\r\n    listLoader.setSearchContext(this.searchContext);\r\n    listLoader.current = current;\r\n\r\n    listLoader.load(true);\r\n    listLoader.load(false);\r\n  }\r\n\r\n  private getPlaybackMediaTypeFromMessage(message: Message.message) {\r\n    const doc = getMediaFromMessage(message) as MyDocument;\r\n    let mediaType: PlaybackMediaType = 'audio';\r\n    if(doc?.type) {\r\n      if(doc.type === 'voice' || doc.type === 'round') {\r\n        mediaType = 'voice';\r\n      } else if(doc.type === 'video') {\r\n        mediaType = 'video';\r\n      }\r\n    }\r\n\r\n    return mediaType;\r\n  }\r\n\r\n  public setMedia(media: HTMLMediaElement, message: Message.message) {\r\n    const mediaType = this.getPlaybackMediaTypeFromMessage(message);\r\n\r\n    this._playbackRate = this.playbackRates[mediaType];\r\n\r\n    this.playingMedia = media;\r\n    this.playingMediaType = mediaType;\r\n    this.playingMedia.volume = this.volume;\r\n    this.playingMedia.muted = this.muted;\r\n    this.playingMedia.playbackRate = this.playbackRate;\r\n\r\n    if(mediaType === 'audio') {\r\n      this.playingMedia.loop = this.loop;\r\n    }\r\n\r\n    if('mediaSession' in navigator) {\r\n      this.setNewMediadata(message);\r\n    }\r\n  }\r\n\r\n  public setSingleMedia(media?: HTMLMediaElement, message?: Message.message) {\r\n    const playingMedia = this.playingMedia;\r\n\r\n    const wasPlaying = this.pause();\r\n\r\n    let onPlay: () => void;\r\n    if(media) {\r\n      onPlay = () => {\r\n        const pip = this.pip;\r\n        if(pip) {\r\n          pip.pause();\r\n        }\r\n\r\n        this.pauseMediaInOtherTabs();\r\n      };\r\n\r\n      if(!media.paused) {\r\n        onPlay();\r\n      }\r\n\r\n      media.addEventListener('play', onPlay);\r\n    } else { // maybe it's voice recording\r\n      this.pauseMediaInOtherTabs();\r\n    }\r\n\r\n    this.willBePlayed(undefined);\r\n    if(media) this.setMedia(media, message);\r\n    else this.playingMedia = undefined;\r\n    this.toggleSwitchers(false);\r\n\r\n    return (playPaused = wasPlaying) => {\r\n      this.toggleSwitchers(true);\r\n\r\n      if(playingMedia) {\r\n        if(this.mediaDetails.get(playingMedia)) {\r\n          this.setMedia(playingMedia, this.getMessageByMedia(playingMedia));\r\n        } else {\r\n          this.next() || this.previous();\r\n        }\r\n      }\r\n\r\n      // If it's still not cleaned\r\n      if(this.playingMedia === media) {\r\n        this.playingMedia = undefined;\r\n        this.playingMediaType = undefined;\r\n      }\r\n\r\n      if(media) {\r\n        media.removeEventListener('play', onPlay);\r\n      }\r\n\r\n      // I don't remember what it was for\r\n      // if(media && this.playingMedia === media) {\r\n      //   this.stop();\r\n      // }\r\n\r\n      if(playPaused) {\r\n        this.play();\r\n      }\r\n    };\r\n  }\r\n\r\n  public toggleSwitchers(enabled: boolean) {\r\n    this.lockedSwitchers = !enabled;\r\n  }\r\n\r\n  public setPictureInPicture(video: HTMLVideoElement) {\r\n    this.pip = video;\r\n\r\n    // let wasPlaying = this.pause();\r\n\r\n    const listenerSetter = new ListenerSetter();\r\n    listenerSetter.add(video)('leavepictureinpicture', () => {\r\n      if(this.pip !== video) {\r\n        return;\r\n      }\r\n\r\n      this.pip = undefined;\r\n      // if(wasPlaying) {\r\n      //   this.play();\r\n      // }\r\n\r\n      listenerSetter.removeAll();\r\n    }, {once: true});\r\n\r\n    listenerSetter.add(video)('play', (e) => {\r\n      if(this.playingMedia !== video) {\r\n        this.pause();\r\n      }\r\n\r\n      this.pauseMediaInOtherTabs();\r\n      // if(this.pause()) {\r\n      //   listenerSetter.add(video)('pause', () => {\r\n      //     this.play();\r\n      //   }, {once: true});\r\n      // }\r\n    });\r\n  }\r\n}\r\n\r\nconst appMediaPlaybackController = new AppMediaPlaybackController();\r\nMOUNT_CLASS_TO.appMediaPlaybackController = appMediaPlaybackController;\r\nexport default appMediaPlaybackController;\r\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport MEDIA_MIME_TYPES_SUPPORTED from '../environment/mediaMimeTypesSupport';\nimport cancelEvent from '../helpers/dom/cancelEvent';\nimport {attachClickEvent, detachClickEvent} from '../helpers/dom/clickEvent';\nimport findUpClassName from '../helpers/dom/findUpClassName';\nimport findUpTag from '../helpers/dom/findUpTag';\nimport setInnerHTML from '../helpers/dom/setInnerHTML';\nimport mediaSizes from '../helpers/mediaSizes';\nimport SearchListLoader from '../helpers/searchListLoader';\nimport {Message} from '../layer';\nimport type {MyDocument} from '../lib/appManagers/appDocsManager';\nimport appDownloadManager from '../lib/appManagers/appDownloadManager';\nimport appImManager from '../lib/appManagers/appImManager';\nimport {MyMessage} from '../lib/appManagers/appMessagesManager';\nimport {MyPhoto} from '../lib/appManagers/appPhotosManager';\nimport getMediaFromMessage from '../lib/appManagers/utils/messages/getMediaFromMessage';\nimport wrapRichText from '../lib/richTextProcessor/wrapRichText';\nimport {MediaSearchContext} from './appMediaPlaybackController';\nimport AppMediaViewerBase, {MEDIA_VIEWER_CLASSNAME} from './appMediaViewerBase';\nimport {ButtonMenuItemOptions} from './buttonMenu';\nimport PopupDeleteMessages from './popups/deleteMessages';\nimport PopupForward from './popups/forward';\nimport Scrollable from './scrollable';\nimport appSidebarRight from './sidebarRight';\nimport AppSharedMediaTab from './sidebarRight/tabs/sharedMedia';\n\ntype AppMediaViewerTargetType = {\n  element: HTMLElement,\n  mid: number,\n  peerId: PeerId\n};\nexport default class AppMediaViewer extends AppMediaViewerBase<'caption', 'delete' | 'forward', AppMediaViewerTargetType> {\n  protected listLoader: SearchListLoader<AppMediaViewerTargetType>;\n  protected btnMenuForward: ButtonMenuItemOptions;\n  protected btnMenuDownload: ButtonMenuItemOptions;\n  protected btnMenuDelete: ButtonMenuItemOptions;\n\n  get searchContext() {\n    return this.listLoader.searchContext;\n  }\n\n  constructor() {\n    super(new SearchListLoader({\n      processItem: (item) => {\n        const isForDocument = this.searchContext.inputFilter._ === 'inputMessagesFilterDocument';\n        const {mid, peerId} = item;\n        const media: MyPhoto | MyDocument = getMediaFromMessage(item);\n\n        if(!media) return;\n\n        if(isForDocument && !AppMediaViewer.isMediaCompatibleForDocumentViewer(media)) {\n          return;\n        }\n\n        return {element: null as HTMLElement, mid, peerId};\n      }\n    }), ['delete', 'forward']);\n\n    this.listLoader.onEmptied = () => {\n      this.close();\n    };\n\n    /* const stub = document.createElement('div');\n    stub.classList.add(MEDIA_VIEWER_CLASSNAME + '-stub');\n    this.content.main.prepend(stub); */\n\n    this.content.caption = document.createElement('div');\n    this.content.caption.classList.add(MEDIA_VIEWER_CLASSNAME + '-caption', 'spoilers-container'/* , 'media-viewer-stub' */);\n\n    let captionTimeout: number;\n    const setCaptionTimeout = () => {\n      if(captionTimeout) {\n        clearTimeout(captionTimeout);\n      }\n\n      captionTimeout = window.setTimeout(() => {\n        captionTimeout = undefined;\n        this.content.caption.classList.remove('is-focused');\n      }, 800);\n    };\n    this.content.caption.addEventListener('touchstart', () => {\n      if(!mediaSizes.isMobile) return;\n\n      this.content.caption.classList.add('is-focused');\n\n      if(captionTimeout) {\n        clearTimeout(captionTimeout);\n        captionTimeout = undefined;\n      }\n\n      document.addEventListener('touchend', setCaptionTimeout, {once: true});\n    });\n\n    const captionScrollable = new Scrollable(this.content.caption);\n    captionScrollable.onAdditionalScroll = setCaptionTimeout;\n\n    // this.content.main.append(this.content.caption);\n    this.wholeDiv.append(this.content.caption);\n\n    attachClickEvent(this.buttons.delete, this.onDeleteClick);\n\n    const buttons: ButtonMenuItemOptions[] = [this.btnMenuForward = {\n      icon: 'forward',\n      text: 'Forward',\n      onClick: this.onForwardClick\n    }, this.btnMenuDownload = {\n      icon: 'download',\n      text: 'MediaViewer.Context.Download',\n      onClick: this.onDownloadClick\n    }, this.btnMenuDelete = {\n      icon: 'delete danger',\n      text: 'Delete',\n      onClick: this.onDeleteClick\n    }];\n\n    this.setBtnMenuToggle(buttons);\n\n    // * constructing html end\n\n    this.setListeners();\n  }\n\n  protected setListeners() {\n    super.setListeners();\n    attachClickEvent(this.buttons.forward, this.onForwardClick);\n    attachClickEvent(this.author.container, this.onAuthorClick);\n\n    const onCaptionClick = (e: MouseEvent) => {\n      const a = findUpTag(e.target, 'A');\n      const spoiler = findUpClassName(e.target, 'spoiler');\n      if(a instanceof HTMLAnchorElement && (!spoiler || this.content.caption.classList.contains('is-spoiler-visible'))) { // close viewer if it's t.me/ redirect\n        const onclick = a.getAttribute('onclick');\n        if(!onclick || onclick.includes('showMaskedAlert')) {\n          return;\n        }\n\n        cancelEvent(e);\n\n        this.close().then(() => {\n          this.content.caption.removeEventListener('click', onCaptionClick, {capture: true});\n          a.click();\n        });\n\n        return false;\n      }\n    };\n\n    this.content.caption.addEventListener('click', onCaptionClick, {capture: true});\n  }\n\n  /* public close(e?: MouseEvent) {\n    const good = !this.setMoverAnimationPromise;\n    const promise = super.close(e);\n\n    if(good) { // clear\n      this.currentMessageId = 0;\n      this.peerId = 0;\n    }\n\n    return promise;\n  } */\n\n  protected getMessageByPeer(peerId: PeerId, mid: number) {\n    return this.searchContext.isScheduled ? this.managers.appMessagesManager.getScheduledMessageByPeer(peerId, mid) : this.managers.appMessagesManager.getMessageByPeer(peerId, mid);\n  }\n\n  onPrevClick = async(target: AppMediaViewerTargetType) => {\n    this.openMedia(await this.getMessageByPeer(target.peerId, target.mid), target.element, -1);\n  };\n\n  onNextClick = async(target: AppMediaViewerTargetType) => {\n    this.openMedia(await this.getMessageByPeer(target.peerId, target.mid), target.element, 1);\n  };\n\n  onDeleteClick = () => {\n    const target = this.target;\n    new PopupDeleteMessages(target.peerId, [target.mid], 'chat', () => {\n      this.target = {element: this.content.media} as any;\n      this.close();\n    });\n  };\n\n  onForwardClick = () => {\n    const target = this.target;\n    if(target.mid) {\n      // appSidebarRight.forwardTab.open([target.mid]);\n      new PopupForward({\n        [target.peerId]: [target.mid]\n      }, () => {\n        return this.close();\n      });\n    }\n  };\n\n  onAuthorClick = async(e: MouseEvent) => {\n    const {mid, peerId} = this.target;\n    if(mid && mid !== Number.MAX_SAFE_INTEGER) {\n      const threadId = this.searchContext.threadId;\n      const message = await this.getMessageByPeer(peerId, mid);\n      this.close(e)\n      // .then(() => mediaSizes.isMobile ? appSidebarRight.sharedMediaTab.closeBtn.click() : Promise.resolve())\n      .then(async() => {\n        if(mediaSizes.isMobile) {\n          const tab = appSidebarRight.getTab(AppSharedMediaTab);\n          if(tab) {\n            tab.close();\n          }\n        }\n\n        appImManager.setInnerPeer({\n          peerId: message.peerId,\n          lastMsgId: mid,\n          type: threadId ? 'discussion' : undefined,\n          threadId\n        });\n      });\n    }\n  };\n\n  onDownloadClick = async() => {\n    const {peerId, mid} = this.target;\n    const message = await this.getMessageByPeer(peerId, mid);\n    const media = getMediaFromMessage(message);\n    if(!media) return;\n    appDownloadManager.downloadToDisc({media, queueId: appImManager.chat.bubbles.lazyLoadQueue.queueId});\n  };\n\n  private setCaption(message: MyMessage) {\n    const caption = (message as Message.message).message;\n    let html: Parameters<typeof setInnerHTML>[1] = '';\n    if(caption) {\n      html = wrapRichText(caption, {\n        entities: (message as Message.message).totalEntities\n      });\n    }\n\n    // html = 'Dandelion are a family of flowering plants that grow in many parts of the world.';\n    setInnerHTML(this.content.caption.firstElementChild, html);\n    this.content.caption.classList.toggle('hide', !caption);\n    // this.content.container.classList.toggle('with-caption', !!caption);\n  }\n\n  public setSearchContext(context: MediaSearchContext) {\n    this.listLoader.setSearchContext(context);\n\n    return this;\n  }\n\n  public async openMedia(message: MyMessage, target?: HTMLElement, fromRight = 0, reverse = false,\n    prevTargets: AppMediaViewerTargetType[] = [], nextTargets: AppMediaViewerTargetType[] = []/* , needLoadMore = true */) {\n    if(this.setMoverPromise) return this.setMoverPromise;\n\n    const mid = message.mid;\n    const fromId = (message as Message.message).fwd_from && !message.fromId ? (message as Message.message).fwd_from.from_name : message.fromId;\n    const media = getMediaFromMessage(message);\n\n    const cantForwardMessage = message._ === 'messageService' || !this.managers.appMessagesManager.canForward(message);\n    [this.buttons.forward, this.btnMenuForward.element].forEach((button) => {\n      button.classList.toggle('hide', cantForwardMessage);\n    });\n\n    this.wholeDiv.classList.toggle('no-forwards', cantForwardMessage);\n\n    const cantDownloadMessage = cantForwardMessage;\n    [this.buttons.download, this.btnMenuDownload.element].forEach((button) => {\n      button.classList.toggle('hide', cantDownloadMessage);\n    });\n\n    const canDeleteMessage = this.managers.appMessagesManager.canDeleteMessage(message);\n    [this.buttons.delete, this.btnMenuDelete.element].forEach((button) => {\n      button.classList.toggle('hide', !canDeleteMessage);\n    });\n\n    this.setCaption(message);\n    const promise = super._openMedia(media, message.date, fromId, fromRight, target, reverse, prevTargets, nextTargets, message/* , needLoadMore */);\n    this.target.mid = mid;\n    this.target.peerId = message.peerId;\n\n    return promise;\n  }\n\n  public static isMediaCompatibleForDocumentViewer(media: MyPhoto | MyDocument) {\n    return media._ === 'photo' || MEDIA_MIME_TYPES_SUPPORTED.has(media.mime_type);\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport appMediaPlaybackController from '../components/appMediaPlaybackController';\nimport {IS_APPLE_MOBILE, IS_MOBILE} from '../environment/userAgent';\nimport IS_TOUCH_SUPPORTED from '../environment/touchSupport';\nimport cancelEvent from '../helpers/dom/cancelEvent';\nimport ListenerSetter, {Listener} from '../helpers/listenerSetter';\nimport ButtonMenu from '../components/buttonMenu';\nimport {ButtonMenuToggleHandler} from '../components/buttonMenuToggle';\nimport ControlsHover from '../helpers/dom/controlsHover';\nimport {addFullScreenListener, cancelFullScreen, isFullScreen, requestFullScreen} from '../helpers/dom/fullScreen';\nimport toHHMMSS from '../helpers/string/toHHMMSS';\nimport MediaProgressLine from '../components/mediaProgressLine';\nimport VolumeSelector from '../components/volumeSelector';\nimport debounce from '../helpers/schedulers/debounce';\nimport overlayCounter from '../helpers/overlayCounter';\nimport onMediaLoad from '../helpers/onMediaLoad';\nimport {attachClickEvent} from '../helpers/dom/clickEvent';\n\nexport default class VideoPlayer extends ControlsHover {\n  private static PLAYBACK_RATES = [0.5, 1, 1.5, 2];\n  private static PLAYBACK_RATES_ICONS = ['playback_05', 'playback_1x', 'playback_15', 'playback_2x'];\n\n  protected video: HTMLVideoElement;\n  protected wrapper: HTMLDivElement;\n  protected progress: MediaProgressLine;\n  protected skin: 'default';\n\n  protected listenerSetter: ListenerSetter;\n  protected playbackRateButton: HTMLElement;\n  protected pipButton: HTMLElement;\n\n  /* protected videoParent: HTMLElement;\n  protected videoWhichChild: number; */\n\n  protected onPlaybackRackMenuToggle?: (open: boolean) => void;\n  protected onPip?: (pip: boolean) => void;\n  protected onPipClose?: () => void;\n\n  constructor({video, play = false, streamable = false, duration, onPlaybackRackMenuToggle, onPip, onPipClose}: {\n    video: HTMLVideoElement,\n    play?: boolean,\n    streamable?: boolean,\n    duration?: number,\n    onPlaybackRackMenuToggle?: VideoPlayer['onPlaybackRackMenuToggle'],\n    onPip?: VideoPlayer['onPip'],\n    onPipClose?: VideoPlayer['onPipClose']\n  }) {\n    super();\n\n    this.video = video;\n    this.wrapper = document.createElement('div');\n    this.wrapper.classList.add('ckin__player');\n\n    this.onPlaybackRackMenuToggle = onPlaybackRackMenuToggle;\n    this.onPip = onPip;\n    this.onPipClose = onPipClose;\n\n    this.listenerSetter = new ListenerSetter();\n\n    this.setup({\n      element: this.wrapper,\n      listenerSetter: this.listenerSetter,\n      canHideControls: () => {\n        return !this.video.paused && (!this.playbackRateButton || !this.playbackRateButton.classList.contains('menu-open'));\n      },\n      showOnLeaveToClassName: 'media-viewer-caption',\n      ignoreClickClassName: 'ckin__controls'\n    });\n\n    video.parentNode.insertBefore(this.wrapper, video);\n    this.wrapper.appendChild(video);\n\n    this.skin = 'default';\n\n    this.stylePlayer(duration);\n    this.setBtnMenuToggle();\n\n    if(this.skin === 'default') {\n      const controls = this.wrapper.querySelector('.default__controls.ckin__controls') as HTMLDivElement;\n      this.progress = new MediaProgressLine(video, streamable);\n      controls.prepend(this.progress.container);\n    }\n\n    if(play/*  && video.paused */) {\n      const promise = video.play();\n      promise.catch((err: Error) => {\n        if(err.name === 'NotAllowedError') {\n          video.muted = true;\n          video.autoplay = true;\n          video.play();\n        }\n      }).finally(() => { // due to autoplay, play will not call\n        this.wrapper.classList.toggle('is-playing', !this.video.paused);\n      });\n    }\n  }\n\n  private stylePlayer(initDuration: number) {\n    const {wrapper, video, skin, listenerSetter} = this;\n\n    wrapper.classList.add(skin);\n\n    const html = this.buildControls();\n    wrapper.insertAdjacentHTML('beforeend', html);\n    let timeDuration: HTMLElement;\n\n    if(skin === 'default') {\n      this.playbackRateButton = this.wrapper.querySelector('.playback-rate') as HTMLElement;\n      this.pipButton = this.wrapper.querySelector('.pip') as HTMLElement;\n\n      const toggle = wrapper.querySelectorAll('.toggle') as NodeListOf<HTMLElement>;\n      const fullScreenButton = wrapper.querySelector('.fullscreen') as HTMLElement;\n      const timeElapsed = wrapper.querySelector('#time-elapsed');\n      timeDuration = wrapper.querySelector('#time-duration') as HTMLElement;\n      timeDuration.textContent = toHHMMSS(video.duration | 0);\n\n      const volumeSelector = new VolumeSelector(listenerSetter);\n\n      const leftControls = wrapper.querySelector('.left-controls');\n      volumeSelector.btn.classList.remove('btn-icon');\n      leftControls.insertBefore(volumeSelector.btn, timeElapsed.parentElement);\n\n      Array.from(toggle).forEach((button) => {\n        attachClickEvent(button, () => {\n          this.togglePlay();\n        }, {listenerSetter: this.listenerSetter});\n      });\n\n      if(this.pipButton) {\n        attachClickEvent(this.pipButton, () => {\n          this.video.requestPictureInPicture();\n        }, {listenerSetter: this.listenerSetter});\n\n        const onPip = (pip: boolean) => {\n          this.wrapper.style.visibility = pip ? 'hidden': '';\n          if(this.onPip) {\n            this.onPip(pip);\n          }\n        };\n\n        const debounceTime = 20;\n        const debouncedPip = debounce(onPip, debounceTime, false, true);\n\n        listenerSetter.add(video)('enterpictureinpicture', () => {\n          debouncedPip(true);\n\n          listenerSetter.add(video)('leavepictureinpicture', () => {\n            const onPause = () => {\n              clearTimeout(timeout);\n              if(this.onPipClose) {\n                this.onPipClose();\n              }\n            };\n            const listener = listenerSetter.add(video)('pause', onPause, {once: true}) as any as Listener;\n            const timeout = setTimeout(() => {\n              listenerSetter.remove(listener);\n            }, debounceTime);\n          }, {once: true});\n        });\n\n        listenerSetter.add(video)('leavepictureinpicture', () => {\n          debouncedPip(false);\n        });\n      }\n\n      if(!IS_TOUCH_SUPPORTED) {\n        attachClickEvent(video, () => {\n          this.togglePlay();\n        }, {listenerSetter: this.listenerSetter});\n\n        listenerSetter.add(document)('keydown', (e: KeyboardEvent) => {\n          if(overlayCounter.overlaysActive > 1 || document.pictureInPictureElement === video) { // forward popup is active, etc\n            return;\n          }\n\n          const {key, code} = e;\n\n          let good = true;\n          if(code === 'KeyF') {\n            this.toggleFullScreen();\n          } else if(code === 'KeyM') {\n            appMediaPlaybackController.muted = !appMediaPlaybackController.muted;\n          } else if(code === 'Space') {\n            this.togglePlay();\n          } else if(e.altKey && (code === 'Equal' || code === 'Minus')) {\n            const add = code === 'Equal' ? 1 : -1;\n            const playbackRate = appMediaPlaybackController.playbackRate;\n            const idx = VideoPlayer.PLAYBACK_RATES.indexOf(playbackRate);\n            const nextIdx = idx + add;\n            if(nextIdx >= 0 && nextIdx < VideoPlayer.PLAYBACK_RATES.length) {\n              appMediaPlaybackController.playbackRate = VideoPlayer.PLAYBACK_RATES[nextIdx];\n            }\n          } else if(wrapper.classList.contains('ckin__fullscreen') && (key === 'ArrowLeft' || key === 'ArrowRight')) {\n            if(key === 'ArrowLeft') appMediaPlaybackController.seekBackward({action: 'seekbackward'});\n            else appMediaPlaybackController.seekForward({action: 'seekforward'});\n          } else {\n            good = false;\n          }\n\n          if(good) {\n            cancelEvent(e);\n            return false;\n          }\n        });\n      }\n\n      listenerSetter.add(video)('dblclick', () => {\n        if(!IS_TOUCH_SUPPORTED) {\n          this.toggleFullScreen();\n        }\n      });\n\n      attachClickEvent(fullScreenButton, () => {\n        this.toggleFullScreen();\n      }, {listenerSetter: this.listenerSetter});\n\n      addFullScreenListener(wrapper, this.onFullScreen.bind(this, fullScreenButton), listenerSetter);\n\n      listenerSetter.add(video)('timeupdate', () => {\n        timeElapsed.textContent = toHHMMSS(video.currentTime | 0);\n      });\n\n      listenerSetter.add(video)('play', () => {\n        wrapper.classList.add('played');\n\n        if(!IS_TOUCH_SUPPORTED) {\n          listenerSetter.add(video)('play', () => {\n            this.hideControls(true);\n          });\n        }\n      }, {once: true});\n\n      listenerSetter.add(video)('pause', () => {\n        this.showControls(false);\n      });\n\n      listenerSetter.add(appMediaPlaybackController)('playbackParams', () => {\n        this.setPlaybackRateIcon();\n      });\n    }\n\n    listenerSetter.add(video)('play', () => {\n      wrapper.classList.add('is-playing');\n    });\n\n    listenerSetter.add(video)('pause', () => {\n      wrapper.classList.remove('is-playing');\n    });\n\n    if(video.duration || initDuration) {\n      timeDuration.textContent = toHHMMSS(Math.round(video.duration || initDuration));\n    } else {\n      onMediaLoad(video).then(() => {\n        timeDuration.textContent = toHHMMSS(Math.round(video.duration));\n      });\n    }\n  }\n\n  protected togglePlay() {\n    this.video[this.video.paused ? 'play' : 'pause']();\n  }\n\n  private buildControls() {\n    const skin = this.skin;\n    if(skin === 'default') {\n      return `\n      <button class=\"${skin}__button--big toggle tgico\" title=\"Toggle Play\"></button>\n      <div class=\"${skin}__gradient-bottom ckin__controls\"></div>\n      <div class=\"${skin}__controls ckin__controls\">\n        <div class=\"bottom-controls\">\n          <div class=\"left-controls\">\n            <button class=\"btn-icon ${skin}__button toggle tgico\" title=\"Toggle Video\"></button>\n            <div class=\"time\">\n              <time id=\"time-elapsed\">0:00</time>\n              <span> / </span>\n              <time id=\"time-duration\">0:00</time>\n            </div>\n          </div>\n          <div class=\"right-controls\">\n            <button class=\"btn-icon ${skin}__button btn-menu-toggle playback-rate night\" title=\"Playback Rate\"></button>\n            ${!IS_MOBILE && document.pictureInPictureEnabled ? `<button class=\"btn-icon ${skin}__button pip tgico-pip\" title=\"Picture-in-Picture\"></button>` : ''}\n            <button class=\"btn-icon ${skin}__button fullscreen tgico-fullscreen\" title=\"Full Screen\"></button>\n          </div>\n        </div>\n      </div>`;\n    }\n  }\n\n  protected setBtnMenuToggle() {\n    const buttons: Parameters<typeof ButtonMenu>[0] = VideoPlayer.PLAYBACK_RATES.map((rate, idx) => {\n      return {\n        // icon: VideoPlayer.PLAYBACK_RATES_ICONS[idx],\n        regularText: rate + 'x',\n        onClick: () => {\n          appMediaPlaybackController.playbackRate = rate;\n        }\n      };\n    });\n    const btnMenu = ButtonMenu(buttons);\n    btnMenu.classList.add('top-left');\n    ButtonMenuToggleHandler(\n      this.playbackRateButton,\n      this.onPlaybackRackMenuToggle ? () => {\n        this.onPlaybackRackMenuToggle(true);\n      } : undefined,\n      undefined,\n      this.onPlaybackRackMenuToggle ? () => {\n        this.onPlaybackRackMenuToggle(false);\n      } : undefined\n    );\n    this.playbackRateButton.append(btnMenu);\n\n    this.setPlaybackRateIcon();\n  }\n\n  protected setPlaybackRateIcon() {\n    const playbackRateButton = this.playbackRateButton;\n    VideoPlayer.PLAYBACK_RATES_ICONS.forEach((className) => {\n      className = 'tgico-' + className;\n      playbackRateButton.classList.remove(className);\n    });\n\n    let idx = VideoPlayer.PLAYBACK_RATES.indexOf(appMediaPlaybackController.playbackRate);\n    if(idx === -1) idx = VideoPlayer.PLAYBACK_RATES.indexOf(1);\n\n    playbackRateButton.classList.add('tgico-' + VideoPlayer.PLAYBACK_RATES_ICONS[idx]);\n  }\n\n  protected toggleFullScreen() {\n    const player = this.wrapper;\n\n    // * https://caniuse.com/#feat=fullscreen\n    if(IS_APPLE_MOBILE) {\n      const video = this.video as any;\n      video.webkitEnterFullscreen();\n      video.enterFullscreen();\n      return;\n    }\n\n    if(!isFullScreen()) {\n      /* const videoParent = this.video.parentElement;\n      const videoWhichChild = whichChild(this.video);\n      const needVideoRemount = videoParent !== player;\n\n      if(needVideoRemount) {\n        this.videoParent = videoParent;\n        this.videoWhichChild = videoWhichChild;\n        player.prepend(this.video);\n      } */\n\n      requestFullScreen(player);\n    } else {\n      /* if(this.videoParent) {\n        const {videoWhichChild, videoParent} = this;\n        if(!videoWhichChild) {\n          videoParent.prepend(this.video);\n        } else {\n          videoParent.insertBefore(this.video, videoParent.children[videoWhichChild]);\n        }\n\n        this.videoParent = null;\n        this.videoWhichChild = -1;\n      } */\n\n      cancelFullScreen();\n    }\n  }\n\n  protected onFullScreen(fullScreenButton: HTMLElement) {\n    const isFull = isFullScreen();\n    this.wrapper.classList.toggle('ckin__fullscreen', isFull);\n    if(!isFull) {\n      fullScreenButton.classList.remove('tgico-smallscreen');\n      fullScreenButton.classList.add('tgico-fullscreen');\n      fullScreenButton.setAttribute('title', 'Full Screen');\n    } else {\n      fullScreenButton.classList.remove('tgico-fullscreen');\n      fullScreenButton.classList.add('tgico-smallscreen');\n      fullScreenButton.setAttribute('title', 'Exit Full Screen');\n    }\n  }\n\n  public cleanup() {\n    super.cleanup();\n    this.listenerSetter.removeAll();\n    this.progress.removeListeners();\n    this.onPlaybackRackMenuToggle = this.onPip = undefined;\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport deferredPromise from '../helpers/cancellablePromise';\nimport mediaSizes from '../helpers/mediaSizes';\nimport IS_TOUCH_SUPPORTED from '../environment/touchSupport';\nimport {IS_MOBILE_SAFARI, IS_SAFARI} from '../environment/userAgent';\nimport type {MyDocument} from '../lib/appManagers/appDocsManager';\nimport type {MyPhoto} from '../lib/appManagers/appPhotosManager';\nimport {logger} from '../lib/logger';\nimport VideoPlayer from '../lib/mediaPlayer';\nimport rootScope from '../lib/rootScope';\nimport animationIntersector from './animationIntersector';\nimport appMediaPlaybackController, {AppMediaPlaybackController} from './appMediaPlaybackController';\nimport AvatarElement from './avatar';\nimport ButtonIcon from './buttonIcon';\nimport {ButtonMenuItemOptions} from './buttonMenu';\nimport ButtonMenuToggle from './buttonMenuToggle';\nimport ProgressivePreloader from './preloader';\nimport SwipeHandler from './swipeHandler';\nimport {formatFullSentTime} from '../helpers/date';\nimport appNavigationController, {NavigationItem} from './appNavigationController';\nimport {Message} from '../layer';\nimport findUpClassName from '../helpers/dom/findUpClassName';\nimport renderImageFromUrl, {renderImageFromUrlPromise} from '../helpers/dom/renderImageFromUrl';\nimport getVisibleRect from '../helpers/dom/getVisibleRect';\nimport cancelEvent from '../helpers/dom/cancelEvent';\nimport fillPropertyValue from '../helpers/fillPropertyValue';\nimport generatePathData from '../helpers/generatePathData';\nimport replaceContent from '../helpers/dom/replaceContent';\nimport PeerTitle from './peerTitle';\nimport {doubleRaf, fastRaf} from '../helpers/schedulers';\nimport RangeSelector from './rangeSelector';\nimport windowSize from '../helpers/windowSize';\nimport ListLoader from '../helpers/listLoader';\nimport EventListenerBase from '../helpers/eventListenerBase';\nimport {MyMessage} from '../lib/appManagers/appMessagesManager';\nimport {NULL_PEER_ID} from '../lib/mtproto/mtproto_config';\nimport {isFullScreen} from '../helpers/dom/fullScreen';\nimport {attachClickEvent} from '../helpers/dom/clickEvent';\nimport SearchListLoader from '../helpers/searchListLoader';\nimport createVideo from '../helpers/dom/createVideo';\nimport {AppManagers} from '../lib/appManagers/managers';\nimport getStrippedThumbIfNeeded from '../helpers/getStrippedThumbIfNeeded';\nimport setAttachmentSize from '../helpers/setAttachmentSize';\nimport wrapEmojiText from '../lib/richTextProcessor/wrapEmojiText';\nimport LazyLoadQueueBase from './lazyLoadQueueBase';\nimport overlayCounter from '../helpers/overlayCounter';\nimport {ThumbCache} from '../lib/storages/thumbs';\nimport appDownloadManager from '../lib/appManagers/appDownloadManager';\nimport wrapPeerTitle from './wrappers/peerTitle';\n\nconst ZOOM_STEP = 0.5;\nconst ZOOM_INITIAL_VALUE = 1;\nconst ZOOM_MIN_VALUE = 0.5;\nconst ZOOM_MAX_VALUE = 4;\n\n// TODO:   ( SVG)  ,      \n// TODO:  \"\"      ,     (,  )\n// TODO:    ,    :    ,     , ..  -   ,   \n\nexport const MEDIA_VIEWER_CLASSNAME = 'media-viewer';\n\nexport default class AppMediaViewerBase<\n  ContentAdditionType extends string,\n  ButtonsAdditionType extends string,\n  TargetType extends {element: HTMLElement\n}> extends EventListenerBase<{\n  setMoverBefore: () => void,\n  setMoverAfter: () => void\n}> {\n  protected wholeDiv: HTMLElement;\n  protected overlaysDiv: HTMLElement;\n  protected author: {[k in 'container' | 'avatarEl' | 'nameEl' | 'date']: HTMLElement} = {} as any;\n  protected content: {[k in 'main' | 'container' | 'media' | 'mover' | ContentAdditionType]: HTMLElement} = {} as any;\n  protected buttons: {[k in 'download' | 'close' | 'prev' | 'next' | 'mobile-close' | 'zoom' | ButtonsAdditionType]: HTMLElement} = {} as any;\n  protected topbar: HTMLElement;\n  protected moversContainer: HTMLElement;\n\n  protected tempId = 0;\n  protected preloader: ProgressivePreloader = null;\n  protected preloaderStreamable: ProgressivePreloader = null;\n\n  // protected targetContainer: HTMLElement = null;\n  // protected loadMore: () => void = null;\n\n  protected log: ReturnType<typeof logger>;\n\n  protected isFirstOpen = true;\n\n  // protected needLoadMore = true;\n\n  protected pageEl = document.getElementById('page-chats') as HTMLDivElement;\n\n  protected setMoverPromise: Promise<void>;\n  protected setMoverAnimationPromise: Promise<void>;\n\n  protected lazyLoadQueue: LazyLoadQueueBase;\n\n  protected highlightSwitchersTimeout: number;\n\n  protected onDownloadClick: (e: MouseEvent) => void;\n  protected onPrevClick: (target: TargetType) => void;\n  protected onNextClick: (target: TargetType) => void;\n\n  protected videoPlayer: VideoPlayer;\n\n  protected zoomElements: {\n    container: HTMLElement,\n    btnOut: HTMLElement,\n    btnIn: HTMLElement,\n    rangeSelector: RangeSelector\n  } = {} as any;\n  // protected zoomValue = ZOOM_INITIAL_VALUE;\n  protected zoomSwipeHandler: SwipeHandler;\n  protected zoomSwipeStartX = 0;\n  protected zoomSwipeStartY = 0;\n  protected zoomSwipeX = 0;\n  protected zoomSwipeY = 0;\n\n  protected ctrlKeyDown: boolean;\n  protected releaseSingleMedia: ReturnType<AppMediaPlaybackController['setSingleMedia']>;\n  protected navigationItem: NavigationItem;\n\n  protected managers: AppManagers;\n\n  get target() {\n    return this.listLoader.current;\n  }\n\n  set target(value) {\n    this.listLoader.current = value;\n  }\n\n  constructor(\n    protected listLoader: ListLoader<TargetType, any>,\n    topButtons: Array<keyof AppMediaViewerBase<ContentAdditionType, ButtonsAdditionType, TargetType>['buttons']>\n  ) {\n    super(false);\n\n    this.managers = rootScope.managers;\n\n    this.log = logger('AMV');\n    this.preloader = new ProgressivePreloader();\n    this.preloaderStreamable = new ProgressivePreloader({\n      cancelable: false,\n      streamable: true\n    });\n    this.preloader.construct();\n    this.preloaderStreamable.construct();\n    this.lazyLoadQueue = new LazyLoadQueueBase();\n\n    this.wholeDiv = document.createElement('div');\n    this.wholeDiv.classList.add(MEDIA_VIEWER_CLASSNAME + '-whole');\n\n    this.overlaysDiv = document.createElement('div');\n    this.overlaysDiv.classList.add('overlays');\n\n    const mainDiv = document.createElement('div');\n    mainDiv.classList.add(MEDIA_VIEWER_CLASSNAME);\n\n    const topbar = this.topbar = document.createElement('div');\n    topbar.classList.add(MEDIA_VIEWER_CLASSNAME + '-topbar', MEDIA_VIEWER_CLASSNAME + '-appear');\n\n    const topbarLeft = document.createElement('div');\n    topbarLeft.classList.add(MEDIA_VIEWER_CLASSNAME + '-topbar-left');\n\n    this.buttons['mobile-close'] = ButtonIcon('close', {onlyMobile: true});\n\n    // * author\n    this.author.container = document.createElement('div');\n    this.author.container.classList.add(MEDIA_VIEWER_CLASSNAME + '-author', 'no-select');\n    const authorRight = document.createElement('div');\n\n    this.author.avatarEl = new AvatarElement();\n    this.author.avatarEl.classList.add(MEDIA_VIEWER_CLASSNAME + '-userpic', 'avatar-44');\n\n    this.author.nameEl = document.createElement('div');\n    this.author.nameEl.classList.add(MEDIA_VIEWER_CLASSNAME + '-name');\n\n    this.author.date = document.createElement('div');\n    this.author.date.classList.add(MEDIA_VIEWER_CLASSNAME + '-date');\n\n    authorRight.append(this.author.nameEl, this.author.date);\n\n    this.author.container.append(this.author.avatarEl, authorRight);\n\n    // * buttons\n    const buttonsDiv = document.createElement('div');\n    buttonsDiv.classList.add(MEDIA_VIEWER_CLASSNAME + '-buttons');\n\n    topButtons.concat(['download', 'zoom', 'close']).forEach((name) => {\n      const button = ButtonIcon(name, {noRipple: true});\n      this.buttons[name] = button;\n      buttonsDiv.append(button);\n    });\n\n    this.buttons.zoom.classList.add('zoom-in');\n\n    // * zoom\n    this.zoomElements.container = document.createElement('div');\n    this.zoomElements.container.classList.add('zoom-container');\n\n    this.zoomElements.btnOut = ButtonIcon('zoomout', {noRipple: true});\n    attachClickEvent(this.zoomElements.btnOut, () => this.changeZoom(false));\n    this.zoomElements.btnIn = ButtonIcon('zoomin', {noRipple: true});\n    attachClickEvent(this.zoomElements.btnIn, () => this.changeZoom(true));\n\n    this.zoomElements.rangeSelector = new RangeSelector({\n      step: ZOOM_STEP,\n      min: ZOOM_MIN_VALUE,\n      max: ZOOM_MAX_VALUE,\n      withTransition: true\n    }, ZOOM_INITIAL_VALUE);\n    this.zoomElements.rangeSelector.setListeners();\n    this.zoomElements.rangeSelector.setHandlers({\n      onScrub: this.setZoomValue,\n      onMouseUp: () => this.setZoomValue()\n    });\n\n    this.zoomElements.container.append(this.zoomElements.btnOut, this.zoomElements.rangeSelector.container, this.zoomElements.btnIn);\n\n    this.wholeDiv.append(this.zoomElements.container);\n\n    // * content\n    this.content.main = document.createElement('div');\n    this.content.main.classList.add(MEDIA_VIEWER_CLASSNAME + '-content');\n\n    this.content.container = document.createElement('div');\n    this.content.container.classList.add(MEDIA_VIEWER_CLASSNAME + '-container');\n\n    this.content.media = document.createElement('div');\n    this.content.media.classList.add(MEDIA_VIEWER_CLASSNAME + '-media');\n\n    this.content.container.append(this.content.media);\n\n    this.content.main.append(this.content.container);\n    mainDiv.append(this.content.main);\n    this.overlaysDiv.append(mainDiv);\n    // * overlays end\n\n    topbarLeft.append(this.buttons['mobile-close'], this.author.container);\n    topbar.append(topbarLeft, buttonsDiv);\n\n    this.buttons.prev = document.createElement('div');\n    this.buttons.prev.className = `${MEDIA_VIEWER_CLASSNAME}-switcher ${MEDIA_VIEWER_CLASSNAME}-switcher-left`;\n    this.buttons.prev.innerHTML = `<span class=\"tgico-down ${MEDIA_VIEWER_CLASSNAME}-prev-button\"></span>`;\n\n    this.buttons.next = document.createElement('div');\n    this.buttons.next.className = `${MEDIA_VIEWER_CLASSNAME}-switcher ${MEDIA_VIEWER_CLASSNAME}-switcher-right`;\n    this.buttons.next.innerHTML = `<span class=\"tgico-down ${MEDIA_VIEWER_CLASSNAME}-next-button\"></span>`;\n\n    this.moversContainer = document.createElement('div');\n    this.moversContainer.classList.add(MEDIA_VIEWER_CLASSNAME + '-movers');\n\n    this.wholeDiv.append(this.overlaysDiv, this.buttons.prev, this.buttons.next, this.topbar, this.moversContainer);\n\n    // * constructing html end\n\n    this.listLoader.onLoadedMore = () => {\n      this.buttons.prev.classList.toggle('hide', !this.listLoader.previous.length);\n      this.buttons.next.classList.toggle('hide', !this.listLoader.next.length);\n    };\n\n    this.setNewMover();\n  }\n\n  protected setListeners() {\n    attachClickEvent(this.buttons.download, this.onDownloadClick);\n    [this.buttons.close, this.buttons['mobile-close'], this.preloaderStreamable.preloader].forEach((el) => {\n      attachClickEvent(el, this.close.bind(this));\n    });\n\n    ([[-1, this.buttons.prev], [1, this.buttons.next]] as [number, HTMLElement][]).forEach(([moveLength, button]) => {\n      // attachClickEvent(button, (e) => {\n      button.addEventListener('click', (e) => {\n        cancelEvent(e);\n        if(this.setMoverPromise) return;\n\n        this.listLoader.go(moveLength);\n      });\n    });\n\n    attachClickEvent(this.buttons.zoom, () => {\n      if(this.isZooming()) this.toggleZoom(false);\n      else {\n        this.changeZoom(true);\n      }\n    });\n\n    // ! cannot use the function because it'll cancel slide event on touch devices\n    // attachClickEvent(this.wholeDiv, this.onClick);\n    this.wholeDiv.addEventListener('click', this.onClick);\n\n    this.listLoader.onJump = (item, older) => {\n      if(older) this.onNextClick(item);\n      else this.onPrevClick(item);\n    };\n\n    if(IS_TOUCH_SUPPORTED) {\n      const swipeHandler = new SwipeHandler({\n        element: this.wholeDiv,\n        onSwipe: (xDiff, yDiff) => {\n          if(isFullScreen()) {\n            return;\n          }\n          // console.log(xDiff, yDiff);\n\n          const percents = Math.abs(xDiff) / windowSize.width;\n          if(percents > .2 || xDiff > 125) {\n            // console.log('will swipe', xDiff);\n\n            if(xDiff < 0) {\n              this.buttons.prev.click();\n            } else {\n              this.buttons.next.click();\n            }\n\n            return true;\n          }\n\n          const percentsY = Math.abs(yDiff) / windowSize.height;\n          if(percentsY > .2 || yDiff > 125) {\n            this.close();\n            return true;\n          }\n\n          return false;\n        },\n        verifyTouchTarget: (evt) => {\n          // * Fix for seek input\n          if((evt.target as HTMLElement).tagName === 'INPUT' || findUpClassName(evt.target, 'media-viewer-caption')) {\n            return false;\n          }\n\n          return true;\n        }\n      });\n    }\n  }\n\n  protected toggleZoom(enable?: boolean) {\n    const isVisible = this.isZooming();\n    if(this.zoomElements.rangeSelector.mousedown || this.ctrlKeyDown) {\n      enable = true;\n    }\n\n    if(isVisible === enable) return;\n\n    if(enable === undefined) {\n      enable = !isVisible;\n    }\n\n    this.buttons.zoom.classList.toggle('zoom-in', !enable);\n    this.zoomElements.container.classList.toggle('is-visible', enable);\n    const zoomValue = enable ? this.zoomElements.rangeSelector.value : 1;\n    this.setZoomValue(zoomValue);\n    this.zoomElements.rangeSelector.setProgress(zoomValue);\n\n    if(this.videoPlayer) {\n      this.videoPlayer.lockControls(enable ? false : undefined);\n    }\n\n    if(enable) {\n      if(!this.zoomSwipeHandler) {\n        let lastDiffX: number, lastDiffY: number;\n        const multiplier = -1;\n        this.zoomSwipeHandler = new SwipeHandler({\n          element: this.moversContainer,\n          onFirstSwipe: () => {\n            lastDiffX = lastDiffY = 0;\n            this.moversContainer.classList.add('no-transition');\n          },\n          onSwipe: (xDiff, yDiff) => {\n            [xDiff, yDiff] = [xDiff * multiplier, yDiff * multiplier];\n            this.zoomSwipeX += xDiff - lastDiffX;\n            this.zoomSwipeY += yDiff - lastDiffY;\n            [lastDiffX, lastDiffY] = [xDiff, yDiff];\n\n            this.setZoomValue();\n          },\n          onReset: () => {\n            this.moversContainer.classList.remove('no-transition');\n          },\n          cursor: 'move'\n        });\n      } else {\n        this.zoomSwipeHandler.setListeners();\n      }\n\n      this.zoomElements.rangeSelector.setProgress(zoomValue);\n    } else if(!enable) {\n      this.zoomSwipeHandler.removeListeners();\n    }\n  }\n\n  protected changeZoom(add: boolean) {\n    this.zoomElements.rangeSelector.addProgress(ZOOM_STEP * (add ? 1 : -1));\n    this.setZoomValue();\n  }\n\n  protected setZoomValue = (value = this.zoomElements.rangeSelector.value) => {\n    // this.zoomValue = value;\n    if(value === ZOOM_INITIAL_VALUE) {\n      this.zoomSwipeX = 0;\n      this.zoomSwipeY = 0;\n    }\n\n    this.moversContainer.style.transform = `matrix(${value}, 0, 0, ${value}, ${this.zoomSwipeX}, ${this.zoomSwipeY})`;\n\n    this.zoomElements.btnOut.classList.toggle('inactive', value === ZOOM_MIN_VALUE);\n    this.zoomElements.btnIn.classList.toggle('inactive', value === ZOOM_MAX_VALUE);\n\n    this.toggleZoom(value !== ZOOM_INITIAL_VALUE);\n  };\n\n  protected isZooming() {\n    return this.zoomElements.container.classList.contains('is-visible');\n  }\n\n  protected setBtnMenuToggle(buttons: ButtonMenuItemOptions[]) {\n    const btnMenuToggle = ButtonMenuToggle({onlyMobile: true}, 'bottom-left', buttons);\n    this.topbar.append(btnMenuToggle);\n  }\n\n  public close(e?: MouseEvent) {\n    if(e) {\n      cancelEvent(e);\n    }\n\n    if(this.setMoverAnimationPromise) return Promise.reject();\n\n    if(this.navigationItem) {\n      appNavigationController.removeItem(this.navigationItem);\n    }\n\n    this.lazyLoadQueue.clear();\n\n    const promise = this.setMoverToTarget(this.target?.element, true).then(({onAnimationEnd}) => onAnimationEnd);\n\n    this.listLoader.reset();\n    (this.listLoader as SearchListLoader<any>).cleanup && (this.listLoader as SearchListLoader<any>).cleanup();\n    this.setMoverPromise = null;\n    this.tempId = -1;\n    if((window as any).appMediaViewer === this) {\n      (window as any).appMediaViewer = undefined;\n    }\n\n    /* if(appSidebarRight.historyTabIDs.slice(-1)[0] === AppSidebarRight.SLIDERITEMSIDS.forward) {\n      promise.then(() => {\n        appSidebarRight.forwardTab.closeBtn.click();\n      });\n    } */\n\n    this.removeGlobalListeners();\n\n    this.zoomSwipeHandler = undefined;\n\n    promise.finally(() => {\n      this.wholeDiv.remove();\n      this.toggleOverlay(false);\n    });\n\n    return promise;\n  }\n\n  protected toggleOverlay(active: boolean) {\n    overlayCounter.isOverlayActive = active;\n    animationIntersector.checkAnimations(active);\n  }\n\n  protected toggleGlobalListeners(active: boolean) {\n    if(active) this.setGlobalListeners();\n    else this.removeGlobalListeners();\n  }\n\n  protected removeGlobalListeners() {\n    if(this.zoomSwipeHandler) {\n      this.zoomSwipeHandler.removeListeners();\n    }\n\n    window.removeEventListener('keydown', this.onKeyDown);\n    window.removeEventListener('keyup', this.onKeyUp);\n    window.removeEventListener('wheel', this.onWheel, {capture: true});\n  }\n\n  protected setGlobalListeners() {\n    if(this.isZooming()) {\n      this.zoomSwipeHandler.setListeners();\n    }\n\n    window.addEventListener('keydown', this.onKeyDown);\n    window.addEventListener('keyup', this.onKeyUp);\n    if(!IS_TOUCH_SUPPORTED) window.addEventListener('wheel', this.onWheel, {passive: false, capture: true});\n  }\n\n  onClick = (e: MouseEvent) => {\n    if(this.setMoverAnimationPromise) return;\n\n    const target = e.target as HTMLElement;\n    if(target.tagName === 'A') return;\n    cancelEvent(e);\n\n    if(IS_TOUCH_SUPPORTED) {\n      if(this.highlightSwitchersTimeout) {\n        clearTimeout(this.highlightSwitchersTimeout);\n      } else {\n        this.wholeDiv.classList.add('highlight-switchers');\n      }\n\n      this.highlightSwitchersTimeout = window.setTimeout(() => {\n        this.wholeDiv.classList.remove('highlight-switchers');\n        this.highlightSwitchersTimeout = 0;\n      }, 3e3);\n\n      return;\n    }\n\n    const isZooming = this.isZooming();\n    let mover: HTMLElement = null;\n    const classNames = ['ckin__player', 'media-viewer-buttons', 'media-viewer-author', 'media-viewer-caption', 'zoom-container'];\n    if(isZooming) {\n      classNames.push('media-viewer-movers');\n    }\n\n    classNames.find((s) => {\n      try {\n        mover = findUpClassName(target, s);\n        if(mover) return true;\n      } catch(err) {return false;}\n    });\n\n    if(/* target === this.mediaViewerDiv */!mover || (!isZooming && (target.tagName === 'IMG' || target.tagName === 'image'))) {\n      this.close();\n    }\n  };\n\n  private onKeyDown = (e: KeyboardEvent) => {\n    // this.log('onKeyDown', e);\n    if(overlayCounter.overlaysActive > 1) {\n      return;\n    }\n\n    const key = e.key;\n\n    let good = true;\n    if(key === 'ArrowRight') {\n      this.buttons.next.click();\n    } else if(key === 'ArrowLeft') {\n      this.buttons.prev.click();\n    } else if(key === '-' || key === '=') {\n      if(this.ctrlKeyDown) {\n        this.changeZoom(key === '=');\n      }\n    } else {\n      good = false;\n    }\n\n    if(e.ctrlKey || e.metaKey) {\n      this.ctrlKeyDown = true;\n    }\n\n    if(good) {\n      cancelEvent(e);\n    }\n  };\n\n  private onKeyUp = (e: KeyboardEvent) => {\n    if(overlayCounter.overlaysActive > 1) {\n      return;\n    }\n\n    if(!(e.ctrlKey || e.metaKey)) {\n      this.ctrlKeyDown = false;\n\n      if(this.isZooming()) {\n        this.setZoomValue();\n      }\n    }\n  };\n\n  private onWheel = (e: WheelEvent) => {\n    if(overlayCounter.overlaysActive > 1 || (findUpClassName(e.target, 'media-viewer-caption') && !this.ctrlKeyDown)) {\n      return;\n    }\n\n    cancelEvent(e);\n\n    if(this.ctrlKeyDown) {\n      const scrollingUp = e.deltaY < 0;\n      // if(!scrollingUp && !this.isZooming()) return;\n      this.changeZoom(!!scrollingUp);\n    }\n  };\n\n  protected async setMoverToTarget(target: HTMLElement, closing = false, fromRight = 0) {\n    this.dispatchEvent('setMoverBefore');\n\n    const mover = this.content.mover;\n\n    if(!closing) {\n      mover.innerHTML = '';\n      // mover.append(this.buttons.prev, this.buttons.next);\n    }\n\n    const zoomValue = this.isZooming() && closing /* && false */ ? this.zoomElements.rangeSelector.value : ZOOM_INITIAL_VALUE;\n    /* if(!(zoomValue > 1 && closing)) */ this.removeCenterFromMover(mover);\n\n    const wasActive = fromRight !== 0;\n\n    const delay = rootScope.settings.animationsEnabled ? (wasActive ? 350 : 200) : 0;\n    // let delay = wasActive ? 350 : 10000;\n\n    /* if(wasActive) {\n      this.moveTheMover(mover);\n      mover = this.setNewMover();\n    } */\n\n    /* if(DEBUG) {\n      this.log('setMoverToTarget', target, closing, wasActive, fromRight);\n    } */\n\n    let realParent: HTMLElement;\n\n    let rect: DOMRect;\n    if(target) {\n      if(target instanceof AvatarElement || target.classList.contains('grid-item')/*  || target.classList.contains('document-ico') */) {\n        realParent = target;\n        rect = target.getBoundingClientRect();\n      } else if(target instanceof SVGImageElement || target.parentElement instanceof SVGForeignObjectElement) {\n        realParent = findUpClassName(target, 'attachment');\n        rect = realParent.getBoundingClientRect();\n      } else if(target.classList.contains('profile-avatars-avatar')) {\n        realParent = findUpClassName(target, 'profile-avatars-container');\n        rect = realParent.getBoundingClientRect();\n\n        // * if not active avatar\n        if(closing && target.getBoundingClientRect().left !== rect.left) {\n          target = realParent = rect = undefined;\n        }\n      }\n    }\n\n    if(!target) {\n      target = this.content.media;\n    }\n\n    if(!rect) {\n      realParent = target.parentElement as HTMLElement;\n      rect = target.getBoundingClientRect();\n    }\n\n    let needOpacity = false;\n    if(target !== this.content.media && !target.classList.contains('profile-avatars-avatar')) {\n      const overflowElement = findUpClassName(realParent, 'scrollable');\n      const visibleRect = getVisibleRect(realParent, overflowElement, true);\n\n      if(closing && (!visibleRect || visibleRect.overflow.vertical === 2 || visibleRect.overflow.horizontal === 2)) {\n        target = this.content.media;\n        realParent = target.parentElement as HTMLElement;\n        rect = target.getBoundingClientRect();\n      } else if(visibleRect && (visibleRect.overflow.vertical === 1 || visibleRect.overflow.horizontal === 1)) {\n        needOpacity = true;\n      }\n    }\n\n    const containerRect = this.content.media.getBoundingClientRect();\n\n    let transform = '';\n    let left: number;\n    let top: number;\n\n    if(wasActive) {\n      left = fromRight === 1 ? windowSize.width : -containerRect.width;\n      top = containerRect.top;\n    } else {\n      left = rect.left;\n      top = rect.top;\n    }\n\n    /* if(zoomValue > 1) { // 33\n      // const diffX = (rect.width * zoomValue - rect.width) / 4;\n      const diffX = (rect.width * zoomValue - rect.width) / 2;\n      const diffY = (rect.height * zoomValue - rect.height) / 4;\n      // left -= diffX;\n      // top += diffY;\n    } */\n\n    transform += `translate3d(${left}px,${top}px,0) `;\n\n    /* if(wasActive) {\n      left = fromRight === 1 ? appPhotosManager.windowW / 2 : -(containerRect.width + appPhotosManager.windowW / 2);\n      transform += `translate(${left}px,-50%) `;\n    } else {\n      left = rect.left - (appPhotosManager.windowW / 2);\n      top = rect.top - (appPhotosManager.windowH / 2);\n      transform += `translate(${left}px,${top}px) `;\n    } */\n\n    let aspecter: HTMLDivElement;\n    if(target instanceof HTMLImageElement || target instanceof HTMLVideoElement || target.tagName === 'DIV') {\n      if(mover.firstElementChild && mover.firstElementChild.classList.contains('media-viewer-aspecter')) {\n        aspecter = mover.firstElementChild as HTMLDivElement;\n\n        const player = aspecter.querySelector('.ckin__player');\n        if(player) {\n          const video = player.firstElementChild as HTMLVideoElement;\n          aspecter.append(video);\n          player.remove();\n        }\n\n        if(!aspecter.style.cssText) { //  - ,   ,       \n          mover.classList.remove('active');\n          this.setFullAspect(aspecter, containerRect, rect);\n          void mover.offsetLeft; // reflow\n          mover.classList.add('active');\n        }\n      } else {\n        aspecter = document.createElement('div');\n        aspecter.classList.add('media-viewer-aspecter'/* , 'disable-hover' */);\n        mover.prepend(aspecter);\n      }\n\n      aspecter.style.cssText = `width: ${rect.width}px; height: ${rect.height}px; transform: scale3d(${containerRect.width / rect.width}, ${containerRect.height / rect.height}, 1);`;\n    }\n\n    mover.style.width = containerRect.width + 'px';\n    mover.style.height = containerRect.height + 'px';\n\n    // const scaleX = rect.width / (containerRect.width * zoomValue);\n    // const scaleY = rect.height / (containerRect.height * zoomValue);\n    const scaleX = rect.width / containerRect.width;\n    const scaleY = rect.height / containerRect.height;\n    if(!wasActive) {\n      transform += `scale3d(${scaleX},${scaleY},1) `;\n    }\n\n    let borderRadius = window.getComputedStyle(realParent).getPropertyValue('border-radius');\n    const brSplitted = fillPropertyValue(borderRadius) as string[];\n    borderRadius = brSplitted.map((r) => (parseInt(r) / scaleX) + 'px').join(' ');\n    if(!wasActive) {\n      mover.style.borderRadius = borderRadius;\n    }\n    // let borderRadius = '0px 0px 0px 0px';\n\n    if(closing && zoomValue !== 1) {\n      // const width = this.moversContainer.scrollWidth * scaleX;\n      // const height = this.moversContainer.scrollHeight * scaleY;\n      const willBeLeft = windowSize.width / 2 - rect.width / 2;\n      const willBeTop = windowSize.height / 2 - rect.height / 2;\n      const left = rect.left - willBeLeft/*  + (width - rect.width) / 2 */;\n      const top = rect.top - willBeTop/*  + (height - rect.height) / 2 */;\n      this.moversContainer.style.transform = `matrix(${scaleX}, 0, 0, ${scaleY}, ${left}, ${top})`;\n    } else {\n      mover.style.transform = transform;\n    }\n\n    needOpacity && (mover.style.opacity = '0'/* !closing ? '0' : '' */);\n\n    /* if(wasActive) {\n      this.log('setMoverToTarget', mover.style.transform);\n    } */\n\n    let path: SVGPathElement;\n    const isOut = target.classList.contains('is-out');\n\n    const deferred = this.setMoverAnimationPromise = deferredPromise<void>();\n    const ret = {onAnimationEnd: deferred};\n\n    const timeout = setTimeout(() => {\n      if(!deferred.isFulfilled && !deferred.isRejected) {\n        deferred.resolve();\n      }\n    }, 1000);\n\n    deferred.finally(() => {\n      this.dispatchEvent('setMoverAfter');\n\n      if(this.setMoverAnimationPromise === deferred) {\n        this.setMoverAnimationPromise = null;\n      }\n\n      clearTimeout(timeout);\n    });\n\n    if(!closing) {\n      let mediaElement: HTMLImageElement | HTMLVideoElement | HTMLCanvasElement;\n      let src: string;\n\n      // if(target instanceof HTMLVideoElement) {\n      const selector = 'video, img, .canvas-thumbnail';\n      const queryFrom = target.matches(selector) ? target.parentElement : target;\n      const elements = Array.from(queryFrom.querySelectorAll(selector)) as HTMLImageElement[];\n      if(elements.length) {\n        target = elements.pop();\n        const canvas = document.createElement('canvas');\n        const context = canvas.getContext('2d');\n        if(target instanceof HTMLImageElement) {\n          canvas.width = target.naturalWidth;\n          canvas.height = target.naturalHeight;\n        } else if(target instanceof HTMLVideoElement) {\n          canvas.width = target.videoWidth;\n          canvas.height = target.videoHeight;\n        } else if(target instanceof HTMLCanvasElement) {\n          canvas.width = target.width;\n          canvas.height = target.height;\n        }\n\n        canvas.className = 'canvas-thumbnail thumbnail media-photo';\n        context.drawImage(target as HTMLImageElement | HTMLCanvasElement, 0, 0);\n        target = canvas;\n      }\n      // }\n\n      if(target.tagName === 'DIV' || target.tagName === 'AVATAR-ELEMENT') { // useContainerAsTarget\n        const images = Array.from(target.querySelectorAll('img')) as HTMLImageElement[];\n        const image = images.pop();\n        if(image) {\n          mediaElement = new Image();\n          src = image.src;\n          mover.append(mediaElement);\n        }\n        /* mediaElement = new Image();\n        src = target.style.backgroundImage.slice(5, -2); */\n      } else if(target instanceof HTMLImageElement) {\n        mediaElement = new Image();\n        src = target.src;\n      } else if(target instanceof HTMLVideoElement) {\n        mediaElement = createVideo();\n        mediaElement.src = target.src;\n      } else if(target instanceof SVGSVGElement) {\n        const clipId = target.dataset.clipId;\n        const newClipId = clipId + '-mv';\n\n        const {width, height} = containerRect;\n\n        const newSvg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');\n        newSvg.setAttributeNS(null, 'width', '' + width);\n        newSvg.setAttributeNS(null, 'height', '' + height);\n\n        //     \n        newSvg.setAttributeNS(null, 'viewBox', `0 0 ${width} ${height}`);\n        newSvg.setAttributeNS(null, 'preserveAspectRatio', 'xMidYMid meet');\n\n        newSvg.insertAdjacentHTML('beforeend', target.firstElementChild.outerHTML.replace(clipId, newClipId));\n        newSvg.insertAdjacentHTML('beforeend', target.lastElementChild.outerHTML.replace(clipId, newClipId));\n\n        //       \n        const defs = newSvg.firstElementChild;\n        const use = defs.firstElementChild.firstElementChild as SVGUseElement;\n        if(use instanceof SVGUseElement) {\n          let transform = use.getAttributeNS(null, 'transform');\n          transform = transform.replace(/translate\\((.+?), (.+?)\\) scale\\((.+?), (.+?)\\)/, (match, x, y, sX, sY) => {\n            x = +x;\n            if(x !== 2) {\n              x = width - (2 / scaleX);\n            } else {\n              x = 2 / scaleX;\n            }\n\n            y = height;\n\n            return `translate(${x}, ${y}) scale(${+sX / scaleX}, ${+sY / scaleY})`;\n          });\n          use.setAttributeNS(null, 'transform', transform);\n\n          //   RECT\n          path = defs.firstElementChild.lastElementChild as SVGPathElement;\n\n          //            \n          let d: string;\n          const br: [number, number, number, number] = borderRadius.split(' ').map((v) => parseInt(v)) as any;\n          if(isOut) d = generatePathData(0, 0, width - 9 / scaleX, height, ...br);\n          else d = generatePathData(9 / scaleX, 0, width - 9 / scaleX, height, ...br);\n          path.setAttributeNS(null, 'd', d);\n        }\n\n        const foreignObject = newSvg.lastElementChild;\n        foreignObject.setAttributeNS(null, 'width', '' + containerRect.width);\n        foreignObject.setAttributeNS(null, 'height', '' + containerRect.height);\n\n        mover.prepend(newSvg);\n      } else if(target instanceof HTMLCanvasElement) {\n        mediaElement = target;\n      }\n\n      if(aspecter) {\n        aspecter.style.borderRadius = borderRadius;\n\n        if(mediaElement) {\n          aspecter.append(mediaElement);\n        }\n      }\n\n      mediaElement = mover.querySelector('video, img');\n      if(mediaElement instanceof HTMLImageElement) {\n        mediaElement.classList.add('thumbnail');\n        if(!aspecter) {\n          mediaElement.style.width = containerRect.width + 'px';\n          mediaElement.style.height = containerRect.height + 'px';\n        }\n\n        if(src) {\n          await renderImageFromUrlPromise(mediaElement, src);\n        }\n      }/*  else if(mediaElement instanceof HTMLVideoElement && mediaElement.firstElementChild && ((mediaElement.firstElementChild as HTMLSourceElement).src || src)) {\n        await new Promise((resolve, reject) => {\n          mediaElement.addEventListener('loadeddata', resolve);\n\n          if(src) {\n            (mediaElement.firstElementChild as HTMLSourceElement).src = src;\n          }\n        });\n      } */\n\n      mover.style.display = '';\n\n      fastRaf(() => {\n        mover.classList.add(wasActive ? 'moving' : 'active');\n      });\n    } else {\n      /* if(mover.classList.contains('center')) {\n        mover.classList.remove('center');\n        void mover.offsetLeft; // reflow\n      } */\n\n      if(target instanceof SVGSVGElement) {\n        path = mover.querySelector('path');\n\n        if(path) {\n          this.sizeTailPath(path, containerRect, scaleX, delay, false, isOut, borderRadius);\n        }\n      }\n\n      if(target.classList.contains('media-viewer-media')) {\n        mover.classList.add('hiding');\n      }\n\n      this.toggleWholeActive(false);\n\n      // return ret;\n\n      setTimeout(() => {\n        mover.style.borderRadius = borderRadius;\n\n        if(mover.firstElementChild) {\n          (mover.firstElementChild as HTMLElement).style.borderRadius = borderRadius;\n        }\n      }, delay / 2);\n\n      setTimeout(() => {\n        mover.innerHTML = '';\n        mover.classList.remove('moving', 'active', 'hiding');\n        mover.style.cssText = 'display: none;';\n\n        deferred.resolve();\n      }, delay);\n\n      mover.classList.remove('opening');\n\n      return ret;\n    }\n\n    mover.classList.add('opening');\n\n    // await new Promise((resolve) => setTimeout(resolve, 0));\n    // await new Promise((resolve) => window.requestAnimationFrame(resolve));\n    // *  RAF' ,       (  )\n    await doubleRaf();\n\n    //     - \n    // throw '';\n\n    // await new Promise((resolve) => setTimeout(resolve, 5e3));\n\n    mover.style.transform = `translate3d(${containerRect.left}px,${containerRect.top}px,0) scale3d(1,1,1)`;\n    // mover.style.transform = `translate(-50%,-50%) scale(1,1)`;\n    needOpacity && (mover.style.opacity = ''/* closing ? '0' : '' */);\n\n    if(aspecter) {\n      this.setFullAspect(aspecter, containerRect, rect);\n    }\n\n    // throw '';\n\n    setTimeout(() => {\n      mover.style.borderRadius = '';\n\n      if(mover.firstElementChild) {\n        (mover.firstElementChild as HTMLElement).style.borderRadius = '';\n      }\n    }, 0/* delay / 2 */);\n\n    mover.dataset.timeout = '' + setTimeout(() => {\n      mover.classList.remove('moving', 'opening');\n\n      if(aspecter) { //  - ,   ,       \n        if(mover.querySelector('video') || true) {\n          mover.classList.remove('active');\n          aspecter.style.cssText = '';\n          void mover.offsetLeft; // reflow\n        }\n\n        // aspecter.classList.remove('disable-hover');\n      }\n\n      //       ,      \n      mover.classList.add('center', 'no-transition');\n      /* mover.style.left = mover.style.top = '50%';\n      mover.style.transform = 'translate(-50%, -50%)';\n      void mover.offsetLeft; // reflow */\n\n      //      \n      mover.classList.add('active');\n      delete mover.dataset.timeout;\n\n      deferred.resolve();\n    }, delay);\n\n    if(path) {\n      this.sizeTailPath(path, containerRect, scaleX, delay, true, isOut, borderRadius);\n    }\n\n    return ret;\n  }\n\n  protected toggleWholeActive(active: boolean) {\n    if(active) {\n      this.wholeDiv.classList.add('active');\n    } else {\n      this.wholeDiv.classList.add('backwards');\n      setTimeout(() => {\n        this.wholeDiv.classList.remove('active');\n      }, 0);\n    }\n  }\n\n  protected setFullAspect(aspecter: HTMLDivElement, containerRect: DOMRect, rect: DOMRect) {\n    /* let media = aspecter.firstElementChild;\n    let proportion: number;\n    if(media instanceof HTMLImageElement) {\n      proportion = media.naturalWidth / media.naturalHeight;\n    } else if(media instanceof HTMLVideoElement) {\n      proportion = media.videoWidth / media.videoHeight;\n    } */\n    const proportion = containerRect.width / containerRect.height;\n\n    let {width, height} = rect;\n    /* if(proportion === 1) {\n      aspecter.style.cssText = '';\n    } else { */\n    if(proportion > 0) {\n      width = height * proportion;\n    } else {\n      height = width * proportion;\n    }\n\n    // this.log('will set style aspecter:', `width: ${width}px; height: ${height}px; transform: scale(${containerRect.width / width}, ${containerRect.height / height});`);\n\n    aspecter.style.cssText = `width: ${width}px; height: ${height}px; transform: scale3d(${containerRect.width / width}, ${containerRect.height / height}, 1);`;\n    // }\n  }\n\n  protected sizeTailPath(path: SVGPathElement, rect: DOMRect, scaleX: number, delay: number, upscale: boolean, isOut: boolean, borderRadius: string) {\n    const start = Date.now();\n    const {width, height} = rect;\n    delay = delay / 2;\n\n    const br = borderRadius.split(' ').map((v) => parseInt(v));\n\n    const step = () => {\n      const diff = Date.now() - start;\n\n      let progress = delay ? diff / delay : 1;\n      if(progress > 1) progress = 1;\n      if(upscale) progress = 1 - progress;\n\n      const _br: [number, number, number, number] = br.map((v) => v * progress) as any;\n\n      let d: string;\n      if(isOut) d = generatePathData(0, 0, width - (9 / scaleX * progress), height, ..._br);\n      else d = generatePathData(9 / scaleX * progress, 0, width/* width - (9 / scaleX * progress) */, height, ..._br);\n      path.setAttributeNS(null, 'd', d);\n\n      if(diff < delay) fastRaf(step);\n    };\n\n    // window.requestAnimationFrame(step);\n    step();\n  }\n\n  protected removeCenterFromMover(mover: HTMLElement) {\n    if(mover.classList.contains('center')) {\n      // const rect = mover.getBoundingClientRect();\n      const rect = this.content.media.getBoundingClientRect();\n      mover.style.transform = `translate3d(${rect.left}px,${rect.top}px,0)`;\n      mover.classList.remove('center');\n      void mover.offsetLeft; // reflow\n      mover.classList.remove('no-transition');\n    }\n  }\n\n  protected moveTheMover(mover: HTMLElement, toLeft = true) {\n    const windowW = windowSize.width;\n\n    this.removeCenterFromMover(mover);\n\n    // mover.classList.remove('active');\n    mover.classList.add('moving');\n\n    if(mover.dataset.timeout) { //     -  ,      \n      clearTimeout(+mover.dataset.timeout);\n    }\n\n    const rect = mover.getBoundingClientRect();\n\n    const newTransform = mover.style.transform.replace(/translate3d\\((.+?),/, (match, p1) => {\n      const x = toLeft ? -rect.width : windowW;\n      // const x = toLeft ? -(rect.right + (rect.width / 2)) : windowW / 2;\n\n      return match.replace(p1, x + 'px');\n    });\n\n    // //////this.log('set newTransform:', newTransform, mover.style.transform, toLeft);\n    mover.style.transform = newTransform;\n\n    setTimeout(() => {\n      mover.remove();\n    }, 350);\n  }\n\n  protected setNewMover() {\n    const newMover = document.createElement('div');\n    newMover.classList.add('media-viewer-mover');\n    newMover.style.display = 'none';\n\n    if(this.content.mover) {\n      const oldMover = this.content.mover;\n      oldMover.parentElement.append(newMover);\n    } else {\n      this.moversContainer.append(newMover);\n    }\n\n    return this.content.mover = newMover;\n  }\n\n  protected updateMediaSource(target: HTMLElement, url: string, tagName: 'video' | 'img') {\n    // if(target instanceof SVGSVGElement) {\n    const el = target.tagName.toLowerCase() === tagName ? target : target.querySelector(tagName) as HTMLElement;\n    if(el && !findUpClassName(target, 'document')) {\n      if(findUpClassName(target, 'attachment')) {\n        // two parentElements because element can be contained in aspecter\n        const preloader = target.parentElement.parentElement.querySelector('.preloader-container') as HTMLElement;\n        if(preloader) {\n          if(tagName === 'video') {\n            if(preloader.classList.contains('manual')) {\n              preloader.click();\n              // return;\n            }\n\n            return;\n          }\n\n          preloader.remove();\n        }\n      }\n\n      renderImageFromUrl(el, url);\n\n      // ! ,       \n      if(el.classList.contains('thumbnail') && el.parentElement.classList.contains('media-container-aspecter')) {\n        el.classList.remove('thumbnail');\n      }\n    }\n    /* } else {\n\n    } */\n  }\n\n  protected setAuthorInfo(fromId: PeerId | string, timestamp: number) {\n    const isPeerId = fromId.isPeerId();\n    let wrapTitlePromise: Promise<HTMLElement> | HTMLElement;\n    if(isPeerId) {\n      wrapTitlePromise = wrapPeerTitle({\n        peerId: fromId as PeerId,\n        dialog: false,\n        onlyFirstName: false,\n        plainText: false\n      })\n    } else {\n      const title = wrapTitlePromise = document.createElement('span');\n      title.append(wrapEmojiText(fromId));\n      title.classList.add('peer-title');\n    }\n\n    const oldAvatar = this.author.avatarEl;\n    const newAvatar = this.author.avatarEl = (oldAvatar.cloneNode() as AvatarElement);\n\n    return Promise.all([\n      (this.author.avatarEl as AvatarElement).updateWithOptions({\n        peerId: fromId as PeerId || NULL_PEER_ID,\n        peerTitle: isPeerId ? undefined : '' + fromId\n      }),\n\n      wrapTitlePromise\n    ]).then(([_, title]) => {\n      if(this.author.avatarEl !== newAvatar) {\n        return;\n      }\n\n      replaceContent(this.author.date, formatFullSentTime(timestamp));\n      replaceContent(this.author.nameEl, title);\n      oldAvatar.replaceWith(this.author.avatarEl);\n    });\n  }\n\n  protected async _openMedia(\n    media: MyDocument | MyPhoto,\n    timestamp: number,\n    fromId: PeerId | string,\n    fromRight: number,\n    target?: HTMLElement,\n    reverse = false,\n    prevTargets: TargetType[] = [],\n    nextTargets: TargetType[] = [],\n    message?: MyMessage\n    /* , needLoadMore = true */\n  ) {\n    if(this.setMoverPromise) return this.setMoverPromise;\n\n    /* if(DEBUG) {\n      this.log('openMedia:', media, fromId, prevTargets, nextTargets);\n    } */\n\n    const setAuthorPromise = this.setAuthorInfo(fromId, timestamp);\n\n    const isDocument = media._ === 'document';\n    const isVideo = isDocument && media.mime_type && ((['video', 'gif'] as MyDocument['type'][]).includes(media.type) || media.mime_type.indexOf('video/') === 0);\n\n    if(this.isFirstOpen) {\n      // this.targetContainer = targetContainer;\n      // this.needLoadMore = needLoadMore;\n      this.isFirstOpen = false;\n      this.listLoader.setTargets(prevTargets, nextTargets, reverse);\n      (window as any).appMediaViewer = this;\n      // this.loadMore = loadMore;\n\n      /* if(appSidebarRight.historyTabIDs.slice(-1)[0] === AppSidebarRight.SLIDERITEMSIDS.forward) {\n        appSidebarRight.forwardTab.closeBtn.click();\n        await new Promise((resolve) => setTimeout(resolve, 200));\n      } */\n    }\n\n    if(this.listLoader.next.length < 10) {\n      setTimeout(() => {\n        this.listLoader.load(true);\n      }, 0);\n    }\n\n    // if(prevTarget && (!prevTarget.parentElement || !this.isElementVisible(this.targetContainer, prevTarget))) prevTarget = null;\n    // if(nextTarget && (!nextTarget.parentElement || !this.isElementVisible(this.targetContainer, nextTarget))) nextTarget = null;\n\n    this.buttons.prev.classList.toggle('hide', !this.listLoader.previous.length);\n    this.buttons.next.classList.toggle('hide', !this.listLoader.next.length);\n\n    const container = this.content.media;\n    const useContainerAsTarget = !target || target === container;\n    if(useContainerAsTarget) target = container;\n\n    this.target = {element: target} as any;\n    const tempId = ++this.tempId;\n\n    if(container.firstElementChild) {\n      container.innerHTML = '';\n    }\n\n    // ok set\n\n    const wasActive = fromRight !== 0;\n    if(wasActive) {\n      this.moveTheMover(this.content.mover, fromRight === 1);\n      this.setNewMover();\n    } else {\n      this.toggleOverlay(true);\n      this.setGlobalListeners();\n      await setAuthorPromise;\n\n      if(!this.wholeDiv.parentElement) {\n        this.pageEl.insertBefore(this.wholeDiv, document.getElementById('main-columns'));\n        void this.wholeDiv.offsetLeft; // reflow\n      }\n\n      this.toggleWholeActive(true);\n\n      if(!IS_MOBILE_SAFARI) {\n        this.navigationItem = {\n          type: 'media',\n          onPop: (canAnimate) => {\n            if(this.setMoverAnimationPromise) {\n              return false;\n            }\n\n            this.close();\n          }\n        };\n\n        appNavigationController.pushItem(this.navigationItem);\n      }\n    }\n\n    // //////this.log('wasActive:', wasActive);\n\n    const mover = this.content.mover;\n\n    const maxWidth = windowSize.width;\n    // const maxWidth = this.pageEl.scrollWidth;\n    // TODO: const maxHeight = mediaSizes.isMobile ? appPhotosManager.windowH : appPhotosManager.windowH - 100;\n    let padding = 0;\n    const windowH = windowSize.height;\n    if(windowH < 1000000 && !mediaSizes.isMobile) {\n      padding = 120;\n    }\n    const maxHeight = windowH - 120 - padding;\n    let thumbPromise: Promise<any> = Promise.resolve();\n    const size = setAttachmentSize(media, container, maxWidth, maxHeight, mediaSizes.isMobile ? false : true, undefined, !!(isDocument && media.w && media.h)).photoSize;\n    if(useContainerAsTarget) {\n      const cacheContext = await this.managers.thumbsStorage.getCacheContext(media, size.type);\n      let img: HTMLImageElement | HTMLCanvasElement;\n      if(cacheContext.downloaded) {\n        img = new Image();\n        img.src = cacheContext.url;\n      } else {\n        const gotThumb = getStrippedThumbIfNeeded(media, cacheContext, true);\n        if(gotThumb) {\n          thumbPromise = gotThumb.loadPromise;\n          img = gotThumb.image;\n        }\n      }\n\n      if(img) {\n        img.classList.add('thumbnail');\n        container.append(img);\n      }\n    }\n\n    // need after setAttachmentSize\n    /* if(useContainerAsTarget) {\n      target = target.querySelector('img, video') || target;\n    } */\n\n    const supportsStreaming: boolean = !!(isDocument && media.supportsStreaming);\n    const preloader = supportsStreaming ? this.preloaderStreamable : this.preloader;\n\n    const getCacheContext = () => {\n      return this.managers.thumbsStorage.getCacheContext(media, size?.type);\n    };\n\n    let setMoverPromise: Promise<void>;\n    if(isVideo) {\n      // //////this.log('will wrap video', media, size);\n\n      //    safari     event'\n      // const video = document.createElement('video');\n      const useController = message && media.type !== 'gif';\n      const video = /* useController ?\n        appMediaPlaybackController.addMedia(message, false, true) as HTMLVideoElement :\n         */createVideo({pip: useController});\n\n      const set = () => this.setMoverToTarget(target, false, fromRight).then(({onAnimationEnd}) => {\n      // return; // set and don't move\n      // if(wasActive) return;\n        // return;\n\n        const div = mover.firstElementChild && mover.firstElementChild.classList.contains('media-viewer-aspecter') ? mover.firstElementChild : mover;\n        // const video = mover.querySelector('video') || document.createElement('video');\n\n        const moverVideo = mover.querySelector('video');\n        if(moverVideo) {\n          moverVideo.remove();\n        }\n\n        // video.src = '';\n\n        video.setAttribute('playsinline', 'true');\n\n        // * fix for playing video if viewer is closed (https://contest.com/javascript-web-bonus/entry1425#issue11629)\n        video.addEventListener('timeupdate', () => {\n          if(this.tempId !== tempId) {\n            video.pause();\n          }\n        });\n\n        this.addEventListener('setMoverAfter', () => {\n          video.src = '';\n          video.load();\n        }, {once: true});\n\n        if(IS_SAFARI) {\n          // test stream\n          // video.controls = true;\n          video.autoplay = true;\n        }\n\n        if(media.type === 'gif') {\n          video.muted = true;\n          video.autoplay = true;\n          video.loop = true;\n        } else if(media.duration < 60) {\n          video.loop = true;\n        }\n\n        // if(!video.parentElement) {\n        div.append(video);\n        // }\n\n        const canPlayThrough = new Promise((resolve) => {\n          video.addEventListener('canplay', resolve, {once: true});\n        });\n\n        const createPlayer = () => {\n          if(media.type !== 'gif') {\n            video.dataset.ckin = 'default';\n            video.dataset.overlay = '1';\n\n            Promise.all([canPlayThrough, onAnimationEnd]).then(() => {\n              if(this.tempId !== tempId) {\n                return;\n              }\n\n              // const play = useController ? appMediaPlaybackController.willBePlayedMedia === video : true;\n              const play = true;\n              const player = this.videoPlayer = new VideoPlayer({\n                video,\n                play,\n                streamable: supportsStreaming,\n                onPlaybackRackMenuToggle: (open) => {\n                  this.wholeDiv.classList.toggle('hide-caption', !!open);\n                },\n                onPip: (pip) => {\n                  const otherMediaViewer = (window as any).appMediaViewer;\n                  if(!pip && otherMediaViewer && otherMediaViewer !== this) {\n                    this.releaseSingleMedia = undefined;\n                    this.close();\n                    return;\n                  }\n\n                  const mover = this.moversContainer.lastElementChild as HTMLElement;\n                  mover.classList.toggle('hiding', pip);\n                  this.toggleWholeActive(!pip);\n                  this.toggleOverlay(!pip);\n                  this.toggleGlobalListeners(!pip);\n\n                  if(this.navigationItem) {\n                    if(pip) appNavigationController.removeItem(this.navigationItem);\n                    else appNavigationController.pushItem(this.navigationItem);\n                  }\n\n                  if(useController) {\n                    if(pip) {\n                      // appMediaPlaybackController.toggleSwitchers(true);\n\n                      this.releaseSingleMedia(false);\n                      this.releaseSingleMedia = undefined;\n\n                      appMediaPlaybackController.setPictureInPicture(video);\n                    } else {\n                      this.releaseSingleMedia = appMediaPlaybackController.setSingleMedia(video, message as Message.message);\n                    }\n                  }\n                },\n                onPipClose: () => {\n                  // this.target = undefined;\n                  // this.toggleWholeActive(false);\n                  // this.toggleOverlay(false);\n                  this.close();\n                }\n              });\n              player.addEventListener('toggleControls', (show) => {\n                this.wholeDiv.classList.toggle('has-video-controls', show);\n              });\n\n              this.addEventListener('setMoverBefore', () => {\n                this.wholeDiv.classList.remove('has-video-controls');\n                this.videoPlayer.cleanup();\n                this.videoPlayer = undefined;\n              }, {once: true});\n\n              if(this.isZooming()) {\n                this.videoPlayer.lockControls(false);\n              }\n              /* div.append(video);\n              mover.append(player.wrapper); */\n            });\n          }\n        };\n\n        if(supportsStreaming) {\n          onAnimationEnd.then(() => {\n            if(video.readyState < video.HAVE_FUTURE_DATA) {\n              // console.log('ppp 1');\n              preloader.attach(mover, true);\n            }\n\n            /* canPlayThrough.then(() => {\n              preloader.detach();\n            }); */\n          });\n\n          const attachCanPlay = () => {\n            video.addEventListener('canplay', () => {\n              // console.log('ppp 2');\n              preloader.detach();\n              video.parentElement.classList.remove('is-buffering');\n            }, {once: true});\n          };\n\n          video.addEventListener('waiting', () => {\n            const loading = video.networkState === video.NETWORK_LOADING;\n            const isntEnoughData = video.readyState < video.HAVE_FUTURE_DATA;\n\n            // this.log('video waiting for progress', loading, isntEnoughData);\n            if(loading && isntEnoughData) {\n              attachCanPlay();\n\n              // console.log('ppp 3');\n              preloader.attach(mover, true);\n\n              //    ,        \n              video.parentElement.classList.add('is-buffering');\n            }\n          });\n\n          if(this.wholeDiv.classList.contains('no-forwards')) {\n            video.addEventListener('contextmenu', (e) => {\n              cancelEvent(e);\n            });\n          }\n\n          attachCanPlay();\n        }\n\n        // if(!video.src || media.url !== video.src) {\n        const load = async() => {\n          /* if(useController) {\n              appMediaPlaybackController.resolveWaitingForLoadMedia(message.peerId, message.mid, message.pFlags.is_scheduled);\n            } */\n\n          const promise: Promise<any> = supportsStreaming ? Promise.resolve() : appDownloadManager.downloadMediaURL({media});\n\n          if(!supportsStreaming) {\n            onAnimationEnd.then(async() => {\n              if(!(await getCacheContext()).url) {\n                // console.log('ppp 4');\n                preloader.attach(mover, true, promise);\n              }\n            });\n          }\n\n          Promise.all([promise, onAnimationEnd]).then(async() => {\n            if(this.tempId !== tempId) {\n              this.log.warn('media viewer changed video');\n              return;\n            }\n\n            const url = (await getCacheContext()).url;\n\n            video.addEventListener('error', () => {\n              if(video.error.code !== 4) {\n                this.log.error('Error ' + video.error.code + '; details: ' + video.error.message);\n              }\n\n              if(preloader) {\n                preloader.detach();\n              }\n            }, {once: true});\n\n            if(target instanceof SVGSVGElement/*  && (video.parentElement || !isSafari) */) { // if video exists\n              // if(!video.parentElement) {\n              div.firstElementChild.lastElementChild.append(video);\n              // }\n            } else {\n              renderImageFromUrl(video, url);\n            }\n\n            // * have to set options (especially playbackRate) after src\n            // * https://github.com/videojs/video.js/issues/2516\n            if(useController) {\n              this.releaseSingleMedia = appMediaPlaybackController.setSingleMedia(video, message as Message.message);\n\n              this.addEventListener('setMoverBefore', () => {\n                if(this.releaseSingleMedia) {\n                  this.releaseSingleMedia();\n                  this.releaseSingleMedia = undefined;\n                }\n              }, {once: true});\n            }\n\n            this.updateMediaSource(target, url, 'video');\n\n            createPlayer();\n          });\n\n          return promise;\n        };\n\n        this.lazyLoadQueue.unshift({load});\n        // } else createPlayer();\n      });\n\n      setMoverPromise = thumbPromise.then(set);\n    } else {\n      const set = () => this.setMoverToTarget(target, false, fromRight).then(({onAnimationEnd}) => {\n      // return; // set and don't move\n      // if(wasActive) return;\n        // return;\n\n        const load = async() => {\n          const cancellablePromise = isDocument ? appDownloadManager.downloadMediaURL({media}) : appDownloadManager.downloadMediaURL({media, thumb: size});\n\n          onAnimationEnd.then(async() => {\n            if(!(await getCacheContext()).url) {\n              this.preloader.attachPromise(cancellablePromise);\n              // this.preloader.attach(mover, true, cancellablePromise);\n            }\n          });\n\n          Promise.all([onAnimationEnd, cancellablePromise]).then(async() => {\n            if(this.tempId !== tempId) {\n              this.log.warn('media viewer changed photo');\n              return;\n            }\n\n            // /////this.log('indochina', blob);\n\n            const url = (await getCacheContext()).url;\n            if(target instanceof SVGSVGElement) {\n              this.updateMediaSource(target, url, 'img');\n              this.updateMediaSource(mover, url, 'img');\n\n              if(mediaSizes.isMobile) {\n                const imgs = mover.querySelectorAll('img');\n                if(imgs && imgs.length) {\n                  imgs.forEach((img) => {\n                    img.classList.remove('thumbnail'); //      \n                  });\n                }\n              }\n            } else {\n              const div = mover.firstElementChild && mover.firstElementChild.classList.contains('media-viewer-aspecter') ? mover.firstElementChild : mover;\n              const haveImage = div.firstElementChild?.tagName === 'IMG' ? div.firstElementChild as HTMLImageElement : null;\n              if(!haveImage || haveImage.src !== url)  {\n                const image = new Image();\n                image.classList.add('thumbnail');\n\n                // this.log('will renderImageFromUrl:', image, div, target);\n\n                renderImageFromUrl(image, url, () => {\n                  this.updateMediaSource(target, url, 'img');\n\n                  if(haveImage) {\n                    fastRaf(() => {\n                      haveImage.remove();\n                    });\n                  }\n\n                  div.append(image);\n                });\n              }\n            }\n\n            // this.preloader.detach();\n          }).catch((err) => {\n            this.log.error(err);\n            this.preloader.attach(mover);\n            this.preloader.setManual();\n          });\n\n          return cancellablePromise;\n        };\n\n        this.lazyLoadQueue.unshift({load});\n      });\n\n      setMoverPromise = thumbPromise.then(set);\n    }\n\n    return this.setMoverPromise = setMoverPromise.catch(() => {\n      this.setMoverAnimationPromise = null;\n    }).finally(() => {\n      this.setMoverPromise = null;\n    });\n  }\n}\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nexport default function fillPropertyValue(str: string) {\r\n  const splitted = str.split(' ');\r\n  if(splitted.length !== 4) {\r\n    if(!splitted[0]) splitted[0] = '0px';\r\n    for(let i = splitted.length; i < 4; ++i) {\r\n      splitted[i] = splitted[i % 2] || splitted[0] || '0px';\r\n    }\r\n  }\r\n\r\n  return splitted;\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport {MOUNT_CLASS_TO} from '../config/debug';\r\nimport {IS_MOBILE_SAFARI} from '../environment/userAgent';\r\nimport {logger} from '../lib/logger';\r\nimport blurActiveElement from '../helpers/dom/blurActiveElement';\r\nimport cancelEvent from '../helpers/dom/cancelEvent';\r\nimport isSwipingBackSafari from '../helpers/dom/isSwipingBackSafari';\r\nimport indexOfAndSplice from '../helpers/array/indexOfAndSplice';\r\n\r\nexport type NavigationItem = {\r\n  type: 'left' | 'right' | 'im' | 'chat' | 'popup' | 'media' | 'menu' |\r\n    'esg' | 'multiselect' | 'input-helper' | 'autocomplete-helper' | 'markup' |\r\n    'global-search' | 'voice' | 'mobile-search' | 'filters' | 'global-search-focus' |\r\n    'toast',\r\n  onPop: (canAnimate: boolean) => boolean | void,\r\n  onEscape?: () => boolean,\r\n  noHistory?: boolean,\r\n  noBlurOnPop?: boolean,\r\n};\r\n\r\nexport class AppNavigationController {\r\n  private navigations: Array<NavigationItem>;\r\n  private id: number;\r\n  private manual: boolean;\r\n  private log: ReturnType<typeof logger>;\r\n  private debug: boolean;\r\n  private currentHash: string; // have to start with # if not empty\r\n  private overriddenHash: string; // have to start with # if not empty\r\n  private isPossibleSwipe: boolean;\r\n  public onHashChange: () => void;\r\n\r\n  constructor() {\r\n    this.navigations = [];\r\n    this.id = Date.now();\r\n    this.manual = false;\r\n    this.log = logger('NC');\r\n    this.debug = true;\r\n    this.currentHash = window.location.hash;\r\n    this.overriddenHash = '';\r\n    this.isPossibleSwipe = false;\r\n\r\n    window.addEventListener('popstate', this.onPopState);\r\n    window.addEventListener('keydown', this.onKeyDown, {capture: true, passive: false});\r\n\r\n    if(IS_MOBILE_SAFARI) {\r\n      const options = {passive: true};\r\n      window.addEventListener('touchstart', this.onTouchStart, options);\r\n    }\r\n\r\n    history.scrollRestoration = 'manual';\r\n\r\n    this.pushState(); // * push init state\r\n  }\r\n\r\n  private onPopState = (e: PopStateEvent) => {\r\n    const hash = window.location.hash;\r\n    const id: number = e.state;\r\n    this.debug && this.log('popstate', e, this.isPossibleSwipe, hash);\r\n    if(hash !== this.currentHash) {\r\n      this.debug && this.log.warn(`hash changed, new=${hash}, current=${this.currentHash}, overridden=${this.overriddenHash}`);\r\n      // fix for returning to wrong hash (e.g. chat -> archive -> chat -> 3x back)\r\n      if(id === this.id && this.overriddenHash && this.overriddenHash !== hash) {\r\n        this.overrideHash(this.overriddenHash);\r\n      } else if(id/*  === this.id */ && !this.overriddenHash && hash) {\r\n        this.overrideHash();\r\n      } else {\r\n        this.currentHash = hash;\r\n        this.onHashChange && this.onHashChange();\r\n        // this.replaceState();\r\n        return;\r\n      }\r\n    }\r\n\r\n    if(id !== this.id/*  && !this.navigations.length */) {\r\n      this.pushState();\r\n\r\n      if(!this.navigations.length) {\r\n        return;\r\n      }\r\n    }\r\n\r\n    const item = this.navigations.pop();\r\n    if(!item) {\r\n      this.pushState();\r\n      return;\r\n    }\r\n\r\n    this.manual = !this.isPossibleSwipe;\r\n    this.handleItem(item);\r\n    // this.pushState(); // * prevent adding forward arrow\r\n  };\r\n\r\n  private onKeyDown = (e: KeyboardEvent) => {\r\n    const item = this.navigations[this.navigations.length - 1];\r\n    if(!item) return;\r\n    if(e.key === 'Escape' && (item.onEscape ? item.onEscape() : true)) {\r\n      cancelEvent(e);\r\n      this.back(item.type);\r\n    }\r\n  };\r\n\r\n  private onTouchStart = (e: TouchEvent) => {\r\n    if(e.touches.length > 1) return;\r\n    this.debug && this.log('touchstart');\r\n\r\n    if(isSwipingBackSafari(e)) {\r\n      this.isPossibleSwipe = true;\r\n\r\n      window.addEventListener('touchend', () => {\r\n        setTimeout(() => {\r\n          this.isPossibleSwipe = false;\r\n        }, 100);\r\n      }, {passive: true, once: true});\r\n    }\r\n\r\n    /* const detach = () => {\r\n      window.removeEventListener('touchend', onTouchEnd);\r\n      window.removeEventListener('touchmove', onTouchMove);\r\n    };\r\n\r\n    let moved = false;\r\n    const onTouchMove = (e: TouchEvent) => {\r\n      this.debug && this.log('touchmove');\r\n      if(e.touches.length > 1) {\r\n        detach();\r\n        return;\r\n      }\r\n\r\n      moved = true;\r\n    };\r\n\r\n    const onTouchEnd = (e: TouchEvent) => {\r\n      this.debug && this.log('touchend');\r\n      if(e.touches.length > 1 || !moved) {\r\n        detach();\r\n        return;\r\n      }\r\n\r\n      isPossibleSwipe = true;\r\n      doubleRaf().then(() => {\r\n        isPossibleSwipe = false;\r\n      });\r\n\r\n      detach();\r\n    };\r\n\r\n    window.addEventListener('touchend', onTouchEnd, options);\r\n    window.addEventListener('touchmove', onTouchMove, options); */\r\n  };\r\n\r\n  public overrideHash(hash: string = '') {\r\n    if(hash && hash[0] !== '#') hash = '#' + hash;\r\n    else if(hash === '#') hash = '';\r\n\r\n    this.overriddenHash = this.currentHash = hash;\r\n    this.replaceState();\r\n    this.pushState();\r\n  }\r\n\r\n  private handleItem(item: NavigationItem) {\r\n    const good = item.onPop(!this.manual ? false : undefined);\r\n    this.debug && this.log('popstate, navigation:', item, this.navigations);\r\n    if(good === false) {\r\n      this.pushItem(item);\r\n    } else if(!item.noBlurOnPop) {\r\n      blurActiveElement(); // no better place for it\r\n    }\r\n\r\n    this.manual = false;\r\n  }\r\n\r\n  public findItemByType(type: NavigationItem['type']) {\r\n    for(let i = this.navigations.length - 1; i >= 0; --i) {\r\n      const item = this.navigations[i];\r\n      if(item.type === type) {\r\n        return {item, index: i};\r\n      }\r\n    }\r\n  }\r\n\r\n  public back(type?: NavigationItem['type']) {\r\n    if(type) {\r\n      const ret = this.findItemByType(type);\r\n      if(ret) {\r\n        this.backByItem(ret.item, ret.index);\r\n        return;\r\n      }\r\n    }\r\n\r\n    history.back();\r\n  }\r\n\r\n  public backByItem(item: NavigationItem, index = this.navigations.indexOf(item)) {\r\n    this.manual = true;\r\n    // ! commented because 'popstate' event will be fired with delay\r\n    // if(index !== (this.navigations.length - 1)) {\r\n    this.navigations.splice(index, 1);\r\n    this.handleItem(item);\r\n    // }\r\n  }\r\n\r\n  private onItemAdded(item: NavigationItem) {\r\n    this.debug && this.log('onItemAdded', item, this.navigations);\r\n\r\n    if(!item.noHistory) {\r\n      this.pushState();\r\n    }\r\n  }\r\n\r\n  public pushItem(item: NavigationItem) {\r\n    this.navigations.push(item);\r\n    this.onItemAdded(item);\r\n  }\r\n\r\n  public unshiftItem(item: NavigationItem) {\r\n    this.navigations.unshift(item);\r\n    this.onItemAdded(item);\r\n  }\r\n\r\n  public spliceItems(index: number, length: number, ...items: NavigationItem[]) {\r\n    this.navigations.splice(index, length, ...items);\r\n    items.forEach((item) => {\r\n      this.onItemAdded(item);\r\n    });\r\n  }\r\n\r\n  private pushState() {\r\n    this.debug && this.log('push');\r\n    this.manual = false;\r\n    history.pushState(this.id, '');\r\n  }\r\n\r\n  public replaceState() {\r\n    this.debug && this.log.warn('replace');\r\n\r\n    const url = location.origin + location.pathname + location.search + this.overriddenHash;\r\n    history.replaceState(this.id, '', url);\r\n  }\r\n\r\n  public removeItem(item: NavigationItem) {\r\n    if(!item) {\r\n      return;\r\n    }\r\n\r\n    indexOfAndSplice(this.navigations, item);\r\n  }\r\n\r\n  public removeByType(type: NavigationItem['type'], single = false) {\r\n    for(let i = this.navigations.length - 1; i >= 0; --i) {\r\n      const item = this.navigations[i];\r\n      if(item.type === type) {\r\n        this.navigations.splice(i, 1);\r\n\r\n        if(single) {\r\n          break;\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\nconst appNavigationController = new AppNavigationController();\r\nMOUNT_CLASS_TO.appNavigationController = appNavigationController;\r\nexport default appNavigationController;\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport appDialogsManager from '../lib/appManagers/appDialogsManager';\r\nimport Scrollable from './scrollable';\r\nimport InputSearch from './inputSearch';\r\nimport replaceContent from '../helpers/dom/replaceContent';\r\nimport {i18n, LangPackKey} from '../lib/langPack';\r\nimport rootScope from '../lib/rootScope';\r\n\r\nexport class SearchGroup {\r\n  container: HTMLDivElement;\r\n  nameEl: HTMLDivElement;\r\n  list: HTMLUListElement;\r\n\r\n  constructor(\r\n    public name: LangPackKey | boolean,\r\n    public type: string,\r\n    private clearable = true,\r\n    className?: string,\r\n    clickable = true,\r\n    public autonomous = true,\r\n    public onFound?: () => void,\r\n    public noIcons?: boolean\r\n  ) {\r\n    this.list = appDialogsManager.createChatList();\r\n    this.container = document.createElement('div');\r\n    if(className) this.container.className = className;\r\n\r\n    if(name) {\r\n      this.nameEl = document.createElement('div');\r\n      this.nameEl.classList.add('search-group__name');\r\n      if(typeof(name) === 'string') {\r\n        this.nameEl.append(i18n(name));\r\n      }\r\n      this.container.append(this.nameEl);\r\n    }\r\n\r\n    this.container.classList.add('search-group', 'search-group-' + type);\r\n    this.container.append(this.list);\r\n    this.container.style.display = 'none';\r\n\r\n    if(clickable) {\r\n      appDialogsManager.setListClickListener(this.list, onFound, undefined, autonomous);\r\n    }\r\n  }\r\n\r\n  clear() {\r\n    this.container.style.display = 'none';\r\n\r\n    if(this.clearable) {\r\n      this.list.innerHTML = '';\r\n    }\r\n  }\r\n\r\n  setActive() {\r\n    this.container.style.display = '';\r\n  }\r\n\r\n  toggle() {\r\n    if(this.list.childElementCount) {\r\n      this.setActive();\r\n    } else {\r\n      this.clear();\r\n    }\r\n  }\r\n}\r\n\r\nexport type SearchGroupType = 'contacts' | 'globalContacts' | 'messages' | string;\r\n\r\nexport default class AppSearch {\r\n  private minMsgId = 0;\r\n  private loadedCount = -1;\r\n  private foundCount = -1;\r\n\r\n  private searchPromise: Promise<void> = null;\r\n  private searchTimeout: number = 0;\r\n\r\n  private query = '';\r\n\r\n  private listsContainer: HTMLDivElement = null;\r\n\r\n  private peerId: PeerId; // 0 - means global\r\n  private threadId = 0;\r\n\r\n  private scrollable: Scrollable;\r\n\r\n  constructor(\r\n    public container: HTMLElement,\r\n    public searchInput: InputSearch,\r\n    public searchGroups: {[group in SearchGroupType]: SearchGroup},\r\n    public onSearch?: (count: number) => void,\r\n    public noIcons?: boolean\r\n  ) {\r\n    this.scrollable = new Scrollable(this.container);\r\n    this.listsContainer = this.scrollable.container as HTMLDivElement;\r\n    for(const i in this.searchGroups) {\r\n      this.listsContainer.append(this.searchGroups[i as SearchGroupType].container);\r\n    }\r\n\r\n    if(this.searchGroups.messages) {\r\n      this.scrollable.setVirtualContainer(this.searchGroups.messages.list);\r\n    }\r\n\r\n    this.searchInput.onChange = (value) => {\r\n      /* if(!value.trim()) {\r\n        //this.peerId = 0;\r\n        return;\r\n      } */\r\n\r\n      this.query = value;\r\n      this.reset(false);\r\n      this.searchMore();\r\n    };\r\n\r\n    this.scrollable.onScrolledBottom = () => {\r\n      if(!this.query.trim()) return;\r\n\r\n      if(!this.searchTimeout) {\r\n        this.searchTimeout = window.setTimeout(() => {\r\n          this.searchMore();\r\n          this.searchTimeout = 0;\r\n        }, 0);\r\n      }\r\n    };\r\n  }\r\n\r\n  public reset(all = true) {\r\n    if(all) {\r\n      this.searchInput.value = '';\r\n      this.query = '';\r\n      this.peerId = undefined;\r\n      this.threadId = 0;\r\n    }\r\n\r\n    this.minMsgId = 0;\r\n    this.loadedCount = -1;\r\n    this.foundCount = -1;\r\n\r\n    for(const i in this.searchGroups) {\r\n      this.searchGroups[i as SearchGroupType].clear();\r\n    }\r\n\r\n    this.searchPromise = null;\r\n  }\r\n\r\n  public beginSearch(peerId?: PeerId, threadId = 0, query = '') {\r\n    this.peerId = peerId;\r\n    this.threadId = threadId;\r\n\r\n    if(this.query !== query) {\r\n      this.searchInput.inputField.value = query;\r\n    }\r\n\r\n    this.searchInput.input.focus();\r\n  }\r\n\r\n  public searchMore() {\r\n    if(this.searchPromise) return this.searchPromise;\r\n\r\n    const query = this.query;\r\n\r\n    if(!query.trim()) {\r\n      this.onSearch && this.onSearch(0);\r\n      return;\r\n    }\r\n\r\n    if(this.foundCount !== -1 && this.loadedCount >= this.foundCount) {\r\n      return Promise.resolve();\r\n    }\r\n\r\n    const maxId = this.minMsgId || 0;\r\n\r\n    return this.searchPromise = rootScope.managers.appMessagesManager.getSearch({\r\n      peerId: this.peerId,\r\n      query,\r\n      inputFilter: {_: 'inputMessagesFilterEmpty'},\r\n      maxId,\r\n      limit: 20,\r\n      threadId: this.threadId\r\n    }).then((res) => {\r\n      this.searchPromise = null;\r\n\r\n      if(this.searchInput.value !== query) {\r\n        return;\r\n      }\r\n\r\n      // console.log('input search result:', this.peerId, query, null, maxId, 20, res);\r\n\r\n      const {count, history} = res;\r\n\r\n      if(history.length && history[0].mid === this.minMsgId) {\r\n        history.shift();\r\n      }\r\n\r\n      const searchGroup = this.searchGroups.messages;\r\n\r\n      history.forEach((message) => {\r\n        try {\r\n          const peerId = this.peerId ? message.fromId : message.peerId;\r\n          appDialogsManager.addDialogAndSetLastMessage({\r\n            peerId,\r\n            container: this.scrollable/* searchGroup.list */,\r\n            avatarSize: 54,\r\n            meAsSaved: false,\r\n            message,\r\n            query,\r\n            noIcons: this.noIcons\r\n          });\r\n        } catch(err) {\r\n          console.error('[appSearch] render search result', err);\r\n        }\r\n      });\r\n\r\n      searchGroup.toggle();\r\n\r\n      this.minMsgId = history.length && history[history.length - 1].mid;\r\n\r\n      if(this.loadedCount === -1) {\r\n        this.loadedCount = 0;\r\n      }\r\n      this.loadedCount += history.length;\r\n\r\n      if(this.foundCount === -1) {\r\n        this.foundCount = count;\r\n\r\n        if(searchGroup.nameEl) {\r\n          replaceContent(searchGroup.nameEl, i18n(count ? 'Chat.Search.MessagesFound' : 'Chat.Search.NoMessagesFound', [count]));\r\n        }\r\n\r\n        this.onSearch && this.onSearch(this.foundCount);\r\n      }\r\n    }).catch((err) => {\r\n      console.error('search error', err);\r\n      this.searchPromise = null;\r\n    });\r\n  }\r\n}\r\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport appDialogsManager, {DIALOG_LIST_ELEMENT_TAG} from '../lib/appManagers/appDialogsManager';\nimport type {MyInputMessagesFilter, MyMessage} from '../lib/appManagers/appMessagesManager';\nimport {logger} from '../lib/logger';\nimport rootScope from '../lib/rootScope';\nimport {SearchGroup, SearchGroupType} from './appSearch';\nimport {horizontalMenu} from './horizontalMenu';\nimport LazyLoadQueue from './lazyLoadQueue';\nimport {putPreloader} from './putPreloader';\nimport ripple from './ripple';\nimport Scrollable, {ScrollableX} from './scrollable';\nimport {wrapDocument, wrapPhoto, wrapVideo} from './wrappers';\nimport useHeavyAnimationCheck, {getHeavyAnimationPromise} from '../hooks/useHeavyAnimationCheck';\nimport I18n, {LangPackKey, i18n} from '../lib/langPack';\nimport findUpClassName from '../helpers/dom/findUpClassName';\nimport {getMiddleware} from '../helpers/middleware';\nimport {ChannelParticipant, ChatFull, ChatParticipant, ChatParticipants, Document, Message, MessageMedia, Photo, WebPage} from '../layer';\nimport SortedUserList from './sortedUserList';\nimport findUpTag from '../helpers/dom/findUpTag';\nimport appSidebarRight from './sidebarRight';\nimport mediaSizes from '../helpers/mediaSizes';\nimport appImManager from '../lib/appManagers/appImManager';\nimport positionElementByIndex from '../helpers/dom/positionElementByIndex';\nimport cleanSearchText from '../helpers/cleanSearchText';\nimport IS_TOUCH_SUPPORTED from '../environment/touchSupport';\nimport handleTabSwipe from '../helpers/dom/handleTabSwipe';\nimport windowSize from '../helpers/windowSize';\nimport {formatPhoneNumber} from '../helpers/formatPhoneNumber';\nimport ButtonMenu, {ButtonMenuItemOptions} from './buttonMenu';\nimport PopupForward from './popups/forward';\nimport PopupDeleteMessages from './popups/deleteMessages';\nimport Row from './row';\nimport htmlToDocumentFragment from '../helpers/dom/htmlToDocumentFragment';\nimport {SearchSelection} from './chat/selection';\nimport cancelEvent from '../helpers/dom/cancelEvent';\nimport {attachClickEvent, simulateClickEvent} from '../helpers/dom/clickEvent';\nimport {MyDocument} from '../lib/appManagers/appDocsManager';\nimport AppMediaViewer from './appMediaViewer';\nimport lockTouchScroll from '../helpers/dom/lockTouchScroll';\nimport copy from '../helpers/object/copy';\nimport getObjectKeysAndSort from '../helpers/object/getObjectKeysAndSort';\nimport safeAssign from '../helpers/object/safeAssign';\nimport escapeRegExp from '../helpers/string/escapeRegExp';\nimport findAndSplice from '../helpers/array/findAndSplice';\nimport {ScrollStartCallbackDimensions} from '../helpers/fastSmoothScroll';\nimport setInnerHTML from '../helpers/dom/setInnerHTML';\nimport {AppManagers} from '../lib/appManagers/managers';\nimport choosePhotoSize from '../lib/appManagers/utils/photos/choosePhotoSize';\nimport wrapWebPageDescription from './wrappers/webPageDescription';\nimport wrapWebPageTitle from './wrappers/webPageTitle';\nimport getAbbreviation from '../lib/richTextProcessor/getAbbreviation';\nimport matchUrl from '../lib/richTextProcessor/matchUrl';\nimport wrapPlainText from '../lib/richTextProcessor/wrapPlainText';\nimport wrapRichText from '../lib/richTextProcessor/wrapRichText';\nimport wrapSenderToPeer from './wrappers/senderToPeer';\nimport wrapSentTime from './wrappers/sentTime';\nimport getMediaFromMessage from '../lib/appManagers/utils/messages/getMediaFromMessage';\nimport filterMessagesByInputFilter from '../lib/appManagers/utils/messages/filterMessagesByInputFilter';\nimport getChatMembersString from './wrappers/getChatMembersString';\nimport getUserStatusString from './wrappers/getUserStatusString';\nimport getParticipantPeerId from '../lib/appManagers/utils/chats/getParticipantPeerId';\nimport {Awaited} from '../types';\nimport {attachContextMenuListener} from '../helpers/dom/attachContextMenuListener';\nimport contextMenuController from '../helpers/contextMenuController';\nimport positionMenu from '../helpers/positionMenu';\nimport apiManagerProxy from '../lib/mtproto/mtprotoworker';\nimport ListenerSetter from '../helpers/listenerSetter';\nimport SwipeHandler from './swipeHandler';\n\n// const testScroll = false;\n\nexport type SearchSuperType = MyInputMessagesFilter/*  | 'members' */;\nexport type SearchSuperContext = {\n  peerId: PeerId,\n  inputFilter: {_: MyInputMessagesFilter},\n  query?: string,\n  maxId?: number,\n  folderId?: number,\n  threadId?: number,\n  date?: number,\n  nextRate?: number,\n  minDate?: number,\n  maxDate?: number\n};\n\nexport type SearchSuperMediaType = 'members' | 'media' | 'files' | 'links' | 'music' | 'chats' | 'voice';\nexport type SearchSuperMediaTab = {\n  inputFilter: SearchSuperType,\n  name: LangPackKey,\n  type: SearchSuperMediaType,\n  contentTab?: HTMLElement,\n  menuTab?: HTMLElement,\n  scroll?: {scrollTop: number, scrollHeight: number}\n};\n\nclass SearchContextMenu {\n  private buttons: (ButtonMenuItemOptions & {verify?: () => boolean | Promise<boolean>, withSelection?: true})[];\n  private element: HTMLElement;\n  private target: HTMLElement;\n  private peerId: PeerId;\n  private mid: number;\n  private isSelected: boolean;\n  private managers: AppManagers;\n\n  constructor(\n    private attachTo: HTMLElement,\n    private searchSuper: AppSearchSuper,\n    private listenerSetter: ListenerSetter\n  ) {\n    this.managers = searchSuper.managers;\n\n    const onContextMenu = (e: MouseEvent) => {\n      if(this.init) {\n        this.init();\n        this.init = null;\n      }\n\n      let item: HTMLElement;\n      try {\n        item = findUpClassName(e.target, 'search-super-item');\n      } catch(e) {}\n\n      if(!item) return;\n\n      if(e instanceof MouseEvent) e.preventDefault();\n      if(this.element.classList.contains('active')) {\n        return false;\n      }\n      if(e instanceof MouseEvent) e.cancelBubble = true;\n\n      const r = async() => {\n        this.target = item;\n        this.peerId = item.dataset.peerId.toPeerId();\n        this.mid = +item.dataset.mid;\n        this.isSelected = searchSuper.selection.isMidSelected(this.peerId, this.mid);\n\n        await Promise.all(this.buttons.map(async(button) => {\n          let good: boolean;\n\n          if(this.isSelected && !button.withSelection) {\n            good = false;\n          } else {\n            good = button.verify ? await button.verify() : true;\n          }\n\n          button.element.classList.toggle('hide', !good);\n        }));\n\n        item.classList.add('menu-open');\n\n        positionMenu(e, this.element);\n        contextMenuController.openBtnMenu(this.element, () => {\n          item.classList.remove('menu-open');\n        });\n      };\n\n      r();\n    };\n\n    if(IS_TOUCH_SUPPORTED) {\n\n    } else {\n      attachContextMenuListener(attachTo, onContextMenu as any, listenerSetter);\n    }\n  }\n\n  private init() {\n    this.buttons = [{\n      icon: 'forward',\n      text: 'Forward',\n      onClick: this.onForwardClick,\n      verify: async() => this.managers.appMessagesManager.canForward(await this.managers.appMessagesManager.getMessageByPeer(this.peerId, this.mid))\n    }, {\n      icon: 'forward',\n      text: 'Message.Context.Selection.Forward',\n      onClick: this.onForwardClick,\n      verify: () => this.isSelected &&\n        !this.searchSuper.selection.selectionForwardBtn.classList.contains('hide'),\n      withSelection: true\n    }, {\n      icon: 'message',\n      text: 'Message.Context.Goto',\n      onClick: this.onGotoClick,\n      withSelection: true\n    }, {\n      icon: 'select',\n      text: 'Message.Context.Select',\n      onClick: this.onSelectClick\n    }, {\n      icon: 'select',\n      text: 'Message.Context.Selection.Clear',\n      onClick: this.onClearSelectionClick,\n      verify: () => this.isSelected,\n      withSelection: true\n    }, {\n      icon: 'delete danger',\n      text: 'Delete',\n      onClick: this.onDeleteClick,\n      verify: async() => this.managers.appMessagesManager.canDeleteMessage(await this.managers.appMessagesManager.getMessageByPeer(this.peerId, this.mid))\n    }, {\n      icon: 'delete danger',\n      text: 'Message.Context.Selection.Delete',\n      onClick: this.onDeleteClick,\n      verify: () => this.isSelected && !this.searchSuper.selection.selectionDeleteBtn.classList.contains('hide'),\n      withSelection: true\n    }];\n\n    this.element = ButtonMenu(this.buttons);\n    this.element.classList.add('search-contextmenu', 'contextmenu');\n    document.getElementById('page-chats').append(this.element);\n  }\n\n  private onGotoClick = () => {\n    appImManager.setInnerPeer({\n      peerId: this.peerId,\n      lastMsgId: this.mid,\n      threadId: this.searchSuper.searchContext.threadId\n    });\n  };\n\n  private onForwardClick = () => {\n    if(this.searchSuper.selection.isSelecting) {\n      simulateClickEvent(this.searchSuper.selection.selectionForwardBtn);\n    } else {\n      new PopupForward({\n        [this.peerId]: [this.mid]\n      });\n    }\n  };\n\n  private onSelectClick = () => {\n    this.searchSuper.selection.toggleByElement(this.target);\n  };\n\n  private onClearSelectionClick = () => {\n    this.searchSuper.selection.cancelSelection();\n  };\n\n  private onDeleteClick = () => {\n    if(this.searchSuper.selection.isSelecting) {\n      simulateClickEvent(this.searchSuper.selection.selectionDeleteBtn);\n    } else {\n      new PopupDeleteMessages(this.peerId, [this.mid], 'chat');\n    }\n  };\n}\n\nexport type ProcessSearchSuperResult = {\n  message: Message.message,\n  middleware: () => boolean,\n  promises: Promise<any>[],\n  elemsToAppend: {element: HTMLElement, message: any}[],\n  inputFilter: MyInputMessagesFilter,\n  searchGroup?: SearchGroup\n};\n\nexport default class AppSearchSuper {\n  public tabs: {[t in SearchSuperType]: HTMLDivElement} = {} as any;\n\n  public mediaTab: SearchSuperMediaTab;\n\n  public container: HTMLElement;\n  public nav: HTMLElement;\n  public navScrollableContainer: HTMLDivElement;\n  public tabsContainer: HTMLElement;\n  public navScrollable: ScrollableX;\n  private tabsMenu: HTMLElement;\n  private prevTabId = -1;\n\n  private lazyLoadQueue = new LazyLoadQueue();\n  public middleware = getMiddleware();\n\n  public historyStorage: Partial<{[type in SearchSuperType]: {mid: number, peerId: PeerId}[]}> = {};\n  public usedFromHistory: Partial<{[type in SearchSuperType]: number}> = {};\n  public urlsToRevoke: string[] = [];\n\n  public searchContext: SearchSuperContext;\n  public loadMutex: Promise<any> = Promise.resolve();\n\n  private nextRates: Partial<{[type in SearchSuperType]: number}> = {};\n  private loadPromises: Partial<{[type in SearchSuperType]: Promise<void>}> = {};\n  private loaded: Partial<{[type in SearchSuperType]: boolean}> = {};\n  private loadedChats = false;\n  private firstLoad = true;\n\n  private log = logger('SEARCH-SUPER');\n  public selectTab: ReturnType<typeof horizontalMenu>;\n\n  private monthContainers: Partial<{\n    [type in SearchSuperType]: {\n      [timestamp: number]: {\n        container: HTMLElement,\n        items: HTMLElement\n      }\n    }\n  }> = {};\n\n  private searchGroupMedia: SearchGroup;\n\n  public mediaTabsMap: Map<SearchSuperMediaType, SearchSuperMediaTab> = new Map();\n\n  private membersList: SortedUserList;\n\n  private skipScroll: boolean;\n\n  // * arguments\n  public mediaTabs: SearchSuperMediaTab[];\n  public scrollable: Scrollable;\n  public searchGroups?: {[group in SearchGroupType]: SearchGroup};\n  public asChatList? = false;\n  public groupByMonth? = true;\n  public hideEmptyTabs? = true;\n  public onChangeTab?: (mediaTab: SearchSuperMediaTab) => void;\n  public showSender? = false;\n\n  private searchContextMenu: SearchContextMenu;\n  public selection: SearchSelection;\n\n  public scrollStartCallback: (dimensions: ScrollStartCallbackDimensions) => void;\n\n  public managers: AppManagers;\n  private loadFirstTimePromise: Promise<void>;\n\n  private listenerSetter: ListenerSetter;\n  private swipeHandler: SwipeHandler;\n\n  constructor(options: Pick<AppSearchSuper, 'mediaTabs' | 'scrollable' | 'searchGroups' | 'asChatList' | 'groupByMonth' | 'hideEmptyTabs' | 'onChangeTab' | 'showSender' | 'managers'>) {\n    safeAssign(this, options);\n\n    this.container = document.createElement('div');\n    this.container.classList.add('search-super');\n\n    this.listenerSetter = new ListenerSetter();\n    this.searchContextMenu = new SearchContextMenu(this.container, this, this.listenerSetter);\n    this.selection = new SearchSelection(this, this.managers, this.listenerSetter);\n\n    const navScrollableContainer = this.navScrollableContainer = document.createElement('div');\n    navScrollableContainer.classList.add('search-super-tabs-scrollable', 'menu-horizontal-scrollable', 'sticky');\n\n    const navScrollable = this.navScrollable = new ScrollableX(navScrollableContainer);\n    navScrollable.container.classList.add('search-super-nav-scrollable');\n\n    const nav = this.nav = document.createElement('nav');\n    nav.classList.add('search-super-tabs', 'menu-horizontal-div');\n    this.tabsMenu = nav;\n\n    navScrollable.container.append(nav);\n\n    for(const mediaTab of this.mediaTabs) {\n      const menuTab = document.createElement('div');\n      menuTab.classList.add('menu-horizontal-div-item');\n      const span = document.createElement('span');\n      const i = document.createElement('i');\n\n      span.append(i18n(mediaTab.name));\n      span.append(i);\n\n      menuTab.append(span);\n\n      ripple(menuTab);\n\n      this.tabsMenu.append(menuTab);\n\n      this.mediaTabsMap.set(mediaTab.type, mediaTab);\n\n      mediaTab.menuTab = menuTab;\n    }\n\n    this.tabsContainer = document.createElement('div');\n    this.tabsContainer.classList.add('search-super-tabs-container', 'tabs-container');\n\n    let unlockScroll: ReturnType<typeof lockTouchScroll>;\n    if(IS_TOUCH_SUPPORTED) {\n      this.swipeHandler = handleTabSwipe({\n        element: this.tabsContainer,\n        onSwipe: (xDiff, yDiff, e) => {\n          const prevId = this.selectTab.prevId();\n          const children = Array.from(this.tabsMenu.children) as HTMLElement[];\n          let idx: number;\n          if(xDiff > 0) {\n            for(let i = prevId + 1; i < children.length; ++i) {\n              if(!children[i].classList.contains('hide')) {\n                idx = i;\n                break;\n              }\n            }\n          } else {\n            for(let i = prevId - 1; i >= 0; --i) {\n              if(!children[i].classList.contains('hide')) {\n                idx = i;\n                break;\n              }\n            }\n          }\n\n          if(idx !== undefined) {\n            unlockScroll = lockTouchScroll(this.tabsContainer);\n            this.selectTab(idx);\n          }\n        }\n      });\n    }\n\n    for(const mediaTab of this.mediaTabs) {\n      const container = document.createElement('div');\n      container.classList.add('search-super-container-' + mediaTab.type, 'tabs-tab');\n\n      const content = document.createElement('div');\n      content.classList.add('search-super-content-' + mediaTab.type);\n\n      container.append(content);\n\n      this.tabsContainer.append(container);\n\n      this.tabs[mediaTab.inputFilter] = content;\n\n      mediaTab.contentTab = content;\n    }\n\n    this.container.append(navScrollableContainer, this.tabsContainer);\n\n    // * construct end\n\n    this.searchGroupMedia = new SearchGroup(false, 'messages', true);\n\n    this.scrollable.onScrolledBottom = () => {\n      if(this.mediaTab.contentTab && this.canLoadMediaTab(this.mediaTab)/* && false */) {\n        // this.log('onScrolledBottom will load media');\n        this.load(true);\n      }\n    };\n    // this.scroll.attachSentinels(undefined, 400);\n\n    this.selectTab = horizontalMenu(this.tabsMenu, this.tabsContainer, (id, tabContent, animate) => {\n      if(this.prevTabId === id && !this.skipScroll) {\n        this.scrollable.scrollIntoViewNew({\n          element: this.container,\n          position: 'start',\n          startCallback: this.scrollStartCallback\n        });\n        return;\n      }\n\n      const newMediaTab = this.mediaTabs[id];\n      if(this.onChangeTab) {\n        this.onChangeTab(newMediaTab);\n      }\n\n      const fromMediaTab = this.mediaTab;\n      this.mediaTab = newMediaTab;\n\n      if(this.prevTabId !== -1 && animate) {\n        this.onTransitionStart();\n      }\n\n      if(this.skipScroll) {\n        this.skipScroll = false;\n      } else {\n        const offsetTop = this.container.offsetTop;\n        let scrollTop = this.scrollable.scrollTop;\n        if(scrollTop < offsetTop) {\n          this.scrollable.scrollIntoViewNew({\n            element: this.container,\n            position: 'start',\n            startCallback: this.scrollStartCallback\n          });\n          scrollTop = offsetTop;\n        }\n\n        fromMediaTab.scroll = {scrollTop: scrollTop, scrollHeight: this.scrollable.scrollHeight};\n\n        if(newMediaTab.scroll === undefined) {\n          const rect = this.container.getBoundingClientRect();\n          const rect2 = this.container.parentElement.getBoundingClientRect();\n          const diff = rect.y - rect2.y;\n\n          if(scrollTop > diff) {\n            newMediaTab.scroll = {scrollTop: diff, scrollHeight: 0};\n          }\n        }\n\n        if(newMediaTab.scroll) {\n          const diff = fromMediaTab.scroll.scrollTop - newMediaTab.scroll.scrollTop;\n          // console.log('what you gonna do', this.goingHard, diff);\n\n          // this.scrollable.scrollTop = scrollTop;\n          if(diff/*  && diff < 0 */) {\n            /* if(diff > -(fromMediaTab.contentTab.scrollHeight + this.nav.scrollHeight)) {\n              fromMediaTab.contentTab.style.transform = `translateY(${diff}px)`;\n              this.scrollable.scrollTop = scrollTop - diff;\n            } else { */\n            newMediaTab.contentTab.style.transform = `translateY(${diff}px)`;\n            // }\n          }\n        }\n      }\n\n      /* if(this.prevTabId !== -1 && nav.offsetTop) {\n        this.scrollable.scrollTop -= nav.offsetTop;\n      } */\n\n      /* this.log('setVirtualContainer', id, this.sharedMediaSelected, this.sharedMediaSelected.childElementCount);\n      this.scroll.setVirtualContainer(this.sharedMediaSelected); */\n\n      if(this.prevTabId !== -1 && !newMediaTab.contentTab.childElementCount) { // quick brown fix\n        // this.contentContainer.classList.remove('loaded');\n        this.load(true);\n      }\n\n      this.prevTabId = id;\n    }, () => {\n      this.scrollable.onScroll();\n\n      // console.log('what y', this.tabSelected.style.transform);\n      if(this.mediaTab.scroll !== undefined) {\n        this.mediaTab.contentTab.style.transform = '';\n        this.scrollable.scrollTop = this.mediaTab.scroll.scrollTop;\n      }\n\n      if(unlockScroll) {\n        unlockScroll();\n        unlockScroll = undefined;\n      }\n\n      this.onTransitionEnd();\n    }, undefined, navScrollable, this.listenerSetter);\n\n    attachClickEvent(this.tabsContainer, (e) => {\n      if(this.selection.isSelecting) {\n        cancelEvent(e);\n        this.selection.toggleByElement(findUpClassName(e.target, 'search-super-item'));\n      }\n    }, {capture: true, passive: false, listenerSetter: this.listenerSetter});\n\n    const onMediaClick = async(className: string, targetClassName: string, inputFilter: MyInputMessagesFilter, e: MouseEvent) => {\n      const target = findUpClassName(e.target as HTMLDivElement, className);\n      if(!target) return;\n\n      const mid = +target.dataset.mid;\n      if(!mid) {\n        this.log.warn('no messageId by click on target:', target);\n        return;\n      }\n\n      const peerId = target.dataset.peerId.toPeerId();\n\n      const targets = (Array.from(this.tabs[inputFilter].querySelectorAll('.' + targetClassName)) as HTMLElement[]).map((el) => {\n        const containerEl = findUpClassName(el, className);\n        return {\n          element: el,\n          mid: +containerEl.dataset.mid,\n          peerId: containerEl.dataset.peerId.toPeerId()\n        };\n      });\n\n      // const ids = Object.keys(this.mediaDivsByIds).map((k) => +k).sort((a, b) => a - b);\n      const idx = targets.findIndex((item) => item.mid === mid && item.peerId === peerId);\n\n      const message = await this.managers.appMessagesManager.getMessageByPeer(peerId, mid);\n      new AppMediaViewer()\n      .setSearchContext(this.copySearchContext(inputFilter))\n      .openMedia(message, targets[idx].element, 0, false, targets.slice(0, idx), targets.slice(idx + 1));\n    };\n\n    attachClickEvent(this.tabs.inputMessagesFilterPhotoVideo, onMediaClick.bind(null, 'grid-item', 'grid-item', 'inputMessagesFilterPhotoVideo'), {listenerSetter: this.listenerSetter});\n    attachClickEvent(this.tabs.inputMessagesFilterDocument, onMediaClick.bind(null, 'document-with-thumb', 'media-container', 'inputMessagesFilterDocument'), {listenerSetter: this.listenerSetter});\n\n    /* attachClickEvent(this.tabs.inputMessagesFilterUrl, (e) => {\n      const target = e.target as HTMLElement;\n      if(target.tagName === 'A') {\n        return;\n      }\n\n      try {\n        const a = findUpClassName(target, 'row').querySelector('.anchor-url:last-child') as HTMLAnchorElement;\n        a.click();\n      } catch(err) {}\n    }); */\n\n    this.mediaTab = this.mediaTabs[0];\n\n    useHeavyAnimationCheck(() => {\n      this.lazyLoadQueue.lock();\n    }, () => {\n      this.lazyLoadQueue.unlockAndRefresh(); // ! maybe not so efficient\n    }, this.listenerSetter);\n  }\n\n  private onTransitionStart = () => {\n    this.container.classList.add('sliding');\n  };\n\n  private onTransitionEnd = () => {\n    this.container.classList.remove('sliding');\n  };\n\n  public filterMessagesByType(messages: any[], type: SearchSuperType): MyMessage[] {\n    return filterMessagesByInputFilter(type, messages, messages.length);\n  }\n\n  private processEmptyFilter({message, searchGroup}: ProcessSearchSuperResult) {\n    const loadPromises: Promise<any>[] = [];\n    const {dom} = appDialogsManager.addDialogNew({\n      peerId: message.peerId,\n      container: searchGroup.list,\n      avatarSize: 54,\n      loadPromises\n    });\n\n    const setLastMessagePromise = appDialogsManager.setLastMessageN({\n      dialog: {\n        _: 'dialog',\n        peerId: message.peerId\n      } as any,\n      lastMessage: message,\n      dom,\n      highlightWord: this.searchContext.query\n    });\n\n    loadPromises.push(setLastMessagePromise);\n    return Promise.all(loadPromises);\n  }\n\n  private async processPhotoVideoFilter({message, promises, middleware}: ProcessSearchSuperResult) {\n    const media = getMediaFromMessage(message);\n\n    const div = document.createElement('div');\n    div.classList.add('grid-item');\n    // this.log(message, photo);\n\n    let wrapped: Awaited<ReturnType<typeof wrapPhoto>>;\n    const size = choosePhotoSize(media, 200, 200);\n    if(media._ !== 'photo') {\n      wrapped = await (await wrapVideo({\n        doc: media,\n        message,\n        container: div,\n        boxWidth: 0,\n        boxHeight: 0,\n        lazyLoadQueue: this.lazyLoadQueue,\n        middleware,\n        onlyPreview: true,\n        withoutPreloader: true,\n        noPlayButton: true,\n        photoSize: size\n      })).thumb;\n    } else {\n      wrapped = await wrapPhoto({\n        photo: media,\n        message,\n        container: div,\n        boxWidth: 0,\n        boxHeight: 0,\n        lazyLoadQueue: this.lazyLoadQueue,\n        middleware,\n        withoutPreloader: true,\n        noBlur: true,\n        size\n      });\n    }\n\n    [wrapped.images.thumb, wrapped.images.full].filter(Boolean).forEach((image) => {\n      image.classList.add('grid-item-media');\n    });\n\n    promises.push(wrapped.loadPromises.thumb);\n\n    return {element: div, message};\n  }\n\n  private async processDocumentFilter({message, inputFilter}: ProcessSearchSuperResult) {\n    const document = getMediaFromMessage(message) as Document.document;\n    const showSender = this.showSender || (['voice', 'round'] as MyDocument['type'][]).includes(document.type);\n\n    const div = await wrapDocument({\n      message,\n      withTime: !showSender,\n      fontWeight: 400,\n      voiceAsMusic: true,\n      showSender,\n      searchContext: this.copySearchContext(inputFilter),\n      lazyLoadQueue: this.lazyLoadQueue,\n      autoDownloadSize: 0\n    });\n\n    if((['audio', 'voice', 'round'] as MyDocument['type'][]).includes(document.type)) {\n      div.classList.add('audio-48');\n    }\n\n    return {message, element: div};\n  }\n\n  private async processUrlFilter({message, promises, middleware}: ProcessSearchSuperResult) {\n    let webpage = (message.media as MessageMedia.messageMediaWebPage)?.webpage as WebPage.webPage;\n\n    if(!webpage) {\n      const entity = message.totalEntities ? message.totalEntities.find((e: any) => e._ === 'messageEntityUrl' || e._ === 'messageEntityTextUrl') : null;\n      let url: string, display_url: string, sliced: string;\n\n      if(!entity) {\n        // this.log.error('NO ENTITY:', message);\n        const match = matchUrl(message.message);\n        if(!match) {\n          // this.log.error('NO ENTITY AND NO MATCH:', message);\n          return;\n        }\n\n        url = match[0];\n      } else {\n        sliced = message.message.slice(entity.offset, entity.offset + entity.length);\n      }\n\n      if(entity?._ === 'messageEntityTextUrl') {\n        url = entity.url;\n        // display_url = sliced;\n      } else {\n        url = url || sliced;\n      }\n\n      display_url = url;\n\n      const same = message.message === url;\n      if(!url.match(/^(ftp|http|https):\\/\\//)) {\n        display_url = 'https://' + url;\n        url = url.includes('@') ? url : 'https://' + url;\n      }\n\n      display_url = new URL(display_url).hostname;\n\n      webpage = {\n        _: 'webPage',\n        url,\n        display_url,\n        id: '',\n        hash: 0\n      };\n\n      if(!same) {\n        webpage.description = message.message;\n      }\n    }\n\n    const previewDiv = document.createElement('div');\n    previewDiv.classList.add('preview', 'row-media');\n\n    // this.log('wrapping webpage', webpage);\n\n    if(webpage.photo) {\n      const res = wrapPhoto({\n        container: previewDiv,\n        message: null,\n        photo: webpage.photo as Photo.photo,\n        boxWidth: 0,\n        boxHeight: 0,\n        withoutPreloader: true,\n        lazyLoadQueue: this.lazyLoadQueue,\n        middleware,\n        size: choosePhotoSize(webpage.photo as Photo.photo, 60, 60, false),\n        loadPromises: promises,\n        noBlur: true\n      });\n    } else {\n      previewDiv.classList.add('empty');\n      setInnerHTML(previewDiv, getAbbreviation(webpage.title || webpage.display_url || webpage.description || webpage.url, true));\n    }\n\n    const title = wrapWebPageTitle(webpage);\n\n    const subtitleFragment = wrapWebPageDescription(webpage);\n    const aFragment = htmlToDocumentFragment(wrapRichText(webpage.url || ''));\n    const a = aFragment.firstElementChild;\n    if(a instanceof HTMLAnchorElement) {\n      try { // can have 'URIError: URI malformed'\n        a.innerText = decodeURIComponent(a.href);\n      } catch(err) {\n\n      }\n    }\n\n    if(subtitleFragment.firstChild) {\n      subtitleFragment.append('\\n');\n    }\n\n    subtitleFragment.append(a);\n\n    if(this.showSender) {\n      subtitleFragment.append('\\n', await wrapSenderToPeer(message));\n    }\n\n    if(!title.textContent) {\n      // title = new URL(webpage.url).hostname;\n      title.append(wrapPlainText(webpage.display_url.split('/', 1)[0]));\n    }\n\n    const row = new Row({\n      title,\n      titleRight: wrapSentTime(message),\n      subtitle: subtitleFragment,\n      havePadding: true,\n      clickable: true,\n      noRipple: true\n    });\n\n    /* const mediaDiv = document.createElement('div');\n    mediaDiv.classList.add('row-media'); */\n\n    row.container.append(previewDiv);\n\n    /* ripple(div);\n    div.append(previewDiv);\n    div.insertAdjacentHTML('beforeend', `\n    <div class=\"title\">${title}${titleAdditionHTML}</div>\n    <div class=\"subtitle\">${subtitle}</div>\n    <div class=\"url\">${url}</div>\n    ${sender}\n    `); */\n\n    if(row.container.innerText.trim().length) {\n      return {message, element: row.container};\n    }\n  }\n\n  public async performSearchResult(messages: any[], mediaTab: SearchSuperMediaTab, append = true) {\n    const elemsToAppend: {element: HTMLElement, message: any}[] = [];\n    const sharedMediaDiv: HTMLElement = mediaTab.contentTab;\n    const promises: Promise<any>[] = [];\n    const middleware = this.middleware.get();\n    let inputFilter = mediaTab.inputFilter;\n\n    await getHeavyAnimationPromise();\n\n    let searchGroup: SearchGroup;\n    if(inputFilter === 'inputMessagesFilterPhotoVideo' && !!this.searchContext.query.trim()) {\n      inputFilter = 'inputMessagesFilterEmpty';\n      searchGroup = this.searchGroupMedia;\n      sharedMediaDiv.append(searchGroup.container);\n    } else if(inputFilter === 'inputMessagesFilterEmpty') {\n      searchGroup = this.searchGroups.messages;\n    }\n\n    const options: ProcessSearchSuperResult = {\n      elemsToAppend,\n      inputFilter,\n      message: undefined,\n      middleware,\n      promises,\n      searchGroup\n    };\n\n    let processCallback: (options: ProcessSearchSuperResult) => any;\n\n    // https://core.telegram.org/type/MessagesFilter\n    switch(inputFilter) {\n      case 'inputMessagesFilterEmpty': {\n        processCallback = this.processEmptyFilter;\n        break;\n      }\n\n      case 'inputMessagesFilterPhotoVideo': {\n        processCallback = this.processPhotoVideoFilter;\n        break;\n      }\n\n      case 'inputMessagesFilterVoice':\n      case 'inputMessagesFilterRoundVoice':\n      case 'inputMessagesFilterMusic':\n      case 'inputMessagesFilterDocument': {\n        processCallback = this.processDocumentFilter;\n        break;\n      }\n\n      case 'inputMessagesFilterUrl': {\n        processCallback = this.processUrlFilter;\n        break;\n      }\n\n      default:\n        // this.log.warn('death is my friend', messages);\n        break;\n    }\n\n    if(processCallback) {\n      processCallback = processCallback.bind(this);\n\n      type K = {element: HTMLElement, message: Message.message | Message.messageService};\n      const results: (Promise<K> | K)[] = messages.map(async(message) => {\n        try {\n          options.message = message;\n          return await processCallback(options);\n        } catch(err) {\n          this.log.error('error rendering filter', inputFilter, options, message, err);\n        }\n      });\n\n      const awaited = (await Promise.all(results)).filter(Boolean);\n      elemsToAppend.push(...awaited.filter(Boolean));\n    }\n\n    if(searchGroup && searchGroup.list.childElementCount) {\n      searchGroup.setActive();\n    }\n\n    if(this.loadMutex) {\n      promises.push(this.loadMutex);\n    }\n\n    if(promises.length) {\n      await Promise.all(promises);\n      if(!middleware()) {\n        // this.log.warn('peer changed');\n        return;\n      }\n    }\n\n    if(elemsToAppend.length) {\n      const method = append ? 'append' : 'prepend';\n      elemsToAppend.forEach((details) => {\n        const {element, message} = details;\n        const monthContainer = this.getMonthContainerByTimestamp(this.groupByMonth ? message.date : 0, inputFilter);\n        element.classList.add('search-super-item');\n        element.dataset.mid = '' + message.mid;\n        element.dataset.peerId = '' + message.peerId;\n        monthContainer.items[method](element);\n\n        if(this.selection?.isSelecting) {\n          this.selection.toggleElementCheckbox(element, true);\n        }\n      });\n    }\n\n    // if(type !== 'inputMessagesFilterEmpty') {\n    this.afterPerforming(inputFilter === 'inputMessagesFilterEmpty' ? 1 : messages.length, sharedMediaDiv);\n    // }\n  }\n\n  private afterPerforming(length: number, contentTab: HTMLElement) {\n    if(contentTab) {\n      const parent = contentTab.parentElement;\n      Array.from(parent.children).slice(1).forEach((child) => {\n        child.remove();\n      });\n\n      // this.contentContainer.classList.add('loaded');\n\n      if(!length && !contentTab.childElementCount) {\n        const div = document.createElement('div');\n        div.innerText = 'Nothing interesting here yet...';\n        div.classList.add('position-center', 'text-center', 'content-empty', 'no-select');\n\n        parent.append(div);\n      }\n    }\n  }\n\n  private loadChats() {\n    const renderedPeerIds: Set<PeerId> = new Set();\n    const middleware = this.middleware.get();\n\n    for(const i in this.searchGroups) {\n      const group = this.searchGroups[i as SearchGroupType];\n      this.tabs.inputMessagesFilterEmpty.append(group.container);\n      group.clear();\n    }\n\n    const query = this.searchContext.query;\n    if(query) {\n      const setResults = (results: PeerId[], group: SearchGroup, showMembersCount = false) => {\n        results.map((peerId) => {\n          if(renderedPeerIds.has(peerId)) {\n            return;\n          }\n\n          renderedPeerIds.add(peerId);\n\n          const {dom} = appDialogsManager.addDialogNew({\n            peerId: peerId,\n            container: group.list,\n            avatarSize: 48,\n            autonomous: group.autonomous\n          });\n\n          return {dom, peerId};\n        }).forEach(async({dom, peerId}) => {\n          const peer = await this.managers.appPeersManager.getPeer(peerId);\n          if(showMembersCount && (peer.participants_count || peer.participants)) {\n            const regExp = new RegExp(`(${escapeRegExp(query)}|${escapeRegExp(cleanSearchText(query))})`, 'gi');\n            dom.titleSpan.innerHTML = dom.titleSpan.innerHTML.replace(regExp, '<i>$1</i>');\n            dom.lastMessageSpan.append(await getChatMembersString(peerId.toChatId()));\n          } else if(peerId === rootScope.myId) {\n            dom.lastMessageSpan.append(i18n('Presence.YourChat'));\n          } else {\n            let username = await this.managers.appPeersManager.getPeerUsername(peerId);\n            if(!username) {\n              const user = await this.managers.appUsersManager.getUser(peerId);\n              if(user && user.phone) {\n                username = '+' + formatPhoneNumber(user.phone).formatted;\n              }\n            } else {\n              username = '@' + username;\n            }\n\n            dom.lastMessageSpan.innerHTML = '<i>' + username + '</i>';\n          }\n        });\n\n        group.toggle();\n      };\n\n      const onLoad = <T>(arg: T) => {\n        if(!middleware()) {\n          return;\n        }\n\n        // this.loadedContacts = true;\n\n        return arg;\n      };\n\n      return Promise.all([\n        this.managers.appUsersManager.getContactsPeerIds(query, true)\n        .then(onLoad)\n        .then((contacts) => {\n          if(contacts) {\n            setResults(contacts, this.searchGroups.contacts, true);\n          }\n        }),\n\n        this.managers.appUsersManager.searchContacts(query, 20)\n        .then(onLoad)\n        .then((contacts) => {\n          if(contacts) {\n            setResults(contacts.my_results, this.searchGroups.contacts, true);\n            setResults(contacts.results/* .concat(contacts.results, contacts.results, contacts.results) */, this.searchGroups.globalContacts);\n\n            this.searchGroups.globalContacts.container.classList.add('is-short');\n\n            if(this.searchGroups.globalContacts.nameEl.lastElementChild !== this.searchGroups.globalContacts.nameEl.firstElementChild) {\n              this.searchGroups.globalContacts.nameEl.lastElementChild.remove();\n            }\n\n            if(this.searchGroups.globalContacts.list.childElementCount > 3) {\n              const showMore = document.createElement('div');\n              showMore.classList.add('search-group__show-more');\n              const intlElement = new I18n.IntlElement({\n                key: 'Separator.ShowMore'\n              });\n              showMore.append(intlElement.element);\n              this.searchGroups.globalContacts.nameEl.append(showMore);\n              attachClickEvent(showMore, () => {\n                const isShort = this.searchGroups.globalContacts.container.classList.toggle('is-short');\n                intlElement.key = isShort ? 'Separator.ShowMore' : 'Separator.ShowLess';\n                intlElement.update();\n              });\n            }\n          }\n        }),\n\n        this.managers.appMessagesManager.getConversations(query, 0, 20, 0)\n        .then(onLoad)\n        .then((value) => {\n          if(value) {\n            setResults(value.dialogs.map((d) => d.peerId), this.searchGroups.contacts, true);\n          }\n        })\n      ]);\n    } else if(!this.searchContext.peerId && !this.searchContext.minDate) {\n      const renderRecentSearch = (setActive = true) => {\n        return apiManagerProxy.getState().then((state) => {\n          if(!middleware()) {\n            return;\n          }\n\n          this.searchGroups.recent.list.innerHTML = '';\n\n          state.recentSearch.slice(0, 20).forEach(async(peerId) => {\n            const {dom} = appDialogsManager.addDialogNew({\n              peerId: peerId,\n              container: this.searchGroups.recent.list,\n              meAsSaved: true,\n              avatarSize: 48,\n              autonomous: true\n            });\n\n            dom.lastMessageSpan.append(await (peerId.isUser() ?\n              getUserStatusString(await this.managers.appUsersManager.getUser(peerId.toUserId())) :\n              getChatMembersString(peerId.toChatId())));\n          });\n\n          if(!state.recentSearch.length) {\n            this.searchGroups.recent.clear();\n          } else if(setActive) {\n            this.searchGroups.recent.setActive();\n          }\n        });\n      };\n\n      return Promise.all([\n        this.managers.appUsersManager.getTopPeers('correspondents').then((peers) => {\n          if(!middleware()) return;\n\n          const idx = peers.findIndex((peer) => peer.id === rootScope.myId);\n          if(idx !== -1) {\n            peers = peers.slice();\n            peers.splice(idx, 1);\n          }\n          // console.log('got top categories:', categories);\n          if(peers.length) {\n            peers.forEach((peer) => {\n              appDialogsManager.addDialogNew({\n                peerId: peer.id,\n                container: this.searchGroups.people.list,\n                onlyFirstName: true,\n                avatarSize: 54,\n                autonomous: false,\n                noIcons: this.searchGroups.people.noIcons\n              });\n            });\n          }\n\n          this.searchGroups.people.setActive();\n        }),\n\n        renderRecentSearch()\n      ]);\n    } else return Promise.resolve();\n  }\n\n  private async loadMembers(mediaTab: SearchSuperMediaTab) {\n    const id = this.searchContext.peerId.toChatId();\n    const middleware = this.middleware.get();\n    let promise: Promise<void>;\n\n    const renderParticipants = async(participants: (ChatParticipant | ChannelParticipant)[]) => {\n      if(this.loadMutex) {\n        await this.loadMutex;\n\n        if(!middleware()) {\n          return;\n        }\n      }\n\n      if(!this.membersList) {\n        this.membersList = new SortedUserList({\n          lazyLoadQueue: this.lazyLoadQueue,\n          rippleEnabled: false,\n          managers: this.managers\n        });\n        attachClickEvent(this.membersList.list, (e) => {\n          const li = findUpTag(e.target, DIALOG_LIST_ELEMENT_TAG);\n          if(!li) {\n            return;\n          }\n\n          const peerId = li.dataset.peerId.toPeerId();\n          let promise: Promise<any> = Promise.resolve();\n          if(mediaSizes.isMobile) {\n            promise = appSidebarRight.toggleSidebar(false);\n          }\n\n          promise.then(() => {\n            appImManager.setInnerPeer({peerId});\n          });\n        });\n        mediaTab.contentTab.append(this.membersList.list);\n        this.afterPerforming(1, mediaTab.contentTab);\n      }\n\n      for(const participant of participants) {\n        const peerId = getParticipantPeerId(participant);\n        if(peerId.isAnyChat()) {\n          continue;\n        }\n\n        const user = await this.managers.appUsersManager.getUser(peerId);\n        if(user.pFlags.deleted) {\n          continue;\n        }\n\n        this.membersList.add(peerId);\n      }\n    };\n\n    if(await this.managers.appChatsManager.isChannel(id)) {\n      const LOAD_COUNT = !this.membersList ? 50 : 200;\n      promise = this.managers.appProfileManager.getChannelParticipants(id, undefined, LOAD_COUNT, this.nextRates[mediaTab.inputFilter]).then((participants) => {\n        if(!middleware()) {\n          return;\n        }\n\n        const list = mediaTab.contentTab.firstElementChild as HTMLUListElement;\n        this.nextRates[mediaTab.inputFilter] = (list ? list.childElementCount : 0) + participants.participants.length;\n\n        if(participants.participants.length < LOAD_COUNT) {\n          this.loaded[mediaTab.inputFilter] = true;\n        }\n\n        return renderParticipants(participants.participants);\n      });\n    } else {\n      promise = this.managers.appProfileManager.getChatFull(id).then((chatFull) => {\n        if(!middleware()) {\n          return;\n        }\n\n        // console.log('anymore', chatFull);\n        this.loaded[mediaTab.inputFilter] = true;\n        const participants = (chatFull as ChatFull.chatFull).participants;\n        if(participants._ === 'chatParticipantsForbidden') {\n          return;\n        }\n\n        return renderParticipants(participants.participants);\n      });\n    }\n\n    return this.loadPromises[mediaTab.inputFilter] = promise.finally(() => {\n      if(!middleware()) {\n        return;\n      }\n\n      this.loadPromises[mediaTab.inputFilter] = null;\n    });\n  }\n\n  private loadType(mediaTab: SearchSuperMediaTab, justLoad: boolean, loadCount: number, middleware: () => boolean) {\n    const type = mediaTab.inputFilter;\n\n    if(this.loadPromises[type]) {\n      return this.loadPromises[type];\n    }\n\n    if(mediaTab.type === 'members') {\n      return this.loadMembers(mediaTab);\n    }\n\n    const history = this.historyStorage[type] ?? (this.historyStorage[type] = []);\n\n    if(type === 'inputMessagesFilterEmpty' && !history.length) {\n      if(!this.loadedChats) {\n        this.loadChats();\n        this.loadedChats = true;\n      }\n\n      if(!this.searchContext.query.trim() && !this.searchContext.peerId && !this.searchContext.minDate) {\n        this.loaded[type] = true;\n        return Promise.resolve();\n      }\n    }\n\n    const promise = this.loadPromises[type] = Promise.resolve().then(async() => {\n      // render from cache\n      if(history.length && this.usedFromHistory[type] < history.length && !justLoad) {\n        const messages: any[] = [];\n        let used = Math.max(0, this.usedFromHistory[type]);\n        let slicedLength = 0;\n\n        do {\n          const ids = history.slice(used, used + loadCount);\n          used += ids.length;\n          slicedLength += ids.length;\n\n          const notFilteredMessages = await Promise.all(ids.map((m) => this.managers.appMessagesManager.getMessageByPeer(m.peerId, m.mid)));\n\n          messages.push(...this.filterMessagesByType(notFilteredMessages, type));\n        } while(slicedLength < loadCount && used < history.length);\n\n        //  \n        /* if(slicedLength > loadCount) {\n          let diff = messages.length - loadCount;\n          messages = messages.slice(0, messages.length - diff);\n          used -= diff;\n        } */\n\n        this.usedFromHistory[type] = used;\n        // if(messages.length) {\n        return this.performSearchResult(messages, mediaTab).finally(() => {\n          setTimeout(() => {\n            this.scrollable.checkForTriggers();\n          }, 0);\n        });\n        // }\n      }\n\n      const maxId = history.length ? history[history.length - 1].mid : 0;\n\n      const value = await this.managers.appMessagesManager.getSearch({\n        ...this.searchContext,\n        inputFilter: {_: type},\n        maxId,\n        limit: loadCount,\n        nextRate: this.nextRates[type] ??= 0\n      });\n\n      history.push(...value.history.map((m) => ({mid: m.mid, peerId: m.peerId})));\n\n      if(!middleware()) {\n        // this.log.warn('peer changed');\n        return;\n      }\n\n      // !  ,         ( - ,        getSearch)\n      if(value.history.length < loadCount || (this.searchContext.folderId !== undefined && !value.next_rate) || value.history.length === value.count) {\n      // if((value.count || history.length === value.count) && history.length >= value.count) {\n        // this.log(logStr + 'loaded all media', value, loadCount);\n        this.loaded[type] = true;\n      }\n\n      this.nextRates[type] = value.next_rate;\n\n      if(justLoad) {\n        return;\n      }\n\n      this.usedFromHistory[type] = history.length;\n\n      if(!this.loaded[type]) {\n        promise.then(() => {\n          setTimeout(() => {\n            if(!middleware()) return;\n            // this.log('will preload more');\n            if(this.mediaTab === mediaTab) {\n              const promise = this.load(true, true);\n              if(promise) {\n                promise.then(() => {\n                  if(!middleware()) return;\n                  // this.log('preloaded more');\n                  setTimeout(() => {\n                    this.scrollable.checkForTriggers();\n                  }, 0);\n                });\n              }\n            }\n          }, 0);\n        });\n      }\n\n      // if(value.history.length) {\n      return this.performSearchResult(this.filterMessagesByType(value.history, type), mediaTab);\n      // }\n    }).catch((err) => {\n      this.log.error('load error:', err);\n    }).finally(() => {\n      this.loadPromises[type] = null;\n    });\n\n    return promise;\n  }\n\n  private canLoadMediaTab(mediaTab: SearchSuperMediaTab) {\n    const inputFilter = mediaTab.inputFilter;\n    return !this.loaded[inputFilter] || (this.historyStorage[inputFilter] && this.usedFromHistory[inputFilter] < this.historyStorage[inputFilter].length);\n  }\n\n  private async loadFirstTime() {\n    const middleware = this.middleware.get();\n    const peerId = this.searchContext.peerId;\n    if(!this.hideEmptyTabs) {\n      return;\n    }\n\n    const mediaTabs = this.mediaTabs.filter((mediaTab) => mediaTab.inputFilter !== 'inputMessagesFilterEmpty');\n    const filters = mediaTabs.map((mediaTab) => ({_: mediaTab.inputFilter}));\n\n    const [counters, canViewMembers] = await Promise.all([\n      this.managers.appMessagesManager.getSearchCounters(peerId, filters),\n      this.canViewMembers()\n    ]);\n\n    if(!middleware()) {\n      return;\n    }\n\n    if(this.loadMutex) {\n      await this.loadMutex;\n\n      if(!middleware()) {\n        return;\n      }\n    }\n\n    let firstMediaTab: SearchSuperMediaTab;\n    let count = 0;\n    mediaTabs.forEach((mediaTab) => {\n      const counter = counters.find((c) => c.filter._ === mediaTab.inputFilter);\n\n      mediaTab.menuTab.classList.toggle('hide', !counter.count);\n      mediaTab.menuTab.classList.remove('active');\n      // mediaTab.contentTab.classList.toggle('hide', !counter.count);\n\n      if(counter.count) {\n        if(firstMediaTab === undefined) {\n          firstMediaTab = mediaTab;\n        }\n\n        ++count;\n      }\n    });\n\n    const membersTab = this.mediaTabsMap.get('members');\n    membersTab.menuTab.classList.toggle('hide', !canViewMembers);\n\n    if(canViewMembers) {\n      firstMediaTab = membersTab;\n    }\n\n    this.container.classList.toggle('hide', !firstMediaTab);\n    this.container.parentElement.classList.toggle('search-empty', !firstMediaTab);\n    if(firstMediaTab) {\n      this.skipScroll = true;\n      this.selectTab(this.mediaTabs.indexOf(firstMediaTab), false);\n      // firstMediaTab.menuTab.classList.add('active');\n\n      this.navScrollableContainer.classList.toggle('hide', count <= 1);\n    }\n  }\n\n  public async load(single = false, justLoad = false) {\n    const peerId = this.searchContext.peerId;\n    this.log('load', single, peerId, this.loadPromises);\n    const middleware = this.middleware.get();\n\n    if(this.firstLoad) {\n      await (this.loadFirstTimePromise ??= this.loadFirstTime());\n      if(!middleware()) {\n        return;\n      }\n\n      this.loadFirstTimePromise = undefined;\n      this.firstLoad = false;\n    }\n\n    let toLoad = single ? [this.mediaTab] : this.mediaTabs.filter((t) => t !== this.mediaTab);\n    toLoad = toLoad.filter((mediaTab) => {\n      return this.canLoadMediaTab(mediaTab);\n    });\n\n    if(peerId.isUser()) {\n      findAndSplice(toLoad, (mediaTab) => mediaTab.type === 'members');\n    }\n\n    if(!toLoad.length) {\n      return;\n    }\n\n    const loadCount = justLoad ? 50 : Math.round((windowSize.height / 130 | 0) * 3 * 1.25); // that's good for all types\n\n    const promises: Promise<any>[] = toLoad.map((mediaTab) => {\n      return this.loadType(mediaTab, justLoad, loadCount, middleware);\n    });\n\n    return Promise.all(promises).catch((err) => {\n      this.log.error('Load error all promises:', err);\n    });\n  }\n\n  public getMonthContainerByTimestamp(timestamp: number, type: SearchSuperType) {\n    const date = new Date(timestamp * 1000);\n    date.setHours(0, 0, 0);\n    date.setDate(1);\n    const dateTimestamp = date.getTime();\n    const containers = this.monthContainers[type] ?? (this.monthContainers[type] = {});\n    if(!(dateTimestamp in containers)) {\n      const container = document.createElement('div');\n      container.className = 'search-super-month';\n\n      const name = document.createElement('div');\n      name.classList.add('search-super-month-name');\n\n      const options: Intl.DateTimeFormatOptions = {\n        month: 'long'\n      };\n\n      if(date.getFullYear() !== new Date().getFullYear()) {\n        options.year = 'numeric';\n      }\n\n      const dateElement = new I18n.IntlDateElement({\n        date,\n        options\n      }).element;\n      name.append(dateElement);\n\n      container.append(name);\n\n      const items = document.createElement('div');\n      items.classList.add('search-super-month-items');\n\n      container.append(name, items);\n\n      const haveTimestamps = getObjectKeysAndSort(containers, 'desc');\n      let i = 0;\n      for(; i < haveTimestamps.length; ++i) {\n        const t = haveTimestamps[i];\n        if(dateTimestamp > t) {\n          break;\n        }\n      }\n\n      containers[dateTimestamp] = {container, items};\n      positionElementByIndex(container, this.tabs[type], i);\n    }\n\n    return containers[dateTimestamp];\n  }\n\n  public canViewMembers() {\n    return Promise.all([\n      this.searchContext.peerId.isAnyChat(),\n      this.managers.appChatsManager.isBroadcast(this.searchContext.peerId.toChatId()),\n      this.managers.appChatsManager.hasRights(this.searchContext.peerId.toChatId(), 'view_participants')\n    ]).then(([isAnyChat, isBroadcast, hasRights]) => {\n      return isAnyChat && !isBroadcast && hasRights;\n    });\n  }\n\n  public cleanup() {\n    this.loadPromises = {};\n    this.loaded = {};\n    this.loadedChats = false;\n    this.nextRates = {};\n    this.firstLoad = true;\n    this.prevTabId = -1;\n\n    this.lazyLoadQueue.clear();\n\n    this.mediaTabs.forEach((mediaTab) => {\n      this.usedFromHistory[mediaTab.inputFilter] = -1;\n    });\n\n    if(this.selection?.isSelecting) {\n      this.selection.cancelSelection();\n    }\n\n    // * must go to first tab ( )\n    /* const membersTab = this.mediaTabsMap.get('members');\n    if(membersTab) {\n      const tab = this.canViewMembers() ? membersTab : this.mediaTabs[this.mediaTabs.indexOf(membersTab) + 1];\n      this.mediaTab = tab;\n    } */\n\n    this.middleware.clean();\n    this.loadFirstTimePromise = undefined;\n    this.cleanScrollPositions();\n    this.membersList = undefined;\n  }\n\n  public cleanScrollPositions() {\n    this.mediaTabs.forEach((mediaTab) => {\n      mediaTab.scroll = undefined;\n    });\n  }\n\n  public cleanupHTML(goFirst = false) {\n    if(this.urlsToRevoke.length) {\n      this.urlsToRevoke.forEach((url) => {\n        URL.revokeObjectURL(url);\n      });\n      this.urlsToRevoke.length = 0;\n    }\n\n    this.mediaTabs.forEach((tab) => {\n      tab.contentTab.innerHTML = '';\n\n      if(this.hideEmptyTabs) {\n        // tab.menuTab.classList.add('hide');\n        this.container.classList.add('hide');\n        this.container.parentElement.classList.add('search-empty');\n      }\n\n      if(tab.type === 'chats') {\n        return;\n      }\n\n      if(!this.historyStorage[tab.inputFilter]) {\n        const parent = tab.contentTab.parentElement;\n        // if(!testScroll) {\n        if(!parent.querySelector('.preloader')) {\n          putPreloader(parent, true);\n        }\n        // }\n\n        const empty = parent.querySelector('.content-empty');\n        if(empty) {\n          empty.remove();\n        }\n      }\n    });\n\n    /* if(goFirst) {\n      const membersTab = this.mediaTabsMap.get('members');\n      if(membersTab) {\n        let idx = this.canViewMembers() ? 0 : 1;\n        membersTab.menuTab.classList.toggle('hide', idx !== 0);\n\n        this.selectTab(idx, false);\n      } else {\n        this.selectTab(0, false);\n      }\n    } */\n\n    this.monthContainers = {};\n    this.searchGroupMedia.clear();\n    this.scrollable.scrollTop = 0;\n\n    /* if(testScroll) {\n      for(let i = 0; i < 1500; ++i) {\n        let div = document.createElement('div');\n        div.insertAdjacentHTML('beforeend', `<img class=\"media-image\" src=\"assets/img/camomile.jpg\">`);\n        div.classList.add('grid-item');\n        div.dataset.id = '' + (i / 3 | 0);\n        //div.innerText = '' + (i / 3 | 0);\n        this.tabs.inputMessagesFilterPhotoVideo.append(div);\n      }\n    } */\n  }\n\n  private copySearchContext(newInputFilter: MyInputMessagesFilter) {\n    const context = copy(this.searchContext);\n    context.inputFilter = {_: newInputFilter};\n    context.nextRate = this.nextRates[newInputFilter];\n    return context;\n  }\n\n  public setQuery({peerId, query, threadId, historyStorage, folderId, minDate, maxDate}: {\n    peerId: PeerId,\n    query?: string,\n    threadId?: number,\n    historyStorage?: AppSearchSuper['historyStorage'],\n    folderId?: number,\n    minDate?: number,\n    maxDate?: number\n  }) {\n    this.searchContext = {\n      peerId,\n      query: query || '',\n      inputFilter: {_: this.mediaTab.inputFilter},\n      threadId,\n      folderId,\n      minDate,\n      maxDate\n    };\n\n    this.historyStorage = historyStorage ?? {};\n\n    this.cleanup();\n  }\n\n  public destroy() {\n    this.listenerSetter.removeAll();\n    this.scrollable.destroy();\n    this.swipeHandler?.removeListeners();\n    this.selection?.cleanup();\n\n    this.scrollStartCallback = undefined;\n    this.onChangeTab = undefined;\n    this.selectTab = undefined;\n    this.searchContextMenu = undefined;\n    this.swipeHandler = undefined;\n    this.selection = undefined;\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport cancelEvent from './cancelEvent';\n\nexport default function lockTouchScroll(container: HTMLElement) {\n  const onTouchMove = (e: TouchEvent) => {\n    cancelEvent(e);\n  };\n\n  let lockers = 2;\n  const cb = () => {\n    if(!--lockers) {\n      container.removeEventListener('touchmove', onTouchMove, {capture: true});\n    }\n  };\n\n  container.addEventListener('touchmove', onTouchMove, {capture: true, passive: false});\n  container.addEventListener('touchend', cb, {once: true});\n\n  return cb;\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport type {ChatRights} from '../lib/appManagers/appChatsManager';\nimport type {Dialog} from '../lib/appManagers/appMessagesManager';\nimport appDialogsManager from '../lib/appManagers/appDialogsManager';\nimport rootScope from '../lib/rootScope';\nimport Scrollable from './scrollable';\nimport {FocusDirection} from '../helpers/fastSmoothScroll';\nimport CheckboxField from './checkboxField';\nimport {i18n, LangPackKey, _i18n} from '../lib/langPack';\nimport findUpAttribute from '../helpers/dom/findUpAttribute';\nimport findUpClassName from '../helpers/dom/findUpClassName';\nimport PeerTitle from './peerTitle';\nimport cancelEvent from '../helpers/dom/cancelEvent';\nimport replaceContent from '../helpers/dom/replaceContent';\nimport debounce from '../helpers/schedulers/debounce';\nimport windowSize from '../helpers/windowSize';\nimport type {IsPeerType} from '../lib/appManagers/appPeersManager';\nimport {generateDelimiter, SettingSection} from './sidebarLeft';\nimport {attachClickEvent, simulateClickEvent} from '../helpers/dom/clickEvent';\nimport filterUnique from '../helpers/array/filterUnique';\nimport indexOfAndSplice from '../helpers/array/indexOfAndSplice';\nimport safeAssign from '../helpers/object/safeAssign';\nimport findAndSplice from '../helpers/array/findAndSplice';\nimport AvatarElement from './avatar';\nimport {AppManagers} from '../lib/appManagers/managers';\nimport filterAsync from '../helpers/array/filterAsync';\nimport getParticipantPeerId from '../lib/appManagers/utils/chats/getParticipantPeerId';\nimport getChatMembersString from './wrappers/getChatMembersString';\nimport getUserStatusString from './wrappers/getUserStatusString';\nimport {Chat, User} from '../layer';\nimport canSendToUser from '../lib/appManagers/utils/users/canSendToUser';\nimport hasRights from '../lib/appManagers/utils/chats/hasRights';\nimport getDialogIndex from '../lib/appManagers/utils/dialogs/getDialogIndex';\n\ntype SelectSearchPeerType = 'contacts' | 'dialogs' | 'channelParticipants';\n\n// TODO:    addMembers, ..  peerType: 'contacts',       -  ,      \n\nexport default class AppSelectPeers {\n  public container = document.createElement('div');\n  public list = appDialogsManager.createChatList(/* {\n    handheldsSize: 66,\n    avatarSize: 48\n  } */);\n  private chatsContainer = document.createElement('div');\n  public scrollable: Scrollable;\n  private selectedScrollable: Scrollable;\n\n  private selectedContainer: HTMLElement;\n  public input: HTMLInputElement;\n\n  // public selected: {[peerId: PeerId]: HTMLElement} = {};\n  public selected = new Set<PeerId | string>();\n\n  public freezed = false;\n\n  private folderId = 0;\n  private offsetIndex = 0;\n  private promise: Promise<any>;\n\n  private query = '';\n  private cachedContacts: PeerId[];\n\n  private loadedWhat: Partial<{[k in 'dialogs' | 'archived' | 'contacts' | 'channelParticipants']: true}> = {};\n\n  private renderedPeerIds: Set<PeerId> = new Set();\n\n  private appendTo: HTMLElement;\n  private onChange: (length: number) => void;\n  private peerType: SelectSearchPeerType[] = ['dialogs'];\n  private renderResultsFunc: (peerIds: PeerId[]) => void | Promise<void>;\n  private chatRightsAction: ChatRights;\n  private multiSelect = true;\n  private rippleEnabled = true;\n  private avatarSize = 48;\n  private exceptSelf = false;\n  private filterPeerTypeBy: IsPeerType[];\n\n  private tempIds: {[k in keyof AppSelectPeers['loadedWhat']]: number} = {};\n  private peerId: PeerId;\n\n  private placeholder: LangPackKey;\n\n  private selfPresence: LangPackKey = 'Presence.YourChat';\n\n  private needSwitchList = false;\n\n  private sectionNameLangPackKey: LangPackKey;\n\n  private managers: AppManagers;\n\n  constructor(options: {\n    appendTo: AppSelectPeers['appendTo'],\n    onChange?: AppSelectPeers['onChange'],\n    peerType?: AppSelectPeers['peerType'],\n    peerId?: AppSelectPeers['peerId'],\n    onFirstRender?: () => void,\n    renderResultsFunc?: AppSelectPeers['renderResultsFunc'],\n    chatRightsAction?: AppSelectPeers['chatRightsAction'],\n    multiSelect?: AppSelectPeers['multiSelect'],\n    rippleEnabled?: AppSelectPeers['rippleEnabled'],\n    avatarSize?: AppSelectPeers['avatarSize'],\n    placeholder?: AppSelectPeers['placeholder'],\n    selfPresence?: AppSelectPeers['selfPresence'],\n    exceptSelf?: AppSelectPeers['exceptSelf'],\n    filterPeerTypeBy?: AppSelectPeers['filterPeerTypeBy'],\n    sectionNameLangPackKey?: AppSelectPeers['sectionNameLangPackKey'],\n    managers: AppSelectPeers['managers']\n  }) {\n    safeAssign(this, options);\n\n    this.container.classList.add('selector');\n\n    const f = (this.renderResultsFunc || this.renderResults).bind(this);\n    this.renderResultsFunc = async(peerIds) => {\n      if(this.needSwitchList) {\n        this.scrollable.splitUp.replaceWith(this.list);\n        this.scrollable.setVirtualContainer(this.list);\n        this.needSwitchList = false;\n      }\n\n      peerIds = peerIds.filter((peerId) => {\n        const notRendered = !this.renderedPeerIds.has(peerId);\n        if(notRendered) this.renderedPeerIds.add(peerId);\n        return notRendered;\n      });\n\n      if(this.filterPeerTypeBy) {\n        peerIds = await filterAsync(peerIds, async(peerId) => {\n          if(peerId.isPeerId()) {\n            const peer = await this.managers.appPeersManager.getPeer(peerId);\n            if(!peer.deleted) {\n              for(const method of this.filterPeerTypeBy) {\n                if(await this.managers.appPeersManager[method](peerId)) {\n                  return true;\n                }\n              }\n            }\n          }\n\n          return true;\n        });\n      }\n\n      return f(peerIds);\n    };\n\n    this.input = document.createElement('input');\n    this.input.classList.add('selector-search-input');\n    if(this.placeholder) {\n      _i18n(this.input, this.placeholder, undefined, 'placeholder');\n    } else {\n      _i18n(this.input, 'SendMessageTo', undefined, 'placeholder');\n    }\n\n    this.input.type = 'text';\n\n    if(this.multiSelect) {\n      const section = new SettingSection({});\n      section.innerContainer.classList.add('selector-search-section');\n      const topContainer = document.createElement('div');\n      topContainer.classList.add('selector-search-container');\n\n      this.selectedContainer = document.createElement('div');\n      this.selectedContainer.classList.add('selector-search');\n\n      this.selectedContainer.append(this.input);\n      topContainer.append(this.selectedContainer);\n      this.selectedScrollable = new Scrollable(topContainer);\n\n      // let delimiter = document.createElement('hr');\n\n      attachClickEvent(this.selectedContainer, (e) => {\n        if(this.freezed) return;\n        let target = e.target as HTMLElement;\n        target = findUpClassName(target, 'selector-user');\n\n        if(!target) return;\n\n        const peerId = target.dataset.key;\n        const li = this.chatsContainer.querySelector('[data-peer-id=\"' + peerId + '\"]') as HTMLElement;\n        if(!li) {\n          this.remove(peerId.toPeerId());\n        } else {\n          simulateClickEvent(li);\n        }\n      });\n\n      section.content.append(topContainer);\n      this.container.append(section.container/* , delimiter */);\n    }\n\n    this.chatsContainer.classList.add('chatlist-container');\n    // this.chatsContainer.append(this.list);\n    const section = new SettingSection({\n      name: this.sectionNameLangPackKey,\n      noShadow: true\n    });\n    section.content.append(this.list);\n    this.chatsContainer.append(section.container);\n    this.scrollable = new Scrollable(this.chatsContainer);\n    this.scrollable.setVirtualContainer(this.list);\n\n    attachClickEvent(this.chatsContainer, (e) => {\n      const target = findUpAttribute(e.target, 'data-peer-id') as HTMLElement;\n      cancelEvent(e);\n\n      if(!target) return;\n      if(this.freezed) return;\n\n      let key: PeerId | string = target.dataset.peerId;\n      key = key.isPeerId() ? key.toPeerId() : key;\n\n      if(!this.multiSelect) {\n        this.add(key);\n        return;\n      }\n\n      // target.classList.toggle('active');\n      if(this.selected.has(key)) {\n        this.remove(key);\n      } else {\n        this.add(key);\n      }\n\n      const checkbox = target.querySelector('input') as HTMLInputElement;\n      checkbox.checked = !checkbox.checked;\n    });\n\n    const debouncedInput = debounce(this.onInput, 200, false, true);\n    this.input.addEventListener('input', debouncedInput);\n\n    this.scrollable.onScrolledBottom = () => {\n      this.getMoreResults();\n    };\n\n    this.scrollable.container.prepend(generateDelimiter());\n\n    this.container.append(this.chatsContainer);\n    this.appendTo.append(this.container);\n\n    // WARNING TIMEOUT\n    setTimeout(() => {\n      const getResultsPromise = this.getMoreResults() as Promise<any>;\n      if(options.onFirstRender) {\n        getResultsPromise.then(() => {\n          options.onFirstRender();\n        });\n      }\n    }, 0);\n  }\n\n  private onInput = () => {\n    const value = this.input.value;\n    if(this.query !== value) {\n      if(this.peerType.includes('contacts') || this.peerType.includes('dialogs')) {\n        this.cachedContacts = null;\n      }\n\n      if(this.peerType.includes('dialogs')) {\n        this.folderId = 0;\n        this.offsetIndex = 0;\n      }\n\n      for(const i in this.tempIds) {\n        // @ts-ignore\n        ++this.tempIds[i];\n      }\n\n      this.list = appDialogsManager.createChatList();\n\n      this.promise = null;\n      this.loadedWhat = {};\n      this.query = value;\n      this.renderedPeerIds.clear();\n      this.needSwitchList = true;\n\n      // console.log('selectPeers input:', this.query);\n      this.getMoreResults();\n    }\n  };\n\n  private async renderSaved() {\n    if(\n      !this.exceptSelf &&\n      !this.offsetIndex &&\n      this.folderId === 0 &&\n      this.peerType.includes('dialogs') &&\n      (!this.query || await this.managers.appUsersManager.testSelfSearch(this.query))\n    ) {\n      await this.renderResultsFunc([rootScope.myId]);\n    }\n  }\n\n  private getTempId(type: keyof AppSelectPeers['tempIds']) {\n    if(this.tempIds[type] === undefined) {\n      this.tempIds[type] = 0;\n    }\n\n    return ++this.tempIds[type];\n  }\n\n  private async getMoreDialogs(): Promise<any> {\n    if(this.promise) return this.promise;\n\n    if(this.loadedWhat.dialogs && this.loadedWhat.archived) {\n      return;\n    }\n\n    //   -   ,  ,    \n    const pageCount = windowSize.height / 72 * 1.25 | 0;\n\n    const tempId = this.getTempId('dialogs');\n    const promise = this.managers.appMessagesManager.getConversations(this.query, this.offsetIndex, pageCount, this.folderId, true);\n    this.promise = promise;\n    const value = await promise;\n    if(this.tempIds.dialogs !== tempId) {\n      return;\n    }\n\n    this.promise = null;\n\n    let dialogs = value.dialogs as Dialog[];\n    if(dialogs.length) {\n      const newOffsetIndex = getDialogIndex(dialogs[dialogs.length - 1]) || 0;\n\n      dialogs = dialogs.slice();\n      findAndSplice(dialogs, d => d.peerId === rootScope.myId); // no my account\n\n      if(this.chatRightsAction) {\n        dialogs = await filterAsync(dialogs, (d) => this.filterByRights(d.peerId));\n      }\n\n      await this.renderSaved();\n\n      this.offsetIndex = newOffsetIndex;\n    }\n\n    this.renderResultsFunc(dialogs.map((dialog) => dialog.peerId));\n\n    if(value.isEnd) {\n      if(!this.loadedWhat.dialogs) {\n        await this.renderSaved();\n\n        this.loadedWhat.dialogs = true;\n        this.offsetIndex = 0;\n        this.folderId = 1;\n\n        return this.getMoreDialogs();\n      } else {\n        this.loadedWhat.archived = true;\n\n        if(!this.loadedWhat.contacts/*  && this.peerType.includes('contacts') */) {\n          return this.getMoreContacts();\n        }\n      }\n    }\n  }\n\n  private async filterByRights(peerId: PeerId) {\n    const peer: User | Chat = await this.managers.appPeersManager.getPeer(peerId);\n    if(peerId.isUser()) {\n      return this.chatRightsAction !== 'send_messages' || canSendToUser(peer as User.user);\n    } else if(hasRights(peer as Chat.chat, this.chatRightsAction)) {\n      return true;\n    }\n  }\n\n  private async getMoreContacts() {\n    if(this.promise) return this.promise;\n\n    if(this.loadedWhat.contacts) {\n      return;\n    }\n\n    const isGlobalSearch = this.peerType.includes('contacts');\n\n    if(!this.cachedContacts) {\n      /* const promises: Promise<any>[] = [appUsersManager.getContacts(this.query)];\n      if(!this.peerType.includes('dialogs')) {\n        promises.push(appMessagesManager.getConversationsAll());\n      }\n\n      this.promise = Promise.all(promises);\n      this.cachedContacts = (await this.promise)[0].slice(); */\n      const tempId = this.getTempId('contacts');\n      const promise = Promise.all([\n        isGlobalSearch ? this.managers.appUsersManager.getContactsPeerIds(this.query) : [],\n        this.query ? this.managers.appUsersManager.searchContacts(this.query) : undefined\n      ]);\n\n      this.promise = promise;\n      const [cachedContacts, searchResult] = await promise;\n      if(this.tempIds.contacts !== tempId) {\n        return;\n      }\n\n      if(searchResult) {\n        // do not add global result if only dialogs needed\n        let resultPeerIds = isGlobalSearch ? searchResult.my_results.concat(searchResult.results) : searchResult.my_results;\n\n        if(this.chatRightsAction) {\n          resultPeerIds = await filterAsync(resultPeerIds, (peerId) => this.filterByRights(peerId));\n        }\n\n        if(!this.peerType.includes('dialogs')) {\n          resultPeerIds = resultPeerIds.filter((peerId) => peerId.isUser());\n        }\n\n        this.cachedContacts = filterUnique(cachedContacts.concat(resultPeerIds));\n      } else this.cachedContacts = cachedContacts.slice();\n\n      indexOfAndSplice(this.cachedContacts, rootScope.myId); // no my account\n      this.promise = null;\n    }\n\n    // if(this.cachedContacts.length) {\n    const pageCount = windowSize.height / 72 * 1.25 | 0;\n    const arr = this.cachedContacts.splice(0, pageCount);\n    this.renderResultsFunc(arr);\n    // }\n\n    if(!this.cachedContacts.length) {\n      this.loadedWhat.contacts = true;\n\n      // need to load non-contacts\n      /* if(!this.peerType.includes('dialogs')) {\n        return this.getMoreDialogs();\n      } */\n    }\n  }\n\n  private async getMoreChannelParticipants() {\n    if(this.promise) return this.promise;\n\n    if(this.loadedWhat.channelParticipants) {\n      return;\n    }\n\n    const pageCount = 50; // same as in group permissions to use cache\n\n    const tempId = this.getTempId('channelParticipants');\n    const promise = this.managers.appProfileManager.getChannelParticipants(this.peerId.toChatId(), {_: 'channelParticipantsSearch', q: this.query}, pageCount, this.list.childElementCount);\n    const participants = await promise;\n    if(this.tempIds.channelParticipants !== tempId) {\n      return;\n    }\n\n    const peerIds = participants.participants.map((participant) => {\n      return getParticipantPeerId(participant);\n    });\n    indexOfAndSplice(peerIds, rootScope.myId);\n    this.renderResultsFunc(peerIds);\n\n    if(this.list.childElementCount >= participants.count || participants.participants.length < pageCount) {\n      this.loadedWhat.channelParticipants = true;\n    }\n  }\n\n  checkForTriggers = () => {\n    this.scrollable.checkForTriggers();\n  };\n\n  private getMoreResults() {\n    const get = () => {\n      const promises: Promise<any>[] = [];\n\n      // if(!loadedAllDialogs && (this.peerType.includes('dialogs')/*  || this.peerType.includes('contacts') */)) {\n      //   if(!loadAllDialogsPromise) {\n      //     loadAllDialogsPromise = appMessagesManager.getConversationsAll()\n      //     .then(() => {\n      //       loadedAllDialogs = true;\n      //     }).finally(() => {\n      //       loadAllDialogsPromise = null;\n      //     });\n      //   }\n\n      //   promises.push(loadAllDialogsPromise);\n      // }\n\n      if((this.peerType.includes('dialogs')/*  || this.loadedWhat.contacts */) && !this.loadedWhat.archived) { // to load non-contacts\n        promises.push(this.getMoreDialogs());\n\n        if(!this.loadedWhat.archived) {\n          return promises;\n        }\n      }\n\n      if((this.peerType.includes('contacts') || this.peerType.includes('dialogs')) && !this.loadedWhat.contacts) {\n        promises.push(this.getMoreContacts());\n      }\n\n      if(this.peerType.includes('channelParticipants') && !this.loadedWhat.channelParticipants) {\n        promises.push(this.getMoreChannelParticipants());\n      }\n\n      return promises;\n    };\n\n    const promises = get();\n    const promise = Promise.all(promises);\n    if(promises.length) {\n      promise.then(this.checkForTriggers);\n    }\n\n    return promise;\n  }\n\n  private async renderResults(peerIds: PeerId[]) {\n    // console.log('will renderResults:', peerIds);\n\n    //     \n    if(!this.peerType.includes('dialogs') && this.loadedWhat.contacts) {\n      peerIds = await filterAsync(peerIds, (peerId) => {\n        return this.managers.appUsersManager.isNonContactUser(peerId);\n      });\n    }\n\n    peerIds.forEach(async(peerId) => {\n      const {dom} = appDialogsManager.addDialogNew({\n        peerId: peerId,\n        container: this.scrollable,\n        rippleEnabled: this.rippleEnabled,\n        avatarSize: this.avatarSize\n      });\n\n      if(this.multiSelect) {\n        const selected = this.selected.has(peerId);\n        const checkboxField = new CheckboxField();\n\n        if(selected) {\n          // dom.listEl.classList.add('active');\n          checkboxField.input.checked = true;\n        }\n\n        dom.containerEl.prepend(checkboxField.label);\n      }\n\n      let subtitleEl: HTMLElement;\n      if(peerId.isAnyChat()) {\n        subtitleEl = await getChatMembersString(peerId.toChatId());\n      } else if(peerId === rootScope.myId) {\n        subtitleEl = i18n(this.selfPresence);\n      } else {\n        subtitleEl = getUserStatusString(await this.managers.appUsersManager.getUser(peerId.toUserId()));\n      }\n\n      dom.lastMessageSpan.append(subtitleEl);\n    });\n  }\n\n  public add(key: PeerId | string, title?: string | HTMLElement, scroll = true) {\n    // console.trace('add');\n    this.selected.add(key);\n\n    if(!this.multiSelect) {\n      this.onChange(this.selected.size);\n      return;\n    }\n\n    if(this.query.trim()) {\n      this.input.value = '';\n      this.onInput();\n    }\n\n    const div = document.createElement('div');\n    div.classList.add('selector-user', 'scale-in');\n\n    const avatarEl = new AvatarElement();\n    avatarEl.classList.add('selector-user-avatar', 'tgico', 'avatar-32');\n    avatarEl.isDialog = true;\n\n    div.dataset.key = '' + key;\n    if(key.isPeerId()) {\n      if(title === undefined) {\n        title = new PeerTitle({peerId: key.toPeerId(), dialog: true}).element;\n      }\n\n      avatarEl.updateWithOptions({\n        peerId: key as PeerId\n      });\n    }\n\n    if(title) {\n      if(typeof(title) === 'string') {\n        div.innerHTML = title;\n      } else {\n        replaceContent(div, title);\n        div.append(title);\n      }\n    }\n\n    div.insertAdjacentElement('afterbegin', avatarEl);\n\n    this.selectedContainer.insertBefore(div, this.input);\n    // this.selectedScrollable.scrollTop = this.selectedScrollable.scrollHeight;\n    this.onChange && this.onChange(this.selected.size);\n\n    if(scroll) {\n      this.selectedScrollable.scrollIntoViewNew({\n        element: this.input,\n        position: 'center'\n      });\n    }\n\n    return div;\n  }\n\n  public remove(key: PeerId | string) {\n    if(!this.multiSelect) return;\n    // const div = this.selected[peerId];\n    const div = this.selectedContainer.querySelector(`[data-key=\"${key}\"]`) as HTMLElement;\n    div.classList.remove('scale-in');\n    void div.offsetWidth;\n    div.classList.add('scale-out');\n\n    const onAnimationEnd = () => {\n      this.selected.delete(key);\n      div.remove();\n      this.onChange && this.onChange(this.selected.size);\n    };\n\n    if(rootScope.settings.animationsEnabled) {\n      div.addEventListener('animationend', onAnimationEnd, {once: true});\n    } else {\n      onAnimationEnd();\n    }\n  }\n\n  public getSelected() {\n    return [...this.selected];\n  }\n\n  public addInitial(values: any[]) {\n    values.forEach((value) => {\n      this.add(value, undefined, false);\n    });\n\n    window.requestAnimationFrame(() => { // ! not the best place for this raf though it works\n      this.selectedScrollable.scrollIntoViewNew({\n        element: this.input,\n        position: 'center',\n        forceDirection: FocusDirection.Static\n      });\n    });\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport type {MyDocument} from '../lib/appManagers/appDocsManager';\nimport {wrapPhoto} from './wrappers';\nimport ProgressivePreloader from './preloader';\nimport appMediaPlaybackController, {MediaItem, MediaSearchContext} from './appMediaPlaybackController';\nimport {DocumentAttribute, Message} from '../layer';\nimport mediaSizes from '../helpers/mediaSizes';\nimport {IS_SAFARI} from '../environment/userAgent';\nimport rootScope from '../lib/rootScope';\nimport cancelEvent from '../helpers/dom/cancelEvent';\nimport {attachClickEvent} from '../helpers/dom/clickEvent';\nimport LazyLoadQueue from './lazyLoadQueue';\nimport deferredPromise, {CancellablePromise} from '../helpers/cancellablePromise';\nimport ListenerSetter, {Listener} from '../helpers/listenerSetter';\nimport noop from '../helpers/noop';\nimport findUpClassName from '../helpers/dom/findUpClassName';\nimport {joinElementsWith} from '../lib/langPack';\nimport {MiddleEllipsisElement} from './middleEllipsis';\nimport {formatFullSentTime} from '../helpers/date';\nimport throttleWithRaf from '../helpers/schedulers/throttleWithRaf';\nimport {NULL_PEER_ID} from '../lib/mtproto/mtproto_config';\nimport formatBytes from '../helpers/formatBytes';\nimport {animateSingle} from '../helpers/animation';\nimport clamp from '../helpers/number/clamp';\nimport toHHMMSS from '../helpers/string/toHHMMSS';\nimport MediaProgressLine from './mediaProgressLine';\nimport setInnerHTML from '../helpers/dom/setInnerHTML';\nimport {AppManagers} from '../lib/appManagers/managers';\nimport wrapEmojiText from '../lib/richTextProcessor/wrapEmojiText';\nimport wrapSenderToPeer from './wrappers/senderToPeer';\nimport wrapSentTime from './wrappers/sentTime';\nimport getMediaFromMessage from '../lib/appManagers/utils/messages/getMediaFromMessage';\nimport appDownloadManager from '../lib/appManagers/appDownloadManager';\n\nrootScope.addEventListener('messages_media_read', ({mids, peerId}) => {\n  mids.forEach((mid) => {\n    const attr = `[data-mid=\"${mid}\"][data-peer-id=\"${peerId}\"]`;\n    (Array.from(document.querySelectorAll(`audio-element.is-unread${attr}, .media-round.is-unread${attr}`)) as AudioElement[]).forEach((elem) => {\n      elem.classList.remove('is-unread');\n    });\n  });\n});\n\n// https://github.com/LonamiWebs/Telethon/blob/4393ec0b83d511b6a20d8a20334138730f084375/telethon/utils.py#L1285\nexport function decodeWaveform(waveform: Uint8Array | number[]) {\n  if(!(waveform instanceof Uint8Array)) {\n    waveform = new Uint8Array(waveform);\n  }\n\n  const bitCount = waveform.length * 8;\n  const valueCount = bitCount / 5 | 0;\n  if(!valueCount) {\n    return new Uint8Array([]);\n  }\n\n  let result: Uint8Array;\n  try {\n    const dataView = new DataView(waveform.buffer);\n    result = new Uint8Array(valueCount);\n    for(let i = 0; i < valueCount; i++) {\n      const byteIndex = i * 5 / 8 | 0;\n      const bitShift = i * 5 % 8;\n      const value = dataView.getUint16(byteIndex, true);\n      result[i] = (value >> bitShift) & 0b00011111;\n    }\n  } catch(err) {\n    result = new Uint8Array([]);\n  }\n\n  /* var byteIndex = (valueCount - 1) / 8 | 0;\n  var bitShift = (valueCount - 1) % 8;\n  if(byteIndex === waveform.length - 1) {\n    var value = waveform[byteIndex];\n  } else {\n    var value = dataView.getUint16(byteIndex, true);\n  }\n  console.log('decoded waveform, setting last value:', value, byteIndex, bitShift);\n  result[valueCount - 1] = (value >> bitShift) & 0b00011111; */\n  return result;\n}\n\nfunction createWaveformBars(waveform: Uint8Array, duration: number) {\n  const barWidth = 2;\n  const barMargin = 2;      // mediaSizes.isMobile ? 2 : 1;\n  const barHeightMin = 4;   // mediaSizes.isMobile ? 3 : 2;\n  const barHeightMax = mediaSizes.isMobile ? 16 : 23;\n  // const availW = 150;       //mediaSizes.isMobile ? 152 : 190;\n\n  const minW = mediaSizes.isMobile ? 152 : 190;\n  const maxW = mediaSizes.isMobile ? 190 : 256;\n  const availW = clamp(duration / 60 * maxW, minW, maxW); // mediaSizes.isMobile ? 152 : 224;\n\n  const svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');\n  svg.classList.add('audio-waveform-bars');\n  svg.setAttributeNS(null, 'width', '' + availW);\n  svg.setAttributeNS(null, 'height', '' + barHeightMax);\n  svg.setAttributeNS(null, 'viewBox', `0 0 ${availW} ${barHeightMax}`);\n\n  // console.log('decoded waveform:', waveform);\n\n  const normValue = Math.max(...waveform);\n  const wfSize = waveform.length ? waveform.length : 100;\n  const barCount = Math.min((availW / (barWidth + barMargin)) | 0, wfSize);\n\n  let maxValue = 0;\n  const maxDelta = barHeightMax - barHeightMin;\n\n  let html = '';\n  for(let i = 0, barX = 0, sumI = 0; i < wfSize; ++i) {\n    const value = waveform[i] || 0;\n    if((sumI + barCount) >= wfSize) { // draw bar\n      sumI = sumI + barCount - wfSize;\n      if(sumI < (barCount + 1) / 2) {\n        if(maxValue < value) maxValue = value;\n      }\n\n      const bar_value = Math.max(((maxValue * maxDelta) + ((normValue + 1) / 2)) / (normValue + 1), barHeightMin);\n\n      const h = `\n      <rect x=\"${barX}\" y=\"${barHeightMax - bar_value}\" width=\"${barWidth}\" height=\"${bar_value}\" rx=\"1\" ry=\"1\"></rect>\n      `;\n      html += h;\n\n      barX += barWidth + barMargin;\n\n      if(sumI < (barCount + 1) / 2) {\n        maxValue = 0;\n      } else {\n        maxValue = value;\n      }\n    } else {\n      if(maxValue < value) maxValue = value;\n\n      sumI += barCount;\n    }\n  }\n\n  const container = document.createElement('div');\n  container.classList.add('audio-waveform');\n  container.append(svg);\n\n  svg.insertAdjacentHTML('beforeend', html);\n  return {svg, container, availW};\n}\n\nasync function wrapVoiceMessage(audioEl: AudioElement) {\n  audioEl.classList.add('is-voice');\n\n  const message = audioEl.message;\n  const doc = getMediaFromMessage(message) as MyDocument;\n\n  if(message.pFlags.out) {\n    audioEl.classList.add('is-out');\n  }\n\n  let waveform = (doc.attributes.find((attribute) => attribute._ === 'documentAttributeAudio') as DocumentAttribute.documentAttributeAudio).waveform || new Uint8Array([]);\n  waveform = decodeWaveform(waveform.slice(0, 63));\n\n  const {svg, container: svgContainer, availW} = createWaveformBars(waveform, doc.duration);\n\n  const fakeSvgContainer = svgContainer.cloneNode(true) as HTMLElement;\n  fakeSvgContainer.classList.add('audio-waveform-fake');\n  svgContainer.classList.add('audio-waveform-background');\n\n  const waveformContainer = document.createElement('div');\n  waveformContainer.classList.add('audio-waveform-container');\n  waveformContainer.append(svgContainer, fakeSvgContainer);\n\n  const timeDiv = document.createElement('div');\n  timeDiv.classList.add('audio-time');\n  audioEl.append(waveformContainer, timeDiv);\n\n  let progress = svg as any as HTMLElement;\n\n  const onLoad = () => {\n    let audio = audioEl.audio;\n\n    const setAnimation = () => {\n      animateSingle(() => {\n        if(!audio) return false;\n        onTimeUpdate();\n        return !audio.paused;\n      }, audioEl);\n    };\n\n    const onTimeUpdate = () => {\n      fakeSvgContainer.style.width = (audio.currentTime / audio.duration * 100) + '%';\n    };\n\n    if(!audio.paused || (audio.currentTime > 0 && audio.currentTime !== audio.duration)) {\n      onTimeUpdate();\n    }\n\n    const throttledTimeUpdate = throttleWithRaf(onTimeUpdate);\n    audioEl.addAudioListener('timeupdate', throttledTimeUpdate);\n    audioEl.addAudioListener('ended', throttledTimeUpdate);\n    audioEl.addAudioListener('play', setAnimation);\n\n    audioEl.readyPromise.then(() => {\n      let mousedown = false, mousemove = false;\n      progress.addEventListener('mouseleave', (e) => {\n        if(mousedown) {\n          audio.play();\n          mousedown = false;\n        }\n        mousemove = false;\n      })\n      progress.addEventListener('mousemove', (e) => {\n        mousemove = true;\n        if(mousedown) scrub(e);\n      });\n      progress.addEventListener('mousedown', (e) => {\n        e.preventDefault();\n        if(e.button !== 0) return;\n        if(!audio.paused) {\n          audio.pause();\n        }\n\n        scrub(e);\n        mousedown = true;\n      });\n      progress.addEventListener('mouseup', (e) => {\n        if(mousemove && mousedown) {\n          audio.play();\n          mousedown = false;\n        }\n      });\n      attachClickEvent(progress, (e) => {\n        cancelEvent(e);\n        if(!audio.paused) scrub(e);\n      });\n\n      function scrub(e: MouseEvent | TouchEvent) {\n        let offsetX: number;\n        if(e instanceof MouseEvent) {\n          offsetX = e.offsetX;\n        } else { // touch\n          const rect = (e.target as HTMLElement).getBoundingClientRect();\n          offsetX = e.targetTouches[0].pageX - rect.left;\n        }\n\n        const scrubTime = offsetX / availW /* width */ * audio.duration;\n        audio.currentTime = scrubTime;\n      }\n    }, noop);\n\n    return () => {\n      progress.remove();\n      progress = null;\n      audio = null;\n    };\n  };\n\n  return onLoad;\n}\n\nasync function wrapAudio(audioEl: AudioElement) {\n  const withTime = audioEl.withTime;\n\n  const message = audioEl.message;\n  const doc = getMediaFromMessage(message) as MyDocument;\n\n  const isVoice = doc.type === 'voice' || doc.type === 'round';\n  const descriptionEl = document.createElement('div');\n  descriptionEl.classList.add('audio-description');\n\n  const audioAttribute = doc.attributes.find((attr) => attr._ === 'documentAttributeAudio') as DocumentAttribute.documentAttributeAudio;\n\n  if(!isVoice) {\n    const parts: (Node | string)[] = [];\n    if(audioAttribute?.performer) {\n      parts.push(wrapEmojiText(audioAttribute.performer));\n    }\n\n    if(withTime) {\n      parts.push(formatFullSentTime(message.date));\n    } else if(!parts.length) {\n      parts.push(formatBytes(doc.size));\n    }\n\n    if(audioEl.showSender) {\n      parts.push(await wrapSenderToPeer(message));\n    }\n\n    descriptionEl.append(...joinElementsWith(parts, '  '));\n  }\n\n  const html = `\n  <div class=\"audio-details\">\n    <div class=\"audio-title\"></div>\n    <div class=\"audio-subtitle\"><div class=\"audio-time\"></div></div>\n  </div>`;\n  audioEl.insertAdjacentHTML('beforeend', html);\n\n  const titleEl = audioEl.querySelector('.audio-title') as HTMLElement;\n\n  const middleEllipsisEl = new MiddleEllipsisElement();\n  middleEllipsisEl.dataset.fontWeight = audioEl.dataset.fontWeight;\n  middleEllipsisEl.dataset.sizeType = audioEl.dataset.sizeType;\n  if(isVoice) {\n    middleEllipsisEl.append(await wrapSenderToPeer(message));\n  } else {\n    setInnerHTML(middleEllipsisEl, wrapEmojiText(audioAttribute?.title ?? doc.file_name));\n  }\n\n  titleEl.append(middleEllipsisEl);\n\n  if(audioEl.showSender) {\n    titleEl.append(wrapSentTime(message));\n  }\n\n  const subtitleDiv = audioEl.querySelector('.audio-subtitle') as HTMLDivElement;\n  subtitleDiv.append(descriptionEl);\n\n  const onLoad = () => {\n    let launched = false;\n\n    let progressLine = new MediaProgressLine(audioEl.audio, doc.supportsStreaming);\n\n    audioEl.addAudioListener('ended', () => {\n      audioEl.classList.remove('audio-show-progress');\n      // Reset subtitle\n      subtitleDiv.lastChild.replaceWith(descriptionEl);\n      launched = false;\n    });\n\n    const onPlay = () => {\n      if(!launched) {\n        audioEl.classList.add('audio-show-progress');\n        launched = true;\n\n        if(progressLine) {\n          subtitleDiv.lastChild.replaceWith(progressLine.container);\n        }\n      }\n    };\n\n    audioEl.addAudioListener('play', onPlay);\n\n    if(!audioEl.audio.paused || audioEl.audio.currentTime > 0) {\n      onPlay();\n    }\n\n    return () => {\n      progressLine.removeListeners();\n      progressLine.container.remove();\n      progressLine = null;\n    };\n  };\n\n  return onLoad;\n}\n\nfunction constructDownloadPreloader(tryAgainOnFail = true) {\n  const preloader = new ProgressivePreloader({cancelable: true, tryAgainOnFail});\n  preloader.construct();\n\n  if(!tryAgainOnFail) {\n    preloader.circle.setAttributeNS(null, 'r', '23');\n    preloader.totalLength = 143.58203125;\n  }\n\n  return preloader;\n}\n\nexport const findMediaTargets = (anchor: HTMLElement, anchorMid: number/* , useSearch: boolean */) => {\n  let prev: MediaItem[], next: MediaItem[];\n  // if(anchor.classList.contains('search-super-item') || !useSearch) {\n  const isBubbles = !anchor.classList.contains('search-super-item');\n  const container = findUpClassName(anchor, !isBubbles ? 'tabs-tab' : 'bubbles-inner');\n  if(container) {\n    const attr = `:not([data-is-outgoing=\"1\"])`;\n    const justAudioSelector = `.audio:not(.is-voice)${attr}`;\n    let selectors: string[];\n    if(!anchor.matches(justAudioSelector)) {\n      selectors = [`.audio.is-voice${attr}`, `.media-round${attr}`];\n    } else {\n      selectors = [justAudioSelector];\n    }\n\n    if(isBubbles) {\n      const prefix = '.bubble:not(.webpage) ';\n      selectors = selectors.map((s) => prefix + s);\n    }\n\n    const selector = selectors.join(', ');\n\n    const elements = Array.from(container.querySelectorAll(selector)) as HTMLElement[];\n    const idx = elements.indexOf(anchor);\n\n    const mediaItems: MediaItem[] = elements.map((element) => ({peerId: element.dataset.peerId.toPeerId(), mid: +element.dataset.mid}));\n\n    prev = mediaItems.slice(0, idx);\n    next = mediaItems.slice(idx + 1);\n  }\n  // }\n\n  if((next.length && next[0].mid < anchorMid) || (prev.length && prev[prev.length - 1].mid > anchorMid)) {\n    [prev, next] = [next.reverse(), prev.reverse()];\n  }\n\n  // prev = next = undefined;\n\n  return [prev, next];\n};\n\nexport default class AudioElement extends HTMLElement {\n  public audio: HTMLAudioElement;\n  public preloader: ProgressivePreloader;\n  public message: Message.message;\n  public withTime = false;\n  public voiceAsMusic = false;\n  public searchContext: MediaSearchContext;\n  public showSender = false;\n  public noAutoDownload: boolean;\n  public lazyLoadQueue: LazyLoadQueue;\n  public loadPromises: Promise<any>[];\n  public managers: AppManagers;\n\n  private listenerSetter = new ListenerSetter();\n  private onTypeDisconnect: () => void;\n  public onLoad: (autoload?: boolean) => void;\n  public readyPromise: CancellablePromise<void>;\n\n  public async render() {\n    this.classList.add('audio');\n    this.managers = rootScope.managers;\n\n    this.dataset.mid = '' + this.message.mid;\n    this.dataset.peerId = '' + this.message.peerId;\n\n    const doc = getMediaFromMessage(this.message) as MyDocument;\n    const isRealVoice = doc.type === 'voice';\n    const isVoice = !this.voiceAsMusic && isRealVoice;\n    const isOutgoing = this.message.pFlags.is_outgoing;\n    const uploadingFileName = this.message?.uploadingFileName;\n\n    const durationStr = toHHMMSS(doc.duration | 0);\n\n    this.innerHTML = `\n    <div class=\"audio-toggle audio-ico\">\n      <div class=\"audio-play-icon\">\n        <div class=\"part one\" x=\"0\" y=\"0\" fill=\"#fff\"></div>\n        <div class=\"part two\" x=\"0\" y=\"0\" fill=\"#fff\"></div>\n      </div>\n    </div>`;\n\n    const toggle = this.firstElementChild as HTMLElement;\n\n    const downloadDiv = document.createElement('div');\n    downloadDiv.classList.add('audio-download');\n\n    const isUnread = doc.type !== 'audio' && this.message && this.message.pFlags.media_unread;\n    if(isUnread) {\n      this.classList.add('is-unread');\n    }\n\n    if(uploadingFileName) {\n      this.classList.add('is-outgoing');\n      this.append(downloadDiv);\n    }\n\n    const onTypeLoad = await (isVoice ? wrapVoiceMessage(this) : wrapAudio(this));\n\n    const audioTimeDiv = this.querySelector('.audio-time') as HTMLDivElement;\n    audioTimeDiv.innerHTML = durationStr;\n\n    const onLoad = this.onLoad = (autoload: boolean) => {\n      this.onLoad = undefined;\n\n      const audio = this.audio = appMediaPlaybackController.addMedia(this.message, autoload);\n\n      const readyPromise = this.readyPromise = deferredPromise<void>();\n      if(this.audio.readyState >= this.audio.HAVE_CURRENT_DATA) readyPromise.resolve();\n      else {\n        this.addAudioListener('canplay', () => readyPromise.resolve(), {once: true});\n      }\n\n      this.onTypeDisconnect = onTypeLoad();\n\n      const getTimeStr = () => toHHMMSS(audio.currentTime | 0) + (isVoice ? (' / ' + durationStr) : '');\n\n      const onPlay = () => {\n        audioTimeDiv.innerText = getTimeStr();\n        toggle.classList.toggle('playing', !audio.paused);\n      };\n\n      if(!audio.paused || (audio.currentTime > 0 && audio.currentTime !== audio.duration)) {\n        onPlay();\n      }\n\n      const togglePlay = (e?: Event, paused = audio.paused) => {\n        e && cancelEvent(e);\n\n        if(paused) {\n          const hadSearchContext = !!this.searchContext;\n          if(appMediaPlaybackController.setSearchContext(this.searchContext || {\n            peerId: NULL_PEER_ID,\n            inputFilter: {_: 'inputMessagesFilterEmpty'},\n            useSearch: false\n          })) {\n            const [prev, next] = !hadSearchContext ? [] : findMediaTargets(this, this.message.mid/* , this.searchContext.useSearch */);\n            appMediaPlaybackController.setTargets({peerId: this.message.peerId, mid: this.message.mid}, prev, next);\n          }\n\n          audio.play().catch(() => {});\n        } else {\n          audio.pause();\n        }\n      };\n\n      attachClickEvent(toggle, (e) => togglePlay(e), {listenerSetter: this.listenerSetter});\n\n      this.addAudioListener('ended', () => {\n        toggle.classList.remove('playing');\n        audioTimeDiv.innerText = durationStr;\n      });\n\n      this.addAudioListener('timeupdate', () => {\n        if((!audio.currentTime && audio.paused) || appMediaPlaybackController.isSafariBuffering(audio)) return;\n        audioTimeDiv.innerText = getTimeStr();\n      });\n\n      this.addAudioListener('pause', () => {\n        toggle.classList.remove('playing');\n      });\n\n      this.addAudioListener('play', onPlay);\n\n      return togglePlay;\n    };\n\n    if(doc.thumbs?.length) {\n      const imgs: HTMLElement[] = [];\n      const wrapped = await wrapPhoto({\n        photo: doc,\n        message: null,\n        container: toggle,\n        boxWidth: 48,\n        boxHeight: 48,\n        loadPromises: this.loadPromises,\n        withoutPreloader: true,\n        lazyLoadQueue: this.lazyLoadQueue\n      });\n      toggle.style.width = toggle.style.height = '';\n      if(wrapped.images.thumb) imgs.push(wrapped.images.thumb);\n      if(wrapped.images.full) imgs.push(wrapped.images.full);\n\n      this.classList.add('audio-with-thumb');\n      imgs.forEach((img) => img.classList.add('audio-thumb'));\n    }\n\n    if(!isOutgoing) {\n      let preloader: ProgressivePreloader = this.preloader;\n\n      const autoDownload = doc.type !== 'audio'/*  || !this.noAutoDownload */;\n      onLoad(autoDownload);\n\n      const r = (shouldPlay: boolean) => {\n        if(this.audio.src) {\n          return;\n        }\n\n        appMediaPlaybackController.resolveWaitingForLoadMedia(this.message.peerId, this.message.mid, this.message.pFlags.is_scheduled);\n\n        const onDownloadInit = () => {\n          if(shouldPlay) {\n            appMediaPlaybackController.willBePlayed(this.audio); // prepare for loading audio\n\n            if(IS_SAFARI && !this.audio.autoplay) {\n              this.audio.autoplay = true;\n            }\n          }\n        };\n\n        onDownloadInit();\n\n        if(!preloader) {\n          if(doc.supportsStreaming) {\n            this.classList.add('corner-download');\n\n            let pauseListener: Listener;\n            const onPlay = () => {\n              const preloader = constructDownloadPreloader(false);\n              const deferred = deferredPromise<void>();\n              deferred.notifyAll({done: 75, total: 100});\n              deferred.catch(() => {\n                this.audio.pause();\n                appMediaPlaybackController.willBePlayed(undefined);\n              });\n              deferred.cancel = () => {\n                deferred.cancel = noop;\n                const err = new Error();\n                (err as any).type = 'CANCELED';\n                deferred.reject(err);\n              };\n              preloader.attach(downloadDiv, false, deferred);\n\n              pauseListener = this.addAudioListener('pause', () => {\n                deferred.cancel();\n              }, {once: true}) as any;\n\n              onDownloadInit();\n            };\n\n            /* if(!this.audio.paused) {\n              onPlay();\n            } */\n\n            const playListener: any = this.addAudioListener('play', onPlay);\n            this.readyPromise.then(() => {\n              this.listenerSetter.remove(playListener);\n              this.listenerSetter.remove(pauseListener);\n            });\n          } else {\n            preloader = constructDownloadPreloader();\n\n            if(!shouldPlay) {\n              this.readyPromise = deferredPromise();\n            }\n\n            const load = () => {\n              onDownloadInit();\n\n              const download = appDownloadManager.downloadMediaURL({media: doc});\n\n              if(!shouldPlay) {\n                download.then(() => {\n                  this.readyPromise.resolve();\n                });\n              }\n\n              preloader.attach(downloadDiv, false, download);\n              return {download};\n            };\n\n            preloader.setDownloadFunction(load);\n            load();\n          }\n        }\n\n        if(this.classList.contains('corner-download')) {\n          toggle.append(downloadDiv);\n        } else {\n          this.append(downloadDiv);\n        }\n\n        this.classList.add('downloading');\n\n        this.readyPromise.then(() => {\n          this.classList.remove('downloading');\n          downloadDiv.classList.add('downloaded');\n          setTimeout(() => {\n            downloadDiv.remove();\n          }, 200);\n\n          // setTimeout(() => {\n          // release loaded audio\n          if(appMediaPlaybackController.willBePlayedMedia === this.audio) {\n            this.audio.play();\n            appMediaPlaybackController.willBePlayed(undefined);\n          }\n          // }, 10e3);\n        });\n      };\n\n      if(!this.audio?.src) {\n        if(autoDownload) {\n          r(false);\n        } else {\n          attachClickEvent(toggle, () => {\n            r(true);\n          }, {once: true, capture: true, passive: false, listenerSetter: this.listenerSetter});\n        }\n      }\n    } else if(uploadingFileName) {\n      this.preloader = constructDownloadPreloader(false);\n      this.preloader.attachPromise(appDownloadManager.getUpload(uploadingFileName));\n      this.dataset.isOutgoing = '1';\n      this.preloader.attach(downloadDiv, false);\n      // onLoad();\n    }\n  }\n\n  get addAudioListener() {\n    return this.listenerSetter.add(this.audio);\n  }\n\n  disconnectedCallback() {\n    setTimeout(() => {\n      if(this.isConnected) {\n        return;\n      }\n\n      if(this.onTypeDisconnect) {\n        this.onTypeDisconnect();\n        this.onTypeDisconnect = null;\n      }\n\n      if(this.readyPromise) {\n        this.readyPromise.reject();\n      }\n\n      if(this.listenerSetter) {\n        this.listenerSetter.removeAll();\n        this.listenerSetter = null;\n      }\n\n      if(this.preloader) {\n        this.preloader = null;\n      }\n    }, 100);\n  }\n}\n\ncustomElements.define('audio-element', AudioElement);\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport {Photo} from '../layer';\nimport {AppManagers} from '../lib/appManagers/managers';\nimport ListLoader, {ListLoaderOptions} from './listLoader';\n\nexport default class AvatarListLoader<Item extends {photoId: Photo.photo['id']}> extends ListLoader<Item, any> {\n  private peerId: PeerId;\n  private managers: AppManagers;\n\n  constructor(options: Omit<ListLoaderOptions<Item, any>, 'loadMore'> & {peerId: PeerId, managers: AppManagers}) {\n    super({\n      ...options,\n      loadMore: (anchor, older, loadCount) => {\n        if(this.peerId.isAnyChat() || !older) return Promise.resolve({count: 0, items: []}); // !  ,    ,    .\n\n        const maxId = anchor?.photoId;\n        return this.managers.appPhotosManager.getUserPhotos(this.peerId, maxId, loadCount).then((value) => {\n          const items = value.photos.map((photoId) => {\n            return {element: null as HTMLElement, photoId} as any;\n          });\n\n          return {count: value.count, items};\n        });\n      }\n    });\n\n    this.loadedAllUp = true;\n    this.peerId = options.peerId;\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport AvatarListLoader from '../helpers/avatarListLoader';\nimport {Photo} from '../layer';\nimport appDownloadManager from '../lib/appManagers/appDownloadManager';\nimport appImManager from '../lib/appManagers/appImManager';\nimport rootScope from '../lib/rootScope';\nimport AppMediaViewerBase from './appMediaViewerBase';\n\ntype AppMediaViewerAvatarTargetType = {element: HTMLElement, photoId: Photo.photo['id']};\nexport default class AppMediaViewerAvatar extends AppMediaViewerBase<'', 'delete', AppMediaViewerAvatarTargetType> {\n  public peerId: PeerId;\n\n  constructor(peerId: PeerId) {\n    super(new AvatarListLoader({peerId, managers: rootScope.managers}), [/* 'delete' */]);\n\n    this.peerId = peerId;\n\n    this.setBtnMenuToggle([{\n      icon: 'download',\n      text: 'MediaViewer.Context.Download',\n      onClick: this.onDownloadClick\n    }/* , {\n      icon: 'delete danger btn-disabled',\n      text: 'Delete',\n      onClick: () => {}\n    } */]);\n\n    // * constructing html end\n\n    this.setListeners();\n  }\n\n  onPrevClick = (target: AppMediaViewerAvatarTargetType) => {\n    this.openMedia(target.photoId, target.element, -1);\n  };\n\n  onNextClick = (target: AppMediaViewerAvatarTargetType) => {\n    this.openMedia(target.photoId, target.element, 1);\n  };\n\n  onDownloadClick = async() => {\n    appDownloadManager.downloadToDisc({\n      media: await this.managers.appPhotosManager.getPhoto(this.target.photoId),\n      queueId: appImManager.chat.bubbles.lazyLoadQueue.queueId\n    });\n  };\n\n  public async openMedia(photoId: Photo.photo['id'], target?: HTMLElement, fromRight = 0, prevTargets?: AppMediaViewerAvatarTargetType[], nextTargets?: AppMediaViewerAvatarTargetType[]) {\n    if(this.setMoverPromise) return this.setMoverPromise;\n\n    const photo = await this.managers.appPhotosManager.getPhoto(photoId);\n    const ret = super._openMedia(photo, photo.date, this.peerId, fromRight, target, false, prevTargets, nextTargets);\n    this.target.photoId = photo.id;\n\n    return ret;\n  }\n}\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport rootScope from '../lib/rootScope';\r\nimport {Message, Photo} from '../layer';\r\nimport type LazyLoadQueue from './lazyLoadQueue';\r\nimport {attachClickEvent} from '../helpers/dom/clickEvent';\r\nimport cancelEvent from '../helpers/dom/cancelEvent';\r\nimport AppMediaViewer from './appMediaViewer';\r\nimport AppMediaViewerAvatar from './appMediaViewerAvatar';\r\nimport isObject from '../helpers/object/isObject';\r\nimport {ArgumentTypes} from '../types';\r\nimport putPhoto from './putPhoto';\r\nimport {recordPromise} from '../helpers/recordPromise';\r\n\r\nconst onAvatarUpdate = (peerId: PeerId) => {\r\n  (Array.from(document.querySelectorAll('avatar-element[data-peer-id=\"' + peerId + '\"]')) as AvatarElement[]).forEach((elem) => {\r\n    // console.log('updating avatar:', elem);\r\n    elem.update();\r\n  });\r\n};\r\n\r\nrootScope.addEventListener('avatar_update', onAvatarUpdate);\r\nrootScope.addEventListener('peer_title_edit', async(peerId) => {\r\n  if(!(await rootScope.managers.appAvatarsManager.isAvatarCached(peerId))) {\r\n    onAvatarUpdate(peerId);\r\n  }\r\n});\r\n\r\nexport async function openAvatarViewer(\r\n  target: HTMLElement,\r\n  peerId: PeerId,\r\n  middleware: () => boolean,\r\n  message?: any,\r\n  prevTargets?: {element: HTMLElement, item: Photo.photo['id'] | Message.messageService}[],\r\n  nextTargets?: typeof prevTargets\r\n) {\r\n  let photo = await rootScope.managers.appProfileManager.getFullPhoto(peerId);\r\n  if(!middleware() || !photo) {\r\n    return;\r\n  }\r\n\r\n  const getTarget = () => {\r\n    const good = Array.from(target.querySelectorAll('img')).find((img) => !img.classList.contains('emoji'));\r\n    return good ? target : null;\r\n  };\r\n\r\n  if(peerId.isAnyChat()) {\r\n    const hadMessage = !!message;\r\n    const inputFilter = 'inputMessagesFilterChatPhotos';\r\n    if(!message) {\r\n      message = await rootScope.managers.appMessagesManager.getSearch({\r\n        peerId,\r\n        inputFilter: {_: inputFilter},\r\n        maxId: 0,\r\n        limit: 1\r\n      }).then((value) => {\r\n        // console.log(lol);\r\n        // ! by descend\r\n        return value.history[0];\r\n      });\r\n\r\n      if(!middleware()) {\r\n        return;\r\n      }\r\n    }\r\n\r\n    if(message) {\r\n      // !   ,  (  )\r\n      const messagePhoto = message.action.photo;\r\n      if(messagePhoto.id !== photo.id) {\r\n        if(!hadMessage) {\r\n          message = rootScope.managers.appMessagesManager.generateFakeAvatarMessage(peerId, photo);\r\n        } else {\r\n\r\n        }\r\n      }\r\n\r\n      const f = (arr: typeof prevTargets) => arr.map((el) => ({\r\n        element: el.element,\r\n        mid: (el.item as Message.messageService).mid,\r\n        peerId: (el.item as Message.messageService).peerId\r\n      }));\r\n\r\n      new AppMediaViewer()\r\n      .setSearchContext({\r\n        peerId,\r\n        inputFilter: {_: inputFilter}\r\n      })\r\n      .openMedia(message, getTarget(), undefined, undefined, prevTargets ? f(prevTargets) : undefined, nextTargets ? f(nextTargets) : undefined);\r\n\r\n      return;\r\n    }\r\n  }\r\n\r\n  if(photo) {\r\n    if(!isObject(message) && message) {\r\n      photo = await rootScope.managers.appPhotosManager.getPhoto(message);\r\n    }\r\n\r\n    const f = (arr: typeof prevTargets) => arr.map((el) => ({\r\n      element: el.element,\r\n      photoId: el.item as string\r\n    }));\r\n\r\n    new AppMediaViewerAvatar(peerId).openMedia(\r\n      photo.id,\r\n      getTarget(),\r\n      undefined,\r\n      prevTargets ? f(prevTargets) : undefined,\r\n      nextTargets ? f(nextTargets) : undefined\r\n    );\r\n  }\r\n}\r\n\r\nconst believeMe: Map<PeerId, Set<AvatarElement>> = new Map();\r\nconst seen: Set<PeerId> = new Set();\r\n\r\nexport default class AvatarElement extends HTMLElement {\r\n  public peerId: PeerId;\r\n  public isDialog: boolean;\r\n  public peerTitle: string;\r\n  public loadPromises: Promise<any>[];\r\n  public lazyLoadQueue: LazyLoadQueue;\r\n  public isBig: boolean;\r\n  private addedToQueue = false;\r\n\r\n  disconnectedCallback() {\r\n    //         \r\n    // (   ,    /)\r\n    const set = believeMe.get(this.peerId);\r\n    if(set && set.has(this)) {\r\n      set.delete(this);\r\n      if(!set.size) {\r\n        believeMe.delete(this.peerId);\r\n      }\r\n    }\r\n\r\n    if(this.lazyLoadQueue) {\r\n      this.lazyLoadQueue.unobserve(this);\r\n    }\r\n  }\r\n\r\n  public attachClickEvent() {\r\n    let loading = false;\r\n    attachClickEvent(this, async(e) => {\r\n      cancelEvent(e);\r\n      if(loading) return;\r\n      // console.log('avatar clicked');\r\n      const peerId = this.peerId;\r\n      loading = true;\r\n      await openAvatarViewer(this, this.peerId, () => this.peerId === peerId);\r\n      loading = false;\r\n    });\r\n  }\r\n\r\n  public updateOptions(options: Partial<ArgumentTypes<AvatarElement['updateWithOptions']>[0]>) {\r\n    for(const i in options) {\r\n      // @ts-ignore\r\n      this[i] = options[i];\r\n    }\r\n  }\r\n\r\n  public updateWithOptions(options: {\r\n    peerId: PeerId,\r\n    isDialog?: boolean,\r\n    isBig?: boolean,\r\n    peerTitle?: string,\r\n    lazyLoadQueue?: LazyLoadQueue,\r\n    loadPromises?: Promise<any>[]\r\n  }) {\r\n    const wasPeerId = this.peerId;\r\n    this.updateOptions(options);\r\n    const newPeerId = this.peerId;\r\n\r\n    if(wasPeerId === newPeerId) {\r\n      return;\r\n    }\r\n\r\n    this.peerId = /* rootScope.managers.appPeersManager.getPeerMigratedTo(newPeerId) ||  */newPeerId;\r\n    this.dataset.peerId = '' + newPeerId;\r\n\r\n    if(wasPeerId) {\r\n      const set = believeMe.get(wasPeerId);\r\n      if(set) {\r\n        set.delete(this);\r\n        if(!set.size) {\r\n          believeMe.delete(wasPeerId);\r\n        }\r\n      }\r\n    }\r\n\r\n    return this.update();\r\n  }\r\n\r\n  private r(onlyThumb = false) {\r\n    const promise = putPhoto(this, this.peerId, this.isDialog, this.peerTitle, onlyThumb, this.isBig);\r\n    // recordPromise(promise, 'avatar putPhoto-' + this.peerId);\r\n\r\n    if(this.loadPromises) {\r\n      this.loadPromises.push(promise);\r\n\r\n      promise.finally(() => {\r\n        this.loadPromises = undefined;\r\n      });\r\n    }\r\n\r\n    return promise;\r\n  }\r\n\r\n  public update() {\r\n    if(this.lazyLoadQueue) {\r\n      if(!seen.has(this.peerId)) {\r\n        if(this.addedToQueue) return;\r\n        this.addedToQueue = true;\r\n\r\n        let set = believeMe.get(this.peerId);\r\n        if(!set) {\r\n          set = new Set();\r\n          believeMe.set(this.peerId, set);\r\n        }\r\n\r\n        set.add(this);\r\n\r\n        this.lazyLoadQueue.push({\r\n          div: this,\r\n          load: () => {\r\n            seen.add(this.peerId);\r\n            return this.update();\r\n          }\r\n        });\r\n\r\n        return this.r(true);\r\n      } else if(this.addedToQueue) {\r\n        this.lazyLoadQueue.unobserve(this);\r\n      }\r\n    }\r\n\r\n    seen.add(this.peerId);\r\n\r\n    const promise = this.r();\r\n\r\n    if(this.addedToQueue) {\r\n      promise.finally(() => {\r\n        this.addedToQueue = false;\r\n      });\r\n    }\r\n\r\n    const set = believeMe.get(this.peerId);\r\n    if(set) {\r\n      set.delete(this);\r\n      const arr = Array.from(set);\r\n      believeMe.delete(this.peerId);\r\n\r\n\r\n      for(let i = 0, length = arr.length; i < length; ++i) {\r\n        arr[i].update();\r\n      }\r\n    }\r\n\r\n    return promise;\r\n  }\r\n}\r\n\r\ncustomElements.define('avatar-element', AvatarElement);\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport type {CancellablePromise} from '../helpers/cancellablePromise';\r\nimport type {InputFile} from '../layer';\r\nimport {attachClickEvent} from '../helpers/dom/clickEvent';\r\nimport PopupElement from './popups';\r\nimport PopupAvatar from './popups/avatar';\r\n\r\nexport default class AvatarEdit {\r\n  public container: HTMLElement;\r\n  private canvas: HTMLCanvasElement;\r\n  private icon: HTMLSpanElement;\r\n\r\n  constructor(onChange: (uploadAvatar: () => CancellablePromise<InputFile>) => void) {\r\n    this.container = document.createElement('div');\r\n    this.container.classList.add('avatar-edit');\r\n\r\n    this.canvas = document.createElement('canvas');\r\n    this.canvas.classList.add('avatar-edit-canvas');\r\n\r\n    this.icon = document.createElement('span');\r\n    this.icon.classList.add('tgico', 'tgico-cameraadd');\r\n\r\n    this.container.append(this.canvas, this.icon);\r\n\r\n    attachClickEvent(this.container, () => {\r\n      PopupElement.createPopup(PopupAvatar).open(this.canvas, onChange);\r\n    });\r\n  }\r\n\r\n  public clear() {\r\n    const ctx = this.canvas.getContext('2d');\r\n    ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);\r\n  }\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport {i18n, LangPackKey} from '../lib/langPack';\r\nimport ripple from './ripple';\r\n\r\nexport type ButtonOptions = Partial<{\r\n  noRipple: true,\r\n  onlyMobile: true,\r\n  icon: string,\r\n  rippleSquare: true,\r\n  text: LangPackKey,\r\n  disabled: boolean,\r\n  asDiv: boolean\r\n}>;\r\n\r\nconst Button = (className: string, options: ButtonOptions = {}) => {\r\n  const button: HTMLButtonElement = document.createElement(options.asDiv ? 'div' : 'button') as any;\r\n  button.className = className + (options.icon ? ' tgico-' + options.icon : '');\r\n\r\n  if(!options.noRipple) {\r\n    if(options.rippleSquare) {\r\n      button.classList.add('rp-square');\r\n    }\r\n\r\n    ripple(button);\r\n  }\r\n\r\n  if(options.onlyMobile) {\r\n    button.classList.add('only-handhelds');\r\n  }\r\n\r\n  if(options.disabled) {\r\n    button.setAttribute('disabled', 'true');\r\n  }\r\n\r\n  if(options.text) {\r\n    button.append(i18n(options.text));\r\n  }\r\n\r\n  return button;\r\n};\r\n\r\nexport default Button;\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport Button from './button';\r\n\r\nconst ButtonCorner = (options: Partial<{className: string, icon: string, noRipple: true, onlyMobile: true, asDiv: boolean}> = {}) => {\r\n  const button = Button('btn-circle btn-corner z-depth-1' + (options.className ? ' ' + options.className : ''), options);\r\n  return button;\r\n};\r\n\r\nexport default ButtonCorner;\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport Button from './button';\r\n\r\nconst ButtonIcon = (className?: string, options: Partial<{noRipple: true, onlyMobile: true, asDiv: boolean}> = {}) => {\r\n  const button = Button('btn-icon', {\r\n    icon: className || undefined,\r\n    ...options\r\n  });\r\n\r\n  return button;\r\n};\r\n\r\nexport default ButtonIcon;\r\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport contextMenuController from '../helpers/contextMenuController';\nimport cancelEvent from '../helpers/dom/cancelEvent';\nimport {AttachClickOptions, attachClickEvent} from '../helpers/dom/clickEvent';\nimport findUpClassName from '../helpers/dom/findUpClassName';\nimport ListenerSetter from '../helpers/listenerSetter';\nimport {FormatterArguments, i18n, LangPackKey} from '../lib/langPack';\nimport CheckboxField from './checkboxField';\n\nexport type ButtonMenuItemOptions = {\n  icon?: string,\n  text?: LangPackKey,\n  textArgs?: FormatterArguments,\n  regularText?: string,\n  onClick: (e: MouseEvent | TouchEvent) => void | boolean | any,\n  element?: HTMLElement,\n  textElement?: HTMLElement,\n  options?: AttachClickOptions,\n  checkboxField?: CheckboxField,\n  noCheckboxClickListener?: boolean,\n  keepOpen?: boolean\n  /* , cancelEvent?: true */\n};\n\nconst ButtonMenuItem = (options: ButtonMenuItemOptions) => {\n  if(options.element) return options.element;\n\n  const {icon, text, onClick, checkboxField, noCheckboxClickListener} = options;\n  const el = document.createElement('div');\n  el.className = 'btn-menu-item rp-overflow' + (icon ? ' tgico-' + icon : '');\n  // ripple(el);\n\n  let textElement = options.textElement;\n  if(!textElement) {\n    textElement = options.textElement = text ? i18n(text, options.textArgs) : document.createElement('span');\n    if(options.regularText) textElement.innerHTML = options.regularText;\n  }\n\n  textElement.classList.add('btn-menu-item-text');\n  el.append(textElement);\n\n  const keepOpen = !!checkboxField || !!options.keepOpen;\n\n  // * cancel mobile keyboard close\n  onClick && attachClickEvent(el, /* CLICK_EVENT_NAME !== 'click' || keepOpen ? */ (e) => {\n    cancelEvent(e);\n\n    const menu = findUpClassName(e.target, 'btn-menu');\n    if(menu && !menu.classList.contains('active')) {\n      return;\n    }\n\n    const result = onClick(e);\n\n    if(result === false) {\n      return;\n    }\n\n    if(!keepOpen) {\n      contextMenuController.close();\n    }\n\n    if(checkboxField && !noCheckboxClickListener/*  && result !== false */) {\n      checkboxField.checked = checkboxField.input.type === 'radio' ? true : !checkboxField.checked;\n    }\n  }/*  : onClick */, options.options);\n\n  if(checkboxField) {\n    el.append(checkboxField.label);\n  }\n\n  return options.element = el;\n};\n\nconst ButtonMenu = (buttons: ButtonMenuItemOptions[], listenerSetter?: ListenerSetter) => {\n  const el = document.createElement('div');\n  el.classList.add('btn-menu');\n\n  if(listenerSetter) {\n    buttons.forEach((b) => {\n      if(b.options) {\n        b.options.listenerSetter = listenerSetter;\n      } else {\n        b.options = {listenerSetter};\n      }\n    });\n  }\n\n  const items = buttons.map(ButtonMenuItem);\n\n  el.append(...items);\n\n  return el;\n};\n\nexport default ButtonMenu;\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport contextMenuController from '../helpers/contextMenuController';\r\nimport cancelEvent from '../helpers/dom/cancelEvent';\r\nimport {AttachClickOptions, CLICK_EVENT_NAME} from '../helpers/dom/clickEvent';\r\nimport ListenerSetter from '../helpers/listenerSetter';\r\nimport ButtonIcon from './buttonIcon';\r\nimport ButtonMenu, {ButtonMenuItemOptions} from './buttonMenu';\r\n\r\nconst ButtonMenuToggle = (\r\n  options: Partial<{\r\n    noRipple: true,\r\n    onlyMobile: true,\r\n    listenerSetter: ListenerSetter,\r\n    asDiv: boolean,\r\n    container: HTMLElement\r\n  }> = {},\r\n  direction: 'bottom-left' | 'bottom-right' | 'top-left' | 'top-right',\r\n  buttons: ButtonMenuItemOptions[],\r\n  onOpen?: (e: Event) => void,\r\n  onClose?: () => void\r\n) => {\r\n  options.asDiv = true;\r\n  const button = options.container ?? ButtonIcon('more', options);\r\n  button.classList.add('btn-menu-toggle');\r\n\r\n  const btnMenu = ButtonMenu(buttons, options.listenerSetter);\r\n  btnMenu.classList.add(direction);\r\n  ButtonMenuToggleHandler(button, onOpen, options, onClose);\r\n  button.append(btnMenu);\r\n  return button;\r\n};\r\n\r\n// TODO: refactor for attachClickEvent, because if move finger after touchstart, it will start anyway\r\nconst ButtonMenuToggleHandler = (el: HTMLElement, onOpen?: (e: Event) => void | Promise<any>, options?: AttachClickOptions, onClose?: () => void) => {\r\n  const add = options?.listenerSetter ? options.listenerSetter.add(el) : el.addEventListener.bind(el);\r\n\r\n  // console.trace('ButtonMenuToggleHandler attach', el, onOpen, options);\r\n  add(CLICK_EVENT_NAME, (e: Event) => {\r\n    // console.log('ButtonMenuToggleHandler click', e);\r\n    if(!el.classList.contains('btn-menu-toggle')) return false;\r\n\r\n    // window.removeEventListener('mousemove', onMouseMove);\r\n    const openedMenu = el.querySelector('.btn-menu') as HTMLDivElement;\r\n    cancelEvent(e);\r\n\r\n    if(el.classList.contains('menu-open')) {\r\n      contextMenuController.close();\r\n    } else {\r\n      const result = onOpen && onOpen(e);\r\n      const open = () => {\r\n        contextMenuController.openBtnMenu(openedMenu, onClose);\r\n      };\r\n\r\n      if(result instanceof Promise) {\r\n        result.then(open);\r\n      } else {\r\n        open();\r\n      }\r\n    }\r\n  });\r\n};\r\n\r\nexport {ButtonMenuToggleHandler};\r\nexport default ButtonMenuToggle;\r\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko, Artem Kolnogorov and unknown creator of the script taken from http://useless.altervista.org/gradient.html\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport {animate} from '../../helpers/animation';\nimport {hexToRgb} from '../../helpers/color';\n\nconst WIDTH = 50;\nconst HEIGHT = WIDTH;\n\nexport default class ChatBackgroundGradientRenderer {\n  private readonly _width = WIDTH;\n  private readonly _height = HEIGHT;\n  private _phase: number;\n  private _tail: number;\n  private readonly _tails = 90;\n  private readonly _scrollTails = 50;\n  private _frames: ImageData[];\n  private _colors: {r: number, g: number, b: number}[];\n  /* private readonly _curve = [\n    0, 25, 50, 75, 100, 150, 200, 250, 300, 350, 400, 500, 600, 700, 800, 900,\n    1000, 1100, 1200, 1300, 1400, 1500, 1600, 1700, 1800, 1830, 1860, 1890, 1920,\n    1950, 1980, 2010, 2040, 2070, 2100, 2130, 2160, 2190, 2220, 2250, 2280, 2310,\n    2340, 2370, 2400, 2430, 2460, 2490, 2520, 2550, 2580, 2610, 2630, 2640, 2650,\n    2660, 2670, 2680, 2690, 2700\n  ]; */\n  private readonly _curve = [\n    0, 0.25, 0.50, 0.75, 1, 1.5, 2, 2.5, 3, 3.5, 4, 5, 6, 7, 8, 9, 10, 11, 12,\n    13, 14, 15, 16, 17, 18, 18.3, 18.6, 18.9, 19.2, 19.5, 19.8, 20.1, 20.4, 20.7,\n    21.0, 21.3, 21.6, 21.9, 22.2, 22.5, 22.8, 23.1, 23.4, 23.7, 24.0, 24.3, 24.6,\n    24.9, 25.2, 25.5, 25.8, 26.1, 26.3, 26.4, 26.5, 26.6, 26.7, 26.8, 26.9, 27\n  ];\n  private readonly _incrementalCurve: number[];\n  private readonly _positions = [\n    {x: 0.80, y: 0.10},\n    {x: 0.60, y: 0.20},\n    {x: 0.35, y: 0.25},\n    {x: 0.25, y: 0.60},\n    {x: 0.20, y: 0.90},\n    {x: 0.40, y: 0.80},\n    {x: 0.65, y: 0.75},\n    {x: 0.75, y: 0.40}\n  ];\n  private readonly _phases = this._positions.length;\n  private _onWheelRAF: number;\n  private _scrollDelta: number;\n\n  // private _ts = 0;\n  // private _fps = 15;\n  // private _frametime = 1000 / this._fps;\n  // private _raf: number;\n\n  private _canvas: HTMLCanvasElement;\n  private _ctx: CanvasRenderingContext2D;\n  private _hc: HTMLCanvasElement;\n  private _hctx: CanvasRenderingContext2D;\n\n  private _addedScrollListener: boolean;\n  private _animatingToNextPosition: boolean;\n\n  constructor() {\n    const diff = this._tails / this._curve[this._curve.length - 1];\n\n    for(let i = 0, length = this._curve.length; i < length; ++i) {\n      this._curve[i] = this._curve[i] * diff;\n    }\n\n    this._incrementalCurve = this._curve.map((v, i, arr) => {\n      return v - (arr[i - 1] ?? 0);\n    });\n  }\n\n  private hexToRgb(hex: string) {\n    const result = hexToRgb(hex);\n    return {r: result[0], g: result[1], b: result[2]};\n  }\n\n  private getPositions(shift: number) {\n    const positions = this._positions.slice();\n    while(shift > 0) {\n      positions.push(positions.shift());\n      --shift;\n    }\n\n    const result: typeof positions = [];\n    for(let i = 0; i < positions.length; i += 2) {\n      result.push(positions[i]);\n    }\n    return result;\n  }\n\n  private getNextPositions(phase: number, curveMax: number, curve: number[]) {\n    const pos = this.getPositions(phase);\n    if(!curve[0] && curve.length === 1) {\n      return [pos];\n    }\n\n    const nextPos = this.getPositions(++phase % this._phases);\n    const distances = nextPos.map((nextPos, idx) => {\n      return {\n        x: (nextPos.x - pos[idx].x) / curveMax,\n        y: (nextPos.y - pos[idx].y) / curveMax\n      };\n    });\n\n    const positions = curve.map((value) => {\n      return distances.map((distance, idx) => {\n        return {\n          x: pos[idx].x + distance.x * value,\n          y: pos[idx].y + distance.y * value\n        };\n      });\n    });\n\n    return positions;\n  }\n\n  private curPosition(phase: number, tail: number) {\n    const positions = this.getNextPositions(phase, this._tails, [tail]);\n    return positions[0];\n  }\n\n  private changeTail(diff: number) {\n    this._tail += diff;\n\n    while(this._tail >= this._tails) {\n      this._tail -= this._tails;\n      if(++this._phase >= this._phases) {\n        this._phase -= this._phases;\n      }\n    }\n\n    while(this._tail < 0) {\n      this._tail += this._tails;\n      if(--this._phase < 0) {\n        this._phase += this._phases;\n      }\n    }\n  }\n\n  private onWheel = (e: {deltaY: number}) => {\n    if(this._animatingToNextPosition) {\n      return;\n    }\n\n    this._scrollDelta += e.deltaY;\n    if(this._onWheelRAF === undefined) {\n      this._onWheelRAF = requestAnimationFrame(this.drawOnWheel);\n    }\n  };\n\n  private drawOnWheel = () => {\n    let diff = this._scrollDelta / this._scrollTails;\n    this._scrollDelta %= this._scrollTails;\n    diff = diff > 0 ? Math.floor(diff) : Math.ceil(diff);\n    if(diff) {\n      this.changeTail(diff);\n      const curPos = this.curPosition(this._phase, this._tail);\n      this.drawGradient(curPos);\n    }\n    this._onWheelRAF = undefined;\n  };\n\n  private drawNextPositionAnimated = () => {\n    const frames = this._frames;\n    const id = frames.shift();\n    if(id) {\n      this.drawImageData(id);\n    }\n\n    const leftLength = frames.length;\n    if(!leftLength) {\n      this._animatingToNextPosition = undefined;\n    }\n\n    return !!leftLength;\n  };\n\n  private getGradientImageData(positions: {x: number, y: number}[]) {\n    const id = this._hctx.createImageData(this._width, this._height);\n    const pixels = id.data;\n\n    let offset = 0;\n    for(let y = 0; y < this._height; ++y) {\n      const directPixelY = y / this._height;\n      const centerDistanceY = directPixelY - 0.5;\n      const centerDistanceY2 = centerDistanceY * centerDistanceY;\n\n      for(let x = 0; x < this._width; ++x) {\n        const directPixelX = x / this._width;\n\n        const centerDistanceX = directPixelX - 0.5;\n        const centerDistance = Math.sqrt(centerDistanceX * centerDistanceX + centerDistanceY2);\n\n        const swirlFactor = 0.35 * centerDistance;\n        const theta = swirlFactor * swirlFactor * 0.8 * 8.0;\n        const sinTheta = Math.sin(theta);\n        const cosTheta = Math.cos(theta);\n\n        const pixelX = Math.max(0.0, Math.min(1.0, 0.5 + centerDistanceX * cosTheta - centerDistanceY * sinTheta));\n        const pixelY = Math.max(0.0, Math.min(1.0, 0.5 + centerDistanceX * sinTheta + centerDistanceY * cosTheta));\n\n        let distanceSum = 0.0;\n\n        let r = 0.0;\n        let g = 0.0;\n        let b = 0.0;\n\n        for(let i = 0; i < this._colors.length; i++) {\n          const colorX = positions[i].x;\n          const colorY = positions[i].y;\n\n          const distanceX = pixelX - colorX;\n          const distanceY = pixelY - colorY;\n\n          let distance = Math.max(0.0, 0.9 - Math.sqrt(distanceX * distanceX + distanceY * distanceY));\n          distance = distance * distance * distance * distance;\n          distanceSum += distance;\n\n          r += distance * this._colors[i].r / 255;\n          g += distance * this._colors[i].g / 255;\n          b += distance * this._colors[i].b / 255;\n        }\n\n        pixels[offset++] = r / distanceSum * 255.0;\n        pixels[offset++] = g / distanceSum * 255.0;\n        pixels[offset++] = b / distanceSum * 255.0;\n        pixels[offset++] = 0xFF;\n      }\n    }\n    return id;\n  }\n\n  private drawImageData(id: ImageData) {\n    this._hctx.putImageData(id, 0, 0);\n    this._ctx.drawImage(this._hc, 0, 0, this._width, this._height);\n  }\n\n  private drawGradient(positions: {x: number, y: number}[]) {\n    this.drawImageData(this.getGradientImageData(positions));\n  }\n\n  // private doAnimate = () => {\n  //   const now = +Date.now();\n  //   if(!document.hasFocus() || (now - this._ts) < this._frametime) {\n  //     this._raf = requestAnimationFrame(this.doAnimate);\n  //     return;\n  //   }\n\n  //   this._ts = now;\n  //   this.changeTail(1);\n  //   const cur_pos = this.curPosition(this._phase, this._tail);\n  //   this.drawGradient(cur_pos);\n  //   this._raf = requestAnimationFrame(this.doAnimate);\n  // };\n\n  // public animate(start?: boolean) {\n  //   if(!start) {\n  //     cancelAnimationFrame(this._raf);\n  //     return;\n  //   }\n  //   this.doAnimate();\n  // }\n\n  public init(el: HTMLCanvasElement) {\n    this._frames = [];\n    this._phase = 0;\n    this._tail = 0;\n    this._scrollDelta = 0;\n    if(this._onWheelRAF !== undefined) {\n      cancelAnimationFrame(this._onWheelRAF);\n      this._onWheelRAF = undefined;\n    }\n\n    const colors = el.getAttribute('data-colors').split(',').reverse();\n    this._colors = colors.map((color) => {\n      return this.hexToRgb(color);\n    });\n\n    if(!this._hc) {\n      this._hc = document.createElement('canvas');\n      this._hc.width = this._width;\n      this._hc.height = this._height;\n      this._hctx = this._hc.getContext('2d', {alpha: false});\n    }\n\n    this._canvas = el;\n    this._ctx = this._canvas.getContext('2d', {alpha: false});\n    this.update();\n  }\n\n  public update() {\n    if(this._colors.length < 2) {\n      const color = this._colors[0];\n      this._ctx.fillStyle = `rgb(${color.r}, ${color.g}, ${color.b})`;\n      this._ctx.fillRect(0, 0, this._width, this._height);\n      return;\n    }\n\n    const pos = this.curPosition(this._phase, this._tail);\n    this.drawGradient(pos);\n  }\n\n  public toNextPosition() {\n    if(this._colors.length < 2) {\n      return;\n    }\n\n    const tail = this._tail;\n    const tails = this._tails;\n\n    let nextPhaseOnIdx: number;\n\n    const curve: number[] = [];\n    for(let i = 0, length = this._incrementalCurve.length; i < length; ++i) {\n      const inc = this._incrementalCurve[i];\n      let value = (curve[i - 1] ?? tail) + inc;\n\n      if(+value.toFixed(2) > tails && nextPhaseOnIdx === undefined) {\n        nextPhaseOnIdx = i;\n        value %= tails;\n      }\n\n      curve.push(value);\n    }\n\n    const currentPhaseCurve = curve.slice(0, nextPhaseOnIdx);\n    const nextPhaseCurve = nextPhaseOnIdx !== undefined ? curve.slice(nextPhaseOnIdx) : [];\n\n    [currentPhaseCurve, nextPhaseCurve].forEach((curve, idx, curves) => {\n      const last = curve[curve.length - 1];\n      if(last !== undefined && last > tails) {\n        curve[curve.length - 1] = +last.toFixed(2);\n      }\n\n      this._tail = last ?? 0;\n\n      if(!curve.length) {\n        return;\n      }\n\n      const positions = this.getNextPositions(this._phase, tails, curve);\n      if(idx !== (curves.length - 1)) {\n        if(++this._phase >= this._phases) {\n          this._phase -= this._phases;\n        }\n      }\n\n      const ids = positions.map((pos) => {\n        return this.getGradientImageData(pos);\n      });\n\n      this._frames.push(...ids);\n    });\n\n    this._animatingToNextPosition = true;\n    animate(this.drawNextPositionAnimated);\n  }\n\n  public scrollAnimate(start?: boolean) {\n    if(this._colors.length < 2 && start) {\n      return;\n    }\n\n    if(start && !this._addedScrollListener) {\n      document.addEventListener('wheel', this.onWheel);\n      this._addedScrollListener = true;\n    } else if(!start && this._addedScrollListener) {\n      document.removeEventListener('wheel', this.onWheel);\n      this._addedScrollListener = false;\n    }\n  }\n\n  public cleanup() {\n    this.scrollAnimate(false);\n    // this.animate(false);\n  }\n\n  public static createCanvas(colors?: string) {\n    const canvas = document.createElement('canvas');\n    canvas.width = WIDTH;\n    canvas.height = HEIGHT;\n    if(colors !== undefined) {\n      canvas.dataset.colors = colors;\n    }\n\n    return canvas;\n  }\n\n  public static create(colors?: string) {\n    const canvas = this.createCanvas(colors);\n    const gradientRenderer = new ChatBackgroundGradientRenderer();\n    gradientRenderer.init(canvas);\n\n    return {gradientRenderer, canvas};\n  }\n}\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport replaceContent from '../../helpers/dom/replaceContent';\r\nimport limitSymbols from '../../helpers/string/limitSymbols';\r\nimport {Document, MessageMedia, Photo, WebPage} from '../../layer';\r\nimport appImManager, {CHAT_ANIMATION_GROUP} from '../../lib/appManagers/appImManager';\r\nimport choosePhotoSize from '../../lib/appManagers/utils/photos/choosePhotoSize';\r\nimport wrapEmojiText from '../../lib/richTextProcessor/wrapEmojiText';\r\nimport DivAndCaption from '../divAndCaption';\r\nimport {wrapPhoto, wrapSticker, wrapVideo} from '../wrappers';\r\nimport wrapMessageForReply from '../wrappers/messageForReply';\r\n\r\nconst MEDIA_SIZE = 32;\r\n\r\nexport async function wrapReplyDivAndCaption(options: {\r\n  title: string | HTMLElement | DocumentFragment,\r\n  titleEl: HTMLElement,\r\n  subtitle: string | HTMLElement | DocumentFragment,\r\n  subtitleEl: HTMLElement,\r\n  message: any,\r\n  mediaEl: HTMLElement,\r\n  loadPromises?: Promise<any>[]\r\n}) {\r\n  let {title, titleEl, subtitle, subtitleEl, mediaEl, message, loadPromises} = options;\r\n  if(title !== undefined) {\r\n    if(typeof(title) === 'string') {\r\n      title = limitSymbols(title, 140);\r\n      title = wrapEmojiText(title);\r\n    }\r\n\r\n    replaceContent(titleEl, title);\r\n  }\r\n\r\n  if(!loadPromises) {\r\n    loadPromises = [];\r\n  }\r\n\r\n  let messageMedia: MessageMedia | WebPage.webPage = message?.media;\r\n  let setMedia = false, isRound = false;\r\n  const mediaChildren = mediaEl ? Array.from(mediaEl.children).slice() : [];\r\n  let middleware: () => boolean;\r\n  if(messageMedia && mediaEl) {\r\n    subtitleEl.textContent = '';\r\n    subtitleEl.append(await wrapMessageForReply(message, undefined, undefined, undefined, undefined, true));\r\n\r\n    messageMedia = (messageMedia as MessageMedia.messageMediaWebPage).webpage as WebPage.webPage || messageMedia;\r\n    const photo = (messageMedia as MessageMedia.messageMediaPhoto).photo as Photo.photo;\r\n    const document = (messageMedia as MessageMedia.messageMediaDocument).document as Document.document;\r\n    if(photo || (document && document.thumbs?.length)/* ['video', 'sticker', 'gif', 'round', 'photo', 'audio'].indexOf(document.type) !== -1) */) {\r\n      middleware = appImManager.chat.bubbles.getMiddleware();\r\n      const lazyLoadQueue = appImManager.chat.bubbles.lazyLoadQueue;\r\n\r\n      if(document?.type === 'sticker') {\r\n        await wrapSticker({\r\n          doc: document,\r\n          div: mediaEl,\r\n          lazyLoadQueue,\r\n          group: CHAT_ANIMATION_GROUP,\r\n          // onlyThumb: document.sticker === 2,\r\n          width: MEDIA_SIZE,\r\n          height: MEDIA_SIZE,\r\n          middleware,\r\n          loadPromises\r\n        });\r\n        setMedia = true;\r\n      } else if(document?.type === 'gif' && document.video_thumbs) {\r\n        setMedia = true;\r\n        await wrapVideo({\r\n          doc: document,\r\n          container: mediaEl,\r\n          boxWidth: MEDIA_SIZE,\r\n          boxHeight: MEDIA_SIZE,\r\n          lazyLoadQueue,\r\n          noPlayButton: true,\r\n          noInfo: true,\r\n          middleware,\r\n          loadPromises,\r\n          withoutPreloader: true,\r\n          videoSize: document.video_thumbs[0],\r\n          group: CHAT_ANIMATION_GROUP\r\n        });\r\n      } else {\r\n        const m = photo || document;\r\n        isRound = document?.type === 'round';\r\n\r\n        try {\r\n          await wrapPhoto({\r\n            photo: m,\r\n            container: mediaEl,\r\n            boxWidth: MEDIA_SIZE,\r\n            boxHeight: MEDIA_SIZE,\r\n            size: choosePhotoSize(m, MEDIA_SIZE, MEDIA_SIZE),\r\n            middleware,\r\n            lazyLoadQueue,\r\n            noBlur: true,\r\n            withoutPreloader: true,\r\n            loadPromises\r\n          });\r\n          setMedia = true;\r\n        } catch(err) {\r\n\r\n        }\r\n      }\r\n    }\r\n  } else {\r\n    if(message) {\r\n      subtitleEl.textContent = '';\r\n      subtitleEl.append(await wrapMessageForReply(message));\r\n    } else {\r\n      if(typeof(subtitle) === 'string') {\r\n        subtitle = limitSymbols(subtitle, 140);\r\n        subtitle = wrapEmojiText(subtitle);\r\n      }\r\n\r\n      replaceContent(subtitleEl, subtitle || '');\r\n    }\r\n  }\r\n\r\n  Promise.all(loadPromises).then(() => {\r\n    if(middleware && !middleware()) return;\r\n    mediaChildren.forEach((child) => child.remove());\r\n\r\n    if(mediaEl) {\r\n      mediaEl.classList.toggle('is-round', isRound);\r\n    }\r\n  });\r\n\r\n  return setMedia;\r\n}\r\n\r\nexport default class ReplyContainer extends DivAndCaption<(title: string | HTMLElement | DocumentFragment, subtitle: string | HTMLElement | DocumentFragment, message?: any) => Promise<void>> {\r\n  private mediaEl: HTMLElement;\r\n\r\n  constructor(protected className: string) {\r\n    super(className, async(title, subtitle = '', message?) => {\r\n      if(!this.mediaEl) {\r\n        this.mediaEl = document.createElement('div');\r\n        this.mediaEl.classList.add(this.className + '-media');\r\n      }\r\n\r\n      const isMediaSet = await wrapReplyDivAndCaption({\r\n        title,\r\n        titleEl: this.title,\r\n        subtitle,\r\n        subtitleEl: this.subtitle,\r\n        mediaEl: this.mediaEl,\r\n        message\r\n      });\r\n\r\n      this.container.classList.toggle('is-media', isMediaSet);\r\n      if(isMediaSet) {\r\n        this.content.prepend(this.mediaEl);\r\n      } else {\r\n        this.mediaEl.remove();\r\n      }\r\n    });\r\n  }\r\n}\r\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport type {AppMessagesManager, MessagesStorageKey} from '../../lib/appManagers/appMessagesManager';\nimport type ChatBubbles from './bubbles';\nimport type ChatInput from './input';\nimport type Chat from './chat';\nimport IS_TOUCH_SUPPORTED from '../../environment/touchSupport';\nimport Button from '../button';\nimport ButtonIcon from '../buttonIcon';\nimport CheckboxField from '../checkboxField';\nimport PopupDeleteMessages from '../popups/deleteMessages';\nimport PopupForward from '../popups/forward';\nimport {toast} from '../toast';\nimport SetTransition from '../singleTransition';\nimport ListenerSetter from '../../helpers/listenerSetter';\nimport PopupSendNow from '../popups/sendNow';\nimport appNavigationController, {NavigationItem} from '../appNavigationController';\nimport {IS_MOBILE_SAFARI} from '../../environment/userAgent';\nimport I18n, {i18n, _i18n} from '../../lib/langPack';\nimport findUpClassName from '../../helpers/dom/findUpClassName';\nimport blurActiveElement from '../../helpers/dom/blurActiveElement';\nimport cancelEvent from '../../helpers/dom/cancelEvent';\nimport cancelSelection from '../../helpers/dom/cancelSelection';\nimport getSelectedText from '../../helpers/dom/getSelectedText';\nimport rootScope from '../../lib/rootScope';\nimport replaceContent from '../../helpers/dom/replaceContent';\nimport AppSearchSuper from '../appSearchSuper.';\nimport isInDOM from '../../helpers/dom/isInDOM';\nimport {randomLong} from '../../helpers/random';\nimport {attachClickEvent, AttachClickOptions} from '../../helpers/dom/clickEvent';\nimport findUpAsChild from '../../helpers/dom/findUpAsChild';\nimport EventListenerBase from '../../helpers/eventListenerBase';\nimport safeAssign from '../../helpers/object/safeAssign';\nimport {AppManagers} from '../../lib/appManagers/managers';\nimport {attachContextMenuListener} from '../../helpers/dom/attachContextMenuListener';\nimport filterUnique from '../../helpers/array/filterUnique';\nimport appImManager from '../../lib/appManagers/appImManager';\n\nconst accumulateMapSet = (map: Map<any, Set<number>>) => {\n  return [...map.values()].reduce((acc, v) => acc + v.size, 0);\n};\n\n// const MIN_CLICK_MOVE = 32; // minimum bubble height\n\nclass AppSelection extends EventListenerBase<{\n  toggle: (isSelecting: boolean) => void\n}> {\n  public selectedMids: Map<PeerId, Set<number>> = new Map();\n  public isSelecting = false;\n\n  public selectedText: string;\n\n  protected listenerSetter: ListenerSetter;\n  protected isScheduled: boolean;\n  protected listenElement: HTMLElement;\n\n  protected onToggleSelection: (forwards: boolean, animate: boolean) => void;\n  protected onUpdateContainer: (cantForward: boolean, cantDelete: boolean, cantSend: boolean) => void;\n  protected onCancelSelection: () => void;\n  protected toggleByMid: (peerId: PeerId, mid: number) => void;\n  protected toggleByElement: (bubble: HTMLElement) => void;\n\n  protected navigationType: NavigationItem['type'];\n\n  protected getElementFromTarget: (target: HTMLElement) => HTMLElement;\n  protected verifyTarget: (e: MouseEvent, target: HTMLElement) => boolean;\n  protected verifyMouseMoveTarget: (e: MouseEvent, element: HTMLElement, selecting: boolean) => boolean;\n  protected verifyTouchLongPress: () => boolean;\n  protected targetLookupClassName: string;\n  protected lookupBetweenParentClassName: string;\n  protected lookupBetweenElementsQuery: string;\n\n  protected doNotAnimate: boolean;\n  protected managers: AppManagers;\n\n  constructor(options: {\n    managers: AppManagers,\n    getElementFromTarget: AppSelection['getElementFromTarget'],\n    verifyTarget?: AppSelection['verifyTarget'],\n    verifyMouseMoveTarget?: AppSelection['verifyMouseMoveTarget'],\n    verifyTouchLongPress?: AppSelection['verifyTouchLongPress'],\n    targetLookupClassName: string,\n    lookupBetweenParentClassName: string,\n    lookupBetweenElementsQuery: string,\n    isScheduled?: AppSelection['isScheduled']\n  }) {\n    super(false);\n\n    safeAssign(this, options);\n\n    this.navigationType = 'multiselect-' + randomLong() as any;\n  }\n\n  public attachListeners(listenElement: HTMLElement, listenerSetter: ListenerSetter) {\n    if(this.listenElement) {\n      this.listenerSetter.removeAll();\n    }\n\n    this.listenElement = listenElement;\n    this.listenerSetter = listenerSetter;\n\n    if(!listenElement) {\n      return;\n    }\n\n    if(IS_TOUCH_SUPPORTED) {\n      listenerSetter.add(listenElement)('touchend', () => {\n        if(!this.isSelecting) return;\n        this.selectedText = getSelectedText();\n      });\n\n      attachContextMenuListener(listenElement, (e) => {\n        if(this.isSelecting || (this.verifyTouchLongPress && !this.verifyTouchLongPress())) return;\n\n        // * these two lines will fix instant text selection on iOS Safari\n        document.body.classList.add('no-select'); // * need no-select on body because chat-input transforms in channels\n        listenElement.addEventListener('touchend', (e) => {\n          cancelEvent(e); // ! this one will fix propagation to document loader button, etc\n          document.body.classList.remove('no-select');\n\n          // this.chat.bubbles.onBubblesClick(e);\n        }, {once: true, capture: true});\n\n        cancelSelection();\n        // cancelEvent(e as any);\n        const element = this.getElementFromTarget(e.target as HTMLElement);\n        if(element) {\n          this.toggleByElement(element);\n        }\n      }, listenerSetter);\n\n      return;\n    }\n\n    listenerSetter.add(listenElement)('mousedown', this.onMouseDown);\n  }\n\n  private onMouseDown = (e: MouseEvent) => {\n    // console.log('selection mousedown', e);\n    const element = findUpClassName(e.target, this.targetLookupClassName);\n    if(e.button !== 0) {\n      return;\n    }\n\n    if(this.verifyTarget && !this.verifyTarget(e, element)) {\n      return;\n    }\n\n    const seen: AppSelection['selectedMids'] = new Map();\n    let selecting: boolean;\n\n    /* let good = false;\n    const {x, y} = e; */\n\n    /* const bubbles = appImManager.bubbles;\n    for(const mid in bubbles) {\n      const bubble = bubbles[mid];\n      bubble.addEventListener('mouseover', () => {\n        console.log('mouseover');\n      }, {once: true});\n    } */\n\n    let firstTarget = element;\n\n    const processElement = (element: HTMLElement, checkBetween = true) => {\n      const mid = +element.dataset.mid;\n      if(!mid || !element.dataset.peerId) return;\n      const peerId = element.dataset.peerId.toPeerId();\n\n      if(!isInDOM(firstTarget)) {\n        firstTarget = element;\n      }\n\n      let seenSet = seen.get(peerId);\n      if(!seenSet) {\n        seen.set(peerId, seenSet = new Set());\n      }\n\n      if(seenSet.has(mid)) {\n        return;\n      }\n\n      const isSelected = this.isMidSelected(peerId, mid);\n      if(selecting === undefined) {\n        // bubblesContainer.classList.add('no-select');\n        selecting = !isSelected;\n      }\n\n      seenSet.add(mid);\n\n      if((selecting && !isSelected) || (!selecting && isSelected)) {\n        const seenLength = accumulateMapSet(seen);\n        if(this.toggleByElement && checkBetween) {\n          if(seenLength < 2) {\n            if(findUpAsChild(element, firstTarget)) {\n              firstTarget = element;\n            }\n          }\n\n          const elementsBetween = this.getElementsBetween(firstTarget, element);\n          // console.log(elementsBetween);\n          if(elementsBetween.length) {\n            elementsBetween.forEach((element) => {\n              processElement(element, false);\n            });\n          }\n        }\n\n        if(!this.selectedMids.size) {\n          if(seenLength === 2 && this.toggleByMid) {\n            for(const [peerId, mids] of seen) {\n              for(const mid of mids) {\n                this.toggleByMid(peerId, mid);\n              }\n            }\n          }\n        } else if(this.toggleByElement) {\n          this.toggleByElement(element);\n        }\n      }\n    };\n\n    // const foundTargets: Map<HTMLElement, true> = new Map();\n    let canceledSelection = false;\n    const onMouseMove = (e: MouseEvent) => {\n      if(!canceledSelection) {\n        cancelSelection();\n        canceledSelection = true;\n      }\n      /* if(!good) {\n        if(Math.abs(e.x - x) > MIN_CLICK_MOVE || Math.abs(e.y - y) > MIN_CLICK_MOVE) {\n          good = true;\n        } else {\n          return;\n        }\n      } */\n\n      /* if(foundTargets.has(e.target as HTMLElement)) return;\n      foundTargets.set(e.target as HTMLElement, true); */\n      const element = this.getElementFromTarget(e.target as HTMLElement);\n      if(!element) {\n        // console.error('found no bubble', e);\n        return;\n      }\n\n      if(this.verifyMouseMoveTarget && !this.verifyMouseMoveTarget(e, element, selecting)) {\n        this.listenerSetter.removeManual(this.listenElement, 'mousemove', onMouseMove);\n        this.listenerSetter.removeManual(document, 'mouseup', onMouseUp, documentListenerOptions);\n        return;\n      }\n\n      processElement(element);\n    };\n\n    const onMouseUp = (e: MouseEvent) => {\n      if(seen.size) {\n        attachClickEvent(window, cancelEvent, {capture: true, once: true, passive: false});\n      }\n\n      this.listenerSetter.removeManual(this.listenElement, 'mousemove', onMouseMove);\n      // bubblesContainer.classList.remove('no-select');\n\n      // ! CANCEL USER SELECTION !\n      cancelSelection();\n    };\n\n    const documentListenerOptions = {once: true};\n    this.listenerSetter.add(this.listenElement)('mousemove', onMouseMove);\n    this.listenerSetter.add(document)('mouseup', onMouseUp, documentListenerOptions);\n  };\n\n  private getElementsBetween = (first: HTMLElement, last: HTMLElement) => {\n    if(first === last) {\n      return [];\n    }\n\n    const firstRect = first.getBoundingClientRect();\n    const lastRect = last.getBoundingClientRect();\n    const difference = (firstRect.top - lastRect.top) || (firstRect.left - lastRect.left);\n    const isHigher = difference < 0;\n\n    const parent = findUpClassName(first, this.lookupBetweenParentClassName);\n    if(!parent) {\n      return [];\n    }\n\n    const elements = Array.from(parent.querySelectorAll(this.lookupBetweenElementsQuery)) as HTMLElement[];\n    let firstIndex = elements.indexOf(first);\n    let lastIndex = elements.indexOf(last);\n\n    if(!isHigher) {\n      [lastIndex, firstIndex] = [firstIndex, lastIndex];\n    }\n\n    const slice = elements.slice(firstIndex + 1, lastIndex);\n\n    // console.log('getElementsBetween', first, last, slice, firstIndex, lastIndex, isHigher);\n\n    return slice;\n  };\n\n  protected isElementShouldBeSelected(element: HTMLElement) {\n    return this.isMidSelected(element.dataset.peerId.toPeerId(), +element.dataset.mid);\n  }\n\n  protected appendCheckbox(element: HTMLElement, checkboxField: CheckboxField) {\n    element.prepend(checkboxField.label);\n  }\n\n  public toggleElementCheckbox(element: HTMLElement, show: boolean) {\n    const hasCheckbox = !!this.getCheckboxInputFromElement(element);\n    if(show) {\n      if(hasCheckbox) {\n        return false;\n      }\n\n      const checkboxField = new CheckboxField({\n        name: element.dataset.mid,\n        round: true\n      });\n\n      // * if it is a render of new message\n      if(this.isSelecting) { // ! avoid breaking animation on start\n        if(this.isElementShouldBeSelected(element)) {\n          checkboxField.input.checked = true;\n          element.classList.add('is-selected');\n        }\n      }\n\n      this.appendCheckbox(element, checkboxField);\n    } else if(hasCheckbox) {\n      this.getCheckboxInputFromElement(element).parentElement.remove();\n      SetTransition(element, 'is-selected', false, 200);\n    }\n\n    return true;\n  }\n\n  protected getCheckboxInputFromElement(element: HTMLElement): HTMLInputElement {\n    return element.firstElementChild?.tagName === 'LABEL' &&\n      element.firstElementChild.firstElementChild as HTMLInputElement;\n  }\n\n  protected async updateContainer(forceSelection = false) {\n    const size = this.selectedMids.size;\n    if(!size && !forceSelection) return;\n\n    let cantForward = !size,\n      cantDelete = !size;\n    const cantSend = !size;\n    for(const [peerId, mids] of this.selectedMids) {\n      const storageKey: MessagesStorageKey = `${peerId}_${this.isScheduled ? 'scheduled' : 'history'}`;\n      const r = await this.managers.appMessagesManager.cantForwardDeleteMids(storageKey, Array.from(mids));\n      cantForward = r.cantForward;\n      cantDelete = r.cantDelete;\n\n      if(cantForward && cantDelete) break;\n    }\n\n    this.onUpdateContainer && this.onUpdateContainer(cantForward, cantDelete, cantSend);\n  }\n\n  public toggleSelection(toggleCheckboxes = true, forceSelection = false) {\n    const wasSelecting = this.isSelecting;\n    const size = this.selectedMids.size;\n    this.isSelecting = !!size || forceSelection;\n\n    if(wasSelecting === this.isSelecting) return false;\n\n    this.dispatchEvent('toggle', this.isSelecting);\n\n    // const bubblesContainer = this.bubbles.bubblesContainer;\n    // bubblesContainer.classList.toggle('is-selecting', !!size);\n\n    /* if(bubblesContainer.classList.contains('is-chat-input-hidden')) {\n      const scrollable = this.appImManager.scrollable;\n      if(scrollable.isScrolledDown) {\n        scrollable.scrollTo(scrollable.scrollHeight, 'top', true, true, 200);\n      }\n    } */\n\n    if(!IS_TOUCH_SUPPORTED) {\n      this.listenElement.classList.toggle('no-select', this.isSelecting);\n\n      if(wasSelecting) {\n        // ! CANCEL USER SELECTION !\n        cancelSelection();\n      }\n    }/*  else {\n      if(!wasSelecting) {\n        bubblesContainer.classList.add('no-select');\n        setTimeout(() => {\n          cancelSelection();\n          bubblesContainer.classList.remove('no-select');\n          cancelSelection();\n        }, 100);\n      }\n    } */\n\n    blurActiveElement();\n\n    const forwards = !!size || forceSelection;\n    this.onToggleSelection && this.onToggleSelection(forwards, !this.doNotAnimate);\n\n    if(!IS_MOBILE_SAFARI) {\n      if(forwards) {\n        appNavigationController.pushItem({\n          type: this.navigationType,\n          onPop: () => {\n            this.cancelSelection();\n          }\n        });\n      } else {\n        appNavigationController.removeByType(this.navigationType);\n      }\n    }\n\n    if(forceSelection) {\n      this.updateContainer(forceSelection);\n    }\n\n    return true;\n  }\n\n  public cancelSelection = async(doNotAnimate?: boolean) => {\n    if(doNotAnimate) this.doNotAnimate = true;\n    this.onCancelSelection && await this.onCancelSelection();\n    this.selectedMids.clear();\n    this.toggleSelection();\n    cancelSelection();\n    if(doNotAnimate) this.doNotAnimate = undefined;\n  };\n\n  public cleanup() {\n    this.doNotAnimate = true;\n    this.selectedMids.clear();\n    this.toggleSelection(false);\n    this.doNotAnimate = undefined;\n  }\n\n  protected updateElementSelection(element: HTMLElement, isSelected: boolean) {\n    this.toggleElementCheckbox(element, true);\n    const input = this.getCheckboxInputFromElement(element);\n    input.checked = isSelected;\n\n    this.toggleSelection();\n    this.updateContainer();\n    SetTransition(element, 'is-selected', isSelected, 200);\n  }\n\n  public isMidSelected(peerId: PeerId, mid: number) {\n    const set = this.selectedMids.get(peerId);\n    return set?.has(mid);\n  }\n\n  public length() {\n    return accumulateMapSet(this.selectedMids);\n  }\n\n  protected toggleMid(peerId: PeerId, mid: number, unselect?: boolean) {\n    let set = this.selectedMids.get(peerId);\n    if(unselect || (unselect === undefined && set?.has(mid))) {\n      if(set) {\n        set.delete(mid);\n\n        if(!set.size) {\n          this.selectedMids.delete(peerId);\n        }\n      }\n    } else {\n      // const diff = rootScope.config.forwarded_count_max - this.length() - 1;\n      // if(diff < 0) {\n      //   toast(I18n.format('Chat.Selection.LimitToast', true));\n      //   return false;\n      //   /* const it = this.selectedMids.values();\n      //   do {\n      //     const mid = it.next().value;\n      //     const mounted = this.appImManager.getMountedBubble(mid);\n      //     if(mounted) {\n      //       this.toggleByBubble(mounted.bubble);\n      //     } else {\n      //       const mids = this.appMessagesManager.getMidsByMid(mid);\n      //       for(const mid of mids) {\n      //         this.selectedMids.delete(mid);\n      //       }\n      //     }\n      //   } while(this.selectedMids.size > MAX_SELECTION_LENGTH); */\n      // }\n\n      if(!set) {\n        set = new Set();\n        this.selectedMids.set(peerId, set);\n      }\n\n      set.add(mid);\n    }\n\n    return true;\n  }\n\n  /**\n   * ! Call this method only to handle deleted messages\n   */\n  public deleteSelectedMids(peerId: PeerId, mids: number[]) {\n    const set = this.selectedMids.get(peerId);\n    if(!set) {\n      return;\n    }\n\n    mids.forEach((mid) => {\n      set.delete(mid);\n    });\n\n    if(!set.size) {\n      this.selectedMids.delete(peerId);\n    }\n\n    this.updateContainer();\n    this.toggleSelection();\n  }\n}\n\nexport class SearchSelection extends AppSelection {\n  protected selectionContainer: HTMLElement;\n  protected selectionCountEl: HTMLElement;\n  public selectionForwardBtn: HTMLElement;\n  public selectionDeleteBtn: HTMLElement;\n  public selectionGotoBtn: HTMLElement;\n\n  private isPrivate: boolean;\n\n  constructor(private searchSuper: AppSearchSuper, managers: AppManagers, listenerSetter: ListenerSetter) {\n    super({\n      managers,\n      verifyTarget: (e, target) => !!target && this.isSelecting,\n      getElementFromTarget: (target) => findUpClassName(target, 'search-super-item'),\n      targetLookupClassName: 'search-super-item',\n      lookupBetweenParentClassName: 'tabs-tab',\n      lookupBetweenElementsQuery: '.search-super-item'\n    });\n\n    this.isPrivate = !searchSuper.showSender;\n    this.attachListeners(searchSuper.container, listenerSetter);\n  }\n\n  /* public appendCheckbox(element: HTMLElement, checkboxField: CheckboxField) {\n    checkboxField.label.classList.add('bubble-select-checkbox');\n\n    if(element.classList.contains('document') || element.tagName === 'AUDIO-ELEMENT') {\n      element.querySelector('.document, audio-element').append(checkboxField.label);\n    } else {\n      super.appendCheckbox(bubble, checkboxField);\n    }\n  } */\n\n  public toggleSelection(toggleCheckboxes = true, forceSelection = false) {\n    const ret = super.toggleSelection(toggleCheckboxes, forceSelection);\n\n    if(ret && toggleCheckboxes) {\n      const elements = Array.from(this.searchSuper.tabsContainer.querySelectorAll('.search-super-item')) as HTMLElement[];\n      elements.forEach((element) => {\n        this.toggleElementCheckbox(element, this.isSelecting);\n      });\n    }\n\n    return ret;\n  }\n\n  public toggleByElement = (element: HTMLElement) => {\n    const mid = +element.dataset.mid;\n    const peerId = element.dataset.peerId.toPeerId();\n\n    if(!this.toggleMid(peerId, mid)) {\n      return;\n    }\n\n    this.updateElementSelection(element, this.isMidSelected(peerId, mid));\n  };\n\n  public toggleByMid = (peerId: PeerId, mid: number) => {\n    const element = this.searchSuper.mediaTab.contentTab.querySelector(`.search-super-item[data-peer-id=\"${peerId}\"][data-mid=\"${mid}\"]`) as HTMLElement;\n    this.toggleByElement(element);\n  };\n\n  protected onUpdateContainer = (cantForward: boolean, cantDelete: boolean, cantSend: boolean) => {\n    const length = this.length();\n    replaceContent(this.selectionCountEl, i18n('messages', [length]));\n    this.selectionGotoBtn.classList.toggle('hide', length !== 1);\n    this.selectionForwardBtn.classList.toggle('hide', cantForward);\n    this.selectionDeleteBtn && this.selectionDeleteBtn.classList.toggle('hide', cantDelete);\n  };\n\n  protected onToggleSelection = (forwards: boolean, animate: boolean) => {\n    SetTransition(this.searchSuper.navScrollableContainer, 'is-selecting', forwards, animate ? 200 : 0, () => {\n      if(!this.isSelecting) {\n        this.selectionContainer.remove();\n        this.selectionContainer =\n          this.selectionForwardBtn =\n          this.selectionDeleteBtn =\n          null;\n        this.selectedText = undefined;\n      }\n    });\n\n    SetTransition(this.searchSuper.container, 'is-selecting', forwards, 200);\n\n    if(this.isSelecting) {\n      if(!this.selectionContainer) {\n        const BASE_CLASS = 'search-super-selection';\n        this.selectionContainer = document.createElement('div');\n        this.selectionContainer.classList.add(BASE_CLASS + '-container');\n\n        const btnCancel = ButtonIcon(`close ${BASE_CLASS}-cancel`, {noRipple: true});\n        attachClickEvent(btnCancel, () => this.cancelSelection(), {listenerSetter: this.listenerSetter, once: true});\n\n        this.selectionCountEl = document.createElement('div');\n        this.selectionCountEl.classList.add(BASE_CLASS + '-count');\n\n        this.selectionGotoBtn = ButtonIcon(`message ${BASE_CLASS}-goto`);\n\n        const attachClickOptions: AttachClickOptions = {listenerSetter: this.listenerSetter};\n        attachClickEvent(this.selectionGotoBtn, () => {\n          const peerId = [...this.selectedMids.keys()][0];\n          const mid = [...this.selectedMids.get(peerId)][0];\n          this.cancelSelection();\n\n          appImManager.setInnerPeer({peerId, lastMsgId: mid});\n        }, attachClickOptions);\n\n        this.selectionForwardBtn = ButtonIcon(`forward ${BASE_CLASS}-forward`);\n        attachClickEvent(this.selectionForwardBtn, () => {\n          const obj: {[fromPeerId: PeerId]: number[]} = {};\n          for(const [fromPeerId, mids] of this.selectedMids) {\n            obj[fromPeerId] = Array.from(mids).sort((a, b) => a - b);\n          }\n\n          new PopupForward(obj, () => {\n            this.cancelSelection();\n          });\n        }, attachClickOptions);\n\n        if(this.isPrivate) {\n          this.selectionDeleteBtn = ButtonIcon(`delete danger ${BASE_CLASS}-delete`);\n          attachClickEvent(this.selectionDeleteBtn, () => {\n            const peerId = [...this.selectedMids.keys()][0];\n            new PopupDeleteMessages(peerId, [...this.selectedMids.get(peerId)], 'chat', () => {\n              this.cancelSelection();\n            });\n          }, attachClickOptions);\n        }\n\n        this.selectionContainer.append(...[\n          btnCancel,\n          this.selectionCountEl,\n          this.selectionGotoBtn,\n          this.selectionForwardBtn,\n          this.selectionDeleteBtn\n        ].filter(Boolean));\n\n        const transitionElement = this.selectionContainer;\n        transitionElement.style.opacity = '0';\n        this.searchSuper.navScrollableContainer.append(transitionElement);\n\n        void transitionElement.offsetLeft; // reflow\n        transitionElement.style.opacity = '';\n      }\n    }\n  };\n}\n\nexport default class ChatSelection extends AppSelection {\n  protected selectionInputWrapper: HTMLElement;\n  protected selectionContainer: HTMLElement;\n  protected selectionCountEl: HTMLElement;\n  public selectionSendNowBtn: HTMLElement;\n  public selectionForwardBtn: HTMLElement;\n  public selectionDeleteBtn: HTMLElement;\n  private selectionLeft: HTMLDivElement;\n  private selectionRight: HTMLDivElement;\n\n  constructor(\n    private chat: Chat,\n    private bubbles: ChatBubbles,\n    private input: ChatInput,\n    managers: AppManagers\n  ) {\n    super({\n      managers,\n      getElementFromTarget: (target) => findUpClassName(target, 'grouped-item') || findUpClassName(target, 'bubble'),\n      verifyTarget: (e, target) => {\n        // LEFT BUTTON\n        //     ,      target  .bubble\n        const bad = !this.selectedMids.size &&\n          !(e.target as HTMLElement).classList.contains('bubble') &&\n          !(e.target as HTMLElement).classList.contains('document-selection') &&\n          target;\n\n        return !bad;\n      },\n      verifyMouseMoveTarget: (e, element, selecting) => {\n        const bad = e.target !== element &&\n          !(e.target as HTMLElement).classList.contains('document-selection') &&\n          selecting === undefined &&\n          !this.selectedMids.size;\n        return !bad;\n      },\n      verifyTouchLongPress: () => !this.chat.input.recording,\n      targetLookupClassName: 'bubble',\n      lookupBetweenParentClassName: 'bubbles-inner',\n      lookupBetweenElementsQuery: '.bubble:not(.is-multiple-documents), .grouped-item',\n      isScheduled: chat.type === 'scheduled'\n    });\n  }\n\n  public appendCheckbox(bubble: HTMLElement, checkboxField: CheckboxField) {\n    checkboxField.label.classList.add('bubble-select-checkbox');\n\n    if(bubble.classList.contains('document-container')) {\n      bubble.querySelector('.document, audio-element').append(checkboxField.label);\n    } else {\n      super.appendCheckbox(bubble, checkboxField);\n    }\n  }\n\n  public toggleSelection(toggleCheckboxes = true, forceSelection = false) {\n    const ret = super.toggleSelection(toggleCheckboxes, forceSelection);\n\n    if(ret && toggleCheckboxes) {\n      for(const mid in this.bubbles.bubbles) {\n        if(this.bubbles.skippedMids.has(+mid)) {\n          continue;\n        }\n\n        const bubble = this.bubbles.bubbles[mid];\n        this.toggleElementCheckbox(bubble, this.isSelecting);\n      }\n    }\n\n    return ret;\n  }\n\n  public toggleElementCheckbox(bubble: HTMLElement, show: boolean) {\n    if(!this.canSelectBubble(bubble)) return;\n\n    const ret = super.toggleElementCheckbox(bubble, show);\n    if(ret) {\n      const isGrouped = bubble.classList.contains('is-grouped');\n      if(isGrouped) {\n        this.bubbles.getBubbleGroupedItems(bubble).forEach((item) => this.toggleElementCheckbox(item, show));\n      }\n    }\n\n    return ret;\n  }\n\n  public toggleByElement = (bubble: HTMLElement): Promise<void> => {\n    if(!this.canSelectBubble(bubble)) return;\n\n    const mid = +bubble.dataset.mid;\n\n    const isGrouped = bubble.classList.contains('is-grouped');\n    if(isGrouped) {\n      if(!this.isGroupedBubbleSelected(bubble)) {\n        const set = this.selectedMids.get(this.chat.peerId);\n        if(set) {\n          // const mids = await this.chat.getMidsByMid(mid);\n          const mids = this.getMidsFromGroupContainer(bubble);\n          mids.forEach((mid) => set.delete(mid));\n        }\n      }\n\n      /* const promises =  */this.bubbles.getBubbleGroupedItems(bubble).map(this.toggleByElement);\n      // await Promise.all(promises);\n      return;\n    }\n\n    if(!this.toggleMid(this.chat.peerId, mid)) {\n      return;\n    }\n\n    const isGroupedItem = bubble.classList.contains('grouped-item');\n    if(isGroupedItem) {\n      const groupContainer = findUpClassName(bubble, 'bubble');\n      const isGroupedSelected = this.isGroupedBubbleSelected(groupContainer);\n      const isGroupedMidsSelected = this.isGroupedMidsSelected(groupContainer);\n\n      const willChange = isGroupedMidsSelected || isGroupedSelected;\n      if(willChange) {\n        this.updateElementSelection(groupContainer, isGroupedMidsSelected);\n      }\n    }\n\n    this.updateElementSelection(bubble, this.isMidSelected(this.chat.peerId, mid));\n  };\n\n  protected toggleByMid = async(peerId: PeerId, mid: number) => {\n    const mounted = await this.bubbles.getMountedBubble(mid);\n    if(mounted) {\n      this.toggleByElement(mounted.bubble);\n    }\n  };\n\n  public isElementShouldBeSelected(element: HTMLElement) {\n    const isGrouped = element.classList.contains('is-grouped');\n    return super.isElementShouldBeSelected(element) && (!isGrouped || this.isGroupedMidsSelected(element));\n  }\n\n  protected isGroupedBubbleSelected(bubble: HTMLElement) {\n    const groupedCheckboxInput = this.getCheckboxInputFromElement(bubble);\n    return groupedCheckboxInput?.checked;\n  }\n\n  protected getMidsFromGroupContainer(groupContainer: HTMLElement) {\n    const elements = this.chat.bubbles.getBubbleGroupedItems(groupContainer);\n    if(!elements.length) {\n      elements.push(groupContainer);\n    }\n\n    return elements.map((element) => +element.dataset.mid);\n  }\n\n  protected isGroupedMidsSelected(groupContainer: HTMLElement) {\n    const mids = this.getMidsFromGroupContainer(groupContainer);\n    const selectedMids = mids.filter((mid) => this.isMidSelected(this.chat.peerId, mid));\n    return mids.length === selectedMids.length;\n  }\n\n  protected getCheckboxInputFromElement(bubble: HTMLElement) {\n    /* let perf = performance.now();\n    let checkbox = bubble.firstElementChild.tagName === 'LABEL' && bubble.firstElementChild.firstElementChild as HTMLInputElement;\n    console.log('getCheckboxInputFromBubble firstElementChild time:', performance.now() - perf);\n\n    perf = performance.now();\n    checkbox = bubble.querySelector('label input');\n    console.log('getCheckboxInputFromBubble querySelector time:', performance.now() - perf); */\n    /* let perf = performance.now();\n    let contains = bubble.classList.contains('document-container');\n    console.log('getCheckboxInputFromBubble classList time:', performance.now() - perf);\n\n    perf = performance.now();\n    contains = bubble.className.includes('document-container');\n    console.log('getCheckboxInputFromBubble className time:', performance.now() - perf); */\n\n    return bubble.classList.contains('document-container') ?\n      bubble.querySelector('label input') as HTMLInputElement :\n      super.getCheckboxInputFromElement(bubble);\n  }\n\n  public canSelectBubble(bubble: HTMLElement) {\n    return !bubble.classList.contains('service') &&\n      !bubble.classList.contains('is-outgoing') &&\n      !bubble.classList.contains('is-error') &&\n      !bubble.classList.contains('bubble-first') &&\n      !bubble.classList.contains('avoid-selection');\n  }\n\n  protected onToggleSelection = async(forwards: boolean, animate: boolean) => {\n    const {needTranslateX, widthFrom, widthTo} = await this.chat.input.center(animate);\n\n    SetTransition(this.listenElement, 'is-selecting', forwards, animate ? 200 : 0, () => {\n      if(!this.isSelecting) {\n        this.selectionInputWrapper.remove();\n        this.selectionInputWrapper =\n          this.selectionContainer =\n          this.selectionSendNowBtn =\n          this.selectionForwardBtn =\n          this.selectionDeleteBtn =\n          this.selectionLeft =\n          this.selectionRight =\n          null;\n        this.selectedText = undefined;\n      }\n\n      /* fastRaf(() => {\n        this.bubbles.onScroll();\n      }); */\n    });\n\n    // const chatInput = this.appImManager.chatInput;\n\n    const translateButtonsX = widthFrom < widthTo ? undefined : needTranslateX * 2;\n    if(this.isSelecting) {\n      if(!this.selectionContainer) {\n        this.selectionInputWrapper = document.createElement('div');\n        this.selectionInputWrapper.classList.add('chat-input-wrapper', 'selection-wrapper');\n\n        // const background = document.createElement('div');\n        // background.classList.add('chat-input-wrapper-background');\n\n        this.selectionContainer = document.createElement('div');\n        this.selectionContainer.classList.add('selection-container');\n\n        const attachClickOptions: AttachClickOptions = {listenerSetter: this.listenerSetter};\n        const btnCancel = ButtonIcon('close', {noRipple: true});\n        attachClickEvent(btnCancel, () => this.cancelSelection(), {once: true, listenerSetter: this.listenerSetter});\n\n        this.selectionCountEl = document.createElement('div');\n        this.selectionCountEl.classList.add('selection-container-count');\n\n        if(this.chat.type === 'scheduled') {\n          this.selectionSendNowBtn = Button('btn-primary btn-transparent btn-short text-bold selection-container-send', {icon: 'send2'});\n          this.selectionSendNowBtn.append(i18n('MessageScheduleSend'));\n          attachClickEvent(this.selectionSendNowBtn, () => {\n            new PopupSendNow(this.chat.peerId, [...this.selectedMids.get(this.chat.peerId)], () => {\n              this.cancelSelection();\n            });\n          }, attachClickOptions);\n        } else {\n          this.selectionForwardBtn = Button('btn-primary btn-transparent text-bold selection-container-forward', {icon: 'forward'});\n          this.selectionForwardBtn.append(i18n('Forward'));\n          attachClickEvent(this.selectionForwardBtn, () => {\n            const obj: {[fromPeerId: PeerId]: number[]} = {};\n            for(const [fromPeerId, mids] of this.selectedMids) {\n              obj[fromPeerId] = Array.from(mids).sort((a, b) => a - b);\n            }\n\n            new PopupForward(obj, () => {\n              this.cancelSelection();\n            });\n          }, attachClickOptions);\n        }\n\n        this.selectionDeleteBtn = Button('btn-primary btn-transparent danger text-bold selection-container-delete', {icon: 'delete'});\n        this.selectionDeleteBtn.append(i18n('Delete'));\n        attachClickEvent(this.selectionDeleteBtn, () => {\n          new PopupDeleteMessages(this.chat.peerId, [...this.selectedMids.get(this.chat.peerId)], this.chat.type, () => {\n            this.cancelSelection();\n          });\n        }, attachClickOptions);\n\n        const left = this.selectionLeft = document.createElement('div');\n        left.classList.add('selection-container-left');\n        left.append(btnCancel, this.selectionCountEl);\n\n        const right = this.selectionRight = document.createElement('div');\n        right.classList.add('selection-container-right');\n        right.append(...[\n          this.selectionSendNowBtn,\n          this.selectionForwardBtn,\n          this.selectionDeleteBtn\n        ].filter(Boolean))\n\n        if(translateButtonsX !== undefined) {\n          left.style.transform = `translateX(${-translateButtonsX}px)`;\n          right.style.transform = `translateX(${translateButtonsX}px)`;\n        }\n\n        this.selectionContainer.append(left, right);\n\n        // background.style.opacity = '0';\n        this.selectionInputWrapper.style.opacity = '0';\n        this.selectionInputWrapper.append(/* background,  */this.selectionContainer);\n        this.input.inputContainer.append(this.selectionInputWrapper);\n\n        void this.selectionInputWrapper.offsetLeft; // reflow\n        // background.style.opacity = '';\n        this.selectionInputWrapper.style.opacity = '';\n        left.style.transform = '';\n        right.style.transform = '';\n      }\n    } else if(this.selectionLeft && translateButtonsX !== undefined) {\n      this.selectionLeft.style.transform = `translateX(-${translateButtonsX}px)`;\n      this.selectionRight.style.transform = `translateX(${translateButtonsX}px)`;\n    }\n  };\n\n  protected onUpdateContainer = (cantForward: boolean, cantDelete: boolean, cantSend: boolean) => {\n    replaceContent(this.selectionCountEl, i18n('messages', [this.length()]));\n    this.selectionSendNowBtn && this.selectionSendNowBtn.toggleAttribute('disabled', cantSend);\n    this.selectionForwardBtn && this.selectionForwardBtn.toggleAttribute('disabled', cantForward);\n    this.selectionDeleteBtn.toggleAttribute('disabled', cantDelete);\n  };\n\n  protected onCancelSelection = async() => {\n    return;\n    const promises: Promise<HTMLElement>[] = [];\n    for(const [peerId, mids] of this.selectedMids) {\n      for(const mid of mids) {\n        promises.push(this.bubbles.getMountedBubble(mid).then((m) => m?.bubble));\n      }\n    }\n\n    const bubbles = filterUnique((await Promise.all(promises)).filter(Boolean));\n    bubbles.forEach((bubble) => {\n      this.toggleByElement(bubble);\n    });\n  };\n}\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nexport default function getSelectedText(): string {\r\n  if(window.getSelection) {\r\n    return window.getSelection().toString();\r\n    // @ts-ignore\r\n  } else if(document.selection) {\r\n    // @ts-ignore\r\n    return document.selection.createRange().text;\r\n  }\r\n\r\n  return '';\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport type ListenerSetter from '../helpers/listenerSetter';\r\nimport ripple from './ripple';\r\nimport {LangPackKey, _i18n} from '../lib/langPack';\r\nimport getDeepProperty from '../helpers/object/getDeepProperty';\r\nimport rootScope from '../lib/rootScope';\r\nimport apiManagerProxy from '../lib/mtproto/mtprotoworker';\r\n\r\nexport type CheckboxFieldOptions = {\r\n  text?: LangPackKey,\r\n  textArgs?: any[],\r\n  name?: string,\r\n  round?: boolean,\r\n  toggle?: boolean,\r\n  stateKey?: string,\r\n  stateValues?: any[],\r\n  disabled?: boolean,\r\n  checked?: boolean,\r\n  restriction?: boolean,\r\n  withRipple?: boolean,\r\n  withHover?: boolean,\r\n  listenerSetter?: ListenerSetter\r\n};\r\nexport default class CheckboxField {\r\n  public input: HTMLInputElement;\r\n  public label: HTMLLabelElement;\r\n  public span: HTMLSpanElement;\r\n\r\n  constructor(options: CheckboxFieldOptions = {}) {\r\n    const label = this.label = document.createElement('label');\r\n    label.classList.add('checkbox-field');\r\n\r\n    if(options.restriction) {\r\n      label.classList.add('checkbox-field-restriction');\r\n    }\r\n\r\n    if(options.round) {\r\n      label.classList.add('checkbox-field-round');\r\n    }\r\n\r\n    if(options.disabled) {\r\n      this.toggleDisability(true);\r\n    }\r\n\r\n    const input = this.input = document.createElement('input');\r\n    input.classList.add('checkbox-field-input');\r\n    input.type = 'checkbox';\r\n    if(options.name) {\r\n      input.id = 'input-' + options.name;\r\n    }\r\n\r\n    if(options.checked) {\r\n      input.checked = true;\r\n    }\r\n\r\n    if(options.stateKey) {\r\n      let loaded = false;\r\n      const onChange = () => {\r\n        if(!loaded) {\r\n          return;\r\n        }\r\n\r\n        let value: any;\r\n        if(options.stateValues) {\r\n          value = options.stateValues[input.checked ? 1 : 0];\r\n        } else {\r\n          value = input.checked;\r\n        }\r\n\r\n        rootScope.managers.appStateManager.setByKey(options.stateKey, value);\r\n      };\r\n\r\n      apiManagerProxy.getState().then((state) => {\r\n        loaded = true;\r\n        const stateValue = getDeepProperty(state, options.stateKey);\r\n        let checked: boolean;\r\n        if(options.stateValues) {\r\n          checked = options.stateValues.indexOf(stateValue) === 1;\r\n        } else {\r\n          checked = stateValue;\r\n        }\r\n\r\n        this.setValueSilently(checked);\r\n      });\r\n\r\n      if(options.listenerSetter) options.listenerSetter.add(input)('change', onChange);\r\n      else input.addEventListener('change', onChange);\r\n    }\r\n\r\n    let span: HTMLSpanElement;\r\n    if(options.text) {\r\n      span = this.span = document.createElement('span');\r\n      span.classList.add('checkbox-caption');\r\n      _i18n(span, options.text, options.textArgs);\r\n    } else {\r\n      label.classList.add('checkbox-without-caption');\r\n    }\r\n\r\n    label.append(input);\r\n\r\n    if(options.toggle) {\r\n      label.classList.add('checkbox-field-toggle');\r\n\r\n      const toggle = document.createElement('div');\r\n      toggle.classList.add('checkbox-toggle');\r\n      label.append(toggle);\r\n    } else {\r\n      const box = document.createElement('div');\r\n      box.classList.add('checkbox-box');\r\n\r\n      const checkSvg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');\r\n      checkSvg.classList.add('checkbox-box-check');\r\n      checkSvg.setAttributeNS(null, 'viewBox', '0 0 24 24');\r\n      const use = document.createElementNS('http://www.w3.org/2000/svg', 'use');\r\n      use.setAttributeNS(null, 'href', '#check');\r\n      use.setAttributeNS(null, 'x', '-1');\r\n      checkSvg.append(use);\r\n\r\n      const bg = document.createElement('div');\r\n      bg.classList.add('checkbox-box-background');\r\n\r\n      const border = document.createElement('div');\r\n      border.classList.add('checkbox-box-border');\r\n\r\n      box.append(border, bg, checkSvg);\r\n\r\n      label.append(box);\r\n    }\r\n\r\n    if(span) {\r\n      label.append(span);\r\n    }\r\n\r\n    if(options.withRipple) {\r\n      label.classList.add('checkbox-ripple', 'hover-effect');\r\n      ripple(label, undefined, undefined, true);\r\n      // label.prepend(input);\r\n    } else if(options.withHover) {\r\n      label.classList.add('hover-effect');\r\n    }\r\n  }\r\n\r\n  get checked() {\r\n    return this.input.checked;\r\n  }\r\n\r\n  set checked(checked: boolean) {\r\n    /* if(this.checked === checked) {\r\n      return;\r\n    } */\r\n\r\n    this.setValueSilently(checked);\r\n\r\n    const event = new Event('change', {bubbles: true, cancelable: true});\r\n    this.input.dispatchEvent(event);\r\n  }\r\n\r\n  public setValueSilently(checked: boolean) {\r\n    this.input.checked = checked;\r\n  }\r\n\r\n  public toggleDisability(disable: boolean) {\r\n    this.label.classList.toggle('checkbox-disabled', disable);\r\n    return () => this.toggleDisability(!disable);\r\n  }\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport InputField, {InputFieldOptions} from './inputField';\r\n\r\nexport default class CodeInputField extends InputField {\r\n  constructor(options: InputFieldOptions & {\r\n    length: number,\r\n    onFill: (code: string) => void\r\n  }) {\r\n    super({\r\n      plainText: true,\r\n      ...options\r\n    });\r\n\r\n    const input = this.input as HTMLInputElement;\r\n    input.type = 'tel';\r\n    input.setAttribute('required', '');\r\n    input.autocomplete = 'off';\r\n\r\n    let lastLength = 0;\r\n    this.input.addEventListener('input', (e) => {\r\n      this.input.classList.remove('error');\r\n      this.setLabel();\r\n\r\n      const value = this.value.replace(/\\D/g, '').slice(0, options.length);\r\n      this.setValueSilently(value);\r\n\r\n      const length = this.value.length;\r\n      if(length === options.length) { // submit code\r\n        options.onFill(this.value);\r\n      } else if(length === lastLength) {\r\n        return;\r\n      }\r\n\r\n      lastLength = length;\r\n    });\r\n  }\r\n}\r\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport {addCancelButton} from './popups';\nimport PopupPeer, {PopupPeerOptions} from './popups/peer';\n\n// type PopupConfirmationOptions = Pick<PopupPeerOptions, 'titleLangKey'>;\nexport type PopupConfirmationOptions = PopupPeerOptions & {\n  button: PopupPeerOptions['buttons'][0],\n  checkbox?: PopupPeerOptions['checkboxes'][0]\n};\n\nexport default function confirmationPopup(options: PopupConfirmationOptions) {\n  return new Promise<boolean | void>((resolve, reject) => {\n    const {button, checkbox} = options;\n    button.callback = (set) => {\n      resolve(set ? !!set.size : undefined);\n    };\n\n    const buttons = addCancelButton(options.buttons || [button]);\n    const cancelButton = buttons.find((button) => button.isCancel);\n    cancelButton.callback = () => {\n      reject();\n    };\n\n    options.buttons = buttons;\n    options.checkboxes ??= checkbox && [checkbox];\n\n    new PopupPeer('popup-confirmation', options).show();\n  });\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport IS_EMOJI_SUPPORTED from '../environment/emojiSupport';\nimport cancelEvent from '../helpers/dom/cancelEvent';\nimport simulateEvent from '../helpers/dom/dispatchEvent';\nimport findUpClassName from '../helpers/dom/findUpClassName';\nimport findUpTag from '../helpers/dom/findUpTag';\nimport replaceContent from '../helpers/dom/replaceContent';\nimport setInnerHTML from '../helpers/dom/setInnerHTML';\nimport fastSmoothScroll from '../helpers/fastSmoothScroll';\nimport {randomLong} from '../helpers/random';\nimport {HelpCountry, HelpCountryCode} from '../layer';\nimport I18n, {i18n} from '../lib/langPack';\nimport wrapEmojiText from '../lib/richTextProcessor/wrapEmojiText';\nimport rootScope from '../lib/rootScope';\nimport {getCountryEmoji} from '../vendor/emoji';\nimport InputField, {InputFieldOptions} from './inputField';\nimport Scrollable from './scrollable';\n\nlet countries: HelpCountry.helpCountry[];\nconst setCountries = () => {\n  countries = I18n.countriesList\n  .filter((country) => !country.pFlags?.hidden)\n  .sort((a, b) => (a.name || a.default_name).localeCompare(b.name || b.default_name));\n};\n\nlet init = () => {\n  setCountries();\n  rootScope.addEventListener('language_change', () => {\n    setCountries();\n  });\n};\n\nexport default class CountryInputField extends InputField {\n  private lastCountrySelected: HelpCountry;\n  private lastCountryCodeSelected: HelpCountryCode;\n\n  private hideTimeout: number;\n  private selectWrapper: HTMLElement;\n\n  private liMap: Map<string, HTMLLIElement[]>;\n\n  constructor(public options: InputFieldOptions & {\n    onCountryChange?: (country: HelpCountry.helpCountry, code: HelpCountryCode.helpCountryCode) => void,\n    noPhoneCodes?: boolean\n  } = {}) {\n    super({\n      label: 'Country',\n      name: randomLong(),\n      ...options\n    });\n\n    if(init) {\n      init();\n      init = undefined;\n    }\n\n    this.liMap = new Map();\n\n    this.container.classList.add('input-select');\n\n    const selectWrapper = this.selectWrapper = document.createElement('div');\n    selectWrapper.classList.add('select-wrapper', 'z-depth-3', 'hide');\n\n    const arrowDown = document.createElement('span');\n    arrowDown.classList.add('arrow', 'arrow-down');\n    this.container.append(arrowDown);\n\n    const selectList = document.createElement('ul');\n    selectWrapper.appendChild(selectList);\n\n    const scroll = new Scrollable(selectWrapper);\n\n    let initSelect = () => {\n      initSelect = null;\n\n      countries.forEach((c) => {\n        const emoji = getCountryEmoji(c.iso2);\n\n        const liArr: Array<HTMLLIElement> = [];\n        for(let i = 0, length = Math.min(c.country_codes.length, options.noPhoneCodes ? 1 : Infinity); i < length; ++i) {\n          const countryCode = c.country_codes[i];\n          const li = document.createElement('li');\n\n          const wrapped = wrapEmojiText(emoji);\n          if(IS_EMOJI_SUPPORTED) {\n            const spanEmoji = document.createElement('span');\n            setInnerHTML(spanEmoji, wrapped);\n            li.append(spanEmoji);\n          } else {\n            setInnerHTML(li, wrapped);\n          }\n\n          const el = i18n(c.default_name as any);\n          el.dataset.defaultName = c.default_name;\n          li.append(el);\n\n          if(!options.noPhoneCodes) {\n            const span = document.createElement('span');\n            span.classList.add('phone-code');\n            span.innerText = '+' + countryCode.country_code;\n            li.appendChild(span);\n          }\n\n          liArr.push(li);\n          selectList.append(li);\n        }\n\n        this.liMap.set(c.iso2, liArr);\n      });\n\n      selectList.addEventListener('mousedown', (e) => {\n        if(e.button !== 0) { // other buttons but left shall not pass\n          return;\n        }\n\n        const target = findUpTag(e.target, 'LI')\n        this.selectCountryByTarget(target);\n        // console.log('clicked', e, countryName, phoneCode);\n      });\n\n      this.container.appendChild(selectWrapper);\n    };\n\n    initSelect();\n\n    this.input.addEventListener('focus', (e) => {\n      if(initSelect) {\n        initSelect();\n      } else {\n        countries.forEach((c) => {\n          this.liMap.get(c.iso2).forEach((li) => li.style.display = '');\n        });\n      }\n\n      clearTimeout(this.hideTimeout);\n      this.hideTimeout = undefined;\n\n      selectWrapper.classList.remove('hide');\n      void selectWrapper.offsetWidth; // reflow\n      selectWrapper.classList.add('active');\n\n      this.select();\n\n      fastSmoothScroll({\n        // container: page.pageEl.parentElement.parentElement,\n        container: findUpClassName(this.container, 'scrollable-y'),\n        element: this.input,\n        position: 'start',\n        margin: 4\n      });\n\n      setTimeout(() => {\n        if(!mouseDownHandlerAttached) {\n          document.addEventListener('mousedown', onMouseDown, {capture: true});\n          mouseDownHandlerAttached = true;\n        }\n      }, 0);\n    });\n\n    let mouseDownHandlerAttached = false;\n    const onMouseDown = (e: MouseEvent) => {\n      if(findUpClassName(e.target, 'input-select')) {\n        return;\n      }\n      if(e.target === this.input) {\n        return;\n      }\n\n      this.hidePicker();\n      document.removeEventListener('mousedown', onMouseDown, {capture: true});\n      mouseDownHandlerAttached = false;\n    };\n\n    /* false && this.input.addEventListener('blur', function(this: typeof this.input, e) {\n      hidePicker();\n\n      e.cancelBubble = true;\n    }, {capture: true}); */\n\n    const onKeyPress = (e: KeyboardEvent) => {\n      const key = e.key;\n      if(e.ctrlKey || key === 'Control') return false;\n\n      // let i = new RegExp('^' + this.value, 'i');\n      const _value = this.value.toLowerCase();\n      const matches: HelpCountry[] = [];\n      countries.forEach((c) => {\n        const names = [\n          c.name,\n          c.default_name,\n          c.iso2\n        ];\n\n        names.filter(Boolean).forEach((name) => {\n          const abbr = name.split(' ').filter((word) => /\\w/.test(word)).map((word) => word[0]).join('');\n          if(abbr.length > 1) {\n            names.push(abbr);\n          }\n        });\n\n        const good = !!names.filter(Boolean).find((str) => str.toLowerCase().indexOf(_value) !== -1)/*  === 0 */;// i.test(c.name);\n\n        this.liMap.get(c.iso2).forEach((li) => li.style.display = good ? '' : 'none');\n        if(good) matches.push(c);\n      });\n\n      //           \n      /* if(matches.length === 1 && matches[0].li.length === 1) {\n        if(matches[0].name === lastCountrySelected) return false;\n        //console.log('clicking', matches[0]);\n\n        var clickEvent = document.createEvent('MouseEvents');\n        clickEvent.initEvent('mousedown', true, true);\n        matches[0].li[0].dispatchEvent(clickEvent);\n        return false;\n      } else  */if(matches.length === 0) {\n        countries.forEach((c) => {\n          this.liMap.get(c.iso2).forEach((li) => li.style.display = '');\n        });\n      } else if(matches.length === 1 && key === 'Enter') {\n        cancelEvent(e);\n        this.selectCountryByTarget(this.liMap.get(matches[0].iso2)[0]);\n      }\n    };\n\n    this.input.addEventListener('keyup', onKeyPress);\n    this.input.addEventListener('keydown', (e) => {\n      if(e.key === 'Enter') {\n        onKeyPress(e);\n      }\n    });\n\n    arrowDown.addEventListener('mousedown', (e) => {\n      if(this.input.matches(':focus')) {\n        this.hidePicker();\n        this.input.blur();\n      } else {\n        e.cancelBubble = true;\n        e.preventDefault();\n        this.input.focus();\n      }\n    });\n  }\n\n  public getSelected() {\n    return {country: this.lastCountrySelected, code: this.lastCountryCodeSelected};\n  }\n\n  public hidePicker = () => {\n    if(this.hideTimeout !== undefined) return;\n    this.selectWrapper.classList.remove('active');\n    this.hideTimeout = window.setTimeout(() => {\n      this.selectWrapper.classList.add('hide');\n      this.hideTimeout = undefined;\n    }, 200);\n  }\n\n  public selectCountryByTarget = (target: HTMLElement) => {\n    const defaultName = target.querySelector<HTMLElement>('[data-default-name]').dataset.defaultName;\n    const phoneCodeEl = target.querySelector<HTMLElement>('.phone-code');\n    const phoneCode = phoneCodeEl?.innerText;\n    const countryCode = phoneCode && phoneCode.replace(/\\D/g, '');\n\n    replaceContent(this.input, i18n(defaultName as any));\n    simulateEvent(this.input, 'input');\n    this.lastCountrySelected = countries.find((c) => c.default_name === defaultName);\n    this.lastCountryCodeSelected = countryCode && this.lastCountrySelected.country_codes.find((_countryCode) => _countryCode.country_code === countryCode);\n\n    this.options.onCountryChange?.(this.lastCountrySelected, this.lastCountryCodeSelected);\n    this.hidePicker();\n  }\n\n  public selectCountryByIso2(iso2: string) {\n    this.selectCountryByTarget(this.liMap.get(iso2)[0]);\n  }\n\n  public override(country: HelpCountry, code: HelpCountryCode, countryName?: string) {\n    replaceContent(this.input, country ? i18n(country.default_name as any) : countryName);\n    this.lastCountrySelected = country;\n    this.lastCountryCodeSelected = code;\n    this.options.onCountryChange?.(this.lastCountrySelected, this.lastCountryCodeSelected);\n  }\n}\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nexport default class DivAndCaption<T> {\r\n  public container: HTMLElement;\r\n  public border: HTMLElement;\r\n  public content: HTMLElement;\r\n  public title: HTMLElement;\r\n  public subtitle: HTMLElement;\r\n\r\n  constructor(protected className: string, public fill?: T) {\r\n    this.container = document.createElement('div');\r\n    this.container.className = className;\r\n\r\n    this.border = document.createElement('div');\r\n    this.border.classList.add(className + '-border');\r\n\r\n    this.content = document.createElement('div');\r\n    this.content.classList.add(className + '-content');\r\n\r\n    this.title = document.createElement('div');\r\n    this.title.classList.add(className + '-title');\r\n    this.title.setAttribute('dir', 'auto');\r\n\r\n    this.subtitle = document.createElement('div');\r\n    this.subtitle.classList.add(className + '-subtitle');\r\n    this.subtitle.setAttribute('dir', 'auto');\r\n\r\n    this.content.append(this.title, this.subtitle);\r\n    this.container.append(this.border, this.content);\r\n  }\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport {InputFile} from '../layer';\r\nimport AvatarEdit from './avatarEdit';\r\nimport AvatarElement from './avatar';\r\nimport InputField from './inputField';\r\nimport ListenerSetter from '../helpers/listenerSetter';\r\nimport ButtonCorner from './buttonCorner';\r\nimport safeAssign from '../helpers/object/safeAssign';\r\n\r\nexport default class EditPeer {\r\n  public nextBtn: HTMLButtonElement;\r\n\r\n  public uploadAvatar: () => Promise<InputFile>;\r\n  public avatarEdit: AvatarEdit;\r\n  public avatarElem: AvatarElement;\r\n\r\n  private inputFields: InputField[];\r\n  private listenerSetter: ListenerSetter;\r\n\r\n  private peerId: PeerId;\r\n\r\n  private _disabled = false;\r\n  private avatarSize = 120;\r\n\r\n  constructor(options: {\r\n    peerId?: EditPeer['peerId'],\r\n    inputFields: EditPeer['inputFields'],\r\n    listenerSetter: ListenerSetter,\r\n    doNotEditAvatar?: boolean,\r\n    withoutAvatar?: boolean,\r\n    nextBtn?: HTMLButtonElement,\r\n    avatarSize?: number\r\n  }) {\r\n    safeAssign(this, options);\r\n\r\n    if(!this.nextBtn) {\r\n      this.nextBtn = ButtonCorner({icon: 'check'});\r\n    } else if(!this.nextBtn.classList.contains('btn-corner')) {\r\n      this.handleChange = () => {\r\n        this.nextBtn.toggleAttribute('disabled', !this.isChanged() || this.disabled);\r\n      };\r\n    }\r\n\r\n    if(!options.withoutAvatar) {\r\n      this.avatarElem = document.createElement('avatar-element') as AvatarElement;\r\n      this.avatarElem.classList.add('avatar-placeholder', 'avatar-' + this.avatarSize);\r\n      this.avatarElem.updateWithOptions({peerId: this.peerId});\r\n\r\n      if(!options.doNotEditAvatar) {\r\n        this.avatarEdit = new AvatarEdit((_upload) => {\r\n          this.uploadAvatar = _upload;\r\n          this.handleChange();\r\n          this.avatarElem.remove();\r\n        });\r\n\r\n        this.avatarEdit.container.append(this.avatarElem);\r\n      }\r\n    }\r\n\r\n    this.inputFields.forEach((inputField) => {\r\n      this.listenerSetter.add(inputField.input)('input', this.handleChange);\r\n    });\r\n\r\n    this.handleChange();\r\n  }\r\n\r\n  public get disabled() {\r\n    return this._disabled;\r\n  }\r\n\r\n  public set disabled(value) {\r\n    this._disabled = value;\r\n    this.inputFields.forEach((inputField) => inputField.input.toggleAttribute('disabled', value));\r\n    this.handleChange();\r\n  }\r\n\r\n  public lockWithPromise(promise: Promise<any>, unlockOnSuccess = false) {\r\n    this.disabled = true;\r\n    promise.then(() => {\r\n      if(unlockOnSuccess) {\r\n        this.disabled = false;\r\n      }\r\n    }, () => {\r\n      this.disabled = false;\r\n    });\r\n  }\r\n\r\n  public isChanged = () => {\r\n    if(this.uploadAvatar) {\r\n      return true;\r\n    }\r\n\r\n    let changedLength = 0, requiredLength = 0, requiredValidLength = 0;\r\n    this.inputFields.forEach((inputField) => {\r\n      if(inputField.isValid()) {\r\n        if(inputField.isChanged()) {\r\n          ++changedLength;\r\n        }\r\n\r\n        if(inputField.required) {\r\n          ++requiredValidLength;\r\n        }\r\n      }\r\n\r\n      if(inputField.required) {\r\n        ++requiredLength;\r\n      }\r\n    });\r\n\r\n    return requiredLength === requiredValidLength && changedLength > 0;\r\n  };\r\n\r\n  public handleChange = () => {\r\n    this.nextBtn.classList.toggle('is-visible', this.isChanged());\r\n  };\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport emoticonsDropdown, {EmoticonsDropdown, EmoticonsTab, EMOTICONSSTICKERGROUP} from '..';\r\nimport GifsMasonry from '../../gifsMasonry';\r\nimport Scrollable from '../../scrollable';\r\nimport {putPreloader} from '../../putPreloader';\r\nimport {AppManagers} from '../../../lib/appManagers/managers';\r\nimport {attachClickEvent} from '../../../helpers/dom/clickEvent';\r\n\r\nexport default class GifsTab implements EmoticonsTab {\r\n  private content: HTMLElement;\r\n\r\n  constructor(private managers: AppManagers) {\r\n\r\n  }\r\n\r\n  init() {\r\n    this.content = document.getElementById('content-gifs');\r\n    const gifsContainer = this.content.firstElementChild as HTMLDivElement;\r\n    attachClickEvent(gifsContainer, EmoticonsDropdown.onMediaClick);\r\n\r\n    const scroll = new Scrollable(this.content, 'GIFS');\r\n    const masonry = new GifsMasonry(gifsContainer, EMOTICONSSTICKERGROUP, scroll);\r\n    const preloader = putPreloader(this.content, true);\r\n\r\n    this.managers.appDocsManager.getGifs().then((docs) => {\r\n      docs.forEach((doc) => {\r\n        masonry.add(doc);\r\n      });\r\n\r\n      preloader.remove();\r\n    });\r\n\r\n    emoticonsDropdown.addLazyLoadQueueRepeat(masonry.lazyLoadQueue, masonry.processInvisibleDiv);\r\n\r\n    this.init = null;\r\n  }\r\n\r\n  onClose() {\r\n\r\n  }\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport {SliderSuperTab} from '../../slider';\r\nimport InputSearch from '../../inputSearch';\r\nimport animationIntersector, {AnimationItemGroup} from '../../animationIntersector';\r\nimport appSidebarRight from '..';\r\nimport {AppInlineBotsManager} from '../../../lib/appManagers/appInlineBotsManager';\r\nimport GifsMasonry from '../../gifsMasonry';\r\nimport appImManager from '../../../lib/appManagers/appImManager';\r\nimport type {MyDocument} from '../../../lib/appManagers/appDocsManager';\r\nimport mediaSizes from '../../../helpers/mediaSizes';\r\nimport findUpClassName from '../../../helpers/dom/findUpClassName';\r\nimport {attachClickEvent} from '../../../helpers/dom/clickEvent';\r\nimport {NULL_PEER_ID} from '../../../lib/mtproto/mtproto_config';\r\n\r\nconst ANIMATIONGROUP: AnimationItemGroup = 'GIFS-SEARCH';\r\n\r\nexport default class AppGifsTab extends SliderSuperTab {\r\n  private inputSearch: InputSearch;\r\n  private gifsDiv: HTMLDivElement;\r\n\r\n  private nextOffset = '';\r\n  private loadedAll = false;\r\n\r\n  private gifBotPeerId: PeerId;\r\n  private masonry: GifsMasonry;\r\n\r\n  private searchPromise: ReturnType<AppInlineBotsManager['getInlineResults']>;\r\n\r\n  protected init() {\r\n    this.container.id = 'search-gifs-container';\r\n\r\n    this.inputSearch = new InputSearch('SearchGifsTitle', (value) => {\r\n      this.reset();\r\n      this.search(value);\r\n    });\r\n\r\n    this.title.replaceWith(this.inputSearch.container);\r\n\r\n    this.gifsDiv = document.createElement('div');\r\n    this.gifsDiv.classList.add('gifs-masonry');\r\n    attachClickEvent(this.gifsDiv, this.onGifsClick, {listenerSetter: this.listenerSetter});\r\n\r\n    this.scrollable.append(this.gifsDiv);\r\n\r\n    this.masonry = new GifsMasonry(this.gifsDiv, ANIMATIONGROUP, this.scrollable);\r\n    // this.backBtn.parentElement.append(this.inputSearch.container);\r\n  }\r\n\r\n  private onGifsClick = (e: MouseEvent | TouchEvent) => {\r\n    const target = findUpClassName(e.target, 'gif');\r\n    if(!target) return;\r\n\r\n    const fileId = target.dataset.docId;\r\n    if(appImManager.chat.input.sendMessageWithDocument(fileId)) {\r\n      if(mediaSizes.isMobile) {\r\n        appSidebarRight.onCloseBtnClick();\r\n      }\r\n    } else {\r\n      console.warn('got no doc by id:', fileId);\r\n    }\r\n  };\r\n\r\n  public onClose() {\r\n    this.scrollable.onScrolledBottom = () => {};\r\n  }\r\n\r\n  public onCloseAfterTimeout() {\r\n    this.reset();\r\n    this.gifsDiv.innerHTML = '';\r\n    animationIntersector.checkAnimations(undefined, ANIMATIONGROUP);\r\n    this.inputSearch.remove();\r\n    return super.onCloseAfterTimeout();\r\n  }\r\n\r\n  private reset() {\r\n    this.searchPromise = null;\r\n    this.nextOffset = '';\r\n    this.loadedAll = false;\r\n    this.masonry.clear();\r\n  }\r\n\r\n  public open() {\r\n    const ret = super.open();\r\n    appSidebarRight.toggleSidebar(true).then(() => {\r\n      this.search('', true);\r\n\r\n      this.scrollable.onScrolledBottom = () => {\r\n        this.search(this.inputSearch.value, false);\r\n      };\r\n    });\r\n    return ret;\r\n  }\r\n\r\n  public async search(query: string, newSearch = true) {\r\n    if(this.searchPromise || this.loadedAll) return;\r\n\r\n    if(!this.gifBotPeerId) {\r\n      this.gifBotPeerId = (await this.managers.appUsersManager.resolveUsername('gif')).id.toPeerId(false);\r\n    }\r\n\r\n    try {\r\n      this.searchPromise = this.managers.appInlineBotsManager.getInlineResults(NULL_PEER_ID, this.gifBotPeerId, query, this.nextOffset);\r\n      const {results, next_offset} = await this.searchPromise;\r\n\r\n      if(this.inputSearch.value !== query) {\r\n        return;\r\n      }\r\n\r\n      this.searchPromise = null;\r\n      this.nextOffset = next_offset;\r\n      if(newSearch) {\r\n        this.gifsDiv.innerHTML = '';\r\n      }\r\n\r\n      if(results.length) {\r\n        results.forEach((result) => {\r\n          if(result._ === 'botInlineMediaResult' && result.document) {\r\n            this.masonry.add(result.document as MyDocument);\r\n          }\r\n        });\r\n      } else {\r\n        this.loadedAll = true;\r\n      }\r\n\r\n      this.scrollable.onScroll();\r\n    } catch(err) {\r\n      this.searchPromise = null;\r\n      console.error('gifs loading error:', err);\r\n      throw err;\r\n    }\r\n  }\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport {SliderSuperTab} from '../../slider';\r\nimport InputSearch from '../../inputSearch';\r\nimport LazyLoadQueue from '../../lazyLoadQueue';\r\nimport appImManager from '../../../lib/appManagers/appImManager';\r\nimport PopupStickers from '../../popups/stickers';\r\nimport animationIntersector from '../../animationIntersector';\r\nimport {wrapSticker} from '../../wrappers';\r\nimport appSidebarRight from '..';\r\nimport {StickerSet, StickerSetCovered} from '../../../layer';\r\nimport {i18n} from '../../../lib/langPack';\r\nimport findUpClassName from '../../../helpers/dom/findUpClassName';\r\nimport {attachClickEvent} from '../../../helpers/dom/clickEvent';\r\nimport forEachReverse from '../../../helpers/array/forEachReverse';\r\nimport setInnerHTML from '../../../helpers/dom/setInnerHTML';\r\nimport wrapEmojiText from '../../../lib/richTextProcessor/wrapEmojiText';\r\nimport attachStickerViewerListeners from '../../stickerViewer';\r\n\r\nexport default class AppStickersTab extends SliderSuperTab {\r\n  private inputSearch: InputSearch;\r\n  private setsDiv: HTMLDivElement;\r\n  private lazyLoadQueue: LazyLoadQueue;\r\n\r\n  protected init() {\r\n    this.container.id = 'stickers-container';\r\n    this.container.classList.add('chatlist-container');\r\n\r\n    this.lazyLoadQueue = new LazyLoadQueue();\r\n\r\n    this.inputSearch = new InputSearch('StickersTab.SearchPlaceholder', (value) => {\r\n      this.search(value);\r\n    });\r\n\r\n    this.title.replaceWith(this.inputSearch.container);\r\n\r\n    this.setsDiv = document.createElement('div');\r\n    this.setsDiv.classList.add('sticker-sets');\r\n    this.scrollable.append(this.setsDiv);\r\n\r\n    attachStickerViewerListeners({listenTo: this.setsDiv, listenerSetter: this.listenerSetter});\r\n\r\n    attachClickEvent(this.setsDiv, (e) => {\r\n      const sticker = findUpClassName(e.target, 'sticker-set-sticker');\r\n      if(sticker) {\r\n        const docId = sticker.dataset.docId;\r\n        appImManager.chat.input.sendMessageWithDocument(docId);\r\n        return;\r\n      }\r\n\r\n      const target = findUpClassName(e.target, 'sticker-set');\r\n      if(!target) return;\r\n\r\n      const id = target.dataset.stickerSet as string;\r\n      const access_hash = target.dataset.access_hash as string;\r\n\r\n      const button = findUpClassName(e.target, 'sticker-set-button') as HTMLElement;\r\n      if(button) {\r\n        e.preventDefault();\r\n        e.cancelBubble = true;\r\n\r\n        button.setAttribute('disabled', 'true');\r\n\r\n        this.managers.appStickersManager.getStickerSet({id, access_hash}).then((full) => {\r\n          this.managers.appStickersManager.toggleStickerSet(full.set).then((changed) => {\r\n            if(changed) {\r\n              button.textContent = '';\r\n              button.append(i18n(full.set.installed_date ? 'Stickers.SearchAdded' : 'Stickers.SearchAdd'));\r\n              button.classList.toggle('gray', !!full.set.installed_date);\r\n            }\r\n          }).finally(() => {\r\n            // button.style.width = set.installed_date ? '68px' : '52px';\r\n            button.removeAttribute('disabled');\r\n          });\r\n        });\r\n      } else {\r\n        this.managers.appStickersManager.getStickerSet({id, access_hash}).then((full) => {\r\n          new PopupStickers(full.set).show();\r\n        });\r\n      }\r\n    }, {listenerSetter: this.listenerSetter});\r\n  }\r\n\r\n  public onCloseAfterTimeout() {\r\n    this.setsDiv.innerHTML = '';\r\n    animationIntersector.checkAnimations(undefined, 'STICKERS-SEARCH');\r\n    return super.onCloseAfterTimeout();\r\n  }\r\n\r\n  public renderSet(set: StickerSet.stickerSet) {\r\n    // console.log('renderSet:', set);\r\n    const div = document.createElement('div');\r\n    div.classList.add('sticker-set');\r\n\r\n    const header = document.createElement('div');\r\n    header.classList.add('sticker-set-header');\r\n\r\n    const details = document.createElement('div');\r\n    details.classList.add('sticker-set-details');\r\n    details.innerHTML = `<div class=\"sticker-set-name\"></div>`;\r\n\r\n    setInnerHTML(details.firstElementChild, wrapEmojiText(set.title));\r\n\r\n    const countDiv = document.createElement('div');\r\n    countDiv.classList.add('sticker-set-count');\r\n    countDiv.append(i18n('Stickers', [set.count]));\r\n    details.append(countDiv);\r\n\r\n    const button = document.createElement('button');\r\n    button.classList.add('btn-primary', 'btn-color-primary', 'sticker-set-button');\r\n    button.append(i18n(set.installed_date ? 'Stickers.SearchAdded' : 'Stickers.SearchAdd'));\r\n    // button.style.width = set.installed_date ? '68px' : '52px';\r\n\r\n    if(set.installed_date) {\r\n      button.classList.add('gray');\r\n    }\r\n\r\n    // ripple(button);\r\n\r\n    header.append(details, button);\r\n\r\n    const stickersDiv = document.createElement('div');\r\n    stickersDiv.classList.add('sticker-set-stickers');\r\n\r\n    const count = Math.min(5, set.count);\r\n    for(let i = 0; i < count; ++i) {\r\n      const stickerDiv = document.createElement('div');\r\n      stickerDiv.classList.add('sticker-set-sticker');\r\n\r\n      stickersDiv.append(stickerDiv);\r\n    }\r\n\r\n    this.managers.appStickersManager.getStickerSet(set).then((set) => {\r\n      // console.log('renderSet got set:', set);\r\n\r\n      for(let i = 0; i < count; ++i) {\r\n        const div = stickersDiv.children[i] as HTMLDivElement;\r\n        const doc = set.documents[i];\r\n        if(doc._ === 'documentEmpty') {\r\n          continue;\r\n        }\r\n\r\n        wrapSticker({\r\n          doc,\r\n          div,\r\n          lazyLoadQueue: this.lazyLoadQueue,\r\n          group: 'STICKERS-SEARCH',\r\n          /* play: false,\r\n          loop: false, */\r\n          play: true,\r\n          loop: true,\r\n          width: 68,\r\n          height: 68,\r\n          withLock: true\r\n        });\r\n      }\r\n    });\r\n\r\n    /* const onMouseOver = () => {\r\n      const animations: AnimationItem['animation'][] = [];\r\n      for(let i = 0; i < count; ++i) {\r\n        const stickerDiv = stickersDiv.children[i] as HTMLElement;\r\n        const animationItem = animationIntersector.getAnimation(stickerDiv);\r\n        if(!animationItem) continue;\r\n\r\n        const animation = animationItem.animation;\r\n\r\n        animations.push(animation);\r\n        animation.loop = true;\r\n        animation.play();\r\n      }\r\n\r\n      div.addEventListener('mouseout', () => {\r\n        animations.forEach((animation) => {\r\n          animation.loop = false;\r\n        });\r\n\r\n        div.addEventListener('mouseover', onMouseOver, {once: true});\r\n      }, {once: true});\r\n    };\r\n\r\n    div.addEventListener('mouseover', onMouseOver, {once: true}); */\r\n\r\n    div.dataset.stickerSet = '' + set.id;\r\n    div.dataset.access_hash = '' + set.access_hash;\r\n    div.dataset.title = set.title;\r\n\r\n    div.append(header, stickersDiv);\r\n\r\n    this.setsDiv.append(div);\r\n  }\r\n\r\n  public open() {\r\n    const ret = super.open();\r\n    appSidebarRight.toggleSidebar(true).then(() => {\r\n      this.renderFeatured();\r\n    });\r\n\r\n    return ret;\r\n  }\r\n\r\n  public renderFeatured() {\r\n    return this.managers.appStickersManager.getFeaturedStickers().then((coveredSets) => {\r\n      if(this.inputSearch.value) {\r\n        return;\r\n      }\r\n\r\n      coveredSets = this.filterRendered('', coveredSets);\r\n      coveredSets.forEach((set) => {\r\n        this.renderSet(set.set);\r\n      });\r\n    });\r\n  }\r\n\r\n  private filterRendered(query: string, coveredSets: StickerSetCovered[]) {\r\n    coveredSets = coveredSets.slice();\r\n\r\n    const children = Array.from(this.setsDiv.children) as HTMLElement[];\r\n    forEachReverse(children, el => {\r\n      const id = el.dataset.stickerSet;\r\n      const index = coveredSets.findIndex((covered) => covered.set.id === id);\r\n\r\n      if(index !== -1) {\r\n        coveredSets.splice(index, 1);\r\n      } else if(!query || !el.dataset.title.toLowerCase().includes(query.toLowerCase())) {\r\n        el.remove();\r\n      }\r\n    });\r\n\r\n    animationIntersector.checkAnimations(undefined, 'STICKERS-SEARCH');\r\n\r\n    return coveredSets;\r\n  }\r\n\r\n  public search(query: string) {\r\n    if(!query) {\r\n      return this.renderFeatured();\r\n    }\r\n\r\n    return this.managers.appStickersManager.searchStickerSets(query, false).then((coveredSets) => {\r\n      if(this.inputSearch.value !== query) {\r\n        return;\r\n      }\r\n\r\n      // console.log('search result:', coveredSets);\r\n\r\n      coveredSets = this.filterRendered(query, coveredSets);\r\n      coveredSets.forEach((set) => {\r\n        this.renderSet(set.set);\r\n      });\r\n    });\r\n  }\r\n}\r\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport IS_TOUCH_SUPPORTED from '../../environment/touchSupport';\nimport appImManager from '../../lib/appManagers/appImManager';\nimport rootScope from '../../lib/rootScope';\nimport animationIntersector, {AnimationItemGroup} from '../animationIntersector';\nimport {horizontalMenu} from '../horizontalMenu';\nimport LazyLoadQueue from '../lazyLoadQueue';\nimport Scrollable, {ScrollableX} from '../scrollable';\nimport appSidebarRight from '../sidebarRight';\nimport StickyIntersector from '../stickyIntersector';\nimport EmojiTab from './tabs/emoji';\nimport GifsTab from './tabs/gifs';\nimport StickersTab from './tabs/stickers';\nimport {MOUNT_CLASS_TO} from '../../config/debug';\nimport AppGifsTab from '../sidebarRight/tabs/gifs';\nimport AppStickersTab from '../sidebarRight/tabs/stickers';\nimport findUpClassName from '../../helpers/dom/findUpClassName';\nimport findUpTag from '../../helpers/dom/findUpTag';\nimport blurActiveElement from '../../helpers/dom/blurActiveElement';\nimport whichChild from '../../helpers/dom/whichChild';\nimport cancelEvent from '../../helpers/dom/cancelEvent';\nimport DropdownHover from '../../helpers/dropdownHover';\nimport pause from '../../helpers/schedulers/pause';\nimport {IS_APPLE_MOBILE} from '../../environment/userAgent';\nimport {AppManagers} from '../../lib/appManagers/managers';\nimport type LazyLoadQueueIntersector from '../lazyLoadQueueIntersector';\nimport {simulateClickEvent} from '../../helpers/dom/clickEvent';\nimport overlayCounter from '../../helpers/overlayCounter';\n\nexport const EMOTICONSSTICKERGROUP: AnimationItemGroup = 'emoticons-dropdown';\n\nexport interface EmoticonsTab {\n  init: () => void,\n  onCloseAfterTimeout?: () => void\n}\n\nexport class EmoticonsDropdown extends DropdownHover {\n  public static lazyLoadQueue = new LazyLoadQueue();\n\n  private emojiTab: EmojiTab;\n  public stickersTab: StickersTab;\n  private gifsTab: GifsTab;\n\n  private container: HTMLElement;\n  private tabsEl: HTMLElement;\n  private tabId = -1;\n\n  private tabs: {[id: number]: EmoticonsTab};\n\n  private searchButton: HTMLElement;\n  private deleteBtn: HTMLElement;\n\n  private selectTab: ReturnType<typeof horizontalMenu>;\n\n  private savedRange: Range;\n  private managers: AppManagers;\n\n  constructor() {\n    super({\n      element: document.getElementById('emoji-dropdown') as HTMLDivElement\n    });\n\n    this.addEventListener('open', async() => {\n      if(IS_TOUCH_SUPPORTED) {\n        // appImManager.chat.input.saveScroll();\n        if(blurActiveElement()) {\n          await pause(100);\n        }\n      }\n\n      if(this.element.parentElement !== appImManager.chat.input.chatInput) {\n        appImManager.chat.input.chatInput.append(this.element);\n      }\n\n      this.savedRange = this.getGoodRange();\n\n      EmoticonsDropdown.lazyLoadQueue.lock();\n      // EmoticonsDropdown.lazyLoadQueue.unlock();\n      animationIntersector.lockIntersectionGroup(EMOTICONSSTICKERGROUP);\n    });\n\n    this.addEventListener('opened', () => {\n      animationIntersector.unlockIntersectionGroup(EMOTICONSSTICKERGROUP);\n      EmoticonsDropdown.lazyLoadQueue.unlock();\n      EmoticonsDropdown.lazyLoadQueue.refresh();\n\n      // this.container.classList.remove('disable-hover');\n    });\n\n    this.addEventListener('close', () => {\n      EmoticonsDropdown.lazyLoadQueue.lock();\n      // EmoticonsDropdown.lazyLoadQueue.lock();\n\n      //      \n      animationIntersector.lockIntersectionGroup(EMOTICONSSTICKERGROUP);\n      animationIntersector.checkAnimations(true, EMOTICONSSTICKERGROUP);\n    });\n\n    this.addEventListener('closed', () => {\n      //    visible,      \n      animationIntersector.unlockIntersectionGroup(EMOTICONSSTICKERGROUP);\n      EmoticonsDropdown.lazyLoadQueue.unlock();\n      EmoticonsDropdown.lazyLoadQueue.refresh();\n\n      // this.container.classList.remove('disable-hover');\n\n      this.savedRange = undefined;\n    });\n  }\n\n  protected init() {\n    this.managers = rootScope.managers;\n    this.emojiTab = new EmojiTab(this.managers);\n    this.stickersTab = new StickersTab(this.managers);\n    this.gifsTab = new GifsTab(this.managers);\n\n    this.tabs = {\n      0: this.emojiTab,\n      1: this.stickersTab,\n      2: this.gifsTab\n    };\n\n    this.container = this.element.querySelector('.emoji-container .tabs-container') as HTMLDivElement;\n    this.tabsEl = this.element.querySelector('.emoji-tabs') as HTMLUListElement;\n    this.selectTab = horizontalMenu(this.tabsEl, this.container, this.onSelectTabClick, () => {\n      const tab = this.tabs[this.tabId];\n      if(tab.init) {\n        tab.init();\n      }\n\n      tab.onCloseAfterTimeout && tab.onCloseAfterTimeout();\n      animationIntersector.checkAnimations(false, EMOTICONSSTICKERGROUP);\n    });\n\n    this.searchButton = this.element.querySelector('.emoji-tabs-search');\n    this.searchButton.addEventListener('click', () => {\n      if(this.tabId === 1) {\n        if(!appSidebarRight.isTabExists(AppStickersTab)) {\n          appSidebarRight.createTab(AppStickersTab).open();\n        }\n      } else {\n        if(!appSidebarRight.isTabExists(AppGifsTab)) {\n          appSidebarRight.createTab(AppGifsTab).open();\n        }\n      }\n    });\n\n    this.deleteBtn = this.element.querySelector('.emoji-tabs-delete');\n    this.deleteBtn.addEventListener('click', (e) => {\n      const input = appImManager.chat.input.messageInput;\n      if((input.lastChild as any)?.tagName) {\n        input.lastElementChild.remove();\n      } else if(input.lastChild) {\n        if(!input.lastChild.textContent.length) {\n          input.lastChild.remove();\n        } else {\n          input.lastChild.textContent = input.lastChild.textContent.slice(0, -1);\n        }\n      }\n\n      const event = new Event('input', {bubbles: true, cancelable: true});\n      appImManager.chat.input.messageInput.dispatchEvent(event);\n      // appSidebarRight.stickersTab.init();\n\n      cancelEvent(e);\n    });\n\n    const HIDE_EMOJI_TAB = IS_APPLE_MOBILE;\n\n    const INIT_TAB_ID = HIDE_EMOJI_TAB ? 1 : 0;\n\n    if(HIDE_EMOJI_TAB) {\n      (this.tabsEl.children[1] as HTMLElement).classList.add('hide');\n    }\n\n    simulateClickEvent(this.tabsEl.children[INIT_TAB_ID + 1] as HTMLElement); // set emoji tab\n    if(this.tabs[INIT_TAB_ID].init) {\n      this.tabs[INIT_TAB_ID].init(); // onTransitionEnd  , ..    \n    }\n\n    if(!IS_TOUCH_SUPPORTED) {\n      let lastMouseMoveEvent: MouseEvent, mouseMoveEventAttached = false;\n      const onMouseMove = (e: MouseEvent) => {\n        lastMouseMoveEvent = e;\n      };\n      overlayCounter.addEventListener('change', (isActive) => {\n        if(isActive) {\n          if(!mouseMoveEventAttached) {\n            document.body.addEventListener('mousemove', onMouseMove);\n            mouseMoveEventAttached = true;\n          }\n        } else if(mouseMoveEventAttached) {\n          document.body.removeEventListener('mousemove', onMouseMove);\n          if(lastMouseMoveEvent) {\n            this.onMouseOut(lastMouseMoveEvent);\n          }\n        }\n      });\n    }\n\n    appImManager.addEventListener('peer_changed', this.checkRights);\n    this.checkRights();\n\n    return super.init();\n  }\n\n  public getElement() {\n    return this.element;\n  }\n\n  private onSelectTabClick = (id: number) => {\n    if(this.tabId === id) {\n      return;\n    }\n\n    animationIntersector.checkAnimations(true, EMOTICONSSTICKERGROUP);\n\n    this.tabId = id;\n    this.searchButton.classList.toggle('hide', this.tabId === 0);\n    this.deleteBtn.classList.toggle('hide', this.tabId !== 0);\n  };\n\n  private checkRights = async() => {\n    const {peerId, threadId} = appImManager.chat;\n    const children = this.tabsEl.children;\n    const tabsElements = Array.from(children) as HTMLElement[];\n\n    const [canSendStickers, canSendGifs] = await Promise.all([\n      this.managers.appMessagesManager.canSendToPeer(peerId, threadId, 'send_stickers'),\n      this.managers.appMessagesManager.canSendToPeer(peerId, threadId, 'send_gifs')\n    ]);\n\n    tabsElements[2].toggleAttribute('disabled', !canSendStickers);\n    tabsElements[3].toggleAttribute('disabled', !canSendGifs);\n\n    const active = this.tabsEl.querySelector('.active');\n    if(active && whichChild(active) !== 1 && (!canSendStickers || !canSendGifs)) {\n      this.selectTab(0, false);\n    }\n  };\n\n  public static menuOnClick = (menu: HTMLElement, scroll: Scrollable, menuScroll?: ScrollableX, prevId = 0) => {\n    let jumpedTo = -1;\n\n    const setActive = (id: number) => {\n      if(id === prevId) {\n        return false;\n      }\n\n      menu.children[prevId].classList.remove('active');\n      menu.children[id].classList.add('active');\n      prevId = id;\n\n      return true;\n    };\n\n    const stickyIntersector = new StickyIntersector(scroll.container, (stuck, target) => {\n      // console.log('sticky scrollTOp', stuck, target, scroll.container.scrollTop);\n\n      if(Math.abs(jumpedTo - scroll.container.scrollTop) <= 1) {\n        return;\n      } else {\n        jumpedTo = -1;\n      }\n\n      const which = whichChild(target);\n      if(!stuck && which) { // * due to stickyIntersector\n        return;\n      }\n\n      setActive(which);\n\n      if(menuScroll) {\n        menuScroll.scrollIntoViewNew({\n          element: menu.children[which] as HTMLElement,\n          position: 'center',\n          axis: 'x'\n        });\n      }\n    });\n\n    menu.addEventListener('click', (e) => {\n      let target = e.target as HTMLElement;\n      target = findUpClassName(target, 'menu-horizontal-div-item');\n\n      if(!target) {\n        return;\n      }\n\n      const which = whichChild(target);\n\n      /* if(menuScroll) {\n        menuScroll.scrollIntoView(target, false, 0);\n      } */\n\n      if(!setActive(which)) {\n        return;\n      }\n\n      const element = (scroll.splitUp || scroll.container).children[which] as HTMLElement;\n      const offsetTop = element.offsetTop + 1; // * due to stickyIntersector\n\n      scroll.container.scrollTop = jumpedTo = offsetTop;\n\n      // console.log('set scrollTop:', offsetTop);\n    });\n\n    return {stickyIntersector, setActive};\n  };\n\n  public static onMediaClick = async(e: {target: EventTarget | Element}, clearDraft = false, silent?: boolean) => {\n    let target = e.target as HTMLElement;\n    target = findUpTag(target, 'DIV');\n\n    if(!target) return false;\n\n    const docId = target.dataset.docId;\n    if(!docId) return false;\n\n    return this.sendDocId(docId, clearDraft, silent);\n  };\n\n  public static async sendDocId(docId: DocId, clearDraft?: boolean, silent?: boolean) {\n    if(await appImManager.chat.input.sendMessageWithDocument(docId, undefined, clearDraft, silent)) {\n      /* dropdown.classList.remove('active');\n      toggleEl.classList.remove('active'); */\n      if(emoticonsDropdown.container) {\n        emoticonsDropdown.forceClose = true;\n        // emoticonsDropdown.container.classList.add('disable-hover');\n        emoticonsDropdown.toggle(false);\n      }\n\n      return true;\n    } else {\n      console.warn('got no doc by id:', docId);\n      return false;\n    }\n  }\n\n  public addLazyLoadQueueRepeat(lazyLoadQueue: LazyLoadQueueIntersector, processInvisibleDiv: (div: HTMLElement) => void) {\n    this.addEventListener('close', () => {\n      lazyLoadQueue.lock();\n    });\n\n    this.addEventListener('closed', () => {\n      const divs = lazyLoadQueue.intersector.getVisible();\n\n      for(const div of divs) {\n        processInvisibleDiv(div);\n      }\n\n      lazyLoadQueue.intersector.clearVisible();\n    });\n\n    this.addEventListener('opened', () => {\n      lazyLoadQueue.unlockAndRefresh();\n    });\n  }\n\n  public getSavedRange() {\n    return this.getGoodRange() || this.savedRange;\n  }\n\n  private getGoodRange() {\n    const sel = document.getSelection();\n    if(sel.rangeCount && document.activeElement === appImManager.chat.input.messageInput) {\n      return sel.getRangeAt(0);\n    }\n  }\n}\n\nconst emoticonsDropdown = new EmoticonsDropdown();\nMOUNT_CLASS_TO.emoticonsDropdown = emoticonsDropdown;\nexport default emoticonsDropdown;\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport emoticonsDropdown, {EmoticonsDropdown, EmoticonsTab} from '..';\nimport cancelEvent from '../../../helpers/dom/cancelEvent';\nimport findUpClassName from '../../../helpers/dom/findUpClassName';\nimport {fastRaf} from '../../../helpers/schedulers';\nimport pause from '../../../helpers/schedulers/pause';\nimport appImManager from '../../../lib/appManagers/appImManager';\nimport {i18n, LangPackKey} from '../../../lib/langPack';\nimport rootScope from '../../../lib/rootScope';\nimport {emojiFromCodePoints} from '../../../vendor/emoji';\nimport {putPreloader} from '../../putPreloader';\nimport Scrollable from '../../scrollable';\nimport StickyIntersector from '../../stickyIntersector';\nimport IS_EMOJI_SUPPORTED from '../../../environment/emojiSupport';\nimport IS_TOUCH_SUPPORTED from '../../../environment/touchSupport';\nimport blurActiveElement from '../../../helpers/dom/blurActiveElement';\nimport Emoji from '../../../config/emoji';\nimport {AppManagers} from '../../../lib/appManagers/managers';\nimport fixEmoji from '../../../lib/richTextProcessor/fixEmoji';\nimport wrapEmojiText from '../../../lib/richTextProcessor/wrapEmojiText';\nimport wrapSingleEmoji from '../../../lib/richTextProcessor/wrapSingleEmoji';\nimport {attachClickEvent} from '../../../helpers/dom/clickEvent';\n\nconst loadedURLs: Set<string> = new Set();\nexport function appendEmoji(emoji: string, container: HTMLElement, prepend = false, unify = false) {\n  // const emoji = details.unified;\n  // const emoji = (details.unified as string).split('-')\n  // .reduce((prev, curr) => prev + String.fromCodePoint(parseInt(curr, 16)), '');\n\n  const spanEmoji = document.createElement('span');\n  spanEmoji.classList.add('super-emoji');\n\n  let kek: DocumentFragment;\n  if(unify && !IS_EMOJI_SUPPORTED) {\n    kek = wrapSingleEmoji(emoji);\n  } else {\n    emoji = fixEmoji(emoji);\n    kek = wrapEmojiText(emoji);\n  }\n\n  /* if(!kek.includes('emoji')) {\n    console.log(emoji, kek, spanEmoji, emoji.length, new TextEncoder().encode(emoji), emojiUnicode(emoji));\n    return;\n  } */\n\n  // console.log(kek);\n\n  spanEmoji.append(kek);\n\n  if(spanEmoji.children.length > 1) {\n    const first = spanEmoji.firstElementChild;\n    spanEmoji.innerHTML = '';\n    spanEmoji.append(first);\n  }\n\n  if(spanEmoji.firstElementChild?.tagName === 'IMG') {\n    const image = spanEmoji.firstElementChild as HTMLImageElement;\n\n    const url = image.src;\n    if(!loadedURLs.has(url)) {\n      image.setAttribute('loading', 'lazy');\n      const placeholder = document.createElement('span');\n      placeholder.classList.add('emoji-placeholder');\n\n      if(rootScope.settings.animationsEnabled) {\n        image.style.opacity = '0';\n        placeholder.style.opacity = '1';\n      }\n\n      image.addEventListener('load', () => {\n        fastRaf(() => {\n          if(rootScope.settings.animationsEnabled) {\n            image.style.opacity = '';\n            placeholder.style.opacity = '';\n          }\n\n          spanEmoji.classList.remove('empty');\n\n          loadedURLs.add(url);\n        });\n      }, {once: true});\n\n      spanEmoji.append(placeholder);\n    }\n  }\n\n  // spanEmoji = spanEmoji.firstElementChild as HTMLSpanElement;\n  // spanEmoji.setAttribute('emoji', emoji);\n  if(prepend) container.prepend(spanEmoji);\n  else container.appendChild(spanEmoji);\n}\n\nexport function getEmojiFromElement(element: HTMLElement) {\n  if(!findUpClassName(element, 'super-emoji')) return '';\n\n  if(element.nodeType === 3) return element.nodeValue;\n  if(element.tagName === 'SPAN' && !element.classList.contains('emoji') && element.firstElementChild) {\n    element = element.firstElementChild as HTMLElement;\n  }\n\n  return element.getAttribute('alt') || element.innerText;\n}\n\nexport default class EmojiTab implements EmoticonsTab {\n  private content: HTMLElement;\n\n  private recentItemsDiv: HTMLElement;\n\n  private scroll: Scrollable;\n  private stickyIntersector: StickyIntersector;\n  private menu: HTMLElement;\n\n  private closeScrollTop = 0;\n  private setMenuActive: (id: number) => boolean;\n\n  constructor(private managers: AppManagers) {\n\n  }\n\n  init() {\n    this.content = document.getElementById('content-emoji') as HTMLDivElement;\n\n    const categories: LangPackKey[] = [\n      'Emoji.SmilesAndPeople',\n      'Emoji.AnimalsAndNature',\n      'Emoji.FoodAndDrink',\n      'Emoji.TravelAndPlaces',\n      'Emoji.ActivityAndSport',\n      'Emoji.Objects',\n      /* 'Emoji.Symbols',  */\n      'Emoji.Flags',\n      'Skin Tones' as any\n    ];\n    const divs: {\n      [category in LangPackKey]?: HTMLDivElement\n    } = {};\n\n    const sorted: Map<LangPackKey, string[]> = new Map([\n      [\n        'Emoji.Recent',\n        []\n      ]\n    ]);\n\n    for(const emoji in Emoji) {\n      const details = Emoji[emoji];\n      const i = '' + details;\n      const category = categories[+i[0] - 1];\n      if(!category) continue; // maybe it's skin tones\n\n      let s = sorted.get(category);\n      if(!s) {\n        s = [];\n        sorted.set(category, s);\n      }\n\n      s[+i.slice(1) || 0] = emoji;\n    }\n\n    // console.log('emoticons sorted:', sorted);\n\n    // Object.keys(sorted).forEach((c) => sorted[c].sort((a, b) => a - b));\n\n    sorted.delete(categories.pop());\n\n    // console.time('emojiParse');\n    sorted.forEach((emojis, category) => {\n      const div = document.createElement('div');\n      div.classList.add('emoji-category');\n\n      const titleDiv = document.createElement('div');\n      titleDiv.classList.add('category-title');\n      titleDiv.append(i18n(category));\n\n      const itemsDiv = document.createElement('div');\n      itemsDiv.classList.add('super-emojis');\n\n      div.append(titleDiv, itemsDiv);\n\n      emojis.forEach((unified) => {\n        /* if(emojiUnicode(emoji) === '1f481-200d-2642') {\n          console.log('append emoji', emoji, emojiUnicode(emoji));\n        } */\n\n        const emoji = emojiFromCodePoints(unified);\n        // if(emoji.includes('')) {\n        // console.log('toCodePoints', toCodePoints(emoji));\n        // emoji = emoji.replace(/(\\u200d[\\u2640\\u2642\\u2695])(?!\\ufe0f)/, '\\ufe0f$1');\n        // const zwjIndex = emoji.indexOf('\\u200d');\n        // if(zwjIndex !== -1 && !emoji.includes('\\ufe0f')) {\n        //   /* if(zwjIndex !== (emoji.length - 1)) {\n        //     emoji = emoji.replace(/(\\u200d)/g, '\\ufe0f$1');\n        //   } */\n\n        //   emoji += '\\ufe0f';\n        //   //emoji += '\\ufe0f';\n        // }\n\n        // debugger;\n        // }\n\n        appendEmoji(emoji/* .replace(/[\\ufe0f\\u2640\\u2642\\u2695]/g, '') */, itemsDiv, false/* , false */);\n\n        /* if(category === 'Smileys & Emotion') {\n          console.log('appended emoji', emoji, itemsDiv.children[itemsDiv.childElementCount - 1].innerHTML, emojiUnicode(emoji));\n        } */\n      });\n\n      divs[category] = div;\n    });\n\n    // console.timeEnd('emojiParse');\n\n    const menu = this.menu = this.content.previousElementSibling as HTMLElement;\n    const emojiScroll = this.scroll = new Scrollable(this.content, 'EMOJI');\n\n    // emojiScroll.setVirtualContainer(emojiScroll.container);\n\n    const preloader = putPreloader(this.content, true);\n\n    Promise.all([\n      pause(200),\n      this.managers.appEmojiManager.getRecentEmojis().then((recent) => {\n        const hasRecent = !!recent.length;\n        const activeId = hasRecent ? 0 : 1;\n        this.menu.children[0].classList.toggle('hide', !hasRecent);\n        this.menu.children[activeId].classList.add('active');\n        const m = EmoticonsDropdown.menuOnClick(menu, emojiScroll, undefined, activeId);\n        this.stickyIntersector = m.stickyIntersector;\n        this.setMenuActive = m.setActive;\n        return recent;\n      })\n    ]).then(([_, recent]) => {\n      preloader.remove();\n\n      this.recentItemsDiv = divs['Emoji.Recent'].querySelector('.super-emojis');\n      for(const emoji of recent) {\n        appendEmoji(emoji, this.recentItemsDiv);\n      }\n\n      this.recentItemsDiv.parentElement.classList.toggle('hide', !this.recentItemsDiv.childElementCount);\n\n      categories.unshift('Emoji.Recent');\n      categories.map((category) => {\n        const div = divs[category];\n\n        if(!div) {\n          console.error('no div by category:', category);\n        }\n\n        emojiScroll.container.append(div);\n        this.stickyIntersector.observeStickyHeaderChanges(div);\n        return div;\n      });\n    });\n\n    attachClickEvent(this.content, this.onContentClick);\n    this.init = null;\n\n    rootScope.addEventListener('emoji_recent', (emoji) => {\n      const children = Array.from(this.recentItemsDiv.children) as HTMLElement[];\n      for(let i = 0, length = children.length; i < length; ++i) {\n        const el = children[i];\n        const _emoji = fixEmoji(getEmojiFromElement(el));\n        if(emoji === _emoji) {\n          if(i === 0) {\n            return;\n          }\n\n          el.remove();\n        }\n      }\n\n      appendEmoji(emoji, this.recentItemsDiv, true);\n      this.recentItemsDiv.parentElement.classList.remove('hide');\n      this.menu.children[0].classList.remove('hide');\n\n      if(!this.closeScrollTop) {\n        this.setMenuActive(0);\n      }\n    });\n\n    emoticonsDropdown.addEventListener('close', () => {\n      this.closeScrollTop = this.scroll.scrollTop;\n    });\n  }\n\n  onContentClick = (e: MouseEvent) => {\n    cancelEvent(e);\n\n    const emoji = getEmojiFromElement(e.target as HTMLElement);\n    if(!emoji) {\n      return;\n    }\n\n    appImManager.chat.input.onEmojiSelected(emoji, false);\n    if(IS_TOUCH_SUPPORTED) {\n      blurActiveElement();\n    }\n  };\n\n  onClose() {\n\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport getEmojiEntityFromEmoji from './getEmojiEntityFromEmoji';\nimport wrapRichText from './wrapRichText';\n\nexport default function wrapSingleEmoji(emoji: string) {\n  return wrapRichText(emoji, {\n    entities: [getEmojiEntityFromEmoji(emoji)]\n  });\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport findAndSpliceAll from '../helpers/array/findAndSpliceAll';\nimport LazyLoadQueueIntersector, {LazyLoadElement} from './lazyLoadQueueIntersector';\nimport VisibilityIntersector, {OnVisibilityChange} from './visibilityIntersector';\n\nexport default class LazyLoadQueueRepeat extends LazyLoadQueueIntersector {\n  private _queue: Map<HTMLElement, LazyLoadElement> = new Map();\n\n  constructor(parallelLimit?: number, protected onVisibilityChange?: OnVisibilityChange, options?: IntersectionObserverInit) {\n    super(parallelLimit);\n\n    this.intersector = new VisibilityIntersector((item) => {\n      const {target, visible} = item;\n      const spliced = findAndSpliceAll(this.queue, (i) => i.div === target);\n      if(visible) {\n        const items = spliced.length ? spliced : [this._queue.get(target)];\n        items.forEach((item) => {\n          this.queue.unshift(item || this._queue.get(target));\n        });\n      }\n\n      this.onVisibilityChange && this.onVisibilityChange(item);\n      this.setProcessQueueTimeout();\n    }, options);\n  }\n\n  public clear() {\n    super.clear();\n    this._queue.clear();\n  }\n\n  /* public async processItem(item: LazyLoadElement) {\n    //await super.processItem(item);\n    await LazyLoadQueueBase.prototype.processItem.call(this, item);\n\n    if(this.lazyLoadMedia.length) {\n      this.processQueue();\n    }\n  } */\n\n  public observe(el: LazyLoadElement) {\n    this._queue.set(el.div, el);\n    this.intersector.observe(el.div);\n  }\n}\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport emoticonsDropdown, {EmoticonsDropdown, EMOTICONSSTICKERGROUP, EmoticonsTab} from '..';\r\nimport findUpClassName from '../../../helpers/dom/findUpClassName';\r\nimport mediaSizes from '../../../helpers/mediaSizes';\r\nimport {MessagesAllStickers, StickerSet} from '../../../layer';\r\nimport {MyDocument} from '../../../lib/appManagers/appDocsManager';\r\nimport {AppManagers} from '../../../lib/appManagers/managers';\r\nimport {i18n, LangPackKey} from '../../../lib/langPack';\r\nimport wrapEmojiText from '../../../lib/richTextProcessor/wrapEmojiText';\r\nimport rootScope from '../../../lib/rootScope';\r\nimport animationIntersector, {AnimationItemGroup} from '../../animationIntersector';\r\nimport LazyLoadQueue from '../../lazyLoadQueue';\r\nimport LazyLoadQueueRepeat from '../../lazyLoadQueueRepeat';\r\nimport {putPreloader} from '../../putPreloader';\r\nimport PopupStickers from '../../popups/stickers';\r\nimport Scrollable, {ScrollableX} from '../../scrollable';\r\nimport StickyIntersector from '../../stickyIntersector';\r\nimport {wrapSticker, wrapStickerSetThumb} from '../../wrappers';\r\nimport findAndSplice from '../../../helpers/array/findAndSplice';\r\nimport {attachClickEvent} from '../../../helpers/dom/clickEvent';\r\nimport positionElementByIndex from '../../../helpers/dom/positionElementByIndex';\r\nimport noop from '../../../helpers/noop';\r\nimport ButtonIcon from '../../buttonIcon';\r\nimport confirmationPopup from '../../confirmationPopup';\r\nimport VisibilityIntersector, {OnVisibilityChange} from '../../visibilityIntersector';\r\nimport createStickersContextMenu from '../../../helpers/dom/createStickersContextMenu';\r\nimport findUpAsChild from '../../../helpers/dom/findUpAsChild';\r\nimport forEachReverse from '../../../helpers/array/forEachReverse';\r\nimport {MTAppConfig} from '../../../lib/mtproto/appConfig';\r\nimport attachStickerViewerListeners from '../../stickerViewer';\r\nimport ListenerSetter from '../../../helpers/listenerSetter';\r\n\r\nexport class SuperStickerRenderer {\r\n  public lazyLoadQueue: LazyLoadQueueRepeat;\r\n  private animated: Set<HTMLElement> = new Set();\r\n\r\n  constructor(\r\n    private regularLazyLoadQueue: LazyLoadQueue,\r\n    private group: AnimationItemGroup,\r\n    private managers: AppManagers,\r\n    private options?: IntersectionObserverInit\r\n  ) {\r\n    this.lazyLoadQueue = new LazyLoadQueueRepeat(undefined, ({target, visible}) => {\r\n      if(!visible) {\r\n        this.processInvisible(target);\r\n      }\r\n    }, options);\r\n  }\r\n\r\n  public clear() {\r\n    this.lazyLoadQueue.clear();\r\n  }\r\n\r\n  public renderSticker(doc: MyDocument, element?: HTMLElement, loadPromises?: Promise<any>[]) {\r\n    if(!element) {\r\n      element = document.createElement('div');\r\n      element.classList.add('grid-item', 'super-sticker');\r\n      element.dataset.docId = '' + doc.id;\r\n\r\n      if(doc.animated) {\r\n        this.observeAnimated(element);\r\n      }\r\n    }\r\n\r\n    // * This will wrap only a thumb\r\n    /* !doc.animated &&  */wrapSticker({\r\n      doc,\r\n      div: element,\r\n      lazyLoadQueue: this.regularLazyLoadQueue,\r\n      group: this.group,\r\n      onlyThumb: doc.animated,\r\n      loadPromises\r\n    });\r\n\r\n    return element;\r\n  }\r\n\r\n  public observeAnimated(element: HTMLElement) {\r\n    this.animated.add(element);\r\n    this.lazyLoadQueue.observe({\r\n      div: element,\r\n      load: this.processVisible\r\n    });\r\n  }\r\n\r\n  public unobserveAnimated(element: HTMLElement) {\r\n    this.animated.delete(element);\r\n    this.lazyLoadQueue.unobserve(element);\r\n  }\r\n\r\n  private checkAnimationContainer = (element: HTMLElement, visible: boolean) => {\r\n    // console.error('checkAnimationContainer', div, visible);\r\n    const players = animationIntersector.getAnimations(element);\r\n    players.forEach((player) => {\r\n      if(!visible) {\r\n        animationIntersector.checkAnimation(player, true, true);\r\n      } else {\r\n        animationIntersector.checkAnimation(player, false);\r\n      }\r\n    });\r\n  };\r\n\r\n  private processVisible = async(element: HTMLElement) => {\r\n    const docId = element.dataset.docId;\r\n    const doc = await this.managers.appDocsManager.getDoc(docId);\r\n\r\n    const size = mediaSizes.active.esgSticker.width;\r\n\r\n    // console.log('processVisibleDiv:', div);\r\n\r\n    const promise = wrapSticker({\r\n      doc,\r\n      div: element,\r\n      width: size,\r\n      height: size,\r\n      lazyLoadQueue: null,\r\n      group: this.group,\r\n      onlyThumb: false,\r\n      play: true,\r\n      loop: true,\r\n      withLock: true\r\n    }).then(({render}) => render);\r\n\r\n    promise.then(() => {\r\n      // clearTimeout(timeout);\r\n      this.checkAnimationContainer(element, this.lazyLoadQueue.intersector.isVisible(element));\r\n    });\r\n\r\n    /* let timeout = window.setTimeout(() => {\r\n      console.error('processVisibleDiv timeout', div, doc);\r\n    }, 1e3); */\r\n\r\n    return promise;\r\n  };\r\n\r\n  public processInvisible = async(element: HTMLElement) => {\r\n    const docId = element.dataset.docId;\r\n    const doc = await this.managers.appDocsManager.getDoc(docId);\r\n\r\n    // console.log('STICKER INvisible:', /* div,  */docId);\r\n\r\n    this.checkAnimationContainer(element, false);\r\n\r\n    element.textContent = '';\r\n    this.renderSticker(doc, element as HTMLDivElement);\r\n  };\r\n}\r\n\r\ntype StickersTabCategory = {\r\n  elements: {\r\n    container: HTMLElement,\r\n    title: HTMLElement,\r\n    items: HTMLElement,\r\n    menuTab: HTMLElement,\r\n    menuTabPadding: HTMLElement\r\n  },\r\n  set: StickerSet.stickerSet,\r\n  items: {\r\n    document: MyDocument,\r\n    element: HTMLElement\r\n  }[],\r\n  mounted?: boolean,\r\n  id: string,\r\n  limit?: number\r\n};\r\n\r\nexport default class StickersTab implements EmoticonsTab {\r\n  private content: HTMLElement;\r\n\r\n  private categories: {[id: string]: StickersTabCategory};\r\n  private categoriesMap: Map<HTMLElement, StickersTabCategory>;\r\n  private categoriesIntersector: VisibilityIntersector;\r\n  private localCategories: StickersTabCategory[];\r\n\r\n  private scroll: Scrollable;\r\n  private menu: HTMLElement;\r\n  private mounted = false;\r\n  private stickyIntersector: StickyIntersector;\r\n  private superStickerRenderer: SuperStickerRenderer;\r\n\r\n  constructor(private managers: AppManagers) {\r\n    this.categories = {};\r\n    this.categoriesMap = new Map();\r\n    this.localCategories = [];\r\n  }\r\n\r\n  private setFavedLimit(appConfig: MTAppConfig) {\r\n    const limit = rootScope.premium ? appConfig.stickers_faved_limit_premium : appConfig.stickers_faved_limit_default;\r\n    const category = this.categories['faved'];\r\n    category.limit = limit;\r\n  }\r\n\r\n  private createCategory(stickerSet: StickerSet.stickerSet, _title: HTMLElement | DocumentFragment) {\r\n    const container = document.createElement('div');\r\n    container.classList.add('emoji-category', 'hide');\r\n\r\n    const items = document.createElement('div');\r\n    items.classList.add('category-items', 'super-stickers');\r\n\r\n    const title = document.createElement('div');\r\n    title.classList.add('category-title');\r\n    title.append(_title);\r\n\r\n    const menuTab = ButtonIcon(undefined, {noRipple: true});\r\n    menuTab.classList.add('menu-horizontal-div-item');\r\n\r\n    const menuTabPadding = document.createElement('div');\r\n    menuTabPadding.classList.add('menu-horizontal-div-item-padding');\r\n\r\n    menuTab.append(menuTabPadding);\r\n\r\n    const category: StickersTabCategory = {\r\n      elements: {\r\n        container,\r\n        title,\r\n        items,\r\n        menuTab,\r\n        menuTabPadding\r\n      },\r\n      set: stickerSet,\r\n      items: [],\r\n      id: '' + stickerSet.id\r\n    };\r\n\r\n    container.append(title, items);\r\n\r\n    this.categories[stickerSet.id] = category;\r\n    this.categoriesMap.set(container, category);\r\n\r\n    this.categoriesIntersector.observe(container);\r\n    this.stickyIntersector.observeStickyHeaderChanges(container);\r\n\r\n    return category;\r\n  }\r\n\r\n  private categoryAppendStickers(\r\n    category: StickersTabCategory,\r\n    promise: Promise<MyDocument[]>\r\n  ) {\r\n    const {container} = category.elements;\r\n\r\n    promise.then((documents) => {\r\n      const isVisible = this.isCategoryVisible(category);\r\n\r\n      documents.forEach((document) => {\r\n        const element = this.superStickerRenderer.renderSticker(document);\r\n        category.items.push({document, element});\r\n\r\n        if(isVisible) {\r\n          category.elements.items.append(element);\r\n        }\r\n      });\r\n\r\n      this.setCategoryItemsHeight(category);\r\n      container.classList.remove('hide');\r\n    });\r\n  }\r\n\r\n  private isCategoryVisible(category: StickersTabCategory) {\r\n    return this.categoriesIntersector.getVisible().includes(category.elements.container);\r\n  }\r\n\r\n  private setCategoryItemsHeight(category: StickersTabCategory) {\r\n    const containerWidth = this.content.getBoundingClientRect().width - 10;\r\n    const stickerSize = mediaSizes.active.esgSticker.width;\r\n\r\n    const itemsPerRow = Math.floor(containerWidth / stickerSize);\r\n    const rows = Math.ceil(category.items.length / itemsPerRow);\r\n    const height = rows * stickerSize;\r\n\r\n    category.elements.items.style.minHeight = height + 'px';\r\n  }\r\n\r\n  private async renderStickerSet(set: StickerSet.stickerSet, prepend = false) {\r\n    const category = this.createCategory(set, wrapEmojiText(set.title));\r\n    const {menuTab, menuTabPadding, container} = category.elements;\r\n\r\n    const pos = prepend ? this.localCategories.filter((category) => category.mounted).length : 0xFFFF;\r\n    positionElementByIndex(menuTab, this.menu, pos);\r\n\r\n    const promise = this.managers.appStickersManager.getStickerSet(set);\r\n    this.categoryAppendStickers(\r\n      category,\r\n      promise.then((stickerSet) => stickerSet.documents as MyDocument[])\r\n    );\r\n    // const stickerSet = await promise;\r\n\r\n    positionElementByIndex(container, this.scroll.container, pos, -1);\r\n\r\n    wrapStickerSetThumb({\r\n      set,\r\n      container: menuTabPadding,\r\n      group: EMOTICONSSTICKERGROUP,\r\n      lazyLoadQueue: EmoticonsDropdown.lazyLoadQueue,\r\n      width: 32,\r\n      height: 32,\r\n      autoplay: false\r\n    });\r\n  }\r\n\r\n  public init() {\r\n    this.content = document.getElementById('content-stickers');\r\n    const menuWrapper = this.content.previousElementSibling as HTMLDivElement;\r\n    this.menu = menuWrapper.firstElementChild as HTMLUListElement;\r\n\r\n    const menuScroll = new ScrollableX(menuWrapper);\r\n\r\n    this.scroll = new Scrollable(this.content, 'STICKERS');\r\n    this.scroll.onAdditionalScroll = () => {\r\n      setTyping();\r\n    };\r\n\r\n    /* stickersDiv.addEventListener('mouseover', (e) => {\r\n      let target = e.target as HTMLElement;\r\n\r\n      if(target.tagName === 'CANVAS') { // turn on sticker\r\n        let animation = lottieLoader.getAnimation(target.parentElement, EMOTICONSSTICKERGROUP);\r\n\r\n        if(animation) {\r\n          // @ts-ignore\r\n          if(animation.currentFrame === animation.totalFrames - 1) {\r\n            animation.goToAndPlay(0, true);\r\n          } else {\r\n            animation.play();\r\n          }\r\n        }\r\n      }\r\n    }); */\r\n\r\n    const onCategoryVisibility: OnVisibilityChange = ({target, visible, entry}) => {\r\n      const category = this.categoriesMap.get(target);\r\n      // console.log('roll the windows up', category, target, visible, entry);\r\n      if(!visible) {\r\n        category.elements.items.textContent = '';\r\n      } else {\r\n        category.elements.items.append(...category.items.map(({element}) => element));\r\n      }\r\n    };\r\n\r\n    const intersectionOptions: IntersectionObserverInit = {root: emoticonsDropdown.getElement()};\r\n    this.categoriesIntersector = new VisibilityIntersector(onCategoryVisibility, intersectionOptions);\r\n\r\n    const clearCategoryItems = (category: StickersTabCategory) => {\r\n      category.elements.items.textContent = '';\r\n      category.items.forEach(({element}) => this.superStickerRenderer.unobserveAnimated(element));\r\n      category.items.length = 0;\r\n    };\r\n\r\n    this.scroll.container.addEventListener('click', (e) => {\r\n      const target = e.target as HTMLElement;\r\n      if(findUpClassName(target, 'category-title')) {\r\n        const container = findUpClassName(target, 'emoji-category');\r\n        const category = this.categoriesMap.get(container);\r\n        if(category.set.id === 'recent') {\r\n          return;\r\n        }\r\n\r\n        new PopupStickers({id: category.set.id, access_hash: category.set.access_hash}).show();\r\n        return;\r\n      }\r\n\r\n      EmoticonsDropdown.onMediaClick(e);\r\n    });\r\n\r\n    const setTyping = (cancel = false) => {\r\n      rootScope.dispatchEvent('choosing_sticker', !cancel);\r\n    };\r\n\r\n    emoticonsDropdown.addEventListener('closed', () => {\r\n      setTyping(true);\r\n    });\r\n\r\n    emoticonsDropdown.addEventListener('opened', () => {\r\n      setTyping();\r\n    });\r\n\r\n    const {stickyIntersector, setActive} = EmoticonsDropdown.menuOnClick(this.menu, this.scroll, menuScroll);\r\n    this.stickyIntersector = stickyIntersector;\r\n\r\n    const preloader = putPreloader(this.content, true);\r\n\r\n    const createLocalCategory = (id: string, title: LangPackKey, icon?: string) => {\r\n      const category = this.createCategory({id} as any, i18n(title));\r\n      this.localCategories.push(category);\r\n      category.elements.title.classList.add('disable-hover');\r\n      icon && category.elements.menuTab.classList.add('tgico-' + icon);\r\n      category.elements.menuTabPadding.remove();\r\n      this.toggleLocalCategory(category, false);\r\n      return category;\r\n    };\r\n\r\n    const onCategoryStickers = (category: StickersTabCategory, stickers: MyDocument[]) => {\r\n      // if(category.id === 'faved' && category.limit && category.limit < stickers.length) {\r\n      //   category.limit = stickers.length;\r\n      // }\r\n\r\n      if(category.limit) {\r\n        stickers = stickers.slice(0, category.limit);\r\n      }\r\n\r\n      const ids = new Set(stickers.map((doc) => doc.id));\r\n      forEachReverse(category.items, (item) => {\r\n        if(!ids.has(item.document.id)) {\r\n          this.deleteSticker(category, item.document, true);\r\n        }\r\n      });\r\n\r\n      this.toggleLocalCategory(category, !!stickers.length);\r\n      forEachReverse(stickers, (doc, idx) => {\r\n        this.unshiftSticker(category, doc, true, idx);\r\n      });\r\n      this.spliceExceed(category);\r\n      category.elements.container.classList.remove('hide');\r\n    };\r\n\r\n    const favedCategory = createLocalCategory('faved', 'FavoriteStickers', 'saved');\r\n    favedCategory.elements.menuTab.classList.add('active');\r\n\r\n    const recentCategory = createLocalCategory('recent', 'Stickers.Recent', 'recent');\r\n    recentCategory.limit = 20;\r\n    // recentCategory.elements.menuTab.classList.add('active');\r\n\r\n    const clearButton = ButtonIcon('close', {noRipple: true});\r\n    recentCategory.elements.title.append(clearButton);\r\n    attachClickEvent(clearButton, () => {\r\n      confirmationPopup({\r\n        titleLangKey: 'ClearRecentStickersAlertTitle',\r\n        descriptionLangKey: 'ClearRecentStickersAlertMessage',\r\n        button: {\r\n          langKey: 'Clear'\r\n        }\r\n      }).then(() => {\r\n        this.managers.appStickersManager.clearRecentStickers();\r\n      }, noop);\r\n    });\r\n\r\n    const premiumCategory = createLocalCategory('premium', 'PremiumStickersShort');\r\n    const s = document.createElement('span');\r\n    s.classList.add('tgico-star', 'color-premium');\r\n    premiumCategory.elements.menuTab.append(s);\r\n\r\n    const promises = [\r\n      Promise.all([\r\n        this.managers.apiManager.getAppConfig(),\r\n        this.managers.appStickersManager.getFavedStickersStickers()\r\n      ]).then(([appConfig, stickers]) => {\r\n        this.setFavedLimit(appConfig);\r\n        onCategoryStickers(favedCategory, stickers);\r\n      }),\r\n\r\n      this.managers.appStickersManager.getRecentStickersStickers().then((stickers) => {\r\n        onCategoryStickers(recentCategory, stickers);\r\n      }),\r\n\r\n      this.managers.appStickersManager.getAllStickers().then((res) => {\r\n        for(const set of (res as MessagesAllStickers.messagesAllStickers).sets) {\r\n          this.renderStickerSet(set);\r\n        }\r\n      }),\r\n\r\n      this.managers.appStickersManager.getPremiumStickers().then((stickers) => {\r\n        const length = stickers.length;\r\n        this.toggleLocalCategory(premiumCategory, rootScope.premium && !!length);\r\n        this.categoryAppendStickers(premiumCategory, Promise.resolve(stickers));\r\n\r\n        rootScope.addEventListener('premium_toggle', (isPremium) => {\r\n          this.toggleLocalCategory(this.categories['premium'], isPremium && !!length);\r\n        });\r\n      })\r\n    ];\r\n\r\n    Promise.race(promises).finally(() => {\r\n      preloader.remove();\r\n    });\r\n\r\n    Promise.all(promises).finally(() => {\r\n      this.mounted = true;\r\n      setTyping();\r\n      setActive(0);\r\n    });\r\n\r\n    this.superStickerRenderer = new SuperStickerRenderer(EmoticonsDropdown.lazyLoadQueue, EMOTICONSSTICKERGROUP, this.managers, intersectionOptions);\r\n\r\n    const rendererLazyLoadQueue = this.superStickerRenderer.lazyLoadQueue;\r\n    emoticonsDropdown.addLazyLoadQueueRepeat(rendererLazyLoadQueue, this.superStickerRenderer.processInvisible);\r\n\r\n    // emoticonsDropdown.addEventListener('close', () => {\r\n    //   this.categoriesIntersector.lock();\r\n    // });\r\n\r\n    // emoticonsDropdown.addEventListener('closed', () => {\r\n    //   for(const [container] of this.categoriesMap) {\r\n    //     onCategoryVisibility(container, false);\r\n    //   }\r\n    // });\r\n\r\n    // emoticonsDropdown.addEventListener('opened', () => {\r\n    //   this.categoriesIntersector.unlockAndRefresh();\r\n    // });\r\n\r\n    // setInterval(() => {\r\n    //   // @ts-ignore\r\n    //   const players = Object.values(lottieLoader.players).filter((p) => p.width >= 80);\r\n\r\n    //   console.log(\r\n    //     'STICKERS RENDERED IN PANEL:',\r\n    //     players.length,\r\n    //     players.filter((p) => !p.paused).length,\r\n    //     rendererLazyLoadQueue.intersector.getVisible().length\r\n    //   );\r\n    // }, .25e3);\r\n\r\n    rootScope.addEventListener('stickers_installed', (set) => {\r\n      if(!this.categories[set.id] && this.mounted) {\r\n        this.renderStickerSet(set, true);\r\n      }\r\n    });\r\n\r\n    rootScope.addEventListener('stickers_deleted', ({id}) => {\r\n      const category = this.categories[id];\r\n      if(category && this.mounted) {\r\n        category.elements.container.remove();\r\n        category.elements.menuTab.remove();\r\n        this.categoriesIntersector.unobserve(category.elements.container);\r\n        clearCategoryItems(category);\r\n        delete this.categories[id];\r\n        this.categoriesMap.delete(category.elements.container);\r\n      }\r\n    });\r\n\r\n    rootScope.addEventListener('sticker_updated', ({type, document, faved}) => {\r\n      // if(type === 'faved') {\r\n      //   return;\r\n      // }\r\n\r\n      const category = this.categories[type === 'faved' ? 'faved' : 'recent'];\r\n      if(category) {\r\n        if(faved) {\r\n          this.unshiftSticker(category, document);\r\n        } else {\r\n          this.deleteSticker(category, document);\r\n        }\r\n      }\r\n    });\r\n\r\n    rootScope.addEventListener('stickers_updated', ({type, stickers}) => {\r\n      if(this.mounted) {\r\n        const category = this.categories[type === 'faved' ? 'faved' : 'recent'];\r\n        onCategoryStickers(category, stickers);\r\n      }\r\n    });\r\n\r\n    rootScope.addEventListener('app_config', (appConfig) => {\r\n      this.setFavedLimit(appConfig);\r\n    });\r\n\r\n    const resizeCategories = () => {\r\n      for(const [container, category] of this.categoriesMap) {\r\n        this.setCategoryItemsHeight(category);\r\n      }\r\n    };\r\n\r\n    mediaSizes.addEventListener('resize', resizeCategories);\r\n\r\n    emoticonsDropdown.addEventListener('opened', resizeCategories);\r\n\r\n    attachStickerViewerListeners({listenTo: this.content, listenerSetter: new ListenerSetter()});\r\n\r\n    createStickersContextMenu({\r\n      listenTo: this.content,\r\n      verifyRecent: (target) => !!findUpAsChild(target, this.categories['recent'].elements.items),\r\n      onOpen: () => {\r\n        emoticonsDropdown.setIgnoreMouseOut(true);\r\n      },\r\n      onClose: () => {\r\n        emoticonsDropdown.setIgnoreMouseOut(false);\r\n      }\r\n    });\r\n\r\n    this.init = null;\r\n  }\r\n\r\n  private toggleLocalCategory(category: StickersTabCategory, visible: boolean) {\r\n    if(!visible) {\r\n      category.elements.menuTab.remove();\r\n      category.elements.container.remove();\r\n    } else {\r\n      let idx = this.localCategories.indexOf(category);\r\n      const notMounted = this.localCategories.slice(0, idx).filter((category) => !category.mounted);\r\n      idx -= notMounted.length;\r\n      positionElementByIndex(category.elements.menuTab, this.menu, idx);\r\n      positionElementByIndex(category.elements.container, this.scroll.container, idx);\r\n    }\r\n\r\n    category.mounted = visible;\r\n    // category.elements.container.classList.toggle('hide', !visible);\r\n  }\r\n\r\n  private onLocalCategoryUpdate(category: StickersTabCategory) {\r\n    this.setCategoryItemsHeight(category);\r\n    this.toggleLocalCategory(category, !!category.items.length);\r\n  }\r\n\r\n  public deleteSticker(category: StickersTabCategory, doc: MyDocument, batch?: boolean) {\r\n    const item = findAndSplice(category.items, (item) => item.document.id === doc.id);\r\n    if(item) {\r\n      item.element.remove();\r\n\r\n      if(!batch) {\r\n        this.onLocalCategoryUpdate(category);\r\n      }\r\n    }\r\n  }\r\n\r\n  private spliceExceed(category: StickersTabCategory) {\r\n    const {items, limit} = category;\r\n    items.splice(limit, items.length - limit).forEach(({element}) => {\r\n      element.remove();\r\n    });\r\n\r\n    this.onLocalCategoryUpdate(category);\r\n  }\r\n\r\n  public unshiftSticker(category: StickersTabCategory, doc: MyDocument, batch?: boolean, idx?: number) {\r\n    if(idx !== undefined) {\r\n      const i = category.items[idx];\r\n      if(i && i.document.id === doc.id) {\r\n        return;\r\n      }\r\n    }\r\n\r\n    let item = findAndSplice(category.items, (item) => item.document.id === doc.id);\r\n    if(!item) {\r\n      item = {\r\n        element: this.superStickerRenderer.renderSticker(doc),\r\n        document: doc\r\n      };\r\n    }\r\n\r\n    category.items.unshift(item);\r\n    category.elements.items.prepend(item.element);\r\n\r\n    if(!batch) {\r\n      this.spliceExceed(category);\r\n    }\r\n  }\r\n\r\n  public unshiftRecentSticker(doc: MyDocument) {\r\n    this.managers.appStickersManager.saveRecentSticker(doc.id);\r\n  }\r\n\r\n  public deleteRecentSticker(doc: MyDocument) {\r\n    this.managers.appStickersManager.saveRecentSticker(doc.id, true);\r\n  }\r\n\r\n  onClose() {\r\n\r\n  }\r\n}\r\n","import {_i18n} from '../lib/langPack';\n\nexport default function generateFakeIcon(isScam?: boolean) {\n  const span = document.createElement('span');\n  span.classList.add('badge-fake');\n  _i18n(span, isScam ? 'ScamMessage' : 'FakeMessage');\n  return span;\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport findAndSpliceAll from '../helpers/array/findAndSpliceAll';\nimport LazyLoadQueueIntersector from './lazyLoadQueueIntersector';\nimport VisibilityIntersector, {OnVisibilityChange} from './visibilityIntersector';\n\nexport default class LazyLoadQueueRepeat2 extends LazyLoadQueueIntersector {\n  constructor(parallelLimit?: number, protected onVisibilityChange?: OnVisibilityChange) {\n    super(parallelLimit);\n\n    this.intersector = new VisibilityIntersector((item) => {\n      const {target, visible} = item;\n      const spliced = findAndSpliceAll(this.queue, (i) => i.div === target);\n      if(visible && spliced.length) {\n        spliced.forEach((item) => {\n          this.queue.unshift(item);\n        });\n      }\n\n      this.onVisibilityChange && this.onVisibilityChange(item);\n      this.setProcessQueueTimeout();\n    });\n  }\n\n  public observe(el: HTMLElement) {\n    this.intersector.observe(el);\n  }\n}\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport type {MyDocument} from '../lib/appManagers/appDocsManager';\r\nimport {wrapVideo} from './wrappers';\r\nimport animationIntersector, {AnimationItemGroup} from './animationIntersector';\r\nimport Scrollable from './scrollable';\r\nimport deferredPromise, {CancellablePromise} from '../helpers/cancellablePromise';\r\nimport calcImageInBox from '../helpers/calcImageInBox';\r\nimport {doubleRaf} from '../helpers/schedulers';\r\nimport {AppManagers} from '../lib/appManagers/managers';\r\nimport rootScope from '../lib/rootScope';\r\nimport LazyLoadQueueRepeat2 from './lazyLoadQueueRepeat2';\r\n\r\nconst width = 400;\r\nconst maxSingleWidth = width - 100;\r\nconst height = 100;\r\n\r\nexport default class GifsMasonry {\r\n  public lazyLoadQueue: LazyLoadQueueRepeat2;\r\n  private scrollPromise: CancellablePromise<void> = Promise.resolve();\r\n  private timeout: number = 0;\r\n  private managers: AppManagers;\r\n\r\n  constructor(\r\n    private element: HTMLElement,\r\n    private group: AnimationItemGroup,\r\n    private scrollable: Scrollable,\r\n    attach = true\r\n  ) {\r\n    this.managers = rootScope.managers;\r\n\r\n    this.lazyLoadQueue = new LazyLoadQueueRepeat2(undefined, ({target, visible}) => {\r\n      if(visible) {\r\n        this.processVisibleDiv(target);\r\n      } else {\r\n        this.processInvisibleDiv(target);\r\n      }\r\n    });\r\n\r\n    /* setInterval(() => {\r\n      // @ts-ignore\r\n      const players = animationIntersector.byGroups[group];\r\n\r\n      if(players) {\r\n        console.log(`GIFS RENDERED IN ${group}:`, players.length, players.filter((p) => !p.animation.paused).length, this.lazyLoadQueue.intersector.getVisible().length);\r\n      }\r\n    }, .25e3); */\r\n\r\n    if(attach) {\r\n      this.attach();\r\n    }\r\n  }\r\n\r\n  private onScroll = () => {\r\n    if(this.timeout) {\r\n      clearTimeout(this.timeout);\r\n    } else {\r\n      this.scrollPromise = deferredPromise<void>();\r\n      // animationIntersector.checkAnimations(true, group);\r\n    }\r\n\r\n    this.timeout = window.setTimeout(() => {\r\n      this.timeout = 0;\r\n      this.scrollPromise.resolve();\r\n      // animationIntersector.checkAnimations(false, group);\r\n    }, 150);\r\n  };\r\n\r\n  public attach() {\r\n    this.scrollable.container.addEventListener('scroll', this.onScroll);\r\n  }\r\n\r\n  public detach() {\r\n    this.clear();\r\n    this.scrollable.container.removeEventListener('scroll', this.onScroll);\r\n  }\r\n\r\n  public clear() {\r\n    this.lazyLoadQueue.clear();\r\n  }\r\n\r\n  private processVisibleDiv(div: HTMLElement) {\r\n    const video = div.querySelector('video');\r\n    if(video) {\r\n      return;\r\n    }\r\n\r\n    const load = () => {\r\n      const docId = div.dataset.docId;\r\n      const promise = Promise.all([this.managers.appDocsManager.getDoc(docId), this.scrollPromise]).then(async([doc]) => {\r\n        const res = await wrapVideo({\r\n          doc,\r\n          container: div as HTMLDivElement,\r\n          lazyLoadQueue: null,\r\n          // lazyLoadQueue: EmoticonsDropdown.lazyLoadQueue,\r\n          group: this.group,\r\n          noInfo: true,\r\n          noPreview: true\r\n        });\r\n\r\n        const promise = res.loadPromise;\r\n        promise.finally(() => {\r\n          const video = div.querySelector('video');\r\n          const thumb = div.querySelector('img, canvas');\r\n\r\n          // div.style.opacity = '';\r\n          thumb && thumb.classList.add('hide');\r\n\r\n          if(video && !video.parentElement) {\r\n            setTimeout(() => {\r\n              video.src = '';\r\n              video.load();\r\n              const animations = animationIntersector.getAnimations(video);\r\n              animations.forEach((item) => {\r\n                animationIntersector.checkAnimation(item, true, true);\r\n              });\r\n            }, 0);\r\n          }\r\n\r\n          // clearTimeout(timeout);\r\n          if(!this.lazyLoadQueue.intersector.isVisible(div)) {\r\n            this.processInvisibleDiv(div);\r\n          }\r\n        });\r\n\r\n        return promise;\r\n      });\r\n\r\n      /* let timeout = window.setTimeout(() => {\r\n        console.error('processVisibleDiv timeout', div, doc);\r\n      }, 1e3); */\r\n\r\n      return promise;\r\n    };\r\n\r\n    // return load();\r\n\r\n    this.lazyLoadQueue.push({div, load});\r\n  }\r\n\r\n  public processInvisibleDiv = (div: HTMLElement) => {\r\n    return this.scrollPromise.then(async() => {\r\n      // return;\r\n\r\n      if(this.lazyLoadQueue.intersector.isVisible(div)) {\r\n        return;\r\n      }\r\n\r\n      const video = div.querySelector('video');\r\n      const thumb = div.querySelector('img, canvas');\r\n\r\n      if(thumb) {\r\n        thumb.classList.remove('hide');\r\n\r\n        await doubleRaf();\r\n      }\r\n\r\n      if(this.lazyLoadQueue.intersector.isVisible(div)) {\r\n        return;\r\n      }\r\n\r\n      if(video) {\r\n        video.remove();\r\n        video.src = '';\r\n        video.load();\r\n        const animations = animationIntersector.getAnimations(video);\r\n        animations.forEach((item) => {\r\n          animationIntersector.checkAnimation(item, true, true);\r\n        });\r\n      }\r\n    });\r\n  };\r\n\r\n  public add(doc: MyDocument, appendTo = this.element) {\r\n    let gifWidth = doc.w;\r\n    let gifHeight = doc.h;\r\n    if(gifHeight < height) {\r\n      gifWidth = height / gifHeight * gifWidth;\r\n      gifHeight = height;\r\n    }\r\n\r\n    const willUseWidth = Math.min(maxSingleWidth, width, gifWidth);\r\n    const size = calcImageInBox(gifWidth, gifHeight, willUseWidth, height);\r\n\r\n    const div = document.createElement('div');\r\n    div.classList.add('gif'/* , 'fade-in-transition' */);\r\n    div.style.width = size.width + 'px';\r\n    // div.style.opacity = '0';\r\n    // div.style.height = h + 'px';\r\n    div.dataset.docId = '' + doc.id;\r\n\r\n    appendTo.append(div);\r\n\r\n    this.lazyLoadQueue.observe(div);\r\n\r\n    // let preloader = new ProgressivePreloader(div);\r\n\r\n    wrapVideo({\r\n      doc,\r\n      container: div as HTMLDivElement,\r\n      lazyLoadQueue: null,\r\n      noInfo: true,\r\n      onlyPreview: true\r\n    });\r\n  }\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport {TransitionSlider} from './transition';\r\nimport {ScrollableX} from './scrollable';\r\nimport rootScope from '../lib/rootScope';\r\nimport {fastRaf} from '../helpers/schedulers';\r\nimport {FocusDirection} from '../helpers/fastSmoothScroll';\r\nimport findUpAsChild from '../helpers/dom/findUpAsChild';\r\nimport whichChild from '../helpers/dom/whichChild';\r\nimport ListenerSetter from '../helpers/listenerSetter';\r\nimport {attachClickEvent} from '../helpers/dom/clickEvent';\r\n\r\nexport function horizontalMenu(\r\n  tabs: HTMLElement,\r\n  content: HTMLElement,\r\n  onClick?: (id: number, tabContent: HTMLDivElement, animate: boolean) => void | boolean | Promise<void | boolean>,\r\n  onTransitionEnd?: () => void,\r\n  transitionTime = 250,\r\n  scrollableX?: ScrollableX,\r\n  listenerSetter?: ListenerSetter\r\n) {\r\n  const selectTab = TransitionSlider(content, tabs || content.dataset.animation === 'tabs' ? 'tabs' : 'navigation', transitionTime, onTransitionEnd, undefined, listenerSetter);\r\n\r\n  if(!tabs) {\r\n    return selectTab;\r\n  }\r\n\r\n  const proxy = new Proxy(selectTab, {\r\n    apply: (target, that, args) => {\r\n      const id = +args[0];\r\n      const animate = args[1] !== undefined ? args[1] : true;\r\n\r\n      const el = (tabs.querySelector(`[data-tab=\"${id}\"]`) || tabs.children[id]) as HTMLElement;\r\n      selectTarget(el, id, animate);\r\n    }\r\n  });\r\n\r\n  const selectTarget = async(target: HTMLElement, id: number, animate = true) => {\r\n    const tabContent = content.children[id] as HTMLDivElement;\r\n\r\n    if(onClick) {\r\n      const result1 = onClick(id, tabContent, animate);\r\n      const canChange = result1 instanceof Promise ? await result1 : result1;\r\n      if(canChange !== undefined && !canChange) {\r\n        return;\r\n      }\r\n    }\r\n\r\n    if(scrollableX) {\r\n      scrollableX.scrollIntoViewNew({\r\n        element: target.parentElement.children[id] as HTMLElement,\r\n        position: 'center',\r\n        forceDirection: animate ? undefined : FocusDirection.Static,\r\n        forceDuration: transitionTime,\r\n        axis: 'x'\r\n      });\r\n    }\r\n\r\n    if(!rootScope.settings.animationsEnabled) {\r\n      animate = false;\r\n    }\r\n\r\n    const prevId = selectTab.prevId();\r\n    if(target.classList.contains('active') || id === prevId) {\r\n      return false;\r\n    }\r\n\r\n    const mutateCallback = animate ? fastRaf : (cb: () => void) => cb();\r\n\r\n    const prev = tabs.querySelector(tagName.toLowerCase() + '.active') as HTMLElement;\r\n    if(prev) {\r\n      mutateCallback(() => {\r\n        prev.classList.remove('active');\r\n      });\r\n    }\r\n\r\n    // a great stripe from Jolly Cobra\r\n    if(useStripe && prevId !== -1 && animate) {\r\n      mutateCallback(() => {\r\n        const indicator = target.querySelector('i')!;\r\n        const currentIndicator = target.parentElement.children[prevId].querySelector('i')!;\r\n\r\n        currentIndicator.classList.remove('animate');\r\n        indicator.classList.remove('animate');\r\n\r\n        // We move and resize our indicator so it repeats the position and size of the previous one.\r\n        const shiftLeft = currentIndicator.parentElement.parentElement.offsetLeft - indicator.parentElement.parentElement.offsetLeft;\r\n        const scaleFactor = currentIndicator.clientWidth / indicator.clientWidth;\r\n        indicator.style.transform = `translate3d(${shiftLeft}px, 0, 0) scale3d(${scaleFactor}, 1, 1)`;\r\n\r\n        // console.log(`translate3d(${shiftLeft}px, 0, 0) scale3d(${scaleFactor}, 1, 1)`);\r\n\r\n        fastRaf(() => {\r\n          // Now we remove the transform to let it animate to its own position and size.\r\n          indicator.classList.add('animate');\r\n          indicator.style.transform = 'none';\r\n        });\r\n      });\r\n    }\r\n\r\n    mutateCallback(() => {\r\n      target.classList.add('active');\r\n    });\r\n\r\n    selectTab(id, animate);\r\n  };\r\n\r\n  const useStripe = !tabs.classList.contains('no-stripe');\r\n\r\n  // const tagName = tabs.classList.contains('menu-horizontal-div') ? 'BUTTON' : 'LI';\r\n  const tagName = tabs.firstElementChild.tagName;\r\n  attachClickEvent(tabs, (e) => {\r\n    let target = e.target as HTMLElement;\r\n\r\n    target = findUpAsChild(target, tabs);\r\n\r\n    // console.log('tabs click:', target);\r\n\r\n    if(!target) return false;\r\n\r\n    let id: number;\r\n    if(target.dataset.tab) {\r\n      id = +target.dataset.tab;\r\n      if(id === -1) {\r\n        return false;\r\n      }\r\n    } else {\r\n      id = whichChild(target);\r\n    }\r\n\r\n    selectTarget(target, id);\r\n  }, {listenerSetter});\r\n\r\n  return proxy;\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport cancelEvent from '../helpers/dom/cancelEvent';\r\nimport simulateEvent from '../helpers/dom/dispatchEvent';\r\nimport documentFragmentToHTML from '../helpers/dom/documentFragmentToHTML';\r\nimport findUpAttribute from '../helpers/dom/findUpAttribute';\r\nimport getRichValue from '../helpers/dom/getRichValue';\r\nimport isInputEmpty from '../helpers/dom/isInputEmpty';\r\nimport selectElementContents from '../helpers/dom/selectElementContents';\r\nimport setInnerHTML from '../helpers/dom/setInnerHTML';\r\nimport {MessageEntity} from '../layer';\r\nimport {i18n, LangPackKey, _i18n} from '../lib/langPack';\r\nimport mergeEntities from '../lib/richTextProcessor/mergeEntities';\r\nimport parseEntities from '../lib/richTextProcessor/parseEntities';\r\nimport wrapDraftText from '../lib/richTextProcessor/wrapDraftText';\r\n\r\nlet init = () => {\r\n  document.addEventListener('paste', (e) => {\r\n    const input = findUpAttribute(e.target, 'contenteditable=\"true\"');\r\n    if(!input) {\r\n      return;\r\n    }\r\n\r\n    const noLinebreaks = !!input.dataset.noLinebreaks;\r\n    e.preventDefault();\r\n    let text: string, entities: MessageEntity[];\r\n\r\n    // @ts-ignore\r\n    let plainText: string = (e.originalEvent || e).clipboardData.getData('text/plain');\r\n    let usePlainText = true;\r\n\r\n    // @ts-ignore\r\n    let html: string = (e.originalEvent || e).clipboardData.getData('text/html');\r\n\r\n    const filterEntity = (e: MessageEntity) => e._ === 'messageEntityEmoji' || (e._ === 'messageEntityLinebreak' && !noLinebreaks);\r\n    if(noLinebreaks) {\r\n      const regExp = /[\\r\\n]/g;\r\n      plainText = plainText.replace(regExp, '');\r\n      html = html.replace(regExp, '');\r\n    }\r\n\r\n    if(html.trim()) {\r\n      html = html.replace(/<style([\\s\\S]*)<\\/style>/, '');\r\n      html = html.replace(/<!--([\\s\\S]*)-->/, '');\r\n\r\n      const match = html.match(/<body>([\\s\\S]*)<\\/body>/);\r\n      if(match) {\r\n        html = match[1].trim();\r\n      }\r\n\r\n      const span: HTMLElement = document.createElement('span');\r\n      span.innerHTML = html;\r\n\r\n      let curChild = span.firstChild;\r\n      while(curChild) { // * fix whitespace between elements like <p>asd</p>\\n<p>zxc</p>\r\n        const nextSibling = curChild.nextSibling;\r\n        if(curChild.nodeType === 3) {\r\n          if(!curChild.nodeValue.trim()) {\r\n            curChild.remove();\r\n          }\r\n        }\r\n\r\n        curChild = nextSibling;\r\n      }\r\n\r\n      const richValue = getRichValue(span, true);\r\n      if(richValue.value.replace(/\\s/g, '').length === plainText.replace(/\\s/g, '').length) {\r\n        text = richValue.value;\r\n        entities = richValue.entities;\r\n        usePlainText = false;\r\n\r\n        let entities2 = parseEntities(text);\r\n        entities2 = entities2.filter(filterEntity);\r\n        mergeEntities(entities, entities2);\r\n      }\r\n    }\r\n\r\n    if(usePlainText) {\r\n      text = plainText;\r\n      entities = parseEntities(text);\r\n      entities = entities.filter(filterEntity);\r\n    }\r\n\r\n    const fragment = wrapDraftText(text, {entities});\r\n    text = documentFragmentToHTML(fragment);\r\n\r\n    window.document.execCommand('insertHTML', false, text);\r\n  });\r\n\r\n  init = null;\r\n};\r\n\r\n// ! it doesn't respect symbols other than strongs\r\n/* const checkAndSetRTL = (input: HTMLElement) => {\r\n  //const isEmpty = isInputEmpty(input);\r\n  //console.log('input', isEmpty);\r\n\r\n  //const char = [...getRichValue(input)][0];\r\n  const char = (input instanceof HTMLInputElement ? input.value : input.innerText)[0];\r\n  let direction = 'ltr';\r\n  if(char && checkRTL(char)) {\r\n    direction = 'rtl';\r\n  }\r\n\r\n  //console.log('RTL', direction, char);\r\n\r\n  input.style.direction = direction;\r\n}; */\r\n\r\nexport enum InputState {\r\n  Neutral = 0,\r\n  Valid = 1,\r\n  Error = 2\r\n};\r\n\r\nexport type InputFieldOptions = {\r\n  placeholder?: LangPackKey,\r\n  label?: LangPackKey,\r\n  labelOptions?: any[],\r\n  labelText?: string | DocumentFragment,\r\n  name?: string,\r\n  maxLength?: number,\r\n  showLengthOn?: number,\r\n  plainText?: true,\r\n  required?: boolean,\r\n  canBeEdited?: boolean,\r\n  validate?: () => boolean,\r\n  inputMode?: 'tel' | 'numeric',\r\n  withLinebreaks?: boolean,\r\n  autocomplete?: string\r\n};\r\n\r\nexport default class InputField {\r\n  public container: HTMLElement;\r\n  public input: HTMLElement;\r\n  public label: HTMLLabelElement;\r\n\r\n  public originalValue: string;\r\n\r\n  public required: boolean;\r\n  public validate: () => boolean;\r\n\r\n  constructor(public options: InputFieldOptions = {}) {\r\n    this.container = document.createElement('div');\r\n    this.container.classList.add('input-field');\r\n\r\n    this.required = options.required;\r\n    this.validate = options.validate;\r\n\r\n    if(options.maxLength !== undefined && options.showLengthOn === undefined) {\r\n      options.showLengthOn = Math.min(40, Math.round(options.maxLength / 3));\r\n    }\r\n\r\n    const {placeholder, maxLength, showLengthOn, name, plainText, canBeEdited = true, autocomplete} = options;\r\n    const label = options.label || options.labelText;\r\n\r\n    const onInputCallbacks: Array<() => void> = [];\r\n    let input: HTMLElement;\r\n    if(!plainText) {\r\n      if(init) {\r\n        init();\r\n      }\r\n\r\n      this.container.innerHTML = `\r\n      <div contenteditable=\"${String(!!canBeEdited)}\" class=\"input-field-input\"></div>\r\n      `;\r\n\r\n      input = this.container.firstElementChild as HTMLElement;\r\n      // const observer = new MutationObserver(() => {\r\n      //   //checkAndSetRTL(input);\r\n\r\n      //   if(processInput) {\r\n      //     processInput();\r\n      //   }\r\n      // });\r\n\r\n      onInputCallbacks.push(() => {\r\n        // * because if delete all characters there will br left\r\n        if(isInputEmpty(input)) {\r\n          input.textContent = '';\r\n        }\r\n      });\r\n\r\n      // ! childList for paste first symbol\r\n      // observer.observe(input, {characterData: true, childList: true, subtree: true});\r\n    } else {\r\n      this.container.innerHTML = `\r\n      <input type=\"text\" ${name ? `name=\"${name}\"` : ''} autocomplete=\"${autocomplete ?? 'off'}\" ${label ? 'required=\"\"' : ''} class=\"input-field-input\">\r\n      `;\r\n\r\n      input = this.container.firstElementChild as HTMLElement;\r\n      // input.addEventListener('input', () => checkAndSetRTL(input));\r\n    }\r\n\r\n    input.setAttribute('dir', 'auto');\r\n\r\n    if(options.inputMode) {\r\n      input.inputMode = options.inputMode;\r\n    }\r\n\r\n    if(placeholder) {\r\n      _i18n(input, placeholder, undefined, 'placeholder');\r\n    }\r\n\r\n    if(label || placeholder) {\r\n      const border = document.createElement('div');\r\n      border.classList.add('input-field-border');\r\n      this.container.append(border);\r\n    }\r\n\r\n    if(label) {\r\n      this.label = document.createElement('label');\r\n      this.setLabel();\r\n      this.container.append(this.label);\r\n    }\r\n\r\n    if(maxLength) {\r\n      const labelEl = this.container.lastElementChild as HTMLLabelElement;\r\n      let showingLength = false;\r\n\r\n      const onInput = () => {\r\n        const wasError = input.classList.contains('error');\r\n        // * https://stackoverflow.com/a/54369605 #2 to count emoji as 1 symbol\r\n        const inputLength = plainText ? (input as HTMLInputElement).value.length : [...getRichValue(input, false).value].length;\r\n        const diff = maxLength - inputLength;\r\n        const isError = diff < 0;\r\n        input.classList.toggle('error', isError);\r\n\r\n        // this.onLengthChange && this.onLengthChange(inputLength, isError);\r\n\r\n        if(isError || diff <= showLengthOn) {\r\n          this.setLabel();\r\n          labelEl.append(` (${maxLength - inputLength})`);\r\n          if(!showingLength) showingLength = true;\r\n        } else if((wasError && !isError) || showingLength) {\r\n          this.setLabel();\r\n          showingLength = false;\r\n        }\r\n      };\r\n\r\n      onInputCallbacks.push(onInput);\r\n    }\r\n\r\n    const noLinebreaks = !options.withLinebreaks;\r\n    if(noLinebreaks && !plainText) {\r\n      input.dataset.noLinebreaks = '1';\r\n      input.addEventListener('keypress', (e) => {\r\n        if(e.key === 'Enter') {\r\n          e.preventDefault();\r\n          return false;\r\n        }\r\n      });\r\n    }\r\n\r\n    if(onInputCallbacks.length) {\r\n      input.addEventListener('input', () => {\r\n        onInputCallbacks.forEach((callback) => callback());\r\n      });\r\n    }\r\n\r\n    this.input = input;\r\n  }\r\n\r\n  public select() {\r\n    if(!this.value) { // * avoid selecting whole empty field on iOS devices\r\n      return;\r\n    }\r\n\r\n    if(this.options.plainText) {\r\n      (this.input as HTMLInputElement).select(); // * select text\r\n    } else {\r\n      selectElementContents(this.input);\r\n    }\r\n  }\r\n\r\n  public setLabel() {\r\n    this.label.textContent = '';\r\n    if(this.options.labelText) {\r\n      setInnerHTML(this.label, this.options.labelText);\r\n    } else {\r\n      this.label.append(i18n(this.options.label, this.options.labelOptions));\r\n    }\r\n  }\r\n\r\n  get value() {\r\n    return this.options.plainText ? (this.input as HTMLInputElement).value : getRichValue(this.input, false).value;\r\n    // return getRichValue(this.input);\r\n  }\r\n\r\n  set value(value: string) {\r\n    this.setValueSilently(value, true);\r\n\r\n    simulateEvent(this.input, 'input');\r\n  }\r\n\r\n  public setValueSilently(value: string, fromSet?: boolean) {\r\n    if(this.options.plainText) {\r\n      (this.input as HTMLInputElement).value = value;\r\n    } else {\r\n      this.input.innerHTML = value;\r\n    }\r\n  }\r\n\r\n  public isChanged() {\r\n    return this.value !== this.originalValue;\r\n  }\r\n\r\n  public isValid() {\r\n    return !this.input.classList.contains('error') &&\r\n      (!this.validate || this.validate()) &&\r\n      (!this.required || !isInputEmpty(this.input));\r\n  }\r\n\r\n  public isValidToChange() {\r\n    return this.isValid() && this.isChanged();\r\n  }\r\n\r\n  public setDraftValue(value = '', silent?: boolean) {\r\n    if(!this.options.plainText) {\r\n      value = documentFragmentToHTML(wrapDraftText(value));\r\n    }\r\n\r\n    if(silent) {\r\n      this.setValueSilently(value, false);\r\n    } else {\r\n      this.value = value;\r\n    }\r\n  }\r\n\r\n  public setOriginalValue(value: InputField['originalValue'] = '', silent?: boolean) {\r\n    this.originalValue = value;\r\n    this.setDraftValue(value, silent);\r\n  }\r\n\r\n  public setState(state: InputState, label?: LangPackKey) {\r\n    if(label) {\r\n      this.label.textContent = '';\r\n      this.label.append(i18n(label, this.options.labelOptions));\r\n    } else {\r\n      this.setLabel();\r\n    }\r\n\r\n    this.input.classList.toggle('error', !!(state & InputState.Error));\r\n    this.input.classList.toggle('valid', !!(state & InputState.Valid));\r\n  }\r\n\r\n  public setError(label?: LangPackKey) {\r\n    this.setState(InputState.Error, label);\r\n  }\r\n}\r\n","// https://stackoverflow.com/a/6150060\nexport default function selectElementContents(el: HTMLElement) {\n  const range = document.createRange();\n  range.selectNodeContents(el);\n  const sel = window.getSelection();\n  sel.removeAllRanges();\n  sel.addRange(range);\n}\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\n// import { getRichValue } from \"../helpers/dom\";\r\nimport {LangPackKey} from '../lib/langPack';\r\nimport InputField from './inputField';\r\n\r\nexport default class InputSearch {\r\n  public container: HTMLElement;\r\n  public input: HTMLElement;\r\n  public inputField: InputField;\r\n  public clearBtn: HTMLElement;\r\n\r\n  public prevValue = '';\r\n  public timeout = 0;\r\n  public onChange: (value: string) => void;\r\n  public onClear: () => void;\r\n\r\n  constructor(placeholder: LangPackKey, onChange?: (value: string) => void) {\r\n    this.inputField = new InputField({\r\n      placeholder,\r\n      plainText: true\r\n    });\r\n\r\n    this.container = this.inputField.container;\r\n    this.container.classList.remove('input-field');\r\n    this.container.classList.add('input-search');\r\n\r\n    this.onChange = onChange;\r\n\r\n    this.input = this.inputField.input;\r\n    this.input.classList.add('input-search-input');\r\n\r\n    const searchIcon = document.createElement('i');\r\n    searchIcon.classList.add('tgico', 'tgico-search');\r\n\r\n    this.clearBtn = document.createElement('i');\r\n    this.clearBtn.classList.add('tgico', 'btn-icon', 'tgico-close');\r\n\r\n    this.input.addEventListener('input', this.onInput);\r\n    this.clearBtn.addEventListener('click', this.onClearClick);\r\n\r\n    this.container.append(searchIcon, this.clearBtn);\r\n  }\r\n\r\n  onInput = () => {\r\n    if(!this.onChange) return;\r\n\r\n    const value = this.value;\r\n\r\n    // this.input.classList.toggle('is-empty', !value.trim());\r\n\r\n    if(value !== this.prevValue) {\r\n      this.prevValue = value;\r\n      clearTimeout(this.timeout);\r\n      this.timeout = window.setTimeout(() => {\r\n        this.onChange(value);\r\n      }, 200);\r\n    }\r\n  };\r\n\r\n  onClearClick = () => {\r\n    this.value = '';\r\n    this.onChange && this.onChange('');\r\n    this.onClear && this.onClear();\r\n  };\r\n\r\n  get value() {\r\n    return this.inputField.value;\r\n  }\r\n\r\n  set value(value: string) {\r\n    this.prevValue = value;\r\n    clearTimeout(this.timeout);\r\n    this.inputField.value = value;\r\n  }\r\n\r\n  public remove() {\r\n    clearTimeout(this.timeout);\r\n    this.input.removeEventListener('input', this.onInput);\r\n    this.clearBtn.removeEventListener('click', this.onClearClick);\r\n  }\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport VisibilityIntersector, {OnVisibilityChangeItem} from './visibilityIntersector';\r\nimport findAndSpliceAll from '../helpers/array/findAndSpliceAll';\r\nimport findAndSplice from '../helpers/array/findAndSplice';\r\nimport LazyLoadQueueIntersector, {LazyLoadElement} from './lazyLoadQueueIntersector';\r\n\r\nexport default class LazyLoadQueue extends LazyLoadQueueIntersector {\r\n  constructor(parallelLimit?: number) {\r\n    super(parallelLimit);\r\n\r\n    this.intersector = new VisibilityIntersector(this.onVisibilityChange);\r\n  }\r\n\r\n  private onVisibilityChange = ({target, visible}: OnVisibilityChangeItem) => {\r\n    if(visible) {\r\n      /* if(DEBUG) {\r\n        this.log('isIntersecting', target);\r\n      } */\r\n\r\n      // need for set element first if scrolled\r\n      findAndSpliceAll(this.queue, (i) => i.div === target).forEach((item) => {\r\n        item.wasSeen = true;\r\n        this.queue.unshift(item);\r\n        // this.processQueue(item);\r\n      });\r\n\r\n      this.setProcessQueueTimeout();\r\n    }\r\n  };\r\n\r\n  protected getItem() {\r\n    return findAndSplice(this.queue, item => item.wasSeen);\r\n  }\r\n\r\n  public async processItem(item: LazyLoadElement) {\r\n    await super.processItem(item);\r\n    this.intersector.unobserve(item.div);\r\n  }\r\n\r\n  protected addElement(method: 'push' | 'unshift', el: LazyLoadElement) {\r\n    const inserted = super.addElement(method, el);\r\n\r\n    if(!inserted) return false;\r\n\r\n    this.intersector.observe(el.div);\r\n    /* if(el.wasSeen) {\r\n      this.processQueue(el);\r\n    } else  */if(!el.hasOwnProperty('wasSeen')) {\r\n      el.wasSeen = false;\r\n    }\r\n\r\n    return true;\r\n  }\r\n}\r\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport findAndSpliceAll from '../helpers/array/findAndSpliceAll';\nimport LazyLoadQueueBase, {LazyLoadElementBase} from './lazyLoadQueueBase';\nimport VisibilityIntersector from './visibilityIntersector';\n\nexport type LazyLoadElement = Omit<LazyLoadElementBase, 'load'> & {\n  load: (target?: HTMLElement) => Promise<any>,\n  div: HTMLElement\n  wasSeen?: boolean,\n};\n\nexport default class LazyLoadQueueIntersector extends LazyLoadQueueBase {\n  protected queue: Array<LazyLoadElement> = [];\n  protected inProcess: Set<LazyLoadElement> = new Set();\n\n  public intersector: VisibilityIntersector;\n  protected intersectorTimeout: number;\n\n  constructor(parallelLimit?: number) {\n    super(parallelLimit);\n  }\n\n  public lock() {\n    super.lock();\n    this.intersector.lock();\n  }\n\n  public unlock() {\n    super.unlock();\n    this.intersector.unlock();\n  }\n\n  public unlockAndRefresh() {\n    super.unlock();\n    this.intersector.unlockAndRefresh();\n  }\n\n  public clear() {\n    super.clear();\n    this.intersector.disconnect();\n  }\n\n  public refresh() {\n    this.intersector.refresh();\n  }\n\n  protected loadItem(item: LazyLoadElement) {\n    return item.load(item.div);\n  }\n\n  protected addElement(method: 'push' | 'unshift', el: LazyLoadElement) {\n    const item = this.queue.find((i) => i.div === el.div && i.load === el.load);\n    if(item) {\n      return false;\n    } else {\n      for(const item of this.inProcess) {\n        if(item.div === el.div && item.load === el.load) {\n          return false;\n        }\n      }\n    }\n\n    this.queue[method](el);\n    return true;\n  }\n\n  protected setProcessQueueTimeout() {\n    if(!this.intersectorTimeout) {\n      this.intersectorTimeout = window.setTimeout(() => {\n        this.intersectorTimeout = 0;\n        this.processQueue();\n      }, 0);\n    }\n  }\n\n  public push(el: LazyLoadElement) {\n    super.push(el);\n  }\n\n  public unshift(el: LazyLoadElement) {\n    super.unshift(el);\n  }\n\n  public unobserve(el: HTMLElement) {\n    findAndSpliceAll(this.queue, (i) => i.div === el);\n\n    this.intersector.unobserve(el);\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport {GrabEvent} from '../helpers/dom/attachGrabListeners';\nimport appMediaPlaybackController from './appMediaPlaybackController';\nimport RangeSelector from './rangeSelector';\n\nexport default class MediaProgressLine extends RangeSelector {\n  protected filledLoad: HTMLDivElement;\n\n  protected progressRAF = 0;\n\n  protected media: HTMLMediaElement;\n  protected streamable: boolean;\n\n  constructor(media?: HTMLAudioElement | HTMLVideoElement, streamable?: boolean, withTransition?: boolean, useTransform?: boolean) {\n    super({\n      step: 1000 / 60 / 1000,\n      min: 0,\n      max: 1,\n      withTransition,\n      useTransform\n    }, 0);\n\n    if(media) {\n      this.setMedia(media, streamable);\n    }\n  }\n\n  public setMedia(media: HTMLMediaElement, streamable = false) {\n    if(this.media) {\n      this.removeListeners();\n    }\n\n    if(streamable && !this.filledLoad) {\n      this.filledLoad = document.createElement('div');\n      this.filledLoad.classList.add('progress-line__filled', 'progress-line__loaded');\n      this.container.prepend(this.filledLoad);\n      // this.setLoadProgress();\n    } else if(this.filledLoad) {\n      this.filledLoad.classList.toggle('hide', !streamable);\n    }\n\n    this.media = media;\n    this.streamable = streamable;\n    if(!media.paused || media.currentTime > 0) {\n      this.onPlay();\n    }\n\n    let wasPlaying = false;\n    this.setSeekMax();\n    this.setListeners();\n    this.setHandlers({\n      onMouseDown: () => {\n        wasPlaying = !this.media.paused;\n        wasPlaying && this.media.pause();\n      },\n\n      onMouseUp: (e) => {\n        // cancelEvent(e.event);\n        wasPlaying && this.media.play();\n      }\n    });\n  }\n\n  protected onLoadedData = () => {\n    this.max = this.media.duration;\n    this.seek.setAttribute('max', '' + this.max);\n  };\n\n  protected onEnded = () => {\n    this.setProgress();\n  };\n\n  protected onPlay = () => {\n    const r = () => {\n      this.setProgress();\n\n      this.progressRAF = this.media.paused ? 0 : window.requestAnimationFrame(r);\n    };\n\n    if(this.progressRAF) {\n      window.cancelAnimationFrame(this.progressRAF);\n    }\n\n    if(this.streamable) {\n      this.setLoadProgress();\n    }\n\n    this.progressRAF = window.requestAnimationFrame(r);\n  };\n\n  protected onTimeUpdate = () => {\n    if(this.media.paused) {\n      this.setProgress();\n\n      if(this.streamable) {\n        this.setLoadProgress();\n      }\n    }\n  };\n\n  protected onProgress = (e: Event) => {\n    this.setLoadProgress();\n  };\n\n  protected scrub(e: GrabEvent) {\n    const scrubTime = super.scrub(e);\n    this.media.currentTime = scrubTime;\n    return scrubTime;\n  }\n\n  protected setLoadProgress() {\n    if(appMediaPlaybackController.isSafariBuffering(this.media)) return;\n    const buf = this.media.buffered;\n    const numRanges = buf.length;\n\n    const currentTime = this.media.currentTime;\n    let nearestStart = 0, end = 0;\n    for(let i = 0; i < numRanges; ++i) {\n      const start = buf.start(i);\n      if(currentTime >= start && start >= nearestStart) {\n        nearestStart = start;\n        end = buf.end(i);\n      }\n\n      // console.log('onProgress range:', i, buf.start(i), buf.end(i), this.media);\n    }\n\n    // console.log('onProgress correct range:', nearestStart, end, this.media);\n\n    const percents = this.media.duration ? end / this.media.duration : 0;\n    this.filledLoad.style.width = (percents * 100) + '%';\n    // this.filledLoad.style.transform = 'scaleX(' + percents + ')';\n  }\n\n  protected setSeekMax() {\n    this.max = this.media.duration || 0;\n    if(this.max > 0) {\n      this.onLoadedData();\n    } else {\n      this.media.addEventListener('loadeddata', this.onLoadedData);\n    }\n  }\n\n  public setProgress() {\n    if(appMediaPlaybackController.isSafariBuffering(this.media)) return;\n    const currentTime = this.media.currentTime;\n\n    super.setProgress(currentTime);\n  }\n\n  public setListeners() {\n    super.setListeners();\n    this.media.addEventListener('ended', this.onEnded);\n    this.media.addEventListener('play', this.onPlay);\n    this.media.addEventListener('timeupdate', this.onTimeUpdate);\n    this.streamable && this.media.addEventListener('progress', this.onProgress);\n  }\n\n  public removeListeners() {\n    super.removeListeners();\n\n    if(this.media) {\n      this.media.removeEventListener('loadeddata', this.onLoadedData);\n      this.media.removeEventListener('ended', this.onEnded);\n      this.media.removeEventListener('play', this.onPlay);\n      this.media.removeEventListener('timeupdate', this.onTimeUpdate);\n      this.streamable && this.media.removeEventListener('progress', this.onProgress);\n    }\n\n    if(this.progressRAF) {\n      window.cancelAnimationFrame(this.progressRAF);\n      this.progressRAF = 0;\n    }\n  }\n}\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport {FontFamily, FontSize, FontWeight} from '../config/font';\r\nimport getTextWidth from '../helpers/canvas/getTextWidth';\r\nimport mediaSizes from '../helpers/mediaSizes';\r\nimport clamp from '../helpers/number/clamp';\r\nimport {fastRaf} from '../helpers/schedulers';\r\n\r\n// Thanks to https://stackoverflow.com/a/49349813\r\n\r\n/**\r\n * Attibute modifier to create middle ellipsis\r\n * When the attribute value is left blank the ellipsis will be in the middle\r\n * When positive the attribute value will be used as a percentage\r\n * When negative the attribute value will be used as character index counted from the end\r\n * @example\r\n *   <div data-middle-ellipsis>A Javascript solution to middle ellipsis</div>\r\n *   <div data-middle-ellipsis=\"20\">A Javascript solution to middle ellipsis</div>\r\n *   <div data-middle-ellipsis=\"-3\">A Javascript solution to middle ellipsis</div>\r\n */\r\nconst ellipsis = '';\r\nconst map: Map<HTMLElement, {\r\n  text: string,\r\n  textLength: number,\r\n  from: number,\r\n  multiplier: number,\r\n  font: string,\r\n  textWidth: number,\r\n  elementWidth: number\r\n}> = new Map();\r\n\r\nconst testQueue: Set<HTMLElement> = new Set();\r\nconst fontSize = '16px';\r\nlet pendingTest = false;\r\n\r\nfunction setTestQueue() {\r\n  if(pendingTest) {\r\n    return;\r\n  }\r\n\r\n  pendingTest = true;\r\n  fastRaf(() => {\r\n    pendingTest = false;\r\n    testQueueElements();\r\n  });\r\n}\r\n\r\nfunction testQueueElements() {\r\n  testQueue.forEach(testElement);\r\n  testQueue.clear();\r\n}\r\n\r\nwindow.addEventListener('resize', () => {\r\n  for(const [key] of map) {\r\n    testQueue.add(key);\r\n  }\r\n\r\n  setTestQueue();\r\n}, {capture: true, passive: true});\r\n\r\nfunction getElementWidth(element: HTMLElement) {\r\n  const type = element.dataset.sizeType;\r\n  if(type) {\r\n    const mediaSize = mediaSizes.active;\r\n    // @ts-ignore\r\n    const size: MediaSize = mediaSize[type];\r\n    return size.width;\r\n  }\r\n\r\n  return element.getBoundingClientRect().width;\r\n}\r\n\r\nfunction testElement(element: HTMLElement) {\r\n  // const perf = performance.now();\r\n  // do not recalculate variables a second time\r\n  let mapped = map.get(element);\r\n  const firstTime = !mapped;\r\n\r\n  let {text, textLength, from, multiplier, font, textWidth, elementWidth} = mapped || {};\r\n  // console.log('[MEE] testElement got mapped', mapped);\r\n\r\n  if(firstTime) {\r\n    text = element.textContent;\r\n    textLength = text.length;\r\n    from = /* parseFloat(element.getAttribute(attributeName)) ||  */50;\r\n    multiplier = from > 0 && from / 100;\r\n\r\n    // const perf = performance.now();\r\n    font = `${element.dataset.fontWeight || FontWeight} ${FontSize} ${FontFamily}`;\r\n    /* const computedStyle = window.getComputedStyle(elm, null);\r\n    font = `${computedStyle.getPropertyValue('font-weight')} ${computedStyle.getPropertyValue('font-size')} ${computedStyle.getPropertyValue('font-family')}`; */\r\n    // console.log('testMiddleEllipsis get computed style:', performance.now() - perf, font);\r\n\r\n    textWidth = getTextWidth(text, font);\r\n    // const perf = performance.now();\r\n    elementWidth = getElementWidth(element);\r\n    // console.log('testMiddleEllipsis get offsetWidth:', performance.now() - perf, font);\r\n    mapped = {text, textLength, from, multiplier, font, textWidth, elementWidth};\r\n    map.set(element, mapped);\r\n\r\n    // console.log('[MEE] testElement map set', element);\r\n  }\r\n\r\n  const newElementWidth = getElementWidth(element);\r\n  const widthChanged = firstTime || elementWidth !== newElementWidth;\r\n  !firstTime && widthChanged && (mapped.elementWidth = elementWidth = newElementWidth);\r\n\r\n  if(widthChanged) {\r\n    if(textWidth > elementWidth) {\r\n      element.setAttribute('title', text);\r\n      let smallerText = text;\r\n      let smallerWidth = elementWidth;\r\n      while(smallerText.length > 3) {\r\n        const smallerTextLength = smallerText.length;\r\n        const half = multiplier &&\r\n          clamp(multiplier * smallerTextLength << 0, 1, smallerTextLength - 2) ||\r\n          Math.max(smallerTextLength + from - 1, 1);\r\n        const half1 = smallerText.substr(0, half).replace(/\\s*$/, '');\r\n        const half2 = smallerText.substr(half + 1).replace(/^\\s*/, '');\r\n        smallerText = half1 + half2;\r\n        smallerWidth = getTextWidth(smallerText + ellipsis, font);\r\n        if(smallerWidth < elementWidth) {\r\n          element.textContent = half1 + ellipsis + half2;\r\n          break;\r\n        }\r\n      }\r\n\r\n      // * set new width after cutting text\r\n      mapped.elementWidth = getElementWidth(element);\r\n      // mapped.textWidth = smallerWidth;\r\n    } else {\r\n      element.removeAttribute('title');\r\n    }\r\n  }\r\n\r\n  // console.log('testMiddleEllipsis for element:', elm, performance.now() - perf);\r\n}\r\n\r\nexport class MiddleEllipsisElement extends HTMLElement {\r\n  connectedCallback() {\r\n    // console.log('[MEE]: connectedCallback before', map.has(this), testQueue.has(this), map.size, this.textContent, map);\r\n\r\n    map.set(this, null);\r\n    if(this.dataset.sizeType) {\r\n      testElement(this);\r\n    } else {\r\n      testQueue.add(this);\r\n      setTestQueue();\r\n    }\r\n    // testElement(this);\r\n\r\n    // console.log('[MEE]: connectedCallback after', map.has(this), map.size, testQueue.has(this), testQueue.size);\r\n  }\r\n\r\n  disconnectedCallback() {\r\n    const deleted = map.delete(this);\r\n    testQueue.delete(this);\r\n    // console.log('[MEE]: disconnectedCallback', deleted, map.has(this), map.size, this.textContent, map);\r\n  }\r\n}\r\n\r\ncustomElements.define('middle-ellipsis-element', MiddleEllipsisElement);\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport lottieLoader, {LottieLoader} from '../../lib/rlottie/lottieLoader';\r\nimport RLottiePlayer from '../../lib/rlottie/rlottiePlayer';\r\nimport PasswordInputField from '../passwordInputField';\r\n\r\nexport default class PasswordMonkey {\r\n  public container: HTMLElement;\r\n  public animation: RLottiePlayer;\r\n  public needFrame = 0;\r\n  protected loadPromise: ReturnType<LottieLoader['waitForFirstFrame']>;\r\n\r\n  constructor(protected passwordInputField: PasswordInputField, protected size: number) {\r\n    this.container = document.createElement('div');\r\n    this.container.classList.add('media-sticker-wrapper');\r\n  }\r\n\r\n  public load() {\r\n    if(this.loadPromise) return this.loadPromise;\r\n    return this.loadPromise = lottieLoader.loadAnimationAsAsset({\r\n      container: this.container,\r\n      loop: false,\r\n      autoplay: false,\r\n      width: this.size,\r\n      height: this.size,\r\n      noCache: true\r\n    // }, 'assets/img/TwoFactorSetupMonkeyClose.tgs').then((_animation) => {\r\n    }, 'TwoFactorSetupMonkeyPeek').then((_animation) => {\r\n      // return;\r\n      this.animation = _animation;\r\n      this.animation.addEventListener('enterFrame', currentFrame => {\r\n        // console.log('enterFrame', currentFrame, this.needFrame);\r\n\r\n        if((this.animation.direction === 1 && currentFrame >= this.needFrame) ||\r\n          (this.animation.direction === -1 && currentFrame <= this.needFrame)) {\r\n          this.animation.setSpeed(1);\r\n          this.animation.pause();\r\n        }\r\n      });\r\n\r\n      this.passwordInputField.onVisibilityClickAdditional = () => {\r\n        if(this.passwordInputField.passwordVisible) {\r\n          this.animation.setDirection(1);\r\n          this.animation.curFrame = 0;\r\n          this.needFrame = 16;\r\n          this.animation.play();\r\n        } else {\r\n          this.animation.setDirection(-1);\r\n          this.animation.curFrame = 16;\r\n          this.needFrame = 0;\r\n          this.animation.play();\r\n        }\r\n      };\r\n\r\n      return lottieLoader.waitForFirstFrame(_animation);\r\n    });\r\n  }\r\n\r\n  public remove() {\r\n    if(this.animation) {\r\n      this.animation.remove();\r\n    }\r\n  }\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport InputField from '../inputField';\r\nimport lottieLoader from '../../lib/rlottie/lottieLoader';\r\nimport RLottiePlayer from '../../lib/rlottie/rlottiePlayer';\r\n\r\nexport default class TrackingMonkey {\r\n  public container: HTMLElement;\r\n\r\n  protected max = 45;\r\n  protected needFrame = 0;\r\n\r\n  protected animation: RLottiePlayer;\r\n  protected idleAnimation: RLottiePlayer;\r\n\r\n  protected loadPromise: Promise<any>;\r\n\r\n  constructor(protected inputField: InputField, protected size: number) {\r\n    this.container = document.createElement('div');\r\n    this.container.classList.add('media-sticker-wrapper');\r\n\r\n    const input = inputField.input;\r\n\r\n    input.addEventListener('blur', () => {\r\n      this.playAnimation(0);\r\n    });\r\n\r\n    input.addEventListener('input', (e) => {\r\n      this.playAnimation(inputField.value.length);\r\n    });\r\n\r\n    /* codeInput.addEventListener('focus', () => {\r\n      playAnimation(Math.max(codeInput.value.length, 1));\r\n    }); */\r\n  }\r\n\r\n  // 1st symbol = frame 15\r\n  // end symbol = frame 165\r\n  public playAnimation(length: number) {\r\n    if(!this.animation) return;\r\n\r\n    length = Math.min(length, 30);\r\n    let frame: number;\r\n    if(length) {\r\n      frame = Math.round(Math.min(this.max, length) * (165 / this.max) + 11.33);\r\n\r\n      if(this.idleAnimation) {\r\n        this.idleAnimation.stop(true);\r\n        this.idleAnimation.canvas[0].style.display = 'none';\r\n      }\r\n\r\n      this.animation.canvas[0].style.display = '';\r\n    } else {\r\n      /* const cb = (frameNo: number) => {\r\n        if(frameNo <= 1) { */\r\n      /* idleAnimation.play();\r\n          idleAnimation.canvas.style.display = '';\r\n          animation.canvas.style.display = 'none'; */\r\n      /*     animation.removeListener('enterFrame', cb);\r\n        }\r\n      };\r\n      animation.addListener('enterFrame', cb); */\r\n\r\n      frame = 0;\r\n    }\r\n    // animation.playSegments([1, 2]);\r\n\r\n    const direction = this.needFrame > frame ? -1 : 1;\r\n    // console.log('keydown', length, frame, direction);\r\n\r\n    this.animation.setDirection(direction);\r\n    if(this.needFrame !== 0 && frame === 0) {\r\n      this.animation.setSpeed(7);\r\n    }\r\n    /* let diff = Math.abs(needFrame - frame * direction);\r\n    if((diff / 20) > 1) animation.setSpeed(diff / 20 | 0); */\r\n    this.needFrame = frame;\r\n\r\n    this.animation.play();\r\n\r\n    /* animation.goToAndStop(15, true); */\r\n    // animation.goToAndStop(length / max * );\r\n  }\r\n\r\n  public load() {\r\n    if(this.loadPromise) return this.loadPromise;\r\n    return this.loadPromise = Promise.all([\r\n      lottieLoader.loadAnimationAsAsset({\r\n        container: this.container,\r\n        loop: true,\r\n        autoplay: true,\r\n        width: this.size,\r\n        height: this.size\r\n      }, 'TwoFactorSetupMonkeyIdle').then((animation) => {\r\n        this.idleAnimation = animation;\r\n\r\n        // ! animationIntersector will stop animation instantly\r\n        if(!this.inputField.value.length) {\r\n          animation.play();\r\n        }\r\n\r\n        return lottieLoader.waitForFirstFrame(animation);\r\n      }),\r\n\r\n      lottieLoader.loadAnimationAsAsset({\r\n        container: this.container,\r\n        loop: false,\r\n        autoplay: false,\r\n        width: this.size,\r\n        height: this.size\r\n      }, 'TwoFactorSetupMonkeyTracking').then((_animation) => {\r\n        this.animation = _animation;\r\n\r\n        if(!this.inputField.value.length) {\r\n          this.animation.canvas[0].style.display = 'none';\r\n        }\r\n\r\n        this.animation.addEventListener('enterFrame', currentFrame => {\r\n          // console.log('enterFrame', currentFrame, needFrame);\r\n          // let currentFrame = Math.round(e.currentTime);\r\n\r\n          if((this.animation.direction === 1 && currentFrame >= this.needFrame) ||\r\n            (this.animation.direction === -1 && currentFrame <= this.needFrame)) {\r\n            this.animation.setSpeed(1);\r\n            this.animation.pause();\r\n          }\r\n\r\n          if(currentFrame === 0 && this.needFrame === 0) {\r\n            // animation.curFrame = 0;\r\n\r\n            if(this.idleAnimation) {\r\n              this.idleAnimation.canvas[0].style.display = '';\r\n              this.idleAnimation.play();\r\n              this.animation.canvas[0].style.display = 'none';\r\n            }\r\n          }\r\n        });\r\n        // console.log(animation.getDuration(), animation.getDuration(true));\r\n\r\n        return lottieLoader.waitForFirstFrame(_animation);\r\n      })\r\n    ]);\r\n  }\r\n\r\n  public remove() {\r\n    if(this.animation) this.animation.remove();\r\n    if(this.idleAnimation) this.idleAnimation.remove();\r\n  }\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\n// import { IS_MOBILE_SAFARI, IS_SAFARI } from \"../environment/userAgent\";\r\nimport cancelEvent from '../helpers/dom/cancelEvent';\r\nimport InputField, {InputFieldOptions} from './inputField';\r\n\r\nexport default class PasswordInputField extends InputField {\r\n  public passwordVisible = false;\r\n  public toggleVisible: HTMLElement;\r\n  public onVisibilityClickAdditional: () => void;\r\n\r\n  constructor(options: InputFieldOptions = {}) {\r\n    super({\r\n      plainText: true,\r\n      ...options\r\n    });\r\n\r\n    const input = this.input as HTMLInputElement;\r\n    input.type = 'password';\r\n    input.setAttribute('required', '');\r\n    input.name = 'notsearch_password';\r\n    input.autocomplete = 'off';\r\n\r\n    /* if(IS_SAFARI && !IS_MOBILE_SAFARI) {\r\n      input.setAttribute('readonly', '');\r\n      input.addEventListener('focus', () => {\r\n        input.removeAttribute('readonly');\r\n      }, {once: true});\r\n    } */\r\n\r\n    // * https://stackoverflow.com/a/35949954/6758968\r\n    const stealthy = document.createElement('input');\r\n    stealthy.classList.add('stealthy');\r\n    stealthy.tabIndex = -1;\r\n    stealthy.type = 'password';\r\n    input.parentElement.prepend(stealthy);\r\n    input.parentElement.insertBefore(stealthy.cloneNode(), input.nextSibling);\r\n\r\n    const toggleVisible = this.toggleVisible = document.createElement('span');\r\n    toggleVisible.classList.add('toggle-visible', 'tgico');\r\n\r\n    this.container.classList.add('input-field-password');\r\n    this.container.append(toggleVisible);\r\n\r\n    toggleVisible.addEventListener('click', this.onVisibilityClick);\r\n    toggleVisible.addEventListener('touchend', this.onVisibilityClick);\r\n  }\r\n\r\n  public onVisibilityClick = (e: Event) => {\r\n    cancelEvent(e);\r\n    this.passwordVisible = !this.passwordVisible;\r\n\r\n    this.toggleVisible.classList.toggle('eye-hidden', this.passwordVisible);\r\n    (this.input as HTMLInputElement).type = this.passwordVisible ? 'text' : 'password';\r\n    this.onVisibilityClickAdditional && this.onVisibilityClickAdditional();\r\n  };\r\n}\r\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport IS_PARALLAX_SUPPORTED from '../environment/parallaxSupport';\nimport IS_TOUCH_SUPPORTED from '../environment/touchSupport';\nimport findAndSplice from '../helpers/array/findAndSplice';\nimport cancelEvent from '../helpers/dom/cancelEvent';\nimport {attachClickEvent} from '../helpers/dom/clickEvent';\nimport filterChatPhotosMessages from '../helpers/filterChatPhotosMessages';\nimport ListenerSetter from '../helpers/listenerSetter';\nimport ListLoader from '../helpers/listLoader';\nimport {fastRaf} from '../helpers/schedulers';\nimport {Message, ChatFull, MessageAction, Photo} from '../layer';\nimport type {AppMessagesManager} from '../lib/appManagers/appMessagesManager';\nimport {AppManagers} from '../lib/appManagers/managers';\nimport choosePhotoSize from '../lib/appManagers/utils/photos/choosePhotoSize';\nimport {openAvatarViewer} from './avatar';\nimport {putAvatar} from './putPhoto';\nimport Scrollable from './scrollable';\nimport SwipeHandler from './swipeHandler';\nimport {wrapPhoto} from './wrappers';\n\nconst LOAD_NEAREST = 3;\n\nexport default class PeerProfileAvatars {\n  private static BASE_CLASS = 'profile-avatars';\n  private static SCALE = IS_PARALLAX_SUPPORTED ? 2 : 1;\n  private static TRANSLATE_TEMPLATE = IS_PARALLAX_SUPPORTED ? `translate3d({x}, 0, -1px) scale(${PeerProfileAvatars.SCALE})` : 'translate({x}, 0)';\n  public container: HTMLElement;\n  public avatars: HTMLElement;\n  public gradient: HTMLElement;\n  public info: HTMLElement;\n  public arrowPrevious: HTMLElement;\n  public arrowNext: HTMLElement;\n  private tabs: HTMLDivElement;\n  private listLoader: ListLoader<Photo.photo['id'] | Message.messageService, Photo.photo['id'] | Message.messageService>;\n  private peerId: PeerId;\n  private intersectionObserver: IntersectionObserver;\n  private loadCallbacks: Map<Element, () => void>;\n  private listenerSetter: ListenerSetter;\n  private swipeHandler: SwipeHandler;\n\n  constructor(\n    public scrollable: Scrollable,\n    private managers: AppManagers\n  ) {\n    this.container = document.createElement('div');\n    this.container.classList.add(PeerProfileAvatars.BASE_CLASS + '-container');\n\n    this.avatars = document.createElement('div');\n    this.avatars.classList.add(PeerProfileAvatars.BASE_CLASS + '-avatars');\n\n    this.gradient = document.createElement('div');\n    this.gradient.classList.add(PeerProfileAvatars.BASE_CLASS + '-gradient');\n\n    this.info = document.createElement('div');\n    this.info.classList.add(PeerProfileAvatars.BASE_CLASS + '-info');\n\n    this.tabs = document.createElement('div');\n    this.tabs.classList.add(PeerProfileAvatars.BASE_CLASS + '-tabs');\n\n    this.arrowPrevious = document.createElement('div');\n    this.arrowPrevious.classList.add(PeerProfileAvatars.BASE_CLASS + '-arrow', 'tgico-avatarprevious');\n\n    /* const previousIcon = document.createElement('i');\n    previousIcon.classList.add(PeerProfileAvatars.BASE_CLASS + '-arrow-icon', 'tgico-previous');\n    this.arrowBack.append(previousIcon); */\n\n    this.arrowNext = document.createElement('div');\n    this.arrowNext.classList.add(PeerProfileAvatars.BASE_CLASS + '-arrow', PeerProfileAvatars.BASE_CLASS + '-arrow-next', 'tgico-avatarnext');\n\n    /* const nextIcon = document.createElement('i');\n    nextIcon.classList.add(PeerProfileAvatars.BASE_CLASS + '-arrow-icon', 'tgico-next');\n    this.arrowNext.append(nextIcon); */\n\n    this.container.append(this.avatars, this.gradient, this.info, this.tabs, this.arrowPrevious, this.arrowNext);\n\n    this.loadCallbacks = new Map();\n    this.listenerSetter = new ListenerSetter();\n\n    const checkScrollTop = () => {\n      if(this.scrollable.scrollTop !== 0) {\n        this.scrollable.scrollIntoViewNew({\n          element: this.scrollable.container.firstElementChild as HTMLElement,\n          position: 'start'\n        });\n        return false;\n      }\n\n      return true;\n    };\n\n    const SWITCH_ZONE = 1 / 3;\n    let cancel = false;\n    let freeze = false;\n    attachClickEvent(this.container, async(_e) => {\n      if(freeze) {\n        cancelEvent(_e);\n        return;\n      }\n\n      if(cancel) {\n        cancel = false;\n        return;\n      }\n\n      if(!checkScrollTop()) {\n        return;\n      }\n\n      const rect = this.container.getBoundingClientRect();\n\n      // const e = (_e as TouchEvent).touches ? (_e as TouchEvent).touches[0] : _e as MouseEvent;\n      const e = _e;\n      const x = e.pageX;\n\n      const clickX = x - rect.left;\n      if((!this.listLoader.previous.length && !this.listLoader.next.length) ||\n        (clickX > (rect.width * SWITCH_ZONE) && clickX < (rect.width - rect.width * SWITCH_ZONE))) {\n        const peerId = this.peerId;\n\n        const targets: {element: HTMLElement, item: Photo.photo['id'] | Message.messageService}[] = [];\n        this.listLoader.previous.concat(this.listLoader.current, this.listLoader.next).forEach((item, idx) => {\n          targets.push({\n            element: /* null */this.avatars.children[idx] as HTMLElement,\n            item\n          });\n        });\n\n        const prevTargets = targets.slice(0, this.listLoader.previous.length);\n        const nextTargets = targets.slice(this.listLoader.previous.length + 1);\n\n        const target = this.avatars.children[this.listLoader.previous.length] as HTMLElement;\n        freeze = true;\n        openAvatarViewer(target, peerId, () => peerId === this.peerId, this.listLoader.current, prevTargets, nextTargets);\n        freeze = false;\n      } else {\n        const centerX = rect.right - (rect.width / 2);\n        const toRight = x > centerX;\n\n        // this.avatars.classList.remove('no-transition');\n        // fastRaf(() => {\n        this.avatars.classList.add('no-transition');\n        void this.avatars.offsetLeft; // reflow\n\n        let distance: number;\n        if(this.listLoader.index === 0 && !toRight) distance = this.listLoader.count - 1;\n        else if(this.listLoader.index === (this.listLoader.count - 1) && toRight) distance = -(this.listLoader.count - 1);\n        else distance = toRight ? 1 : -1;\n        this.listLoader.go(distance);\n\n        fastRaf(() => {\n          this.avatars.classList.remove('no-transition');\n        });\n        // });\n      }\n    }, {listenerSetter: this.listenerSetter});\n\n    const cancelNextClick = () => {\n      cancel = true;\n      document.body.addEventListener(IS_TOUCH_SUPPORTED ? 'touchend' : 'click', (e) => {\n        cancel = false;\n      }, {once: true});\n    };\n\n    let width = 0, x = 0, lastDiffX = 0, /* lastIndex = 0, */ minX = 0;\n    const swipeHandler = this.swipeHandler = new SwipeHandler({\n      element: this.avatars,\n      onSwipe: (xDiff, yDiff) => {\n        lastDiffX = xDiff;\n        let lastX = x + xDiff * -PeerProfileAvatars.SCALE;\n        if(lastX > 0) lastX = 0;\n        else if(lastX < minX) lastX = minX;\n\n        this.avatars.style.transform = PeerProfileAvatars.TRANSLATE_TEMPLATE.replace('{x}', lastX + 'px');\n        // console.log(xDiff, yDiff);\n        return false;\n      },\n      verifyTouchTarget: (e) => {\n        if(!checkScrollTop()) {\n          cancelNextClick();\n          cancelEvent(e);\n          return false;\n        } else if(this.container.classList.contains('is-single') || freeze) {\n          return false;\n        }\n\n        return true;\n      },\n      onFirstSwipe: () => {\n        const rect = this.avatars.getBoundingClientRect();\n        width = rect.width;\n        minX = -width * (this.tabs.childElementCount - 1);\n\n        /* lastIndex = whichChild(this.tabs.querySelector('.active'));\n        x = -width * lastIndex; */\n        x = rect.left - this.container.getBoundingClientRect().left;\n\n        this.avatars.style.transform = PeerProfileAvatars.TRANSLATE_TEMPLATE.replace('{x}', x + 'px');\n\n        this.container.classList.add('is-swiping');\n        this.avatars.classList.add('no-transition');\n        void this.avatars.offsetLeft; // reflow\n      },\n      onReset: () => {\n        const addIndex = Math.ceil(Math.abs(lastDiffX) / (width / PeerProfileAvatars.SCALE)) * (lastDiffX >= 0 ? 1 : -1);\n        cancelNextClick();\n\n        // console.log(addIndex);\n\n        this.avatars.classList.remove('no-transition');\n        fastRaf(() => {\n          this.listLoader.go(addIndex);\n          this.container.classList.remove('is-swiping');\n        });\n      }\n    });\n\n    this.intersectionObserver = new IntersectionObserver((entries) => {\n      entries.forEach((entry) => {\n        if(!entry.isIntersecting) {\n          return;\n        }\n\n        this.loadNearestToTarget(entry.target);\n      });\n    });\n\n    /* this.listenerSetter.add(rootScope)('avatar_update', (peerId) => {\n      if(this.peerId === peerId) {\n        const photo = appPeersManager.getPeerPhoto(peerId);\n        if(photo) {\n          const id = photo.photo_id;\n          const previous = this.listLoader.previous;\n          for(let i = 0; i < previous.length; ++i) {\n            if(previous[i] === id)\n          }\n          this.listLoader.previous.forEach((_id, idx, arr) => {});\n        }\n      }\n    }); */\n  }\n\n  public async setPeer(peerId: PeerId) {\n    this.peerId = peerId;\n\n    const photo = await this.managers.appPeersManager.getPeerPhoto(peerId);\n    if(!photo) {\n      return;\n    }\n\n    const listLoader: PeerProfileAvatars['listLoader'] = this.listLoader = new ListLoader({\n      loadCount: 50,\n      loadMore: (anchor, older, loadCount) => {\n        if(!older) return Promise.resolve({count: undefined, items: []});\n\n        if(peerId.isUser()) {\n          const maxId: Photo.photo['id'] = anchor as any;\n          return this.managers.appPhotosManager.getUserPhotos(peerId, maxId, loadCount).then((value) => {\n            return {\n              count: value.count,\n              items: value.photos\n            };\n          });\n        } else {\n          const promises: [Promise<ChatFull> | ChatFull, ReturnType<AppMessagesManager['getSearch']>] = [] as any;\n          if(!listLoader.current) {\n            promises.push(this.managers.appProfileManager.getChatFull(peerId.toChatId()));\n          }\n\n          promises.push(this.managers.appMessagesManager.getSearch({\n            peerId,\n            maxId: Number.MAX_SAFE_INTEGER,\n            inputFilter: {\n              _: 'inputMessagesFilterChatPhotos'\n            },\n            limit: loadCount,\n            backLimit: 0\n          }));\n\n          return Promise.all(promises).then(async(result) => {\n            const value = result.pop() as typeof result[1];\n\n            filterChatPhotosMessages(value);\n\n            if(!listLoader.current) {\n              const chatFull = result[0];\n              const message = findAndSplice(value.history, (message) => {\n                return ((message as Message.messageService).action as MessageAction.messageActionChannelEditPhoto).photo.id === chatFull.chat_photo.id;\n              }) as Message.messageService;\n\n              listLoader.current = message || await this.managers.appMessagesManager.generateFakeAvatarMessage(this.peerId, chatFull.chat_photo);\n            }\n\n            // console.log('avatars loaded:', value);\n            return {\n              count: value.count,\n              items: value.history\n            };\n          });\n        }\n      },\n      processItem: this.processItem,\n      onJump: (item, older) => {\n        const id = this.listLoader.index;\n        // const nextId = Math.max(0, id);\n        const x = 100 * PeerProfileAvatars.SCALE * id;\n        this.avatars.style.transform = PeerProfileAvatars.TRANSLATE_TEMPLATE.replace('{x}', `-${x}%`);\n\n        const activeTab = this.tabs.querySelector('.active');\n        if(activeTab) activeTab.classList.remove('active');\n\n        const tab = this.tabs.children[id] as HTMLElement;\n        tab.classList.add('active');\n\n        this.loadNearestToTarget(this.avatars.children[id]);\n      }\n    });\n\n    if(photo._ === 'userProfilePhoto') {\n      listLoader.current = photo.photo_id;\n    }\n\n    await this.processItem(listLoader.current);\n\n    // listLoader.loaded\n    listLoader.load(true);\n  }\n\n  public addTab() {\n    const tab = document.createElement('div');\n    tab.classList.add(PeerProfileAvatars.BASE_CLASS + '-tab');\n    this.tabs.append(tab);\n\n    if(this.tabs.childElementCount === 1) {\n      tab.classList.add('active');\n    }\n\n    this.container.classList.toggle('is-single', this.tabs.childElementCount <= 1);\n  }\n\n  public processItem = async(photoId: Photo.photo['id'] | Message.messageService) => {\n    const avatar = document.createElement('div');\n    avatar.classList.add(PeerProfileAvatars.BASE_CLASS + '-avatar', 'media-container', 'hide');\n\n    this.avatars.append(avatar);\n\n    let photo: Photo.photo;\n    if(photoId) {\n      photo = typeof(photoId) !== 'object' ?\n        await this.managers.appPhotosManager.getPhoto(photoId) :\n        (photoId.action as MessageAction.messageActionChannelEditPhoto).photo as Photo.photo;\n    }\n\n    const img = new Image();\n    img.classList.add('avatar-photo');\n    img.draggable = false;\n\n    const loadCallback = async() => {\n      if(photo) {\n        const res = await wrapPhoto({\n          container: avatar,\n          photo,\n          size: choosePhotoSize(photo, 420, 420, false),\n          withoutPreloader: true\n        });\n\n        [res.images.thumb, res.images.full].filter(Boolean).forEach((img) => {\n          img.classList.add('avatar-photo');\n        });\n      } else {\n        const photo = await this.managers.appPeersManager.getPeerPhoto(this.peerId);\n        await putAvatar(avatar, this.peerId, photo, 'photo_big', img);\n      }\n\n      avatar.classList.remove('hide');\n    };\n\n    if(this.avatars.childElementCount <= LOAD_NEAREST) {\n      await loadCallback();\n    } else {\n      this.intersectionObserver.observe(avatar);\n      this.loadCallbacks.set(avatar, loadCallback);\n    }\n\n    this.addTab();\n\n    return photoId;\n  };\n\n  private loadNearestToTarget(target: Element) {\n    const children = Array.from(target.parentElement.children);\n    const idx = children.indexOf(target);\n    const slice = children.slice(Math.max(0, idx - LOAD_NEAREST), Math.min(children.length, idx + LOAD_NEAREST));\n\n    slice.forEach((target) => {\n      const callback = this.loadCallbacks.get(target);\n      if(callback) {\n        callback();\n        this.loadCallbacks.delete(target);\n        this.intersectionObserver.unobserve(target);\n      }\n    });\n  }\n\n  public cleanup() {\n    this.listenerSetter.removeAll();\n    this.swipeHandler.removeListeners();\n    this.intersectionObserver?.disconnect();\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport IS_PARALLAX_SUPPORTED from '../environment/parallaxSupport';\nimport {copyTextToClipboard} from '../helpers/clipboard';\nimport replaceContent from '../helpers/dom/replaceContent';\nimport setInnerHTML from '../helpers/dom/setInnerHTML';\nimport ListenerSetter from '../helpers/listenerSetter';\nimport {fastRaf} from '../helpers/schedulers';\nimport {Chat, ChatFull, User, UserFull} from '../layer';\nimport type {Channel} from '../lib/appManagers/appChatsManager';\nimport appImManager from '../lib/appManagers/appImManager';\nimport {AppManagers} from '../lib/appManagers/managers';\nimport I18n from '../lib/langPack';\nimport wrapRichText from '../lib/richTextProcessor/wrapRichText';\nimport rootScope from '../lib/rootScope';\nimport AvatarElement from './avatar';\nimport CheckboxField from './checkboxField';\nimport PeerProfileAvatars from './peerProfileAvatars';\nimport Row from './row';\nimport Scrollable from './scrollable';\nimport {SettingSection, generateDelimiter} from './sidebarLeft';\nimport {toast} from './toast';\nimport formatUserPhone from './wrappers/formatUserPhone';\nimport wrapPeerTitle from './wrappers/peerTitle';\n\nconst setText = (text: Parameters<typeof setInnerHTML>[1], row: Row) => {\n  // fastRaf(() => {\n  setInnerHTML(row.title, text || '');\n  row.container.style.display = text ? '' : 'none';\n  // });\n};\n\nexport default class PeerProfile {\n  public element: HTMLElement;\n  private avatars: PeerProfileAvatars;\n  private avatar: AvatarElement;\n  private section: SettingSection;\n  private name: HTMLDivElement;\n  private subtitle: HTMLDivElement;\n  private bio: Row;\n  private username: Row;\n  private phone: Row;\n  private notifications: Row;\n  private location: Row;\n  private link: Row;\n\n  private cleaned: boolean;\n  private setMoreDetailsTimeout: number;\n  private setPeerStatusInterval: number;\n\n  private peerId: PeerId;\n  private threadId: number;\n\n  constructor(\n    private managers: AppManagers,\n    public scrollable: Scrollable,\n    private listenerSetter?: ListenerSetter,\n    private isDialog = true\n  ) {\n    if(!IS_PARALLAX_SUPPORTED) {\n      this.scrollable.container.classList.add('no-parallax');\n    }\n\n    if(!listenerSetter) {\n      this.listenerSetter = new ListenerSetter();\n    }\n  }\n\n  public init() {\n    this.init = null;\n\n\n    this.element = document.createElement('div');\n    this.element.classList.add('profile-content');\n\n    this.section = new SettingSection({\n      noDelimiter: true\n    });\n\n    this.avatar = new AvatarElement();\n    this.avatar.classList.add('profile-avatar', 'avatar-120');\n    this.avatar.isDialog = this.isDialog;\n    this.avatar.attachClickEvent();\n\n    this.name = document.createElement('div');\n    this.name.classList.add('profile-name');\n\n    this.subtitle = document.createElement('div');\n    this.subtitle.classList.add('profile-subtitle');\n\n    this.bio = new Row({\n      title: ' ',\n      subtitleLangKey: 'UserBio',\n      icon: 'info',\n      clickable: async(e) => {\n        if((e.target as HTMLElement).tagName === 'A') {\n          return;\n        }\n\n        const full = await this.managers.appProfileManager.getProfileByPeerId(this.peerId);\n        copyTextToClipboard(full.about);\n        toast(I18n.format('BioCopied', true));\n      },\n      listenerSetter: this.listenerSetter\n    });\n\n    this.bio.title.classList.add('pre-wrap');\n\n    this.username = new Row({\n      title: ' ',\n      subtitleLangKey: 'Username',\n      icon: 'username',\n      clickable: async() => {\n        const peer: Channel | User.user = await this.managers.appPeersManager.getPeer(this.peerId);\n        copyTextToClipboard('@' + peer.username);\n        toast(I18n.format('UsernameCopied', true));\n      },\n      listenerSetter: this.listenerSetter\n    });\n\n    this.phone = new Row({\n      title: ' ',\n      subtitleLangKey: 'Phone',\n      icon: 'phone',\n      clickable: async() => {\n        const peer: User = await this.managers.appUsersManager.getUser(this.peerId);\n        copyTextToClipboard('+' + peer.phone);\n        toast(I18n.format('PhoneCopied', true));\n      },\n      listenerSetter: this.listenerSetter\n    });\n\n    this.link = new Row({\n      title: ' ',\n      subtitleLangKey: 'SetUrlPlaceholder',\n      icon: 'link',\n      clickable: () => {\n        copyTextToClipboard(this.link.title.textContent);\n        // Promise.resolve(appProfileManager.getChatFull(this.peerId.toChatId())).then((chatFull) => {\n        // copyTextToClipboard(chatFull.exported_invite.link);\n        toast(I18n.format('LinkCopied', true));\n        // });\n      },\n      listenerSetter: this.listenerSetter\n    });\n\n    this.location = new Row({\n      title: ' ',\n      subtitleLangKey: 'ChatLocation',\n      icon: 'location'\n    });\n\n    this.section.content.append(\n      this.phone.container,\n      this.username.container,\n      this.location.container,\n      this.bio.container,\n      this.link.container\n    );\n\n    const {listenerSetter} = this;\n    if(this.isDialog) {\n      this.notifications = new Row({\n        checkboxField: new CheckboxField({toggle: true}),\n        titleLangKey: 'Notifications',\n        icon: 'unmute',\n        listenerSetter: this.listenerSetter\n      });\n\n      listenerSetter.add(this.notifications.checkboxField.input)('change', (e) => {\n        if(!e.isTrusted) {\n          return;\n        }\n\n        // let checked = this.notificationsCheckbox.checked;\n        this.managers.appMessagesManager.togglePeerMute(this.peerId);\n      });\n\n      listenerSetter.add(rootScope)('dialog_notify_settings', async(dialog) => {\n        if(this.peerId === dialog.peerId) {\n          const muted = await this.managers.appNotificationsManager.isPeerLocalMuted(this.peerId, false);\n          this.notifications.checkboxField.checked = !muted;\n        }\n      });\n\n      this.section.content.append(this.notifications.container);\n    }\n\n    this.element.append(this.section.container);\n\n    if(IS_PARALLAX_SUPPORTED) {\n      this.element.append(generateDelimiter());\n    }\n\n    listenerSetter.add(rootScope)('peer_typings', ({peerId}) => {\n      if(this.peerId === peerId) {\n        this.setPeerStatus();\n      }\n    });\n\n    listenerSetter.add(rootScope)('peer_bio_edit', (peerId) => {\n      if(peerId === this.peerId) {\n        this.setMoreDetails(true);\n      }\n    });\n\n    listenerSetter.add(rootScope)('peer_title_edit', (peerId) => {\n      if(peerId === this.peerId) {\n        this.fillUsername();\n      }\n    });\n\n    listenerSetter.add(rootScope)('user_update', (userId) => {\n      if(this.peerId === userId.toPeerId()) {\n        this.setPeerStatus();\n      }\n    });\n\n    listenerSetter.add(rootScope)('contacts_update', async(userId) => {\n      if(this.peerId === userId.toPeerId()) {\n        const user = await this.managers.appUsersManager.getUser(userId);\n        if(!user.pFlags.self || !this.isDialog) {\n          this.fillUserPhone();\n        }\n      }\n    });\n\n    listenerSetter.add(rootScope)('avatar_update', (peerId) => {\n      if(this.peerId === peerId) {\n        // const photo = appPeersManager.getPeerPhoto(peerId);\n        // if(!photo && this.avatars) {\n        this.setAvatar();\n        // }\n      }\n    });\n\n    this.setPeerStatusInterval = window.setInterval(this.setPeerStatus, 60e3);\n  }\n\n  private setPeerStatus = (needClear = false) => {\n    const peerId = this.peerId;\n    this.element.classList.toggle('is-me', peerId === rootScope.myId);\n    if(!peerId || (rootScope.myId === peerId && this.isDialog)) return;\n\n    return appImManager.setPeerStatus(\n      peerId,\n      this.subtitle,\n      needClear,\n      true,\n      () => peerId === this.peerId,\n      !this.isDialog\n    ).then((callback) => {\n      if(callback) {\n        callback();\n      }\n    });\n  };\n\n  public cleanupHTML() {\n    [\n      this.bio,\n      this.phone,\n      this.username,\n      this.location,\n      this.link\n    ].forEach((row) => {\n      row.container.style.display = 'none';\n    });\n\n    if(this.notifications) {\n      this.notifications.container.style.display = '';\n      this.notifications.checkboxField.checked = true;\n    }\n\n    this.clearSetMoreDetailsTimeout();\n  }\n\n  private canBeDetailed() {\n    return this.peerId !== rootScope.myId || !this.isDialog;\n  }\n\n  private async setAvatar() {\n    if(this.canBeDetailed()) {\n      const photo = await this.managers.appPeersManager.getPeerPhoto(this.peerId);\n\n      if(photo) {\n        const oldAvatars = this.avatars;\n        this.avatars = new PeerProfileAvatars(this.scrollable, this.managers);\n        await this.avatars.setPeer(this.peerId);\n        this.avatars.info.append(this.name, this.subtitle);\n\n        this.avatar.remove();\n\n        if(oldAvatars) oldAvatars.container.replaceWith(this.avatars.container);\n        else this.element.prepend(this.avatars.container);\n\n        if(IS_PARALLAX_SUPPORTED) {\n          this.scrollable.container.classList.add('parallax');\n        }\n\n        return;\n      }\n    }\n\n    if(IS_PARALLAX_SUPPORTED) {\n      this.scrollable.container.classList.remove('parallax');\n    }\n\n    if(this.avatars) {\n      this.avatars.container.remove();\n      this.avatars.cleanup();\n      this.avatars = undefined;\n    }\n\n    await this.avatar.updateWithOptions({peerId: this.peerId});\n\n    this.section.content.prepend(this.avatar, this.name, this.subtitle);\n  }\n\n  private async fillUsername() {\n    const {peerId} = this;\n    if(peerId.isUser() && this.canBeDetailed()) {\n      const username = await this.managers.appPeersManager.getPeerUsername(peerId);\n      return setText(username, this.username);\n    }\n  }\n\n  private async fillUserPhone() {\n    const {peerId} = this;\n    if(peerId.isUser() && this.canBeDetailed()) {\n      const user = await this.managers.appUsersManager.getUser(peerId);\n      return setText(user.phone ? formatUserPhone(user.phone) : undefined, this.phone);\n    }\n  }\n\n  private async fillNotifications() {\n    const notificationsRow = this.notifications;\n    if(!notificationsRow) {\n      return;\n    }\n\n    if(this.canBeDetailed()) {\n      const muted = await this.managers.appNotificationsManager.isPeerLocalMuted(this.peerId, false);\n      notificationsRow.checkboxField.checked = !muted;\n    } else {\n      fastRaf(() => {\n        notificationsRow.container.style.display = 'none';\n      });\n    }\n  }\n\n  private async fillRows() {\n    const peerId = this.peerId;\n\n    await Promise.all([\n      this.fillUsername(),\n      this.fillUserPhone(),\n      this.fillNotifications(),\n      this.setMoreDetails(),\n      (async() => {\n        const [element/* , icons */] = await Promise.all([\n          wrapPeerTitle({\n            peerId,\n            dialog: this.isDialog,\n            withIcons: true\n          })\n\n          // generateTitleIcons(peerId)\n        ]);\n        replaceContent(this.name, element);\n        // this.name.append(...icons);\n      })(),\n      this.setPeerStatus(true)\n    ]);\n  }\n\n  public async fillProfileElements() {\n    if(!this.cleaned) return;\n    this.cleaned = false;\n\n    this.cleanupHTML();\n    await Promise.all([\n      this.setAvatar(),\n      this.fillRows()\n    ]);\n  }\n\n  private async _setMoreDetails(peerId: PeerId, peerFull: ChatFull | UserFull) {\n    // if(peerFull.about) {\n    setText(peerFull.about ? wrapRichText(peerFull.about) : undefined, this.bio);\n    // }\n\n    if(!peerId.isUser()) {\n      const chat: Chat.channel = await this.managers.appChatsManager.getChat(peerId.toChatId());\n      if(chat.username) {\n        setText('https://t.me/' + chat.username, this.link);\n      } else {\n        const exportedInvite = (peerFull as ChatFull.channelFull).exported_invite;\n        if(exportedInvite?._ === 'chatInviteExported') {\n          setText(exportedInvite.link, this.link);\n        }\n      }\n    }\n\n    const location = (peerFull as ChatFull.channelFull).location;\n    if(location?._ == 'channelLocation') {\n      setText(location.address, this.location);\n    }\n\n    this.setMoreDetailsTimeout = window.setTimeout(() => this.setMoreDetails(true), 60e3);\n  }\n\n  private async setMoreDetails(override?: true) {\n    this.clearSetMoreDetailsTimeout();\n\n    const peerId = this.peerId;\n    const threadId = this.threadId;\n\n    if(!peerId || await this.managers.appPeersManager.isRestricted(peerId) || !this.canBeDetailed()) {\n      return;\n    }\n\n    const result = await this.managers.acknowledged.appProfileManager.getProfileByPeerId(peerId, override);\n    const setPromise = result.result.then(async(peerFull) => {\n      if(this.peerId !== peerId || this.threadId !== threadId || await this.managers.appPeersManager.isRestricted(peerId)) {\n        // this.log.warn('peer changed');\n        return;\n      }\n\n      await this._setMoreDetails(peerId, peerFull);\n    });\n\n    if(result.cached) {\n      await setPromise;\n    }\n  }\n\n  public setPeer(peerId: PeerId, threadId = 0) {\n    if(this.peerId === peerId && this.threadId === threadId) return;\n\n    if(this.init) {\n      this.init();\n    }\n\n    this.peerId = peerId;\n    this.threadId = threadId;\n\n    this.cleaned = true;\n  }\n\n  public clearSetMoreDetailsTimeout() {\n    if(this.setMoreDetailsTimeout !== undefined) {\n      clearTimeout(this.setMoreDetailsTimeout);\n      this.setMoreDetailsTimeout = undefined;\n    }\n  }\n\n  public destroy() {\n    this.clearSetMoreDetailsTimeout();\n    clearInterval(this.setPeerStatusInterval);\n    this.avatars?.cleanup();\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport {Chat, User} from '../layer';\nimport rootScope from '../lib/rootScope';\nimport generateFakeIcon from './generateFakeIcon';\nimport generatePremiumIcon from './generatePremiumIcon';\nimport generateVerifiedIcon from './generateVerifiedIcon';\n\nexport default async function generateTitleIcons(peerId: PeerId) {\n  const elements: Element[] = [];\n  const peer: Chat | User = await rootScope.managers.appPeersManager.getPeer(peerId);\n  if((peer as Chat.channel).pFlags.verified) {\n    elements.push(generateVerifiedIcon());\n  }\n\n  if((peer as Chat.channel).pFlags.fake || (peer as User.user).pFlags.scam) {\n    elements.push(generateFakeIcon((peer as User.user).pFlags.scam));\n  }\n\n  if((peer as User.user).pFlags.premium) {\n    elements.push(generatePremiumIcon());\n  }\n\n  return elements;\n}\n","export default function generateVerifiedIcon() {\n  const span = document.createElement('span');\n  span.classList.add('verified-icon', 'tgico');\n\n  const size = 26; // 24\n  const svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');\n  svg.setAttributeNS(null, 'viewBox', `0 0 ${size} ${size}`);\n  svg.setAttributeNS(null, 'width', `${size}`);\n  svg.setAttributeNS(null, 'height', `${size}`);\n  svg.classList.add('verified-icon-svg');\n\n  const use = document.createElementNS('http://www.w3.org/2000/svg', 'use');\n  use.setAttributeNS(null, 'href', '#verified-icon-background');\n  use.classList.add('verified-icon-background');\n\n  const use2 = document.createElementNS('http://www.w3.org/2000/svg', 'use');\n  use2.setAttributeNS(null, 'href', '#verified-icon-check');\n  use2.classList.add('verified-icon-check');\n\n  // svg.append(use, use2);\n  svg.append(use2, use);\n\n  span.append(svg);\n\n  return span;\n  // const span = document.createElement('span');\n  // span.classList.add('verified-icon', 'tgico-verified_filled');\n  // return span;\n}\n","export default function generatePremiumIcon() {\n  const span = document.createElement('span');\n  span.classList.add('premium-icon', 'tgico-star');\n  return span;\n}\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport rootScope from '../lib/rootScope';\r\nimport {i18n} from '../lib/langPack';\r\nimport replaceContent from '../helpers/dom/replaceContent';\r\nimport {NULL_PEER_ID} from '../lib/mtproto/mtproto_config';\r\nimport limitSymbols from '../helpers/string/limitSymbols';\r\nimport setInnerHTML from '../helpers/dom/setInnerHTML';\r\nimport {AppManagers} from '../lib/appManagers/managers';\r\nimport wrapEmojiText from '../lib/richTextProcessor/wrapEmojiText';\r\nimport getPeerTitle from './wrappers/getPeerTitle';\r\nimport generateTitleIcons from './generateTitleIcons';\r\n\r\nexport type PeerTitleOptions = {\r\n  peerId?: PeerId,\r\n  fromName?: string,\r\n  plainText?: boolean,\r\n  onlyFirstName?: boolean,\r\n  dialog?: boolean,\r\n  limitSymbols?: number,\r\n  managers?: AppManagers,\r\n  withIcons?: boolean\r\n};\r\n\r\nconst weakMap: WeakMap<HTMLElement, PeerTitle> = new WeakMap();\r\n\r\nrootScope.addEventListener('peer_title_edit', (peerId) => {\r\n  const elements = Array.from(document.querySelectorAll(`.peer-title[data-peer-id=\"${peerId}\"]`)) as HTMLElement[];\r\n  elements.forEach((element) => {\r\n    const peerTitle = weakMap.get(element);\r\n    // console.log('in the summer silence i was doing nothing', peerTitle, peerId);\r\n\r\n    if(peerTitle) {\r\n      peerTitle.update();\r\n    }\r\n  });\r\n});\r\n\r\nexport default class PeerTitle {\r\n  public element: HTMLElement;\r\n  public peerId: PeerId;\r\n  private fromName: string;\r\n  private plainText = false;\r\n  private onlyFirstName = false;\r\n  private dialog = false;\r\n  private limitSymbols: number;\r\n  private managers: AppManagers;\r\n  private hasInner: boolean;\r\n  private withIcons: boolean;\r\n\r\n  constructor(options?: PeerTitleOptions) {\r\n    this.element = document.createElement('span');\r\n    this.element.classList.add('peer-title');\r\n    this.element.setAttribute('dir', 'auto');\r\n\r\n    if(options) {\r\n      this.update(options);\r\n    }\r\n\r\n    weakMap.set(this.element, this);\r\n  }\r\n\r\n  public setOptions(options?: PeerTitleOptions) {\r\n    if(!options) {\r\n      return;\r\n    }\r\n\r\n    for(const i in options) {\r\n      // @ts-ignore\r\n      const value = options[i];\r\n\r\n      if(typeof(value) !== 'object') {\r\n        // @ts-ignore\r\n        this.element.dataset[i] = value ? '' + (typeof(value) === 'boolean' ? +value : value) : '0';\r\n      }\r\n\r\n      // @ts-ignore\r\n      this[i] = value;\r\n    }\r\n  }\r\n\r\n  public async update(options?: PeerTitleOptions) {\r\n    this.setOptions(options);\r\n\r\n    let fromName = this.fromName;\r\n    if(fromName !== undefined) {\r\n      if(this.limitSymbols !== undefined) {\r\n        fromName = limitSymbols(fromName, this.limitSymbols, this.limitSymbols);\r\n      }\r\n\r\n      setInnerHTML(this.element, wrapEmojiText(fromName));\r\n      return;\r\n    }\r\n\r\n    this.peerId ??= NULL_PEER_ID;\r\n\r\n    let hasInner: boolean;\r\n    if(this.peerId !== rootScope.myId || !this.dialog) {\r\n      const managers = this.managers ?? rootScope.managers;\r\n      const [title, icons] = await Promise.all([\r\n        getPeerTitle(this.peerId, this.plainText, this.onlyFirstName, this.limitSymbols, managers),\r\n        this.withIcons && generateTitleIcons(this.peerId)\r\n      ]);\r\n\r\n      if(icons?.length) {\r\n        const inner = document.createElement('span');\r\n        inner.classList.add('peer-title-inner');\r\n        hasInner = true;\r\n        setInnerHTML(inner, title);\r\n\r\n        const fragment = document.createDocumentFragment();\r\n        fragment.append(inner, ...icons);\r\n        setInnerHTML(this.element, fragment);\r\n      } else {\r\n        setInnerHTML(this.element, title);\r\n      }\r\n    } else {\r\n      replaceContent(this.element, i18n(this.onlyFirstName ? 'Saved' : 'SavedMessages'));\r\n    }\r\n\r\n    if(this.hasInner !== hasInner) {\r\n      this.hasInner = hasInner;\r\n      this.element.classList.toggle('with-icons', hasInner);\r\n    }\r\n  }\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport type {AppDownloadManager} from '../../lib/appManagers/appDownloadManager';\r\nimport resizeableImage from '../../lib/cropper';\r\nimport PopupElement from '.';\r\nimport {_i18n} from '../../lib/langPack';\r\nimport {attachClickEvent} from '../../helpers/dom/clickEvent';\r\nimport readBlobAsDataURL from '../../helpers/blob/readBlobAsDataURL';\r\nimport rootScope from '../../lib/rootScope';\r\nimport appDownloadManager from '../../lib/appManagers/appDownloadManager';\r\n\r\nexport default class PopupAvatar extends PopupElement {\r\n  private cropContainer: HTMLElement;\r\n  private input: HTMLInputElement;\r\n  private h6: HTMLElement;\r\n\r\n  private image = new Image();\r\n\r\n  private canvas: HTMLCanvasElement;\r\n  private blob: Blob;\r\n  private cropper = {\r\n    crop: () => {},\r\n    removeHandlers: () => {}\r\n  };\r\n\r\n  private onCrop: (upload: () => ReturnType<AppDownloadManager['upload']>) => void;\r\n\r\n  constructor() {\r\n    super('popup-avatar', {closable: true, withConfirm: true});\r\n\r\n    this.h6 = document.createElement('h6');\r\n    _i18n(this.h6, 'Popup.Avatar.Title');\r\n\r\n    this.btnClose.classList.remove('btn-icon');\r\n\r\n    this.header.append(this.h6);\r\n\r\n    this.cropContainer = document.createElement('div');\r\n    this.cropContainer.classList.add('crop');\r\n    this.cropContainer.append(this.image);\r\n\r\n    this.input = document.createElement('input');\r\n    this.input.type = 'file';\r\n    this.input.style.display = 'none';\r\n    this.listenerSetter.add(this.input)('change', (e: any) => {\r\n      const file = e.target.files[0];\r\n      if(!file) {\r\n        return;\r\n      }\r\n\r\n      readBlobAsDataURL(file).then((contents) => {\r\n        this.image = new Image();\r\n        this.cropContainer.append(this.image);\r\n        this.image.src = contents;\r\n\r\n        this.image.onload = () => {\r\n          /* let {w, h} = calcImageInBox(this.image.naturalWidth, this.image.naturalHeight, 460, 554);\r\n          cropContainer.style.width = w + 'px';\r\n          cropContainer.style.height = h + 'px'; */\r\n          this.show();\r\n\r\n          this.cropper = resizeableImage(this.image, this.canvas);\r\n          this.input.value = '';\r\n        };\r\n      });\r\n    }, false);\r\n\r\n    this.btnConfirm.className = 'btn-primary btn-color-primary btn-circle btn-crop btn-icon tgico-check z-depth-1';\r\n    attachClickEvent(this.btnConfirm, () => {\r\n      this.cropper.crop();\r\n      this.hide();\r\n\r\n      this.canvas.toBlob((blob) => {\r\n        this.blob = blob; // save blob to send after reg\r\n        this.darkenCanvas();\r\n        this.resolve();\r\n      }, 'image/jpeg', 1);\r\n    }, {listenerSetter: this.listenerSetter});\r\n\r\n    this.container.append(this.cropContainer, this.btnConfirm, this.input);\r\n\r\n    this.addEventListener('closeAfterTimeout', () => {\r\n      this.cropper.removeHandlers();\r\n      if(this.image) {\r\n        this.image.remove();\r\n      }\r\n    });\r\n  }\r\n\r\n  private resolve() {\r\n    this.onCrop(() => {\r\n      return appDownloadManager.upload(this.blob);\r\n    });\r\n  }\r\n\r\n  public open(postCanvas: HTMLCanvasElement, onCrop: PopupAvatar['onCrop']) {\r\n    this.canvas = postCanvas;\r\n    this.onCrop = onCrop;\r\n\r\n    this.input.click();\r\n  }\r\n\r\n  public darkenCanvas() {\r\n    const ctx = this.canvas.getContext('2d');\r\n    ctx.fillStyle = 'rgba(0, 0, 0, 0.3)';\r\n    ctx.fillRect(0, 0, this.canvas.width, this.canvas.height);\r\n  }\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nfunction resizeableImage(originalImage: HTMLImageElement, canvas?: HTMLCanvasElement) {\r\n  let cropComponent: HTMLDivElement,\r\n    container: HTMLDivElement,\r\n    cropImage: HTMLImageElement,\r\n    event_state: Partial<{\r\n      mouse_x: number,\r\n      mouse_y: number,\r\n      container_width: number,\r\n      container_height: number,\r\n      container_left: number,\r\n      container_top: number\r\n    }> = {},\r\n    keyZoomValue = 4.0,\r\n    MINWIDTH = 50,\r\n    MINHEIGHT = 50,\r\n    CROPWIDTH = 200,\r\n    CROPHEIGHT = 200,\r\n    cropLeft = 0,\r\n    cropTop = 0,\r\n    cropWidth = 0,\r\n    cropHeight = 0,\r\n    scaledRatio = 0;\r\n\r\n  if(originalImage.complete) init();\r\n  else originalImage.onload = init;\r\n\r\n  function removeHandlers() {\r\n    container.removeEventListener('mousedown', startMoving);\r\n    container.removeEventListener('touchstart', startMoving);\r\n    container.removeEventListener('wheel', resizing);\r\n\r\n    document.removeEventListener('mouseup', endMoving);\r\n    document.removeEventListener('touchend', endMoving);\r\n    document.removeEventListener('mousemove', moving);\r\n    document.removeEventListener('touchmove', moving);\r\n    document.removeEventListener('keypress', keyHandler);\r\n\r\n    cropComponent.remove();\r\n    container.remove();\r\n    cropImage.remove();\r\n  }\r\n\r\n  function addHandlers() {\r\n    container.addEventListener('mousedown', startMoving, false);\r\n    container.addEventListener('touchstart', startMoving, false);\r\n    container.addEventListener('wheel', resizing, false);\r\n\r\n    document.addEventListener('keypress', keyHandler, false);\r\n    // document.querySelector('.btn-crop').addEventListener('click', openCropCanvasImg);\r\n  }\r\n\r\n  function init() {\r\n    originalImage.classList.add('crop-blur');\r\n    originalImage.draggable = false;\r\n\r\n    cropImage = new Image();\r\n    cropImage.src = originalImage.src;\r\n    cropImage.draggable = false;\r\n    cropImage.classList.add('crop-overlay-image');\r\n\r\n    if(!canvas) {\r\n      canvas = document.createElement('canvas');\r\n    }\r\n\r\n    cropComponent = document.createElement('div');\r\n    cropComponent.classList.add('crop-component');\r\n\r\n    container = document.createElement('div');\r\n    container.classList.add('crop-overlay');\r\n\r\n    const overlayColor = document.createElement('div');\r\n    overlayColor.classList.add('crop-overlay-color');\r\n\r\n    cropComponent.appendChild(container);\r\n    const wrapper = originalImage.parentNode as HTMLElement;\r\n    wrapper.appendChild(cropComponent);\r\n    cropComponent.appendChild(cropImage);\r\n    cropComponent.appendChild(originalImage);\r\n    cropComponent.appendChild(overlayColor);\r\n    container.appendChild(cropImage);\r\n\r\n    cropImage.style.maxWidth = originalImage.width + 'px';\r\n\r\n    scaledRatio = originalImage.naturalWidth / originalImage.offsetWidth;\r\n\r\n    const left = originalImage.offsetWidth / 2 - CROPWIDTH / 2;\r\n    const top = originalImage.offsetHeight / 2 - CROPHEIGHT / 2;\r\n\r\n    updateCropSize(CROPWIDTH, CROPHEIGHT);\r\n    updateCropImage(left, top);\r\n    updateContainer(left, top);\r\n    addHandlers();\r\n    // crop();\r\n  }\r\n\r\n  function updateCropSize(width: number, height: number) {\r\n    cropWidth = width * scaledRatio;\r\n    cropHeight = height * scaledRatio;\r\n\r\n    container.style.width = width + 'px';\r\n    container.style.height = height + 'px';\r\n  }\r\n\r\n  function updateCropImage(left: number, top: number) {\r\n    cropTop = top * scaledRatio;\r\n    cropLeft = left * scaledRatio;\r\n\r\n    cropImage.style.top = -top + 'px';\r\n    cropImage.style.left = -left + 'px';\r\n  }\r\n\r\n  function updateContainer(left: number, top: number) {\r\n    container.style.top = top + 'px';\r\n    container.style.left = left + 'px';\r\n  }\r\n\r\n  // Save the initial event details and container state\r\n  function saveEventState(e: any) {\r\n    event_state.container_width = container.offsetWidth;\r\n    event_state.container_height = container.offsetHeight;\r\n\r\n    event_state.container_left = container.offsetLeft;\r\n    event_state.container_top = container.offsetTop;\r\n\r\n    event_state.mouse_x = (e.clientX || e.pageX || e.touches && e.touches[0].clientX) + window.scrollX;\r\n    event_state.mouse_y = (e.clientY || e.pageY || e.touches && e.touches[0].clientY) + window.scrollY;\r\n  }\r\n\r\n  function imgZoom(zoom: number) {\r\n    zoom = zoom * Math.PI * 2\r\n    let newWidth = Math.floor(container.clientWidth + zoom),\r\n      newHeight = Math.floor(container.clientHeight + zoom),\r\n      w = cropImage.clientWidth,\r\n      h = cropImage.clientHeight,\r\n      left: number,\r\n      top: number,\r\n      right: number,\r\n      bottom: number;\r\n\r\n    if(newWidth < MINWIDTH) {\r\n      return;\r\n    } else if(newWidth > w) {\r\n      return;\r\n    }\r\n\r\n    left = container.offsetLeft - (zoom / 2);\r\n    top = container.offsetTop - (zoom / 2);\r\n    right = left + newWidth;\r\n    bottom = top + newHeight;\r\n\r\n    if(left < 0) left = 0;\r\n    if(top < 0) top = 0;\r\n\r\n    if(right > w) return;\r\n    if(bottom > h) return;\r\n\r\n    updateCropSize(newWidth, newWidth);\r\n    updateCropImage(left, top);\r\n    updateContainer(left, top);\r\n    // crop();\r\n  }\r\n\r\n  function keyHandler(e: KeyboardEvent) {\r\n    e.preventDefault();\r\n\r\n    switch(String.fromCharCode(e.charCode)) {\r\n      case '+':\r\n        imgZoom(keyZoomValue);\r\n        break;\r\n      case '-':\r\n        imgZoom(-keyZoomValue);\r\n        break;\r\n    }\r\n  }\r\n\r\n  function resizing(e: any) {\r\n    e.preventDefault();\r\n    imgZoom(e.deltaY > 0 ? 1 : -1);\r\n  }\r\n\r\n  function startMoving(e: MouseEvent | TouchEvent) {\r\n    e.preventDefault();\r\n    e.stopPropagation();\r\n\r\n    saveEventState(e);\r\n\r\n    document.addEventListener('mousemove', moving);\r\n    document.addEventListener('touchmove', moving);\r\n    document.addEventListener('mouseup', endMoving);\r\n    document.addEventListener('touchend', endMoving);\r\n  }\r\n\r\n  function endMoving(e: MouseEvent | TouchEvent) {\r\n    e.preventDefault();\r\n\r\n    document.removeEventListener('mouseup', endMoving);\r\n    document.removeEventListener('touchend', endMoving);\r\n    document.removeEventListener('mousemove', moving);\r\n    document.removeEventListener('touchmove', moving);\r\n  }\r\n\r\n  function moving(e: any) {\r\n    let currentTouch = {x: 0, y: 0},\r\n      left: number,\r\n      top: number,\r\n      w: number,\r\n      h: number;\r\n\r\n    e.preventDefault();\r\n    e.stopPropagation();\r\n\r\n    currentTouch.x = e.pageX || e.touches && e.touches[0].pageX;\r\n    currentTouch.y = e.pageY || e.touches && e.touches[0].pageY;\r\n\r\n    left = currentTouch.x - (event_state.mouse_x - event_state.container_left);\r\n    top = currentTouch.y - (event_state.mouse_y - event_state.container_top);\r\n    w = container.offsetWidth;\r\n    h = container.offsetHeight;\r\n\r\n    if(left < 0) left = 0;\r\n    else if(left > cropImage.offsetWidth - w) left = cropImage.offsetWidth - w;\r\n\r\n    if(top < 0) top = 0;\r\n    else if(top > cropImage.offsetHeight - h) top = cropImage.offsetHeight - h;\r\n\r\n    updateCropImage(left, top);\r\n    updateContainer(left, top);\r\n    // crop();\r\n  }\r\n\r\n  function crop() {\r\n    canvas.width = cropWidth;\r\n    canvas.height = cropHeight;\r\n\r\n    const ctx = canvas.getContext('2d');\r\n    ctx.drawImage(originalImage,\r\n      cropLeft, cropTop,\r\n      cropWidth, cropHeight,\r\n      0, 0,\r\n      cropWidth, cropHeight\r\n    );\r\n  }\r\n\r\n  return {crop, removeHandlers};\r\n}\r\n\r\nexport default resizeableImage;\r\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport PopupElement from '.';\nimport type {PeerType} from '../../lib/appManagers/appPeersManager';\nimport {LangPackKey} from '../../lib/langPack';\nimport PeerTitle from '../peerTitle';\nimport PopupPeer, {PopupPeerButtonCallbackCheckboxes, PopupPeerOptions} from './peer';\n\nexport default class PopupDeleteDialog {\n  constructor(\n    private peerId: PeerId,\n    // actionType: 'leave' | 'delete',\n    private peerType?: PeerType,\n    private onSelect?: (promise: Promise<any>) => void\n  ) {\n    this.construct();\n  }\n\n  private async construct() {\n    let {peerId, peerType, onSelect} = this;\n    const peerTitleElement = new PeerTitle({peerId}).element;\n\n    const managers = PopupElement.MANAGERS;\n    if(peerType === undefined) {\n      peerType = await managers.appPeersManager.getDialogType(peerId);\n    }\n\n    /* const callbackFlush = (checked: PopupPeerButtonCallbackCheckboxes) => {\n      const promise = appMessagesManager.flushHistory(peerId, checkboxes ? !checked[checkboxes[0].text] : undefined);\n      onSelect && onSelect(promise);\n    }; */\n\n    const callbackLeave = (checked: PopupPeerButtonCallbackCheckboxes, flush = checkboxes && !!checked.size) => {\n      let promise = managers.appChatsManager.leave(peerId.toChatId());\n\n      if(flush) {\n        promise = promise.finally(() => {\n          return managers.appMessagesManager.flushHistory(peerId);\n        }) as any;\n      }\n\n      onSelect && onSelect(promise);\n    };\n\n    const callbackDelete = (checked: PopupPeerButtonCallbackCheckboxes) => {\n      let promise: Promise<any>;\n\n      if(peerId.isUser()) {\n        promise = managers.appMessagesManager.flushHistory(peerId, false, checkboxes ? !!checked.size : undefined);\n      } else {\n        if(checked.size) {\n          promise = managers.appChatsManager.delete(peerId.toChatId());\n        } else {\n          return callbackLeave(checked);\n        }\n      }\n\n      onSelect && onSelect(promise);\n    };\n\n    let title: LangPackKey, description: LangPackKey, descriptionArgs: any[], buttons: PopupPeerOptions['buttons'], checkboxes: PopupPeerOptions['checkboxes'];\n    switch(peerType) {\n      case 'channel': {\n        if(/* actionType === 'delete' &&  */await managers.appChatsManager.hasRights(peerId.toChatId(), 'delete_chat')) {\n          title = 'ChannelDeleteMenu';\n          description = 'AreYouSureDeleteAndExitChannel';\n          buttons = [{\n            langKey: 'ChannelDeleteMenu',\n            isDanger: true,\n            callback: callbackDelete\n          }];\n\n          checkboxes = [{\n            text: 'DeleteChannelForAll'\n          }];\n        } else {\n          title = 'LeaveChannelMenu';\n          description = 'ChannelLeaveAlertWithName';\n          descriptionArgs = [peerTitleElement];\n          buttons = [{\n            langKey: 'LeaveChannel',\n            isDanger: true,\n            callback: callbackLeave\n          }];\n        }\n\n        break;\n      }\n\n      /* case 'megagroup': {\n        title = 'Leave Group?';\n        description = `Are you sure you want to leave this group?`;\n        buttons = [{\n          text: 'LEAVE ' + peerTitleElement,\n          isDanger: true,\n          callback: callbackLeave\n        }];\n\n        break;\n      } */\n\n      case 'chat': {\n        title = 'DeleteChatUser';\n        description = 'AreYouSureDeleteThisChatWithUser';\n        descriptionArgs = [peerTitleElement];\n\n        buttons = [{\n          langKey: 'DeleteChatUser',\n          isDanger: true,\n          callback: callbackDelete\n        }];\n\n        checkboxes = [{\n          text: 'DeleteMessagesOptionAlso',\n          textArgs: [\n            new PeerTitle({peerId}).element\n          ]\n        }];\n\n        break;\n      }\n\n      case 'saved': {\n        title = 'DeleteChatUser';\n        description = 'AreYouSureDeleteThisChatSavedMessages';\n        buttons = [{\n          langKey: 'DeleteChatUser',\n          isDanger: true,\n          callback: callbackDelete\n        }];\n\n        break;\n      }\n\n      case 'megagroup':\n      case 'group': {\n        if(/* actionType === 'delete' &&  */await managers.appChatsManager.hasRights(peerId.toChatId(), 'delete_chat')) {\n          title = 'DeleteMegaMenu';\n          description = 'AreYouSureDeleteAndExit';\n          buttons = [{\n            langKey: 'DeleteMegaMenu',\n            isDanger: true,\n            callback: callbackDelete\n          }];\n\n          checkboxes = [{\n            text: 'DeleteChat.DeleteGroupForAll'\n          }];\n        } else {\n          title = 'LeaveMegaMenu';\n          description = 'AreYouSureDeleteAndExitName';\n          descriptionArgs = [peerTitleElement];\n          buttons = [{\n            langKey: 'DeleteChatUser',\n            isDanger: true,\n            callback: (checkboxes) => callbackLeave(checkboxes, true)\n          }];\n        }\n\n        break;\n      }\n    }\n\n    new PopupPeer('popup-delete-chat', {\n      peerId,\n      titleLangKey: title,\n      descriptionLangKey: description,\n      descriptionLangArgs: descriptionArgs,\n      buttons,\n      checkboxes\n    }).show();\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport rootScope from '../../lib/rootScope';\nimport PopupElement, {addCancelButton} from '.';\nimport PopupPeer, {PopupPeerButtonCallbackCheckboxes, PopupPeerOptions} from './peer';\nimport {ChatType} from '../chat/chat';\nimport {i18n, LangPackKey} from '../../lib/langPack';\nimport PeerTitle from '../peerTitle';\nimport hasRights from '../../lib/appManagers/utils/chats/hasRights';\nimport filterAsync from '../../helpers/array/filterAsync';\n\nexport default class PopupDeleteMessages {\n  constructor(private peerId: PeerId, private mids: number[], private type: ChatType, private onConfirm?: () => void) {\n    this.construct();\n  }\n\n  private async construct() {\n    let {peerId, mids, type, onConfirm} = this;\n\n    const peerTitleElement = new PeerTitle({peerId}).element;\n\n    const managers = PopupElement.MANAGERS;\n\n    mids = mids.slice();\n    const callback = (checked: PopupPeerButtonCallbackCheckboxes, revoke?: boolean) => {\n      onConfirm && onConfirm();\n      if(type === 'scheduled') {\n        managers.appMessagesManager.deleteScheduledMessages(peerId, mids);\n      } else {\n        managers.appMessagesManager.deleteMessages(peerId, mids, !!checked.size || revoke);\n      }\n    };\n\n    const buttons: PopupPeerOptions['buttons'] = [{\n      langKey: 'Delete',\n      isDanger: true,\n      callback\n    }];\n    const checkboxes: PopupPeerOptions['checkboxes'] = [];\n    let title: LangPackKey, titleArgs: any[], description: LangPackKey, descriptionArgs: any[];\n    if(mids.length === 1) {\n      title = 'DeleteSingleMessagesTitle';\n    } else {\n      title = 'DeleteMessagesTitle';\n      titleArgs = [i18n('messages', [mids.length])];\n    }\n\n    if(await managers.appPeersManager.isMegagroup(peerId)) {\n      description = mids.length === 1 ? 'AreYouSureDeleteSingleMessageMega' : 'AreYouSureDeleteFewMessagesMega';\n    } else {\n      description = mids.length === 1 ? 'AreYouSureDeleteSingleMessage' : 'AreYouSureDeleteFewMessages';\n    }\n\n    if(peerId === rootScope.myId || type === 'scheduled') {\n\n    } else {\n      if(peerId.isUser()) {\n        checkboxes.push({\n          text: 'DeleteMessagesOptionAlso',\n          textArgs: [peerTitleElement]\n        });\n      } else {\n        const chat = await managers.appChatsManager.getChat(peerId.toChatId());\n\n        const _hasRights = hasRights(chat, 'delete_messages');\n        if(chat._ === 'chat') {\n          const canRevoke = _hasRights ? mids.slice() : await filterAsync(mids, async(mid) => {\n            const message = await managers.appMessagesManager.getMessageByPeer(peerId, mid);\n            return message.fromId === rootScope.myId;\n          });\n\n          if(canRevoke.length) {\n            if(canRevoke.length === mids.length) {\n              checkboxes.push({\n                text: 'DeleteForAll'\n              });\n            } else {\n              checkboxes.push({\n                text: 'DeleteMessagesOption'\n              });\n\n              description = 'DeleteMessagesTextGroup';\n              descriptionArgs = [i18n('messages', [canRevoke.length])];\n              // description = `You can also delete the ${canRevoke.length} message${canRevoke.length > 1 ? 's' : ''} you sent from the inboxes of other group members by pressing \"${buttonText}\".`;\n            }\n          }\n        } else {\n          buttons[0].callback = (checked) => callback(checked, true);\n        }\n      }\n    }\n\n    addCancelButton(buttons);\n\n    const popup = new PopupPeer('popup-delete-chat', {\n      peerId,\n      titleLangKey: title,\n      titleLangArgs: titleArgs,\n      descriptionLangKey: description,\n      descriptionLangArgs: descriptionArgs,\n      buttons,\n      checkboxes\n    });\n\n    popup.show();\n  }\n}\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport appImManager from '../../lib/appManagers/appImManager';\r\nimport PopupPickUser from './pickUser';\r\n\r\nexport default class PopupForward extends PopupPickUser {\r\n  constructor(\r\n    peerIdMids: {[fromPeerId: PeerId]: number[]},\r\n    onSelect?: (peerId: PeerId) => Promise<void> | void,\r\n    overrideOnSelect = false\r\n  ) {\r\n    super({\r\n      peerTypes: ['dialogs', 'contacts'],\r\n      onSelect: overrideOnSelect ? onSelect : async(peerId) => {\r\n        if(onSelect) {\r\n          const res = onSelect(peerId);\r\n          if(res instanceof Promise) {\r\n            await res;\r\n          }\r\n        }\r\n\r\n        appImManager.setInnerPeer({peerId});\r\n        appImManager.chat.input.initMessagesForward(peerIdMids);\r\n      },\r\n      placeholder: 'ShareModal.Search.ForwardPlaceholder',\r\n      chatRightsAction: 'send_messages',\r\n      selfPresence: 'ChatYourSelf'\r\n    });\r\n  }\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport ripple from '../ripple';\r\nimport animationIntersector from '../animationIntersector';\r\nimport appNavigationController, {NavigationItem} from '../appNavigationController';\r\nimport {i18n, LangPackKey, _i18n} from '../../lib/langPack';\r\nimport findUpClassName from '../../helpers/dom/findUpClassName';\r\nimport blurActiveElement from '../../helpers/dom/blurActiveElement';\r\nimport ListenerSetter from '../../helpers/listenerSetter';\r\nimport {attachClickEvent, simulateClickEvent} from '../../helpers/dom/clickEvent';\r\nimport isSendShortcutPressed from '../../helpers/dom/isSendShortcutPressed';\r\nimport cancelEvent from '../../helpers/dom/cancelEvent';\r\nimport EventListenerBase, {EventListenerListeners} from '../../helpers/eventListenerBase';\r\nimport {addFullScreenListener, getFullScreenElement} from '../../helpers/dom/fullScreen';\r\nimport indexOfAndSplice from '../../helpers/array/indexOfAndSplice';\r\nimport {AppManagers} from '../../lib/appManagers/managers';\r\nimport overlayCounter from '../../helpers/overlayCounter';\r\nimport Scrollable from '../scrollable';\r\n\r\nexport type PopupButton = {\r\n  text?: string,\r\n  callback?: () => void,\r\n  langKey?: LangPackKey,\r\n  langArgs?: any[],\r\n  isDanger?: true,\r\n  isCancel?: true,\r\n  element?: HTMLButtonElement\r\n};\r\n\r\nexport type PopupOptions = Partial<{\r\n  closable: boolean,\r\n  overlayClosable: boolean,\r\n  withConfirm: LangPackKey | boolean,\r\n  body: boolean,\r\n  confirmShortcutIsSendShortcut: boolean,\r\n  withoutOverlay: boolean,\r\n  scrollable: boolean,\r\n  buttons: Array<PopupButton>,\r\n  title: boolean | LangPackKey\r\n}>;\r\n\r\nexport interface PopupElementConstructable<T extends PopupElement = any> {\r\n  new(...args: any[]): T;\r\n}\r\n\r\nconst DEFAULT_APPEND_TO = document.body;\r\nlet appendPopupTo = DEFAULT_APPEND_TO;\r\n\r\nconst onFullScreenChange = () => {\r\n  appendPopupTo = getFullScreenElement() || DEFAULT_APPEND_TO;\r\n  PopupElement.reAppend();\r\n};\r\n\r\naddFullScreenListener(DEFAULT_APPEND_TO, onFullScreenChange);\r\n\r\ntype PopupListeners = {\r\n  close: () => void,\r\n  closeAfterTimeout: () => void\r\n};\r\n\r\nexport default class PopupElement<T extends EventListenerListeners = {}> extends EventListenerBase<PopupListeners & T> {\r\n  private static POPUPS: PopupElement<any>[] = [];\r\n  public static MANAGERS: AppManagers;\r\n\r\n  protected element = document.createElement('div');\r\n  protected container = document.createElement('div');\r\n  protected header = document.createElement('div');\r\n  protected title = document.createElement('div');\r\n  protected btnClose: HTMLElement;\r\n  protected btnConfirm: HTMLButtonElement;\r\n  protected body: HTMLElement;\r\n  protected buttonsEl: HTMLElement;\r\n\r\n  protected onEscape: () => boolean = () => true;\r\n\r\n  protected navigationItem: NavigationItem;\r\n\r\n  protected listenerSetter: ListenerSetter;\r\n\r\n  protected confirmShortcutIsSendShortcut: boolean;\r\n  protected btnConfirmOnEnter: HTMLElement;\r\n\r\n  protected withoutOverlay: boolean;\r\n\r\n  protected managers: AppManagers;\r\n\r\n  protected scrollable: Scrollable;\r\n\r\n  protected buttons: Array<PopupButton>;\r\n\r\n  constructor(className: string, options: PopupOptions = {}) {\r\n    super(false);\r\n    this.element.classList.add('popup');\r\n    this.element.className = 'popup' + (className ? ' ' + className : '');\r\n    this.container.classList.add('popup-container', 'z-depth-1');\r\n\r\n    this.header.classList.add('popup-header');\r\n\r\n    if(options.title) {\r\n      this.title.classList.add('popup-title');\r\n      if(typeof(options.title) === 'string') {\r\n        _i18n(this.title, options.title);\r\n      }\r\n\r\n      this.header.append(this.title);\r\n    }\r\n\r\n    this.listenerSetter = new ListenerSetter();\r\n    this.managers = PopupElement.MANAGERS;\r\n\r\n    this.confirmShortcutIsSendShortcut = options.confirmShortcutIsSendShortcut;\r\n\r\n    if(options.closable) {\r\n      this.btnClose = document.createElement('span');\r\n      this.btnClose.classList.add('btn-icon', 'popup-close', 'tgico-close');\r\n      // ripple(this.closeBtn);\r\n      this.header.prepend(this.btnClose);\r\n\r\n      attachClickEvent(this.btnClose, this.hide, {listenerSetter: this.listenerSetter, once: true});\r\n    }\r\n\r\n    this.withoutOverlay = options.withoutOverlay;\r\n    if(this.withoutOverlay) {\r\n      this.element.classList.add('no-overlay');\r\n    }\r\n\r\n    if(options.overlayClosable) {\r\n      attachClickEvent(this.element, (e: MouseEvent) => {\r\n        if(!findUpClassName(e.target, 'popup-container')) {\r\n          this.hide();\r\n        }\r\n      }, {listenerSetter: this.listenerSetter});\r\n    }\r\n\r\n    if(options.withConfirm) {\r\n      this.btnConfirm = document.createElement('button');\r\n      this.btnConfirm.classList.add('btn-primary', 'btn-color-primary');\r\n      if(options.withConfirm !== true) {\r\n        this.btnConfirm.append(i18n(options.withConfirm));\r\n      }\r\n      this.header.append(this.btnConfirm);\r\n      ripple(this.btnConfirm);\r\n    }\r\n\r\n    this.container.append(this.header);\r\n    if(options.body) {\r\n      this.body = document.createElement('div');\r\n      this.body.classList.add('popup-body');\r\n      this.container.append(this.body);\r\n    }\r\n\r\n    if(options.scrollable) {\r\n      const scrollable = this.scrollable = new Scrollable(this.body);\r\n      scrollable.onAdditionalScroll = () => {\r\n        scrollable.container.classList.toggle('scrolled-top', !scrollable.scrollTop);\r\n        scrollable.container.classList.toggle('scrolled-bottom', scrollable.isScrolledDown);\r\n      };\r\n\r\n      scrollable.container.classList.add('scrolled-top', 'scrolled-bottom', 'scrollable-y-bordered');\r\n\r\n      if(!this.body) {\r\n        this.container.insertBefore(scrollable.container, this.header.nextSibling);\r\n      }\r\n    }\r\n\r\n    let btnConfirmOnEnter = this.btnConfirm;\r\n    const buttons = this.buttons = options.buttons;\r\n    if(buttons?.length) {\r\n      const buttonsDiv = this.buttonsEl = document.createElement('div');\r\n      buttonsDiv.classList.add('popup-buttons');\r\n\r\n      const buttonsElements = buttons.map((b) => {\r\n        const button = document.createElement('button');\r\n        button.className = 'btn' + (b.isDanger ? ' danger' : ' primary');\r\n\r\n        ripple(button);\r\n\r\n        if(b.text) {\r\n          button.innerHTML =  b.text;\r\n        } else {\r\n          button.append(i18n(b.langKey, b.langArgs));\r\n        }\r\n\r\n        attachClickEvent(button, () => {\r\n          b.callback && b.callback();\r\n          this.destroy();\r\n        }, {listenerSetter: this.listenerSetter, once: true});\r\n\r\n        return b.element = button;\r\n      });\r\n\r\n      if(!btnConfirmOnEnter && buttons.length === 2) {\r\n        const button = buttons.find((button) => !button.isCancel);\r\n        if(button) {\r\n          btnConfirmOnEnter = button.element;\r\n        }\r\n      }\r\n\r\n      buttonsDiv.append(...buttonsElements);\r\n      this.container.append(buttonsDiv);\r\n    }\r\n\r\n    this.btnConfirmOnEnter = btnConfirmOnEnter;\r\n\r\n    this.element.append(this.container);\r\n\r\n    PopupElement.POPUPS.push(this);\r\n  }\r\n\r\n  protected onContentUpdate() {\r\n    if(this.scrollable) {\r\n      this.scrollable.onAdditionalScroll();\r\n    }\r\n  }\r\n\r\n  public show() {\r\n    this.navigationItem = {\r\n      type: 'popup',\r\n      onPop: () => this.destroy(),\r\n      onEscape: this.onEscape\r\n    };\r\n\r\n    appNavigationController.pushItem(this.navigationItem);\r\n\r\n    blurActiveElement(); // * hide mobile keyboard\r\n    appendPopupTo.append(this.element);\r\n    void this.element.offsetWidth; // reflow\r\n    this.element.classList.add('active');\r\n\r\n    this.onContentUpdate();\r\n\r\n    if(!this.withoutOverlay) {\r\n      overlayCounter.isOverlayActive = true;\r\n      animationIntersector.checkAnimations(true);\r\n    }\r\n\r\n    // cannot add event instantly because keydown propagation will fire it\r\n    // if(this.btnConfirmOnEnter) {\r\n    setTimeout(() => {\r\n      if(!this.element.classList.contains('active')) {\r\n        return;\r\n      }\r\n\r\n      this.listenerSetter.add(document.body)('keydown', (e) => {\r\n        if(PopupElement.POPUPS[PopupElement.POPUPS.length - 1] !== this) {\r\n          return;\r\n        }\r\n\r\n        if(this.confirmShortcutIsSendShortcut ? isSendShortcutPressed(e) : e.key === 'Enter') {\r\n          simulateClickEvent(this.btnConfirmOnEnter);\r\n          cancelEvent(e);\r\n        }\r\n      });\r\n    }, 0);\r\n    // }\r\n  }\r\n\r\n  public hide = () => {\r\n    appNavigationController.backByItem(this.navigationItem);\r\n  };\r\n\r\n  protected destroy() {\r\n    this.dispatchEvent<PopupListeners>('close');\r\n    this.element.classList.add('hiding');\r\n    this.element.classList.remove('active');\r\n    this.listenerSetter.removeAll();\r\n\r\n    if(!this.withoutOverlay) {\r\n      overlayCounter.isOverlayActive = false;\r\n    }\r\n\r\n    appNavigationController.removeItem(this.navigationItem);\r\n    this.navigationItem = undefined;\r\n\r\n    indexOfAndSplice(PopupElement.POPUPS, this);\r\n\r\n    // ! calm\r\n    onFullScreenChange();\r\n\r\n    setTimeout(() => {\r\n      this.element.remove();\r\n      this.dispatchEvent<PopupListeners>('closeAfterTimeout');\r\n      this.cleanup();\r\n\r\n      if(!this.withoutOverlay) {\r\n        animationIntersector.checkAnimations(false);\r\n      }\r\n    }, 150);\r\n  }\r\n\r\n  public static reAppend() {\r\n    this.POPUPS.forEach((popup) => {\r\n      const {element, container} = popup;\r\n      const parentElement = element.parentElement;\r\n      if(parentElement && parentElement !== appendPopupTo && appendPopupTo !== container) {\r\n        appendPopupTo.append(element);\r\n      }\r\n    });\r\n  }\r\n\r\n  public static getPopups<T extends PopupElement>(popupConstructor: PopupElementConstructable<T>) {\r\n    return this.POPUPS.filter((element) => element instanceof popupConstructor) as T[];\r\n  }\r\n\r\n  public static createPopup<T extends PopupElement, A extends Array<any>>(ctor: {new(...args: A): T}, ...args: A) {\r\n    const popup = new ctor(...args);\r\n    return popup;\r\n  }\r\n}\r\n\r\nexport const addCancelButton = (buttons: PopupButton[]) => {\r\n  const button = buttons.find((b) => b.isCancel);\r\n  if(!button) {\r\n    buttons.push({\r\n      langKey: 'Cancel',\r\n      isCancel: true\r\n    });\r\n  }\r\n\r\n  return buttons;\r\n};\r\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport tsNow from '../../helpers/tsNow';\nimport {LangPackKey} from '../../lib/langPack';\nimport {MUTE_UNTIL} from '../../lib/mtproto/mtproto_config';\nimport RadioField from '../radioField';\nimport Row, {RadioFormFromRows} from '../row';\nimport PopupPeer from './peer';\n\nconst ONE_HOUR = 3600;\nconst times: {time: number, langKey: LangPackKey}[] = [{\n  time: ONE_HOUR,\n  langKey: 'ChatList.Mute.1Hour'\n}, {\n  time: ONE_HOUR * 4,\n  langKey: 'ChatList.Mute.4Hours'\n}, {\n  time: ONE_HOUR * 8,\n  langKey: 'ChatList.Mute.8Hours'\n}, {\n  time: ONE_HOUR * 24,\n  langKey: 'ChatList.Mute.1Day'\n}, {\n  time: ONE_HOUR * 24 * 3,\n  langKey: 'ChatList.Mute.3Days'\n}, {\n  time: -1,\n  langKey: 'ChatList.Mute.Forever'\n}];\n\nexport default class PopupMute extends PopupPeer {\n  constructor(peerId: PeerId) {\n    super('popup-mute', {\n      peerId,\n      titleLangKey: 'Notifications',\n      buttons: [{\n        langKey: 'ChatList.Context.Mute',\n        callback: () => {\n          this.managers.appMessagesManager.mutePeer(peerId, time === -1 ? MUTE_UNTIL : tsNow(true) + time);\n        }\n      }],\n      body: true\n    });\n\n    const name = 'mute-time';\n    const rows = times.map((time) => {\n      const row = new Row({\n        radioField: new RadioField({\n          langKey: time.langKey,\n          name,\n          value: '' + time.time\n        })\n      });\n\n      return row;\n    });\n\n    let time: number;\n    const radioForm = RadioFormFromRows(rows, (value) => {\n      time = +value;\n    });\n\n    this.body.append(radioForm);\n\n    rows[rows.length - 1].radioField.checked = true;\n\n    this.show();\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport AvatarElement from '../avatar';\nimport PopupElement, {addCancelButton, PopupButton, PopupOptions} from '.';\nimport {i18n, LangPackKey} from '../../lib/langPack';\nimport CheckboxField, {CheckboxFieldOptions} from '../checkboxField';\nimport setInnerHTML from '../../helpers/dom/setInnerHTML';\n\nexport type PopupPeerButton = Omit<PopupButton, 'callback'> & Partial<{callback: PopupPeerButtonCallback}>;\nexport type PopupPeerButtonCallbackCheckboxes = Set<LangPackKey>;\nexport type PopupPeerButtonCallback = (checkboxes?: PopupPeerButtonCallbackCheckboxes) => void;\nexport type PopupPeerCheckboxOptions = CheckboxFieldOptions & {checkboxField?: CheckboxField};\n\nexport type PopupPeerOptions = Omit<PopupOptions, 'buttons' | 'title'> & Partial<{\n  peerId: PeerId,\n  title: string | HTMLElement,\n  titleLangKey: LangPackKey,\n  titleLangArgs: any[],\n  noTitle: boolean,\n  description: string | DocumentFragment,\n  descriptionLangKey: LangPackKey,\n  descriptionLangArgs: any[],\n  buttons: Array<PopupPeerButton>,\n  checkboxes: Array<PopupPeerCheckboxOptions>\n}>;\nexport default class PopupPeer extends PopupElement {\n  protected description: HTMLParagraphElement;\n\n  constructor(private className: string, options: PopupPeerOptions = {}) {\n    super('popup-peer' + (className ? ' ' + className : ''), {\n      overlayClosable: true,\n      ...options,\n      title: true,\n      buttons: options.buttons && addCancelButton(options.buttons)\n    });\n\n    if(options.peerId) {\n      const avatarEl = new AvatarElement();\n      avatarEl.classList.add('avatar-32');\n      avatarEl.updateWithOptions({\n        isDialog: true,\n        peerId: options.peerId\n      });\n      this.header.prepend(avatarEl);\n    }\n\n    if(!options.noTitle) {\n      if(options.titleLangKey || !options.title) this.title.append(i18n(options.titleLangKey || 'AppName', options.titleLangArgs));\n      else if(options.title instanceof HTMLElement) {\n        this.title.append(options.title);\n      } else this.title.innerText = options.title || '';\n    }\n\n    const fragment = document.createDocumentFragment();\n\n    if(options.descriptionLangKey || options.description) {\n      const p = this.description = document.createElement('p');\n      p.classList.add('popup-description');\n      if(options.descriptionLangKey) p.append(i18n(options.descriptionLangKey, options.descriptionLangArgs));\n      else if(options.description) setInnerHTML(p, options.description);\n\n      fragment.append(p);\n    }\n\n    if(options.checkboxes) {\n      this.container.classList.add('have-checkbox');\n\n      options.checkboxes.forEach((o) => {\n        o.withRipple = true;\n        const checkboxField = new CheckboxField(o);\n        o.checkboxField = checkboxField;\n        fragment.append(checkboxField.label);\n      });\n\n      options.buttons.forEach((button) => {\n        if(button.callback) {\n          const original = button.callback;\n          button.callback = () => {\n            const c: Set<LangPackKey> = new Set();\n            options.checkboxes.forEach((o) => {\n              if(o.checkboxField.checked) {\n                c.add(o.text);\n              }\n            });\n            original(c);\n          };\n        }\n      });\n    }\n\n    this.container.insertBefore(fragment, this.header.nextElementSibling);\n  }\n}\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport IS_TOUCH_SUPPORTED from '../../environment/touchSupport';\r\nimport AppSelectPeers from '../appSelectPeers';\r\nimport PopupElement from '.';\r\nimport {LangPackKey, _i18n} from '../../lib/langPack';\r\n\r\nexport default class PopupPickUser extends PopupElement {\r\n  protected selector: AppSelectPeers;\r\n\r\n  constructor(options: {\r\n    peerTypes: AppSelectPeers['peerType'],\r\n    onSelect?: (peerId: PeerId) => Promise<void> | void,\r\n    placeholder: LangPackKey,\r\n    chatRightsAction?: AppSelectPeers['chatRightsAction'],\r\n    peerId?: number,\r\n    selfPresence?: LangPackKey\r\n  }) {\r\n    super('popup-forward', {closable: true, overlayClosable: true, body: true, title: true});\r\n\r\n    this.selector = new AppSelectPeers({\r\n      appendTo: this.body,\r\n      onChange: async() => {\r\n        const selected = this.selector.getSelected();\r\n        const peerId = selected[selected.length - 1].toPeerId();\r\n\r\n        if(options.onSelect) {\r\n          const res = options.onSelect(peerId);\r\n          if(res instanceof Promise) {\r\n            try {\r\n              await res;\r\n            } catch(err) {\r\n              return;\r\n            }\r\n          }\r\n        }\r\n\r\n        this.selector = null;\r\n        this.hide();\r\n      },\r\n      peerType: options.peerTypes,\r\n      onFirstRender: () => {\r\n        this.show();\r\n        this.selector.checkForTriggers(); // ! due to zero height before mounting\r\n\r\n        if(!IS_TOUCH_SUPPORTED) {\r\n          this.selector.input.focus();\r\n        }\r\n      },\r\n      chatRightsAction: options.chatRightsAction,\r\n      multiSelect: false,\r\n      rippleEnabled: false,\r\n      avatarSize: 46,\r\n      peerId: options.peerId,\r\n      placeholder: options.placeholder,\r\n      selfPresence: options.selfPresence,\r\n      managers: this.managers\r\n    });\r\n\r\n    // this.scrollable = new Scrollable(this.body);\r\n\r\n    this.title.append(this.selector.input);\r\n  }\r\n}\r\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport PopupPeer from './peer';\n\nexport default class PopupSendNow extends PopupPeer {\n  constructor(peerId: PeerId, mids: number[], onConfirm?: () => void) {\n    super('popup-delete-chat', {\n      title: `Send Message${mids.length > 1 ? 's' : ''} Now`,\n      description: mids.length > 1 ? 'Send ' + mids.length + ' messages now?' : 'Send message now?',\n      buttons: [{\n        langKey: 'Send',\n        callback: () => {\n          onConfirm && onConfirm();\n          this.managers.appMessagesManager.sendScheduledMessages(peerId, mids);\n        }\n      }]\n    });\n\n    this.show();\n  }\n}\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport PopupElement from '.';\r\nimport type {AppStickersManager} from '../../lib/appManagers/appStickersManager';\r\nimport {wrapSticker} from '../wrappers';\r\nimport LazyLoadQueue from '../lazyLoadQueue';\r\nimport {putPreloader} from '../putPreloader';\r\nimport animationIntersector, {AnimationItemGroup} from '../animationIntersector';\r\nimport appImManager from '../../lib/appManagers/appImManager';\r\nimport mediaSizes from '../../helpers/mediaSizes';\r\nimport {i18n} from '../../lib/langPack';\r\nimport Button from '../button';\r\nimport findUpClassName from '../../helpers/dom/findUpClassName';\r\nimport toggleDisability from '../../helpers/dom/toggleDisability';\r\nimport {attachClickEvent} from '../../helpers/dom/clickEvent';\r\nimport {toastNew} from '../toast';\r\nimport setInnerHTML from '../../helpers/dom/setInnerHTML';\r\nimport wrapEmojiText from '../../lib/richTextProcessor/wrapEmojiText';\r\nimport createStickersContextMenu from '../../helpers/dom/createStickersContextMenu';\r\nimport attachStickerViewerListeners from '../stickerViewer';\r\n\r\nconst ANIMATION_GROUP: AnimationItemGroup = 'STICKERS-POPUP';\r\n\r\nexport default class PopupStickers extends PopupElement {\r\n  private stickersFooter: HTMLElement;\r\n  private stickersDiv: HTMLElement;\r\n\r\n  constructor(private stickerSetInput: Parameters<AppStickersManager['getStickerSet']>[0]) {\r\n    super('popup-stickers', {closable: true, overlayClosable: true, body: true, scrollable: true, title: true});\r\n\r\n    this.title.append(i18n('Loading'));\r\n\r\n    this.addEventListener('close', () => {\r\n      animationIntersector.setOnlyOnePlayableGroup();\r\n      destroy();\r\n    });\r\n\r\n    const div = document.createElement('div');\r\n    div.classList.add('sticker-set');\r\n\r\n    this.stickersDiv = document.createElement('div');\r\n    this.stickersDiv.classList.add('sticker-set-stickers', 'is-loading');\r\n\r\n    attachClickEvent(this.stickersDiv, this.onStickersClick, {listenerSetter: this.listenerSetter});\r\n\r\n    putPreloader(this.stickersDiv, true);\r\n\r\n    this.stickersFooter = document.createElement('div');\r\n    this.stickersFooter.classList.add('sticker-set-footer');\r\n\r\n    div.append(this.stickersDiv);\r\n\r\n    const btn = Button('btn-primary btn-primary-transparent disable-hover', {noRipple: true, text: 'Loading'});\r\n    this.stickersFooter.append(btn);\r\n\r\n    this.scrollable.append(div);\r\n    this.body.append(this.stickersFooter);\r\n\r\n    const {destroy} = createStickersContextMenu({\r\n      listenTo: this.stickersDiv,\r\n      isStickerPack: true\r\n    });\r\n\r\n    attachStickerViewerListeners({listenTo: this.stickersDiv, listenerSetter: this.listenerSetter});\r\n\r\n    this.loadStickerSet();\r\n  }\r\n\r\n  private onStickersClick = (e: MouseEvent) => {\r\n    const target = findUpClassName(e.target, 'sticker-set-sticker');\r\n    if(!target) return;\r\n\r\n    const docId = target.dataset.docId;\r\n    if(appImManager.chat.input.sendMessageWithDocument(docId)) {\r\n      this.hide();\r\n    }\r\n  };\r\n\r\n  private loadStickerSet() {\r\n    return this.managers.appStickersManager.getStickerSet(this.stickerSetInput).then(async(set) => {\r\n      if(!set) {\r\n        toastNew({langPackKey: 'StickerSet.DontExist'});\r\n        this.hide();\r\n        return;\r\n      }\r\n\r\n      animationIntersector.setOnlyOnePlayableGroup(ANIMATION_GROUP);\r\n\r\n      let button: HTMLElement;\r\n      const s = i18n('Stickers', [set.set.count]);\r\n      if(set.set.installed_date) {\r\n        button = Button('btn-primary btn-primary-transparent danger', {noRipple: true});\r\n        button.append(i18n('RemoveStickersCount', [s]));\r\n      } else {\r\n        button = Button('btn-primary btn-color-primary', {noRipple: true});\r\n        button.append(i18n('AddStickersCount', [s]));\r\n      }\r\n\r\n      attachClickEvent(button, () => {\r\n        const toggle = toggleDisability([button], true);\r\n\r\n        this.managers.appStickersManager.toggleStickerSet(set.set).then(() => {\r\n          this.hide();\r\n        }).catch(() => {\r\n          toggle();\r\n        });\r\n      });\r\n\r\n      const lazyLoadQueue = new LazyLoadQueue();\r\n      const divs = await Promise.all(set.documents.map(async(doc) => {\r\n        if(doc._ === 'documentEmpty') {\r\n          return;\r\n        }\r\n\r\n        const div = document.createElement('div');\r\n        div.classList.add('sticker-set-sticker');\r\n\r\n        const size = mediaSizes.active.esgSticker.width;\r\n\r\n        await wrapSticker({\r\n          doc,\r\n          div,\r\n          lazyLoadQueue,\r\n          group: ANIMATION_GROUP,\r\n          play: true,\r\n          loop: true,\r\n          width: size,\r\n          height: size,\r\n          withLock: true\r\n        });\r\n\r\n        return div;\r\n      }));\r\n\r\n      setInnerHTML(this.title, wrapEmojiText(set.set.title));\r\n      this.stickersFooter.classList.toggle('add', !set.set.installed_date);\r\n      this.stickersFooter.textContent = '';\r\n      this.stickersFooter.append(button);\r\n\r\n      this.stickersDiv.classList.remove('is-loading');\r\n      this.stickersDiv.innerHTML = '';\r\n      this.stickersDiv.append(...divs.filter(Boolean));\r\n\r\n      this.scrollable.onAdditionalScroll();\r\n    });\r\n  }\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport {CancellablePromise} from '../helpers/cancellablePromise';\r\nimport SetTransition from './singleTransition';\r\nimport {fastRaf} from '../helpers/schedulers';\r\nimport cancelEvent from '../helpers/dom/cancelEvent';\r\nimport {attachClickEvent} from '../helpers/dom/clickEvent';\r\nimport isInDOM from '../helpers/dom/isInDOM';\r\nimport safeAssign from '../helpers/object/safeAssign';\r\n\r\nconst TRANSITION_TIME = 200;\r\n\r\nexport default class ProgressivePreloader {\r\n  public preloader: HTMLDivElement;\r\n  public circle: SVGCircleElement;\r\n  private cancelSvg: SVGSVGElement;\r\n  private downloadSvg: HTMLElement;\r\n\r\n  private tempId = 0;\r\n  public detached = true;\r\n\r\n  public promise: CancellablePromise<any> = null;\r\n\r\n  public isUpload = false;\r\n  private cancelable = true;\r\n  private streamable = false;\r\n  private tryAgainOnFail = true;\r\n  private attachMethod: 'append' | 'prepend' = 'append';\r\n\r\n  public loadFunc: (e?: Event) => any;\r\n\r\n  public totalLength: number;\r\n\r\n  constructor(options?: Partial<{\r\n    isUpload: ProgressivePreloader['isUpload'],\r\n    cancelable: ProgressivePreloader['cancelable'],\r\n    streamable: ProgressivePreloader['streamable'],\r\n    tryAgainOnFail: ProgressivePreloader['tryAgainOnFail'],\r\n    attachMethod: ProgressivePreloader['attachMethod']\r\n  }>) {\r\n    if(options) {\r\n      safeAssign(this, options);\r\n    }\r\n\r\n    if(this.isUpload) {\r\n      this.tryAgainOnFail = false;\r\n    }\r\n  }\r\n\r\n  public constructContainer(options: Partial<{\r\n    color: 'transparent',\r\n    bold: boolean\r\n  }> = {}) {\r\n    if(!this.preloader) {\r\n      this.preloader = document.createElement('div');\r\n      this.preloader.classList.add('preloader-container');\r\n\r\n      if(options.color) {\r\n        this.preloader.classList.add('preloader-' + options.color);\r\n      }\r\n\r\n      if(options.bold) {\r\n        this.preloader.classList.add('preloader-bold');\r\n      }\r\n\r\n      if(this.streamable) {\r\n        this.preloader.classList.add('preloader-streamable');\r\n      }\r\n    }\r\n  }\r\n\r\n  public constructDownloadIcon() {\r\n    this.constructContainer();\r\n  }\r\n\r\n  public construct() {\r\n    this.construct = null;\r\n\r\n    this.constructContainer();\r\n\r\n    this.preloader.innerHTML = `\r\n    <div class=\"you-spin-me-round\">\r\n    <svg xmlns=\"http://www.w3.org/2000/svg\" class=\"preloader-circular\" viewBox=\"${this.streamable ? '25 25 50 50' : '27 27 54 54'}\">\r\n    <circle class=\"preloader-path-new\" cx=\"${this.streamable ? '50' : '54'}\" cy=\"${this.streamable ? '50' : '54'}\" r=\"${this.streamable ? 19 : 24}\" fill=\"none\" stroke-miterlimit=\"10\"/>\r\n    </svg>\r\n    </div>`;\r\n\r\n    if(this.streamable) {\r\n      this.totalLength = 118.61124420166016;\r\n    } else {\r\n      this.totalLength = 149.82473754882812;\r\n    }\r\n\r\n    if(this.cancelable) {\r\n      this.preloader.innerHTML += `\r\n      <svg xmlns=\"http://www.w3.org/2000/svg\" class=\"preloader-close\" viewBox=\"0 0 24 24\">\r\n        <g fill=\"none\" fill-rule=\"evenodd\">\r\n          <polygon points=\"0 0 24 0 24 24 0 24\"/>\r\n          <path fill=\"#000\" fill-rule=\"nonzero\" d=\"M5.20970461,5.38710056 L5.29289322,5.29289322 C5.65337718,4.93240926 6.22060824,4.90467972 6.61289944,5.20970461 L6.70710678,5.29289322 L12,10.585 L17.2928932,5.29289322 C17.6834175,4.90236893 18.3165825,4.90236893 18.7071068,5.29289322 C19.0976311,5.68341751 19.0976311,6.31658249 18.7071068,6.70710678 L13.415,12 L18.7071068,17.2928932 C19.0675907,17.6533772 19.0953203,18.2206082 18.7902954,18.6128994 L18.7071068,18.7071068 C18.3466228,19.0675907 17.7793918,19.0953203 17.3871006,18.7902954 L17.2928932,18.7071068 L12,13.415 L6.70710678,18.7071068 C6.31658249,19.0976311 5.68341751,19.0976311 5.29289322,18.7071068 C4.90236893,18.3165825 4.90236893,17.6834175 5.29289322,17.2928932 L10.585,12 L5.29289322,6.70710678 C4.93240926,6.34662282 4.90467972,5.77939176 5.20970461,5.38710056 L5.29289322,5.29289322 L5.20970461,5.38710056 Z\"/>\r\n        </g>\r\n      </svg>\r\n      <svg xmlns=\"http://www.w3.org/2000/svg\" class=\"preloader-download\" viewBox=\"0 0 24 24\">\r\n        <g fill=\"none\" fill-rule=\"evenodd\">\r\n          <polygon points=\"0 0 24 0 24 24 0 24\"/>\r\n          <path fill=\"#000\" fill-rule=\"nonzero\" d=\"M5,19 L19,19 C19.5522847,19 20,19.4477153 20,20 C20,20.5128358 19.6139598,20.9355072 19.1166211,20.9932723 L19,21 L5,21 C4.44771525,21 4,20.5522847 4,20 C4,19.4871642 4.38604019,19.0644928 4.88337887,19.0067277 L5,19 L19,19 L5,19 Z M11.8833789,3.00672773 L12,3 C12.5128358,3 12.9355072,3.38604019 12.9932723,3.88337887 L13,4 L13,13.585 L16.2928932,10.2928932 C16.6533772,9.93240926 17.2206082,9.90467972 17.6128994,10.2097046 L17.7071068,10.2928932 C18.0675907,10.6533772 18.0953203,11.2206082 17.7902954,11.6128994 L17.7071068,11.7071068 L12.7071068,16.7071068 C12.3466228,17.0675907 11.7793918,17.0953203 11.3871006,16.7902954 L11.2928932,16.7071068 L6.29289322,11.7071068 C5.90236893,11.3165825 5.90236893,10.6834175 6.29289322,10.2928932 C6.65337718,9.93240926 7.22060824,9.90467972 7.61289944,10.2097046 L7.70710678,10.2928932 L11,13.585 L11,4 C11,3.48716416 11.3860402,3.06449284 11.8833789,3.00672773 L12,3 L11.8833789,3.00672773 Z\"/>\r\n        </g>\r\n      </svg>`;\r\n\r\n      this.downloadSvg = this.preloader.lastElementChild as HTMLElement;\r\n      this.cancelSvg = this.downloadSvg.previousElementSibling as any;\r\n    } else {\r\n      this.preloader.classList.add('preloader-swing');\r\n    }\r\n\r\n    this.circle = this.preloader.firstElementChild.firstElementChild.firstElementChild as SVGCircleElement;\r\n\r\n    if(this.cancelable) {\r\n      attachClickEvent(this.preloader, this.onClick);\r\n    }\r\n  }\r\n\r\n  public onClick = (e?: Event) => {\r\n    if(e) {\r\n      cancelEvent(e);\r\n    }\r\n\r\n    if(this.preloader.classList.contains('manual')) {\r\n      if(this.loadFunc) {\r\n        this.loadFunc(e);\r\n      }\r\n    } else {\r\n      if(this.promise && this.promise.cancel) {\r\n        this.promise.cancel();\r\n      }\r\n    }\r\n  };\r\n\r\n  public setDownloadFunction(func: ProgressivePreloader['loadFunc']) {\r\n    this.loadFunc = func;\r\n  }\r\n\r\n  public setManual() {\r\n    this.preloader.classList.add('manual');\r\n    this.setProgress(0);\r\n  }\r\n\r\n  public attachPromise(promise: CancellablePromise<any>) {\r\n    if(this.isUpload && this.promise) return;\r\n\r\n    this.promise = promise;\r\n\r\n    const tempId = --this.tempId;\r\n    const startTime = Date.now();\r\n\r\n    const onEnd = (err: Error) => {\r\n      promise.notify = promise.notifyAll = null;\r\n\r\n      if(tempId !== this.tempId) {\r\n        return;\r\n      }\r\n\r\n      const elapsedTime = Date.now() - startTime;\r\n\r\n      // console.log('[PP]: end', this.detached, performance.now());\r\n\r\n      if(!err && this.cancelable) {\r\n        this.setProgress(100);\r\n\r\n        const delay = TRANSITION_TIME * 0.75;\r\n\r\n        if(elapsedTime < delay) {\r\n          this.detach();\r\n        } else {\r\n          setTimeout(() => { // * wait for transition complete\r\n            if(tempId === this.tempId) {\r\n              this.detach();\r\n            }\r\n          }, delay);\r\n        }\r\n      } else {\r\n        if(this.tryAgainOnFail) {\r\n          this.attach(this.preloader.parentElement);\r\n          fastRaf(() => {\r\n            this.setManual();\r\n          });\r\n        } else {\r\n          this.detach();\r\n        }\r\n      }\r\n\r\n      this.promise = promise = null;\r\n    };\r\n\r\n    promise\r\n    .then(() => onEnd(null))\r\n    .catch((err) => onEnd(err));\r\n\r\n    if(promise.addNotifyListener) {\r\n      promise.addNotifyListener((details: {done: number, total: number}) => {\r\n        /* if(details.done >= details.total) {\r\n          onEnd();\r\n        } */\r\n\r\n        if(tempId !== this.tempId) return;\r\n\r\n        // console.log('preloader download', promise, details);\r\n        const percents = details.done / details.total * 100;\r\n        this.setProgress(percents);\r\n      });\r\n    }\r\n  }\r\n\r\n  public attach(elem: Element, reset = false, promise?: CancellablePromise<any>) {\r\n    if(this.construct) {\r\n      this.construct();\r\n    }\r\n\r\n    if(this.preloader.parentElement) {\r\n      this.preloader.classList.remove('manual');\r\n    }\r\n\r\n    this.detached = false;\r\n\r\n    if(promise/*  && false */) {\r\n      this.attachPromise(promise);\r\n    }\r\n\r\n    let useRafs = 0;\r\n    if(this.detached || this.preloader.parentElement !== elem) {\r\n      useRafs = isInDOM(this.preloader) ? 1 : 2;\r\n      if(this.preloader.parentElement !== elem) {\r\n        elem[this.attachMethod](this.preloader);\r\n      }\r\n    }\r\n\r\n    SetTransition(this.preloader, 'is-visible', true, TRANSITION_TIME, undefined, useRafs);\r\n\r\n    if(this.cancelable && reset) {\r\n      this.setProgress(0);\r\n    }\r\n  }\r\n\r\n  public detach() {\r\n    if(this.detached) {\r\n      return;\r\n    }\r\n    // return;\r\n\r\n    this.detached = true;\r\n\r\n    // return;\r\n\r\n    if(this.preloader?.parentElement) {\r\n      /* setTimeout(() =>  */// fastRaf(() => {\r\n      /* if(!this.detached) return;\r\n        this.detached = true; */\r\n\r\n      // fastRaf(() => {\r\n      // console.log('[PP]: detach after rAF', this.detached, performance.now());\r\n\r\n      // if(!this.detached || !this.preloader.parentElement) {\r\n      //   return;\r\n      // }\r\n\r\n      SetTransition(this.preloader, 'is-visible', false, TRANSITION_TIME, () => {\r\n        this.preloader.remove();\r\n      }, 1);\r\n      // });\r\n      // })/* , 5e3) */;\r\n    }\r\n  }\r\n\r\n  public setProgress(percents: number) {\r\n    if(!this.totalLength && !isInDOM(this.circle)) {\r\n      return;\r\n    }\r\n\r\n    if(percents === 0) {\r\n      this.circle.style.strokeDasharray = '';\r\n      return;\r\n    }\r\n\r\n    try {\r\n      if(!this.totalLength) {\r\n        this.totalLength = this.circle.getTotalLength();\r\n      }\r\n\r\n      // console.log('setProgress', (percents / 100 * totalLength));\r\n      this.circle.style.strokeDasharray = '' + Math.max(5, percents / 100 * this.totalLength) + ', ' + this.totalLength;\r\n    } catch(err) {}\r\n  }\r\n}\r\n","/*\r\nThis file is part of Telegram Desktop,\r\nthe official desktop application for the Telegram messaging service.\r\nFor license and copyright information please follow this link:\r\nhttps://github.com/telegramdesktop/tdesktop/blob/master/LEGAL\r\n*/\r\n\r\nimport accumulate from '../helpers/array/accumulate';\r\nimport clamp from '../helpers/number/clamp';\r\n\r\ntype Size = {w: number, h: number};\r\nexport type GroupMediaLayout = {\r\n  geometry: {\r\n    x: number,\r\n    y: number,\r\n    width: number,\r\n    height: number\r\n  },\r\n  sides: number\r\n};\r\ntype Attempt = {\r\n  lineCounts: number[],\r\n  heights: number[]\r\n};\r\nexport const RectPart = {\r\n  None: 0,\r\n  Top: 1,\r\n  Right: 2,\r\n  Bottom: 4,\r\n  Left: 8\r\n};\r\n\r\n// https://github.com/telegramdesktop/tdesktop/blob/4669c07dc5335cbf4795bbbe5b0ab7c007b9aee2/Telegram/SourceFiles/ui/grouped_layout.cpp\r\nexport class Layouter {\r\n  private count: number;\r\n  private ratios: number[];\r\n  private proportions: string;\r\n  private averageRatio: number;\r\n  private maxSizeRatio: number;\r\n\r\n  constructor(private sizes: Size[], private maxWidth: number, private minWidth: number, private spacing: number, private maxHeight = maxWidth) {\r\n    this.count = sizes.length;\r\n    this.ratios = Layouter.countRatios(sizes);\r\n    this.proportions = Layouter.countProportions(this.ratios);\r\n    this.averageRatio = accumulate(this.ratios, 1) / this.count; // warn\r\n    this.maxSizeRatio = maxWidth / this.maxHeight;\r\n  }\r\n\r\n  public layout(): GroupMediaLayout[] {\r\n    if(!this.count) return [];\r\n    // else if(this.count === 1) return this.layoutOne();\r\n\r\n    if(this.count >= 5 || this.ratios.find((r) => r > 2)) {\r\n      return new ComplexLayouter(this.ratios, this.averageRatio, this.maxWidth, this.minWidth, this.spacing).layout();\r\n    }\r\n\r\n    if(this.count === 2) return this.layoutTwo();\r\n    else if(this.count === 3) return this.layoutThree();\r\n    return this.layoutFour();\r\n  }\r\n\r\n  private layoutTwo(): ReturnType<Layouter['layout']> {\r\n    if((this.proportions === 'ww') &&\r\n      (this.averageRatio > 1.4 * this.maxSizeRatio) &&\r\n      (this.ratios[1] - this.ratios[0] < 0.2)) {\r\n      return this.layoutTwoTopBottom();\r\n    } else if(this.proportions === 'ww' || this.proportions === 'qq') {\r\n      return this.layoutTwoLeftRightEqual();\r\n    }\r\n    return this.layoutTwoLeftRight();\r\n  }\r\n\r\n  private layoutThree(): ReturnType<Layouter['layout']> {\r\n    // console.log('layoutThree:', this);\r\n    if(this.proportions[0] === 'n') {\r\n      return this.layoutThreeLeftAndOther();\r\n    }\r\n    return this.layoutThreeTopAndOther();\r\n  }\r\n\r\n  private layoutFour(): ReturnType<Layouter['layout']> {\r\n    if(this.proportions[0] === 'w') {\r\n      return this.layoutFourTopAndOther();\r\n    }\r\n    return this.layoutFourLeftAndOther();\r\n  }\r\n\r\n  private layoutTwoTopBottom(): ReturnType<Layouter['layout']> {\r\n    const width = this.maxWidth;\r\n    const height = Math.round(Math.min(\r\n      width / this.ratios[0],\r\n      Math.min(\r\n        width / this.ratios[1],\r\n        (this.maxHeight - this.spacing) / 2)));\r\n\r\n    return [\r\n      {\r\n        geometry: {x: 0, y: 0, width, height},\r\n        sides: RectPart.Left | RectPart.Top | RectPart.Right\r\n      },\r\n      {\r\n        geometry: {x: 0, y: height + this.spacing, width, height},\r\n        sides: RectPart.Left | RectPart.Bottom | RectPart.Right\r\n      }\r\n    ];\r\n  }\r\n\r\n  private layoutTwoLeftRightEqual(): ReturnType<Layouter['layout']> {\r\n    const width = (this.maxWidth - this.spacing) / 2;\r\n    const height = Math.round(Math.min(\r\n      width / this.ratios[0],\r\n      Math.min(width / this.ratios[1], this.maxHeight * 1)));\r\n\r\n    return [\r\n      {\r\n        geometry: {x: 0, y: 0, width, height},\r\n        sides: RectPart.Top | RectPart.Left | RectPart.Bottom\r\n      },\r\n      {\r\n        geometry: {x: width + this.spacing, y: 0, width, height},\r\n        sides: RectPart.Top | RectPart.Right | RectPart.Bottom\r\n      }\r\n    ];\r\n  }\r\n\r\n  private layoutTwoLeftRight(): ReturnType<Layouter['layout']> {\r\n    const minimalWidth = Math.round(this.minWidth * 1.5);\r\n    const secondWidth = Math.min(\r\n      Math.round(Math.max(\r\n        0.4 * (this.maxWidth - this.spacing),\r\n        (this.maxWidth - this.spacing) / this.ratios[0] /\r\n          (1 / this.ratios[0] + 1 / this.ratios[1]))),\r\n      this.maxWidth - this.spacing - minimalWidth);\r\n    const firstWidth = this.maxWidth -\r\n      secondWidth -\r\n      this.spacing;\r\n    const height = Math.min(\r\n      this.maxHeight,\r\n      Math.round(Math.min(\r\n        firstWidth / this.ratios[0],\r\n        secondWidth / this.ratios[1])));\r\n\r\n    return [\r\n      {\r\n        geometry: {x: 0, y: 0, width: firstWidth, height},\r\n        sides: RectPart.Top | RectPart.Left | RectPart.Bottom\r\n      },\r\n      {\r\n        geometry: {x: firstWidth + this.spacing, y: 0, width: secondWidth, height},\r\n        sides: RectPart.Top | RectPart.Right | RectPart.Bottom\r\n      }\r\n    ];\r\n  }\r\n\r\n  private layoutThreeLeftAndOther(): ReturnType<Layouter['layout']> {\r\n    const firstHeight = this.maxHeight;\r\n    const thirdHeight = Math.round(Math.min(\r\n      (this.maxHeight - this.spacing) / 2.,\r\n      (this.ratios[1] * (this.maxWidth - this.spacing) /\r\n        (this.ratios[2] + this.ratios[1]))));\r\n    const secondHeight = firstHeight -\r\n      thirdHeight -\r\n      this.spacing;\r\n    const rightWidth = Math.max(\r\n      this.minWidth,\r\n      Math.round(Math.min(\r\n        (this.maxWidth - this.spacing) / 2.,\r\n        Math.min(\r\n          thirdHeight * this.ratios[2],\r\n          secondHeight * this.ratios[1]))));\r\n    const leftWidth = Math.min(\r\n      Math.round(firstHeight * this.ratios[0]),\r\n      this.maxWidth - this.spacing - rightWidth);\r\n\r\n    return [\r\n      {\r\n        geometry: {x: 0, y: 0, width: leftWidth, height: firstHeight},\r\n        sides: RectPart.Top | RectPart.Left | RectPart.Bottom\r\n      },\r\n      {\r\n        geometry: {x: leftWidth + this.spacing, y: 0, width: rightWidth, height: secondHeight},\r\n        sides: RectPart.Top | RectPart.Right\r\n      },\r\n      {\r\n        geometry: {x: leftWidth + this.spacing, y: secondHeight + this.spacing, width: rightWidth, height: thirdHeight},\r\n        sides: RectPart.Bottom | RectPart.Right\r\n      }\r\n    ];\r\n  }\r\n\r\n  private layoutThreeTopAndOther(): ReturnType<Layouter['layout']> {\r\n    const firstWidth = this.maxWidth;\r\n    const firstHeight = Math.round(Math.min(\r\n      firstWidth / this.ratios[0],\r\n      (this.maxHeight - this.spacing) * 0.66));\r\n    const secondWidth = (this.maxWidth - this.spacing) / 2;\r\n    const secondHeight = Math.min(\r\n      this.maxHeight - firstHeight - this.spacing,\r\n      Math.round(Math.min(\r\n        secondWidth / this.ratios[1],\r\n        secondWidth / this.ratios[2])));\r\n    const thirdWidth = firstWidth - secondWidth - this.spacing;\r\n\r\n    return [\r\n      {\r\n        geometry: {x: 0, y: 0, width: firstWidth, height: firstHeight},\r\n        sides: RectPart.Left | RectPart.Top | RectPart.Right\r\n      },\r\n      {\r\n        geometry: {x: 0, y: firstHeight + this.spacing, width: secondWidth, height: secondHeight},\r\n        sides: RectPart.Bottom | RectPart.Left\r\n      },\r\n      {\r\n        geometry: {x: secondWidth + this.spacing, y: firstHeight + this.spacing, width: thirdWidth, height: secondHeight},\r\n        sides: RectPart.Bottom | RectPart.Right\r\n      }\r\n    ];\r\n  }\r\n\r\n  private layoutFourTopAndOther(): ReturnType<Layouter['layout']> {\r\n    const w = this.maxWidth;\r\n    const h0 = Math.round(Math.min(\r\n      w / this.ratios[0],\r\n      (this.maxHeight - this.spacing) * 0.66));\r\n    const h = Math.round(\r\n      (this.maxWidth - 2 * this.spacing) /\r\n        (this.ratios[1] + this.ratios[2] + this.ratios[3]));\r\n    const w0 = Math.max(\r\n      this.minWidth,\r\n      Math.round(Math.min(\r\n        (this.maxWidth - 2 * this.spacing) * 0.4,\r\n        h * this.ratios[1])));\r\n    const w2 = Math.round(Math.max(\r\n      Math.max(\r\n        this.minWidth * 1.,\r\n        (this.maxWidth - 2 * this.spacing) * 0.33),\r\n      h * this.ratios[3]));\r\n    const w1 = w - w0 - w2 - 2 * this.spacing;\r\n    const h1 = Math.min(\r\n      this.maxHeight - h0 - this.spacing,\r\n      h);\r\n\r\n    return [\r\n      {\r\n        geometry: {x: 0, y: 0, width: w, height: h0},\r\n        sides: RectPart.Left | RectPart.Top | RectPart.Right\r\n      },\r\n      {\r\n        geometry: {x: 0, y: h0 + this.spacing, width: w0, height: h1},\r\n        sides: RectPart.Bottom | RectPart.Left\r\n      },\r\n      {\r\n        geometry: {x: w0 + this.spacing, y: h0 + this.spacing, width: w1, height: h1},\r\n        sides: RectPart.Bottom\r\n      },\r\n      {\r\n        geometry: {x: w0 + this.spacing + w1 + this.spacing, y: h0 + this.spacing, width: w2, height: h1},\r\n        sides: RectPart.Right | RectPart.Bottom\r\n      }\r\n    ];\r\n  }\r\n\r\n  private layoutFourLeftAndOther(): ReturnType<Layouter['layout']> {\r\n    const h = this.maxHeight;\r\n    const w0 = Math.round(Math.min(\r\n      h * this.ratios[0],\r\n      (this.maxWidth - this.spacing) * 0.6));\r\n\r\n    const w = Math.round(\r\n      (this.maxHeight - 2 * this.spacing) /\r\n        (1. / this.ratios[1] + 1. / this.ratios[2] + 1. / this.ratios[3])\r\n    );\r\n    const h0 = Math.round(w / this.ratios[1]);\r\n    const h1 = Math.round(w / this.ratios[2]);\r\n    const h2 = h - h0 - h1 - 2 * this.spacing;\r\n    const w1 = Math.max(\r\n      this.minWidth,\r\n      Math.min(this.maxWidth - w0 - this.spacing, w));\r\n\r\n    return [\r\n      {\r\n        geometry: {x: 0, y: 0, width: w0, height: h},\r\n        sides: RectPart.Top | RectPart.Left | RectPart.Bottom\r\n      },\r\n      {\r\n        geometry: {x: w0 + this.spacing, y: 0, width: w1, height: h0},\r\n        sides: RectPart.Top | RectPart.Right\r\n      },\r\n      {\r\n        geometry: {x: w0 + this.spacing, y: h0 + this.spacing, width: w1, height: h1},\r\n        sides: RectPart.Right\r\n      },\r\n      {\r\n        geometry: {x: w0 + this.spacing, y: h0 + h1 + 2 * this.spacing, width: w1, height: h2},\r\n        sides: RectPart.Bottom | RectPart.Right\r\n      }\r\n    ];\r\n  }\r\n\r\n  private static countRatios(sizes: Size[]) {\r\n    return sizes.map((size) => size.w / size.h);\r\n  }\r\n\r\n  private static countProportions(ratios: number[]) {\r\n    return ratios.map((ratio) => (ratio > 1.2) ? 'w' : (ratio < 0.8) ? 'n' : 'q').join('');\r\n  }\r\n}\r\n\r\nclass ComplexLayouter {\r\n  private ratios: number[];\r\n  private count: number;\r\n\r\n  constructor(ratios: number[], private averageRatio: number, private maxWidth: number, private minWidth: number, private spacing: number, private maxHeight = maxWidth * 4 / 3) {\r\n    this.ratios = ComplexLayouter.cropRatios(ratios, averageRatio);\r\n    this.count = ratios.length;\r\n  }\r\n\r\n  private static cropRatios(ratios: number[], averageRatio: number) {\r\n    const kMaxRatio = 2.75;\r\n    const kMinRatio = 0.6667;\r\n    return ratios.map((ratio) => {\r\n      return averageRatio > 1.1 ?\r\n        clamp(ratio, 1., kMaxRatio) :\r\n        clamp(ratio, kMinRatio, 1.);\r\n    });\r\n  }\r\n\r\n  public layout(): GroupMediaLayout[] {\r\n    const result = new Array<GroupMediaLayout>(this.count);\r\n\r\n    const attempts: Attempt[] = [];\r\n    const multiHeight = (offset: number, count: number) => {\r\n      const ratios = this.ratios.slice(offset, offset + count); // warn\r\n      const sum = accumulate(ratios, 0);\r\n      return (this.maxWidth - (count - 1) * this.spacing) / sum;\r\n    };\r\n    const pushAttempt = (lineCounts: number[]) => {\r\n      const heights: number[] = [];\r\n      let offset = 0;\r\n      for(const count of lineCounts) {\r\n        heights.push(multiHeight(offset, count));\r\n        offset += count;\r\n      }\r\n      attempts.push({lineCounts, heights}); // warn\r\n    };\r\n\r\n    for(let first = 1; first !== this.count; ++first) {\r\n      const second = this.count - first;\r\n      if(first > 3 || second > 3) {\r\n        continue;\r\n      }\r\n      pushAttempt([first, second]);\r\n    }\r\n    for(let first = 1; first !== this.count - 1; ++first) {\r\n      for(let second = 1; second !== this.count - first; ++second) {\r\n        const third = this.count - first - second;\r\n        if((first > 3) ||\r\n          (second > ((this.averageRatio < 0.85) ? 4 : 3)) ||\r\n          (third > 3)) {\r\n          continue;\r\n        }\r\n        pushAttempt([first, second, third]);\r\n      }\r\n    }\r\n    for(let first = 1; first !== this.count - 1; ++first) {\r\n      for(let second = 1; second !== this.count - first; ++second) {\r\n        for(let third = 1; third !== this.count - first - second; ++third) {\r\n          const fourth = this.count - first - second - third;\r\n          if(first > 3 || second > 3 || third > 3 || fourth > 3) {\r\n            continue;\r\n          }\r\n          pushAttempt([first, second, third, fourth]);\r\n        }\r\n      }\r\n    }\r\n\r\n    let optimalAttempt: Attempt = null;\r\n    let optimalDiff = 0;\r\n    for(const attempt of attempts) {\r\n      const {heights, lineCounts: counts} = attempt;\r\n      const lineCount = counts.length;\r\n      const totalHeight = accumulate(heights, 0) +\r\n        this.spacing * (lineCount - 1);\r\n      const minLineHeight = Math.min(...heights);\r\n      const maxLineHeight = Math.max(...heights);\r\n      const bad1 = (minLineHeight < this.minWidth) ? 1.5 : 1;\r\n      const bad2 = (() => {\r\n        for(let line = 1; line !== lineCount; ++line) {\r\n          if(counts[line - 1] > counts[line]) {\r\n            return 1.5;\r\n          }\r\n        }\r\n        return 1.;\r\n      })();\r\n      const diff = Math.abs(totalHeight - this.maxHeight) * bad1 * bad2;\r\n      if(!optimalAttempt || diff < optimalDiff) {\r\n        optimalAttempt = attempt;\r\n        optimalDiff = diff;\r\n      }\r\n    }\r\n\r\n    const optimalCounts = optimalAttempt.lineCounts;\r\n    const optimalHeights = optimalAttempt.heights;\r\n    const rowCount = optimalCounts.length;\r\n\r\n    let index = 0;\r\n    let y = 0;\r\n    for(let row = 0; row !== rowCount; ++row) {\r\n      const colCount = optimalCounts[row];\r\n      const lineHeight = optimalHeights[row];\r\n      const height = Math.round(lineHeight);\r\n\r\n      let x = 0;\r\n      for(let col = 0; col !== colCount; ++col) {\r\n        const sides = RectPart.None |\r\n          (row === 0 ? RectPart.Top : RectPart.None) |\r\n          (row === rowCount - 1 ? RectPart.Bottom : RectPart.None) |\r\n          (col === 0 ? RectPart.Left : RectPart.None) |\r\n          (col === colCount - 1 ? RectPart.Right : RectPart.None);\r\n\r\n        const ratio = this.ratios[index];\r\n        const width = (col === colCount - 1) ?\r\n          (this.maxWidth - x) :\r\n          Math.round(ratio * lineHeight);\r\n        result[index] = {\r\n          geometry: {x, y, width, height},\r\n          sides\r\n        };\r\n\r\n        x += width + this.spacing;\r\n        ++index;\r\n      }\r\n      y += height + this.spacing;\r\n    }\r\n\r\n    return result;\r\n  }\r\n}\r\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport {Layouter, RectPart} from './groupedLayout';\n\nexport default function prepareAlbum(options: {\n  container: HTMLElement,\n  items: {w: number, h: number}[],\n  maxWidth: number,\n  minWidth: number,\n  spacing: number,\n  maxHeight?: number,\n  forMedia?: true\n}) {\n  const layouter = new Layouter(options.items, options.maxWidth, options.minWidth, options.spacing, options.maxHeight);\n  const layout = layouter.layout();\n\n  const widthItem = layout.find((item) => item.sides & RectPart.Right);\n  const width = widthItem.geometry.width + widthItem.geometry.x;\n\n  const heightItem = layout.find((item) => item.sides & RectPart.Bottom);\n  const height = heightItem.geometry.height + heightItem.geometry.y;\n\n  const container = options.container;\n  container.style.width = width + 'px';\n  container.style.height = height + 'px';\n  const children = container.children;\n\n  layout.forEach(({geometry, sides}, idx) => {\n    let div: HTMLElement;\n    div = children[idx] as HTMLElement;\n    if(!div) {\n      div = document.createElement('div');\n      container.append(div);\n    }\n\n    div.classList.add('album-item', 'grouped-item');\n\n    div.style.width = (geometry.width / width * 100) + '%';\n    div.style.height = (geometry.height / height * 100) + '%';\n    div.style.top = (geometry.y / height * 100) + '%';\n    div.style.left = (geometry.x / width * 100) + '%';\n\n    if(sides & RectPart.Left && sides & RectPart.Top) {\n      div.style.borderTopLeftRadius = 'inherit';\n    }\n\n    if(sides & RectPart.Left && sides & RectPart.Bottom) {\n      div.style.borderBottomLeftRadius = 'inherit';\n    }\n\n    if(sides & RectPart.Right && sides & RectPart.Top) {\n      div.style.borderTopRightRadius = 'inherit';\n    }\n\n    if(sides & RectPart.Right && sides & RectPart.Bottom) {\n      div.style.borderBottomRightRadius = 'inherit';\n    }\n\n    if(options.forMedia) {\n      const mediaDiv = document.createElement('div');\n      mediaDiv.classList.add('album-item-media');\n\n      div.append(mediaDiv);\n    }\n\n    // @ts-ignore\n    // div.style.backgroundColor = '#' + Math.floor(Math.random() * (2 ** 24 - 1)).toString(16).padStart(6, '0');\n  });\n\n  /* if(options.forMedia) {\n    layout.forEach((_, i) => {\n      const mediaDiv = document.createElement('div');\n      mediaDiv.classList.add('album-item-media');\n\n      options.container.children[i].append(mediaDiv);\n    });\n  } */\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport getPreviewURLFromBytes from '../helpers/bytes/getPreviewURLFromBytes';\nimport {renderImageFromUrlPromise} from '../helpers/dom/renderImageFromUrl';\nimport replaceContent from '../helpers/dom/replaceContent';\nimport setInnerHTML from '../helpers/dom/setInnerHTML';\nimport {recordPromise} from '../helpers/recordPromise';\nimport sequentialDom from '../helpers/sequentialDom';\nimport {UserProfilePhoto, ChatPhoto} from '../layer';\nimport type {PeerPhotoSize} from '../lib/appManagers/appAvatarsManager';\nimport getPeerColorById from '../lib/appManagers/utils/peers/getPeerColorById';\nimport {NULL_PEER_ID, REPLIES_PEER_ID} from '../lib/mtproto/mtproto_config';\nimport getAbbreviation from '../lib/richTextProcessor/getAbbreviation';\nimport rootScope from '../lib/rootScope';\nimport getPeerInitials from './wrappers/getPeerInitials';\n\nexport async function putAvatar(\n  div: HTMLElement,\n  peerId: PeerId,\n  photo: UserProfilePhoto.userProfilePhoto | ChatPhoto.chatPhoto,\n  size: PeerPhotoSize,\n  img = new Image(),\n  onlyThumb = false\n) {\n  const r = await rootScope.managers.acknowledged.appAvatarsManager.loadAvatar(peerId, photo, size);\n  const loadPromise = r.result;\n  const cached = r.cached;\n\n  img.classList.add('avatar-photo');\n\n  let renderThumbPromise: Promise<void>;\n  let callback: () => void;\n  let thumbImage: HTMLImageElement;\n  if(cached) {\n    //   misc.ts: renderImageFromUrl\n    callback = () => {\n      replaceContent(div, img);\n      div.dataset.color = '';\n    };\n  } else {\n    const animate = rootScope.settings.animationsEnabled;\n    if(animate) {\n      img.classList.add('fade-in');\n    }\n\n    let isFullLoaded = false;\n    if(size === 'photo_big') { // let's load small photo first\n      const res = await putAvatar(div, peerId, photo, 'photo_small');\n      renderThumbPromise = res.loadPromise;\n      thumbImage = res.thumbImage;\n    } else if(photo.stripped_thumb) {\n      thumbImage = new Image();\n      div.classList.add('avatar-relative');\n      thumbImage.classList.add('avatar-photo', 'avatar-photo-thumbnail');\n      const url = getPreviewURLFromBytes(photo.stripped_thumb);\n      renderThumbPromise = renderImageFromUrlPromise(thumbImage, url).then(() => {\n        if(isFullLoaded) {\n          return;\n        }\n\n        replaceContent(div, thumbImage);\n      });\n    }\n\n    callback = () => {\n      isFullLoaded = true;\n\n      if(thumbImage) {\n        div.append(img);\n      } else {\n        replaceContent(div, img);\n      }\n\n      setTimeout(() => {\n        if(div.childElementCount) {\n          sequentialDom.mutateElement(img, () => {\n            div.dataset.color = '';\n\n            if(animate) {\n              img.classList.remove('fade-in');\n            }\n\n            if(thumbImage) {\n              thumbImage.remove();\n            }\n          });\n        }\n      }, animate ? 200 : 0);\n    };\n  }\n\n  const renderPromise = loadPromise\n  .then((url) => renderImageFromUrlPromise(img, url/* , !cached */))\n  .then(callback);\n\n  await (renderThumbPromise || renderPromise);\n\n  return {\n    cached,\n    loadPromise: renderThumbPromise || renderPromise,\n    thumbImage\n  };\n}\n\nfunction set(\n  div: HTMLElement,\n  innerHTML: Parameters<typeof setInnerHTML>[1],\n  color: string,\n  icon: string\n) {\n  setInnerHTML(div, innerHTML);\n  div.dataset.color = color;\n  div.classList.remove('tgico-saved', 'tgico-deletedaccount', 'tgico-reply_filled');\n  icon && div.classList.add(icon);\n}\n\n// peerId === peerId || title\nexport default async function putPhoto(\n  div: HTMLElement,\n  peerId: PeerId,\n  isDialog = false,\n  title = '',\n  onlyThumb = false,\n  isBig?: boolean\n) {\n  const myId = rootScope.myId;\n\n  if(peerId === myId && isDialog) {\n    set(div, '', '', 'tgico-saved');\n    return;\n  }\n\n  const managers = rootScope.managers;\n\n  if(peerId !== NULL_PEER_ID && peerId.isUser()) {\n    const user = await managers.appUsersManager.getUser(peerId);\n    if(user && user.pFlags && user.pFlags.deleted) {\n      set(div, '', getPeerColorById(peerId), 'tgico-deletedaccount');\n      return;\n    }\n  }\n\n  const size: PeerPhotoSize = isBig ? 'photo_big' : 'photo_small';\n  const photo = await managers.appPeersManager.getPeerPhoto(peerId);\n  const avatarAvailable = !!photo;\n  const avatarRendered = !!div.firstElementChild && !(div.firstElementChild as HTMLElement).classList.contains('emoji');\n  if(!avatarAvailable || !avatarRendered || !(await managers.appAvatarsManager.isAvatarCached(peerId, size))) {\n    let color = '';\n    if(peerId && (peerId !== myId || !isDialog)) {\n      color = getPeerColorById(peerId);\n    }\n\n    if(peerId === REPLIES_PEER_ID) {\n      set(div, '', color, 'tgico-reply_filled');\n      return;\n    }\n\n    const abbr = await (title ? getAbbreviation(title) : getPeerInitials(peerId, managers));\n    set(div, abbr, color, '');\n    // return Promise.resolve(true);\n  }\n\n  if(avatarAvailable/*  && false */) {\n    const promise = putAvatar(div, peerId, photo, size, undefined, onlyThumb);\n    // recordPromise(promise, 'putAvatar-' + peerId);\n    return promise;\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport {Chat, User} from '../../layer';\nimport getAbbreviation from '../../lib/richTextProcessor/getAbbreviation';\nimport rootScope from '../../lib/rootScope';\n\nexport default async function getPeerInitials(peerId: PeerId, managers = rootScope.managers) {\n  const peer: Chat | User = await managers.appPeersManager.getPeer(peerId);\n  return getAbbreviation(\n    (peer as Chat.chat).title ?? [(peer as User.user).first_name, (peer as User.user).last_name].filter(Boolean).join(' ')\n  );\n}\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport {MOUNT_CLASS_TO} from '../config/debug';\r\n\r\nexport function putPreloader(elem: Element, returnDiv = false): HTMLElement {\r\n  const html = `\r\n  <svg xmlns=\"http://www.w3.org/2000/svg\" class=\"preloader-circular\" viewBox=\"25 25 50 50\">\r\n  <circle class=\"preloader-path\" cx=\"50\" cy=\"50\" r=\"20\" fill=\"none\" stroke-miterlimit=\"10\"/>\r\n  </svg>`;\r\n\r\n  if(returnDiv) {\r\n    const div = document.createElement('div');\r\n    div.classList.add('preloader');\r\n    div.innerHTML = html;\r\n\r\n    if(elem) {\r\n      elem.appendChild(div);\r\n    }\r\n\r\n    return div;\r\n  }\r\n\r\n  elem.insertAdjacentHTML('beforeend', html);\r\n  return elem.lastElementChild as HTMLElement;\r\n}\r\n\r\nMOUNT_CLASS_TO.putPreloader = putPreloader;\r\n\r\nexport function setButtonLoader(elem: HTMLButtonElement, icon = 'check') {\r\n  elem.classList.remove('tgico-' + icon);\r\n  elem.disabled = true;\r\n  putPreloader(elem);\r\n\r\n  return () => {\r\n    elem.innerHTML = '';\r\n    elem.classList.add('tgico-' + icon);\r\n    elem.removeAttribute('disabled');\r\n  };\r\n}\r\n\r\n/* export function parseMenuButtonsTo(to: {[name: string]: HTMLElement}, elements: HTMLCollection | NodeListOf<HTMLElement>) {\r\n  Array.from(elements).forEach((el) => {\r\n    const match = el.className.match(/(?:^|\\s)menu-(.+?)(?:$|\\s)/);\r\n    if(!match) return;\r\n    to[match[1]] = el as HTMLElement;\r\n  });\r\n} */\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport getDeepProperty from '../helpers/object/getDeepProperty';\r\nimport {LangPackKey, _i18n} from '../lib/langPack';\r\nimport apiManagerProxy from '../lib/mtproto/mtprotoworker';\r\nimport rootScope from '../lib/rootScope';\r\n\r\nexport default class RadioField {\r\n  public input: HTMLInputElement;\r\n  public label: HTMLLabelElement;\r\n  public main: HTMLElement;\r\n\r\n  constructor(options: {\r\n    text?: string,\r\n    langKey?: LangPackKey,\r\n    name: string,\r\n    value?: string,\r\n    stateKey?: string,\r\n    alignRight?: boolean\r\n  }) {\r\n    const label = this.label = document.createElement('label');\r\n    label.classList.add('radio-field');\r\n\r\n    if(options.alignRight) {\r\n      label.classList.add('radio-field-right');\r\n    }\r\n\r\n    const input = this.input = document.createElement('input');\r\n    input.type = 'radio';\r\n    /* input.id =  */input.name = 'input-radio-' + options.name;\r\n\r\n    if(options.value) {\r\n      input.value = options.value;\r\n\r\n      if(options.stateKey) {\r\n        apiManagerProxy.getState().then((state) => {\r\n          input.checked = getDeepProperty(state, options.stateKey) === options.value;\r\n        });\r\n\r\n        input.addEventListener('change', () => {\r\n          rootScope.managers.appStateManager.setByKey(options.stateKey, options.value);\r\n        });\r\n      }\r\n    }\r\n\r\n    const main = this.main = document.createElement('div');\r\n    main.classList.add('radio-field-main');\r\n\r\n    if(options.text) {\r\n      main.innerHTML = options.text;\r\n      /* const caption = document.createElement('div');\r\n      caption.classList.add('radio-field-main-caption');\r\n      caption.innerHTML = text;\r\n\r\n      if(subtitle) {\r\n        label.classList.add('radio-field-with-subtitle');\r\n        caption.insertAdjacentHTML('beforeend', `<div class=\"radio-field-main-subtitle\">${subtitle}</div>`);\r\n      }\r\n\r\n      main.append(caption); */\r\n    } else if(options.langKey) {\r\n      _i18n(main, options.langKey);\r\n    }\r\n\r\n    label.append(input, main);\r\n  }\r\n\r\n  get checked() {\r\n    return this.input.checked;\r\n  }\r\n\r\n  set checked(checked: boolean) {\r\n    this.setValueSilently(checked);\r\n\r\n    const event = new Event('change', {bubbles: true, cancelable: true});\r\n    this.input.dispatchEvent(event);\r\n  }\r\n\r\n  public setValueSilently(checked: boolean) {\r\n    this.input.checked = checked;\r\n  }\r\n};\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nexport default function RadioForm(radios: {container: HTMLElement, input: HTMLInputElement}[], onChange: (value: string, event: Event) => void) {\r\n  const form = document.createElement('form');\r\n\r\n  radios.forEach((r) => {\r\n    const {container, input} = r;\r\n    form.append(container);\r\n    input.addEventListener('change', (e) => {\r\n      if(input.checked) {\r\n        onChange(input.value, e);\r\n      }\r\n    });\r\n  });\r\n\r\n  return form;\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport attachGrabListeners, {GrabEvent} from '../helpers/dom/attachGrabListeners';\r\nimport clamp from '../helpers/number/clamp';\r\nimport safeAssign from '../helpers/object/safeAssign';\r\n\r\nexport default class RangeSelector {\r\n  public container: HTMLDivElement;\r\n  protected filled: HTMLDivElement;\r\n  protected seek: HTMLInputElement;\r\n\r\n  public mousedown = false;\r\n  protected rect: DOMRect;\r\n  protected _removeListeners: () => void;\r\n\r\n  private events: Partial<{\r\n    // onMouseMove: ProgressLine['onMouseMove'],\r\n    onMouseDown: RangeSelector['onMouseDown'],\r\n    onMouseUp: RangeSelector['onMouseUp'],\r\n    onScrub: (value: number) => void\r\n  }> = {};\r\n\r\n  protected decimals: number;\r\n\r\n  protected step: number;\r\n  protected min: number;\r\n  protected max: number;\r\n  protected withTransition = false;\r\n  protected useTransform = false;\r\n  protected vertical = false;\r\n\r\n  constructor(\r\n    options: {\r\n      step: RangeSelector['step'],\r\n      min: RangeSelector['min'],\r\n      max: RangeSelector['max'],\r\n      withTransition?: RangeSelector['withTransition'],\r\n      useTransform?: RangeSelector['useTransform'],\r\n      vertical?: RangeSelector['vertical']\r\n    },\r\n    value = 0\r\n  ) {\r\n    safeAssign(this, options);\r\n\r\n    this.container = document.createElement('div');\r\n    this.container.classList.add('progress-line');\r\n\r\n    // there is no sense in using transition with transform, because it is updating every frame\r\n    if(this.useTransform) {\r\n      this.container.classList.add('use-transform');\r\n    } else if(this.withTransition) {\r\n      this.container.classList.add('with-transition');\r\n    }\r\n\r\n    this.filled = document.createElement('div');\r\n    this.filled.classList.add('progress-line__filled');\r\n\r\n    const seek = this.seek = document.createElement('input');\r\n    seek.classList.add('progress-line__seek');\r\n    // seek.setAttribute('max', '0');\r\n    seek.type = 'range';\r\n    seek.step = '' + this.step;\r\n    seek.min = '' + this.min;\r\n    seek.max = '' + this.max;\r\n    seek.value = '' + value;\r\n\r\n    if(value) {\r\n      this.setProgress(value);\r\n    }\r\n\r\n    const stepStr = '' + this.step;\r\n    const index = stepStr.indexOf('.');\r\n    this.decimals = index === -1 ? 0 : stepStr.length - index - 1;\r\n\r\n    // this.setListeners();\r\n\r\n    this.container.append(this.filled, seek);\r\n  }\r\n\r\n  get value() {\r\n    return +this.seek.value;\r\n  }\r\n\r\n  public setHandlers(events: RangeSelector['events']) {\r\n    this.events = events;\r\n  }\r\n\r\n  protected onMouseMove = (event: GrabEvent) => {\r\n    this.scrub(event);\r\n  };\r\n\r\n  protected onMouseDown = (event: GrabEvent) => {\r\n    this.rect = this.container.getBoundingClientRect();\r\n    this.mousedown = true;\r\n    this.scrub(event);\r\n    this.container.classList.add('is-focused');\r\n    this.events?.onMouseDown && this.events.onMouseDown(event);\r\n  };\r\n\r\n  protected onMouseUp = (event: GrabEvent) => {\r\n    this.mousedown = false;\r\n    this.container.classList.remove('is-focused');\r\n    this.events?.onMouseUp && this.events.onMouseUp(event);\r\n  };\r\n\r\n  public setListeners() {\r\n    this.seek.addEventListener('input', this.onInput);\r\n    this._removeListeners = attachGrabListeners(this.container, this.onMouseDown, this.onMouseMove, this.onMouseUp);\r\n  }\r\n\r\n  public onInput = () => {\r\n    const value = +this.seek.value;\r\n    this.setFilled(value);\r\n    this.events?.onScrub && this.events.onScrub(value);\r\n  };\r\n\r\n  public setProgress(value: number) {\r\n    this.seek.value = '' + value;\r\n    this.setFilled(+this.seek.value); // clamp\r\n  }\r\n\r\n  public addProgress(value: number) {\r\n    this.seek.value = '' + (+this.seek.value + value);\r\n    this.setFilled(+this.seek.value); // clamp\r\n  }\r\n\r\n  public setFilled(value: number) {\r\n    let percents = (value - this.min) / (this.max - this.min);\r\n    percents = clamp(percents, 0, 1);\r\n\r\n    // using scaleX and width even with vertical because it will be rotated\r\n    if(this.useTransform) {\r\n      this.filled.style.transform = `scaleX(${percents})`;\r\n    } else {\r\n      this.filled.style.width = (percents * 100) + '%';\r\n    }\r\n  }\r\n\r\n  protected scrub(event: GrabEvent) {\r\n    const rectMax = this.vertical ? this.rect.height : this.rect.width;\r\n    const offsetAxisValue = clamp(this.vertical ? -(event.y - this.rect.bottom) : event.x - this.rect.left, 0, rectMax);\r\n\r\n    let value = this.min + (offsetAxisValue / rectMax * (this.max - this.min));\r\n\r\n    if((value - this.min) < ((this.max - this.min) / 2)) {\r\n      value -= this.step / 10;\r\n    }\r\n\r\n    value = +value.toFixed(this.decimals);\r\n    value = clamp(value, this.min, this.max);\r\n\r\n    // this.seek.value = '' + value;\r\n    // this.onInput();\r\n\r\n    this.setProgress(value);\r\n    this.events?.onScrub && this.events.onScrub(value);\r\n\r\n    return value;\r\n  }\r\n\r\n  public removeListeners() {\r\n    if(this._removeListeners) {\r\n      this._removeListeners();\r\n      this._removeListeners = null;\r\n    }\r\n\r\n    this.seek.removeEventListener('input', this.onInput);\r\n\r\n    this.events = {};\r\n  }\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport findUpClassName from '../helpers/dom/findUpClassName';\r\nimport sequentialDom from '../helpers/sequentialDom';\r\nimport IS_TOUCH_SUPPORTED from '../environment/touchSupport';\r\nimport rootScope from '../lib/rootScope';\r\nimport findUpAsChild from '../helpers/dom/findUpAsChild';\r\n\r\nlet rippleClickId = 0;\r\nexport default function ripple(\r\n  elem: HTMLElement,\r\n  callback: (id: number) => Promise<boolean | void> = () => Promise.resolve(),\r\n  onEnd: (id: number) => void = null,\r\n  prepend = false,\r\n  attachListenerTo = elem\r\n) {\r\n  // return;\r\n  if(elem.querySelector('.c-ripple')) return;\r\n  elem.classList.add('rp');\r\n\r\n  const r = document.createElement('div');\r\n  r.classList.add('c-ripple');\r\n\r\n  const isSquare = elem.classList.contains('rp-square');\r\n  if(isSquare) {\r\n    r.classList.add('is-square');\r\n  }\r\n\r\n  elem[prepend ? 'prepend' : 'append'](r);\r\n\r\n  let handler: () => void;\r\n  // let animationEndPromise: Promise<number>;\r\n  const drawRipple = (clientX: number, clientY: number) => {\r\n    const startTime = Date.now();\r\n    const elem = document.createElement('div');\r\n\r\n    const clickId = rippleClickId++;\r\n\r\n    // console.log('ripple drawRipple');\r\n\r\n    const duration = +window.getComputedStyle(r).getPropertyValue('--ripple-duration').replace('s', '') * 1000;\r\n    // console.log('ripple duration', duration);\r\n\r\n    handler = () => {\r\n    // handler = () => animationEndPromise.then((duration) => {\r\n      // console.log('ripple animation was:', duration);\r\n\r\n      // const duration = isSquare || mediaSizes.isMobile ? 200 : 700;\r\n      // return;\r\n      const elapsedTime = Date.now() - startTime;\r\n      const cb = () => {\r\n        // console.log('ripple elapsedTime total pre-remove:', Date.now() - startTime);\r\n        sequentialDom.mutate(() => {\r\n          elem.remove();\r\n        });\r\n\r\n        if(onEnd) onEnd(clickId);\r\n      };\r\n      if(elapsedTime < duration) {\r\n        const delay = Math.max(duration - elapsedTime, duration / 2);\r\n        setTimeout(() => elem.classList.add('hiding'), Math.max(delay - duration / 2, 0));\r\n\r\n        setTimeout(cb, delay);\r\n      } else {\r\n        elem.classList.add('hiding');\r\n        setTimeout(cb, duration / 2);\r\n      }\r\n\r\n      if(!IS_TOUCH_SUPPORTED) {\r\n        window.removeEventListener('contextmenu', handler);\r\n      }\r\n\r\n      handler = null;\r\n      touchStartFired = false;\r\n    };\r\n    // });\r\n\r\n    callback && callback(clickId);\r\n\r\n    /* callback().then((bad) => {\r\n      if(bad) {\r\n        span.remove();\r\n        return;\r\n      } */\r\n\r\n    // console.log('ripple after promise', Date.now() - startTime);\r\n    // console.log('ripple tooSlow:', tooSlow);\r\n    /* if(tooSlow) {\r\n        span.remove();\r\n        return;\r\n      } */\r\n\r\n    window.requestAnimationFrame(() => {\r\n      const rect = r.getBoundingClientRect();\r\n      elem.classList.add('c-ripple__circle');\r\n\r\n      const clickX = clientX - rect.left;\r\n      const clickY = clientY - rect.top;\r\n\r\n      const radius = Math.sqrt((Math.abs(clickY - rect.height / 2) + rect.height / 2) ** 2 + (Math.abs(clickX - rect.width / 2) + rect.width / 2) ** 2);\r\n      const size = radius;\r\n\r\n      // center of circle\r\n      const x = clickX - size / 2;\r\n      const y = clickY - size / 2;\r\n\r\n      // console.log('ripple click', offsetFromCenter, size, clickX, clickY);\r\n\r\n      elem.style.width = elem.style.height = size + 'px';\r\n      elem.style.left = x + 'px';\r\n      elem.style.top = y + 'px';\r\n\r\n      //     \r\n      /* animationEndPromise = new Promise((resolve) => {\r\n          span.addEventListener('animationend', () => {\r\n            // 713 -> 700\r\n            resolve(((Date.now() - startTime) / 100 | 0) * 100);\r\n          }, {once: true});\r\n        }); */\r\n\r\n      //             \r\n      /* span.style.display = 'none';\r\n        r.append(span);\r\n        duration = +window.getComputedStyle(span).getPropertyValue('animation-duration').replace('s', '') * 1000;\r\n        span.style.display = ''; */\r\n\r\n      r.append(elem);\r\n\r\n      // r.classList.add('active');\r\n      // handler();\r\n    });\r\n    // });\r\n  };\r\n\r\n  const isRippleUnneeded = (e: Event) => e.target !== elem && (\r\n    ['BUTTON', 'A'].includes((e.target as HTMLElement).tagName) ||\r\n      findUpClassName(e.target as HTMLElement, 'c-ripple') !== r\r\n  ) && (\r\n    attachListenerTo === elem ||\r\n      !findUpAsChild(e.target as HTMLElement, attachListenerTo)\r\n  );\r\n\r\n  // TODO: rename this variable\r\n  let touchStartFired = false;\r\n  if(IS_TOUCH_SUPPORTED) {\r\n    const touchEnd = () => {\r\n      handler && handler();\r\n    };\r\n\r\n    attachListenerTo.addEventListener('touchstart', (e) => {\r\n      if(!rootScope.settings.animationsEnabled) {\r\n        return;\r\n      }\r\n\r\n      // console.log('ripple touchstart', e);\r\n      if(e.touches.length > 1 || touchStartFired || isRippleUnneeded(e)) {\r\n        return;\r\n      }\r\n\r\n      // console.log('touchstart', e);\r\n      touchStartFired = true;\r\n\r\n      const {clientX, clientY} = e.touches[0];\r\n      drawRipple(clientX, clientY);\r\n      attachListenerTo.addEventListener('touchend', touchEnd, {once: true});\r\n\r\n      window.addEventListener('touchmove', (e) => {\r\n        e.cancelBubble = true;\r\n        e.stopPropagation();\r\n        touchEnd();\r\n        attachListenerTo.removeEventListener('touchend', touchEnd);\r\n      }, {once: true});\r\n    }, {passive: true});\r\n  } else {\r\n    attachListenerTo.addEventListener('mousedown', (e) => {\r\n      if(![0, 2].includes(e.button)) { // only left and right buttons\r\n        return;\r\n      }\r\n\r\n      if(!rootScope.settings.animationsEnabled) {\r\n        return;\r\n      }\r\n      // console.log('ripple mousedown', e, e.target, findUpClassName(e.target as HTMLElement, 'c-ripple') === r);\r\n\r\n      if(attachListenerTo.dataset.ripple === '0' || isRippleUnneeded(e)) {\r\n        return;\r\n      } else if(touchStartFired) {\r\n        touchStartFired = false;\r\n        return;\r\n      }\r\n\r\n      const {clientX, clientY} = e;\r\n      drawRipple(clientX, clientY);\r\n      window.addEventListener('mouseup', handler, {once: true, passive: true});\r\n      window.addEventListener('contextmenu', handler, {once: true, passive: true});\r\n    }, {passive: true});\r\n  }\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport CheckboxField from './checkboxField';\r\nimport RadioField from './radioField';\r\nimport ripple from './ripple';\r\nimport {SliderSuperTab} from './slider';\r\nimport RadioForm from './radioForm';\r\nimport {i18n, LangPackKey} from '../lib/langPack';\r\nimport replaceContent from '../helpers/dom/replaceContent';\r\nimport setInnerHTML from '../helpers/dom/setInnerHTML';\r\nimport {attachClickEvent} from '../helpers/dom/clickEvent';\r\nimport ListenerSetter from '../helpers/listenerSetter';\r\n\r\nexport default class Row {\r\n  public container: HTMLElement;\r\n  public title: HTMLDivElement;\r\n  public titleRight: HTMLElement;\r\n  public subtitle: HTMLElement;\r\n  public media: HTMLElement;\r\n\r\n  public checkboxField: CheckboxField;\r\n  public radioField: RadioField;\r\n\r\n  public freezed = false;\r\n\r\n  constructor(options: Partial<{\r\n    icon: string,\r\n    subtitle: string | HTMLElement | DocumentFragment,\r\n    subtitleLangKey: LangPackKey,\r\n    subtitleLangArgs: any[],\r\n    radioField: Row['radioField'],\r\n    checkboxField: Row['checkboxField'],\r\n    noCheckboxSubtitle: boolean,\r\n    title: string | HTMLElement | DocumentFragment,\r\n    titleLangKey: LangPackKey,\r\n    titleRight: string | HTMLElement,\r\n    titleRightSecondary: string | HTMLElement,\r\n    clickable: boolean | ((e: Event) => void),\r\n    navigationTab: SliderSuperTab,\r\n    havePadding: boolean,\r\n    noRipple: boolean,\r\n    noWrap: boolean,\r\n    listenerSetter: ListenerSetter\r\n  }> = {}) {\r\n    this.container = document.createElement(options.radioField || options.checkboxField ? 'label' : 'div');\r\n    this.container.classList.add('row');\r\n\r\n    this.subtitle = document.createElement('div');\r\n    this.subtitle.classList.add('row-subtitle');\r\n    this.subtitle.setAttribute('dir', 'auto');\r\n    if(options.subtitle) {\r\n      if(typeof(options.subtitle) === 'string') {\r\n        setInnerHTML(this.subtitle, options.subtitle);\r\n      } else {\r\n        this.subtitle.append(options.subtitle);\r\n      }\r\n    } else if(options.subtitleLangKey) {\r\n      this.subtitle.append(i18n(options.subtitleLangKey, options.subtitleLangArgs));\r\n    }\r\n    this.container.append(this.subtitle);\r\n\r\n    let havePadding = !!options.havePadding;\r\n    if(options.radioField || options.checkboxField) {\r\n      if(options.radioField) {\r\n        this.radioField = options.radioField;\r\n        this.container.append(this.radioField.label);\r\n        havePadding = true;\r\n      }\r\n\r\n      if(options.checkboxField) {\r\n        this.checkboxField = options.checkboxField;\r\n\r\n        const isToggle = options.checkboxField.label.classList.contains('checkbox-field-toggle');\r\n        if(isToggle) {\r\n          this.container.classList.add('row-with-toggle');\r\n          options.titleRight = this.checkboxField.label;\r\n        } else {\r\n          havePadding = true;\r\n          this.container.append(this.checkboxField.label);\r\n        }\r\n\r\n        if(!options.noCheckboxSubtitle && !isToggle) {\r\n          const onChange = () => {\r\n            replaceContent(this.subtitle, i18n(this.checkboxField.input.checked ? 'Checkbox.Enabled' : 'Checkbox.Disabled'));\r\n          };\r\n\r\n          if(options.listenerSetter) options.listenerSetter.add(this.checkboxField.input)('change', onChange);\r\n          else this.checkboxField.input.addEventListener('change', onChange);\r\n        }\r\n      }\r\n\r\n      const i = options.radioField || options.checkboxField;\r\n      i.label.classList.add('disable-hover');\r\n    }\r\n\r\n    if(options.title || options.titleLangKey) {\r\n      let c: HTMLElement;\r\n      const titleRight = options.titleRight || options.titleRightSecondary;\r\n      if(titleRight) {\r\n        c = document.createElement('div');\r\n        c.classList.add('row-title-row');\r\n        this.container.append(c);\r\n      } else {\r\n        c = this.container;\r\n      }\r\n\r\n      this.title = document.createElement('div');\r\n      this.title.classList.add('row-title');\r\n      this.title.setAttribute('dir', 'auto');\r\n      if(options.noWrap) this.title.classList.add('no-wrap');\r\n      if(options.title) {\r\n        if(typeof(options.title) === 'string') {\r\n          this.title.innerHTML = options.title;\r\n        } else {\r\n          this.title.append(options.title);\r\n        }\r\n      } else {\r\n        this.title.append(i18n(options.titleLangKey));\r\n      }\r\n      c.append(this.title);\r\n\r\n      if(titleRight) {\r\n        const titleRightEl = this.titleRight = document.createElement('div');\r\n        titleRightEl.classList.add('row-title', 'row-title-right');\r\n\r\n        if(options.titleRightSecondary) {\r\n          titleRightEl.classList.add('row-title-right-secondary');\r\n        }\r\n\r\n        if(typeof(titleRight) === 'string') {\r\n          titleRightEl.innerHTML = titleRight;\r\n        } else {\r\n          titleRightEl.append(titleRight);\r\n        }\r\n\r\n        c.append(titleRightEl);\r\n      }\r\n    }\r\n\r\n    if(options.icon) {\r\n      havePadding = true;\r\n      this.title.classList.add('tgico', 'tgico-' + options.icon);\r\n      this.container.classList.add('row-with-icon');\r\n    }\r\n\r\n    if(havePadding) {\r\n      this.container.classList.add('row-with-padding');\r\n    }\r\n\r\n    if(options.navigationTab) {\r\n      options.clickable = () => options.navigationTab.open();\r\n    }\r\n\r\n    if(options.clickable || options.radioField || options.checkboxField) {\r\n      if(typeof(options.clickable) === 'function') {\r\n        attachClickEvent(this.container, (e) => {\r\n          if(this.freezed) return;\r\n          (options.clickable as any)(e);\r\n        }, {listenerSetter: options.listenerSetter});\r\n      }\r\n\r\n      this.container.classList.add('row-clickable', 'hover-effect');\r\n\r\n      if(!options.noRipple) {\r\n        ripple(this.container, undefined, undefined, true);\r\n      }\r\n\r\n      /* if(options.radioField || options.checkboxField) {\r\n        this.container.prepend(this.container.lastElementChild);\r\n      } */\r\n    }\r\n  }\r\n\r\n  public createMedia(size?: 'small') {\r\n    this.container.classList.add('row-with-padding');\r\n\r\n    const media = this.media = document.createElement('div');\r\n    media.classList.add('row-media');\r\n\r\n    if(size) {\r\n      media.classList.add('row-media-' + size);\r\n    }\r\n\r\n    this.container.append(media);\r\n\r\n    return media;\r\n  }\r\n}\r\n\r\nexport const RadioFormFromRows = (rows: Row[], onChange: (value: string) => void) => {\r\n  return RadioForm(rows.map((r) => ({container: r.container, input: r.radioField.input})), onChange);\r\n};\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport IS_TOUCH_SUPPORTED from '../environment/touchSupport';\r\nimport {logger, LogTypes} from '../lib/logger';\r\nimport fastSmoothScroll, {ScrollOptions} from '../helpers/fastSmoothScroll';\r\nimport useHeavyAnimationCheck from '../hooks/useHeavyAnimationCheck';\r\nimport cancelEvent from '../helpers/dom/cancelEvent';\r\nimport {IS_ANDROID} from '../environment/userAgent';\r\n/*\r\nvar el = $0;\r\nvar height = 0;\r\nvar checkUp = false;\r\n\r\ndo {\r\n  height += el.scrollHeight;\r\n} while(el = (checkUp ? el.previousElementSibling : el.nextElementSibling));\r\nconsole.log(height);\r\n*/\r\n\r\n/*\r\nArray.from($0.querySelectorAll('.bubble-content')).forEach((_el) => {\r\n  //_el.style.display = '';\r\n  //return;\r\n\r\n  let el = _el.parentElement;\r\n  let height = el.scrollHeight;\r\n  let width = el.scrollWidth;\r\n  el.style.width = width + 'px';\r\n  el.style.height = height + 'px';\r\n  _el.style.display = 'none';\r\n});\r\n*/\r\n\r\n/* const scrollables: Map<HTMLElement, Scrollable> = new Map();\r\nconst scrollsIntersector = new IntersectionObserver((entries) => {\r\n  for(let entry of entries) {\r\n    const scrollable = scrollables.get(entry.target as HTMLElement);\r\n\r\n    if(entry.isIntersecting) {\r\n      scrollable.isVisible = true;\r\n    } else {\r\n      scrollable.isVisible = false;\r\n\r\n      if(!isInDOM(entry.target)) {\r\n        scrollsIntersector.unobserve(scrollable.container);\r\n        scrollables.delete(scrollable.container);\r\n      }\r\n    }\r\n  }\r\n}); */\r\n\r\nconst SCROLL_THROTTLE = IS_ANDROID ? 200 : 24;\r\n\r\nexport class ScrollableBase {\r\n  protected log: ReturnType<typeof logger>;\r\n\r\n  public splitUp: HTMLElement;\r\n  public onScrollMeasure: number = 0;\r\n\r\n  public lastScrollPosition: number = 0;\r\n  public lastScrollDirection: number = 0;\r\n\r\n  public onAdditionalScroll: () => void;\r\n  public onScrolledTop: () => void;\r\n  public onScrolledBottom: () => void;\r\n\r\n  public isHeavyAnimationInProgress = false;\r\n  protected needCheckAfterAnimation = false;\r\n\r\n  public checkForTriggers?: () => void;\r\n\r\n  public scrollProperty: 'scrollTop' | 'scrollLeft';\r\n\r\n  protected removeHeavyAnimationListener: () => void;\r\n  protected addedScrollListener: boolean;\r\n\r\n  constructor(public el: HTMLElement, logPrefix = '', public container: HTMLElement = document.createElement('div')) {\r\n    this.container.classList.add('scrollable');\r\n\r\n    this.log = logger('SCROLL' + (logPrefix ? '-' + logPrefix : ''), LogTypes.Error);\r\n\r\n    if(el) {\r\n      Array.from(el.children).forEach((c) => this.container.append(c));\r\n\r\n      el.append(this.container);\r\n    }\r\n    // this.onScroll();\r\n  }\r\n\r\n  public addScrollListener() {\r\n    if(this.addedScrollListener) {\r\n      return;\r\n    }\r\n\r\n    this.addedScrollListener = true;\r\n    this.container.addEventListener('scroll', this.onScroll, {passive: true, capture: true});\r\n  }\r\n\r\n  public removeScrollListener() {\r\n    if(!this.addedScrollListener) {\r\n      return;\r\n    }\r\n\r\n    this.addedScrollListener = false;\r\n    this.container.removeEventListener('scroll', this.onScroll, {capture: true});\r\n  }\r\n\r\n  public setListeners() {\r\n    if(this.removeHeavyAnimationListener) {\r\n      return;\r\n    }\r\n\r\n    window.addEventListener('resize', this.onScroll, {passive: true});\r\n    this.addScrollListener();\r\n\r\n    this.removeHeavyAnimationListener = useHeavyAnimationCheck(() => {\r\n      this.isHeavyAnimationInProgress = true;\r\n\r\n      if(this.onScrollMeasure) {\r\n        this.cancelMeasure();\r\n        this.needCheckAfterAnimation = true;\r\n      }\r\n    }, () => {\r\n      this.isHeavyAnimationInProgress = false;\r\n\r\n      if(this.needCheckAfterAnimation) {\r\n        this.onScroll();\r\n        this.needCheckAfterAnimation = false;\r\n      }\r\n    });\r\n  }\r\n\r\n  public removeListeners() {\r\n    if(!this.removeHeavyAnimationListener) {\r\n      return;\r\n    }\r\n\r\n    window.removeEventListener('resize', this.onScroll);\r\n    this.removeScrollListener();\r\n\r\n    this.removeHeavyAnimationListener();\r\n    this.removeHeavyAnimationListener = undefined;\r\n  }\r\n\r\n  public destroy() {\r\n    this.removeListeners();\r\n    this.onAdditionalScroll = undefined;\r\n    this.onScrolledTop = undefined;\r\n    this.onScrolledBottom = undefined;\r\n  }\r\n\r\n  public append(element: HTMLElement) {\r\n    this.container.append(element);\r\n  }\r\n\r\n  public scrollIntoViewNew(options: Omit<ScrollOptions, 'container'>) {\r\n    // return Promise.resolve();\r\n    // this.removeListeners();\r\n    return fastSmoothScroll({\r\n      ...options,\r\n      container: this.container\r\n    });/* .finally(() => {\r\n      this.setListeners();\r\n    }); */\r\n  }\r\n\r\n  public onScroll = () => {\r\n    // if(this.debug) {\r\n    // this.log('onScroll call', this.onScrollMeasure);\r\n    // }\r\n\r\n    // return;\r\n\r\n    if(this.isHeavyAnimationInProgress) {\r\n      this.cancelMeasure();\r\n      this.needCheckAfterAnimation = true;\r\n      return;\r\n    }\r\n\r\n    // if(this.onScrollMeasure || ((this.scrollLocked || (!this.onScrolledTop && !this.onScrolledBottom)) && !this.splitUp && !this.onAdditionalScroll)) return;\r\n    if((!this.onScrolledTop && !this.onScrolledBottom) && !this.splitUp && !this.onAdditionalScroll) return;\r\n    if(this.onScrollMeasure) return;\r\n    // if(this.onScrollMeasure) window.cancelAnimationFrame(this.onScrollMeasure);\r\n    // this.onScrollMeasure = window.requestAnimationFrame(() => {\r\n    this.onScrollMeasure = window.setTimeout(() => {\r\n      this.onScrollMeasure = 0;\r\n\r\n      const scrollPosition = this.container[this.scrollProperty];\r\n      this.lastScrollDirection = this.lastScrollPosition === scrollPosition ? 0 : (this.lastScrollPosition < scrollPosition ? 1 : -1); // * 1 - bottom, -1 - top\r\n      this.lastScrollPosition = scrollPosition;\r\n\r\n      // lastScrollDirection check is useless here, every callback should decide on its own\r\n      if(this.onAdditionalScroll/*  && this.lastScrollDirection !== 0 */) {\r\n        this.onAdditionalScroll();\r\n      }\r\n\r\n      if(this.checkForTriggers) {\r\n        this.checkForTriggers();\r\n      }\r\n    // });\r\n    }, SCROLL_THROTTLE);\r\n  };\r\n\r\n  public cancelMeasure() {\r\n    if(this.onScrollMeasure) {\r\n      // window.cancelAnimationFrame(this.onScrollMeasure);\r\n      clearTimeout(this.onScrollMeasure);\r\n      this.onScrollMeasure = 0;\r\n    }\r\n  }\r\n}\r\n\r\nexport type SliceSides = 'top' | 'bottom';\r\nexport type SliceSidesContainer = {[k in SliceSides]: boolean};\r\n\r\nexport default class Scrollable extends ScrollableBase {\r\n  public padding: HTMLElement;\r\n\r\n  public loadedAll: SliceSidesContainer = {top: true, bottom: false};\r\n\r\n  constructor(el: HTMLElement, logPrefix = '', public onScrollOffset = 300, withPaddingContainer?: boolean) {\r\n    super(el, logPrefix);\r\n\r\n    /* if(withPaddingContainer) {\r\n      this.padding = document.createElement('div');\r\n      this.padding.classList.add('scrollable-padding');\r\n      Array.from(this.container.children).forEach((c) => this.padding.append(c));\r\n      this.container.append(this.padding);\r\n    } */\r\n\r\n    this.container.classList.add('scrollable-y');\r\n    this.setListeners();\r\n    this.scrollProperty = 'scrollTop';\r\n  }\r\n\r\n  public setVirtualContainer(el?: HTMLElement) {\r\n    this.splitUp = el;\r\n    this.log('setVirtualContainer:', el, this);\r\n  }\r\n\r\n  public checkForTriggers = () => {\r\n    if((!this.onScrolledTop && !this.onScrolledBottom)) return;\r\n\r\n    if(this.isHeavyAnimationInProgress) {\r\n      this.onScroll();\r\n      return;\r\n    }\r\n\r\n    const scrollHeight = this.container.scrollHeight;\r\n    if(!scrollHeight) { //         \r\n      return;\r\n    }\r\n\r\n    const clientHeight = this.container.clientHeight;\r\n    const maxScrollTop = scrollHeight - clientHeight;\r\n    const scrollTop = this.lastScrollPosition;\r\n\r\n    // this.log('checkForTriggers:', scrollTop, maxScrollTop);\r\n\r\n    if(this.onScrolledTop && scrollTop <= this.onScrollOffset && this.lastScrollDirection <= 0/* && direction === -1 */) {\r\n      this.onScrolledTop();\r\n    }\r\n\r\n    if(this.onScrolledBottom && (maxScrollTop - scrollTop) <= this.onScrollOffset && this.lastScrollDirection >= 0/* && direction === 1 */) {\r\n      this.onScrolledBottom();\r\n    }\r\n  };\r\n\r\n  public prepend(...elements: (HTMLElement | DocumentFragment)[]) {\r\n    (this.splitUp || this.padding || this.container).prepend(...elements);\r\n  }\r\n\r\n  public append(...elements: (HTMLElement | DocumentFragment)[]) {\r\n    (this.splitUp || this.padding || this.container).append(...elements);\r\n  }\r\n\r\n  public getDistanceToEnd() {\r\n    return this.scrollHeight - Math.round(this.scrollTop + this.container.offsetHeight);\r\n  }\r\n\r\n  get isScrolledDown() {\r\n    return this.getDistanceToEnd() <= 1;\r\n  }\r\n\r\n  set scrollTop(y: number) {\r\n    this.container.scrollTop = y;\r\n  }\r\n\r\n  get scrollTop() {\r\n    // this.log.trace('get scrollTop');\r\n    return this.container.scrollTop;\r\n  }\r\n\r\n  public setScrollTopSilently(value: number) {\r\n    this.lastScrollPosition = value;\r\n    this.ignoreNextScrollEvent();\r\n\r\n    this.scrollTop = value;\r\n  }\r\n\r\n  public ignoreNextScrollEvent() {\r\n    if(this.removeHeavyAnimationListener) {\r\n      this.removeScrollListener();\r\n      this.container.addEventListener('scroll', (e) => {\r\n        cancelEvent(e);\r\n        this.addScrollListener();\r\n      }, {capture: true, passive: false, once: true});\r\n    }\r\n  }\r\n\r\n  get scrollHeight() {\r\n    return this.container.scrollHeight;\r\n  }\r\n}\r\n\r\nexport class ScrollableX extends ScrollableBase {\r\n  constructor(el: HTMLElement, logPrefix = '', public onScrollOffset = 300, public splitCount = 15, public container: HTMLElement = document.createElement('div')) {\r\n    super(el, logPrefix, container);\r\n\r\n    this.container.classList.add('scrollable-x');\r\n\r\n    if(!IS_TOUCH_SUPPORTED) {\r\n      const scrollHorizontally = (e: any) => {\r\n        if(!e.deltaX && this.container.scrollWidth > this.container.clientWidth) {\r\n          this.container.scrollLeft += e.deltaY / 4;\r\n          cancelEvent(e);\r\n        }\r\n      };\r\n\r\n      this.container.addEventListener('wheel', scrollHorizontally, {passive: false});\r\n    }\r\n\r\n    this.scrollProperty = 'scrollLeft';\r\n  }\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport appSidebarLeft, {SettingSection} from '..';\r\nimport {InputFile} from '../../../layer';\r\nimport appDialogsManager from '../../../lib/appManagers/appDialogsManager';\r\nimport InputField from '../../inputField';\r\nimport {SliderSuperTab} from '../../slider';\r\nimport AvatarEdit from '../../avatarEdit';\r\nimport I18n from '../../../lib/langPack';\r\nimport ButtonCorner from '../../buttonCorner';\r\nimport getUserStatusString from '../../wrappers/getUserStatusString';\r\nimport appImManager from '../../../lib/appManagers/appImManager';\r\nimport {attachClickEvent} from '../../../helpers/dom/clickEvent';\r\n\r\ninterface OpenStreetMapInterface {\r\n  place_id?: number;\r\n  license?: string;\r\n  osm_type?: string;\r\n  osm_id?: number;\r\n  lat?: string;\r\n  lon?: string;\r\n  display_name: string;\r\n  address?: object;\r\n  boundingbox?: object;\r\n}\r\n\r\nexport default class AppNewGroupTab extends SliderSuperTab {\r\n  private avatarEdit: AvatarEdit;\r\n  private uploadAvatar: () => Promise<InputFile> = null;\r\n  private peerIds: PeerId[];\r\n  private isGeoChat: boolean = false;\r\n  private nextBtn: HTMLButtonElement;\r\n  private groupNameInputField: InputField;\r\n  private list: HTMLUListElement;\r\n  private groupLocationInputField: InputField;\r\n  private userLocationCoords: {lat: number, long: number};\r\n  private userLocationAddress: string;\r\n\r\n  protected init() {\r\n    this.container.classList.add('new-group-container');\r\n    this.setTitle('NewGroup');\r\n\r\n    this.avatarEdit = new AvatarEdit((_upload) => {\r\n      this.uploadAvatar = _upload;\r\n    });\r\n\r\n    const section = new SettingSection({});\r\n\r\n    const inputWrapper = document.createElement('div');\r\n    inputWrapper.classList.add('input-wrapper');\r\n\r\n    this.groupNameInputField = new InputField({\r\n      label: 'CreateGroup.NameHolder',\r\n      maxLength: 128\r\n    });\r\n\r\n    this.groupLocationInputField = new InputField({\r\n      label: 'ChatLocation',\r\n      name: 'location',\r\n      canBeEdited: false\r\n    });\r\n\r\n    inputWrapper.append(\r\n      this.groupNameInputField.container,\r\n      this.groupLocationInputField.container\r\n    );\r\n\r\n    this.listenerSetter.add(this.groupNameInputField.input)('input', () => {\r\n      const value = this.groupNameInputField.value;\r\n      let valueCheck = !!value.length && !this.groupNameInputField.input.classList.contains('error');\r\n      if(this.isGeoChat) valueCheck = valueCheck && !!this.userLocationCoords && !!this.userLocationAddress;\r\n      this.nextBtn.classList.toggle('is-visible', !!valueCheck);\r\n    });\r\n\r\n    this.nextBtn = ButtonCorner({icon: 'arrow_next'});\r\n\r\n    attachClickEvent(this.nextBtn, () => {\r\n      const title = this.groupNameInputField.value;\r\n\r\n      let promise: Promise<ChatId>;\r\n      if(this.isGeoChat) {\r\n        if(!this.userLocationAddress || !this.userLocationCoords) return;\r\n        promise = this.managers.appChatsManager.createChannel({\r\n          title,\r\n          about: '',\r\n          geo_point: {\r\n            _: 'inputGeoPoint',\r\n            ...this.userLocationCoords\r\n          },\r\n          address: this.userLocationAddress,\r\n          megagroup: true\r\n        }).then((chatId) => {\r\n          if(this.uploadAvatar) {\r\n            this.uploadAvatar().then((inputFile) => {\r\n              this.managers.appChatsManager.editPhoto(chatId, inputFile);\r\n            });\r\n          }\r\n\r\n          if(this.peerIds.length) {\r\n            this.managers.appChatsManager.inviteToChannel(chatId, this.peerIds);\r\n          }\r\n\r\n          return chatId;\r\n        });\r\n      } else {\r\n        this.nextBtn.disabled = true;\r\n        promise = this.managers.appChatsManager.createChat(title, this.peerIds.map((peerId) => peerId.toUserId())).then((chatId) => {\r\n          if(this.uploadAvatar) {\r\n            this.uploadAvatar().then((inputFile) => {\r\n              this.managers.appChatsManager.editPhoto(chatId, inputFile);\r\n            });\r\n          }\r\n\r\n          return chatId;\r\n        });\r\n      }\r\n\r\n      if(!promise) {\r\n        return;\r\n      }\r\n\r\n      promise.then((chatId) => {\r\n        appSidebarLeft.removeTabFromHistory(this);\r\n        appSidebarLeft.selectTab(0);\r\n\r\n        appImManager.setInnerPeer({peerId: chatId.toPeerId(true)});\r\n      });\r\n    }, {listenerSetter: this.listenerSetter});\r\n\r\n    const chatsSection = new SettingSection({\r\n      name: 'Members',\r\n      nameArgs: [this.peerIds.length]\r\n    });\r\n\r\n    const list = this.list = appDialogsManager.createChatList({\r\n      new: true\r\n    });\r\n\r\n    chatsSection.content.append(list);\r\n\r\n    section.content.append(this.avatarEdit.container, inputWrapper);\r\n\r\n    this.content.append(this.nextBtn);\r\n    this.scrollable.append(section.container, chatsSection.container);\r\n  }\r\n\r\n  public onCloseAfterTimeout() {\r\n    this.avatarEdit.clear();\r\n    this.uploadAvatar = null;\r\n    this.groupNameInputField.value = '';\r\n    this.groupLocationInputField.container.classList.add('hide');\r\n    this.nextBtn.disabled = false;\r\n  }\r\n\r\n  public open(peerIds: PeerId[], isGeoChat: boolean = false) {\r\n    this.isGeoChat = isGeoChat;\r\n    this.peerIds = peerIds;\r\n    const result = super.open();\r\n    result.then(() => {\r\n      if(isGeoChat) {\r\n        this.setTitle('NearbyCreateGroup');\r\n        this.groupLocationInputField.container.classList.remove('hide');\r\n        this.groupLocationInputField.setValueSilently(I18n.format('Loading', true));\r\n        this.startLocating();\r\n      } else {\r\n        this.groupLocationInputField.container.classList.add('hide');\r\n      }\r\n\r\n      return Promise.all(this.peerIds.map(async(userId) => {\r\n        const {dom} = appDialogsManager.addDialogNew({\r\n          peerId: userId,\r\n          container: this.list,\r\n          rippleEnabled: false,\r\n          avatarSize: 48\r\n        });\r\n\r\n        dom.lastMessageSpan.append(getUserStatusString(await this.managers.appUsersManager.getUser(userId)));\r\n      }));\r\n    });\r\n\r\n    return result;\r\n  }\r\n\r\n  private startLocating() {\r\n    navigator.geolocation.getCurrentPosition((location) => {\r\n      this.userLocationCoords = {\r\n        lat: location.coords.latitude,\r\n        long: location.coords.longitude\r\n      };\r\n\r\n      let uri = 'https://nominatim.openstreetmap.org/reverse';\r\n      uri += '?lat='+location.coords.latitude;\r\n      uri += '&lon='+location.coords.longitude;\r\n      uri += '&format=json';\r\n      uri += '&addressdetails=1';\r\n      uri += '&accept-language=en';\r\n      fetch(uri)\r\n      .then((response) => response.json())\r\n      .then((response: OpenStreetMapInterface) => {\r\n        this.userLocationAddress = response.display_name;\r\n        this.groupLocationInputField.setValueSilently(response.display_name);\r\n      });\r\n    }, (error) => {\r\n      if(error instanceof GeolocationPositionError) {\r\n        this.groupLocationInputField.setValueSilently('Location permission denied. Please retry later.');\r\n      } else {\r\n        this.groupLocationInputField.setValueSilently('An error has occurred. Please retry later.');\r\n      }\r\n    });\r\n  }\r\n}\r\n","enum PrivacyType {\n  Everybody = 2,\n  Contacts = 1,\n  Nobody = 0\n}\n\nexport default PrivacyType;\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport {PrivacyRule} from '../../../../layer';\nimport PrivacyType from './privacyType';\n\nexport default function getPrivacyRulesDetails(rules: PrivacyRule[]) {\n  const types: PrivacyType[] = [];\n\n  type peers = {users: UserId[], chats: ChatId[]};\n  const allowPeers: peers = {users: [], chats: []}, disallowPeers: peers = {users: [], chats: []};\n  rules.forEach((rule) => {\n    switch(rule._) {\n      case 'privacyValueAllowAll':\n        types.push(2);\n        break;\n      case 'privacyValueDisallowAll':\n        types.push(0);\n        break;\n      case 'privacyValueAllowContacts':\n        types.push(1);\n        break;\n      /* case 'privacyValueDisallowContacts':\n        types.push('Except My Contacts');\n        break; */\n      case 'privacyValueAllowChatParticipants':\n        allowPeers.chats.push(...rule.chats);\n        break;\n      case 'privacyValueAllowUsers':\n        allowPeers.users.push(...rule.users);\n        break;\n      case 'privacyValueDisallowChatParticipants':\n        disallowPeers.chats.push(...rule.chats);\n        break;\n      case 'privacyValueDisallowUsers':\n        disallowPeers.users.push(...rule.users);\n        break;\n    }\n  });\n\n  return {type: types[0], disallowPeers, allowPeers};\n}\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport replaceContent from '../helpers/dom/replaceContent';\r\nimport {randomLong} from '../helpers/random';\r\nimport {InputPrivacyKey, InputPrivacyRule} from '../layer';\r\nimport {AppManagers} from '../lib/appManagers/managers';\r\nimport getPrivacyRulesDetails from '../lib/appManagers/utils/privacy/getPrivacyRulesDetails';\r\nimport PrivacyType from '../lib/appManagers/utils/privacy/privacyType';\r\nimport {i18n, join, LangPackKey, _i18n} from '../lib/langPack';\r\nimport RadioField from './radioField';\r\nimport Row, {RadioFormFromRows} from './row';\r\nimport Scrollable from './scrollable';\r\nimport {SettingSection, generateSection} from './sidebarLeft';\r\nimport AppAddMembersTab from './sidebarLeft/tabs/addMembers';\r\nimport {SliderSuperTabEventable} from './sliderTab';\r\n\r\nexport type PrivacySectionStr = LangPackKey | '' | HTMLElement;\r\nexport default class PrivacySection {\r\n  public radioRows: Map<PrivacyType, Row>;\r\n  public radioSection: SettingSection;\r\n  public exceptions: Map<keyof PrivacySection['peerIds'], {\r\n    titleLangKey: LangPackKey,\r\n    key: keyof PrivacySection['peerIds'],\r\n    row: Row,\r\n    icon: string,\r\n    subtitleLangKey: LangPackKey,\r\n    clickable: true\r\n  }>;\r\n  public peerIds: {\r\n    disallow?: PeerId[],\r\n    allow?: PeerId[]\r\n  };\r\n  public type: PrivacyType;\r\n\r\n  constructor(public options: {\r\n    tab: SliderSuperTabEventable,\r\n    title: LangPackKey,\r\n    inputKey: InputPrivacyKey['_'],\r\n    captions?: [PrivacySectionStr, PrivacySectionStr, PrivacySectionStr],\r\n    appendTo?: Scrollable,\r\n    noExceptions?: boolean,\r\n    onRadioChange?: (value: number) => any,\r\n    skipTypes?: PrivacyType[],\r\n    exceptionTexts?: [LangPackKey, LangPackKey],\r\n    managers: AppManagers\r\n  }) {\r\n    if(options.captions) {\r\n      options.captions.reverse();\r\n    }\r\n\r\n    const managers = options.managers;\r\n\r\n    this.radioSection = new SettingSection({name: options.title, caption: true});\r\n\r\n    this.radioRows = new Map();\r\n\r\n    let r: Array<{type: PrivacyType, langKey: LangPackKey}> = [{\r\n      type: PrivacyType.Everybody,\r\n      langKey: 'PrivacySettingsController.Everbody'\r\n    }, {\r\n      type: PrivacyType.Contacts,\r\n      langKey: 'PrivacySettingsController.MyContacts'\r\n    }, {\r\n      type: PrivacyType.Nobody,\r\n      langKey: 'PrivacySettingsController.Nobody'\r\n    }];\r\n\r\n    if(options.skipTypes) {\r\n      r = r.filter((r) => !options.skipTypes.includes(r.type));\r\n    }\r\n\r\n    const random = randomLong();\r\n    r.forEach(({type, langKey}) => {\r\n      const row = new Row({\r\n        radioField: new RadioField({\r\n          langKey,\r\n          name: random,\r\n          value: '' + type\r\n        })\r\n      });\r\n\r\n      this.radioRows.set(type, row);\r\n    });\r\n\r\n    const form = RadioFormFromRows([...this.radioRows.values()], this.onRadioChange);\r\n\r\n    this.radioSection.content.append(form);\r\n    if(options.appendTo) {\r\n      options.appendTo.append(this.radioSection.container);\r\n    }\r\n\r\n    if(!options.noExceptions) {\r\n      const container = generateSection(options.appendTo, 'PrivacyExceptions', 'PrivacySettingsController.PeerInfo');\r\n\r\n      this.exceptions = new Map([[\r\n        'disallow',\r\n        {\r\n          titleLangKey: options.exceptionTexts[0],\r\n          key: 'disallow',\r\n          row: null,\r\n          icon: 'deleteuser',\r\n          subtitleLangKey: 'PrivacySettingsController.AddUsers',\r\n          clickable: true\r\n        }\r\n      ], [\r\n        'allow',\r\n        {\r\n          titleLangKey: options.exceptionTexts[1],\r\n          key: 'allow',\r\n          row: null,\r\n          icon: 'adduser',\r\n          subtitleLangKey: 'PrivacySettingsController.AddUsers',\r\n          clickable: true\r\n        }\r\n      ]]);\r\n\r\n      this.exceptions.forEach((exception) => {\r\n        exception.row = new Row(exception);\r\n\r\n        exception.row.container.addEventListener('click', () => {\r\n          promise.then(() => {\r\n            const _peerIds = this.peerIds[exception.key];\r\n            options.tab.slider.createTab(AppAddMembersTab).open({\r\n              type: 'privacy',\r\n              skippable: true,\r\n              title: exception.titleLangKey,\r\n              placeholder: 'PrivacyModal.Search.Placeholder',\r\n              takeOut: (newPeerIds) => {\r\n                _peerIds.length = 0;\r\n                _peerIds.push(...newPeerIds);\r\n                exception.row.subtitle.innerHTML = '';\r\n                exception.row.subtitle.append(...this.generateStr(this.splitPeersByType(newPeerIds)));\r\n              },\r\n              selectedPeerIds: _peerIds\r\n            });\r\n          });\r\n        });\r\n\r\n        container.append(exception.row.container);\r\n      });\r\n    }\r\n\r\n    /* setTimeout(() => {\r\n      this.setRadio(PrivacyType.Contacts);\r\n    }, 0); */\r\n\r\n    const promise = managers.appPrivacyManager.getPrivacy(options.inputKey).then((rules) => {\r\n      const details = getPrivacyRulesDetails(rules);\r\n      this.setRadio(details.type);\r\n\r\n      if(this.exceptions) {\r\n        this.peerIds = {};\r\n        ['allow' as const, 'disallow' as const].forEach((k) => {\r\n          const arr = [];\r\n          const from = k === 'allow' ? details.allowPeers : details.disallowPeers;\r\n          arr.push(...from.users.map((id) => id.toPeerId()));\r\n          arr.push(...from.chats.map((id) => id.toPeerId(true)));\r\n          this.peerIds[k] = arr;\r\n          const s = this.exceptions.get(k).row.subtitle;\r\n          s.innerHTML = '';\r\n          s.append(...this.generateStr(from));\r\n        });\r\n      }\r\n\r\n      options.tab.eventListener.addEventListener('destroy', async() => {\r\n        const rules: InputPrivacyRule[] = [];\r\n\r\n        switch(this.type) {\r\n          case PrivacyType.Everybody:\r\n            rules.push({_: 'inputPrivacyValueAllowAll'});\r\n            break;\r\n          case PrivacyType.Contacts:\r\n            rules.push({_: 'inputPrivacyValueAllowContacts'});\r\n            break;\r\n          case PrivacyType.Nobody:\r\n            rules.push({_: 'inputPrivacyValueDisallowAll'});\r\n            break;\r\n        }\r\n\r\n        if(this.exceptions) {\r\n          const a = ([\r\n            ['allow',     'inputPrivacyValueAllowChatParticipants',     'inputPrivacyValueAllowUsers'],\r\n            ['disallow',  'inputPrivacyValueDisallowChatParticipants',  'inputPrivacyValueDisallowUsers']\r\n          ] as Array<[\r\n            'allow' | 'disallow',\r\n            'inputPrivacyValueAllowChatParticipants' | 'inputPrivacyValueDisallowChatParticipants',\r\n            'inputPrivacyValueAllowUsers' | 'inputPrivacyValueDisallowUsers'\r\n          ]>);\r\n          for(const [k, chatKey, usersKey] of a) {\r\n            if(this.exceptions.get(k).row.container.classList.contains('hide')) {\r\n              continue;\r\n            }\r\n\r\n            const _peerIds = this.peerIds[k];\r\n            if(_peerIds) {\r\n              const splitted = this.splitPeersByType(_peerIds);\r\n              if(splitted.chats.length) {\r\n                rules.push({_: chatKey, chats: splitted.chats});\r\n              }\r\n\r\n              if(splitted.users.length) {\r\n                rules.push({\r\n                  _: usersKey,\r\n                  users: await Promise.all(splitted.users.map((id) => managers.appUsersManager.getUserInput(id)))\r\n                });\r\n              }\r\n            }\r\n          }\r\n        }\r\n\r\n        managers.appPrivacyManager.setPrivacy(options.inputKey, rules);\r\n      }, {once: true});\r\n    });\r\n  }\r\n\r\n  private onRadioChange = (value: string | PrivacySection['type']) => {\r\n    value = +value as PrivacySection['type'];\r\n    this.type = value;\r\n\r\n    const caption = this.options.captions[this.type];\r\n    const captionElement = this.radioSection.caption;\r\n    if(!caption) {\r\n      captionElement.innerHTML = '';\r\n    } else if(caption instanceof HTMLElement) {\r\n      replaceContent(captionElement, caption);\r\n    } else {\r\n      _i18n(captionElement, caption);\r\n    }\r\n    captionElement.classList.toggle('hide', !caption);\r\n\r\n    if(this.exceptions) {\r\n      this.exceptions.get('allow').row.container.classList.toggle('hide', this.type === PrivacyType.Everybody);\r\n      this.exceptions.get('disallow').row.container.classList.toggle('hide', this.type === PrivacyType.Nobody);\r\n    }\r\n\r\n    this.options.onRadioChange && this.options.onRadioChange(value);\r\n  };\r\n\r\n  public setRadio(type: PrivacySection['type']) {\r\n    const row = this.radioRows.get(type);\r\n    this.onRadioChange(type);\r\n    row.radioField.input.checked = true;\r\n  }\r\n\r\n  private splitPeersByType(peerIds: PeerId[]) {\r\n    const peers = {users: [] as UserId[], chats: [] as ChatId[]};\r\n    peerIds.forEach((peerId) => {\r\n      peers[peerId.isAnyChat() ? 'chats' : 'users'].push(peerId.isAnyChat() ? peerId.toChatId() : peerId);\r\n    });\r\n\r\n    return peers;\r\n  }\r\n\r\n  private generateStr(peers: {users: UserId[], chats: ChatId[]}) {\r\n    if(!peers.users.length && !peers.chats.length) {\r\n      return [i18n('PrivacySettingsController.AddUsers')];\r\n    }\r\n\r\n    return join([\r\n      peers.users.length ? i18n('Users', [peers.users.length]) : null,\r\n      peers.chats.length ? i18n('Chats', [peers.chats.length]) : null\r\n    ].filter(Boolean), false);\r\n  }\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport {SliderSuperTabEventable} from '../../../sliderTab';\r\nimport PrivacySection from '../../../privacySection';\r\nimport {i18n, LangPackKey} from '../../../../lib/langPack';\r\nimport anchorCopy from '../../../../helpers/dom/anchorCopy';\r\nimport PrivacyType from '../../../../lib/appManagers/utils/privacy/privacyType';\r\n\r\nexport default class AppPrivacyPhoneNumberTab extends SliderSuperTabEventable {\r\n  protected async init() {\r\n    this.header.classList.add('with-border');\r\n    this.container.classList.add('privacy-tab', 'privacy-phone-number');\r\n    this.setTitle('PrivacyPhone');\r\n\r\n    const formatted = '+' + (await this.managers.appUsersManager.getSelf()).phone;\r\n    const captionEl = document.createElement('div');\r\n    captionEl.append(\r\n      i18n('PrivacyPhoneInfo'),\r\n      document.createElement('br'),\r\n      document.createElement('br'),\r\n      i18n('PrivacyPhoneInfo4'),\r\n      document.createElement('br'),\r\n      anchorCopy({\r\n        mePath: formatted\r\n      })\r\n    );\r\n\r\n    const phoneSection = new PrivacySection({\r\n      tab: this,\r\n      title: 'PrivacyPhoneTitle',\r\n      inputKey: 'inputPrivacyKeyPhoneNumber',\r\n      captions: [captionEl, captionEl, ''],\r\n      exceptionTexts: ['PrivacySettingsController.NeverShare', 'PrivacySettingsController.AlwaysShare'],\r\n      appendTo: this.scrollable,\r\n      onRadioChange: (type) => {\r\n        s.setRadio(PrivacyType.Everybody);\r\n        s.radioSection.container.classList.toggle('hide', type !== PrivacyType.Nobody);\r\n      },\r\n      managers: this.managers\r\n    });\r\n\r\n    const sCaption: LangPackKey = 'PrivacyPhoneInfo3';\r\n    const s = new PrivacySection({\r\n      tab: this,\r\n      title: 'PrivacyPhoneTitle2',\r\n      inputKey: 'inputPrivacyKeyAddedByPhone',\r\n      captions: [sCaption, sCaption, ''],\r\n      noExceptions: true,\r\n      skipTypes: [PrivacyType.Nobody],\r\n      managers: this.managers\r\n    });\r\n\r\n    this.scrollable.container.insertBefore(s.radioSection.container, phoneSection.radioSection.container.nextSibling);\r\n  }\r\n}\r\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport {toastNew} from '../../components/toast';\nimport {copyTextToClipboard} from '../clipboard';\nimport cancelEvent from './cancelEvent';\nimport {attachClickEvent} from './clickEvent';\n\nexport default function anchorCopy(options: Partial<{\n  // href: string,\n  mePath: string\n}> = {}) {\n  const anchor = document.createElement('a');\n  anchor.classList.add('anchor-copy');\n\n  if(options.mePath) {\n    const href = 'https://t.me/' + options.mePath;\n    anchor.href = anchor.innerText = href;\n  }\n\n  attachClickEvent(anchor, (e) => {\n    cancelEvent(e);\n    copyTextToClipboard(anchor.href);\n    toastNew({langPackKey: 'LinkCopied'});\n  });\n\n  return anchor;\n}\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport {SettingSection} from '../..';\r\nimport {attachClickEvent} from '../../../../helpers/dom/clickEvent';\r\nimport Button from '../../../button';\r\nimport {SliderSuperTab} from '../../../slider';\r\nimport wrapStickerEmoji from '../../../wrappers/stickerEmoji';\r\nimport AppSettingsTab from '../settings';\r\n\r\nexport default class AppTwoStepVerificationSetTab extends SliderSuperTab {\r\n  protected init() {\r\n    this.container.classList.add('two-step-verification', 'two-step-verification-set');\r\n    this.setTitle('TwoStepVerificationPasswordSet');\r\n\r\n    const section = new SettingSection({\r\n      captionOld: 'TwoStepVerificationPasswordSetInfo',\r\n      noDelimiter: true\r\n    });\r\n\r\n    const emoji = '';\r\n    const stickerContainer = document.createElement('div');\r\n\r\n    wrapStickerEmoji({\r\n      emoji,\r\n      div: stickerContainer,\r\n      width: 160,\r\n      height: 160\r\n    });\r\n\r\n    section.content.append(stickerContainer);\r\n\r\n    const inputContent = section.generateContentElement();\r\n\r\n    const inputWrapper = document.createElement('div');\r\n    inputWrapper.classList.add('input-wrapper');\r\n\r\n    const btnReturn = Button('btn-primary btn-color-primary', {text: 'TwoStepVerificationPasswordReturnSettings'});\r\n\r\n    attachClickEvent(btnReturn, (e) => {\r\n      this.close();\r\n    });\r\n\r\n    this.slider.sliceTabsUntilTab(AppSettingsTab, this);\r\n\r\n    inputWrapper.append(btnReturn);\r\n\r\n    inputContent.append(inputWrapper);\r\n\r\n    this.scrollable.container.append(section.container);\r\n  }\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport {IS_MOBILE_SAFARI} from '../../environment/userAgent';\r\n\r\nexport function canFocus(isFirstInput: boolean) {\r\n  return !IS_MOBILE_SAFARI || !isFirstInput;\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport {SettingSection} from '../..';\r\nimport {AccountPassword} from '../../../../layer';\r\nimport Button from '../../../button';\r\nimport {SliderSuperTab} from '../../../slider';\r\nimport AppTwoStepVerificationSetTab from './passwordSet';\r\nimport CodeInputField from '../../../codeInputField';\r\nimport AppTwoStepVerificationEmailTab from './email';\r\nimport {putPreloader} from '../../../putPreloader';\r\nimport {i18n, _i18n} from '../../../../lib/langPack';\r\nimport {canFocus} from '../../../../helpers/dom/canFocus';\r\nimport {attachClickEvent} from '../../../../helpers/dom/clickEvent';\r\nimport replaceContent from '../../../../helpers/dom/replaceContent';\r\nimport toggleDisability from '../../../../helpers/dom/toggleDisability';\r\nimport wrapStickerEmoji from '../../../wrappers/stickerEmoji';\r\n\r\nexport default class AppTwoStepVerificationEmailConfirmationTab extends SliderSuperTab {\r\n  public codeInputField: CodeInputField;\r\n  public state: AccountPassword;\r\n  public email: string;\r\n  public length: number;\r\n  public isFirst = false;\r\n\r\n  protected init() {\r\n    this.container.classList.add('two-step-verification', 'two-step-verification-email-confirmation');\r\n    this.setTitle('TwoStepAuth.RecoveryTitle');\r\n\r\n    const section = new SettingSection({\r\n      captionOld: true,\r\n      noDelimiter: true\r\n    });\r\n\r\n    _i18n(section.caption, 'TwoStepAuth.ConfirmEmailCodeDesc', [this.email]);\r\n\r\n    const emoji = '';\r\n    const stickerContainer = document.createElement('div');\r\n\r\n    wrapStickerEmoji({\r\n      div: stickerContainer,\r\n      width: 160,\r\n      height: 160,\r\n      emoji\r\n    });\r\n\r\n    section.content.append(stickerContainer);\r\n\r\n    const inputContent = section.generateContentElement();\r\n\r\n    const inputWrapper = document.createElement('div');\r\n    inputWrapper.classList.add('input-wrapper');\r\n\r\n    const inputField = this.codeInputField = new CodeInputField({\r\n      name: 'recovery-email-code',\r\n      label: 'TwoStepAuth.RecoveryCode',\r\n      length: this.length,\r\n      onFill: (code) => {\r\n        freeze(true);\r\n\r\n        this.managers.passwordManager.confirmPasswordEmail('' + code)\r\n        .then((value) => {\r\n          if(!value) {\r\n\r\n          }\r\n\r\n          goNext();\r\n        })\r\n        .catch((err) => {\r\n          switch(err.type) {\r\n            case 'CODE_INVALID':\r\n              inputField.input.classList.add('error');\r\n              replaceContent(inputField.label, i18n('TwoStepAuth.RecoveryCodeInvalid'));\r\n              break;\r\n\r\n            case 'EMAIL_HASH_EXPIRED':\r\n              inputField.input.classList.add('error');\r\n              replaceContent(inputField.label, i18n('TwoStepAuth.RecoveryCodeExpired'));\r\n              break;\r\n\r\n            default:\r\n              console.error('confirm error', err);\r\n              break;\r\n          }\r\n\r\n          freeze(false);\r\n        });\r\n      }\r\n    });\r\n\r\n    const btnChange = Button('btn-primary btn-primary-transparent primary', {text: 'TwoStepAuth.EmailCodeChangeEmail'});\r\n    const btnResend = Button('btn-primary btn-secondary btn-primary-transparent primary', {text: 'ResendCode'});\r\n\r\n    const goNext = () => {\r\n      this.slider.createTab(AppTwoStepVerificationSetTab).open();\r\n    };\r\n\r\n    const freeze = (disable: boolean) => {\r\n      toggleDisability([inputField.input, btnChange, btnResend], disable);\r\n    };\r\n\r\n    attachClickEvent(btnChange, (e) => {\r\n      freeze(true);\r\n      this.managers.passwordManager.cancelPasswordEmail().then((value) => {\r\n        this.slider.sliceTabsUntilTab(AppTwoStepVerificationEmailTab, this);\r\n        this.close();\r\n      }, () => {\r\n        freeze(false);\r\n      });\r\n    });\r\n\r\n    attachClickEvent(btnResend, (e) => {\r\n      freeze(true);\r\n      const d = putPreloader(btnResend);\r\n      this.managers.passwordManager.resendPasswordEmail().then((value) => {\r\n        d.remove();\r\n        freeze(false);\r\n      });\r\n    });\r\n\r\n    inputWrapper.append(inputField.container, btnChange, btnResend);\r\n\r\n    inputContent.append(inputWrapper);\r\n\r\n    this.scrollable.container.append(section.container);\r\n  }\r\n\r\n  onOpenAfterTimeout() {\r\n    if(!canFocus(this.isFirst)) return;\r\n    this.codeInputField.input.focus();\r\n  }\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport {SettingSection} from '../..';\r\nimport {AccountPassword} from '../../../../layer';\r\nimport Button from '../../../button';\r\nimport {SliderSuperTab} from '../../../slider';\r\nimport InputField from '../../../inputField';\r\nimport {putPreloader} from '../../../putPreloader';\r\nimport AppTwoStepVerificationSetTab from './passwordSet';\r\nimport AppTwoStepVerificationEmailConfirmationTab from './emailConfirmation';\r\nimport PopupPeer from '../../../popups/peer';\r\nimport cancelEvent from '../../../../helpers/dom/cancelEvent';\r\nimport {canFocus} from '../../../../helpers/dom/canFocus';\r\nimport {attachClickEvent} from '../../../../helpers/dom/clickEvent';\r\nimport matchEmail from '../../../../lib/richTextProcessor/matchEmail';\r\nimport wrapStickerEmoji from '../../../wrappers/stickerEmoji';\r\n\r\nexport default class AppTwoStepVerificationEmailTab extends SliderSuperTab {\r\n  public inputField: InputField;\r\n  public state: AccountPassword;\r\n  public plainPassword: string;\r\n  public newPassword: string;\r\n  public hint: string;\r\n  public isFirst = false;\r\n\r\n  protected init() {\r\n    this.container.classList.add('two-step-verification', 'two-step-verification-email');\r\n    this.setTitle('RecoveryEmailTitle');\r\n\r\n    const section = new SettingSection({\r\n      captionOld: true,\r\n      noDelimiter: true\r\n    });\r\n\r\n    const emoji = '';\r\n    const stickerContainer = document.createElement('div');\r\n\r\n    wrapStickerEmoji({\r\n      div: stickerContainer,\r\n      width: 160,\r\n      height: 160,\r\n      emoji\r\n    });\r\n\r\n    section.content.append(stickerContainer);\r\n\r\n    const inputContent = section.generateContentElement();\r\n\r\n    const inputWrapper = document.createElement('div');\r\n    inputWrapper.classList.add('input-wrapper');\r\n\r\n    const inputField = this.inputField = new InputField({\r\n      name: 'recovery-email',\r\n      label: 'RecoveryEmail',\r\n      plainText: true\r\n    });\r\n\r\n    inputField.input.addEventListener('keypress', (e) => {\r\n      if(e.key === 'Enter') {\r\n        cancelEvent(e);\r\n        return onContinueClick();\r\n      }\r\n    });\r\n\r\n    inputField.input.addEventListener('input', (e) => {\r\n      inputField.input.classList.remove('error');\r\n    });\r\n\r\n    const btnContinue = Button('btn-primary btn-color-primary', {text: 'Continue'});\r\n    const btnSkip = Button('btn-primary btn-secondary btn-primary-transparent primary', {text: 'YourEmailSkip'});\r\n\r\n    const goNext = () => {\r\n      this.slider.createTab(AppTwoStepVerificationSetTab).open();\r\n    };\r\n\r\n    const onContinueClick = () => {\r\n      const email = inputField.value.trim();\r\n      const match = matchEmail(email);\r\n      if(!match || match[0].length !== email.length) {\r\n        inputField.input.classList.add('error');\r\n        return;\r\n      }\r\n\r\n      toggleButtons(true);\r\n      const d = putPreloader(btnContinue);\r\n\r\n      this.managers.passwordManager.updateSettings({\r\n        hint: this.hint,\r\n        currentPassword: this.plainPassword,\r\n        newPassword: this.newPassword,\r\n        email\r\n      }).then((value) => {\r\n        goNext();\r\n      }, (err) => {\r\n        if(err.type.includes('EMAIL_UNCONFIRMED')) {\r\n          const symbols = +err.type.match(/^EMAIL_UNCONFIRMED_(\\d+)/)[1];\r\n\r\n          const tab = this.slider.createTab(AppTwoStepVerificationEmailConfirmationTab);\r\n          tab.state = this.state;\r\n          tab.email = email;\r\n          tab.length = symbols;\r\n          tab.open();\r\n        } else {\r\n          console.log('password set error', err);\r\n        }\r\n\r\n        toggleButtons(false);\r\n        d.remove();\r\n      });\r\n    };\r\n    attachClickEvent(btnContinue, onContinueClick);\r\n\r\n    const toggleButtons = (freeze: boolean) => {\r\n      if(freeze) {\r\n        btnContinue.setAttribute('disabled', 'true');\r\n        btnSkip.setAttribute('disabled', 'true');\r\n      } else {\r\n        btnContinue.removeAttribute('disabled');\r\n        btnSkip.removeAttribute('disabled');\r\n      }\r\n    };\r\n\r\n    attachClickEvent(btnSkip, (e) => {\r\n      const popup = new PopupPeer('popup-skip-email', {\r\n        buttons: [{\r\n          langKey: 'Cancel',\r\n          isCancel: true\r\n        }, {\r\n          langKey: 'YourEmailSkip',\r\n          callback: () => {\r\n            // inputContent.classList.add('sidebar-left-section-disabled');\r\n            toggleButtons(true);\r\n            putPreloader(btnSkip);\r\n            this.managers.passwordManager.updateSettings({\r\n              hint: this.hint,\r\n              currentPassword: this.plainPassword,\r\n              newPassword: this.newPassword,\r\n              email: ''\r\n            }).then(() => {\r\n              goNext();\r\n            }, (err) => {\r\n              toggleButtons(false);\r\n            });\r\n          },\r\n          isDanger: true\r\n        }],\r\n        titleLangKey: 'YourEmailSkipWarning',\r\n        descriptionLangKey: 'YourEmailSkipWarningText'\r\n      });\r\n\r\n      popup.show();\r\n    });\r\n\r\n    inputWrapper.append(inputField.container, btnContinue, btnSkip);\r\n\r\n    inputContent.append(inputWrapper);\r\n\r\n    this.scrollable.container.append(section.container);\r\n  }\r\n\r\n  onOpenAfterTimeout() {\r\n    if(!canFocus(this.isFirst)) return;\r\n    this.inputField.input.focus();\r\n  }\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport {SettingSection} from '../..';\r\nimport {AccountPassword} from '../../../../layer';\r\nimport Button from '../../../button';\r\nimport {SliderSuperTab} from '../../../slider';\r\nimport InputField from '../../../inputField';\r\nimport AppTwoStepVerificationEmailTab from './email';\r\nimport {toast} from '../../../toast';\r\nimport I18n from '../../../../lib/langPack';\r\nimport cancelEvent from '../../../../helpers/dom/cancelEvent';\r\nimport {attachClickEvent} from '../../../../helpers/dom/clickEvent';\r\nimport wrapStickerEmoji from '../../../wrappers/stickerEmoji';\r\n\r\nexport default class AppTwoStepVerificationHintTab extends SliderSuperTab {\r\n  public inputField: InputField;\r\n  public state: AccountPassword;\r\n  public plainPassword: string;\r\n  public newPassword: string;\r\n\r\n  protected init() {\r\n    this.container.classList.add('two-step-verification', 'two-step-verification-hint');\r\n    this.setTitle('TwoStepAuth.SetupHintTitle');\r\n\r\n    const section = new SettingSection({\r\n      noDelimiter: true\r\n    });\r\n\r\n    const emoji = '';\r\n    const stickerContainer = document.createElement('div');\r\n    wrapStickerEmoji({\r\n      div: stickerContainer,\r\n      width: 160,\r\n      height: 160,\r\n      emoji\r\n    });\r\n\r\n    section.content.append(stickerContainer);\r\n\r\n    const inputWrapper = document.createElement('div');\r\n    inputWrapper.classList.add('input-wrapper');\r\n\r\n    const inputField = this.inputField = new InputField({\r\n      name: 'hint',\r\n      label: 'TwoStepAuth.SetupHintPlaceholder'\r\n    });\r\n\r\n    inputField.input.addEventListener('keypress', (e) => {\r\n      if(e.key === 'Enter') {\r\n        cancelEvent(e);\r\n        return inputField.value ? onContinueClick() : onSkipClick();\r\n      }\r\n    });\r\n\r\n    const goNext = (e?: Event, saveHint?: boolean) => {\r\n      if(e) {\r\n        cancelEvent(e);\r\n      }\r\n\r\n      const hint = saveHint ? inputField.value : undefined;\r\n      if(hint && this.newPassword === hint) {\r\n        toast(I18n.format('PasswordAsHintError', true));\r\n        return;\r\n      }\r\n\r\n      const tab = this.slider.createTab(AppTwoStepVerificationEmailTab);\r\n      tab.state = this.state;\r\n      tab.plainPassword = this.plainPassword;\r\n      tab.newPassword = this.newPassword;\r\n      tab.hint = hint;\r\n\r\n      tab.open();\r\n    };\r\n\r\n    const btnContinue = Button('btn-primary btn-color-primary', {text: 'Continue'});\r\n    const btnSkip = Button('btn-primary btn-secondary btn-primary-transparent primary', {text: 'YourEmailSkip'});\r\n\r\n    const onContinueClick = (e?: Event) => goNext(e, true);\r\n    const onSkipClick = (e?: Event) => goNext(e, false);\r\n    attachClickEvent(btnContinue, onContinueClick);\r\n    attachClickEvent(btnSkip, onSkipClick);\r\n\r\n    inputWrapper.append(inputField.container, btnContinue, btnSkip);\r\n\r\n    section.content.append(inputWrapper);\r\n\r\n    this.scrollable.container.append(section.container);\r\n  }\r\n\r\n  onOpenAfterTimeout() {\r\n    this.inputField.input.focus();\r\n  }\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport {SettingSection} from '../..';\r\nimport {AccountPassword} from '../../../../layer';\r\nimport Button from '../../../button';\r\nimport PasswordInputField from '../../../passwordInputField';\r\nimport {SliderSuperTab} from '../../../slider';\r\nimport TrackingMonkey from '../../../monkeys/tracking';\r\nimport AppTwoStepVerificationHintTab from './hint';\r\nimport {InputState} from '../../../inputField';\r\nimport cancelEvent from '../../../../helpers/dom/cancelEvent';\r\nimport {attachClickEvent} from '../../../../helpers/dom/clickEvent';\r\n\r\nexport default class AppTwoStepVerificationReEnterPasswordTab extends SliderSuperTab {\r\n  public state: AccountPassword;\r\n  public passwordInputField: PasswordInputField;\r\n  public plainPassword: string;\r\n  public newPassword: string;\r\n\r\n  protected init() {\r\n    this.container.classList.add('two-step-verification', 'two-step-verification-enter-password', 'two-step-verification-re-enter-password');\r\n    this.setTitle('PleaseReEnterPassword');\r\n\r\n    const section = new SettingSection({\r\n      noDelimiter: true\r\n    });\r\n\r\n    const inputWrapper = document.createElement('div');\r\n    inputWrapper.classList.add('input-wrapper');\r\n\r\n    const passwordInputField = this.passwordInputField = new PasswordInputField({\r\n      name: 're-enter-password',\r\n      label: 'PleaseReEnterPassword'\r\n    });\r\n\r\n    const monkey = new TrackingMonkey(passwordInputField, 157);\r\n\r\n    const btnContinue = Button('btn-primary btn-color-primary', {text: 'Continue'});\r\n\r\n    inputWrapper.append(passwordInputField.container, btnContinue);\r\n    section.content.append(monkey.container, inputWrapper);\r\n\r\n    this.scrollable.container.append(section.container);\r\n\r\n    passwordInputField.input.addEventListener('keypress', (e) => {\r\n      if(passwordInputField.input.classList.contains('error')) {\r\n        passwordInputField.setState(InputState.Neutral);\r\n      }\r\n\r\n      if(e.key === 'Enter') {\r\n        return onContinueClick();\r\n      }\r\n    });\r\n\r\n    const verifyInput = () => {\r\n      if(this.newPassword !== passwordInputField.value) {\r\n        passwordInputField.setError();\r\n        return false;\r\n      }\r\n\r\n      return true;\r\n    };\r\n\r\n    const onContinueClick = (e?: Event) => {\r\n      if(e) {\r\n        cancelEvent(e);\r\n      }\r\n\r\n      if(!verifyInput()) return;\r\n\r\n      const tab = this.slider.createTab(AppTwoStepVerificationHintTab);\r\n      tab.state = this.state;\r\n      tab.plainPassword = this.plainPassword;\r\n      tab.newPassword = this.newPassword;\r\n      tab.open();\r\n    };\r\n    attachClickEvent(btnContinue, onContinueClick);\r\n\r\n    return monkey.load();\r\n  }\r\n\r\n  onOpenAfterTimeout() {\r\n    this.passwordInputField.input.focus();\r\n  }\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport AppTwoStepVerificationTab from '.';\r\nimport {SettingSection} from '../..';\r\nimport cancelEvent from '../../../../helpers/dom/cancelEvent';\r\nimport {canFocus} from '../../../../helpers/dom/canFocus';\r\nimport {attachClickEvent} from '../../../../helpers/dom/clickEvent';\r\nimport replaceContent from '../../../../helpers/dom/replaceContent';\r\nimport setInnerHTML from '../../../../helpers/dom/setInnerHTML';\r\nimport {AccountPassword} from '../../../../layer';\r\nimport I18n, {i18n} from '../../../../lib/langPack';\r\nimport wrapEmojiText from '../../../../lib/richTextProcessor/wrapEmojiText';\r\nimport Button from '../../../button';\r\nimport {putPreloader} from '../../../putPreloader';\r\nimport PasswordMonkey from '../../../monkeys/password';\r\nimport PasswordInputField from '../../../passwordInputField';\r\nimport {SliderSuperTab} from '../../../slider';\r\nimport AppTwoStepVerificationReEnterPasswordTab from './reEnterPassword';\r\n\r\nexport default class AppTwoStepVerificationEnterPasswordTab extends SliderSuperTab {\r\n  public state: AccountPassword;\r\n  public passwordInputField: PasswordInputField;\r\n  public plainPassword: string;\r\n  public isFirst = true;\r\n\r\n  protected init() {\r\n    const isNew = !this.state.pFlags.has_password || this.plainPassword;\r\n    this.container.classList.add('two-step-verification', 'two-step-verification-enter-password');\r\n    this.setTitle(isNew ? 'PleaseEnterFirstPassword' : 'PleaseEnterCurrentPassword');\r\n\r\n    const section = new SettingSection({\r\n      noDelimiter: true\r\n    });\r\n\r\n    const inputWrapper = document.createElement('div');\r\n    inputWrapper.classList.add('input-wrapper');\r\n\r\n    const passwordInputField = this.passwordInputField = new PasswordInputField({\r\n      name: 'enter-password',\r\n      label: isNew ? 'PleaseEnterFirstPassword' : (this.state.hint ? undefined : 'LoginPassword'),\r\n      labelText: !isNew && this.state.hint ? wrapEmojiText(this.state.hint) : undefined\r\n    });\r\n\r\n    const monkey = new PasswordMonkey(passwordInputField, 157);\r\n\r\n    const btnContinue = Button('btn-primary btn-color-primary');\r\n    const textEl = new I18n.IntlElement({key: 'Continue'});\r\n\r\n    btnContinue.append(textEl.element);\r\n\r\n    inputWrapper.append(passwordInputField.container, btnContinue);\r\n    section.content.append(monkey.container, inputWrapper);\r\n\r\n    this.scrollable.container.append(section.container);\r\n\r\n    passwordInputField.input.addEventListener('keypress', (e) => {\r\n      if(passwordInputField.input.classList.contains('error')) {\r\n        passwordInputField.input.classList.remove('error');\r\n        textEl.key = 'Continue';\r\n        textEl.update();\r\n      }\r\n\r\n      if(e.key === 'Enter') {\r\n        return onContinueClick();\r\n      }\r\n    });\r\n\r\n    const verifyInput = () => {\r\n      if(!passwordInputField.value.length) {\r\n        passwordInputField.input.classList.add('error');\r\n        return false;\r\n      }\r\n\r\n      return true;\r\n    };\r\n\r\n    let onContinueClick: (e?: Event) => void;\r\n    if(!isNew) {\r\n      let getStateInterval: number;\r\n\r\n      const getState = () => {\r\n        // * just to check session relevance\r\n        if(!getStateInterval) {\r\n          getStateInterval = window.setInterval(getState, 10e3);\r\n        }\r\n\r\n        return this.managers.passwordManager.getState().then((_state) => {\r\n          this.state = _state;\r\n\r\n          if(this.state.hint) {\r\n            setInnerHTML(passwordInputField.label, wrapEmojiText(this.state.hint));\r\n          } else {\r\n            replaceContent(passwordInputField.label, i18n('LoginPassword'));\r\n          }\r\n        });\r\n      };\r\n\r\n      const submit = (e?: Event) => {\r\n        if(!verifyInput()) {\r\n          cancelEvent(e);\r\n          return;\r\n        }\r\n\r\n        btnContinue.setAttribute('disabled', 'true');\r\n        textEl.key = 'PleaseWait';\r\n        textEl.update();\r\n        const preloader = putPreloader(btnContinue);\r\n\r\n        const plainPassword = passwordInputField.value;\r\n        this.managers.passwordManager.check(passwordInputField.value, this.state).then((auth) => {\r\n          console.log(auth);\r\n\r\n          if(auth._ === 'auth.authorization') {\r\n            clearInterval(getStateInterval);\r\n            if(monkey) monkey.remove();\r\n            const tab = this.slider.createTab(AppTwoStepVerificationTab);\r\n            tab.state = this.state;\r\n            tab.plainPassword = plainPassword;\r\n            tab.open();\r\n            this.slider.removeTabFromHistory(this);\r\n          }\r\n        }, (err) => {\r\n          btnContinue.removeAttribute('disabled');\r\n          passwordInputField.input.classList.add('error');\r\n\r\n          switch(err.type) {\r\n            default:\r\n              // btnContinue.innerText = err.type;\r\n              textEl.key = 'PASSWORD_HASH_INVALID';\r\n              textEl.update();\r\n              preloader.remove();\r\n              passwordInputField.select();\r\n              break;\r\n          }\r\n\r\n          getState();\r\n        });\r\n      };\r\n\r\n      onContinueClick = submit;\r\n\r\n      getState();\r\n    } else {\r\n      onContinueClick = (e) => {\r\n        if(e) {\r\n          cancelEvent(e);\r\n        }\r\n\r\n        if(!verifyInput()) return;\r\n\r\n        const tab = this.slider.createTab(AppTwoStepVerificationReEnterPasswordTab);\r\n        tab.state = this.state;\r\n        tab.newPassword = passwordInputField.value;\r\n        tab.plainPassword = this.plainPassword;\r\n        tab.open();\r\n      };\r\n    }\r\n\r\n    attachClickEvent(btnContinue, onContinueClick);\r\n\r\n    return monkey.load();\r\n  }\r\n\r\n  onOpenAfterTimeout() {\r\n    if(!canFocus(this.isFirst)) return;\r\n    this.passwordInputField.input.focus();\r\n  }\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport {SettingSection} from '../..';\r\nimport {attachClickEvent} from '../../../../helpers/dom/clickEvent';\r\nimport {AccountPassword} from '../../../../layer';\r\nimport {_i18n} from '../../../../lib/langPack';\r\nimport Button from '../../../button';\r\nimport PopupPeer from '../../../popups/peer';\r\nimport {SliderSuperTab} from '../../../slider';\r\nimport wrapStickerEmoji from '../../../wrappers/stickerEmoji';\r\nimport AppSettingsTab from '../settings';\r\nimport AppTwoStepVerificationEmailTab from './email';\r\nimport AppTwoStepVerificationEnterPasswordTab from './enterPassword';\r\n\r\nexport default class AppTwoStepVerificationTab extends SliderSuperTab {\r\n  public state: AccountPassword;\r\n  public plainPassword: string;\r\n\r\n  protected init() {\r\n    this.container.classList.add('two-step-verification', 'two-step-verification-main');\r\n    this.setTitle('TwoStepVerificationTitle');\r\n\r\n    const section = new SettingSection({\r\n      captionOld: true,\r\n      noDelimiter: true\r\n    });\r\n\r\n    const emoji = '';\r\n    const stickerContainer = document.createElement('div');\r\n\r\n    wrapStickerEmoji({\r\n      div: stickerContainer,\r\n      width: 168,\r\n      height: 168,\r\n      emoji\r\n    });\r\n\r\n    section.content.append(stickerContainer);\r\n\r\n    const c = section.generateContentElement();\r\n    if(this.state.pFlags.has_password) {\r\n      _i18n(section.caption, 'TwoStepAuth.GenericHelp');\r\n\r\n      const btnChangePassword = Button('btn-primary btn-transparent', {icon: 'edit', text: 'TwoStepAuth.ChangePassword'});\r\n      const btnDisablePassword = Button('btn-primary btn-transparent', {icon: 'passwordoff', text: 'TwoStepAuth.RemovePassword'});\r\n      const btnSetRecoveryEmail = Button('btn-primary btn-transparent', {icon: 'email', text: this.state.pFlags.has_recovery ? 'TwoStepAuth.ChangeEmail' : 'TwoStepAuth.SetupEmail'});\r\n\r\n      attachClickEvent(btnChangePassword, () => {\r\n        const tab = this.slider.createTab(AppTwoStepVerificationEnterPasswordTab);\r\n        tab.state = this.state;\r\n        tab.plainPassword = this.plainPassword;\r\n        tab.open();\r\n      });\r\n\r\n      attachClickEvent(btnDisablePassword, () => {\r\n        const popup = new PopupPeer('popup-disable-password', {\r\n          buttons: [{\r\n            langKey: 'Disable',\r\n            callback: () => {\r\n              this.managers.passwordManager.updateSettings({currentPassword: this.plainPassword}).then(() => {\r\n                this.slider.sliceTabsUntilTab(AppSettingsTab, this);\r\n                this.close();\r\n              });\r\n            },\r\n            isDanger: true\r\n          }],\r\n          titleLangKey: 'TurnPasswordOffQuestionTitle',\r\n          descriptionLangKey: 'TurnPasswordOffQuestion'\r\n        });\r\n\r\n        popup.show();\r\n      });\r\n\r\n      attachClickEvent(btnSetRecoveryEmail, () => {\r\n        const tab = this.slider.createTab(AppTwoStepVerificationEmailTab);\r\n        tab.state = this.state;\r\n        tab.hint = this.state.hint;\r\n        tab.plainPassword = this.plainPassword;\r\n        tab.newPassword = this.plainPassword;\r\n        tab.isFirst = true;\r\n        tab.open();\r\n      });\r\n\r\n      c.append(btnChangePassword, btnDisablePassword, btnSetRecoveryEmail);\r\n    } else {\r\n      _i18n(section.caption, 'TwoStepAuth.SetPasswordHelp');\r\n\r\n      const inputWrapper = document.createElement('div');\r\n      inputWrapper.classList.add('input-wrapper');\r\n\r\n      const btnSetPassword = Button('btn-primary btn-color-primary', {text: 'TwoStepVerificationSetPassword'});\r\n\r\n      inputWrapper.append(btnSetPassword);\r\n      c.append(inputWrapper);\r\n\r\n      attachClickEvent(btnSetPassword, (e) => {\r\n        const tab = this.slider.createTab(AppTwoStepVerificationEnterPasswordTab);\r\n        tab.state = this.state;\r\n        tab.open();\r\n      });\r\n    }\r\n\r\n    this.scrollable.container.append(section.container);\r\n  }\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport {SliderSuperTabEventable} from '../../../sliderTab';\r\nimport PrivacySection from '../../../privacySection';\r\nimport {LangPackKey} from '../../../../lib/langPack';\r\n\r\nexport default class AppPrivacyLastSeenTab extends SliderSuperTabEventable {\r\n  protected init() {\r\n    this.header.classList.add('with-border');\r\n    this.container.classList.add('privacy-tab', 'privacy-last-seen');\r\n    this.setTitle('PrivacyLastSeen');\r\n\r\n    const caption: LangPackKey = 'PrivacySettingsController.LastSeenDescription';\r\n    new PrivacySection({\r\n      tab: this,\r\n      title: 'LastSeenTitle',\r\n      inputKey: 'inputPrivacyKeyStatusTimestamp',\r\n      captions: [caption, caption, caption],\r\n      exceptionTexts: ['PrivacySettingsController.NeverShare', 'PrivacySettingsController.AlwaysShare'],\r\n      appendTo: this.scrollable,\r\n      managers: this.managers\r\n    });\r\n  }\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport {SliderSuperTabEventable} from '../../../sliderTab';\r\nimport PrivacySection from '../../../privacySection';\r\nimport {LangPackKey} from '../../../../lib/langPack';\r\nimport PrivacyType from '../../../../lib/appManagers/utils/privacy/privacyType';\r\n\r\nexport default class AppPrivacyProfilePhotoTab extends SliderSuperTabEventable {\r\n  protected init() {\r\n    this.header.classList.add('with-border');\r\n    this.container.classList.add('privacy-tab', 'privacy-profile-photo');\r\n    this.setTitle('PrivacyProfilePhoto');\r\n\r\n    const caption: LangPackKey = 'PrivacySettingsController.ProfilePhoto.CustomHelp';\r\n    new PrivacySection({\r\n      tab: this,\r\n      title: 'PrivacyProfilePhotoTitle',\r\n      inputKey: 'inputPrivacyKeyProfilePhoto',\r\n      captions: [caption, caption, caption],\r\n      exceptionTexts: ['PrivacySettingsController.NeverShare', 'PrivacySettingsController.AlwaysShare'],\r\n      appendTo: this.scrollable,\r\n      skipTypes: [PrivacyType.Nobody],\r\n      managers: this.managers\r\n    });\r\n  }\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport {SliderSuperTabEventable} from '../../../sliderTab';\r\nimport PrivacySection from '../../../privacySection';\r\nimport {LangPackKey} from '../../../../lib/langPack';\r\n\r\nexport default class AppPrivacyForwardMessagesTab extends SliderSuperTabEventable {\r\n  protected init() {\r\n    this.header.classList.add('with-border');\r\n    this.container.classList.add('privacy-tab', 'privacy-forward-messages');\r\n    this.setTitle('PrivacySettings.Forwards');\r\n\r\n    const caption: LangPackKey = 'PrivacySettingsController.Forwards.CustomHelp';\r\n    new PrivacySection({\r\n      tab: this,\r\n      title: 'PrivacyForwardsTitle',\r\n      inputKey: 'inputPrivacyKeyForwards',\r\n      captions: [caption, caption, caption],\r\n      exceptionTexts: ['PrivacySettingsController.NeverAllow', 'PrivacySettingsController.AlwaysAllow'],\r\n      appendTo: this.scrollable,\r\n      managers: this.managers\r\n    });\r\n  }\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport {SliderSuperTabEventable} from '../../../sliderTab';\r\nimport PrivacySection from '../../../privacySection';\r\nimport {LangPackKey} from '../../../../lib/langPack';\r\nimport PrivacyType from '../../../../lib/appManagers/utils/privacy/privacyType';\r\n\r\nexport default class AppPrivacyAddToGroupsTab extends SliderSuperTabEventable {\r\n  protected init() {\r\n    this.header.classList.add('with-border');\r\n    this.container.classList.add('privacy-tab', 'privacy-add-to-groups');\r\n    this.setTitle('PrivacySettings.Groups');\r\n\r\n    const caption: LangPackKey = 'PrivacySettingsController.GroupDescription';\r\n    new PrivacySection({\r\n      tab: this,\r\n      title: 'WhoCanAddMe',\r\n      inputKey: 'inputPrivacyKeyChatInvite',\r\n      captions: [caption, caption, caption],\r\n      exceptionTexts: ['PrivacySettingsController.NeverAllow', 'PrivacySettingsController.AlwaysAllow'],\r\n      appendTo: this.scrollable,\r\n      skipTypes: [PrivacyType.Nobody],\r\n      managers: this.managers\r\n    });\r\n  }\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport {SliderSuperTabEventable} from '../../../sliderTab';\r\nimport PrivacySection from '../../../privacySection';\r\nimport {LangPackKey} from '../../../../lib/langPack';\r\n\r\nexport default class AppPrivacyCallsTab extends SliderSuperTabEventable {\r\n  protected init() {\r\n    this.header.classList.add('with-border');\r\n    this.container.classList.add('privacy-tab', 'privacy-calls');\r\n    this.setTitle('PrivacySettings.VoiceCalls');\r\n\r\n    const caption: LangPackKey = 'PrivacySettingsController.PhoneCallDescription';\r\n    new PrivacySection({\r\n      tab: this,\r\n      title: 'WhoCanCallMe',\r\n      inputKey: 'inputPrivacyKeyPhoneCall',\r\n      captions: [caption, caption, caption],\r\n      exceptionTexts: ['PrivacySettingsController.NeverAllow', 'PrivacySettingsController.AlwaysAllow'],\r\n      appendTo: this.scrollable,\r\n      managers: this.managers\r\n    });\r\n\r\n    {\r\n      const caption: LangPackKey = 'PrivacySettingsController.P2p.Desc';\r\n      new PrivacySection({\r\n        tab: this,\r\n        title: 'PrivacyP2PHeader',\r\n        inputKey: 'inputPrivacyKeyPhoneP2P',\r\n        captions: [caption, caption, caption],\r\n        exceptionTexts: ['PrivacySettingsController.NeverAllow', 'PrivacySettingsController.AlwaysAllow'],\r\n        appendTo: this.scrollable,\r\n        managers: this.managers\r\n      });\r\n    }\r\n  }\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport {SettingSection} from '..';\r\nimport Button from '../../button';\r\nimport Row from '../../row';\r\nimport {Authorization} from '../../../layer';\r\nimport {formatDateAccordingToTodayNew} from '../../../helpers/date';\r\nimport ButtonMenu from '../../buttonMenu';\r\nimport {toast} from '../../toast';\r\nimport I18n from '../../../lib/langPack';\r\nimport PopupPeer from '../../popups/peer';\r\nimport findUpClassName from '../../../helpers/dom/findUpClassName';\r\nimport {attachClickEvent} from '../../../helpers/dom/clickEvent';\r\nimport toggleDisability from '../../../helpers/dom/toggleDisability';\r\nimport {SliderSuperTabEventable} from '../../sliderTab';\r\nimport findAndSplice from '../../../helpers/array/findAndSplice';\r\nimport {attachContextMenuListener} from '../../../helpers/dom/attachContextMenuListener';\r\nimport positionMenu from '../../../helpers/positionMenu';\r\nimport contextMenuController from '../../../helpers/contextMenuController';\r\n\r\nexport default class AppActiveSessionsTab extends SliderSuperTabEventable {\r\n  public authorizations: Authorization.authorization[];\r\n  private menuElement: HTMLElement;\r\n\r\n  protected init() {\r\n    this.header.classList.add('with-border');\r\n    this.container.classList.add('active-sessions-container');\r\n    this.setTitle('SessionsTitle');\r\n\r\n    const Session = (auth: Authorization.authorization) => {\r\n      const row = new Row({\r\n        title: [auth.app_name, auth.app_version].join(' '),\r\n        subtitle: [auth.ip, auth.country].join(' - '),\r\n        clickable: true,\r\n        titleRight: auth.pFlags.current ? undefined : formatDateAccordingToTodayNew(new Date(Math.max(auth.date_active, auth.date_created) * 1000))\r\n      });\r\n\r\n      row.container.dataset.hash = '' + auth.hash;\r\n\r\n      const midtitle = document.createElement('div');\r\n      midtitle.classList.add('row-midtitle');\r\n      midtitle.innerHTML = [auth.device_model, auth.system_version || auth.platform].filter(Boolean).join(', ');\r\n\r\n      row.subtitle.parentElement.insertBefore(midtitle, row.subtitle);\r\n\r\n      return row;\r\n    };\r\n\r\n    const authorizations = this.authorizations.slice();\r\n\r\n    {\r\n      const section = new SettingSection({\r\n        name: 'CurrentSession',\r\n        caption: 'ClearOtherSessionsHelp'\r\n      });\r\n\r\n      const auth = findAndSplice(authorizations, auth => auth.pFlags.current);\r\n      const session = Session(auth);\r\n\r\n      section.content.append(session.container);\r\n\r\n      if(authorizations.length) {\r\n        const btnTerminate = Button('btn-primary btn-transparent danger', {icon: 'stop', text: 'TerminateAllSessions'});\r\n        attachClickEvent(btnTerminate, (e) => {\r\n          new PopupPeer('revoke-session', {\r\n            buttons: [{\r\n              langKey: 'Terminate',\r\n              isDanger: true,\r\n              callback: () => {\r\n                const toggle = toggleDisability([btnTerminate], true);\r\n                this.managers.apiManager.invokeApi('auth.resetAuthorizations').then((value) => {\r\n                  // toggleDisability([btnTerminate], false);\r\n                  btnTerminate.remove();\r\n                  otherSection.container.remove();\r\n                }, onError).finally(() => {\r\n                  toggle();\r\n                });\r\n              }\r\n            }],\r\n            titleLangKey: 'AreYouSureSessionsTitle',\r\n            descriptionLangKey: 'AreYouSureSessions'\r\n          }).show();\r\n        });\r\n\r\n        section.content.append(btnTerminate);\r\n      }\r\n\r\n      this.scrollable.append(section.container);\r\n    }\r\n\r\n    if(!authorizations.length) {\r\n      return;\r\n    }\r\n\r\n    const otherSection = new SettingSection({\r\n      name: 'OtherSessions',\r\n      caption: 'SessionsListInfo'\r\n    });\r\n\r\n    authorizations.forEach((auth) => {\r\n      otherSection.content.append(Session(auth).container);\r\n    });\r\n\r\n    this.scrollable.append(otherSection.container);\r\n\r\n    const onError = (err: any) => {\r\n      if(err.type === 'FRESH_RESET_AUTHORISATION_FORBIDDEN') {\r\n        toast(I18n.format('RecentSessions.Error.FreshReset', true));\r\n      }\r\n    };\r\n\r\n    let target: HTMLElement;\r\n    const onTerminateClick = () => {\r\n      const hash = target.dataset.hash;\r\n\r\n      new PopupPeer('revoke-session', {\r\n        buttons: [{\r\n          langKey: 'Terminate',\r\n          isDanger: true,\r\n          callback: () => {\r\n            this.managers.apiManager.invokeApi('account.resetAuthorization', {hash})\r\n            .then((value) => {\r\n              if(value) {\r\n                target.remove();\r\n              }\r\n            }, onError);\r\n          }\r\n        }],\r\n        titleLangKey: 'AreYouSureSessionTitle',\r\n        descriptionLangKey: 'TerminateSessionText'\r\n      }).show();\r\n    };\r\n\r\n    const element = this.menuElement = ButtonMenu([{\r\n      icon: 'stop',\r\n      text: 'Terminate',\r\n      onClick: onTerminateClick\r\n    }]);\r\n    element.id = 'active-sessions-contextmenu';\r\n    element.classList.add('contextmenu');\r\n\r\n    document.getElementById('page-chats').append(element);\r\n\r\n    attachContextMenuListener(this.scrollable.container, (e) => {\r\n      target = findUpClassName(e.target, 'row');\r\n      if(!target || target.dataset.hash === '0') {\r\n        return;\r\n      }\r\n\r\n      if(e instanceof MouseEvent) e.preventDefault();\r\n      // smth\r\n      if(e instanceof MouseEvent) e.cancelBubble = true;\r\n\r\n      positionMenu(e, element);\r\n      contextMenuController.openBtnMenu(element);\r\n    });\r\n\r\n    attachClickEvent(this.scrollable.container, (e) => {\r\n      target = findUpClassName(e.target, 'row');\r\n      if(!target || target.dataset.hash === '0') {\r\n        return;\r\n      }\r\n\r\n      onTerminateClick();\r\n    });\r\n  }\r\n\r\n  onCloseAfterTimeout() {\r\n    if(this.menuElement) {\r\n      this.menuElement.remove();\r\n    }\r\n\r\n    return super.onCloseAfterTimeout();\r\n  }\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport {SliderSuperTab} from '../../slider';\r\nimport {SettingSection} from '..';\r\nimport ButtonMenu from '../../buttonMenu';\r\nimport appDialogsManager, {DIALOG_LIST_ELEMENT_TAG} from '../../../lib/appManagers/appDialogsManager';\r\nimport PopupPickUser from '../../popups/pickUser';\r\nimport rootScope from '../../../lib/rootScope';\r\nimport findUpTag from '../../../helpers/dom/findUpTag';\r\nimport ButtonCorner from '../../buttonCorner';\r\nimport {attachClickEvent} from '../../../helpers/dom/clickEvent';\r\nimport formatUserPhone from '../../wrappers/formatUserPhone';\r\nimport getUserStatusString from '../../wrappers/getUserStatusString';\r\nimport {attachContextMenuListener} from '../../../helpers/dom/attachContextMenuListener';\r\nimport positionMenu from '../../../helpers/positionMenu';\r\nimport contextMenuController from '../../../helpers/contextMenuController';\r\n\r\nexport default class AppBlockedUsersTab extends SliderSuperTab {\r\n  public peerIds: PeerId[];\r\n  private menuElement: HTMLElement;\r\n\r\n  protected init() {\r\n    this.header.classList.add('with-border');\r\n    this.container.classList.add('blocked-users-container');\r\n    this.setTitle('BlockedUsers');\r\n\r\n    const section = new SettingSection({\r\n      caption: 'BlockedUsersInfo'\r\n    });\r\n\r\n    section.caption.parentElement.prepend(section.caption);\r\n\r\n    this.scrollable.append(section.container);\r\n\r\n    const btnAdd = ButtonCorner({icon: 'add', className: 'is-visible'});\r\n    this.content.append(btnAdd);\r\n\r\n    attachClickEvent(btnAdd, (e) => {\r\n      new PopupPickUser({\r\n        peerTypes: ['contacts'],\r\n        placeholder: 'BlockModal.Search.Placeholder',\r\n        onSelect: (peerId) => {\r\n          // console.log('block', peerId);\r\n          this.managers.appUsersManager.toggleBlock(peerId, true);\r\n        }\r\n      });\r\n    }, {listenerSetter: this.listenerSetter});\r\n\r\n    const list = appDialogsManager.createChatList();\r\n    this.scrollable.container.classList.add('chatlist-container');\r\n    section.content.append(list);\r\n\r\n    const add = async(peerId: PeerId, append: boolean) => {\r\n      const {dom} = appDialogsManager.addDialogNew({\r\n        peerId: peerId,\r\n        container: list,\r\n        rippleEnabled: true,\r\n        avatarSize: 48,\r\n        append\r\n      });\r\n\r\n      const user = await this.managers.appUsersManager.getUser(peerId);\r\n      if(user.pFlags.bot) {\r\n        dom.lastMessageSpan.append('@' + user.username);\r\n      } else {\r\n        if(user.phone) dom.lastMessageSpan.innerHTML = formatUserPhone(user.phone);\r\n        else dom.lastMessageSpan.append(user.username ? '@' + user.username : getUserStatusString(user));\r\n      }\r\n\r\n      // dom.titleSpan.innerHTML = 'Raaid El Syed';\r\n      // dom.lastMessageSpan.innerHTML = '+1 234 567891';\r\n    };\r\n\r\n    for(const peerId of this.peerIds) {\r\n      add(peerId, true);\r\n    }\r\n\r\n    let target: HTMLElement;\r\n    const onUnblock = () => {\r\n      const peerId = target.dataset.peerId.toPeerId();\r\n      this.managers.appUsersManager.toggleBlock(peerId, false);\r\n    };\r\n\r\n    const element = this.menuElement = ButtonMenu([{\r\n      icon: 'lockoff',\r\n      text: 'Unblock',\r\n      onClick: onUnblock,\r\n      options: {listenerSetter: this.listenerSetter}\r\n    }]);\r\n    element.id = 'blocked-users-contextmenu';\r\n    element.classList.add('contextmenu');\r\n\r\n    document.getElementById('page-chats').append(element);\r\n\r\n    attachContextMenuListener(this.scrollable.container, (e) => {\r\n      target = findUpTag(e.target, DIALOG_LIST_ELEMENT_TAG);\r\n      if(!target) {\r\n        return;\r\n      }\r\n\r\n      if(e instanceof MouseEvent) e.preventDefault();\r\n      // smth\r\n      if(e instanceof MouseEvent) e.cancelBubble = true;\r\n\r\n      positionMenu(e, element);\r\n      contextMenuController.openBtnMenu(element);\r\n    }, this.listenerSetter);\r\n\r\n    this.listenerSetter.add(rootScope)('peer_block', (update) => {\r\n      const {peerId, blocked} = update;\r\n      const li = list.querySelector(`[data-peer-id=\"${peerId}\"]`);\r\n      if(blocked) {\r\n        if(!li) {\r\n          add(peerId, false);\r\n        }\r\n      } else {\r\n        if(li) {\r\n          li.remove();\r\n        }\r\n      }\r\n    });\r\n\r\n    const LOAD_COUNT = 50;\r\n    let loading = false;\r\n    this.scrollable.onScrolledBottom = () => {\r\n      if(loading) {\r\n        return;\r\n      }\r\n\r\n      loading = true;\r\n      this.managers.appUsersManager.getBlocked(list.childElementCount, LOAD_COUNT).then((res) => {\r\n        for(const peerId of res.peerIds) {\r\n          add(peerId, true);\r\n        }\r\n\r\n        if(res.peerIds.length < LOAD_COUNT || list.childElementCount === res.count) {\r\n          this.scrollable.onScrolledBottom = null;\r\n        }\r\n\r\n        this.scrollable.checkForTriggers();\r\n      }).finally(() => {\r\n        loading = false;\r\n      });\r\n    };\r\n  }\r\n\r\n  onOpenAfterTimeout() {\r\n    this.scrollable.onScroll();\r\n  }\r\n\r\n  onCloseAfterTimeout() {\r\n    if(this.menuElement) {\r\n      this.menuElement.remove();\r\n    }\r\n\r\n    return super.onCloseAfterTimeout();\r\n  }\r\n}\r\n","export default function convertKeyToInputKey(key: string) {\n  key = key[0].toUpperCase() + key.slice(1);\n  key = 'input' + key;\n  return key;\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport {SliderSuperTabEventable} from '../../../sliderTab';\nimport PrivacySection from '../../../privacySection';\nimport {LangPackKey} from '../../../../lib/langPack';\n\nexport default class AppPrivacyVoicesTab extends SliderSuperTabEventable {\n  protected init() {\n    this.header.classList.add('with-border');\n    this.container.classList.add('privacy-tab', 'privacy-voices');\n    this.setTitle('PrivacyVoiceMessages');\n\n    const caption: LangPackKey = 'PrivacyVoiceMessagesInfo';\n    new PrivacySection({\n      tab: this,\n      title: 'PrivacyVoiceMessagesTitle',\n      inputKey: 'inputPrivacyKeyVoiceMessages',\n      captions: [caption, caption, caption],\n      exceptionTexts: ['PrivacySettingsController.NeverAllow', 'PrivacySettingsController.AlwaysAllow'],\n      appendTo: this.scrollable,\n      managers: this.managers\n    });\n  }\n}\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport {SliderSuperTabEventable} from '../../sliderTab';\r\nimport {SettingSection} from '..';\r\nimport Row from '../../row';\r\nimport {AccountPassword, Authorization, InputPrivacyKey, Updates} from '../../../layer';\r\nimport AppPrivacyPhoneNumberTab from './privacy/phoneNumber';\r\nimport AppTwoStepVerificationTab from './2fa';\r\nimport AppTwoStepVerificationEnterPasswordTab from './2fa/enterPassword';\r\nimport AppTwoStepVerificationEmailConfirmationTab from './2fa/emailConfirmation';\r\nimport AppPrivacyLastSeenTab from './privacy/lastSeen';\r\nimport AppPrivacyProfilePhotoTab from './privacy/profilePhoto';\r\nimport AppPrivacyForwardMessagesTab from './privacy/forwardMessages';\r\nimport AppPrivacyAddToGroupsTab from './privacy/addToGroups';\r\nimport AppPrivacyCallsTab from './privacy/calls';\r\nimport AppActiveSessionsTab from './activeSessions';\r\nimport AppBlockedUsersTab from './blockedUsers';\r\nimport rootScope from '../../../lib/rootScope';\r\nimport {i18n, LangPackKey, _i18n} from '../../../lib/langPack';\r\nimport replaceContent from '../../../helpers/dom/replaceContent';\r\nimport CheckboxField from '../../checkboxField';\r\nimport PopupPeer from '../../popups/peer';\r\nimport Button from '../../button';\r\nimport toggleDisability from '../../../helpers/dom/toggleDisability';\r\nimport convertKeyToInputKey from '../../../helpers/string/convertKeyToInputKey';\r\nimport getPrivacyRulesDetails from '../../../lib/appManagers/utils/privacy/getPrivacyRulesDetails';\r\nimport PrivacyType from '../../../lib/appManagers/utils/privacy/privacyType';\r\nimport confirmationPopup, {PopupConfirmationOptions} from '../../confirmationPopup';\r\nimport noop from '../../../helpers/noop';\r\nimport {toastNew} from '../../toast';\r\nimport AppPrivacyVoicesTab from './privacy/voices';\r\n\r\nexport default class AppPrivacyAndSecurityTab extends SliderSuperTabEventable {\r\n  private activeSessionsRow: Row;\r\n  private authorizations: Authorization.authorization[];\r\n\r\n  protected init() {\r\n    this.header.classList.add('with-border');\r\n    this.container.classList.add('dont-u-dare-block-me');\r\n    this.setTitle('PrivacySettings');\r\n\r\n    const SUBTITLE: LangPackKey = 'Loading';\r\n\r\n    {\r\n      const section = new SettingSection({noDelimiter: true, caption: 'SessionsInfo'});\r\n\r\n      let blockedPeerIds: PeerId[];\r\n      const blockedUsersRow = new Row({\r\n        icon: 'deleteuser',\r\n        titleLangKey: 'BlockedUsers',\r\n        subtitleLangKey: SUBTITLE,\r\n        clickable: () => {\r\n          const tab = this.slider.createTab(AppBlockedUsersTab);\r\n          tab.peerIds = blockedPeerIds;\r\n          tab.open();\r\n        },\r\n        listenerSetter: this.listenerSetter\r\n      });\r\n      blockedUsersRow.freezed = true;\r\n\r\n      let passwordState: AccountPassword;\r\n      const twoFactorRowOptions = {\r\n        icon: 'lock',\r\n        titleLangKey: 'TwoStepVerification' as LangPackKey,\r\n        subtitleLangKey: SUBTITLE,\r\n        clickable: (e: Event) => {\r\n          let tab: AppTwoStepVerificationTab | AppTwoStepVerificationEnterPasswordTab | AppTwoStepVerificationEmailConfirmationTab;\r\n          if(passwordState.pFlags.has_password) {\r\n            tab = this.slider.createTab(AppTwoStepVerificationEnterPasswordTab);\r\n          } else if(passwordState.email_unconfirmed_pattern) {\r\n            tab = this.slider.createTab(AppTwoStepVerificationEmailConfirmationTab);\r\n            tab.email = passwordState.email_unconfirmed_pattern;\r\n            tab.length = 6;\r\n            tab.isFirst = true;\r\n            this.managers.passwordManager.resendPasswordEmail();\r\n          } else {\r\n            tab = this.slider.createTab(AppTwoStepVerificationTab);\r\n          }\r\n\r\n          tab.state = passwordState;\r\n          tab.open();\r\n        },\r\n        listenerSetter: this.listenerSetter\r\n      };\r\n\r\n      const twoFactorRow = new Row(twoFactorRowOptions);\r\n      twoFactorRow.freezed = true;\r\n\r\n      const activeSessionsRow = this.activeSessionsRow = new Row({\r\n        icon: 'activesessions',\r\n        titleLangKey: 'SessionsTitle',\r\n        subtitleLangKey: SUBTITLE,\r\n        clickable: () => {\r\n          const tab = this.slider.createTab(AppActiveSessionsTab);\r\n          tab.authorizations = this.authorizations;\r\n          tab.eventListener.addEventListener('destroy', () => {\r\n            this.updateActiveSessions();\r\n          }, {once: true});\r\n          tab.open();\r\n        },\r\n        listenerSetter: this.listenerSetter\r\n      });\r\n      activeSessionsRow.freezed = true;\r\n\r\n      section.content.append(blockedUsersRow.container, twoFactorRow.container, activeSessionsRow.container);\r\n      this.scrollable.append(section.container);\r\n\r\n      const setBlockedCount = (count: number) => {\r\n        if(count) {\r\n          replaceContent(blockedUsersRow.subtitle, i18n('PrivacySettingsController.UserCount', [count]));\r\n        } else {\r\n          replaceContent(blockedUsersRow.subtitle, i18n('BlockedEmpty', [count]));\r\n        }\r\n      };\r\n\r\n      this.listenerSetter.add(rootScope)('peer_block', () => {\r\n        /* const {blocked, peerId} = update;\r\n        if(!blocked) blockedPeerIds.findAndSplice((p) => p === peerId);\r\n        else blockedPeerIds.unshift(peerId);\r\n        blockedCount += blocked ? 1 : -1;\r\n        setBlockedCount(blockedCount); */\r\n        updateBlocked();\r\n      });\r\n\r\n      const updateBlocked = () => {\r\n        this.managers.appUsersManager.getBlocked().then((res) => {\r\n          blockedUsersRow.freezed = false;\r\n          setBlockedCount(res.count);\r\n          blockedPeerIds = res.peerIds;\r\n        });\r\n      };\r\n\r\n      updateBlocked();\r\n\r\n      this.managers.passwordManager.getState().then((state) => {\r\n        passwordState = state;\r\n        replaceContent(twoFactorRow.subtitle, i18n(state.pFlags.has_password ? 'PrivacyAndSecurity.Item.On' : 'PrivacyAndSecurity.Item.Off'));\r\n        twoFactorRow.freezed = false;\r\n\r\n        // console.log('password state', state);\r\n      });\r\n\r\n      this.updateActiveSessions();\r\n    }\r\n\r\n    {\r\n      const section = new SettingSection({name: 'PrivacyTitle', caption: 'GroupsAndChannelsHelp'});\r\n\r\n      section.content.classList.add('privacy-navigation-container');\r\n\r\n      const rowsByKeys: Partial<{\r\n        [key in InputPrivacyKey['_']]: Row\r\n      }> = {};\r\n\r\n      const numberVisibilityRow = rowsByKeys['inputPrivacyKeyPhoneNumber'] = new Row({\r\n        titleLangKey: 'PrivacyPhoneTitle',\r\n        subtitleLangKey: SUBTITLE,\r\n        clickable: () => {\r\n          this.slider.createTab(AppPrivacyPhoneNumberTab).open();\r\n        },\r\n        listenerSetter: this.listenerSetter\r\n      });\r\n\r\n      const lastSeenTimeRow = rowsByKeys['inputPrivacyKeyStatusTimestamp'] = new Row({\r\n        titleLangKey: 'LastSeenTitle',\r\n        subtitleLangKey: SUBTITLE,\r\n        clickable: () => {\r\n          this.slider.createTab(AppPrivacyLastSeenTab).open();\r\n        },\r\n        listenerSetter: this.listenerSetter\r\n      });\r\n\r\n      const photoVisibilityRow = rowsByKeys['inputPrivacyKeyProfilePhoto'] = new Row({\r\n        titleLangKey: 'PrivacyProfilePhotoTitle',\r\n        subtitleLangKey: SUBTITLE,\r\n        clickable: () => {\r\n          this.slider.createTab(AppPrivacyProfilePhotoTab).open();\r\n        },\r\n        listenerSetter: this.listenerSetter\r\n      });\r\n\r\n      const callRow = rowsByKeys['inputPrivacyKeyPhoneCall'] = new Row({\r\n        titleLangKey: 'WhoCanCallMe',\r\n        subtitleLangKey: SUBTITLE,\r\n        clickable: () => {\r\n          this.slider.createTab(AppPrivacyCallsTab).open();\r\n        },\r\n        listenerSetter: this.listenerSetter\r\n      });\r\n\r\n      const linkAccountRow = rowsByKeys['inputPrivacyKeyForwards'] = new Row({\r\n        titleLangKey: 'PrivacyForwardsTitle',\r\n        subtitleLangKey: SUBTITLE,\r\n        clickable: () => {\r\n          this.slider.createTab(AppPrivacyForwardMessagesTab).open();\r\n        },\r\n        listenerSetter: this.listenerSetter\r\n      });\r\n\r\n      const groupChatsAddRow = rowsByKeys['inputPrivacyKeyChatInvite'] = new Row({\r\n        titleLangKey: 'WhoCanAddMe',\r\n        subtitleLangKey: SUBTITLE,\r\n        clickable: () => {\r\n          this.slider.createTab(AppPrivacyAddToGroupsTab).open();\r\n        },\r\n        listenerSetter: this.listenerSetter\r\n      });\r\n\r\n      const voicesRow = rowsByKeys['inputPrivacyKeyVoiceMessages'] = new Row({\r\n        titleLangKey: 'PrivacyVoiceMessagesTitle',\r\n        subtitleLangKey: SUBTITLE,\r\n        clickable: () => {\r\n          if(!rootScope.premium) {\r\n            toastNew({langPackKey: 'PrivacyVoiceMessagesPremiumOnly'});\r\n          } else {\r\n            this.slider.createTab(AppPrivacyVoicesTab).open();\r\n          }\r\n        },\r\n        listenerSetter: this.listenerSetter\r\n      });\r\n\r\n      const updatePrivacyRow = (key: InputPrivacyKey['_']) => {\r\n        const row = rowsByKeys[key];\r\n        if(!row) {\r\n          return;\r\n        }\r\n\r\n        this.managers.appPrivacyManager.getPrivacy(key).then((rules) => {\r\n          const details = getPrivacyRulesDetails(rules);\r\n          const langKey = details.type === PrivacyType.Everybody ? 'PrivacySettingsController.Everbody' : (details.type === PrivacyType.Contacts ? 'PrivacySettingsController.MyContacts' : 'PrivacySettingsController.Nobody');\r\n          const disallowLength = details.disallowPeers.users.length + details.disallowPeers.chats.length;\r\n          const allowLength = details.allowPeers.users.length + details.allowPeers.chats.length;\r\n\r\n          row.subtitle.innerHTML = '';\r\n          const s = i18n(langKey);\r\n          row.subtitle.append(s);\r\n          if(disallowLength || allowLength) {\r\n            row.subtitle.append(` (${[-disallowLength, allowLength ? '+' + allowLength : 0].filter(Boolean).join(', ')})`);\r\n          }\r\n        });\r\n      };\r\n\r\n      section.content.append(\r\n        numberVisibilityRow.container,\r\n        lastSeenTimeRow.container,\r\n        photoVisibilityRow.container,\r\n        callRow.container,\r\n        linkAccountRow.container,\r\n        groupChatsAddRow.container,\r\n        voicesRow.container\r\n      );\r\n      this.scrollable.append(section.container);\r\n\r\n      for(const key in rowsByKeys) {\r\n        updatePrivacyRow(key as keyof typeof rowsByKeys);\r\n      }\r\n\r\n      rootScope.addEventListener('privacy_update', (update) => {\r\n        updatePrivacyRow(convertKeyToInputKey(update.key._) as any);\r\n      });\r\n    }\r\n\r\n    const promises: Promise<any>[] = [];\r\n\r\n    {\r\n      const section = new SettingSection({name: 'NewChatsFromNonContacts', caption: 'ArchiveAndMuteInfo'});\r\n\r\n      const checkboxField = new CheckboxField({text: 'ArchiveAndMute'});\r\n      const row = new Row({\r\n        checkboxField,\r\n        noCheckboxSubtitle: true\r\n      });\r\n\r\n      section.content.append(row.container);\r\n\r\n      let enabled: boolean, destroyed: boolean;\r\n      this.eventListener.addEventListener('destroy', () => {\r\n        destroyed = true;\r\n        if(enabled === undefined) return;\r\n        this.managers.appPrivacyManager.setGlobalPrivacySettings({\r\n          _: 'globalPrivacySettings',\r\n          archive_and_mute_new_noncontact_peers: checkboxField.checked\r\n        });\r\n      }, {once: true});\r\n\r\n      const promise = Promise.all([\r\n        this.managers.apiManager.getAppConfig(),\r\n        this.managers.appPrivacyManager.getGlobalPrivacySettings()\r\n      ]).then(([appConfig, settings]) => {\r\n        if(destroyed) {\r\n          return;\r\n        }\r\n\r\n        const onPremiumToggle = (isPremium: boolean) => {\r\n          section.container.classList.toggle('hide', !isPremium && !appConfig.autoarchive_setting_available);\r\n        };\r\n\r\n        this.listenerSetter.add(rootScope)('premium_toggle', onPremiumToggle);\r\n        onPremiumToggle(rootScope.premium);\r\n\r\n        enabled = settings.archive_and_mute_new_noncontact_peers;\r\n\r\n        checkboxField.setValueSilently(enabled);\r\n      });\r\n\r\n      promises.push(promise);\r\n\r\n      this.scrollable.append(section.container);\r\n    }\r\n\r\n    {\r\n      const section = new SettingSection({name: 'Privacy.SensitiveContent', caption: 'PrivacyAndSecurity.SensitiveDesc'});\r\n      section.container.classList.add('hide');\r\n\r\n      const checkboxField = new CheckboxField({text: 'PrivacyAndSecurity.SensitiveText'});\r\n      const row = new Row({\r\n        checkboxField,\r\n        noCheckboxSubtitle: true\r\n      });\r\n\r\n      section.content.append(row.container);\r\n\r\n      let enabled: boolean;\r\n      this.eventListener.addEventListener('destroy', () => {\r\n        if(enabled === undefined) return;\r\n        const _enabled = row.checkboxField.checked;\r\n        const isChanged = _enabled !== enabled;\r\n        if(!isChanged) {\r\n          return;\r\n        }\r\n\r\n        this.managers.apiManager.invokeApi('account.setContentSettings', {\r\n          sensitive_enabled: _enabled\r\n        });\r\n      }, {once: true});\r\n\r\n      const promise = this.managers.apiManager.invokeApi('account.getContentSettings').then((settings) => {\r\n        if(!settings.pFlags.sensitive_can_change) {\r\n          return;\r\n        }\r\n\r\n        enabled = settings.pFlags.sensitive_enabled;\r\n        checkboxField.setValueSilently(enabled);\r\n        section.container.classList.remove('hide');\r\n      });\r\n\r\n      promises.push(promise);\r\n\r\n      this.scrollable.append(section.container);\r\n    }\r\n\r\n    {\r\n      const section = new SettingSection({name: 'PrivacyPayments', caption: 'PrivacyPaymentsClearInfo'});\r\n\r\n      const onClearClick = () => {\r\n        const options: PopupConfirmationOptions = {\r\n          titleLangKey: 'PrivacyPaymentsClearAlertTitle',\r\n          descriptionLangKey: 'PrivacyPaymentsClearAlertText',\r\n          button: {\r\n            langKey: 'Clear'\r\n          },\r\n          checkboxes: [{\r\n            text: 'PrivacyClearShipping',\r\n            checked: true\r\n          }, {\r\n            text: 'PrivacyClearPayment',\r\n            checked: true\r\n          }]\r\n        };\r\n\r\n        confirmationPopup(options).then(() => {\r\n          const [info, payment] = options.checkboxes.map((c) => c.checkboxField.checked);\r\n          const toggle = toggleDisability([clearButton], true);\r\n          this.managers.appPaymentsManager.clearSavedInfo(info, payment).then(() => {\r\n            if(!info && !payment) {\r\n              return;\r\n            }\r\n\r\n            toggle();\r\n            toastNew({\r\n              langPackKey: info && payment ? 'PrivacyPaymentsPaymentShippingCleared' : (info ? 'PrivacyPaymentsShippingInfoCleared' : 'PrivacyPaymentsPaymentInfoCleared')\r\n            });\r\n          });\r\n        }, noop);\r\n      };\r\n\r\n      const clearButton = Button('btn-primary btn-transparent', {icon: 'delete', text: 'PrivacyPaymentsClear'});\r\n      this.listenerSetter.add(clearButton)('click', onClearClick);\r\n      section.content.append(clearButton);\r\n\r\n      this.scrollable.append(section.container);\r\n    }\r\n\r\n    {\r\n      const section = new SettingSection({name: 'FilterChats'});\r\n\r\n      const onDeleteClick = () => {\r\n        const popup = new PopupPeer('popup-delete-drafts', {\r\n          buttons: [{\r\n            langKey: 'Delete',\r\n            callback: () => {\r\n              const toggle = toggleDisability([deleteButton], true);\r\n              this.managers.appDraftsManager.clearAllDrafts().then(() => {\r\n                toggle();\r\n              });\r\n            },\r\n            isDanger: true\r\n          }],\r\n          titleLangKey: 'AreYouSureClearDraftsTitle',\r\n          descriptionLangKey: 'AreYouSureClearDrafts'\r\n        });\r\n\r\n        popup.show();\r\n      };\r\n\r\n      const deleteButton = Button('btn-primary btn-transparent', {icon: 'delete', text: 'PrivacyDeleteCloudDrafts'});\r\n      this.listenerSetter.add(deleteButton)('click', onDeleteClick);\r\n      section.content.append(deleteButton);\r\n\r\n      /* promises.push(apiManager.invokeApi('messages.getAllDrafts').then((drafts) => {\r\n        const draftsRow = new Row({\r\n          titleLangKey: 'PrivacyDeleteCloudDrafts',\r\n          subtitleLangKey: 'Drafts',\r\n          subtitleLangArgs: [(drafts as Updates.updates).updates.length],\r\n          icon: 'delete',\r\n          clickable: onDeleteClick\r\n        });\r\n\r\n        section.content.append(draftsRow.container);\r\n      })); */\r\n\r\n      this.scrollable.append(section.container);\r\n    }\r\n\r\n    return Promise.all(promises);\r\n  }\r\n\r\n  public updateActiveSessions() {\r\n    this.managers.apiManager.invokeApi('account.getAuthorizations').then((auths) => {\r\n      this.activeSessionsRow.freezed = false;\r\n      this.authorizations = auths.authorizations;\r\n      _i18n(this.activeSessionsRow.subtitle, 'Privacy.Devices', [this.authorizations.length]);\r\n      // console.log('auths', auths);\r\n    });\r\n  }\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport renderImageFromUrl from './dom/renderImageFromUrl';\r\n\r\nexport function averageColorFromCanvas(canvas: HTMLCanvasElement) {\r\n  const context = canvas.getContext('2d');\r\n\r\n  const pixel = new Array(4).fill(0);\r\n  const pixels = context.getImageData(0, 0, canvas.width, canvas.height).data;\r\n  const pixelsLength = pixels.length / 4;\r\n  for(let i = 0; i < pixels.length; i += 4) {\r\n    // const alphaPixel = pixels[i + 3];\r\n    pixel[0] += pixels[i]/*  * (alphaPixel / 255) */;\r\n    pixel[1] += pixels[i + 1]/*  * (alphaPixel / 255) */;\r\n    pixel[2] += pixels[i + 2]/*  * (alphaPixel / 255) */;\r\n    pixel[3] += pixels[i + 3];\r\n  }\r\n\r\n  const outPixel = new Uint8ClampedArray(4);\r\n  outPixel[0] = pixel[0] / pixelsLength;\r\n  outPixel[1] = pixel[1] / pixelsLength;\r\n  outPixel[2] = pixel[2] / pixelsLength;\r\n  outPixel[3] = pixel[3] / pixelsLength;\r\n  // outPixel[3] = 255;\r\n  return outPixel;\r\n}\r\n\r\nexport function averageColorFromImageSource(imageSource: CanvasImageSource, width: number, height: number) {\r\n  const canvas = document.createElement('canvas');\r\n  const ratio = width / height;\r\n  const DIMENSIONS = 50;\r\n  if(ratio === 1) {\r\n    canvas.width = DIMENSIONS;\r\n    canvas.height = canvas.width / ratio;\r\n  } else if(ratio > 1) {\r\n    canvas.height = DIMENSIONS;\r\n    canvas.width = canvas.height / ratio;\r\n  } else {\r\n    canvas.width = canvas.height = DIMENSIONS;\r\n  }\r\n\r\n  const context = canvas.getContext('2d');\r\n  context.drawImage(imageSource, 0, 0, width, height, 0, 0, canvas.width, canvas.height);\r\n  return averageColorFromCanvas(canvas);\r\n}\r\n\r\nexport function averageColor(imageUrl: string) {\r\n  const img = document.createElement('img');\r\n  return new Promise<Uint8ClampedArray>((resolve) => {\r\n    renderImageFromUrl(img, imageUrl, () => {\r\n      resolve(averageColorFromImageSource(img, img.naturalWidth, img.naturalHeight));\r\n    });\r\n  });\r\n};\r\n","import {rgbaToHsla} from './color';\r\n\r\n// * https://github.com/TelegramMessenger/Telegram-iOS/blob/3d062fff78cc6b287c74e6171f855a3500c0156d/submodules/TelegramPresentationData/Sources/PresentationData.swift#L453\r\nexport default function highlightningColor(rgba: [number, number, number, number?]) {\r\n  let {h, s, l} = rgbaToHsla(rgba[0], rgba[1], rgba[2]);\r\n  if(s > 0) {\r\n    s = Math.min(100, s + 5 + 0.1 * (100 - s));\r\n  }\r\n  l = Math.max(0, l * .65);\r\n\r\n  const hsla = `hsla(${h}, ${s}%, ${l}%, .4)`;\r\n  return hsla;\r\n}\r\n","import {ColorHsla, ColorRgba, hexaToHsla, hslaToRgba, rgbaToHexa as rgbaToHexa, rgbaToHsla} from '../helpers/color';\r\nimport attachGrabListeners from '../helpers/dom/attachGrabListeners';\r\nimport clamp from '../helpers/number/clamp';\r\nimport InputField, {InputState} from './inputField';\r\n\r\nexport type ColorPickerColor = {\r\n  hsl: string;\r\n  rgb: string;\r\n  hex: string;\r\n  hsla: string;\r\n  rgba: string;\r\n  hexa: string;\r\n  rgbaArray: ColorRgba;\r\n};\r\n\r\nexport default class ColorPicker {\r\n  private static BASE_CLASS = 'color-picker';\r\n  public container: HTMLElement;\r\n\r\n  private boxRect: DOMRect;\r\n  // private boxDraggerRect: DOMRect;\r\n  private hueRect: DOMRect;\r\n  // private hueDraggerRect: DOMRect;\r\n\r\n  private hue = 0;\r\n  private saturation = 100;\r\n  private lightness = 50;\r\n  private alpha = 1;\r\n  private elements: {\r\n    box: SVGSVGElement,\r\n    boxDragger: SVGSVGElement,\r\n    sliders: HTMLElement,\r\n    hue: SVGSVGElement,\r\n    hueDragger: SVGSVGElement,\r\n    saturation: SVGLinearGradientElement,\r\n  } = {} as any;\r\n  private hexInputField: InputField;\r\n  private rgbInputField: InputField;\r\n  public onChange: (color: ReturnType<ColorPicker['getCurrentColor']>) => void;\r\n\r\n  constructor() {\r\n    this.container = document.createElement('div');\r\n    this.container.classList.add(ColorPicker.BASE_CLASS);\r\n\r\n    const html = `\r\n      <svg class=\"${ColorPicker.BASE_CLASS + '-box'}\" viewBox=\"0 0 380 198\">\r\n        <defs>\r\n          <linearGradient id=\"color-picker-saturation\" x1=\"0%\" y1=\"0%\" x2=\"100%\" y2=\"0%\">\r\n            <stop offset=\"0%\" stop-color=\"#fff\"></stop>\r\n            <stop offset=\"100%\" stop-color=\"hsl(0,100%,50%)\"></stop>\r\n          </linearGradient>\r\n          <linearGradient id=\"color-picker-brightness\" x1=\"0%\" y1=\"0%\" x2=\"0%\" y2=\"100%\">\r\n            <stop offset=\"0%\" stop-color=\"rgba(0,0,0,0)\"></stop>\r\n            <stop offset=\"100%\" stop-color=\"#000\"></stop>\r\n          </linearGradient>\r\n          <pattern id=\"color-picker-pattern\" width=\"100%\" height=\"100%\">\r\n            <rect x=\"0\" y=\"0\" width=\"100%\" height=\"100%\" fill=\"url(#color-picker-saturation)\"></rect>\r\n            <rect x=\"0\" y=\"0\" width=\"100%\" height=\"100%\" fill=\"url(#color-picker-brightness)\"></rect>\r\n          </pattern>\r\n        </defs>\r\n        <rect rx=\"10\" ry=\"10\" x=\"0\" y=\"0\" width=\"380\" height=\"198\" fill=\"url(#color-picker-pattern)\"></rect>\r\n        <svg class=\"${ColorPicker.BASE_CLASS + '-dragger'} ${ColorPicker.BASE_CLASS + '-box-dragger'}\" x=\"0\" y=\"0\">\r\n          <circle r=\"11\" fill=\"inherit\" stroke=\"#fff\" stroke-width=\"2\"></circle>\r\n        </svg>\r\n      </svg>\r\n      <div class=\"${ColorPicker.BASE_CLASS + '-sliders'}\">\r\n        <svg class=\"${ColorPicker.BASE_CLASS + '-color-slider'}\" viewBox=\"0 0 380 24\">\r\n          <defs>\r\n            <linearGradient id=\"hue\" x1=\"100%\" y1=\"0%\" x2=\"0%\" y2=\"0%\">\r\n              <stop offset=\"0%\" stop-color=\"#f00\"></stop>\r\n              <stop offset=\"16.666%\" stop-color=\"#f0f\"></stop>\r\n              <stop offset=\"33.333%\" stop-color=\"#00f\"></stop>\r\n              <stop offset=\"50%\" stop-color=\"#0ff\"></stop>\r\n              <stop offset=\"66.666%\" stop-color=\"#0f0\"></stop>\r\n              <stop offset=\"83.333%\" stop-color=\"#ff0\"></stop>\r\n              <stop offset=\"100%\" stop-color=\"#f00\"></stop>\r\n            </linearGradient>\r\n          </defs>\r\n          <rect rx=\"4\" ry=\"4\" x=\"0\" y=\"9\" width=\"380\" height=\"8\" fill=\"url(#hue)\"></rect>\r\n          <svg class=\"${ColorPicker.BASE_CLASS + '-dragger'} ${ColorPicker.BASE_CLASS + '-color-slider-dragger'}\" x=\"0\" y=\"13\">\r\n            <circle r=\"11\" fill=\"inherit\" stroke=\"#fff\" stroke-width=\"2\"></circle>\r\n          </svg>\r\n        </svg>\r\n      </div>\r\n    `;\r\n\r\n    this.container.innerHTML = html;\r\n\r\n    this.elements.box = this.container.firstElementChild as any;\r\n    this.elements.boxDragger = this.elements.box.lastElementChild as any;\r\n    this.elements.saturation = this.elements.box.firstElementChild.firstElementChild as any;\r\n\r\n    this.elements.sliders = this.elements.box.nextElementSibling as any;\r\n\r\n    this.elements.hue = this.elements.sliders.firstElementChild as any;\r\n    this.elements.hueDragger = this.elements.hue.lastElementChild as any;\r\n\r\n    this.hexInputField = new InputField({plainText: true, label: 'Appearance.Color.Hex'});\r\n    this.rgbInputField = new InputField({plainText: true, label: 'Appearance.Color.RGB'});\r\n\r\n    const inputs = document.createElement('div');\r\n    inputs.className = ColorPicker.BASE_CLASS + '-inputs';\r\n    inputs.append(this.hexInputField.container, this.rgbInputField.container);\r\n    this.container.append(inputs);\r\n\r\n    this.hexInputField.input.addEventListener('input', () => {\r\n      let value = this.hexInputField.value.replace(/#/g, '').slice(0, 6);\r\n\r\n      const match = value.match(/([a-fA-F\\d]+)/);\r\n      const valid = match && match[0].length === value.length && [/* 3, 4,  */6].includes(value.length);\r\n      this.hexInputField.setState(valid ? InputState.Neutral : InputState.Error);\r\n\r\n      value = '#' + value;\r\n      this.hexInputField.setValueSilently(value);\r\n\r\n      if(valid) {\r\n        this.setColor(value, false, true);\r\n      }\r\n    });\r\n\r\n    // patched https://stackoverflow.com/a/34029238/6758968\r\n    const rgbRegExp = /^(?:rgb)?\\(?([01]?\\d\\d?|2[0-4]\\d|25[0-5])(?:\\W+)([01]?\\d\\d?|2[0-4]\\d|25[0-5])\\W+(?:([01]?\\d\\d?|2[0-4]\\d|25[0-5])\\)?)$/;\r\n    this.rgbInputField.input.addEventListener('input', () => {\r\n      const match = this.rgbInputField.value.match(rgbRegExp);\r\n      this.rgbInputField.setState(match ? InputState.Neutral : InputState.Error);\r\n\r\n      if(match) {\r\n        this.setColor(rgbaToHsla(+match[1], +match[2], +match[3]), true, false);\r\n      }\r\n    });\r\n\r\n    this.attachBoxListeners();\r\n    this.attachHueListeners();\r\n  }\r\n\r\n  private onGrabStart = () => {\r\n    document.documentElement.style.cursor = this.elements.boxDragger.style.cursor = 'grabbing';\r\n  };\r\n\r\n  private onGrabEnd = () => {\r\n    document.documentElement.style.cursor = this.elements.boxDragger.style.cursor = '';\r\n  };\r\n\r\n  private attachBoxListeners() {\r\n    attachGrabListeners(this.elements.box as any, () => {\r\n      this.onGrabStart();\r\n      this.boxRect = this.elements.box.getBoundingClientRect();\r\n      // this.boxDraggerRect = this.elements.boxDragger.getBoundingClientRect();\r\n    }, (pos) => {\r\n      this.saturationHandler(pos.x, pos.y);\r\n    }, () => {\r\n      this.onGrabEnd();\r\n    });\r\n  }\r\n\r\n  private attachHueListeners() {\r\n    attachGrabListeners(this.elements.hue as any, () => {\r\n      this.onGrabStart();\r\n      this.hueRect = this.elements.hue.getBoundingClientRect();\r\n      // this.hueDraggerRect = this.elements.hueDragger.getBoundingClientRect();\r\n    }, (pos) => {\r\n      this.hueHandler(pos.x);\r\n    }, () => {\r\n      this.onGrabEnd();\r\n    });\r\n  }\r\n\r\n  public setColor(color: ColorHsla | string, updateHexInput = true, updateRgbInput = true) {\r\n    if(color === undefined) { // * set to red\r\n      color = {\r\n        h: 0,\r\n        s: 100,\r\n        l: 50,\r\n        a: 1\r\n      };\r\n    } else if(typeof(color) === 'string') {\r\n      if(color[0] === '#') {\r\n        color = hexaToHsla(color);\r\n      } else {\r\n        const rgb = color.match(/[.?\\d]+/g);\r\n        color = rgbaToHsla(+rgb[0], +rgb[1], +rgb[2], rgb[3] === undefined ? 1 : +rgb[3]);\r\n      }\r\n    }\r\n\r\n    // Set box\r\n    this.boxRect = this.elements.box.getBoundingClientRect();\r\n\r\n    const boxX = this.boxRect.width / 100 * color.s;\r\n    const percentY = 100 - (color.l / (100 - color.s / 2)) * 100;\r\n    const boxY = this.boxRect.height / 100 * percentY;\r\n\r\n    this.saturationHandler(this.boxRect.left + boxX, this.boxRect.top + boxY, false);\r\n\r\n    // Set hue\r\n    this.hueRect = this.elements.hue.getBoundingClientRect();\r\n\r\n    const percentHue = color.h / 360;\r\n    const hueX = this.hueRect.left + this.hueRect.width * percentHue;\r\n\r\n    this.hueHandler(hueX, false);\r\n\r\n    // Set values\r\n    this.hue = color.h;\r\n    this.saturation = color.s;\r\n    this.lightness = color.l;\r\n    this.alpha = color.a;\r\n\r\n    this.updatePicker(updateHexInput, updateRgbInput);\r\n  };\r\n\r\n  public getCurrentColor(): ColorPickerColor {\r\n    const rgbaArray = hslaToRgba(this.hue, this.saturation, this.lightness, this.alpha);\r\n    const hexa = rgbaToHexa(rgbaArray);\r\n    const hex = hexa.slice(0, -2);\r\n\r\n    return {\r\n      hsl: `hsl(${this.hue}, ${this.saturation}%, ${this.lightness}%)`,\r\n      rgb: `rgb(${rgbaArray[0]}, ${rgbaArray[1]}, ${rgbaArray[2]})`,\r\n      hex: hex,\r\n      hsla: `hsla(${this.hue}, ${this.saturation}%, ${this.lightness}%, ${this.alpha})`,\r\n      rgba: `rgba(${rgbaArray[0]}, ${rgbaArray[1]}, ${rgbaArray[2]}, ${rgbaArray[3]})`,\r\n      hexa: hexa,\r\n      rgbaArray: rgbaArray\r\n    };\r\n  }\r\n\r\n  public updatePicker(updateHexInput = true, updateRgbInput = true) {\r\n    const color = this.getCurrentColor();\r\n    this.elements.boxDragger.setAttributeNS(null, 'fill', color.hex);\r\n\r\n    if(updateHexInput) {\r\n      this.hexInputField.setValueSilently(color.hex);\r\n      this.hexInputField.setState(InputState.Neutral);\r\n    }\r\n\r\n    if(updateRgbInput) {\r\n      this.rgbInputField.setValueSilently(color.rgbaArray.slice(0, -1).join(', '));\r\n      this.rgbInputField.setState(InputState.Neutral);\r\n    }\r\n\r\n    if(this.onChange) {\r\n      this.onChange(color);\r\n    }\r\n  }\r\n\r\n  private hueHandler(pageX: number, update = true) {\r\n    const eventX = clamp(pageX - this.hueRect.left, 0, this.hueRect.width);\r\n\r\n    const percents = eventX / this.hueRect.width;\r\n    this.hue = Math.round(360 * percents);\r\n\r\n    const hsla = `hsla(${this.hue}, 100%, 50%, ${this.alpha})`;\r\n\r\n    this.elements.hueDragger.setAttributeNS(null, 'x', (percents * 100) + '%');\r\n    this.elements.hueDragger.setAttributeNS(null, 'fill', hsla);\r\n\r\n    this.elements.saturation.lastElementChild.setAttributeNS(null, 'stop-color', hsla);\r\n\r\n    if(update) {\r\n      this.updatePicker();\r\n    }\r\n  }\r\n\r\n  private saturationHandler(pageX: number, pageY: number, update = true) {\r\n    const maxX = this.boxRect.width;\r\n    const maxY = this.boxRect.height;\r\n\r\n    const eventX = clamp(pageX - this.boxRect.left, 0, maxX);\r\n    const eventY = clamp(pageY - this.boxRect.top, 0, maxY);\r\n\r\n    const posX = eventX / maxX * 100;\r\n    const posY = eventY / maxY * 100;\r\n\r\n    const boxDragger = this.elements.boxDragger;\r\n    boxDragger.setAttributeNS(null, 'x', posX + '%');\r\n    boxDragger.setAttributeNS(null, 'y', posY + '%');\r\n\r\n    const saturation = clamp(posX, 0, 100);\r\n\r\n    const lightnessX = 100 - saturation / 2;\r\n    const lightnessY = 100 - clamp(posY, 0, 100);\r\n\r\n    const lightness = clamp(lightnessY / 100 * lightnessX, 0, 100);\r\n\r\n    this.saturation = saturation;\r\n    this.lightness = lightness;\r\n\r\n    if(update) {\r\n      this.updatePicker();\r\n    }\r\n  };\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport {SettingSection} from '..';\r\nimport {Theme} from '../../../config/state';\r\nimport {hexaToRgba} from '../../../helpers/color';\r\nimport {attachClickEvent} from '../../../helpers/dom/clickEvent';\r\nimport findUpClassName from '../../../helpers/dom/findUpClassName';\r\nimport highlightningColor from '../../../helpers/highlightningColor';\r\nimport throttle from '../../../helpers/schedulers/throttle';\r\nimport themeController from '../../../helpers/themeController';\r\nimport appImManager from '../../../lib/appManagers/appImManager';\r\nimport rootScope from '../../../lib/rootScope';\r\nimport ColorPicker, {ColorPickerColor} from '../../colorPicker';\r\nimport {SliderSuperTab} from '../../slider';\r\n\r\nexport default class AppBackgroundColorTab extends SliderSuperTab {\r\n  private colorPicker: ColorPicker;\r\n  private grid: HTMLElement;\r\n  private applyColor: (hex: string, updateColorPicker?: boolean) => void;\r\n  private theme: Theme;\r\n\r\n  init() {\r\n    this.header.classList.add('with-border');\r\n    this.container.classList.add('background-container', 'background-color-container');\r\n    this.setTitle('SetColor');\r\n\r\n    this.theme = themeController.getTheme();\r\n\r\n    const section = new SettingSection({});\r\n    this.colorPicker = new ColorPicker();\r\n\r\n    section.content.append(this.colorPicker.container);\r\n\r\n    this.scrollable.append(section.container);\r\n\r\n    const gridSection = new SettingSection({});\r\n\r\n    const grid = this.grid = document.createElement('div');\r\n    grid.classList.add('grid');\r\n\r\n    const colors = [\r\n      '#E6EBEE',\r\n      '#B2CEE1',\r\n      '#008DD0',\r\n      '#C6E7CB',\r\n      '#C4E1A6',\r\n      '#60B16E',\r\n      '#CCD0AF',\r\n      '#A6A997',\r\n      '#7A7072',\r\n      '#FDD7AF',\r\n      '#FDB76E',\r\n      '#DD8851'\r\n    ];\r\n\r\n    colors.forEach((color) => {\r\n      const item = document.createElement('div');\r\n      item.classList.add('grid-item');\r\n      item.dataset.color = color.toLowerCase();\r\n\r\n      // * need for transform scale\r\n      const media = document.createElement('div');\r\n      media.classList.add('grid-item-media');\r\n      media.style.backgroundColor = color;\r\n\r\n      item.append(media);\r\n      grid.append(item);\r\n    });\r\n\r\n    attachClickEvent(grid, (e) => {\r\n      const target = findUpClassName(e.target, 'grid-item');\r\n      if(!target || target.classList.contains('active')) {\r\n        return;\r\n      }\r\n\r\n      const color = target.dataset.color;\r\n      if(!color) {\r\n        return;\r\n      }\r\n\r\n      this.applyColor(color);\r\n    }, {listenerSetter: this.listenerSetter});\r\n\r\n    gridSection.content.append(grid);\r\n    this.scrollable.append(gridSection.container);\r\n\r\n    this.applyColor = throttle(this._applyColor, 16, true);\r\n  }\r\n\r\n  private setActive() {\r\n    const active = this.grid.querySelector('.active');\r\n    const background = this.theme.background;\r\n    const target = background.color ? this.grid.querySelector(`.grid-item[data-color=\"${background.color}\"]`) : null;\r\n    if(active === target) {\r\n      return;\r\n    }\r\n\r\n    if(active) {\r\n      active.classList.remove('active');\r\n    }\r\n\r\n    if(target) {\r\n      target.classList.add('active');\r\n    }\r\n  }\r\n\r\n  private _applyColor = (hex: string, updateColorPicker = true) => {\r\n    if(updateColorPicker) {\r\n      this.colorPicker.setColor(hex);\r\n    } else {\r\n      const rgba = hexaToRgba(hex);\r\n      const background = this.theme.background;\r\n      const hsla = highlightningColor(rgba);\r\n\r\n      background.id = '2';\r\n      background.intensity = 0;\r\n      background.slug = '';\r\n      background.color = hex.toLowerCase();\r\n      background.highlightningColor = hsla;\r\n      this.managers.appStateManager.pushToState('settings', rootScope.settings);\r\n\r\n      appImManager.applyCurrentTheme(undefined, undefined, true);\r\n      this.setActive();\r\n    }\r\n  };\r\n\r\n  private onColorChange = (color: ColorPickerColor) => {\r\n    this.applyColor(color.hex, false);\r\n  };\r\n\r\n  onOpen() {\r\n    setTimeout(() => {\r\n      const background = this.theme.background;\r\n\r\n      const color = (background.color || '').split(',')[0];\r\n      const isColored = !!color && !background.slug;\r\n\r\n      // * set active if type is color\r\n      if(isColored) {\r\n        this.colorPicker.onChange = this.onColorChange;\r\n      }\r\n\r\n      this.colorPicker.setColor(color || '#cccccc');\r\n\r\n      if(!isColored) {\r\n        this.colorPicker.onChange = this.onColorChange;\r\n      }\r\n    }, 0);\r\n  }\r\n\r\n  onCloseAfterTimeout() {\r\n    this.colorPicker.onChange = undefined;\r\n    this.colorPicker = undefined;\r\n\r\n    return super.onCloseAfterTimeout();\r\n  }\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport {generateSection} from '..';\r\nimport {averageColor, averageColorFromCanvas} from '../../../helpers/averageColor';\r\nimport blur from '../../../helpers/blur';\r\nimport deferredPromise, {CancellablePromise} from '../../../helpers/cancellablePromise';\r\nimport {attachClickEvent} from '../../../helpers/dom/clickEvent';\r\nimport findUpClassName from '../../../helpers/dom/findUpClassName';\r\nimport highlightningColor from '../../../helpers/highlightningColor';\r\nimport copy from '../../../helpers/object/copy';\r\nimport sequentialDom from '../../../helpers/sequentialDom';\r\nimport ChatBackgroundGradientRenderer from '../../chat/gradientRenderer';\r\nimport {Document, PhotoSize, WallPaper} from '../../../layer';\r\nimport {MyDocument} from '../../../lib/appManagers/appDocsManager';\r\nimport appDownloadManager, {AppDownloadManager, DownloadBlob} from '../../../lib/appManagers/appDownloadManager';\r\nimport appImManager from '../../../lib/appManagers/appImManager';\r\nimport rootScope from '../../../lib/rootScope';\r\nimport Button from '../../button';\r\nimport CheckboxField from '../../checkboxField';\r\nimport ProgressivePreloader from '../../preloader';\r\nimport {SliderSuperTab} from '../../slider';\r\nimport {wrapPhoto} from '../../wrappers';\r\nimport AppBackgroundColorTab from './backgroundColor';\r\nimport choosePhotoSize from '../../../lib/appManagers/utils/photos/choosePhotoSize';\r\nimport {STATE_INIT, Theme} from '../../../config/state';\r\nimport themeController from '../../../helpers/themeController';\r\nimport requestFile from '../../../helpers/files/requestFile';\r\nimport {renderImageFromUrlPromise} from '../../../helpers/dom/renderImageFromUrl';\r\nimport scaleMediaElement from '../../../helpers/canvas/scaleMediaElement';\r\nimport {MediaSize} from '../../../helpers/mediaSize';\r\n\r\nexport default class AppBackgroundTab extends SliderSuperTab {\r\n  private grid: HTMLElement;\r\n  private tempId = 0;\r\n  private clicked: Set<DocId> = new Set();\r\n  private blurCheckboxField: CheckboxField;\r\n\r\n  private wallPapersByElement: Map<HTMLElement, WallPaper> = new Map();\r\n  private elementsByKey: Map<string, HTMLElement> = new Map();\r\n\r\n  private get theme() {\r\n    return themeController.getTheme();\r\n  }\r\n\r\n  init() {\r\n    this.header.classList.add('with-border');\r\n    this.container.classList.add('background-container', 'background-image-container');\r\n    this.setTitle('ChatBackground');\r\n\r\n    {\r\n      const container = generateSection(this.scrollable);\r\n\r\n      const uploadButton = Button('btn-primary btn-transparent', {icon: 'cameraadd', text: 'ChatBackground.UploadWallpaper'});\r\n      const colorButton = Button('btn-primary btn-transparent', {icon: 'colorize', text: 'SetColor'});\r\n      const resetButton = Button('btn-primary btn-transparent', {icon: 'favourites', text: 'Appearance.Reset'});\r\n\r\n      attachClickEvent(uploadButton, this.onUploadClick, {listenerSetter: this.listenerSetter});\r\n\r\n      attachClickEvent(colorButton, () => {\r\n        this.slider.createTab(AppBackgroundColorTab).open();\r\n      }, {listenerSetter: this.listenerSetter});\r\n\r\n      attachClickEvent(resetButton, this.onResetClick, {listenerSetter: this.listenerSetter});\r\n\r\n      const blurCheckboxField = this.blurCheckboxField = new CheckboxField({\r\n        text: 'ChatBackground.Blur',\r\n        name: 'blur',\r\n        checked: this.theme.background.blur,\r\n        withRipple: true\r\n      });\r\n\r\n      this.listenerSetter.add(blurCheckboxField.input)('change', async() => {\r\n        this.theme.background.blur = blurCheckboxField.input.checked;\r\n        await this.managers.appStateManager.pushToState('settings', rootScope.settings);\r\n\r\n        // * wait for animation end\r\n        setTimeout(() => {\r\n          const active = grid.querySelector('.active') as HTMLElement;\r\n          if(!active) return;\r\n\r\n          const wallpaper = this.wallPapersByElement.get(active);\r\n          if((wallpaper as WallPaper.wallPaper).pFlags.pattern || wallpaper._ === 'wallPaperNoFile') {\r\n            return;\r\n          }\r\n\r\n          this.setBackgroundDocument(wallpaper);\r\n        }, 100);\r\n      });\r\n\r\n      container.append(uploadButton, colorButton, resetButton, blurCheckboxField.label);\r\n    }\r\n\r\n    rootScope.addEventListener('background_change', this.setActive);\r\n\r\n    this.managers.appDocsManager.getWallPapers().then((wallPapers) => {\r\n      wallPapers.forEach((wallPaper) => {\r\n        this.addWallPaper(wallPaper);\r\n      });\r\n    });\r\n\r\n    const gridContainer = generateSection(this.scrollable);\r\n    const grid = this.grid = document.createElement('div');\r\n    grid.classList.add('grid');\r\n    attachClickEvent(grid, this.onGridClick, {listenerSetter: this.listenerSetter});\r\n    gridContainer.append(grid);\r\n  }\r\n\r\n  private onUploadClick = () => {\r\n    requestFile('image/x-png,image/png,image/jpeg').then(async(file) => {\r\n      if(file.name.endsWith('.png')) {\r\n        const img = document.createElement('img');\r\n        const url = URL.createObjectURL(file);\r\n        await renderImageFromUrlPromise(img, url, false);\r\n        const mimeType = 'image/jpeg';\r\n        const {blob} = await scaleMediaElement({media: img, size: new MediaSize(img.naturalWidth, img.naturalHeight), mimeType});\r\n        file = new File([blob], file.name.replace(/\\.png$/, '.jpg'), {type: mimeType});\r\n      }\r\n\r\n      const wallPaper = await this.managers.appDocsManager.prepareWallPaperUpload(file);\r\n      const uploadPromise = this.managers.appDocsManager.uploadWallPaper(wallPaper.id);\r\n      const uploadDeferred: CancellablePromise<any> = appDownloadManager.getNewDeferredForUpload(file.name, uploadPromise);\r\n\r\n      const deferred = deferredPromise<void>();\r\n      deferred.addNotifyListener = uploadDeferred.addNotifyListener;\r\n      deferred.cancel = uploadDeferred.cancel;\r\n\r\n      uploadDeferred.then((wallPaper) => {\r\n        this.clicked.delete(key);\r\n        this.elementsByKey.delete(key);\r\n        this.wallPapersByElement.set(container, wallPaper);\r\n        const newKey = this.getWallPaperKey(wallPaper);\r\n        this.elementsByKey.set(newKey, container);\r\n\r\n        this.setBackgroundDocument(wallPaper).then(deferred.resolve, deferred.reject);\r\n      }, deferred.reject);\r\n\r\n      const key = this.getWallPaperKey(wallPaper);\r\n      deferred.catch(() => {\r\n        container.remove();\r\n      });\r\n\r\n      const preloader = new ProgressivePreloader({\r\n        isUpload: true,\r\n        cancelable: true,\r\n        tryAgainOnFail: false\r\n      });\r\n\r\n      const container = this.addWallPaper(wallPaper, false);\r\n      this.clicked.add(key);\r\n\r\n      preloader.attach(container, false, deferred);\r\n    });\r\n  };\r\n\r\n  private onResetClick = () => {\r\n    const defaultTheme = STATE_INIT.settings.themes.find((t) => t.name === this.theme.name);\r\n    if(defaultTheme) {\r\n      ++this.tempId;\r\n      this.theme.background = copy(defaultTheme.background);\r\n      this.managers.appStateManager.pushToState('settings', rootScope.settings);\r\n      appImManager.applyCurrentTheme(undefined, undefined, true);\r\n      this.blurCheckboxField.setValueSilently(this.theme.background.blur);\r\n    }\r\n  };\r\n\r\n  private getColorsFromWallPaper(wallPaper: WallPaper) {\r\n    return wallPaper.settings ? [\r\n      wallPaper.settings.background_color,\r\n      wallPaper.settings.second_background_color,\r\n      wallPaper.settings.third_background_color,\r\n      wallPaper.settings.fourth_background_color\r\n    ].filter(Boolean).map((color) => '#' + color.toString(16)).join(',') : '';\r\n  }\r\n\r\n  private getWallPaperKey(wallPaper: WallPaper) {\r\n    return '' + wallPaper.id;\r\n  }\r\n\r\n  private getWallPaperKeyFromTheme(theme: Theme) {\r\n    return '' + theme.background.id;\r\n  }\r\n\r\n  private addWallPaper(wallPaper: WallPaper, append = true) {\r\n    const colors = this.getColorsFromWallPaper(wallPaper);\r\n    const hasFile = wallPaper._ === 'wallPaper';\r\n    if((hasFile && wallPaper.pFlags.pattern && !colors)/*  ||\r\n      (wallpaper.document as MyDocument).mime_type.indexOf('application/') === 0 */) {\r\n      return;\r\n    }\r\n\r\n    const isDark = !!wallPaper.pFlags.dark;\r\n\r\n    const doc = hasFile ? wallPaper.document as Document.document : undefined;\r\n\r\n    const container = document.createElement('div');\r\n    container.classList.add('grid-item');\r\n\r\n    container.dataset.id = '' + wallPaper.id;\r\n\r\n    const key = this.getWallPaperKey(wallPaper);\r\n    this.wallPapersByElement.set(container, wallPaper);\r\n    this.elementsByKey.set(key, container);\r\n\r\n    const media = document.createElement('div');\r\n    media.classList.add('grid-item-media');\r\n\r\n    let wrapped: ReturnType<typeof wrapPhoto>, size: ReturnType<typeof choosePhotoSize>;\r\n    if(hasFile) {\r\n      size = choosePhotoSize(doc, 200, 200);\r\n      wrapped = wrapPhoto({\r\n        photo: doc,\r\n        message: null,\r\n        container: media,\r\n        withoutPreloader: true,\r\n        size: size,\r\n        noFadeIn: wallPaper.pFlags.pattern\r\n      });\r\n\r\n      if(wallPaper.pFlags.pattern) {\r\n        media.classList.add('is-pattern');\r\n      }\r\n\r\n      wrapped.then(async({loadPromises, images}) => {\r\n        await loadPromises.thumb || loadPromises.full;\r\n        return images;\r\n      }).then((images) => {\r\n        if(wallPaper.pFlags.pattern) {\r\n          if(isDark) {\r\n            images.full.style.display = 'none';\r\n            if(images.thumb) {\r\n              images.thumb.style.display = 'none';\r\n            }\r\n          } else if(wallPaper.settings?.intensity) {\r\n            images.full.style.opacity = '' + Math.abs(wallPaper.settings.intensity) / 100;\r\n          }\r\n        }\r\n\r\n        sequentialDom.mutate(() => {\r\n          container.append(media);\r\n        });\r\n      });\r\n    } else {\r\n      container.append(media);\r\n    }\r\n\r\n    if(wallPaper.settings && wallPaper.settings.background_color !== undefined) {\r\n      const {canvas} = ChatBackgroundGradientRenderer.create(colors);\r\n      canvas.classList.add('background-colors-canvas');\r\n\r\n      if(isDark && hasFile) {\r\n        wrapped.then(({loadPromises}) => {\r\n          loadPromises.full.then(async() => {\r\n            const cacheContext = await this.managers.thumbsStorage.getCacheContext(doc, size.type);\r\n            canvas.style.webkitMaskImage = `url(${cacheContext.url})`;\r\n            canvas.style.opacity = '' + (wallPaper.pFlags.dark ? 100 + wallPaper.settings.intensity : wallPaper.settings.intensity) / 100;\r\n            media.append(canvas);\r\n          });\r\n        });\r\n      } else {\r\n        media.append(canvas);\r\n      }\r\n    }\r\n\r\n    if(this.getWallPaperKeyFromTheme(this.theme) === key) {\r\n      container.classList.add('active');\r\n    }\r\n\r\n    this.grid[append ? 'append' : 'prepend'](container);\r\n\r\n    return container;\r\n  }\r\n\r\n  private onGridClick = (e: MouseEvent | TouchEvent) => {\r\n    const target = findUpClassName(e.target, 'grid-item') as HTMLElement;\r\n    if(!target) return;\r\n\r\n    const wallpaper = this.wallPapersByElement.get(target);\r\n    if(wallpaper._ === 'wallPaperNoFile') {\r\n      this.setBackgroundDocument(wallpaper);\r\n      return;\r\n    }\r\n\r\n    const key = this.getWallPaperKey(wallpaper);\r\n    if(this.clicked.has(key)) return;\r\n    this.clicked.add(key);\r\n\r\n    const doc = wallpaper.document as MyDocument;\r\n    const preloader = new ProgressivePreloader({\r\n      cancelable: true,\r\n      tryAgainOnFail: false\r\n    });\r\n\r\n    const load = async() => {\r\n      const promise = this.setBackgroundDocument(wallpaper);\r\n      const cacheContext = await this.managers.thumbsStorage.getCacheContext(doc);\r\n      if(!cacheContext.url || this.theme.background.blur) {\r\n        preloader.attach(target, true, promise);\r\n      }\r\n    };\r\n\r\n    preloader.construct();\r\n\r\n    attachClickEvent(target, (e) => {\r\n      if(preloader.preloader.parentElement) {\r\n        preloader.onClick(e);\r\n        preloader.detach();\r\n      } else {\r\n        load();\r\n      }\r\n    }, {listenerSetter: this.listenerSetter});\r\n\r\n    load();\r\n\r\n    // console.log(doc);\r\n  };\r\n\r\n  private saveToCache = (slug: string, url: string) => {\r\n    fetch(url).then((response) => {\r\n      appImManager.cacheStorage.save('backgrounds/' + slug, response);\r\n    });\r\n  };\r\n\r\n  private setBackgroundDocument = (wallPaper: WallPaper) => {\r\n    const _tempId = ++this.tempId;\r\n    const middleware = () => _tempId === this.tempId;\r\n\r\n    const doc = (wallPaper as WallPaper.wallPaper).document as MyDocument;\r\n    const deferred = deferredPromise<void>();\r\n    let download: Promise<void> | ReturnType<AppDownloadManager['downloadMediaURL']>;\r\n    if(doc) {\r\n      download = appDownloadManager.downloadMediaURL({media: doc, queueId: appImManager.chat.bubbles ? appImManager.chat.bubbles.lazyLoadQueue.queueId : 0});\r\n      deferred.addNotifyListener = download.addNotifyListener;\r\n      deferred.cancel = download.cancel;\r\n    } else {\r\n      download = Promise.resolve();\r\n    }\r\n\r\n    download.then(async() => {\r\n      if(!middleware()) {\r\n        deferred.resolve();\r\n        return;\r\n      }\r\n\r\n      const background = this.theme.background;\r\n      const onReady = (url?: string) => {\r\n        // const perf = performance.now();\r\n        let getPixelPromise: Promise<Uint8ClampedArray>;\r\n        if(url && !this.theme.background.color) {\r\n          getPixelPromise = averageColor(url);\r\n        } else {\r\n          const {canvas} = ChatBackgroundGradientRenderer.create(this.getColorsFromWallPaper(wallPaper));\r\n          getPixelPromise = Promise.resolve(averageColorFromCanvas(canvas));\r\n        }\r\n\r\n        getPixelPromise.then((pixel) => {\r\n          if(!middleware()) {\r\n            deferred.resolve();\r\n            return;\r\n          }\r\n\r\n          const hsla = highlightningColor(Array.from(pixel) as any);\r\n          // const hsla = 'rgba(0, 0, 0, 0.3)';\r\n          // console.log(doc, hsla, performance.now() - perf);\r\n\r\n          const slug = (wallPaper as WallPaper.wallPaper).slug ?? '';\r\n          background.id = wallPaper.id;\r\n          background.intensity = wallPaper.settings?.intensity ?? 0;\r\n          background.color = this.getColorsFromWallPaper(wallPaper);\r\n          background.slug = slug;\r\n          background.highlightningColor = hsla;\r\n          this.managers.appStateManager.pushToState('settings', rootScope.settings);\r\n\r\n          if(slug) {\r\n            this.saveToCache(slug, url);\r\n          }\r\n\r\n          appImManager.applyCurrentTheme(slug, url, true).then(deferred.resolve);\r\n        });\r\n      };\r\n\r\n      if(!doc) {\r\n        onReady();\r\n        return;\r\n      }\r\n\r\n      const cacheContext = await this.managers.thumbsStorage.getCacheContext(doc);\r\n      if(background.blur) {\r\n        setTimeout(() => {\r\n          const {canvas, promise} = blur(cacheContext.url, 12, 4)\r\n          promise.then(() => {\r\n            if(!middleware()) {\r\n              deferred.resolve();\r\n              return;\r\n            }\r\n\r\n            onReady(canvas.toDataURL());\r\n          });\r\n        }, 200);\r\n      } else {\r\n        onReady(cacheContext.url);\r\n      }\r\n    });\r\n\r\n    return deferred;\r\n  };\r\n\r\n  private setActive = () => {\r\n    const active = this.grid.querySelector('.active');\r\n    const target = this.elementsByKey.get(this.getWallPaperKeyFromTheme(this.theme));\r\n    if(active === target) {\r\n      return;\r\n    }\r\n\r\n    if(active) {\r\n      active.classList.remove('active');\r\n    }\r\n\r\n    if(target) {\r\n      target.classList.add('active');\r\n    }\r\n  };\r\n}\r\n","export default function requestFile(accept?: string) {\n  const input = document.createElement('input');\n  input.type = 'file';\n  input.style.display = 'none';\n\n  if(accept) {\n    input.accept = accept;\n  }\n\n  document.body.append(input);\n\n  const promise = new Promise<File>((resolve, reject) => {\n    input.addEventListener('change', (e: any) => {\n      const file: File = e.target.files[0];\n      if(!file) {\n        reject('NO_FILE_SELECTED');\n        return;\n      }\n\n      resolve(file);\n    }, {once: true});\n  }).finally(() => {\n    input.remove();\n  });\n\n  input.click();\n\n  return promise;\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport {SettingSection} from '..';\nimport RadioField from '../../radioField';\nimport Row, {RadioFormFromRows} from '../../row';\nimport SliderSuperTab from '../../sliderTab';\nimport {wrapStickerToRow} from '../../wrappers';\n\nexport default class AppQuickReactionTab extends SliderSuperTab {\n  protected init() {\n    this.header.classList.add('with-border');\n    this.setTitle('DoubleTapSetting');\n    this.container.classList.add('quick-reaction-container');\n\n    return Promise.all([\n      this.managers.appReactionsManager.getQuickReaction(),\n      this.managers.appReactionsManager.getAvailableReactions()\n    ]).then(([quickReaction, availableReactions]) => {\n      availableReactions = availableReactions.filter((reaction) => !reaction.pFlags.inactive);\n\n      const section = new SettingSection();\n\n      const name = 'quick-reaction';\n      const rows = availableReactions.map((availableReaction) => {\n        const radioField = new RadioField({\n          name,\n          text: availableReaction.title,\n          value: availableReaction.reaction,\n          alignRight: true\n        });\n\n        const row = new Row({\n          radioField,\n          havePadding: true\n        });\n\n        radioField.main.classList.add('quick-reaction-title');\n\n        wrapStickerToRow({\n          row,\n          doc: availableReaction.static_icon,\n          size: 'small'\n        });\n\n        if(availableReaction.reaction === quickReaction.reaction) {\n          radioField.setValueSilently(true);\n        }\n\n        return row;\n      });\n\n      const form = RadioFormFromRows(rows, (value) => {\n        this.managers.appReactionsManager.setDefaultReaction(value);\n      });\n\n      section.content.append(form);\n      this.scrollable.append(section.container);\n    });\n  }\n}\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport {generateSection, SettingSection} from '..';\r\nimport RangeSelector from '../../rangeSelector';\r\nimport Button from '../../button';\r\nimport CheckboxField from '../../checkboxField';\r\nimport RadioField from '../../radioField';\r\nimport rootScope from '../../../lib/rootScope';\r\nimport {IS_APPLE} from '../../../environment/userAgent';\r\nimport Row from '../../row';\r\nimport AppBackgroundTab from './background';\r\nimport {LangPackKey, _i18n} from '../../../lib/langPack';\r\nimport {attachClickEvent} from '../../../helpers/dom/clickEvent';\r\nimport assumeType from '../../../helpers/assumeType';\r\nimport {MessagesAllStickers, StickerSet} from '../../../layer';\r\nimport {wrapStickerSetThumb, wrapStickerToRow} from '../../wrappers';\r\nimport LazyLoadQueue from '../../lazyLoadQueue';\r\nimport PopupStickers from '../../popups/stickers';\r\nimport eachMinute from '../../../helpers/eachMinute';\r\nimport {SliderSuperTabEventable} from '../../sliderTab';\r\nimport IS_GEOLOCATION_SUPPORTED from '../../../environment/geolocationSupport';\r\nimport AppQuickReactionTab from './quickReaction';\r\nimport wrapEmojiText from '../../../lib/richTextProcessor/wrapEmojiText';\r\nimport {State} from '../../../config/state';\r\n\r\nexport class RangeSettingSelector {\r\n  public container: HTMLDivElement;\r\n  public valueContainer: HTMLElement;\r\n  private range: RangeSelector;\r\n\r\n  public onChange: (value: number) => void;\r\n\r\n  constructor(\r\n    name: LangPackKey,\r\n    step: number,\r\n    initialValue: number,\r\n    minValue: number,\r\n    maxValue: number,\r\n    writeValue = true\r\n  ) {\r\n    const BASE_CLASS = 'range-setting-selector';\r\n    this.container = document.createElement('div');\r\n    this.container.classList.add(BASE_CLASS);\r\n\r\n    const details = document.createElement('div');\r\n    details.classList.add(BASE_CLASS + '-details');\r\n\r\n    const nameDiv = document.createElement('div');\r\n    nameDiv.classList.add(BASE_CLASS + '-name');\r\n    _i18n(nameDiv, name);\r\n\r\n    const valueDiv = this.valueContainer = document.createElement('div');\r\n    valueDiv.classList.add(BASE_CLASS + '-value');\r\n\r\n    if(writeValue) {\r\n      valueDiv.innerHTML = '' + initialValue;\r\n    }\r\n\r\n    details.append(nameDiv, valueDiv);\r\n\r\n    this.range = new RangeSelector({\r\n      step,\r\n      min: minValue,\r\n      max: maxValue\r\n    }, initialValue);\r\n    this.range.setListeners();\r\n    this.range.setHandlers({\r\n      onScrub: value => {\r\n        if(this.onChange) {\r\n          this.onChange(value);\r\n        }\r\n\r\n        if(writeValue) {\r\n          // console.log('font size scrub:', value);\r\n          valueDiv.innerText = '' + value;\r\n        }\r\n      }\r\n    });\r\n\r\n    this.container.append(details, this.range.container);\r\n  }\r\n}\r\n\r\nexport default class AppGeneralSettingsTab extends SliderSuperTabEventable {\r\n  init() {\r\n    this.header.classList.add('with-border');\r\n    this.container.classList.add('general-settings-container');\r\n    this.setTitle('General');\r\n\r\n    const section = generateSection.bind(null, this.scrollable);\r\n\r\n    {\r\n      const container = section('Settings');\r\n\r\n      const range = new RangeSettingSelector('TextSize', 1, rootScope.settings.messagesTextSize, 12, 20);\r\n      range.onChange = (value) => {\r\n        rootScope.managers.appStateManager.setByKey('settings.messagesTextSize', value);\r\n      };\r\n\r\n      const chatBackgroundButton = Button('btn-primary btn-transparent', {icon: 'image', text: 'ChatBackground'});\r\n\r\n      attachClickEvent(chatBackgroundButton, () => {\r\n        this.slider.createTab(AppBackgroundTab).open();\r\n      });\r\n\r\n      const animationsCheckboxField = new CheckboxField({\r\n        text: 'EnableAnimations',\r\n        name: 'animations',\r\n        stateKey: 'settings.animationsEnabled',\r\n        withRipple: true,\r\n        listenerSetter: this.listenerSetter\r\n      });\r\n\r\n      container.append(range.container, chatBackgroundButton, animationsCheckboxField.label);\r\n    }\r\n\r\n    {\r\n      const container = section('General.Keyboard');\r\n\r\n      const form = document.createElement('form');\r\n\r\n      const name = 'send-shortcut';\r\n      const stateKey = 'settings.sendShortcut';\r\n\r\n      const enterRow = new Row({\r\n        radioField: new RadioField({\r\n          langKey: 'General.SendShortcut.Enter',\r\n          name,\r\n          value: 'enter',\r\n          stateKey\r\n        }),\r\n        subtitleLangKey: 'General.SendShortcut.NewLine.ShiftEnter'\r\n      });\r\n\r\n      const ctrlEnterRow = new Row({\r\n        radioField: new RadioField({\r\n          name,\r\n          value: 'ctrlEnter',\r\n          stateKey\r\n        }),\r\n        subtitleLangKey: 'General.SendShortcut.NewLine.Enter'\r\n      });\r\n      _i18n(ctrlEnterRow.radioField.main, 'General.SendShortcut.CtrlEnter', [IS_APPLE ? '' : 'Ctrl']);\r\n\r\n      form.append(enterRow.container, ctrlEnterRow.container);\r\n      container.append(form);\r\n    }\r\n\r\n    if(IS_GEOLOCATION_SUPPORTED) {\r\n      const container = section('DistanceUnitsTitle');\r\n\r\n      const form = document.createElement('form');\r\n\r\n      const name = 'distance-unit';\r\n      const stateKey = 'settings.distanceUnit';\r\n\r\n      const kilometersRow = new Row({\r\n        radioField: new RadioField({\r\n          langKey: 'DistanceUnitsKilometers',\r\n          name,\r\n          value: 'kilometers',\r\n          stateKey\r\n        })\r\n      });\r\n\r\n      const milesRow = new Row({\r\n        radioField: new RadioField({\r\n          langKey: 'DistanceUnitsMiles',\r\n          name,\r\n          value: 'miles',\r\n          stateKey\r\n        })\r\n      });\r\n\r\n      form.append(kilometersRow.container, milesRow.container);\r\n      container.append(form);\r\n    }\r\n\r\n    {\r\n      const container = section('General.TimeFormat');\r\n\r\n      const form = document.createElement('form');\r\n\r\n      const name = 'time-format';\r\n      const stateKey = 'settings.timeFormat';\r\n\r\n      const formats: [State['settings']['timeFormat'], LangPackKey][] = [\r\n        ['h12', 'General.TimeFormat.h12'],\r\n        ['h23', 'General.TimeFormat.h23']\r\n      ];\r\n\r\n      const rows = formats.map(([format, langPackKey]) => {\r\n        const row = new Row({\r\n          radioField: new RadioField({\r\n            langKey: langPackKey,\r\n            name,\r\n            value: format,\r\n            stateKey\r\n          })\r\n        });\r\n\r\n        return row;\r\n      });\r\n\r\n      const cancel = eachMinute(() => {\r\n        const date = new Date();\r\n\r\n        formats.forEach(([format], idx) => {\r\n          const str = date.toLocaleTimeString('en-us-u-hc-' + format, {\r\n            hour: '2-digit',\r\n            minute: '2-digit'\r\n          });\r\n\r\n          rows[idx].subtitle.textContent = str;\r\n        });\r\n      });\r\n\r\n      this.eventListener.addEventListener('destroy', cancel);\r\n\r\n      form.append(...rows.map((row) => row.container));\r\n      container.append(form);\r\n    }\r\n\r\n    {\r\n      const container = section('Emoji');\r\n\r\n      const suggestCheckboxField = new CheckboxField({\r\n        text: 'GeneralSettings.EmojiPrediction',\r\n        name: 'suggest-emoji',\r\n        stateKey: 'settings.emoji.suggest',\r\n        withRipple: true,\r\n        listenerSetter: this.listenerSetter\r\n      });\r\n      const bigCheckboxField = new CheckboxField({\r\n        text: 'GeneralSettings.BigEmoji',\r\n        name: 'emoji-big',\r\n        stateKey: 'settings.emoji.big',\r\n        withRipple: true,\r\n        listenerSetter: this.listenerSetter\r\n      });\r\n\r\n      container.append(suggestCheckboxField.label, bigCheckboxField.label);\r\n    }\r\n\r\n    {\r\n      const section = new SettingSection({name: 'Telegram.InstalledStickerPacksController', caption: 'StickersBotInfo'});\r\n\r\n      const reactionsRow = new Row({\r\n        titleLangKey: 'DoubleTapSetting',\r\n        havePadding: true,\r\n        clickable: () => {\r\n          this.slider.createTab(AppQuickReactionTab).open();\r\n        },\r\n        listenerSetter: this.listenerSetter\r\n      });\r\n\r\n      const renderQuickReaction = () => {\r\n        Promise.resolve(this.managers.appReactionsManager.getQuickReaction()).then((reaction) => {\r\n          wrapStickerToRow({\r\n            row: reactionsRow,\r\n            doc: reaction.static_icon,\r\n            size: 'small'\r\n          });\r\n        });\r\n      };\r\n\r\n      renderQuickReaction();\r\n\r\n      this.listenerSetter.add(rootScope)('quick_reaction', renderQuickReaction);\r\n\r\n      const suggestCheckboxField = new CheckboxField({\r\n        text: 'Stickers.SuggestStickers',\r\n        name: 'suggest',\r\n        stateKey: 'settings.stickers.suggest',\r\n        withRipple: true,\r\n        listenerSetter: this.listenerSetter\r\n      });\r\n      const loopCheckboxField = new CheckboxField({\r\n        text: 'InstalledStickers.LoopAnimated',\r\n        name: 'loop',\r\n        stateKey: 'settings.stickers.loop',\r\n        withRipple: true,\r\n        listenerSetter: this.listenerSetter\r\n      });\r\n\r\n      const stickerSets: {[id: string]: Row} = {};\r\n\r\n      const stickersContent = section.generateContentElement();\r\n\r\n      const lazyLoadQueue = new LazyLoadQueue();\r\n      const renderStickerSet = (stickerSet: StickerSet.stickerSet, method: 'append' | 'prepend' = 'append') => {\r\n        const row = new Row({\r\n          title: wrapEmojiText(stickerSet.title),\r\n          subtitleLangKey: 'Stickers',\r\n          subtitleLangArgs: [stickerSet.count],\r\n          havePadding: true,\r\n          clickable: () => {\r\n            new PopupStickers({id: stickerSet.id, access_hash: stickerSet.access_hash}).show();\r\n          },\r\n          listenerSetter: this.listenerSetter\r\n        });\r\n\r\n        stickerSets[stickerSet.id] = row;\r\n\r\n        const div = document.createElement('div');\r\n        div.classList.add('row-media');\r\n\r\n        wrapStickerSetThumb({\r\n          set: stickerSet,\r\n          container: div,\r\n          group: 'GENERAL-SETTINGS',\r\n          lazyLoadQueue,\r\n          width: 48,\r\n          height: 48,\r\n          autoplay: true\r\n        });\r\n\r\n        row.container.append(div);\r\n\r\n        stickersContent[method](row.container);\r\n      };\r\n\r\n      this.managers.appStickersManager.getAllStickers().then((allStickers) => {\r\n        assumeType<MessagesAllStickers.messagesAllStickers>(allStickers);\r\n        for(const stickerSet of allStickers.sets) {\r\n          renderStickerSet(stickerSet);\r\n        }\r\n      });\r\n\r\n      this.listenerSetter.add(rootScope)('stickers_installed', (e) => {\r\n        const set: StickerSet.stickerSet = e;\r\n\r\n        if(!stickerSets[set.id]) {\r\n          renderStickerSet(set, 'prepend');\r\n        }\r\n      });\r\n\r\n      this.listenerSetter.add(rootScope)('stickers_deleted', (e) => {\r\n        const set: StickerSet.stickerSet = e;\r\n\r\n        if(stickerSets[set.id]) {\r\n          stickerSets[set.id].container.remove();\r\n          delete stickerSets[set.id];\r\n        }\r\n      });\r\n\r\n      section.content.append(reactionsRow.container, suggestCheckboxField.label, loopCheckboxField.label);\r\n      this.scrollable.append(section.container);\r\n    }\r\n  }\r\n\r\n  onOpen() {\r\n    if(this.init) {\r\n      this.init();\r\n      this.init = null;\r\n    }\r\n  }\r\n}\r\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport eachTimeout from './eachTimeout';\n\n// It's better to use timeout instead of interval, because interval can be corrupted\nexport default function eachMinute(callback: () => any, runFirst = true) {\n  return eachTimeout(callback, () => (60 - new Date().getSeconds()) * 1000, runFirst);\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport ctx from '../environment/ctx';\nimport noop from './noop';\n\n// It's better to use timeout instead of interval, because interval can be corrupted\nexport default function eachTimeout(callback: () => any, getNextTimeout: () => number, runFirst = true) {\n  const cancel = () => {\n    clearTimeout(timeout);\n  };\n\n  // replace callback to run noop and restore after\n  const _callback = callback;\n  if(!runFirst) {\n    callback = noop;\n  }\n\n  let timeout: number;\n  (function run() {\n    callback();\n    timeout = ctx.setTimeout(run, getNextTimeout());\n  })();\n\n  callback = _callback;\n\n  return cancel;\n}\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport InputField from '../../inputField';\r\nimport {SliderSuperTab} from '../../slider';\r\nimport EditPeer from '../../editPeer';\r\nimport {UsernameInputField} from '../../usernameInputField';\r\nimport {i18n, i18n_} from '../../../lib/langPack';\r\nimport {attachClickEvent} from '../../../helpers/dom/clickEvent';\r\nimport rootScope from '../../../lib/rootScope';\r\nimport {generateSection, SettingSection} from '..';\r\n\r\n// TODO:         - (    ,    ,      )\r\n\r\nexport default class AppEditProfileTab extends SliderSuperTab {\r\n  private firstNameInputField: InputField;\r\n  private lastNameInputField: InputField;\r\n  private bioInputField: InputField;\r\n  private usernameInputField: InputField;\r\n\r\n  private profileUrlContainer: HTMLDivElement;\r\n  private profileUrlAnchor: HTMLAnchorElement;\r\n\r\n  private editPeer: EditPeer;\r\n\r\n  protected async init() {\r\n    this.container.classList.add('edit-profile-container');\r\n    this.setTitle('EditAccount.Title');\r\n\r\n    const inputFields: InputField[] = [];\r\n\r\n    {\r\n      const section = generateSection(this.scrollable, undefined, 'Bio.Description');\r\n      const inputWrapper = document.createElement('div');\r\n      inputWrapper.classList.add('input-wrapper');\r\n\r\n      const appConfig = await this.managers.apiManager.getAppConfig();\r\n      this.firstNameInputField = new InputField({\r\n        label: 'EditProfile.FirstNameLabel',\r\n        name: 'first-name',\r\n        maxLength: 70\r\n      });\r\n      this.lastNameInputField = new InputField({\r\n        label: 'Login.Register.LastName.Placeholder',\r\n        name: 'last-name',\r\n        maxLength: 64\r\n      });\r\n      this.bioInputField = new InputField({\r\n        label: 'EditProfile.BioLabel',\r\n        name: 'bio',\r\n        maxLength: rootScope.premium ? appConfig.about_length_limit_premium : appConfig.about_length_limit_default\r\n      });\r\n\r\n      inputWrapper.append(this.firstNameInputField.container, this.lastNameInputField.container, this.bioInputField.container);\r\n\r\n      const caption = document.createElement('div');\r\n      caption.classList.add('caption');\r\n      i18n_({element: caption, key: 'Bio.Description'});\r\n\r\n      inputFields.push(this.firstNameInputField, this.lastNameInputField, this.bioInputField);\r\n\r\n      this.editPeer = new EditPeer({\r\n        peerId: rootScope.myId,\r\n        inputFields,\r\n        listenerSetter: this.listenerSetter\r\n      });\r\n\r\n      this.content.append(this.editPeer.nextBtn);\r\n\r\n      section.append(this.editPeer.avatarEdit.container, inputWrapper);\r\n    }\r\n\r\n    {\r\n      const section = new SettingSection({\r\n        name: 'EditAccount.Username',\r\n        caption: true\r\n      });\r\n\r\n      const inputWrapper = document.createElement('div');\r\n      inputWrapper.classList.add('input-wrapper');\r\n\r\n      this.usernameInputField = new UsernameInputField({\r\n        label: 'EditProfile.Username.Label',\r\n        name: 'username',\r\n        plainText: true,\r\n        listenerSetter: this.listenerSetter,\r\n        onChange: () => {\r\n          this.editPeer.handleChange();\r\n          this.setProfileUrl();\r\n        },\r\n        availableText: 'EditProfile.Username.Available',\r\n        takenText: 'EditProfile.Username.Taken',\r\n        invalidText: 'EditProfile.Username.Invalid'\r\n      }, this.managers);\r\n\r\n      inputWrapper.append(this.usernameInputField.container);\r\n\r\n      const caption = section.caption;\r\n      caption.append(i18n('UsernameSettings.ChangeDescription'));\r\n      caption.append(document.createElement('br'), document.createElement('br'));\r\n\r\n      const profileUrlContainer = this.profileUrlContainer = document.createElement('div');\r\n      profileUrlContainer.classList.add('profile-url-container');\r\n\r\n      const profileUrlAnchor = this.profileUrlAnchor = document.createElement('a');\r\n      profileUrlAnchor.classList.add('profile-url');\r\n      profileUrlAnchor.href = '#';\r\n      profileUrlAnchor.target = '_blank';\r\n\r\n      profileUrlContainer.append(i18n('UsernameHelpLink', [profileUrlAnchor]));\r\n\r\n      caption.append(profileUrlContainer);\r\n\r\n      inputFields.push(this.usernameInputField);\r\n      section.content.append(inputWrapper);\r\n      this.scrollable.append(section.container);\r\n    }\r\n\r\n    attachClickEvent(this.editPeer.nextBtn, () => {\r\n      this.editPeer.nextBtn.disabled = true;\r\n\r\n      const promises: Promise<any>[] = [];\r\n\r\n      promises.push(this.managers.appProfileManager.updateProfile(this.firstNameInputField.value, this.lastNameInputField.value, this.bioInputField.value).then(() => {\r\n        this.close();\r\n      }, (err) => {\r\n        console.error('updateProfile error:', err);\r\n      }));\r\n\r\n      if(this.editPeer.uploadAvatar) {\r\n        promises.push(this.editPeer.uploadAvatar().then((inputFile) => {\r\n          return this.managers.appProfileManager.uploadProfilePhoto(inputFile);\r\n        }));\r\n      }\r\n\r\n      if(this.usernameInputField.isValidToChange()) {\r\n        promises.push(this.managers.appUsersManager.updateUsername(this.usernameInputField.value));\r\n      }\r\n\r\n      Promise.race(promises).finally(() => {\r\n        this.editPeer.nextBtn.removeAttribute('disabled');\r\n      });\r\n    }, {listenerSetter: this.listenerSetter});\r\n\r\n    const user = await this.managers.appUsersManager.getSelf();\r\n\r\n    const userFull = await this.managers.appProfileManager.getProfile(user.id, true);\r\n\r\n    this.firstNameInputField.setOriginalValue(user.first_name, true);\r\n    this.lastNameInputField.setOriginalValue(user.last_name, true);\r\n    this.bioInputField.setOriginalValue(userFull.about, true);\r\n    this.usernameInputField.setOriginalValue(user.username, true);\r\n\r\n    this.setProfileUrl();\r\n    this.editPeer.handleChange();\r\n  }\r\n\r\n  private setProfileUrl() {\r\n    if(this.usernameInputField.input.classList.contains('error') || !this.usernameInputField.value.length) {\r\n      this.profileUrlContainer.style.display = 'none';\r\n    } else {\r\n      this.profileUrlContainer.style.display = '';\r\n      const url = 'https://t.me/' + this.usernameInputField.value;\r\n      this.profileUrlAnchor.innerText = url;\r\n      this.profileUrlAnchor.href = url;\r\n    }\r\n  }\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport {SettingSection} from '..';\r\nimport Row from '../../row';\r\nimport CheckboxField from '../../checkboxField';\r\nimport {InputNotifyPeer, Update} from '../../../layer';\r\nimport {SliderSuperTabEventable} from '../../sliderTab';\r\nimport rootScope from '../../../lib/rootScope';\r\nimport {LangPackKey} from '../../../lib/langPack';\r\nimport copy from '../../../helpers/object/copy';\r\nimport convertKeyToInputKey from '../../../helpers/string/convertKeyToInputKey';\r\nimport {MUTE_UNTIL} from '../../../lib/mtproto/mtproto_config';\r\nimport apiManagerProxy from '../../../lib/mtproto/mtprotoworker';\r\n\r\ntype InputNotifyKey = Exclude<InputNotifyPeer['_'], 'inputNotifyPeer'>;\r\n\r\nexport default class AppNotificationsTab extends SliderSuperTabEventable {\r\n  protected init() {\r\n    this.header.classList.add('with-border');\r\n    this.container.classList.add('notifications-container', 'with-border');\r\n    this.setTitle('Telegram.NotificationSettingsViewController');\r\n\r\n    const NotifySection = (options: {\r\n      name: LangPackKey,\r\n      typeText: LangPackKey,\r\n      inputKey: InputNotifyKey,\r\n    }) => {\r\n      const section = new SettingSection({\r\n        name: options.name\r\n      });\r\n\r\n      const enabledRow = new Row({\r\n        checkboxField: new CheckboxField({text: options.typeText, checked: true}),\r\n        subtitleLangKey: 'Loading',\r\n        listenerSetter: this.listenerSetter\r\n      });\r\n\r\n      const previewEnabledRow = new Row({\r\n        checkboxField: new CheckboxField({text: 'MessagePreview', checked: true}),\r\n        subtitleLangKey: 'Loading',\r\n        listenerSetter: this.listenerSetter\r\n      });\r\n\r\n      section.content.append(enabledRow.container, previewEnabledRow.container);\r\n\r\n      this.scrollable.append(section.container);\r\n\r\n      const inputNotifyPeer = {_: options.inputKey};\r\n      const ret = this.managers.appNotificationsManager.getNotifySettings(inputNotifyPeer);\r\n      (ret instanceof Promise ? ret : Promise.resolve(ret)).then((notifySettings) => {\r\n        const applySettings = async() => {\r\n          const muted = await this.managers.appNotificationsManager.isMuted(notifySettings);\r\n          enabledRow.checkboxField.checked = !muted;\r\n          previewEnabledRow.checkboxField.checked = notifySettings.show_previews;\r\n\r\n          return muted;\r\n        };\r\n\r\n        applySettings();\r\n\r\n        this.eventListener.addEventListener('destroy', async() => {\r\n          const mute = !enabledRow.checkboxField.checked;\r\n          const showPreviews = previewEnabledRow.checkboxField.checked;\r\n\r\n          if(mute === (await this.managers.appNotificationsManager.isMuted(notifySettings)) && showPreviews === notifySettings.show_previews) {\r\n            return;\r\n          }\r\n\r\n          const inputSettings: any = copy(notifySettings);\r\n          inputSettings._ = 'inputPeerNotifySettings';\r\n          inputSettings.mute_until = mute ? MUTE_UNTIL : 0;\r\n          inputSettings.show_previews = showPreviews;\r\n\r\n          this.managers.appNotificationsManager.updateNotifySettings(inputNotifyPeer, inputSettings);\r\n        }, {once: true});\r\n\r\n        this.listenerSetter.add(rootScope)('notify_settings', (update: Update.updateNotifySettings) => {\r\n          const inputKey = convertKeyToInputKey(update.peer._) as any;\r\n          if(options.inputKey === inputKey) {\r\n            notifySettings = update.notify_settings;\r\n            applySettings();\r\n          }\r\n        });\r\n      });\r\n    };\r\n\r\n    NotifySection({\r\n      name: 'NotificationsPrivateChats',\r\n      typeText: 'NotificationsForPrivateChats',\r\n      inputKey: 'inputNotifyUsers'\r\n    });\r\n\r\n    NotifySection({\r\n      name: 'NotificationsGroups',\r\n      typeText: 'NotificationsForGroups',\r\n      inputKey: 'inputNotifyChats'\r\n    });\r\n\r\n    NotifySection({\r\n      name: 'NotificationsChannels',\r\n      typeText: 'NotificationsForChannels',\r\n      inputKey: 'inputNotifyBroadcasts'\r\n    });\r\n\r\n    {\r\n      const section = new SettingSection({\r\n        name: 'NotificationsOther'\r\n      });\r\n\r\n      const contactsSignUpRow = new Row({\r\n        checkboxField: new CheckboxField({text: 'ContactJoined', checked: true}),\r\n        subtitleLangKey: 'Loading',\r\n        listenerSetter: this.listenerSetter\r\n      });\r\n\r\n      const soundRow = new Row({\r\n        checkboxField: new CheckboxField({text: 'Notifications.Sound', checked: true, stateKey: 'settings.notifications.sound', listenerSetter: this.listenerSetter}),\r\n        subtitleLangKey: 'Loading',\r\n        listenerSetter: this.listenerSetter\r\n      });\r\n\r\n      apiManagerProxy.getState().then((state) => {\r\n        soundRow.checkboxField.checked = state.settings.notifications.sound;\r\n      });\r\n\r\n      section.content.append(contactsSignUpRow.container, soundRow.container);\r\n\r\n      this.scrollable.append(section.container);\r\n\r\n      this.managers.appNotificationsManager.getContactSignUpNotification().then((enabled) => {\r\n        contactsSignUpRow.checkboxField.checked = enabled;\r\n\r\n        this.eventListener.addEventListener('destroy', () => {\r\n          const _enabled = contactsSignUpRow.checkboxField.checked;\r\n          if(enabled !== _enabled) {\r\n            this.managers.appNotificationsManager.setContactSignUpNotification(!_enabled);\r\n          }\r\n        }, {once: true});\r\n      });\r\n    }\r\n  }\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport {SettingSection} from '..';\r\nimport {randomLong} from '../../../helpers/random';\r\nimport I18n from '../../../lib/langPack';\r\nimport RadioField from '../../radioField';\r\nimport Row, {RadioFormFromRows} from '../../row';\r\nimport {SliderSuperTab} from '../../slider'\r\n\r\nexport default class AppLanguageTab extends SliderSuperTab {\r\n  protected async init() {\r\n    this.header.classList.add('with-border');\r\n    this.container.classList.add('language-container');\r\n    this.setTitle('Telegram.LanguageViewController');\r\n\r\n    const section = new SettingSection({});\r\n\r\n    const radioRows: Map<string, Row> = new Map();\r\n\r\n    const promise = Promise.all([\r\n      this.managers.apiManager.invokeApiCacheable('langpack.getLanguages', {\r\n        lang_pack: 'web'\r\n      }),\r\n      this.managers.apiManager.invokeApiCacheable('langpack.getLanguages', {\r\n        lang_pack: 'macos'\r\n      }),\r\n    ]).then(([languages1, languages2]) => {\r\n      const rendered: Set<string> = new Set();\r\n      const webLangCodes = languages1.map((language) => language.lang_code);\r\n\r\n      const random = randomLong();\r\n      languages1.concat(languages2).forEach((language) => {\r\n        if(rendered.has(language.lang_code)) return;\r\n        rendered.add(language.lang_code);\r\n\r\n        const row = new Row({\r\n          radioField: new RadioField({\r\n            text: language.name,\r\n            name: random,\r\n            value: language.lang_code\r\n          }),\r\n          subtitle: language.native_name\r\n        });\r\n\r\n        radioRows.set(language.lang_code, row);\r\n      });\r\n\r\n      const form = RadioFormFromRows([...radioRows.values()], (value) => {\r\n        I18n.getLangPack(value, webLangCodes.includes(value));\r\n      });\r\n\r\n      I18n.getCacheLangPack().then((langPack) => {\r\n        const row = radioRows.get(langPack.lang_code);\r\n        if(!row) {\r\n          console.error('no row', row, langPack);\r\n          return;\r\n        }\r\n\r\n        row.radioField.setValueSilently(true);\r\n      });\r\n\r\n      section.content.append(form);\r\n    });\r\n\r\n    this.scrollable.append(section.container);\r\n\r\n    return promise;\r\n  }\r\n}\r\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport type ListenerSetter from '../../../../helpers/listenerSetter';\nimport {SettingSection} from '../..';\nimport {LangPackKey} from '../../../../lib/langPack';\nimport CheckboxField from '../../../checkboxField';\nimport {SliderSuperTabEventable} from '../../../sliderTab';\n\nexport function autoDownloadPeerTypeSection(type: 'photo' | 'video' | 'file', title: LangPackKey, listenerSetter: ListenerSetter) {\n  const section = new SettingSection({name: title});\n\n  const key = 'settings.autoDownload.' + type + '.';\n  const contactsCheckboxField = new CheckboxField({\n    text: 'AutodownloadContacts',\n    name: 'contacts',\n    stateKey: key + 'contacts',\n    withRipple: true,\n    listenerSetter\n  });\n  const privateCheckboxField = new CheckboxField({\n    text: 'AutodownloadPrivateChats',\n    name: 'private',\n    stateKey: key + 'private',\n    withRipple: true,\n    listenerSetter\n  });\n  const groupsCheckboxField = new CheckboxField({\n    text: 'AutodownloadGroupChats',\n    name: 'groups',\n    stateKey: key + 'groups',\n    withRipple: true,\n    listenerSetter\n  });\n  const channelsCheckboxField = new CheckboxField({\n    text: 'AutodownloadChannels',\n    name: 'channels',\n    stateKey: key + 'channels',\n    withRipple: true,\n    listenerSetter\n  });\n\n  section.content.append(\n    contactsCheckboxField.label,\n    privateCheckboxField.label,\n    groupsCheckboxField.label,\n    channelsCheckboxField.label\n  );\n\n  return section;\n}\n\nexport default class AppAutoDownloadPhotoTab extends SliderSuperTabEventable {\n  protected init() {\n    this.header.classList.add('with-border');\n    this.setTitle('AutoDownloadPhotos');\n\n    const section = autoDownloadPeerTypeSection('photo', 'AutoDownloadPhotosTitle', this.listenerSetter);\n    this.scrollable.append(section.container);\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport formatBytes from '../../../../helpers/formatBytes';\nimport debounce from '../../../../helpers/schedulers/debounce';\nimport I18n from '../../../../lib/langPack';\nimport rootScope from '../../../../lib/rootScope';\nimport {SliderSuperTabEventable} from '../../../sliderTab';\nimport {RangeSettingSelector} from '../generalSettings';\nimport {autoDownloadPeerTypeSection} from './photo';\n\nexport default class AppAutoDownloadFileTab extends SliderSuperTabEventable {\n  protected init() {\n    this.header.classList.add('with-border');\n    this.setTitle('AutoDownloadFiles');\n\n    const debouncedSave = debounce((sizeMax: number) => {\n      this.managers.appStateManager.setByKey('settings.autoDownloadNew.file_size_max', sizeMax);\n    }, 200, false, true);\n\n    const section = autoDownloadPeerTypeSection('file', 'AutoDownloadFilesTitle', this.listenerSetter);\n\n    const MIN = 512 * 1024;\n    // const MAX = 2 * 1024 * 1024 * 1024;\n    const MAX = 20 * 1024 * 1024;\n    const MAX_RANGE = MAX - MIN;\n\n    const sizeMax = rootScope.settings.autoDownloadNew.file_size_max;\n    const value = Math.sqrt(Math.sqrt((sizeMax - MIN) / MAX_RANGE));\n    const upTo = new I18n.IntlElement({\n      key: 'AutodownloadSizeLimitUpTo',\n      args: [formatBytes(sizeMax)]\n    });\n    const range = new RangeSettingSelector('AutoDownloadMaxFileSize', 0.01, value, 0, 1, false);\n    range.onChange = (value) => {\n      const sizeMax = (value ** 4 * MAX_RANGE + MIN) | 0;\n\n      upTo.compareAndUpdate({args: [formatBytes(sizeMax)]});\n\n      debouncedSave(sizeMax);\n    };\n\n    range.valueContainer.append(upTo.element);\n\n    section.content.append(range.container);\n\n    this.scrollable.append(section.container);\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport {SliderSuperTabEventable} from '../../../sliderTab';\nimport {autoDownloadPeerTypeSection} from './photo';\n\nexport default class AppAutoDownloadVideoTab extends SliderSuperTabEventable {\n  protected init() {\n    this.header.classList.add('with-border');\n    this.setTitle('AutoDownloadVideos');\n\n    const section = autoDownloadPeerTypeSection('video', 'AutoDownloadVideosTitle', this.listenerSetter);\n    this.scrollable.append(section.container);\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport {AutoDownloadPeerTypeSettings, STATE_INIT} from '../../../config/state';\nimport {SettingSection} from '..';\nimport {attachClickEvent} from '../../../helpers/dom/clickEvent';\nimport replaceContent from '../../../helpers/dom/replaceContent';\nimport toggleDisability from '../../../helpers/dom/toggleDisability';\nimport formatBytes from '../../../helpers/formatBytes';\nimport copy from '../../../helpers/object/copy';\nimport deepEqual from '../../../helpers/object/deepEqual';\nimport {FormatterArguments, i18n, join, LangPackKey} from '../../../lib/langPack';\nimport rootScope from '../../../lib/rootScope';\nimport Button from '../../button';\nimport CheckboxField from '../../checkboxField';\nimport confirmationPopup from '../../confirmationPopup';\nimport Row from '../../row';\nimport {SliderSuperTabEventable, SliderSuperTabEventableConstructable} from '../../sliderTab';\nimport AppAutoDownloadFileTab from './autoDownload/file';\nimport AppAutoDownloadPhotoTab from './autoDownload/photo';\nimport AppAutoDownloadVideoTab from './autoDownload/video';\nimport apiManagerProxy from '../../../lib/mtproto/mtprotoworker';\n\nconst AUTO_DOWNLOAD_FOR_KEYS: {[k in keyof AutoDownloadPeerTypeSettings]: LangPackKey} = {\n  contacts: 'AutoDownloadContacts',\n  private: 'AutoDownloadPm',\n  groups: 'AutoDownloadGroups',\n  channels: 'AutoDownloadChannels'\n};\n\nexport default class AppDataAndStorageTab extends SliderSuperTabEventable {\n  protected async init() {\n    this.header.classList.add('with-border');\n    this.setTitle('DataSettings');\n\n    {\n      const section = new SettingSection({name: 'AutomaticMediaDownload', caption: 'AutoDownloadAudioInfo'});\n\n      const state = await apiManagerProxy.getState();\n\n      const autoCheckboxField = new CheckboxField({\n        text: 'AutoDownloadMedia',\n        name: 'auto',\n        checked: !state.settings.autoDownloadNew.pFlags.disabled,\n        withRipple: true\n      });\n\n      const onChange = () => {\n        toggleDisability([resetButton],\n          deepEqual(state.settings.autoDownload, STATE_INIT.settings.autoDownload) &&\n          deepEqual(state.settings.autoDownloadNew, STATE_INIT.settings.autoDownloadNew));\n      };\n\n      const setSubtitles = () => {\n        this.setAutoDownloadSubtitle(photoRow, state.settings.autoDownload.photo /* state.settings.autoDownloadNew.photo_size_max */);\n        this.setAutoDownloadSubtitle(videoRow, state.settings.autoDownload.video/* , state.settings.autoDownloadNew.video_size_max */);\n        this.setAutoDownloadSubtitle(fileRow, state.settings.autoDownload.file, state.settings.autoDownloadNew.file_size_max);\n      };\n\n      const openTab = (tabConstructor: SliderSuperTabEventableConstructable) => {\n        const tab = new tabConstructor(this.slider, true);\n        tab.open();\n\n        this.listenerSetter.add(tab.eventListener)('destroy', () => {\n          setSubtitles();\n          onChange();\n        }, {once: true});\n      };\n\n      const photoRow = new Row({\n        titleLangKey: 'AutoDownloadPhotos',\n        subtitle: '',\n        clickable: () => {\n          openTab(AppAutoDownloadPhotoTab);\n        },\n        listenerSetter: this.listenerSetter\n      });\n\n      const videoRow = new Row({\n        titleLangKey: 'AutoDownloadVideos',\n        subtitle: '',\n        clickable: () => {\n          openTab(AppAutoDownloadVideoTab);\n        },\n        listenerSetter: this.listenerSetter\n      });\n\n      const fileRow = new Row({\n        titleLangKey: 'AutoDownloadFiles',\n        subtitle: '',\n        clickable: () => {\n          openTab(AppAutoDownloadFileTab);\n        },\n        listenerSetter: this.listenerSetter\n      });\n\n      const resetButton = Button('btn-primary btn-transparent primary', {icon: 'delete', text: 'ResetAutomaticMediaDownload'});\n      attachClickEvent(resetButton, () => {\n        confirmationPopup({\n          titleLangKey: 'ResetAutomaticMediaDownloadAlertTitle',\n          descriptionLangKey: 'ResetAutomaticMediaDownloadAlert',\n          button: {\n            langKey: 'Reset'\n          }\n        }).then(() => {\n          const settings = rootScope.settings;\n          settings.autoDownloadNew = copy(STATE_INIT.settings.autoDownloadNew);\n          settings.autoDownload = copy(STATE_INIT.settings.autoDownload);\n          this.managers.appStateManager.setByKey('settings', settings);\n\n          setSubtitles();\n          autoCheckboxField.checked = !state.settings.autoDownloadNew.pFlags.disabled;\n        });\n      });\n\n      const onDisabledChange = () => {\n        const disabled = !autoCheckboxField.checked;\n\n        const settings = rootScope.settings;\n        if(disabled) {\n          settings.autoDownloadNew.pFlags.disabled = true;\n        } else {\n          delete settings.autoDownloadNew.pFlags.disabled;\n        }\n\n        [photoRow, videoRow, fileRow].forEach((row) => {\n          row.container.classList.toggle('is-disabled', disabled);\n        });\n\n        this.managers.appStateManager.setByKey('settings', settings);\n\n        onChange();\n      };\n\n      autoCheckboxField.input.addEventListener('change', onDisabledChange);\n      onDisabledChange();\n      setSubtitles();\n\n      section.content.append(\n        autoCheckboxField.label,\n        photoRow.container,\n        videoRow.container,\n        fileRow.container,\n        resetButton\n      );\n\n      this.scrollable.append(section.container);\n    }\n\n    {\n      const section = new SettingSection({name: 'AutoplayMedia'});\n\n      const gifsCheckboxField = new CheckboxField({\n        text: 'AutoplayGIF',\n        name: 'gifs',\n        stateKey: 'settings.autoPlay.gifs',\n        withRipple: true,\n        listenerSetter: this.listenerSetter\n      });\n      const videosCheckboxField = new CheckboxField({\n        text: 'AutoplayVideo',\n        name: 'videos',\n        stateKey: 'settings.autoPlay.videos',\n        withRipple: true,\n        listenerSetter: this.listenerSetter\n      });\n\n      section.content.append(gifsCheckboxField.label, videosCheckboxField.label);\n\n      this.scrollable.append(section.container);\n    }\n  }\n\n  private setAutoDownloadSubtitle(row: Row, settings: AutoDownloadPeerTypeSettings, sizeMax?: number) {\n    let key: LangPackKey;\n    const args: FormatterArguments = [];\n\n    const peerKeys = Object.keys(settings) as (keyof typeof AUTO_DOWNLOAD_FOR_KEYS)[];\n    const enabledKeys = peerKeys.map((key) => settings[key] ? AUTO_DOWNLOAD_FOR_KEYS[key] : undefined).filter(Boolean);\n    if(!enabledKeys.length || sizeMax === 0) {\n      key = 'AutoDownloadOff';\n    } else {\n      const isAll = enabledKeys.length === peerKeys.length;\n      if(sizeMax !== undefined) {\n        key = isAll ? 'AutoDownloadUpToOnAllChats' : 'AutoDownloadOnUpToFor';\n        args.push(formatBytes(sizeMax));\n      } else {\n        key = isAll ? 'AutoDownloadOnAllChats' : 'AutoDownloadOnFor';\n      }\n\n      if(!isAll) {\n        const fragment = document.createElement('span');\n        fragment.append(...join(enabledKeys.map((key) => i18n(key)), true, false));\n        args.push(fragment);\n      }\n    }\n\n    replaceContent(row.subtitle, i18n(key, args));\n  }\n}\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport {SliderSuperTab} from '../../slider';\r\nimport ButtonMenuToggle from '../../buttonMenuToggle';\r\nimport Button from '../../button';\r\nimport AppPrivacyAndSecurityTab from './privacyAndSecurity';\r\nimport AppGeneralSettingsTab from './generalSettings';\r\nimport AppEditProfileTab from './editProfile';\r\nimport AppChatFoldersTab from './chatFolders';\r\nimport AppNotificationsTab from './notifications';\r\nimport AppLanguageTab from './language';\r\nimport lottieLoader from '../../../lib/rlottie/lottieLoader';\r\nimport PopupPeer from '../../popups/peer';\r\nimport AppDataAndStorageTab from './dataAndStorage';\r\nimport ButtonIcon from '../../buttonIcon';\r\nimport PeerProfile from '../../peerProfile';\r\nimport rootScope from '../../../lib/rootScope';\r\nimport {SettingSection} from '..';\r\nimport Row from '../../row';\r\nimport AppActiveSessionsTab from './activeSessions';\r\nimport {i18n, LangPackKey} from '../../../lib/langPack';\r\nimport {SliderSuperTabConstructable} from '../../sliderTab';\r\nimport PopupAvatar from '../../popups/avatar';\r\nimport {AccountAuthorizations, Authorization} from '../../../layer';\r\nimport PopupElement from '../../popups';\r\nimport {attachClickEvent} from '../../../helpers/dom/clickEvent';\r\n// import AppMediaViewer from \"../../appMediaViewerNew\";\r\n\r\nexport default class AppSettingsTab extends SliderSuperTab {\r\n  private buttons: {\r\n    edit: HTMLButtonElement,\r\n    folders: HTMLButtonElement,\r\n    general: HTMLButtonElement,\r\n    notifications: HTMLButtonElement,\r\n    storage: HTMLButtonElement,\r\n    privacy: HTMLButtonElement,\r\n  } = {} as any;\r\n  private profile: PeerProfile;\r\n\r\n  private languageRow: Row;\r\n  private devicesRow: Row;\r\n\r\n  private authorizations: Authorization.authorization[];\r\n  private getAuthorizationsPromise: Promise<AccountAuthorizations.accountAuthorizations>;\r\n\r\n  protected async init() {\r\n    this.container.classList.add('settings-container');\r\n    this.setTitle('Settings');\r\n\r\n    const btnMenu = ButtonMenuToggle({listenerSetter: this.listenerSetter}, 'bottom-left', [{\r\n      icon: 'logout',\r\n      text: 'EditAccount.Logout',\r\n      onClick: () => {\r\n        new PopupPeer('logout', {\r\n          titleLangKey: 'LogOut',\r\n          descriptionLangKey: 'LogOut.Description',\r\n          buttons: [{\r\n            langKey: 'LogOut',\r\n            callback: () => {\r\n              this.managers.apiManager.logOut();\r\n            },\r\n            isDanger: true\r\n          }]\r\n        }).show();\r\n      }\r\n    }]);\r\n\r\n    this.buttons.edit = ButtonIcon('edit');\r\n\r\n    this.header.append(this.buttons.edit, btnMenu);\r\n\r\n    this.profile = new PeerProfile(this.managers, this.scrollable, this.listenerSetter, false);\r\n    this.profile.init();\r\n    this.profile.setPeer(rootScope.myId);\r\n    const fillPromise = this.profile.fillProfileElements();\r\n\r\n    const changeAvatarBtn = Button('btn-circle btn-corner z-depth-1 profile-change-avatar', {icon: 'cameraadd'});\r\n    attachClickEvent(changeAvatarBtn, () => {\r\n      const canvas = document.createElement('canvas');\r\n      PopupElement.createPopup(PopupAvatar).open(canvas, (upload) => {\r\n        upload().then((inputFile) => {\r\n          return this.managers.appProfileManager.uploadProfilePhoto(inputFile);\r\n        });\r\n      });\r\n    }, {listenerSetter: this.listenerSetter});\r\n    this.profile.element.lastElementChild.firstElementChild.append(changeAvatarBtn);\r\n\r\n    const updateChangeAvatarBtn = async() => {\r\n      const user = await this.managers.appUsersManager.getSelf();\r\n      changeAvatarBtn.classList.toggle('hide', user.photo?._ !== 'userProfilePhoto');\r\n    };\r\n\r\n    updateChangeAvatarBtn();\r\n    this.listenerSetter.add(rootScope)('avatar_update', (peerId) => {\r\n      if(rootScope.myId === peerId) {\r\n        updateChangeAvatarBtn();\r\n      }\r\n    });\r\n\r\n    /* const div = document.createElement('div');\r\n    //div.style.cssText = 'border-radius: 8px; overflow: hidden; width: 396px; height: 264px; flex: 0 0 auto; position: relative; margin: 10rem 0 10rem auto;';\r\n    //div.style.width = '135px';\r\n    //div.style.height = '100px';\r\n    div.style.cssText = 'border-radius: 8px; overflow: hidden; width: 396px; height: 264px; flex: 0 0 auto; position: relative; margin: 10rem auto 10rem 0;';\r\n    div.style.width = '135px';\r\n    div.style.height = '100px';\r\n\r\n    const img = document.createElement('img');\r\n    img.src = 'assets/img/pepe.jpg';\r\n    img.classList.add('media-photo');\r\n    img.style.cssText = 'max-width: 100%;max-height: 100%;';\r\n\r\n    div.append(img);\r\n\r\n    div.addEventListener('click', () => {\r\n      new AppMediaViewer().setSearchContext({peerId: 61004386, inputFilter: 'inputMessagesFilterPhotos'}).openMedia({\r\n        _: 'message',\r\n        mid: 1,\r\n        peerId: 61004386,\r\n        fromId: 61004386,\r\n        message: '',\r\n        media: {\r\n          _: 'messageMediaPhoto',\r\n          photo: {\r\n            _: 'photo',\r\n            url: img.src,\r\n            downloaded: 111,\r\n            sizes: [{\r\n              _: 'photoSize',\r\n              type: 'x',\r\n              w: 618,\r\n              h: 412\r\n            }]\r\n          }\r\n        },\r\n        date: Date.now() / 1000 | 0\r\n      }, img);\r\n    });\r\n\r\n    this.scrollable.append(div); */\r\n\r\n    const buttonsDiv = document.createElement('div');\r\n    buttonsDiv.classList.add('profile-buttons');\r\n\r\n    const b: [string, LangPackKey, SliderSuperTabConstructable][] = [\r\n      ['unmute', 'AccountSettings.Notifications', AppNotificationsTab],\r\n      ['data', 'DataSettings', AppDataAndStorageTab],\r\n      ['lock', 'AccountSettings.PrivacyAndSecurity', AppPrivacyAndSecurityTab],\r\n      ['settings', 'Telegram.GeneralSettingsViewController', AppGeneralSettingsTab],\r\n      ['folder', 'AccountSettings.Filters', AppChatFoldersTab]\r\n    ];\r\n\r\n    const rows = b.map(([icon, langPackKey, tabConstructor]) => {\r\n      return new Row({\r\n        titleLangKey: langPackKey,\r\n        icon,\r\n        clickable: () => {\r\n          this.slider.createTab(tabConstructor).open();\r\n          // new tabConstructor(this.slider, true).open();\r\n        },\r\n        listenerSetter: this.listenerSetter\r\n      });\r\n    });\r\n\r\n    rows.push(\r\n      this.devicesRow = new Row({\r\n        titleLangKey: 'Devices',\r\n        titleRightSecondary: ' ',\r\n        icon: 'activesessions',\r\n        clickable: async() => {\r\n          if(!this.authorizations) {\r\n            await this.updateActiveSessions();\r\n          }\r\n\r\n          const tab = this.slider.createTab(AppActiveSessionsTab);\r\n          tab.authorizations = this.authorizations;\r\n          tab.eventListener.addEventListener('destroy', () => {\r\n            this.authorizations = undefined;\r\n            this.updateActiveSessions(true);\r\n          }, {once: true});\r\n          tab.open();\r\n        },\r\n        listenerSetter: this.listenerSetter\r\n      }),\r\n\r\n      this.languageRow = new Row({\r\n        titleLangKey: 'AccountSettings.Language',\r\n        titleRightSecondary: i18n('LanguageName'),\r\n        icon: 'language',\r\n        clickable: () => {\r\n          this.slider.createTab(AppLanguageTab).open();\r\n        },\r\n        listenerSetter: this.listenerSetter\r\n      })\r\n    );\r\n\r\n    buttonsDiv.append(...rows.map((row) => row.container));\r\n\r\n    // const profileSection = new SettingSection({fullWidth: true, noPaddingTop: true});\r\n    // profileSection.content.append(this.profile.element);\r\n\r\n    const buttonsSection = new SettingSection();\r\n    buttonsSection.content.append(buttonsDiv);\r\n\r\n    this.scrollable.append(this.profile.element/* profileSection.container */, buttonsSection.container);\r\n\r\n    attachClickEvent(this.buttons.edit, () => {\r\n      const tab = this.slider.createTab(AppEditProfileTab);\r\n      tab.open();\r\n    }, {listenerSetter: this.listenerSetter});\r\n\r\n    lottieLoader.loadLottieWorkers();\r\n\r\n    this.updateActiveSessions();\r\n\r\n    await fillPromise;\r\n  }\r\n\r\n  private getAuthorizations(overwrite?: boolean) {\r\n    if(this.getAuthorizationsPromise && !overwrite) return this.getAuthorizationsPromise;\r\n\r\n    const promise = this.getAuthorizationsPromise = this.managers.apiManager.invokeApi('account.getAuthorizations')\r\n    .finally(() => {\r\n      if(this.getAuthorizationsPromise === promise) {\r\n        this.getAuthorizationsPromise = undefined;\r\n      }\r\n    });\r\n\r\n    return promise;\r\n  }\r\n\r\n  public updateActiveSessions(overwrite?: boolean) {\r\n    return this.getAuthorizations(overwrite).then((auths) => {\r\n      this.authorizations = auths.authorizations;\r\n      this.devicesRow.titleRight.textContent = '' + this.authorizations.length;\r\n    });\r\n  }\r\n\r\n  public onCloseAfterTimeout() {\r\n    this.profile.destroy();\r\n    return super.onCloseAfterTimeout();\r\n  }\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport appSidebarLeft, {SettingSection} from '..';\r\nimport {InputFile} from '../../../layer';\r\nimport InputField from '../../inputField';\r\nimport {SliderSuperTab} from '../../slider';\r\nimport AvatarEdit from '../../avatarEdit';\r\nimport AppAddMembersTab from './addMembers';\r\nimport {_i18n} from '../../../lib/langPack';\r\nimport ButtonCorner from '../../buttonCorner';\r\nimport appImManager from '../../../lib/appManagers/appImManager';\r\nimport {attachClickEvent} from '../../../helpers/dom/clickEvent';\r\n\r\nexport default class AppNewChannelTab extends SliderSuperTab {\r\n  private uploadAvatar: () => Promise<InputFile> = null;\r\n\r\n  private channelNameInputField: InputField;\r\n  private channelDescriptionInputField: InputField;\r\n  private nextBtn: HTMLButtonElement;\r\n  private avatarEdit: AvatarEdit;\r\n\r\n  protected init() {\r\n    this.container.classList.add('new-channel-container');\r\n    this.setTitle('NewChannel');\r\n\r\n    this.avatarEdit = new AvatarEdit((_upload) => {\r\n      this.uploadAvatar = _upload;\r\n    });\r\n\r\n    const section = new SettingSection({\r\n      caption: 'Channel.DescriptionHolderDescrpiton'\r\n    });\r\n\r\n    const inputWrapper = document.createElement('div');\r\n    inputWrapper.classList.add('input-wrapper');\r\n\r\n    this.channelNameInputField = new InputField({\r\n      label: 'EnterChannelName',\r\n      maxLength: 128\r\n    });\r\n\r\n    this.channelDescriptionInputField = new InputField({\r\n      label: 'DescriptionOptionalPlaceholder',\r\n      maxLength: 255\r\n    });\r\n\r\n    inputWrapper.append(this.channelNameInputField.container, this.channelDescriptionInputField.container);\r\n\r\n    const onLengthChange = () => {\r\n      this.nextBtn.classList.toggle('is-visible', !!this.channelNameInputField.value.length &&\r\n        !this.channelNameInputField.input.classList.contains('error') &&\r\n        !this.channelDescriptionInputField.input.classList.contains('error'));\r\n    };\r\n\r\n    this.channelNameInputField.input.addEventListener('input', onLengthChange);\r\n    this.channelDescriptionInputField.input.addEventListener('input', onLengthChange);\r\n\r\n    this.nextBtn = ButtonCorner({icon: 'arrow_next'});\r\n\r\n    attachClickEvent(this.nextBtn, () => {\r\n      const title = this.channelNameInputField.value;\r\n      const about = this.channelDescriptionInputField.value;\r\n\r\n      this.nextBtn.disabled = true;\r\n      this.managers.appChatsManager.createChannel({\r\n        title,\r\n        about,\r\n        broadcast: true\r\n      }).then((channelId) => {\r\n        if(this.uploadAvatar) {\r\n          this.uploadAvatar().then((inputFile) => {\r\n            this.managers.appChatsManager.editPhoto(channelId, inputFile);\r\n          });\r\n        }\r\n\r\n        appImManager.setInnerPeer({peerId: channelId.toPeerId(true)});\r\n\r\n        appSidebarLeft.removeTabFromHistory(this);\r\n        this.slider.createTab(AppAddMembersTab).open({\r\n          type: 'channel',\r\n          skippable: true,\r\n          title: 'GroupAddMembers',\r\n          placeholder: 'SendMessageTo',\r\n          takeOut: (peerIds) => {\r\n            return this.managers.appChatsManager.inviteToChannel(channelId, peerIds);\r\n          }\r\n        });\r\n      });\r\n    }, {listenerSetter: this.listenerSetter});\r\n\r\n    this.content.append(this.nextBtn);\r\n    section.content.append(this.avatarEdit.container, inputWrapper);\r\n    this.scrollable.append(section.container);\r\n  }\r\n\r\n  public onCloseAfterTimeout() {\r\n    this.avatarEdit.clear();\r\n    this.uploadAvatar = null;\r\n    this.channelNameInputField.value = '';\r\n    this.channelDescriptionInputField.value = '';\r\n    this.nextBtn.disabled = false;\r\n    return super.onCloseAfterTimeout();\r\n  }\r\n}\r\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport InputField from '../inputField';\nimport PopupElement from '.';\nimport {attachClickEvent} from '../../helpers/dom/clickEvent';\nimport EditPeer from '../editPeer';\nimport {_i18n} from '../../lib/langPack';\nimport TelInputField from '../telInputField';\nimport {formatPhoneNumber} from '../../helpers/formatPhoneNumber';\nimport {toastNew} from '../toast';\n\nexport default class PopupCreateContact extends PopupElement {\n  constructor() {\n    super('popup-create-contact popup-send-photo popup-new-media', {closable: true, withConfirm: 'Add', title: 'AddContactTitle'});\n    this.construct();\n  }\n\n  private async construct() {\n    attachClickEvent(this.btnConfirm, () => {\n      const promise = this.managers.appUsersManager.importContact(nameInputField.value, lastNameInputField.value, telInputField.value);\n\n      promise.then(() => {\n        this.hide();\n      }, (err) => {\n        if(err.type === 'NO_USER') {\n          toastNew({langPackKey: 'Contacts.PhoneNumber.NotRegistred'});\n          editPeer.disabled = false;\n        }\n      });\n\n      editPeer.lockWithPromise(promise);\n    }, {listenerSetter: this.listenerSetter});\n\n    const inputFields: InputField[] = [];\n    const div = document.createElement('div');\n    div.classList.add('name-fields');\n    const nameInputField = new InputField({\n      label: 'FirstName',\n      name: 'create-contact-name',\n      maxLength: 70,\n      required: true\n    });\n    const lastNameInputField = new InputField({\n      label: 'LastName',\n      name: 'create-contact-lastname',\n      maxLength: 70\n    });\n    const telInputField = new TelInputField({required: true});\n    inputFields.push(nameInputField, lastNameInputField, telInputField);\n\n    const onInput = () => {\n      const name = nameInputField.value + ' ' + lastNameInputField.value;\n      // const abbr = getAbbreviation(name);\n      editPeer.avatarElem.peerTitle = name;\n      editPeer.avatarElem.update();\n    };\n\n    this.listenerSetter.add(nameInputField.input)('input', onInput);\n    this.listenerSetter.add(lastNameInputField.input)('input', onInput);\n\n    telInputField.validate = () => {\n      return !!telInputField.value.match(/\\d/);\n    };\n\n    const user = await this.managers.appUsersManager.getSelf();\n    const formatted = formatPhoneNumber(user.phone);\n    if(formatted.code) {\n      telInputField.value = '+' + formatted.code.country_code;\n    }\n\n    const editPeer = new EditPeer({\n      inputFields,\n      listenerSetter: this.listenerSetter,\n      doNotEditAvatar: true,\n      nextBtn: this.btnConfirm,\n      avatarSize: 100\n    });\n\n    div.append(nameInputField.container, lastNameInputField.container, editPeer.avatarElem);\n    this.container.append(div, telInputField.container);\n\n    this.show();\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport {SliderSuperTab} from '../../slider';\nimport appDialogsManager from '../../../lib/appManagers/appDialogsManager';\nimport InputSearch from '../../inputSearch';\nimport {IS_MOBILE} from '../../../environment/userAgent';\nimport {canFocus} from '../../../helpers/dom/canFocus';\nimport windowSize from '../../../helpers/windowSize';\nimport ButtonCorner from '../../buttonCorner';\nimport {attachClickEvent} from '../../../helpers/dom/clickEvent';\nimport PopupCreateContact from '../../popups/createContact';\nimport SortedUserList from '../../sortedUserList';\nimport {getMiddleware} from '../../../helpers/middleware';\nimport replaceContent from '../../../helpers/dom/replaceContent';\nimport rootScope from '../../../lib/rootScope';\nimport PopupElement from '../../popups';\n\n// TODO:    ,      \n\nexport default class AppContactsTab extends SliderSuperTab {\n  private inputSearch: InputSearch;\n  private middleware: ReturnType<typeof getMiddleware>;\n  private sortedUserList: SortedUserList;\n\n  protected init() {\n    this.container.id = 'contacts-container';\n\n    // this.list = appDialogsManager.createChatList(/* {avatarSize: 48, handheldsSize: 66} */);\n\n    const btnAdd = ButtonCorner({icon: 'add', className: 'is-visible'});\n    this.content.append(btnAdd);\n\n    attachClickEvent(btnAdd, () => {\n      PopupElement.createPopup(PopupCreateContact);\n    }, {listenerSetter: this.listenerSetter});\n\n    this.inputSearch = new InputSearch('Search', (value) => {\n      this.openContacts(value);\n    });\n\n    this.listenerSetter.add(rootScope)('contacts_update', async(userId) => {\n      const isContact = await this.managers.appUsersManager.isContact(userId);\n      const peerId = userId.toPeerId();\n      if(isContact) this.sortedUserList.add(peerId);\n      else this.sortedUserList.delete(peerId);\n    });\n\n    this.title.replaceWith(this.inputSearch.container);\n\n    this.middleware = getMiddleware();\n\n    // preload contacts\n    // appUsersManager.getContacts();\n  }\n\n  protected createList() {\n    const sortedUserList = new SortedUserList({\n      managers: this.managers\n    });\n    const list = sortedUserList.list;\n    list.id = 'contacts';\n    list.classList.add('contacts-container');\n    appDialogsManager.setListClickListener(list, () => {\n      this.close();\n    }, undefined, true);\n    return sortedUserList;\n  }\n\n  protected onClose() {\n    this.middleware.clean();\n    /* // need to clear, and left 1 page for smooth slide\n    let pageCount = appPhotosManager.windowH / 72 * 1.25 | 0;\n    (Array.from(this.list.children) as HTMLElement[]).slice(pageCount).forEach((el) => el.remove()); */\n  }\n\n  protected onOpenAfterTimeout() {\n    if(IS_MOBILE || !canFocus(true)) return;\n    this.inputSearch.input.focus();\n  }\n\n  public openContacts(query?: string) {\n    if(this.init) {\n      this.init();\n      this.init = null;\n    }\n\n    this.middleware.clean();\n    const middleware = this.middleware.get();\n    this.scrollable.onScrolledBottom = null;\n    this.scrollable.container.textContent = '';\n\n    this.managers.appUsersManager.getContactsPeerIds(query, undefined, 'online').then((contacts) => {\n      if(!middleware()) {\n        return;\n      }\n\n      const sortedUserList = this.sortedUserList = this.createList();\n\n      let renderPage = () => {\n        const pageCount = windowSize.height / 72 * 1.25 | 0;\n        const arr = contacts.splice(0, pageCount); //  splice!\n\n        arr.forEach((peerId) => {\n          sortedUserList.add(peerId);\n        });\n\n        if(!contacts.length) {\n          renderPage = undefined;\n          this.scrollable.onScrolledBottom = null;\n        }\n      };\n\n      renderPage();\n      this.scrollable.onScrolledBottom = () => {\n        if(renderPage) {\n          renderPage();\n        } else {\n          this.scrollable.onScrolledBottom = null;\n        }\n      };\n\n      replaceContent(this.scrollable.container, sortedUserList.list);\n    });\n  }\n\n  public open() {\n    this.openContacts();\n    return super.open();\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport appDialogsManager from '../../../lib/appManagers/appDialogsManager';\nimport {SliderSuperTab} from '../../slider';\nimport {FOLDER_ID_ARCHIVE, REAL_FOLDER_ID} from '../../../lib/mtproto/mtproto_config';\n\nexport default class AppArchivedTab extends SliderSuperTab {\n  private static filterId: REAL_FOLDER_ID = FOLDER_ID_ARCHIVE;\n  private wasFilterId: number;\n\n  protected init() {\n    this.wasFilterId = appDialogsManager.filterId;\n\n    this.container.id = 'chats-archived-container';\n    this.setTitle('ArchivedChats');\n\n    if(!appDialogsManager.sortedLists[AppArchivedTab.filterId]) {\n      const chatList = appDialogsManager.createChatList();\n      const scrollable = appDialogsManager.generateScrollable(chatList, {\n        title: undefined,\n        id: AppArchivedTab.filterId,\n        localId: FOLDER_ID_ARCHIVE\n      });\n      scrollable.container.append(chatList);\n      appDialogsManager.setListClickListener(chatList, null, true);\n      // appDialogsManager.setListClickListener(archivedChatList, null, true); // * to test peer changing\n    }\n\n    const scrollable = appDialogsManager.scrollables[AppArchivedTab.filterId];\n    this.scrollable.container.replaceWith(scrollable.container);\n    this.scrollable = scrollable;\n\n    return appDialogsManager.setFilterIdAndChangeTab(AppArchivedTab.filterId).then(({cached, renderPromise}) => {\n      if(cached) {\n        return renderPromise;\n      }\n    });\n  }\n\n  // ,   ,         ...\n  onOpenAfterTimeout() {\n    appDialogsManager.sortedLists[this.wasFilterId].clear();\n  }\n\n  onClose() {\n    appDialogsManager.setFilterIdAndChangeTab(this.wasFilterId);\n  }\n\n  onCloseAfterTimeout() {\n    appDialogsManager.sortedLists[AppArchivedTab.filterId].clear();\n    return super.onCloseAfterTimeout();\n  }\n}\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport {SliderSuperTab} from '../../slider';\r\nimport ButtonCorner from '../../buttonCorner';\r\nimport AppNewGroupTab from './newGroup';\r\nimport {toast} from '../../toast';\r\nimport {ButtonMenuItemOptions} from '../../buttonMenu';\r\nimport {i18n, join, _i18n} from '../../../lib/langPack';\r\nimport rootScope from '../../../lib/rootScope';\r\nimport {wrapSticker} from '../../wrappers';\r\nimport SortedUserList from '../../sortedUserList';\r\nimport {PeerLocated, Update, Updates} from '../../../layer';\r\nimport {SettingChatListSection} from '..';\r\nimport appDialogsManager from '../../../lib/appManagers/appDialogsManager';\r\nimport {attachClickEvent} from '../../../helpers/dom/clickEvent';\r\nimport confirmationPopup from '../../confirmationPopup';\r\nimport getPeerId from '../../../lib/appManagers/utils/peers/getPeerId';\r\nimport type LazyLoadQueue from '../../lazyLoadQueue';\r\n\r\nexport default class AppPeopleNearbyTab extends SliderSuperTab {\r\n  private latestLocationSaved: {latitude: number, longitude: number, accuracy: number};\r\n  private isLocationWatched: boolean = false;\r\n  private errorCategory: HTMLElement;\r\n  private retryBtn: HTMLButtonElement;\r\n  private btnOptions: HTMLButtonElement;\r\n  private menuButtons: (ButtonMenuItemOptions & {verify?: () => boolean})[];\r\n\r\n  protected lazyLoadQueue: LazyLoadQueue;\r\n  protected peopleSection: SettingChatListSection;\r\n  protected chatsSection: SettingChatListSection;\r\n\r\n  protected locatedPeers: Map<PeerId, PeerLocated.peerLocated>;\r\n\r\n  // protected async init() {\r\n  //   this.container.classList.add('people-nearby-container');\r\n  //   this.setTitle('PeopleNearby');\r\n\r\n  //   this.errorCategory = document.createElement('div');\r\n  //   this.errorCategory.classList.add('text', 'hide', 'nearby-error');\r\n\r\n  //   this.retryBtn = ButtonCorner({icon: 'check'});\r\n\r\n  //   const emoji = '';\r\n  //   const doc = await this.managers.appStickersManager.getAnimatedEmojiSticker(emoji);\r\n  //   const stickerContainer = document.createElement('div');\r\n  //   stickerContainer.classList.add('sticker-container');\r\n\r\n  //   if(doc) {\r\n  //     wrapSticker({\r\n  //       doc,\r\n  //       div: stickerContainer,\r\n  //       loop: false,\r\n  //       play: true,\r\n  //       width: 86,\r\n  //       height: 86,\r\n  //       emoji,\r\n  //       needUpscale: true\r\n  //     }).then(() => {\r\n  //       // this.animation = player;\r\n  //     });\r\n  //   } else {\r\n  //     stickerContainer.classList.add('media-sticker-wrapper');\r\n  //   }\r\n\r\n  //   const caption = document.createElement('div');\r\n  //   caption.classList.add('caption');\r\n  //   _i18n(caption, 'PeopleNearbyInfo2');\r\n\r\n  //   this.locatedPeers = new Map();\r\n\r\n  //   const m = () => {\r\n  //     const sortedUserList = new SortedUserList({\r\n  //       avatarSize: 42,\r\n  //       createChatListOptions: {\r\n  //         dialogSize: 48,\r\n  //         new: true\r\n  //       },\r\n  //       autonomous: false,\r\n  //       onUpdate: (element) => {\r\n  //         const peer = this.locatedPeers.get(element.id);\r\n  //         const elements: HTMLElement[] = [\r\n  //           this.parseDistance(peer.distance)\r\n  //         ];\r\n\r\n  //         if(!element.id.isUser()) {\r\n  //           elements.push(this.managers.appProfileManager.getChatMembersString(element.id.toChatId()));\r\n  //         }\r\n\r\n  //         element.dom.lastMessageSpan.textContent = '';\r\n  //         element.dom.lastMessageSpan.append(...join(elements, false));\r\n  //       },\r\n  //       getIndex: (element) => {\r\n  //         const peer = this.locatedPeers.get(element.id);\r\n  //         return 0x7FFFFFFF - peer.distance;\r\n  //       },\r\n  //       appUsersManager: this.managers.appUsersManager\r\n  //     });\r\n\r\n  //     appDialogsManager.setListClickListener(sortedUserList.list, undefined, undefined, false);\r\n\r\n  //     return sortedUserList;\r\n  //   };\r\n\r\n  //   const peopleSection = this.peopleSection = new SettingChatListSection({\r\n  //     name: 'PeopleNearbyHeader',\r\n  //     sortedList: m()\r\n  //   });\r\n\r\n  //   const chatsSection = this.chatsSection = new SettingChatListSection({\r\n  //     name: 'ChatsNearbyHeader',\r\n  //     sortedList: m()\r\n  //   });\r\n\r\n  //   const btnMakeVisible = peopleSection.makeButton({\r\n  //     text: 'MakeMyselfVisible',\r\n  //     icon: 'location'\r\n  //   });\r\n\r\n  //   const btnMakeInvisible = peopleSection.makeButton({\r\n  //     text: 'StopShowingMe',\r\n  //     icon: 'location'\r\n  //   });\r\n\r\n  //   const btnCreateGroup = chatsSection.makeButton({\r\n  //     text: 'NearbyCreateGroup',\r\n  //     icon: 'newgroup'\r\n  //   });\r\n\r\n  //   attachClickEvent(btnMakeVisible, () => {\r\n  //     confirmationPopup({\r\n  //       titleLangKey: 'MakeMyselfVisibleTitle',\r\n  //       descriptionLangKey: 'MakeMyselfVisibleInfo',\r\n  //       button: {\r\n  //         langKey: 'OK'\r\n  //       }\r\n  //     }).then(() => {\r\n  //       this.startWatching();\r\n  //     });\r\n  //   }, {listenerSetter: this.listenerSetter});\r\n\r\n  //   attachClickEvent(btnMakeInvisible, () => {\r\n  //     this.stopWatching();\r\n  //   }, {listenerSetter: this.listenerSetter});\r\n\r\n  //   attachClickEvent(btnCreateGroup, () => {\r\n  //     this.slider.createTab(AppNewGroupTab).open([], true);\r\n  //   }, {listenerSetter: this.listenerSetter});\r\n\r\n  //   btnMakeVisible.classList.add('primary');\r\n  //   btnMakeInvisible.classList.add('danger');\r\n  //   btnCreateGroup.classList.add('primary');\r\n\r\n  //   this.content.append(this.retryBtn);\r\n  //   this.scrollable.append(\r\n  //     stickerContainer,\r\n  //     caption,\r\n  //     peopleSection.container,\r\n  //     chatsSection.container,\r\n  //     this.errorCategory\r\n  //   );\r\n  // }\r\n\r\n  private parseDistance(distance: number) {\r\n    if(rootScope.settings.distanceUnit === 'miles') {\r\n      if(distance > 1609.34) {\r\n        return i18n('MilesAway', [Math.round(distance / 1609)]);\r\n      } else {\r\n        return i18n('FootsAway', [Math.round(distance * 3.281)]);\r\n      }\r\n    } else {\r\n      if(distance >= 1000) {\r\n        return i18n('KMetersAway2', [distance / 1000]);\r\n      } else {\r\n        return i18n('MetersAway2', [distance]);\r\n      }\r\n    }\r\n  }\r\n\r\n  public open() {\r\n    const result = super.open();\r\n    result.then(() => {\r\n      this.retryBtn.classList.remove('is-visible');\r\n      navigator.geolocation.getCurrentPosition((location) => {\r\n        this.latestLocationSaved = {\r\n          latitude: location.coords.latitude,\r\n          longitude: location.coords.longitude,\r\n          accuracy: location.coords.accuracy\r\n        };\r\n\r\n        console.log(this.latestLocationSaved);\r\n\r\n        this.managers.appUsersManager.getLocated(\r\n          location.coords.latitude,\r\n          location.coords.longitude,\r\n          location.coords.accuracy\r\n        ).then((response) => {\r\n          const update = (response as Updates.updates).updates[0] as Update.updatePeerLocated;\r\n          const peers = update.peers as PeerLocated.peerLocated[];\r\n          const orderedPeers = peers.sort((a, b) => a.distance - b.distance);\r\n          const groupsCounter = peers.filter((e) => e.peer._ == 'peerChannel').length;\r\n          const usersCounter = peers.filter((e) => e.peer._ != 'peerChannel').length;\r\n          orderedPeers?.forEach((peer) => {\r\n            const peerId = getPeerId(peer.peer);\r\n            const section = peerId.isUser() ? this.peopleSection : this.chatsSection;\r\n            this.locatedPeers.set(peerId, peer);\r\n            section.sortedList.add(peerId);\r\n          });\r\n\r\n          this.errorCategory.classList.toggle('hide', !!(usersCounter || groupsCounter));\r\n          this.errorCategory.innerHTML = 'No groups or channels found around you.';\r\n        });\r\n      }, (error) => {\r\n        this.errorCategory.classList.remove('hide');\r\n        this.retryBtn.classList.add('is-visible');\r\n        this.retryBtn.addEventListener('click', this.open);\r\n        if(error instanceof GeolocationPositionError) {\r\n          this.errorCategory.innerHTML = 'Location permission denied. Click below to retry.';\r\n        } else {\r\n          this.errorCategory.innerHTML = 'An error has occurred. Please retry later clicking the button below.';\r\n        }\r\n      });\r\n    });\r\n\r\n    return result;\r\n  }\r\n\r\n  private startWatching() {\r\n    if(!this.latestLocationSaved || this.isLocationWatched) return;\r\n    this.isLocationWatched = true;\r\n\r\n    toast('Your position is now being shared. Do not close the page or it will be suspended.');\r\n\r\n    this.managers.appUsersManager.getLocated(\r\n      this.latestLocationSaved.latitude,\r\n      this.latestLocationSaved.longitude,\r\n      this.latestLocationSaved.accuracy,\r\n      true, // background parameter\r\n      0x7fffffff // self_expires parameter\r\n    );\r\n\r\n    navigator.geolocation.watchPosition((result) => {\r\n      const isLongitudeDifferent = result.coords.longitude !== this.latestLocationSaved.longitude;\r\n      const isLatitudeDifferent = result.coords.latitude !== this.latestLocationSaved.latitude;\r\n      const distanceCheck = this.calculateDistance(\r\n        result.coords.latitude, result.coords.longitude,\r\n        this.latestLocationSaved.latitude, this.latestLocationSaved.longitude\r\n      ) > 100;\r\n\r\n      if((isLatitudeDifferent || isLongitudeDifferent) && distanceCheck) {\r\n        this.managers.appUsersManager.getLocated(\r\n          result.coords.latitude,\r\n          result.coords.longitude,\r\n          result.coords.accuracy,\r\n          true, // background parameter\r\n          0x7fffffff // self_expires parameter\r\n        );\r\n        this.latestLocationSaved = {\r\n          latitude: result.coords.latitude,\r\n          longitude: result.coords.longitude,\r\n          accuracy: result.coords.accuracy\r\n        }\r\n      }\r\n    });\r\n  }\r\n\r\n  private stopWatching() {\r\n    if(!this.isLocationWatched) return;\r\n    this.isLocationWatched = false;\r\n    toast('The sharing of your position has been stopped. You will no longer be visible to other users.');\r\n    this.managers.appUsersManager.getLocated(\r\n      0, // latitude parameter\r\n      0, // longitude parameter\r\n      0, // accuracy parameter\r\n      false, // background parameter\r\n      0 // self_expires parameter\r\n    );\r\n  }\r\n\r\n  private calculateDistance(lat1: number, long1: number, lat2: number, long2: number) {\r\n    const p = 0.017453292519943295; // Math.PI/180\r\n    return (\r\n      12742 * Math.asin(\r\n        Math.sqrt(\r\n          (0.5 - Math.cos((lat2 - lat1) * p)) +\r\n          (\r\n            Math.cos(lat1 * p) * Math.cos(lat2 * p) *\r\n            (1 - Math.cos((long2 - long1) * p)/2)\r\n          )\r\n        )\r\n      )\r\n    );\r\n  }\r\n}\r\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport appImManager from '../../lib/appManagers/appImManager';\nimport rootScope from '../../lib/rootScope';\nimport {SearchGroup} from '../appSearch';\nimport '../avatar';\nimport Scrollable, {ScrollableX} from '../scrollable';\nimport InputSearch from '../inputSearch';\nimport SidebarSlider from '../slider';\nimport {TransitionSlider} from '../transition';\nimport AppNewGroupTab from './tabs/newGroup';\nimport AppSearchSuper from '../appSearchSuper.';\nimport {DateData, fillTipDates} from '../../helpers/date';\nimport {MOUNT_CLASS_TO} from '../../config/debug';\nimport AppSettingsTab from './tabs/settings';\nimport AppNewChannelTab from './tabs/newChannel';\nimport AppContactsTab from './tabs/contacts';\nimport AppArchivedTab from './tabs/archivedTab';\nimport AppAddMembersTab from './tabs/addMembers';\nimport I18n, {FormatterArguments, i18n, i18n_, LangPackKey} from '../../lib/langPack';\nimport AppPeopleNearbyTab from './tabs/peopleNearby';\nimport {ButtonMenuItemOptions} from '../buttonMenu';\nimport CheckboxField from '../checkboxField';\nimport {IS_MOBILE_SAFARI} from '../../environment/userAgent';\nimport appNavigationController, {NavigationItem} from '../appNavigationController';\nimport findUpClassName from '../../helpers/dom/findUpClassName';\nimport findUpTag from '../../helpers/dom/findUpTag';\nimport PeerTitle from '../peerTitle';\nimport App from '../../config/app';\nimport ButtonMenuToggle from '../buttonMenuToggle';\nimport replaceContent from '../../helpers/dom/replaceContent';\nimport sessionStorage from '../../lib/sessionStorage';\nimport {attachClickEvent, CLICK_EVENT_NAME, simulateClickEvent} from '../../helpers/dom/clickEvent';\nimport ButtonIcon from '../buttonIcon';\nimport confirmationPopup from '../confirmationPopup';\nimport IS_GEOLOCATION_SUPPORTED from '../../environment/geolocationSupport';\nimport type SortedUserList from '../sortedUserList';\nimport Button, {ButtonOptions} from '../button';\nimport noop from '../../helpers/noop';\nimport ripple from '../ripple';\nimport indexOfAndSplice from '../../helpers/array/indexOfAndSplice';\nimport formatNumber from '../../helpers/number/formatNumber';\nimport AvatarElement from '../avatar';\nimport {AppManagers} from '../../lib/appManagers/managers';\nimport themeController from '../../helpers/themeController';\nimport contextMenuController from '../../helpers/contextMenuController';\nimport {DIALOG_LIST_ELEMENT_TAG} from '../../lib/appManagers/appDialogsManager';\nimport apiManagerProxy from '../../lib/mtproto/mtprotoworker';\n\nexport const LEFT_COLUMN_ACTIVE_CLASSNAME = 'is-left-column-shown';\n\nexport class AppSidebarLeft extends SidebarSlider {\n  private toolsBtn: HTMLElement;\n  private backBtn: HTMLButtonElement;\n  // private searchInput = document.getElementById('global-search') as HTMLInputElement;\n  private inputSearch: InputSearch;\n\n  public archivedCount: HTMLSpanElement;\n\n  private newBtnMenu: HTMLElement;\n\n  // private log = logger('SL');\n\n  private searchGroups: {[k in 'contacts' | 'globalContacts' | 'messages' | 'people' | 'recent']: SearchGroup} = {} as any;\n  private searchSuper: AppSearchSuper;\n\n  private updateBtn: HTMLElement;\n  private hasUpdate: boolean;\n\n  constructor() {\n    super({\n      sidebarEl: document.getElementById('column-left') as HTMLDivElement,\n      navigationType: 'left'\n    });\n  }\n\n  construct(managers: AppManagers) {\n    this.managers = managers;\n    // this._selectTab(0); // make first tab as default\n\n    this.inputSearch = new InputSearch('Search');\n    const sidebarHeader = this.sidebarEl.querySelector('.item-main .sidebar-header');\n    sidebarHeader.append(this.inputSearch.container);\n\n    const onNewGroupClick = () => {\n      this.createTab(AppAddMembersTab).open({\n        type: 'chat',\n        skippable: false,\n        takeOut: (peerIds) => {\n          this.createTab(AppNewGroupTab).open(peerIds);\n        },\n        title: 'GroupAddMembers',\n        placeholder: 'SendMessageTo'\n      });\n    };\n\n    const onContactsClick = () => {\n      this.createTab(AppContactsTab).open();\n    };\n\n    // this.toolsBtn = this.sidebarEl.querySelector('.sidebar-tools-button') as HTMLButtonElement;\n    this.backBtn = this.sidebarEl.querySelector('.sidebar-back-button') as HTMLButtonElement;\n\n    const btnArchive: typeof menuButtons[0] = {\n      icon: 'archive',\n      text: 'ArchivedChats',\n      onClick: () => {\n        this.createTab(AppArchivedTab).open();\n      },\n      verify: async() => {\n        const folder = await this.managers.dialogsStorage.getFolderDialogs(1, false);\n        return !!folder.length || !(await this.managers.dialogsStorage.isDialogsLoaded(1));\n      }\n    };\n\n    const themeCheckboxField = new CheckboxField({\n      toggle: true,\n      checked: themeController.getTheme().name === 'night'\n    });\n    themeCheckboxField.input.addEventListener('change', async() => {\n      await this.managers.appStateManager.setByKey('settings.theme', themeCheckboxField.input.checked ? 'night' : 'day');\n      rootScope.dispatchEvent('theme_change');\n    });\n\n    rootScope.addEventListener('theme_change', () => {\n      themeCheckboxField.setValueSilently(themeController.getTheme().name === 'night');\n    });\n\n    const menuButtons: (ButtonMenuItemOptions & {verify?: () => boolean | Promise<boolean>})[] = [{\n      icon: 'saved',\n      text: 'SavedMessages',\n      onClick: () => {\n        setTimeout(() => { // menu doesn't close if no timeout (lol)\n          appImManager.setPeer({\n            peerId: appImManager.myId\n          });\n        }, 0);\n      }\n    }, btnArchive, {\n      icon: 'user',\n      text: 'Contacts',\n      onClick: onContactsClick\n    }, IS_GEOLOCATION_SUPPORTED ? {\n      icon: 'group',\n      text: 'PeopleNearby',\n      onClick: () => {\n        this.createTab(AppPeopleNearbyTab).open();\n      }\n    } : undefined, {\n      icon: 'settings',\n      text: 'Settings',\n      onClick: () => {\n        this.createTab(AppSettingsTab).open();\n      }\n    }, {\n      icon: 'darkmode',\n      text: 'DarkMode',\n      onClick: () => {\n\n      },\n      checkboxField: themeCheckboxField\n    }, {\n      icon: 'animations',\n      text: 'Animations',\n      onClick: () => {\n\n      },\n      checkboxField: new CheckboxField({\n        toggle: true,\n        checked: true,\n        stateKey: 'settings.animationsEnabled'\n      })\n    }, {\n      icon: 'help',\n      text: 'TelegramFeatures',\n      onClick: () => {\n        const url = I18n.format('TelegramFeaturesUrl', true);\n        appImManager.openUrl(url);\n      }\n    }, {\n      icon: 'bug',\n      text: 'ReportBug',\n      onClick: () => {\n        const a = document.createElement('a');\n        a.target = '_blank';\n        a.href = 'https://bugs.telegram.org/?tag_ids=40&sort=time';\n        document.body.append(a);\n        a.click();\n        setTimeout(() => {\n          a.remove();\n        }, 0);\n      }\n    }, {\n      icon: 'char z',\n      text: 'ChatList.Menu.SwitchTo.Z',\n      onClick: () => {\n        Promise.all([\n          sessionStorage.set({kz_version: 'Z'}),\n          sessionStorage.delete('tgme_sync')\n        ]).then(() => {\n          location.href = 'https://web.telegram.org/z/';\n        });\n      },\n      verify: () => App.isMainDomain\n    }, {\n      icon: 'char w',\n      text: 'ChatList.Menu.SwitchTo.Webogram',\n      onClick: () => {\n        sessionStorage.delete('tgme_sync').then(() => {\n          location.href = 'https://web.telegram.org/?legacy=1';\n        });\n      },\n      verify: () => App.isMainDomain\n    }];\n\n    const filteredButtons = menuButtons.filter(Boolean);\n\n    this.toolsBtn = ButtonMenuToggle({}, 'bottom-right', filteredButtons, async(e) => {\n      await Promise.all(filteredButtons.map(async(button) => {\n        if(button.verify) {\n          button.element.classList.toggle('hide', !(await button.verify()));\n        }\n      }));\n    });\n    this.toolsBtn.classList.remove('tgico-more');\n    this.toolsBtn.classList.add('sidebar-tools-button', 'is-visible');\n\n    this.backBtn.parentElement.insertBefore(this.toolsBtn, this.backBtn);\n\n    const btnMenu = this.toolsBtn.querySelector('.btn-menu') as HTMLElement;\n\n    const btnMenuFooter = document.createElement('a');\n    btnMenuFooter.href = 'https://github.com/morethanwords/tweb/blob/master/CHANGELOG.md';\n    btnMenuFooter.target = '_blank';\n    btnMenuFooter.rel = 'noopener noreferrer';\n    btnMenuFooter.classList.add('btn-menu-footer');\n    btnMenuFooter.addEventListener(CLICK_EVENT_NAME, (e) => {\n      e.stopPropagation();\n      contextMenuController.close();\n    });\n    const t = document.createElement('span');\n    t.classList.add('btn-menu-footer-text');\n    t.innerHTML = 'Telegram Web' + App.suffix + ' '/* ' alpha ' */ + App.versionFull;\n    btnMenuFooter.append(t);\n    btnMenu.classList.add('has-footer');\n    btnMenu.append(btnMenuFooter);\n\n    this.newBtnMenu = ButtonMenuToggle({}, 'top-left', [{\n      icon: 'newchannel',\n      text: 'NewChannel',\n      onClick: () => {\n        this.createTab(AppNewChannelTab).open();\n      }\n    }, {\n      icon: 'newgroup',\n      text: 'NewGroup',\n      onClick: onNewGroupClick\n    }, {\n      icon: 'newprivate',\n      text: 'NewPrivateChat',\n      onClick: onContactsClick\n    }]);\n    this.newBtnMenu.className = 'btn-circle rp btn-corner z-depth-1 btn-menu-toggle animated-button-icon';\n    this.newBtnMenu.insertAdjacentHTML('afterbegin', `\n    <span class=\"tgico tgico-newchat_filled\"></span>\n    <span class=\"tgico tgico-close\"></span>\n    `);\n    this.newBtnMenu.id = 'new-menu';\n    sidebarHeader.nextElementSibling.append(this.newBtnMenu);\n\n    this.updateBtn = document.createElement('div');\n    // this.updateBtn.classList.add('btn-update');\n    this.updateBtn.className = 'btn-circle rp btn-corner z-depth-1 btn-update is-hidden';\n    ripple(this.updateBtn);\n    this.updateBtn.append(i18n('Update'));\n    // const weave = new TopbarWeave();\n    // const weaveContainer = weave.render('btn-update-weave');\n    // this.updateBtn.prepend(weaveContainer);\n\n    attachClickEvent(this.updateBtn, () => {\n      if(this.updateBtn.classList.contains('is-hidden')) {\n        return;\n      }\n\n      location.reload();\n    });\n\n    sidebarHeader.nextElementSibling.append(this.updateBtn);\n\n    // setTimeout(() => {\n    //   weave.componentDidMount();\n    //   weave.setCurrentState(GROUP_CALL_STATE.MUTED, true);\n    //   weave.setAmplitude(0);\n    //   weave.handleBlur();\n    // }, 1e3);\n\n    this.inputSearch.input.addEventListener('focus', () => this.initSearch(), {once: true});\n\n    // parseMenuButtonsTo(this.newButtons, this.newBtnMenu.firstElementChild.children);\n\n    this.archivedCount = document.createElement('span');\n    this.archivedCount.className = 'archived-count badge badge-24 badge-gray';\n\n    btnArchive.element.append(this.archivedCount);\n\n    rootScope.addEventListener('folder_unread', (folder) => {\n      if(folder.id === 1) {\n        // const count = folder.unreadMessagesCount;\n        const count = folder.unreadPeerIds.size;\n        this.archivedCount.innerText = '' + formatNumber(count, 1);\n        this.archivedCount.classList.toggle('hide', !count);\n      }\n    });\n\n    this.managers.appUsersManager.getTopPeers('correspondents');\n\n    // Focus search input by pressing Escape\n    const navigationItem: NavigationItem = {\n      type: 'global-search-focus',\n      onPop: () => {\n        setTimeout(() => {\n          this.inputSearch.input.focus();\n        }, 0);\n\n        return false;\n      },\n      noHistory: true\n    };\n    appNavigationController.pushItem(navigationItem);\n\n    apiManagerProxy.getState().then((state) => {\n      const CHECK_UPDATE_INTERVAL = 1800e3;\n      const checkUpdateInterval = setInterval(() => {\n        fetch('version', {cache: 'no-cache'})\n        .then((res) => (res.status === 200 && res.ok && res.text()) || Promise.reject())\n        .then((text) => {\n          if(text !== App.versionFull) {\n            this.hasUpdate = true;\n            clearInterval(checkUpdateInterval);\n\n            if(!this.newBtnMenu.classList.contains('is-hidden')) {\n              this.updateBtn.classList.remove('is-hidden');\n            }\n          }\n        })\n        .catch(noop);\n      }, CHECK_UPDATE_INTERVAL);\n    });\n  }\n\n  private initSearch() {\n    const searchContainer = this.sidebarEl.querySelector('#search-container') as HTMLDivElement;\n\n    const scrollable = new Scrollable(searchContainer);\n\n    const close = () => {\n      // setTimeout(() => {\n      simulateClickEvent(this.backBtn);\n      // }, 0);\n    };\n\n    this.searchGroups = {\n      contacts: new SearchGroup('SearchAllChatsShort', 'contacts', undefined, undefined, undefined, undefined, close),\n      globalContacts: new SearchGroup('GlobalSearch', 'contacts', undefined, undefined, undefined, undefined, close),\n      messages: new SearchGroup('SearchMessages', 'messages'),\n      people: new SearchGroup(false, 'contacts', true, 'search-group-people', true, false, close, true),\n      recent: new SearchGroup('Recent', 'contacts', true, 'search-group-recent', true, true, close)\n    };\n\n    const searchSuper = this.searchSuper = new AppSearchSuper({\n      mediaTabs: [{\n        inputFilter: 'inputMessagesFilterEmpty',\n        name: 'FilterChats',\n        type: 'chats'\n      }, {\n        inputFilter: 'inputMessagesFilterPhotoVideo',\n        name: 'SharedMediaTab2',\n        type: 'media'\n      }, {\n        inputFilter: 'inputMessagesFilterUrl',\n        name: 'SharedLinksTab2',\n        type: 'links'\n      }, {\n        inputFilter: 'inputMessagesFilterDocument',\n        name: 'SharedFilesTab2',\n        type: 'files'\n      }, {\n        inputFilter: 'inputMessagesFilterMusic',\n        name: 'SharedMusicTab2',\n        type: 'music'\n      }, {\n        inputFilter: 'inputMessagesFilterRoundVoice',\n        name: 'SharedVoiceTab2',\n        type: 'voice'\n      }],\n      scrollable,\n      searchGroups: this.searchGroups,\n      asChatList: true,\n      hideEmptyTabs: false,\n      showSender: true,\n      managers: this.managers\n    });\n\n    searchContainer.prepend(searchSuper.nav.parentElement.parentElement);\n    scrollable.container.append(searchSuper.container);\n\n    const resetSearch = () => {\n      searchSuper.setQuery({\n        peerId: ''.toPeerId(),\n        folderId: 0\n      });\n      searchSuper.selectTab(0);\n      searchSuper.load(true);\n    };\n\n    resetSearch();\n\n    const pickedElements: HTMLElement[] = [];\n    let selectedPeerId: PeerId = ''.toPeerId();\n    let selectedMinDate = 0;\n    let selectedMaxDate = 0;\n    const updatePicked = () => {\n      // (this.inputSearch.input as HTMLInputElement).placeholder = pickedElements.length ? 'Search' : 'Telegram Search';\n      this.inputSearch.container.classList.toggle('is-picked-twice', pickedElements.length === 2);\n      this.inputSearch.container.classList.toggle('is-picked', !!pickedElements.length);\n\n      if(pickedElements.length) {\n        this.inputSearch.input.style.setProperty('--paddingLeft', (pickedElements[pickedElements.length - 1].getBoundingClientRect().right - this.inputSearch.input.getBoundingClientRect().left) + 'px');\n      } else {\n        this.inputSearch.input.style.removeProperty('--paddingLeft');\n      }\n    };\n\n    const helper = document.createElement('div');\n    helper.classList.add('search-helper');\n    helper.addEventListener('click', (e) => {\n      const target = findUpClassName(e.target, 'selector-user');\n      if(!target) {\n        return;\n      }\n\n      const key = target.dataset.key;\n      if(key.indexOf('date_') === 0) {\n        const [_, minDate, maxDate] = key.split('_');\n        selectedMinDate = +minDate;\n        selectedMaxDate = +maxDate;\n      } else {\n        selectedPeerId = key.toPeerId();\n      }\n\n      target.addEventListener('click', () => {\n        unselectEntity(target);\n      });\n\n      this.inputSearch.container.append(target);\n      this.inputSearch.onChange(this.inputSearch.value = '');\n      pickedElements.push(target);\n      updatePicked();\n    });\n\n    searchSuper.nav.parentElement.append(helper);\n\n    const renderEntity = (key: PeerId | string, title?: string | HTMLElement) => {\n      const div = document.createElement('div');\n      div.classList.add('selector-user'/* , 'scale-in' */);\n\n      const avatarEl = new AvatarElement();\n      avatarEl.classList.add('selector-user-avatar', 'tgico', 'avatar-30');\n      avatarEl.isDialog = true;\n\n      div.dataset.key = '' + key;\n      if(key.isPeerId()) {\n        if(title === undefined) {\n          title = new PeerTitle({peerId: key.toPeerId()}).element;\n        }\n\n        avatarEl.updateWithOptions({peerId: key as PeerId});\n      } else {\n        avatarEl.classList.add('tgico-calendarfilter');\n      }\n\n      if(title) {\n        if(typeof(title) === 'string') {\n          div.innerHTML = title;\n        } else {\n          replaceContent(div, title);\n          div.append(title);\n        }\n      }\n\n      div.insertAdjacentElement('afterbegin', avatarEl);\n\n      return div;\n    };\n\n    const unselectEntity = (target: HTMLElement) => {\n      const key = target.dataset.key;\n      if(key.indexOf('date_') === 0) {\n        selectedMinDate = selectedMaxDate = 0;\n      } else {\n        selectedPeerId = ''.toPeerId();\n      }\n\n      target.remove();\n      indexOfAndSplice(pickedElements, target);\n\n      setTimeout(() => {\n        updatePicked();\n        this.inputSearch.onChange(this.inputSearch.value);\n      }, 0);\n    };\n\n    this.inputSearch.onClear = () => {\n      pickedElements.forEach((el) => {\n        unselectEntity(el);\n      });\n    };\n\n    this.inputSearch.onChange = (value) => {\n      searchSuper.cleanupHTML();\n      searchSuper.setQuery({\n        peerId: selectedPeerId,\n        folderId: selectedPeerId ? undefined : 0,\n        query: value,\n        minDate: selectedMinDate,\n        maxDate: selectedMaxDate\n      });\n      searchSuper.load(true);\n\n      helper.innerHTML = '';\n      searchSuper.nav.classList.remove('hide');\n      if(!value) {\n      }\n\n      if(!selectedPeerId && value.trim()) {\n        const middleware = searchSuper.middleware.get();\n        Promise.all([\n          // appMessagesManager.getConversationsAll(value).then((dialogs) => dialogs.map((d) => d.peerId)),\n          this.managers.appMessagesManager.getConversations(value).then(({dialogs}) => dialogs.map((d) => d.peerId)),\n          this.managers.appUsersManager.getContactsPeerIds(value, true)\n        ]).then((results) => {\n          if(!middleware()) return;\n          const peerIds = new Set(results[0].concat(results[1]));\n\n          peerIds.forEach((peerId) => {\n            helper.append(renderEntity(peerId));\n          });\n\n          searchSuper.nav.classList.toggle('hide', !!helper.innerHTML);\n          // console.log('got peerIds by value:', value, [...peerIds]);\n        });\n      }\n\n      if(!selectedMinDate && value.trim()) {\n        const dates: DateData[] = [];\n        fillTipDates(value, dates);\n        dates.forEach((dateData) => {\n          helper.append(renderEntity('date_' + dateData.minDate + '_' + dateData.maxDate, dateData.title));\n        });\n\n        searchSuper.nav.classList.toggle('hide', !!helper.innerHTML);\n      }\n    };\n\n    searchSuper.tabs.inputMessagesFilterEmpty.addEventListener('mousedown', (e) => {\n      const target = findUpTag(e.target, DIALOG_LIST_ELEMENT_TAG) as HTMLElement;\n      if(!target) {\n        return;\n      }\n\n      const searchGroup = findUpClassName(target, 'search-group');\n      if(!searchGroup || searchGroup.classList.contains('search-group-recent') || searchGroup.classList.contains('search-group-people')) {\n        return;\n      }\n\n      const peerId = target.getAttribute('data-peer-id').toPeerId();\n      this.managers.appUsersManager.pushRecentSearch(peerId);\n    }, {capture: true});\n\n    const peopleContainer = document.createElement('div');\n    peopleContainer.classList.add('search-group-scrollable');\n    peopleContainer.append(this.searchGroups.people.list);\n    this.searchGroups.people.container.append(peopleContainer);\n    const peopleScrollable = new ScrollableX(peopleContainer);\n\n    let first = true;\n    let hideNewBtnMenuTimeout: number;\n    // const transition = Transition.bind(null, searchContainer.parentElement, 150);\n    const transition = TransitionSlider(searchContainer.parentElement, 'zoom-fade', 150, (id) => {\n      if(hideNewBtnMenuTimeout) clearTimeout(hideNewBtnMenuTimeout);\n\n      if(id === 0 && !first) {\n        searchSuper.selectTab(0, false);\n        this.inputSearch.onClearClick();\n        hideNewBtnMenuTimeout = window.setTimeout(() => {\n          hideNewBtnMenuTimeout = 0;\n          this.newBtnMenu.classList.remove('is-hidden');\n          this.hasUpdate && this.updateBtn.classList.remove('is-hidden');\n        }, 150);\n      }\n\n      first = false;\n    });\n\n    transition(0);\n\n    const activeClassName = 'is-visible';\n    const onFocus = () => {\n      this.toolsBtn.classList.remove(activeClassName);\n      this.backBtn.classList.add(activeClassName);\n      this.newBtnMenu.classList.add('is-hidden');\n      this.updateBtn.classList.add('is-hidden');\n      this.toolsBtn.parentElement.firstElementChild.classList.toggle('state-back', true);\n\n      const navigationType: NavigationItem['type'] = 'global-search';\n      if(!IS_MOBILE_SAFARI && !appNavigationController.findItemByType(navigationType)) {\n        appNavigationController.pushItem({\n          onPop: () => {\n            close();\n          },\n          type: navigationType\n        });\n      }\n\n      transition(1);\n    };\n\n    this.inputSearch.input.addEventListener('focus', onFocus);\n    onFocus();\n\n    attachClickEvent(this.backBtn, (e) => {\n      this.toolsBtn.classList.add(activeClassName);\n      this.backBtn.classList.remove(activeClassName);\n      this.toolsBtn.parentElement.firstElementChild.classList.toggle('state-back', false);\n\n      appNavigationController.removeByType('global-search');\n\n      transition(0);\n    });\n\n    const clearRecentSearchBtn = ButtonIcon('close');\n    this.searchGroups.recent.nameEl.append(clearRecentSearchBtn);\n    clearRecentSearchBtn.addEventListener('click', () => {\n      confirmationPopup({\n        descriptionLangKey: 'Search.Confirm.ClearHistory',\n        button: {\n          langKey: 'ClearButton',\n          isDanger: true\n        }\n      }).then(() => {\n        return this.managers.appUsersManager.clearRecentSearch().then(() => {\n          this.searchGroups.recent.clear();\n        });\n      });\n    });\n  }\n}\n\nexport type SettingSectionOptions = {\n  name?: LangPackKey,\n  nameArgs?: FormatterArguments,\n  caption?: LangPackKey | true,\n  captionArgs?: FormatterArguments,\n  captionOld?: SettingSectionOptions['caption'],\n  noDelimiter?: boolean,\n  fakeGradientDelimiter?: boolean,\n  noShadow?: boolean,\n  // fullWidth?: boolean,\n  // noPaddingTop?: boolean\n};\n\nconst className = 'sidebar-left-section';\nexport class SettingSection {\n  public container: HTMLElement;\n  public innerContainer: HTMLElement;\n  public content: HTMLElement;\n  public title: HTMLElement;\n  public caption: HTMLElement;\n\n  private fullWidth: boolean;\n\n  constructor(options: SettingSectionOptions = {}) {\n    const container = this.container = document.createElement('div');\n    container.classList.add(className + '-container');\n\n    const innerContainer = this.innerContainer = document.createElement('div');\n    innerContainer.classList.add(className);\n\n    if(options.noShadow) {\n      innerContainer.classList.add('no-shadow');\n    }\n\n    if(options.fakeGradientDelimiter) {\n      innerContainer.append(generateDelimiter());\n      innerContainer.classList.add('with-fake-delimiter');\n    } else if(!options.noDelimiter) {\n      const hr = document.createElement('hr');\n      innerContainer.append(hr);\n    } else {\n      innerContainer.classList.add('no-delimiter');\n    }\n\n    // if(options.fullWidth) {\n    //   this.fullWidth = true;\n    // }\n\n    // if(options.noPaddingTop) {\n    //   innerContainer.classList.add('no-padding-top');\n    // }\n\n    const content = this.content = this.generateContentElement();\n\n    if(options.name) {\n      const title = this.title = document.createElement('div');\n      title.classList.add('sidebar-left-h2', className + '-name');\n      i18n_({element: title, key: options.name, args: options.nameArgs});\n      content.append(title);\n    }\n\n    container.append(innerContainer);\n\n    const caption = options.caption ?? options.captionOld;\n    if(caption) {\n      const el = this.caption = this.generateContentElement();\n      el.classList.add(className + '-caption');\n\n      if(!options.captionOld) {\n        container.append(el);\n      }\n\n      if(caption !== true) {\n        i18n_({element: el, key: caption, args: options.captionArgs});\n      }\n    }\n  }\n\n  public generateContentElement() {\n    const content = document.createElement('div');\n    content.classList.add(className + '-content');\n\n    // if(this.fullWidth) {\n    //   content.classList.add('full-width');\n    // }\n\n    this.innerContainer.append(content);\n    return content;\n  }\n}\n\nexport const generateSection = (appendTo: Scrollable, name?: LangPackKey, caption?: LangPackKey) => {\n  const section = new SettingSection({name, caption});\n  appendTo.append(section.container);\n  return section.content;\n};\n\nexport const generateDelimiter = () => {\n  const delimiter = document.createElement('div');\n  delimiter.classList.add('gradient-delimiter');\n  return delimiter;\n};\n\nexport class SettingChatListSection extends SettingSection {\n  public sortedList: SortedUserList;\n\n  constructor(options: SettingSectionOptions & {sortedList: SortedUserList}) {\n    super(options);\n\n    this.sortedList = options.sortedList;\n\n    this.content.append(this.sortedList.list);\n  }\n\n  public makeButton(options: ButtonOptions) {\n    const button = Button('folder-category-button btn btn-primary btn-transparent', options);\n    if(this.title) this.content.insertBefore(button, this.title.nextSibling);\n    else this.content.prepend(button);\n    return button;\n  }\n}\n\nconst appSidebarLeft = new AppSidebarLeft();\nMOUNT_CLASS_TO.appSidebarLeft = appSidebarLeft;\nexport default appSidebarLeft;\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport {SliderSuperTab} from '../../slider';\r\nimport AppSelectPeers from '../../appSelectPeers';\r\nimport {setButtonLoader} from '../../putPreloader';\r\nimport {LangPackKey, _i18n} from '../../../lib/langPack';\r\nimport ButtonCorner from '../../buttonCorner';\r\n\r\nexport default class AppAddMembersTab extends SliderSuperTab {\r\n  private nextBtn: HTMLButtonElement;\r\n  private selector: AppSelectPeers;\r\n  private peerType: 'channel' | 'chat' | 'privacy';\r\n  private takeOut: (peerIds: PeerId[]) => Promise<any> | false | void;\r\n  private skippable: boolean;\r\n\r\n  protected init() {\r\n    this.container.classList.add('add-members-container');\r\n    this.nextBtn = ButtonCorner({icon: 'arrow_next'});\r\n    this.content.append(this.nextBtn);\r\n    this.scrollable.container.remove();\r\n\r\n    this.nextBtn.addEventListener('click', () => {\r\n      const peerIds = this.selector.getSelected().map((sel) => sel.toPeerId());\r\n\r\n      if(this.skippable) {\r\n        this.takeOut(peerIds);\r\n        this.close();\r\n      } else {\r\n        const promise = this.takeOut(peerIds);\r\n\r\n        if(promise instanceof Promise) {\r\n          this.attachToPromise(promise);\r\n        } else if(promise === undefined) {\r\n          this.close();\r\n        }\r\n      }\r\n    });\r\n  }\r\n\r\n  public attachToPromise(promise: Promise<any>) {\r\n    const removeLoader = setButtonLoader(this.nextBtn, 'arrow_next');\r\n\r\n    promise.then(() => {\r\n      this.close();\r\n    }, () => {\r\n      removeLoader();\r\n    });\r\n  }\r\n\r\n  public open(options: {\r\n    title: LangPackKey,\r\n    placeholder: LangPackKey,\r\n    type: AppAddMembersTab['peerType'],\r\n    takeOut?: AppAddMembersTab['takeOut'],\r\n    skippable: boolean,\r\n    selectedPeerIds?: PeerId[]\r\n  }) {\r\n    const ret = super.open();\r\n\r\n    this.setTitle(options.title);\r\n    this.peerType = options.type;\r\n    this.takeOut = options.takeOut;\r\n    this.skippable = options.skippable;\r\n\r\n    const isPrivacy = this.peerType === 'privacy';\r\n    this.selector = new AppSelectPeers({\r\n      appendTo: this.content,\r\n      onChange: this.skippable ? null : (length) => {\r\n        this.nextBtn.classList.toggle('is-visible', !!length);\r\n      },\r\n      peerType: [isPrivacy ? 'dialogs' : 'contacts'],\r\n      placeholder: options.placeholder,\r\n      exceptSelf: isPrivacy,\r\n      filterPeerTypeBy: isPrivacy ? ['isAnyGroup', 'isUser'] : undefined,\r\n      managers: this.managers\r\n    });\r\n\r\n    if(options.selectedPeerIds) {\r\n      this.selector.addInitial(options.selectedPeerIds);\r\n    }\r\n\r\n    this.nextBtn.classList.add('tgico-arrow_next');\r\n    this.nextBtn.innerHTML = '';\r\n    this.nextBtn.disabled = false;\r\n    this.nextBtn.classList.toggle('is-visible', this.skippable);\r\n\r\n    return ret;\r\n  }\r\n}\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport type {MyDialogFilter} from '../../../lib/storages/filters';\r\nimport type {DialogFilterSuggested} from '../../../layer';\r\nimport type _rootScope from '../../../lib/rootScope';\r\nimport {SliderSuperTab} from '../../slider';\r\nimport lottieLoader, {LottieLoader} from '../../../lib/rlottie/lottieLoader';\r\nimport {toast} from '../../toast';\r\nimport Button from '../../button';\r\nimport rootScope from '../../../lib/rootScope';\r\nimport AppEditFolderTab from './editFolder';\r\nimport Row from '../../row';\r\nimport {SettingSection} from '..';\r\nimport {i18n, i18n_, LangPackKey, join} from '../../../lib/langPack';\r\nimport cancelEvent from '../../../helpers/dom/cancelEvent';\r\nimport {attachClickEvent} from '../../../helpers/dom/clickEvent';\r\nimport positionElementByIndex from '../../../helpers/dom/positionElementByIndex';\r\nimport RLottiePlayer from '../../../lib/rlottie/rlottiePlayer';\r\nimport wrapEmojiText from '../../../lib/richTextProcessor/wrapEmojiText';\r\nimport {FOLDER_ID_ALL, FOLDER_ID_ARCHIVE, REAL_FOLDERS} from '../../../lib/mtproto/mtproto_config';\r\nimport replaceContent from '../../../helpers/dom/replaceContent';\r\n\r\nexport default class AppChatFoldersTab extends SliderSuperTab {\r\n  private createFolderBtn: HTMLElement;\r\n  private foldersSection: SettingSection;\r\n  private suggestedSection: SettingSection;\r\n  private stickerContainer: HTMLElement;\r\n  private animation: RLottiePlayer;\r\n\r\n  private filtersRendered: {[filterId: number]: Row} = {};\r\n  private loadAnimationPromise: ReturnType<LottieLoader['waitForFirstFrame']>;\r\n\r\n  private async renderFolder(\r\n    dialogFilter: DialogFilterSuggested | MyDialogFilter,\r\n    container?: HTMLElement,\r\n    row?: Row,\r\n    append?: boolean\r\n  ) {\r\n    let filter: MyDialogFilter;\r\n    let description = '';\r\n    const d: HTMLElement[] = [];\r\n    if(dialogFilter._ === 'dialogFilterSuggested') {\r\n      filter = dialogFilter.filter as MyDialogFilter;\r\n      description = dialogFilter.description;\r\n    } else {\r\n      filter = dialogFilter;\r\n\r\n      const enabledFilters = Object.keys(filter.pFlags).length;\r\n      /* (['include_peers', 'exclude_peers'] as ['include_peers', 'exclude_peers']).forEach((key) => {\r\n        enabledFilters += +!!filter[key].length;\r\n      }); */\r\n\r\n      if(enabledFilters === 1) {\r\n        const pFlags = filter.pFlags;\r\n        let k: LangPackKey;\r\n        if(pFlags.contacts) k = 'FilterAllContacts';\r\n        else if(pFlags.non_contacts) k = 'FilterAllNonContacts';\r\n        else if(pFlags.groups) k = 'FilterAllGroups';\r\n        else if(pFlags.broadcasts) k = 'FilterAllChannels';\r\n        else if(pFlags.bots) k = 'FilterAllBots';\r\n\r\n        if(k) {\r\n          d.push(i18n(k));\r\n        }\r\n      }\r\n\r\n      if(!d.length) {\r\n        const folder = await this.managers.dialogsStorage.getFolderDialogs(filter.id);\r\n        let chats = 0, channels = 0, groups = 0;\r\n        await Promise.all(folder.map(async(dialog) => {\r\n          if(await this.managers.appPeersManager.isAnyGroup(dialog.peerId)) groups++;\r\n          else if(await this.managers.appPeersManager.isBroadcast(dialog.peerId)) channels++;\r\n          else chats++;\r\n        }));\r\n\r\n        if(chats) d.push(i18n('Chats', [chats]));\r\n        if(channels) d.push(i18n('Channels', [channels]));\r\n        if(groups) d.push(i18n('Groups', [groups]));\r\n      }\r\n    }\r\n\r\n    if(!row) {\r\n      row = new Row({\r\n        title: filter.id === FOLDER_ID_ALL ? i18n('FilterAllChats') : wrapEmojiText(filter.title),\r\n        subtitle: description,\r\n        clickable: filter.id !== FOLDER_ID_ALL\r\n      });\r\n\r\n      if(d.length) {\r\n        row.subtitle.append(...join(d));\r\n      }\r\n\r\n      if(dialogFilter._ === 'dialogFilter') {\r\n        const filterId = filter.id;\r\n        if(!this.filtersRendered[filter.id] && filter.id !== FOLDER_ID_ALL) {\r\n          attachClickEvent(row.container, async() => {\r\n            this.slider.createTab(AppEditFolderTab).open(await this.managers.filtersStorage.getFilter(filterId));\r\n          }, {listenerSetter: this.listenerSetter});\r\n        }\r\n\r\n        this.filtersRendered[filter.id] = row;\r\n      }\r\n    } else {\r\n      if(filter.id !== FOLDER_ID_ALL) {\r\n        replaceContent(row.title, wrapEmojiText(filter.title));\r\n      }\r\n\r\n      row.subtitle.textContent = '';\r\n      row.subtitle.append(...join(d));\r\n    }\r\n\r\n    const div = row.container;\r\n\r\n    if(append) {\r\n      const localId = (filter as MyDialogFilter).localId;\r\n      if(localId !== undefined) {\r\n        // ! header will be at 0 index\r\n        positionElementByIndex(div, div.parentElement || container, localId);\r\n      } else if(container) {\r\n        container.append(div);\r\n      }\r\n    }\r\n\r\n    return div;\r\n  }\r\n\r\n  protected async init() {\r\n    this.container.classList.add('chat-folders-container');\r\n    this.setTitle('ChatList.Filter.List.Title');\r\n\r\n    this.scrollable.container.classList.add('chat-folders');\r\n\r\n    this.stickerContainer = document.createElement('div');\r\n    this.stickerContainer.classList.add('sticker-container');\r\n\r\n    const caption = document.createElement('div');\r\n    caption.classList.add('caption');\r\n    i18n_({element: caption, key: 'ChatList.Filter.Header'});\r\n\r\n    this.createFolderBtn = Button('btn-primary btn-color-primary btn-control tgico', {\r\n      text: 'ChatList.Filter.NewTitle',\r\n      icon: 'add'\r\n    });\r\n\r\n    this.foldersSection = new SettingSection({\r\n      name: 'Filters'\r\n    });\r\n    this.foldersSection.container.style.display = 'none';\r\n\r\n    this.suggestedSection = new SettingSection({\r\n      name: 'FilterRecommended'\r\n    });\r\n    this.suggestedSection.container.style.display = 'none';\r\n\r\n    this.scrollable.append(this.stickerContainer, caption, this.createFolderBtn, this.foldersSection.container, this.suggestedSection.container);\r\n\r\n    attachClickEvent(this.createFolderBtn, async() => {\r\n      if(!(await this.canCreateFolder())) {\r\n        toast('Sorry, you can\\'t create more folders.');\r\n      } else {\r\n        this.slider.createTab(AppEditFolderTab).open();\r\n      }\r\n    }, {listenerSetter: this.listenerSetter});\r\n\r\n    const onFiltersContainerUpdate = () => {\r\n      this.foldersSection.container.style.display = Object.keys(this.filtersRendered).length ? '' : 'none';\r\n    };\r\n\r\n    this.managers.filtersStorage.getDialogFilters().then(async(filters) => {\r\n      for(const filter of filters) {\r\n        if(filter.id === FOLDER_ID_ARCHIVE) {\r\n          continue;\r\n        }\r\n\r\n        await this.renderFolder(filter, this.foldersSection.content, undefined, true);\r\n      }\r\n\r\n      this.toggleAllChats();\r\n\r\n      onFiltersContainerUpdate();\r\n    });\r\n\r\n    this.listenerSetter.add(rootScope)('filter_update', async(filter) => {\r\n      const filterRendered = this.filtersRendered[filter.id];\r\n      if(filterRendered) {\r\n        await this.renderFolder(filter, null, filterRendered);\r\n      } else if(filter.id !== FOLDER_ID_ARCHIVE) {\r\n        await this.renderFolder(filter, this.foldersSection.content, undefined, true);\r\n      }\r\n\r\n      onFiltersContainerUpdate();\r\n\r\n      this.getSuggestedFilters();\r\n    });\r\n\r\n    this.listenerSetter.add(rootScope)('filter_delete', (filter) => {\r\n      const filterRendered = this.filtersRendered[filter.id];\r\n      if(filterRendered) {\r\n        /* for(const suggested of this.suggestedFilters) {\r\n          if(deepEqual(suggested.filter, filter)) {\r\n\r\n          }\r\n        } */\r\n        this.getSuggestedFilters();\r\n\r\n        filterRendered.container.remove();\r\n        delete this.filtersRendered[filter.id];\r\n      }\r\n\r\n      onFiltersContainerUpdate();\r\n    });\r\n\r\n    this.listenerSetter.add(rootScope)('filter_order', (order) => {\r\n      order.filter((filterId) => !!this.filtersRendered[filterId]).forEach((filterId, idx) => {\r\n        const filterRendered = this.filtersRendered[filterId];\r\n        const container = filterRendered.container;\r\n        positionElementByIndex(container, container.parentElement, idx + 1); // ! + 1 due to header\r\n      });\r\n    });\r\n\r\n    this.listenerSetter.add(rootScope)('premium_toggle', () => {\r\n      this.toggleAllChats();\r\n    });\r\n\r\n    this.loadAnimationPromise = lottieLoader.loadAnimationAsAsset({\r\n      container: this.stickerContainer,\r\n      loop: false,\r\n      autoplay: false,\r\n      width: 86,\r\n      height: 86\r\n    }, 'Folders_1').then((player) => {\r\n      this.animation = player;\r\n\r\n      return lottieLoader.waitForFirstFrame(player);\r\n    });\r\n\r\n    this.getSuggestedFilters()\r\n\r\n    /* return Promise.all([\r\n      this.loadAnimationPromise\r\n    ]); */\r\n    return this.loadAnimationPromise;\r\n  }\r\n\r\n  onOpenAfterTimeout() {\r\n    this.loadAnimationPromise.then(() => {\r\n      this.animation.autoplay = true;\r\n      this.animation.play();\r\n    });\r\n  }\r\n\r\n  private toggleAllChats() {\r\n    const filterRendered = this.filtersRendered[FOLDER_ID_ALL];\r\n    filterRendered.container.classList.toggle('hide', !rootScope.premium);\r\n  }\r\n\r\n  private async canCreateFolder() {\r\n    const [appConfig, filters] = await Promise.all([\r\n      this.managers.apiManager.getAppConfig(),\r\n      this.managers.filtersStorage.getDialogFilters()\r\n    ]);\r\n\r\n    const filtersLength = filters.filter((filter) => !REAL_FOLDERS.has(filter.id)).length;\r\n    return filtersLength < (rootScope.premium ? appConfig.dialog_filters_limit_premium : appConfig.dialog_filters_limit_default);\r\n  }\r\n\r\n  private getSuggestedFilters() {\r\n    return this.managers.filtersStorage.getSuggestedDialogsFilters().then(async(suggestedFilters) => {\r\n      this.suggestedSection.container.style.display = suggestedFilters.length ? '' : 'none';\r\n      Array.from(this.suggestedSection.content.children).slice(1).forEach((el) => el.remove());\r\n\r\n      for(const filter of suggestedFilters) {\r\n        const div = await this.renderFolder(filter);\r\n        const button = Button('btn-primary btn-color-primary', {text: 'Add'});\r\n        div.append(button);\r\n        this.suggestedSection.content.append(div);\r\n\r\n        attachClickEvent(button, async(e) => {\r\n          cancelEvent(e);\r\n\r\n          if(!(await this.canCreateFolder())) {\r\n            toast('Sorry, you can\\'t create more folders.');\r\n            return;\r\n          }\r\n\r\n          button.setAttribute('disabled', 'true');\r\n\r\n          const f = filter.filter as MyDialogFilter;\r\n          f.includePeerIds = [];\r\n          f.excludePeerIds = [];\r\n          f.pinnedPeerIds = [];\r\n\r\n          this.managers.filtersStorage.createDialogFilter(f, true).then((bool) => {\r\n            if(bool) {\r\n              div.remove();\r\n            }\r\n          }).finally(() => {\r\n            button.removeAttribute('disabled');\r\n          });\r\n        }, {listenerSetter: this.listenerSetter});\r\n      }\r\n    });\r\n  }\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport {SliderSuperTab} from '../../slider';\r\nimport AppSelectPeers from '../../appSelectPeers';\r\nimport appDialogsManager from '../../../lib/appManagers/appDialogsManager';\r\nimport {MyDialogFilter as DialogFilter} from '../../../lib/storages/filters';\r\nimport ButtonIcon from '../../buttonIcon';\r\nimport CheckboxField from '../../checkboxField';\r\nimport Button from '../../button';\r\nimport AppEditFolderTab from './editFolder';\r\nimport I18n, {i18n, LangPackKey, _i18n, join} from '../../../lib/langPack';\r\nimport {SettingSection} from '..';\r\nimport {toast} from '../../toast';\r\nimport copy from '../../../helpers/object/copy';\r\nimport forEachReverse from '../../../helpers/array/forEachReverse';\r\nimport setInnerHTML from '../../../helpers/dom/setInnerHTML';\r\nimport wrapEmojiText from '../../../lib/richTextProcessor/wrapEmojiText';\r\nimport {REAL_FOLDERS} from '../../../lib/mtproto/mtproto_config';\r\nimport rootScope from '../../../lib/rootScope';\r\nimport {MTAppConfig} from '../../../lib/mtproto/appConfig';\r\nimport {attachClickEvent, simulateClickEvent} from '../../../helpers/dom/clickEvent';\r\n\r\nexport default class AppIncludedChatsTab extends SliderSuperTab {\r\n  private editFolderTab: AppEditFolderTab;\r\n  private confirmBtn: HTMLElement;\r\n\r\n  private selector: AppSelectPeers;\r\n  private type: 'included' | 'excluded';\r\n  private filter: DialogFilter;\r\n  private originalFilter: DialogFilter;\r\n\r\n  private dialogsByFilters: Map<DialogFilter, Set<PeerId>>;\r\n  private limit: number;\r\n\r\n  protected init() {\r\n    this.content.remove();\r\n    this.container.classList.add('included-chatlist-container');\r\n    this.confirmBtn = ButtonIcon('check btn-confirm blue', {noRipple: true});\r\n    this.confirmBtn.style.display = 'none';\r\n\r\n    this.header.append(this.confirmBtn);\r\n\r\n    attachClickEvent(this.confirmBtn, async() => {\r\n      const selected = this.selector.getSelected();\r\n\r\n      // this.filter.pFlags = {};\r\n\r\n      if(this.type === 'included') {\r\n        for(const key in this.filter.pFlags) {\r\n          if(key.indexOf('exclude_') === 0) {\r\n            continue;\r\n          }\r\n\r\n          // @ts-ignore\r\n          delete this.filter.pFlags[key];\r\n        }\r\n      } else {\r\n        for(const key in this.filter.pFlags) {\r\n          if(key.indexOf('exclude_') !== 0) {\r\n            continue;\r\n          }\r\n\r\n          // @ts-ignore\r\n          delete this.filter.pFlags[key];\r\n        }\r\n      }\r\n\r\n      const peerIds: PeerId[] = [];\r\n      for(const key of selected) {\r\n        if(key.isPeerId()) {\r\n          peerIds.push(key.toPeerId());\r\n        } else {\r\n          // @ts-ignore\r\n          this.filter.pFlags[key] = true;\r\n        }\r\n      }\r\n\r\n      let cmp: (peerId: PeerId) => boolean;\r\n      if(this.type === 'included') {\r\n        cmp = (peerId) => peerIds.includes(peerId);\r\n      } else {\r\n        cmp = (peerId) => !peerIds.includes(peerId);\r\n      }\r\n\r\n      forEachReverse(this.filter.pinnedPeerIds, (peerId, idx) => {\r\n        if(!cmp(peerId)) {\r\n          this.filter.pinnedPeerIds.splice(idx, 1);\r\n          this.filter.pinned_peers.splice(idx, 1);\r\n        }\r\n      });\r\n\r\n      const other = this.type === 'included' ? 'excludePeerIds' : 'includePeerIds';\r\n      const otherLegacy = this.type === 'included' ? 'exclude_peers' : 'include_peers';\r\n      forEachReverse(this.filter[other], (peerId, idx) => {\r\n        if(peerIds.includes(peerId)) {\r\n          this.filter[other].splice(idx, 1);\r\n          this.filter[otherLegacy].splice(idx, 1);\r\n        }\r\n      });\r\n\r\n      this.filter[this.type === 'included' ? 'includePeerIds' : 'excludePeerIds'] = peerIds;\r\n      this.filter[this.type === 'included' ? 'include_peers' : 'exclude_peers'] = await Promise.all(peerIds.map((peerId) => this.managers.appPeersManager.getInputPeerById(peerId)));\r\n      // this.filter.pinned_peers = this.filter.pinned_peers.filter((peerId) => this.filter.include_peers.includes(peerId));\r\n\r\n      this.editFolderTab.setFilter(this.filter, false);\r\n      this.close();\r\n    }, {listenerSetter: this.listenerSetter});\r\n\r\n    const onAppConfig = (appConfig: MTAppConfig) => {\r\n      this.limit = rootScope.premium ? appConfig.dialog_filters_chats_limit_premium : appConfig.dialog_filters_chats_limit_default;\r\n    };\r\n\r\n    this.listenerSetter.add(rootScope)('app_config', onAppConfig);\r\n\r\n    this.dialogsByFilters = new Map();\r\n    return Promise.all([\r\n      this.managers.filtersStorage.getDialogFilters().then(async(filters) => {\r\n        await Promise.all(filters.filter((filter) => !REAL_FOLDERS.has(filter.id)).map(async(filter) => {\r\n          const dialogs = await this.managers.dialogsStorage.getFolderDialogs(filter.id);\r\n          const peerIds = dialogs.map((d) => d.peerId);\r\n          this.dialogsByFilters.set(filter, new Set(peerIds));\r\n        }));\r\n      }),\r\n\r\n      this.managers.apiManager.getAppConfig().then((appConfig) => {\r\n        onAppConfig(appConfig);\r\n      })\r\n    ]);\r\n  }\r\n\r\n  checkbox(selected?: boolean) {\r\n    const checkboxField = new CheckboxField({\r\n      round: true\r\n    });\r\n    if(selected) {\r\n      checkboxField.input.checked = selected;\r\n    }\r\n\r\n    return checkboxField.label;\r\n  }\r\n\r\n  renderResults = async(peerIds: PeerId[]) => {\r\n    // const other = this.type === 'included' ? this.filter.exclude_peers : this.filter.include_peers;\r\n\r\n    await this.managers.appUsersManager.getContacts();\r\n    peerIds.forEach((peerId) => {\r\n      // if(other.includes(peerId)) return;\r\n\r\n      const {dom} = appDialogsManager.addDialogNew({\r\n        peerId: peerId,\r\n        container: this.selector.scrollable,\r\n        rippleEnabled: true,\r\n        avatarSize: 46\r\n      });\r\n\r\n      const selected = this.selector.selected.has(peerId);\r\n      dom.containerEl.append(this.checkbox(selected));\r\n      // if(selected) dom.listEl.classList.add('active');\r\n\r\n      const foundInFilters: HTMLElement[] = [];\r\n      this.dialogsByFilters.forEach((dialogs, filter) => {\r\n        if(dialogs.has(peerId)) {\r\n          const span = document.createElement('span');\r\n          setInnerHTML(span, wrapEmojiText(filter.title));\r\n          foundInFilters.push(span);\r\n        }\r\n      });\r\n\r\n      const joined = join(foundInFilters, false);\r\n      joined.forEach((el) => {\r\n        dom.lastMessageSpan.append(el);\r\n      });\r\n    });\r\n  };\r\n\r\n  onOpen() {\r\n    if(this.init) {\r\n      this.init();\r\n      this.init = null;\r\n    }\r\n\r\n    this.confirmBtn.style.display = this.type === 'excluded' ? '' : 'none';\r\n    this.setTitle(this.type === 'included' ? 'FilterAlwaysShow' : 'FilterNeverShow');\r\n\r\n    const filter = this.filter;\r\n\r\n    const categoriesSection = new SettingSection({\r\n      noDelimiter: true,\r\n      name: 'FilterChatTypes'\r\n    });\r\n\r\n    categoriesSection.container.classList.add('folder-categories');\r\n\r\n    let details: {[flag: string]: {ico: string, text: LangPackKey}};\r\n    if(this.type === 'excluded') {\r\n      details = {\r\n        exclude_muted: {ico: 'mute', text: 'ChatList.Filter.MutedChats'},\r\n        exclude_archived: {ico: 'archive', text: 'ChatList.Filter.Archive'},\r\n        exclude_read: {ico: 'readchats', text: 'ChatList.Filter.ReadChats'}\r\n      };\r\n    } else {\r\n      details = {\r\n        contacts: {ico: 'newprivate', text: 'ChatList.Filter.Contacts'},\r\n        non_contacts: {ico: 'noncontacts', text: 'ChatList.Filter.NonContacts'},\r\n        groups: {ico: 'group', text: 'ChatList.Filter.Groups'},\r\n        broadcasts: {ico: 'newchannel', text: 'ChatList.Filter.Channels'},\r\n        bots: {ico: 'bots', text: 'ChatList.Filter.Bots'}\r\n      };\r\n    }\r\n\r\n    const f = document.createDocumentFragment();\r\n    for(const key in details) {\r\n      const button = Button('btn-primary btn-transparent folder-category-button', {icon: details[key].ico, text: details[key].text});\r\n      button.dataset.peerId = key;\r\n      button.append(this.checkbox());\r\n      f.append(button);\r\n    }\r\n    categoriesSection.content.append(f);\r\n\r\n    // ///////////////\r\n\r\n    const selectedPeers = (this.type === 'included' ? filter.includePeerIds : filter.excludePeerIds).slice();\r\n\r\n    this.selector = new AppSelectPeers({\r\n      appendTo: this.container,\r\n      onChange: this.onSelectChange,\r\n      peerType: ['dialogs'],\r\n      renderResultsFunc: this.renderResults,\r\n      placeholder: 'Search',\r\n      sectionNameLangPackKey: 'FilterChats',\r\n      managers: this.managers\r\n    });\r\n    this.selector.selected = new Set(selectedPeers);\r\n\r\n    let addedInitial = false;\r\n    const _add = this.selector.add.bind(this.selector);\r\n    this.selector.add = (peerId, title, scroll) => {\r\n      if(this.selector.selected.size >= this.limit && addedInitial && !details[peerId]) {\r\n        const el: HTMLInputElement = this.selector.list.querySelector(`[data-peer-id=\"${peerId}\"] [type=\"checkbox\"]`);\r\n        if(el) {\r\n          setTimeout(() => {\r\n            el.checked = false;\r\n          }, 0);\r\n        }\r\n\r\n        const str = I18n.format(this.type === 'excluded' ? 'ChatList.Filter.Exclude.LimitReached': 'ChatList.Filter.Include.LimitReached', true);\r\n        toast(str);\r\n        return;\r\n      }\r\n\r\n      const div = _add(peerId, details[peerId] ? i18n(details[peerId].text) : undefined, scroll);\r\n      if(details[peerId]) {\r\n        div.querySelector('avatar-element').classList.add('tgico-' + details[peerId].ico);\r\n      }\r\n      return div;\r\n    };\r\n\r\n    this.selector.scrollable.container.append(categoriesSection.container, this.selector.scrollable.container.lastElementChild);\r\n\r\n    this.selector.addInitial(selectedPeers);\r\n    addedInitial = true;\r\n\r\n    for(const flag in filter.pFlags) {\r\n      // @ts-ignore\r\n      if(details.hasOwnProperty(flag) && !!filter.pFlags[flag]) {\r\n        simulateClickEvent(categoriesSection.content.querySelector(`[data-peer-id=\"${flag}\"]`) as HTMLElement);\r\n      }\r\n    }\r\n  }\r\n\r\n  onSelectChange = (length: number) => {\r\n    // const changed = !deepEqual(this.filter, this.originalFilter);\r\n    if(this.type === 'included') {\r\n      this.confirmBtn.style.display = length ? '' : 'none';\r\n    }\r\n  };\r\n\r\n  onCloseAfterTimeout() {\r\n    if(this.selector) {\r\n      this.selector.container.remove();\r\n      this.selector = null;\r\n    }\r\n\r\n    return super.onCloseAfterTimeout();\r\n  }\r\n\r\n  /**\r\n   * Do not ignore arguments!\r\n   */\r\n  public open(filter?: DialogFilter, type?: 'included' | 'excluded', editFolderTab?: AppIncludedChatsTab['editFolderTab']) {\r\n    this.originalFilter = filter;\r\n    this.filter = copy(this.originalFilter);\r\n    this.type = type;\r\n    this.editFolderTab = editFolderTab;\r\n\r\n    return super.open();\r\n  }\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport appDialogsManager from '../../../lib/appManagers/appDialogsManager';\r\nimport {MyDialogFilter as DialogFilter} from '../../../lib/storages/filters';\r\nimport lottieLoader, {LottieLoader} from '../../../lib/rlottie/lottieLoader';\r\nimport {SliderSuperTab} from '../../slider';\r\nimport {toast} from '../../toast';\r\nimport InputField from '../../inputField';\r\nimport ButtonIcon from '../../buttonIcon';\r\nimport ButtonMenuToggle from '../../buttonMenuToggle';\r\nimport {ButtonMenuItemOptions} from '../../buttonMenu';\r\nimport Button from '../../button';\r\nimport AppIncludedChatsTab from './includedChats';\r\nimport {i18n, LangPackKey} from '../../../lib/langPack';\r\nimport {SettingSection} from '..';\r\nimport PopupPeer from '../../popups/peer';\r\nimport RLottiePlayer from '../../../lib/rlottie/rlottiePlayer';\r\nimport copy from '../../../helpers/object/copy';\r\nimport deepEqual from '../../../helpers/object/deepEqual';\r\nimport documentFragmentToHTML from '../../../helpers/dom/documentFragmentToHTML';\r\nimport wrapDraftText from '../../../lib/richTextProcessor/wrapDraftText';\r\nimport filterAsync from '../../../helpers/array/filterAsync';\r\nimport {attachClickEvent} from '../../../helpers/dom/clickEvent';\r\n\r\nconst MAX_FOLDER_NAME_LENGTH = 12;\r\n\r\nexport default class AppEditFolderTab extends SliderSuperTab {\r\n  private caption: HTMLElement;\r\n  private stickerContainer: HTMLElement;\r\n\r\n  private confirmBtn: HTMLElement;\r\n  private menuBtn: HTMLElement;\r\n  private nameInputField: InputField;\r\n\r\n  private includePeerIds: SettingSection;\r\n  private excludePeerIds: SettingSection;\r\n  private flags: {[k in 'contacts' | 'non_contacts' | 'groups' | 'broadcasts' | 'bots' | 'exclude_muted' | 'exclude_archived' | 'exclude_read']: HTMLElement} = {} as any;\r\n\r\n  private animation: RLottiePlayer;\r\n  private filter: DialogFilter;\r\n  private originalFilter: DialogFilter;\r\n\r\n  private type: 'edit' | 'create';\r\n  private loadAnimationPromise: ReturnType<LottieLoader['waitForFirstFrame']>;\r\n\r\n  protected init() {\r\n    this.container.classList.add('edit-folder-container');\r\n    this.caption = document.createElement('div');\r\n    this.caption.classList.add('caption');\r\n    this.caption.append(i18n('FilterIncludeExcludeInfo'));\r\n    this.stickerContainer = document.createElement('div');\r\n    this.stickerContainer.classList.add('sticker-container');\r\n\r\n    this.confirmBtn = ButtonIcon('check btn-confirm hide blue');\r\n    const deleteFolderButton: ButtonMenuItemOptions = {\r\n      icon: 'delete danger',\r\n      text: 'FilterMenuDelete',\r\n      onClick: () => {\r\n        new PopupPeer('filter-delete', {\r\n          titleLangKey: 'ChatList.Filter.Confirm.Remove.Header',\r\n          descriptionLangKey: 'ChatList.Filter.Confirm.Remove.Text',\r\n          buttons: [{\r\n            langKey: 'Delete',\r\n            callback: () => {\r\n              deleteFolderButton.element.setAttribute('disabled', 'true');\r\n              this.managers.filtersStorage.updateDialogFilter(this.filter, true).then((bool) => {\r\n                if(bool) {\r\n                  this.close();\r\n                }\r\n              }).finally(() => {\r\n                deleteFolderButton.element.removeAttribute('disabled');\r\n              });\r\n            },\r\n            isDanger: true\r\n          }]\r\n        }).show();\r\n      }\r\n    };\r\n    this.menuBtn = ButtonMenuToggle({listenerSetter: this.listenerSetter}, 'bottom-left', [deleteFolderButton]);\r\n    this.menuBtn.classList.add('hide');\r\n\r\n    this.header.append(this.confirmBtn, this.menuBtn);\r\n\r\n    const inputSection = new SettingSection({});\r\n\r\n    const inputWrapper = document.createElement('div');\r\n    inputWrapper.classList.add('input-wrapper');\r\n\r\n    this.nameInputField = new InputField({\r\n      label: 'FilterNameHint',\r\n      maxLength: MAX_FOLDER_NAME_LENGTH\r\n    });\r\n\r\n    inputWrapper.append(this.nameInputField.container);\r\n    inputSection.content.append(inputWrapper);\r\n\r\n    const generateList = (className: string, h2Text: LangPackKey, buttons: {icon: string, name?: string, withRipple?: true, text: LangPackKey}[], to: any) => {\r\n      const section = new SettingSection({\r\n        name: h2Text,\r\n        noDelimiter: true\r\n      });\r\n\r\n      section.container.classList.add('folder-list', className);\r\n\r\n      const categories = section.generateContentElement();\r\n      categories.classList.add('folder-categories');\r\n\r\n      buttons.forEach((o) => {\r\n        const button = Button('folder-category-button btn btn-primary btn-transparent', {\r\n          icon: o.icon,\r\n          text: o.text,\r\n          noRipple: o.withRipple ? undefined : true\r\n        });\r\n\r\n        if(o.name) {\r\n          to[o.name] = button;\r\n        }\r\n\r\n        categories.append(button);\r\n      });\r\n\r\n      return section;\r\n    };\r\n\r\n    this.includePeerIds = generateList('folder-list-included', 'FilterInclude', [{\r\n      icon: 'add primary',\r\n      text: 'ChatList.Filter.Include.AddChat',\r\n      withRipple: true\r\n    }, {\r\n      text: 'ChatList.Filter.Contacts',\r\n      icon: 'newprivate',\r\n      name: 'contacts'\r\n    }, {\r\n      text: 'ChatList.Filter.NonContacts',\r\n      icon: 'noncontacts',\r\n      name: 'non_contacts'\r\n    }, {\r\n      text: 'ChatList.Filter.Groups',\r\n      icon: 'group',\r\n      name: 'groups'\r\n    }, {\r\n      text: 'ChatList.Filter.Channels',\r\n      icon: 'channel',\r\n      name: 'broadcasts'\r\n    }, {\r\n      text: 'ChatList.Filter.Bots',\r\n      icon: 'bots',\r\n      name: 'bots'\r\n    }], this.flags);\r\n\r\n    this.excludePeerIds = generateList('folder-list-excluded', 'FilterExclude', [{\r\n      icon: 'minus primary',\r\n      text: 'ChatList.Filter.Exclude.AddChat',\r\n      withRipple: true\r\n    }, {\r\n      text: 'ChatList.Filter.MutedChats',\r\n      icon: 'mute',\r\n      name: 'exclude_muted'\r\n    }, {\r\n      text: 'ChatList.Filter.Archive',\r\n      icon: 'archive',\r\n      name: 'exclude_archived'\r\n    }, {\r\n      text: 'ChatList.Filter.ReadChats',\r\n      icon: 'readchats',\r\n      name: 'exclude_read'\r\n    }], this.flags);\r\n\r\n    this.scrollable.append(this.stickerContainer, this.caption, inputSection.container, this.includePeerIds.container, this.excludePeerIds.container);\r\n\r\n    const includedFlagsContainer = this.includePeerIds.container.querySelector('.folder-categories');\r\n    const excludedFlagsContainer = this.excludePeerIds.container.querySelector('.folder-categories');\r\n\r\n    attachClickEvent(includedFlagsContainer.querySelector('.btn') as HTMLElement, () => {\r\n      this.slider.createTab(AppIncludedChatsTab).open(this.filter, 'included', this);\r\n    }, {listenerSetter: this.listenerSetter});\r\n\r\n    attachClickEvent(excludedFlagsContainer.querySelector('.btn') as HTMLElement, () => {\r\n      this.slider.createTab(AppIncludedChatsTab).open(this.filter, 'excluded', this);\r\n    }, {listenerSetter: this.listenerSetter});\r\n\r\n    attachClickEvent(this.confirmBtn, () => {\r\n      if(this.nameInputField.input.classList.contains('error')) {\r\n        return;\r\n      }\r\n\r\n      if(!this.nameInputField.value.trim()) {\r\n        this.nameInputField.input.classList.add('error');\r\n        return;\r\n      }\r\n\r\n      let include = (Array.from(includedFlagsContainer.children) as HTMLElement[]).slice(1).reduce((acc, el) => acc + +!el.style.display, 0);\r\n      include += this.filter.include_peers.length;\r\n\r\n      if(!include) {\r\n        toast('Please choose at least one chat for this folder.');\r\n        return;\r\n      }\r\n\r\n      this.confirmBtn.setAttribute('disabled', 'true');\r\n\r\n      let promise: Promise<boolean>;\r\n      if(!this.filter.id) {\r\n        promise = this.managers.filtersStorage.createDialogFilter(this.filter);\r\n      } else {\r\n        promise = this.managers.filtersStorage.updateDialogFilter(this.filter);\r\n      }\r\n\r\n      promise.then((bool) => {\r\n        if(bool) {\r\n          this.close();\r\n        }\r\n      }).catch((err) => {\r\n        if(err.type === 'DIALOG_FILTERS_TOO_MUCH') {\r\n          toast('Sorry, you can\\'t create more folders.');\r\n        } else {\r\n          console.error('updateDialogFilter error:', err);\r\n        }\r\n      }).finally(() => {\r\n        this.confirmBtn.removeAttribute('disabled');\r\n      });\r\n    }, {listenerSetter: this.listenerSetter});\r\n\r\n    this.listenerSetter.add(this.nameInputField.input)('input', () => {\r\n      this.filter.title = this.nameInputField.value;\r\n      this.editCheckForChange();\r\n    });\r\n\r\n    const reloadMissingPromises: Promise<any>[] = this.type === 'edit' ? [\r\n      this.managers.filtersStorage.reloadMissingPeerIds(this.filter.id, 'pinned_peers'),\r\n      this.managers.filtersStorage.reloadMissingPeerIds(this.filter.id, 'include_peers'),\r\n      this.managers.filtersStorage.reloadMissingPeerIds(this.filter.id, 'exclude_peers')\r\n    ] : [];\r\n\r\n    return Promise.all([\r\n      this.loadAnimationPromise = lottieLoader.loadAnimationAsAsset({\r\n        container: this.stickerContainer,\r\n        loop: false,\r\n        autoplay: false,\r\n        width: 86,\r\n        height: 86\r\n      }, 'Folders_2').then((player) => {\r\n        this.animation = player;\r\n\r\n        return lottieLoader.waitForFirstFrame(player);\r\n      }),\r\n\r\n      ...reloadMissingPromises\r\n    ]);\r\n  }\r\n\r\n  onOpenAfterTimeout() {\r\n    this.loadAnimationPromise.then(() => {\r\n      this.animation.autoplay = true;\r\n      this.animation.play();\r\n    });\r\n  }\r\n\r\n  private onCreateOpen() {\r\n    // this.caption.style.display = '';\r\n    this.setTitle('FilterNew');\r\n    this.menuBtn.classList.add('hide');\r\n    this.confirmBtn.classList.remove('hide');\r\n    this.nameInputField.value = '';\r\n\r\n    for(const flag in this.flags) {\r\n      // @ts-ignore\r\n      this.flags[flag].style.display = 'none';\r\n    }\r\n  }\r\n\r\n  private onEditOpen() {\r\n    // this.caption.style.display = 'none';\r\n    this.setTitle(this.type === 'create' ? 'FilterNew' : 'FilterHeaderEdit');\r\n\r\n    if(this.type === 'edit') {\r\n      this.menuBtn.classList.remove('hide');\r\n      this.confirmBtn.classList.add('hide');\r\n    }\r\n\r\n    const filter = this.filter;\r\n    this.nameInputField.value = documentFragmentToHTML(wrapDraftText(filter.title));\r\n\r\n    for(const flag in this.flags) {\r\n      this.flags[flag as keyof AppEditFolderTab['flags']].style.display = !!filter.pFlags[flag as keyof AppEditFolderTab['flags']] ? '' : 'none';\r\n    }\r\n\r\n    (['includePeerIds' as const, 'excludePeerIds' as const]).forEach(async(key) => {\r\n      const section = this[key];\r\n      const ul = appDialogsManager.createChatList({ignoreClick: true});\r\n\r\n      let peers = filter[key];\r\n\r\n      // filter peers where we're kicked\r\n      const hasPeer = async(peerId: PeerId) => {\r\n        return !!(await this.managers.appMessagesManager.getDialogOnly(peerId)) || (peerId.isUser() ? (await this.managers.appUsersManager.getUser(peerId.toUserId()))._ === 'user' : false);\r\n      };\r\n\r\n      const filtered = await filterAsync(peers, (peerId) => hasPeer(peerId));\r\n      peers.length = 0;\r\n      peers.push(...filtered);\r\n\r\n      peers = peers.slice();\r\n\r\n      const renderMore = async(_length: number) => {\r\n        for(let i = 0, length = Math.min(peers.length, _length); i < length; ++i) {\r\n          const peerId = peers.shift();\r\n          if(peerId.isUser() ? false : !(await this.managers.appMessagesManager.getDialogOnly(peerId))) {\r\n            continue;\r\n          }\r\n\r\n          const {dom} = appDialogsManager.addDialogNew({\r\n            peerId: peerId,\r\n            container: ul,\r\n            rippleEnabled: false,\r\n            meAsSaved: true,\r\n            avatarSize: 32\r\n          });\r\n          dom.lastMessageSpan.parentElement.remove();\r\n        }\r\n\r\n        if(peers.length) {\r\n          showMore.lastElementChild.replaceWith(i18n('FilterShowMoreChats', [peers.length]));\r\n        } else if(showMore) {\r\n          showMore.remove();\r\n        }\r\n      };\r\n\r\n      section.generateContentElement().append(ul);\r\n\r\n      let showMore: HTMLElement;\r\n      if(peers.length) {\r\n        const content = section.generateContentElement();\r\n        showMore = Button('folder-category-button btn btn-primary btn-transparent', {icon: 'down'});\r\n        showMore.classList.add('load-more', 'rp-overflow');\r\n        attachClickEvent(showMore, () => renderMore(20), {listenerSetter: this.listenerSetter});\r\n        showMore.append(i18n('FilterShowMoreChats', [peers.length]));\r\n\r\n        content.append(showMore);\r\n      }\r\n\r\n      renderMore(4);\r\n    });\r\n  }\r\n\r\n  editCheckForChange() {\r\n    if(this.type === 'edit') {\r\n      const changed = !deepEqual(this.originalFilter, this.filter);\r\n      this.confirmBtn.classList.toggle('hide', !changed);\r\n      this.menuBtn.classList.toggle('hide', changed);\r\n    }\r\n  };\r\n\r\n  setFilter(filter: DialogFilter, firstTime: boolean) {\r\n    if(this.container) {\r\n      // cleanup\r\n      Array.from(this.container.querySelectorAll('ul, .load-more')).forEach((el) => el.remove());\r\n    }\r\n\r\n    if(firstTime) {\r\n      this.originalFilter = filter;\r\n      this.filter = copy(filter);\r\n    } else {\r\n      this.filter = filter;\r\n      this.onEditOpen();\r\n      this.editCheckForChange();\r\n    }\r\n  }\r\n\r\n  public open(filter?: DialogFilter) {\r\n    if(filter === undefined) {\r\n      this.setFilter({\r\n        _: 'dialogFilter',\r\n        id: 0,\r\n        title: '',\r\n        pFlags: {},\r\n        pinned_peers: [],\r\n        include_peers: [],\r\n        exclude_peers: [],\r\n        pinnedPeerIds: [],\r\n        includePeerIds: [],\r\n        excludePeerIds: []\r\n      }, true);\r\n      this.type = 'create';\r\n    } else {\r\n      this.setFilter(filter, true);\r\n      this.type = 'edit';\r\n    }\r\n\r\n    return super.open().then(() => {\r\n      if(this.type === 'edit') {\r\n        this.setFilter(this.originalFilter, true);\r\n        this.onEditOpen();\r\n      } else {\r\n        this.onCreateOpen();\r\n      }\r\n    });\r\n  }\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport appImManager from '../../lib/appManagers/appImManager';\r\nimport SidebarSlider from '../slider';\r\nimport mediaSizes, {ScreenSize} from '../../helpers/mediaSizes';\r\nimport AppSharedMediaTab from './tabs/sharedMedia';\r\nimport {MOUNT_CLASS_TO} from '../../config/debug';\r\nimport {AppManagers} from '../../lib/appManagers/managers';\r\n\r\nexport const RIGHT_COLUMN_ACTIVE_CLASSNAME = 'is-right-column-shown';\r\n\r\nexport class AppSidebarRight extends SidebarSlider {\r\n  private isColumnProportionSet = false;\r\n  private sharedMediaTab: AppSharedMediaTab;\r\n\r\n  constructor() {\r\n    super({\r\n      sidebarEl: document.getElementById('column-right') as HTMLElement,\r\n      canHideFirst: true,\r\n      navigationType: 'right'\r\n    });\r\n  }\r\n\r\n  construct(managers: AppManagers) {\r\n    this.managers = managers;\r\n\r\n    mediaSizes.addEventListener('changeScreen', (from, to) => {\r\n      if(to === ScreenSize.medium && from !== ScreenSize.mobile) {\r\n        this.toggleSidebar(false);\r\n      }\r\n    });\r\n\r\n    mediaSizes.addEventListener('resize', () => {\r\n      this.setColumnProportion();\r\n    });\r\n  }\r\n\r\n  public createSharedMediaTab() {\r\n    const tab = this.createTab(AppSharedMediaTab, true);\r\n    tab.slider = this;\r\n    // this.tabsContainer.prepend(tab.container);\r\n    return tab;\r\n  }\r\n\r\n  public replaceSharedMediaTab(tab?: AppSharedMediaTab) {\r\n    const previousTab = this.sharedMediaTab;\r\n    if(previousTab) {\r\n      const idx = this.historyTabIds.indexOf(previousTab);\r\n\r\n      if(this._selectTab.getFrom() === previousTab.container) {\r\n        this._selectTab.setFrom(tab.container);\r\n      }\r\n\r\n      if(tab) {\r\n        if(idx !== -1) {\r\n          this.historyTabIds[idx] = tab;\r\n        }\r\n\r\n        const wasActive = previousTab.container.classList.contains('active');\r\n        if(wasActive) {\r\n          tab.container.classList.add('active');\r\n        }\r\n\r\n        previousTab.container.replaceWith(tab.container);\r\n      } else {\r\n        if(idx !== -1) {\r\n          this.historyTabIds.splice(idx, 1);\r\n        }\r\n\r\n        previousTab.container.remove();\r\n      }\r\n    } else {\r\n      this.tabsContainer.prepend(tab.container);\r\n    }\r\n\r\n    this.sharedMediaTab = tab;\r\n  }\r\n\r\n  public onCloseTab(id: number, animate: boolean, isNavigation?: boolean) {\r\n    if(!this.historyTabIds.length) {\r\n      this.toggleSidebar(false, animate);\r\n    }\r\n\r\n    super.onCloseTab(id, animate, isNavigation);\r\n  }\r\n\r\n  private setColumnProportion() {\r\n    const proportion = this.sidebarEl.scrollWidth / this.sidebarEl.previousElementSibling.scrollWidth;\r\n    document.documentElement.style.setProperty('--right-column-proportion', '' + proportion);\r\n  }\r\n\r\n  public toggleSidebar(enable?: boolean, animate?: boolean) {\r\n    const active = document.body.classList.contains(RIGHT_COLUMN_ACTIVE_CLASSNAME);\r\n    let willChange: boolean;\r\n    if(enable !== undefined) {\r\n      if(enable) {\r\n        if(!active) {\r\n          willChange = true;\r\n        }\r\n      } else if(active) {\r\n        willChange = true;\r\n      }\r\n    } else {\r\n      willChange = true;\r\n    }\r\n\r\n    if(!willChange) return Promise.resolve();\r\n\r\n    if(!active && !this.historyTabIds.length) {\r\n      this.sharedMediaTab.open();\r\n    }\r\n\r\n    if(!this.isColumnProportionSet) {\r\n      this.setColumnProportion();\r\n      this.isColumnProportionSet = true;\r\n    }\r\n\r\n    const animationPromise = appImManager.selectTab(active ? 1 : 2, animate);\r\n    document.body.classList.toggle(RIGHT_COLUMN_ACTIVE_CLASSNAME, enable);\r\n    return animationPromise;\r\n\r\n    /* return new Promise((resolve, reject) => {\r\n      const hidden: {element: HTMLDivElement, height: number}[] = [];\r\n      const observer = new IntersectionObserver((entries) => {\r\n        for(const entry of entries) {\r\n          const bubble = entry.target as HTMLDivElement;\r\n          if(!entry.isIntersecting) {\r\n            hidden.push({element: bubble, height: bubble.scrollHeight});\r\n          }\r\n        }\r\n\r\n        for(const item of hidden) {\r\n          item.element.style.minHeight = item.height + 'px';\r\n          (item.element.firstElementChild as HTMLElement).style.display = 'none';\r\n          item.element.style.width = '1px';\r\n        }\r\n\r\n        //console.log('hidden', hidden);\r\n        observer.disconnect();\r\n\r\n        set();\r\n\r\n        setTimeout(() => {\r\n          for(const item of hidden) {\r\n            item.element.style.minHeight = '';\r\n            item.element.style.width = '';\r\n            (item.element.firstElementChild as HTMLElement).style.display = '';\r\n          }\r\n\r\n          resolve();\r\n        }, 200);\r\n      });\r\n\r\n      const length = Object.keys(appImManager.bubbles).length;\r\n      if(length) {\r\n        for(const i in appImManager.bubbles) {\r\n          observer.observe(appImManager.bubbles[i]);\r\n        }\r\n      } else {\r\n        set();\r\n        setTimeout(resolve, 200);\r\n      }\r\n    }); */\r\n  }\r\n}\r\n\r\nconst appSidebarRight = new AppSidebarRight();\r\nMOUNT_CLASS_TO.appSidebarRight = appSidebarRight;\r\nexport default appSidebarRight;\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport {SliderSuperTab} from '../../slider'\r\nimport InputField from '../../inputField';\r\nimport EditPeer from '../../editPeer';\r\nimport {SettingSection} from '../../sidebarLeft';\r\nimport Row from '../../row';\r\nimport CheckboxField from '../../checkboxField';\r\nimport Button from '../../button';\r\nimport PeerTitle from '../../peerTitle';\r\nimport rootScope from '../../../lib/rootScope';\r\nimport PopupPeer from '../../popups/peer';\r\nimport {addCancelButton} from '../../popups';\r\nimport {i18n} from '../../../lib/langPack';\r\nimport {attachClickEvent} from '../../../helpers/dom/clickEvent';\r\nimport toggleDisability from '../../../helpers/dom/toggleDisability';\r\nimport getPeerId from '../../../lib/appManagers/utils/peers/getPeerId';\r\nimport formatUserPhone from '../../wrappers/formatUserPhone';\r\n\r\nexport default class AppEditContactTab extends SliderSuperTab {\r\n  private nameInputField: InputField;\r\n  private lastNameInputField: InputField;\r\n  private editPeer: EditPeer;\r\n  public peerId: PeerId;\r\n\r\n  protected async init() {\r\n    this.container.classList.add('edit-peer-container', 'edit-contact-container');\r\n    const isNew = !(await this.managers.appUsersManager.isContact(this.peerId.toUserId()));\r\n    this.setTitle(isNew ? 'AddContactTitle' : 'Edit');\r\n\r\n    {\r\n      const section = new SettingSection({noDelimiter: true});\r\n      const inputFields: InputField[] = [];\r\n\r\n      const inputWrapper = document.createElement('div');\r\n      inputWrapper.classList.add('input-wrapper');\r\n\r\n      this.nameInputField = new InputField({\r\n        label: 'FirstName',\r\n        name: 'contact-name',\r\n        maxLength: 70,\r\n        required: true\r\n      });\r\n      this.lastNameInputField = new InputField({\r\n        label: 'LastName',\r\n        name: 'contact-lastname',\r\n        maxLength: 70\r\n      });\r\n\r\n      if(this.peerId) {\r\n        const user = await this.managers.appUsersManager.getUser(this.peerId);\r\n\r\n        if(isNew) {\r\n          this.nameInputField.setDraftValue(user.first_name);\r\n          this.lastNameInputField.setDraftValue(user.last_name);\r\n        } else {\r\n          this.nameInputField.setOriginalValue(user.first_name);\r\n          this.lastNameInputField.setOriginalValue(user.last_name);\r\n        }\r\n      }\r\n\r\n      inputWrapper.append(this.nameInputField.container, this.lastNameInputField.container);\r\n      inputFields.push(this.nameInputField, this.lastNameInputField);\r\n\r\n      this.editPeer = new EditPeer({\r\n        peerId: this.peerId,\r\n        inputFields,\r\n        listenerSetter: this.listenerSetter,\r\n        doNotEditAvatar: true\r\n      });\r\n      this.content.append(this.editPeer.nextBtn);\r\n\r\n      if(this.peerId) {\r\n        const div = document.createElement('div');\r\n        div.classList.add('avatar-edit');\r\n        div.append(this.editPeer.avatarElem);\r\n\r\n        const notificationsCheckboxField = new CheckboxField({\r\n          text: 'Notifications'\r\n        });\r\n\r\n        notificationsCheckboxField.input.addEventListener('change', (e) => {\r\n          if(!e.isTrusted) {\r\n            return;\r\n          }\r\n\r\n          this.managers.appMessagesManager.togglePeerMute(this.peerId);\r\n        });\r\n\r\n        this.listenerSetter.add(rootScope)('notify_settings', async(update) => {\r\n          if(update.peer._ !== 'notifyPeer') return;\r\n          const peerId = getPeerId(update.peer.peer);\r\n          if(this.peerId === peerId) {\r\n            const enabled = !(await this.managers.appNotificationsManager.isMuted(update.notify_settings));\r\n            if(enabled !== notificationsCheckboxField.checked) {\r\n              notificationsCheckboxField.checked = enabled;\r\n            }\r\n          }\r\n        });\r\n\r\n        const profileNameDiv = document.createElement('div');\r\n        profileNameDiv.classList.add('profile-name');\r\n        profileNameDiv.append(new PeerTitle({\r\n          peerId: this.peerId\r\n        }).element);\r\n        // profileNameDiv.innerHTML = 'Karen Stanford';\r\n\r\n        const profileSubtitleDiv = document.createElement('div');\r\n        profileSubtitleDiv.classList.add('profile-subtitle');\r\n        profileSubtitleDiv.append(i18n('EditContact.OriginalName'));\r\n\r\n        section.content.append(div, profileNameDiv, profileSubtitleDiv, inputWrapper);\r\n\r\n        if(!isNew) {\r\n          const notificationsRow = new Row({\r\n            checkboxField: notificationsCheckboxField,\r\n            listenerSetter: this.listenerSetter\r\n          });\r\n\r\n          const enabled = !(await this.managers.appNotificationsManager.isPeerLocalMuted(this.peerId, false));\r\n          notificationsCheckboxField.checked = enabled;\r\n\r\n          section.content.append(notificationsRow.container);\r\n        } else {\r\n          const user = await this.managers.appUsersManager.getUser(this.peerId);\r\n\r\n          const phoneRow = new Row({\r\n            icon: 'phone',\r\n            titleLangKey: user.phone ? undefined : 'MobileHidden',\r\n            title: user.phone ? formatUserPhone(user.phone)  : undefined,\r\n            subtitleLangKey: user.phone ? 'Phone' : 'MobileHiddenExceptionInfo',\r\n            subtitleLangArgs: user.phone ? undefined : [new PeerTitle({peerId: this.peerId}).element]\r\n          });\r\n\r\n          section.content.append(phoneRow.container);\r\n        }\r\n      } else {\r\n        section.content.append(inputWrapper);\r\n      }\r\n\r\n      this.scrollable.append(section.container);\r\n\r\n      attachClickEvent(this.editPeer.nextBtn, async() => {\r\n        this.editPeer.nextBtn.disabled = true;\r\n\r\n        this.managers.appUsersManager.addContact(\r\n          this.peerId,\r\n          this.nameInputField.value,\r\n          this.lastNameInputField.value,\r\n          (await this.managers.appUsersManager.getUser(this.peerId)).phone\r\n        ).finally(() => {\r\n          this.editPeer.nextBtn.removeAttribute('disabled');\r\n          this.close();\r\n        });\r\n      }, {listenerSetter: this.listenerSetter});\r\n    }\r\n\r\n    if(!isNew) {\r\n      const section = new SettingSection({\r\n\r\n      });\r\n\r\n      const btnDelete = Button('btn-primary btn-transparent danger', {icon: 'delete', text: 'PeerInfo.DeleteContact'});\r\n\r\n      attachClickEvent(btnDelete, () => {\r\n        new PopupPeer('popup-delete-contact', {\r\n          peerId: this.peerId,\r\n          titleLangKey: 'DeleteContact',\r\n          descriptionLangKey: 'AreYouSureDeleteContact',\r\n          buttons: addCancelButton([{\r\n            langKey: 'Delete',\r\n            callback: () => {\r\n              const toggle = toggleDisability([btnDelete], true);\r\n\r\n              this.managers.appUsersManager.deleteContacts([this.peerId]).then(() => {\r\n                this.close();\r\n              }, () => {\r\n                toggle();\r\n              });\r\n            },\r\n            isDanger: true\r\n          }])\r\n        }).show();\r\n      }, {listenerSetter: this.listenerSetter});\r\n\r\n      section.content.append(btnDelete);\r\n\r\n      this.scrollable.append(section.container);\r\n    }\r\n  }\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport {copyTextToClipboard} from '../../../helpers/clipboard';\r\nimport {randomLong} from '../../../helpers/random';\r\nimport {Chat, ChatFull, ExportedChatInvite} from '../../../layer';\r\nimport Button from '../../button';\r\nimport {setButtonLoader} from '../../putPreloader';\r\nimport RadioField from '../../radioField';\r\nimport Row, {RadioFormFromRows} from '../../row';\r\nimport {SettingSection} from '../../sidebarLeft';\r\nimport {toast} from '../../toast';\r\nimport {UsernameInputField} from '../../usernameInputField';\r\nimport {SliderSuperTabEventable} from '../../sliderTab';\r\nimport I18n from '../../../lib/langPack';\r\nimport PopupPeer from '../../popups/peer';\r\nimport ButtonCorner from '../../buttonCorner';\r\nimport {attachClickEvent} from '../../../helpers/dom/clickEvent';\r\nimport toggleDisability from '../../../helpers/dom/toggleDisability';\r\nimport CheckboxField from '../../checkboxField';\r\nimport rootScope from '../../../lib/rootScope';\r\n\r\nexport default class AppChatTypeTab extends SliderSuperTabEventable {\r\n  public chatId: ChatId;\r\n  public chatFull: ChatFull;\r\n\r\n  protected async init() {\r\n    this.container.classList.add('edit-peer-container', 'group-type-container');\r\n\r\n    const isBroadcast = await this.managers.appChatsManager.isBroadcast(this.chatId);\r\n\r\n    this.setTitle(isBroadcast ? 'ChannelType' : 'GroupType');\r\n\r\n    const section = new SettingSection({\r\n      name: isBroadcast ? 'ChannelType' : 'GroupType'\r\n    });\r\n\r\n    const random = randomLong();\r\n    const privateRow = new Row({\r\n      radioField: new RadioField({\r\n        langKey: isBroadcast ? 'ChannelPrivate' : 'MegaPrivate',\r\n        name: random,\r\n        value: 'private'\r\n      }),\r\n      subtitleLangKey: isBroadcast ? 'ChannelPrivateInfo' : 'MegaPrivateInfo'\r\n    });\r\n    const publicRow = new Row({\r\n      radioField: new RadioField({\r\n        langKey: isBroadcast ? 'ChannelPublic' : 'MegaPublic',\r\n        name: random,\r\n        value: 'public'\r\n      }),\r\n      subtitleLangKey: isBroadcast ? 'ChannelPublicInfo' : 'MegaPublicInfo'\r\n    });\r\n    const form = RadioFormFromRows([privateRow, publicRow], (value) => {\r\n      const a = [privateSection, publicSection];\r\n      if(value === 'public') a.reverse();\r\n\r\n      a[0].container.classList.remove('hide');\r\n      a[1].container.classList.add('hide');\r\n\r\n      onChange();\r\n    });\r\n\r\n    const chat: Chat = await this.managers.appChatsManager.getChat(this.chatId);\r\n\r\n    section.content.append(form);\r\n\r\n    const privateSection = new SettingSection({});\r\n\r\n    // let revoked = false;\r\n    const linkRow = new Row({\r\n      title: (this.chatFull.exported_invite as ExportedChatInvite.chatInviteExported).link,\r\n      subtitleLangKey: isBroadcast ? 'ChannelPrivateLinkHelp' : 'MegaPrivateLinkHelp',\r\n      clickable: () => {\r\n        copyTextToClipboard((this.chatFull.exported_invite as ExportedChatInvite.chatInviteExported).link);\r\n        toast(I18n.format('LinkCopied', true));\r\n      },\r\n      listenerSetter: this.listenerSetter\r\n    });\r\n\r\n    const btnRevoke = Button('btn-primary btn-transparent danger', {icon: 'delete', text: 'RevokeLink'});\r\n\r\n    attachClickEvent(btnRevoke, () => {\r\n      new PopupPeer('revoke-link', {\r\n        buttons: [{\r\n          langKey: 'RevokeButton',\r\n          callback: () => {\r\n            const toggle = toggleDisability([btnRevoke], true);\r\n\r\n            this.managers.appProfileManager.getChatInviteLink(this.chatId, true).then((link) => {\r\n              toggle();\r\n              linkRow.title.innerHTML = link;\r\n              // revoked = true;\r\n              // onChange();\r\n            });\r\n          }\r\n        }],\r\n        titleLangKey: 'RevokeLink',\r\n        descriptionLangKey: 'RevokeAlert'\r\n      }).show();\r\n    }, {listenerSetter: this.listenerSetter});\r\n\r\n    privateSection.content.append(linkRow.container, btnRevoke);\r\n\r\n    const publicSection = new SettingSection({\r\n      caption: isBroadcast ? 'Channel.UsernameAboutChannel' : 'Channel.UsernameAboutGroup',\r\n      noDelimiter: true\r\n    });\r\n\r\n    const inputWrapper = document.createElement('div');\r\n    inputWrapper.classList.add('input-wrapper');\r\n\r\n    const placeholder = 't.me/';\r\n\r\n    const onChange = () => {\r\n      const changed = (privateRow.radioField.checked && (originalValue !== placeholder/*  || revoked */)) ||\r\n        (linkInputField.isValidToChange() && linkInputField.input.classList.contains('valid'));\r\n      applyBtn.classList.toggle('is-visible', changed);\r\n    };\r\n\r\n    const linkInputField = new UsernameInputField({\r\n      label: 'SetUrlPlaceholder',\r\n      name: 'group-public-link',\r\n      plainText: true,\r\n      listenerSetter: this.listenerSetter,\r\n      availableText: 'Link.Available',\r\n      invalidText: 'Link.Invalid',\r\n      takenText: 'Link.Taken',\r\n      onChange: onChange,\r\n      peerId: this.chatId.toPeerId(true),\r\n      head: placeholder\r\n    }, this.managers);\r\n\r\n    const originalValue = placeholder + ((chat as Chat.channel).username || '');\r\n\r\n    inputWrapper.append(linkInputField.container)\r\n    publicSection.content.append(inputWrapper);\r\n\r\n    const applyBtn = ButtonCorner({icon: 'check', className: 'is-visible'});\r\n    this.content.append(applyBtn);\r\n\r\n    attachClickEvent(applyBtn, () => {\r\n      /* const unsetLoader =  */setButtonLoader(applyBtn);\r\n      const username = publicRow.radioField.checked ? linkInputField.getValue() : '';\r\n      this.managers.appChatsManager.migrateChat(this.chatId).then((channelId) => {\r\n        return this.managers.appChatsManager.updateUsername(channelId, username);\r\n      }).then(() => {\r\n        // unsetLoader();\r\n        this.close();\r\n      });\r\n    }, {listenerSetter: this.listenerSetter});\r\n\r\n    (originalValue !== placeholder ? publicRow : privateRow).radioField.checked = true;\r\n    linkInputField.setOriginalValue(originalValue);\r\n\r\n    this.scrollable.append(section.container, privateSection.container, publicSection.container);\r\n\r\n    {\r\n      const section = new SettingSection({\r\n        name: 'SavingContentTitle',\r\n        caption: isBroadcast ? 'RestrictSavingContentInfoChannel' : 'RestrictSavingContentInfoGroup'\r\n      });\r\n\r\n      const checkboxField = new CheckboxField({\r\n        text: 'RestrictSavingContent',\r\n        withRipple: true\r\n      });\r\n\r\n      this.listenerSetter.add(checkboxField.input)('change', () => {\r\n        const toggle = checkboxField.toggleDisability(true);\r\n        this.managers.appChatsManager.toggleNoForwards(this.chatId, checkboxField.checked).then(() => {\r\n          toggle();\r\n        });\r\n      });\r\n\r\n      const onChatUpdate = () => {\r\n        checkboxField.setValueSilently(!!(chat as Chat.channel).pFlags.noforwards);\r\n      };\r\n\r\n      this.listenerSetter.add(rootScope)('chat_update', (chatId) => {\r\n        if(this.chatId === chatId) {\r\n          onChatUpdate();\r\n        }\r\n      });\r\n\r\n      onChatUpdate();\r\n\r\n      section.content.append(checkboxField.label);\r\n\r\n      this.scrollable.append(section.container);\r\n    }\r\n  }\r\n}\r\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport {attachClickEvent} from '../../../helpers/dom/clickEvent';\nimport toggleDisability from '../../../helpers/dom/toggleDisability';\nimport deepEqual from '../../../helpers/object/deepEqual';\nimport {ChannelParticipant} from '../../../layer';\nimport appDialogsManager from '../../../lib/appManagers/appDialogsManager';\nimport Button from '../../button';\nimport {SettingSection} from '../../sidebarLeft';\nimport {SliderSuperTabEventable} from '../../sliderTab';\nimport getUserStatusString from '../../wrappers/getUserStatusString';\nimport {ChatPermissions} from './groupPermissions';\n\nexport default class AppUserPermissionsTab extends SliderSuperTabEventable {\n  public participant: ChannelParticipant;\n  public chatId: ChatId;\n  public userId: UserId;\n\n  protected async init() {\n    this.container.classList.add('edit-peer-container', 'user-permissions-container');\n    this.setTitle('UserRestrictions');\n\n    let destroyListener: () => void;\n\n    {\n      const section = new SettingSection({\n        name: 'UserRestrictionsCanDo'\n      });\n\n      const div = document.createElement('div');\n      div.classList.add('chatlist-container');\n      section.content.insertBefore(div, section.title);\n\n      const list = appDialogsManager.createChatList({new: true});\n      div.append(list);\n\n      const {dom} = appDialogsManager.addDialogNew({\n        peerId: this.userId.toPeerId(false),\n        container: list,\n        rippleEnabled: true,\n        avatarSize: 48\n      });\n\n      dom.lastMessageSpan.append(getUserStatusString(await this.managers.appUsersManager.getUser(this.userId)));\n\n      const p = new ChatPermissions({\n        chatId: this.chatId,\n        listenerSetter: this.listenerSetter,\n        appendTo: section.content,\n        participant: this.participant._ === 'channelParticipantBanned' ? this.participant : undefined\n      }, this.managers);\n\n      destroyListener = () => {\n        // appChatsManager.editChatDefaultBannedRights(this.chatId, p.takeOut());\n        const rights = p.takeOut();\n        if(this.participant._ === 'channelParticipantBanned' && deepEqual(this.participant.banned_rights.pFlags, rights.pFlags)) {\n          return;\n        }\n\n        this.managers.appChatsManager.editBanned(this.chatId, this.participant, rights);\n      };\n\n      this.eventListener.addEventListener('destroy', destroyListener, {once: true});\n\n      this.scrollable.append(section.container);\n    }\n\n    {\n      const section = new SettingSection({});\n\n      if(this.participant._ === 'channelParticipantBanned') {\n        const btnDeleteException = Button('btn-primary btn-transparent danger', {icon: 'delete', text: 'GroupPermission.Delete'});\n\n        attachClickEvent(btnDeleteException, () => {\n          const toggle = toggleDisability([btnDeleteException], true);\n          this.managers.appChatsManager.clearChannelParticipantBannedRights(this.chatId, this.participant).then(() => {\n            this.eventListener.removeEventListener('destroy', destroyListener);\n            this.close();\n          }, () => {\n            toggle();\n          });\n        }, {listenerSetter: this.listenerSetter});\n\n        section.content.append(btnDeleteException);\n      }\n\n      const btnDelete = Button('btn-primary btn-transparent danger', {icon: 'deleteuser', text: 'UserRestrictionsBlock'});\n\n      attachClickEvent(btnDelete, () => {\n        const toggle = toggleDisability([btnDelete], true);\n        this.managers.appChatsManager.kickFromChannel(this.chatId, this.participant).then(() => {\n          this.eventListener.removeEventListener('destroy', destroyListener);\n          this.close();\n        });\n        /* new PopupPeer('popup-group-kick-user', {\n          peerId: -this.chatId,\n          title: 'Ban User?',\n          description: `Are you sure you want to ban <b>${appPeersManager.getPeerTitle(this.userId)}</b>`,\n          buttons: addCancelButton([{\n            text: 'BAN',\n            callback: () => {\n              const toggle = toggleDisability([btnDelete], true);\n\n              appChatsManager.kickFromChannel(this.chatId, this.participant).then(() => {\n                this.eventListener.removeEventListener('destroy', destroyListener);\n                this.close();\n              }, () => {\n                toggle();\n              });\n            },\n            isDanger: true\n          }])\n        }).show(); */\n      }, {listenerSetter: this.listenerSetter});\n\n      section.content.append(btnDelete);\n\n      this.scrollable.append(section.container);\n    }\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport {attachClickEvent} from '../../../helpers/dom/clickEvent';\nimport findUpTag from '../../../helpers/dom/findUpTag';\nimport replaceContent from '../../../helpers/dom/replaceContent';\nimport ListenerSetter from '../../../helpers/listenerSetter';\nimport ScrollableLoader from '../../../helpers/scrollableLoader';\nimport {ChannelParticipant, Chat, ChatBannedRights, Update} from '../../../layer';\nimport {ChatRights} from '../../../lib/appManagers/appChatsManager';\nimport appDialogsManager, {DIALOG_LIST_ELEMENT_TAG} from '../../../lib/appManagers/appDialogsManager';\nimport {AppManagers} from '../../../lib/appManagers/managers';\nimport combineParticipantBannedRights from '../../../lib/appManagers/utils/chats/combineParticipantBannedRights';\nimport hasRights from '../../../lib/appManagers/utils/chats/hasRights';\nimport getPeerId from '../../../lib/appManagers/utils/peers/getPeerId';\nimport I18n, {i18n, join, LangPackKey} from '../../../lib/langPack';\nimport rootScope from '../../../lib/rootScope';\nimport CheckboxField from '../../checkboxField';\nimport PopupPickUser from '../../popups/pickUser';\nimport Row from '../../row';\nimport {SettingSection} from '../../sidebarLeft';\nimport {SliderSuperTabEventable} from '../../sliderTab';\nimport {toast} from '../../toast';\nimport AppUserPermissionsTab from './userPermissions';\n\nexport class ChatPermissions {\n  public v: Array<{\n    flags: ChatRights[],\n    text: LangPackKey,\n    exceptionText: LangPackKey,\n    checkboxField?: CheckboxField,\n  }>;\n  private toggleWith: Partial<{[chatRight in ChatRights]: ChatRights[]}>;\n\n  constructor(private options: {\n    chatId: ChatId,\n    listenerSetter: ListenerSetter,\n    appendTo: HTMLElement,\n    participant?: ChannelParticipant.channelParticipantBanned\n  }, private managers: AppManagers) {\n    this.construct();\n  }\n\n  public async construct() {\n    this.v = [\n      {flags: ['send_messages'], text: 'UserRestrictionsSend', exceptionText: 'UserRestrictionsNoSend'},\n      {flags: ['send_media'], text: 'UserRestrictionsSendMedia', exceptionText: 'UserRestrictionsNoSendMedia'},\n      {flags: ['send_stickers', 'send_gifs'], text: 'UserRestrictionsSendStickers', exceptionText: 'UserRestrictionsNoSendStickers'},\n      {flags: ['send_polls'], text: 'UserRestrictionsSendPolls', exceptionText: 'UserRestrictionsNoSendPolls'},\n      {flags: ['embed_links'], text: 'UserRestrictionsEmbedLinks', exceptionText: 'UserRestrictionsNoEmbedLinks'},\n      {flags: ['invite_users'], text: 'UserRestrictionsInviteUsers', exceptionText: 'UserRestrictionsNoInviteUsers'},\n      {flags: ['pin_messages'], text: 'UserRestrictionsPinMessages', exceptionText: 'UserRestrictionsNoPinMessages'},\n      {flags: ['change_info'], text: 'UserRestrictionsChangeInfo', exceptionText: 'UserRestrictionsNoChangeInfo'}\n    ];\n\n    this.toggleWith = {\n      'send_messages': ['send_media', 'send_stickers', 'send_polls', 'embed_links']\n    };\n\n    const options = this.options;\n    const chat: Chat.chat | Chat.channel = await this.managers.appChatsManager.getChat(options.chatId);\n    const defaultBannedRights = chat.default_banned_rights;\n    const rights = options.participant ? combineParticipantBannedRights(chat as Chat.channel, options.participant.banned_rights) : defaultBannedRights;\n\n    const restrictionText: LangPackKey = options.participant ? 'UserRestrictionsDisabled' : 'EditCantEditPermissionsPublic';\n    for(const info of this.v) {\n      const mainFlag = info.flags[0];\n      info.checkboxField = new CheckboxField({\n        text: info.text,\n        checked: hasRights(chat, mainFlag, rights),\n        restriction: true,\n        withRipple: true\n      });\n\n      if((\n        options.participant &&\n          defaultBannedRights.pFlags[mainFlag as keyof typeof defaultBannedRights['pFlags']]\n      ) || (\n        (chat as Chat.channel).username &&\n          (\n            info.flags.includes('pin_messages') ||\n            info.flags.includes('change_info')\n          )\n      )\n      ) {\n        info.checkboxField.input.disabled = true;\n\n        /* options.listenerSetter.add(info.checkboxField.input)('change', (e) => {\n          if(!e.isTrusted) {\n            return;\n          }\n\n          cancelEvent(e);\n          toast('This option is disabled for all members in Group Permissions.');\n          info.checkboxField.checked = false;\n        }); */\n\n        attachClickEvent(info.checkboxField.label, (e) => {\n          toast(I18n.format(restrictionText, true));\n        }, {listenerSetter: options.listenerSetter});\n      }\n\n      if(this.toggleWith[mainFlag]) {\n        options.listenerSetter.add(info.checkboxField.input)('change', () => {\n          if(!info.checkboxField.checked) {\n            const other = this.v.filter((i) => this.toggleWith[mainFlag].includes(i.flags[0]));\n            other.forEach((info) => {\n              info.checkboxField.checked = false;\n            });\n          }\n        });\n      }\n\n      options.appendTo.append(info.checkboxField.label);\n    }\n  }\n\n  public takeOut() {\n    const rights: ChatBannedRights = {\n      _: 'chatBannedRights',\n      until_date: 0x7FFFFFFF,\n      pFlags: {}\n    };\n\n    for(const info of this.v) {\n      const banned = !info.checkboxField.checked;\n      if(banned) {\n        info.flags.forEach((flag) => {\n          // @ts-ignore\n          rights.pFlags[flag] = true;\n        });\n      }\n    }\n\n    return rights;\n  }\n}\n\nexport default class AppGroupPermissionsTab extends SliderSuperTabEventable {\n  public chatId: ChatId;\n\n  protected async init() {\n    this.container.classList.add('edit-peer-container', 'group-permissions-container');\n    this.setTitle('ChannelPermissions');\n\n    let chatPermissions: ChatPermissions;\n    {\n      const section = new SettingSection({\n        name: 'ChannelPermissionsHeader'\n      });\n\n      chatPermissions = new ChatPermissions({\n        chatId: this.chatId,\n        listenerSetter: this.listenerSetter,\n        appendTo: section.content\n      }, this.managers);\n\n      this.eventListener.addEventListener('destroy', () => {\n        this.managers.appChatsManager.editChatDefaultBannedRights(this.chatId, chatPermissions.takeOut());\n      }, {once: true});\n\n      this.scrollable.append(section.container);\n    }\n\n    {\n      const section = new SettingSection({\n        name: 'PrivacyExceptions'\n      });\n\n      const addExceptionRow = new Row({\n        titleLangKey: 'ChannelAddException',\n        subtitleLangKey: 'Loading',\n        icon: 'adduser',\n        clickable: () => {\n          new PopupPickUser({\n            peerTypes: ['channelParticipants'],\n            onSelect: (peerId) => {\n              setTimeout(() => {\n                openPermissions(peerId);\n              }, 0);\n            },\n            placeholder: 'ExceptionModal.Search.Placeholder',\n            peerId: -this.chatId\n          });\n        },\n        listenerSetter: this.listenerSetter\n      });\n\n      const openPermissions = async(peerId: PeerId) => {\n        let participant: AppUserPermissionsTab['participant'];\n        try {\n          participant = await this.managers.appProfileManager.getChannelParticipant(this.chatId, peerId) as any;\n        } catch(err) {\n          toast('User is no longer participant');\n          return;\n        }\n\n        const tab = this.slider.createTab(AppUserPermissionsTab);\n        tab.participant = participant;\n        tab.chatId = this.chatId;\n        tab.userId = peerId;\n        tab.open();\n      };\n\n      section.content.append(addExceptionRow.container);\n\n      /* const removedUsersRow = new Row({\n        titleLangKey: 'ChannelBlockedUsers',\n        subtitleLangKey: 'NoBlockedUsers',\n        icon: 'deleteuser',\n        clickable: true\n      });\n\n      section.content.append(removedUsersRow.container); */\n\n      const c = section.generateContentElement();\n      c.classList.add('chatlist-container');\n\n      const list = appDialogsManager.createChatList({new: true});\n      c.append(list);\n\n      attachClickEvent(list, (e) => {\n        const target = findUpTag(e.target, DIALOG_LIST_ELEMENT_TAG);\n        if(!target) return;\n\n        const peerId = target.dataset.peerId.toPeerId();\n        openPermissions(peerId);\n      }, {listenerSetter: this.listenerSetter});\n\n      const setSubtitle = async(li: Element, participant: ChannelParticipant.channelParticipantBanned) => {\n        const bannedRights = participant.banned_rights;// appChatsManager.combineParticipantBannedRights(this.chatId, participant.banned_rights);\n        const defaultBannedRights = ((await this.managers.appChatsManager.getChat(this.chatId)) as Chat.channel).default_banned_rights;\n        // const combinedRights = appChatsManager.combineParticipantBannedRights(this.chatId, bannedRights);\n\n        const cantWhat: LangPackKey[] = []/* , canWhat: LangPackKey[] = [] */;\n        chatPermissions.v.forEach((info) => {\n          const mainFlag = info.flags[0];\n          // @ts-ignore\n          if(bannedRights.pFlags[mainFlag] && !defaultBannedRights.pFlags[mainFlag]) {\n            cantWhat.push(info.exceptionText);\n          // @ts-ignore\n          }/*  else if(!combinedRights.pFlags[mainFlag]) {\n            canWhat.push(info.exceptionText);\n          } */\n        });\n\n        const el = li.querySelector('.user-last-message') as HTMLElement;\n\n        if(cantWhat.length) {\n          el.innerHTML = '';\n          el.append(...join(cantWhat.map((t) => i18n(t)), false));\n        }/*  else if(canWhat.length) {\n          str = 'Can ' + canWhat.join(canWhat.length === 2 ? ' and ' : ', ');\n        } */\n\n        el.classList.toggle('hide', !cantWhat.length);\n      };\n\n      const add = (participant: ChannelParticipant.channelParticipantBanned, append: boolean) => {\n        const {dom} = appDialogsManager.addDialogNew({\n          peerId: getPeerId(participant.peer),\n          container: list,\n          rippleEnabled: true,\n          avatarSize: 48,\n          append\n        });\n\n        setSubtitle(dom.listEl, participant);\n\n        // dom.titleSpan.innerHTML = 'Chinaza Akachi';\n        // dom.lastMessageSpan.innerHTML = 'Can Add Users and Pin Messages';\n      };\n\n      // this.listenerSetter.add(rootScope)('updateChannelParticipant', (update: Update.updateChannelParticipant) => {\n      //   const needAdd = update.new_participant?._ === 'channelParticipantBanned' && !update.new_participant.banned_rights.pFlags.view_messages;\n      //   const li = list.querySelector(`[data-peer-id=\"${update.user_id}\"]`);\n      //   if(needAdd) {\n      //     if(!li) {\n      //       add(update.new_participant as ChannelParticipant.channelParticipantBanned, false);\n      //     } else {\n      //       setSubtitle(li, update.new_participant as ChannelParticipant.channelParticipantBanned);\n      //     }\n\n      //     if(update.prev_participant?._ !== 'channelParticipantBanned') {\n      //       ++exceptionsCount;\n      //     }\n      //   } else {\n      //     if(li) {\n      //       li.remove();\n      //     }\n\n      //     if(update.prev_participant?._ === 'channelParticipantBanned') {\n      //       --exceptionsCount;\n      //     }\n      //   }\n\n      //   setLength();\n      // });\n\n      const setLength = () => {\n        replaceContent(addExceptionRow.subtitle, i18n(exceptionsCount ? 'Permissions.ExceptionsCount' : 'Permissions.NoExceptions', [exceptionsCount]));\n      };\n\n      let exceptionsCount = 0;\n      let loader: ScrollableLoader;\n      const setLoader = () => {\n        const LOAD_COUNT = 50;\n        loader = new ScrollableLoader({\n          scrollable: this.scrollable,\n          getPromise: () => {\n            return this.managers.appProfileManager.getChannelParticipants(this.chatId, {_: 'channelParticipantsBanned', q: ''}, LOAD_COUNT, list.childElementCount).then((res) => {\n              for(const participant of res.participants) {\n                add(participant as ChannelParticipant.channelParticipantBanned, true);\n              }\n\n              exceptionsCount = res.count;\n              setLength();\n\n              return res.participants.length < LOAD_COUNT || res.count === list.childElementCount;\n            });\n          }\n        });\n\n        return loader.load();\n      };\n\n      this.scrollable.append(section.container);\n\n      if(await this.managers.appChatsManager.isChannel(this.chatId)) {\n        await setLoader();\n      } else {\n        setLength();\n\n        this.listenerSetter.add(rootScope)('dialog_migrate', ({migrateFrom, migrateTo}) => {\n          if(this.chatId === migrateFrom) {\n            this.chatId = migrateTo;\n            setLoader();\n          }\n        });\n      }\n    }\n  }\n\n  onOpenAfterTimeout() {\n    this.scrollable.onScroll();\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport copy from '../../../../helpers/object/copy';\nimport {ChatBannedRights, Chat} from '../../../../layer';\n\nexport default function combineParticipantBannedRights(chat: Chat.channel, rights: ChatBannedRights) {\n  if(chat.default_banned_rights) {\n    rights = copy(rights);\n    const defaultRights = chat.default_banned_rights.pFlags;\n    for(const i in defaultRights) {\n      // @ts-ignore\n      rights.pFlags[i] = defaultRights[i];\n    }\n  }\n\n  return rights;\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport debounce from '../../../helpers/schedulers/debounce';\nimport CheckboxField from '../../checkboxField';\nimport Row from '../../row';\nimport {SettingSection} from '../../sidebarLeft';\nimport {SliderSuperTabEventable} from '../../sliderTab';\nimport {wrapStickerToRow} from '../../wrappers';\n\nexport default class AppChatReactionsTab extends SliderSuperTabEventable {\n  public chatId: ChatId;\n\n  protected async init() {\n    this.setTitle('Reactions');\n\n    const availableReactions = await this.managers.appReactionsManager.getActiveAvailableReactions();\n    const chatFull = await this.managers.appProfileManager.getChatFull(this.chatId);\n    let originalReactions = chatFull.available_reactions ?? [];\n    const enabledReactions = new Set(originalReactions);\n\n    const toggleSection = new SettingSection({\n      caption: await this.managers.appChatsManager.isBroadcast(this.chatId) ? 'EnableReactionsChannelInfo' : 'EnableReactionsGroupInfo'\n    });\n\n    const toggleCheckboxField = new CheckboxField({toggle: true, checked: !!enabledReactions.size});\n    const toggleRow = new Row({\n      checkboxField: toggleCheckboxField,\n      titleLangKey: 'EnableReactions',\n      listenerSetter: this.listenerSetter\n    });\n\n    toggleSection.content.append(toggleRow.container);\n\n    const reactionsSection = new SettingSection({\n      name: 'AvailableReactions'\n    });\n\n    const checkboxFields = availableReactions.map((availableReaction) => {\n      const checkboxField = new CheckboxField({\n        toggle: true,\n        checked: enabledReactions.has(availableReaction.reaction)\n      });\n\n      this.listenerSetter.add(checkboxField.input)('change', () => {\n        if(checkboxField.checked) {\n          enabledReactions.add(availableReaction.reaction);\n\n          if(!toggleCheckboxField.checked) {\n            toggleCheckboxField.setValueSilently(true);\n          }\n        } else {\n          enabledReactions.delete(availableReaction.reaction);\n\n          if(!enabledReactions.size && toggleCheckboxField.checked) {\n            toggleCheckboxField.setValueSilently(false);\n          }\n        }\n\n        saveReactionsDebounced();\n      });\n\n      const row = new Row({\n        checkboxField,\n        title: availableReaction.title,\n        havePadding: true,\n        listenerSetter: this.listenerSetter\n      });\n\n      wrapStickerToRow({\n        row,\n        doc: availableReaction.static_icon,\n        size: 'small'\n      });\n\n      reactionsSection.content.append(row.container);\n\n      return checkboxField;\n    });\n\n    this.listenerSetter.add(toggleRow.checkboxField.input)('change', () => {\n      if(!toggleCheckboxField.checked) {\n        checkboxFields.forEach((checkboxField) => checkboxField.checked = false);\n        saveReactionsDebounced();\n      } else if(checkboxFields.every((checkboxField) => !checkboxField.checked)) {\n        checkboxFields.forEach((checkboxField) => checkboxField.checked = true);\n        saveReactionsDebounced();\n      }\n    });\n\n    const saveReactions = async() => {\n      const newReactions = Array.from(enabledReactions);\n      if([...newReactions].sort().join() === [...originalReactions].sort().join()) {\n        return;\n      }\n\n      const chatFull = await this.managers.appProfileManager.getCachedFullChat(this.chatId);\n      if(chatFull) {\n        chatFull.available_reactions = newReactions;\n      }\n\n      this.managers.appChatsManager.setChatAvailableReactions(this.chatId, newReactions);\n      originalReactions = newReactions;\n    };\n\n    const saveReactionsDebounced = debounce(saveReactions, 3000, false, true);\n\n    this.eventListener.addEventListener('destroy', saveReactions, {once: true});\n\n    this.scrollable.append(toggleSection.container, reactionsSection.container);\n  }\n}\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport {SliderSuperTab} from '../../slider'\r\nimport InputField from '../../inputField';\r\nimport EditPeer from '../../editPeer';\r\nimport {SettingSection} from '../../sidebarLeft';\r\nimport Row from '../../row';\r\nimport Button from '../../button';\r\nimport {ChatRights} from '../../../lib/appManagers/appChatsManager';\r\nimport {Chat, ChatFull} from '../../../layer';\r\nimport AppChatTypeTab from './chatType';\r\nimport rootScope from '../../../lib/rootScope';\r\nimport AppGroupPermissionsTab from './groupPermissions';\r\nimport {i18n, LangPackKey} from '../../../lib/langPack';\r\nimport PopupDeleteDialog from '../../popups/deleteDialog';\r\nimport {attachClickEvent} from '../../../helpers/dom/clickEvent';\r\nimport toggleDisability from '../../../helpers/dom/toggleDisability';\r\nimport CheckboxField from '../../checkboxField';\r\nimport AppChatReactionsTab from './chatReactions';\r\nimport hasRights from '../../../lib/appManagers/utils/chats/hasRights';\r\n\r\nexport default class AppEditChatTab extends SliderSuperTab {\r\n  private chatNameInputField: InputField;\r\n  private descriptionInputField: InputField;\r\n  private editPeer: EditPeer;\r\n  private tempId: number;\r\n  public chatId: ChatId;\r\n\r\n  protected async _init() {\r\n    // * cleanup prev\r\n    this.listenerSetter.removeAll();\r\n    this.scrollable.container.innerHTML = '';\r\n    this.tempId ??= 0;\r\n    const tempId = ++this.tempId;\r\n\r\n    this.container.classList.add('edit-peer-container', 'edit-group-container');\r\n    this.setTitle('Edit');\r\n\r\n    let chatFull = await this.managers.appProfileManager.getChatFull(this.chatId, true);\r\n\r\n    const chat: Chat.chat | Chat.channel = await this.managers.appChatsManager.getChat(this.chatId);\r\n    const isBroadcast = await this.managers.appChatsManager.isBroadcast(this.chatId);\r\n    const isChannel = await this.managers.appChatsManager.isChannel(this.chatId);\r\n\r\n    const chatUpdateListeners: (() => void)[] = [];\r\n    const addChatUpdateListener = (callback: () => void) => {\r\n      chatUpdateListeners.push(callback);\r\n    };\r\n\r\n    this.listenerSetter.add(rootScope)('chat_update', (chatId) => {\r\n      if(this.chatId === chatId) {\r\n        chatUpdateListeners.forEach((callback) => callback());\r\n      }\r\n    });\r\n\r\n    this.listenerSetter.add(rootScope)('chat_full_update', async(chatId) => {\r\n      if(this.chatId === chatId) {\r\n        chatFull = await this.managers.appProfileManager.getCachedFullChat(chatId) || chatFull;\r\n      }\r\n    });\r\n\r\n    const peerId = this.chatId.toPeerId(true);\r\n    const canChangeType = await this.managers.appChatsManager.hasRights(this.chatId, 'change_type');\r\n    const canChangePermissions = await this.managers.appChatsManager.hasRights(this.chatId, 'change_permissions');\r\n\r\n    {\r\n      const section = new SettingSection({noDelimiter: true});\r\n      const inputFields: InputField[] = [];\r\n\r\n      const inputWrapper = document.createElement('div');\r\n      inputWrapper.classList.add('input-wrapper');\r\n\r\n      this.chatNameInputField = new InputField({\r\n        label: isBroadcast ? 'EnterChannelName' : 'CreateGroup.NameHolder',\r\n        name: 'chat-name',\r\n        maxLength: 255,\r\n        required: true\r\n      });\r\n      this.descriptionInputField = new InputField({\r\n        label: 'DescriptionPlaceholder',\r\n        name: 'chat-description',\r\n        maxLength: 255\r\n      });\r\n\r\n      this.chatNameInputField.setOriginalValue(chat.title);\r\n      this.descriptionInputField.setOriginalValue(chatFull.about);\r\n\r\n      inputWrapper.append(this.chatNameInputField.container, this.descriptionInputField.container);\r\n\r\n      inputFields.push(this.chatNameInputField, this.descriptionInputField);\r\n\r\n      this.editPeer = new EditPeer({\r\n        peerId,\r\n        inputFields,\r\n        listenerSetter: this.listenerSetter\r\n      });\r\n      this.content.append(this.editPeer.nextBtn);\r\n\r\n      section.content.append(this.editPeer.avatarEdit.container, inputWrapper);\r\n\r\n      if(canChangeType) {\r\n        const chatTypeRow = new Row({\r\n          titleLangKey: isBroadcast ? 'ChannelType' : 'GroupType',\r\n          clickable: () => {\r\n            const tab = this.slider.createTab(AppChatTypeTab);\r\n            tab.chatId = this.chatId;\r\n            tab.chatFull = chatFull;\r\n            tab.open();\r\n\r\n            this.listenerSetter.add(tab.eventListener)('destroy', setChatTypeSubtitle);\r\n          },\r\n          icon: 'lock',\r\n          listenerSetter: this.listenerSetter\r\n        });\r\n\r\n        const setChatTypeSubtitle = () => {\r\n          chatTypeRow.subtitle.textContent = '';\r\n\r\n          let key: LangPackKey;\r\n          if(isBroadcast) {\r\n            key = (chat as Chat.channel).username ? 'TypePublic' : 'TypePrivate';\r\n          } else {\r\n            key = (chat as Chat.channel).username ? 'TypePublicGroup' : 'TypePrivateGroup';\r\n          }\r\n\r\n          chatTypeRow.subtitle.append(i18n(key));\r\n        };\r\n\r\n        setChatTypeSubtitle();\r\n        section.content.append(chatTypeRow.container);\r\n      }\r\n\r\n      if(canChangeType || canChangePermissions) {\r\n        const reactionsRow = new Row({\r\n          titleLangKey: 'Reactions',\r\n          icon: 'reactions',\r\n          clickable: () => {\r\n            const tab = this.slider.createTab(AppChatReactionsTab);\r\n            tab.chatId = this.chatId;\r\n            tab.open().then(() => {\r\n              if(this.tempId !== tempId) {\r\n                return;\r\n              }\r\n\r\n              this.listenerSetter.add(tab.eventListener)('destroy', setReactionsLength);\r\n            });\r\n          },\r\n          listenerSetter: this.listenerSetter\r\n        });\r\n\r\n        const availableReactions = await this.managers.appReactionsManager.getAvailableReactions();\r\n        const availableReactionsLength = availableReactions.filter((availableReaction) => !availableReaction.pFlags.inactive).length;\r\n        const setReactionsLength = () => {\r\n          const reactions = chatFull.available_reactions ?? [];\r\n          reactionsRow.subtitle.innerHTML = reactions.length + '/' + availableReactionsLength;\r\n        };\r\n\r\n        setReactionsLength();\r\n\r\n        section.content.append(reactionsRow.container);\r\n      }\r\n\r\n      if(canChangePermissions && !isBroadcast) {\r\n        const flags = [\r\n          'send_messages',\r\n          'send_media',\r\n          'send_stickers',\r\n          'send_polls',\r\n          'embed_links',\r\n          'invite_users',\r\n          'pin_messages',\r\n          'change_info'\r\n        ] as ChatRights[];\r\n\r\n        const permissionsRow = new Row({\r\n          titleLangKey: 'ChannelPermissions',\r\n          clickable: () => {\r\n            const tab = this.slider.createTab(AppGroupPermissionsTab);\r\n            tab.chatId = this.chatId;\r\n            tab.open();\r\n          },\r\n          icon: 'permissions',\r\n          listenerSetter: this.listenerSetter\r\n        });\r\n\r\n        const setPermissionsLength = async() => {\r\n          const chat = await this.managers.appChatsManager.getChatTyped(this.chatId);\r\n          permissionsRow.subtitle.innerHTML = flags.reduce((acc, f) => acc + +hasRights(chat, f, (chat as Chat.chat).default_banned_rights), 0) + '/' + flags.length;\r\n        };\r\n\r\n        setPermissionsLength();\r\n        section.content.append(permissionsRow.container);\r\n\r\n        this.listenerSetter.add(rootScope)('chat_update', (chatId) => {\r\n          if(this.chatId === chatId) {\r\n            setPermissionsLength();\r\n          }\r\n        });\r\n      }\r\n\r\n      /* const administratorsRow = new Row({\r\n        titleLangKey: 'PeerInfo.Administrators',\r\n        subtitle: '' + ((chatFull as ChatFull.channelFull).admins_count || 1),\r\n        icon: 'admin',\r\n        clickable: true\r\n      });\r\n\r\n      section.content.append(administratorsRow.container); */\r\n\r\n      this.scrollable.append(section.container);\r\n\r\n      attachClickEvent(this.editPeer.nextBtn, () => {\r\n        this.editPeer.nextBtn.disabled = true;\r\n\r\n        const promises: Promise<any>[] = [];\r\n\r\n        const id = this.chatId;\r\n        if(this.chatNameInputField.isValidToChange()) {\r\n          promises.push(this.managers.appChatsManager.editTitle(id, this.chatNameInputField.value));\r\n        }\r\n\r\n        if(this.descriptionInputField.isValidToChange()) {\r\n          promises.push(this.managers.appChatsManager.editAbout(id, this.descriptionInputField.value));\r\n        }\r\n\r\n        if(this.editPeer.uploadAvatar) {\r\n          promises.push(this.editPeer.uploadAvatar().then((inputFile) => {\r\n            return this.managers.appChatsManager.editPhoto(id, inputFile);\r\n          }));\r\n        }\r\n\r\n        Promise.race(promises).finally(() => {\r\n          this.editPeer.nextBtn.removeAttribute('disabled');\r\n          this.close();\r\n        });\r\n      }, {listenerSetter: this.listenerSetter});\r\n\r\n\r\n      /* if(appChatsManager.hasRights(-this.peerId, 'change_info')) {\r\n        const discussionRow = new Row({\r\n          titleLangKey: 'PeerInfo.Discussion',\r\n          subtitleLangKey: 'PeerInfo.Discussion.Add',\r\n          clickable: true,\r\n          icon: 'message'\r\n        });\r\n\r\n        section.content.append(discussionRow.container);\r\n      }\r\n\r\n      const administratorsRow = new Row({\r\n        titleLangKey: 'PeerInfo.Administrators',\r\n        subtitle: '' + chatFull.admins_count,\r\n        icon: 'admin',\r\n        clickable: true\r\n      });\r\n\r\n      section.content.append(administratorsRow.container); */\r\n\r\n      if(isBroadcast && await this.managers.appChatsManager.hasRights(this.chatId, 'change_info')) {\r\n        const signMessagesCheckboxField = new CheckboxField({\r\n          text: 'PeerInfo.SignMessages',\r\n          checked: !!(chat as Chat.channel).pFlags.signatures,\r\n          withRipple: true\r\n        });\r\n\r\n        this.listenerSetter.add(signMessagesCheckboxField.input)('change', () => {\r\n          const toggle = signMessagesCheckboxField.toggleDisability(true);\r\n          this.managers.appChatsManager.toggleSignatures(this.chatId, signMessagesCheckboxField.checked).then(() => {\r\n            toggle();\r\n          });\r\n        });\r\n\r\n        addChatUpdateListener(() => {\r\n          signMessagesCheckboxField.setValueSilently(!!(chat as Chat.channel).pFlags.signatures);\r\n        });\r\n\r\n        section.content.append(signMessagesCheckboxField.label);\r\n      }\r\n    }\r\n\r\n    if(!isBroadcast) {\r\n      const section = new SettingSection({\r\n\r\n      });\r\n\r\n      /* const membersRow = new Row({\r\n        titleLangKey: isBroadcast ? 'PeerInfo.Subscribers' : 'GroupMembers',\r\n        icon: 'newgroup',\r\n        clickable: true\r\n      });\r\n\r\n      membersRow.subtitle.append(i18n('Subscribers', [numberThousandSplitter(335356)]));\r\n\r\n      section.content.append(membersRow.container); */\r\n\r\n      if(!isBroadcast && canChangeType) {\r\n        const showChatHistoryCheckboxField = new CheckboxField({\r\n          text: 'ChatHistory',\r\n          withRipple: true\r\n        });\r\n\r\n        this.listenerSetter.add(showChatHistoryCheckboxField.input)('change', () => {\r\n          const toggle = showChatHistoryCheckboxField.toggleDisability(true);\r\n          this.managers.appChatsManager.togglePreHistoryHidden(this.chatId, !showChatHistoryCheckboxField.checked).then(() => {\r\n            toggle();\r\n          });\r\n        });\r\n\r\n        // ! it won't be updated because chatFull will be old\r\n        const onChatUpdate = () => {\r\n          showChatHistoryCheckboxField.setValueSilently(isChannel && !(chatFull as ChatFull.channelFull).pFlags.hidden_prehistory);\r\n        };\r\n\r\n        onChatUpdate();\r\n        addChatUpdateListener(onChatUpdate);\r\n\r\n        section.content.append(showChatHistoryCheckboxField.label);\r\n      }\r\n\r\n      if(section.content.childElementCount) {\r\n        this.scrollable.append(section.container);\r\n      }\r\n    }\r\n\r\n    if(await this.managers.appChatsManager.hasRights(this.chatId, 'delete_chat')) {\r\n      const section = new SettingSection({});\r\n\r\n      const btnDelete = Button('btn-primary btn-transparent danger', {icon: 'delete', text: isBroadcast ? 'PeerInfo.DeleteChannel' : 'DeleteAndExitButton'});\r\n\r\n      attachClickEvent(btnDelete, () => {\r\n        new PopupDeleteDialog(peerId/* , 'delete' */, undefined, (promise) => {\r\n          const toggle = toggleDisability([btnDelete], true);\r\n          promise.then(() => {\r\n            this.close();\r\n          }, () => {\r\n            toggle();\r\n          });\r\n        });\r\n      }, {listenerSetter: this.listenerSetter});\r\n\r\n      section.content.append(btnDelete);\r\n\r\n      this.scrollable.append(section.container);\r\n    }\r\n\r\n    if(!isChannel) {\r\n      // ! this one will fire earlier than tab's closeAfterTimeout (destroy) event and listeners will be erased, so destroy won't fire\r\n      this.listenerSetter.add(rootScope)('dialog_migrate', ({migrateFrom, migrateTo}) => {\r\n        if(peerId === migrateFrom) {\r\n          this.chatId = migrateTo.toChatId();\r\n          this._init();\r\n        }\r\n      });\r\n    }\r\n  }\r\n\r\n  protected init() {\r\n    return this._init();\r\n  }\r\n}\r\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport rootScope from '../../../lib/rootScope';\nimport AppSearchSuper, {SearchSuperType} from '../../appSearchSuper.';\nimport SidebarSlider, {SliderSuperTab} from '../../slider';\nimport {TransitionSlider} from '../../transition';\nimport AppEditChatTab from './editChat';\nimport PeerTitle from '../../peerTitle';\nimport AppEditContactTab from './editContact';\nimport Button from '../../button';\nimport ButtonIcon from '../../buttonIcon';\nimport {i18n, LangPackKey} from '../../../lib/langPack';\nimport {toastNew} from '../../toast';\nimport AppAddMembersTab from '../../sidebarLeft/tabs/addMembers';\nimport PopupPickUser from '../../popups/pickUser';\nimport PopupPeer, {PopupPeerButtonCallbackCheckboxes, PopupPeerCheckboxOptions} from '../../popups/peer';\nimport ButtonCorner from '../../buttonCorner';\nimport {attachClickEvent} from '../../../helpers/dom/clickEvent';\nimport PeerProfile from '../../peerProfile';\nimport {Message} from '../../../layer';\n\nconst historiesStorage: {\n  [peerId: PeerId]: Partial<{\n    [type in SearchSuperType]: {mid: number, peerId: PeerId}[]\n  }>\n} = {};\n\n// TODO:    \nexport default class AppSharedMediaTab extends SliderSuperTab {\n  private editBtn: HTMLElement;\n\n  private peerId: PeerId;\n  private threadId = 0;\n\n  private searchSuper: AppSearchSuper;\n\n  private profile: PeerProfile;\n  private peerChanged: boolean;\n\n  constructor(slider: SidebarSlider) {\n    super(slider, false);\n  }\n\n  public init() {\n    // const perf = performance.now();\n\n    this.container.classList.add('shared-media-container', 'profile-container');\n\n    // * header\n    const newCloseBtn = Button('btn-icon sidebar-close-button', {noRipple: true});\n    this.closeBtn.replaceWith(newCloseBtn);\n    this.closeBtn = newCloseBtn;\n\n    const animatedCloseIcon = document.createElement('div');\n    animatedCloseIcon.classList.add('animated-close-icon');\n    newCloseBtn.append(animatedCloseIcon);\n\n    const transitionContainer = document.createElement('div');\n    transitionContainer.className = 'transition slide-fade';\n\n    const transitionFirstItem = document.createElement('div');\n    transitionFirstItem.classList.add('transition-item');\n\n    this.title.append(i18n('Profile'));\n    this.editBtn = ButtonIcon('edit');\n    // const moreBtn = ButtonIcon('more');\n\n    transitionFirstItem.append(this.title, this.editBtn/* , moreBtn */);\n\n    const transitionLastItem = document.createElement('div');\n    transitionLastItem.classList.add('transition-item');\n\n    const secondTitle: HTMLElement = this.title.cloneNode() as any;\n    secondTitle.append(i18n('PeerInfo.SharedMedia'));\n\n    transitionLastItem.append(secondTitle);\n\n    transitionContainer.append(transitionFirstItem, transitionLastItem);\n\n    this.header.append(transitionContainer);\n\n    // * body\n\n    this.profile = new PeerProfile(this.managers, this.scrollable, this.listenerSetter);\n    this.profile.init();\n\n    this.scrollable.append(this.profile.element);\n\n    const HEADER_HEIGHT = 56;\n    this.scrollable.onAdditionalScroll = () => {\n      const rect = this.searchSuper.nav.getBoundingClientRect();\n      if(!rect.width) return;\n\n      const top = rect.top - 1;\n      setIsSharedMedia(top <= HEADER_HEIGHT);\n    };\n\n    const setIsSharedMedia = (isSharedMedia: boolean) => {\n      animatedCloseIcon.classList.toggle('state-back', isSharedMedia);\n      this.searchSuper.container.classList.toggle('is-full-viewport', isSharedMedia);\n      transition(+isSharedMedia);\n\n      if(!isSharedMedia) {\n        this.searchSuper.cleanScrollPositions();\n      }\n    };\n\n    const transition = TransitionSlider(transitionContainer, 'slide-fade', 400, null, false);\n\n    transition(0);\n\n    attachClickEvent(this.closeBtn, (e) => {\n      if(this.closeBtn.firstElementChild.classList.contains('state-back')) {\n        this.scrollable.scrollIntoViewNew({\n          element: this.scrollable.container.firstElementChild as HTMLElement,\n          position: 'start'\n        });\n        transition(0);\n        animatedCloseIcon.classList.remove('state-back');\n      } else if(!this.scrollable.isHeavyAnimationInProgress) {\n        this.slider.onCloseBtnClick();\n      }\n    }, {listenerSetter: this.listenerSetter});\n\n    attachClickEvent(this.editBtn, (e) => {\n      let tab: AppEditChatTab | AppEditContactTab;\n      if(this.peerId.isAnyChat()) {\n        tab = this.slider.createTab(AppEditChatTab);\n      } else {\n        tab = this.slider.createTab(AppEditContactTab);\n      }\n\n      if(tab) {\n        if(tab instanceof AppEditChatTab) {\n          tab.chatId = this.peerId.toChatId();\n        } else {\n          tab.peerId = this.peerId;\n        }\n\n        tab.open();\n      }\n    }, {listenerSetter: this.listenerSetter});\n\n    this.listenerSetter.add(rootScope)('contacts_update', (userId) => {\n      if(this.peerId === userId) {\n        this.toggleEditBtn();\n      }\n    });\n\n    this.listenerSetter.add(rootScope)('chat_update', (chatId) => {\n      if(this.peerId === chatId.toPeerId(true)) {\n        this.toggleEditBtn();\n      }\n    });\n\n    this.listenerSetter.add(rootScope)('history_multiappend', (message) => {\n      this.renderNewMessages(message);\n    });\n\n    this.listenerSetter.add(rootScope)('history_delete', ({peerId, msgs}) => {\n      this.deleteDeletedMessages(peerId, Array.from(msgs));\n    });\n\n    // Calls when message successfully sent and we have an id\n    this.listenerSetter.add(rootScope)('message_sent', ({message}) => {\n      this.renderNewMessages(message);\n    });\n\n    // this.container.prepend(this.closeBtn.parentElement);\n\n    this.searchSuper = new AppSearchSuper({\n      mediaTabs: [{\n        inputFilter: 'inputMessagesFilterEmpty',\n        name: 'PeerMedia.Members',\n        type: 'members'\n      }, {\n        inputFilter: 'inputMessagesFilterPhotoVideo',\n        name: 'SharedMediaTab2',\n        type: 'media'\n      }, {\n        inputFilter: 'inputMessagesFilterDocument',\n        name: 'SharedFilesTab2',\n        type: 'files'\n      }, {\n        inputFilter: 'inputMessagesFilterUrl',\n        name: 'SharedLinksTab2',\n        type: 'links'\n      }, {\n        inputFilter: 'inputMessagesFilterMusic',\n        name: 'SharedMusicTab2',\n        type: 'music'\n      }, {\n        inputFilter: 'inputMessagesFilterRoundVoice',\n        name: 'SharedVoiceTab2',\n        type: 'voice'\n      }],\n      scrollable: this.scrollable,\n      onChangeTab: (mediaTab) => {\n        const timeout = mediaTab.type === 'members' && rootScope.settings.animationsEnabled ? 250 : 0;\n        setTimeout(() => {\n          btnAddMembers.classList.toggle('is-hidden', mediaTab.type !== 'members');\n        }, timeout);\n      },\n      managers: this.managers\n    });\n\n    this.searchSuper.scrollStartCallback = () => {\n      setIsSharedMedia(true);\n    };\n\n    this.profile.element.append(this.searchSuper.container);\n\n    const btnAddMembers = ButtonCorner({icon: 'addmember_filled'});\n    this.content.append(btnAddMembers);\n\n    attachClickEvent(btnAddMembers, async() => {\n      const peerId = this.peerId;\n      const id = this.peerId.toChatId();\n      const isChannel = await this.managers.appChatsManager.isChannel(id);\n\n      const showConfirmation = (peerIds: PeerId[], callback: (checked: PopupPeerButtonCallbackCheckboxes) => void) => {\n        let titleLangKey: LangPackKey, titleLangArgs: any[],\n          descriptionLangKey: LangPackKey, descriptionLangArgs: any[],\n          checkboxes: PopupPeerCheckboxOptions[];\n\n        if(peerIds.length > 1) {\n          titleLangKey = 'AddMembersAlertTitle';\n          titleLangArgs = [i18n('Members', [peerIds.length])];\n          descriptionLangKey = 'AddMembersAlertCountText';\n          descriptionLangArgs = peerIds.map((peerId) => {\n            const b = document.createElement('b');\n            b.append(new PeerTitle({peerId}).element);\n            return b;\n          });\n\n          if(!isChannel) {\n            checkboxes = [{\n              text: 'AddMembersForwardMessages',\n              checked: true\n            }];\n          }\n        } else {\n          titleLangKey = 'AddOneMemberAlertTitle';\n          descriptionLangKey = 'AddMembersAlertNamesText';\n          const b = document.createElement('b');\n          b.append(new PeerTitle({\n            peerId: peerIds[0]\n          }).element);\n          descriptionLangArgs = [b];\n\n          if(!isChannel) {\n            checkboxes = [{\n              text: 'AddOneMemberForwardMessages',\n              textArgs: [new PeerTitle({peerId: peerIds[0]}).element],\n              checked: true\n            }];\n          }\n        }\n\n        descriptionLangArgs.push(new PeerTitle({\n          peerId\n        }).element);\n\n        new PopupPeer('popup-add-members', {\n          peerId,\n          titleLangKey,\n          descriptionLangKey,\n          descriptionLangArgs,\n          buttons: [{\n            langKey: 'Add',\n            callback\n          }],\n          checkboxes\n        }).show();\n      };\n\n      const onError = (err: any) => {\n        if(err.type === 'USER_PRIVACY_RESTRICTED') {\n          toastNew({langPackKey: 'InviteToGroupError'});\n        }\n      };\n\n      if(isChannel) {\n        const tab = this.slider.createTab(AppAddMembersTab);\n        tab.open({\n          type: 'channel',\n          skippable: false,\n          takeOut: (peerIds) => {\n            showConfirmation(peerIds, () => {\n              const promise = this.managers.appChatsManager.inviteToChannel(id, peerIds);\n              promise.catch(onError);\n              tab.attachToPromise(promise);\n            });\n\n            return false;\n          },\n          title: 'GroupAddMembers',\n          placeholder: 'SendMessageTo'\n        });\n      } else {\n        new PopupPickUser({\n          peerTypes: ['contacts'],\n          placeholder: 'Search',\n          onSelect: (peerId) => {\n            setTimeout(() => {\n              showConfirmation([peerId], (checked) => {\n                this.managers.appChatsManager.addChatUser(id, peerId, checked.size ? undefined : 0)\n                .catch(onError);\n              });\n            }, 0);\n          }\n        });\n      }\n    }, {listenerSetter: this.listenerSetter});\n\n    // console.log('construct shared media time:', performance.now() - perf);\n  }\n\n  public async renderNewMessages(message: Message.message | Message.messageService) {\n    if(this.init) return; // * not inited yet\n\n    const {peerId} = message;\n    if(!historiesStorage[peerId]) return;\n\n    for(const mediaTab of this.searchSuper.mediaTabs) {\n      const inputFilter = mediaTab.inputFilter;\n      const history = historiesStorage[peerId][inputFilter];\n      if(!history) {\n        continue;\n      }\n\n      const filtered = this.searchSuper.filterMessagesByType([message], inputFilter).filter((message) => !history.find((m) => m.mid === message.mid && m.peerId === message.peerId));\n      if(filtered.length) {\n        history.unshift(...filtered.map((message) => ({mid: message.mid, peerId: message.peerId})));\n\n        if(this.peerId === peerId && this.searchSuper.usedFromHistory[inputFilter] !== -1) {\n          this.searchSuper.usedFromHistory[inputFilter] += filtered.length;\n          this.searchSuper.performSearchResult(filtered, mediaTab, false);\n        }\n      }\n    }\n  }\n\n  public deleteDeletedMessages(peerId: PeerId, mids: number[]) {\n    if(this.init) return; // * not inited yet\n\n    if(!historiesStorage[peerId]) return;\n\n    for(const mid of mids) {\n      for(const type of this.searchSuper.mediaTabs) {\n        const inputFilter = type.inputFilter;\n\n        const history = historiesStorage[peerId][inputFilter];\n        if(!history) continue;\n\n        const idx = history.findIndex((m) => m.mid === mid);\n        if(idx === -1) {\n          continue;\n        }\n\n        history.splice(idx, 1);\n\n        if(this.peerId === peerId) {\n          const container = this.searchSuper.tabs[inputFilter];\n          const div = container.querySelector(`[data-mid=\"${mid}\"][data-peer-id=\"${peerId}\"]`) as HTMLElement;\n          if(div) {\n            if(this.searchSuper.selection.isSelecting) {\n              this.searchSuper.selection.toggleByElement(div);\n            }\n\n            div.remove();\n          }\n\n          if(this.searchSuper.usedFromHistory[inputFilter] >= (idx + 1)) {\n            --this.searchSuper.usedFromHistory[inputFilter];\n          }\n        }\n\n        // can have element in different tabs somehow\n        // break;\n      }\n    }\n\n    this.scrollable.onScroll();\n  }\n\n  public async cleanupHTML() {\n    // const perf = performance.now();\n    this.profile.cleanupHTML();\n    this.editBtn.classList.add('hide');\n    this.searchSuper.cleanupHTML(true);\n    this.container.classList.toggle('can-add-members', await this.searchSuper.canViewMembers() && await this.managers.appChatsManager.hasRights(this.peerId.toChatId(), 'invite_users'));\n    // console.log('cleanupHTML shared media time:', performance.now() - perf);\n  }\n\n  public setLoadMutex(promise: Promise<any>) {\n    this.searchSuper.loadMutex = promise;\n  }\n\n  public setPeer(peerId: PeerId, threadId = 0) {\n    if(this.peerId === peerId && this.threadId === threadId) return false;\n\n    this.peerId = peerId;\n    this.threadId = threadId;\n    this.peerChanged = true;\n\n    if(this.init) {\n      this.init();\n      this.init = null;\n    }\n\n    this.searchSuper.setQuery({\n      peerId,\n      // threadId,\n      historyStorage: historiesStorage[peerId] ??= {}\n    });\n\n    this.profile.setPeer(peerId, threadId);\n\n    return true;\n  }\n\n  public async fillProfileElements() {\n    if(!this.peerChanged) {\n      return;\n    }\n\n    this.peerChanged = false;\n    await this.cleanupHTML();\n    await this.toggleEditBtn();\n    await this.profile.fillProfileElements();\n  }\n\n  private async toggleEditBtn() {\n    let show: boolean;\n    if(this.peerId.isUser()) {\n      show = this.peerId !== rootScope.myId && await this.managers.appUsersManager.isContact(this.peerId.toUserId());\n    } else {\n      show = await this.managers.appChatsManager.hasRights(this.peerId.toChatId(), 'change_info');\n    }\n\n    this.editBtn.classList.toggle('hide', !show);\n  }\n\n  public loadSidebarMedia(single: boolean, justLoad?: boolean) {\n    this.searchSuper.load(single, justLoad);\n  }\n\n  onOpenAfterTimeout() {\n    this.scrollable.onScroll();\n  }\n\n  public destroy() {\n    this.destroyable = true;\n    this.onCloseAfterTimeout();\n    this.profile.destroy();\n    this.searchSuper.destroy();\n  }\n}\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport rootScope from '../lib/rootScope';\r\n\r\nconst SetTransition = (\r\n  element: HTMLElement,\r\n  className: string,\r\n  forwards: boolean,\r\n  duration: number,\r\n  onTransitionEnd?: () => void,\r\n  useRafs?: number,\r\n  onTransitionStart?: () => void\r\n) => {\r\n  const {timeout, raf} = element.dataset;\r\n  if(timeout !== undefined) {\r\n    clearTimeout(+timeout);\r\n  }\r\n\r\n  // useRafs = undefined;\r\n  // duration = 0;\r\n\r\n  if(raf !== undefined) {\r\n    window.cancelAnimationFrame(+raf);\r\n    if(!useRafs) {\r\n      delete element.dataset.raf;\r\n    }\r\n  }\r\n\r\n  // if(forwards && className && element.classList.contains(className) && !element.classList.contains('animating')) {\r\n  //   return;\r\n  // }\r\n\r\n  if(useRafs && rootScope.settings.animationsEnabled && duration) {\r\n    element.dataset.raf = '' + window.requestAnimationFrame(() => {\r\n      delete element.dataset.raf;\r\n      SetTransition(element, className, forwards, duration, onTransitionEnd, useRafs - 1, onTransitionStart);\r\n    });\r\n\r\n    return;\r\n  }\r\n\r\n  if(forwards && className) {\r\n    element.classList.add(className);\r\n  }\r\n\r\n  const afterTimeout = () => {\r\n    delete element.dataset.timeout;\r\n    if(!forwards && className) {\r\n      element.classList.remove('backwards', className);\r\n    }\r\n\r\n    element.classList.remove('animating');\r\n\r\n    onTransitionEnd?.();\r\n  };\r\n\r\n  onTransitionStart?.();\r\n  if(!rootScope.settings.animationsEnabled || !duration) {\r\n    element.classList.remove('animating', 'backwards');\r\n    afterTimeout();\r\n    return;\r\n  }\r\n\r\n  element.classList.add('animating');\r\n\r\n  element.classList.toggle('backwards', !forwards);\r\n  element.dataset.timeout = '' + setTimeout(afterTimeout, duration);\r\n};\r\n\r\nexport default SetTransition;\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport {horizontalMenu} from './horizontalMenu';\r\nimport {TransitionSlider} from './transition';\r\nimport appNavigationController, {NavigationItem} from './appNavigationController';\r\nimport SliderSuperTab, {SliderSuperTabConstructable, SliderTab} from './sliderTab';\r\nimport {attachClickEvent} from '../helpers/dom/clickEvent';\r\nimport indexOfAndSplice from '../helpers/array/indexOfAndSplice';\r\nimport safeAssign from '../helpers/object/safeAssign';\r\nimport {AppManagers} from '../lib/appManagers/managers';\r\n\r\nconst TRANSITION_TIME = 250;\r\n\r\nexport type {SliderTab};\r\nexport {SliderSuperTab};\r\n\r\nexport default class SidebarSlider {\r\n  protected _selectTab: ReturnType<typeof horizontalMenu>;\r\n  public historyTabIds: (number | SliderSuperTab)[] = []; // * key is any, since right sidebar is ugly nowz\r\n  public tabsContainer: HTMLElement;\r\n  public sidebarEl: HTMLElement;\r\n  public tabs: Map<any, SliderTab>; // * key is any, since right sidebar is ugly now\r\n  private canHideFirst = false;\r\n  private navigationType: NavigationItem['type'];\r\n  protected managers: AppManagers;\r\n\r\n  constructor(options: {\r\n    sidebarEl: SidebarSlider['sidebarEl'],\r\n    tabs?: SidebarSlider['tabs'],\r\n    canHideFirst?: SidebarSlider['canHideFirst'],\r\n    navigationType: SidebarSlider['navigationType']\r\n  }) {\r\n    safeAssign(this, options);\r\n\r\n    if(!this.tabs) {\r\n      this.tabs = new Map();\r\n    }\r\n\r\n    this.tabsContainer = this.sidebarEl.querySelector('.sidebar-slider');\r\n    this._selectTab = TransitionSlider(this.tabsContainer, 'navigation', TRANSITION_TIME);\r\n    if(!this.canHideFirst) {\r\n      this._selectTab(0);\r\n    }\r\n\r\n    Array.from(this.sidebarEl.querySelectorAll('.sidebar-close-button') as any as HTMLElement[]).forEach((el) => {\r\n      attachClickEvent(el, this.onCloseBtnClick);\r\n    });\r\n  }\r\n\r\n  public onCloseBtnClick = () => {\r\n    const item = appNavigationController.findItemByType(this.navigationType);\r\n    if(item) {\r\n      appNavigationController.back(this.navigationType);\r\n    } else if(this.historyTabIds.length) {\r\n      this.closeTab(this.historyTabIds[this.historyTabIds.length - 1]);\r\n    }\r\n    // this.closeTab();\r\n  };\r\n\r\n  public closeTab = (id?: number | SliderSuperTab, animate?: boolean, isNavigation?: boolean) => {\r\n    if(id !== undefined && this.historyTabIds[this.historyTabIds.length - 1] !== id) {\r\n      return false;\r\n    }\r\n\r\n    // console.log('sidebar-close-button click:', this.historyTabIDs);\r\n    const closingId = this.historyTabIds.pop(); // pop current\r\n    this.onCloseTab(closingId, animate, isNavigation);\r\n\r\n    const tab = this.historyTabIds[this.historyTabIds.length - 1];\r\n    this._selectTab(tab !== undefined ? (tab instanceof SliderSuperTab ? tab.container : tab) : (this.canHideFirst ? -1 : 0), animate);\r\n    return true;\r\n  };\r\n\r\n  public selectTab(id: number | SliderSuperTab): boolean {\r\n    /* if(id instanceof SliderSuperTab) {\r\n      id = id.id;\r\n    } */\r\n\r\n    if(this.historyTabIds[this.historyTabIds.length - 1] === id) {\r\n      return false;\r\n    }\r\n\r\n    const tab: SliderTab = id instanceof SliderSuperTab ? id : this.tabs.get(id);\r\n    if(tab) {\r\n      if(tab.onOpen) {\r\n        tab.onOpen();\r\n      }\r\n\r\n      if(tab.onOpenAfterTimeout) {\r\n        setTimeout(() => {\r\n          tab.onOpenAfterTimeout();\r\n        }, TRANSITION_TIME);\r\n      }\r\n    }\r\n\r\n    // if(!this.canHideFirst || this.historyTabIds.length) {\r\n    appNavigationController.pushItem({\r\n      type: this.navigationType,\r\n      onPop: (canAnimate) => {\r\n        this.closeTab(undefined, canAnimate, true);\r\n        return true;\r\n      }\r\n    });\r\n    // }\r\n\r\n    this.historyTabIds.push(id);\r\n    this._selectTab(id instanceof SliderSuperTab ? id.container : id);\r\n    return true;\r\n  }\r\n\r\n  public removeTabFromHistory(id: number | SliderSuperTab) {\r\n    indexOfAndSplice(this.historyTabIds, id);\r\n    this.onCloseTab(id, undefined);\r\n  }\r\n\r\n  public sliceTabsUntilTab(tabConstructor: SliderSuperTabConstructable, preserveTab: SliderSuperTab) {\r\n    for(let i = this.historyTabIds.length - 1; i >= 0; --i) {\r\n      const tab = this.historyTabIds[i];\r\n      if(tab === preserveTab) continue;\r\n      else if(tab instanceof tabConstructor) {\r\n        break;\r\n      }\r\n\r\n      this.removeTabFromHistory(tab);\r\n      // appNavigationController.removeByType(this.navigationType, true);\r\n    }\r\n  }\r\n\r\n  public getTab<T extends SliderSuperTab>(tabConstructor: SliderSuperTabConstructable<T>) {\r\n    return this.historyTabIds.find((t) => t instanceof tabConstructor) as T;\r\n  }\r\n\r\n  public isTabExists(tabConstructor: SliderSuperTabConstructable) {\r\n    return !!this.getTab(tabConstructor);\r\n  }\r\n\r\n  protected onCloseTab(id: number | SliderSuperTab, animate: boolean, isNavigation?: boolean) {\r\n    if(!isNavigation) {\r\n      appNavigationController.removeByType(this.navigationType, true);\r\n    }\r\n\r\n    const tab: SliderTab = id instanceof SliderSuperTab ? id : this.tabs.get(id);\r\n    if(tab) {\r\n      if(tab.onClose) {\r\n        tab.onClose();\r\n      }\r\n\r\n      if(tab.onCloseAfterTimeout) {\r\n        setTimeout(() => {\r\n          tab.onCloseAfterTimeout();\r\n        }, TRANSITION_TIME + 30);\r\n      }\r\n    }\r\n  }\r\n\r\n  public addTab(tab: SliderSuperTab) {\r\n    if(!tab.container.parentElement) {\r\n      this.tabsContainer.append(tab.container);\r\n\r\n      if(tab.closeBtn) {\r\n        tab.closeBtn.addEventListener('click', this.onCloseBtnClick);\r\n      }\r\n    }\r\n  }\r\n\r\n  public createTab<T extends SliderSuperTab>(ctor: SliderSuperTabConstructable<T>, doNotAppend?: boolean) {\r\n    const tab = new ctor(doNotAppend ? undefined : this, true);\r\n    tab.managers = this.managers;\r\n    return tab;\r\n  }\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport EventListenerBase from '../helpers/eventListenerBase';\r\nimport ListenerSetter from '../helpers/listenerSetter';\r\nimport {AppManagers} from '../lib/appManagers/managers';\r\nimport {i18n, LangPackKey} from '../lib/langPack';\r\nimport ButtonIcon from './buttonIcon';\r\nimport Scrollable from './scrollable';\r\nimport SidebarSlider from './slider';\r\n\r\nexport interface SliderTab {\r\n  onOpen?: () => void,\r\n  onOpenAfterTimeout?: () => void,\r\n  onClose?: () => void,\r\n  onCloseAfterTimeout?: () => void\r\n}\r\n\r\nexport interface SliderSuperTabConstructable<T extends SliderSuperTab = any> {\r\n  new(slider: SidebarSlider, destroyable: boolean): T;\r\n}\r\n\r\nexport interface SliderSuperTabEventableConstructable {\r\n  new(slider: SidebarSlider, destroyable: boolean): SliderSuperTabEventable;\r\n}\r\n\r\nexport default class SliderSuperTab implements SliderTab {\r\n  public container: HTMLElement;\r\n\r\n  public header: HTMLElement;\r\n  public closeBtn: HTMLElement;\r\n  public title: HTMLElement;\r\n\r\n  public content: HTMLElement;\r\n  public scrollable: Scrollable;\r\n\r\n  public slider: SidebarSlider;\r\n  public destroyable: boolean;\r\n  public listenerSetter: ListenerSetter;\r\n\r\n  public managers: AppManagers;\r\n\r\n  constructor(slider: SidebarSlider, destroyable?: boolean) {\r\n    this._constructor(slider, destroyable);\r\n  }\r\n\r\n  public _constructor(slider: SidebarSlider, destroyable = true): any {\r\n    this.slider = slider;\r\n    this.destroyable = destroyable;\r\n\r\n    this.container = document.createElement('div');\r\n    this.container.classList.add('tabs-tab', 'sidebar-slider-item');\r\n\r\n    // * Header\r\n    this.header = document.createElement('div');\r\n    this.header.classList.add('sidebar-header');\r\n\r\n    this.closeBtn = ButtonIcon('left sidebar-close-button', {noRipple: true});\r\n    this.title = document.createElement('div');\r\n    this.title.classList.add('sidebar-header__title');\r\n    this.header.append(this.closeBtn, this.title);\r\n\r\n    // * Content\r\n    this.content = document.createElement('div');\r\n    this.content.classList.add('sidebar-content');\r\n\r\n    this.scrollable = new Scrollable(this.content, undefined, undefined, true);\r\n\r\n    this.container.append(this.header, this.content);\r\n\r\n    if(this.slider) {\r\n      this.slider.addTab(this);\r\n    }\r\n\r\n    this.listenerSetter = new ListenerSetter();\r\n  }\r\n\r\n  public close() {\r\n    return this.slider.closeTab(this);\r\n  }\r\n\r\n  public async open(...args: any[]) {\r\n    if(this.init) {\r\n      try {\r\n        const result = this.init();\r\n        this.init = null;\r\n\r\n        if(result instanceof Promise) {\r\n          await result;\r\n        }\r\n      } catch(err) {\r\n        console.error('open tab error', err);\r\n      }\r\n    }\r\n\r\n    this.slider.selectTab(this);\r\n  }\r\n\r\n  protected init(): Promise<any> | any {\r\n\r\n  }\r\n\r\n  public onCloseAfterTimeout() {\r\n    if(this.destroyable) { // ! WARNING,            !\r\n      this.slider.tabs.delete(this);\r\n      this.container.remove();\r\n      this.scrollable.destroy();\r\n      this.listenerSetter?.removeAll();\r\n    }\r\n  }\r\n\r\n  protected setTitle(key: LangPackKey) {\r\n    this.title.innerHTML = '';\r\n    this.title.append(i18n(key));\r\n  }\r\n}\r\n\r\nexport class SliderSuperTabEventable extends SliderSuperTab {\r\n  public eventListener: EventListenerBase<{\r\n    destroy: () => void\r\n  }>;\r\n\r\n  constructor(slider: SidebarSlider) {\r\n    super(slider);\r\n    this.eventListener = new EventListenerBase();\r\n  }\r\n\r\n  onCloseAfterTimeout() {\r\n    this.eventListener.dispatchEvent('destroy');\r\n    this.eventListener.cleanup();\r\n    return super.onCloseAfterTimeout();\r\n  }\r\n}\r\n\r\n/* // @ts-ignore\r\ninterface SliderSuperEventsTab extends SliderSuperTab, EventListenerBase<{}> {\r\n  superConstructor: (...args: any[]) => any;\r\n}\r\nclass SliderSuperEventsTab implements SliderSuperEventsTab {\r\n  constructor(slider: SidebarSlider) {\r\n    this.superConstructor([slider, true]);\r\n  }\r\n}\r\napplyMixins(SliderSuperEventsTab, [SliderSuperTab, EventListenerBase]);\r\n\r\n(window as any).lol = SliderSuperEventsTab\r\n\r\nexport {SliderSuperEventsTab}; */\r\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport appDialogsManager, {AppDialogsManager, DialogDom} from '../lib/appManagers/appDialogsManager';\nimport {getHeavyAnimationPromise} from '../hooks/useHeavyAnimationCheck';\nimport isInDOM from '../helpers/dom/isInDOM';\nimport positionElementByIndex from '../helpers/dom/positionElementByIndex';\nimport replaceContent from '../helpers/dom/replaceContent';\nimport {fastRaf} from '../helpers/schedulers';\nimport SortedList, {SortedElementBase} from '../helpers/sortedList';\nimport safeAssign from '../helpers/object/safeAssign';\nimport {AppManagers} from '../lib/appManagers/managers';\nimport getUserStatusString from './wrappers/getUserStatusString';\nimport type LazyLoadQueue from './lazyLoadQueue';\n\ninterface SortedUser extends SortedElementBase {\n  dom: DialogDom\n}\n\nexport default class SortedUserList extends SortedList<SortedUser> {\n  protected static SORT_INTERVAL = 30e3;\n  public list: HTMLUListElement;\n\n  protected lazyLoadQueue: LazyLoadQueue;\n  protected avatarSize = 48;\n  protected rippleEnabled = true;\n  protected autonomous = true;\n  protected createChatListOptions: Parameters<AppDialogsManager['createChatList']>[0];\n  protected onListLengthChange: () => void;\n  protected getIndex: (element: SortedUser) => number;\n  protected onUpdate: (element: SortedUser) => void;\n  protected managers: AppManagers;\n\n  constructor(options: Partial<{\n    lazyLoadQueue: SortedUserList['lazyLoadQueue'],\n    avatarSize: SortedUserList['avatarSize'],\n    rippleEnabled: SortedUserList['rippleEnabled'],\n    createChatListOptions: SortedUserList['createChatListOptions'],\n    autonomous: SortedUserList['autonomous'],\n    onListLengthChange: SortedUserList['onListLengthChange'],\n    getIndex: SortedUserList['getIndex'],\n    onUpdate: SortedUserList['onUpdate']\n  }> & {\n    managers: SortedUserList['managers']\n  }) {\n    super({\n      getIndex: options.getIndex || ((element) => this.managers.appUsersManager.getUserStatusForSort(element.id)),\n      onDelete: (element) => {\n        element.dom.listEl.remove();\n        this.onListLengthChange && this.onListLengthChange();\n      },\n      onUpdate: options.onUpdate || (async(element) => {\n        const status = getUserStatusString(await this.managers.appUsersManager.getUser(element.id));\n        replaceContent(element.dom.lastMessageSpan, status);\n      }),\n      onSort: (element, idx) => {\n        const willChangeLength = element.dom.listEl.parentElement !== this.list;\n        positionElementByIndex(element.dom.listEl, this.list, idx);\n\n        if(willChangeLength && this.onListLengthChange) {\n          this.onListLengthChange();\n        }\n      },\n      onElementCreate: (base) => {\n        const {dom} = appDialogsManager.addDialogNew({\n          peerId: base.id,\n          container: false,\n          avatarSize: this.avatarSize,\n          autonomous: this.autonomous,\n          meAsSaved: false,\n          rippleEnabled: this.rippleEnabled,\n          lazyLoadQueue: this.lazyLoadQueue\n        });\n\n        (base as SortedUser).dom = dom;\n        return base as SortedUser;\n      },\n      updateElementWith: fastRaf,\n      updateListWith: async(callback) => {\n        if(!isInDOM(this.list)) {\n          return callback(false);\n        }\n\n        await getHeavyAnimationPromise();\n\n        if(!isInDOM(this.list)) {\n          return callback(false);\n        }\n\n        callback(true);\n      }\n    });\n\n    safeAssign(this, options);\n\n    this.list = appDialogsManager.createChatList(this.createChatListOptions);\n\n    let timeout: number;\n    const doTimeout = () => {\n      timeout = window.setTimeout(() => {\n        this.updateList((good) => {\n          if(good) {\n            doTimeout();\n          }\n        });\n      }, SortedUserList.SORT_INTERVAL);\n    };\n\n    doTimeout();\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport AvatarElement from './avatar';\nimport type LazyLoadQueue from './lazyLoadQueue';\n\nconst CLASS_NAME = 'stacked-avatars';\nconst AVATAR_CLASS_NAME = CLASS_NAME + '-avatar';\nconst AVATAR_CONTAINER_CLASS_NAME = AVATAR_CLASS_NAME + '-container';\n\nexport default class StackedAvatars {\n  public container: HTMLElement;\n  private lazyLoadQueue: LazyLoadQueue;\n  private avatarSize: number;\n\n  constructor(options: {\n    lazyLoadQueue?: StackedAvatars['lazyLoadQueue'],\n    avatarSize: StackedAvatars['avatarSize']\n  }) {\n    this.lazyLoadQueue = options.lazyLoadQueue;\n    this.avatarSize = options.avatarSize;\n\n    this.container = document.createElement('div');\n    this.container.classList.add(CLASS_NAME);\n\n    this.container.style.setProperty('--avatar-size', options.avatarSize + 'px');\n  }\n  /**\n   * MACOS, ANDROID -  \n   * WINDOWS DESKTOP - \n   *       ,       , !\n   */\n  public render(peerIds: PeerId[], loadPromises?: Promise<any>[]) {\n    const children = this.container.children;\n    peerIds = peerIds.slice().reverse();\n    if(peerIds.length > 3) {\n      peerIds = peerIds.slice(-3);\n    }\n\n    peerIds.forEach((peerId, idx) => {\n      let avatarContainer = children[idx] as HTMLElement;\n      if(!avatarContainer) {\n        avatarContainer = document.createElement('div');\n        avatarContainer.classList.add(AVATAR_CONTAINER_CLASS_NAME);\n      }\n\n      let avatarElem = avatarContainer.firstElementChild as AvatarElement;\n      if(!avatarElem) {\n        avatarElem = new AvatarElement();\n        avatarElem.classList.add('avatar-' + this.avatarSize, AVATAR_CLASS_NAME);\n        avatarElem.updateOptions({\n          isDialog: false,\n          loadPromises\n        });\n      }\n\n      avatarElem.updateWithOptions({\n        lazyLoadQueue: this.lazyLoadQueue,\n        peerId: peerId\n      });\n\n      if(!avatarElem.parentNode) {\n        avatarContainer.append(avatarElem);\n      }\n\n      if(!avatarContainer.parentNode) {\n        this.container.append(avatarContainer);\n      }\n    });\n\n    // if were 3 and became 2\n    (Array.from(children) as HTMLElement[]).slice(peerIds.length).forEach((el) => el.remove());\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport IS_TOUCH_SUPPORTED from '../environment/touchSupport';\nimport cancelEvent from '../helpers/dom/cancelEvent';\nimport {simulateClickEvent, attachClickEvent} from '../helpers/dom/clickEvent';\nimport findUpAsChild from '../helpers/dom/findUpAsChild';\nimport findUpClassName from '../helpers/dom/findUpClassName';\nimport getVisibleRect from '../helpers/dom/getVisibleRect';\nimport ListenerSetter from '../helpers/listenerSetter';\nimport {makeMediaSize} from '../helpers/mediaSize';\nimport {getMiddleware} from '../helpers/middleware';\nimport {doubleRaf} from '../helpers/schedulers';\nimport pause from '../helpers/schedulers/pause';\nimport windowSize from '../helpers/windowSize';\nimport {MyDocument} from '../lib/appManagers/appDocsManager';\nimport getStickerEffectThumb from '../lib/appManagers/utils/stickers/getStickerEffectThumb';\nimport wrapEmojiText from '../lib/richTextProcessor/wrapEmojiText';\nimport lottieLoader from '../lib/rlottie/lottieLoader';\nimport RLottiePlayer from '../lib/rlottie/rlottiePlayer';\nimport rootScope from '../lib/rootScope';\nimport animationIntersector, {AnimationItemGroup} from './animationIntersector';\nimport SetTransition from './singleTransition';\nimport {wrapSticker} from './wrappers';\nimport {STICKER_EFFECT_MULTIPLIER} from './wrappers/sticker';\n\nlet hasViewer = false;\nexport default function attachStickerViewerListeners({listenTo, listenerSetter, selector}: {\n  listenerSetter: ListenerSetter,\n  listenTo: HTMLElement,\n  selector?: string\n}) {\n  if(IS_TOUCH_SUPPORTED) {\n    return;\n  }\n\n  const findTarget = (e: MouseEvent, checkForParent?: boolean) => {\n    const s = selector || `.media-sticker-wrapper`;\n    const el = (e.target as HTMLElement).closest(s) as HTMLElement;\n    return el && (!checkForParent || findUpAsChild(el, listenTo)) ? el : undefined;\n  };\n\n  const managers = rootScope.managers;\n\n  listenerSetter.add(listenTo)('mousedown', (e) => {\n    if(hasViewer || e.buttons > 1 || e.button !== 0) return;\n    let mediaContainer = findTarget(e);\n    if(!mediaContainer) {\n      return;\n    }\n\n    // const img: HTMLImageElement = mediaContainer.querySelector('img.media-sticker');\n\n    const docId = mediaContainer.dataset.docId;\n    if(!docId) {\n      return;\n    }\n\n    const className = 'sticker-viewer';\n    const group: AnimationItemGroup = 'STICKER-VIEWER';\n    const openDuration = 200;\n    const switchDuration = 200;\n    const previousGroup = animationIntersector.getOnlyOnePlayableGroup();\n    const _middleware = getMiddleware();\n    let container: HTMLElement, previousTransformer: HTMLElement;\n\n    const doThatSticker = async({mediaContainer, doc, middleware, lockGroups, isSwitching}: {\n      mediaContainer: HTMLElement,\n      doc: MyDocument,\n      middleware: () => boolean,\n      lockGroups?: boolean,\n      isSwitching?: boolean\n    }) => {\n      const effectThumb = getStickerEffectThumb(doc);\n      const mediaRect: DOMRect = mediaContainer.getBoundingClientRect();\n      const s = makeMediaSize(doc.w, doc.h);\n      const size = effectThumb ? 280 : 360;\n      const boxSize = makeMediaSize(size, size);\n      const fitted = mediaRect.width === mediaRect.height ? boxSize : s.aspectFitted(boxSize);\n\n      const bubble = findUpClassName(mediaContainer, 'bubble');\n      const isOut = bubble ? bubble.classList.contains('is-out') : true;\n\n      const transformer = document.createElement('div');\n      transformer.classList.add(className + '-transformer');\n\n      const stickerContainer = document.createElement('div');\n      stickerContainer.classList.add(className + '-sticker');\n      /* transformer.style.width =  */stickerContainer.style.width = fitted.width + 'px';\n      /* transformer.style.height =  */stickerContainer.style.height = fitted.height + 'px';\n\n      const stickerEmoji = document.createElement('div');\n      stickerEmoji.classList.add(className + '-emoji');\n      stickerEmoji.append(wrapEmojiText(doc.stickerEmojiRaw));\n\n      if(effectThumb) {\n        const margin = (size * STICKER_EFFECT_MULTIPLIER - size) / 3 * (isOut ? 1 : -1);\n        transformer.classList.add('has-effect');\n        // const property = `--margin-${isOut ? 'right' : 'left'}`;\n        // stickerContainer.style.setProperty(property, `${margin * 2}px`);\n        transformer.style.setProperty('--translateX', `${margin}px`);\n        stickerEmoji.style.setProperty('--translateX', `${-margin}px`);\n      }\n\n      const overflowElement = findUpClassName(mediaContainer, 'scrollable');\n      const visibleRect = getVisibleRect(mediaContainer, overflowElement, true, mediaRect);\n      if(visibleRect.overflow.vertical || visibleRect.overflow.horizontal) {\n        stickerContainer.classList.add('is-overflow');\n      }\n\n      // if(img) {\n      //   const ratio = img.naturalWidth / img.naturalHeight;\n      //   if((mediaRect.width / mediaRect.height).toFixed(1) !== ratio.toFixed(1)) {\n\n      //     mediaRect = mediaRect.toJSON();\n      //   }\n      // }\n\n      const rect = mediaContainer.getBoundingClientRect();\n      const scaleX = rect.width / fitted.width;\n      const scaleY = rect.height / fitted.height;\n      const transformX = rect.left - (windowSize.width - rect.width) / 2;\n      const transformY = rect.top - (windowSize.height - rect.height) / 2;\n      transformer.style.transform = `translate(${transformX}px, ${transformY}px) scale(${scaleX}, ${scaleY})`;\n      if(isSwitching) transformer.classList.add('is-switching');\n      transformer.append(stickerContainer, stickerEmoji);\n      container.append(transformer);\n\n      const player = await wrapSticker({\n        doc,\n        div: stickerContainer,\n        group,\n        width: fitted.width,\n        height: fitted.height,\n        play: false,\n        loop: true,\n        middleware,\n        managers,\n        needFadeIn: false,\n        isOut,\n        withThumb: false,\n        relativeEffect: true,\n        loopEffect: true\n      }).then(({render}) => render);\n      if(!middleware()) return;\n\n      if(!container.parentElement) {\n        document.body.append(container);\n      }\n\n      const firstFramePromise = player instanceof RLottiePlayer ?\n        new Promise<void>((resolve) => player.addEventListener('firstFrame', resolve, {once: true})) :\n        Promise.resolve();\n      await Promise.all([firstFramePromise, doubleRaf()]);\n      await pause(0); // ! need it because firstFrame will be called just from the loop\n      if(!middleware()) return;\n\n      if(lockGroups) {\n        animationIntersector.setOnlyOnePlayableGroup(group);\n        animationIntersector.checkAnimations(true);\n      }\n\n      if(player instanceof RLottiePlayer) {\n        const prevPlayer = lottieLoader.getAnimation(mediaContainer);\n        player.curFrame = prevPlayer.curFrame;\n        player.play();\n        await new Promise<void>((resolve) => {\n          let i = 0;\n          const c = () => {\n            if(++i === 2) {\n              resolve();\n              player.removeEventListener('enterFrame', c);\n            }\n          };\n\n          player.addEventListener('enterFrame', c);\n        });\n        player.pause();\n      } else if(player instanceof HTMLVideoElement) {\n        player.currentTime = (mediaContainer.querySelector('video') as HTMLVideoElement).currentTime;\n      }\n\n      return {\n        ready: () => {\n          if(player instanceof RLottiePlayer || player instanceof HTMLVideoElement) {\n            player.play();\n          }\n\n          if(effectThumb) {\n            simulateClickEvent(stickerContainer);\n          }\n        },\n        transformer\n      };\n    };\n\n    const timeout = window.setTimeout(async() => {\n      document.removeEventListener('mousemove', onMousePreMove);\n\n      container = document.createElement('div');\n      container.classList.add(className);\n      hasViewer = true;\n\n      const middleware = _middleware.get();\n      const doc = await managers.appDocsManager.getDoc(docId);\n      if(!middleware()) return;\n\n      let result: Awaited<ReturnType<typeof doThatSticker>>;\n      try {\n        result = await doThatSticker({\n          doc,\n          mediaContainer,\n          middleware,\n          lockGroups: true\n        });\n        if(!result) return;\n      } catch(err) {\n        return;\n      }\n\n      const {ready, transformer} = result;\n\n      previousTransformer = transformer;\n\n      SetTransition(container, 'is-visible', true, openDuration, () => {\n        if(!middleware()) return;\n        ready();\n      });\n\n      document.addEventListener('mousemove', onMouseMove);\n    }, 125);\n\n    const onMouseMove = async(e: MouseEvent) => {\n      const newMediaContainer = findTarget(e, true);\n      if(!newMediaContainer || mediaContainer === newMediaContainer) {\n        return;\n      }\n\n      const docId = newMediaContainer.dataset.docId;\n      if(!docId) {\n        return;\n      }\n\n      mediaContainer = newMediaContainer;\n      _middleware.clean();\n      const middleware = _middleware.get();\n\n      const doc = await managers.appDocsManager.getDoc(docId);\n      if(!middleware()) return;\n\n      let r: Awaited<ReturnType<typeof doThatSticker>>;\n      try {\n        r = await doThatSticker({\n          doc,\n          mediaContainer,\n          middleware,\n          isSwitching: true\n        });\n        if(!r) return;\n      } catch(err) {\n        return;\n      }\n\n      const {ready, transformer} = r;\n\n      const _previousTransformer = previousTransformer;\n      SetTransition(_previousTransformer, 'is-switching', true, switchDuration, () => {\n        _previousTransformer.remove();\n      });\n\n      previousTransformer = transformer;\n\n      SetTransition(transformer, 'is-switching', false, switchDuration, () => {\n        if(!middleware()) return;\n        ready();\n      });\n    };\n\n    const onMousePreMove = (e: MouseEvent) => {\n      if(!findUpAsChild(e.target as HTMLElement, mediaContainer)) {\n        document.removeEventListener('mousemove', onMousePreMove);\n        onMouseUp();\n      }\n    };\n\n    const onMouseUp = () => {\n      clearTimeout(timeout);\n      _middleware.clean();\n\n      if(container) {\n        SetTransition(container, 'is-visible', false, openDuration, () => {\n          container.remove();\n          animationIntersector.setOnlyOnePlayableGroup(previousGroup);\n          animationIntersector.checkAnimations(false);\n          hasViewer = false;\n        });\n\n        attachClickEvent(document.body, cancelEvent, {capture: true, once: true});\n      }\n\n      document.removeEventListener('mousemove', onMouseMove);\n      document.removeEventListener('mouseup', onMouseUp, {capture: true});\n    };\n\n    document.addEventListener('mousemove', onMousePreMove);\n    document.addEventListener('mouseup', onMouseUp, {once: true, capture: true});\n  });\n}\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nexport default class StickyIntersector {\r\n  private headersObserver: IntersectionObserver;\r\n  private elementsObserver: IntersectionObserver;\r\n\r\n  constructor(private container: HTMLElement, private handler: (stuck: boolean, target: HTMLElement) => void) {\r\n    this.observeHeaders();\r\n    this.observeElements();\r\n  }\r\n\r\n  /**\r\n   * Sets up an intersection observer to notify when elements with the class\r\n   * `.sticky_sentinel--top` become visible/invisible at the top of the container.\r\n   * @param {!Element} container\r\n   */\r\n  private observeHeaders() {\r\n    this.headersObserver = new IntersectionObserver((entries) => {\r\n      for(const entry of entries) {\r\n        const targetInfo = entry.boundingClientRect;\r\n        const stickyTarget = entry.target.parentElement;\r\n        const rootBoundsInfo = entry.rootBounds;\r\n\r\n        // Started sticking.\r\n        if(targetInfo.bottom < rootBoundsInfo.top) {\r\n          this.handler(true, stickyTarget);\r\n        }\r\n\r\n        // Stopped sticking.\r\n        if(targetInfo.bottom >= rootBoundsInfo.top &&\r\n            targetInfo.bottom < rootBoundsInfo.bottom) {\r\n          this.handler(false, stickyTarget);\r\n        }\r\n      }\r\n    }, {threshold: 0, root: this.container});\r\n  }\r\n\r\n  private observeElements() {\r\n    this.elementsObserver = new IntersectionObserver((entries) => {\r\n      const entry = entries\r\n      .filter((entry) => entry.boundingClientRect.top < entry.rootBounds.top)\r\n      .sort((a, b) => a.boundingClientRect.top - b.boundingClientRect.top)[0];\r\n      if(!entry) return;\r\n\r\n      const container = entry.isIntersecting ? entry.target : entry.target.nextElementSibling;\r\n      this.handler(true, container as HTMLElement);\r\n    }, {root: this.container});\r\n  }\r\n\r\n  /**\r\n   * @param {!Element} container\r\n   * @param {string} className\r\n   */\r\n  private addSentinel(container: HTMLElement, className: string) {\r\n    const sentinel = document.createElement('div');\r\n    sentinel.classList.add('sticky_sentinel', className);\r\n    return container.appendChild(sentinel);\r\n  }\r\n\r\n  /**\r\n   * Notifies when elements w/ the `sticky` class begin to stick or stop sticking.\r\n   * Note: the elements should be children of `container`.\r\n   * @param {!Element} container\r\n   */\r\n  public observeStickyHeaderChanges(element: HTMLElement) {\r\n    const headerSentinel = this.addSentinel(element, 'sticky_sentinel--top');\r\n    this.headersObserver.observe(headerSentinel);\r\n\r\n    this.elementsObserver.observe(element);\r\n  }\r\n\r\n  public disconnect() {\r\n    this.headersObserver.disconnect();\r\n    this.elementsObserver.disconnect();\r\n  }\r\n\r\n  public unobserve(element: HTMLElement, headerSentinel: HTMLElement) {\r\n    this.elementsObserver.unobserve(element);\r\n    this.headersObserver.unobserve(headerSentinel);\r\n  }\r\n}\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport cancelEvent from '../helpers/dom/cancelEvent';\r\nimport IS_TOUCH_SUPPORTED from '../environment/touchSupport';\r\nimport safeAssign from '../helpers/object/safeAssign';\r\nimport contextMenuController from '../helpers/contextMenuController';\r\n\r\nconst getEvent = (e: TouchEvent | MouseEvent) => {\r\n  return (e as TouchEvent).touches ? (e as TouchEvent).touches[0] : e as MouseEvent;\r\n};\r\n\r\nconst attachGlobalListenerTo = window;\r\n\r\nlet RESET_GLOBAL = false;\r\ncontextMenuController.addEventListener('toggle', (visible) => {\r\n  RESET_GLOBAL = visible;\r\n});\r\n\r\nexport type SwipeHandlerOptions = {\r\n  element: SwipeHandler['element'],\r\n  onSwipe: SwipeHandler['onSwipe'],\r\n  verifyTouchTarget?: SwipeHandler['verifyTouchTarget'],\r\n  onFirstSwipe?: SwipeHandler['onFirstSwipe'],\r\n  onReset?: SwipeHandler['onReset'],\r\n  cursor?: SwipeHandler['cursor'],\r\n  cancelEvent?: SwipeHandler['cancelEvent'],\r\n  listenerOptions?: SwipeHandler['listenerOptions']\r\n};\r\n\r\nexport default class SwipeHandler {\r\n  private element: HTMLElement;\r\n  private onSwipe: (xDiff: number, yDiff: number, e: TouchEvent | MouseEvent) => boolean | void;\r\n  private verifyTouchTarget: (evt: TouchEvent | MouseEvent) => boolean | Promise<boolean>;\r\n  private onFirstSwipe: () => void;\r\n  private onReset: () => void;\r\n  private cursor: 'grabbing' | 'move' | 'row-resize' | 'col-resize' | 'nesw-resize' | 'nwse-resize' | 'ne-resize' | 'se-resize' | 'sw-resize' | 'nw-resize' | 'n-resize' | 'e-resize' | 's-resize' | 'w-resize' | '' = 'grabbing';\r\n  private cancelEvent = true;\r\n  private listenerOptions: boolean | AddEventListenerOptions = false;\r\n  private setCursorTo: HTMLElement;\r\n\r\n  private hadMove = false;\r\n  private xDown: number = null;\r\n  private yDown: number = null;\r\n\r\n  constructor(options: SwipeHandlerOptions) {\r\n    safeAssign(this, options);\r\n\r\n    this.setCursorTo = this.element;\r\n\r\n    this.setListeners();\r\n  }\r\n\r\n  public setListeners() {\r\n    if(!IS_TOUCH_SUPPORTED) {\r\n      this.element.addEventListener('mousedown', this.handleStart, this.listenerOptions);\r\n      attachGlobalListenerTo.addEventListener('mouseup', this.reset);\r\n    } else {\r\n      this.element.addEventListener('touchstart', this.handleStart, this.listenerOptions);\r\n      attachGlobalListenerTo.addEventListener('touchend', this.reset);\r\n    }\r\n  }\r\n\r\n  public removeListeners() {\r\n    if(!IS_TOUCH_SUPPORTED) {\r\n      this.element.removeEventListener('mousedown', this.handleStart, this.listenerOptions);\r\n      attachGlobalListenerTo.removeEventListener('mouseup', this.reset);\r\n    } else {\r\n      this.element.removeEventListener('touchstart', this.handleStart, this.listenerOptions);\r\n      attachGlobalListenerTo.removeEventListener('touchend', this.reset);\r\n    }\r\n  }\r\n\r\n  public setCursor(cursor: SwipeHandler['cursor']) {\r\n    this.cursor = cursor;\r\n\r\n    if(!IS_TOUCH_SUPPORTED && this.hadMove) {\r\n      this.setCursorTo.style.setProperty('cursor', this.cursor, 'important');\r\n    }\r\n  }\r\n\r\n  reset = (e?: Event) => {\r\n    /* if(e) {\r\n      cancelEvent(e);\r\n    } */\r\n\r\n    if(IS_TOUCH_SUPPORTED) {\r\n      attachGlobalListenerTo.removeEventListener('touchmove', this.handleMove, {capture: true});\r\n    } else {\r\n      attachGlobalListenerTo.removeEventListener('mousemove', this.handleMove);\r\n      this.setCursorTo.style.cursor = '';\r\n    }\r\n\r\n    if(this.onReset && this.hadMove) {\r\n      this.onReset();\r\n    }\r\n\r\n    this.xDown = this.yDown = null;\r\n    this.hadMove = false;\r\n  };\r\n\r\n  handleStart = async(_e: TouchEvent | MouseEvent) => {\r\n    const e = getEvent(_e);\r\n    if(this.verifyTouchTarget && !(await this.verifyTouchTarget(_e))) {\r\n      return this.reset();\r\n    }\r\n\r\n    this.xDown = e.clientX;\r\n    this.yDown = e.clientY;\r\n\r\n    if(IS_TOUCH_SUPPORTED) {\r\n      attachGlobalListenerTo.addEventListener('touchmove', this.handleMove, {passive: false, capture: true});\r\n    } else {\r\n      attachGlobalListenerTo.addEventListener('mousemove', this.handleMove, false);\r\n    }\r\n  };\r\n\r\n  handleMove = (_e: TouchEvent | MouseEvent) => {\r\n    if(this.xDown === null || this.yDown === null || RESET_GLOBAL) {\r\n      this.reset();\r\n      return;\r\n    }\r\n\r\n    if(this.cancelEvent) {\r\n      cancelEvent(_e);\r\n    }\r\n\r\n    const e = getEvent(_e);\r\n    const xUp = e.clientX;\r\n    const yUp = e.clientY;\r\n\r\n    const xDiff = this.xDown - xUp;\r\n    const yDiff = this.yDown - yUp;\r\n\r\n    if(!this.hadMove) {\r\n      if(!xDiff && !yDiff) {\r\n        return;\r\n      }\r\n\r\n      this.hadMove = true;\r\n\r\n      if(!IS_TOUCH_SUPPORTED) {\r\n        this.setCursorTo.style.setProperty('cursor', this.cursor, 'important');\r\n      }\r\n\r\n      if(this.onFirstSwipe) {\r\n        this.onFirstSwipe();\r\n      }\r\n    }\r\n\r\n    // if(Math.abs(xDiff) > Math.abs(yDiff)) { /*most significant*/\r\n    //   if(xDiff > 0) { /* left swipe */\r\n\r\n    //   } else { /* right swipe */\r\n\r\n    //   }\r\n    // } else {\r\n    //   if(yDiff > 0) { /* up swipe */\r\n\r\n    //   } else { /* down swipe */\r\n\r\n    //   }\r\n    // }\r\n\r\n    /* reset values */\r\n    const onSwipeResult = this.onSwipe(xDiff, yDiff, _e);\r\n    if(onSwipeResult !== undefined && onSwipeResult) {\r\n      this.reset();\r\n    }\r\n  };\r\n}\r\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport placeCaretAtEnd from '../helpers/dom/placeCaretAtEnd';\nimport {formatPhoneNumber} from '../helpers/formatPhoneNumber';\nimport {IS_APPLE, IS_ANDROID, IS_APPLE_MOBILE} from '../environment/userAgent';\nimport {HelpCountry, HelpCountryCode} from '../layer';\nimport InputField, {InputFieldOptions} from './inputField';\n\nexport default class TelInputField extends InputField {\n  private pasted = false;\n  public lastValue = '';\n\n  constructor(options: InputFieldOptions & {\n    onInput?: (formatted: ReturnType<typeof formatPhoneNumber>) => void\n  } = {}) {\n    super({\n      label: 'Contacts.PhoneNumber.Placeholder',\n      // plainText: true,\n      name: 'phone',\n      ...options\n    });\n\n    this.container.classList.add('input-field-phone');\n\n    const telEl = this.input;\n    if(telEl instanceof HTMLInputElement) {\n      telEl.type = 'tel';\n      telEl.autocomplete = 'rr55RandomRR55';\n    } else {\n      telEl.inputMode = 'decimal';\n\n      const pixelRatio = window.devicePixelRatio;\n      if(pixelRatio > 1) {\n        let letterSpacing: number;\n        if(IS_APPLE) {\n          letterSpacing = pixelRatio * -.16;\n        } else if(IS_ANDROID) {\n          letterSpacing = 0;\n        }\n\n        telEl.style.setProperty('--letter-spacing', letterSpacing + 'px');\n      }\n\n      const originalFunc = this.setValueSilently.bind(this);\n      this.setValueSilently = (value) => {\n        originalFunc(value);\n        placeCaretAtEnd(this.input, true);\n      };\n    }\n\n    telEl.addEventListener('input', () => {\n      // console.log('input', this.value);\n      telEl.classList.remove('error');\n\n      const value = this.value;\n      const diff = Math.abs(value.length - this.lastValue.length);\n      if(diff > 1 && !this.pasted && IS_APPLE_MOBILE) {\n        this.setValueSilently(this.lastValue + value);\n      }\n\n      this.pasted = false;\n\n      this.setLabel();\n\n      let formattedPhoneNumber: ReturnType<typeof formatPhoneNumber>;\n      let formatted: string, country: HelpCountry, countryCode: HelpCountryCode, leftPattern = '';\n      if(this.value.replace(/\\++/, '+') === '+') {\n        this.setValueSilently('+');\n      } else {\n        formattedPhoneNumber = formatPhoneNumber(this.value);\n        formatted = formattedPhoneNumber.formatted;\n        country = formattedPhoneNumber.country;\n        leftPattern = formattedPhoneNumber.leftPattern;\n        countryCode = formattedPhoneNumber.code;\n        this.setValueSilently(this.lastValue = formatted ? '+' + formatted : '');\n      }\n\n      telEl.dataset.leftPattern = leftPattern/* .replace(/X/g, '0') */;\n\n      // console.log(formatted, country);\n\n      options.onInput && options.onInput(formattedPhoneNumber);\n    });\n\n    telEl.addEventListener('paste', () => {\n      this.pasted = true;\n      // console.log('paste', telEl.value);\n    });\n\n    /* telEl.addEventListener('change', (e) => {\n      console.log('change', telEl.value);\n    }); */\n\n    telEl.addEventListener('keypress', (e) => {\n      // console.log('keypress', this.value);\n      const key = e.key;\n      if(/\\D/.test(key) && !(e.metaKey || e.ctrlKey) && key !== 'Backspace' && !(key === '+' && e.shiftKey/*  && !this.value */)) {\n        e.preventDefault();\n        return false;\n      }\n    });\n\n    /* telEl.addEventListener('focus', function(this: typeof telEl, e) {\n      this.removeAttribute('readonly'); // fix autocomplete\n    });*/\n  }\n}\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport replaceContent from '../helpers/dom/replaceContent';\r\nimport OverlayClickHandler from '../helpers/overlayClickHandler';\r\nimport {FormatterArguments, i18n, LangPackKey} from '../lib/langPack';\r\n\r\nconst toastEl = document.createElement('div');\r\ntoastEl.classList.add('toast');\r\nlet timeout: number;\r\n\r\nconst x = new OverlayClickHandler('toast');\r\nx.addEventListener('toggle', (open) => {\r\n  if(!open) {\r\n    hideToast();\r\n  }\r\n});\r\n\r\nexport function hideToast() {\r\n  x.close();\r\n\r\n  toastEl.classList.remove('is-visible');\r\n  timeout && clearTimeout(+timeout);\r\n\r\n  timeout = window.setTimeout(() => {\r\n    toastEl.remove();\r\n    timeout = undefined;\r\n  }, 200);\r\n}\r\n\r\nexport function toast(content: string | Node, onClose?: () => void) {\r\n  x.close();\r\n\r\n  replaceContent(toastEl, content);\r\n\r\n  if(!toastEl.parentElement) {\r\n    document.body.append(toastEl);\r\n    void toastEl.offsetLeft; // reflow\r\n  }\r\n\r\n  toastEl.classList.add('is-visible');\r\n\r\n  timeout && clearTimeout(+timeout);\r\n  x.open(toastEl);\r\n\r\n  timeout = window.setTimeout(hideToast, 3000);\r\n\r\n  if(onClose) {\r\n    x.addEventListener('toggle', onClose, {once: true});\r\n  }\r\n}\r\n\r\nexport function toastNew(options: Partial<{\r\n  langPackKey: LangPackKey,\r\n  langPackArguments: FormatterArguments,\r\n  onClose: () => void\r\n}>) {\r\n  toast(i18n(options.langPackKey, options.langPackArguments), options.onClose);\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport rootScope from '../lib/rootScope';\r\nimport deferredPromise, {CancellablePromise} from '../helpers/cancellablePromise';\r\nimport {dispatchHeavyAnimationEvent} from '../hooks/useHeavyAnimationCheck';\r\nimport whichChild from '../helpers/dom/whichChild';\r\nimport cancelEvent from '../helpers/dom/cancelEvent';\r\nimport ListenerSetter from '../helpers/listenerSetter';\r\n\r\nfunction slideNavigation(tabContent: HTMLElement, prevTabContent: HTMLElement, toRight: boolean) {\r\n  const width = prevTabContent.getBoundingClientRect().width;\r\n  const elements = [tabContent, prevTabContent];\r\n  if(toRight) elements.reverse();\r\n  elements[0].style.filter = `brightness(80%)`;\r\n  elements[0].style.transform = `translate3d(${-width * .25}px, 0, 0)`;\r\n  elements[1].style.transform = `translate3d(${width}px, 0, 0)`;\r\n\r\n  tabContent.classList.add('active');\r\n  void tabContent.offsetWidth; // reflow\r\n\r\n  tabContent.style.transform = '';\r\n  tabContent.style.filter = '';\r\n\r\n  return () => {\r\n    prevTabContent.style.transform = prevTabContent.style.filter = '';\r\n  };\r\n}\r\n\r\nfunction slideTabs(tabContent: HTMLElement, prevTabContent: HTMLElement, toRight: boolean) {\r\n  // Jolly Cobra's // Workaround for scrollable content flickering during animation.\r\n  // const scrollableContainer = findUpClassName(tabContent, 'scrollable-y');\r\n  // if(scrollableContainer && scrollableContainer.style.overflowY !== 'hidden') {\r\n  //   // const scrollBarWidth = scrollableContainer.offsetWidth - scrollableContainer.clientWidth;\r\n  //   scrollableContainer.style.overflowY = 'hidden';\r\n  //   // scrollableContainer.style.paddingRight = `${scrollBarWidth}px`;\r\n  //   // this.container.classList.add('sliding');\r\n  // }\r\n\r\n  // window.requestAnimationFrame(() => {\r\n  const width = prevTabContent.getBoundingClientRect().width;\r\n  /* tabContent.style.setProperty('--width', width + 'px');\r\n    prevTabContent.style.setProperty('--width', width + 'px');\r\n\r\n    tabContent.classList.add('active'); */\r\n  // void tabContent.offsetWidth; // reflow\r\n  const elements = [tabContent, prevTabContent];\r\n  if(toRight) elements.reverse();\r\n  elements[0].style.transform = `translate3d(${-width}px, 0, 0)`;\r\n  elements[1].style.transform = `translate3d(${width}px, 0, 0)`;\r\n\r\n  tabContent.classList.add('active');\r\n  void tabContent.offsetWidth; // reflow\r\n\r\n  tabContent.style.transform = '';\r\n  // });\r\n\r\n  return () => {\r\n    prevTabContent.style.transform = '';\r\n\r\n    // if(scrollableContainer) {\r\n    //   // Jolly Cobra's // Workaround for scrollable content flickering during animation.\r\n    //   if(isSafari) { // ! safari doesn't respect sticky header, so it flicks when overflow is changing\r\n    //     scrollableContainer.style.display = 'none';\r\n    //   }\r\n\r\n    //   scrollableContainer.style.overflowY = '';\r\n\r\n    //   if(isSafari) {\r\n    //     void scrollableContainer.offsetLeft; // reflow\r\n    //     scrollableContainer.style.display = '';\r\n    //   }\r\n\r\n    //   // scrollableContainer.style.paddingRight = '0';\r\n    //   // this.container.classList.remove('sliding');\r\n    // }\r\n  };\r\n}\r\n\r\nexport const TransitionSlider = (\r\n  content: HTMLElement,\r\n  type: 'tabs' | 'navigation' | 'zoom-fade' | 'slide-fade' | 'none'/*  | 'counter' */,\r\n  transitionTime: number,\r\n  onTransitionEnd?: (id: number) => void,\r\n  isHeavy = true,\r\n  listenerSetter?: ListenerSetter\r\n) => {\r\n  let animationFunction: TransitionFunction = null;\r\n\r\n  switch(type) {\r\n    case 'tabs':\r\n      animationFunction = slideTabs;\r\n      break;\r\n    case 'navigation':\r\n      animationFunction = slideNavigation;\r\n      break;\r\n    /* default:\r\n      break; */\r\n  }\r\n\r\n  content.dataset.animation = type;\r\n\r\n  return Transition(content, animationFunction, transitionTime, onTransitionEnd, isHeavy, undefined, undefined, listenerSetter);\r\n};\r\n\r\ntype TransitionFunction = (tabContent: HTMLElement, prevTabContent: HTMLElement, toRight: boolean) => void | (() => void);\r\n\r\nconst Transition = (\r\n  content: HTMLElement,\r\n  animationFunction: TransitionFunction,\r\n  transitionTime: number,\r\n  onTransitionEnd?: (id: number) => void,\r\n  isHeavy = true,\r\n  once = false,\r\n  withAnimationListener = true,\r\n  listenerSetter?: ListenerSetter\r\n) => {\r\n  const onTransitionEndCallbacks: Map<HTMLElement, Function> = new Map();\r\n  let animationDeferred: CancellablePromise<void>;\r\n  // let animationStarted = 0;\r\n  let from: HTMLElement = null;\r\n\r\n  if(withAnimationListener) {\r\n    const listenerName = animationFunction ? 'transitionend' : 'animationend';\r\n\r\n    const onEndEvent = (e: TransitionEvent | AnimationEvent) => {\r\n      cancelEvent(e);\r\n\r\n      if((e.target as HTMLElement).parentElement !== content) {\r\n        return;\r\n      }\r\n\r\n      // console.log('Transition: transitionend', /* content, */ e, selectTab.prevId, performance.now() - animationStarted);\r\n\r\n      const callback = onTransitionEndCallbacks.get(e.target as HTMLElement);\r\n      callback?.();\r\n\r\n      if(e.target !== from) {\r\n        return;\r\n      }\r\n\r\n      if(!animationDeferred && isHeavy) return;\r\n\r\n      if(animationDeferred) {\r\n        animationDeferred.resolve();\r\n        animationDeferred = undefined;\r\n      }\r\n\r\n      if(onTransitionEnd) {\r\n        onTransitionEnd(selectTab.prevId());\r\n      }\r\n\r\n      content.classList.remove('animating', 'backwards', 'disable-hover');\r\n\r\n      if(once) {\r\n        if(listenerSetter) listenerSetter.removeManual(content, listenerName, onEndEvent);\r\n        else content.removeEventListener(listenerName, onEndEvent/* , {capture: false} */);\r\n        from = animationDeferred = undefined;\r\n        onTransitionEndCallbacks.clear();\r\n      }\r\n    };\r\n\r\n    // TODO: check for transition type (transform, etc) using by animationFunction\r\n    if(listenerSetter) listenerSetter.add(content)(listenerName, onEndEvent);\r\n    else content.addEventListener(listenerName, onEndEvent/* , {passive: true, capture: false} */);\r\n  }\r\n\r\n  function selectTab(id: number | HTMLElement, animate = true, overrideFrom?: typeof from) {\r\n    if(overrideFrom) {\r\n      from = overrideFrom;\r\n    }\r\n\r\n    if(id instanceof HTMLElement) {\r\n      id = whichChild(id);\r\n    }\r\n\r\n    const prevId = selectTab.prevId();\r\n    if(id === prevId) return false;\r\n\r\n    // console.log('selectTab id:', id);\r\n\r\n    const to = content.children[id] as HTMLElement;\r\n\r\n    if(!rootScope.settings.animationsEnabled || prevId === -1) {\r\n      animate = false;\r\n    }\r\n\r\n    if(!withAnimationListener) {\r\n      const timeout = content.dataset.timeout;\r\n      if(timeout !== undefined) {\r\n        clearTimeout(+timeout);\r\n      }\r\n\r\n      delete content.dataset.timeout;\r\n    }\r\n\r\n    if(!animate) {\r\n      if(from) from.classList.remove('active', 'to', 'from');\r\n      else if(to) { // fix instant opening back from closed slider (e.g. instant closening and opening right sidebar)\r\n        const callback = onTransitionEndCallbacks.get(to);\r\n        callback?.();\r\n      }\r\n\r\n      if(to) {\r\n        to.classList.remove('to', 'from');\r\n        to.classList.add('active');\r\n      }\r\n\r\n      content.classList.remove('animating', 'backwards', 'disable-hover');\r\n\r\n      from = to;\r\n\r\n      if(onTransitionEnd) onTransitionEnd(id);\r\n      return;\r\n    }\r\n\r\n    if(!withAnimationListener) {\r\n      content.dataset.timeout = '' + window.setTimeout(() => {\r\n        to.classList.remove('to');\r\n        from && from.classList.remove('from');\r\n        content.classList.remove('animating', 'backwards', 'disable-hover');\r\n        delete content.dataset.timeout;\r\n      }, transitionTime);\r\n    }\r\n\r\n    if(from) {\r\n      from.classList.remove('to');\r\n      from.classList.add('from');\r\n    }\r\n\r\n    content.classList.add('animating'/* , 'disable-hover' */);\r\n    const toRight = prevId < id;\r\n    content.classList.toggle('backwards', !toRight);\r\n\r\n    let onTransitionEndCallback: ReturnType<TransitionFunction>;\r\n    if(!to) {\r\n      // prevTabContent.classList.remove('active');\r\n    } else {\r\n      if(animationFunction) {\r\n        onTransitionEndCallback = animationFunction(to, from, toRight);\r\n      } else {\r\n        to.classList.add('active');\r\n      }\r\n\r\n      to.classList.remove('from');\r\n      to.classList.add('to');\r\n    }\r\n\r\n    if(to) {\r\n      onTransitionEndCallbacks.set(to, () => {\r\n        to.classList.remove('to');\r\n        onTransitionEndCallbacks.delete(to);\r\n      });\r\n    }\r\n\r\n    if(from/*  && false */) {\r\n      let timeout: number;\r\n      const _from = from;\r\n      const callback = () => {\r\n        clearTimeout(timeout);\r\n        _from.classList.remove('active', 'from');\r\n\r\n        if(onTransitionEndCallback) {\r\n          onTransitionEndCallback?.();\r\n        }\r\n\r\n        onTransitionEndCallbacks.delete(_from);\r\n      };\r\n\r\n      if(to) {\r\n        timeout = window.setTimeout(callback, transitionTime + 100); // something happened to container\r\n        onTransitionEndCallbacks.set(_from, callback);\r\n      } else {\r\n        timeout = window.setTimeout(callback, transitionTime);\r\n        onTransitionEndCallbacks.set(_from, () => {\r\n          clearTimeout(timeout);\r\n          onTransitionEndCallbacks.delete(_from);\r\n        });\r\n      }\r\n\r\n      if(isHeavy) {\r\n        if(!animationDeferred) {\r\n          animationDeferred = deferredPromise<void>();\r\n          // animationStarted = performance.now();\r\n        }\r\n\r\n        dispatchHeavyAnimationEvent(animationDeferred, transitionTime * 2);\r\n      }\r\n    }\r\n\r\n    from = to;\r\n  }\r\n\r\n  // selectTab.prevId = -1;\r\n  selectTab.prevId = () => from ? whichChild(from) : -1;\r\n  selectTab.getFrom = () => from;\r\n  selectTab.setFrom = (_from: HTMLElement) => from = _from;\r\n\r\n  return selectTab;\r\n};\r\n\r\nexport default Transition;\r\n","export default function isUsernameValid(username: string) {\n  return ((username.length >= 5 && username.length <= 32) || !username.length) && /^[a-zA-Z0-9_]*$/.test(username);\n}\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport ListenerSetter from '../helpers/listenerSetter';\r\nimport debounce from '../helpers/schedulers/debounce';\r\nimport {LangPackKey} from '../lib/langPack';\r\nimport InputField, {InputFieldOptions, InputState} from './inputField';\r\nimport isUsernameValid from '../lib/richTextProcessor/isUsernameValid';\r\nimport {AppManagers} from '../lib/appManagers/managers';\r\n\r\nexport class UsernameInputField extends InputField {\r\n  private checkUsernamePromise: Promise<any>;\r\n  private checkUsernameDebounced: (username: string) => void;\r\n  public options: InputFieldOptions & {\r\n    peerId?: PeerId,\r\n    listenerSetter: ListenerSetter,\r\n    onChange?: () => void,\r\n    invalidText: LangPackKey,\r\n    takenText: LangPackKey,\r\n    availableText: LangPackKey,\r\n    head?: string\r\n  };\r\n\r\n  constructor(\r\n    options: UsernameInputField['options'],\r\n    private managers: AppManagers\r\n  ) {\r\n    super(options);\r\n\r\n    this.checkUsernameDebounced = debounce(this.checkUsername.bind(this), 150, false, true);\r\n\r\n    options.listenerSetter.add(this.input)('input', () => {\r\n      const value = this.getValue();\r\n\r\n      // console.log('userNameInput:', value);\r\n      if(value === this.originalValue || !value.length) {\r\n        this.setState(InputState.Neutral);\r\n        this.options.onChange && this.options.onChange();\r\n        return;\r\n      } else if(!isUsernameValid(value)) { // does not check the last underscore\r\n        this.setError(this.options.invalidText);\r\n      } else {\r\n        this.setState(InputState.Neutral);\r\n      }\r\n\r\n      if(this.input.classList.contains('error')) {\r\n        this.options.onChange && this.options.onChange();\r\n        return;\r\n      }\r\n\r\n      this.checkUsernameDebounced(value);\r\n    });\r\n  }\r\n\r\n  public getValue() {\r\n    let value = this.value;\r\n    if(this.options.head) {\r\n      value = value.slice(this.options.head.length);\r\n      this.setValueSilently(this.options.head + value);\r\n    }\r\n\r\n    return value;\r\n  }\r\n\r\n  private checkUsername(username: string) {\r\n    if(this.checkUsernamePromise) return;\r\n\r\n    if(this.options.peerId) {\r\n      this.checkUsernamePromise = this.managers.appChatsManager.checkUsername(this.options.peerId.toChatId(), username);\r\n    } else {\r\n      this.checkUsernamePromise = this.managers.appUsersManager.checkUsername(username);\r\n    }\r\n\r\n    this.checkUsernamePromise.then((available) => {\r\n      if(this.getValue() !== username) return;\r\n\r\n      if(available) {\r\n        this.setState(InputState.Valid, this.options.availableText);\r\n      } else {\r\n        this.setError(this.options.takenText);\r\n      }\r\n    }, (err) => {\r\n      if(this.getValue() !== username) return;\r\n\r\n      switch(err.type) {\r\n        case 'USERNAME_INVALID': {\r\n          this.setError(this.options.invalidText);\r\n          break;\r\n        }\r\n      }\r\n    }).then(() => {\r\n      this.checkUsernamePromise = undefined;\r\n      this.options.onChange && this.options.onChange();\r\n\r\n      const value = this.getValue();\r\n      if(value !== username && this.isValidToChange() && isUsernameValid(value)) {\r\n        this.checkUsername(value);\r\n      }\r\n    });\r\n  };\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\ntype TargetType = HTMLElement;\r\nexport type OnVisibilityChangeItem = {target: TargetType, visible: boolean, entry: IntersectionObserverEntry};\r\nexport type OnVisibilityChange = (item: OnVisibilityChangeItem) => void;\r\n\r\nexport default class VisibilityIntersector {\r\n  private observer: IntersectionObserver;\r\n  private items: Map<TargetType, boolean> = new Map();\r\n  private locked = false;\r\n\r\n  constructor(onVisibilityChange: OnVisibilityChange, options?: IntersectionObserverInit) {\r\n    this.observer = new IntersectionObserver((entries) => {\r\n      if(this.locked) {\r\n        return;\r\n      }\r\n\r\n      const changed: OnVisibilityChangeItem[] = [];\r\n\r\n      entries.forEach((entry) => {\r\n        const target = entry.target as TargetType;\r\n\r\n        if(this.items.get(target) === entry.isIntersecting) {\r\n          return;\r\n        } else {\r\n          this.items.set(target, entry.isIntersecting);\r\n        }\r\n\r\n        /* if(entry.isIntersecting) {\r\n          console.log('ooo', entry);\r\n        } */\r\n\r\n        /* if(this.locked) {\r\n          return;\r\n        } */\r\n\r\n        const change: typeof changed[0] = {target, visible: entry.isIntersecting, entry};\r\n\r\n        // ! order will be incorrect so can't use it\r\n        // changed[entry.isIntersecting ? 'unshift' : 'push'](change);\r\n        changed.push(change);\r\n\r\n        // onVisibilityChange(target, entry.isIntersecting);\r\n      });\r\n\r\n      changed.forEach((item) => {\r\n        onVisibilityChange(item);\r\n      });\r\n    }, options);\r\n  }\r\n\r\n  public getVisible() {\r\n    const items: TargetType[] = [];\r\n    this.items.forEach((value, key) => {\r\n      if(value) {\r\n        items.push(key);\r\n      }\r\n    });\r\n\r\n    return items;\r\n  }\r\n\r\n  public clearVisible() {\r\n    const visible = this.getVisible();\r\n    for(const target of visible) {\r\n      this.items.set(target, false);\r\n    }\r\n  }\r\n\r\n  public isVisible(target: TargetType) {\r\n    return this.items.get(target);\r\n  }\r\n\r\n  public disconnect() {\r\n    this.observer.disconnect();\r\n    this.items.clear();\r\n  }\r\n\r\n  public refresh() {\r\n    this.observer.disconnect();\r\n\r\n    // window.requestAnimationFrame(() => {\r\n    const targets = [...this.items.keys()];\r\n    for(const target of targets) {\r\n      // this.items.set(target, false);\r\n      this.observer.observe(target);\r\n    }\r\n    // });\r\n  }\r\n\r\n  public refreshVisible() {\r\n    const visible = this.getVisible();\r\n    for(const target of visible) {\r\n      this.observer.unobserve(target);\r\n    }\r\n\r\n    for(const target of visible) {\r\n      this.observer.observe(target);\r\n    }\r\n  }\r\n\r\n  public observe(target: TargetType) {\r\n    this.items.set(target, false);\r\n    this.observer.observe(target);\r\n  }\r\n\r\n  public unobserve(target: TargetType) {\r\n    this.observer.unobserve(target);\r\n    this.items.delete(target);\r\n  }\r\n\r\n  public unlock() {\r\n    this.locked = false;\r\n  }\r\n\r\n  public unlockAndRefresh() {\r\n    this.unlock();\r\n    this.refresh();\r\n  }\r\n\r\n  public lock() {\r\n    this.locked = true;\r\n  }\r\n}\r\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport cancelEvent from '../helpers/dom/cancelEvent';\nimport {attachClickEvent} from '../helpers/dom/clickEvent';\nimport ListenerSetter from '../helpers/listenerSetter';\nimport rootScope from '../lib/rootScope';\nimport appMediaPlaybackController from './appMediaPlaybackController';\nimport RangeSelector from './rangeSelector';\n\nexport default class VolumeSelector extends RangeSelector {\n  private static ICONS = ['volume_off', 'volume_mute', 'volume_down', 'volume_up'];\n  public btn: HTMLElement;\n  protected icon: HTMLSpanElement;\n\n  constructor(protected listenerSetter: ListenerSetter, protected vertical = false) {\n    super({\n      step: 0.01,\n      min: 0,\n      max: 1,\n      vertical\n    }, 1);\n\n    this.setListeners();\n    this.setHandlers({\n      onScrub: currentTime => {\n        const value = Math.max(Math.min(currentTime, 1), 0);\n\n        // console.log('volume scrub:', currentTime, value);\n\n        appMediaPlaybackController.muted = false;\n        appMediaPlaybackController.volume = value;\n      }\n\n      /* onMouseUp: (e) => {\n        cancelEvent(e.event);\n      } */\n    });\n\n    const className = 'player-volume';\n    const btn = this.btn = document.createElement('div');\n    btn.classList.add('btn-icon', className);\n    const icon = this.icon = document.createElement('span');\n    icon.classList.add(className + '__icon');\n\n    btn.append(icon, this.container);\n\n    attachClickEvent(icon, this.onMuteClick, {listenerSetter: this.listenerSetter});\n    this.listenerSetter.add(appMediaPlaybackController)('playbackParams', this.setVolume);\n\n    this.setVolume();\n  }\n\n  private onMuteClick = (e?: Event) => {\n    e && cancelEvent(e);\n    appMediaPlaybackController.muted = !appMediaPlaybackController.muted;\n  };\n\n  public setVolume = () => {\n    // const volume = video.volume;\n    const {volume, muted} = appMediaPlaybackController;\n    let d: string;\n    let iconIndex: number;\n    if(!volume || muted) {\n      iconIndex = 0;\n    } else if(volume > .5) {\n      iconIndex = 3;\n    } else if(volume > 0 && volume < .25) {\n      iconIndex = 1;\n    } else {\n      iconIndex = 2;\n    }\n\n    VolumeSelector.ICONS.forEach((icon) => this.icon.classList.remove('tgico-' + icon));\n    this.icon.classList.add('tgico-' + VolumeSelector.ICONS[iconIndex]);\n\n    if(!this.mousedown) {\n      this.setProgress(muted ? 0 : volume);\n    }\n  };\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport renderMediaWithFadeIn from '../../helpers/dom/renderMediaWithFadeIn';\nimport mediaSizes from '../../helpers/mediaSizes';\nimport {Message, PhotoSize, VideoSize, WebDocument} from '../../layer';\nimport {MyDocument} from '../../lib/appManagers/appDocsManager';\nimport {MyPhoto} from '../../lib/appManagers/appPhotosManager';\nimport rootScope from '../../lib/rootScope';\nimport LazyLoadQueue from '../lazyLoadQueue';\nimport ProgressivePreloader from '../preloader';\nimport blur from '../../helpers/blur';\nimport {AppManagers} from '../../lib/appManagers/managers';\nimport getStrippedThumbIfNeeded from '../../helpers/getStrippedThumbIfNeeded';\nimport setAttachmentSize from '../../helpers/setAttachmentSize';\nimport choosePhotoSize from '../../lib/appManagers/utils/photos/choosePhotoSize';\nimport type {ThumbCache} from '../../lib/storages/thumbs';\nimport appDownloadManager from '../../lib/appManagers/appDownloadManager';\nimport isWebDocument from '../../lib/appManagers/utils/webDocs/isWebDocument';\nimport createVideo from '../../helpers/dom/createVideo';\nimport noop from '../../helpers/noop';\nimport {THUMB_TYPE_FULL} from '../../lib/mtproto/mtproto_config';\n\nexport default async function wrapPhoto({photo, message, container, boxWidth, boxHeight, withTail, isOut, lazyLoadQueue, middleware, size, withoutPreloader, loadPromises, autoDownloadSize, noBlur, noThumb, noFadeIn, blurAfter, managers = rootScope.managers}: {\n  photo: MyPhoto | MyDocument | WebDocument,\n  message?: Message.message | Message.messageService,\n  container: HTMLElement,\n  boxWidth?: number,\n  boxHeight?: number,\n  withTail?: boolean,\n  isOut?: boolean,\n  lazyLoadQueue?: LazyLoadQueue,\n  middleware?: () => boolean,\n  size?: PhotoSize | VideoSize,\n  withoutPreloader?: boolean,\n  loadPromises?: Promise<any>[],\n  autoDownloadSize?: number,\n  noBlur?: boolean,\n  noThumb?: boolean,\n  noFadeIn?: boolean,\n  blurAfter?: boolean,\n  managers?: AppManagers,\n}) {\n  const ret = {\n    loadPromises: {\n      thumb: Promise.resolve() as Promise<any>,\n      full: Promise.resolve() as Promise<any>\n    },\n    images: {\n      thumb: null as HTMLImageElement | HTMLCanvasElement,\n      full: null as HTMLVideoElement | HTMLImageElement\n    },\n    preloader: null as ProgressivePreloader,\n    aspecter: null as HTMLElement\n  };\n\n  const isDocument = photo._ === 'document';\n  const isWebDoc = isWebDocument(photo);\n  if(!((photo as MyPhoto).sizes || (photo as MyDocument).thumbs) && !isWebDoc) {\n    if(boxWidth && boxHeight && !size && isDocument) {\n      setAttachmentSize(photo, container, boxWidth, boxHeight, undefined, message);\n    }\n\n    return ret;\n  }\n\n  let noAutoDownload = autoDownloadSize === 0;\n\n  if(!size) {\n    if(boxWidth === undefined) boxWidth = mediaSizes.active.regular.width;\n    if(boxHeight === undefined) boxHeight = mediaSizes.active.regular.height;\n  }\n\n  container.classList.add('media-container');\n  let aspecter = container;\n\n  let isFit = true;\n  let loadThumbPromise: Promise<any> = Promise.resolve();\n  let thumbImage: HTMLImageElement | HTMLCanvasElement;\n  // let image: HTMLImageElement;\n  let cacheContext: ThumbCache;\n  const isGif = isDocument && photo.mime_type === 'image/gif' && !size;\n  // if(withTail) {\n  //   image = wrapMediaWithTail(photo, message, container, boxWidth, boxHeight, isOut);\n  // } else {\n\n  if(boxWidth && boxHeight && !size) { // !album\n    const set = setAttachmentSize(photo, container, boxWidth, boxHeight, undefined, message, undefined, isGif ? {\n      _: 'photoSize',\n      w: photo.w,\n      h: photo.h,\n      size: photo.size,\n      type: THUMB_TYPE_FULL\n    } : undefined);\n    size = set.photoSize;\n    isFit = set.isFit;\n    cacheContext = await managers.thumbsStorage.getCacheContext(photo, size.type);\n\n    if(!isFit && !isWebDoc) {\n      aspecter = document.createElement('div');\n      aspecter.classList.add('media-container-aspecter');\n      aspecter.style.width = set.size.width + 'px';\n      aspecter.style.height = set.size.height + 'px';\n\n      const gotThumb = getStrippedThumbIfNeeded(photo, cacheContext, !noBlur, true);\n      if(gotThumb) {\n        loadThumbPromise = gotThumb.loadPromise;\n        const thumbImage = gotThumb.image; // local scope\n        thumbImage.classList.add('media-photo');\n        container.append(thumbImage);\n      } else {\n        const res = await wrapPhoto({\n          container,\n          message,\n          photo,\n          boxWidth: 0,\n          boxHeight: 0,\n          size,\n          lazyLoadQueue,\n          isOut,\n          loadPromises,\n          middleware,\n          withoutPreloader,\n          withTail,\n          autoDownloadSize,\n          noBlur,\n          noThumb: true,\n          blurAfter: true,\n          managers\n          // noFadeIn: true\n        });\n        const thumbImage = res.images.full;\n        thumbImage.classList.add('media-photo', 'thumbnail');\n        // container.append(thumbImage);\n      }\n\n      container.classList.add('media-container-fitted');\n      container.append(aspecter);\n    }\n  } else {\n    if(!size) {\n      size = choosePhotoSize(photo, boxWidth, boxHeight, true);\n    }\n\n    cacheContext = await managers.thumbsStorage.getCacheContext(photo, size?.type);\n  }\n\n  if(!noThumb && !isWebDoc) {\n    const gotThumb = getStrippedThumbIfNeeded(photo, cacheContext, !noBlur);\n    if(gotThumb) {\n      loadThumbPromise = Promise.all([loadThumbPromise, gotThumb.loadPromise]);\n      ret.loadPromises.thumb = ret.loadPromises.full = loadThumbPromise;\n      thumbImage = ret.images.thumb = gotThumb.image;\n      thumbImage.classList.add('media-photo');\n      aspecter.append(thumbImage);\n    }\n  }\n  // }\n\n  if(size?._ === 'photoSizeEmpty' && isDocument) {\n    return ret;\n  }\n\n  let media: HTMLVideoElement | HTMLImageElement;\n  if(size?._ === 'videoSize') {\n    media = ret.images.full = createVideo();\n    media.autoplay = true;\n    media.loop = true;\n    media.muted = true;\n    media.classList.add('media-photo');\n  } else {\n    media = ret.images.full = new Image();\n    media.classList.add('media-photo');\n  }\n\n  // console.log('wrapPhoto downloaded:', photo, photo.downloaded, container);\n\n  const needFadeIn = (thumbImage || !cacheContext.downloaded) && rootScope.settings.animationsEnabled && !noFadeIn;\n\n  let preloader: ProgressivePreloader;\n  const uploadingFileName = (message as Message.message)?.uploadingFileName;\n  if(!withoutPreloader) {\n    if(!cacheContext.downloaded || uploadingFileName) {\n      preloader = new ProgressivePreloader({\n        attachMethod: 'prepend',\n        isUpload: !!uploadingFileName\n      });\n    }\n\n    if(uploadingFileName) { // means upload\n      preloader.attachPromise(appDownloadManager.getUpload(uploadingFileName));\n      preloader.attach(container);\n      noAutoDownload = undefined;\n    }\n  }\n\n\n  const getDownloadPromise = () => {\n    // const promise = isGif && !size ?\n    //   managers.appDocsManager.downloadDoc(photo, /* undefined,  */lazyLoadQueue?.queueId) :\n    //   managers.appPhotosManager.preloadPhoto(photo, size, lazyLoadQueue?.queueId, noAutoDownload);\n    const haveToDownload = isGif && !size;\n    const promise = appDownloadManager.downloadMediaURL({\n      media: photo,\n      thumb: size,\n      queueId: lazyLoadQueue?.queueId,\n      onlyCache: haveToDownload ? undefined : noAutoDownload\n    });\n\n    return promise;\n  };\n\n  const renderOnLoad = (url: string) => {\n    return renderMediaWithFadeIn(container, media, url, needFadeIn, aspecter, thumbImage);\n  };\n\n  const onLoad = async(url: string) => {\n    if(middleware && !middleware()) return;\n\n    if(blurAfter) {\n      const result = blur(url, 12);\n      return result.promise.then(() => {\n        // image = result.canvas;\n        return renderOnLoad(result.canvas.toDataURL());\n      });\n    }\n\n    return renderOnLoad(url);\n  };\n\n  let loadPromise: Promise<any>;\n  const canAttachPreloader = (\n    (size as PhotoSize.photoSize).w >= 150 &&\n    (size as PhotoSize.photoSize).h >= 150\n  ) || noAutoDownload;\n  const load = async() => {\n    if(noAutoDownload && !withoutPreloader && preloader) {\n      preloader.construct();\n      preloader.setManual();\n    }\n\n    const promise = getDownloadPromise();\n    const cacheContext = await managers.thumbsStorage.getCacheContext(photo, size?.type);\n    if(\n      preloader &&\n      !cacheContext.downloaded &&\n      !withoutPreloader &&\n      canAttachPreloader\n    ) {\n      preloader.attach(container, false, promise);\n    }\n\n    noAutoDownload = undefined;\n\n    const renderPromise = promise.then(onLoad);\n    renderPromise.catch(noop);\n    return {download: promise, render: renderPromise};\n  };\n\n  if(preloader) {\n    preloader.setDownloadFunction(load);\n  }\n\n  if(cacheContext.downloaded) {\n    loadThumbPromise = loadPromise = (await load()).render;\n  } else {\n    if(!lazyLoadQueue) loadPromise = (await load()).render;\n    /* else if(noAutoDownload) {\n      preloader.construct();\n      preloader.setManual();\n      preloader.attach(container);\n    } */ else lazyLoadQueue.push({div: container, load: () => load().then(({download}) => download)});\n  }\n\n  if(loadPromises && loadThumbPromise) {\n    loadPromises.push(loadThumbPromise);\n  }\n\n  // const perf = performance.now();\n  await loadThumbPromise;\n  ret.loadPromises.thumb = loadThumbPromise;\n  ret.loadPromises.full = loadPromise || Promise.resolve();\n  ret.preloader = preloader;\n  ret.aspecter = aspecter;\n\n  // const elapsedTime = performance.now() - perf;\n  // if(elapsedTime > 4) {\n  //   console.log('wrapping photo thumb time', elapsedTime, photo, size);\n  // }\n\n  return ret;\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport {IS_SAFARI} from '../../environment/userAgent';\nimport {animateSingle} from '../../helpers/animation';\nimport {ChatAutoDownloadSettings} from '../../helpers/autoDownload';\nimport deferredPromise from '../../helpers/cancellablePromise';\nimport cancelEvent from '../../helpers/dom/cancelEvent';\nimport {attachClickEvent} from '../../helpers/dom/clickEvent';\nimport createVideo from '../../helpers/dom/createVideo';\nimport isInDOM from '../../helpers/dom/isInDOM';\nimport renderImageFromUrl from '../../helpers/dom/renderImageFromUrl';\nimport getStrippedThumbIfNeeded from '../../helpers/getStrippedThumbIfNeeded';\nimport mediaSizes, {ScreenSize} from '../../helpers/mediaSizes';\nimport noop from '../../helpers/noop';\nimport onMediaLoad from '../../helpers/onMediaLoad';\nimport {fastRaf} from '../../helpers/schedulers';\nimport throttle from '../../helpers/schedulers/throttle';\nimport sequentialDom from '../../helpers/sequentialDom';\nimport toHHMMSS from '../../helpers/string/toHHMMSS';\nimport {Message, PhotoSize, VideoSize} from '../../layer';\nimport {MyDocument} from '../../lib/appManagers/appDocsManager';\nimport appDownloadManager from '../../lib/appManagers/appDownloadManager';\nimport appImManager from '../../lib/appManagers/appImManager';\nimport {AppManagers} from '../../lib/appManagers/managers';\nimport {NULL_PEER_ID} from '../../lib/mtproto/mtproto_config';\nimport rootScope from '../../lib/rootScope';\nimport {ThumbCache} from '../../lib/storages/thumbs';\nimport animationIntersector, {AnimationItemGroup} from '../animationIntersector';\nimport appMediaPlaybackController, {MediaSearchContext} from '../appMediaPlaybackController';\nimport {findMediaTargets} from '../audio';\nimport LazyLoadQueue from '../lazyLoadQueue';\nimport ProgressivePreloader from '../preloader';\nimport wrapPhoto from './photo';\n\nconst MAX_VIDEO_AUTOPLAY_SIZE = 50 * 1024 * 1024; // 50 MB\n\nlet roundVideoCircumference = 0;\nmediaSizes.addEventListener('changeScreen', (from, to) => {\n  if(to === ScreenSize.mobile || from === ScreenSize.mobile) {\n    const elements = Array.from(document.querySelectorAll('.media-round .progress-ring')) as SVGSVGElement[];\n    const width = mediaSizes.active.round.width;\n    const halfSize = width / 2;\n    const radius = halfSize - 7;\n    roundVideoCircumference = 2 * Math.PI * radius;\n    elements.forEach((element) => {\n      element.setAttributeNS(null, 'width', '' + width);\n      element.setAttributeNS(null, 'height', '' + width);\n\n      const circle = element.firstElementChild as SVGCircleElement;\n      circle.setAttributeNS(null, 'cx', '' + halfSize);\n      circle.setAttributeNS(null, 'cy', '' + halfSize);\n      circle.setAttributeNS(null, 'r', '' + radius);\n\n      circle.style.strokeDasharray = roundVideoCircumference + ' ' + roundVideoCircumference;\n      circle.style.strokeDashoffset = '' + roundVideoCircumference;\n    });\n  }\n});\n\nexport default async function wrapVideo({doc, container, message, boxWidth, boxHeight, withTail, isOut, middleware, lazyLoadQueue, noInfo, group, onlyPreview, noPreview, withoutPreloader, loadPromises, noPlayButton, photoSize, videoSize, searchContext, autoDownload, managers = rootScope.managers}: {\n  doc: MyDocument,\n  container?: HTMLElement,\n  message?: Message.message,\n  boxWidth?: number,\n  boxHeight?: number,\n  withTail?: boolean,\n  isOut?: boolean,\n  middleware?: () => boolean,\n  lazyLoadQueue?: LazyLoadQueue,\n  noInfo?: boolean,\n  noPlayButton?: boolean,\n  group?: AnimationItemGroup,\n  onlyPreview?: boolean,\n  noPreview?: boolean,\n  withoutPreloader?: boolean,\n  loadPromises?: Promise<any>[],\n  autoDownload?: ChatAutoDownloadSettings,\n  photoSize?: PhotoSize,\n  videoSize?: VideoSize,\n  searchContext?: MediaSearchContext,\n  managers?: AppManagers\n}) {\n  const autoDownloadSize = autoDownload?.video;\n  let noAutoDownload = autoDownloadSize === 0;\n  const isAlbumItem = !(boxWidth && boxHeight);\n  const canAutoplay = /* doc.sticker ||  */(\n    (\n      doc.type !== 'video' || (\n        doc.size <= MAX_VIDEO_AUTOPLAY_SIZE &&\n        !isAlbumItem\n      )\n    ) && (doc.type === 'gif' ? rootScope.settings.autoPlay.gifs : rootScope.settings.autoPlay.videos)\n  );\n  let spanTime: HTMLElement, spanPlay: HTMLElement;\n\n  if(!noInfo) {\n    spanTime = document.createElement('span');\n    spanTime.classList.add('video-time');\n    container.append(spanTime);\n\n    let needPlayButton = false;\n    if(doc.type !== 'gif') {\n      spanTime.innerText = toHHMMSS(doc.duration, false);\n\n      if(!noPlayButton && doc.type !== 'round') {\n        if(canAutoplay && !noAutoDownload) {\n          spanTime.classList.add('tgico', 'can-autoplay');\n        } else {\n          needPlayButton = true;\n        }\n      }\n    } else {\n      spanTime.innerText = 'GIF';\n\n      if(!canAutoplay && !noPlayButton) {\n        needPlayButton = true;\n        noAutoDownload = undefined;\n      }\n    }\n\n    if(needPlayButton) {\n      spanPlay = document.createElement('span');\n      spanPlay.classList.add('video-play', 'tgico-largeplay', 'btn-circle', 'position-center');\n      container.append(spanPlay);\n    }\n  }\n\n  const res: {\n    thumb?: typeof photoRes,\n    loadPromise: Promise<any>\n  } = {} as any;\n\n  if(doc.mime_type === 'image/gif') {\n    const photoRes = await wrapPhoto({\n      photo: doc,\n      message,\n      container,\n      boxWidth,\n      boxHeight,\n      withTail,\n      isOut,\n      lazyLoadQueue,\n      middleware,\n      withoutPreloader,\n      loadPromises,\n      autoDownloadSize,\n      size: photoSize,\n      managers\n    });\n\n    res.thumb = photoRes;\n    res.loadPromise = photoRes.loadPromises.full;\n    return res;\n  }\n\n  /* const video = doc.type === 'round' ? appMediaPlaybackController.addMedia(doc, message.mid) as HTMLVideoElement : document.createElement('video');\n  if(video.parentElement) {\n    video.remove();\n  } */\n\n  let preloader: ProgressivePreloader; // it must be here, otherwise will get error before initialization in round onPlay\n\n  const video = createVideo();\n  video.classList.add('media-video');\n  video.muted = true;\n  if(doc.type === 'round') {\n    const divRound = document.createElement('div');\n    divRound.classList.add('media-round', 'z-depth-1');\n    divRound.dataset.mid = '' + message.mid;\n    divRound.dataset.peerId = '' + message.peerId;\n    (divRound as any).message = message;\n\n    const size = mediaSizes.active.round;\n    const halfSize = size.width / 2;\n    const strokeWidth = 3.5;\n    const radius = halfSize - (strokeWidth * 2);\n    divRound.innerHTML = `<svg class=\"progress-ring\" width=\"${size.width}\" height=\"${size.width}\" style=\"transform: rotate(-90deg);\">\n      <circle class=\"progress-ring__circle\" stroke=\"white\" stroke-opacity=\"0.3\" stroke-width=\"${strokeWidth}\" cx=\"${halfSize}\" cy=\"${halfSize}\" r=\"${radius}\" fill=\"transparent\"/>\n    </svg>`;\n\n    const circle = divRound.firstElementChild.firstElementChild as SVGCircleElement;\n    if(!roundVideoCircumference) {\n      roundVideoCircumference = 2 * Math.PI * radius;\n    }\n    circle.style.strokeDasharray = roundVideoCircumference + ' ' + roundVideoCircumference;\n    circle.style.strokeDashoffset = '' + roundVideoCircumference;\n\n    spanTime.classList.add('tgico');\n\n    const isUnread = message.pFlags.media_unread;\n    if(isUnread) {\n      divRound.classList.add('is-unread');\n    }\n\n    const canvas = document.createElement('canvas');\n    canvas.width = canvas.height = doc.w/*  * window.devicePixelRatio */;\n\n    divRound.prepend(canvas, spanTime);\n    divRound.append(video);\n    container.append(divRound);\n\n    const ctx = canvas.getContext('2d');\n    /* ctx.beginPath();\n    ctx.arc(canvas.width / 2, canvas.height / 2, canvas.width / 2, 0, Math.PI * 2);\n    ctx.clip(); */\n\n    const onLoad = () => {\n      const message: Message.message = (divRound as any).message;\n      const globalVideo = appMediaPlaybackController.addMedia(message, !noAutoDownload) as HTMLVideoElement;\n      const clear = () => {\n        (appImManager.chat.setPeerPromise || Promise.resolve()).finally(() => {\n          if(isInDOM(globalVideo)) {\n            return;\n          }\n\n          globalVideo.removeEventListener('play', onPlay);\n          globalVideo.removeEventListener('timeupdate', throttledTimeUpdate);\n          globalVideo.removeEventListener('pause', onPaused);\n          globalVideo.removeEventListener('ended', onEnded);\n        });\n      };\n\n      const onFrame = () => {\n        ctx.drawImage(globalVideo, 0, 0);\n\n        const offset = roundVideoCircumference - globalVideo.currentTime / globalVideo.duration * roundVideoCircumference;\n        circle.style.strokeDashoffset = '' + offset;\n\n        return !globalVideo.paused;\n      };\n\n      const onTimeUpdate = () => {\n        if(!globalVideo.duration) {\n          return;\n        }\n\n        if(!isInDOM(globalVideo)) {\n          clear();\n          return;\n        }\n\n        if(globalVideo.paused) {\n          onFrame();\n        }\n\n        spanTime.innerText = toHHMMSS(globalVideo.duration - globalVideo.currentTime, false);\n      };\n\n      const throttledTimeUpdate = throttle(() => {\n        fastRaf(onTimeUpdate);\n      }, 1000, false);\n\n      const onPlay = () => {\n        video.classList.add('hide');\n        divRound.classList.remove('is-paused');\n        animateSingle(onFrame, canvas);\n\n        if(preloader && preloader.preloader && preloader.preloader.classList.contains('manual')) {\n          preloader.onClick();\n        }\n      };\n\n      const onPaused = () => {\n        if(!isInDOM(globalVideo)) {\n          clear();\n          return;\n        }\n\n        divRound.classList.add('is-paused');\n      };\n\n      const onEnded = () => {\n        video.classList.remove('hide');\n        divRound.classList.add('is-paused');\n\n        video.currentTime = 0;\n        spanTime.innerText = toHHMMSS(globalVideo.duration, false);\n\n        if(globalVideo.currentTime) {\n          globalVideo.currentTime = 0;\n        }\n      };\n\n      globalVideo.addEventListener('play', onPlay);\n      globalVideo.addEventListener('timeupdate', throttledTimeUpdate);\n      globalVideo.addEventListener('pause', onPaused);\n      globalVideo.addEventListener('ended', onEnded);\n\n      attachClickEvent(canvas, (e) => {\n        cancelEvent(e);\n\n        // ! \n        if(preloader && !preloader.detached) {\n          preloader.onClick();\n        }\n\n        // ! can't use it here. on Safari iOS video won't start.\n        /* if(globalVideo.readyState < 2) {\n          return;\n        } */\n\n        if(globalVideo.paused) {\n          const hadSearchContext = !!searchContext;\n          if(appMediaPlaybackController.setSearchContext(searchContext || {\n            peerId: NULL_PEER_ID,\n            inputFilter: {_: 'inputMessagesFilterEmpty'},\n            useSearch: false\n          })) {\n            const [prev, next] = !hadSearchContext ? [] : findMediaTargets(divRound, message.mid/* , searchContext.useSearch */);\n            appMediaPlaybackController.setTargets({peerId: message.peerId, mid: message.mid}, prev, next);\n          }\n\n          globalVideo.play();\n        } else {\n          globalVideo.pause();\n        }\n      });\n\n      if(globalVideo.paused) {\n        if(globalVideo.duration && globalVideo.currentTime !== globalVideo.duration && globalVideo.currentTime > 0) {\n          onFrame();\n          onTimeUpdate();\n          video.classList.add('hide');\n        } else {\n          onPaused();\n        }\n      } else {\n        onPlay();\n      }\n    };\n\n    if(message.pFlags.is_outgoing) {\n      (divRound as any).onLoad = onLoad;\n      divRound.dataset.isOutgoing = '1';\n    } else {\n      onLoad();\n    }\n  } else {\n    video.autoplay = true; //  safari\n  }\n\n  let photoRes: Awaited<ReturnType<typeof wrapPhoto>>;\n  if(message) {\n    photoRes = await wrapPhoto({\n      photo: doc,\n      message,\n      container,\n      boxWidth,\n      boxHeight,\n      withTail,\n      isOut,\n      lazyLoadQueue,\n      middleware,\n      withoutPreloader: true,\n      loadPromises,\n      autoDownloadSize: autoDownload?.photo,\n      size: photoSize,\n      managers\n    });\n\n    res.thumb = photoRes;\n\n    if((!canAutoplay && doc.type !== 'gif') || onlyPreview) {\n      res.loadPromise = photoRes.loadPromises.full;\n      return res;\n    }\n\n    if(withTail) {\n      const foreignObject = (photoRes.images.thumb || photoRes.images.full).parentElement;\n      video.width = +foreignObject.getAttributeNS(null, 'width');\n      video.height = +foreignObject.getAttributeNS(null, 'height');\n      foreignObject.append(video);\n    }\n  } else if(!noPreview) { // * gifs masonry\n    const gotThumb = getStrippedThumbIfNeeded(doc, {} as ThumbCache, true);\n    if(gotThumb) {\n      const thumbImage = gotThumb.image;\n      thumbImage.classList.add('media-poster');\n      container.append(thumbImage);\n      res.thumb = {\n        loadPromises: {\n          thumb: gotThumb.loadPromise,\n          full: Promise.resolve()\n        },\n        images: {\n          thumb: thumbImage,\n          full: null\n        },\n        preloader: null,\n        aspecter: null\n      };\n\n      loadPromises?.push(gotThumb.loadPromise);\n      res.loadPromise = gotThumb.loadPromise;\n    }\n  }\n\n  if(onlyPreview) {\n    return res;\n  }\n\n  if(!video.parentElement && container) {\n    (photoRes?.aspecter || container).append(video);\n  }\n\n  let cacheContext: ThumbCache;\n  const getCacheContext = async() => {\n    return cacheContext = await managers.thumbsStorage.getCacheContext(doc, videoSize?.type);\n  };\n\n  await getCacheContext();\n\n  const uploadFileName = message?.uploadingFileName;\n  if(uploadFileName) { // means upload\n    preloader = new ProgressivePreloader({\n      attachMethod: 'prepend',\n      isUpload: true\n    });\n    preloader.attachPromise(appDownloadManager.getUpload(uploadFileName));\n    preloader.attach(container, false);\n    noAutoDownload = undefined;\n  } else if(!cacheContext.downloaded && !doc.supportsStreaming && !withoutPreloader) {\n    preloader = new ProgressivePreloader({\n      attachMethod: 'prepend'\n    });\n  } else if(doc.supportsStreaming) {\n    preloader = new ProgressivePreloader({\n      cancelable: false,\n      attachMethod: 'prepend'\n    });\n  }\n\n  const renderDeferred = deferredPromise<void>();\n  video.addEventListener('error', (e) => {\n    if(video.error.code !== 4) {\n      console.error('Error ' + video.error.code + '; details: ' + video.error.message);\n    }\n\n    if(preloader && !uploadFileName) {\n      preloader.detach();\n    }\n\n    if(!renderDeferred.isFulfilled) {\n      renderDeferred.resolve();\n    }\n  }, {once: true});\n\n  if(doc.type === 'video') {\n    const onTimeUpdate = () => {\n      if(!video.duration) {\n        return;\n      }\n\n      spanTime.innerText = toHHMMSS(video.duration - video.currentTime, false);\n    };\n\n    const throttledTimeUpdate = throttle(() => {\n      fastRaf(onTimeUpdate);\n    }, 1e3, false);\n\n    video.addEventListener('timeupdate', throttledTimeUpdate);\n\n    if(spanPlay) {\n      video.addEventListener('timeupdate', () => {\n        sequentialDom.mutateElement(spanPlay, () => {\n          spanPlay.remove();\n        });\n      }, {once: true});\n    }\n  }\n\n  video.muted = true;\n  video.loop = true;\n  // video.play();\n  video.autoplay = true;\n\n  let loadPhotoThumbFunc = noAutoDownload && photoRes?.preloader?.loadFunc;\n  const load = async() => {\n    if(preloader && noAutoDownload && !withoutPreloader) {\n      preloader.construct();\n      preloader.setManual();\n    }\n\n    await getCacheContext();\n    let loadPromise: Promise<any> = Promise.resolve();\n    if((preloader && !uploadFileName) || withoutPreloader) {\n      if(!cacheContext.downloaded && !doc.supportsStreaming) {\n        const promise = loadPromise = appDownloadManager.downloadMediaURL({\n          media: doc,\n          queueId: lazyLoadQueue?.queueId,\n          onlyCache: noAutoDownload,\n          thumb: videoSize\n        });\n\n        if(preloader) {\n          preloader.attach(container, false, promise);\n        }\n      } else if(doc.supportsStreaming) {\n        if(noAutoDownload) {\n          loadPromise = Promise.reject();\n        } else if(!cacheContext.downloaded && preloader) { // * check for uploading video\n          preloader.attach(container, false, null);\n          video.addEventListener(IS_SAFARI ? 'timeupdate' : 'canplay', () => {\n            preloader.detach();\n          }, {once: true});\n        }\n      }\n    }\n\n    if(!noAutoDownload && loadPhotoThumbFunc) {\n      loadPhotoThumbFunc();\n      loadPhotoThumbFunc = null;\n    }\n\n    noAutoDownload = undefined;\n\n    loadPromise.then(async() => {\n      if(middleware && !middleware()) {\n        renderDeferred.resolve();\n        return;\n      }\n\n      if(doc.type === 'round') {\n        appMediaPlaybackController.resolveWaitingForLoadMedia(message.peerId, message.mid, message.pFlags.is_scheduled);\n      }\n\n      await getCacheContext();\n\n      onMediaLoad(video).then(() => {\n        if(group) {\n          animationIntersector.addAnimation(video, group);\n        }\n\n        if(preloader && !uploadFileName) {\n          preloader.detach();\n        }\n\n        renderDeferred.resolve();\n      });\n\n      renderImageFromUrl(video, cacheContext.url);\n    }, noop);\n\n    return {download: loadPromise, render: renderDeferred};\n  };\n\n  if(preloader && !uploadFileName) {\n    preloader.setDownloadFunction(load);\n  }\n\n  /* if(doc.size >= 20e6 && !doc.downloaded) {\n    let downloadDiv = document.createElement('div');\n    downloadDiv.classList.add('download');\n\n    let span = document.createElement('span');\n    span.classList.add('btn-circle', 'tgico-download');\n    downloadDiv.append(span);\n\n    downloadDiv.addEventListener('click', () => {\n      downloadDiv.remove();\n      loadVideo();\n    });\n\n    container.prepend(downloadDiv);\n\n    return;\n  } */\n\n  if(doc.type === 'gif' && !canAutoplay) {\n    attachClickEvent(container, (e) => {\n      cancelEvent(e);\n      spanPlay.remove();\n      load();\n    }, {capture: true, once: true});\n  } else {\n    res.loadPromise = !lazyLoadQueue ?\n      (await load()).render :\n      (lazyLoadQueue.push({div: container, load: () => load().then(({render}) => render)}), Promise.resolve());\n  }\n\n  if(res.thumb) {\n    await res.thumb.loadPromises.thumb;\n  }\n\n  return res;\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport {ChatAutoDownloadSettings} from '../../helpers/autoDownload';\nimport mediaSizes from '../../helpers/mediaSizes';\nimport {Message, PhotoSize} from '../../layer';\nimport {AppManagers} from '../../lib/appManagers/managers';\nimport getMediaFromMessage from '../../lib/appManagers/utils/messages/getMediaFromMessage';\nimport choosePhotoSize from '../../lib/appManagers/utils/photos/choosePhotoSize';\nimport rootScope from '../../lib/rootScope';\nimport Chat from '../chat/chat';\nimport LazyLoadQueue from '../lazyLoadQueue';\nimport prepareAlbum from '../prepareAlbum';\nimport wrapPhoto from './photo';\nimport wrapVideo from './video';\n\nexport default function wrapAlbum({messages, attachmentDiv, middleware, uploading, lazyLoadQueue, isOut, chat, loadPromises, autoDownload, managers = rootScope.managers}: {\n  messages: Message.message[],\n  attachmentDiv: HTMLElement,\n  middleware?: () => boolean,\n  lazyLoadQueue?: LazyLoadQueue,\n  uploading?: boolean,\n  isOut: boolean,\n  chat: Chat,\n  loadPromises?: Promise<any>[],\n  autoDownload?: ChatAutoDownloadSettings,\n  managers?: AppManagers\n}) {\n  const items: {size: PhotoSize.photoSize, media: any, message: any}[] = [];\n\n  // !lowest msgID will be the FIRST in album\n  for(const message of messages) {\n    const media = getMediaFromMessage(message);\n\n    const size: any = media._ === 'photo' ? choosePhotoSize(media, 480, 480) : {w: media.w, h: media.h};\n    items.push({size, media, message});\n  }\n\n  /* // * pending\n  if(storage[0] < 0) {\n    items.reverse();\n  } */\n\n  prepareAlbum({\n    container: attachmentDiv,\n    items: items.map((i) => ({w: i.size.w, h: i.size.h})),\n    maxWidth: mediaSizes.active.album.width,\n    minWidth: 100,\n    spacing: 2,\n    forMedia: true\n  });\n\n  items.forEach((item, idx) => {\n    const {size, media, message} = item;\n\n    const div = attachmentDiv.children[idx] as HTMLElement;\n    div.dataset.mid = '' + message.mid;\n    div.dataset.peerId = '' + message.peerId;\n    const mediaDiv = div.firstElementChild as HTMLElement;\n    const isPhoto = media._ === 'photo';\n    let thumbPromise: Promise<any>;\n    if(isPhoto) {\n      thumbPromise = wrapPhoto({\n        photo: media,\n        message,\n        container: mediaDiv,\n        boxWidth: 0,\n        boxHeight: 0,\n        isOut,\n        lazyLoadQueue,\n        middleware,\n        size,\n        loadPromises,\n        autoDownloadSize: autoDownload.photo,\n        managers\n      });\n    } else {\n      thumbPromise = wrapVideo({\n        doc: message.media.document,\n        container: mediaDiv,\n        message,\n        boxWidth: 0,\n        boxHeight: 0,\n        withTail: false,\n        isOut,\n        lazyLoadQueue,\n        middleware,\n        loadPromises,\n        autoDownload,\n        managers\n      });\n    }\n\n    if(thumbPromise && loadPromises) {\n      loadPromises.push(thumbPromise);\n    }\n  });\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport MEDIA_MIME_TYPES_SUPPORTED from '../../environment/mediaMimeTypesSupport';\nimport {CancellablePromise} from '../../helpers/cancellablePromise';\nimport {clearBadCharsAndTrim} from '../../helpers/cleanSearchText';\nimport {formatFullSentTime} from '../../helpers/date';\nimport {simulateClickEvent, attachClickEvent} from '../../helpers/dom/clickEvent';\nimport replaceContent from '../../helpers/dom/replaceContent';\nimport formatBytes from '../../helpers/formatBytes';\nimport {MediaSizeType} from '../../helpers/mediaSizes';\nimport noop from '../../helpers/noop';\nimport {Message, MessageMedia, WebPage} from '../../layer';\nimport {MyDocument} from '../../lib/appManagers/appDocsManager';\nimport appDownloadManager, {Progress} from '../../lib/appManagers/appDownloadManager';\nimport appImManager from '../../lib/appManagers/appImManager';\nimport {AppManagers} from '../../lib/appManagers/managers';\nimport getDownloadMediaDetails from '../../lib/appManagers/utils/download/getDownloadMediaDetails';\nimport choosePhotoSize from '../../lib/appManagers/utils/photos/choosePhotoSize';\nimport {joinElementsWith} from '../../lib/langPack';\nimport {MAX_FILE_SAVE_SIZE} from '../../lib/mtproto/mtproto_config';\nimport wrapPlainText from '../../lib/richTextProcessor/wrapPlainText';\nimport rootScope from '../../lib/rootScope';\nimport type {ThumbCache} from '../../lib/storages/thumbs';\nimport {MediaSearchContext} from '../appMediaPlaybackController';\nimport AudioElement from '../audio';\nimport LazyLoadQueue from '../lazyLoadQueue';\nimport {MiddleEllipsisElement} from '../middleEllipsis';\nimport ProgressivePreloader from '../preloader';\nimport wrapPhoto from './photo';\nimport wrapSenderToPeer from './senderToPeer';\nimport wrapSentTime from './sentTime';\n\nrootScope.addEventListener('document_downloading', (docId) => {\n  const elements = Array.from(document.querySelectorAll(`.document[data-doc-id=\"${docId}\"]`)) as HTMLElement[];\n  elements.forEach((element) => {\n    if(element.querySelector('.preloader-container.manual')) {\n      simulateClickEvent(element);\n    }\n  });\n});\n\nexport default async function wrapDocument({message, withTime, fontWeight, voiceAsMusic, showSender, searchContext, loadPromises, autoDownloadSize, lazyLoadQueue, sizeType, managers = rootScope.managers, cacheContext}: {\n  message: Message.message,\n  withTime?: boolean,\n  fontWeight?: number,\n  voiceAsMusic?: boolean,\n  showSender?: boolean,\n  searchContext?: MediaSearchContext,\n  loadPromises?: Promise<any>[],\n  autoDownloadSize?: number,\n  lazyLoadQueue?: LazyLoadQueue,\n  sizeType?: MediaSizeType,\n  managers?: AppManagers,\n  cacheContext?: ThumbCache\n}): Promise<HTMLElement> {\n  if(!fontWeight) fontWeight = 500;\n  if(!sizeType) sizeType = '' as any;\n  const noAutoDownload = autoDownloadSize === 0;\n\n  const doc = ((message.media as MessageMedia.messageMediaDocument).document || ((message.media as MessageMedia.messageMediaWebPage).webpage as WebPage.webPage).document) as MyDocument;\n  const uploadFileName = message?.uploadingFileName;\n  if(doc.type === 'audio' || doc.type === 'voice' || doc.type === 'round') {\n    const audioElement = new AudioElement();\n    audioElement.withTime = withTime;\n    audioElement.message = message;\n    audioElement.noAutoDownload = noAutoDownload;\n    audioElement.lazyLoadQueue = lazyLoadQueue;\n    audioElement.loadPromises = loadPromises;\n\n    if(voiceAsMusic) audioElement.voiceAsMusic = voiceAsMusic;\n    if(searchContext) audioElement.searchContext = searchContext;\n    if(showSender) audioElement.showSender = showSender;\n\n    audioElement.dataset.fontWeight = '' + fontWeight;\n    audioElement.dataset.sizeType = sizeType;\n    await audioElement.render();\n    return audioElement;\n  }\n\n  const extSplitted = doc.file_name ? doc.file_name.split('.') : '';\n  let ext = '';\n  ext = extSplitted.length > 1 && Array.isArray(extSplitted) ?\n    clearBadCharsAndTrim(extSplitted.pop().split(' ', 1)[0].toLowerCase()) :\n    'file';\n\n  const docDiv = document.createElement('div');\n  docDiv.classList.add('document', `ext-${ext}`);\n  docDiv.dataset.docId = '' + doc.id;\n  (docDiv as any).doc = doc;\n\n  // return docDiv;\n\n  const icoDiv = document.createElement('div');\n  icoDiv.classList.add('document-ico');\n  let icoTextEl: HTMLElement;\n\n  const hadContext = !!cacheContext;\n  const getCacheContext = () => {\n    return hadContext ? cacheContext : managers.thumbsStorage.getCacheContext(doc);\n  };\n\n  cacheContext = await getCacheContext();\n  let hasThumb = false;\n  if((doc.thumbs?.length || (message.pFlags.is_outgoing && cacheContext.url && doc.type === 'photo'))/*  && doc.mime_type !== 'image/gif' */) {\n    docDiv.classList.add('document-with-thumb');\n    hasThumb = true;\n\n    const imgs: (HTMLImageElement | HTMLCanvasElement | HTMLVideoElement)[] = [];\n    // ! WARNING, use thumbs for check when thumb will be generated for media\n    if(message.pFlags.is_outgoing && ['photo', 'video'].includes(doc.type)) {\n      icoDiv.innerHTML = `<img src=\"${cacheContext.url}\">`;\n      imgs.push(icoDiv.firstElementChild as HTMLImageElement);\n    } else {\n      const perf = performance.now();\n      const wrapped = await wrapPhoto({\n        photo: doc,\n        message: null,\n        container: icoDiv,\n        boxWidth: 54,\n        boxHeight: 54,\n        loadPromises,\n        withoutPreloader: true,\n        lazyLoadQueue,\n        size: choosePhotoSize(doc, 54, 54, true),\n        managers\n      });\n      // console.log('was wrapping photo', performance.now() - perf);\n      icoDiv.style.width = icoDiv.style.height = '';\n      if(wrapped.images.thumb) imgs.push(wrapped.images.thumb);\n      if(wrapped.images.full) imgs.push(wrapped.images.full);\n    }\n\n    imgs.forEach((img) => img.classList.add('document-thumb'));\n  } else {\n    icoTextEl = document.createElement('span');\n    icoTextEl.classList.add('document-ico-text');\n    icoTextEl.innerText = ext;\n    icoDiv.append(icoTextEl);\n  }\n\n  // let fileName = stringMiddleOverflow(doc.file_name || 'Unknown.file', 26);\n  const fileName = doc.file_name ? wrapPlainText(doc.file_name) : 'Unknown.file';\n  const descriptionEl = document.createElement('div');\n  descriptionEl.classList.add('document-description');\n  const bytesContainer = document.createElement('span');\n  const bytesEl = formatBytes(doc.size);\n  const bytesJoiner = ' / ';\n\n  const descriptionParts: (HTMLElement | string | DocumentFragment)[] = [bytesEl];\n\n  if(withTime) {\n    descriptionParts.push(formatFullSentTime(message.date));\n  }\n\n  if(showSender) {\n    descriptionParts.push(await wrapSenderToPeer(message));\n  }\n\n  if(!withTime && !showSender) {\n    const b = document.createElement('span');\n    const bytesMaxEl = formatBytes(doc.size);\n    b.append(bytesJoiner, bytesMaxEl);\n    b.style.visibility = 'hidden';\n    descriptionParts.push(b);\n  }\n\n  docDiv.innerHTML = `\n  ${(cacheContext.downloaded && !uploadFileName) || !message.mid || !hasThumb ? '' : `<div class=\"document-download\"></div>`}\n  <div class=\"document-name\"></div>\n  <div class=\"document-size\"></div>\n  `;\n\n  const nameDiv = docDiv.querySelector('.document-name') as HTMLElement;\n  const middleEllipsisEl = new MiddleEllipsisElement();\n  middleEllipsisEl.dataset.fontWeight = '' + fontWeight;\n  middleEllipsisEl.dataset.sizeType = sizeType;\n  middleEllipsisEl.textContent = fileName;\n  // setInnerHTML(middleEllipsisEl, fileName);\n\n  // * new media popup\n  if(!message.mid) {\n    docDiv.classList.add('downloaded');\n  }\n\n  nameDiv.append(middleEllipsisEl);\n\n  if(showSender) {\n    nameDiv.append(wrapSentTime(message));\n  }\n\n  const sizeDiv = docDiv.querySelector('.document-size') as HTMLElement;\n  bytesContainer.append(...joinElementsWith(descriptionParts, '  '));\n  sizeDiv.append(bytesContainer);\n\n  docDiv.prepend(icoDiv);\n\n  if(!uploadFileName && message.pFlags.is_outgoing && !message.mid) {\n    return docDiv;\n  }\n\n  let downloadDiv: HTMLElement, preloader: ProgressivePreloader = null;\n  const onLoad = () => {\n    docDiv.classList.remove('downloading');\n\n    if(/* !hasThumb ||  */(doc.size > MAX_FILE_SAVE_SIZE && !uploadFileName)) {\n      preloader.setManual();\n      preloader.attach(downloadDiv);\n      preloader.preloader.classList.add('manual');\n      preloader.setDownloadFunction(load);\n      return;\n    }\n\n    if(doc.size <= MAX_FILE_SAVE_SIZE) {\n      docDiv.classList.add('downloaded');\n    }\n\n    if(downloadDiv) {\n      if(downloadDiv !== icoDiv) {\n        const _downloadDiv = downloadDiv;\n        setTimeout(() => {\n          _downloadDiv.remove();\n        }, 200);\n      }\n\n      downloadDiv = null;\n    }\n\n    if(preloader) {\n      preloader = null;\n    }\n  };\n\n  const addByteProgress = (promise: CancellablePromise<any>) => {\n    docDiv.classList.add('downloading');\n\n    const sizeContainer = document.createElement('span');\n    const _bytesContainer = formatBytes(doc.size);\n    sizeContainer.style.position = 'absolute';\n    sizeContainer.style.left = '0';\n    promise.then(onLoad, noop).finally(() => {\n      // sizeContainer.replaceWith(bytesContainer);\n      bytesContainer.style.visibility = '';\n      sizeContainer.remove();\n      // b && b.classList.remove('hide');\n    });\n\n    // b && b.classList.add('hide');\n\n    const format = (bytes: number) => formatBytes(bytes);\n    let d = format(0);\n    bytesContainer.style.visibility = 'hidden';\n    // bytesContainer.replaceWith(sizeContainer);\n    sizeContainer.append(d, bytesJoiner, _bytesContainer);\n    bytesContainer.parentElement.append(sizeContainer);\n    promise.addNotifyListener((progress: Progress) => {\n      const _d = format(progress.done);\n      d.replaceWith(_d);\n      d = _d;\n    });\n  };\n\n  // ! DO NOT USE ASYNC/AWAIT HERE ! SAFARI WON'T LET DOWNLOAD THE FILE BECAUSE OF ASYNC\n  const load = (e?: Event) => {\n    const save = !e || e.isTrusted;\n    const doc = (docDiv as any).doc;\n    // const doc = await managers.appDocsManager.getDoc(docDiv.dataset.docId);\n    let download: CancellablePromise<any>;\n    const queueId = appImManager.chat.bubbles ? appImManager.chat.bubbles.lazyLoadQueue.queueId : undefined;\n    if(!save) {\n      download = appDownloadManager.downloadToDisc({media: doc, queueId}, true);\n    } else if(doc.type === 'pdf') {\n      const canOpenAfter = /* managers.appDocsManager.downloading.has(doc.id) ||  */!preloader || preloader.detached;\n      download = appDownloadManager.downloadMediaURL({media: doc, queueId});\n      if(canOpenAfter) {\n        download.then(() => {\n          setTimeout(async() => { // wait for preloader animation end\n            const url = (await getCacheContext()).url;\n            window.open(url);\n          }, rootScope.settings.animationsEnabled ? 250 : 0);\n        });\n      }\n    } else if(MEDIA_MIME_TYPES_SUPPORTED.has(doc.mime_type) && doc.thumbs?.length) {\n      download = appDownloadManager.downloadMediaURL({media: doc, queueId});\n    } else {\n      download = appDownloadManager.downloadToDisc({media: doc, queueId});\n    }\n\n    download.catch(() => {\n      docDiv.classList.remove('downloading');\n    });\n\n    if(downloadDiv) {\n      preloader.attach(downloadDiv, true, download);\n      addByteProgress(download);\n    }\n  };\n\n  const {fileName: downloadFileName} = getDownloadMediaDetails({media: doc, downloadId: '1'});\n  if(await managers.apiFileManager.isDownloading(downloadFileName)) {\n    downloadDiv = docDiv.querySelector('.document-download') || icoDiv;\n    const promise = appDownloadManager.downloadToDisc({media: doc}, true);\n\n    preloader = new ProgressivePreloader();\n    preloader.attach(downloadDiv, false, promise);\n    preloader.setDownloadFunction(load);\n    addByteProgress(promise);\n  } else if(!cacheContext.downloaded || uploadFileName) {\n    downloadDiv = docDiv.querySelector('.document-download') || icoDiv;\n    preloader = new ProgressivePreloader({\n      isUpload: !!uploadFileName\n    });\n\n    if(!uploadFileName) {\n      preloader.construct();\n      preloader.setManual();\n      preloader.attach(downloadDiv);\n      preloader.setDownloadFunction(load);\n\n      if(autoDownloadSize !== undefined && autoDownloadSize >= doc.size) {\n        simulateClickEvent(preloader.preloader);\n      }\n    } else {\n      const uploadPromise = appDownloadManager.getUpload(uploadFileName);\n      preloader.attachPromise(uploadPromise);\n      preloader.attach(downloadDiv);\n      addByteProgress(uploadPromise);\n    }\n  }\n\n  attachClickEvent(docDiv, (e) => {\n    if(preloader) {\n      preloader.onClick(e);\n    } else {\n      load(e);\n    }\n  });\n\n  return docDiv;\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport setInnerHTML from '../../helpers/dom/setInnerHTML';\nimport {MediaSizeType} from '../../helpers/mediaSizes';\nimport {Message} from '../../layer';\nimport {AppManagers} from '../../lib/appManagers/managers';\nimport wrapRichText from '../../lib/richTextProcessor/wrapRichText';\nimport {MediaSearchContext} from '../appMediaPlaybackController';\nimport Chat from '../chat/chat';\nimport LazyLoadQueue from '../lazyLoadQueue';\nimport wrapDocument from './document';\n\nexport default async function wrapGroupedDocuments({albumMustBeRenderedFull, message, bubble, messageDiv, chat, loadPromises, autoDownloadSize, lazyLoadQueue, searchContext, useSearch, sizeType, managers}: {\n  albumMustBeRenderedFull: boolean,\n  message: any,\n  messageDiv: HTMLElement,\n  bubble: HTMLElement,\n  uploading?: boolean,\n  chat: Chat,\n  loadPromises?: Promise<any>[],\n  autoDownloadSize?: number,\n  lazyLoadQueue?: LazyLoadQueue,\n  searchContext?: MediaSearchContext,\n  useSearch?: boolean,\n  sizeType?: MediaSizeType,\n  managers?: AppManagers\n}) {\n  let nameContainer: HTMLElement;\n  const mids = albumMustBeRenderedFull ? await chat.getMidsByMid(message.mid) : [message.mid];\n  /* if(isPending) {\n    mids.reverse();\n  } */\n\n  const promises = mids.map(async(mid, idx) => {\n    const message = (await chat.getMessage(mid)) as Message.message;\n    const div = await wrapDocument({\n      message,\n      loadPromises,\n      autoDownloadSize,\n      lazyLoadQueue,\n      searchContext,\n      sizeType,\n      managers\n    });\n\n    const container = document.createElement('div');\n    container.classList.add('document-container');\n    container.dataset.mid = '' + mid;\n    container.dataset.peerId = '' + message.peerId;\n\n    const wrapper = document.createElement('div');\n    wrapper.classList.add('document-wrapper');\n\n    if(message.message) {\n      const messageDiv = document.createElement('div');\n      messageDiv.classList.add('document-message');\n\n      const richText = wrapRichText(message.message, {\n        entities: message.totalEntities\n      });\n\n      setInnerHTML(messageDiv, richText);\n      wrapper.append(messageDiv);\n    }\n\n    if(mids.length > 1) {\n      const selection = document.createElement('div');\n      selection.classList.add('document-selection');\n      container.append(selection);\n\n      container.classList.add('grouped-item');\n\n      if(idx === 0) {\n        nameContainer = wrapper;\n      }\n    }\n\n    wrapper.append(div);\n    container.append(wrapper);\n    return container;\n  });\n\n  const containers = await Promise.all(promises);\n  messageDiv.append(...containers);\n\n  if(mids.length > 1) {\n    bubble.classList.add('is-multiple-documents', 'is-grouped');\n  }\n\n  return nameContainer;\n}\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport {SliderSuperTab} from '../../slider';\r\nimport appSidebarRight from '..';\r\nimport {roundPercents} from '../../poll';\r\nimport appDialogsManager from '../../../lib/appManagers/appDialogsManager';\r\nimport ripple from '../../ripple';\r\nimport {i18n} from '../../../lib/langPack';\r\nimport setInnerHTML from '../../../helpers/dom/setInnerHTML';\r\nimport wrapEmojiText from '../../../lib/richTextProcessor/wrapEmojiText';\r\n\r\nexport default class AppPollResultsTab extends SliderSuperTab {\r\n  private resultsDiv: HTMLElement;\r\n\r\n  protected init() {\r\n    this.container.id = 'poll-results-container';\r\n    this.container.classList.add('chatlist-container');\r\n\r\n    this.resultsDiv = document.createElement('div');\r\n    this.resultsDiv.classList.add('poll-results');\r\n    this.scrollable.append(this.resultsDiv);\r\n  }\r\n\r\n  public async open(message: any) {\r\n    const ret = super.open();\r\n    const poll = await this.managers.appPollsManager.getPoll(message.media.poll.id);\r\n\r\n    this.setTitle(poll.poll.pFlags.quiz ? 'PollResults.Title.Quiz' : 'PollResults.Title.Poll');\r\n\r\n    const title = document.createElement('h3');\r\n    setInnerHTML(title, wrapEmojiText(poll.poll.question));\r\n\r\n    const percents = poll.results.results.map((v) => v.voters / poll.results.total_voters * 100);\r\n    roundPercents(percents);\r\n\r\n    const fragment = document.createDocumentFragment();\r\n    poll.results.results.forEach((result, idx) => {\r\n      if(!result.voters) return;\r\n\r\n      const hr = document.createElement('hr');\r\n\r\n      const answer = poll.poll.answers[idx];\r\n\r\n      // Head\r\n      const answerEl = document.createElement('div');\r\n      answerEl.classList.add('poll-results-answer');\r\n\r\n      const answerTitle = document.createElement('div');\r\n      setInnerHTML(answerTitle, wrapEmojiText(answer.text));\r\n\r\n      const answerPercents = document.createElement('div');\r\n      answerPercents.innerText = Math.round(percents[idx]) + '%';\r\n\r\n      answerEl.append(answerTitle, answerPercents);\r\n\r\n      // Humans\r\n      const list = appDialogsManager.createChatList();\r\n      list.classList.add('poll-results-voters');\r\n\r\n      appDialogsManager.setListClickListener(list, () => {\r\n        appSidebarRight.onCloseBtnClick();\r\n      }, undefined, true);\r\n\r\n      list.style.minHeight = Math.min(result.voters, 4) * 50 + 'px';\r\n\r\n      fragment.append(hr, answerEl, list);\r\n\r\n      let offset: string, limit = 4, loading = false, left = result.voters - 4;\r\n      const load = () => {\r\n        if(loading) return;\r\n        loading = true;\r\n\r\n        this.managers.appPollsManager.getVotes(message, answer.option, offset, limit).then((votesList) => {\r\n          votesList.votes.forEach((vote) => {\r\n            const {dom} = appDialogsManager.addDialogNew({\r\n              peerId: vote.user_id.toPeerId(false),\r\n              container: list,\r\n              rippleEnabled: false,\r\n              meAsSaved: false,\r\n              avatarSize: 32\r\n            });\r\n            dom.lastMessageSpan.parentElement.remove();\r\n          });\r\n\r\n          if(offset) {\r\n            left -= votesList.votes.length;\r\n            (showMore.lastElementChild as HTMLElement).replaceWith(i18n('PollResults.LoadMore', [Math.min(20, left)]));\r\n          }\r\n\r\n          offset = votesList.next_offset;\r\n          limit = 20;\r\n\r\n          if(!left || !votesList.votes.length) {\r\n            showMore.remove();\r\n          }\r\n        }).finally(() => {\r\n          loading = false;\r\n        });\r\n      };\r\n\r\n      load();\r\n\r\n      if(left <= 0) return;\r\n\r\n      const showMore = document.createElement('div');\r\n      showMore.classList.add('poll-results-more', 'show-more', 'rp-overflow');\r\n      showMore.addEventListener('click', load);\r\n      ripple(showMore);\r\n      const down = document.createElement('div');\r\n      down.classList.add('tgico-down');\r\n      showMore.append(down, i18n('PollResults.LoadMore', [Math.min(20, left)]));\r\n\r\n      fragment.append(showMore);\r\n    });\r\n\r\n    this.resultsDiv.append(title, fragment);\r\n\r\n    appSidebarRight.toggleSidebar(true).then(() => {\r\n      /* appPollsManager.getVotes(mid).then((votes) => {\r\n        console.log('gOt VotEs', votes);\r\n      }); */\r\n    });\r\n\r\n    return ret;\r\n  }\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport mediaSizes from '../helpers/mediaSizes';\r\nimport IS_TOUCH_SUPPORTED from '../environment/touchSupport';\r\nimport appImManager from '../lib/appManagers/appImManager';\r\nimport rootScope from '../lib/rootScope';\r\nimport ripple from './ripple';\r\nimport appSidebarRight from './sidebarRight';\r\nimport AppPollResultsTab from './sidebarRight/tabs/pollResults';\r\nimport {FormatterArguments, i18n, LangPackKey} from '../lib/langPack';\r\nimport {fastRaf} from '../helpers/schedulers';\r\nimport SetTransition from './singleTransition';\r\nimport findUpClassName from '../helpers/dom/findUpClassName';\r\nimport cancelEvent from '../helpers/dom/cancelEvent';\r\nimport {attachClickEvent, detachClickEvent, simulateClickEvent} from '../helpers/dom/clickEvent';\r\nimport replaceContent from '../helpers/dom/replaceContent';\r\nimport windowSize from '../helpers/windowSize';\r\nimport {Message, MessageMedia, Poll, PollResults} from '../layer';\r\nimport toHHMMSS from '../helpers/string/toHHMMSS';\r\nimport StackedAvatars from './stackedAvatars';\r\nimport setInnerHTML from '../helpers/dom/setInnerHTML';\r\nimport {AppManagers} from '../lib/appManagers/managers';\r\nimport wrapEmojiText from '../lib/richTextProcessor/wrapEmojiText';\r\nimport wrapRichText from '../lib/richTextProcessor/wrapRichText';\r\n\r\nlet lineTotalLength = 0;\r\nconst tailLength = 9;\r\nconst times = 10;\r\nconst fullTime = 340;\r\nconst oneTime = fullTime / times;\r\n\r\nexport const roundPercents = (percents: number[]) => {\r\n  // console.log('roundPercents before percents:', percents);\r\n\r\n  const sum = percents.reduce((acc, p) => acc + Math.round(p), 0);\r\n  if(sum > 100) {\r\n    const diff = sum - 100;\r\n    const length = percents.length;\r\n    for(let i = 0; i < diff; ++i) {\r\n      let minIndex = -1, minRemainder = 1;\r\n      for(let k = 0; k < length; ++k) {\r\n        const remainder = percents[k] % 1;\r\n        if(remainder >= 0.5 && remainder < minRemainder) {\r\n          minRemainder = remainder;\r\n          minIndex = k;\r\n        }\r\n      }\r\n\r\n      if(minIndex === -1) {\r\n        // throw new Error('lol chto');\r\n        return;\r\n      }\r\n\r\n      percents[minIndex] -= minRemainder;\r\n    }\r\n  } else if(sum < 100) {\r\n    const diff = 100 - sum;\r\n    const length = percents.length;\r\n    for(let i = 0; i < diff; ++i) {\r\n      let minIndex = -1, maxRemainder = 0;\r\n      for(let k = 0; k < length; ++k) {\r\n        const remainder = percents[k] % 1;\r\n        if(remainder < 0.5 && remainder > maxRemainder) {\r\n          maxRemainder = remainder;\r\n          minIndex = k;\r\n        }\r\n      }\r\n\r\n      if(minIndex === -1) {\r\n        // throw new Error('lol chto');\r\n        return;\r\n      }\r\n\r\n      percents[minIndex] += 1 - maxRemainder;\r\n    }\r\n  }\r\n\r\n  // console.log('roundPercents after percents:', percents);\r\n};\r\n\r\n/* const connectedPolls: {id: string, element: PollElement}[] = [];\r\nrootScope.on('poll_update', (e) => {\r\n  const {poll, results} = e as {poll: Poll, results: PollResults};\r\n\r\n  //console.log('poll_update', poll, results);\r\n  for(const connected of connectedPolls) {\r\n    if(connected.id === poll.id) {\r\n      const pollElement = connected.element;\r\n      pollElement.isClosed = !!poll.pFlags.closed;\r\n      pollElement.performResults(results, poll.chosenIndexes);\r\n    }\r\n  }\r\n}); */\r\n\r\nrootScope.addEventListener('poll_update', ({poll, results}) => {\r\n  const pollElements = Array.from(document.querySelectorAll(`poll-element[poll-id=\"${poll.id}\"]`)) as PollElement[];\r\n  pollElements.forEach((pollElement) => {\r\n    // console.log('poll_update', poll, results);\r\n    pollElement.isClosed = !!poll.pFlags.closed;\r\n    pollElement.performResults(results, poll.chosenIndexes);\r\n  });\r\n});\r\n\r\nmediaSizes.addEventListener('resize', () => {\r\n  PollElement.setMaxLength();\r\n  PollElement.resizePolls();\r\n});\r\n\r\nmediaSizes.addEventListener('changeScreen', () => {\r\n  PollElement.setMaxLength();\r\n});\r\n\r\nconst hideQuizHint = (element: HTMLElement, onHide: () => void, timeout: number) => {\r\n  element.classList.remove('active');\r\n\r\n  clearTimeout(timeout);\r\n  setTimeout(() => {\r\n    onHide();\r\n    element.remove();\r\n\r\n    if(prevQuizHint === element && prevQuizHintOnHide === onHide && prevQuizHintTimeout === timeout) {\r\n      prevQuizHint = prevQuizHintOnHide = null;\r\n      prevQuizHintTimeout = 0;\r\n    }\r\n  }, 200);\r\n};\r\n\r\nlet prevQuizHint: HTMLElement, prevQuizHintOnHide: () => void, prevQuizHintTimeout: number;\r\nlet isListenerSet = false;\r\nconst setQuizHint = (solution: string, solution_entities: any[], onHide: () => void) => {\r\n  if(prevQuizHint) {\r\n    hideQuizHint(prevQuizHint, prevQuizHintOnHide, prevQuizHintTimeout);\r\n  }\r\n\r\n  const element = document.createElement('div');\r\n  element.classList.add('quiz-hint');\r\n\r\n  const container = document.createElement('div');\r\n  container.classList.add('container', 'tgico');\r\n\r\n  const textEl = document.createElement('div');\r\n  textEl.classList.add('text');\r\n\r\n  container.append(textEl);\r\n  element.append(container);\r\n\r\n  setInnerHTML(textEl, wrapRichText(solution, {entities: solution_entities}));\r\n  appImManager.chat.bubbles.container.append(element);\r\n\r\n  void element.offsetLeft; // reflow\r\n  element.classList.add('active');\r\n\r\n  prevQuizHint = element;\r\n  prevQuizHintOnHide = onHide;\r\n  prevQuizHintTimeout = window.setTimeout(() => {\r\n    hideQuizHint(element, onHide, prevQuizHintTimeout);\r\n  }, IS_TOUCH_SUPPORTED ? 5000 : 7000);\r\n\r\n  if(!isListenerSet) {\r\n    isListenerSet = true;\r\n    appImManager.addEventListener('peer_changed', () => {\r\n      if(prevQuizHint) {\r\n        hideQuizHint(prevQuizHint, prevQuizHintOnHide, prevQuizHintTimeout);\r\n      }\r\n    });\r\n  }\r\n};\r\n\r\nexport default class PollElement extends HTMLElement {\r\n  public static MAX_OFFSET = -46.5;\r\n  public static MAX_LENGTH = 0;\r\n  public svgLines: SVGSVGElement[];\r\n  private numberDivs: HTMLDivElement[];\r\n  private answerDivs: HTMLDivElement[];\r\n  private descDiv: HTMLElement;\r\n  private typeDiv: HTMLElement;\r\n  private avatarsDiv: HTMLElement;\r\n  private viewResults: HTMLElement;\r\n  private votersCountDiv: HTMLDivElement;\r\n\r\n  // private maxLength: number;\r\n  // private maxLengths: number[];\r\n  private maxPercents: number[];\r\n\r\n  public isClosed = false;\r\n  private isQuiz = false;\r\n  private isRetracted = false;\r\n  private isPublic = false;\r\n  private isMultiple = false;\r\n  private chosenIndexes: number[] = [];\r\n  private percents: number[];\r\n\r\n  public message: Message.message;\r\n  public managers: AppManagers;\r\n\r\n  private quizInterval: number;\r\n  private quizTimer: SVGSVGElement;\r\n\r\n  private sendVoteBtn: HTMLElement;\r\n  private chosingIndexes: number[] = [];\r\n\r\n  private sendVotePromise: Promise<void>;\r\n  private sentVote = false;\r\n\r\n  public static setMaxLength() {\r\n    const width = windowSize.width <= 360 ? windowSize.width - 120 : mediaSizes.active.poll.width;\r\n    this.MAX_LENGTH = width + tailLength + this.MAX_OFFSET + -13.7; // 13 - position left\r\n  }\r\n\r\n  public static resizePolls() {\r\n    if(!this.MAX_LENGTH) return;\r\n    const pollElements = Array.from(document.querySelectorAll('poll-element.is-voted')) as PollElement[];\r\n    pollElements.forEach((pollElement) => {\r\n      pollElement.svgLines.forEach((svg, idx) => {\r\n        // void svg.getBoundingClientRect(); // reflow\r\n        pollElement.setLineProgress(idx, 1);\r\n      });\r\n    });\r\n  }\r\n\r\n  public async render() {\r\n    //         \r\n    // (   ,    /)\r\n\r\n    if(!lineTotalLength) {\r\n      lineTotalLength = (document.getElementById('poll-line') as any as SVGPathElement).getTotalLength();\r\n      // console.log('line total length:', lineTotalLength);\r\n      PollElement.setMaxLength();\r\n    }\r\n\r\n    // const {poll, results} = this.managers.appPollsManager.getPoll(pollId);\r\n    const {poll, results} = this.message.media as MessageMedia.messageMediaPoll;\r\n\r\n    /* const timestamp = Date.now() / 1000 | 0;\r\n    if(timestamp < this.message.date) { */\r\n    if(this.message.pFlags.is_scheduled) {\r\n      this.classList.add('disable-hover');\r\n    }\r\n\r\n    // console.log('pollElement poll:', poll, results);\r\n\r\n    let descKey: LangPackKey;\r\n    if(poll.pFlags) {\r\n      this.isPublic = !!poll.pFlags.public_voters;\r\n      this.isQuiz = !!poll.pFlags.quiz;\r\n      this.isClosed = !!poll.pFlags.closed;\r\n      this.isMultiple = !!poll.pFlags.multiple_choice;\r\n\r\n      if(this.isClosed) {\r\n        descKey = 'Chat.Poll.Type.Closed';\r\n        this.classList.add('is-closed');\r\n      } else if(this.isQuiz) {\r\n        descKey = this.isPublic ? 'Chat.Poll.Type.Quiz' : 'Chat.Poll.Type.AnonymousQuiz';\r\n      } else {\r\n        descKey = this.isPublic ? 'Chat.Poll.Type.Public' : 'Chat.Poll.Type.Anonymous';\r\n      }\r\n    }\r\n\r\n    this.classList.toggle('is-multiple', this.isMultiple);\r\n\r\n    const multipleSelect = this.isMultiple ? '<span class=\"poll-answer-selected tgico-check\"></span>' : '';\r\n    const votes = poll.answers.map((answer, idx) => {\r\n      return `\r\n        <div class=\"poll-answer\" data-index=\"${idx}\">\r\n          <div class=\"circle-hover\">\r\n            <div class=\"animation-ring\"></div>\r\n            <svg class=\"progress-ring\">\r\n              <circle class=\"progress-ring__circle\" cx=\"13\" cy=\"13\" r=\"9\"></circle>\r\n            </svg>\r\n            ${multipleSelect}\r\n          </div>\r\n          <div class=\"poll-answer-percents\"></div>\r\n          <div class=\"poll-answer-text\"></div>\r\n          <svg version=\"1.1\" class=\"poll-line\" style=\"display: none;\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" viewBox=\"0 0 485.9 35\" xml:space=\"preserve\">\r\n            <use href=\"#poll-line\"></use>\r\n          </svg>\r\n          <span class=\"poll-answer-selected tgico\"></span>\r\n        </div>\r\n      `;\r\n    }).join('');\r\n\r\n    this.innerHTML = `\r\n      <div class=\"poll-title\"></div>\r\n      <div class=\"poll-desc\">\r\n        <div class=\"poll-type\"></div>\r\n        <div class=\"poll-avatars\"></div>\r\n      </div>\r\n      ${votes}`;\r\n\r\n    setInnerHTML(this.firstElementChild, wrapEmojiText(poll.question));\r\n\r\n    Array.from(this.querySelectorAll('.poll-answer-text')).forEach((el, idx) => {\r\n      setInnerHTML(el, wrapEmojiText(poll.answers[idx].text));\r\n    });\r\n\r\n    this.descDiv = this.firstElementChild.nextElementSibling as HTMLElement;\r\n    this.typeDiv = this.descDiv.firstElementChild as HTMLElement;\r\n    this.avatarsDiv = this.descDiv.lastElementChild as HTMLElement;\r\n\r\n    if(descKey) {\r\n      this.typeDiv.append(i18n(descKey));\r\n    }\r\n\r\n    if(this.isQuiz) {\r\n      this.classList.add('is-quiz');\r\n\r\n      if(poll.close_period && poll.close_date) {\r\n        const timeLeftDiv = document.createElement('div');\r\n        timeLeftDiv.classList.add('poll-time');\r\n        this.descDiv.append(timeLeftDiv);\r\n\r\n        const svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');\r\n        // svg.setAttributeNS(null, 'viewBox', '0 0 15 15');\r\n        svg.classList.add('poll-quiz-timer');\r\n\r\n        this.quizTimer = svg;\r\n\r\n        const strokeWidth = 2;\r\n        const radius = 7;\r\n        const circumference = 2 * Math.PI * radius;\r\n\r\n        const circle = document.createElementNS('http://www.w3.org/2000/svg', 'circle');\r\n        circle.classList.add('poll-quiz-timer-circle');\r\n        circle.setAttributeNS(null, 'cx', '16');\r\n        circle.setAttributeNS(null, 'cy', '16');\r\n        circle.setAttributeNS(null, 'r', '' + radius);\r\n        circle.setAttributeNS(null, 'stroke-width', '' + strokeWidth);\r\n\r\n        svg.append(circle);\r\n        this.descDiv.append(svg);\r\n\r\n        const period = poll.close_period * 1000;\r\n        const closeTime = (poll.close_date - await rootScope.managers.timeManager.getServerTimeOffset()) * 1000;\r\n\r\n        // console.log('closeTime:', poll.close_date, serverTimeManager.serverTimeOffset, Date.now() / 1000 | 0);\r\n\r\n        // let time = Date.now();\r\n        // let percents = (closeTime - time) / period;\r\n\r\n        // timeLeftDiv.innerHTML = String((closeTime - time) / 1000 + 1 | 0).toHHMMSS();\r\n\r\n        // // @ts-ignore\r\n        // circle.style.strokeDashoffset = circumference + percents * circumference;\r\n        // circle.style.strokeDasharray = ${circumference} ${circumference};\r\n\r\n        this.quizInterval = window.setInterval(() => {\r\n          const time = Date.now();\r\n          const percents = (closeTime - time) / period;\r\n          const timeLeft = (closeTime - time) / 1000 + 1 | 0;\r\n          timeLeftDiv.innerHTML = toHHMMSS(timeLeft);\r\n\r\n          if(timeLeft <= 5) {\r\n            timeLeftDiv.style.color = '#ee545c';\r\n            circle.style.stroke = '#ee545c';\r\n          }\r\n          // timeLeftDiv.style.visibility = 'visible';\r\n\r\n          // @ts-ignore\r\n          circle.style.strokeDashoffset = circumference + percents * circumference;\r\n          circle.style.strokeDasharray = `${circumference} ${circumference}`;\r\n\r\n          if(time >= closeTime) {\r\n            clearInterval(this.quizInterval);\r\n            timeLeftDiv.innerHTML = '';\r\n            // @ts-ignore\r\n            circle.style.strokeDashoffset = circumference;\r\n            this.quizInterval = 0;\r\n\r\n            setTimeout(() => {\r\n              //      \r\n              this.managers.appPollsManager.getResults(this.message);\r\n            }, 3e3);\r\n          }\r\n        }, 1e3);\r\n      }\r\n    }\r\n\r\n    this.answerDivs = Array.from(this.querySelectorAll('.poll-answer')) as HTMLDivElement[];\r\n    this.svgLines = Array.from(this.querySelectorAll('.poll-line')) as SVGSVGElement[];\r\n    this.numberDivs = Array.from(this.querySelectorAll('.poll-answer-percents')) as HTMLDivElement[];\r\n\r\n    const footerDiv = document.createElement('div');\r\n    footerDiv.classList.add('poll-footer');\r\n\r\n    this.viewResults = document.createElement('div');\r\n    this.viewResults.className = 'poll-footer-button poll-view-results hide';\r\n    this.viewResults.append(i18n('Chat.Poll.ViewResults'));\r\n\r\n    this.votersCountDiv = document.createElement('div');\r\n    this.votersCountDiv.className = 'poll-votes-count';\r\n\r\n    footerDiv.append(this.viewResults, this.votersCountDiv);\r\n    this.append(footerDiv);\r\n\r\n    this.viewResults.addEventListener('click', (e) => {\r\n      cancelEvent(e);\r\n\r\n      if(!appSidebarRight.isTabExists(AppPollResultsTab)) {\r\n        appSidebarRight.createTab(AppPollResultsTab).open(this.message);\r\n      }\r\n    });\r\n    ripple(this.viewResults);\r\n\r\n    if(this.isMultiple) {\r\n      this.sendVoteBtn = document.createElement('div');\r\n      this.sendVoteBtn.classList.add('poll-footer-button', 'poll-send-vote');\r\n      this.sendVoteBtn.append(i18n('Chat.Poll.SubmitVote'));\r\n      ripple(this.sendVoteBtn);\r\n\r\n      if(!poll.chosenIndexes.length) {\r\n        this.votersCountDiv.classList.add('hide');\r\n      }\r\n\r\n      attachClickEvent(this.sendVoteBtn, (e) => {\r\n        cancelEvent(e);\r\n        /* const indexes = this.answerDivs.filter((el) => el.classList.contains('is-chosing')).map((el) => +el.dataset.index);\r\n        if(indexes.length) {\r\n\r\n        } */\r\n        if(this.chosingIndexes.length) {\r\n          this.sendVotes(this.chosingIndexes).then(() => {\r\n            this.chosingIndexes.length = 0;\r\n            this.answerDivs.forEach((el) => {\r\n              el.classList.remove('is-chosing');\r\n            });\r\n          });\r\n        }\r\n      });\r\n\r\n      footerDiv.append(this.sendVoteBtn);\r\n    }\r\n\r\n    // const width = this.getBoundingClientRect().width;\r\n    // const width = mediaSizes.active.poll.width;\r\n    // this.maxLength = width + tailLength + this.maxOffset + -13.7; // 13 - position left\r\n\r\n    const canVote = !(poll.chosenIndexes.length || this.isClosed);\r\n    if(!canVote || this.isPublic) {\r\n      this.performResults(results, poll.chosenIndexes, false);\r\n    }\r\n\r\n    if(canVote) {\r\n      this.setVotersCount(results);\r\n      attachClickEvent(this, this.clickHandler);\r\n    }\r\n  }\r\n\r\n  initQuizHint(results: PollResults) {\r\n    if(results.solution && results.solution_entities) {\r\n      const toggleHint = document.createElement('div');\r\n      toggleHint.classList.add('tgico-tip', 'poll-hint');\r\n      this.descDiv.append(toggleHint);\r\n\r\n      // let active = false;\r\n      attachClickEvent(toggleHint, (e) => {\r\n        cancelEvent(e);\r\n\r\n        // active = true;\r\n        toggleHint.classList.add('active');\r\n        setQuizHint(results.solution, results.solution_entities, () => {\r\n          // active = false;\r\n          toggleHint.classList.remove('active');\r\n        });\r\n      });\r\n\r\n      if(this.sentVote) {\r\n        const correctResult = results.results.find((r) => r.pFlags.correct);\r\n        if(correctResult && !correctResult.pFlags.chosen) {\r\n          simulateClickEvent(toggleHint);\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  clickHandler(e: Event) {\r\n    const target = findUpClassName(e.target, 'poll-answer') as HTMLElement;\r\n    if(!target) {\r\n      return;\r\n    }\r\n\r\n    cancelEvent(e);\r\n    const answerIndex = +target.dataset.index;\r\n    if(this.isMultiple) {\r\n      target.classList.toggle('is-chosing');\r\n\r\n      const foundIndex = this.chosingIndexes.indexOf(answerIndex);\r\n      if(foundIndex !== -1) {\r\n        this.chosingIndexes.splice(foundIndex, 1);\r\n      } else {\r\n        this.chosingIndexes.push(answerIndex);\r\n      }\r\n    } else {\r\n      this.sendVotes([answerIndex]);\r\n    }\r\n\r\n    /* target.classList.add('is-voting');\r\n    setTimeout(() => { // simulate\r\n      this.setResults([100, 0], answerIndex);\r\n      target.classList.remove('is-voting');\r\n    }, 1000); */\r\n  }\r\n\r\n  sendVotes(indexes: number[]) {\r\n    if(this.sendVotePromise) return this.sendVotePromise;\r\n\r\n    const targets = this.answerDivs.filter((_, idx) => indexes.includes(idx));\r\n    targets.forEach((target) => {\r\n      target.classList.add('is-voting');\r\n    });\r\n\r\n    this.classList.add('disable-hover');\r\n    this.sentVote = true;\r\n    return this.sendVotePromise = this.managers.appPollsManager.sendVote(this.message, indexes).then(() => {\r\n      targets.forEach((target) => {\r\n        target.classList.remove('is-voting');\r\n      });\r\n\r\n      this.classList.remove('disable-hover');\r\n    }).catch(() => {\r\n      this.sentVote = false;\r\n    }).finally(() => {\r\n      this.sendVotePromise = null;\r\n    });\r\n  }\r\n\r\n  performResults(results: PollResults, chosenIndexes: number[], animate = true) {\r\n    if(!rootScope.settings.animationsEnabled) {\r\n      animate = false;\r\n    }\r\n\r\n    if(this.isQuiz && (results.results?.length || this.isClosed)) {\r\n      this.answerDivs.forEach((el, idx) => {\r\n        el.classList.toggle('is-correct', !!results.results[idx].pFlags.correct);\r\n      });\r\n\r\n      if(this.initQuizHint) {\r\n        this.initQuizHint(results);\r\n        this.initQuizHint = null;\r\n      }\r\n\r\n      if(this.quizInterval) {\r\n        clearInterval(this.quizInterval);\r\n        this.quizInterval = 0;\r\n      }\r\n\r\n      if(this.quizTimer?.parentElement) {\r\n        this.quizTimer.remove();\r\n      }\r\n\r\n      const timeEl = this.descDiv.querySelector('.poll-time');\r\n      if(timeEl) {\r\n        timeEl.remove();\r\n      }\r\n    }\r\n\r\n    if(this.isClosed) {\r\n      this.classList.add('is-closed');\r\n      replaceContent(this.typeDiv, i18n('Chat.Poll.Type.Closed'));\r\n    }\r\n\r\n    // set chosen\r\n    if(this.chosenIndexes.length !== chosenIndexes.length || this.isClosed) { // if we voted\r\n      this.isRetracted = this.chosenIndexes.length && !chosenIndexes.length;\r\n      this.chosenIndexes = chosenIndexes.slice();\r\n\r\n      if(this.isRetracted) {\r\n        attachClickEvent(this, this.clickHandler);\r\n      } else {\r\n        detachClickEvent(this, this.clickHandler);\r\n      }\r\n    }\r\n\r\n    // is need update\r\n    if(this.chosenIndexes.length || this.isRetracted || this.isClosed) {\r\n      const percents = results.results.map((v) => results.total_voters ? v.voters / results.total_voters * 100 : 0);\r\n\r\n      this.classList.toggle('no-transition', !animate);\r\n      if(animate) {\r\n        SetTransition(this, '', !this.isRetracted, 340);\r\n      }\r\n\r\n      fastRaf(() => {\r\n        this.setResults(this.isRetracted ? this.percents : percents, this.chosenIndexes, animate);\r\n        this.percents = percents;\r\n        this.isRetracted = false;\r\n      });\r\n    }\r\n\r\n    this.setVotersCount(results);\r\n\r\n    if(this.isPublic) {\r\n      if(!this.isMultiple) {\r\n        this.viewResults.classList.toggle('hide', !results.total_voters || !this.chosenIndexes.length);\r\n        this.votersCountDiv.classList.toggle('hide', !!this.chosenIndexes.length);\r\n      }\r\n\r\n      const peerIds = (results.recent_voters || []).map((userId) => userId.toPeerId());\r\n      const stackedAvatars = new StackedAvatars({avatarSize: 16});\r\n      stackedAvatars.render(peerIds);\r\n      replaceContent(this.avatarsDiv, stackedAvatars.container);\r\n    }\r\n\r\n    if(this.isMultiple) {\r\n      const isVoted = !!this.chosenIndexes.length;\r\n\r\n      const hideSendVoteBtn = this.isClosed || isVoted;\r\n      const hideViewResultsBtn = !this.isPublic || !results.total_voters || (!isVoted && !this.isClosed);\r\n      this.sendVoteBtn.classList.toggle('hide', hideSendVoteBtn);\r\n      this.viewResults.classList.toggle('hide', hideViewResultsBtn);\r\n      this.votersCountDiv.classList.toggle('hide', !hideSendVoteBtn || !hideViewResultsBtn);\r\n    }\r\n  }\r\n\r\n  setResults(percents: number[], chosenIndexes: number[], animate: boolean) {\r\n    this.svgLines.forEach((svg) => svg.style.display = '');\r\n\r\n    this.answerDivs.forEach((el, idx) => {\r\n      el.classList.toggle('is-chosen', chosenIndexes.includes(idx));\r\n    });\r\n\r\n    const maxValue = Math.max(...percents);\r\n    // this.maxLengths = percents.map((p) => p / maxValue * this.maxLength);\r\n    this.maxPercents = percents.map((p) => p / maxValue);\r\n\r\n    // line\r\n    if(this.isRetracted) {\r\n      this.svgLines.forEach((svg, idx) => {\r\n        this.setLineProgress(idx, -1);\r\n      });\r\n    } else {\r\n      const cb = () => {\r\n        this.svgLines.forEach((svg, idx) => {\r\n          // void svg.getBoundingClientRect(); // reflow\r\n          this.setLineProgress(idx, 1);\r\n        });\r\n      };\r\n\r\n      animate ? fastRaf(cb) : cb();\r\n    }\r\n\r\n    percents = percents.slice();\r\n    roundPercents(percents);\r\n    let getPercentValue: (percents: number, index: number) => number;\r\n    const iterate = (i: number) => {\r\n      percents.forEach((percents, idx) => {\r\n        const value = getPercentValue(percents, i);\r\n        this.numberDivs[idx].innerText = value + '%';\r\n      });\r\n    };\r\n    // numbers\r\n    if(this.isRetracted) {\r\n      getPercentValue = (percents, index) => Math.round(percents / times * index);\r\n\r\n      if(animate) {\r\n        for(let i = (times - 1), k = 0; i >= 0; --i, ++k) {\r\n          setTimeout(() => {\r\n            iterate(i);\r\n          }, oneTime * k);\r\n        }\r\n      } else {\r\n        iterate(0);\r\n      }\r\n    } else {\r\n      getPercentValue = (percents, index) => Math.round(percents / times * (index + 1));\r\n\r\n      if(animate) {\r\n        for(let i = 0; i < times; ++i) {\r\n          setTimeout(() => {\r\n            iterate(i);\r\n          }, oneTime * i);\r\n        }\r\n      } else {\r\n        iterate(times - 1);\r\n      }\r\n    }\r\n\r\n    if(this.isRetracted) {\r\n      if(animate) {\r\n        this.classList.add('is-retracting');\r\n      }\r\n\r\n      this.classList.remove('is-voted');\r\n      const cb = () => {\r\n        this.svgLines.forEach((svg) => svg.style.display = 'none');\r\n      };\r\n\r\n      if(animate) {\r\n        setTimeout(() => {\r\n          this.classList.remove('is-retracting');\r\n          cb();\r\n        }, fullTime);\r\n      } else {\r\n        cb();\r\n      }\r\n    } else {\r\n      this.classList.add('is-voted');\r\n    }\r\n  }\r\n\r\n  setVotersCount(results: PollResults) {\r\n    const votersCount = results.total_voters || 0;\r\n    let key: LangPackKey;\r\n    const args: FormatterArguments = [votersCount];\r\n    if(this.isClosed) {\r\n      if(this.isQuiz) key = votersCount ? 'Chat.Quiz.TotalVotes' : 'Chat.Quiz.TotalVotesResultEmpty';\r\n      else key = votersCount ? 'Chat.Poll.TotalVotes1' : 'Chat.Poll.TotalVotesResultEmpty';\r\n    } else {\r\n      if(this.isQuiz) key = votersCount ? 'Chat.Quiz.TotalVotes' : 'Chat.Quiz.TotalVotesEmpty';\r\n      else key = votersCount ? 'Chat.Poll.TotalVotes1' : 'Chat.Poll.TotalVotesEmpty';\r\n    }\r\n\r\n    replaceContent(this.votersCountDiv, i18n(key, args));\r\n  }\r\n\r\n  setLineProgress(index: number, multiplier: number) {\r\n    const svg = this.svgLines[index];\r\n\r\n    if(multiplier === -1) {\r\n      svg.style.strokeDasharray = '';\r\n      svg.style.strokeDashoffset = '';\r\n    } else {\r\n      // svg.style.strokeDasharray = (multiplier * this.maxLengths[index]) + ', 485.9';\r\n      svg.style.strokeDasharray = (multiplier * this.maxPercents[index] * PollElement.MAX_LENGTH) + ', 485.9';\r\n      // svg.style.strokeDasharray = (multiplier * this.maxPercents[index] * 100) + '%, 485.9';\r\n      svg.style.strokeDashoffset = '' + multiplier * PollElement.MAX_OFFSET;\r\n    }\r\n  }\r\n\r\n  //         \r\n}\r\n\r\ncustomElements.define('poll-element', PollElement);\r\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport {AppManagers} from '../../lib/appManagers/managers';\nimport rootScope from '../../lib/rootScope';\nimport PollElement from '../poll';\n\nexport default function wrapPoll(message: any, managers: AppManagers = rootScope.managers) {\n  const elem = new PollElement();\n  elem.message = message;\n  elem.managers = managers;\n  elem.setAttribute('peer-id', '' + message.peerId);\n  elem.setAttribute('poll-id', message.media.poll.id);\n  elem.setAttribute('message-id', '' + message.mid);\n  elem.render();\n  return elem;\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport {hexToRgb} from '../../helpers/color';\nimport {Message} from '../../layer';\nimport getPeerColorById from '../../lib/appManagers/utils/peers/getPeerColorById';\nimport ReplyContainer from '../chat/replyContainer';\n\nexport default function wrapReply(\n  title: Parameters<ReplyContainer['fill']>[0],\n  subtitle: Parameters<ReplyContainer['fill']>[1],\n  message?: Message.message | Message.messageService,\n  setColorPeerId?: PeerId\n) {\n  const replyContainer = new ReplyContainer('reply');\n  const fillPromise = replyContainer.fill(title, subtitle, message);\n\n  if(setColorPeerId) {\n    const hex = getPeerColorById(setColorPeerId, false);\n    const [r, g, b] = hexToRgb(hex);\n    replyContainer.container.style.setProperty('--override-color', `${r}, ${g}, ${b}`);\n    replyContainer.container.classList.add('is-overriding-color');\n    // replyContainer.border.style.backgroundColor = hex;\n    // replyContainer.title.style.color = hex;\n  }\n\n  return {container: replyContainer.container, fillPromise};\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport createVideo from '../../helpers/dom/createVideo';\nimport renderImageFromUrl from '../../helpers/dom/renderImageFromUrl';\nimport {StickerSet} from '../../layer';\nimport appDownloadManager from '../../lib/appManagers/appDownloadManager';\nimport {AppManagers} from '../../lib/appManagers/managers';\nimport lottieLoader from '../../lib/rlottie/lottieLoader';\nimport rootScope from '../../lib/rootScope';\nimport animationIntersector, {AnimationItemGroup} from '../animationIntersector';\nimport LazyLoadQueue from '../lazyLoadQueue';\nimport wrapSticker from './sticker';\n\nexport default async function wrapStickerSetThumb({set, lazyLoadQueue, container, group, autoplay, width, height, managers = rootScope.managers}: {\n  set: StickerSet.stickerSet,\n  lazyLoadQueue: LazyLoadQueue,\n  container: HTMLElement,\n  group: AnimationItemGroup,\n  autoplay: boolean,\n  width: number,\n  height: number,\n  managers?: AppManagers\n}) {\n  if(set.thumbs?.length) {\n    container.classList.add('media-sticker-wrapper');\n    lazyLoadQueue.push({\n      div: container,\n      load: async() => {\n        const downloadOptions = await managers.appStickersManager.getStickerSetThumbDownloadOptions(set);\n        const promise = appDownloadManager.download(downloadOptions);\n\n        if(set.pFlags.animated && !set.pFlags.videos) {\n          return promise\n          .then((blob) => {\n            lottieLoader.loadAnimationWorker({\n              container,\n              loop: true,\n              autoplay,\n              animationData: blob,\n              width,\n              height,\n              needUpscale: true,\n              name: 'setThumb' + set.id\n            }, group);\n          });\n        } else {\n          let media: HTMLElement;\n          if(set.pFlags.videos) {\n            media = createVideo();\n            (media as HTMLVideoElement).autoplay = true;\n            (media as HTMLVideoElement).muted = true;\n            (media as HTMLVideoElement).loop = true;\n          } else {\n            media = new Image();\n          }\n\n          media.classList.add('media-sticker');\n\n          return promise.then((blob) => {\n            renderImageFromUrl(media, URL.createObjectURL(blob), () => {\n              container.append(media);\n\n              if(set.pFlags.videos) {\n                animationIntersector.addAnimation(media as HTMLVideoElement, group);\n              }\n            });\n          });\n        }\n      }\n    });\n\n    return;\n  }\n\n  const promise = managers.appStickersManager.getStickerSet(set);\n  const stickerSet = await promise;\n  if(stickerSet.documents[0]._ !== 'documentEmpty') { // as thumb will be used first sticker\n    wrapSticker({\n      doc: stickerSet.documents[0],\n      div: container,\n      group: group,\n      lazyLoadQueue,\n      managers,\n      width,\n      height\n    }); // kostil\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport {MyDocument} from '../../lib/appManagers/appDocsManager';\nimport {AppManagers} from '../../lib/appManagers/managers';\nimport Row from '../row';\nimport wrapSticker from './sticker';\n\nexport default function wrapStickerToRow({doc, row, size, managers}: {\n  doc: MyDocument,\n  row: Row,\n  size?: 'small' | 'large',\n  managers?: AppManagers\n}) {\n  const previousMedia = row.media;\n  const media = row.createMedia('small');\n\n  if(previousMedia) {\n    media.classList.add('hide');\n  }\n\n  const loadPromises: Promise<any>[] = previousMedia ? [] : undefined;\n\n  const _size = size === 'small' ? 32 : 48;\n  const result = wrapSticker({\n    div: media,\n    doc: doc,\n    width: _size,\n    height: _size,\n    loadPromises,\n    managers\n  }).then(({render}) => render);\n\n  loadPromises && Promise.all(loadPromises).then(() => {\n    media.classList.remove('hide');\n    previousMedia.remove();\n  });\n\n  return result;\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport {formatPhoneNumber} from '../../helpers/formatPhoneNumber';\n\nexport default function formatUserPhone(phone: string) {\n  return '+' + formatPhoneNumber(phone).formatted;\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport numberThousandSplitter from '../../helpers/number/numberThousandSplitter';\nimport {Chat, ChatParticipants} from '../../layer';\nimport {i18n, LangPackKey} from '../../lib/langPack';\nimport rootScope from '../../lib/rootScope';\n\nexport default async function getChatMembersString(chatId: ChatId, managers = rootScope.managers) {\n  const chat: Chat = await managers.appChatsManager.getChat(chatId);\n  if(chat._ === 'chatForbidden') {\n    return i18n('YouWereKicked');\n  }\n\n  const chatFull = await managers.appProfileManager.getCachedFullChat(chatId);\n  let count: number;\n  if(chatFull) {\n    if(chatFull._ === 'channelFull') {\n      count = chatFull.participants_count;\n    } else {\n      count = (chatFull.participants as ChatParticipants.chatParticipants).participants?.length;\n    }\n  } else {\n    count = (chat as Chat.chat).participants_count || (chat as any).participants?.participants.length;\n  }\n\n  const isBroadcast = (chat as Chat.channel).pFlags.broadcast;\n  count = count || 1;\n\n  const key: LangPackKey = isBroadcast ? 'Peer.Status.Subscribers' : 'Peer.Status.Member';\n  return i18n(key, [numberThousandSplitter(count)]);\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport limitSymbols from '../../helpers/string/limitSymbols';\nimport {Chat} from '../../layer';\nimport {AppManagers} from '../../lib/appManagers/managers';\nimport I18n from '../../lib/langPack';\nimport wrapEmojiText from '../../lib/richTextProcessor/wrapEmojiText';\nimport rootScope from '../../lib/rootScope';\n\nexport default async function getPeerTitle(peerId: PeerId, plainText: true, onlyFirstName?: boolean, _limitSymbols?: number, managers?: AppManagers): Promise<string>;\nexport default async function getPeerTitle(peerId: PeerId, plainText?: false, onlyFirstName?: boolean, _limitSymbols?: number, managers?: AppManagers): Promise<DocumentFragment>;\nexport default async function getPeerTitle(peerId: PeerId, plainText: boolean, onlyFirstName?: boolean, _limitSymbols?: number, managers?: AppManagers): Promise<DocumentFragment | string>;\nexport default async function getPeerTitle(peerId: PeerId, plainText = false, onlyFirstName = false, _limitSymbols?: number, managers: AppManagers = rootScope.managers): Promise<DocumentFragment | string> {\n  if(!peerId) {\n    peerId = rootScope.myId;\n  }\n\n  let title = '';\n  if(peerId.isUser()) {\n    const user = await managers.appUsersManager.getUser(peerId.toUserId());\n    if(user.first_name) title += user.first_name;\n    if(user.last_name && (!onlyFirstName || !title)) title += ' ' + user.last_name;\n\n    if(!title) title = user.pFlags.deleted ? I18n.format(onlyFirstName ? 'Deleted' : 'HiddenName', true) : user.username;\n    else title = title.trim();\n  } else {\n    const chat: Chat.chat = await managers.appChatsManager.getChat(peerId.toChatId());\n    title = chat.title;\n\n    if(onlyFirstName) {\n      title = title.split(' ')[0];\n    }\n  }\n\n  if(_limitSymbols !== undefined) {\n    title = limitSymbols(title, _limitSymbols, _limitSymbols);\n  }\n\n  return plainText ? title : wrapEmojiText(title);\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport {formatFullSentTimeRaw} from '../../helpers/date';\nimport {User} from '../../layer';\nimport {LangPackKey, i18n} from '../../lib/langPack';\nimport {REPLIES_PEER_ID, SERVICE_PEER_ID} from '../../lib/mtproto/mtproto_config';\n\nexport default function getUserStatusString(user: User.user): HTMLElement {\n  if(!user) {\n    return document.createElement('span');\n  }\n\n  let key: LangPackKey;\n  let args: any[];\n\n  switch(user.id) {\n    case REPLIES_PEER_ID.toUserId():\n      key = 'Peer.RepliesNotifications';\n      break;\n    case SERVICE_PEER_ID.toUserId():\n      key = 'Peer.ServiceNotifications';\n      break;\n    default: {\n      if(user.pFlags.bot) {\n        key = 'Bot';\n        break;\n      }\n\n      if(user.pFlags.support) {\n        key = 'SupportStatus';\n        break;\n      }\n\n      switch(user.status?._) {\n        case 'userStatusRecently': {\n          key = 'Lately';\n          break;\n        }\n\n        case 'userStatusLastWeek': {\n          key = 'WithinAWeek';\n          break;\n        }\n\n        case 'userStatusLastMonth': {\n          key = 'WithinAMonth';\n          break;\n        }\n\n        case 'userStatusOffline': {\n          const date = user.status.was_online;\n          const today = new Date();\n          const now = today.getTime() / 1000 | 0;\n\n          const diff = now - date;\n          if(diff < 60) {\n            key = 'Peer.Status.justNow';\n          } else if(diff < 3600) {\n            key = 'Peer.Status.minAgo';\n            const c = diff / 60 | 0;\n            args = [c];\n          } else if(diff < 86400 && today.getDate() === new Date(date * 1000).getDate()) {\n            key = 'LastSeen.HoursAgo';\n            const c = diff / 3600 | 0;\n            args = [c];\n          } else {\n            key = 'Peer.Status.LastSeenAt';\n            const {dateEl, timeEl} = formatFullSentTimeRaw(date);\n            args = [dateEl, timeEl];\n          }\n\n          break;\n        }\n\n        case 'userStatusOnline': {\n          key = 'Online';\n          break;\n        }\n\n        default: {\n          key = 'ALongTimeAgo';\n          break;\n        }\n      }\n\n      break;\n    }\n  }\n\n  return i18n(key, args);\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport {Message, MessageAction} from '../../layer';\nimport wrapUrl from '../../lib/richTextProcessor/wrapUrl';\n\nexport default function wrapJoinVoiceChatAnchor(message: Message.messageService) {\n  const action = message.action as MessageAction.messageActionInviteToGroupCall;\n  const {onclick, url} = wrapUrl(`tg://voicechat?chat_id=${message.peerId.toChatId()}&id=${action.call.id}&access_hash=${action.call.access_hash}`);\n  if(!onclick) {\n    return document.createElement('span');\n  }\n\n  const a = document.createElement('a');\n  a.href = url;\n  a.setAttribute('onclick', onclick + '(this)');\n\n  return a;\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport indexOfAndSplice from '../../helpers/array/indexOfAndSplice';\nimport {formatTime} from '../../helpers/date';\nimport htmlToSpan from '../../helpers/dom/htmlToSpan';\nimport setInnerHTML from '../../helpers/dom/setInnerHTML';\nimport formatCallDuration from '../../helpers/formatCallDuration';\nimport paymentsWrapCurrencyAmount from '../../helpers/paymentsWrapCurrencyAmount';\nimport {Message, MessageAction} from '../../layer';\nimport {MyMessage} from '../../lib/appManagers/appMessagesManager';\nimport getPeerId from '../../lib/appManagers/utils/peers/getPeerId';\nimport I18n, {FormatterArgument, FormatterArguments, i18n, join, langPack, LangPackKey, _i18n} from '../../lib/langPack';\nimport wrapEmojiText from '../../lib/richTextProcessor/wrapEmojiText';\nimport wrapPlainText from '../../lib/richTextProcessor/wrapPlainText';\nimport wrapRichText from '../../lib/richTextProcessor/wrapRichText';\nimport rootScope from '../../lib/rootScope';\nimport PeerTitle from '../peerTitle';\nimport getPeerTitle from './getPeerTitle';\nimport wrapJoinVoiceChatAnchor from './joinVoiceChatAnchor';\nimport wrapMessageForReply from './messageForReply';\n\nasync function wrapLinkToMessage(message: Message.message | Message.messageService, plain?: boolean) {\n  const a = document.createElement('i');\n  a.dataset.savedFrom = message.peerId + '_' + message.mid;\n  a.dir = 'auto';\n  a.append(await wrapMessageForReply(message, undefined, undefined, plain as any));\n  return a;\n}\n\nexport default async function wrapMessageActionTextNewUnsafe(message: MyMessage, plain?: boolean) {\n  const element: HTMLElement = plain ? undefined : document.createElement('span');\n  const action = 'action' in message && message.action;\n\n  // this.log('message action:', action);\n\n  if((action as MessageAction.messageActionCustomAction).message) {\n    const unsafeMessage = (action as MessageAction.messageActionCustomAction).message;\n    if(plain) {\n      return wrapPlainText(unsafeMessage);\n    } else {\n      setInnerHTML(element, wrapRichText(unsafeMessage, {noLinebreaks: true}));\n      return element;\n    }\n  } else {\n    let _ = action._;\n    // let suffix = '';\n    let langPackKey: LangPackKey;\n    let args: Array<FormatterArgument | Promise<FormatterArgument>>;\n\n    const managers = rootScope.managers;\n\n    const getNameDivHTML = async(peerId: PeerId, plain: boolean) => {\n      return plain ? getPeerTitle(peerId, plain) : (new PeerTitle({peerId})).element;\n    };\n\n    switch(action._) {\n      case 'messageActionPhoneCall': {\n        _ += '.' + (action as any).type;\n\n        args = [formatCallDuration(action.duration, plain)];\n        break;\n      }\n\n      case 'messageActionGroupCall': {\n        _ += '.' + (action as any).type;\n\n        args = [];\n        if(!_.endsWith('You') && !message.pFlags.post) {\n          args.push(getNameDivHTML(message.fromId, plain));\n        }\n\n        if(action.duration !== undefined) {\n          args.push(formatCallDuration(action.duration, plain));\n        } else {\n          args.push(wrapJoinVoiceChatAnchor(message as any));\n        }\n\n        break;\n      }\n\n      case 'messageActionInviteToGroupCall': {\n        const peerIds = [message.fromId, action.users[0].toPeerId()];\n        let a = 'Chat.Service.VoiceChatInvitation';\n        const myId = rootScope.myId;\n        if(peerIds[0] === myId) a += 'ByYou';\n        else if(peerIds[1] === myId) a += 'ForYou';\n        indexOfAndSplice(peerIds, myId);\n\n        langPackKey = a as LangPackKey;\n        args = peerIds.map((peerId) => getNameDivHTML(peerId, plain));\n        args.push(wrapJoinVoiceChatAnchor(message as any));\n        break;\n      }\n\n      case 'messageActionGroupCallScheduled': {\n        const today = new Date();\n        const date = new Date(action.schedule_date * 1000);\n        const daysToStart = (date.getTime() - today.getTime()) / 86400e3;\n        const tomorrowDate = new Date(today);\n        tomorrowDate.setDate(tomorrowDate.getDate() + 1);\n\n        const isBroadcast = await managers.appPeersManager.isBroadcast(message.peerId);\n        langPackKey = isBroadcast ? 'ChatList.Service.VoiceChatScheduled.Channel' : 'ChatList.Service.VoiceChatScheduled';\n        args = [];\n        const myId = rootScope.myId;\n        if(message.fromId === myId) {\n          langPackKey += 'You';\n        } else if(!isBroadcast) {\n          args.push(getNameDivHTML(message.fromId, plain));\n        }\n\n        let k: LangPackKey;\n        const _args: FormatterArguments = [];\n        if(daysToStart < 1 && date.getDate() === today.getDate()) {\n          k = 'TodayAtFormattedWithToday';\n        } else if(daysToStart < 2 && date.getDate() === tomorrowDate.getDate()) {\n          k = 'Time.TomorrowAt';\n        } else {\n          k = 'formatDateAtTime';\n          _args.push(new I18n.IntlDateElement({\n            date,\n            options: {\n              day: '2-digit',\n              month: '2-digit',\n              year: '2-digit'\n            }\n          }).element);\n        }\n\n        _args.push(formatTime(date));\n        const t = i18n(k, _args);\n        args.push(t);\n\n        break;\n      }\n\n      case 'messageActionChatCreate': {\n        const myId = rootScope.myId;\n        if(message.fromId === myId) {\n          _ += 'You';\n        } else {\n          args = [getNameDivHTML(message.fromId, plain)];\n        }\n\n        break;\n      }\n\n      case 'messageActionPinMessage': {\n        const peerId = message.peerId;\n        const pinnedMessage = await managers.appMessagesManager.getMessageByPeer(peerId, message.reply_to_mid);\n\n        args = [\n          getNameDivHTML(message.fromId, plain)\n        ];\n\n        if(!pinnedMessage/*  || true */) {\n          langPackKey = 'ActionPinnedNoText';\n\n          if(message.reply_to_mid) { // refresh original message\n            managers.appMessagesManager.fetchMessageReplyTo(message);\n          }\n        } else {\n          args.push(wrapLinkToMessage(pinnedMessage, plain));\n        }\n\n        break;\n      }\n\n      case 'messageActionChatJoinedByRequest': {\n        const isBroadcast = await managers.appPeersManager.isBroadcast(message.peerId);\n        if(message.pFlags.out) {\n          langPackKey = isBroadcast ? 'RequestToJoinChannelApproved' : 'RequestToJoinGroupApproved';\n        } else {\n          langPackKey = isBroadcast ? 'ChatService.UserJoinedChannelByRequest' : 'ChatService.UserJoinedGroupByRequest';\n          args = [getNameDivHTML(message.fromId, plain)];\n        }\n        break;\n      }\n\n      case 'messageActionContactSignUp':\n      case 'messageActionChatReturn':\n      case 'messageActionChatLeave':\n      case 'messageActionChatJoined':\n      case 'messageActionChatEditPhoto':\n      case 'messageActionChatDeletePhoto':\n      case 'messageActionChatEditVideo':\n      case 'messageActionChatJoinedByLink':\n      case 'messageActionChannelEditVideo':\n      case 'messageActionChannelDeletePhoto': {\n        args = [getNameDivHTML(message.fromId, plain)];\n        break;\n      }\n\n      case 'messageActionChannelEditTitle':\n      case 'messageActionChatEditTitle': {\n        args = [];\n        if(action._ === 'messageActionChatEditTitle') {\n          args.push(getNameDivHTML(message.fromId, plain));\n        }\n\n        args.push(plain ? action.title : htmlToSpan(wrapEmojiText(action.title)));\n        break;\n      }\n\n      case 'messageActionChatDeleteUser':\n      case 'messageActionChatAddUsers':\n      case 'messageActionChatAddUser': {\n        const users = (action as MessageAction.messageActionChatAddUser).users ||\n          [(action as MessageAction.messageActionChatDeleteUser).user_id];\n\n        args = [getNameDivHTML(message.fromId, plain)];\n\n        if(users.length > 1) {\n          const joined = join(\n            await Promise.all(users.map((userId: UserId) => getNameDivHTML(userId.toPeerId(), plain))),\n            false,\n            plain\n          );\n\n          if(plain) {\n            args.push(...joined);\n          } else {\n            const fragment = document.createElement('span');\n            fragment.append(...joined);\n            args.push(fragment);\n          }\n        } else {\n          args.push(getNameDivHTML(users[0].toPeerId(), plain));\n        }\n\n        break;\n      }\n\n      case 'messageActionBotAllowed': {\n        const anchorHTML = wrapRichText(action.domain, {\n          entities: [{\n            _: 'messageEntityUrl',\n            length: action.domain.length,\n            offset: 0\n          }]\n        });\n\n        const node = htmlToSpan(anchorHTML);\n\n        args = [node];\n        break;\n      }\n\n      case 'messageActionPaymentSent': {\n        const isRecurringInit = action.pFlags.recurring_init;\n        const isRecurringUsed = action.pFlags.recurring_used;\n        langPackKey = isRecurringUsed ? 'Chat.Service.PaymentSentRecurringUsedNoTitle' : (isRecurringInit ? 'Chat.Service.PaymentSentRecurringInitNoTitle' : 'Chat.Service.PaymentSent1NoTitle');\n        const price = paymentsWrapCurrencyAmount(action.total_amount, action.currency);\n        args = [price, getNameDivHTML(message.peerId, plain)];\n\n        if(message.reply_to_mid) {\n          const invoiceMessage = await managers.appMessagesManager.getMessageByPeer(\n            message.reply_to?.reply_to_peer_id ? getPeerId(message.reply_to.reply_to_peer_id) : message.peerId,\n            message.reply_to_mid\n          );\n\n          if(!invoiceMessage) {\n            managers.appMessagesManager.fetchMessageReplyTo(message);\n          } else {\n            langPackKey = isRecurringUsed ? 'Chat.Service.PaymentSentRecurringUsed' : (isRecurringInit ? 'Chat.Service.PaymentSentRecurringInit' : 'Chat.Service.PaymentSent1');\n            args.push(wrapLinkToMessage(invoiceMessage, plain).then((el) => {\n              el.classList.add('is-receipt-link');\n              return el;\n            }));\n          }\n        }\n\n        break;\n      }\n\n      default:\n        langPackKey = (langPack[_] || `[${action._}]`) as any;\n        break;\n    }\n\n    if(!langPackKey) {\n      langPackKey = langPack[_];\n      if(langPackKey === undefined) {\n        langPackKey = '[' + _ + ']' as any;\n      }\n    }\n\n    const waited = args && await Promise.all(args);\n\n    if(plain) {\n      return I18n.format(langPackKey, true, waited);\n    } else {\n      return _i18n(element, langPackKey, waited);\n    }\n\n    // str = !langPackKey || langPackKey[0].toUpperCase() === langPackKey[0] ? langPackKey : getNameDivHTML(message.fromId) + langPackKey + (suffix ? ' ' : '');\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport {MyMessage} from '../../lib/appManagers/appMessagesManager';\nimport wrapMessageActionTextNewUnsafe from './messageActionTextNewUnsafe';\n\nexport default async function wrapMessageActionTextNew(message: MyMessage, plain: true): Promise<string>;\nexport default async function wrapMessageActionTextNew(message: MyMessage, plain?: false): Promise<HTMLElement>;\nexport default async function wrapMessageActionTextNew(message: MyMessage, plain: boolean): Promise<HTMLElement | string>;\nexport default async function wrapMessageActionTextNew(message: MyMessage, plain?: boolean): Promise<HTMLElement | string> {\n  try {\n    return await wrapMessageActionTextNewUnsafe(message, plain);\n  } catch(err) {\n    console.error('wrapMessageActionTextNewUnsafe error:', err);\n    return plain ? '' : document.createElement('span');\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport assumeType from '../../helpers/assumeType';\nimport htmlToDocumentFragment from '../../helpers/dom/htmlToDocumentFragment';\nimport {getRestrictionReason} from '../../helpers/restrictions';\nimport escapeRegExp from '../../helpers/string/escapeRegExp';\nimport limitSymbols from '../../helpers/string/limitSymbols';\nimport {Message, DocumentAttribute} from '../../layer';\nimport {MyDocument} from '../../lib/appManagers/appDocsManager';\nimport {MyDraftMessage} from '../../lib/appManagers/appDraftsManager';\nimport {MyMessage} from '../../lib/appManagers/appMessagesManager';\nimport isMessageRestricted from '../../lib/appManagers/utils/messages/isMessageRestricted';\nimport I18n, {LangPackKey, i18n, UNSUPPORTED_LANG_PACK_KEY} from '../../lib/langPack';\nimport sortEntities from '../../lib/richTextProcessor/sortEntities';\nimport wrapEmojiText from '../../lib/richTextProcessor/wrapEmojiText';\nimport wrapPlainText from '../../lib/richTextProcessor/wrapPlainText';\nimport wrapRichText from '../../lib/richTextProcessor/wrapRichText';\nimport rootScope from '../../lib/rootScope';\nimport wrapMessageActionTextNew from './messageActionTextNew';\n\nexport default async function wrapMessageForReply(message: MyMessage | MyDraftMessage, text: string, usingMids: number[], plain: true, highlightWord?: string, withoutMediaType?: boolean): Promise<string>;\nexport default async function wrapMessageForReply(message: MyMessage | MyDraftMessage, text?: string, usingMids?: number[], plain?: false, highlightWord?: string, withoutMediaType?: boolean): Promise<DocumentFragment>;\nexport default async function wrapMessageForReply(message: MyMessage | MyDraftMessage, text: string = (message as Message.message).message, usingMids?: number[], plain?: boolean, highlightWord?: string, withoutMediaType?: boolean): Promise<DocumentFragment | string> {\n  const parts: (Node | string)[] = [];\n\n  let hasAlbumKey = false;\n  const addPart = (langKey: LangPackKey, part?: string | HTMLElement | DocumentFragment) => {\n    if(langKey) {\n      if(part === undefined && hasAlbumKey) {\n        return;\n      }\n\n      part = plain ? I18n.format(langKey, true) : i18n(langKey);\n    }\n\n    if(plain) {\n      parts.push(part);\n    } else {\n      const el = document.createElement('i');\n      if(typeof(part) === 'string') el.innerHTML = part;\n      else el.append(part);\n      parts.push(el);\n    }\n  };\n\n  const managers = rootScope.managers;\n  const appMessagesManager = managers.appMessagesManager;\n\n  const isRestricted = isMessageRestricted(message as any);\n\n  let entities = (message as Message.message).totalEntities;\n  if((message as Message.message).media && !isRestricted) {\n    assumeType<Message.message>(message);\n    let usingFullAlbum = true;\n    if(message.grouped_id) {\n      if(usingMids) {\n        const mids = await appMessagesManager.getMidsByMessage(message);\n        if(usingMids.length === mids.length) {\n          for(const mid of mids) {\n            if(!usingMids.includes(mid)) {\n              usingFullAlbum = false;\n              break;\n            }\n          }\n        } else {\n          usingFullAlbum = false;\n        }\n      }\n\n      if(usingFullAlbum) {\n        const albumText = await appMessagesManager.getAlbumText(message.grouped_id);\n        text = albumText.message;\n        entities = albumText.totalEntities;\n\n        if(!withoutMediaType) {\n          addPart('AttachAlbum');\n          hasAlbumKey = true;\n        }\n      }\n    } else {\n      usingFullAlbum = false;\n    }\n\n    if((!usingFullAlbum && !withoutMediaType) || !text) {\n      const media = message.media;\n      switch(media._) {\n        case 'messageMediaPhoto':\n          addPart('AttachPhoto');\n          break;\n        case 'messageMediaDice':\n          addPart(undefined, plain ? media.emoticon : wrapEmojiText(media.emoticon));\n          break;\n        case 'messageMediaVenue': {\n          text = media.title;\n          addPart('AttachLocation');\n          break;\n        }\n        case 'messageMediaGeo':\n          addPart('AttachLocation');\n          break;\n        case 'messageMediaGeoLive':\n          addPart('AttachLiveLocation');\n          break;\n        case 'messageMediaPoll':\n          const f = '' + ' ' + (media.poll.question || 'poll');\n          addPart(undefined, plain ? f : wrapEmojiText(f));\n          break;\n        case 'messageMediaContact':\n          addPart('AttachContact');\n          break;\n        case 'messageMediaGame': {\n          const f = '' + ' ' + media.game.title;\n          addPart(undefined, plain ? f : wrapEmojiText(f));\n          break;\n        }\n        case 'messageMediaDocument': {\n          const document = media.document as MyDocument;\n\n          if(document.type === 'video') {\n            addPart('AttachVideo');\n          } else if(document.type === 'voice') {\n            addPart('AttachAudio');\n          } else if(document.type === 'gif') {\n            addPart('AttachGif');\n          } else if(document.type === 'round') {\n            addPart('AttachRound');\n          } else if(document.type === 'sticker') {\n            const i = parts.length;\n            if(document.stickerEmojiRaw) {\n              const f = document.stickerEmojiRaw + ' ';\n              addPart(undefined, plain ? f : wrapEmojiText(f));\n            }\n\n            addPart('AttachSticker');\n\n            // will combine two parts into one\n            const p = parts.splice(i, 2);\n            if(plain) parts.push((p[0] as string) + (p[1] as string));\n            else {\n              const span = window.document.createElement('span');\n              span.append(...p);\n              parts.push(span);\n            }\n\n            text = '';\n          } else if(document.type === 'audio') {\n            const attribute = document.attributes.find((attribute) => attribute._ === 'documentAttributeAudio' && (attribute.title || attribute.performer)) as DocumentAttribute.documentAttributeAudio;\n            const f = '' + ' ' + (attribute ? [attribute.title, attribute.performer].filter(Boolean).join(' - ') : document.file_name);\n            addPart(undefined, plain ? f : wrapEmojiText(f));\n          } else {\n            addPart(undefined, plain ? document.file_name : wrapEmojiText(document.file_name));\n          }\n\n          break;\n        }\n\n        case 'messageMediaInvoice': {\n          addPart(undefined, plain ? media.title : wrapEmojiText(media.title));\n          break;\n        }\n\n        case 'messageMediaUnsupported': {\n          addPart(UNSUPPORTED_LANG_PACK_KEY);\n          break;\n        }\n\n        default:\n          // messageText += media._;\n          // /////appMessagesManager.log.warn('Got unknown media type!', message);\n          break;\n      }\n    }\n\n    const length = parts.length;\n    for(let i = 1; i < length; i += 2) {\n      parts.splice(i, 0, ', ');\n    }\n\n    if(text && length) {\n      parts.push(', ');\n    }\n  }\n\n  if((message as Message.messageService).action) {\n    const actionWrapped = await wrapMessageActionTextNew((message as Message.messageService), plain);\n    if(actionWrapped) {\n      addPart(undefined, actionWrapped);\n    }\n  }\n\n  if(isRestricted) {\n    text = getRestrictionReason((message as Message.message).restriction_reason).text;\n    entities = [];\n  }\n\n  if(text) {\n    text = limitSymbols(text, 100);\n\n    if(!entities) {\n      entities = [];\n    }\n\n    if(plain) {\n      parts.push(wrapPlainText(text, entities));\n    } else {\n      // let entities = parseEntities(text.replace(/\\n/g, ' '));\n\n      if(highlightWord) {\n        highlightWord = highlightWord.trim();\n        let found = false;\n        let match: any;\n        const regExp = new RegExp(escapeRegExp(highlightWord), 'gi');\n        entities = entities.slice(); // fix leaving highlight entity\n        while((match = regExp.exec(text)) !== null) {\n          entities.push({_: 'messageEntityHighlight', length: highlightWord.length, offset: match.index});\n          found = true;\n        }\n\n        if(found) {\n          sortEntities(entities);\n        }\n      }\n\n      const messageWrapped = wrapRichText(text, {\n        noLinebreaks: true,\n        entities,\n        noLinks: true,\n        noTextFormat: true\n      });\n\n      parts.push(htmlToDocumentFragment(messageWrapped));\n    }\n  }\n\n  if(plain) {\n    return parts.join('');\n  } else {\n    const fragment = document.createDocumentFragment();\n    fragment.append(...parts);\n    return fragment;\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport PeerTitle, {PeerTitleOptions} from '../peerTitle';\n\nexport default async function wrapPeerTitle(options: PeerTitleOptions) {\n  const peerTitle = new PeerTitle();\n  await peerTitle.update(options);\n  return peerTitle.element;\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport {MyMessage} from '../../lib/appManagers/appMessagesManager';\nimport getMessageSenderPeerIdOrName from '../../lib/appManagers/utils/messages/getMessageSenderPeerIdOrName';\nimport {i18n} from '../../lib/langPack';\nimport rootScope from '../../lib/rootScope';\nimport PeerTitle from '../peerTitle';\n\nexport default async function wrapSenderToPeer(message: MyMessage) {\n  const senderTitle: HTMLElement = document.createElement('span');\n  senderTitle.classList.add('sender-title');\n\n  const fromMe = message.fromId === rootScope.myId && message.peerId !== rootScope.myId;\n  senderTitle.append(\n    fromMe ?\n      i18n('FromYou') :\n      new PeerTitle({\n        ...getMessageSenderPeerIdOrName(message),\n        dialog: message.peerId === rootScope.myId\n      }).element\n  );\n\n  if(await rootScope.managers.appPeersManager.isAnyGroup(message.peerId) || fromMe) {\n    const peerTitle = new PeerTitle({peerId: message.peerId}).element;\n    senderTitle.append('  ', peerTitle);\n  }\n\n  return senderTitle;\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport {formatDateAccordingToTodayNew} from '../../helpers/date';\nimport {MyMessage} from '../../lib/appManagers/appMessagesManager';\n\nexport default function wrapSentTime(message: MyMessage) {\n  const el: HTMLElement = document.createElement('span');\n  el.classList.add('sent-time');\n  el.append(formatDateAccordingToTodayNew(new Date(message.date * 1000)));\n\n  return el;\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport IS_WEBP_SUPPORTED from '../../environment/webpSupport';\nimport assumeType from '../../helpers/assumeType';\nimport getPathFromBytes from '../../helpers/bytes/getPathFromBytes';\nimport deferredPromise from '../../helpers/cancellablePromise';\nimport computeLockColor from '../../helpers/computeLockColor';\nimport cancelEvent from '../../helpers/dom/cancelEvent';\nimport {attachClickEvent} from '../../helpers/dom/clickEvent';\nimport createVideo from '../../helpers/dom/createVideo';\nimport findUpClassName from '../../helpers/dom/findUpClassName';\nimport renderImageFromUrl from '../../helpers/dom/renderImageFromUrl';\nimport getImageFromStrippedThumb from '../../helpers/getImageFromStrippedThumb';\nimport getPreviewURLFromThumb from '../../helpers/getPreviewURLFromThumb';\nimport makeError from '../../helpers/makeError';\nimport {makeMediaSize} from '../../helpers/mediaSize';\nimport mediaSizes from '../../helpers/mediaSizes';\nimport noop from '../../helpers/noop';\nimport onMediaLoad from '../../helpers/onMediaLoad';\nimport {isSavingLottiePreview, saveLottiePreview} from '../../helpers/saveLottiePreview';\nimport throttle from '../../helpers/schedulers/throttle';\nimport sequentialDom from '../../helpers/sequentialDom';\nimport {PhotoSize, VideoSize} from '../../layer';\nimport {MyDocument} from '../../lib/appManagers/appDocsManager';\nimport appDownloadManager from '../../lib/appManagers/appDownloadManager';\nimport appImManager from '../../lib/appManagers/appImManager';\nimport {AppManagers} from '../../lib/appManagers/managers';\nimport getServerMessageId from '../../lib/appManagers/utils/messageId/getServerMessageId';\nimport choosePhotoSize from '../../lib/appManagers/utils/photos/choosePhotoSize';\nimport getStickerEffectThumb from '../../lib/appManagers/utils/stickers/getStickerEffectThumb';\nimport lottieLoader from '../../lib/rlottie/lottieLoader';\nimport rootScope from '../../lib/rootScope';\nimport type {ThumbCache} from '../../lib/storages/thumbs';\nimport webpWorkerController from '../../lib/webp/webpWorkerController';\nimport {Awaited, SendMessageEmojiInteractionData} from '../../types';\nimport {getEmojiToneIndex} from '../../vendor/emoji';\nimport animationIntersector, {AnimationItemGroup} from '../animationIntersector';\nimport LazyLoadQueue from '../lazyLoadQueue';\nimport PopupStickers from '../popups/stickers';\nimport {hideToast, toastNew} from '../toast';\nimport wrapStickerAnimation from './stickerAnimation';\n\n// https://github.com/telegramdesktop/tdesktop/blob/master/Telegram/SourceFiles/history/view/media/history_view_sticker.cpp#L40\nexport const STICKER_EFFECT_MULTIPLIER = 1 + 0.245 * 2;\nconst EMOJI_EFFECT_MULTIPLIER = 3;\n\nconst locksUrls: {[docId: string]: string} = {};\n\nexport default async function wrapSticker({doc, div, middleware, loadStickerMiddleware, lazyLoadQueue, exportLoad, group, play, onlyThumb, emoji, width, height, withThumb, loop, loadPromises, needFadeIn, needUpscale, skipRatio, static: asStatic, managers = rootScope.managers, fullThumb, isOut, noPremium, withLock, relativeEffect, loopEffect, isCustomEmoji}: {\n  doc: MyDocument,\n  div: HTMLElement | HTMLElement[],\n  middleware?: () => boolean,\n  loadStickerMiddleware?: () => boolean,\n  lazyLoadQueue?: LazyLoadQueue,\n  exportLoad?: boolean,\n  group?: AnimationItemGroup,\n  play?: boolean,\n  onlyThumb?: boolean,\n  emoji?: string,\n  width?: number,\n  height?: number,\n  withThumb?: boolean,\n  loop?: boolean,\n  loadPromises?: Promise<any>[],\n  needFadeIn?: boolean,\n  needUpscale?: boolean,\n  skipRatio?: number,\n  static?: boolean,\n  managers?: AppManagers,\n  fullThumb?: PhotoSize | VideoSize,\n  isOut?: boolean,\n  noPremium?: boolean,\n  withLock?: boolean,\n  relativeEffect?: boolean,\n  loopEffect?: boolean,\n  isCustomEmoji?: boolean\n}) {\n  div = Array.isArray(div) ? div : [div];\n\n  const stickerType = doc.sticker;\n  if(stickerType === 1) {\n    asStatic = true;\n  }\n\n  if(!width && !height) {\n    const sizes = mediaSizes.active;\n    const boxSize = emoji ? sizes.emojiSticker : (doc.animated ? sizes.animatedSticker : sizes.staticSticker);\n    const size = makeMediaSize(doc.w, doc.h).aspectFitted(boxSize);\n    width = size.width;\n    height = size.height;\n  }\n\n  if(stickerType === 2) {\n    // LottieLoader.loadLottie();\n    lottieLoader.loadLottieWorkers();\n  }\n\n  div.forEach((div) => {\n    div.dataset.docId = '' + doc.id;\n    div.classList.add('media-sticker-wrapper');\n  });\n\n  /* if(stickerType === 3) {\n    const videoRes = wrapVideo({\n      doc,\n      boxWidth: width,\n      boxHeight: height,\n      container: div,\n      group,\n      lazyLoadQueue,\n      middleware,\n      withoutPreloader: true,\n      loadPromises,\n      noPlayButton: true,\n      noInfo: true\n    });\n\n    if(videoRes.thumb) {\n      if(videoRes.thumb.images.thumb) {\n        videoRes.thumb.images.thumb.classList.add('media-sticker', 'thumbnail');\n      }\n\n      if(videoRes.thumb.images.full) {\n        videoRes.thumb.images.full.classList.add('media-sticker');\n      }\n    }\n\n    return videoRes.loadPromise;\n  } */\n\n  // console.log('wrap sticker', doc, div, onlyThumb);\n\n  let cacheContext: ThumbCache;\n  const getCacheContext = async(type: string = cacheContext?.type) => {\n    return cacheContext = await managers.thumbsStorage.getCacheContext(doc, type);\n  };\n\n  const isAnimated = !asStatic && (stickerType === 2 || stickerType === 3);\n\n  const effectThumb = getStickerEffectThumb(doc);\n  if(isOut !== undefined && effectThumb && !isOut) {\n    div.forEach((div) => div.classList.add('reflect-x'));\n  }\n\n  const willHaveLock = effectThumb && withLock;\n  if(willHaveLock) {\n    const lockUrl = locksUrls[doc.id];\n    div.forEach((div) => {\n      div.classList.add('is-premium-sticker', 'tgico-premium_lock');\n      lockUrl && div.style.setProperty('--lock-url', `url(${lockUrl})`);\n    });\n  }\n\n  if(asStatic && stickerType !== 1) {\n    const thumb = choosePhotoSize(doc, width, height, false) as PhotoSize.photoSize;\n    await getCacheContext(thumb.type);\n  } else {\n    await getCacheContext(fullThumb?.type);\n  }\n\n  const toneIndex = emoji ? getEmojiToneIndex(emoji) : -1;\n  const downloaded = cacheContext.downloaded && !needFadeIn;\n\n  const isThumbNeededForType = isAnimated;\n  const lottieCachedThumb = stickerType === 2 || stickerType === 3 ? await managers.appDocsManager.getLottieCachedThumb(doc.id, toneIndex) : undefined;\n\n  const ret = {render: undefined as typeof loadPromise, load: undefined as typeof load};\n  let loadThumbPromise = deferredPromise<void>();\n  let haveThumbCached = false;\n  if((\n    doc.thumbs?.length ||\n      lottieCachedThumb\n  ) &&\n    !div[0].firstElementChild && (\n    !downloaded ||\n      isThumbNeededForType ||\n      onlyThumb\n  ) && withThumb !== false/*  && doc.thumbs[0]._ !== 'photoSizeEmpty' */\n  ) {\n    let thumb = lottieCachedThumb || doc.thumbs[0];\n\n    // console.log('wrap sticker', thumb, div);\n\n    const afterRender = (div: HTMLElement, thumbImage: HTMLElement) => {\n      if(!div.childElementCount) {\n        thumbImage.classList.add('media-sticker', 'thumbnail');\n\n        sequentialDom.mutateElement(div, () => {\n          div.append(thumbImage);\n          loadThumbPromise.resolve();\n        });\n      }\n    };\n\n    if('url' in thumb) {\n      haveThumbCached = true;\n      div.forEach((div) => {\n        const thumbImage = new Image();\n        renderImageFromUrl(thumbImage, (thumb as any).url, () => afterRender(div, thumbImage));\n      });\n    } else if('bytes' in thumb) {\n      if(thumb._ === 'photoPathSize') {\n        if(!thumb.bytes.length) {\n          thumb = doc.thumbs.find((t) => (t as PhotoSize.photoStrippedSize).bytes?.length) || thumb;\n        }\n\n        const d = getPathFromBytes((thumb as PhotoSize.photoStrippedSize).bytes);\n        const ns = 'http://www.w3.org/2000/svg';\n        const svg = document.createElementNS(ns, 'svg');\n        svg.classList.add('rlottie-vector', 'media-sticker', 'thumbnail');\n        svg.setAttributeNS(null, 'viewBox', `0 0 ${doc.w || 512} ${doc.h || 512}`);\n\n        // const defs = document.createElementNS(ns, 'defs');\n        // const linearGradient = document.createElementNS(ns, 'linearGradient');\n        // linearGradient.setAttributeNS(null, 'id', 'g');\n        // linearGradient.setAttributeNS(null, 'x1', '-300%');\n        // linearGradient.setAttributeNS(null, 'x2', '-200%');\n        // linearGradient.setAttributeNS(null, 'y1', '0');\n        // linearGradient.setAttributeNS(null, 'y2', '0');\n        // const stops = [\n        //   ['-10%', '.1'],\n        //   ['30%', '.07'],\n        //   ['70%', '.07'],\n        //   ['110%', '.1']\n        // ].map(([offset, stopOpacity]) => {\n        //   const stop = document.createElementNS(ns, 'stop');\n        //   stop.setAttributeNS(null, 'offset', offset);\n        //   stop.setAttributeNS(null, 'stop-opacity', stopOpacity);\n        //   return stop;\n        // });\n        // const animates = [\n        //   ['-300%', '1200%'],\n        //   ['-200%', '1300%']\n        // ].map(([from, to], idx) => {\n        //   const animate = document.createElementNS(ns, 'animate');\n        //   animate.setAttributeNS(null, 'attributeName', 'x' + (idx + 1));\n        //   animate.setAttributeNS(null, 'from', from);\n        //   animate.setAttributeNS(null, 'to', to);\n        //   animate.setAttributeNS(null, 'dur', '3s');\n        //   animate.setAttributeNS(null, 'repeatCount', 'indefinite');\n        //   return animate;\n        // });\n        // linearGradient.append(...stops, ...animates);\n        // defs.append(linearGradient);\n        // svg.append(defs);\n\n        const path = document.createElementNS(ns, 'path');\n        path.setAttributeNS(null, 'd', d);\n        if(rootScope.settings.animationsEnabled && !isCustomEmoji) path.setAttributeNS(null, 'fill', 'url(#g)');\n        svg.append(path);\n        div.forEach((div, idx) => div.append(idx > 0 ? svg.cloneNode(true) : svg));\n        haveThumbCached = true;\n        loadThumbPromise.resolve();\n      } else if(toneIndex <= 0) {\n        const r = () => {\n          (div as HTMLElement[]).forEach((div) => {\n            const thumbImage = new Image();\n            const url = getPreviewURLFromThumb(doc, thumb as PhotoSize.photoStrippedSize, true);\n            renderImageFromUrl(thumbImage, url, () => afterRender(div, thumbImage));\n          });\n        };\n\n        if((IS_WEBP_SUPPORTED || doc.pFlags.stickerThumbConverted || cacheContext.url)/*  && false */) {\n          haveThumbCached = true;\n          r();\n        } else {\n          haveThumbCached = true;\n          webpWorkerController.convert('main-' + doc.id, thumb.bytes).then((bytes) => {\n            managers.appDocsManager.saveWebPConvertedStrippedThumb(doc.id, bytes);\n            (thumb as PhotoSize.photoStrippedSize).bytes = bytes;\n            doc.pFlags.stickerThumbConverted = true;\n\n            if((middleware && !middleware()) || (div as HTMLElement[])[0].childElementCount) {\n              loadThumbPromise.resolve();\n              return;\n            }\n\n            r();\n          }).catch(() => loadThumbPromise.resolve());\n        }\n      }\n    } else if(((stickerType === 2 && toneIndex <= 0) || stickerType === 3) && (withThumb || onlyThumb)) {\n      const load = async() => {\n        if((div as HTMLElement[])[0].childElementCount || (middleware && !middleware())) {\n          loadThumbPromise.resolve();\n          return;\n        }\n\n        const r = (div: HTMLElement, thumbImage: HTMLElement) => {\n          if(div.childElementCount || (middleware && !middleware())) {\n            loadThumbPromise.resolve();\n            return;\n          }\n\n          renderImageFromUrl(thumbImage, cacheContext.url, () => afterRender(div, thumbImage));\n        };\n\n        await getCacheContext();\n        (div as HTMLElement[]).forEach((div) => {\n          if(cacheContext.url) {\n            r(div, new Image());\n          } else if('bytes' in thumb) {\n            const res = getImageFromStrippedThumb(doc, thumb as PhotoSize.photoStrippedSize, true);\n            res.loadPromise.then(() => r(div, res.image));\n\n            // return managers.appDocsManager.getThumbURL(doc, thumb as PhotoSize.photoStrippedSize).promise.then(r);\n          } else {\n            appDownloadManager.downloadMediaURL({\n              media: doc,\n              thumb: thumb as PhotoSize\n            }).then(async() => {\n              await getCacheContext();\n              return r(div, new Image());\n            });\n          }\n        });\n      };\n\n      if(lazyLoadQueue && onlyThumb) {\n        lazyLoadQueue.push({div: div[0], load});\n        loadThumbPromise.resolve();\n        return ret;\n      } else {\n        load();\n\n        if((thumb as any).url) {\n          haveThumbCached = true;\n        }\n      }\n    }\n  }\n\n  if(loadPromises && haveThumbCached) {\n    loadPromises.push(loadThumbPromise);\n  }\n\n  if(onlyThumb/*  || true */) { // for sticker panel\n    return ret;\n  }\n\n  const middlewareError = makeError('MIDDLEWARE');\n  const load = async() => {\n    if(middleware && !middleware()) {\n      throw middlewareError;\n    }\n\n    if(stickerType === 2 && !asStatic) {\n      return appDownloadManager.downloadMedia({media: doc, queueId: lazyLoadQueue?.queueId, thumb: fullThumb})\n      .then(async(blob) => {\n        if(middleware && !middleware()) {\n          throw middlewareError;\n        }\n\n        const animation = await lottieLoader.loadAnimationWorker({\n          container: (div as HTMLElement[])[0],\n          loop: loop && !emoji,\n          autoplay: play,\n          animationData: blob,\n          width,\n          height,\n          name: 'doc' + doc.id,\n          needUpscale,\n          skipRatio,\n          toneIndex,\n          sync: isCustomEmoji\n        }, group, loadStickerMiddleware ?? middleware);\n\n        // const deferred = deferredPromise<void>();\n\n        const setLockColor = willHaveLock ? () => {\n          const lockUrl = locksUrls[doc.id] ??= computeLockColor(animation.canvas[0]);\n          (div as HTMLElement[]).forEach((div) => div.style.setProperty('--lock-url', `url(${lockUrl})`));\n        } : undefined;\n\n        const onFirstFrame = (container: HTMLElement, canvas: HTMLCanvasElement) => {\n          const element = container.firstElementChild;\n          if(needFadeIn !== false) {\n            needFadeIn = (needFadeIn || !element || element.tagName === 'svg') && rootScope.settings.animationsEnabled;\n          }\n\n          const cb = () => {\n            if(element && element !== canvas && element.tagName !== 'DIV') {\n              element.remove();\n            }\n          };\n\n          if(!needFadeIn) {\n            if(element) {\n              sequentialDom.mutate(cb);\n            }\n          } else {\n            sequentialDom.mutate(() => {\n              canvas && canvas.classList.add('fade-in');\n              if(element) {\n                element.classList.add('fade-out');\n              }\n\n              (canvas || element).addEventListener('animationend', () => {\n                sequentialDom.mutate(() => {\n                  canvas && canvas.classList.remove('fade-in');\n                  cb();\n                });\n              }, {once: true});\n            });\n          }\n        };\n\n        animation.addEventListener('firstFrame', () => {\n          const canvas = animation.canvas[0];\n          if(withThumb !== false) {\n            saveLottiePreview(doc, canvas, toneIndex);\n          }\n\n          if(willHaveLock) {\n            setLockColor();\n          }\n\n          if(!isCustomEmoji) {\n            (div as HTMLElement[]).forEach((container, idx) => {\n              onFirstFrame(container, animation.canvas[idx]);\n            });\n          }\n        }, {once: true});\n\n        if(emoji) {\n          const data: SendMessageEmojiInteractionData = {\n            a: [],\n            v: 1\n          };\n\n          let sendInteractionThrottled: () => void;\n\n          managers.appStickersManager.preloadAnimatedEmojiStickerAnimation(emoji);\n\n          const container = (div as HTMLElement[])[0];\n          attachClickEvent(container, async(e) => {\n            cancelEvent(e);\n            const animation = lottieLoader.getAnimation(container);\n\n            if(animation.paused) {\n              const doc = await managers.appStickersManager.getAnimatedEmojiSoundDocument(emoji);\n              if(doc) {\n                const audio = document.createElement('audio');\n                audio.style.display = 'none';\n                container.parentElement.append(audio);\n\n                try {\n                  const url = await appDownloadManager.downloadMediaURL({media: doc});\n\n                  audio.src = url;\n                  audio.play();\n                  await onMediaLoad(audio, undefined, true);\n\n                  audio.addEventListener('ended', () => {\n                    audio.src = '';\n                    audio.remove();\n                  }, {once: true});\n                } catch(err) {\n\n                }\n              }\n\n              animation.autoplay = true;\n              animation.restart();\n            }\n\n            const peerId = appImManager.chat.peerId;\n            if(!peerId.isUser()) {\n              return;\n            }\n\n            const doc = await managers.appStickersManager.getAnimatedEmojiSticker(emoji, true);\n            if(!doc) {\n              return;\n            }\n\n            const {animationDiv} = wrapStickerAnimation({\n              doc,\n              middleware,\n              side: isOut ? 'right' : 'left',\n              size: 280,\n              target: container,\n              play: true,\n              withRandomOffset: true\n            });\n\n            if(isOut !== undefined && !isOut) {\n              animationDiv.classList.add('reflect-x');\n            }\n\n            if(!sendInteractionThrottled) {\n              sendInteractionThrottled = throttle(() => {\n                const length = data.a.length;\n                if(!length) {\n                  return;\n                }\n\n                const firstTime = data.a[0].t;\n\n                data.a.forEach((a) => {\n                  a.t = (a.t - firstTime) / 1000;\n                });\n\n                const bubble = findUpClassName(container, 'bubble');\n                managers.appMessagesManager.setTyping(appImManager.chat.peerId, {\n                  _: 'sendMessageEmojiInteraction',\n                  msg_id: getServerMessageId(+bubble.dataset.mid),\n                  emoticon: emoji,\n                  interaction: {\n                    _: 'dataJSON',\n                    data: JSON.stringify(data)\n                  }\n                }, true);\n\n                data.a.length = 0;\n              }, 1000, false);\n            }\n\n            // using a trick here: simulated event from interlocutor's interaction won't fire ours\n            if(e.isTrusted) {\n              data.a.push({\n                i: 1,\n                t: Date.now()\n              });\n\n              sendInteractionThrottled();\n            }\n          });\n        }\n\n        return animation;\n\n        // return deferred;\n        // await new Promise((resolve) => setTimeout(resolve, 5e3));\n      });\n    } else if(asStatic || stickerType === 3) {\n      const media: HTMLElement[] = (div as HTMLElement[]).map(() => {\n        let media: HTMLElement;\n        if(asStatic) {\n          media = new Image();\n        } else {\n          const video = media = createVideo();\n          video.muted = true;\n          if(play) video.autoplay = true;\n          if(loop) video.loop = true;\n        }\n\n        media.classList.add('media-sticker');\n        return media;\n      });\n\n      const thumbImage = (div as HTMLElement[]).map((div, idx) => (div.firstElementChild as HTMLElement) !== media[idx] && div.firstElementChild) as HTMLElement[];\n      if(needFadeIn !== false) {\n        needFadeIn = (needFadeIn || !downloaded || (asStatic ? thumbImage[0] : (!thumbImage[0] || thumbImage[0].tagName === 'svg'))) && rootScope.settings.animationsEnabled;\n      }\n\n      if(needFadeIn) {\n        media.forEach((media) => media.classList.add('fade-in'));\n      }\n\n      return new Promise<HTMLVideoElement | HTMLImageElement>(async(resolve, reject) => {\n        const r = async() => {\n          if(middleware && !middleware()) {\n            reject(middlewareError);\n            return;\n          }\n\n          const onLoad = (div: HTMLElement, media: HTMLElement, thumbImage: HTMLElement) => {\n            sequentialDom.mutateElement(div, () => {\n              div.append(media);\n              thumbImage && thumbImage.classList.add('fade-out');\n\n              if(stickerType === 3 && !isSavingLottiePreview(doc, toneIndex)) {\n                // const perf = performance.now();\n                assumeType<HTMLVideoElement>(media);\n                const canvas = document.createElement('canvas');\n                canvas.width = width * window.devicePixelRatio;\n                canvas.height = height * window.devicePixelRatio;\n                const ctx = canvas.getContext('2d');\n                ctx.drawImage(media, 0, 0, canvas.width, canvas.height);\n                saveLottiePreview(doc, canvas, toneIndex);\n                // console.log('perf', performance.now() - perf);\n              }\n\n              if(stickerType === 3 && group) {\n                animationIntersector.addAnimation(media as HTMLVideoElement, group);\n              }\n\n              resolve(media as any);\n\n              if(needFadeIn) {\n                media.addEventListener('animationend', () => {\n                  media.classList.remove('fade-in');\n                  thumbImage?.remove();\n                }, {once: true});\n              }\n            });\n          };\n\n          await getCacheContext();\n          media.forEach((media, idx) => {\n            const cb = () => onLoad((div as HTMLElement[])[idx], media, thumbImage[idx]);\n            if(asStatic) {\n              renderImageFromUrl(media, cacheContext.url, cb);\n            } else {\n              (media as HTMLVideoElement).src = cacheContext.url;\n              onMediaLoad(media as HTMLVideoElement).then(cb);\n            }\n          });\n        };\n\n        await getCacheContext();\n        if(cacheContext.url) r();\n        else {\n          let promise: Promise<any>;\n          if(stickerType !== 1 && asStatic) {\n            const thumb = choosePhotoSize(doc, width, height, false) as PhotoSize.photoSize;\n            // promise = managers.appDocsManager.getThumbURL(doc, thumb).promise\n            promise = appDownloadManager.downloadMediaURL({media: doc, thumb, queueId: lazyLoadQueue?.queueId});\n          } else {\n            promise = appDownloadManager.downloadMediaURL({media: doc, queueId: lazyLoadQueue?.queueId});\n          }\n\n          promise.then(r, reject);\n        }\n      });\n    }\n  };\n\n  if(exportLoad && (!downloaded || isAnimated)) {\n    ret.load = load;\n    return ret;\n  }\n\n  const loadPromise: Promise<Awaited<ReturnType<typeof load>> | void> = lazyLoadQueue && (!downloaded || isAnimated) ?\n    (lazyLoadQueue.push({div: div[0], load}), Promise.resolve()) :\n    load();\n\n  if(downloaded && (asStatic/*  || stickerType === 3 */)) {\n    loadThumbPromise = loadPromise as any;\n    if(loadPromises) {\n      loadPromises.push(loadThumbPromise);\n    }\n  }\n\n  if(stickerType === 2 && effectThumb && isOut !== undefined && !noPremium) {\n    attachStickerEffectHandler({\n      container: div[0],\n      doc,\n      managers,\n      middleware,\n      isOut,\n      width,\n      loadPromise,\n      relativeEffect,\n      loopEffect\n    });\n  }\n\n  ret.render = loadPromise as any;\n  return ret;\n}\n\nfunction attachStickerEffectHandler({container, doc, managers, middleware, isOut, width, loadPromise, relativeEffect, loopEffect}: {\n  container: HTMLElement,\n  doc: MyDocument,\n  managers: AppManagers,\n  middleware: () => boolean,\n  isOut: boolean,\n  width: number,\n  loadPromise: Promise<any>,\n  relativeEffect?: boolean,\n  loopEffect?: boolean\n}) {\n  managers.appStickersManager.preloadSticker(doc.id, true);\n\n  let playing = false;\n  attachClickEvent(container, async(e) => {\n    cancelEvent(e);\n    if(playing) {\n      const a = document.createElement('a');\n      a.onclick = () => {\n        hideToast();\n        new PopupStickers(doc.stickerSetInput).show();\n      };\n\n      toastNew({\n        langPackKey: 'Sticker.Premium.Click.Info',\n        langPackArguments: [a]\n      });\n\n      return;\n    }\n\n    playing = true;\n\n    await loadPromise;\n    const {animationDiv, stickerPromise} = wrapStickerAnimation({\n      doc,\n      middleware,\n      side: isOut ? 'right' : 'left',\n      size: width * STICKER_EFFECT_MULTIPLIER,\n      target: container,\n      play: true,\n      fullThumb: getStickerEffectThumb(doc),\n      relativeEffect,\n      loopEffect\n    });\n\n    if(isOut !== undefined && !isOut/*  && !relativeEffect */) {\n      animationDiv.classList.add('reflect-x');\n    }\n\n    stickerPromise.then((player) => {\n      player.addEventListener('destroy', () => {\n        playing = false;\n      });\n    });\n  });\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\n/**\n  * https://core.telegram.org/api/files#vector-thumbnails\n  */\nexport default function getPathFromBytes(bytes: Uint8Array) {\n  const lookup = 'AACAAAAHAAALMAAAQASTAVAAAZaacaaaahaaalmaaaqastava.az0123456789-,';\n\n  let path = 'M';\n  for(let i = 0, length = bytes.length; i < length; ++i) {\n    const num = bytes[i];\n\n    if(num >= (128 + 64)) {\n      path += lookup[num - 128 - 64];\n    } else {\n      if(num >= 128) {\n        path += ',';\n      } else if(num >= 64) {\n        path += '-';\n      }\n      path += '' + (num & 63);\n    }\n  }\n  path += 'z';\n\n  return path;\n}\n","// https://github.com/telegramdesktop/tdesktop/blob/543bfab24a76402992421063f1e6444f347d31fe/Telegram/SourceFiles/boxes/sticker_set_box.cpp#L75\nexport default function computeLockColor(canvas: HTMLCanvasElement) {\n  const context = canvas.getContext('2d');\n  const size = 20 * (canvas.dpr ?? 1);\n  const width = size;\n  const height = size;\n  const skipx = (canvas.width - width) / 2;\n  const margin = 0/*  * (canvas.dpr ?? 1) */;\n  const skipy = canvas.height - height - margin;\n  const imageData = context.getImageData(skipx, skipy, width, height).data;\n  let sr = 0, sg = 0, sb = 0, sa = 0;\n  for(let i = 0; i < imageData.length; i += 4) {\n    sr += imageData[i];\n    sg += imageData[i + 1];\n    sb += imageData[i + 2];\n    sa += imageData[i + 3];\n  }\n\n  const outCanvas = document.createElement('canvas');\n  outCanvas.width = size;\n  outCanvas.height = size;\n  const outContext = outCanvas.getContext('2d');\n  const color = new Uint8ClampedArray([sr * 255 / sa, sg * 255 / sa, sb * 255 / sa, 255]);\n  const rgba = `rgba(${color[0]}, ${color[1]}, ${color[2]}, ${color[3]})`;\n  outContext.fillStyle = rgba;\n  outContext.fillRect(0, 0, outCanvas.width, outCanvas.height);\n  outContext.fillStyle = `rgba(112, 117, 121, 0.3)`;\n  outContext.fillRect(0, 0, outCanvas.width, outCanvas.height);\n  // document.querySelector('.popup-title').append(c);\n  return outCanvas.toDataURL('image/jpeg');\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport IS_VIBRATE_SUPPORTED from '../../environment/vibrateSupport';\nimport assumeType from '../../helpers/assumeType';\nimport isInDOM from '../../helpers/dom/isInDOM';\nimport throttleWithRaf from '../../helpers/schedulers/throttleWithRaf';\nimport windowSize from '../../helpers/windowSize';\nimport {PhotoSize, VideoSize} from '../../layer';\nimport {MyDocument} from '../../lib/appManagers/appDocsManager';\nimport appImManager from '../../lib/appManagers/appImManager';\nimport {AppManagers} from '../../lib/appManagers/managers';\nimport RLottiePlayer from '../../lib/rlottie/rlottiePlayer';\nimport wrapSticker from './sticker';\n\nexport default function wrapStickerAnimation({\n  size,\n  doc,\n  middleware,\n  target,\n  side,\n  skipRatio,\n  play,\n  managers,\n  fullThumb,\n  withRandomOffset,\n  relativeEffect,\n  loopEffect\n}: {\n  size: number,\n  doc: MyDocument,\n  middleware?: () => boolean,\n  target: HTMLElement,\n  side: 'left' | 'center' | 'right',\n  skipRatio?: number,\n  play: boolean,\n  managers?: AppManagers,\n  fullThumb?: PhotoSize | VideoSize,\n  withRandomOffset?: boolean,\n  relativeEffect?: boolean,\n  loopEffect?: boolean\n}) {\n  const animationDiv = document.createElement('div');\n  animationDiv.classList.add('emoji-animation');\n\n  // const size = 280;\n  animationDiv.style.width = size + 'px';\n  animationDiv.style.height = size + 'px';\n\n  let animation: RLottiePlayer;\n  const unmountAnimation = () => {\n    animation?.remove();\n    animationDiv.remove();\n    appImManager.chat.bubbles.scrollable.container.removeEventListener('scroll', onScroll);\n  };\n\n  const stickerPromise = wrapSticker({\n    div: animationDiv,\n    doc,\n    middleware,\n    withThumb: false,\n    needFadeIn: false,\n    loop: !!loopEffect,\n    width: size,\n    height: size,\n    play,\n    group: 'none',\n    skipRatio,\n    managers,\n    fullThumb\n  }).then(({render}) => render).then((_animation) => {\n    assumeType<RLottiePlayer>(_animation);\n    animation = _animation;\n    animation.addEventListener('enterFrame', (frameNo) => {\n      if((!loopEffect && frameNo === animation.maxFrame) || !isInDOM(target)) {\n        unmountAnimation();\n      }\n    });\n\n    if(IS_VIBRATE_SUPPORTED) {\n      animation.addEventListener('firstFrame', () => {\n        navigator.vibrate(100);\n      }, {once: true});\n    }\n\n    return animation;\n  });\n\n  const generateRandomSigned = (max: number) => {\n    const r = Math.random() * max * 2;\n    return r > max ? -r % max : r;\n  };\n\n  const randomOffsetX = withRandomOffset ? generateRandomSigned(16) : 0;\n  const randomOffsetY = withRandomOffset ? generateRandomSigned(4) : 0;\n  const setPosition = () => {\n    if(!isInDOM(target)) {\n      unmountAnimation();\n      return;\n    }\n\n    const rect = target.getBoundingClientRect();\n\n    const factor = rect.width / 200;\n    const stableOffsetX = side === 'center' ? 0 : 16 * (side === 'right' ? 1 : -1) * factor;\n    // const stableOffsetY = side === 'center' ? 0 : -50 * factor;\n    const stableOffsetY = side === 'center' ? 0 : 0 * factor;\n\n    const rectX = side === 'right' ? rect.right : rect.left;\n    const rectY = rect.top;\n\n    const addOffsetX = (side === 'center' ? (rect.width - size) / 2 : (side === 'right' ? -size : 0)) + stableOffsetX + randomOffsetX;\n    const addOffsetY = (side === 'center' || true ? (rect.height - size) / 2 : 0) + stableOffsetY + randomOffsetY;\n    const x = rectX + addOffsetX;\n    const y = rectY + addOffsetY;\n\n    if(y <= -size || y >= windowSize.height) {\n      unmountAnimation();\n      return;\n    }\n\n    if(relativeEffect) {\n      if(side !== 'center') animationDiv.style[side] = Math.abs(stableOffsetX) * -1 + 'px';\n      else animationDiv.style.left = addOffsetX + 'px';\n      animationDiv.style.top = addOffsetY + 'px';\n    } else {\n      animationDiv.style.top = y + 'px';\n      animationDiv.style.left = x + 'px';\n    }\n  };\n\n  const onScroll = throttleWithRaf(setPosition);\n  appImManager.chat.bubbles.scrollable.container.addEventListener('scroll', onScroll);\n\n  setPosition();\n\n  if(relativeEffect) {\n    animationDiv.classList.add('is-relative');\n    target.parentElement.append(animationDiv);\n  } else {\n    appImManager.emojiAnimationContainer.append(animationDiv);\n  }\n\n  return {animationDiv, stickerPromise};\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport {AppManagers} from '../../lib/appManagers/managers';\nimport rootScope from '../../lib/rootScope';\nimport wrapSticker from './sticker'\n\nexport default async function wrapStickerEmoji({emoji, div, width, height, managers = rootScope.managers}: {\n  emoji: string,\n  div: HTMLElement,\n  managers?: AppManagers,\n  width: number,\n  height: number\n}) {\n  const doc = await managers.appStickersManager.getAnimatedEmojiSticker(emoji);\n  if(!doc) {\n    div.classList.add('media-sticker-wrapper');\n    throw new Error('no sticker');\n  }\n\n  return wrapSticker({\n    doc,\n    div,\n    emoji,\n    width,\n    height,\n    loop: false,\n    play: true\n  });\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport limitSymbols from '../../helpers/string/limitSymbols';\nimport {WebPage} from '../../layer';\nimport wrapRichText from '../../lib/richTextProcessor/wrapRichText';\n\nexport default function wrapWebPageDescription(webPage: WebPage.webPage) {\n  const shortDescriptionText = limitSymbols(webPage.description || '', 150, 180);\n  // const siteName = webPage.site_name;\n  // let contextHashtag = '';\n  // if(siteName === 'GitHub') {\n  //   const matches = apiWebPage.url.match(/(https?:\\/\\/github\\.com\\/[^\\/]+\\/[^\\/]+)/);\n  //   if(matches) {\n  //     contextHashtag = matches[0] + '/issues/{1}';\n  //   }\n  // }\n  return wrapRichText(shortDescriptionText/* , {\n    contextSite: siteName || 'external',\n    contextHashtag: contextHashtag\n  } */);\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport limitSymbols from '../../helpers/string/limitSymbols';\nimport {WebPage} from '../../layer';\nimport wrapRichText from '../../lib/richTextProcessor/wrapRichText';\n\nexport default function wrapWebPageTitle(webPage: WebPage.webPage) {\n  let shortTitle = webPage.title || webPage.author || webPage.site_name || '';\n  shortTitle = limitSymbols(shortTitle, 80, 100);\n  return wrapRichText(shortTitle, {noLinks: true, noLinebreaks: true});\n}\n","// Taken from https://core.telegram.org/bots/payments/currencies.json\nexport type Currency = {\n  code: string,\n  title: string,\n  symbol: string,\n  native: string,\n  thousands_sep: string,\n  decimal_sep: string,\n  symbol_left: boolean,\n  space_between: boolean,\n  exp: number,\n  min_amount: string | number,\n  max_amount: string | number\n};\n\nconst Currencies: {[currency: string]: Currency} = {'AED':{'code':'AED', 'title':'United Arab Emirates Dirham', 'symbol':'AED', 'native':'..', 'thousands_sep':',', 'decimal_sep':'.', 'symbol_left':true, 'space_between':true, 'exp':2, 'min_amount':'367', 'max_amount':'3672990'}, 'AFN':{'code':'AFN', 'title':'Afghan Afghani', 'symbol':'AFN', 'native':'', 'thousands_sep':',', 'decimal_sep':'.', 'symbol_left':true, 'space_between':false, 'exp':2, 'min_amount':'8893', 'max_amount':'88930176'}, 'ALL':{'code':'ALL', 'title':'Albanian Lek', 'symbol':'ALL', 'native':'Lek', 'thousands_sep':'.', 'decimal_sep':',', 'symbol_left':false, 'space_between':false, 'exp':2, 'min_amount':'11408', 'max_amount':'114088432'}, 'AMD':{'code':'AMD', 'title':'Armenian Dram', 'symbol':'AMD', 'native':'.', 'thousands_sep':',', 'decimal_sep':'.', 'symbol_left':false, 'space_between':true, 'exp':2, 'min_amount':'41129', 'max_amount':'411293180'}, 'ARS':{'code':'ARS', 'title':'Argentine Peso', 'symbol':'ARS', 'native':'$', 'thousands_sep':'.', 'decimal_sep':',', 'symbol_left':true, 'space_between':true, 'exp':2, 'min_amount':'12503', 'max_amount':'125036607'}, 'AUD':{'code':'AUD', 'title':'Australian Dollar', 'symbol':'AU$', 'native':'$', 'thousands_sep':',', 'decimal_sep':'.', 'symbol_left':true, 'space_between':false, 'exp':2, 'min_amount':'145', 'max_amount':'1451625'}, 'AZN':{'code':'AZN', 'title':'Azerbaijani Manat', 'symbol':'AZN', 'native':'.', 'thousands_sep':' ', 'decimal_sep':',', 'symbol_left':false, 'space_between':true, 'exp':2, 'min_amount':'171', 'max_amount':'1711164'}, 'BAM':{'code':'BAM', 'title':'Bosnia & Herzegovina Convertible Mark', 'symbol':'BAM', 'native':'KM', 'thousands_sep':'.', 'decimal_sep':',', 'symbol_left':false, 'space_between':true, 'exp':2, 'min_amount':'187', 'max_amount':'1873042'}, 'BDT':{'code':'BDT', 'title':'Bangladeshi Taka', 'symbol':'BDT', 'native':'', 'thousands_sep':',', 'decimal_sep':'.', 'symbol_left':true, 'space_between':true, 'exp':2, 'min_amount':'9415', 'max_amount':'94154281'}, 'BGN':{'code':'BGN', 'title':'Bulgarian Lev', 'symbol':'BGN', 'native':'.', 'thousands_sep':' ', 'decimal_sep':',', 'symbol_left':false, 'space_between':true, 'exp':2, 'min_amount':'186', 'max_amount':'1869710'}, 'BND':{'code':'BND', 'title':'Brunei Dollar', 'symbol':'BND', 'native':'$', 'thousands_sep':'.', 'decimal_sep':',', 'symbol_left':true, 'space_between':false, 'exp':2, 'min_amount':'139', 'max_amount':'1399458'}, 'BOB':{'code':'BOB', 'title':'Bolivian Boliviano', 'symbol':'BOB', 'native':'Bs', 'thousands_sep':'.', 'decimal_sep':',', 'symbol_left':true, 'space_between':true, 'exp':2, 'min_amount':'692', 'max_amount':'6926834'}, 'BRL':{'code':'BRL', 'title':'Brazilian Real', 'symbol':'R$', 'native':'R$', 'thousands_sep':'.', 'decimal_sep':',', 'symbol_left':true, 'space_between':true, 'exp':2, 'min_amount':'518', 'max_amount':'5182986'}, 'CAD':{'code':'CAD', 'title':'Canadian Dollar', 'symbol':'CA$', 'native':'$', 'thousands_sep':',', 'decimal_sep':'.', 'symbol_left':true, 'space_between':false, 'exp':2, 'min_amount':'129', 'max_amount':'1290450'}, 'CHF':{'code':'CHF', 'title':'Swiss Franc', 'symbol':'CHF', 'native':'CHF', 'thousands_sep':'\\'', 'decimal_sep':'.', 'symbol_left':false, 'space_between':true, 'exp':2, 'min_amount':'95', 'max_amount':'954630'}, 'CLP':{'code':'CLP', 'title':'Chilean Peso', 'symbol':'CLP', 'native':'$', 'thousands_sep':'.', 'decimal_sep':',', 'symbol_left':true, 'space_between':true, 'exp':0, 'min_amount':'926', 'max_amount':'9268013'}, 'CNY':{'code':'CNY', 'title':'Chinese Renminbi Yuan', 'symbol':'CN', 'native':'CN', 'thousands_sep':',', 'decimal_sep':'.', 'symbol_left':true, 'space_between':false, 'exp':2, 'min_amount':'669', 'max_amount':'6692902'}, 'COP':{'code':'COP', 'title':'Colombian Peso', 'symbol':'COP', 'native':'$', 'thousands_sep':'.', 'decimal_sep':',', 'symbol_left':true, 'space_between':true, 'exp':2, 'min_amount':'410927', 'max_amount':'4109270000'}, 'CRC':{'code':'CRC', 'title':'Costa Rican Coln', 'symbol':'CRC', 'native':'', 'thousands_sep':'.', 'decimal_sep':',', 'symbol_left':true, 'space_between':false, 'exp':2, 'min_amount':'69166', 'max_amount':'691668622'}, 'CZK':{'code':'CZK', 'title':'Czech Koruna', 'symbol':'CZK', 'native':'K', 'thousands_sep':' ', 'decimal_sep':',', 'symbol_left':false, 'space_between':true, 'exp':2, 'min_amount':'2367', 'max_amount':'23674601'}, 'DKK':{'code':'DKK', 'title':'Danish Krone', 'symbol':'DKK', 'native':'kr', 'thousands_sep':'', 'decimal_sep':',', 'symbol_left':false, 'space_between':true, 'exp':2, 'min_amount':'712', 'max_amount':'7120540'}, 'DOP':{'code':'DOP', 'title':'Dominican Peso', 'symbol':'DOP', 'native':'$', 'thousands_sep':',', 'decimal_sep':'.', 'symbol_left':true, 'space_between':false, 'exp':2, 'min_amount':'5497', 'max_amount':'54971796'}, 'DZD':{'code':'DZD', 'title':'Algerian Dinar', 'symbol':'DZD', 'native':'..', 'thousands_sep':',', 'decimal_sep':'.', 'symbol_left':true, 'space_between':true, 'exp':2, 'min_amount':'14655', 'max_amount':'146557782'}, 'EGP':{'code':'EGP', 'title':'Egyptian Pound', 'symbol':'EGP', 'native':'..', 'thousands_sep':',', 'decimal_sep':'.', 'symbol_left':true, 'space_between':true, 'exp':2, 'min_amount':'1879', 'max_amount':'18794601'}, 'EUR':{'code':'EUR', 'title':'Euro', 'symbol':'', 'native':'', 'thousands_sep':' ', 'decimal_sep':',', 'symbol_left':false, 'space_between':true, 'exp':2, 'min_amount':'95', 'max_amount':'957150'}, 'GBP':{'code':'GBP', 'title':'British Pound', 'symbol':'', 'native':'', 'thousands_sep':',', 'decimal_sep':'.', 'symbol_left':true, 'space_between':false, 'exp':2, 'min_amount':'82', 'max_amount':'822531'}, 'GEL':{'code':'GEL', 'title':'Georgian Lari', 'symbol':'GEL', 'native':'GEL', 'thousands_sep':' ', 'decimal_sep':',', 'symbol_left':false, 'space_between':true, 'exp':2, 'min_amount':'293', 'max_amount':'2939866'}, 'GTQ':{'code':'GTQ', 'title':'Guatemalan Quetzal', 'symbol':'GTQ', 'native':'Q', 'thousands_sep':',', 'decimal_sep':'.', 'symbol_left':true, 'space_between':false, 'exp':2, 'min_amount':'781', 'max_amount':'7811180'}, 'HKD':{'code':'HKD', 'title':'Hong Kong Dollar', 'symbol':'HK$', 'native':'$', 'thousands_sep':',', 'decimal_sep':'.', 'symbol_left':true, 'space_between':false, 'exp':2, 'min_amount':'784', 'max_amount':'7845675'}, 'HNL':{'code':'HNL', 'title':'Honduran Lempira', 'symbol':'HNL', 'native':'L', 'thousands_sep':',', 'decimal_sep':'.', 'symbol_left':true, 'space_between':true, 'exp':2, 'min_amount':'2476', 'max_amount':'24763692'}, 'HRK':{'code':'HRK', 'title':'Croatian Kuna', 'symbol':'HRK', 'native':'kn', 'thousands_sep':'.', 'decimal_sep':',', 'symbol_left':false, 'space_between':true, 'exp':2, 'min_amount':'721', 'max_amount':'7210988'}, 'HUF':{'code':'HUF', 'title':'Hungarian Forint', 'symbol':'HUF', 'native':'Ft', 'thousands_sep':' ', 'decimal_sep':',', 'symbol_left':false, 'space_between':true, 'exp':2, 'min_amount':'37819', 'max_amount':'378197939'}, 'IDR':{'code':'IDR', 'title':'Indonesian Rupiah', 'symbol':'IDR', 'native':'Rp', 'thousands_sep':'.', 'decimal_sep':',', 'symbol_left':true, 'space_between':false, 'exp':2, 'min_amount':'1490695', 'max_amount':'14906950000'}, 'ILS':{'code':'ILS', 'title':'Israeli New Sheqel', 'symbol':'', 'native':'', 'thousands_sep':',', 'decimal_sep':'.', 'symbol_left':true, 'space_between':true, 'exp':2, 'min_amount':'348', 'max_amount':'3480155'}, 'INR':{'code':'INR', 'title':'Indian Rupee', 'symbol':'', 'native':'', 'thousands_sep':',', 'decimal_sep':'.', 'symbol_left':true, 'space_between':false, 'exp':2, 'min_amount':'7894', 'max_amount':'78945050'}, 'ISK':{'code':'ISK', 'title':'Icelandic Krna', 'symbol':'ISK', 'native':'kr', 'thousands_sep':'.', 'decimal_sep':',', 'symbol_left':false, 'space_between':true, 'exp':0, 'min_amount':'133', 'max_amount':'1336303'}, 'JMD':{'code':'JMD', 'title':'Jamaican Dollar', 'symbol':'JMD', 'native':'$', 'thousands_sep':',', 'decimal_sep':'.', 'symbol_left':true, 'space_between':false, 'exp':2, 'min_amount':'15175', 'max_amount':'151753529'}, 'JPY':{'code':'JPY', 'title':'Japanese Yen', 'symbol':'', 'native':'', 'thousands_sep':',', 'decimal_sep':'.', 'symbol_left':true, 'space_between':false, 'exp':0, 'min_amount':'136', 'max_amount':'1362010'}, 'KES':{'code':'KES', 'title':'Kenyan Shilling', 'symbol':'KES', 'native':'Ksh', 'thousands_sep':',', 'decimal_sep':'.', 'symbol_left':true, 'space_between':false, 'exp':2, 'min_amount':'11787', 'max_amount':'117879251'}, 'KGS':{'code':'KGS', 'title':'Kyrgyzstani Som', 'symbol':'KGS', 'native':'KGS', 'thousands_sep':' ', 'decimal_sep':'-', 'symbol_left':false, 'space_between':true, 'exp':2, 'min_amount':'7950', 'max_amount':'79509472'}, 'KRW':{'code':'KRW', 'title':'South Korean Won', 'symbol':'', 'native':'', 'thousands_sep':',', 'decimal_sep':'.', 'symbol_left':true, 'space_between':false, 'exp':0, 'min_amount':'1297', 'max_amount':'12971249'}, 'KZT':{'code':'KZT', 'title':'Kazakhstani Tenge', 'symbol':'KZT', 'native':'', 'thousands_sep':' ', 'decimal_sep':'-', 'symbol_left':true, 'space_between':false, 'exp':2, 'min_amount':'47177', 'max_amount':'471777437'}, 'LBP':{'code':'LBP', 'title':'Lebanese Pound', 'symbol':'LBP', 'native':'..', 'thousands_sep':',', 'decimal_sep':'.', 'symbol_left':true, 'space_between':true, 'exp':2, 'min_amount':'152338', 'max_amount':'1523381760'}, 'LKR':{'code':'LKR', 'title':'Sri Lankan Rupee', 'symbol':'LKR', 'native':'.', 'thousands_sep':',', 'decimal_sep':'.', 'symbol_left':true, 'space_between':true, 'exp':2, 'min_amount':'36271', 'max_amount':'362713465'}, 'MAD':{'code':'MAD', 'title':'Moroccan Dirham', 'symbol':'MAD', 'native':'..', 'thousands_sep':',', 'decimal_sep':'.', 'symbol_left':true, 'space_between':true, 'exp':2, 'min_amount':'1018', 'max_amount':'10188182'}, 'MDL':{'code':'MDL', 'title':'Moldovan Leu', 'symbol':'MDL', 'native':'MDL', 'thousands_sep':',', 'decimal_sep':'.', 'symbol_left':false, 'space_between':true, 'exp':2, 'min_amount':'1928', 'max_amount':'19284237'}, 'MNT':{'code':'MNT', 'title':'Mongolian Tgrg', 'symbol':'MNT', 'native':'MNT', 'thousands_sep':' ', 'decimal_sep':',', 'symbol_left':true, 'space_between':false, 'exp':2, 'min_amount':'312408', 'max_amount':'3124087599'}, 'MUR':{'code':'MUR', 'title':'Mauritian Rupee', 'symbol':'MUR', 'native':'MUR', 'thousands_sep':',', 'decimal_sep':'.', 'symbol_left':true, 'space_between':false, 'exp':2, 'min_amount':'4614', 'max_amount':'46144273'}, 'MVR':{'code':'MVR', 'title':'Maldivian Rufiyaa', 'symbol':'MVR', 'native':'MVR', 'thousands_sep':',', 'decimal_sep':'.', 'symbol_left':false, 'space_between':true, 'exp':2, 'min_amount':'1534', 'max_amount':'15349670'}, 'MXN':{'code':'MXN', 'title':'Mexican Peso', 'symbol':'MX$', 'native':'$', 'thousands_sep':',', 'decimal_sep':'.', 'symbol_left':true, 'space_between':false, 'exp':2, 'min_amount':'2015', 'max_amount':'20158770'}, 'MYR':{'code':'MYR', 'title':'Malaysian Ringgit', 'symbol':'MYR', 'native':'RM', 'thousands_sep':',', 'decimal_sep':'.', 'symbol_left':true, 'space_between':false, 'exp':2, 'min_amount':'440', 'max_amount':'4406499'}, 'MZN':{'code':'MZN', 'title':'Mozambican Metical', 'symbol':'MZN', 'native':'MTn', 'thousands_sep':',', 'decimal_sep':'.', 'symbol_left':true, 'space_between':false, 'exp':2, 'min_amount':'6383', 'max_amount':'63830365'}, 'NGN':{'code':'NGN', 'title':'Nigerian Naira', 'symbol':'NGN', 'native':'', 'thousands_sep':',', 'decimal_sep':'.', 'symbol_left':true, 'space_between':false, 'exp':2, 'min_amount':'41513', 'max_amount':'415132815'}, 'NIO':{'code':'NIO', 'title':'Nicaraguan Crdoba', 'symbol':'NIO', 'native':'C$', 'thousands_sep':',', 'decimal_sep':'.', 'symbol_left':true, 'space_between':true, 'exp':2, 'min_amount':'3612', 'max_amount':'36125609'}, 'NOK':{'code':'NOK', 'title':'Norwegian Krone', 'symbol':'NOK', 'native':'kr', 'thousands_sep':' ', 'decimal_sep':',', 'symbol_left':true, 'space_between':true, 'exp':2, 'min_amount':'990', 'max_amount':'9902585'}, 'NPR':{'code':'NPR', 'title':'Nepalese Rupee', 'symbol':'NPR', 'native':'', 'thousands_sep':',', 'decimal_sep':'.', 'symbol_left':true, 'space_between':false, 'exp':2, 'min_amount':'12731', 'max_amount':'127318435'}, 'NZD':{'code':'NZD', 'title':'New Zealand Dollar', 'symbol':'NZ$', 'native':'$', 'thousands_sep':',', 'decimal_sep':'.', 'symbol_left':true, 'space_between':false, 'exp':2, 'min_amount':'160', 'max_amount':'1603695'}, 'PAB':{'code':'PAB', 'title':'Panamanian Balboa', 'symbol':'PAB', 'native':'B\\/.', 'thousands_sep':',', 'decimal_sep':'.', 'symbol_left':true, 'space_between':true, 'exp':2, 'min_amount':'100', 'max_amount':'1007566'}, 'PEN':{'code':'PEN', 'title':'Peruvian Nuevo Sol', 'symbol':'PEN', 'native':'S\\/.', 'thousands_sep':',', 'decimal_sep':'.', 'symbol_left':true, 'space_between':true, 'exp':2, 'min_amount':'381', 'max_amount':'3818809'}, 'PHP':{'code':'PHP', 'title':'Philippine Peso', 'symbol':'PHP', 'native':'', 'thousands_sep':',', 'decimal_sep':'.', 'symbol_left':true, 'space_between':false, 'exp':2, 'min_amount':'5499', 'max_amount':'54994501'}, 'PKR':{'code':'PKR', 'title':'Pakistani Rupee', 'symbol':'PKR', 'native':'', 'thousands_sep':',', 'decimal_sep':'.', 'symbol_left':true, 'space_between':false, 'exp':2, 'min_amount':'20651', 'max_amount':'206515440'}, 'PLN':{'code':'PLN', 'title':'Polish Zoty', 'symbol':'PLN', 'native':'z', 'thousands_sep':' ', 'decimal_sep':',', 'symbol_left':false, 'space_between':true, 'exp':2, 'min_amount':'446', 'max_amount':'4466920'}, 'PYG':{'code':'PYG', 'title':'Paraguayan Guaran', 'symbol':'PYG', 'native':'', 'thousands_sep':'.', 'decimal_sep':',', 'symbol_left':true, 'space_between':true, 'exp':0, 'min_amount':'6909', 'max_amount':'69095662'}, 'QAR':{'code':'QAR', 'title':'Qatari Riyal', 'symbol':'QAR', 'native':'..', 'thousands_sep':',', 'decimal_sep':'.', 'symbol_left':true, 'space_between':true, 'exp':2, 'min_amount':'364', 'max_amount':'3640988'}, 'RON':{'code':'RON', 'title':'Romanian Leu', 'symbol':'RON', 'native':'RON', 'thousands_sep':'.', 'decimal_sep':',', 'symbol_left':false, 'space_between':true, 'exp':2, 'min_amount':'473', 'max_amount':'4736501'}, 'RSD':{'code':'RSD', 'title':'Serbian Dinar', 'symbol':'RSD', 'native':'.', 'thousands_sep':'.', 'decimal_sep':',', 'symbol_left':false, 'space_between':true, 'exp':2, 'min_amount':'11252', 'max_amount':'112520089'}, 'RUB':{'code':'RUB', 'title':'Russian Ruble', 'symbol':'RUB', 'native':'.', 'thousands_sep':' ', 'decimal_sep':',', 'symbol_left':false, 'space_between':true, 'exp':2, 'min_amount':'5282', 'max_amount':'52825030'}, 'SAR':{'code':'SAR', 'title':'Saudi Riyal', 'symbol':'SAR', 'native':'..', 'thousands_sep':',', 'decimal_sep':'.', 'symbol_left':true, 'space_between':true, 'exp':2, 'min_amount':'375', 'max_amount':'3752099'}, 'SEK':{'code':'SEK', 'title':'Swedish Krona', 'symbol':'SEK', 'native':'kr', 'thousands_sep':'.', 'decimal_sep':',', 'symbol_left':false, 'space_between':true, 'exp':2, 'min_amount':'1022', 'max_amount':'10224070'}, 'SGD':{'code':'SGD', 'title':'Singapore Dollar', 'symbol':'SGD', 'native':'$', 'thousands_sep':',', 'decimal_sep':'.', 'symbol_left':true, 'space_between':false, 'exp':2, 'min_amount':'139', 'max_amount':'1390698'}, 'THB':{'code':'THB', 'title':'Thai Baht', 'symbol':'', 'native':'', 'thousands_sep':',', 'decimal_sep':'.', 'symbol_left':true, 'space_between':false, 'exp':2, 'min_amount':'3529', 'max_amount':'35290499'}, 'TJS':{'code':'TJS', 'title':'Tajikistani Somoni', 'symbol':'TJS', 'native':'TJS', 'thousands_sep':' ', 'decimal_sep':';', 'symbol_left':false, 'space_between':true, 'exp':2, 'min_amount':'977', 'max_amount':'9773409'}, 'TRY':{'code':'TRY', 'title':'Turkish Lira', 'symbol':'TRY', 'native':'TL', 'thousands_sep':'.', 'decimal_sep':',', 'symbol_left':false, 'space_between':true, 'exp':2, 'min_amount':'1667', 'max_amount':'16673549'}, 'TTD':{'code':'TTD', 'title':'Trinidad and Tobago Dollar', 'symbol':'TTD', 'native':'$', 'thousands_sep':',', 'decimal_sep':'.', 'symbol_left':true, 'space_between':false, 'exp':2, 'min_amount':'684', 'max_amount':'6847347'}, 'TWD':{'code':'TWD', 'title':'New Taiwan Dollar', 'symbol':'NT$', 'native':'NT$', 'thousands_sep':',', 'decimal_sep':'.', 'symbol_left':true, 'space_between':false, 'exp':2, 'min_amount':'2973', 'max_amount':'29735499'}, 'TZS':{'code':'TZS', 'title':'Tanzanian Shilling', 'symbol':'TZS', 'native':'TSh', 'thousands_sep':',', 'decimal_sep':'.', 'symbol_left':true, 'space_between':false, 'exp':2, 'min_amount':'233200', 'max_amount':'2332000087'}, 'UAH':{'code':'UAH', 'title':'Ukrainian Hryvnia', 'symbol':'UAH', 'native':'', 'thousands_sep':' ', 'decimal_sep':',', 'symbol_left':false, 'space_between':false, 'exp':2, 'min_amount':'2974', 'max_amount':'29741945'}, 'UGX':{'code':'UGX', 'title':'Ugandan Shilling', 'symbol':'UGX', 'native':'USh', 'thousands_sep':',', 'decimal_sep':'.', 'symbol_left':true, 'space_between':false, 'exp':0, 'min_amount':'3788', 'max_amount':'37883728'}, 'USD':{'code':'USD', 'title':'United States Dollar', 'symbol':'$', 'native':'$', 'thousands_sep':',', 'decimal_sep':'.', 'symbol_left':true, 'space_between':false, 'exp':2, 'min_amount':'100', 'max_amount':1000000}, 'UYU':{'code':'UYU', 'title':'Uruguayan Peso', 'symbol':'UYU', 'native':'$', 'thousands_sep':'.', 'decimal_sep':',', 'symbol_left':true, 'space_between':true, 'exp':2, 'min_amount':'3979', 'max_amount':'39794286'}, 'UZS':{'code':'UZS', 'title':'Uzbekistani Som', 'symbol':'UZS', 'native':'UZS', 'thousands_sep':' ', 'decimal_sep':',', 'symbol_left':false, 'space_between':true, 'exp':2, 'min_amount':'1094209', 'max_amount':'10942099215'}, 'VND':{'code':'VND', 'title':'Vietnamese ng', 'symbol':'', 'native':'', 'thousands_sep':'.', 'decimal_sep':',', 'symbol_left':false, 'space_between':true, 'exp':0, 'min_amount':'23270', 'max_amount':'232700000'}, 'YER':{'code':'YER', 'title':'Yemeni Rial', 'symbol':'YER', 'native':'..', 'thousands_sep':',', 'decimal_sep':'.', 'symbol_left':true, 'space_between':true, 'exp':2, 'min_amount':'25024', 'max_amount':'250249914'}, 'ZAR':{'code':'ZAR', 'title':'South African Rand', 'symbol':'ZAR', 'native':'R', 'thousands_sep':',', 'decimal_sep':'.', 'symbol_left':true, 'space_between':true, 'exp':2, 'min_amount':'1624', 'max_amount':'16246189'}};\n\nexport default Currencies;\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport type {EMOJI_VERSION} from '../environment/emojiVersionsSupport';\n\nexport const EmojiVersions: {[version in EMOJI_VERSION]: {[emoji: string]: number}} = {'14':{'1f6dd':4867, '1f6de':4916, '1f6df':4923, '1f7f0':62832, '1f979':183, '1f9cc':1557, '1fa7b':61332, '1fa7c':61330, '1faa9':51093, '1faaa':61364, '1faab':61189, '1faac':51085, '1fab7':2651, '1fab8':2631, '1fab9':2672, '1faba':2673, '1fac3':1520, '1fac4':1521, '1fac5':1505, '1fad7':3793, '1fad8':3707, '1fad9':3804, '1fae0':111, '1fae1':136, '1fae2':132, '1fae3':133, '1fae4':174, '1fae5':142, '1fae6':1385, '1fae7':61353, '1faf0':1341, '1faf1':1332, '1faf2':1333, '1faf3':1334, '1faf4':1335, '1faf5':1351, '1faf6':1360, '1faf1-1f3fb-200d-1faf2-1f3fc':0, '1faf1-1f3fb-200d-1faf2-1f3fd':0, '1faf1-1f3fb-200d-1faf2-1f3fe':0, '1faf1-1f3fb-200d-1faf2-1f3ff':0, '1faf1-1f3fc-200d-1faf2-1f3fb':0, '1faf1-1f3fc-200d-1faf2-1f3fd':0, '1faf1-1f3fc-200d-1faf2-1f3fe':0, '1faf1-1f3fc-200d-1faf2-1f3ff':0, '1faf1-1f3fd-200d-1faf2-1f3fb':0, '1faf1-1f3fd-200d-1faf2-1f3fc':0, '1faf1-1f3fd-200d-1faf2-1f3fe':0, '1faf1-1f3fd-200d-1faf2-1f3ff':0, '1faf1-1f3fe-200d-1faf2-1f3fb':0, '1faf1-1f3fe-200d-1faf2-1f3fc':0, '1faf1-1f3fe-200d-1faf2-1f3fd':0, '1faf1-1f3fe-200d-1faf2-1f3ff':0, '1faf1-1f3ff-200d-1faf2-1f3fb':0, '1faf1-1f3ff-200d-1faf2-1f3fc':0, '1faf1-1f3ff-200d-1faf2-1f3fd':0, '1faf1-1f3ff-200d-1faf2-1f3fe':0, '1fac3-1f3fb':0, '1fac3-1f3fc':0, '1fac3-1f3fd':0, '1fac3-1f3fe':0, '1fac3-1f3ff':0, '1fac4-1f3fb':0, '1fac4-1f3fc':0, '1fac4-1f3fd':0, '1fac4-1f3fe':0, '1fac4-1f3ff':0, '1fac5-1f3fb':0, '1fac5-1f3fc':0, '1fac5-1f3fd':0, '1fac5-1f3fe':0, '1fac5-1f3ff':0, '1faf0-1f3fb':0, '1faf0-1f3fc':0, '1faf0-1f3fd':0, '1faf0-1f3fe':0, '1faf0-1f3ff':0, '1faf1-1f3fb':0, '1faf1-1f3fc':0, '1faf1-1f3fd':0, '1faf1-1f3fe':0, '1faf1-1f3ff':0, '1faf2-1f3fb':0, '1faf2-1f3fc':0, '1faf2-1f3fd':0, '1faf2-1f3fe':0, '1faf2-1f3ff':0, '1faf3-1f3fb':0, '1faf3-1f3fc':0, '1faf3-1f3fd':0, '1faf3-1f3fe':0, '1faf3-1f3ff':0, '1faf4-1f3fb':0, '1faf4-1f3fc':0, '1faf4-1f3fd':0, '1faf4-1f3fe':0, '1faf4-1f3ff':0, '1faf5-1f3fb':0, '1faf5-1f3fc':0, '1faf5-1f3fd':0, '1faf5-1f3fe':0, '1faf5-1f3ff':0, '1faf6-1f3fb':0, '1faf6-1f3fc':0, '1faf6-1f3fd':0, '1faf6-1f3fe':0, '1faf6-1f3ff':0}, '':{'2049':62835, '2122':62863, '2139':62888, '2194':62764, '2195':62763, '2196':62762, '2197':62756, '2198':62758, '2199':62760, '2328':61194, '2600':4990, '2601':4998, '2602':41013, '2603':41018, '2604':41020, '2611':62851, '2614':41014, '2615':3781, '2618':2667, '2620':1106, '2622':62753, '2623':62754, '2626':62783, '2638':62780, '2639':177, '2648':62788, '2649':62789, '2650':62796, '2651':62797, '2652':62798, '2653':62799, '2660':51095, '2663':51098, '2665':51096, '2666':51097, '2668':4865, '2692':61297, '2693':4922, '2694':61300, '2696':61311, '2697':61319, '2699':61309, '2702':61284, '2705':62850, '2708':4931, '2709':61245, '2712':61259, '2714':62852, '2716':62828, '2721':62779, '2728':51029, '2733':62858, '2734':62859, '2744':41017, '2747':62860, '2753':62836, '2754':62837, '2755':62838, '2757':62839, '2763':1137, '2764':1141, '2795':62829, '2796':62830, '2797':62831, '2934':62767, '2935':62768, '3030':62840, '3297':62912, '3299':62913, '0023-20e3':62864, '002a-20e3':62865, '0030-20e3':62866, '0031-20e3':62867, '0032-20e3':62868, '0033-20e3':62869, '0034-20e3':62870, '0035-20e3':62871, '0036-20e3':62872, '0037-20e3':62873, '0038-20e3':62874, '0039-20e3':62875, '00a9':62861, '00ae':62862, '1f004':51101, '1f0cf':51100, '1f170':62882, '1f171':62884, '1f17e':62893, '1f17f':62895, '1f18e':62883, '1f191':62885, '1f192':62886, '1f193':62887, '1f194':62889, '1f195':62891, '1f196':62892, '1f197':62894, '1f198':62896, '1f199':62897, '1f19a':62898, '1f1e6-1f1e8':71594, '1f1e6-1f1e9':71595, '1f1e6-1f1ea':71596, '1f1e6-1f1eb':71597, '1f1e6-1f1ec':71598, '1f1e6-1f1ee':71599, '1f1e6-1f1f1':71600, '1f1e6-1f1f2':71601, '1f1e6-1f1f4':71602, '1f1e6-1f1f6':71603, '1f1e6-1f1f7':71604, '1f1e6-1f1f8':71605, '1f1e6-1f1f9':71606, '1f1e6-1f1fa':71607, '1f1e6-1f1fc':71608, '1f1e6-1f1fd':71609, '1f1e6-1f1ff':71610, '1f1e7-1f1e6':71611, '1f1e7-1f1e7':71612, '1f1e7-1f1e9':71613, '1f1e7-1f1ea':71614, '1f1e7-1f1eb':71615, '1f1e7-1f1ec':71616, '1f1e7-1f1ed':71617, '1f1e7-1f1ee':71618, '1f1e7-1f1ef':71619, '1f1e7-1f1f1':71620, '1f1e7-1f1f2':71621, '1f1e7-1f1f3':71622, '1f1e7-1f1f4':71623, '1f1e7-1f1f6':71624, '1f1e7-1f1f7':71625, '1f1e7-1f1f8':71626, '1f1e7-1f1f9':71627, '1f1e7-1f1fb':71628, '1f1e7-1f1fc':71629, '1f1e7-1f1fe':71630, '1f1e7-1f1ff':71631, '1f1e8-1f1e6':71632, '1f1e8-1f1e8':71633, '1f1e8-1f1e9':71634, '1f1e8-1f1eb':71635, '1f1e8-1f1ec':71636, '1f1e8-1f1ed':71637, '1f1e8-1f1ee':71638, '1f1e8-1f1f0':71639, '1f1e8-1f1f1':71640, '1f1e8-1f1f2':71641, '1f1e8-1f1f3':71642, '1f1e8-1f1f4':71643, '1f1e8-1f1f5':71644, '1f1e8-1f1f7':71645, '1f1e8-1f1fa':71646, '1f1e8-1f1fb':71647, '1f1e8-1f1fc':71648, '1f1e8-1f1fd':71649, '1f1e8-1f1fe':71650, '1f1e8-1f1ff':71651, '1f1e9-1f1ea':71652, '1f1e9-1f1ec':71653, '1f1e9-1f1ef':71654, '1f1e9-1f1f0':71655, '1f1e9-1f1f2':71656, '1f1e9-1f1f4':71657, '1f1e9-1f1ff':71658, '1f1ea-1f1e6':71659, '1f1ea-1f1e8':71660, '1f1ea-1f1ea':71661, '1f1ea-1f1ec':71662, '1f1ea-1f1ed':71663, '1f1ea-1f1f7':71664, '1f1ea-1f1f8':71665, '1f1ea-1f1f9':71666, '1f1ea-1f1fa':71667, '1f1eb-1f1ee':71668, '1f1eb-1f1ef':71669, '1f1eb-1f1f0':71670, '1f1eb-1f1f2':71671, '1f1eb-1f1f4':71672, '1f1eb-1f1f7':71673, '1f1ec-1f1e6':71674, '1f1ec-1f1e7':71675, '1f1ec-1f1e9':71676, '1f1ec-1f1ea':71677, '1f1ec-1f1eb':71678, '1f1ec-1f1ec':71679, '1f1ec-1f1ed':71680, '1f1ec-1f1ee':71681, '1f1ec-1f1f1':71682, '1f1ec-1f1f2':71683, '1f1ec-1f1f3':71684, '1f1ec-1f1f5':71685, '1f1ec-1f1f6':71686, '1f1ec-1f1f7':71687, '1f1ec-1f1f8':71688, '1f1ec-1f1f9':71689, '1f1ec-1f1fa':71690, '1f1ec-1f1fc':71691, '1f1ec-1f1fe':71692, '1f1ed-1f1f0':71693, '1f1ed-1f1f2':71694, '1f1ed-1f1f3':71695, '1f1ed-1f1f7':71696, '1f1ed-1f1f9':71697, '1f1ed-1f1fa':71698, '1f1ee-1f1e8':71699, '1f1ee-1f1e9':71700, '1f1ee-1f1ea':71701, '1f1ee-1f1f1':71702, '1f1ee-1f1f2':71703, '1f1ee-1f1f3':71704, '1f1ee-1f1f4':71705, '1f1ee-1f1f6':71706, '1f1ee-1f1f7':71707, '1f1ee-1f1f8':71708, '1f1ee-1f1f9':71709, '1f1ef-1f1ea':71710, '1f1ef-1f1f2':71711, '1f1ef-1f1f4':71712, '1f1ef-1f1f5':71713, '1f1f0-1f1ea':71714, '1f1f0-1f1ec':71715, '1f1f0-1f1ed':71716, '1f1f0-1f1ee':71717, '1f1f0-1f1f2':71718, '1f1f0-1f1f3':71719, '1f1f0-1f1f5':71720, '1f1f0-1f1f7':71721, '1f1f0-1f1fc':71722, '1f1f0-1f1fe':71723, '1f1f0-1f1ff':71724, '1f1f1-1f1e6':71725, '1f1f1-1f1e7':71726, '1f1f1-1f1e8':71727, '1f1f1-1f1ee':71728, '1f1f1-1f1f0':71729, '1f1f1-1f1f7':71730, '1f1f1-1f1f8':71731, '1f1f1-1f1f9':71732, '1f1f1-1f1fa':71733, '1f1f1-1f1fb':71734, '1f1f1-1f1fe':71735, '1f1f2-1f1e6':71736, '1f1f2-1f1e8':71737, '1f1f2-1f1e9':71738, '1f1f2-1f1ea':71739, '1f1f2-1f1eb':71740, '1f1f2-1f1ec':71741, '1f1f2-1f1ed':71742, '1f1f2-1f1f0':71743, '1f1f2-1f1f1':71744, '1f1f2-1f1f2':71745, '1f1f2-1f1f3':71746, '1f1f2-1f1f4':71747, '1f1f2-1f1f5':71748, '1f1f2-1f1f6':71749, '1f1f2-1f1f7':71750, '1f1f2-1f1f8':71751, '1f1f2-1f1f9':71752, '1f1f2-1f1fa':71753, '1f1f2-1f1fb':71754, '1f1f2-1f1fc':71755, '1f1f2-1f1fd':71756, '1f1f2-1f1fe':71757, '1f1f2-1f1ff':71758, '1f1f3-1f1e6':71759, '1f1f3-1f1e8':71760, '1f1f3-1f1ea':71761, '1f1f3-1f1eb':71762, '1f1f3-1f1ec':71763, '1f1f3-1f1ee':71764, '1f1f3-1f1f1':71765, '1f1f3-1f1f4':71766, '1f1f3-1f1f5':71767, '1f1f3-1f1f7':71768, '1f1f3-1f1fa':71769, '1f1f3-1f1ff':71770, '1f1f4-1f1f2':71771, '1f1f5-1f1e6':71772, '1f1f5-1f1ea':71773, '1f1f5-1f1eb':71774, '1f1f5-1f1ec':71775, '1f1f5-1f1ed':71776, '1f1f5-1f1f0':71777, '1f1f5-1f1f1':71778, '1f1f5-1f1f2':71779, '1f1f5-1f1f3':71780, '1f1f5-1f1f7':71781, '1f1f5-1f1f8':71782, '1f1f5-1f1f9':71783, '1f1f5-1f1fc':71784, '1f1f5-1f1fe':71785, '1f1f6-1f1e6':71786, '1f1f7-1f1ea':71787, '1f1f7-1f1f4':71788, '1f1f7-1f1f8':71789, '1f1f7-1f1fa':71790, '1f1f7-1f1fc':71791, '1f1f8-1f1e6':71792, '1f1f8-1f1e7':71793, '1f1f8-1f1e8':71794, '1f1f8-1f1e9':71795, '1f1f8-1f1ea':71796, '1f1f8-1f1ec':71797, '1f1f8-1f1ed':71798, '1f1f8-1f1ee':71799, '1f1f8-1f1ef':71800, '1f1f8-1f1f0':71801, '1f1f8-1f1f1':71802, '1f1f8-1f1f2':71803, '1f1f8-1f1f3':71804, '1f1f8-1f1f4':71805, '1f1f8-1f1f7':71806, '1f1f8-1f1f8':71807, '1f1f8-1f1f9':71808, '1f1f8-1f1fb':71809, '1f1f8-1f1fd':71810, '1f1f8-1f1fe':71811, '1f1f8-1f1ff':71812, '1f1f9-1f1e6':71813, '1f1f9-1f1e8':71814, '1f1f9-1f1e9':71815, '1f1f9-1f1eb':71816, '1f1f9-1f1ec':71817, '1f1f9-1f1ed':71818, '1f1f9-1f1ef':71819, '1f1f9-1f1f0':71820, '1f1f9-1f1f1':71821, '1f1f9-1f1f2':71822, '1f1f9-1f1f3':71823, '1f1f9-1f1f4':71824, '1f1f9-1f1f7':71825, '1f1f9-1f1f9':71826, '1f1f9-1f1fb':71827, '1f1f9-1f1fc':71828, '1f1f9-1f1ff':71829, '1f1fa-1f1e6':71830, '1f1fa-1f1ec':71831, '1f1fa-1f1f2':71832, '1f1fa-1f1f3':71833, '1f1fa-1f1f8':71834, '1f1fa-1f1fe':71835, '1f1fa-1f1ff':71836, '1f1fb-1f1e6':71837, '1f1fb-1f1e8':71838, '1f1fb-1f1ea':71839, '1f1fb-1f1ec':71840, '1f1fb-1f1ee':71841, '1f1fb-1f1f3':71842, '1f1fb-1f1fa':71843, '1f1fc-1f1eb':71844, '1f1fc-1f1f8':71845, '1f1fd-1f1f0':71846, '1f1fe-1f1ea':71847, '1f1fe-1f1f9':71848, '1f1ff-1f1e6':71849, '1f1ff-1f1f2':71850, '1f1ff-1f1fc':71851, '1f201':62899, '1f202':62900, '1f21a':62906, '1f22f':62903, '1f232':62907, '1f233':62911, '1f234':62910, '1f235':62915, '1f236':62902, '1f237':62901, '1f238':62909, '1f239':62905, '1f23a':62914, '1f250':62904, '1f251':62908, '1f300':41010, '1f301':4857, '1f302':41012, '1f303':4858, '1f304':4860, '1f305':4861, '1f306':4862, '1f307':4863, '1f308':41011, '1f309':4864, '1f30a':41023, '1f30b':4815, '1f30c':4997, '1f30d':4806, '1f30e':4807, '1f30f':4808, '1f310':4809, '1f311':4977, '1f312':4978, '1f313':4979, '1f314':4980, '1f315':4981, '1f316':4982, '1f317':4983, '1f318':4984, '1f319':4985, '1f31a':4986, '1f31b':4987, '1f31c':4988, '1f31d':4991, '1f31e':4992, '1f31f':4995, '1f320':4996, '1f321':4989, '1f324':41001, '1f325':41002, '1f326':41003, '1f327':41004, '1f328':41005, '1f329':41006, '1f32a':41007, '1f32b':41008, '1f32c':41009, '1f32d':3725, '1f32e':3727, '1f32f':3728, '1f330':3708, '1f331':2659, '1f332':2661, '1f333':2662, '1f334':2663, '1f335':2664, '1f336':3698, '1f337':2658, '1f338':2649, '1f339':2653, '1f33a':2655, '1f33b':2656, '1f33c':2657, '1f33d':3697, '1f33e':2665, '1f33f':2666, '1f340':2668, '1f341':2669, '1f342':2670, '1f343':2671, '1f344':3705, '1f345':3690, '1f346':3694, '1f347':3674, '1f348':3675, '1f349':3676, '1f34a':3677, '1f34b':3678, '1f34c':3679, '1f34d':3680, '1f34e':3682, '1f34f':3683, '1f350':3684, '1f351':3685, '1f352':3686, '1f353':3687, '1f354':3722, '1f355':3724, '1f356':3718, '1f357':3719, '1f358':3744, '1f359':3745, '1f35a':3746, '1f35b':3747, '1f35c':3748, '1f35d':3749, '1f35e':3709, '1f35f':3723, '1f360':3750, '1f361':3756, '1f362':3751, '1f363':3752, '1f364':3753, '1f365':3754, '1f366':3765, '1f367':3766, '1f368':3767, '1f369':3768, '1f36a':3769, '1f36b':3774, '1f36c':3775, '1f36d':3776, '1f36e':3777, '1f36f':3778, '1f370':3771, '1f371':3743, '1f372':3735, '1f373':3733, '1f374':3801, '1f375':3783, '1f376':3784, '1f377':3786, '1f378':3787, '1f379':3788, '1f37a':3789, '1f37b':3790, '1f37c':3779, '1f37d':3800, '1f37e':3785, '1f37f':3739, '1f380':51040, '1f381':51041, '1f382':3770, '1f383':51024, '1f384':51025, '1f385':1527, '1f386':51026, '1f387':51027, '1f388':51030, '1f389':51031, '1f38a':51032, '1f38b':51033, '1f38c':71588, '1f38d':51034, '1f38e':51035, '1f38f':51036, '1f390':51037, '1f391':51038, '1f392':61134, '1f393':61147, '1f396':51045, '1f397':51042, '1f399':61167, '1f39a':61168, '1f39b':61169, '1f39e':61203, '1f39f':51043, '1f3a0':4866, '1f3a1':4868, '1f3a2':4869, '1f3a3':51072, '1f3a4':61170, '1f3a5':61202, '1f3a6':62819, '1f3a7':61171, '1f3a8':51105, '1f3a9':61146, '1f3aa':4871, '1f3ab':51044, '1f3ac':61205, '1f3ad':51103, '1f3ae':51086, '1f3af':51078, '1f3b0':51088, '1f3b1':51081, '1f3b2':51089, '1f3b3':51060, '1f3b4':51102, '1f3b5':61165, '1f3b6':61166, '1f3b7':61173, '1f3b8':61175, '1f3b9':61176, '1f3ba':61177, '1f3bb':61178, '1f3bc':61164, '1f3bd':51074, '1f3be':51058, '1f3bf':51075, '1f3c0':51054, '1f3c1':71586, '1f3c2':1600, '1f3c3-200d-2640':1584, '1f3c3-200d-2642':1583, '1f3c3':1582, '1f3c4-200d-2640':1606, '1f3c4-200d-2642':1605, '1f3c4':1604, '1f3c5':51047, '1f3c6':51046, '1f3c7':1598, '1f3c8':51056, '1f3c9':51057, '1f3ca-200d-2640':1612, '1f3ca-200d-2642':1611, '1f3ca':1610, '1f3cb-200d-2640':1618, '1f3cb-200d-2642':1617, '1f3cb':1616, '1f3cc-200d-2640':1603, '1f3cc-200d-2642':1602, '1f3cc':1601, '1f3cd':4902, '1f3ce':4901, '1f3cf':51061, '1f3d0':51055, '1f3d1':51062, '1f3d2':51063, '1f3d3':51065, '1f3d4':4813, '1f3d5':4817, '1f3d6':4818, '1f3d7':4824, '1f3d8':4829, '1f3d9':4859, '1f3da':4830, '1f3db':4823, '1f3dc':4819, '1f3dd':4820, '1f3de':4821, '1f3df':4822, '1f3e0':4831, '1f3e1':4832, '1f3e2':4833, '1f3e3':4834, '1f3e4':4835, '1f3e5':4836, '1f3e6':4837, '1f3e7':62729, '1f3e8':4838, '1f3e9':4839, '1f3ea':4840, '1f3eb':4841, '1f3ec':4842, '1f3ed':4843, '1f3ee':61216, '1f3ef':4844, '1f3f0':4845, '1f3f3-200d-1f308':71591, '1f3f3-200d-26a7':71592, '1f3f3':71590, '1f3f4-200d-2620':71593, '1f3f4-e0067-e0062-e0065-e006e-e0067-e007f':71852, '1f3f4-e0067-e0062-e0073-e0063-e0074-e007f':71853, '1f3f4-e0067-e0062-e0077-e006c-e0073-e007f':71854, '1f3f4':71589, '1f3f5':2652, '1f3f7':61234, '1f3f8':51066, '1f3f9':61303, '1f3fa':3805, '1f3fb':9525, '1f3fc':9526, '1f3fd':9527, '1f3fe':9528, '1f3ff':9529, '1f400':2576, '1f401':2575, '1f402':2556, '1f403':2557, '1f404':2558, '1f405':2547, '1f406':2548, '1f407':2579, '1f408-200d-2b1b':2544, '1f408':2543, '1f409':2618, '1f40a':2613, '1f40b':2622, '1f40c':2632, '1f40d':2616, '1f40e':2550, '1f40f':2563, '1f410':2565, '1f411':2564, '1f412':2531, '1f413':2596, '1f414':2595, '1f415-200d-1f9ba':2537, '1f415':2535, '1f416':2560, '1f417':2561, '1f418':2570, '1f419':2629, '1f41a':2630, '1f41b':2634, '1f41c':2635, '1f41d':2636, '1f41e':2638, '1f41f':2625, '1f420':2626, '1f421':2627, '1f422':2614, '1f423':2597, '1f424':2598, '1f425':2599, '1f426':2600, '1f427':2601, '1f428':2586, '1f429':2538, '1f42a':2566, '1f42b':2567, '1f42c':2623, '1f42d':2574, '1f42e':2555, '1f42f':2546, '1f430':2578, '1f431':2542, '1f432':2617, '1f433':2621, '1f434':2549, '1f435':2530, '1f436':2534, '1f437':2559, '1f438':2612, '1f439':2577, '1f43a':2539, '1f43b-200d-2744':2585, '1f43b':2584, '1f43c':2587, '1f43d':2562, '1f43e':2593, '1f43f':2580, '1f440':1381, '1f441-200d-1f5e8':1159, '1f441':1382, '1f442':1373, '1f443':1375, '1f444':1384, '1f445':1383, '1f446':1347, '1f447':1349, '1f448':1345, '1f449':1346, '1f44a':1355, '1f44b':1327, '1f44c':1336, '1f44d':1352, '1f44e':1353, '1f44f':1358, '1f450':1361, '1f451':61144, '1f452':61145, '1f453':61110, '1f454':61115, '1f455':61116, '1f456':61117, '1f457':61122, '1f458':61123, '1f459':61128, '1f45a':61129, '1f45b':61130, '1f45c':61131, '1f45d':61132, '1f45e':61136, '1f45f':61137, '1f460':61140, '1f461':61141, '1f462':61143, '1f463':1687, '1f464':1684, '1f465':1685, '1f466':1388, '1f467':1389, '1f468-200d-1f33e':1457, '1f468-200d-1f373':1460, '1f468-200d-1f37c':1524, '1f468-200d-1f393':1448, '1f468-200d-1f3a4':1478, '1f468-200d-1f3a8':1481, '1f468-200d-1f3eb':1451, '1f468-200d-1f3ed':1466, '1f468-200d-1f466-200d-1f466':1674, '1f468-200d-1f466':1673, '1f468-200d-1f467-200d-1f466':1676, '1f468-200d-1f467-200d-1f467':1677, '1f468-200d-1f467':1675, '1f468-200d-1f468-200d-1f466':1663, '1f468-200d-1f468-200d-1f466-200d-1f466':1666, '1f468-200d-1f468-200d-1f467':1664, '1f468-200d-1f468-200d-1f467-200d-1f466':1665, '1f468-200d-1f468-200d-1f467-200d-1f467':1667, '1f468-200d-1f469-200d-1f466':1658, '1f468-200d-1f469-200d-1f466-200d-1f466':1661, '1f468-200d-1f469-200d-1f467':1659, '1f468-200d-1f469-200d-1f467-200d-1f466':1660, '1f468-200d-1f469-200d-1f467-200d-1f467':1662, '1f468-200d-1f4bb':1475, '1f468-200d-1f4bc':1469, '1f468-200d-1f527':1463, '1f468-200d-1f52c':1472, '1f468-200d-1f680':1487, '1f468-200d-1f692':1490, '1f468-200d-1f9af':1574, '1f468-200d-1f9b0':1396, '1f468-200d-1f9b1':1397, '1f468-200d-1f9b2':1399, '1f468-200d-1f9b3':1398, '1f468-200d-1f9bc':1577, '1f468-200d-1f9bd':1580, '1f468-200d-2695':1445, '1f468-200d-2696':1454, '1f468-200d-2708':1484, '1f468-200d-2764-200d-1f468':1655, '1f468-200d-2764-200d-1f48b-200d-1f468':1651, '1f468':1392, '1f469-200d-1f33e':1458, '1f469-200d-1f373':1461, '1f469-200d-1f37c':1523, '1f469-200d-1f393':1449, '1f469-200d-1f3a4':1479, '1f469-200d-1f3a8':1482, '1f469-200d-1f3eb':1452, '1f469-200d-1f3ed':1467, '1f469-200d-1f466-200d-1f466':1679, '1f469-200d-1f466':1678, '1f469-200d-1f467-200d-1f466':1681, '1f469-200d-1f467-200d-1f467':1682, '1f469-200d-1f467':1680, '1f469-200d-1f469-200d-1f466':1668, '1f469-200d-1f469-200d-1f466-200d-1f466':1671, '1f469-200d-1f469-200d-1f467':1669, '1f469-200d-1f469-200d-1f467-200d-1f466':1670, '1f469-200d-1f469-200d-1f467-200d-1f467':1672, '1f469-200d-1f4bb':1476, '1f469-200d-1f4bc':1470, '1f469-200d-1f527':1464, '1f469-200d-1f52c':1473, '1f469-200d-1f680':1488, '1f469-200d-1f692':1491, '1f469-200d-1f9af':1575, '1f469-200d-1f9b0':1401, '1f469-200d-1f9b1':1403, '1f469-200d-1f9b2':1407, '1f469-200d-1f9b3':1405, '1f469-200d-1f9bc':1578, '1f469-200d-1f9bd':1581, '1f469-200d-2695':1446, '1f469-200d-2696':1455, '1f469-200d-2708':1485, '1f469-200d-2764-200d-1f468':1654, '1f469-200d-2764-200d-1f469':1656, '1f469-200d-2764-200d-1f48b-200d-1f468':1650, '1f469-200d-2764-200d-1f48b-200d-1f469':1652, '1f469':1400, '1f46a':1657, '1f46b':1647, '1f46c':1648, '1f46d':1646, '1f46e-200d-2640':1494, '1f46e-200d-2642':1493, '1f46e':1492, '1f46f-200d-2640':1590, '1f46f-200d-2642':1589, '1f46f':1588, '1f470-200d-2640':1518, '1f470-200d-2642':1517, '1f470':1516, '1f471-200d-2640':1409, '1f471-200d-2642':1410, '1f471':1391, '1f472':1511, '1f473-200d-2640':1510, '1f473-200d-2642':1509, '1f473':1508, '1f474':1412, '1f475':1413, '1f476':1386, '1f477-200d-2640':1504, '1f477-200d-2642':1503, '1f477':1502, '1f478':1507, '1f479':1109, '1f47a':1110, '1f47b':1111, '1f47c':1526, '1f47d':1112, '1f47e':1113, '1f47f':1104, '1f480':1105, '1f481-200d-2640':1428, '1f481-200d-2642':1427, '1f481':1426, '1f482-200d-2640':1500, '1f482-200d-2642':1499, '1f482':1498, '1f483':1585, '1f484':61152, '1f485':1366, '1f486-200d-2640':1560, '1f486-200d-2642':1559, '1f486':1558, '1f487-200d-2640':1563, '1f487-200d-2642':1562, '1f487':1561, '1f488':4870, '1f489':61326, '1f48a':61328, '1f48b':1127, '1f48c':1128, '1f48d':61153, '1f48e':61154, '1f48f':1649, '1f490':2648, '1f491':1653, '1f492':4846, '1f493':1133, '1f494':1138, '1f495':1135, '1f496':1131, '1f497':1132, '1f498':1129, '1f499':1145, '1f49a':1144, '1f49b':1143, '1f49c':1146, '1f49d':1130, '1f49e':1134, '1f49f':1136, '1f4a0':62946, '1f4a1':61214, '1f4a2':1151, '1f4a3':1157, '1f4a4':1163, '1f4a5':1152, '1f4a6':1154, '1f4a7':41022, '1f4a8':1155, '1f4a9':1107, '1f4aa':1368, '1f4ab':1153, '1f4ac':1158, '1f4ad':1162, '1f4ae':2650, '1f4af':1150, '1f4b0':61235, '1f4b1':62841, '1f4b2':62842, '1f4b3':61242, '1f4b4':61237, '1f4b5':61238, '1f4b6':61239, '1f4b7':61240, '1f4b8':61241, '1f4b9':61244, '1f4ba':4936, '1f4bb':61191, '1f4bc':61265, '1f4bd':61197, '1f4be':61198, '1f4bf':61199, '1f4c0':61200, '1f4c1':61266, '1f4c2':61267, '1f4c3':61227, '1f4c4':61229, '1f4c5':61269, '1f4c6':61270, '1f4c7':61273, '1f4c8':61274, '1f4c9':61275, '1f4ca':61276, '1f4cb':61277, '1f4cc':61278, '1f4cd':61279, '1f4ce':61280, '1f4cf':61282, '1f4d0':61283, '1f4d1':61232, '1f4d2':61226, '1f4d3':61225, '1f4d4':61218, '1f4d5':61219, '1f4d6':61220, '1f4d7':61221, '1f4d8':61222, '1f4d9':61223, '1f4da':61224, '1f4db':62847, '1f4dc':61228, '1f4dd':61264, '1f4de':61185, '1f4df':61186, '1f4e0':61187, '1f4e1':61325, '1f4e2':61159, '1f4e3':61160, '1f4e4':61249, '1f4e5':61250, '1f4e6':61251, '1f4e7':61246, '1f4e8':61247, '1f4e9':61248, '1f4ea':61253, '1f4eb':61252, '1f4ec':61254, '1f4ed':61255, '1f4ee':61256, '1f4ef':61161, '1f4f0':61230, '1f4f1':61182, '1f4f2':61183, '1f4f3':62823, '1f4f4':62824, '1f4f5':62751, '1f4f6':62822, '1f4f7':61207, '1f4f8':61208, '1f4f9':61209, '1f4fa':61206, '1f4fb':61172, '1f4fc':61210, '1f4fd':61204, '1f4ff':61151, '1f500':62801, '1f501':62802, '1f502':62803, '1f503':62769, '1f504':62770, '1f505':62820, '1f506':62821, '1f507':61155, '1f508':61156, '1f509':61157, '1f50a':61158, '1f50b':61188, '1f50c':61190, '1f50d':61211, '1f50e':61212, '1f50f':61290, '1f510':61291, '1f511':61292, '1f512':61288, '1f513':61289, '1f514':61162, '1f515':61163, '1f516':61233, '1f517':61313, '1f518':62947, '1f519':62771, '1f51a':62772, '1f51b':62773, '1f51c':62774, '1f51d':62775, '1f51e':62752, '1f51f':62876, '1f520':62877, '1f521':62878, '1f522':62879, '1f523':62880, '1f524':62881, '1f525':41021, '1f526':61215, '1f527':61306, '1f528':61294, '1f529':61308, '1f52a':3803, '1f52b':61301, '1f52c':61323, '1f52d':61324, '1f52e':51082, '1f52f':62787, '1f530':62848, '1f531':62846, '1f532':62949, '1f533':62948, '1f534':62916, '1f535':62920, '1f536':62940, '1f537':62941, '1f538':62942, '1f539':62943, '1f53a':62944, '1f53b':62945, '1f53c':62811, '1f53d':62813, '1f549':62778, '1f54a':2602, '1f54b':4854, '1f54c':4850, '1f54d':4852, '1f54e':62786, '1f550':4955, '1f551':4957, '1f552':4959, '1f553':4961, '1f554':4963, '1f555':4965, '1f556':4967, '1f557':4969, '1f558':4971, '1f559':4973, '1f55a':4975, '1f55b':4953, '1f55c':4956, '1f55d':4958, '1f55e':4960, '1f55f':4962, '1f560':4964, '1f561':4966, '1f562':4968, '1f563':4970, '1f564':4972, '1f565':4974, '1f566':4976, '1f567':4954, '1f56f':61213, '1f570':4952, '1f573':1156, '1f574':1587, '1f575-200d-2640':1497, '1f575-200d-2642':1496, '1f575':1495, '1f576':61111, '1f577':2641, '1f578':2642, '1f579':51087, '1f57a':1586, '1f587':61281, '1f58a':61261, '1f58b':61260, '1f58c':61262, '1f58d':61263, '1f590':1329, '1f595':1348, '1f596':1331, '1f5a4':1148, '1f5a5':61192, '1f5a8':61193, '1f5b1':61195, '1f5b2':61196, '1f5bc':51104, '1f5c2':61268, '1f5c3':61285, '1f5c4':61286, '1f5d1':61287, '1f5d2':61271, '1f5d3':61272, '1f5dc':61310, '1f5dd':61293, '1f5de':61231, '1f5e1':61299, '1f5e3':1683, '1f5e8':1160, '1f5ef':1161, '1f5f3':61257, '1f5fa':4810, '1f5fb':4816, '1f5fc':4847, '1f5fd':4848, '1f5fe':4811, '1f5ff':61362, '1f600':11, '1f601':14, '1f602':18, '1f603':12, '1f604':13, '1f605':16, '1f606':15, '1f607':114, '1f608':1103, '1f609':112, '1f60a':113, '1f60b':124, '1f60c':150, '1f60d':116, '1f60e':170, '1f60f':144, '1f610':139, '1f611':140, '1f612':145, '1f613':195, '1f614':151, '1f615':173, '1f616':192, '1f617':119, '1f618':118, '1f619':122, '1f61a':121, '1f61b':125, '1f61c':126, '1f61d':128, '1f61e':194, '1f61f':175, '1f620':1101, '1f621':1100, '1f622':189, '1f623':193, '1f624':199, '1f625':188, '1f626':184, '1f627':185, '1f628':186, '1f629':196, '1f62a':152, '1f62b':197, '1f62c':147, '1f62d':190, '1f62e-200d-1f4a8':148, '1f62e':178, '1f62f':179, '1f630':187, '1f631':191, '1f632':180, '1f633':181, '1f634':154, '1f635-200d-1f4ab':165, '1f635':164, '1f636-200d-1f32b':143, '1f636':141, '1f637':155, '1f638':1116, '1f639':1117, '1f63a':1115, '1f63b':1118, '1f63c':1119, '1f63d':1120, '1f63e':1123, '1f63f':1122, '1f640':1121, '1f641':176, '1f642':19, '1f643':110, '1f644':146, '1f645-200d-2640':1422, '1f645-200d-2642':1421, '1f645':1420, '1f646-200d-2640':1425, '1f646-200d-2642':1424, '1f646':1423, '1f647-200d-2640':1437, '1f647-200d-2642':1436, '1f647':1435, '1f648':1124, '1f649':1125, '1f64a':1126, '1f64b-200d-2640':1431, '1f64b-200d-2642':1430, '1f64b':1429, '1f64c':1359, '1f64d-200d-2640':1416, '1f64d-200d-2642':1415, '1f64d':1414, '1f64e-200d-2640':1419, '1f64e-200d-2642':1418, '1f64e':1417, '1f64f':1364, '1f680':4942, '1f681':4937, '1f682':4872, '1f683':4873, '1f684':4874, '1f685':4875, '1f686':4876, '1f687':4877, '1f688':4878, '1f689':4879, '1f68a':4880, '1f68b':4883, '1f68c':4884, '1f68d':4885, '1f68e':4886, '1f68f':4911, '1f690':4887, '1f691':4888, '1f692':4889, '1f693':4890, '1f694':4891, '1f695':4892, '1f696':4893, '1f697':4894, '1f698':4895, '1f699':4896, '1f69a':4898, '1f69b':4899, '1f69c':4900, '1f69d':4881, '1f69e':4882, '1f69f':4938, '1f6a0':4939, '1f6a1':4940, '1f6a2':4930, '1f6a3-200d-2640':1609, '1f6a3-200d-2642':1608, '1f6a3':1607, '1f6a4':4926, '1f6a5':4918, '1f6a6':4919, '1f6a7':4921, '1f6a8':4917, '1f6a9':71587, '1f6aa':61333, '1f6ab':62745, '1f6ac':61358, '1f6ad':62747, '1f6ae':62730, '1f6af':62748, '1f6b0':62731, '1f6b1':62749, '1f6b2':4907, '1f6b3':62746, '1f6b4-200d-2640':1621, '1f6b4-200d-2642':1620, '1f6b4':1619, '1f6b5-200d-2640':1624, '1f6b5-200d-2642':1623, '1f6b5':1622, '1f6b6-200d-2640':1566, '1f6b6-200d-2642':1565, '1f6b6':1564, '1f6b7':62750, '1f6b8':62743, '1f6b9':62733, '1f6ba':62734, '1f6bb':62735, '1f6bc':62736, '1f6bd':61340, '1f6be':62737, '1f6bf':61342, '1f6c0':1643, '1f6c1':61343, '1f6c2':62738, '1f6c3':62739, '1f6c4':62740, '1f6c5':62741, '1f6cb':61338, '1f6cc':1644, '1f6cd':61133, '1f6ce':4944, '1f6cf':61337, '1f6d0':62776, '1f6d1':4920, '1f6d2':61357, '1f6d5':4851, '1f6d6':4828, '1f6d7':61334, '1f6e0':61298, '1f6e1':61304, '1f6e2':4914, '1f6e3':4912, '1f6e4':4913, '1f6e5':4929, '1f6e9':4932, '1f6eb':4933, '1f6ec':4934, '1f6f0':4941, '1f6f3':4927, '1f6f4':4908, '1f6f5':4903, '1f6f6':4925, '1f6f7':51076, '1f6f8':4943, '1f6f9':4909, '1f6fa':4906, '1f6fb':4897, '1f6fc':4910, '1f7e0':62917, '1f7e1':62918, '1f7e2':62919, '1f7e3':62921, '1f7e4':62922, '1f7e5':62925, '1f7e6':62929, '1f7e7':62926, '1f7e8':62927, '1f7e9':62928, '1f7ea':62930, '1f7eb':62931, '1f90c':1337, '1f90d':1149, '1f90e':1147, '1f90f':1338, '1f910':137, '1f911':129, '1f912':156, '1f913':171, '1f914':135, '1f915':157, '1f916':1114, '1f917':130, '1f918':1343, '1f919':1344, '1f91a':1328, '1f91b':1356, '1f91c':1357, '1f91d':1363, '1f91e':1340, '1f91f':1342, '1f920':167, '1f921':1108, '1f922':158, '1f923':17, '1f924':153, '1f925':149, '1f926-200d-2640':1440, '1f926-200d-2642':1439, '1f926':1438, '1f927':160, '1f928':138, '1f929':117, '1f92a':127, '1f92b':134, '1f92c':1102, '1f92d':131, '1f92e':159, '1f92f':166, '1f930':1519, '1f931':1522, '1f932':1362, '1f933':1367, '1f934':1506, '1f935-200d-2640':1515, '1f935-200d-2642':1514, '1f935':1513, '1f936':1528, '1f937-200d-2640':1443, '1f937-200d-2642':1442, '1f937':1441, '1f938-200d-2640':1627, '1f938-200d-2642':1626, '1f938':1625, '1f939-200d-2640':1639, '1f939-200d-2642':1638, '1f939':1637, '1f93a':1597, '1f93c-200d-2640':1630, '1f93c-200d-2642':1629, '1f93c':1628, '1f93d-200d-2640':1633, '1f93d-200d-2642':1632, '1f93d':1631, '1f93e-200d-2640':1636, '1f93e-200d-2642':1635, '1f93e':1634, '1f93f':51073, '1f940':2654, '1f941':61180, '1f942':3791, '1f943':3792, '1f944':3802, '1f945':51069, '1f947':51048, '1f948':51049, '1f949':51050, '1f94a':51067, '1f94b':51068, '1f94c':51077, '1f94d':51064, '1f94e':51053, '1f94f':51059, '1f950':3710, '1f951':3693, '1f952':3700, '1f953':3721, '1f954':3695, '1f955':3696, '1f956':3711, '1f957':3738, '1f958':3734, '1f959':3730, '1f95a':3732, '1f95b':3780, '1f95c':3706, '1f95d':3689, '1f95e':3715, '1f95f':3757, '1f960':3758, '1f961':3759, '1f962':3799, '1f963':3737, '1f964':3794, '1f965':3692, '1f966':3702, '1f967':3773, '1f968':3713, '1f969':3720, '1f96a':3726, '1f96b':3742, '1f96c':3701, '1f96d':3681, '1f96e':3755, '1f96f':3714, '1f970':115, '1f971':198, '1f972':123, '1f973':168, '1f974':163, '1f975':161, '1f976':162, '1f977':1501, '1f978':169, '1f97a':182, '1f97b':61124, '1f97c':61113, '1f97d':61112, '1f97e':61138, '1f97f':61139, '1f980':3760, '1f981':2545, '1f982':2643, '1f983':2594, '1f984':2551, '1f985':2603, '1f986':2604, '1f987':2583, '1f988':2628, '1f989':2606, '1f98a':2540, '1f98b':2633, '1f98c':2553, '1f98d':2532, '1f98e':2615, '1f98f':2572, '1f990':3762, '1f991':3763, '1f992':2569, '1f993':2552, '1f994':2582, '1f995':2619, '1f996':2620, '1f997':2639, '1f998':2591, '1f999':2568, '1f99a':2610, '1f99b':2573, '1f99c':2611, '1f99d':2541, '1f99e':3761, '1f99f':2644, '1f9a0':2647, '1f9a1':2592, '1f9a2':2605, '1f9a3':2571, '1f9a4':2607, '1f9a5':2588, '1f9a6':2589, '1f9a7':2533, '1f9a8':2590, '1f9a9':2609, '1f9aa':3764, '1f9ab':2581, '1f9ac':2554, '1f9ad':2624, '1f9ae':2536, '1f9af':61312, '1f9b4':1380, '1f9b5':1371, '1f9b6':1372, '1f9b7':1379, '1f9b8-200d-2640':1532, '1f9b8-200d-2642':1531, '1f9b8':1530, '1f9b9-200d-2640':1535, '1f9b9-200d-2642':1534, '1f9b9':1533, '1f9ba':61114, '1f9bb':1374, '1f9bc':4905, '1f9bd':4904, '1f9be':1369, '1f9bf':1370, '1f9c0':3717, '1f9c1':3772, '1f9c2':3741, '1f9c3':3796, '1f9c4':3703, '1f9c5':3704, '1f9c6':3731, '1f9c7':3716, '1f9c8':3740, '1f9c9':3797, '1f9ca':3798, '1f9cb':3795, '1f9cd-200d-2640':1569, '1f9cd-200d-2642':1568, '1f9cd':1567, '1f9ce-200d-2640':1572, '1f9ce-200d-2642':1571, '1f9ce':1570, '1f9cf-200d-2640':1434, '1f9cf-200d-2642':1433, '1f9cf':1432, '1f9d0':172, '1f9d1-200d-1f33e':1456, '1f9d1-200d-1f373':1459, '1f9d1-200d-1f37c':1525, '1f9d1-200d-1f384':1529, '1f9d1-200d-1f393':1447, '1f9d1-200d-1f3a4':1477, '1f9d1-200d-1f3a8':1480, '1f9d1-200d-1f3eb':1450, '1f9d1-200d-1f3ed':1465, '1f9d1-200d-1f4bb':1474, '1f9d1-200d-1f4bc':1468, '1f9d1-200d-1f527':1462, '1f9d1-200d-1f52c':1471, '1f9d1-200d-1f680':1486, '1f9d1-200d-1f692':1489, '1f9d1-200d-1f91d-200d-1f9d1':1645, '1f9d1-200d-1f9af':1573, '1f9d1-200d-1f9b0':1402, '1f9d1-200d-1f9b1':1404, '1f9d1-200d-1f9b2':1408, '1f9d1-200d-1f9b3':1406, '1f9d1-200d-1f9bc':1576, '1f9d1-200d-1f9bd':1579, '1f9d1-200d-2695':1444, '1f9d1-200d-2696':1453, '1f9d1-200d-2708':1483, '1f9d1':1390, '1f9d2':1387, '1f9d3':1411, '1f9d4-200d-2640':1395, '1f9d4-200d-2642':1394, '1f9d4':1393, '1f9d5':1512, '1f9d6-200d-2640':1593, '1f9d6-200d-2642':1592, '1f9d6':1591, '1f9d7-200d-2640':1596, '1f9d7-200d-2642':1595, '1f9d7':1594, '1f9d8-200d-2640':1642, '1f9d8-200d-2642':1641, '1f9d8':1640, '1f9d9-200d-2640':1538, '1f9d9-200d-2642':1537, '1f9d9':1536, '1f9da-200d-2640':1541, '1f9da-200d-2642':1540, '1f9da':1539, '1f9db-200d-2640':1544, '1f9db-200d-2642':1543, '1f9db':1542, '1f9dc-200d-2640':1547, '1f9dc-200d-2642':1546, '1f9dc':1545, '1f9dd-200d-2640':1550, '1f9dd-200d-2642':1549, '1f9dd':1548, '1f9de-200d-2640':1553, '1f9de-200d-2642':1552, '1f9de':1551, '1f9df-200d-2640':1556, '1f9df-200d-2642':1555, '1f9df':1554, '1f9e0':1376, '1f9e1':1142, '1f9e2':61148, '1f9e3':61118, '1f9e4':61119, '1f9e5':61120, '1f9e6':61121, '1f9e7':51039, '1f9e8':51028, '1f9e9':51090, '1f9ea':61320, '1f9eb':61321, '1f9ec':61322, '1f9ed':4812, '1f9ee':61201, '1f9ef':61356, '1f9f0':61316, '1f9f1':4825, '1f9f2':61317, '1f9f3':4945, '1f9f4':61346, '1f9f5':51106, '1f9f6':51108, '1f9f7':61347, '1f9f8':51091, '1f9f9':61348, '1f9fa':61349, '1f9fb':61350, '1f9fc':61352, '1f9fd':61355, '1f9fe':61243, '1f9ff':51084, '1fa70':61142, '1fa71':61125, '1fa72':61126, '1fa73':61127, '1fa74':61135, '1fa78':61327, '1fa79':61329, '1fa7a':61331, '1fa80':51079, '1fa81':51080, '1fa82':4935, '1fa83':61302, '1fa84':51083, '1fa85':51092, '1fa86':51094, '1fa90':4993, '1fa91':61339, '1fa92':61345, '1fa93':61295, '1fa94':61217, '1fa95':61179, '1fa96':61149, '1fa97':61174, '1fa98':61181, '1fa99':61236, '1fa9a':61305, '1fa9b':61307, '1fa9c':61318, '1fa9d':61315, '1fa9e':61335, '1fa9f':61336, '1faa0':61341, '1faa1':51107, '1faa2':51109, '1faa3':61351, '1faa4':61344, '1faa5':61354, '1faa6':61360, '1faa7':61363, '1faa8':4826, '1fab0':2645, '1fab1':2646, '1fab2':2637, '1fab3':2640, '1fab4':2660, '1fab5':4827, '1fab6':2608, '1fac0':1377, '1fac1':1378, '1fac2':1686, '1fad0':3688, '1fad1':3699, '1fad2':3691, '1fad3':3712, '1fad4':3729, '1fad5':3736, '1fad6':3782, '203c':62834, '21a9':62765, '21aa':62766, '231a':4948, '231b':4946, '23cf':62818, '23e9':62805, '23ea':62809, '23eb':62812, '23ec':62814, '23ed':62806, '23ee':62810, '23ef':62807, '23f0':4949, '23f1':4950, '23f2':4951, '23f3':4947, '23f8':62815, '23f9':62816, '23fa':62817, '24c2':62890, '25aa':62938, '25ab':62939, '25b6':62804, '25c0':62808, '25fb':62935, '25fc':62934, '25fd':62937, '25fe':62936, '260e':61184, '261d':1350, '262a':62784, '262e':62785, '262f':62781, '263a':120, '264a':62790, '264b':62791, '264c':62792, '264d':62793, '264e':62794, '264f':62795, '265f':51099, '267b':62844, '267e':62833, '267f':62732, '269b':62777, '269c':62845, '26a0':62742, '26a1':41016, '26a7':62827, '26aa':62924, '26ab':62923, '26b0':61359, '26b1':61361, '26bd':51051, '26be':51052, '26c4':41019, '26c5':4999, '26c8':41000, '26ce':62800, '26cf':61296, '26d1':61150, '26d3':61314, '26d4':62744, '26e9':4853, '26ea':4849, '26f0':4814, '26f1':41015, '26f2':4855, '26f3':51070, '26f4':4928, '26f5':4924, '26f7':1599, '26f8':51071, '26f9-200d-2640':1615, '26f9-200d-2642':1614, '26f9':1613, '26fa':4856, '26fd':4915, '270a':1354, '270b':1330, '270c':1339, '270d':1365, '270f':61258, '271d':62782, '274c':62853, '274e':62854, '2764-200d-1f525':1139, '2764-200d-1fa79':1140, '27a1':62757, '27b0':62855, '27bf':62856, '2b05':62761, '2b06':62755, '2b07':62759, '2b1b':62932, '2b1c':62933, '2b50':4994, '2b55':62849, '303d':62857, '1f385-1f3fb':0, '1f385-1f3fc':0, '1f385-1f3fd':0, '1f385-1f3fe':0, '1f385-1f3ff':0, '1f3c2-1f3fb':0, '1f3c2-1f3fc':0, '1f3c2-1f3fd':0, '1f3c2-1f3fe':0, '1f3c2-1f3ff':0, '1f3c3-1f3fb-200d-2640':0, '1f3c3-1f3fc-200d-2640':0, '1f3c3-1f3fd-200d-2640':0, '1f3c3-1f3fe-200d-2640':0, '1f3c3-1f3ff-200d-2640':0, '1f3c3-1f3fb-200d-2642':0, '1f3c3-1f3fc-200d-2642':0, '1f3c3-1f3fd-200d-2642':0, '1f3c3-1f3fe-200d-2642':0, '1f3c3-1f3ff-200d-2642':0, '1f3c3-1f3fb':0, '1f3c3-1f3fc':0, '1f3c3-1f3fd':0, '1f3c3-1f3fe':0, '1f3c3-1f3ff':0, '1f3c4-1f3fb-200d-2640':0, '1f3c4-1f3fc-200d-2640':0, '1f3c4-1f3fd-200d-2640':0, '1f3c4-1f3fe-200d-2640':0, '1f3c4-1f3ff-200d-2640':0, '1f3c4-1f3fb-200d-2642':0, '1f3c4-1f3fc-200d-2642':0, '1f3c4-1f3fd-200d-2642':0, '1f3c4-1f3fe-200d-2642':0, '1f3c4-1f3ff-200d-2642':0, '1f3c4-1f3fb':0, '1f3c4-1f3fc':0, '1f3c4-1f3fd':0, '1f3c4-1f3fe':0, '1f3c4-1f3ff':0, '1f3c7-1f3fb':0, '1f3c7-1f3fc':0, '1f3c7-1f3fd':0, '1f3c7-1f3fe':0, '1f3c7-1f3ff':0, '1f3ca-1f3fb-200d-2640':0, '1f3ca-1f3fc-200d-2640':0, '1f3ca-1f3fd-200d-2640':0, '1f3ca-1f3fe-200d-2640':0, '1f3ca-1f3ff-200d-2640':0, '1f3ca-1f3fb-200d-2642':0, '1f3ca-1f3fc-200d-2642':0, '1f3ca-1f3fd-200d-2642':0, '1f3ca-1f3fe-200d-2642':0, '1f3ca-1f3ff-200d-2642':0, '1f3ca-1f3fb':0, '1f3ca-1f3fc':0, '1f3ca-1f3fd':0, '1f3ca-1f3fe':0, '1f3ca-1f3ff':0, '1f3cb-1f3fb-200d-2640':0, '1f3cb-1f3fc-200d-2640':0, '1f3cb-1f3fd-200d-2640':0, '1f3cb-1f3fe-200d-2640':0, '1f3cb-1f3ff-200d-2640':0, '1f3cb-1f3fb-200d-2642':0, '1f3cb-1f3fc-200d-2642':0, '1f3cb-1f3fd-200d-2642':0, '1f3cb-1f3fe-200d-2642':0, '1f3cb-1f3ff-200d-2642':0, '1f3cb-1f3fb':0, '1f3cb-1f3fc':0, '1f3cb-1f3fd':0, '1f3cb-1f3fe':0, '1f3cb-1f3ff':0, '1f3cc-1f3fb-200d-2640':0, '1f3cc-1f3fc-200d-2640':0, '1f3cc-1f3fd-200d-2640':0, '1f3cc-1f3fe-200d-2640':0, '1f3cc-1f3ff-200d-2640':0, '1f3cc-1f3fb-200d-2642':0, '1f3cc-1f3fc-200d-2642':0, '1f3cc-1f3fd-200d-2642':0, '1f3cc-1f3fe-200d-2642':0, '1f3cc-1f3ff-200d-2642':0, '1f3cc-1f3fb':0, '1f3cc-1f3fc':0, '1f3cc-1f3fd':0, '1f3cc-1f3fe':0, '1f3cc-1f3ff':0, '1f442-1f3fb':0, '1f442-1f3fc':0, '1f442-1f3fd':0, '1f442-1f3fe':0, '1f442-1f3ff':0, '1f443-1f3fb':0, '1f443-1f3fc':0, '1f443-1f3fd':0, '1f443-1f3fe':0, '1f443-1f3ff':0, '1f446-1f3fb':0, '1f446-1f3fc':0, '1f446-1f3fd':0, '1f446-1f3fe':0, '1f446-1f3ff':0, '1f447-1f3fb':0, '1f447-1f3fc':0, '1f447-1f3fd':0, '1f447-1f3fe':0, '1f447-1f3ff':0, '1f448-1f3fb':0, '1f448-1f3fc':0, '1f448-1f3fd':0, '1f448-1f3fe':0, '1f448-1f3ff':0, '1f449-1f3fb':0, '1f449-1f3fc':0, '1f449-1f3fd':0, '1f449-1f3fe':0, '1f449-1f3ff':0, '1f44a-1f3fb':0, '1f44a-1f3fc':0, '1f44a-1f3fd':0, '1f44a-1f3fe':0, '1f44a-1f3ff':0, '1f44b-1f3fb':0, '1f44b-1f3fc':0, '1f44b-1f3fd':0, '1f44b-1f3fe':0, '1f44b-1f3ff':0, '1f44c-1f3fb':0, '1f44c-1f3fc':0, '1f44c-1f3fd':0, '1f44c-1f3fe':0, '1f44c-1f3ff':0, '1f44d-1f3fb':0, '1f44d-1f3fc':0, '1f44d-1f3fd':0, '1f44d-1f3fe':0, '1f44d-1f3ff':0, '1f44e-1f3fb':0, '1f44e-1f3fc':0, '1f44e-1f3fd':0, '1f44e-1f3fe':0, '1f44e-1f3ff':0, '1f44f-1f3fb':0, '1f44f-1f3fc':0, '1f44f-1f3fd':0, '1f44f-1f3fe':0, '1f44f-1f3ff':0, '1f450-1f3fb':0, '1f450-1f3fc':0, '1f450-1f3fd':0, '1f450-1f3fe':0, '1f450-1f3ff':0, '1f466-1f3fb':0, '1f466-1f3fc':0, '1f466-1f3fd':0, '1f466-1f3fe':0, '1f466-1f3ff':0, '1f467-1f3fb':0, '1f467-1f3fc':0, '1f467-1f3fd':0, '1f467-1f3fe':0, '1f467-1f3ff':0, '1f468-1f3fb-200d-1f33e':0, '1f468-1f3fc-200d-1f33e':0, '1f468-1f3fd-200d-1f33e':0, '1f468-1f3fe-200d-1f33e':0, '1f468-1f3ff-200d-1f33e':0, '1f468-1f3fb-200d-1f373':0, '1f468-1f3fc-200d-1f373':0, '1f468-1f3fd-200d-1f373':0, '1f468-1f3fe-200d-1f373':0, '1f468-1f3ff-200d-1f373':0, '1f468-1f3fb-200d-1f37c':0, '1f468-1f3fc-200d-1f37c':0, '1f468-1f3fd-200d-1f37c':0, '1f468-1f3fe-200d-1f37c':0, '1f468-1f3ff-200d-1f37c':0, '1f468-1f3fb-200d-1f393':0, '1f468-1f3fc-200d-1f393':0, '1f468-1f3fd-200d-1f393':0, '1f468-1f3fe-200d-1f393':0, '1f468-1f3ff-200d-1f393':0, '1f468-1f3fb-200d-1f3a4':0, '1f468-1f3fc-200d-1f3a4':0, '1f468-1f3fd-200d-1f3a4':0, '1f468-1f3fe-200d-1f3a4':0, '1f468-1f3ff-200d-1f3a4':0, '1f468-1f3fb-200d-1f3a8':0, '1f468-1f3fc-200d-1f3a8':0, '1f468-1f3fd-200d-1f3a8':0, '1f468-1f3fe-200d-1f3a8':0, '1f468-1f3ff-200d-1f3a8':0, '1f468-1f3fb-200d-1f3eb':0, '1f468-1f3fc-200d-1f3eb':0, '1f468-1f3fd-200d-1f3eb':0, '1f468-1f3fe-200d-1f3eb':0, '1f468-1f3ff-200d-1f3eb':0, '1f468-1f3fb-200d-1f3ed':0, '1f468-1f3fc-200d-1f3ed':0, '1f468-1f3fd-200d-1f3ed':0, '1f468-1f3fe-200d-1f3ed':0, '1f468-1f3ff-200d-1f3ed':0, '1f468-1f3fb-200d-1f4bb':0, '1f468-1f3fc-200d-1f4bb':0, '1f468-1f3fd-200d-1f4bb':0, '1f468-1f3fe-200d-1f4bb':0, '1f468-1f3ff-200d-1f4bb':0, '1f468-1f3fb-200d-1f4bc':0, '1f468-1f3fc-200d-1f4bc':0, '1f468-1f3fd-200d-1f4bc':0, '1f468-1f3fe-200d-1f4bc':0, '1f468-1f3ff-200d-1f4bc':0, '1f468-1f3fb-200d-1f527':0, '1f468-1f3fc-200d-1f527':0, '1f468-1f3fd-200d-1f527':0, '1f468-1f3fe-200d-1f527':0, '1f468-1f3ff-200d-1f527':0, '1f468-1f3fb-200d-1f52c':0, '1f468-1f3fc-200d-1f52c':0, '1f468-1f3fd-200d-1f52c':0, '1f468-1f3fe-200d-1f52c':0, '1f468-1f3ff-200d-1f52c':0, '1f468-1f3fb-200d-1f680':0, '1f468-1f3fc-200d-1f680':0, '1f468-1f3fd-200d-1f680':0, '1f468-1f3fe-200d-1f680':0, '1f468-1f3ff-200d-1f680':0, '1f468-1f3fb-200d-1f692':0, '1f468-1f3fc-200d-1f692':0, '1f468-1f3fd-200d-1f692':0, '1f468-1f3fe-200d-1f692':0, '1f468-1f3ff-200d-1f692':0, '1f468-1f3fb-200d-1f9af':0, '1f468-1f3fc-200d-1f9af':0, '1f468-1f3fd-200d-1f9af':0, '1f468-1f3fe-200d-1f9af':0, '1f468-1f3ff-200d-1f9af':0, '1f468-1f3fb-200d-1f9b0':0, '1f468-1f3fc-200d-1f9b0':0, '1f468-1f3fd-200d-1f9b0':0, '1f468-1f3fe-200d-1f9b0':0, '1f468-1f3ff-200d-1f9b0':0, '1f468-1f3fb-200d-1f9b1':0, '1f468-1f3fc-200d-1f9b1':0, '1f468-1f3fd-200d-1f9b1':0, '1f468-1f3fe-200d-1f9b1':0, '1f468-1f3ff-200d-1f9b1':0, '1f468-1f3fb-200d-1f9b2':0, '1f468-1f3fc-200d-1f9b2':0, '1f468-1f3fd-200d-1f9b2':0, '1f468-1f3fe-200d-1f9b2':0, '1f468-1f3ff-200d-1f9b2':0, '1f468-1f3fb-200d-1f9b3':0, '1f468-1f3fc-200d-1f9b3':0, '1f468-1f3fd-200d-1f9b3':0, '1f468-1f3fe-200d-1f9b3':0, '1f468-1f3ff-200d-1f9b3':0, '1f468-1f3fb-200d-1f9bc':0, '1f468-1f3fc-200d-1f9bc':0, '1f468-1f3fd-200d-1f9bc':0, '1f468-1f3fe-200d-1f9bc':0, '1f468-1f3ff-200d-1f9bc':0, '1f468-1f3fb-200d-1f9bd':0, '1f468-1f3fc-200d-1f9bd':0, '1f468-1f3fd-200d-1f9bd':0, '1f468-1f3fe-200d-1f9bd':0, '1f468-1f3ff-200d-1f9bd':0, '1f468-1f3fb-200d-2695':0, '1f468-1f3fc-200d-2695':0, '1f468-1f3fd-200d-2695':0, '1f468-1f3fe-200d-2695':0, '1f468-1f3ff-200d-2695':0, '1f468-1f3fb-200d-2696':0, '1f468-1f3fc-200d-2696':0, '1f468-1f3fd-200d-2696':0, '1f468-1f3fe-200d-2696':0, '1f468-1f3ff-200d-2696':0, '1f468-1f3fb-200d-2708':0, '1f468-1f3fc-200d-2708':0, '1f468-1f3fd-200d-2708':0, '1f468-1f3fe-200d-2708':0, '1f468-1f3ff-200d-2708':0, '1f468-1f3fb-200d-2764-200d-1f468-1f3fb':0, '1f468-1f3fb-200d-2764-200d-1f468-1f3fc':0, '1f468-1f3fb-200d-2764-200d-1f468-1f3fd':0, '1f468-1f3fb-200d-2764-200d-1f468-1f3fe':0, '1f468-1f3fb-200d-2764-200d-1f468-1f3ff':0, '1f468-1f3fc-200d-2764-200d-1f468-1f3fb':0, '1f468-1f3fc-200d-2764-200d-1f468-1f3fc':0, '1f468-1f3fc-200d-2764-200d-1f468-1f3fd':0, '1f468-1f3fc-200d-2764-200d-1f468-1f3fe':0, '1f468-1f3fc-200d-2764-200d-1f468-1f3ff':0, '1f468-1f3fd-200d-2764-200d-1f468-1f3fb':0, '1f468-1f3fd-200d-2764-200d-1f468-1f3fc':0, '1f468-1f3fd-200d-2764-200d-1f468-1f3fd':0, '1f468-1f3fd-200d-2764-200d-1f468-1f3fe':0, '1f468-1f3fd-200d-2764-200d-1f468-1f3ff':0, '1f468-1f3fe-200d-2764-200d-1f468-1f3fb':0, '1f468-1f3fe-200d-2764-200d-1f468-1f3fc':0, '1f468-1f3fe-200d-2764-200d-1f468-1f3fd':0, '1f468-1f3fe-200d-2764-200d-1f468-1f3fe':0, '1f468-1f3fe-200d-2764-200d-1f468-1f3ff':0, '1f468-1f3ff-200d-2764-200d-1f468-1f3fb':0, '1f468-1f3ff-200d-2764-200d-1f468-1f3fc':0, '1f468-1f3ff-200d-2764-200d-1f468-1f3fd':0, '1f468-1f3ff-200d-2764-200d-1f468-1f3fe':0, '1f468-1f3ff-200d-2764-200d-1f468-1f3ff':0, '1f468-1f3fb-200d-2764-200d-1f48b-200d-1f468-1f3fb':0, '1f468-1f3fb-200d-2764-200d-1f48b-200d-1f468-1f3fc':0, '1f468-1f3fb-200d-2764-200d-1f48b-200d-1f468-1f3fd':0, '1f468-1f3fb-200d-2764-200d-1f48b-200d-1f468-1f3fe':0, '1f468-1f3fb-200d-2764-200d-1f48b-200d-1f468-1f3ff':0, '1f468-1f3fc-200d-2764-200d-1f48b-200d-1f468-1f3fb':0, '1f468-1f3fc-200d-2764-200d-1f48b-200d-1f468-1f3fc':0, '1f468-1f3fc-200d-2764-200d-1f48b-200d-1f468-1f3fd':0, '1f468-1f3fc-200d-2764-200d-1f48b-200d-1f468-1f3fe':0, '1f468-1f3fc-200d-2764-200d-1f48b-200d-1f468-1f3ff':0, '1f468-1f3fd-200d-2764-200d-1f48b-200d-1f468-1f3fb':0, '1f468-1f3fd-200d-2764-200d-1f48b-200d-1f468-1f3fc':0, '1f468-1f3fd-200d-2764-200d-1f48b-200d-1f468-1f3fd':0, '1f468-1f3fd-200d-2764-200d-1f48b-200d-1f468-1f3fe':0, '1f468-1f3fd-200d-2764-200d-1f48b-200d-1f468-1f3ff':0, '1f468-1f3fe-200d-2764-200d-1f48b-200d-1f468-1f3fb':0, '1f468-1f3fe-200d-2764-200d-1f48b-200d-1f468-1f3fc':0, '1f468-1f3fe-200d-2764-200d-1f48b-200d-1f468-1f3fd':0, '1f468-1f3fe-200d-2764-200d-1f48b-200d-1f468-1f3fe':0, '1f468-1f3fe-200d-2764-200d-1f48b-200d-1f468-1f3ff':0, '1f468-1f3ff-200d-2764-200d-1f48b-200d-1f468-1f3fb':0, '1f468-1f3ff-200d-2764-200d-1f48b-200d-1f468-1f3fc':0, '1f468-1f3ff-200d-2764-200d-1f48b-200d-1f468-1f3fd':0, '1f468-1f3ff-200d-2764-200d-1f48b-200d-1f468-1f3fe':0, '1f468-1f3ff-200d-2764-200d-1f48b-200d-1f468-1f3ff':0, '1f468-1f3fb':0, '1f468-1f3fc':0, '1f468-1f3fd':0, '1f468-1f3fe':0, '1f468-1f3ff':0, '1f469-1f3fb-200d-1f33e':0, '1f469-1f3fc-200d-1f33e':0, '1f469-1f3fd-200d-1f33e':0, '1f469-1f3fe-200d-1f33e':0, '1f469-1f3ff-200d-1f33e':0, '1f469-1f3fb-200d-1f373':0, '1f469-1f3fc-200d-1f373':0, '1f469-1f3fd-200d-1f373':0, '1f469-1f3fe-200d-1f373':0, '1f469-1f3ff-200d-1f373':0, '1f469-1f3fb-200d-1f37c':0, '1f469-1f3fc-200d-1f37c':0, '1f469-1f3fd-200d-1f37c':0, '1f469-1f3fe-200d-1f37c':0, '1f469-1f3ff-200d-1f37c':0, '1f469-1f3fb-200d-1f393':0, '1f469-1f3fc-200d-1f393':0, '1f469-1f3fd-200d-1f393':0, '1f469-1f3fe-200d-1f393':0, '1f469-1f3ff-200d-1f393':0, '1f469-1f3fb-200d-1f3a4':0, '1f469-1f3fc-200d-1f3a4':0, '1f469-1f3fd-200d-1f3a4':0, '1f469-1f3fe-200d-1f3a4':0, '1f469-1f3ff-200d-1f3a4':0, '1f469-1f3fb-200d-1f3a8':0, '1f469-1f3fc-200d-1f3a8':0, '1f469-1f3fd-200d-1f3a8':0, '1f469-1f3fe-200d-1f3a8':0, '1f469-1f3ff-200d-1f3a8':0, '1f469-1f3fb-200d-1f3eb':0, '1f469-1f3fc-200d-1f3eb':0, '1f469-1f3fd-200d-1f3eb':0, '1f469-1f3fe-200d-1f3eb':0, '1f469-1f3ff-200d-1f3eb':0, '1f469-1f3fb-200d-1f3ed':0, '1f469-1f3fc-200d-1f3ed':0, '1f469-1f3fd-200d-1f3ed':0, '1f469-1f3fe-200d-1f3ed':0, '1f469-1f3ff-200d-1f3ed':0, '1f469-1f3fb-200d-1f4bb':0, '1f469-1f3fc-200d-1f4bb':0, '1f469-1f3fd-200d-1f4bb':0, '1f469-1f3fe-200d-1f4bb':0, '1f469-1f3ff-200d-1f4bb':0, '1f469-1f3fb-200d-1f4bc':0, '1f469-1f3fc-200d-1f4bc':0, '1f469-1f3fd-200d-1f4bc':0, '1f469-1f3fe-200d-1f4bc':0, '1f469-1f3ff-200d-1f4bc':0, '1f469-1f3fb-200d-1f527':0, '1f469-1f3fc-200d-1f527':0, '1f469-1f3fd-200d-1f527':0, '1f469-1f3fe-200d-1f527':0, '1f469-1f3ff-200d-1f527':0, '1f469-1f3fb-200d-1f52c':0, '1f469-1f3fc-200d-1f52c':0, '1f469-1f3fd-200d-1f52c':0, '1f469-1f3fe-200d-1f52c':0, '1f469-1f3ff-200d-1f52c':0, '1f469-1f3fb-200d-1f680':0, '1f469-1f3fc-200d-1f680':0, '1f469-1f3fd-200d-1f680':0, '1f469-1f3fe-200d-1f680':0, '1f469-1f3ff-200d-1f680':0, '1f469-1f3fb-200d-1f692':0, '1f469-1f3fc-200d-1f692':0, '1f469-1f3fd-200d-1f692':0, '1f469-1f3fe-200d-1f692':0, '1f469-1f3ff-200d-1f692':0, '1f469-1f3fb-200d-1f9af':0, '1f469-1f3fc-200d-1f9af':0, '1f469-1f3fd-200d-1f9af':0, '1f469-1f3fe-200d-1f9af':0, '1f469-1f3ff-200d-1f9af':0, '1f469-1f3fb-200d-1f9b0':0, '1f469-1f3fc-200d-1f9b0':0, '1f469-1f3fd-200d-1f9b0':0, '1f469-1f3fe-200d-1f9b0':0, '1f469-1f3ff-200d-1f9b0':0, '1f469-1f3fb-200d-1f9b1':0, '1f469-1f3fc-200d-1f9b1':0, '1f469-1f3fd-200d-1f9b1':0, '1f469-1f3fe-200d-1f9b1':0, '1f469-1f3ff-200d-1f9b1':0, '1f469-1f3fb-200d-1f9b2':0, '1f469-1f3fc-200d-1f9b2':0, '1f469-1f3fd-200d-1f9b2':0, '1f469-1f3fe-200d-1f9b2':0, '1f469-1f3ff-200d-1f9b2':0, '1f469-1f3fb-200d-1f9b3':0, '1f469-1f3fc-200d-1f9b3':0, '1f469-1f3fd-200d-1f9b3':0, '1f469-1f3fe-200d-1f9b3':0, '1f469-1f3ff-200d-1f9b3':0, '1f469-1f3fb-200d-1f9bc':0, '1f469-1f3fc-200d-1f9bc':0, '1f469-1f3fd-200d-1f9bc':0, '1f469-1f3fe-200d-1f9bc':0, '1f469-1f3ff-200d-1f9bc':0, '1f469-1f3fb-200d-1f9bd':0, '1f469-1f3fc-200d-1f9bd':0, '1f469-1f3fd-200d-1f9bd':0, '1f469-1f3fe-200d-1f9bd':0, '1f469-1f3ff-200d-1f9bd':0, '1f469-1f3fb-200d-2695':0, '1f469-1f3fc-200d-2695':0, '1f469-1f3fd-200d-2695':0, '1f469-1f3fe-200d-2695':0, '1f469-1f3ff-200d-2695':0, '1f469-1f3fb-200d-2696':0, '1f469-1f3fc-200d-2696':0, '1f469-1f3fd-200d-2696':0, '1f469-1f3fe-200d-2696':0, '1f469-1f3ff-200d-2696':0, '1f469-1f3fb-200d-2708':0, '1f469-1f3fc-200d-2708':0, '1f469-1f3fd-200d-2708':0, '1f469-1f3fe-200d-2708':0, '1f469-1f3ff-200d-2708':0, '1f469-1f3fb-200d-2764-200d-1f468-1f3fb':0, '1f469-1f3fb-200d-2764-200d-1f468-1f3fc':0, '1f469-1f3fb-200d-2764-200d-1f468-1f3fd':0, '1f469-1f3fb-200d-2764-200d-1f468-1f3fe':0, '1f469-1f3fb-200d-2764-200d-1f468-1f3ff':0, '1f469-1f3fc-200d-2764-200d-1f468-1f3fb':0, '1f469-1f3fc-200d-2764-200d-1f468-1f3fc':0, '1f469-1f3fc-200d-2764-200d-1f468-1f3fd':0, '1f469-1f3fc-200d-2764-200d-1f468-1f3fe':0, '1f469-1f3fc-200d-2764-200d-1f468-1f3ff':0, '1f469-1f3fd-200d-2764-200d-1f468-1f3fb':0, '1f469-1f3fd-200d-2764-200d-1f468-1f3fc':0, '1f469-1f3fd-200d-2764-200d-1f468-1f3fd':0, '1f469-1f3fd-200d-2764-200d-1f468-1f3fe':0, '1f469-1f3fd-200d-2764-200d-1f468-1f3ff':0, '1f469-1f3fe-200d-2764-200d-1f468-1f3fb':0, '1f469-1f3fe-200d-2764-200d-1f468-1f3fc':0, '1f469-1f3fe-200d-2764-200d-1f468-1f3fd':0, '1f469-1f3fe-200d-2764-200d-1f468-1f3fe':0, '1f469-1f3fe-200d-2764-200d-1f468-1f3ff':0, '1f469-1f3ff-200d-2764-200d-1f468-1f3fb':0, '1f469-1f3ff-200d-2764-200d-1f468-1f3fc':0, '1f469-1f3ff-200d-2764-200d-1f468-1f3fd':0, '1f469-1f3ff-200d-2764-200d-1f468-1f3fe':0, '1f469-1f3ff-200d-2764-200d-1f468-1f3ff':0, '1f469-1f3fb-200d-2764-200d-1f469-1f3fb':0, '1f469-1f3fb-200d-2764-200d-1f469-1f3fc':0, '1f469-1f3fb-200d-2764-200d-1f469-1f3fd':0, '1f469-1f3fb-200d-2764-200d-1f469-1f3fe':0, '1f469-1f3fb-200d-2764-200d-1f469-1f3ff':0, '1f469-1f3fc-200d-2764-200d-1f469-1f3fb':0, '1f469-1f3fc-200d-2764-200d-1f469-1f3fc':0, '1f469-1f3fc-200d-2764-200d-1f469-1f3fd':0, '1f469-1f3fc-200d-2764-200d-1f469-1f3fe':0, '1f469-1f3fc-200d-2764-200d-1f469-1f3ff':0, '1f469-1f3fd-200d-2764-200d-1f469-1f3fb':0, '1f469-1f3fd-200d-2764-200d-1f469-1f3fc':0, '1f469-1f3fd-200d-2764-200d-1f469-1f3fd':0, '1f469-1f3fd-200d-2764-200d-1f469-1f3fe':0, '1f469-1f3fd-200d-2764-200d-1f469-1f3ff':0, '1f469-1f3fe-200d-2764-200d-1f469-1f3fb':0, '1f469-1f3fe-200d-2764-200d-1f469-1f3fc':0, '1f469-1f3fe-200d-2764-200d-1f469-1f3fd':0, '1f469-1f3fe-200d-2764-200d-1f469-1f3fe':0, '1f469-1f3fe-200d-2764-200d-1f469-1f3ff':0, '1f469-1f3ff-200d-2764-200d-1f469-1f3fb':0, '1f469-1f3ff-200d-2764-200d-1f469-1f3fc':0, '1f469-1f3ff-200d-2764-200d-1f469-1f3fd':0, '1f469-1f3ff-200d-2764-200d-1f469-1f3fe':0, '1f469-1f3ff-200d-2764-200d-1f469-1f3ff':0, '1f469-1f3fb-200d-2764-200d-1f48b-200d-1f468-1f3fb':0, '1f469-1f3fb-200d-2764-200d-1f48b-200d-1f468-1f3fc':0, '1f469-1f3fb-200d-2764-200d-1f48b-200d-1f468-1f3fd':0, '1f469-1f3fb-200d-2764-200d-1f48b-200d-1f468-1f3fe':0, '1f469-1f3fb-200d-2764-200d-1f48b-200d-1f468-1f3ff':0, '1f469-1f3fc-200d-2764-200d-1f48b-200d-1f468-1f3fb':0, '1f469-1f3fc-200d-2764-200d-1f48b-200d-1f468-1f3fc':0, '1f469-1f3fc-200d-2764-200d-1f48b-200d-1f468-1f3fd':0, '1f469-1f3fc-200d-2764-200d-1f48b-200d-1f468-1f3fe':0, '1f469-1f3fc-200d-2764-200d-1f48b-200d-1f468-1f3ff':0, '1f469-1f3fd-200d-2764-200d-1f48b-200d-1f468-1f3fb':0, '1f469-1f3fd-200d-2764-200d-1f48b-200d-1f468-1f3fc':0, '1f469-1f3fd-200d-2764-200d-1f48b-200d-1f468-1f3fd':0, '1f469-1f3fd-200d-2764-200d-1f48b-200d-1f468-1f3fe':0, '1f469-1f3fd-200d-2764-200d-1f48b-200d-1f468-1f3ff':0, '1f469-1f3fe-200d-2764-200d-1f48b-200d-1f468-1f3fb':0, '1f469-1f3fe-200d-2764-200d-1f48b-200d-1f468-1f3fc':0, '1f469-1f3fe-200d-2764-200d-1f48b-200d-1f468-1f3fd':0, '1f469-1f3fe-200d-2764-200d-1f48b-200d-1f468-1f3fe':0, '1f469-1f3fe-200d-2764-200d-1f48b-200d-1f468-1f3ff':0, '1f469-1f3ff-200d-2764-200d-1f48b-200d-1f468-1f3fb':0, '1f469-1f3ff-200d-2764-200d-1f48b-200d-1f468-1f3fc':0, '1f469-1f3ff-200d-2764-200d-1f48b-200d-1f468-1f3fd':0, '1f469-1f3ff-200d-2764-200d-1f48b-200d-1f468-1f3fe':0, '1f469-1f3ff-200d-2764-200d-1f48b-200d-1f468-1f3ff':0, '1f469-1f3fb-200d-2764-200d-1f48b-200d-1f469-1f3fb':0, '1f469-1f3fb-200d-2764-200d-1f48b-200d-1f469-1f3fc':0, '1f469-1f3fb-200d-2764-200d-1f48b-200d-1f469-1f3fd':0, '1f469-1f3fb-200d-2764-200d-1f48b-200d-1f469-1f3fe':0, '1f469-1f3fb-200d-2764-200d-1f48b-200d-1f469-1f3ff':0, '1f469-1f3fc-200d-2764-200d-1f48b-200d-1f469-1f3fb':0, '1f469-1f3fc-200d-2764-200d-1f48b-200d-1f469-1f3fc':0, '1f469-1f3fc-200d-2764-200d-1f48b-200d-1f469-1f3fd':0, '1f469-1f3fc-200d-2764-200d-1f48b-200d-1f469-1f3fe':0, '1f469-1f3fc-200d-2764-200d-1f48b-200d-1f469-1f3ff':0, '1f469-1f3fd-200d-2764-200d-1f48b-200d-1f469-1f3fb':0, '1f469-1f3fd-200d-2764-200d-1f48b-200d-1f469-1f3fc':0, '1f469-1f3fd-200d-2764-200d-1f48b-200d-1f469-1f3fd':0, '1f469-1f3fd-200d-2764-200d-1f48b-200d-1f469-1f3fe':0, '1f469-1f3fd-200d-2764-200d-1f48b-200d-1f469-1f3ff':0, '1f469-1f3fe-200d-2764-200d-1f48b-200d-1f469-1f3fb':0, '1f469-1f3fe-200d-2764-200d-1f48b-200d-1f469-1f3fc':0, '1f469-1f3fe-200d-2764-200d-1f48b-200d-1f469-1f3fd':0, '1f469-1f3fe-200d-2764-200d-1f48b-200d-1f469-1f3fe':0, '1f469-1f3fe-200d-2764-200d-1f48b-200d-1f469-1f3ff':0, '1f469-1f3ff-200d-2764-200d-1f48b-200d-1f469-1f3fb':0, '1f469-1f3ff-200d-2764-200d-1f48b-200d-1f469-1f3fc':0, '1f469-1f3ff-200d-2764-200d-1f48b-200d-1f469-1f3fd':0, '1f469-1f3ff-200d-2764-200d-1f48b-200d-1f469-1f3fe':0, '1f469-1f3ff-200d-2764-200d-1f48b-200d-1f469-1f3ff':0, '1f469-1f3fb':0, '1f469-1f3fc':0, '1f469-1f3fd':0, '1f469-1f3fe':0, '1f469-1f3ff':0, '1f46b-1f3fb':0, '1f46b-1f3fc':0, '1f46b-1f3fd':0, '1f46b-1f3fe':0, '1f46b-1f3ff':0, '1f469-1f3fb-200d-1f91d-200d-1f468-1f3fc':0, '1f469-1f3fb-200d-1f91d-200d-1f468-1f3fd':0, '1f469-1f3fb-200d-1f91d-200d-1f468-1f3fe':0, '1f469-1f3fb-200d-1f91d-200d-1f468-1f3ff':0, '1f469-1f3fc-200d-1f91d-200d-1f468-1f3fb':0, '1f469-1f3fc-200d-1f91d-200d-1f468-1f3fd':0, '1f469-1f3fc-200d-1f91d-200d-1f468-1f3fe':0, '1f469-1f3fc-200d-1f91d-200d-1f468-1f3ff':0, '1f469-1f3fd-200d-1f91d-200d-1f468-1f3fb':0, '1f469-1f3fd-200d-1f91d-200d-1f468-1f3fc':0, '1f469-1f3fd-200d-1f91d-200d-1f468-1f3fe':0, '1f469-1f3fd-200d-1f91d-200d-1f468-1f3ff':0, '1f469-1f3fe-200d-1f91d-200d-1f468-1f3fb':0, '1f469-1f3fe-200d-1f91d-200d-1f468-1f3fc':0, '1f469-1f3fe-200d-1f91d-200d-1f468-1f3fd':0, '1f469-1f3fe-200d-1f91d-200d-1f468-1f3ff':0, '1f469-1f3ff-200d-1f91d-200d-1f468-1f3fb':0, '1f469-1f3ff-200d-1f91d-200d-1f468-1f3fc':0, '1f469-1f3ff-200d-1f91d-200d-1f468-1f3fd':0, '1f469-1f3ff-200d-1f91d-200d-1f468-1f3fe':0, '1f46c-1f3fb':0, '1f46c-1f3fc':0, '1f46c-1f3fd':0, '1f46c-1f3fe':0, '1f46c-1f3ff':0, '1f468-1f3fb-200d-1f91d-200d-1f468-1f3fc':0, '1f468-1f3fb-200d-1f91d-200d-1f468-1f3fd':0, '1f468-1f3fb-200d-1f91d-200d-1f468-1f3fe':0, '1f468-1f3fb-200d-1f91d-200d-1f468-1f3ff':0, '1f468-1f3fc-200d-1f91d-200d-1f468-1f3fb':0, '1f468-1f3fc-200d-1f91d-200d-1f468-1f3fd':0, '1f468-1f3fc-200d-1f91d-200d-1f468-1f3fe':0, '1f468-1f3fc-200d-1f91d-200d-1f468-1f3ff':0, '1f468-1f3fd-200d-1f91d-200d-1f468-1f3fb':0, '1f468-1f3fd-200d-1f91d-200d-1f468-1f3fc':0, '1f468-1f3fd-200d-1f91d-200d-1f468-1f3fe':0, '1f468-1f3fd-200d-1f91d-200d-1f468-1f3ff':0, '1f468-1f3fe-200d-1f91d-200d-1f468-1f3fb':0, '1f468-1f3fe-200d-1f91d-200d-1f468-1f3fc':0, '1f468-1f3fe-200d-1f91d-200d-1f468-1f3fd':0, '1f468-1f3fe-200d-1f91d-200d-1f468-1f3ff':0, '1f468-1f3ff-200d-1f91d-200d-1f468-1f3fb':0, '1f468-1f3ff-200d-1f91d-200d-1f468-1f3fc':0, '1f468-1f3ff-200d-1f91d-200d-1f468-1f3fd':0, '1f468-1f3ff-200d-1f91d-200d-1f468-1f3fe':0, '1f46d-1f3fb':0, '1f46d-1f3fc':0, '1f46d-1f3fd':0, '1f46d-1f3fe':0, '1f46d-1f3ff':0, '1f469-1f3fb-200d-1f91d-200d-1f469-1f3fc':0, '1f469-1f3fb-200d-1f91d-200d-1f469-1f3fd':0, '1f469-1f3fb-200d-1f91d-200d-1f469-1f3fe':0, '1f469-1f3fb-200d-1f91d-200d-1f469-1f3ff':0, '1f469-1f3fc-200d-1f91d-200d-1f469-1f3fb':0, '1f469-1f3fc-200d-1f91d-200d-1f469-1f3fd':0, '1f469-1f3fc-200d-1f91d-200d-1f469-1f3fe':0, '1f469-1f3fc-200d-1f91d-200d-1f469-1f3ff':0, '1f469-1f3fd-200d-1f91d-200d-1f469-1f3fb':0, '1f469-1f3fd-200d-1f91d-200d-1f469-1f3fc':0, '1f469-1f3fd-200d-1f91d-200d-1f469-1f3fe':0, '1f469-1f3fd-200d-1f91d-200d-1f469-1f3ff':0, '1f469-1f3fe-200d-1f91d-200d-1f469-1f3fb':0, '1f469-1f3fe-200d-1f91d-200d-1f469-1f3fc':0, '1f469-1f3fe-200d-1f91d-200d-1f469-1f3fd':0, '1f469-1f3fe-200d-1f91d-200d-1f469-1f3ff':0, '1f469-1f3ff-200d-1f91d-200d-1f469-1f3fb':0, '1f469-1f3ff-200d-1f91d-200d-1f469-1f3fc':0, '1f469-1f3ff-200d-1f91d-200d-1f469-1f3fd':0, '1f469-1f3ff-200d-1f91d-200d-1f469-1f3fe':0, '1f46e-1f3fb-200d-2640':0, '1f46e-1f3fc-200d-2640':0, '1f46e-1f3fd-200d-2640':0, '1f46e-1f3fe-200d-2640':0, '1f46e-1f3ff-200d-2640':0, '1f46e-1f3fb-200d-2642':0, '1f46e-1f3fc-200d-2642':0, '1f46e-1f3fd-200d-2642':0, '1f46e-1f3fe-200d-2642':0, '1f46e-1f3ff-200d-2642':0, '1f46e-1f3fb':0, '1f46e-1f3fc':0, '1f46e-1f3fd':0, '1f46e-1f3fe':0, '1f46e-1f3ff':0, '1f470-1f3fb-200d-2640':0, '1f470-1f3fc-200d-2640':0, '1f470-1f3fd-200d-2640':0, '1f470-1f3fe-200d-2640':0, '1f470-1f3ff-200d-2640':0, '1f470-1f3fb-200d-2642':0, '1f470-1f3fc-200d-2642':0, '1f470-1f3fd-200d-2642':0, '1f470-1f3fe-200d-2642':0, '1f470-1f3ff-200d-2642':0, '1f470-1f3fb':0, '1f470-1f3fc':0, '1f470-1f3fd':0, '1f470-1f3fe':0, '1f470-1f3ff':0, '1f471-1f3fb-200d-2640':0, '1f471-1f3fc-200d-2640':0, '1f471-1f3fd-200d-2640':0, '1f471-1f3fe-200d-2640':0, '1f471-1f3ff-200d-2640':0, '1f471-1f3fb-200d-2642':0, '1f471-1f3fc-200d-2642':0, '1f471-1f3fd-200d-2642':0, '1f471-1f3fe-200d-2642':0, '1f471-1f3ff-200d-2642':0, '1f471-1f3fb':0, '1f471-1f3fc':0, '1f471-1f3fd':0, '1f471-1f3fe':0, '1f471-1f3ff':0, '1f472-1f3fb':0, '1f472-1f3fc':0, '1f472-1f3fd':0, '1f472-1f3fe':0, '1f472-1f3ff':0, '1f473-1f3fb-200d-2640':0, '1f473-1f3fc-200d-2640':0, '1f473-1f3fd-200d-2640':0, '1f473-1f3fe-200d-2640':0, '1f473-1f3ff-200d-2640':0, '1f473-1f3fb-200d-2642':0, '1f473-1f3fc-200d-2642':0, '1f473-1f3fd-200d-2642':0, '1f473-1f3fe-200d-2642':0, '1f473-1f3ff-200d-2642':0, '1f473-1f3fb':0, '1f473-1f3fc':0, '1f473-1f3fd':0, '1f473-1f3fe':0, '1f473-1f3ff':0, '1f474-1f3fb':0, '1f474-1f3fc':0, '1f474-1f3fd':0, '1f474-1f3fe':0, '1f474-1f3ff':0, '1f475-1f3fb':0, '1f475-1f3fc':0, '1f475-1f3fd':0, '1f475-1f3fe':0, '1f475-1f3ff':0, '1f476-1f3fb':0, '1f476-1f3fc':0, '1f476-1f3fd':0, '1f476-1f3fe':0, '1f476-1f3ff':0, '1f477-1f3fb-200d-2640':0, '1f477-1f3fc-200d-2640':0, '1f477-1f3fd-200d-2640':0, '1f477-1f3fe-200d-2640':0, '1f477-1f3ff-200d-2640':0, '1f477-1f3fb-200d-2642':0, '1f477-1f3fc-200d-2642':0, '1f477-1f3fd-200d-2642':0, '1f477-1f3fe-200d-2642':0, '1f477-1f3ff-200d-2642':0, '1f477-1f3fb':0, '1f477-1f3fc':0, '1f477-1f3fd':0, '1f477-1f3fe':0, '1f477-1f3ff':0, '1f478-1f3fb':0, '1f478-1f3fc':0, '1f478-1f3fd':0, '1f478-1f3fe':0, '1f478-1f3ff':0, '1f47c-1f3fb':0, '1f47c-1f3fc':0, '1f47c-1f3fd':0, '1f47c-1f3fe':0, '1f47c-1f3ff':0, '1f481-1f3fb-200d-2640':0, '1f481-1f3fc-200d-2640':0, '1f481-1f3fd-200d-2640':0, '1f481-1f3fe-200d-2640':0, '1f481-1f3ff-200d-2640':0, '1f481-1f3fb-200d-2642':0, '1f481-1f3fc-200d-2642':0, '1f481-1f3fd-200d-2642':0, '1f481-1f3fe-200d-2642':0, '1f481-1f3ff-200d-2642':0, '1f481-1f3fb':0, '1f481-1f3fc':0, '1f481-1f3fd':0, '1f481-1f3fe':0, '1f481-1f3ff':0, '1f482-1f3fb-200d-2640':0, '1f482-1f3fc-200d-2640':0, '1f482-1f3fd-200d-2640':0, '1f482-1f3fe-200d-2640':0, '1f482-1f3ff-200d-2640':0, '1f482-1f3fb-200d-2642':0, '1f482-1f3fc-200d-2642':0, '1f482-1f3fd-200d-2642':0, '1f482-1f3fe-200d-2642':0, '1f482-1f3ff-200d-2642':0, '1f482-1f3fb':0, '1f482-1f3fc':0, '1f482-1f3fd':0, '1f482-1f3fe':0, '1f482-1f3ff':0, '1f483-1f3fb':0, '1f483-1f3fc':0, '1f483-1f3fd':0, '1f483-1f3fe':0, '1f483-1f3ff':0, '1f485-1f3fb':0, '1f485-1f3fc':0, '1f485-1f3fd':0, '1f485-1f3fe':0, '1f485-1f3ff':0, '1f486-1f3fb-200d-2640':0, '1f486-1f3fc-200d-2640':0, '1f486-1f3fd-200d-2640':0, '1f486-1f3fe-200d-2640':0, '1f486-1f3ff-200d-2640':0, '1f486-1f3fb-200d-2642':0, '1f486-1f3fc-200d-2642':0, '1f486-1f3fd-200d-2642':0, '1f486-1f3fe-200d-2642':0, '1f486-1f3ff-200d-2642':0, '1f486-1f3fb':0, '1f486-1f3fc':0, '1f486-1f3fd':0, '1f486-1f3fe':0, '1f486-1f3ff':0, '1f487-1f3fb-200d-2640':0, '1f487-1f3fc-200d-2640':0, '1f487-1f3fd-200d-2640':0, '1f487-1f3fe-200d-2640':0, '1f487-1f3ff-200d-2640':0, '1f487-1f3fb-200d-2642':0, '1f487-1f3fc-200d-2642':0, '1f487-1f3fd-200d-2642':0, '1f487-1f3fe-200d-2642':0, '1f487-1f3ff-200d-2642':0, '1f487-1f3fb':0, '1f487-1f3fc':0, '1f487-1f3fd':0, '1f487-1f3fe':0, '1f487-1f3ff':0, '1f48f-1f3fb':0, '1f48f-1f3fc':0, '1f48f-1f3fd':0, '1f48f-1f3fe':0, '1f48f-1f3ff':0, '1f9d1-1f3fb-200d-2764-200d-1f48b-200d-1f9d1-1f3fc':0, '1f9d1-1f3fb-200d-2764-200d-1f48b-200d-1f9d1-1f3fd':0, '1f9d1-1f3fb-200d-2764-200d-1f48b-200d-1f9d1-1f3fe':0, '1f9d1-1f3fb-200d-2764-200d-1f48b-200d-1f9d1-1f3ff':0, '1f9d1-1f3fc-200d-2764-200d-1f48b-200d-1f9d1-1f3fb':0, '1f9d1-1f3fc-200d-2764-200d-1f48b-200d-1f9d1-1f3fd':0, '1f9d1-1f3fc-200d-2764-200d-1f48b-200d-1f9d1-1f3fe':0, '1f9d1-1f3fc-200d-2764-200d-1f48b-200d-1f9d1-1f3ff':0, '1f9d1-1f3fd-200d-2764-200d-1f48b-200d-1f9d1-1f3fb':0, '1f9d1-1f3fd-200d-2764-200d-1f48b-200d-1f9d1-1f3fc':0, '1f9d1-1f3fd-200d-2764-200d-1f48b-200d-1f9d1-1f3fe':0, '1f9d1-1f3fd-200d-2764-200d-1f48b-200d-1f9d1-1f3ff':0, '1f9d1-1f3fe-200d-2764-200d-1f48b-200d-1f9d1-1f3fb':0, '1f9d1-1f3fe-200d-2764-200d-1f48b-200d-1f9d1-1f3fc':0, '1f9d1-1f3fe-200d-2764-200d-1f48b-200d-1f9d1-1f3fd':0, '1f9d1-1f3fe-200d-2764-200d-1f48b-200d-1f9d1-1f3ff':0, '1f9d1-1f3ff-200d-2764-200d-1f48b-200d-1f9d1-1f3fb':0, '1f9d1-1f3ff-200d-2764-200d-1f48b-200d-1f9d1-1f3fc':0, '1f9d1-1f3ff-200d-2764-200d-1f48b-200d-1f9d1-1f3fd':0, '1f9d1-1f3ff-200d-2764-200d-1f48b-200d-1f9d1-1f3fe':0, '1f491-1f3fb':0, '1f491-1f3fc':0, '1f491-1f3fd':0, '1f491-1f3fe':0, '1f491-1f3ff':0, '1f9d1-1f3fb-200d-2764-200d-1f9d1-1f3fc':0, '1f9d1-1f3fb-200d-2764-200d-1f9d1-1f3fd':0, '1f9d1-1f3fb-200d-2764-200d-1f9d1-1f3fe':0, '1f9d1-1f3fb-200d-2764-200d-1f9d1-1f3ff':0, '1f9d1-1f3fc-200d-2764-200d-1f9d1-1f3fb':0, '1f9d1-1f3fc-200d-2764-200d-1f9d1-1f3fd':0, '1f9d1-1f3fc-200d-2764-200d-1f9d1-1f3fe':0, '1f9d1-1f3fc-200d-2764-200d-1f9d1-1f3ff':0, '1f9d1-1f3fd-200d-2764-200d-1f9d1-1f3fb':0, '1f9d1-1f3fd-200d-2764-200d-1f9d1-1f3fc':0, '1f9d1-1f3fd-200d-2764-200d-1f9d1-1f3fe':0, '1f9d1-1f3fd-200d-2764-200d-1f9d1-1f3ff':0, '1f9d1-1f3fe-200d-2764-200d-1f9d1-1f3fb':0, '1f9d1-1f3fe-200d-2764-200d-1f9d1-1f3fc':0, '1f9d1-1f3fe-200d-2764-200d-1f9d1-1f3fd':0, '1f9d1-1f3fe-200d-2764-200d-1f9d1-1f3ff':0, '1f9d1-1f3ff-200d-2764-200d-1f9d1-1f3fb':0, '1f9d1-1f3ff-200d-2764-200d-1f9d1-1f3fc':0, '1f9d1-1f3ff-200d-2764-200d-1f9d1-1f3fd':0, '1f9d1-1f3ff-200d-2764-200d-1f9d1-1f3fe':0, '1f4aa-1f3fb':0, '1f4aa-1f3fc':0, '1f4aa-1f3fd':0, '1f4aa-1f3fe':0, '1f4aa-1f3ff':0, '1f574-1f3fb':0, '1f574-1f3fc':0, '1f574-1f3fd':0, '1f574-1f3fe':0, '1f574-1f3ff':0, '1f575-1f3fb-200d-2640':0, '1f575-1f3fc-200d-2640':0, '1f575-1f3fd-200d-2640':0, '1f575-1f3fe-200d-2640':0, '1f575-1f3ff-200d-2640':0, '1f575-1f3fb-200d-2642':0, '1f575-1f3fc-200d-2642':0, '1f575-1f3fd-200d-2642':0, '1f575-1f3fe-200d-2642':0, '1f575-1f3ff-200d-2642':0, '1f575-1f3fb':0, '1f575-1f3fc':0, '1f575-1f3fd':0, '1f575-1f3fe':0, '1f575-1f3ff':0, '1f57a-1f3fb':0, '1f57a-1f3fc':0, '1f57a-1f3fd':0, '1f57a-1f3fe':0, '1f57a-1f3ff':0, '1f590-1f3fb':0, '1f590-1f3fc':0, '1f590-1f3fd':0, '1f590-1f3fe':0, '1f590-1f3ff':0, '1f595-1f3fb':0, '1f595-1f3fc':0, '1f595-1f3fd':0, '1f595-1f3fe':0, '1f595-1f3ff':0, '1f596-1f3fb':0, '1f596-1f3fc':0, '1f596-1f3fd':0, '1f596-1f3fe':0, '1f596-1f3ff':0, '1f645-1f3fb-200d-2640':0, '1f645-1f3fc-200d-2640':0, '1f645-1f3fd-200d-2640':0, '1f645-1f3fe-200d-2640':0, '1f645-1f3ff-200d-2640':0, '1f645-1f3fb-200d-2642':0, '1f645-1f3fc-200d-2642':0, '1f645-1f3fd-200d-2642':0, '1f645-1f3fe-200d-2642':0, '1f645-1f3ff-200d-2642':0, '1f645-1f3fb':0, '1f645-1f3fc':0, '1f645-1f3fd':0, '1f645-1f3fe':0, '1f645-1f3ff':0, '1f646-1f3fb-200d-2640':0, '1f646-1f3fc-200d-2640':0, '1f646-1f3fd-200d-2640':0, '1f646-1f3fe-200d-2640':0, '1f646-1f3ff-200d-2640':0, '1f646-1f3fb-200d-2642':0, '1f646-1f3fc-200d-2642':0, '1f646-1f3fd-200d-2642':0, '1f646-1f3fe-200d-2642':0, '1f646-1f3ff-200d-2642':0, '1f646-1f3fb':0, '1f646-1f3fc':0, '1f646-1f3fd':0, '1f646-1f3fe':0, '1f646-1f3ff':0, '1f647-1f3fb-200d-2640':0, '1f647-1f3fc-200d-2640':0, '1f647-1f3fd-200d-2640':0, '1f647-1f3fe-200d-2640':0, '1f647-1f3ff-200d-2640':0, '1f647-1f3fb-200d-2642':0, '1f647-1f3fc-200d-2642':0, '1f647-1f3fd-200d-2642':0, '1f647-1f3fe-200d-2642':0, '1f647-1f3ff-200d-2642':0, '1f647-1f3fb':0, '1f647-1f3fc':0, '1f647-1f3fd':0, '1f647-1f3fe':0, '1f647-1f3ff':0, '1f64b-1f3fb-200d-2640':0, '1f64b-1f3fc-200d-2640':0, '1f64b-1f3fd-200d-2640':0, '1f64b-1f3fe-200d-2640':0, '1f64b-1f3ff-200d-2640':0, '1f64b-1f3fb-200d-2642':0, '1f64b-1f3fc-200d-2642':0, '1f64b-1f3fd-200d-2642':0, '1f64b-1f3fe-200d-2642':0, '1f64b-1f3ff-200d-2642':0, '1f64b-1f3fb':0, '1f64b-1f3fc':0, '1f64b-1f3fd':0, '1f64b-1f3fe':0, '1f64b-1f3ff':0, '1f64c-1f3fb':0, '1f64c-1f3fc':0, '1f64c-1f3fd':0, '1f64c-1f3fe':0, '1f64c-1f3ff':0, '1f64d-1f3fb-200d-2640':0, '1f64d-1f3fc-200d-2640':0, '1f64d-1f3fd-200d-2640':0, '1f64d-1f3fe-200d-2640':0, '1f64d-1f3ff-200d-2640':0, '1f64d-1f3fb-200d-2642':0, '1f64d-1f3fc-200d-2642':0, '1f64d-1f3fd-200d-2642':0, '1f64d-1f3fe-200d-2642':0, '1f64d-1f3ff-200d-2642':0, '1f64d-1f3fb':0, '1f64d-1f3fc':0, '1f64d-1f3fd':0, '1f64d-1f3fe':0, '1f64d-1f3ff':0, '1f64e-1f3fb-200d-2640':0, '1f64e-1f3fc-200d-2640':0, '1f64e-1f3fd-200d-2640':0, '1f64e-1f3fe-200d-2640':0, '1f64e-1f3ff-200d-2640':0, '1f64e-1f3fb-200d-2642':0, '1f64e-1f3fc-200d-2642':0, '1f64e-1f3fd-200d-2642':0, '1f64e-1f3fe-200d-2642':0, '1f64e-1f3ff-200d-2642':0, '1f64e-1f3fb':0, '1f64e-1f3fc':0, '1f64e-1f3fd':0, '1f64e-1f3fe':0, '1f64e-1f3ff':0, '1f64f-1f3fb':0, '1f64f-1f3fc':0, '1f64f-1f3fd':0, '1f64f-1f3fe':0, '1f64f-1f3ff':0, '1f6a3-1f3fb-200d-2640':0, '1f6a3-1f3fc-200d-2640':0, '1f6a3-1f3fd-200d-2640':0, '1f6a3-1f3fe-200d-2640':0, '1f6a3-1f3ff-200d-2640':0, '1f6a3-1f3fb-200d-2642':0, '1f6a3-1f3fc-200d-2642':0, '1f6a3-1f3fd-200d-2642':0, '1f6a3-1f3fe-200d-2642':0, '1f6a3-1f3ff-200d-2642':0, '1f6a3-1f3fb':0, '1f6a3-1f3fc':0, '1f6a3-1f3fd':0, '1f6a3-1f3fe':0, '1f6a3-1f3ff':0, '1f6b4-1f3fb-200d-2640':0, '1f6b4-1f3fc-200d-2640':0, '1f6b4-1f3fd-200d-2640':0, '1f6b4-1f3fe-200d-2640':0, '1f6b4-1f3ff-200d-2640':0, '1f6b4-1f3fb-200d-2642':0, '1f6b4-1f3fc-200d-2642':0, '1f6b4-1f3fd-200d-2642':0, '1f6b4-1f3fe-200d-2642':0, '1f6b4-1f3ff-200d-2642':0, '1f6b4-1f3fb':0, '1f6b4-1f3fc':0, '1f6b4-1f3fd':0, '1f6b4-1f3fe':0, '1f6b4-1f3ff':0, '1f6b5-1f3fb-200d-2640':0, '1f6b5-1f3fc-200d-2640':0, '1f6b5-1f3fd-200d-2640':0, '1f6b5-1f3fe-200d-2640':0, '1f6b5-1f3ff-200d-2640':0, '1f6b5-1f3fb-200d-2642':0, '1f6b5-1f3fc-200d-2642':0, '1f6b5-1f3fd-200d-2642':0, '1f6b5-1f3fe-200d-2642':0, '1f6b5-1f3ff-200d-2642':0, '1f6b5-1f3fb':0, '1f6b5-1f3fc':0, '1f6b5-1f3fd':0, '1f6b5-1f3fe':0, '1f6b5-1f3ff':0, '1f6b6-1f3fb-200d-2640':0, '1f6b6-1f3fc-200d-2640':0, '1f6b6-1f3fd-200d-2640':0, '1f6b6-1f3fe-200d-2640':0, '1f6b6-1f3ff-200d-2640':0, '1f6b6-1f3fb-200d-2642':0, '1f6b6-1f3fc-200d-2642':0, '1f6b6-1f3fd-200d-2642':0, '1f6b6-1f3fe-200d-2642':0, '1f6b6-1f3ff-200d-2642':0, '1f6b6-1f3fb':0, '1f6b6-1f3fc':0, '1f6b6-1f3fd':0, '1f6b6-1f3fe':0, '1f6b6-1f3ff':0, '1f6c0-1f3fb':0, '1f6c0-1f3fc':0, '1f6c0-1f3fd':0, '1f6c0-1f3fe':0, '1f6c0-1f3ff':0, '1f6cc-1f3fb':0, '1f6cc-1f3fc':0, '1f6cc-1f3fd':0, '1f6cc-1f3fe':0, '1f6cc-1f3ff':0, '1f90c-1f3fb':0, '1f90c-1f3fc':0, '1f90c-1f3fd':0, '1f90c-1f3fe':0, '1f90c-1f3ff':0, '1f90f-1f3fb':0, '1f90f-1f3fc':0, '1f90f-1f3fd':0, '1f90f-1f3fe':0, '1f90f-1f3ff':0, '1f918-1f3fb':0, '1f918-1f3fc':0, '1f918-1f3fd':0, '1f918-1f3fe':0, '1f918-1f3ff':0, '1f919-1f3fb':0, '1f919-1f3fc':0, '1f919-1f3fd':0, '1f919-1f3fe':0, '1f919-1f3ff':0, '1f91a-1f3fb':0, '1f91a-1f3fc':0, '1f91a-1f3fd':0, '1f91a-1f3fe':0, '1f91a-1f3ff':0, '1f91b-1f3fb':0, '1f91b-1f3fc':0, '1f91b-1f3fd':0, '1f91b-1f3fe':0, '1f91b-1f3ff':0, '1f91c-1f3fb':0, '1f91c-1f3fc':0, '1f91c-1f3fd':0, '1f91c-1f3fe':0, '1f91c-1f3ff':0, '1f91d-1f3fb':0, '1f91d-1f3fc':0, '1f91d-1f3fd':0, '1f91d-1f3fe':0, '1f91d-1f3ff':0, '1f91e-1f3fb':0, '1f91e-1f3fc':0, '1f91e-1f3fd':0, '1f91e-1f3fe':0, '1f91e-1f3ff':0, '1f91f-1f3fb':0, '1f91f-1f3fc':0, '1f91f-1f3fd':0, '1f91f-1f3fe':0, '1f91f-1f3ff':0, '1f926-1f3fb-200d-2640':0, '1f926-1f3fc-200d-2640':0, '1f926-1f3fd-200d-2640':0, '1f926-1f3fe-200d-2640':0, '1f926-1f3ff-200d-2640':0, '1f926-1f3fb-200d-2642':0, '1f926-1f3fc-200d-2642':0, '1f926-1f3fd-200d-2642':0, '1f926-1f3fe-200d-2642':0, '1f926-1f3ff-200d-2642':0, '1f926-1f3fb':0, '1f926-1f3fc':0, '1f926-1f3fd':0, '1f926-1f3fe':0, '1f926-1f3ff':0, '1f930-1f3fb':0, '1f930-1f3fc':0, '1f930-1f3fd':0, '1f930-1f3fe':0, '1f930-1f3ff':0, '1f931-1f3fb':0, '1f931-1f3fc':0, '1f931-1f3fd':0, '1f931-1f3fe':0, '1f931-1f3ff':0, '1f932-1f3fb':0, '1f932-1f3fc':0, '1f932-1f3fd':0, '1f932-1f3fe':0, '1f932-1f3ff':0, '1f933-1f3fb':0, '1f933-1f3fc':0, '1f933-1f3fd':0, '1f933-1f3fe':0, '1f933-1f3ff':0, '1f934-1f3fb':0, '1f934-1f3fc':0, '1f934-1f3fd':0, '1f934-1f3fe':0, '1f934-1f3ff':0, '1f935-1f3fb-200d-2640':0, '1f935-1f3fc-200d-2640':0, '1f935-1f3fd-200d-2640':0, '1f935-1f3fe-200d-2640':0, '1f935-1f3ff-200d-2640':0, '1f935-1f3fb-200d-2642':0, '1f935-1f3fc-200d-2642':0, '1f935-1f3fd-200d-2642':0, '1f935-1f3fe-200d-2642':0, '1f935-1f3ff-200d-2642':0, '1f935-1f3fb':0, '1f935-1f3fc':0, '1f935-1f3fd':0, '1f935-1f3fe':0, '1f935-1f3ff':0, '1f936-1f3fb':0, '1f936-1f3fc':0, '1f936-1f3fd':0, '1f936-1f3fe':0, '1f936-1f3ff':0, '1f937-1f3fb-200d-2640':0, '1f937-1f3fc-200d-2640':0, '1f937-1f3fd-200d-2640':0, '1f937-1f3fe-200d-2640':0, '1f937-1f3ff-200d-2640':0, '1f937-1f3fb-200d-2642':0, '1f937-1f3fc-200d-2642':0, '1f937-1f3fd-200d-2642':0, '1f937-1f3fe-200d-2642':0, '1f937-1f3ff-200d-2642':0, '1f937-1f3fb':0, '1f937-1f3fc':0, '1f937-1f3fd':0, '1f937-1f3fe':0, '1f937-1f3ff':0, '1f938-1f3fb-200d-2640':0, '1f938-1f3fc-200d-2640':0, '1f938-1f3fd-200d-2640':0, '1f938-1f3fe-200d-2640':0, '1f938-1f3ff-200d-2640':0, '1f938-1f3fb-200d-2642':0, '1f938-1f3fc-200d-2642':0, '1f938-1f3fd-200d-2642':0, '1f938-1f3fe-200d-2642':0, '1f938-1f3ff-200d-2642':0, '1f938-1f3fb':0, '1f938-1f3fc':0, '1f938-1f3fd':0, '1f938-1f3fe':0, '1f938-1f3ff':0, '1f939-1f3fb-200d-2640':0, '1f939-1f3fc-200d-2640':0, '1f939-1f3fd-200d-2640':0, '1f939-1f3fe-200d-2640':0, '1f939-1f3ff-200d-2640':0, '1f939-1f3fb-200d-2642':0, '1f939-1f3fc-200d-2642':0, '1f939-1f3fd-200d-2642':0, '1f939-1f3fe-200d-2642':0, '1f939-1f3ff-200d-2642':0, '1f939-1f3fb':0, '1f939-1f3fc':0, '1f939-1f3fd':0, '1f939-1f3fe':0, '1f939-1f3ff':0, '1f93d-1f3fb-200d-2640':0, '1f93d-1f3fc-200d-2640':0, '1f93d-1f3fd-200d-2640':0, '1f93d-1f3fe-200d-2640':0, '1f93d-1f3ff-200d-2640':0, '1f93d-1f3fb-200d-2642':0, '1f93d-1f3fc-200d-2642':0, '1f93d-1f3fd-200d-2642':0, '1f93d-1f3fe-200d-2642':0, '1f93d-1f3ff-200d-2642':0, '1f93d-1f3fb':0, '1f93d-1f3fc':0, '1f93d-1f3fd':0, '1f93d-1f3fe':0, '1f93d-1f3ff':0, '1f93e-1f3fb-200d-2640':0, '1f93e-1f3fc-200d-2640':0, '1f93e-1f3fd-200d-2640':0, '1f93e-1f3fe-200d-2640':0, '1f93e-1f3ff-200d-2640':0, '1f93e-1f3fb-200d-2642':0, '1f93e-1f3fc-200d-2642':0, '1f93e-1f3fd-200d-2642':0, '1f93e-1f3fe-200d-2642':0, '1f93e-1f3ff-200d-2642':0, '1f93e-1f3fb':0, '1f93e-1f3fc':0, '1f93e-1f3fd':0, '1f93e-1f3fe':0, '1f93e-1f3ff':0, '1f977-1f3fb':0, '1f977-1f3fc':0, '1f977-1f3fd':0, '1f977-1f3fe':0, '1f977-1f3ff':0, '1f9b5-1f3fb':0, '1f9b5-1f3fc':0, '1f9b5-1f3fd':0, '1f9b5-1f3fe':0, '1f9b5-1f3ff':0, '1f9b6-1f3fb':0, '1f9b6-1f3fc':0, '1f9b6-1f3fd':0, '1f9b6-1f3fe':0, '1f9b6-1f3ff':0, '1f9b8-1f3fb-200d-2640':0, '1f9b8-1f3fc-200d-2640':0, '1f9b8-1f3fd-200d-2640':0, '1f9b8-1f3fe-200d-2640':0, '1f9b8-1f3ff-200d-2640':0, '1f9b8-1f3fb-200d-2642':0, '1f9b8-1f3fc-200d-2642':0, '1f9b8-1f3fd-200d-2642':0, '1f9b8-1f3fe-200d-2642':0, '1f9b8-1f3ff-200d-2642':0, '1f9b8-1f3fb':0, '1f9b8-1f3fc':0, '1f9b8-1f3fd':0, '1f9b8-1f3fe':0, '1f9b8-1f3ff':0, '1f9b9-1f3fb-200d-2640':0, '1f9b9-1f3fc-200d-2640':0, '1f9b9-1f3fd-200d-2640':0, '1f9b9-1f3fe-200d-2640':0, '1f9b9-1f3ff-200d-2640':0, '1f9b9-1f3fb-200d-2642':0, '1f9b9-1f3fc-200d-2642':0, '1f9b9-1f3fd-200d-2642':0, '1f9b9-1f3fe-200d-2642':0, '1f9b9-1f3ff-200d-2642':0, '1f9b9-1f3fb':0, '1f9b9-1f3fc':0, '1f9b9-1f3fd':0, '1f9b9-1f3fe':0, '1f9b9-1f3ff':0, '1f9bb-1f3fb':0, '1f9bb-1f3fc':0, '1f9bb-1f3fd':0, '1f9bb-1f3fe':0, '1f9bb-1f3ff':0, '1f9cd-1f3fb-200d-2640':0, '1f9cd-1f3fc-200d-2640':0, '1f9cd-1f3fd-200d-2640':0, '1f9cd-1f3fe-200d-2640':0, '1f9cd-1f3ff-200d-2640':0, '1f9cd-1f3fb-200d-2642':0, '1f9cd-1f3fc-200d-2642':0, '1f9cd-1f3fd-200d-2642':0, '1f9cd-1f3fe-200d-2642':0, '1f9cd-1f3ff-200d-2642':0, '1f9cd-1f3fb':0, '1f9cd-1f3fc':0, '1f9cd-1f3fd':0, '1f9cd-1f3fe':0, '1f9cd-1f3ff':0, '1f9ce-1f3fb-200d-2640':0, '1f9ce-1f3fc-200d-2640':0, '1f9ce-1f3fd-200d-2640':0, '1f9ce-1f3fe-200d-2640':0, '1f9ce-1f3ff-200d-2640':0, '1f9ce-1f3fb-200d-2642':0, '1f9ce-1f3fc-200d-2642':0, '1f9ce-1f3fd-200d-2642':0, '1f9ce-1f3fe-200d-2642':0, '1f9ce-1f3ff-200d-2642':0, '1f9ce-1f3fb':0, '1f9ce-1f3fc':0, '1f9ce-1f3fd':0, '1f9ce-1f3fe':0, '1f9ce-1f3ff':0, '1f9cf-1f3fb-200d-2640':0, '1f9cf-1f3fc-200d-2640':0, '1f9cf-1f3fd-200d-2640':0, '1f9cf-1f3fe-200d-2640':0, '1f9cf-1f3ff-200d-2640':0, '1f9cf-1f3fb-200d-2642':0, '1f9cf-1f3fc-200d-2642':0, '1f9cf-1f3fd-200d-2642':0, '1f9cf-1f3fe-200d-2642':0, '1f9cf-1f3ff-200d-2642':0, '1f9cf-1f3fb':0, '1f9cf-1f3fc':0, '1f9cf-1f3fd':0, '1f9cf-1f3fe':0, '1f9cf-1f3ff':0, '1f9d1-1f3fb-200d-1f33e':0, '1f9d1-1f3fc-200d-1f33e':0, '1f9d1-1f3fd-200d-1f33e':0, '1f9d1-1f3fe-200d-1f33e':0, '1f9d1-1f3ff-200d-1f33e':0, '1f9d1-1f3fb-200d-1f373':0, '1f9d1-1f3fc-200d-1f373':0, '1f9d1-1f3fd-200d-1f373':0, '1f9d1-1f3fe-200d-1f373':0, '1f9d1-1f3ff-200d-1f373':0, '1f9d1-1f3fb-200d-1f37c':0, '1f9d1-1f3fc-200d-1f37c':0, '1f9d1-1f3fd-200d-1f37c':0, '1f9d1-1f3fe-200d-1f37c':0, '1f9d1-1f3ff-200d-1f37c':0, '1f9d1-1f3fb-200d-1f384':0, '1f9d1-1f3fc-200d-1f384':0, '1f9d1-1f3fd-200d-1f384':0, '1f9d1-1f3fe-200d-1f384':0, '1f9d1-1f3ff-200d-1f384':0, '1f9d1-1f3fb-200d-1f393':0, '1f9d1-1f3fc-200d-1f393':0, '1f9d1-1f3fd-200d-1f393':0, '1f9d1-1f3fe-200d-1f393':0, '1f9d1-1f3ff-200d-1f393':0, '1f9d1-1f3fb-200d-1f3a4':0, '1f9d1-1f3fc-200d-1f3a4':0, '1f9d1-1f3fd-200d-1f3a4':0, '1f9d1-1f3fe-200d-1f3a4':0, '1f9d1-1f3ff-200d-1f3a4':0, '1f9d1-1f3fb-200d-1f3a8':0, '1f9d1-1f3fc-200d-1f3a8':0, '1f9d1-1f3fd-200d-1f3a8':0, '1f9d1-1f3fe-200d-1f3a8':0, '1f9d1-1f3ff-200d-1f3a8':0, '1f9d1-1f3fb-200d-1f3eb':0, '1f9d1-1f3fc-200d-1f3eb':0, '1f9d1-1f3fd-200d-1f3eb':0, '1f9d1-1f3fe-200d-1f3eb':0, '1f9d1-1f3ff-200d-1f3eb':0, '1f9d1-1f3fb-200d-1f3ed':0, '1f9d1-1f3fc-200d-1f3ed':0, '1f9d1-1f3fd-200d-1f3ed':0, '1f9d1-1f3fe-200d-1f3ed':0, '1f9d1-1f3ff-200d-1f3ed':0, '1f9d1-1f3fb-200d-1f4bb':0, '1f9d1-1f3fc-200d-1f4bb':0, '1f9d1-1f3fd-200d-1f4bb':0, '1f9d1-1f3fe-200d-1f4bb':0, '1f9d1-1f3ff-200d-1f4bb':0, '1f9d1-1f3fb-200d-1f4bc':0, '1f9d1-1f3fc-200d-1f4bc':0, '1f9d1-1f3fd-200d-1f4bc':0, '1f9d1-1f3fe-200d-1f4bc':0, '1f9d1-1f3ff-200d-1f4bc':0, '1f9d1-1f3fb-200d-1f527':0, '1f9d1-1f3fc-200d-1f527':0, '1f9d1-1f3fd-200d-1f527':0, '1f9d1-1f3fe-200d-1f527':0, '1f9d1-1f3ff-200d-1f527':0, '1f9d1-1f3fb-200d-1f52c':0, '1f9d1-1f3fc-200d-1f52c':0, '1f9d1-1f3fd-200d-1f52c':0, '1f9d1-1f3fe-200d-1f52c':0, '1f9d1-1f3ff-200d-1f52c':0, '1f9d1-1f3fb-200d-1f680':0, '1f9d1-1f3fc-200d-1f680':0, '1f9d1-1f3fd-200d-1f680':0, '1f9d1-1f3fe-200d-1f680':0, '1f9d1-1f3ff-200d-1f680':0, '1f9d1-1f3fb-200d-1f692':0, '1f9d1-1f3fc-200d-1f692':0, '1f9d1-1f3fd-200d-1f692':0, '1f9d1-1f3fe-200d-1f692':0, '1f9d1-1f3ff-200d-1f692':0, '1f9d1-1f3fb-200d-1f91d-200d-1f9d1-1f3fb':0, '1f9d1-1f3fb-200d-1f91d-200d-1f9d1-1f3fc':0, '1f9d1-1f3fb-200d-1f91d-200d-1f9d1-1f3fd':0, '1f9d1-1f3fb-200d-1f91d-200d-1f9d1-1f3fe':0, '1f9d1-1f3fb-200d-1f91d-200d-1f9d1-1f3ff':0, '1f9d1-1f3fc-200d-1f91d-200d-1f9d1-1f3fb':0, '1f9d1-1f3fc-200d-1f91d-200d-1f9d1-1f3fc':0, '1f9d1-1f3fc-200d-1f91d-200d-1f9d1-1f3fd':0, '1f9d1-1f3fc-200d-1f91d-200d-1f9d1-1f3fe':0, '1f9d1-1f3fc-200d-1f91d-200d-1f9d1-1f3ff':0, '1f9d1-1f3fd-200d-1f91d-200d-1f9d1-1f3fb':0, '1f9d1-1f3fd-200d-1f91d-200d-1f9d1-1f3fc':0, '1f9d1-1f3fd-200d-1f91d-200d-1f9d1-1f3fd':0, '1f9d1-1f3fd-200d-1f91d-200d-1f9d1-1f3fe':0, '1f9d1-1f3fd-200d-1f91d-200d-1f9d1-1f3ff':0, '1f9d1-1f3fe-200d-1f91d-200d-1f9d1-1f3fb':0, '1f9d1-1f3fe-200d-1f91d-200d-1f9d1-1f3fc':0, '1f9d1-1f3fe-200d-1f91d-200d-1f9d1-1f3fd':0, '1f9d1-1f3fe-200d-1f91d-200d-1f9d1-1f3fe':0, '1f9d1-1f3fe-200d-1f91d-200d-1f9d1-1f3ff':0, '1f9d1-1f3ff-200d-1f91d-200d-1f9d1-1f3fb':0, '1f9d1-1f3ff-200d-1f91d-200d-1f9d1-1f3fc':0, '1f9d1-1f3ff-200d-1f91d-200d-1f9d1-1f3fd':0, '1f9d1-1f3ff-200d-1f91d-200d-1f9d1-1f3fe':0, '1f9d1-1f3ff-200d-1f91d-200d-1f9d1-1f3ff':0, '1f9d1-1f3fb-200d-1f9af':0, '1f9d1-1f3fc-200d-1f9af':0, '1f9d1-1f3fd-200d-1f9af':0, '1f9d1-1f3fe-200d-1f9af':0, '1f9d1-1f3ff-200d-1f9af':0, '1f9d1-1f3fb-200d-1f9b0':0, '1f9d1-1f3fc-200d-1f9b0':0, '1f9d1-1f3fd-200d-1f9b0':0, '1f9d1-1f3fe-200d-1f9b0':0, '1f9d1-1f3ff-200d-1f9b0':0, '1f9d1-1f3fb-200d-1f9b1':0, '1f9d1-1f3fc-200d-1f9b1':0, '1f9d1-1f3fd-200d-1f9b1':0, '1f9d1-1f3fe-200d-1f9b1':0, '1f9d1-1f3ff-200d-1f9b1':0, '1f9d1-1f3fb-200d-1f9b2':0, '1f9d1-1f3fc-200d-1f9b2':0, '1f9d1-1f3fd-200d-1f9b2':0, '1f9d1-1f3fe-200d-1f9b2':0, '1f9d1-1f3ff-200d-1f9b2':0, '1f9d1-1f3fb-200d-1f9b3':0, '1f9d1-1f3fc-200d-1f9b3':0, '1f9d1-1f3fd-200d-1f9b3':0, '1f9d1-1f3fe-200d-1f9b3':0, '1f9d1-1f3ff-200d-1f9b3':0, '1f9d1-1f3fb-200d-1f9bc':0, '1f9d1-1f3fc-200d-1f9bc':0, '1f9d1-1f3fd-200d-1f9bc':0, '1f9d1-1f3fe-200d-1f9bc':0, '1f9d1-1f3ff-200d-1f9bc':0, '1f9d1-1f3fb-200d-1f9bd':0, '1f9d1-1f3fc-200d-1f9bd':0, '1f9d1-1f3fd-200d-1f9bd':0, '1f9d1-1f3fe-200d-1f9bd':0, '1f9d1-1f3ff-200d-1f9bd':0, '1f9d1-1f3fb-200d-2695':0, '1f9d1-1f3fc-200d-2695':0, '1f9d1-1f3fd-200d-2695':0, '1f9d1-1f3fe-200d-2695':0, '1f9d1-1f3ff-200d-2695':0, '1f9d1-1f3fb-200d-2696':0, '1f9d1-1f3fc-200d-2696':0, '1f9d1-1f3fd-200d-2696':0, '1f9d1-1f3fe-200d-2696':0, '1f9d1-1f3ff-200d-2696':0, '1f9d1-1f3fb-200d-2708':0, '1f9d1-1f3fc-200d-2708':0, '1f9d1-1f3fd-200d-2708':0, '1f9d1-1f3fe-200d-2708':0, '1f9d1-1f3ff-200d-2708':0, '1f9d1-1f3fb':0, '1f9d1-1f3fc':0, '1f9d1-1f3fd':0, '1f9d1-1f3fe':0, '1f9d1-1f3ff':0, '1f9d2-1f3fb':0, '1f9d2-1f3fc':0, '1f9d2-1f3fd':0, '1f9d2-1f3fe':0, '1f9d2-1f3ff':0, '1f9d3-1f3fb':0, '1f9d3-1f3fc':0, '1f9d3-1f3fd':0, '1f9d3-1f3fe':0, '1f9d3-1f3ff':0, '1f9d4-1f3fb-200d-2640':0, '1f9d4-1f3fc-200d-2640':0, '1f9d4-1f3fd-200d-2640':0, '1f9d4-1f3fe-200d-2640':0, '1f9d4-1f3ff-200d-2640':0, '1f9d4-1f3fb-200d-2642':0, '1f9d4-1f3fc-200d-2642':0, '1f9d4-1f3fd-200d-2642':0, '1f9d4-1f3fe-200d-2642':0, '1f9d4-1f3ff-200d-2642':0, '1f9d4-1f3fb':0, '1f9d4-1f3fc':0, '1f9d4-1f3fd':0, '1f9d4-1f3fe':0, '1f9d4-1f3ff':0, '1f9d5-1f3fb':0, '1f9d5-1f3fc':0, '1f9d5-1f3fd':0, '1f9d5-1f3fe':0, '1f9d5-1f3ff':0, '1f9d6-1f3fb-200d-2640':0, '1f9d6-1f3fc-200d-2640':0, '1f9d6-1f3fd-200d-2640':0, '1f9d6-1f3fe-200d-2640':0, '1f9d6-1f3ff-200d-2640':0, '1f9d6-1f3fb-200d-2642':0, '1f9d6-1f3fc-200d-2642':0, '1f9d6-1f3fd-200d-2642':0, '1f9d6-1f3fe-200d-2642':0, '1f9d6-1f3ff-200d-2642':0, '1f9d6-1f3fb':0, '1f9d6-1f3fc':0, '1f9d6-1f3fd':0, '1f9d6-1f3fe':0, '1f9d6-1f3ff':0, '1f9d7-1f3fb-200d-2640':0, '1f9d7-1f3fc-200d-2640':0, '1f9d7-1f3fd-200d-2640':0, '1f9d7-1f3fe-200d-2640':0, '1f9d7-1f3ff-200d-2640':0, '1f9d7-1f3fb-200d-2642':0, '1f9d7-1f3fc-200d-2642':0, '1f9d7-1f3fd-200d-2642':0, '1f9d7-1f3fe-200d-2642':0, '1f9d7-1f3ff-200d-2642':0, '1f9d7-1f3fb':0, '1f9d7-1f3fc':0, '1f9d7-1f3fd':0, '1f9d7-1f3fe':0, '1f9d7-1f3ff':0, '1f9d8-1f3fb-200d-2640':0, '1f9d8-1f3fc-200d-2640':0, '1f9d8-1f3fd-200d-2640':0, '1f9d8-1f3fe-200d-2640':0, '1f9d8-1f3ff-200d-2640':0, '1f9d8-1f3fb-200d-2642':0, '1f9d8-1f3fc-200d-2642':0, '1f9d8-1f3fd-200d-2642':0, '1f9d8-1f3fe-200d-2642':0, '1f9d8-1f3ff-200d-2642':0, '1f9d8-1f3fb':0, '1f9d8-1f3fc':0, '1f9d8-1f3fd':0, '1f9d8-1f3fe':0, '1f9d8-1f3ff':0, '1f9d9-1f3fb-200d-2640':0, '1f9d9-1f3fc-200d-2640':0, '1f9d9-1f3fd-200d-2640':0, '1f9d9-1f3fe-200d-2640':0, '1f9d9-1f3ff-200d-2640':0, '1f9d9-1f3fb-200d-2642':0, '1f9d9-1f3fc-200d-2642':0, '1f9d9-1f3fd-200d-2642':0, '1f9d9-1f3fe-200d-2642':0, '1f9d9-1f3ff-200d-2642':0, '1f9d9-1f3fb':0, '1f9d9-1f3fc':0, '1f9d9-1f3fd':0, '1f9d9-1f3fe':0, '1f9d9-1f3ff':0, '1f9da-1f3fb-200d-2640':0, '1f9da-1f3fc-200d-2640':0, '1f9da-1f3fd-200d-2640':0, '1f9da-1f3fe-200d-2640':0, '1f9da-1f3ff-200d-2640':0, '1f9da-1f3fb-200d-2642':0, '1f9da-1f3fc-200d-2642':0, '1f9da-1f3fd-200d-2642':0, '1f9da-1f3fe-200d-2642':0, '1f9da-1f3ff-200d-2642':0, '1f9da-1f3fb':0, '1f9da-1f3fc':0, '1f9da-1f3fd':0, '1f9da-1f3fe':0, '1f9da-1f3ff':0, '1f9db-1f3fb-200d-2640':0, '1f9db-1f3fc-200d-2640':0, '1f9db-1f3fd-200d-2640':0, '1f9db-1f3fe-200d-2640':0, '1f9db-1f3ff-200d-2640':0, '1f9db-1f3fb-200d-2642':0, '1f9db-1f3fc-200d-2642':0, '1f9db-1f3fd-200d-2642':0, '1f9db-1f3fe-200d-2642':0, '1f9db-1f3ff-200d-2642':0, '1f9db-1f3fb':0, '1f9db-1f3fc':0, '1f9db-1f3fd':0, '1f9db-1f3fe':0, '1f9db-1f3ff':0, '1f9dc-1f3fb-200d-2640':0, '1f9dc-1f3fc-200d-2640':0, '1f9dc-1f3fd-200d-2640':0, '1f9dc-1f3fe-200d-2640':0, '1f9dc-1f3ff-200d-2640':0, '1f9dc-1f3fb-200d-2642':0, '1f9dc-1f3fc-200d-2642':0, '1f9dc-1f3fd-200d-2642':0, '1f9dc-1f3fe-200d-2642':0, '1f9dc-1f3ff-200d-2642':0, '1f9dc-1f3fb':0, '1f9dc-1f3fc':0, '1f9dc-1f3fd':0, '1f9dc-1f3fe':0, '1f9dc-1f3ff':0, '1f9dd-1f3fb-200d-2640':0, '1f9dd-1f3fc-200d-2640':0, '1f9dd-1f3fd-200d-2640':0, '1f9dd-1f3fe-200d-2640':0, '1f9dd-1f3ff-200d-2640':0, '1f9dd-1f3fb-200d-2642':0, '1f9dd-1f3fc-200d-2642':0, '1f9dd-1f3fd-200d-2642':0, '1f9dd-1f3fe-200d-2642':0, '1f9dd-1f3ff-200d-2642':0, '1f9dd-1f3fb':0, '1f9dd-1f3fc':0, '1f9dd-1f3fd':0, '1f9dd-1f3fe':0, '1f9dd-1f3ff':0, '261d-1f3fb':0, '261d-1f3fc':0, '261d-1f3fd':0, '261d-1f3fe':0, '261d-1f3ff':0, '26f9-1f3fb-200d-2640':0, '26f9-1f3fc-200d-2640':0, '26f9-1f3fd-200d-2640':0, '26f9-1f3fe-200d-2640':0, '26f9-1f3ff-200d-2640':0, '26f9-1f3fb-200d-2642':0, '26f9-1f3fc-200d-2642':0, '26f9-1f3fd-200d-2642':0, '26f9-1f3fe-200d-2642':0, '26f9-1f3ff-200d-2642':0, '26f9-1f3fb':0, '26f9-1f3fc':0, '26f9-1f3fd':0, '26f9-1f3fe':0, '26f9-1f3ff':0, '270a-1f3fb':0, '270a-1f3fc':0, '270a-1f3fd':0, '270a-1f3fe':0, '270a-1f3ff':0, '270b-1f3fb':0, '270b-1f3fc':0, '270b-1f3fd':0, '270b-1f3fe':0, '270b-1f3ff':0, '270c-1f3fb':0, '270c-1f3fc':0, '270c-1f3fd':0, '270c-1f3fe':0, '270c-1f3ff':0, '270d-1f3fb':0, '270d-1f3fc':0, '270d-1f3fd':0, '270d-1f3fe':0, '270d-1f3ff':0}};\n\nconst Emoji: {[emoji: string]: number} = EmojiVersions[''];\nfor(const version in EmojiVersions) {\n  if(version) {\n    Object.assign(Emoji, EmojiVersions[version as EMOJI_VERSION]);\n  }\n}\n\nexport default Emoji;\n\n/* Emoji[\"00a9-fe0f\"] = 6362;\nEmoji[\"00ae-fe0f\"] = 6363;\nEmoji[\"2122-fe0f\"] = 6364; */\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nexport const FontFamily = 'Roboto, -apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, Oxygen-Sans, Ubuntu, Cantarell, \"Helvetica Neue\", sans-serif';\nexport const FontSize = '16px';\nexport const FontWeight = '400';\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\n// * Jolly Cobra's animation.ts\r\n\r\nimport {fastRaf} from './schedulers';\r\nimport deferredPromise, {CancellablePromise} from './cancellablePromise';\r\n\r\ninterface AnimationInstance {\r\n  isCancelled: boolean;\r\n  deferred: CancellablePromise<void>\r\n}\r\n\r\ntype AnimationInstanceKey = any;\r\nconst instances: Map<AnimationInstanceKey, AnimationInstance> = new Map();\r\n\r\nexport function createAnimationInstance(key: AnimationInstanceKey) {\r\n  cancelAnimationByKey(key);\r\n\r\n  const instance: AnimationInstance = {\r\n    isCancelled: false,\r\n    deferred: deferredPromise<void>()\r\n  };\r\n\r\n  instances.set(key, instance);\r\n  instance.deferred.then(() => {\r\n    instances.delete(key);\r\n  });\r\n\r\n  return instance;\r\n}\r\n\r\nexport function getAnimationInstance(key: AnimationInstanceKey) {\r\n  return instances.get(key);\r\n}\r\n\r\nexport function cancelAnimationByKey(key: AnimationInstanceKey) {\r\n  const instance = getAnimationInstance(key);\r\n  if(instance) {\r\n    instance.isCancelled = true;\r\n    instance.deferred.resolve();\r\n  }\r\n}\r\n\r\nexport function animateSingle(tick: Function, key: AnimationInstanceKey, instance?: AnimationInstance) {\r\n  if(!instance) {\r\n    instance = createAnimationInstance(key);\r\n  }\r\n\r\n  fastRaf(() => {\r\n    if(instance.isCancelled) {\r\n      return;\r\n    }\r\n\r\n    if(tick()) {\r\n      animateSingle(tick, key, instance);\r\n    } else {\r\n      instance.deferred.resolve();\r\n    }\r\n  });\r\n\r\n  return instance.deferred;\r\n}\r\n\r\nexport function animate(tick: Function) {\r\n  fastRaf(() => {\r\n    if(tick()) {\r\n      animate(tick);\r\n    }\r\n  });\r\n}\r\n","export default function accumulate(arr: number[], initialValue: number) {\n  return arr.reduce((acc, value) => acc + value, initialValue);\n}\n","type K = boolean;\nexport default async function filterAsync<T>(arr: T[], callback: (item: T, idx: number, arr: T[]) => Promise<K> | K) {\n  const promises = arr.map(async(item, idx, arr) => {\n    if(await callback(item, idx, arr)) {\n      return item;\n    }\n  });\n\n  return (await Promise.all(promises)).filter(Boolean);\n}\n","export default function findAndSpliceAll<T>(array: Array<T>, verify: (value: T, index: number, arr: typeof array) => boolean) {\n  const out: typeof array = [];\n  let idx = -1;\n  while((idx = array.findIndex(verify)) !== -1) {\n    out.push(array.splice(idx, 1)[0]);\n  }\n\n  return out;\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nconst ASSETS_PATH = 'assets/audio/';\n\nexport default class AudioAssetPlayer<AssetName extends string> {\n  private audio: HTMLAudioElement;\n  private tempId: number;\n  private assetName: AssetName;\n\n  constructor(private assets: AssetName[]) {\n    this.tempId = 0;\n  }\n\n  public playSound(name: AssetName, loop = false) {\n    ++this.tempId;\n    this.assetName = name;\n\n    try {\n      const audio = this.createAudio();\n      audio.autoplay = true;\n      audio.src = ASSETS_PATH + name;\n      audio.loop = loop;\n      audio.play();\n    } catch(e) {\n      console.error('playSound', name, e);\n    }\n  }\n\n  public playSoundIfDifferent(name: AssetName, loop?: boolean) {\n    if(this.assetName !== name) {\n      this.playSound(name, loop);\n    }\n  }\n\n  public createAudio() {\n    let {audio} = this;\n    if(audio) {\n      return audio;\n    }\n\n    audio = this.audio = new Audio();\n    audio.play();\n    return audio;\n  }\n\n  public stopSound() {\n    if(!this.audio) {\n      return;\n    }\n\n    this.audio.pause();\n  }\n\n  public cancelDelayedPlay() {\n    ++this.tempId;\n  }\n\n  public playSoundWithTimeout(name: AssetName, loop: boolean, timeout: number) {\n    // timeout = 0;\n    const tempId = ++this.tempId;\n    setTimeout(() => {\n      if(this.tempId !== tempId) {\n        return;\n      }\n\n      this.playSound(name, loop);\n    }, timeout);\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport readBlobAs from './readBlobAs';\n\nexport default function readBlobAsDataURL(blob: Blob) {\n  return readBlobAs(blob, 'readAsDataURL');\n}\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport deferredPromise, {CancellablePromise} from './cancellablePromise';\r\nimport {getHeavyAnimationPromise} from '../hooks/useHeavyAnimationCheck';\r\nimport {fastRaf} from './schedulers';\r\nimport {ArgumentTypes} from '../types';\r\n\r\ntype HeavyQueue<T extends HeavyQueue<any>> = {\r\n  items: ArgumentTypes<T['process']>[],\r\n  process: (...args: any[]) => ReturnType<T['process']>,\r\n  context: any,\r\n  promise?: CancellablePromise<ReturnType<T['process']>[]>\r\n};\r\nconst heavyQueue: HeavyQueue<any>[] = [];\r\nlet processingQueue = false;\r\n\r\nexport default function addHeavyTask<T extends HeavyQueue<T>>(queue: T, method: 'push' | 'unshift' = 'push') {\r\n  if(!queue.items.length) {\r\n    return Promise.resolve([]) as typeof promise;\r\n  }\r\n\r\n  const promise = queue.promise = deferredPromise();\r\n  heavyQueue[method](queue);\r\n  processHeavyQueue();\r\n\r\n  return promise;\r\n}\r\n\r\nfunction processHeavyQueue() {\r\n  if(!processingQueue) {\r\n    const queue = heavyQueue.shift();\r\n    timedChunk(queue).finally(() => {\r\n      processingQueue = false;\r\n      if(heavyQueue.length) {\r\n        processHeavyQueue();\r\n      }\r\n    });\r\n  }\r\n}\r\n\r\nfunction timedChunk<T extends HeavyQueue<T>>(queue: HeavyQueue<T>) {\r\n  if(!queue.items.length) {\r\n    queue.promise.resolve([] as any);\r\n    return Promise.resolve([]);\r\n  }\r\n\r\n  const todo = queue.items.slice();\r\n  const results: ReturnType<T['process']>[] = [];\r\n\r\n  return new Promise<typeof results>((resolve, reject) => {\r\n    const f = async() => {\r\n      const start = performance.now();\r\n\r\n      do {\r\n        await getHeavyAnimationPromise();\r\n        const possiblePromise = queue.process.apply(queue.context, todo.shift());\r\n        let realResult: typeof results[0];\r\n        // @ts-ignore\r\n        if(possiblePromise instanceof Promise) {\r\n          try {\r\n            realResult = await possiblePromise;\r\n          } catch(err) {\r\n            reject(err);\r\n            return;\r\n          }\r\n        } else {\r\n          realResult = possiblePromise;\r\n        }\r\n\r\n        results.push(realResult);\r\n      } while(todo.length > 0 && (performance.now() - start) < 6);\r\n\r\n      if(todo.length > 0) {\r\n        fastRaf(f);\r\n        // setTimeout(f, 25);\r\n      } else {\r\n        resolve(results);\r\n      }\r\n    };\r\n\r\n    fastRaf(f);\r\n    // setTimeout(f, 25);\r\n  }).then(queue.promise.resolve, queue.promise.reject);\r\n}\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport type fastBlur from '../vendor/fastBlur';\r\nimport addHeavyTask from './heavyQueue';\r\nimport IS_CANVAS_FILTER_SUPPORTED from '../environment/canvasFilterSupport';\r\n\r\nconst RADIUS = 2;\r\nconst ITERATIONS = 2;\r\n\r\nlet requireBlurPromise: Promise<any>;\r\nlet fastBlurFunc: typeof fastBlur;\r\nif(!IS_CANVAS_FILTER_SUPPORTED) {\r\n  requireBlurPromise = import('../vendor/fastBlur').then((m) => {\r\n    fastBlurFunc = m.default;\r\n  });\r\n} else {\r\n  requireBlurPromise = Promise.resolve();\r\n}\r\n\r\nfunction processBlurNext(\r\n  img: HTMLImageElement,\r\n  radius: number,\r\n  iterations: number,\r\n  canvas: HTMLCanvasElement = document.createElement('canvas')\r\n) {\r\n  canvas.width = img.width;\r\n  canvas.height = img.height;\r\n\r\n  const ctx = canvas.getContext('2d', {alpha: false});\r\n  if(IS_CANVAS_FILTER_SUPPORTED) {\r\n    ctx.filter = `blur(${radius}px)`;\r\n    ctx.drawImage(img, -radius * 2, -radius * 2, canvas.width + radius * 4, canvas.height + radius * 4);\r\n  } else {\r\n    ctx.drawImage(img, 0, 0);\r\n    fastBlurFunc(ctx, 0, 0, canvas.width, canvas.height, radius, iterations);\r\n  }\r\n\r\n  return canvas;\r\n}\r\n\r\ntype CacheValue = {canvas: HTMLCanvasElement, promise: Promise<void>};\r\nconst cache: Map<string, CacheValue> = new Map();\r\nconst CACHE_SIZE = 150;\r\n\r\nexport default function blur(dataUri: string, radius: number = RADIUS, iterations: number = ITERATIONS) {\r\n  if(!dataUri) {\r\n    throw 'no dataUri for blur: ' + dataUri;\r\n  }\r\n\r\n  if(cache.size > CACHE_SIZE) {\r\n    cache.clear();\r\n  }\r\n\r\n  const canvas = document.createElement('canvas');\r\n  canvas.className = 'canvas-thumbnail';\r\n\r\n  let cached = cache.get(dataUri);\r\n  if(!cached) {\r\n    const promise: CacheValue['promise'] = new Promise((resolve) => {\r\n      // return resolve(dataUri);\r\n      requireBlurPromise.then(() => {\r\n        const img = new Image();\r\n        img.onload = () => {\r\n          // if(IS_CANVAS_FILTER_SUPPORTED) {\r\n          // resolve(processBlurNext(img, radius, iterations));\r\n          // } else {\r\n          const promise = addHeavyTask({\r\n            items: [[img, radius, iterations, canvas]],\r\n            context: null,\r\n            process: processBlurNext\r\n          }, 'unshift');\r\n\r\n          promise.then(() => {\r\n            resolve();\r\n          });\r\n          // }\r\n        };\r\n        img.src = dataUri;\r\n      });\r\n    });\r\n\r\n    cache.set(dataUri, cached = {\r\n      canvas,\r\n      promise\r\n    });\r\n  } else {\r\n    canvas.width = cached.canvas.width;\r\n    canvas.height = cached.canvas.height;\r\n    cached.promise.then(() => {\r\n      canvas.getContext('2d').drawImage(cached.canvas, 0, 0, canvas.width, canvas.height);\r\n    });\r\n  }\r\n\r\n  return {\r\n    ...cached,\r\n    canvas\r\n  };\r\n}\r\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport {IS_SAFARI} from '../../environment/userAgent';\nimport bytesFromHex from './bytesFromHex';\nimport bytesToDataURL from './bytesToDataURL';\n\nconst JPEG_HEADER = bytesFromHex('ffd8ffe000104a46494600010100000100010000ffdb004300281c1e231e19282321232d2b28303c64413c37373c7b585d4964918099968f808c8aa0b4e6c3a0aadaad8a8cc8ffcbdaeef5ffffff9bc1fffffffaffe6fdfff8ffdb0043012b2d2d3c353c76414176f8a58ca5f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8ffc00011080000000003012200021101031101ffc4001f0000010501010101010100000000000000000102030405060708090a0bffc400b5100002010303020403050504040000017d01020300041105122131410613516107227114328191a1082342b1c11552d1f02433627282090a161718191a25262728292a3435363738393a434445464748494a535455565758595a636465666768696a737475767778797a838485868788898a92939495969798999aa2a3a4a5a6a7a8a9aab2b3b4b5b6b7b8b9bac2c3c4c5c6c7c8c9cad2d3d4d5d6d7d8d9dae1e2e3e4e5e6e7e8e9eaf1f2f3f4f5f6f7f8f9faffc4001f0100030101010101010101010000000000000102030405060708090a0bffc400b51100020102040403040705040400010277000102031104052131061241510761711322328108144291a1b1c109233352f0156272d10a162434e125f11718191a262728292a35363738393a434445464748494a535455565758595a636465666768696a737475767778797a82838485868788898a92939495969798999aa2a3a4a5a6a7a8a9aab2b3b4b5b6b7b8b9bac2c3c4c5c6c7c8c9cad2d3d4d5d6d7d8d9dae2e3e4e5e6e7e8e9eaf2f3f4f5f6f7f8f9faffda000c03010002110311003f00');\nconst JPEG_TAIL = bytesFromHex('ffd9');\n\nexport default function getPreviewURLFromBytes(bytes: Uint8Array | number[], isSticker = false) {\n  let arr: Uint8Array;\n  if(!isSticker) {\n    arr = new Uint8Array(JPEG_HEADER.concat(Array.from(bytes.slice(3)), JPEG_TAIL));\n    arr[164] = bytes[1];\n    arr[166] = bytes[2];\n  } else {\n    arr = bytes instanceof Uint8Array ? bytes : new Uint8Array(bytes);\n  }\n\n  let mimeType: string;\n  if(isSticker) {\n    mimeType = IS_SAFARI ? 'image/png' : 'image/webp';\n  } else {\n    mimeType = 'image/jpeg';\n  }\n\n  return bytesToDataURL(arr, mimeType);\n}\n","export default function bytesToDataURL(bytes: Uint8Array, mimeType: string = 'image/jpeg') {\n  return `data:${mimeType};base64,${btoa(String.fromCharCode(...bytes))}`;\n}\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n *\r\n * Originally from:\r\n * https://github.com/zhukov/webogram\r\n * Copyright (C) 2014 Igor Zhukov <igor.beatle@gmail.com>\r\n * https://github.com/zhukov/webogram/blob/master/LICENSE\r\n */\r\n\r\nimport {MOUNT_CLASS_TO} from '../config/debug';\r\nimport {makeMediaSize} from './mediaSize';\r\n\r\nexport default function calcImageInBox(imageW: number, imageH: number, boxW: number, boxH: number, noZoom = true) {\r\n  if(imageW < boxW && imageH < boxH && noZoom) {\r\n    return makeMediaSize(imageW, imageH);\r\n  }\r\n\r\n  let boxedImageW = boxW;\r\n  let boxedImageH = boxH;\r\n\r\n  if((imageW / imageH) > (boxW / boxH)) {\r\n    boxedImageH = (imageH * boxW / imageW) | 0;\r\n  } else {\r\n    boxedImageW = (imageW * boxH / imageH) | 0;\r\n    if(boxedImageW > boxW) {\r\n      boxedImageH = (boxedImageH * boxW / boxedImageW) | 0;\r\n      boxedImageW = boxW;\r\n    }\r\n  }\r\n\r\n  // if (Config.Navigator.retina) {\r\n  //   imageW = Math.floor(imageW / 2)\r\n  //   imageH = Math.floor(imageH / 2)\r\n  // }\r\n\r\n  if(noZoom && boxedImageW >= imageW && boxedImageH >= imageH) {\r\n    boxedImageW = imageW;\r\n    boxedImageH = imageH;\r\n  }\r\n\r\n  return makeMediaSize(boxedImageW, boxedImageH);\r\n}\r\n\r\nMOUNT_CLASS_TO.calcImageInBox = calcImageInBox;\r\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\n// import { MOUNT_CLASS_TO } from \"../../config/debug\";\n\nlet context: CanvasRenderingContext2D;\n/**\n * Get the text width\n * @param {string} text\n * @param {string} font\n */\nexport default function getTextWidth(text: string, font: string) {\n  // const perf = performance.now();\n  if(!context) {\n    const canvas = document.createElement('canvas');\n    context = canvas.getContext('2d', {alpha: false});\n    context.font = font;\n  }\n\n  // context.font = font;\n  const metrics = context.measureText(text);\n  // console.log('getTextWidth perf:', performance.now() - perf);\n  return metrics.width;\n  // return Math.round(metrics.width);\n}\n\n// MOUNT_CLASS_TO && (MOUNT_CLASS_TO.getTextWidth = getTextWidth);\n","import type {MediaSize} from '../mediaSize';\n\nexport default function scaleMediaElement(options: {\n  media: CanvasImageSource,\n  mediaSize?: MediaSize,\n  boxSize?: MediaSize,\n  quality?: number,\n  mimeType?: 'image/jpeg' | 'image/png',\n  size?: MediaSize\n}): Promise<{blob: Blob, size: MediaSize}> {\n  return new Promise((resolve) => {\n    const canvas = document.createElement('canvas');\n    const size = options.size ?? options.mediaSize.aspectFitted(options.boxSize);\n    canvas.width = size.width * window.devicePixelRatio;\n    canvas.height = size.height * window.devicePixelRatio;\n    const ctx = canvas.getContext('2d');\n    ctx.drawImage(options.media, 0, 0, canvas.width, canvas.height);\n    canvas.toBlob((blob) => {\n      resolve({blob, size});\n    }, options.mimeType ?? 'image/jpeg', options.quality ?? 1);\n  });\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n *\n * Originally from:\n * https://github.com/zhukov/webogram\n * Copyright (C) 2014 Igor Zhukov <igor.beatle@gmail.com>\n * https://github.com/zhukov/webogram/blob/master/LICENSE\n */\n\nimport LatinizeMap from '../config/latinizeMap';\n\nexport const badCharsRe = /[`~!@#$%^&*()\\-_=+\\[\\]\\\\|{}'\";:\\/?.>,<]+/g;\nconst trimRe = /^\\s+|\\s$/g;\n\nconst C2L: {[k: string]: string} = {\n  '': 'q',\n  '': 'w',\n  '': 'e',\n  '': 'r',\n  '': 't',\n  '': 'y',\n  '': 'u',\n  '': 'i',\n  '': 'o',\n  '': 'p',\n  '': '[',\n  '': ']',\n  '': 'a',\n  '': 's',\n  '': 'd',\n  '': 'f',\n  '': 'g',\n  '': 'h',\n  '': 'j',\n  '': 'k',\n  '': 'l',\n  '': ';',\n  '': '\\'',\n  '': 'z',\n  '': 'x',\n  '': 'c',\n  '': 'v',\n  '': 'b',\n  '': 'n',\n  '': 'm',\n  '': ',',\n  '': '.',\n  '.': '/'\n};\n\nexport function clearBadCharsAndTrim(text: string) {\n  return text.replace(badCharsRe, '').replace(trimRe, '');\n}\n\nexport function fixCyrillic(text: string) {\n  return text.toLowerCase().replace(/[\\w-]/g, (ch) => {\n    const latinizeCh = C2L[ch];\n    return latinizeCh ?? ch;\n  });\n}\n\nexport function latinizeString(text: string) {\n  return text.replace(/[^A-Za-z0-9]/g, (ch) => {\n    const latinizeCh = LatinizeMap[ch];\n    return latinizeCh ?? ch;\n  });\n}\n\nexport default function cleanSearchText(text: string, latinize = true) {\n  return processSearchText(text, {\n    clearBadChars: true,\n    latinize,\n    ignoreCase: true\n  });\n}\n\nexport type ProcessSearchTextOptions = Partial<{\n  clearBadChars: boolean,\n  latinize: boolean,\n  ignoreCase: boolean,\n  includeTag: boolean\n}>;\n\nexport function processSearchText(text: string, options: ProcessSearchTextOptions = {}) {\n  const hasTag = options.includeTag && text.charAt(0) === '%';\n  const originalText = text;\n  if(options.clearBadChars) text = clearBadCharsAndTrim(text);\n  if(options.latinize) text = latinizeString(text);\n  if(options.ignoreCase) text = text.toLowerCase();\n  if(hasTag) text = '%' + text;\n  if(options.latinize) text += '\\x01' + fixCyrillic(originalText);\n  return text;\n}\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\n// https://stackoverflow.com/a/30810322\r\nfunction fallbackCopyTextToClipboard(text: string) {\r\n  var textArea = document.createElement('textarea');\r\n  textArea.value = text;\r\n\r\n  // Avoid scrolling to bottom\r\n  textArea.style.top = '0';\r\n  textArea.style.left = '0';\r\n  textArea.style.position = 'fixed';\r\n\r\n  document.body.appendChild(textArea);\r\n  textArea.focus();\r\n  textArea.select();\r\n\r\n  try {\r\n    document.execCommand('copy');\r\n    // const successful = document.execCommand('copy');\r\n    // const msg = successful ? 'successful' : 'unsuccessful';\r\n    // console.log('Fallback: Copying text command was ' + msg);\r\n  } catch(err) {\r\n    // console.error('Fallback: Oops, unable to copy', err);\r\n  }\r\n\r\n  document.body.removeChild(textArea);\r\n}\r\n\r\nexport function copyTextToClipboard(text: string) {\r\n  if(!navigator.clipboard) {\r\n    fallbackCopyTextToClipboard(text);\r\n    return;\r\n  }\r\n\r\n  navigator.clipboard.writeText(text);/* .then(function() {\r\n    console.log('Async: Copying to clipboard was successful!');\r\n  }, function(err) {\r\n    console.error('Async: Could not copy text: ', err);\r\n  }); */\r\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport IS_TOUCH_SUPPORTED from '../environment/touchSupport';\nimport mediaSizes from './mediaSizes';\nimport OverlayClickHandler from './overlayClickHandler';\n\nclass ContextMenuController extends OverlayClickHandler {\n  constructor() {\n    super('menu', true);\n\n    mediaSizes.addEventListener('resize', () => {\n      if(this.element) {\n        this.close();\n      }\n\n      /* if(openedMenu && (openedMenu.style.top || openedMenu.style.left)) {\n        const rect = openedMenu.getBoundingClientRect();\n        const {innerWidth, innerHeight} = window;\n\n        console.log(innerWidth, innerHeight, rect);\n      } */\n    });\n  }\n\n  public isOpened() {\n    return !!this.element;\n  }\n\n  private onMouseMove = (e: MouseEvent) => {\n    const rect = this.element.getBoundingClientRect();\n    const {clientX, clientY} = e;\n\n    const diffX = clientX >= rect.right ? clientX - rect.right : rect.left - clientX;\n    const diffY = clientY >= rect.bottom ? clientY - rect.bottom : rect.top - clientY;\n\n    if(diffX >= 100 || diffY >= 100) {\n      this.close();\n      // openedMenu.parentElement.click();\n    }\n    // console.log('mousemove', diffX, diffY);\n  };\n\n  public close() {\n    if(this.element) {\n      this.element.classList.remove('active');\n      this.element.parentElement.classList.remove('menu-open');\n    }\n\n    super.close();\n\n    if(!IS_TOUCH_SUPPORTED) {\n      window.removeEventListener('mousemove', this.onMouseMove);\n    }\n  }\n\n  public openBtnMenu(element: HTMLElement, onClose?: () => void) {\n    super.open(element);\n\n    this.element.classList.add('active');\n    this.element.parentElement.classList.add('menu-open');\n\n    if(onClose) {\n      this.addEventListener('toggle', onClose, {once: true});\n    }\n\n    if(!IS_TOUCH_SUPPORTED) {\n      window.addEventListener('mousemove', this.onMouseMove);\n    }\n  }\n}\n\nconst contextMenuController = new ContextMenuController();\nexport default contextMenuController;\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport {MOUNT_CLASS_TO} from '../config/debug';\r\nimport I18n, {i18n} from '../lib/langPack';\r\n\r\nexport const months = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'];\r\nexport const days = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];\r\n\r\nexport const ONE_DAY = 86400;\r\n\r\n// https://stackoverflow.com/a/6117889\r\nexport const getWeekNumber = (date: Date) => {\r\n  const d = new Date(Date.UTC(date.getFullYear(), date.getMonth(), date.getDate()));\r\n  const dayNum = d.getUTCDay() || 7;\r\n  d.setUTCDate(d.getUTCDate() + 4 - dayNum);\r\n  const yearStart = new Date(Date.UTC(d.getUTCFullYear(), 0, 1));\r\n  return Math.ceil((((d.getTime() - yearStart.getTime()) / ONE_DAY) + 1) / 7);\r\n};\r\n\r\nexport function formatDateAccordingToTodayNew(time: Date) {\r\n  const today = new Date();\r\n  const now = today.getTime() / 1000 | 0;\r\n  const timestamp = time.getTime() / 1000 | 0;\r\n\r\n  const options: Intl.DateTimeFormatOptions = {};\r\n  if((now - timestamp) < ONE_DAY && today.getDate() === time.getDate()) { // if the same day\r\n    options.hour = options.minute = '2-digit';\r\n  } else if(today.getFullYear() !== time.getFullYear()) { // different year\r\n    options.year = options.day = 'numeric';\r\n    options.month = '2-digit';\r\n  } else if((now - timestamp) < (ONE_DAY * 7) && getWeekNumber(today) === getWeekNumber(time)) { // current week\r\n    options.weekday = 'short';\r\n  } else { // same year\r\n    options.month = 'short';\r\n    options.day = 'numeric';\r\n  }\r\n\r\n  return new I18n.IntlDateElement({\r\n    date: time,\r\n    options\r\n  }).element;\r\n}\r\n\r\nexport function formatFullSentTimeRaw(timestamp: number, options: {\r\n  capitalize?: boolean\r\n} = {}) {\r\n  const date = new Date();\r\n  const time = new Date(timestamp * 1000);\r\n  const now = date.getTime() / 1000;\r\n\r\n  const timeEl = formatTime(time);\r\n\r\n  let dateEl: Node | string;\r\n  if((now - timestamp) < ONE_DAY && date.getDate() === time.getDate()) { // if the same day\r\n    dateEl = i18n(options.capitalize ? 'Date.Today' : 'Peer.Status.Today');\r\n  } else if((now - timestamp) < (ONE_DAY * 2) && (date.getDate() - 1) === time.getDate()) { // yesterday\r\n    dateEl = i18n(options.capitalize ? 'Yesterday' : 'Peer.Status.Yesterday');\r\n\r\n    if(options.capitalize) {\r\n      (dateEl as HTMLElement).style.textTransform = 'capitalize';\r\n    }\r\n  } else if(date.getFullYear() !== time.getFullYear()) { // different year\r\n    dateEl = new I18n.IntlDateElement({\r\n      date: time,\r\n      options: {\r\n        month: 'short',\r\n        day: 'numeric',\r\n        year: 'numeric'\r\n      }\r\n    }).element;\r\n    // dateStr = months[time.getMonth()].slice(0, 3) + ' ' + time.getDate() + ', ' + time.getFullYear();\r\n  } else {\r\n    dateEl = new I18n.IntlDateElement({\r\n      date: time,\r\n      options: {\r\n        month: 'short',\r\n        day: 'numeric'\r\n      }\r\n    }).element;\r\n    // dateStr = months[time.getMonth()].slice(0, 3) + ' ' + time.getDate();\r\n  }\r\n\r\n  return {dateEl, timeEl};\r\n}\r\n\r\nexport function formatFullSentTime(timestamp: number) {\r\n  const {dateEl, timeEl} = formatFullSentTimeRaw(timestamp, {\r\n    capitalize: true\r\n  });\r\n\r\n  const fragment = document.createDocumentFragment();\r\n  fragment.append(dateEl, ' ', i18n('ScheduleController.at'), ' ', timeEl);\r\n  return fragment;\r\n}\r\n\r\nexport function formatTime(date: Date) {\r\n  return new I18n.IntlDateElement({\r\n    date,\r\n    options: {\r\n      hour: '2-digit',\r\n      minute: '2-digit'\r\n    }\r\n  }).element;\r\n}\r\n\r\nMOUNT_CLASS_TO && (MOUNT_CLASS_TO.formatDateAccordingToTodayNew = formatDateAccordingToTodayNew);\r\n\r\nexport const getFullDate = (date: Date, options: Partial<{\r\n  noTime: true,\r\n  noSeconds: true,\r\n  monthAsNumber: true,\r\n  leadingZero: true\r\n}> = {}) => {\r\n  const joiner = options.monthAsNumber ? '.' : ' ';\r\n  const time = ('0' + date.getHours()).slice(-2) + ':' + ('0' + date.getMinutes()).slice(-2) + (options.noSeconds ? '' : ':' + ('0' + date.getSeconds()).slice(-2));\r\n\r\n  return (options.leadingZero ? ('0' + date.getDate()).slice(-2) : date.getDate()) +\r\n    joiner + (options.monthAsNumber ? ('0' + (date.getMonth() + 1)).slice(-2) : months[date.getMonth()]) +\r\n    joiner + date.getFullYear() +\r\n    (options.noTime ? '' : ', ' + time);\r\n};\r\n\r\n// https://github.com/DrKLO/Telegram/blob/d52b2c921abd3c1e8d6368858313ad0cb0468c07/TMessagesProj/src/main/java/org/telegram/ui/Adapters/FiltersView.java\r\nconst minYear = 2013;\r\nconst yearPattern = new RegExp('20[0-9]{1,2}');\r\nconst monthYearOrDayPattern = new RegExp('(\\\\w{3,}) ([0-9]{0,4})', 'i');\r\nconst yearOrDayAndMonthPattern = new RegExp('([0-9]{0,4}) (\\\\w{2,})', 'i');\r\nconst shortDate = new RegExp('^([0-9]{1,4})(\\\\.| |/|\\\\-)([0-9]{1,4})$', 'i');\r\nconst longDate = new RegExp('^([0-9]{1,2})(\\\\.| |/|\\\\-)([0-9]{1,2})(\\\\.| |/|\\\\-)([0-9]{1,4})$', 'i');\r\nconst numberOfDaysEachMonth = [31, 29, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31];\r\nexport type DateData = {\r\n  title: string,\r\n  minDate: number,\r\n  maxDate: number,\r\n};\r\nexport function fillTipDates(query: string, dates: DateData[]) {\r\n  const q = query.trim().toLowerCase();\r\n\r\n  if(q.length < 3) {\r\n    return;\r\n  }\r\n\r\n  if('today'.indexOf(q) === 0) {\r\n    const date = new Date();\r\n    const year = date.getFullYear();\r\n    const month = date.getMonth();\r\n    const day = date.getDate();\r\n    date.setFullYear(year, month, day);\r\n    date.setHours(0, 0, 0);\r\n\r\n    const minDate = date.getTime();\r\n    date.setFullYear(year, month, day + 1);\r\n    date.setHours(0, 0, 0);\r\n\r\n    const maxDate = date.getTime() - 1;\r\n    dates.push({\r\n      title: 'Today',\r\n      minDate,\r\n      maxDate\r\n    });\r\n    return;\r\n  }\r\n\r\n  if('yesterday'.indexOf(q) === 0) {\r\n    const date = new Date();\r\n    const year = date.getFullYear();\r\n    const month = date.getMonth();\r\n    const day = date.getDate();\r\n    date.setFullYear(year, month, day);\r\n    date.setHours(0, 0, 0);\r\n\r\n    const minDate = date.getTime() - 86400000;\r\n    date.setFullYear(year, month, day + 1);\r\n    date.setHours(0, 0, 0);\r\n\r\n    const maxDate = date.getTime() - 86400001;\r\n    dates.push({\r\n      title: 'Yesterday',\r\n      minDate,\r\n      maxDate\r\n    });\r\n    return;\r\n  }\r\n\r\n  const dayOfWeek = getDayOfWeek(q);\r\n  if(dayOfWeek >= 0) {\r\n    const date = new Date();\r\n    const now = date.getTime();\r\n    const currentDay = date.getDay();\r\n    const distance = dayOfWeek - currentDay;\r\n    date.setDate(date.getDate() + distance);\r\n    if(date.getTime() > now) {\r\n      date.setTime(date.getTime() - 604800000);\r\n    }\r\n    const year = date.getFullYear()\r\n    const month = date.getMonth();\r\n    const day = date.getDate();\r\n    date.setFullYear(year, month, day);\r\n    date.setHours(0, 0, 0);\r\n\r\n    const minDate = date.getTime();\r\n    date.setFullYear(year, month, day + 1);\r\n    date.setHours(0, 0, 0);\r\n\r\n    const maxDate = date.getTime() - 1;\r\n    dates.push({\r\n      title: formatWeekLong(minDate),\r\n      minDate,\r\n      maxDate\r\n    });\r\n    return;\r\n  }\r\n\r\n  let matches: any[];\r\n  if((matches = shortDate.exec(q)) !== null) {\r\n    const g1 = matches[1];\r\n    const g2 = matches[3];\r\n    const k = parseInt(g1);\r\n    const k1 = parseInt(g2);\r\n    if(k > 0 && k <= 31) {\r\n      if(k1 >= minYear && k <= 12) {\r\n        const selectedYear = k1;\r\n        const month = k - 1;\r\n        createForMonthYear(dates, month, selectedYear);\r\n        return;\r\n      } else if(k1 <= 12) {\r\n        const day = k - 1;\r\n        const month = k1 - 1;\r\n        createForDayMonth(dates, day, month);\r\n      }\r\n    } else if(k >= minYear && k1 <= 12) {\r\n      const selectedYear = k;\r\n      const month = k1 - 1;\r\n      createForMonthYear(dates, month, selectedYear);\r\n    }\r\n\r\n    return;\r\n  }\r\n\r\n  if((matches = longDate.exec(q)) !== null) {\r\n    const g1 = matches[1];\r\n    const g2 = matches[3];\r\n    const g3 = matches[5];\r\n    if(!matches[2] === matches[4]) {\r\n      return;\r\n    }\r\n\r\n    const day = parseInt(g1);\r\n    const month = parseInt(g2) - 1;\r\n    let year = parseInt(g3);\r\n    if(year >= 10 && year <= 99) {\r\n      year += 2000;\r\n    }\r\n\r\n    const currentYear = new Date().getFullYear();\r\n    if(validDateForMonth(day - 1, month) && year >= minYear && year <= currentYear) {\r\n      const date = new Date();\r\n      date.setFullYear(year, month, day);\r\n      date.setHours(0, 0, 0);\r\n\r\n      const minDate = date.getTime();\r\n      date.setFullYear(year, month, day + 1);\r\n      date.setHours(0, 0, 0);\r\n\r\n      const maxDate = date.getTime() - 1;\r\n      dates.push({\r\n        title: formatterYearMax(minDate),\r\n        minDate,\r\n        maxDate\r\n      });\r\n      return;\r\n    }\r\n\r\n    return;\r\n  }\r\n\r\n  if((matches = yearPattern.exec(q)) !== null) {\r\n    let selectedYear = +q;\r\n    const currentYear = new Date().getFullYear();\r\n    if(selectedYear < minYear) {\r\n      selectedYear = minYear;\r\n      for(let i = currentYear; i >= selectedYear; i--) {\r\n        const date = new Date();\r\n        date.setFullYear(i, 0, 1);\r\n        date.setHours(0, 0, 0);\r\n\r\n        const minDate = date.getTime();\r\n        date.setFullYear(i + 1, 0, 1);\r\n        date.setHours(0, 0, 0);\r\n\r\n        const maxDate = date.getTime() - 1;\r\n        dates.push({\r\n          title: '' + i,\r\n          minDate,\r\n          maxDate\r\n        });\r\n      }\r\n    } else if(selectedYear <= currentYear) {\r\n      const date = new Date();\r\n      date.setFullYear(selectedYear, 0, 1);\r\n      date.setHours(0, 0, 0);\r\n\r\n      const minDate = date.getTime();\r\n      date.setFullYear(selectedYear + 1, 0, 1);\r\n      date.setHours(0, 0, 0);\r\n\r\n      const maxDate = date.getTime() - 1;\r\n      dates.push({\r\n        title: '' + selectedYear,\r\n        minDate,\r\n        maxDate\r\n      });\r\n    }\r\n\r\n    return;\r\n  }\r\n\r\n  if((matches = monthYearOrDayPattern.exec(q)) !== null) {\r\n    const g1 = matches[1];\r\n    const g2 = matches[2];\r\n    const month = getMonth(g1);\r\n    if(month >= 0) {\r\n      const k = +g2;\r\n      if(k > 0 && k <= 31) {\r\n        const day = k - 1;\r\n        createForDayMonth(dates, day, month);\r\n        return;\r\n      } else if(k >= minYear) {\r\n        const selectedYear = k;\r\n        createForMonthYear(dates, month, selectedYear);\r\n        return;\r\n      }\r\n    }\r\n  }\r\n\r\n  if((matches = yearOrDayAndMonthPattern.exec(q)) !== null) {\r\n    const g1 = matches[1];\r\n    const g2 = matches[2];\r\n    const month = getMonth(g2);\r\n    if(month >= 0) {\r\n      const k = +g1;\r\n      if(k > 0 && k <= 31) {\r\n        const day = k - 1;\r\n        createForDayMonth(dates, day, month);\r\n        return;\r\n      } else if(k >= minYear) {\r\n        const selectedYear = k;\r\n        createForMonthYear(dates, month, selectedYear);\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\nfunction createForMonthYear(dates: DateData[], month: number, selectedYear: number) {\r\n  const currentYear = new Date().getFullYear();\r\n  const today = Date.now();\r\n  if(selectedYear >= minYear && selectedYear <= currentYear) {\r\n    const date = new Date();\r\n    date.setFullYear(selectedYear, month, 1);\r\n    date.setHours(0, 0, 0);\r\n    const minDate = date.getTime();\r\n    if(minDate > today) {\r\n      return;\r\n    }\r\n    date.setMonth(date.getMonth() + 1);\r\n    const maxDate = date.getTime() - 1;\r\n\r\n    dates.push({\r\n      title: formatterMonthYear(minDate),\r\n      minDate,\r\n      maxDate\r\n    });\r\n  }\r\n}\r\n\r\nfunction createForDayMonth(dates: DateData[], day: number, month: number) {\r\n  if(validDateForMonth(day, month)) {\r\n    const currentYear = new Date().getFullYear();\r\n    const today = Date.now();\r\n\r\n    for(let i = currentYear; i >= minYear; i--) {\r\n      if(month === 1 && day === 28 && !isLeapYear(i)) {\r\n        continue;\r\n      }\r\n\r\n      const date = new Date();\r\n      date.setFullYear(i, month, day + 1);\r\n      date.setHours(0, 0, 0);\r\n\r\n      const minDate = date.getTime();\r\n      if(minDate > today) {\r\n        continue;\r\n      }\r\n\r\n      date.setFullYear(i, month, day + 2);\r\n      date.setHours(0, 0, 0);\r\n      const maxDate = date.getTime() - 1;\r\n      if(i === currentYear) {\r\n        dates.push({\r\n          title: formatterDayMonth(minDate),\r\n          minDate,\r\n          maxDate\r\n        });\r\n      } else {\r\n        dates.push({\r\n          title: formatterYearMax(minDate),\r\n          minDate,\r\n          maxDate\r\n        });\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\nfunction formatterMonthYear(timestamp: number) {\r\n  const date = new Date(timestamp);\r\n  return months[date.getMonth()].slice(0, 3) + ' ' + date.getFullYear();\r\n}\r\n\r\nfunction formatterDayMonth(timestamp: number) {\r\n  const date = new Date(timestamp);\r\n  return months[date.getMonth()].slice(0, 3) + ' ' + date.getDate();\r\n}\r\n\r\nfunction formatterYearMax(timestamp: number) {\r\n  const date = new Date(timestamp);\r\n  return ('0' + date.getDate()).slice(-2) + '.' + ('0' + (date.getMonth() + 1)).slice(-2) + '.' + date.getFullYear();\r\n}\r\n\r\nfunction formatWeekLong(timestamp: number) {\r\n  const date = new Date(timestamp);\r\n  return days[date.getDay()];\r\n}\r\n\r\nfunction validDateForMonth(day: number, month: number) {\r\n  if(month >= 0 && month < 12) {\r\n    if(day >= 0 && day < numberOfDaysEachMonth[month]) {\r\n      return true;\r\n    }\r\n  }\r\n  return false;\r\n}\r\n\r\nfunction isLeapYear(year: number) {\r\n  return ((year % 4 === 0) && (year % 100 !== 0)) || (year % 400 === 0);\r\n}\r\n\r\nfunction getMonth(q: string) {\r\n  /* String[] months = new String[]{\r\n          LocaleController.getString(\"January\", R.string.January).toLowerCase(),\r\n          LocaleController.getString(\"February\", R.string.February).toLowerCase(),\r\n          LocaleController.getString(\"March\", R.string.March).toLowerCase(),\r\n          LocaleController.getString(\"April\", R.string.April).toLowerCase(),\r\n          LocaleController.getString(\"May\", R.string.May).toLowerCase(),\r\n          LocaleController.getString(\"June\", R.string.June).toLowerCase(),\r\n          LocaleController.getString(\"July\", R.string.July).toLowerCase(),\r\n          LocaleController.getString(\"August\", R.string.August).toLowerCase(),\r\n          LocaleController.getString(\"September\", R.string.September).toLowerCase(),\r\n          LocaleController.getString(\"October\", R.string.October).toLowerCase(),\r\n          LocaleController.getString(\"November\", R.string.November).toLowerCase(),\r\n          LocaleController.getString(\"December\", R.string.December).toLowerCase()\r\n  }; */\r\n\r\n  /* String[] monthsEng = new String[12];\r\n  Calendar c = Calendar.getInstance();\r\n  for (int i = 1; i <= 12; i++) {\r\n      c.set(0, 0, 0, 0, 0, 0);\r\n      c.set(Calendar.MONTH, i);\r\n      monthsEng[i - 1] = c.getDisplayName(Calendar.MONTH, Calendar.LONG, Locale.ENGLISH).toLowerCase();\r\n  } */\r\n\r\n  q = q.toLowerCase();\r\n  for(let i = 0; i < 12; i++) {\r\n    const month = months[i].toLowerCase();\r\n    if(month.indexOf(q) === 0) {\r\n      return i;\r\n    }\r\n  }\r\n  return -1;\r\n}\r\n\r\nfunction getDayOfWeek(q: string) {\r\n  const c = new Date();\r\n  if(q.length <= 3) {\r\n    return -1;\r\n  }\r\n\r\n  for(let i = 0; i < 7; i++) {\r\n    c.setDate(c.getDate() + 1);\r\n\r\n    if(formatWeekLong(c.getTime()).toLowerCase().indexOf(q) === 0) {\r\n      return c.getDay();\r\n    }\r\n  }\r\n  return -1;\r\n}\r\n\r\nMOUNT_CLASS_TO.fillTipDates = fillTipDates;\r\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport IS_TOUCH_SUPPORTED from '../../environment/touchSupport';\nimport {IS_APPLE} from '../../environment/userAgent';\nimport contextMenuController from '../contextMenuController';\nimport ListenerSetter from '../listenerSetter';\nimport cancelEvent from './cancelEvent';\n\nlet _cancelContextMenuOpening = false, _cancelContextMenuOpeningTimeout = 0;\nexport function cancelContextMenuOpening() {\n  if(_cancelContextMenuOpeningTimeout) {\n    clearTimeout(_cancelContextMenuOpeningTimeout);\n  }\n\n  _cancelContextMenuOpeningTimeout = window.setTimeout(() => {\n    _cancelContextMenuOpeningTimeout = 0;\n    _cancelContextMenuOpening = false;\n  }, .4e3);\n\n  _cancelContextMenuOpening = true;\n}\n\nexport function attachContextMenuListener(element: HTMLElement, callback: (e: Touch | MouseEvent) => void, listenerSetter?: ListenerSetter) {\n  const add = listenerSetter ? listenerSetter.add(element) : element.addEventListener.bind(element);\n  const remove = listenerSetter ? listenerSetter.removeManual.bind(listenerSetter, element) : element.removeEventListener.bind(element);\n\n  if(IS_APPLE && IS_TOUCH_SUPPORTED) {\n    let timeout: number;\n\n    const options: EventListenerOptions = {capture: true};\n\n    const onCancel = () => {\n      clearTimeout(timeout);\n      // @ts-ignore\n      remove('touchmove', onCancel, options);\n      // @ts-ignore\n      remove('touchend', onCancel, options);\n      // @ts-ignore\n      remove('touchcancel', onCancel, options);\n    };\n\n    add('touchstart', (e: TouchEvent) => {\n      if(e.touches.length > 1) {\n        onCancel();\n        return;\n      }\n\n      add('touchmove', onCancel, options);\n      add('touchend', onCancel, options);\n      add('touchcancel', onCancel, options);\n\n      timeout = window.setTimeout(() => {\n        if(_cancelContextMenuOpening) {\n          onCancel();\n          return;\n        }\n\n        callback(e.touches[0]);\n        onCancel();\n\n        if(contextMenuController.isOpened()) {\n          element.addEventListener('touchend', cancelEvent, {once: true}); // * fix instant closing\n        }\n      }, .4e3);\n    });\n\n    /* if(!isSafari) {\n      add('contextmenu', (e: any) => {\n        cancelEvent(e);\n      }, {passive: false, capture: true});\n    } */\n  } else {\n    add('contextmenu', IS_TOUCH_SUPPORTED ? (e: any) => {\n      callback(e);\n\n      if(contextMenuController.isOpened()) {\n        element.addEventListener('touchend', cancelEvent, {once: true}); // * fix instant closing\n      }\n    } : callback);\n  }\n}\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nexport type GrabEvent = {x: number, y: number, isTouch?: boolean, event: TouchEvent | MouseEvent};\r\n\r\nexport default function attachGrabListeners(element: HTMLElement,\r\n  onStart: (position: GrabEvent) => void,\r\n  onMove: (position: GrabEvent) => void,\r\n  onEnd?: (position: GrabEvent) => void) {\r\n  // * Mouse\r\n  const onMouseMove = (event: MouseEvent) => {\r\n    onMove({x: event.pageX, y: event.pageY, event});\r\n  };\r\n\r\n  const onMouseUp = (event: MouseEvent) => {\r\n    document.removeEventListener('mousemove', onMouseMove);\r\n    element.addEventListener('mousedown', onMouseDown, {once: true});\r\n    onEnd && onEnd({x: event.pageX, y: event.pageY, event});\r\n  };\r\n\r\n  const onMouseDown = (event: MouseEvent) => {\r\n    if(event.button !== 0) {\r\n      element.addEventListener('mousedown', onMouseDown, {once: true});\r\n      return;\r\n    }\r\n\r\n    onStart({x: event.pageX, y: event.pageY, event});\r\n    onMouseMove(event);\r\n\r\n    document.addEventListener('mousemove', onMouseMove);\r\n    document.addEventListener('mouseup', onMouseUp, {once: true});\r\n  };\r\n\r\n  element.addEventListener('mousedown', onMouseDown, {once: true});\r\n\r\n  // * Touch\r\n  const onTouchMove = (event: TouchEvent) => {\r\n    event.preventDefault();\r\n    onMove({x: event.touches[0].clientX, y: event.touches[0].clientY, isTouch: true, event});\r\n  };\r\n\r\n  const onTouchEnd = (event: TouchEvent) => {\r\n    document.removeEventListener('touchmove', onTouchMove);\r\n    element.addEventListener('touchstart', onTouchStart, {passive: false, once: true});\r\n    onEnd && onEnd({x: event.touches[0].clientX, y: event.touches[0].clientY, isTouch: true, event});\r\n  };\r\n\r\n  const onTouchStart = (event: TouchEvent) => {\r\n    onStart({x: event.touches[0].clientX, y: event.touches[0].clientY, isTouch: true, event});\r\n    onTouchMove(event);\r\n\r\n    document.addEventListener('touchmove', onTouchMove, {passive: false});\r\n    document.addEventListener('touchend', onTouchEnd, {passive: false, once: true});\r\n  };\r\n\r\n  element.addEventListener('touchstart', onTouchStart, {passive: false, once: true});\r\n\r\n  return () => {\r\n    element.removeEventListener('mousedown', onMouseDown);\r\n    document.removeEventListener('mousemove', onMouseMove);\r\n    document.removeEventListener('mouseup', onMouseUp);\r\n\r\n    element.removeEventListener('touchstart', onTouchStart);\r\n    document.removeEventListener('touchmove', onTouchMove);\r\n    document.removeEventListener('touchend', onTouchEnd);\r\n  };\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nexport default function cancelSelection() {\r\n  if(window.getSelection) {\r\n    if(window.getSelection().empty) {  // Chrome\r\n      window.getSelection().empty();\r\n    } else if(window.getSelection().removeAllRanges) {  // Firefox\r\n      window.getSelection().removeAllRanges();\r\n    }\r\n    // @ts-ignore\r\n  } else if(document.selection) {  // IE?\r\n    // @ts-ignore\r\n    document.selection.empty();\r\n  }\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport type ListenerSetter from '../listenerSetter';\r\nimport IS_TOUCH_SUPPORTED from '../../environment/touchSupport';\r\nimport simulateEvent from './dispatchEvent';\r\n\r\nexport const CLICK_EVENT_NAME: 'mousedown' /* | 'touchend' */ | 'click' = (IS_TOUCH_SUPPORTED ? 'mousedown' : 'click') as any;\r\nexport type AttachClickOptions = AddEventListenerOptions & Partial<{listenerSetter: ListenerSetter, touchMouseDown: true}>;\r\nexport function attachClickEvent(elem: HTMLElement | Window, callback: (e: /* TouchEvent |  */MouseEvent) => void, options: AttachClickOptions = {}) {\r\n  const add = options.listenerSetter ? options.listenerSetter.add(elem) : elem.addEventListener.bind(elem);\r\n  // const remove = options.listenerSetter ? options.listenerSetter.removeManual.bind(options.listenerSetter, elem) : elem.removeEventListener.bind(elem);\r\n\r\n  options.touchMouseDown = true;\r\n  /* if(options.touchMouseDown && CLICK_EVENT_NAME === 'touchend') {\r\n    add('mousedown', callback, options);\r\n  } else if(CLICK_EVENT_NAME === 'touchend') {\r\n    const o = {...options, once: true};\r\n\r\n    const onTouchStart = (e: TouchEvent) => {\r\n      const onTouchMove = (e: TouchEvent) => {\r\n        remove('touchmove', onTouchMove, o);\r\n        remove('touchend', onTouchEnd, o);\r\n      };\r\n\r\n      const onTouchEnd = (e: TouchEvent) => {\r\n        remove('touchmove', onTouchMove, o);\r\n        callback(e);\r\n        if(options.once) {\r\n          remove('touchstart', onTouchStart);\r\n        }\r\n      };\r\n\r\n      add('touchend', onTouchEnd, o);\r\n      add('touchmove', onTouchMove, o);\r\n    };\r\n\r\n    add('touchstart', onTouchStart);\r\n  } else {\r\n    add(CLICK_EVENT_NAME, callback, options);\r\n  } */\r\n  add(CLICK_EVENT_NAME, callback, options);\r\n}\r\n\r\nexport function detachClickEvent(elem: HTMLElement | Window, callback: (e: /* TouchEvent |  */MouseEvent) => void, options?: AddEventListenerOptions) {\r\n  // if(CLICK_EVENT_NAME === 'touchend') {\r\n  //   elem.removeEventListener('touchstart', callback, options);\r\n  // } else {\r\n  elem.removeEventListener(CLICK_EVENT_NAME, callback as any, options);\r\n  // }\r\n}\r\n\r\nexport function simulateClickEvent(elem: HTMLElement) {\r\n  simulateEvent(elem, CLICK_EVENT_NAME);\r\n}\r\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport IS_TOUCH_SUPPORTED from '../../environment/touchSupport';\nimport EventListenerBase from '../eventListenerBase';\nimport ListenerSetter from '../listenerSetter';\nimport safeAssign from '../object/safeAssign';\nimport findUpClassName from './findUpClassName';\n\nexport default class ControlsHover extends EventListenerBase<{\n  toggleControls: (show: boolean) => void\n}> {\n  protected hideControlsTimeout: number;\n  protected controlsLocked: boolean;\n\n  protected canHideControls: () => boolean;\n  protected element: HTMLElement;\n  protected listenerSetter: ListenerSetter;\n  protected showOnLeaveToClassName: string;\n  protected ignoreClickClassName: string;\n\n  constructor() {\n    super(false);\n    this.hideControlsTimeout = 0;\n  }\n\n  public setup(options: {\n    element: HTMLElement,\n    listenerSetter: ListenerSetter,\n    canHideControls?: () => boolean,\n    showOnLeaveToClassName?: string,\n    ignoreClickClassName?: string\n  }) {\n    safeAssign(this, options);\n\n    const {listenerSetter, element} = this;\n\n    if(IS_TOUCH_SUPPORTED) {\n      listenerSetter.add(element)('click', (e) => {\n        if(this.ignoreClickClassName && findUpClassName(e.target, this.ignoreClickClassName)) {\n          return;\n        }\n\n        this.toggleControls();\n      });\n\n      /* listenerSetter.add(player)('touchstart', () => {\n        showControls(false);\n      });\n\n      listenerSetter.add(player)('touchend', () => {\n        if(player.classList.contains('is-playing')) {\n          showControls();\n        }\n      }); */\n    } else {\n      listenerSetter.add(element)('mousemove', () => {\n        this.showControls();\n      });\n\n      listenerSetter.add(element)('mouseenter', () => {\n        this.showControls(false);\n      });\n\n      listenerSetter.add(element)('mouseleave', (e) => {\n        if(e.relatedTarget && this.showOnLeaveToClassName && findUpClassName(e.relatedTarget, this.showOnLeaveToClassName)) {\n          this.showControls(false);\n          return;\n        }\n\n        this.hideControls();\n      });\n    }\n  }\n\n  public hideControls = (setHideTimeout = false) => {\n    if(setHideTimeout) {\n      if(!this.hideControlsTimeout) {\n        this.hideControlsTimeout = window.setTimeout(this.hideControls, 3e3);\n      }\n\n      return;\n    }\n\n    clearTimeout(this.hideControlsTimeout);\n    this.hideControlsTimeout = 0;\n\n    const isShown = this.element.classList.contains('show-controls');\n    if(this.controlsLocked !== false) {\n      if((this.canHideControls ? !this.canHideControls() : false) || !isShown || this.controlsLocked) {\n        return;\n      }\n    } else if(!isShown) {\n      return;\n    }\n\n    this.dispatchEvent('toggleControls', false);\n    this.element.classList.remove('show-controls');\n  };\n\n  public showControls = (setHideTimeout = true) => {\n    if(this.hideControlsTimeout) {\n      clearTimeout(this.hideControlsTimeout);\n      this.hideControlsTimeout = 0;\n    } else if(!this.element.classList.contains('show-controls') && this.controlsLocked !== false) {\n      this.dispatchEvent('toggleControls', true);\n      this.element.classList.add('show-controls');\n    }\n\n    if(!setHideTimeout || this.controlsLocked) {\n      return;\n    }\n\n    this.hideControlsTimeout = window.setTimeout(this.hideControls, 3e3);\n  };\n\n  public toggleControls = (show?: boolean) => {\n    const isShown = this.element.classList.contains('show-controls');\n\n    if(show === undefined) {\n      if(isShown) this.hideControls();\n      else this.showControls();\n    } else if(show === isShown) return;\n    else if(show === false) this.hideControls();\n    else this.showControls();\n  };\n\n  public lockControls(visible: boolean) {\n    this.controlsLocked = visible;\n\n    this.element.classList.toggle('disable-hover', visible === false);\n    this.toggleControls(visible);\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport type {MyDocument} from '../../lib/appManagers/appDocsManager';\nimport PopupStickers from '../../components/popups/stickers';\nimport appImManager from '../../lib/appManagers/appImManager';\nimport rootScope from '../../lib/rootScope';\nimport createContextMenu from './createContextMenu';\nimport findUpClassName from './findUpClassName';\nimport emoticonsDropdown, {EmoticonsDropdown} from '../../components/emoticonsDropdown';\n\nexport default function createStickersContextMenu(options: {\n  listenTo: HTMLElement,\n  isStickerPack?: boolean,\n  verifyRecent?: (target: HTMLElement) => boolean,\n  appendTo?: HTMLElement,\n  onOpen?: () => any,\n  onClose?: () => any\n}) {\n  const {listenTo, isStickerPack, verifyRecent, appendTo, onOpen, onClose} = options;\n  let target: HTMLElement, doc: MyDocument;\n  const verifyFavoriteSticker = async(toAdd: boolean) => {\n    const favedStickers = await rootScope.managers.acknowledged.appStickersManager.getFavedStickersStickers();\n    if(!favedStickers.cached) {\n      return false;\n    }\n\n    const found = (await favedStickers.result).some((_doc) => _doc.id === doc.id);\n    return toAdd ? !found : found;\n  };\n\n  return createContextMenu({\n    listenTo: listenTo,\n    appendTo,\n    findElement: (e) => target = findUpClassName(e.target, 'media-sticker-wrapper'),\n    onOpen: async() => {\n      doc = await rootScope.managers.appDocsManager.getDoc(target.dataset.docId);\n      return onOpen?.();\n    },\n    onClose,\n    buttons: [{\n      icon: 'stickers',\n      text: 'Context.ViewStickerSet',\n      onClick: () => new PopupStickers(doc.stickerSetInput).show(),\n      verify: () => !isStickerPack\n    }, {\n      icon: 'favourites',\n      text: 'AddToFavorites',\n      onClick: () => rootScope.managers.appStickersManager.faveSticker(doc.id, false),\n      verify: () => verifyFavoriteSticker(true)\n    }, {\n      icon: 'favourites',\n      text: 'DeleteFromFavorites',\n      onClick: () => rootScope.managers.appStickersManager.faveSticker(doc.id, true),\n      verify: () => verifyFavoriteSticker(false)\n    }, {\n      icon: 'delete',\n      text: 'DeleteFromRecent',\n      onClick: () => emoticonsDropdown.stickersTab.deleteRecentSticker(doc),\n      verify: () => verifyRecent?.(target) ?? false\n    }, {\n      icon: 'mute',\n      text: 'Chat.Send.WithoutSound',\n      onClick: () => EmoticonsDropdown.sendDocId(doc.id, false, true),\n      verify: () => !!(appImManager.chat.peerId && appImManager.chat.peerId !== rootScope.myId)\n    }, {\n      icon: 'schedule',\n      text: 'Chat.Send.ScheduledMessage',\n      onClick: () => appImManager.chat.input.scheduleSending(() => appImManager.chat.input.sendMessageWithDocument(doc)),\n      verify: () => !!appImManager.chat.peerId\n    }]\n  });\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport ButtonMenu, {ButtonMenuItemOptions} from '../../components/buttonMenu';\nimport filterAsync from '../array/filterAsync';\nimport contextMenuController from '../contextMenuController';\nimport ListenerSetter from '../listenerSetter';\nimport {getMiddleware} from '../middleware';\nimport positionMenu from '../positionMenu';\nimport {attachContextMenuListener} from './attachContextMenuListener';\n\nexport default function createContextMenu<T extends ButtonMenuItemOptions & {verify?: () => boolean | Promise<boolean>}>({\n  buttons,\n  findElement,\n  listenTo,\n  appendTo,\n  filterButtons,\n  onOpen,\n  onClose\n}: {\n  buttons: T[],\n  findElement: (e: MouseEvent) => HTMLElement,\n  listenTo: HTMLElement,\n  appendTo?: HTMLElement,\n  filterButtons?: (buttons: T[]) => Promise<T[]>,\n  onOpen?: (target: HTMLElement) => any,\n  onClose?: () => any\n}) {\n  appendTo ??= document.body;\n\n  const attachListenerSetter = new ListenerSetter();\n  const listenerSetter = new ListenerSetter();\n  const middleware = getMiddleware();\n  let element: HTMLElement;\n\n  attachContextMenuListener(listenTo, (e) => {\n    const target = findElement(e as any);\n    if(!target) {\n      return;\n    }\n\n    let _element = element;\n    if(e instanceof MouseEvent || e.hasOwnProperty('preventDefault')) (e as any).preventDefault();\n    if(_element && _element.classList.contains('active')) {\n      return false;\n    }\n    if(e instanceof MouseEvent || e.hasOwnProperty('cancelBubble')) (e as any).cancelBubble = true;\n\n    const r = async() => {\n      await onOpen?.(target);\n\n      const initResult = await init();\n      if(!initResult) {\n        return;\n      }\n\n      _element = initResult.element;\n      const {cleanup, destroy} = initResult;\n\n      positionMenu(e, _element);\n      contextMenuController.openBtnMenu(_element, () => {\n        onClose?.();\n        cleanup();\n\n        setTimeout(() => {\n          destroy();\n        }, 300);\n      });\n    };\n\n    r();\n  }, attachListenerSetter);\n\n  const cleanup = () => {\n    listenerSetter.removeAll();\n    middleware.clean();\n  };\n\n  const destroy = () => {\n    cleanup();\n    attachListenerSetter.removeAll();\n  };\n\n  const init = async() => {\n    cleanup();\n\n    buttons.forEach((button) => button.element = undefined);\n    const f = filterButtons || ((buttons: T[]) => filterAsync(buttons, (button) => button?.verify?.() ?? true));\n\n    const filteredButtons = await f(buttons);\n    if(!filteredButtons.length) {\n      return;\n    }\n\n    const _element = element = ButtonMenu(filteredButtons, listenerSetter);\n    _element.classList.add('contextmenu');\n\n    appendTo.append(_element);\n\n    return {\n      element: _element,\n      cleanup,\n      destroy: () => {\n        _element.remove();\n      }\n    };\n  };\n\n  return {element, destroy};\n}\n","export default function createVideo(options: {\n  pip?: boolean\n} = {}) {\n  const video = document.createElement('video');\n  if(!options.pip) video.disablePictureInPicture = true;\n  video.setAttribute('playsinline', 'true');\n  return video;\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport rootScope from '../../lib/rootScope';\n\nexport type CustomProperty = string;\n\nexport class CustomProperties {\n  private cache: {[k in CustomProperty]?: string};\n  private computedStyle: CSSStyleDeclaration;\n\n  constructor() {\n    this.cache = {};\n\n    rootScope.addEventListener('theme_change', () => {\n      this.computedStyle = undefined;\n      const cache = this.cache;\n      this.cache = {};\n\n      for(const i in cache) {\n        this.getProperty(i);\n      }\n    });\n  }\n\n  public getProperty(name: CustomProperty) {\n    let value = this.cache[name];\n    if(value) {\n      return value;\n    }\n\n    if(!this.computedStyle) {\n      this.computedStyle = window.getComputedStyle(document.documentElement);\n    }\n\n    value = this.computedStyle.getPropertyValue('--' + name).trim();\n    return this.cache[name] = value;\n  }\n}\n\nconst customProperties = new CustomProperties();\nexport default customProperties;\n","export default function simulateEvent(elem: EventTarget, name: string) {\n  const event = new Event(name, {bubbles: true, cancelable: true});\n  elem.dispatchEvent(event);\n}\n","import encodeEntities from '../string/encodeEntities';\n\nexport default function documentFragmentToHTML(fragment: DocumentFragment) {\n  return Array.from(fragment.childNodes).map((node) => {\n    return node.nodeType === 3 ? encodeEntities(node.textContent) : (node as Element).outerHTML;\n  }).join('');\n}\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nexport default function findUpAsChild(el: HTMLElement, parent: HTMLElement): HTMLElement {\r\n  if(el.parentElement === parent) return el;\r\n\r\n  while(el.parentElement) {\r\n    el = el.parentElement;\r\n    if(el.parentElement === parent) {\r\n      return el;\r\n    }\r\n  }\r\n\r\n  return null;\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nexport default function findUpAttribute(el: any, attribute: string): HTMLElement {\r\n  return el.closest(`[${attribute}]`);\r\n  /* if(el.getAttribute(attribute) !== null) return el; // 03.02.2020\r\n\r\n  while(el.parentElement) {\r\n    el = el.parentElement;\r\n    if(el.getAttribute(attribute) !== null)\r\n      return el;\r\n  }\r\n  return null; */\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nexport default function findUpTag(el: any, tag: string): HTMLElement {\r\n  return el.closest(tag);\r\n  /* if(el.tagName === tag) return el; // 03.02.2020\r\n\r\n  while(el.parentElement) {\r\n    el = el.parentElement;\r\n    if(el.tagName === tag)\r\n      return el;\r\n  }\r\n  return null; */\r\n}\r\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport type ListenerSetter from '../listenerSetter';\n\nexport function requestFullScreen(element: HTMLElement) {\n  if(element.requestFullscreen) {\n    element.requestFullscreen();\n    // @ts-ignore\n  } else if(element.mozRequestFullScreen) {\n    // @ts-ignore\n    element.mozRequestFullScreen(); // Firefox\n    // @ts-ignore\n  } else if(element.webkitRequestFullscreen) {\n    // @ts-ignore\n    element.webkitRequestFullscreen(); // Chrome and Safari\n    // @ts-ignore\n  } else if(element.msRequestFullscreen) {\n    // @ts-ignore\n    element.msRequestFullscreen();\n  }\n}\n\nexport function cancelFullScreen() {\n  // @ts-ignore\n  if(document.cancelFullScreen) {\n    // @ts-ignore\n    document.cancelFullScreen();\n    // @ts-ignore\n  } else if(document.mozCancelFullScreen) {\n    // @ts-ignore\n    document.mozCancelFullScreen();\n    // @ts-ignore\n  } else if(document.webkitCancelFullScreen) {\n    // @ts-ignore\n    document.webkitCancelFullScreen();\n    // @ts-ignore\n  } else if(document.msExitFullscreen) {\n    // @ts-ignore\n    document.msExitFullscreen();\n  }\n}\n\nexport function addFullScreenListener(element: HTMLElement, callback: (e: Event) => any, listenerSetter?: ListenerSetter) {\n  const addListener = listenerSetter ? listenerSetter.add(element) : element.addEventListener.bind(element);\n  'webkitfullscreenchange mozfullscreenchange fullscreenchange MSFullscreenChange'.split(' ').forEach((eventName) => {\n    addListener(eventName, callback, false);\n  });\n}\n\nexport function getFullScreenElement(): HTMLElement {\n  // @ts-ignore\n  return document.fullscreenElement || document.mozFullScreenElement || document.webkitFullscreenElement || document.msFullscreenElement;\n}\n\nexport function isFullScreen() {\n  return !!getFullScreenElement();\n}\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n *\r\n * Originally from:\r\n * https://github.com/zhukov/webogram\r\n * Copyright (C) 2014 Igor Zhukov <igor.beatle@gmail.com>\r\n * https://github.com/zhukov/webogram/blob/master/LICENSE\r\n */\r\n\r\nimport {MessageEntity} from '../../layer';\r\n\r\nexport type MarkdownType = 'bold' | 'italic' | 'underline' | 'strikethrough' | 'monospace' | 'link' | 'mentionName' | 'spoiler';\r\nexport type MarkdownTag = {\r\n  match: string,\r\n  entityName: Extract<MessageEntity['_'], 'messageEntityBold' | 'messageEntityUnderline' | 'messageEntityItalic' | 'messageEntityCode' | 'messageEntityStrike' | 'messageEntityTextUrl' | 'messageEntityMentionName' | 'messageEntitySpoiler'>;\r\n};\r\n\r\n// https://core.telegram.org/bots/api#html-style\r\nexport const markdownTags: {[type in MarkdownType]: MarkdownTag} = {\r\n  bold: {\r\n    match: '[style*=\"bold\"], [style*=\"font-weight: 700\"], [style*=\"font-weight: 600\"], [style*=\"font-weight:700\"], [style*=\"font-weight:600\"], b, strong',\r\n    entityName: 'messageEntityBold'\r\n  },\r\n  underline: {\r\n    match: '[style*=\"underline\"], u, ins',\r\n    entityName: 'messageEntityUnderline'\r\n  },\r\n  italic: {\r\n    match: '[style*=\"italic\"], i, em',\r\n    entityName: 'messageEntityItalic'\r\n  },\r\n  monospace: {\r\n    match: '[style*=\"monospace\"], [face*=\"monospace\"], pre',\r\n    entityName: 'messageEntityCode'\r\n  },\r\n  strikethrough: {\r\n    match: '[style*=\"line-through\"], strike, del, s',\r\n    entityName: 'messageEntityStrike'\r\n  },\r\n  link: {\r\n    match: 'A:not(.follow)',\r\n    entityName: 'messageEntityTextUrl'\r\n  },\r\n  mentionName: {\r\n    match: 'A.follow',\r\n    entityName: 'messageEntityMentionName'\r\n  },\r\n  spoiler: {\r\n    match: '[style*=\"spoiler\"]',\r\n    entityName: 'messageEntitySpoiler'\r\n  }\r\n};\r\n\r\nconst tabulationMatch = '[style*=\"table-cell\"], th, td';\r\n\r\n/* export function getDepth(child: Node, container?: Node) {\r\n  let depth = 0;\r\n\r\n  do {\r\n    if(child === container) {\r\n      return depth;\r\n    }\r\n\r\n    ++depth;\r\n  } while((child = child.parentNode) !== null);\r\n\r\n  return depth;\r\n} */\r\n\r\nconst BLOCK_TAG_NAMES = new Set([\r\n  'DIV',\r\n  'P',\r\n  'BR',\r\n  'LI',\r\n  'SECTION',\r\n  'H6',\r\n  'H5',\r\n  'H4',\r\n  'H3',\r\n  'H2',\r\n  'H1',\r\n  'TR'\r\n]);\r\n\r\nexport default function getRichElementValue(node: HTMLElement, lines: string[], line: string[], selNode?: Node, selOffset?: number, entities?: MessageEntity[], offset = {offset: 0}) {\r\n  if(node.nodeType === 3) { // TEXT\r\n    const nodeValue = node.nodeValue;\r\n\r\n    /* const tabulation = node.parentElement?.closest(tabulationMatch + ', [contenteditable]');\r\n    if(tabulation?.getAttribute('contenteditable') === null) {\r\n      nodeValue += ' ';\r\n      // line.push('\\t');\r\n      // ++offset.offset;\r\n    } */\r\n\r\n    if(selNode === node) {\r\n      line.push(nodeValue.substr(0, selOffset) + '\\x01' + nodeValue.substr(selOffset));\r\n    } else {\r\n      line.push(nodeValue);\r\n    }\r\n\r\n    if(entities && nodeValue.length) {\r\n      if(node.parentNode) {\r\n        const parentElement = node.parentElement;\r\n\r\n        // let closestTag: MarkdownTag, closestElementByTag: Element, closestDepth = Infinity;\r\n        for(const type in markdownTags) {\r\n          const tag = markdownTags[type as MarkdownType];\r\n          const closest = parentElement.closest(tag.match + ', [contenteditable]');\r\n          if(closest?.getAttribute('contenteditable') !== null) {\r\n            /* const depth = getDepth(closest, parentElement.closest('[contenteditable]'));\r\n            if(closestDepth > depth) {\r\n              closestDepth = depth;\r\n              closestTag = tag;\r\n              closestElementByTag = closest;\r\n            } */\r\n            continue;\r\n          }\r\n\r\n          if(tag.entityName === 'messageEntityTextUrl') {\r\n            entities.push({\r\n              _: tag.entityName,\r\n              url: (closest as HTMLAnchorElement).href,\r\n              offset: offset.offset,\r\n              length: nodeValue.length\r\n            });\r\n          } else if(tag.entityName === 'messageEntityMentionName') {\r\n            entities.push({\r\n              _: tag.entityName,\r\n              offset: offset.offset,\r\n              length: nodeValue.length,\r\n              user_id: (closest as HTMLElement).dataset.follow.toUserId()\r\n            });\r\n          } else {\r\n            entities.push({\r\n              _: tag.entityName,\r\n              offset: offset.offset,\r\n              length: nodeValue.length\r\n            });\r\n          }\r\n        }\r\n      }\r\n    }\r\n\r\n    offset.offset += nodeValue.length;\r\n    return;\r\n  }\r\n\r\n  if(node.nodeType !== 1) { // NON-ELEMENT\r\n    return;\r\n  }\r\n\r\n  const isSelected = selNode === node;\r\n  const isBlock = BLOCK_TAG_NAMES.has(node.tagName);\r\n  if(isBlock && line.length) {\r\n    lines.push(line.join(''));\r\n    line.splice(0, line.length);\r\n    ++offset.offset;\r\n  } else if(node instanceof HTMLImageElement) {\r\n    const alt = node.alt;\r\n    if(alt) {\r\n      line.push(alt);\r\n      offset.offset += alt.length;\r\n    }\r\n  }\r\n\r\n  if(isSelected && !selOffset) {\r\n    line.push('\\x01');\r\n  }\r\n\r\n  const isTableCell = node.matches(tabulationMatch);\r\n  const wasEntitiesLength = entities?.length;\r\n\r\n  let curChild = node.firstChild as HTMLElement;\r\n  while(curChild) {\r\n    getRichElementValue(curChild, lines, line, selNode, selOffset, entities, offset);\r\n    curChild = curChild.nextSibling as any;\r\n  }\r\n\r\n  if(isSelected && selOffset) {\r\n    line.push('\\x01');\r\n  }\r\n\r\n  if(isTableCell && node.nextSibling) {\r\n    line.push(' ');\r\n    ++offset.offset;\r\n\r\n    // * combine entities such as url after adding space\r\n    if(wasEntitiesLength !== undefined) {\r\n      for(let i = wasEntitiesLength, length = entities.length; i < length; ++i) {\r\n        ++entities[i].length;\r\n      }\r\n    }\r\n  }\r\n\r\n  const wasLength = line.length;\r\n  if(isBlock && wasLength) {\r\n    lines.push(line.join(''));\r\n    line.splice(0, wasLength);\r\n    ++offset.offset;\r\n  }\r\n\r\n  if(wasLength && node.tagName === 'P' && node.nextSibling) {\r\n    lines.push('');\r\n    ++offset.offset;\r\n  }\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n *\r\n * Originally from:\r\n * https://github.com/zhukov/webogram\r\n * Copyright (C) 2014 Igor Zhukov <igor.beatle@gmail.com>\r\n * https://github.com/zhukov/webogram/blob/master/LICENSE\r\n */\r\n\r\nimport {MOUNT_CLASS_TO} from '../../config/debug';\r\nimport {MessageEntity} from '../../layer';\r\nimport combineSameEntities from '../../lib/richTextProcessor/combineSameEntities';\r\nimport sortEntities from '../../lib/richTextProcessor/sortEntities';\r\nimport getRichElementValue from './getRichElementValue';\r\n\r\nexport default function getRichValue(field: HTMLElement, withEntities = true) {\r\n  const lines: string[] = [];\r\n  const line: string[] = [];\r\n\r\n  const entities: MessageEntity[] = withEntities ? [] : undefined;\r\n  getRichElementValue(field, lines, line, undefined, undefined, entities);\r\n  if(line.length) {\r\n    lines.push(line.join(''));\r\n  }\r\n\r\n  let value = lines.join('\\n');\r\n  value = value.replace(/\\u00A0/g, ' ');\r\n\r\n  if(entities?.length) {\r\n    // ! cannot do that here because have the same check before the sending in RichTextProcessor.parseMarkdown\r\n    /* const entity = entities[entities.length - 1];\r\n    const length = value.length;\r\n    const trimmedLength = value.trimRight().length;\r\n    if(length !== trimmedLength) {\r\n      entity.length -= length - trimmedLength;\r\n    } */\r\n\r\n    combineSameEntities(entities);\r\n    sortEntities(entities);\r\n  }\r\n\r\n  // console.log('getRichValue:', value, entities);\r\n\r\n  return {value, entities};\r\n}\r\n\r\nMOUNT_CLASS_TO.getRichValue = getRichValue;\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nexport default function getVisibleRect(\r\n  element: HTMLElement,\r\n  overflowElement: HTMLElement,\r\n  lookForSticky?: boolean,\r\n  rect = element.getBoundingClientRect(),\r\n  overflowRect = overflowElement.getBoundingClientRect()\r\n) {\r\n  let {top: overflowTop, right: overflowRight, bottom: overflowBottom, left: overflowLeft} = overflowRect;\r\n\r\n  // * respect sticky headers\r\n  if(lookForSticky) {\r\n    const sticky = overflowElement.querySelector('.sticky');\r\n    if(sticky) {\r\n      const stickyRect = sticky.getBoundingClientRect();\r\n      overflowTop = stickyRect.bottom;\r\n    }\r\n  }\r\n\r\n  if(rect.top >= overflowBottom ||\r\n    rect.bottom <= overflowTop ||\r\n    rect.right <= overflowLeft ||\r\n    rect.left >= overflowRight) {\r\n    return null;\r\n  }\r\n\r\n  const overflow = {\r\n    top: false,\r\n    right: false,\r\n    bottom: false,\r\n    left: false,\r\n    vertical: 0 as 0 | 1 | 2,\r\n    horizontal: 0 as 0 | 1 | 2\r\n  };\r\n\r\n  // @ts-ignore\r\n  const w: any = 'visualViewport' in window ? window.visualViewport : window;\r\n  const windowWidth = w.width || w.innerWidth;\r\n  const windowHeight = w.height || w.innerHeight;\r\n\r\n  return {\r\n    rect: {\r\n      top: rect.top < overflowTop && overflowTop !== 0 ? (overflow.top = true, ++overflow.vertical, overflowTop) : rect.top,\r\n      right: rect.right > overflowRight && overflowRight !== windowWidth ? (overflow.right = true, ++overflow.horizontal, overflowRight) : rect.right,\r\n      bottom: rect.bottom > overflowBottom && overflowBottom !== windowHeight ? (overflow.bottom = true, ++overflow.vertical, overflowBottom) : rect.bottom,\r\n      left: rect.left < overflowLeft && overflowLeft !== 0 ? (overflow.left = true, ++overflow.horizontal, overflowLeft) : rect.left\r\n    },\r\n    overflow\r\n  };\r\n}\r\n\r\n(window as any).getVisibleRect = getVisibleRect;\r\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport SwipeHandler, {SwipeHandlerOptions} from '../../components/swipeHandler';\nimport cancelEvent from './cancelEvent';\nimport findUpClassName from './findUpClassName';\nimport isSwipingBackSafari from './isSwipingBackSafari';\n\nexport type SwipeHandlerHorizontalOptions = SwipeHandlerOptions & {\n  // xThreshold?: number\n};\n\nexport default function handleHorizontalSwipe(options: SwipeHandlerHorizontalOptions) {\n  let cancelY = false;\n  return new SwipeHandler({\n    ...options,\n    verifyTouchTarget: (e) => {\n      return !findUpClassName(e.target, 'progress-line') &&\n        !isSwipingBackSafari(e) &&\n        (options.verifyTouchTarget ? options.verifyTouchTarget(e) : true);\n    },\n    onSwipe: (xDiff, yDiff, e) => {\n      if(!cancelY && Math.abs(yDiff) > 20) {\n        return true;\n      }\n\n      if(Math.abs(xDiff) > Math.abs(yDiff)) {\n        cancelEvent(e);\n        cancelY = true;\n      } else if(!cancelY && Math.abs(yDiff) > Math.abs(xDiff)/*  || Math.abs(yDiff) > 20 */) {\n        return true;\n      }\n\n      /* if(!cancelY && options.xThreshold !== undefined && xDiff >= options.xThreshold) {\n        cancelY = true;\n      } */\n\n      return options.onSwipe(xDiff, yDiff, e);\n    },\n    onReset: () => {\n      cancelY = false;\n      options.onReset && options.onReset();\n    },\n    cancelEvent: false // cannot use cancelEvent on Safari iOS because scroll will be canceled too\n  });\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport {cancelContextMenuOpening} from './attachContextMenuListener';\nimport handleHorizontalSwipe, {SwipeHandlerHorizontalOptions} from './handleHorizontalSwipe';\n\nexport default function handleTabSwipe(options: SwipeHandlerHorizontalOptions) {\n  return handleHorizontalSwipe({\n    ...options,\n    onSwipe: (xDiff, yDiff, e) => {\n      if(Math.abs(xDiff) > 50) {\n        options.onSwipe(xDiff, yDiff, e);\n        cancelContextMenuOpening();\n\n        return true;\n      }\n    }\n  });\n}\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nexport default function htmlToDocumentFragment(html: string | DocumentFragment) {\r\n  if(html instanceof DocumentFragment) return html;\r\n  const template = document.createElement('template');\r\n  html = html.trim(); // Never return a text node of whitespace as the result\r\n  template.innerHTML = html;\r\n  return template.content;\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nexport default function htmlToSpan(html: string | DocumentFragment) {\r\n  const span = document.createElement('span');\r\n  if(typeof(html) === 'string') span.innerHTML = html;\r\n  else span.append(html);\r\n  return span;\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n *\r\n * Originally from:\r\n * https://github.com/zhukov/webogram\r\n * Copyright (C) 2014 Igor Zhukov <igor.beatle@gmail.com>\r\n * https://github.com/zhukov/webogram/blob/master/LICENSE\r\n */\r\n\r\n/* export function isInDOM(element: Element, parentNode?: HTMLElement): boolean {\r\n  if(!element) {\r\n    return false;\r\n  }\r\n\r\n  parentNode = parentNode || document.body;\r\n  if(element === parentNode) {\r\n    return true;\r\n  }\r\n  return isInDOM(element.parentNode as HTMLElement, parentNode);\r\n} */\r\nexport default function isInDOM(element: Element): boolean {\r\n  return element?.isConnected;\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport getRichValue from './getRichValue';\r\n\r\nexport default function isInputEmpty(element: HTMLElement) {\r\n  if(element.hasAttribute('contenteditable') || element.tagName !== 'INPUT') {\r\n    /* const value = element.innerText;\r\n\r\n    return !value.trim() && !serializeNodes(Array.from(element.childNodes)).trim(); */\r\n    return !getRichValue(element, false).value.trim();\r\n  } else {\r\n    return !(element as HTMLInputElement).value.trim();\r\n  }\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport rootScope from '../../lib/rootScope';\r\nimport {IS_MOBILE, IS_APPLE} from '../../environment/userAgent';\r\n\r\nexport default function isSendShortcutPressed(e: KeyboardEvent) {\r\n  if(e.key === 'Enter' && !IS_MOBILE && !e.isComposing) {\r\n    /* if(e.ctrlKey || e.metaKey) {\r\n      this.messageInput.innerHTML += '<br>';\r\n      placeCaretAtEnd(this.message)\r\n      return;\r\n    } */\r\n\r\n    if(rootScope.settings.sendShortcut === 'enter') {\r\n      if(e.shiftKey || e.ctrlKey || e.metaKey) {\r\n        return;\r\n      }\r\n\r\n      return true;\r\n    } else {\r\n      const secondaryKey = IS_APPLE ? e.metaKey : e.ctrlKey;\r\n      if(e.shiftKey || (IS_APPLE ? e.ctrlKey : e.metaKey)) {\r\n        return;\r\n      }\r\n\r\n      if(secondaryKey) {\r\n        return true;\r\n      }\r\n    }\r\n  }\r\n\r\n  return false;\r\n}\r\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport {IS_MOBILE_SAFARI} from '../../environment/userAgent';\n\nexport default function isSwipingBackSafari(e: TouchEvent | MouseEvent) {\n  return IS_MOBILE_SAFARI && e instanceof TouchEvent && e.touches[0].clientX < 30;\n}\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n *\r\n * Originally from:\r\n * https://github.com/zhukov/webogram\r\n * Copyright (C) 2014 Igor Zhukov <igor.beatle@gmail.com>\r\n * https://github.com/zhukov/webogram/blob/master/LICENSE\r\n */\r\n\r\nimport IS_TOUCH_SUPPORTED from '../../environment/touchSupport';\r\n\r\nexport default function placeCaretAtEnd(el: HTMLElement, ignoreTouchCheck = false) {\r\n  if(IS_TOUCH_SUPPORTED && (!ignoreTouchCheck || document.activeElement !== el)) {\r\n    return;\r\n  }\r\n\r\n  el.focus();\r\n  if(el instanceof HTMLInputElement) {\r\n    const length = el.value.length;\r\n    el.selectionStart = length;\r\n    el.selectionEnd = length;\r\n  } else if(typeof window.getSelection !== 'undefined' && typeof document.createRange !== 'undefined') {\r\n    var range = document.createRange();\r\n    range.selectNodeContents(el);\r\n    range.collapse(false);\r\n    var sel = window.getSelection();\r\n    sel.removeAllRanges();\r\n    sel.addRange(range);\r\n    // @ts-ignore\r\n  } else if(typeof document.body.createTextRange !== 'undefined') {\r\n    // @ts-ignore\r\n    var textRange = document.body.createTextRange();\r\n    textRange.moveToElementText(el);\r\n    textRange.collapse(false);\r\n    textRange.select();\r\n  }\r\n}\r\n\r\n(window as any).placeCaretAtEnd = placeCaretAtEnd;\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport whichChild from './whichChild';\r\n\r\nexport default function positionElementByIndex(element: HTMLElement, container: HTMLElement, pos: number, prevPos?: number) {\r\n  if(prevPos === undefined) {\r\n    prevPos = element.parentElement === container ? whichChild(element) : -1;\r\n  }\r\n\r\n  if(prevPos === pos) {\r\n    return false;\r\n  } else if(prevPos !== -1 && prevPos < pos) { // was higher\r\n    pos += 1;\r\n  }\r\n\r\n  if(!pos) {\r\n    container.prepend(element);\r\n  } else if(container.childElementCount > pos) {\r\n    container.insertBefore(element, container.children[pos]);\r\n  } else {\r\n    container.append(element);\r\n  }\r\n\r\n  return true;\r\n}\r\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport onMediaLoad from '../onMediaLoad';\n\n// import { getHeavyAnimationPromise } from \"../../hooks/useHeavyAnimationCheck\";\n\nexport const loadedURLs: {[url: string]: boolean} = {};\nconst set = (elem: HTMLElement | HTMLImageElement | SVGImageElement | HTMLVideoElement, url: string) => {\n  if(elem instanceof HTMLImageElement || elem instanceof HTMLVideoElement) elem.src = url;\n  else if(elem instanceof SVGImageElement) elem.setAttributeNS(null, 'href', url);\n  else elem.style.backgroundImage = 'url(' + url + ')';\n};\n\n//    ,      ,    blob',      'load'  .\nexport default function renderImageFromUrl(\n  elem: HTMLElement | HTMLImageElement | SVGImageElement | HTMLVideoElement,\n  url: string,\n  callback?: () => void,\n  useCache = true\n) {\n  if(!url) {\n    console.error('renderImageFromUrl: no url?', elem, url);\n    callback?.();\n    return;\n  }\n\n  const isVideo = elem instanceof HTMLVideoElement;\n  if(((loadedURLs[url]/*  && false */) && useCache) || isVideo) {\n    if(elem) {\n      set(elem, url);\n    }\n\n    if(callback) {\n      if(isVideo) {\n        onMediaLoad(elem).then(callback);\n      } else {\n        callback?.();\n      }\n      // callback && getHeavyAnimationPromise().then(() => callback());\n    }\n  } else {\n    const isImage = elem instanceof HTMLImageElement;\n    const loader = isImage ? elem as HTMLImageElement : new Image();\n    // const loader = new Image();\n    loader.src = url;\n    // let perf = performance.now();\n    loader.addEventListener('load', () => {\n      if(!isImage && elem) {\n        set(elem, url);\n      }\n\n      loadedURLs[url] = true;\n      // console.log('onload:', url, performance.now() - perf);\n      // TODO:      ,       \n      // callback && getHeavyAnimationPromise().then(() => callback());\n      callback?.();\n    }, {once: true});\n\n    if(callback) {\n      loader.addEventListener('error', (err) => {\n        console.error('Render image from url failed:', err, url, loader);\n        callback();\n      });\n    }\n  }\n}\n\nexport function renderImageFromUrlPromise(elem: Parameters<typeof renderImageFromUrl>[0], url: string, useCache?: boolean) {\n  return new Promise<void>((resolve) => {\n    renderImageFromUrl(elem, url, resolve, useCache);\n  });\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport sequentialDom from '../sequentialDom';\nimport {renderImageFromUrlPromise} from './renderImageFromUrl';\n\nexport default function renderMediaWithFadeIn(\n  container: HTMLElement,\n  media: Parameters<typeof renderImageFromUrlPromise>[0],\n  url: string,\n  needFadeIn: boolean,\n  aspecter = container,\n  thumbImage?: HTMLElement\n) {\n  if(needFadeIn) {\n    media.classList.add('fade-in');\n  }\n\n  const promise = renderImageFromUrlPromise(media, url).then(() => {\n    return sequentialDom.mutateElement(container, () => {\n      aspecter.append(media);\n\n      if(needFadeIn) {\n        media.addEventListener('animationend', () => {\n          sequentialDom.mutate(() => {\n            media.classList.remove('fade-in');\n            thumbImage?.remove();\n          });\n        }, {once: true});\n      } else {\n        thumbImage?.remove();\n      }\n    });\n  });\n\n  // recordPromise(promise, 'renderImageWithFadeIn');\n\n  return promise;\n}\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nexport default function replaceContent(elem: HTMLElement, node: string | Node) {\r\n  if(typeof(node) === 'string') {\r\n    elem.innerHTML = node;\r\n    return;\r\n  }\r\n\r\n  // * children.length doesn't count text nodes\r\n  const firstChild = elem.firstChild;\r\n  if(firstChild) {\r\n    if(elem.lastChild === firstChild) {\r\n      firstChild.replaceWith(node);\r\n    } else {\r\n      elem.textContent = '';\r\n      elem.append(node);\r\n    }\r\n  } else {\r\n    elem.append(node);\r\n  }\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nexport default function setInnerHTML(elem: Element, html: string | DocumentFragment) {\r\n  elem.setAttribute('dir', 'auto');\r\n  if(typeof(html) === 'string') {\r\n    if(!html) elem.textContent = '';\r\n    else elem.innerHTML = html;\r\n  } else {\r\n    elem.textContent = '';\r\n    elem.append(html);\r\n  }\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nexport default function toggleDisability(elements: HTMLElement[], disable: boolean): () => void {\r\n  if(disable) {\r\n    elements.forEach((el) => el.setAttribute('disabled', 'true'));\r\n  } else {\r\n    elements.forEach((el) => el.removeAttribute('disabled'));\r\n  }\r\n\r\n  return () => toggleDisability(elements, !disable);\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nexport default function whichChild(elem: Node) {\r\n  if(!elem.parentNode) {\r\n    return -1;\r\n  }\r\n\r\n  let i = 0;\r\n  // @ts-ignore\r\n  while((elem = elem.previousElementSibling) !== null) ++i;\r\n  return i;\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport {attachClickEvent} from './dom/clickEvent';\r\nimport findUpAsChild from './dom/findUpAsChild';\r\nimport EventListenerBase from './eventListenerBase';\r\nimport ListenerSetter from './listenerSetter';\r\nimport IS_TOUCH_SUPPORTED from '../environment/touchSupport';\r\nimport safeAssign from './object/safeAssign';\r\n\r\nconst KEEP_OPEN = false;\r\nconst TOGGLE_TIMEOUT = 200;\r\nconst ANIMATION_DURATION = 200;\r\n\r\nexport default class DropdownHover extends EventListenerBase<{\r\n  open: () => Promise<any> | void,\r\n  opened: () => any,\r\n  close: () => any,\r\n  closed: () => any\r\n}> {\r\n  protected element: HTMLElement;\r\n  protected displayTimeout: number;\r\n  protected forceClose = false;\r\n  protected inited = false;\r\n  protected ignoreMouseOut = false;\r\n\r\n  constructor(options: {\r\n    element: DropdownHover['element']\r\n  }) {\r\n    super(false);\r\n    safeAssign(this, options);\r\n  }\r\n\r\n  public attachButtonListener(button: HTMLElement, listenerSetter: ListenerSetter) {\r\n    let firstTime = true;\r\n    if(IS_TOUCH_SUPPORTED) {\r\n      attachClickEvent(button, () => {\r\n        if(firstTime) {\r\n          firstTime = false;\r\n          this.toggle(true);\r\n        } else {\r\n          this.toggle();\r\n        }\r\n      }, {listenerSetter});\r\n    } else {\r\n      listenerSetter.add(button)('mouseover', (e) => {\r\n        // console.log('onmouseover button');\r\n        if(firstTime) {\r\n          listenerSetter.add(button)('mouseout', (e) => {\r\n            clearTimeout(this.displayTimeout);\r\n            this.onMouseOut(e);\r\n          });\r\n          firstTime = false;\r\n        }\r\n\r\n        clearTimeout(this.displayTimeout);\r\n        this.displayTimeout = window.setTimeout(() => {\r\n          this.toggle(true);\r\n        }, TOGGLE_TIMEOUT);\r\n      });\r\n    }\r\n  }\r\n\r\n  protected onMouseOut = (e: MouseEvent) => {\r\n    if(KEEP_OPEN || !this.isActive()) return;\r\n    clearTimeout(this.displayTimeout);\r\n\r\n    if(this.ignoreMouseOut) {\r\n      return;\r\n    }\r\n\r\n    const toElement = (e as any).toElement as HTMLElement;\r\n    if(toElement && findUpAsChild(toElement, this.element)) {\r\n      return;\r\n    }\r\n\r\n    this.displayTimeout = window.setTimeout(() => {\r\n      this.toggle(false);\r\n    }, TOGGLE_TIMEOUT);\r\n  };\r\n\r\n  protected init() {\r\n    if(!IS_TOUCH_SUPPORTED) {\r\n      this.element.onmouseout = this.onMouseOut;\r\n      this.element.onmouseover = (e) => {\r\n        if(this.forceClose) {\r\n          return;\r\n        }\r\n\r\n        // console.log('onmouseover element');\r\n        clearTimeout(this.displayTimeout);\r\n      };\r\n    }\r\n  }\r\n\r\n  public toggle = async(enable?: boolean) => {\r\n    // if(!this.element) return;\r\n    const willBeActive = (!!this.element.style.display && enable === undefined) || enable;\r\n    if(this.init) {\r\n      if(willBeActive) {\r\n        this.init();\r\n        this.init = null;\r\n      } else {\r\n        return;\r\n      }\r\n    }\r\n\r\n    if(willBeActive === this.isActive()) {\r\n      return;\r\n    }\r\n\r\n    if((this.element.style.display && enable === undefined) || enable) {\r\n      const res = this.dispatchResultableEvent('open');\r\n      await Promise.all(res);\r\n\r\n      this.element.style.display = '';\r\n      void this.element.offsetLeft; // reflow\r\n      this.element.classList.add('active');\r\n\r\n      clearTimeout(this.displayTimeout);\r\n      this.displayTimeout = window.setTimeout(() => {\r\n        this.forceClose = false;\r\n        this.dispatchEvent('opened');\r\n      }, IS_TOUCH_SUPPORTED ? 0 : ANIMATION_DURATION);\r\n\r\n      // ! can't use together with resizeObserver\r\n      /* if(isTouchSupported) {\r\n        const height = this.element.scrollHeight + appImManager.chat.input.inputContainer.scrollHeight - 10;\r\n        console.log('[ESG]: toggle: enable height', height);\r\n        appImManager.chat.bubbles.scrollable.scrollTop += height;\r\n      } */\r\n\r\n      /* if(touchSupport) {\r\n        this.restoreScroll();\r\n      } */\r\n    } else {\r\n      this.dispatchEvent('close');\r\n\r\n      this.element.classList.remove('active');\r\n\r\n      clearTimeout(this.displayTimeout);\r\n      this.displayTimeout = window.setTimeout(() => {\r\n        this.element.style.display = 'none';\r\n        this.forceClose = false;\r\n        this.dispatchEvent('closed');\r\n      }, IS_TOUCH_SUPPORTED ? 0 : ANIMATION_DURATION);\r\n\r\n      /* if(isTouchSupported) {\r\n        const scrollHeight = this.container.scrollHeight;\r\n        if(scrollHeight) {\r\n          const height = this.container.scrollHeight + appImManager.chat.input.inputContainer.scrollHeight - 10;\r\n          appImManager.chat.bubbles.scrollable.scrollTop -= height;\r\n        }\r\n      } */\r\n\r\n      /* if(touchSupport) {\r\n        this.restoreScroll();\r\n      } */\r\n    }\r\n\r\n    // animationIntersector.checkAnimations(false, EMOTICONSSTICKERGROUP);\r\n  };\r\n\r\n  public isActive() {\r\n    return this.element.classList.contains('active');\r\n  }\r\n\r\n  public setIgnoreMouseOut(ignore: boolean) {\r\n    this.ignoreMouseOut = ignore;\r\n  }\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\n// * Jolly Cobra's fastSmoothScroll slightly patched\r\n\r\nimport {dispatchHeavyAnimationEvent} from '../hooks/useHeavyAnimationCheck';\r\nimport {fastRaf, fastRafPromise} from './schedulers';\r\nimport {animateSingle, cancelAnimationByKey} from './animation';\r\nimport rootScope from '../lib/rootScope';\r\nimport isInDOM from './dom/isInDOM';\r\n\r\nconst MIN_JS_DURATION = 250;\r\nconst MAX_JS_DURATION = 600;\r\nconst LONG_TRANSITION_MAX_DISTANCE = 1500;\r\nconst SHORT_TRANSITION_MAX_DISTANCE = 500;\r\n\r\nexport enum FocusDirection {\r\n  Up,\r\n  Down,\r\n  Static,\r\n};\r\n\r\nexport type ScrollGetNormalSizeCallback = (options: {rect: DOMRect}) => number;\r\nexport type ScrollStartCallbackDimensions = {\r\n  scrollSize: number,\r\n  scrollPosition: number,\r\n  distanceToEnd: number,\r\n  path: number,\r\n  duration: number,\r\n  containerRect: DOMRect,\r\n  elementRect: DOMRect,\r\n};\r\n\r\nexport type ScrollOptions = {\r\n  container: HTMLElement,\r\n  element: HTMLElement,\r\n  position: ScrollLogicalPosition,\r\n  margin?: number,\r\n  maxDistance?: number,\r\n  forceDirection?: FocusDirection,\r\n  forceDuration?: number,\r\n  axis?: 'x' | 'y',\r\n  getNormalSize?: ScrollGetNormalSizeCallback,\r\n  fallbackToElementStartWhenCentering?: HTMLElement,\r\n  startCallback?: (dimensions: ScrollStartCallbackDimensions) => void\r\n};\r\n\r\nexport default function fastSmoothScroll(options: ScrollOptions) {\r\n  if(options.margin === undefined) {\r\n    options.margin = 0;\r\n  }\r\n\r\n  if(options.maxDistance === undefined) {\r\n    options.maxDistance = LONG_TRANSITION_MAX_DISTANCE;\r\n  }\r\n\r\n  if(options.axis === undefined) {\r\n    options.axis = 'y';\r\n  }\r\n  // return;\r\n\r\n  if(!rootScope.settings.animationsEnabled) {\r\n    options.forceDirection = FocusDirection.Static;\r\n  }\r\n\r\n  if(options.forceDirection === FocusDirection.Static) {\r\n    options.forceDuration = 0;\r\n    return scrollWithJs(options);\r\n    /* return Promise.resolve();\r\n\r\n    element.scrollIntoView({ block: position });\r\n\r\n    cancelAnimationByKey(container);\r\n    return Promise.resolve(); */\r\n  }\r\n\r\n  const promise = fastRafPromise().then(() => scrollWithJs(options));\r\n\r\n  return options.axis === 'y' ? dispatchHeavyAnimationEvent(promise) : promise;\r\n}\r\n\r\nfunction scrollWithJs(options: ScrollOptions): Promise<void> {\r\n  const {element, container, getNormalSize, axis, margin, position, forceDirection, maxDistance, forceDuration} = options;\r\n  if(!isInDOM(element)) {\r\n    cancelAnimationByKey(container);\r\n    return Promise.resolve();\r\n  }\r\n\r\n  const rectStartKey = axis === 'y' ? 'top' : 'left';\r\n  const rectEndKey = axis === 'y' ? 'bottom' : 'right';\r\n  const sizeKey = axis === 'y' ? 'height' : 'width';\r\n  const scrollSizeKey = axis === 'y' ? 'scrollHeight' : 'scrollWidth';\r\n  const scrollPositionKey = axis === 'y' ? 'scrollTop' : 'scrollLeft';\r\n\r\n  // const { offsetTop: elementTop, offsetHeight: elementHeight } = element;\r\n  const elementRect = element.getBoundingClientRect();\r\n  const containerRect = container.getBoundingClientRect ? container.getBoundingClientRect() : document.body.getBoundingClientRect();\r\n\r\n  // const transformable = container.firstElementChild as HTMLElement;\r\n\r\n  const elementPosition = elementRect[rectStartKey] - containerRect[rectStartKey];\r\n  const elementSize = element[scrollSizeKey]; // margin is exclusive in DOMRect\r\n\r\n  const containerSize = getNormalSize ? getNormalSize({rect: containerRect}) : containerRect[sizeKey];\r\n\r\n  let scrollPosition = container[scrollPositionKey];\r\n  const scrollSize = container[scrollSizeKey];\r\n  /* const elementPosition = element.offsetTop;\r\n  const elementSize = element.offsetHeight;\r\n\r\n  const scrollPosition = container[scrollPositionKey];\r\n  const scrollSize = container[scrollSizeKey];\r\n  const containerSize = container.offsetHeight; */\r\n\r\n  let path!: number;\r\n\r\n  switch(position) {\r\n    case 'start':\r\n      path = elementPosition - margin;\r\n      break;\r\n    case 'end':\r\n      path = elementRect[rectEndKey] /* + (elementSize - elementRect[sizeKey]) */ - containerRect[rectEndKey] + margin;\r\n      break;\r\n    // 'nearest' is not supported yet\r\n    case 'nearest':\r\n    case 'center':\r\n      if(elementSize < containerSize) {\r\n        path = (elementPosition + elementSize / 2) - (containerSize / 2);\r\n      } else {\r\n        if(options.fallbackToElementStartWhenCentering && options.fallbackToElementStartWhenCentering !== element) {\r\n          options.element = options.fallbackToElementStartWhenCentering;\r\n          options.position = 'start';\r\n          return scrollWithJs(options);\r\n        }\r\n\r\n        path = elementPosition - margin;\r\n      }\r\n\r\n      break;\r\n  }\r\n  /* switch (position) {\r\n    case 'start':\r\n      path = (elementPosition - margin) - scrollPosition;\r\n      break;\r\n    case 'end':\r\n      path = (elementPosition + elementSize + margin) - (scrollPosition + containerSize);\r\n      break;\r\n    // 'nearest' is not supported yet\r\n    case 'nearest':\r\n    case 'center':\r\n      path = elementSize < containerSize\r\n        ? (elementPosition + elementSize / 2) - (scrollPosition + containerSize / 2)\r\n        : (elementPosition - margin) - scrollPosition;\r\n      break;\r\n  } */\r\n\r\n  if(Math.abs(path - (margin || 0)) < 1) {\r\n    cancelAnimationByKey(container);\r\n    return Promise.resolve();\r\n  }\r\n\r\n  if(axis === 'y') {\r\n    if(forceDirection === undefined) {\r\n      if(path > maxDistance) {\r\n        scrollPosition = container.scrollTop += path - maxDistance;\r\n        path = maxDistance;\r\n      } else if(path < -maxDistance) {\r\n        scrollPosition = container.scrollTop += path + maxDistance;\r\n        path = -maxDistance;\r\n      }\r\n    }/*  else if(forceDirection === FocusDirection.Up) { // * not tested yet\r\n      container.scrollTop = offsetTop + container.scrollTop + maxDistance;\r\n    } else if(forceDirection === FocusDirection.Down) { // * not tested yet\r\n      container.scrollTop = Math.max(0, offsetTop + container.scrollTop - maxDistance);\r\n    } */\r\n  }\r\n\r\n  // console.log('scrollWithJs: will scroll path:', path, element);\r\n\r\n  /* let existsTransform = 0;\r\n  const currentTransform = transformable.style.transform;\r\n  if(currentTransform) {\r\n    existsTransform = parseInt(currentTransform.match(/\\((.+?), (.+?), .+\\)/)[2]);\r\n    //path += existsTransform;\r\n  } */\r\n\r\n  if(path < 0) {\r\n    const remainingPath = -scrollPosition;\r\n    path = Math.max(path, remainingPath);\r\n  } else if(path > 0) {\r\n    const remainingPath = scrollSize - (scrollPosition + containerSize);\r\n    path = Math.min(path, remainingPath);\r\n  }\r\n\r\n  const target = container[scrollPositionKey] + path;\r\n  const absPath = Math.abs(path);\r\n  const duration = forceDuration ?? (\r\n    MIN_JS_DURATION + (absPath / LONG_TRANSITION_MAX_DISTANCE) * (MAX_JS_DURATION - MIN_JS_DURATION)\r\n  );\r\n  const startAt = Date.now();\r\n\r\n  /* transformable.classList.add('no-transition');\r\n\r\n  const tickTransform = () => {\r\n    const t = duration ? Math.min((Date.now() - startAt) / duration, 1) : 1;\r\n    const currentPath = path * transition(t);\r\n\r\n    transformable.style.transform = `translate3d(0, ${-currentPath}px, 0)`;\r\n    container.dataset.translate = '' + -currentPath;\r\n\r\n    const willContinue = t < 1;\r\n    if(!willContinue) {\r\n      fastRaf(() => {\r\n        delete container.dataset.transform;\r\n        container.dataset.transform = '';\r\n        transformable.style.transform = '';\r\n        void transformable.offsetLeft; // reflow\r\n        transformable.classList.remove('no-transition');\r\n        void transformable.offsetLeft; // reflow\r\n        container[scrollPositionKey] = Math.round(target);\r\n      });\r\n    }\r\n\r\n    return willContinue;\r\n  };\r\n\r\n  return animateSingle(tickTransform, container); */\r\n\r\n  /* return new Promise((resolve) => {\r\n    fastRaf(() => {\r\n      transformable.style.transform = '';\r\n      transformable.style.transition = '';\r\n\r\n      setTimeout(resolve, duration);\r\n    });\r\n  });\r\n\r\n  const transformableHeight = transformable.scrollHeight;\r\n  //transformable.style.minHeight = `${transformableHeight}px`;\r\n  */\r\n\r\n  const transition = absPath < SHORT_TRANSITION_MAX_DISTANCE ? shortTransition : longTransition;\r\n  const tick = () => {\r\n    const t = duration ? Math.min((Date.now() - startAt) / duration, 1) : 1;\r\n\r\n    const currentPath = path * (1 - transition(t));\r\n    container[scrollPositionKey] = Math.round(target - currentPath);\r\n\r\n    return t < 1;\r\n  };\r\n\r\n  if(!duration || !path) {\r\n    cancelAnimationByKey(container);\r\n    tick();\r\n    return Promise.resolve();\r\n  }\r\n\r\n  /* return new Promise((resolve) => {\r\n    setTimeout(resolve, duration);\r\n  }).then(() => {\r\n    transformable.classList.add('no-transition');\r\n    void transformable.offsetLeft; // reflow\r\n    transformable.style.transform = '';\r\n    transformable.style.transition = '';\r\n    void transformable.offsetLeft; // reflow\r\n    transformable.classList.remove('no-transition');\r\n    void transformable.offsetLeft; // reflow\r\n    fastRaf(() => {\r\n\r\n      container[scrollPositionKey] = Math.round(target);\r\n      //transformable.style.minHeight = ``;\r\n    });\r\n\r\n  }); */\r\n\r\n  if(options.startCallback) {\r\n    const distanceToEnd = scrollSize - Math.round(target + container[axis === 'y' ? 'offsetHeight' : 'offsetWidth']);\r\n    options.startCallback({\r\n      scrollSize,\r\n      scrollPosition,\r\n      distanceToEnd,\r\n      path,\r\n      duration,\r\n      containerRect,\r\n      elementRect\r\n    });\r\n  }\r\n\r\n  return animateSingle(tick, container);\r\n}\r\n\r\nfunction longTransition(t: number) {\r\n  return 1 - ((1 - t) ** 5);\r\n}\r\n\r\nfunction shortTransition(t: number) {\r\n  return 1 - ((1 - t) ** 3.5);\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport type {InputFileLocation, InputStickerSet, InputWebFileLocation} from '../layer';\r\nimport type {DownloadOptions} from '../lib/mtproto/apiFileManager';\r\n\r\nconst FILENAME_JOINER = '_';\r\n\r\nexport function getFileNameByLocation(location: InputFileLocation | InputWebFileLocation, options?: Partial<{\r\n  fileName: string,\r\n  downloadId: string\r\n}>) {\r\n  const fileName = '';// (options?.fileName || '').split('.');\r\n  const ext = fileName[fileName.length - 1] || '';\r\n\r\n  let str: string;\r\n  switch(location._) {\r\n    case 'inputPhotoFileLocation': {\r\n      str = ['photo', fileName[0], location.id, location.thumb_size].filter(Boolean).join(FILENAME_JOINER);\r\n      break;\r\n    }\r\n\r\n    case 'inputDocumentFileLocation': {\r\n      str = ['document', fileName[0], location.id, location.thumb_size].filter(Boolean).join(FILENAME_JOINER);\r\n      break;\r\n    }\r\n\r\n    case 'inputPeerPhotoFileLocation':\r\n      str = ['peerPhoto', location.photo_id, location.pFlags.big ? 'big' : 'small'].join(FILENAME_JOINER);\r\n      break;\r\n\r\n    case 'inputStickerSetThumb': {\r\n      const id = (location.stickerset as InputStickerSet.inputStickerSetID).id ||\r\n        (location.stickerset as InputStickerSet.inputStickerSetShortName).short_name ||\r\n        (location.stickerset as InputStickerSet.inputStickerSetDice).emoticon ||\r\n        location.stickerset._;\r\n      str = ['stickerSetThumb', id, location.thumb_version].join(FILENAME_JOINER);\r\n      break;\r\n    }\r\n\r\n    case 'inputFileLocation': {\r\n      str = location.volume_id + '_' + location.local_id;\r\n      break;\r\n    }\r\n\r\n    case 'inputWebFileLocation': {\r\n      str = ['webFile', location.url].join(FILENAME_JOINER);\r\n      break;\r\n    }\r\n\r\n    default: {\r\n      console.error('Unrecognized location:', location);\r\n      str = '';\r\n      break;\r\n    }\r\n  }\r\n\r\n  return str + (options?.downloadId ? '_download' : '') + (ext ? '.' + ext : ext);\r\n}\r\n\r\nexport type FileURLType = 'photo' | 'thumb' | 'document' | 'stream' | 'download';\r\nexport function getFileURL(type: FileURLType, options: DownloadOptions) {\r\n  // console.log('getFileURL', location);\r\n  // const perf = performance.now();\r\n  const encoded = encodeURIComponent(JSON.stringify(options));\r\n  // console.log('getFileURL encode:', performance.now() - perf, encoded);\r\n\r\n  return /* '/' +  */type + '/' + encoded;\r\n}\r\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport type {Message, MessageAction} from '../layer';\nimport type {MyMessage} from '../lib/appManagers/appMessagesManager';\nimport forEachReverse from './array/forEachReverse';\n\nexport default function filterChatPhotosMessages(value: {\n  count: number;\n  next_rate: number;\n  offset_id_offset: number;\n  history: MyMessage[];\n}) {\n  forEachReverse(value.history, (message, idx, arr) => {\n    if(!((message as Message.messageService).action as MessageAction.messageActionChatEditPhoto).photo) {\n      arr.splice(idx, 1);\n      if(value.count !== undefined) {\n        --value.count;\n      }\n    }\n  });\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport {i18n, LangPackKey} from '../lib/langPack';\n\nexport default function formatBytes(bytes: number, decimals: number | 'auto' = 'auto') {\n  if(bytes === 0) return i18n('FileSize.B', [0]);\n\n  const strictDecimals = decimals === 'auto';\n\n  const k = 1024;\n  const i = Math.floor(Math.log(bytes) / Math.log(k));\n  const _decimals = decimals === 'auto' ? Math.max(0, i - 1) : decimals;\n\n  const dm = Math.max(0, _decimals);\n  const sizes: LangPackKey[] = ['FileSize.B', 'FileSize.KB', 'FileSize.MB', 'FileSize.GB'];\n\n  const fixed = (bytes / Math.pow(k, i)).toFixed(dm);\n  return i18n(sizes[i], [strictDecimals ? fixed : parseFloat(fixed)]);\n}\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport I18n, {i18n, join, LangPackKey} from '../lib/langPack';\r\nimport formatDuration, {DurationType} from './formatDuration';\r\n\r\nconst CALL_DURATION_LANG_KEYS: {[type in DurationType]: LangPackKey} = {\r\n  s: 'Seconds',\r\n  m: 'Minutes',\r\n  h: 'Hours',\r\n  d: 'Days',\r\n  w: 'Weeks'\r\n};\r\nexport default function formatCallDuration(duration: number, plain?: boolean) {\r\n  const a = formatDuration(duration, 2);\r\n  if(plain) {\r\n    const strings = a.map((d) => I18n.format(CALL_DURATION_LANG_KEYS[d.type], true, [d.duration]));\r\n    return join(strings, false, plain);\r\n  }\r\n\r\n  const elements = a.map((d) => i18n(CALL_DURATION_LANG_KEYS[d.type], [d.duration]));\r\n\r\n  const fragment = document.createElement('span');\r\n  fragment.append(...join(elements, false));\r\n\r\n  return fragment;\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nexport type DurationType = 's' | 'm' | 'h' | 'd' | 'w';\r\nexport default function formatDuration(duration: number, showLast = 2) {\r\n  if(!duration) {\r\n    duration = 1;\r\n  }\r\n\r\n  const d: {duration: number, type: DurationType}[] = [];\r\n  const p = [\r\n    {m: 1, t: 's'},\r\n    {m: 60, t: 'm'},\r\n    {m: 60, t: 'h'},\r\n    {m: 24, t: 'd'},\r\n    {m: 7, t: 'w'}\r\n  ] as Array<{m?: number, t: DurationType}>\r\n  const s = 1;\r\n  let t = s;\r\n  p.forEach((o, idx) => {\r\n    t *= o.m;\r\n\r\n    if(duration < t) {\r\n      return;\r\n    }\r\n\r\n    const modulus = p[idx === (p.length - 1) ? idx : idx + 1].m;\r\n    d.push({\r\n      duration: (duration / t % modulus | 0),\r\n      type: o.t\r\n    });\r\n  });\r\n\r\n  const out = d.slice(-showLast).reverse();\r\n  for(let i = out.length - 1; i >= 0; --i) {\r\n    if(out[i].duration === 0) {\r\n      out.splice(i, 1);\r\n    }\r\n  }\r\n\r\n  return out;\r\n}\r\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport {HelpCountry, HelpCountryCode} from '../layer';\nimport I18n from '../lib/langPack';\n\nlet sortedCountries: HelpCountry[];\ntype PrefixCountry = {country: HelpCountry, code: HelpCountryCode};\nconst prefixes: Map<string, PrefixCountry> = new Map();\nlet maxPrefixLength = 0;\nconst setPrefix = (country: HelpCountry, code: HelpCountryCode, prefix: string = '') => {\n  prefix = code.country_code + prefix;\n  /* if(prefixes.has(prefix)) {\n    console.error('asdasdasd', prefixes.get(prefix), country, code);\n  } */\n  maxPrefixLength = Math.max(maxPrefixLength, prefix.length);\n  prefixes.set(prefix, {country, code});\n};\n\nexport function formatPhoneNumber(originalStr: string): {\n  formatted: string,\n  country: HelpCountry,\n  code: HelpCountryCode,\n  leftPattern: string\n} {\n  originalStr = originalStr || '';\n\n  if(!prefixes.size) {\n    I18n.countriesList.forEach((country) => {\n      country.country_codes.forEach((code) => {\n        if(code.prefixes) {\n          code.prefixes.forEach((prefix) => {\n            setPrefix(country, code, prefix);\n          });\n        } else {\n          setPrefix(country, code);\n        }\n      });\n    });\n  }\n\n  // return {formatted: originalStr, country: undefined as any, leftPattern: ''};\n  let str = originalStr.replace(/\\D/g, '');\n  const phoneCode = str.slice(0, maxPrefixLength);\n\n  // //console.log('str', str, phoneCode);\n  // if(!sortedCountries) {\n  //   sortedCountries = I18n.countriesList.slice().sort((a, b) => b.country_codes[0].country_code.length - a.country_codes[0].country_code.length);\n  // }\n\n  // let country = sortedCountries.find((c) => {\n  //   return c.country_codes.find((c) => phoneCode.indexOf(c.replace(/\\D/g, '')) === 0);\n  // });\n\n  let prefixCountry: PrefixCountry;\n  for(let i = phoneCode.length - 1; i >= 0; --i) { // lookup for country by prefix\n    prefixCountry = prefixes.get(phoneCode.slice(0, i + 1));\n    if(prefixCountry) {\n      break;\n    }\n  }\n\n  if(!prefixCountry) {\n    return {\n      formatted: str,\n      country: undefined,\n      code: undefined,\n      leftPattern: ''\n    };\n  }\n\n  // country = /* PhoneCodesMain[country.phoneCode] ||  */country;\n  const country = prefixCountry.country;\n\n  const patterns = prefixCountry.code.patterns || [];\n  const searchForPattern = str.slice(prefixCountry.code.country_code.length); // splice country code\n  let pattern = '', mostMatchedPatternMatches = 0, mostMatchedPattern = '';\n  for(let i = patterns.length - 1; i >= 0; --i) {\n    pattern = patterns[i];\n\n    const _pattern = pattern.replace(/ /g, '');\n    let patternMatches = 0;\n    for(let k = 0, length = Math.min(searchForPattern.length, _pattern.length); k < length; ++k) {\n      if(searchForPattern[k] === _pattern[k] || _pattern[k] === 'X') {\n        ++patternMatches;\n      } else {\n        patternMatches = 0;\n        break;\n      }\n    }\n\n    if(patternMatches > mostMatchedPatternMatches) {\n      mostMatchedPatternMatches = patternMatches;\n      mostMatchedPattern = pattern;\n    }\n  }\n\n  pattern = mostMatchedPattern || pattern;\n  pattern = pattern.replace(/\\d/g, 'X');\n\n  pattern = prefixCountry.code.country_code + ' ' + pattern;\n  // let pattern = country.pattern || country.phoneCode;\n  pattern.split('').forEach((symbol, idx) => {\n    if(symbol === ' ' && str[idx] !== ' ' && str.length > idx) {\n      str = str.slice(0, idx) + ' ' + str.slice(idx);\n    }\n  });\n\n  /* if(country.pattern) {\n    str = str.slice(0, country.pattern.length);\n  } */\n\n  let leftPattern = pattern && pattern.length > str.length ? pattern.slice(str.length) : '';\n  if(leftPattern) {\n    /* const length = str.length;\n    leftPattern = leftPattern.split('').map((_, idx) => (length + idx).toString().slice(-1)).join(''); */\n    leftPattern = leftPattern.replace(/X/g, '');\n    // leftPattern = leftPattern.replace(/X/g, '0');\n  }\n\n  return {formatted: str, country, code: prefixCountry.code, leftPattern};\n}\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\n// generate a path's arc data parameter\r\n\r\nimport {MOUNT_CLASS_TO} from '../config/debug';\r\n\r\n// http://www.w3.org/TR/SVG/paths.html#PathDataEllipticalArcCommands\r\nfunction arcParameter(rx: number, ry: number, xAxisRotation: number, largeArcFlag: number, sweepFlag: number, x: number, y: number) {\r\n  return [rx, ',', ry, ' ',\r\n    xAxisRotation, ' ',\r\n    largeArcFlag, ',',\r\n    sweepFlag, ' ',\r\n    x, ',', y].join('');\r\n}\r\n\r\nexport default function generatePathData(x: number, y: number, width: number, height: number, tl: number, tr: number, br: number, bl: number) {\r\n  const data: string[] = [];\r\n\r\n  // start point in top-middle of the rectangle\r\n  data.push('M' + (x + width / 2) + ',' + y);\r\n\r\n  // next we go to the right\r\n  data.push('H' + (x + width - tr));\r\n\r\n  if(tr > 0) {\r\n    // now we draw the arc in the top-right corner\r\n    data.push('A' + arcParameter(tr, tr, 0, 0, 1, (x + width), (y + tr)));\r\n  }\r\n\r\n  // next we go down\r\n  data.push('V' + (y + height - br));\r\n\r\n  if(br > 0) {\r\n    // now we draw the arc in the lower-right corner\r\n    data.push('A' + arcParameter(br, br, 0, 0, 1, (x + width - br), (y + height)));\r\n  }\r\n\r\n  // now we go to the left\r\n  data.push('H' + (x + bl));\r\n\r\n  if(bl > 0) {\r\n    // now we draw the arc in the lower-left corner\r\n    data.push('A' + arcParameter(bl, bl, 0, 0, 1, (x + 0), (y + height - bl)));\r\n  }\r\n\r\n  // next we go up\r\n  data.push('V' + (y + tl));\r\n\r\n  if(tl > 0) {\r\n    // now we draw the arc in the top-left corner\r\n    data.push('A' + arcParameter(tl, tl, 0, 0, 1, (x + tl), (y + 0)));\r\n  }\r\n\r\n  // and we close the path\r\n  data.push('Z');\r\n\r\n  return data.join(' ');\r\n}\r\n\r\nMOUNT_CLASS_TO.generatePathData = generatePathData;\r\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport {PhotoSize} from '../layer';\nimport {MyDocument} from '../lib/appManagers/appDocsManager';\nimport {MyPhoto} from '../lib/appManagers/appPhotosManager';\nimport {renderImageFromUrlPromise} from './dom/renderImageFromUrl';\nimport getPreviewURLFromThumb from './getPreviewURLFromThumb';\nimport blur from './blur';\n\nexport default function getImageFromStrippedThumb(photo: MyPhoto | MyDocument, thumb: PhotoSize.photoCachedSize | PhotoSize.photoStrippedSize, useBlur: boolean) {\n  const url = getPreviewURLFromThumb(photo, thumb, false);\n\n  let element: HTMLImageElement | HTMLCanvasElement, loadPromise: Promise<void>;\n  if(!useBlur) {\n    element = new Image();\n    loadPromise = renderImageFromUrlPromise(element, url);\n  } else {\n    const result = blur(url);\n    element = result.canvas;\n    loadPromise = result.promise;\n  }\n\n  element.classList.add('thumbnail');\n\n  return {image: element, loadPromise};\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport type {MyDocument} from '../lib/appManagers/appDocsManager';\nimport type {MyPhoto} from '../lib/appManagers/appPhotosManager';\nimport {PhotoSize} from '../layer';\n// import appDownloadManager from \"../lib/appManagers/appDownloadManager\";\nimport getPreviewURLFromBytes from './bytes/getPreviewURLFromBytes';\n\nexport default function getPreviewURLFromThumb(photo: MyPhoto | MyDocument, thumb: PhotoSize.photoCachedSize | PhotoSize.photoStrippedSize, isSticker = false) {\n  // const cacheContext = appDownloadManager.getCacheContext(photo, thumb.type);\n  // return cacheContext.url || (cacheContext.url = getPreviewURLFromBytes(thumb.bytes, isSticker));\n  return getPreviewURLFromBytes(thumb.bytes, isSticker);\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport type {MyDocument} from '../lib/appManagers/appDocsManager';\nimport type {MyPhoto} from '../lib/appManagers/appPhotosManager';\nimport {THUMB_TYPE_FULL} from '../lib/mtproto/mtproto_config';\nimport type {ThumbCache} from '../lib/storages/thumbs';\nimport getImageFromStrippedThumb from './getImageFromStrippedThumb';\n\nexport default function getStrippedThumbIfNeeded(photo: MyPhoto | MyDocument, cacheContext: ThumbCache, useBlur: boolean, ignoreCache = false) {\n  const isVideo = (['video', 'gif'] as MyDocument['type'][]).includes((photo as MyDocument).type);\n  if(!cacheContext.downloaded || isVideo || ignoreCache) {\n    if(\n      photo._ === 'document' &&\n      cacheContext.downloaded &&\n      !ignoreCache &&\n      (!isVideo || cacheContext.type !== THUMB_TYPE_FULL)\n    ) {\n      return null;\n    }\n\n    const sizes = (photo as MyPhoto).sizes || (photo as MyDocument).thumbs;\n    const thumb = sizes?.length ? sizes.find((size) => size._ === 'photoStrippedSize') : null;\n    if(thumb && ('bytes' in thumb)) {\n      return getImageFromStrippedThumb(photo, thumb as any, useBlur);\n    }\n  }\n\n  return null;\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport forEachReverse from './array/forEachReverse';\nimport safeAssign from './object/safeAssign';\n\nexport type ListLoaderOptions<T extends {}, P extends {}> = {\n  loadMore: ListLoader<T, P>['loadMore'],\n  loadCount?: ListLoader<T, P>['loadCount'],\n  loadWhenLeft?: ListLoader<T, P>['loadWhenLeft'],\n  processItem?: ListLoader<T, P>['processItem'],\n  onJump?: ListLoader<T, P>['onJump'],\n  onLoadedMore?: ListLoader<T, P>['onLoadedMore']\n};\n\nexport type ListLoaderResult<T extends {}> = {count: number, items: any[]};\nexport default class ListLoader<T extends {}, P extends {}> {\n  public current: T;\n  public previous: T[] = [];\n  public next: T[] = [];\n  public count: number;\n  public reverse = false; // reverse means next = higher msgid\n\n  protected loadMore: (anchor: T, older: boolean, loadCount: number) => Promise<ListLoaderResult<T>>;\n  protected processItem: (item: P) => T | Promise<T>;\n  protected loadCount = 50;\n  protected loadWhenLeft = 20;\n\n  public onJump: (item: T, older: boolean) => void;\n  public onLoadedMore: () => void;\n\n  protected loadedAllUp = false;\n  protected loadedAllDown = false;\n  protected loadPromiseUp: Promise<void>;\n  protected loadPromiseDown: Promise<void>;\n\n  constructor(options: ListLoaderOptions<T, P>) {\n    safeAssign(this, options);\n  }\n\n  public setTargets(previous: T[], next: T[], reverse: boolean) {\n    this.previous = previous;\n    this.next = next;\n    this.reverse = reverse;\n  }\n\n  public get index() {\n    return this.count !== undefined ? this.previous.length : -1;\n  }\n\n  /* public filter(callback: (item: T, idx: number, arr: T[]) => boolean) {\n    const filter = (item: T, idx: number, arr: T[]) => {\n      if(!callback(item, idx, arr)) {\n        arr.splice(idx, 1);\n      }\n    };\n\n    forEachReverse(this.previous, filter);\n    forEachReverse(this.next, filter);\n  } */\n\n  public reset(loadedAll = false) {\n    this.current = undefined;\n    this.previous = [];\n    this.next = [];\n    this.setLoaded(true, loadedAll);\n    this.setLoaded(false, loadedAll);\n  }\n\n  public go(length: number, dispatchJump = true) {\n    let items: T[], item: T;\n    if(length > 0) {\n      items = this.next.splice(0, length);\n      item = items.pop();\n      if(!item) {\n        return;\n      }\n\n      if(this.current !== undefined) items.unshift(this.current);\n      this.previous.push(...items);\n    } else {\n      items = this.previous.splice(Math.max(0, this.previous.length + length), -length);\n      item = items.shift();\n      if(!item) {\n        return;\n      }\n\n      if(this.current !== undefined) items.push(this.current);\n      this.next.unshift(...items);\n    }\n\n    if(this.next.length < this.loadWhenLeft) {\n      this.load(!this.reverse);\n    }\n\n    if(this.previous.length < this.loadWhenLeft) {\n      this.load(this.reverse);\n    }\n\n    this.current = item;\n    dispatchJump && this.onJump && this.onJump(item, length > 0);\n    return this.current;\n  }\n\n  protected unsetCurrent(toPrevious: boolean) {\n    if(toPrevious) this.previous.push(this.current);\n    else this.next.unshift(this.current);\n\n    this.current = undefined;\n  }\n\n  public goUnsafe(length: number, dispatchJump?: boolean) {\n    const leftLength = length > 0 ? Math.max(0, length - this.next.length) : Math.min(0, length + this.previous.length);\n    const item = this.go(length, leftLength ? false : dispatchJump);\n\n    /* if(length > 0 ? this.loadedAllUp : this.loadedAllDown) {\n      this.unsetCurrent(length > 0);\n    } */\n\n    return {\n      item: !leftLength ? item : undefined,\n      leftLength\n    };\n  }\n\n  protected setLoaded(down: boolean, value: boolean) {\n    const isChanged = (down ? this.loadedAllDown : this.loadedAllUp) !== value;\n    if(!isChanged) {\n      return false;\n    }\n\n    if(down) this.loadedAllDown = value;\n    else this.loadedAllUp = value;\n\n    if(!value) {\n      if(down) this.loadPromiseDown = null;\n      else this.loadPromiseUp = null;\n    }\n\n    return true;\n  }\n\n  //      reverse  loadMediaPromise\n  public load(older: boolean) {\n    if(older ? this.loadedAllDown : this.loadedAllUp) return Promise.resolve();\n\n    let promise = older ? this.loadPromiseDown : this.loadPromiseUp;\n    if(promise) return promise;\n\n    let anchor: T;\n    if(older) {\n      anchor = this.reverse ? this.previous[0] : this.next[this.next.length - 1];\n    } else {\n      anchor = this.reverse ? this.next[this.next.length - 1] : this.previous[0];\n    }\n\n    anchor ??= this.current;\n    promise = this.loadMore(anchor, older, this.loadCount).then(async(result) => {\n      if((older ? this.loadPromiseDown : this.loadPromiseUp) !== promise) {\n        return;\n      }\n\n      if(result.items.length < this.loadCount) {\n        this.setLoaded(older, true);\n      }\n\n      if(this.count === undefined) {\n        this.count = result.count || result.items.length;\n      }\n\n      const processedArr: (Promise<any> | any)[] = [];\n      const method = older ? result.items.forEach.bind(result.items) : forEachReverse.bind(null, result.items);\n      method((item: any) => {\n        const processed = this.processItem ? this.processItem(item) : item;\n\n        if(!processed) return;\n        processedArr.push(processed);\n      });\n\n      const results = await Promise.all(processedArr);\n      if(older) {\n        if(this.reverse) this.previous.unshift(...results);\n        else this.next.push(...results);\n      } else {\n        if(this.reverse) this.next.push(...results);\n        else this.previous.unshift(...results);\n      }\n\n      this.onLoadedMore && this.onLoadedMore();\n    }, () => {}).then(() => {\n      if(older) this.loadPromiseDown = null;\n      else this.loadPromiseUp = null;\n    });\n\n    if(older) this.loadPromiseDown = promise;\n    else this.loadPromiseUp = promise;\n\n    return promise;\n  }\n}\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport type EventListenerBase from './eventListenerBase';\r\n\r\nexport type Listener = {\r\n  element: ListenerElement,\r\n  event: ListenerEvent,\r\n  callback: ListenerCallback,\r\n  options?: ListenerOptions,\r\n\r\n  onceFired?: true, // will be set only when options.once is set\r\n  onceCallback?: () => void,\r\n};\r\n\r\nexport type ListenerElement = Window | Document | HTMLElement | Element | EventListenerBase<any>;\r\nexport type ListenerEvent = string;\r\nexport type ListenerCallback = Function;\r\nexport type ListenerOptions = AddEventListenerOptions;\r\n\r\n/* const originalAddEventListener = HTMLElement.prototype.addEventListener;\r\nHTMLElement.prototype.addEventListener = function(this, name: string, callback: EventListenerOrEventListenerObject, options: AddEventListenerOptions) {\r\n  console.log('nu zdarova', name);\r\n  originalAddEventListener.call(this, name, callback, options);\r\n\r\n  if(options?.ls) {\r\n    return options.ls.addFromElement(this, name, callback as any, options);\r\n  }\r\n}; */\r\n\r\nexport default class ListenerSetter {\r\n  private listeners: Set<Listener> = new Set();\r\n\r\n  public add<T extends ListenerElement>(element: T): T['addEventListener'] {\r\n    return ((event: string, callback: Function, options: ListenerOptions) => {\r\n      const listener: Listener = {element, event, callback, options};\r\n      this.addManual(listener);\r\n      return listener;\r\n    }) as any;\r\n  }\r\n\r\n  /* public addFromElement<T extends ListenerElement>(element: T, event: ListenerEvent, callback: ListenerCallback, options: ListenerOptions) {\r\n    const listener: Listener = {element, event, callback, options};\r\n    this.addManual(listener);\r\n    return listener;\r\n  } */\r\n\r\n  public addManual(listener: Listener) {\r\n    // @ts-ignore\r\n    listener.element.addEventListener(listener.event, listener.callback, listener.options);\r\n\r\n    if(listener.options?.once) { // remove listener when its called\r\n      listener.onceCallback = () => {\r\n        this.remove(listener);\r\n        listener.onceFired = true;\r\n      };\r\n\r\n      // @ts-ignore\r\n      listener.element.addEventListener(listener.event, listener.onceCallback, listener.options);\r\n    }\r\n\r\n    this.listeners.add(listener);\r\n  }\r\n\r\n  public remove(listener: Listener) {\r\n    if(!listener.onceFired) {\r\n      // @ts-ignore\r\n      listener.element.removeEventListener(listener.event, listener.callback, listener.options);\r\n\r\n      if(listener.onceCallback) {\r\n        // @ts-ignore\r\n        listener.element.removeEventListener(listener.event, listener.onceCallback, listener.options);\r\n      }\r\n    }\r\n\r\n    this.listeners.delete(listener);\r\n  }\r\n\r\n  public removeManual<T extends ListenerElement>(\r\n    element: T,\r\n    event: ListenerEvent,\r\n    callback: ListenerCallback,\r\n    options?: ListenerOptions\r\n  ) {\r\n    let listener: Listener;\r\n    for(const _listener of this.listeners) {\r\n      if(_listener.element === element &&\r\n        _listener.event === event &&\r\n        _listener.callback === callback &&\r\n        _listener.options === options) {\r\n        listener = _listener;\r\n        break;\r\n      }\r\n    }\r\n\r\n    if(listener) {\r\n      this.remove(listener);\r\n    }\r\n  }\r\n\r\n  public removeAll() {\r\n    this.listeners.forEach((listener) => {\r\n      this.remove(listener);\r\n    });\r\n  }\r\n}\r\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport calcImageInBox from './calcImageInBox';\n\nexport class MediaSize {\n  constructor(public width = 0, public height = width) {\n\n  }\n\n  public aspect(boxSize: MediaSize, fitted: boolean) {\n    return calcImageInBox(this.width, this.height, boxSize.width, boxSize.height, fitted);\n  }\n\n  public aspectFitted(boxSize: MediaSize) {\n    return this.aspect(boxSize, true);\n  }\n\n  public aspectCovered(boxSize: MediaSize) {\n    return this.aspect(boxSize, false);\n  }\n}\n\nexport function makeMediaSize(width?: number, height?: number): MediaSize {\n  return new MediaSize(width, height);\n}\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport {MOUNT_CLASS_TO} from '../config/debug';\r\nimport EventListenerBase from './eventListenerBase';\r\nimport {makeMediaSize, MediaSize} from './mediaSize';\r\n\r\ntype MediaTypeSizes = {\r\n  regular: MediaSize,\r\n  webpage: MediaSize,\r\n  album: MediaSize,\r\n  esgSticker: MediaSize,\r\n  animatedSticker: MediaSize,\r\n  staticSticker: MediaSize,\r\n  emojiSticker: MediaSize,\r\n  poll: MediaSize,\r\n  round: MediaSize,\r\n  documentName: MediaSize,\r\n  invoice: MediaSize,\r\n  customEmoji: MediaSize\r\n};\r\n\r\nexport type MediaSizeType = keyof MediaTypeSizes;\r\n\r\nexport enum ScreenSize {\r\n  mobile,\r\n  medium,\r\n  large\r\n}\r\n\r\nconst MOBILE_SIZE = 600;\r\nconst MEDIUM_SIZE = 1275;\r\nconst LARGE_SIZE = 1680;\r\n\r\nclass MediaSizes extends EventListenerBase<{\r\n  changeScreen: (from: ScreenSize, to: ScreenSize) => void,\r\n  resize: () => void\r\n}> {\r\n  private screenSizes: {key: ScreenSize, value: number}[] = [\r\n    {key: ScreenSize.mobile, value: MOBILE_SIZE},\r\n    {key: ScreenSize.medium, value: MEDIUM_SIZE},\r\n    {key: ScreenSize.large, value: LARGE_SIZE}\r\n  ];\r\n\r\n  private sizes: {[k in 'desktop' | 'handhelds']: MediaTypeSizes} = {\r\n    handhelds: {\r\n      regular: makeMediaSize(270, 270),\r\n      webpage: makeMediaSize(270, 200),\r\n      album: makeMediaSize(270, 0),\r\n      esgSticker: makeMediaSize(68, 68),\r\n      animatedSticker: makeMediaSize(180, 180),\r\n      staticSticker: makeMediaSize(180, 180),\r\n      emojiSticker: makeMediaSize(112, 112),\r\n      poll: makeMediaSize(240, 0),\r\n      round: makeMediaSize(200, 200),\r\n      documentName: makeMediaSize(200, 0),\r\n      invoice: makeMediaSize(240, 240),\r\n      customEmoji: makeMediaSize(18, 18)\r\n    },\r\n    desktop: {\r\n      regular: makeMediaSize(420, 340),\r\n      webpage: makeMediaSize(420, 340),\r\n      album: makeMediaSize(420, 0),\r\n      esgSticker: makeMediaSize(80, 80),\r\n      animatedSticker: makeMediaSize(200, 200),\r\n      staticSticker: makeMediaSize(200, 200),\r\n      emojiSticker: makeMediaSize(112, 112),\r\n      poll: makeMediaSize(330, 0),\r\n      round: makeMediaSize(280, 280),\r\n      documentName: makeMediaSize(240, 0),\r\n      invoice: makeMediaSize(320, 260),\r\n      customEmoji: makeMediaSize(18, 18)\r\n    }\r\n  };\r\n\r\n  public isMobile = false;\r\n  public active: MediaTypeSizes;\r\n  public activeScreen: ScreenSize;\r\n  private rAF: number;\r\n\r\n  constructor() {\r\n    super();\r\n\r\n    window.addEventListener('resize', () => {\r\n      if(this.rAF) window.cancelAnimationFrame(this.rAF);\r\n      this.rAF = window.requestAnimationFrame(() => {\r\n        this.handleResize();\r\n        this.rAF = 0;\r\n      });\r\n    });\r\n    this.handleResize();\r\n  }\r\n\r\n  private handleResize = () => {\r\n    const innerWidth = window.innerWidth;\r\n    // this.isMobile = innerWidth <= 720;\r\n\r\n    let activeScreen = this.screenSizes[0].key;\r\n    for(let i = this.screenSizes.length - 1; i >= 0; --i) {\r\n      if(this.screenSizes[i].value < innerWidth) {\r\n        activeScreen = (this.screenSizes[i + 1] || this.screenSizes[i]).key;\r\n        break;\r\n      }\r\n    }\r\n\r\n    const wasScreen = this.activeScreen;\r\n    this.activeScreen = activeScreen;\r\n    this.isMobile = this.activeScreen === ScreenSize.mobile;\r\n    this.active = this.isMobile ? this.sizes.handhelds : this.sizes.desktop;\r\n\r\n    // console.time('esg');\r\n    // const computedStyle = window.getComputedStyle(document.documentElement);\r\n    // this.active.esgSticker.width = parseFloat(computedStyle.getPropertyValue('--esg-sticker-size'));\r\n    // console.timeEnd('esg');\r\n\r\n    if(wasScreen !== activeScreen) {\r\n      // console.log('changeScreen', this.activeScreen, activeScreen);\r\n\r\n      if(wasScreen !== undefined) {\r\n        this.dispatchEvent('changeScreen', wasScreen, activeScreen);\r\n      }\r\n    }\r\n\r\n    if(wasScreen !== undefined) {\r\n      this.dispatchEvent('resize');\r\n    }\r\n\r\n    /* if(this.isMobile) {\r\n      for(let i in this.active) {\r\n        // @ts-ignore\r\n        let size = this.active[i];\r\n        size.width = innerWidth\r\n      }\r\n    } */\r\n  };\r\n}\r\n\r\nconst mediaSizes = new MediaSizes();\r\nMOUNT_CLASS_TO.mediaSizes = mediaSizes;\r\nexport default mediaSizes;\r\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nexport default function middlewarePromise(middleware: () => boolean, throwWhat: any = '') {\n  return <T>(promise: T): T => {\n    if(!(promise instanceof Promise)) {\n      if(promise instanceof Error) {\n        throw promise;\n      } else {\n        return promise;\n      }\n    }\n\n    return (promise as any as Promise<any>).then((result) => {\n      if(!middleware()) {\n        throw throwWhat;\n      }\n\n      return result;\n    }) as any;\n  };\n}\n","export default function clamp(v: number, min: number, max: number): number {\n  return v < min ? min : ((v > max) ? max : v);\n}\n","export default function formatNumber(bytes: number, decimals = 2) {\n  if(bytes === 0) return '0';\n\n  const k = 1000;\n  const dm = decimals < 0 ? 0 : decimals;\n  const sizes = ['', 'K', 'M', 'B', 'T'];\n\n  const i = Math.floor(Math.log(bytes) / Math.log(k));\n\n  return parseFloat((bytes / Math.pow(k, i)).toFixed(dm)) + sizes[i];\n}\n","export default function numberThousandSplitter(x: number, joiner = ' ') {\n  const parts = x.toString().split('.');\n  parts[0] = parts[0].replace(/\\B(?=(\\d{3})+(?!\\d))/g, joiner);\n  return parts.join('.');\n}\n","import {IS_APPLE_MOBILE} from '../environment/userAgent';\n\nexport default function onMediaLoad(media: HTMLMediaElement, readyState = media.HAVE_METADATA, useCanplayOnIos?: boolean) {\n  return new Promise<void>((resolve) => {\n    if(media.readyState >= readyState) {\n      resolve();\n      return;\n    }\n\n    media.addEventListener(IS_APPLE_MOBILE && !useCanplayOnIos ? 'loadeddata' : 'canplay', () => resolve(), {once: true});\n  });\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport appNavigationController, {NavigationItem} from '../components/appNavigationController';\nimport IS_TOUCH_SUPPORTED from '../environment/touchSupport';\nimport {IS_MOBILE_SAFARI} from '../environment/userAgent';\nimport cancelEvent from './dom/cancelEvent';\nimport {CLICK_EVENT_NAME} from './dom/clickEvent';\nimport findUpAsChild from './dom/findUpAsChild';\nimport EventListenerBase from './eventListenerBase';\n\nexport default class OverlayClickHandler extends EventListenerBase<{\n  toggle: (open: boolean) => void\n}> {\n  protected element: HTMLElement;\n  protected overlay: HTMLElement;\n  protected listenerOptions: AddEventListenerOptions;\n\n  constructor(\n    protected navigationType: NavigationItem['type'],\n    protected withOverlay?: boolean\n  ) {\n    super(false);\n    this.listenerOptions = withOverlay ? {} : {capture: true};\n  }\n\n  protected onClick = (e: MouseEvent | TouchEvent) => {\n    if(this.element && findUpAsChild(e.target as HTMLElement, this.element)) {\n      return;\n    }\n\n    if(this.listenerOptions?.capture) {\n      cancelEvent(e);\n    }\n\n    this.close();\n  };\n\n  public close() {\n    if(this.element) {\n      this.overlay?.remove();\n      this.element = undefined;\n      this.dispatchEvent('toggle', false);\n    }\n\n    if(!IS_TOUCH_SUPPORTED) {\n      // window.removeEventListener('keydown', onKeyDown, {capture: true});\n      window.removeEventListener('contextmenu', this.onClick, this.listenerOptions);\n    }\n\n    document.removeEventListener(CLICK_EVENT_NAME, this.onClick, this.listenerOptions);\n\n    if(!IS_MOBILE_SAFARI) {\n      appNavigationController.removeByType(this.navigationType);\n    }\n  }\n\n  public open(element: HTMLElement) {\n    this.close();\n\n    if(!IS_MOBILE_SAFARI) {\n      appNavigationController.pushItem({\n        type: this.navigationType,\n        onPop: (canAnimate) => {\n          this.close();\n        }\n      });\n    }\n\n    this.element = element;\n\n    if(!this.overlay && this.withOverlay) {\n      this.overlay = document.createElement('div');\n      this.overlay.classList.add('btn-menu-overlay');\n\n      // ! because this event must be canceled, and can't cancel on menu click (below)\n      this.overlay.addEventListener(CLICK_EVENT_NAME, (e) => {\n        cancelEvent(e);\n        this.onClick(e);\n      });\n    }\n\n    this.overlay && this.element.parentElement.insertBefore(this.overlay, this.element);\n\n    // document.body.classList.add('disable-hover');\n\n    if(!IS_TOUCH_SUPPORTED) {\n      // window.addEventListener('keydown', onKeyDown, {capture: true});\n      window.addEventListener('contextmenu', this.onClick, {...this.listenerOptions, once: true});\n    }\n\n    /* // ! because this event must be canceled, and can't cancel on menu click (below)\n    overlay.addEventListener(CLICK_EVENT_NAME, (e) => {\n      cancelEvent(e);\n      onClick(e);\n    }); */\n\n    // ! safari iOS doesn't handle window click event on overlay, idk why\n    document.addEventListener(CLICK_EVENT_NAME, this.onClick, this.listenerOptions);\n\n    this.dispatchEvent('toggle', true);\n  }\n}\n","import Currencies from '../config/currencies';\n\n// https://stackoverflow.com/a/34141813\nfunction number_format(number: any, decimals: any, dec_point: any, thousands_sep: any): string {\n  // Strip all characters but numerical ones.\n  number = (number + '').replace(/[^0-9+\\-Ee.]/g, '');\n  var n = !isFinite(+number) ? 0 : +number,\n    prec = !isFinite(+decimals) ? 0 : Math.abs(decimals),\n    sep = (typeof thousands_sep === 'undefined') ? ',' : thousands_sep,\n    dec = (typeof dec_point === 'undefined') ? '.' : dec_point,\n    s: any = '',\n    toFixedFix = function(n: number, prec: number) {\n      var k = Math.pow(10, prec);\n      return '' + Math.round(n * k) / k;\n    };\n  // Fix for IE parseFloat(0.55).toFixed(0) = 0;\n  s = (prec ? toFixedFix(n, prec) : '' + Math.round(n)).split('.');\n  if(s[0].length > 3) {\n    s[0] = s[0].replace(/\\B(?=(?:\\d{3})+(?!\\d))/g, sep);\n  }\n  if((s[1] || '').length < prec) {\n    s[1] = s[1] || '';\n    s[1] += new Array(prec - s[1].length + 1).join('0');\n  }\n  return s.join(dec);\n}\n\nexport default function paymentsWrapCurrencyAmount(amount: number | string, currency: string, skipSymbol?: boolean) {\n  amount = +amount;\n\n  const isNegative = amount < 0;\n\n  const currencyData = Currencies[currency];\n  if(!currencyData) {\n    throw new Error('CURRENCY_WRAP_INVALID');\n  }\n\n  const amountExp = amount / Math.pow(10, currencyData.exp);\n\n  let decimals = currencyData.exp;\n  if(currency == 'IRR' && Math.floor(amountExp) == amountExp) {\n    decimals = 0; //      = 0     UI\n  }\n\n  let formatted = number_format(amountExp, decimals, currencyData.decimal_sep, currencyData.thousands_sep);\n  if(skipSymbol) {\n    return formatted;\n  }\n\n  let symbol = currencyData.symbol;\n  if(isNegative && !currencyData.space_between && currencyData.symbol_left) {\n    symbol = '-' + symbol;\n    formatted = formatted.replace('-', '');\n  }\n\n  let out: string;\n  const splitter = currencyData.space_between ? ' ' : '';\n  if(currencyData.symbol_left) {\n    out = symbol + splitter + formatted;\n  } else {\n    out = formatted + splitter + symbol;\n  }\n  return out;\n}\n\n(window as any).p = paymentsWrapCurrencyAmount;\n\n// function paymentsGetCurrencyExp($currency: string) {\n//   if($currency == 'CLF') {\n//     return 4;\n//   }\n//   if(['BHD','IQD','JOD','KWD','LYD','OMR','TND'].includes($currency)) {\n//     return 3;\n//   }\n//   if(['BIF','BYR','CLP','CVE','DJF','GNF','ISK','JPY','KMF','KRW','MGA', 'PYG','RWF','UGX','UYI','VND','VUV','XAF','XOF','XPF'].includes($currency)) {\n//     return 0;\n//   }\n//   if($currency == 'MRO') {\n//     return 1;\n//   }\n//   return 2;\n// }\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport mediaSizes from './mediaSizes';\n\nexport type MenuPositionPadding = {\n  top?: number,\n  right?: number,\n  bottom?: number,\n  left?: number\n};\n\nconst PADDING_TOP = 8;\nconst PADDING_BOTTOM = PADDING_TOP;\nconst PADDING_LEFT = 8;\nconst PADDING_RIGHT = PADDING_LEFT;\nexport default function positionMenu({pageX, pageY}: MouseEvent | Touch, elem: HTMLElement, side?: 'left' | 'right' | 'center', additionalPadding?: MenuPositionPadding) {\n  // let {clientX, clientY} = e;\n\n  // * side mean the OPEN side\n\n  const getScrollWidthFromElement = (Array.from(elem.children) as HTMLElement[]).find((element) => element.classList.contains('btn-menu-item') && !element.classList.contains('hide')) || elem;\n\n  const {scrollWidth: menuWidth} = getScrollWidthFromElement;\n  const {scrollHeight: menuHeight} = elem;\n  // let {innerWidth: windowWidth, innerHeight: windowHeight} = window;\n  const rect = document.body.getBoundingClientRect();\n  const windowWidth = rect.width;\n  const windowHeight = rect.height;\n\n  let paddingTop = PADDING_TOP, paddingRight = PADDING_RIGHT, paddingBottom = PADDING_BOTTOM, paddingLeft = PADDING_LEFT;\n  if(additionalPadding) {\n    if(additionalPadding.top) paddingTop += additionalPadding.top;\n    if(additionalPadding.right) paddingRight += additionalPadding.right;\n    if(additionalPadding.bottom) paddingBottom += additionalPadding.bottom;\n    if(additionalPadding.left) paddingLeft += additionalPadding.left;\n  }\n\n  side = mediaSizes.isMobile ? 'right' : 'left';\n  let verticalSide: 'top' /* | 'bottom' */ | 'center' = 'top';\n\n  const maxTop = windowHeight - menuHeight - paddingBottom;\n  const maxLeft = windowWidth - menuWidth - paddingRight;\n  const minTop = paddingTop;\n  const minLeft = paddingLeft;\n\n  const getSides = () => {\n    return {\n      x: {\n        left: pageX,\n        right: Math.min(maxLeft, pageX - menuWidth)\n      },\n      intermediateX: side === 'right' ? minLeft : maxLeft,\n      // intermediateX: clientX < windowWidth / 2 ? PADDING_LEFT : windowWidth - menuWidth - PADDING_LEFT,\n      y: {\n        top: pageY,\n        bottom: pageY - menuHeight\n      },\n      // intermediateY: verticalSide === 'top' ? paddingTop : windowHeight - menuHeight - paddingTop,\n      // intermediateY: pageY < (windowHeight / 2) ? paddingTop : windowHeight - menuHeight - paddingBottom,\n      intermediateY: maxTop\n    };\n  };\n\n  const sides = getSides();\n\n  const possibleSides = {\n    x: {\n      left: (sides.x.left + menuWidth + paddingRight) <= windowWidth,\n      right: sides.x.right >= paddingLeft\n    },\n    y: {\n      top: (sides.y.top + menuHeight + paddingBottom) <= windowHeight,\n      bottom: (sides.y.bottom - paddingBottom) >= paddingBottom\n    }\n  };\n\n  /* if(side === undefined) {\n    if((clientX + menuWidth + PADDING_LEFT) > windowWidth) {\n      side = 'right';\n    }\n  } */\n\n  {\n    /* const x = sides.x;\n\n    const s = Object.keys(x) as (keyof typeof possibleSides.x)[];\n    if(side) {\n      s.findAndSplice((s) => s === side);\n      s.unshift(side);\n    }\n\n    const possibleSide = s.find((s) => possibleSides.x[s]); */\n    // let left: number;\n    /* if(possibleSide) {\n      left = x[possibleSide];\n      side = possibleSide;\n    } else {\n      left = sides.intermediateX;\n      side = undefined;\n    } */\n    const left = possibleSides.x[side] ? sides.x[side] : (side = 'center', sides.intermediateX);\n\n    elem.style.left = left + 'px';\n  }\n\n  /* if((clientY + menuHeight + PADDING_TOP) > windowHeight) {\n    elem.style.top = clamp(clientY - menuHeight, PADDING_TOP, windowHeight - menuHeight - PADDING_TOP) + 'px';\n    // elem.style.top = (innerHeight - scrollHeight - PADDING_TOP) + 'px';\n    verticalSide = 'bottom';\n  } else {\n    elem.style.top = Math.max(PADDING_TOP, clientY) + 'px';\n    verticalSide = 'top';\n  } */\n\n  {\n    const top = possibleSides.y[verticalSide] ? sides.y[verticalSide] : (verticalSide = 'center', sides.intermediateY);\n\n    elem.style.top = top + 'px';\n  }\n\n  elem.className = elem.className.replace(/(top|center|bottom)-(left|center|right)/g, '');\n  elem.classList.add(\n    // (verticalSide === 'center' ? verticalSide : (verticalSide === 'bottom' ? 'top' : 'bottom')) +\n    (verticalSide === 'center' ? verticalSide : 'bottom') +\n    '-' +\n    (side === 'center' ? side : (side === 'left' ? 'right' : 'left')));\n\n  return {\n    width: menuWidth,\n    height: menuHeight\n  };\n}\n","import {RestrictionReason} from '../layer';\n\nconst platforms = new Set([\n  'all',\n  'web',\n  'webk'\n]);\n\nconst ignore = new Set();\n\nexport function getRestrictionReason(reasons: RestrictionReason[]) {\n  // return reasons[0];\n  return reasons.find((reason) => platforms.has(reason.platform) && !ignore.has(reason.reason));\n}\n\nexport function isRestricted(reasons: RestrictionReason[]) {\n  return !!getRestrictionReason(reasons);\n}\n\nexport function ignoreRestrictionReasons(reasons: string[]) {\n  ignore.clear();\n  reasons.forEach((reason) => {\n    ignore.add(reason);\n  });\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport type {MyDocument} from '../lib/appManagers/appDocsManager';\nimport rootScope from '../lib/rootScope';\n\nconst savingLottiePreview: {[docId: DocId]: {width: number, height: number}} = {};\n\nexport function isSavingLottiePreview(doc: MyDocument, toneIndex: number) {\n  const key = doc.id + '-' + toneIndex;\n  return !!savingLottiePreview[key];\n}\n\nexport async function saveLottiePreview(doc: MyDocument, canvas: HTMLCanvasElement, toneIndex: number) {\n  const key = doc.id + '-' + toneIndex;\n  const {width, height} = canvas;\n  let saving = savingLottiePreview[key];\n  if(saving && saving.width >= width && saving.height >= height) {\n    return;\n  }\n\n  saving = savingLottiePreview[key] = {\n    width,\n    height\n  };\n\n  const thumb = await rootScope.managers.appDocsManager.getLottieCachedThumb(doc.id, toneIndex);\n  if(savingLottiePreview[key] !== saving) {\n    return;\n  }\n\n  if(thumb && thumb.w >= width && thumb.h >= height) {\n    return;\n  }\n\n  const promise = new Promise<Blob>((resolve) => {\n    canvas.toBlob((blob) => resolve(blob));\n  });\n\n  const blob = await promise;\n  if(savingLottiePreview[key] !== saving) {\n    return;\n  }\n\n  // console.log('got lottie preview', doc, blob, URL.createObjectURL(blob));\n\n  rootScope.managers.appDocsManager.saveLottiePreview(doc.id, blob, width, height, toneIndex);\n\n  delete savingLottiePreview[key];\n\n  /* const reader = new FileReader();\n  reader.onloadend = (e) => {\n    const uint8 = new Uint8Array(e.target.result as ArrayBuffer);\n    const thumb: PhotoSize.photoStrippedSize = {\n      _: 'photoStrippedSize',\n      bytes: uint8,\n      type: 'i'\n    };\n\n    doc.stickerSavedThumbWidth = canvas.width;\n    doc.stickerSavedThumbHeight = canvas.width;\n\n    defineNotNumerableProperties(thumb, ['url']);\n    thumb.url = URL.createObjectURL(blob);\n    doc.thumbs.findAndSplice((t) => t._ === thumb._);\n    doc.thumbs.unshift(thumb);\n\n    if(!webpWorkerController.isWebpSupported()) {\n      doc.pFlags.stickerThumbConverted = true;\n    }\n\n    delete this.savingLottiePreview[doc.id];\n  };\n  reader.readAsArrayBuffer(blob); */\n}\n","// * Jolly Cobra's schedulers\n\nimport {AnyToVoidFunction} from '../../types';\nimport {fastRaf} from '../schedulers';\nimport throttleWith from './throttleWith';\n\nexport default function throttleWithRaf<F extends AnyToVoidFunction>(fn: F) {\n  return throttleWith(fastRaf, fn);\n}\n","// * Jolly Cobra's schedulers\n\nimport {AnyToVoidFunction} from '../../types';\n\nexport default function throttleWith<F extends AnyToVoidFunction>(schedulerFn: AnyToVoidFunction, fn: F) {\n  let waiting = false;\n  let args: Parameters<F>;\n\n  return (..._args: Parameters<F>) => {\n    args = _args;\n\n    if(!waiting) {\n      waiting = true;\n\n      schedulerFn(() => {\n        waiting = false;\n        // @ts-ignore\n        fn(...args);\n      });\n    }\n  };\n}\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport Scrollable from '../components/scrollable';\r\nimport safeAssign from './object/safeAssign';\r\n\r\nexport default class ScrollableLoader {\r\n  public loading = false;\r\n  private scrollable: Scrollable;\r\n  private getPromise: () => Promise<boolean>;\r\n  private promise: Promise<any>;\r\n  private loaded = false;\r\n\r\n  constructor(options: {\r\n    scrollable: ScrollableLoader['scrollable'],\r\n    getPromise: ScrollableLoader['getPromise']\r\n  }) {\r\n    safeAssign(this, options);\r\n\r\n    options.scrollable.onScrolledBottom = () => {\r\n      this.load();\r\n    };\r\n  }\r\n\r\n  public load() {\r\n    if(this.loaded) {\r\n      return Promise.resolve();\r\n    }\r\n\r\n    if(this.loading) {\r\n      return this.promise;\r\n    }\r\n\r\n    this.loading = true;\r\n    this.promise = this.getPromise().then((done) => {\r\n      this.loading = false;\r\n      this.promise = undefined;\r\n\r\n      if(done) {\r\n        this.loaded = true;\r\n        this.scrollable.onScrolledBottom = null;\r\n      } else {\r\n        this.scrollable.checkForTriggers();\r\n      }\r\n    }, () => {\r\n      this.promise = undefined;\r\n      this.loading = false;\r\n    });\r\n  }\r\n}\r\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport type {MediaSearchContext} from '../components/appMediaPlaybackController';\nimport type {SearchSuperContext} from '../components/appSearchSuper.';\nimport type {Message} from '../layer';\nimport type {MessagesStorageKey, MyMessage} from '../lib/appManagers/appMessagesManager';\nimport {AppManagers} from '../lib/appManagers/managers';\nimport incrementMessageId from '../lib/appManagers/utils/messageId/incrementMessageId';\nimport rootScope from '../lib/rootScope';\nimport forEachReverse from './array/forEachReverse';\nimport filterChatPhotosMessages from './filterChatPhotosMessages';\nimport ListLoader, {ListLoaderOptions} from './listLoader';\n\nexport default class SearchListLoader<Item extends {mid: number, peerId: PeerId}> extends ListLoader<Item, Message.message> {\n  public searchContext: MediaSearchContext;\n  public onEmptied: () => void;\n\n  private otherSideLoader: SearchListLoader<Item>;\n  private managers: AppManagers;\n\n  constructor(options: Omit<ListLoaderOptions<Item, Message.message>, 'loadMore'> & {\n    onEmptied?: () => void,\n    isInner?: boolean,\n    managers?: AppManagers\n  } = {}) {\n    super({\n      ...options,\n      loadMore: (anchor, older, loadCount) => {\n        const backLimit = older ? 0 : loadCount;\n        let maxId = anchor?.mid;\n\n        if(maxId === undefined) maxId = this.searchContext.maxId;\n        if(!older) maxId = incrementMessageId(maxId, 1);\n\n        return this.managers.appMessagesManager.getSearch({\n          ...this.searchContext,\n          peerId: this.searchContext.peerId || anchor?.peerId,\n          maxId,\n          limit: backLimit ? 0 : loadCount,\n          backLimit\n        }).then((value) => {\n          /* if(DEBUG) {\n            this.log('loaded more media by maxId:', maxId, value, older, this.reverse);\n          } */\n\n          if(this.searchContext.inputFilter._ === 'inputMessagesFilterChatPhotos') {\n            filterChatPhotosMessages(value);\n          }\n\n          if(value.next_rate) {\n            this.searchContext.nextRate = value.next_rate;\n          }\n\n          return {count: value.count, items: value.history};\n        });\n      },\n      processItem: async(message) => {\n        const filtered = await this.filterMids([message.mid]);\n        if(!filtered.length) {\n          return;\n        }\n\n        return options.processItem(message);\n      }\n    });\n\n    this.managers ??= rootScope.managers;\n    rootScope.addEventListener('history_delete', this.onHistoryDelete);\n    rootScope.addEventListener('history_multiappend', this.onHistoryMultiappend);\n    rootScope.addEventListener('message_sent', this.onMessageSent);\n\n    if(!options.isInner) {\n      this.otherSideLoader = new SearchListLoader({\n        ...options,\n        isInner: true\n      });\n\n      // this.otherSideLoader.onLoadedMore = () => {\n\n      // };\n    }\n  }\n\n  protected async filterMids(mids: number[]) {\n    const storageKey: MessagesStorageKey = `${this.searchContext.peerId}_${this.searchContext.isScheduled ? 'scheduled' : 'history'}`;\n    const filtered = (await this.managers.appMessagesManager.filterMessagesByInputFilterFromStorage(this.searchContext.inputFilter._, mids, storageKey, mids.length)) as Message.message[];\n    return filtered;\n  }\n\n  protected onHistoryDelete = ({peerId, msgs}: {peerId: PeerId, msgs: Set<number>}) => {\n    const shouldBeDeleted = (item: Item) => item.peerId === peerId && msgs.has(item.mid);\n    const filter = (item: Item, idx: number, arr: Item[]) => {\n      if(shouldBeDeleted(item)) {\n        arr.splice(idx, 1);\n      }\n    };\n\n    forEachReverse(this.previous, filter);\n    forEachReverse(this.next, filter);\n\n    if(this.current && shouldBeDeleted(this.current)) {\n      this.current = undefined;\n      /* if(this.go(1)) {\n        this.previous.splice(this.previous.length - 1, 1);\n      } else if(this.go(-1)) {\n        this.next.splice(0, 1);\n      } else  */if(this.onEmptied) {\n        this.onEmptied();\n      }\n    }\n  };\n\n  protected onHistoryMultiappend = async(message: Message.message | Message.messageService) => {\n    if(this.searchContext.folderId !== undefined) {\n      return;\n    }\n\n    // because it's reversed\n    if(!this.loadedAllUp || this.loadPromiseUp) {\n      return;\n    }\n\n    if(message.peerId !== this.searchContext.peerId) {\n      return;\n    }\n\n    const filtered = await this.filterMids([message.mid]);\n    const targets = (await Promise.all(filtered.map((message) => this.processItem(message)))).filter(Boolean);\n    if(targets.length) {\n      /* const {previous, current, next} = this;\n      const targets = previous.concat(current, next);\n      const currentIdx = targets.length;\n      const mid = targets[0].mid;\n      let i = 0, length = targets.length;\n      for(; i < length; ++i) {\n        const target = targets[i];\n        if(!target || mid < target.mid) {\n          break;\n        }\n      }\n\n      if(i < currentIdx) previous.push(...targets);\n      else next. */\n\n      if(!this.current) {\n        this.previous.push(...targets);\n      } else {\n        this.next.push(...targets);\n      }\n    }\n  };\n\n  protected onMessageSent = ({message}: {message: MyMessage}) => {\n    this.onHistoryMultiappend(message);\n  };\n\n  public setSearchContext(context: SearchSuperContext) {\n    this.searchContext = context;\n\n    if(this.searchContext.folderId !== undefined) {\n      this.loadedAllUp = true;\n\n      if(this.searchContext.nextRate === undefined) {\n        this.loadedAllDown = true;\n      }\n    }\n\n    if(this.searchContext.inputFilter._ === 'inputMessagesFilterChatPhotos') {\n      this.loadedAllUp = true;\n    }\n\n    if(this.searchContext.useSearch === false) {\n      this.loadedAllDown = this.loadedAllUp = true;\n    }\n\n    if(this.otherSideLoader) {\n      this.otherSideLoader.setSearchContext(context);\n    }\n  }\n\n  public reset() {\n    super.reset();\n    this.searchContext = undefined;\n\n    if(this.otherSideLoader) {\n      this.otherSideLoader.reset();\n    }\n  }\n\n  public getPrevious(withOtherSide?: boolean) {\n    let previous = this.previous;\n\n    if(this.otherSideLoader && withOtherSide) {\n      previous = previous.concat(this.otherSideLoader.previous);\n    }\n\n    return previous;\n  }\n\n  public getNext(withOtherSide?: boolean) {\n    let next = this.next;\n\n    if(this.otherSideLoader && withOtherSide) {\n      next = next.concat(this.otherSideLoader.next);\n    }\n\n    return next;\n  }\n\n  public getCurrent() {\n    return this.current || this.otherSideLoader?.current;\n  }\n\n  private goToOtherEnd(length: number) {\n    if(length > 0) return this.go(-this.previous.length);\n    else return this.go(this.next.length);\n  }\n\n  public goRound(length: number, dispatchJump?: boolean) {\n    let ret: ReturnType<SearchListLoader<Item>['goUnsafe']>;\n\n    if(this.otherSideLoader?.current) {\n      ret = this.otherSideLoader.goUnsafe(length, dispatchJump);\n      if(ret.item) {\n        return ret.item;\n      }\n\n      length = ret.leftLength;\n      if(!(length > 0 ? this.otherSideLoader.next : this.otherSideLoader.previous).length) {\n        const loaded = length > 0 ? this.otherSideLoader.loadedAllUp : this.otherSideLoader.loadedAllDown;\n        if(!loaded) { // do not reset anything until it's loaded\n          return;\n        }\n\n        // if other side is loaded too will start from its begin\n        if((length > 0 && (this.otherSideLoader.searchContext.maxId === 1 || this.otherSideLoader.loadedAllDown)) ||\n          (length < 0 && (this.otherSideLoader.searchContext.maxId === 0 || this.otherSideLoader.loadedAllUp))) {\n          return this.otherSideLoader.goToOtherEnd(length);\n        }\n\n        this.otherSideLoader.unsetCurrent(length > 0);\n      }\n    }\n\n    ret = this.goUnsafe(length, dispatchJump);\n    if(!ret.item) {\n      if(this.loadedAllUp && this.loadedAllDown) { // just use the same loader if the list is too short\n        return this.goToOtherEnd(length);\n      } else if(this.otherSideLoader) {\n        length = ret.leftLength;\n        ret = this.otherSideLoader.goUnsafe(length, dispatchJump);\n\n        if(ret.item) {\n          this.unsetCurrent(length > 0);\n        }\n      }\n    }\n\n    return ret?.item;\n  }\n\n  // public setTargets(previous: Item[], next: Item[], reverse: boolean) {\n  //   super.setTargets(previous, next, reverse);\n  // }\n\n  protected setLoaded(down: boolean, value: boolean) {\n    const changed = super.setLoaded(down, value);\n\n    if(changed &&\n      this.otherSideLoader &&\n      value &&\n      this.searchContext?.useSearch !== false/*  &&\n      (this.reverse ? this.loadedAllUp : this.loadedAllDown) */) {\n      const reverse = this.loadedAllUp;\n      this.otherSideLoader.setSearchContext({\n        ...this.searchContext,\n        maxId: reverse ? 1 : 0\n      });\n\n      // these 'reverse' are different, not a mistake here.\n      this.otherSideLoader.reverse = this.reverse;\n      this.otherSideLoader.setLoaded(reverse, true);\n      this.otherSideLoader.load(!reverse);\n    }\n\n    return changed;\n  }\n\n  public cleanup() {\n    this.reset();\n    rootScope.removeEventListener('history_delete', this.onHistoryDelete);\n    rootScope.removeEventListener('history_multiappend', this.onHistoryMultiappend);\n    rootScope.removeEventListener('message_sent', this.onMessageSent);\n    this.onEmptied = undefined;\n\n    if(this.otherSideLoader) {\n      this.otherSideLoader.cleanup();\n      this.otherSideLoader = undefined;\n    }\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport generateMessageId from './generateMessageId';\nimport getServerMessageId from './getServerMessageId';\n\nexport default function incrementMessageId(messageId: number, increment: number) {\n  return generateMessageId(getServerMessageId(messageId) + increment);\n}\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport {fastRaf} from './schedulers';\r\nimport deferredPromise, {CancellablePromise} from './cancellablePromise';\r\nimport {MOUNT_CLASS_TO} from '../config/debug';\r\nimport isInDOM from './dom/isInDOM';\r\n\r\nclass SequentialDom {\r\n  private promises: Partial<{\r\n    read: CancellablePromise<void>,\r\n    write: CancellablePromise<void>\r\n  }> = {};\r\n  private raf = fastRaf.bind(null);\r\n  private scheduled = false;\r\n\r\n  private do(kind: keyof SequentialDom['promises'], callback?: VoidFunction) {\r\n    let promise = this.promises[kind];\r\n    if(!promise) {\r\n      this.scheduleFlush();\r\n      promise = this.promises[kind] = deferredPromise<void>();\r\n    }\r\n\r\n    if(callback !== undefined) {\r\n      promise.then(() => callback());\r\n    }\r\n\r\n    return promise;\r\n  }\r\n\r\n  public measure(callback?: VoidFunction) {\r\n    return this.do('read', callback);\r\n  }\r\n\r\n  public mutate(callback?: VoidFunction) {\r\n    return this.do('write', callback);\r\n  }\r\n\r\n  /**\r\n   * Will fire instantly if element is not connected\r\n   * @param element\r\n   * @param callback\r\n   */\r\n  public mutateElement(element: HTMLElement, callback?: VoidFunction) {\r\n    const isConnected = isInDOM(element);\r\n    const promise = isConnected ? this.mutate() : Promise.resolve();\r\n\r\n    if(callback !== undefined) {\r\n      if(!isConnected) {\r\n        callback();\r\n      } else {\r\n        promise.then(() => callback());\r\n      }\r\n    }\r\n\r\n    return promise;\r\n  }\r\n\r\n  private scheduleFlush() {\r\n    if(!this.scheduled) {\r\n      this.scheduled = true;\r\n\r\n      this.raf(() => {\r\n        this.promises.read && this.promises.read.resolve();\r\n        this.promises.write && this.promises.write.resolve();\r\n\r\n        this.scheduled = false;\r\n        this.promises = {};\r\n      });\r\n    }\r\n  }\r\n}\r\n\r\nconst sequentialDom = new SequentialDom();\r\nMOUNT_CLASS_TO && (MOUNT_CLASS_TO.sequentialDom = sequentialDom);\r\nexport default sequentialDom;\r\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport {PhotoSize, WebDocument} from '../layer';\nimport {REPLIES_HIDDEN_CHANNEL_ID} from '../lib/mtproto/mtproto_config';\nimport {MyDocument} from '../lib/appManagers/appDocsManager';\nimport {MyPhoto} from '../lib/appManagers/appPhotosManager';\nimport choosePhotoSize from '../lib/appManagers/utils/photos/choosePhotoSize';\nimport {MediaSize, makeMediaSize} from './mediaSize';\nimport isWebDocument from '../lib/appManagers/utils/webDocs/isWebDocument';\n\nexport default function setAttachmentSize(\n  photo: MyPhoto | MyDocument | WebDocument,\n  element: HTMLElement | SVGForeignObjectElement,\n  boxWidth: number,\n  boxHeight: number,\n  noZoom = true,\n  message?: any,\n  pushDocumentSize?: boolean,\n  photoSize?: ReturnType<typeof choosePhotoSize>\n) {\n  const _isWebDocument = isWebDocument(photo);\n  // if(_isWebDocument && pushDocumentSize === undefined) {\n  //   pushDocumentSize = true;\n  // }\n\n  if(!photoSize) {\n    photoSize = choosePhotoSize(photo, boxWidth, boxHeight, undefined, pushDocumentSize);\n  }\n  // console.log('setAttachmentSize', photo, photo.sizes[0].bytes, div);\n\n  let size: MediaSize;\n  const isDocument = photo._ === 'document';\n  if(isDocument || _isWebDocument) {\n    size = makeMediaSize(photo.w || (photoSize as PhotoSize.photoSize).w || 512, photo.h || (photoSize as PhotoSize.photoSize).h || 512);\n  } else {\n    size = makeMediaSize((photoSize as PhotoSize.photoSize).w || 100, (photoSize as PhotoSize.photoSize).h || 100);\n  }\n\n  let boxSize = makeMediaSize(boxWidth, boxHeight);\n\n  boxSize = size = size.aspect(boxSize, noZoom);\n\n  let isFit = true;\n\n  if(!isDocument || ['video', 'gif'].includes(photo.type) || _isWebDocument) {\n    if(boxSize.width < 200 && boxSize.height < 200) { // make at least one side this big\n      boxSize = size = size.aspectCovered(makeMediaSize(200, 200));\n    }\n\n    if(message &&\n      (message.message ||\n        message.reply_to_mid ||\n        message.media.webpage ||\n        (message.replies && message.replies.pFlags.comments && message.replies.channel_id.toChatId() !== REPLIES_HIDDEN_CHANNEL_ID)\n      )\n    ) { // make sure that bubble block is human-readable\n      if(boxSize.width < 320) {\n        boxSize = makeMediaSize(320, boxSize.height);\n        isFit = false;\n      }\n    }\n\n    if(isFit && boxSize.width < 120 && message) { // if image is too narrow\n      boxSize = makeMediaSize(120, boxSize.height);\n      isFit = false;\n    }\n  }\n\n  // if(element instanceof SVGForeignObjectElement) {\n  //   element.setAttributeNS(null, 'width', '' + w);\n  //   element.setAttributeNS(null, 'height', '' + h);\n\n  //   //console.log('set dimensions to svg element:', element, w, h);\n  // } else {\n  element.style.width = boxSize.width + 'px';\n  element.style.height = boxSize.height + 'px';\n  // }\n\n  return {photoSize, size, isFit};\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport insertInDescendSortedArray from './array/insertInDescendSortedArray';\nimport {getMiddleware} from './middleware';\nimport safeAssign from './object/safeAssign';\n\nexport type SortedElementId = PeerId;\nexport type SortedElementBase = {\n  id: SortedElementId,\n  index: number\n};\n\nexport default class SortedList<SortedElement extends SortedElementBase> {\n  protected elements: Map<SortedElementId, SortedElement>;\n  protected sorted: Array<SortedElement>;\n\n  protected getIndex: (element: SortedElement) => PromiseLike<number> | number;\n  protected onDelete: (element: SortedElement) => void;\n  protected onUpdate: (element: SortedElement) => void;\n  protected onSort: (element: SortedElement, idx: number) => void;\n  protected onElementCreate: (base: SortedElementBase, batch: boolean) => SortedElement;\n\n  protected updateElementWith = (callback: () => void) => callback();\n  protected updateListWith = (callback: (canUpdate: boolean | undefined) => void) => callback(true);\n\n  protected middleware = getMiddleware();\n\n  constructor(options: {\n    getIndex: SortedList<SortedElement>['getIndex'],\n    onDelete?: SortedList<SortedElement>['onDelete'],\n    onUpdate?: SortedList<SortedElement>['onUpdate'],\n    onSort?: SortedList<SortedElement>['onSort'],\n    onElementCreate: SortedList<SortedElement>['onElementCreate'],\n\n    updateElementWith?: SortedList<SortedElement>['updateElementWith'],\n    updateListWith?: SortedList<SortedElement>['updateListWith']\n  }) {\n    safeAssign(this, options);\n\n    this.elements = new Map();\n    this.sorted = [];\n  }\n\n  public clear() {\n    this.middleware.clean();\n    this.elements.clear();\n    this.sorted.length = 0;\n  }\n\n  protected _updateList() {\n    this.elements.forEach((element) => {\n      this.update(element.id, true);\n    });\n\n    if(this.onSort) {\n      this.sorted.forEach((element, idx) => {\n        this.onSort(element, idx);\n      });\n    }\n  }\n\n  public updateList(callback: (updated: boolean) => void) {\n    const middleware = this.middleware.get();\n    this.updateListWith((canUpdate) => {\n      if(!middleware() || (canUpdate !== undefined && !canUpdate)) {\n        return callback(false);\n      }\n\n      this._updateList();\n\n      callback(true);\n    });\n  }\n\n  public has(id: SortedElementId) {\n    return this.elements.has(id);\n  }\n\n  public get(id: SortedElementId) {\n    return this.elements.get(id);\n  }\n\n  public getAll() {\n    return this.elements;\n  }\n\n  public add(\n    id: SortedElementId,\n    batch = false,\n    updateElementWith?: SortedList<SortedElement>['updateElementWith'],\n    updateBatch = batch\n  ) {\n    let element = this.get(id);\n    if(element) {\n      return element;\n    }\n\n    const base: SortedElementBase = {\n      id,\n      index: 0\n    };\n\n    element = this.onElementCreate(base, batch);\n    this.elements.set(id, element);\n    this.update(id, updateBatch, element, updateElementWith);\n\n    return element;\n  }\n\n  public delete(id: SortedElementId, noScheduler?: boolean) {\n    const element = this.elements.get(id);\n    if(!element) {\n      return false;\n    }\n\n    this.elements.delete(id);\n\n    const idx = this.sorted.indexOf(element);\n    if(idx !== -1) {\n      this.sorted.splice(idx, 1);\n    }\n\n    if(this.onDelete) {\n      if(noScheduler) {\n        this.onDelete(element);\n      } else {\n        const middleware = this.middleware.get();\n        this.updateElementWith(() => {\n          if(!middleware()) {\n            return;\n          }\n\n          this.onDelete(element);\n        });\n      }\n    }\n\n    return true;\n  }\n\n  public async update(\n    id: SortedElementId,\n    batch = false,\n    element = this.get(id),\n    updateElementWith?: SortedList<SortedElement>['updateElementWith']\n  ) {\n    if(!element) {\n      return;\n    }\n\n    element.index = await this.getIndex(element);\n    this.onUpdate && this.onUpdate(element);\n\n    const idx = insertInDescendSortedArray(this.sorted, element, 'index');\n    if(!batch && this.onSort) {\n      const middleware = this.middleware.get();\n      (updateElementWith || this.updateElementWith)(() => {\n        if(!middleware()) {\n          return;\n        }\n\n        // *             .    \n        this.onSort(element, idx);\n        /* if(this.get(id) === element) {\n          this.onSort(element, this.sorted.indexOf(element));\n        } */\n      });\n    }\n  }\n}\n","export default function encodeEntities(value: string) {\n  return value.replace(/&/g, '&amp;').replace(/[\\uD800-\\uDBFF][\\uDC00-\\uDFFF]/g, (value) => {\n    const hi = value.charCodeAt(0);\n    const low = value.charCodeAt(1);\n    return '&#' + (((hi - 0xD800) * 0x400) + (low - 0xDC00) + 0x10000) + ';';\n  }).replace(/([^\\#-~| |!])/g, (value) => { // non-alphanumeric\n    return '&#' + value.charCodeAt(0) + ';';\n  }).replace(/</g, '&lt;').replace(/>/g, '&gt;');\n}\n","// credits to https://github.com/sindresorhus/escape-string-regexp/blob/master/index.js\nexport default function escapeRegExp(str: string) {\n  return str\n  .replace(/[|\\\\{}()[\\]^$+*?.]/g, '\\\\$&')\n  .replace(/-/g, '\\\\x2d');\n}\n","export default function limitSymbols(str: string, length: number, limitFrom = length + 10) {\n  str = str.trim();\n  if(str.length > limitFrom) {\n    str = str.slice(0, length)/* .replace(/\\s*$/, '') */ + '...';\n  }\n\n  return str;\n}\n","export default function toHHMMSS(str: string | number, leadZero = false) {\n  const sec_num = parseInt(str + '', 10);\n  const hours = Math.floor(sec_num / 3600);\n  let minutes: any = Math.floor((sec_num - (hours * 3600)) / 60);\n  let seconds: any = sec_num - (hours * 3600) - (minutes * 60);\n\n  if(hours) leadZero = true;\n  if(minutes < 10) minutes = leadZero ? '0' + minutes : minutes;\n  if(seconds < 10) seconds = '0' + seconds;\n  return (hours ? /* ('0' + hours).slice(-2) */hours + ':' : '') + minutes + ':' + seconds;\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport {IS_WORKER} from './context';\n\nexport class WindowSize {\n  public width: number;\n  public height: number;\n\n  constructor() {\n    if(IS_WORKER) {\n      return;\n    }\n\n    // @ts-ignore\n    const w: any = 'visualViewport' in window ? window.visualViewport : window;\n    const set = () => {\n      this.width = w.width || w.innerWidth;\n      this.height = w.height || w.innerHeight;\n    };\n    w.addEventListener('resize', set);\n    set();\n  }\n}\n\nconst windowSize = new WindowSize();\nexport default windowSize;\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\n// * Jolly Cobra's useHeavyAnimationCheck.ts, patched\r\n\r\nimport {AnyToVoidFunction} from '../types';\r\nimport ListenerSetter from '../helpers/listenerSetter';\r\nimport deferredPromise, {CancellablePromise} from '../helpers/cancellablePromise';\r\nimport DEBUG from '../config/debug';\r\nimport pause from '../helpers/schedulers/pause';\r\nimport EventListenerBase from '../helpers/eventListenerBase';\r\n\r\nconst eventListener = new EventListenerBase<{\r\n  start: () => void,\r\n  end: () => void\r\n}>();\r\nconst ANIMATION_START_EVENT = 'start';\r\nconst ANIMATION_END_EVENT = 'end';\r\n\r\nlet isAnimating = false;\r\nlet heavyAnimationPromise: CancellablePromise<void> = deferredPromise<void>();\r\nlet promisesInQueue = 0;\r\n\r\nheavyAnimationPromise.resolve();\r\n\r\nconst log = console.log.bind(console.log, '[HEAVY-ANIMATION]:');\r\n\r\nexport function dispatchHeavyAnimationEvent(promise: Promise<any>, timeout?: number) {\r\n  if(!isAnimating) {\r\n    heavyAnimationPromise = deferredPromise<void>();\r\n    eventListener.dispatchEvent(ANIMATION_START_EVENT);\r\n    isAnimating = true;\r\n    DEBUG && log('start');\r\n  }\r\n\r\n  ++promisesInQueue;\r\n  DEBUG && log('attach promise, length:', promisesInQueue, timeout);\r\n\r\n  const promises = [\r\n    timeout !== undefined ? pause(timeout) : undefined,\r\n    promise.finally(() => {})\r\n  ].filter(Boolean);\r\n\r\n  const perf = performance.now();\r\n  const _heavyAnimationPromise = heavyAnimationPromise;\r\n  Promise.race(promises).then(() => {\r\n    if(heavyAnimationPromise !== _heavyAnimationPromise || heavyAnimationPromise.isFulfilled) { // interrupted\r\n      return;\r\n    }\r\n\r\n    --promisesInQueue;\r\n    DEBUG && log('promise end, length:', promisesInQueue, performance.now() - perf);\r\n    if(promisesInQueue <= 0) {\r\n      onHeavyAnimationEnd();\r\n    }\r\n  });\r\n\r\n  return heavyAnimationPromise;\r\n}\r\n\r\nfunction onHeavyAnimationEnd() {\r\n  if(heavyAnimationPromise.isFulfilled) {\r\n    return;\r\n  }\r\n\r\n  isAnimating = false;\r\n  promisesInQueue = 0;\r\n  eventListener.dispatchEvent(ANIMATION_END_EVENT);\r\n  heavyAnimationPromise.resolve();\r\n\r\n  DEBUG && log('end');\r\n}\r\n\r\nexport function interruptHeavyAnimation() {\r\n  onHeavyAnimationEnd();\r\n}\r\n\r\nexport function getHeavyAnimationPromise() {\r\n  return heavyAnimationPromise;\r\n}\r\n\r\nexport default function(\r\n  handleAnimationStart: AnyToVoidFunction,\r\n  handleAnimationEnd: AnyToVoidFunction,\r\n  listenerSetter?: ListenerSetter\r\n) {\r\n  // useEffect(() => {\r\n  if(isAnimating) {\r\n    handleAnimationStart();\r\n  }\r\n\r\n  const add = listenerSetter ? listenerSetter.add(eventListener) : eventListener.addEventListener.bind(eventListener);\r\n  const remove = listenerSetter ? listenerSetter.removeManual.bind(listenerSetter, eventListener) : eventListener.removeEventListener.bind(eventListener);\r\n  add(ANIMATION_START_EVENT, handleAnimationStart);\r\n  add(ANIMATION_END_EVENT, handleAnimationEnd);\r\n\r\n  return () => {\r\n    remove(ANIMATION_END_EVENT, handleAnimationEnd);\r\n    remove(ANIMATION_START_EVENT, handleAnimationStart);\r\n  };\r\n  // }, [handleAnimationEnd, handleAnimationStart]);\r\n}\r\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport appDialogsManager, {DIALOG_LIST_ELEMENT_TAG} from '../lib/appManagers/appDialogsManager';\nimport type {Dialog} from '../lib/appManagers/appMessagesManager';\nimport rootScope from '../lib/rootScope';\nimport ButtonMenu, {ButtonMenuItemOptions} from './buttonMenu';\nimport PopupDeleteDialog from './popups/deleteDialog';\nimport {i18n} from '../lib/langPack';\nimport findUpTag from '../helpers/dom/findUpTag';\nimport PopupPeer from './popups/peer';\nimport AppChatFoldersTab from './sidebarLeft/tabs/chatFolders';\nimport appSidebarLeft from './sidebarLeft';\nimport {toastNew} from './toast';\nimport PopupMute from './popups/mute';\nimport {AppManagers} from '../lib/appManagers/managers';\nimport positionMenu from '../helpers/positionMenu';\nimport contextMenuController from '../helpers/contextMenuController';\n\nexport default class DialogsContextMenu {\n  private element: HTMLElement;\n  private buttons: (ButtonMenuItemOptions & {verify: () => boolean | Promise<boolean>})[];\n\n  private selectedId: PeerId;\n  private filterId: number;\n  private dialog: Dialog;\n\n  constructor(private managers: AppManagers) {\n\n  }\n\n  private init() {\n    this.buttons = [{\n      icon: 'unread',\n      text: 'MarkAsUnread',\n      onClick: this.onUnreadClick,\n      verify: async() => !(await this.managers.appMessagesManager.isDialogUnread(this.dialog))\n    }, {\n      icon: 'readchats',\n      text: 'MarkAsRead',\n      onClick: this.onUnreadClick,\n      verify: () => this.managers.appMessagesManager.isDialogUnread(this.dialog)\n    }, {\n      icon: 'pin',\n      text: 'ChatList.Context.Pin',\n      onClick: this.onPinClick,\n      verify: async() => {\n        const isPinned = this.filterId > 1 ?\n          (await this.managers.appMessagesManager.getFilter(this.filterId)).pinnedPeerIds.includes(this.dialog.peerId) :\n          !!this.dialog.pFlags?.pinned;\n        return !isPinned;\n      }\n    }, {\n      icon: 'unpin',\n      text: 'ChatList.Context.Unpin',\n      onClick: this.onPinClick,\n      verify: async() => {\n        const isPinned = this.filterId > 1 ?\n          (await this.managers.appMessagesManager.getFilter(this.filterId)).pinnedPeerIds.includes(this.dialog.peerId) :\n          !!this.dialog.pFlags?.pinned;\n        return isPinned;\n      }\n    }, {\n      icon: 'mute',\n      text: 'ChatList.Context.Mute',\n      onClick: this.onMuteClick,\n      verify: async() => {\n        return this.selectedId !== rootScope.myId && !(await this.managers.appNotificationsManager.isPeerLocalMuted(this.dialog.peerId));\n      }\n    }, {\n      icon: 'unmute',\n      text: 'ChatList.Context.Unmute',\n      onClick: this.onUnmuteClick,\n      verify: async() => {\n        return this.selectedId !== rootScope.myId && (await this.managers.appNotificationsManager.isPeerLocalMuted(this.dialog.peerId));\n      }\n    }, {\n      icon: 'archive',\n      text: 'Archive',\n      onClick: this.onArchiveClick,\n      verify: () => this.filterId === 0 && this.selectedId !== rootScope.myId\n    }, {\n      icon: 'unarchive',\n      text: 'Unarchive',\n      onClick: this.onArchiveClick,\n      verify: () => this.filterId === 1 && this.selectedId !== rootScope.myId\n    }, {\n      icon: 'delete danger',\n      text: 'Delete',\n      onClick: this.onDeleteClick,\n      verify: () => true\n    }];\n\n    this.element = ButtonMenu(this.buttons);\n    this.element.id = 'dialogs-contextmenu';\n    this.element.classList.add('contextmenu');\n    document.getElementById('page-chats').append(this.element);\n  }\n\n  private onArchiveClick = async() => {\n    const dialog = await this.managers.appMessagesManager.getDialogOnly(this.selectedId);\n    if(dialog) {\n      this.managers.appMessagesManager.editPeerFolders([dialog.peerId], +!dialog.folder_id);\n    }\n  };\n\n  private onPinClick = () => {\n    this.managers.appMessagesManager.toggleDialogPin(this.selectedId, this.filterId).catch(async(err: ApiError) => {\n      if(err.type === 'PINNED_DIALOGS_TOO_MUCH') {\n        if(this.filterId >= 1) {\n          toastNew({langPackKey: 'PinFolderLimitReached'});\n        } else {\n          const config = await this.managers.apiManager.getConfig();\n          new PopupPeer('pinned-dialogs-too-much', {\n            buttons: [{\n              langKey: 'OK',\n              isCancel: true\n            }, {\n              langKey: 'FiltersSetupPinAlert',\n              callback: () => {\n                appSidebarLeft.createTab(AppChatFoldersTab).open();\n              }\n            }],\n            descriptionLangKey: 'PinToTopLimitReached2',\n            descriptionLangArgs: [i18n('Chats', [config.pinned_dialogs_count_max])]\n          }).show();\n        }\n      }\n    });\n  };\n\n  private onUnmuteClick = () => {\n    this.managers.appMessagesManager.togglePeerMute(this.selectedId, false);\n  };\n\n  private onMuteClick = () => {\n    new PopupMute(this.selectedId);\n  };\n\n  private onUnreadClick = async() => {\n    const selectedId = this.selectedId;\n    const dialog = await this.managers.appMessagesManager.getDialogOnly(selectedId);\n    if(!dialog) return;\n\n    if(dialog.unread_count) {\n      this.managers.appMessagesManager.readHistory(selectedId, dialog.top_message);\n      this.managers.appMessagesManager.markDialogUnread(selectedId, true);\n    } else {\n      this.managers.appMessagesManager.markDialogUnread(selectedId);\n    }\n  };\n\n  private onDeleteClick = () => {\n    new PopupDeleteDialog(this.selectedId/* , 'delete' */);\n  };\n\n  onContextMenu = (e: MouseEvent | Touch) => {\n    if(this.init) {\n      this.init();\n      this.init = null;\n    }\n\n    let li: HTMLElement = null;\n\n    try {\n      li = findUpTag(e.target, DIALOG_LIST_ELEMENT_TAG);\n    } catch(e) {}\n\n    if(!li) return;\n\n    if(e instanceof MouseEvent) e.preventDefault();\n    if(this.element.classList.contains('active')) {\n      return false;\n    }\n    if(e instanceof MouseEvent) e.cancelBubble = true;\n\n    const r = async() => {\n      this.filterId = appDialogsManager.filterId;\n      this.selectedId = li.dataset.peerId.toPeerId();\n      this.dialog = await this.managers.appMessagesManager.getDialogOnly(this.selectedId);\n\n      await Promise.all(this.buttons.map(async(button) => {\n        const good = await button.verify();\n\n        button.element.classList.toggle('hide', !good);\n      }));\n\n      // delete button\n      this.buttons[this.buttons.length - 1].element.lastChild.replaceWith(i18n(await this.managers.appPeersManager.getDeleteButtonText(this.selectedId)));\n\n      li.classList.add('menu-open');\n      positionMenu(e, this.element);\n      contextMenuController.openBtnMenu(this.element, () => {\n        li.classList.remove('menu-open');\n        this.selectedId = this.dialog = this.filterId = undefined;\n      });\n    };\n\n    r();\n  };\n}\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport App from '../config/app';\r\nimport DEBUG from '../config/debug';\r\nimport replaceContent from '../helpers/dom/replaceContent';\r\nimport {LangPackKey, i18n} from '../lib/langPack';\r\nimport {logger} from '../lib/logger';\r\nimport rootScope from '../lib/rootScope';\r\nimport Button from './button';\r\nimport ProgressivePreloader from './preloader';\r\nimport SetTransition from './singleTransition';\r\nimport sessionStorage from '../lib/sessionStorage';\r\nimport {ConnectionStatus} from '../lib/mtproto/connectionStatus';\r\nimport cancelEvent from '../helpers/dom/cancelEvent';\r\nimport {attachClickEvent} from '../helpers/dom/clickEvent';\r\nimport {AppManagers} from '../lib/appManagers/managers';\r\nimport singleInstance from '../lib/mtproto/singleInstance';\r\n\r\nexport default class ConnectionStatusComponent {\r\n  public static CHANGE_STATE_DELAY = 1000;\r\n\r\n  private statusContainer: HTMLElement;\r\n  private statusEl: HTMLElement;\r\n  private statusPreloader: ProgressivePreloader;\r\n\r\n  private currentLangPackKey: LangPackKey;\r\n\r\n  private hadConnect = false;\r\n  private retryAt: number;\r\n  private connecting = false;\r\n  private timedOut = false;\r\n  private updating = false;\r\n\r\n  private log: ReturnType<typeof logger>;\r\n\r\n  private setFirstConnectionTimeout: number;\r\n  private setStateTimeout: number;\r\n\r\n  constructor(private managers: AppManagers, chatsContainer: HTMLElement) {\r\n    this.log = logger('CS', undefined, undefined);\r\n\r\n    this.statusContainer = document.createElement('div');\r\n    this.statusContainer.classList.add('connection-status'/* , 'hide' */);\r\n\r\n    this.statusEl = Button('btn-primary bg-warning connection-status-button', {noRipple: true});\r\n    this.statusPreloader = new ProgressivePreloader({cancelable: false});\r\n    this.statusPreloader.constructContainer({color: 'transparent', bold: true});\r\n    this.statusContainer.append(this.statusEl);\r\n\r\n    chatsContainer.prepend(this.statusContainer);\r\n\r\n    rootScope.addEventListener('connection_status_change', (status) => {\r\n      // console.log(status);\r\n\r\n      this.setConnectionStatus();\r\n    });\r\n\r\n    rootScope.addEventListener('state_synchronizing', (channelId) => {\r\n      if(!channelId) {\r\n        this.updating = true;\r\n        DEBUG && this.log('updating', this.updating);\r\n        this.setState();\r\n      }\r\n    });\r\n\r\n    rootScope.addEventListener('state_synchronized', (channelId) => {\r\n      DEBUG && this.log('state_synchronized', channelId);\r\n      if(!channelId) {\r\n        this.updating = false;\r\n        DEBUG && this.log('updating', this.updating);\r\n        this.setState();\r\n      }\r\n    });\r\n\r\n    this.setFirstConnectionTimeout = window.setTimeout(this.setConnectionStatus, ConnectionStatusComponent.CHANGE_STATE_DELAY + 1e3);\r\n\r\n    /* let bool = true;\r\n    document.addEventListener('dblclick', () => {\r\n      const dcId = 2;\r\n      rootScope.dispatchEvent('connection_status_change', {\r\n        dcId: dcId,\r\n        isFileDownload: false,\r\n        isFileNetworker: false,\r\n        isFileUpload: false,\r\n        name: \"NET-\" + dcId,\r\n        status: bool ? (bool = false, ConnectionStatus.Closed) : (bool = true, ConnectionStatus.Connected),\r\n        _: \"networkerStatus\"\r\n      });\r\n    }); */\r\n  }\r\n\r\n  private setConnectionStatus = () => {\r\n    Promise.all([\r\n      sessionStorage.get('dc'),\r\n      rootScope.managers.rootScope.getConnectionStatus()\r\n    ]).then(([baseDcId, connectionStatus]) => {\r\n      if(!baseDcId) {\r\n        baseDcId = App.baseDcId;\r\n      }\r\n\r\n      if(this.setFirstConnectionTimeout) {\r\n        clearTimeout(this.setFirstConnectionTimeout);\r\n        this.setFirstConnectionTimeout = 0;\r\n      }\r\n\r\n      const status = connectionStatus['NET-' + baseDcId];\r\n      const online = status && status.status === ConnectionStatus.Connected;\r\n\r\n      if(this.connecting && online) {\r\n        this.managers.apiUpdatesManager.forceGetDifference();\r\n      }\r\n\r\n      if(online && !this.hadConnect) {\r\n        this.hadConnect = true;\r\n      }\r\n\r\n      this.timedOut = status && status.status === ConnectionStatus.TimedOut;\r\n      this.connecting = !online;\r\n      this.retryAt = status && status.retryAt;\r\n      DEBUG && this.log('connecting', this.connecting);\r\n      this.setState();\r\n    });\r\n  };\r\n\r\n  private setStatusText = (langPackKey: LangPackKey, args?: any[]) => {\r\n    if(this.currentLangPackKey === langPackKey) return;\r\n    this.currentLangPackKey = langPackKey;\r\n    replaceContent(this.statusEl, i18n(langPackKey, args));\r\n    this.statusPreloader.attach(this.statusEl);\r\n  };\r\n\r\n  private getA(langPackKey: LangPackKey, callback: () => void) {\r\n    const a = document.createElement('a');\r\n    a.classList.add('force-reconnect');\r\n    a.append(i18n(langPackKey));\r\n    attachClickEvent(a, (e) => {\r\n      cancelEvent(e);\r\n      callback();\r\n    });\r\n\r\n    return a;\r\n  }\r\n\r\n  private setState = () => {\r\n    if(singleInstance.deactivatedReason) {\r\n      return;\r\n    }\r\n\r\n    const timeout = ConnectionStatusComponent.CHANGE_STATE_DELAY;\r\n    if(this.connecting) {\r\n      if(this.timedOut) {\r\n        const a = this.getA('ConnectionStatus.ForceReconnect', () => this.managers.networkerFactory.forceReconnect());\r\n        this.setStatusText('ConnectionStatus.TimedOut', [a]);\r\n      } else if(this.hadConnect) {\r\n        if(this.retryAt !== undefined) {\r\n          const timerSpan = document.createElement('span');\r\n          const retryAt = this.retryAt;\r\n          const setTime = () => {\r\n            const now = Date.now();\r\n            timerSpan.innerText = '' + Math.round((retryAt - now) / 1000);\r\n            if(now > retryAt) {\r\n              clearInterval(interval);\r\n            }\r\n          };\r\n          const interval = setInterval(setTime, 1e3);\r\n          setTime();\r\n\r\n          const a = this.getA('ConnectionStatus.Reconnect', () => this.managers.networkerFactory.forceReconnectTimeout());\r\n          this.setStatusText('ConnectionStatus.ReconnectIn', [timerSpan, a]);\r\n        } else {\r\n          this.setStatusText('ConnectionStatus.Reconnecting');\r\n        }\r\n      } else {\r\n        this.setStatusText('ConnectionStatus.Waiting');\r\n      }\r\n    } else if(this.updating) {\r\n      this.setStatusText('Updating');\r\n    }\r\n\r\n    DEBUG && this.log('setState', this.connecting || this.updating);\r\n    window.requestAnimationFrame(() => {\r\n      if(this.setStateTimeout) clearTimeout(this.setStateTimeout);\r\n\r\n      const cb = () => {\r\n        SetTransition(this.statusContainer, 'is-shown', this.connecting || this.updating, 200);\r\n        this.setStateTimeout = 0;\r\n        DEBUG && this.log('setState: isShown:', this.connecting || this.updating);\r\n      };\r\n\r\n      this.setStateTimeout = window.setTimeout(cb, timeout);\r\n      // cb();\r\n      /* if(timeout) this.setStateTimeout = window.setTimeout(cb, timeout);\r\n      else cb(); */\r\n    });\r\n  };\r\n}\r\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport {Message} from '../layer';\n/* import findUpClassName from \"../helpers/dom/findUpClassName\";\nimport rootScope from \"../lib/rootScope\";\nimport Transition from \"./transition\"; */\n\nexport enum SENDING_STATUS {\n  Error = -1,\n  Pending,\n  Sent,\n  Read\n}\n\nexport function getSendingStatus(message: Message.message | Message.messageService) {\n  return message.pFlags.is_outgoing ?\n    SENDING_STATUS.Pending : (\n      message.pFlags.unread ?\n      SENDING_STATUS.Sent :\n      SENDING_STATUS.Read\n    );\n}\n\nexport function setSendingStatus(\n  container: HTMLElement,\n  message?: Message.message | Message.messageService,\n  disableAnimationIfRippleFound?: boolean\n) {\n  let className: 'check' | 'checks' | 'sending' | 'sendingerror';\n  if(message?.pFlags.out) {\n    if(message.error) {\n      className = 'sendingerror';\n    } else if(message.pFlags.is_outgoing) {\n      className = 'sending';\n    } else if(message.pFlags.unread) {\n      className = 'check';\n    } else {\n      className = 'checks';\n    }\n  }\n\n  if(!className) {\n    container.textContent = '';\n    return;\n  }\n\n  const iconClassName = 'tgico-' + className;\n  const lastElement = container.lastElementChild as HTMLElement;\n  if(lastElement && lastElement.classList.contains(iconClassName)) {\n    return;\n  }\n\n  const element = document.createElement('i');\n  element.classList.add('sending-status-icon', /* 'transition-item', */ iconClassName);\n  container.append(element);\n\n  if(lastElement) {\n    lastElement.remove();\n  }\n\n  /* if(!lastElement) {\n    element.classList.add('active');\n    return;\n  }\n\n  const select = Transition(container, undefined, 350, () => {\n    lastElement.remove();\n  }, false, true, false);\n\n  let animate = rootScope.settings.animationsEnabled && className !== 'sending' && !lastElement.classList.contains('tgico-sending');\n  if(disableAnimationIfRippleFound && animate) {\n    const parent = findUpClassName(container, 'rp');\n    if(parent.querySelector('.c-ripple__circle') || parent.matches(':hover')) {\n      animate = false;\n    }\n  }\n\n  select(element, animate, lastElement); */\n\n  /* SetTransition(lastElement, 'is-visible', false, 350, () => {\n    // lastElement.remove();\n  }, 2);\n  SetTransition(element, 'is-visible', true, 350, undefined, 2); */\n}\n","// https://spicyyoghurt.com/tools/easing-functions\nexport default function easeInOutSine(t: number, b: number, c: number, d: number) {\n  return t >= d ? b + c : -c / 2 * (Math.cos(Math.PI * t / d) - 1) + b;\n}\n","export default function roundRect(\n  ctx: CanvasRenderingContext2D,\n  x: number,\n  y: number,\n  width: number,\n  height: number,\n  radius: {[k in 'tl' | 'tr' | 'br' | 'bl']?: number} | number,\n  fill?: boolean,\n  stroke?: boolean\n) {\n  const dpr = ctx.canvas.dpr;\n  if(dpr) {\n    x *= dpr;\n    y *= dpr;\n    width *= dpr;\n    height *= dpr;\n  }\n\n  if(typeof(radius) === 'number') {\n    if(dpr) radius *= dpr;\n    radius = {tl: radius, tr: radius, br: radius, bl: radius};\n  } else {\n    const defaultRadius = {tl: 0, tr: 0, br: 0, bl: 0};\n    for(const side in defaultRadius) {\n      // @ts-ignore\n      radius[side] = radius[side] ? (dpr ? radius[side] * dpr : radius[side]) : defaultRadius[side];\n    }\n  }\n\n  ctx.beginPath();\n  ctx.moveTo(x + radius.tl, y);\n  ctx.lineTo(x + width - radius.tr, y);\n  ctx.quadraticCurveTo(x + width, y, x + width, y + radius.tr);\n  ctx.lineTo(x + width, y + height - radius.br);\n  ctx.quadraticCurveTo(x + width, y + height, x + width - radius.br, y + height);\n  ctx.lineTo(x + radius.bl, y + height);\n  ctx.quadraticCurveTo(x, y + height, x, y + height - radius.bl);\n  ctx.lineTo(x, y + radius.tl);\n  ctx.quadraticCurveTo(x, y, x + radius.tl, y);\n  ctx.closePath();\n\n  if(fill) {\n    ctx.fill();\n  }\n\n  if(stroke) {\n    ctx.stroke();\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport {animate} from '../helpers/animation';\nimport customProperties from '../helpers/dom/customProperties';\nimport easeInOutSine from '../helpers/easing/easeInOutSine';\nimport mediaSizes from '../helpers/mediaSizes';\nimport roundRect from '../helpers/canvas/roundRect';\n\nconst DPR = window.devicePixelRatio;\nconst SIZE = 20 * DPR;\nconst MARGIN = 2.5 * DPR;\nconst WIDTH = 2 * DPR;\nconst RADIUS = 1 * DPR;\nconst LENGTH = 3;\n\nconst MIN_HEIGHT = 4;\nconst MAX_HEIGHT = 12;\nconst DURATION = 1000;\n\nexport default function groupCallActiveIcon(isActive = false) {\n  const canvas = document.createElement('canvas');\n  canvas.width = canvas.height = SIZE;\n  const context = canvas.getContext('2d');\n\n  const TOTAL_WIDTH = LENGTH * WIDTH + (LENGTH - 1) * MARGIN;\n  const START_X = (SIZE - TOTAL_WIDTH) / 2;\n\n  const startTime = Date.now();\n  let wasMounted = false;\n  // let hadRound = false;\n  const renderFrame = () => {\n    if(!canvas.isConnected) {\n      if(wasMounted) {\n        return false;\n      }\n    } else if(!wasMounted) {\n      wasMounted = canvas.isConnected;\n    }\n\n    const time = Date.now();\n    // if(((time - startTime) / DURATION) >= 1) {\n    //   hadRound = true;\n    // }\n\n    const progress = easeInOutSine((time - startTime) % DURATION, 0, 1, DURATION);\n\n    context.clearRect(0, 0, SIZE, SIZE);\n    context.fillStyle = isActive && !mediaSizes.isMobile ? customProperties.getProperty('primary-color') : '#fff';\n\n    for(let i = 0; i < LENGTH; ++i) {\n      const x = START_X + (i * WIDTH) + (i * MARGIN);\n\n      let itemProgress: number;\n      if(progress >= .5) {\n        itemProgress = i % 2 ? 2 - progress * 2 : (progress - .5) * 2;\n      } else {\n        itemProgress = i % 2 ? progress * 2 : 1 - progress * 2;\n      }\n\n      let height = MIN_HEIGHT + (itemProgress * (MAX_HEIGHT - MIN_HEIGHT));\n      /* if(!hadRound && i === 1) {\n        console.log('call status animation', itemProgress, height, progress, progress >= .5);\n      } */\n\n      height *= DPR;\n      const y = (SIZE - height) / 2;\n\n      roundRect(context, x, y, WIDTH, height, RADIUS, true);\n    }\n\n    return true;\n  };\n\n  return {\n    canvas,\n    startAnimation: () => {\n      animate(renderFrame);\n      renderFrame();\n    },\n    setActive: (active: boolean) => {\n      isActive = active;\n      renderFrame();\n    }\n  };\n}\n","import customProperties from '../dom/customProperties';\nimport clamp from '../number/clamp';\n\nexport default class Shimmer {\n  private canvas: HTMLCanvasElement;\n  private ctx: CanvasRenderingContext2D;\n  private font = '30pt Helvetica';\n  private currTime = Date.now();\n  private diffTime = 0;\n  private spread = 0;\n  private paused = false;\n  private pausedTime = 0;\n  private pauseInterval = 850;\n  private lightSource = 0;\n  private inc = 0.032;\n  private lightSpread = 0.55;\n  private animations = ['slide', 'slide', 'slide', 'slide'];\n  private currentAnimationIndex = 0;\n  private text: string;\n  private fillStyle: CanvasRenderingContext2D['fillStyle'];\n\n  private keepTime() {\n    this.diffTime = Date.now() - this.currTime;\n    this.currTime = Date.now();\n  }\n\n  private cycleAnimation() {\n    ++this.currentAnimationIndex;\n    if(this.currentAnimationIndex >= this.animations.length) {\n      this.currentAnimationIndex = 0;\n    }\n  }\n\n  private animate() {\n    const currentAnimation = this.animations[this.currentAnimationIndex];\n    if(currentAnimation === 'glow') {\n      return this.animateGlow(); // return glow style\n    } else if(currentAnimation === 'slide') {\n      return this.animateSlide(); // return slide gradient\n    } else {\n      console.log('unknown animation type: ' + String(currentAnimation));\n    }\n  }\n\n  private animateGlow() {\n    var glowEnd = 255,\n      rgbStart = 68,\n      r = rgbStart,\n      g = r,\n      b = r,\n      increment = 10,\n      interval = 800;\n\n    return () => {\n      var smartInc = increment * (this.diffTime / (1000 / 60));\n      if(this.paused) {\n        if((Date.now() - this.pausedTime) > interval) {\n          r = rgbStart;\n          this.cycleAnimation()\n          this.paused = false;\n        }\n      } else {\n        r = parseInt('' + (r + smartInc));\n        if(r >= glowEnd) {\n          this.paused = true;\n          this.pausedTime = Date.now()\n        }\n      }\n      return 'rgb('+ r + ',' + r + ',' + r + ')';\n    };\n  }\n\n  private animateSlide(): CanvasGradient {\n    var gradient = this.ctx.createLinearGradient(0, 0, this.canvas.width, 0),\n      smartInc = this.inc * (this.diffTime / (1000 / 60)),\n      lightLeft,\n      lightRight,\n      lightCenter;\n    if(this.paused) {\n      if((Date.now() - this.pausedTime) > this.pauseInterval) {\n        this.lightSource = -0.6;\n        this.cycleAnimation()\n        this.paused = false;\n        return this.animateSlide();\n      }\n    } else {\n      this.lightSource += smartInc;\n      if(this.lightSource > (1 + this.lightSpread)) {\n        this.paused = true;\n        this.pausedTime = Date.now();\n      }\n    }\n    // lighting positions:\n    lightCenter = clamp(this.lightSource, 0, 1);\n    lightLeft = clamp(this.lightSource - this.lightSpread, 0, 1);\n    lightRight = clamp(this.lightSource + this.lightSpread, 0, 1);\n\n    const backgroundColor = customProperties.getProperty('background-color-true');\n    const shimmerColor = customProperties.getProperty('surface-color');\n    gradient.addColorStop(lightLeft, backgroundColor);\n    gradient.addColorStop(lightCenter, shimmerColor);\n    gradient.addColorStop(lightRight, backgroundColor);\n\n    return gradient;\n  }\n\n  public settings(dict: Partial<{\n    canvas: Shimmer['canvas'],\n    fillStyle: Shimmer['fillStyle'],\n    font: Shimmer['font'],\n    lightSpread: Shimmer['lightSpread'],\n    inc: Shimmer['inc'],\n    animations: Shimmer['animations'],\n    text: Shimmer['text']\n  }> = {}) {\n    this.canvas = dict.canvas ?? document.createElement('canvas');\n    this.ctx = this.canvas.getContext('2d');\n    this.font = dict.font ?? this.font;\n    this.lightSpread = dict.lightSpread ?? this.lightSpread;\n    this.inc = dict.inc ?? this.inc;\n    this.animations = dict.animations ?? this.animations;\n    this.text = dict.text ?? this.text;\n    this.fillStyle = dict.fillStyle;\n\n    this.canvas.classList.add('shimmer-canvas');\n  }\n\n  public on() {\n    const {width, height} = this.canvas;\n    // record the time we ran:\n    this.keepTime();\n    // clear and fill the canvas:\n    this.ctx.clearRect(0, 0, width, height);\n\n    if(this.font) {\n      this.ctx.font = this.font;\n    }\n\n    this.ctx.fillStyle = this.animate() as any;\n    this.ctx.fillRect(0, 0, width, height);\n\n    if(this.fillStyle) {\n      this.ctx.fillStyle = this.fillStyle;\n      this.ctx.fillRect(0, 0, width, height);\n    }\n\n    if(this.text) {\n      this.ctx.fillText(this.text, 50, 50);\n    }\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport Scrollable from '../components/scrollable';\nimport rootScope from '../lib/rootScope';\nimport {animate} from './animation';\nimport {drawCircleFromStart} from './canvas/drawCircle';\nimport roundRect from './canvas/roundRect';\nimport Shimmer from './canvas/shimmer';\nimport customProperties from './dom/customProperties';\nimport easeInOutSine from './easing/easeInOutSine';\nimport mediaSizes from './mediaSizes';\n\nexport default class DialogsPlaceholder {\n  private canvas: HTMLCanvasElement;\n  private ctx: CanvasRenderingContext2D;\n  private shimmer: Shimmer;\n  private tempId: number;\n  private detachTime: number;\n\n  private length: number;\n  private dialogHeight: number;\n  private availableLength: number;\n\n  private avatarSize: number;\n  private marginVertical: number;\n  private lineHeight: number;\n  private lineBorderRadius: number;\n  private lineMarginVertical: number;\n  private statusWidth: number;\n  private generatedValues: {\n    firstLineWidth: number,\n    secondLineWidth: number,\n    statusWidth: number\n  }[];\n\n  private getRectFrom: Element;\n  private onRemove: () => void;\n  private blockScrollable: Scrollable;\n\n  constructor() {\n    this.shimmer = new Shimmer();\n    this.tempId = 0;\n    this.canvas = document.createElement('canvas');\n    this.canvas.classList.add('dialogs-placeholder-canvas');\n    this.ctx = this.canvas.getContext('2d');\n\n    this.generatedValues = [];\n    this.avatarSize = 54;\n    this.marginVertical = 9;\n    this.lineHeight = 10;\n    this.lineBorderRadius = 6;\n    this.lineMarginVertical = 8;\n    this.statusWidth = 24;\n  }\n\n  public attach({container, rect, getRectFrom, onRemove, blockScrollable}: {\n    container: HTMLElement,\n    rect?: {width: number, height: number},\n    getRectFrom?: HTMLElement,\n    onRemove?: DialogsPlaceholder['onRemove'],\n    blockScrollable?: DialogsPlaceholder['blockScrollable']\n  }) {\n    const {canvas} = this;\n\n    this.onRemove = onRemove;\n    this.getRectFrom = getRectFrom || container;\n    if(this.blockScrollable = blockScrollable) {\n      blockScrollable.container.style.overflowY = 'hidden';\n    }\n\n    this.updateCanvasSize(rect);\n    this.startAnimation();\n    container.append(canvas);\n  }\n\n  public detach(availableLength: number) {\n    if(this.detachTime) {\n      return;\n    }\n\n    this.availableLength = availableLength;\n    this.detachTime = Date.now();\n\n    if(!rootScope.settings.animationsEnabled) {\n      this.remove();\n    }\n  }\n\n  public remove() {\n    this.stopAnimation();\n\n    if(this.canvas.parentElement) {\n      this.canvas.remove();\n\n      if(this.onRemove) {\n        this.onRemove();\n        this.onRemove = undefined;\n      }\n\n      if(this.blockScrollable) {\n        this.blockScrollable.container.style.overflowY = '';\n        this.blockScrollable = undefined;\n      }\n    }\n  }\n\n  private updateCanvasSize(rect: {width: number, height: number} = this.getRectFrom.getBoundingClientRect()) {\n    const {canvas} = this;\n    const dpr = canvas.dpr = window.devicePixelRatio;\n    canvas.width = rect.width * dpr;\n    canvas.height = rect.height * dpr;\n    canvas.style.width = rect.width + 'px';\n    canvas.style.height = rect.height + 'px';\n  }\n\n  private renderDetachAnimationFrame() {\n    const {\n      canvas,\n      ctx,\n      detachTime,\n      length,\n      availableLength\n    } = this;\n\n    if(!detachTime) {\n      return;\n    } else if(!rootScope.settings.animationsEnabled) {\n      this.remove();\n      return;\n    }\n\n    const {width} = canvas;\n\n    ctx.globalCompositeOperation = 'destination-out';\n\n    // ctx.fillStyle = 'rgba(0, 0, 0, 0)';\n    // ctx.fillRect(0, 0, width, height);\n\n    // const DURATION = 500;\n    // const DELAY = DURATION;\n    const DURATION = 150;\n    const DELAY = 15;\n    const elapsedTime = Date.now() - detachTime;\n    let completed = true;\n    for(let i = 0; i < length; ++i) {\n      const delay = availableLength < length && i >= availableLength ? DELAY * (availableLength - 1) : DELAY * i;\n      const elapsedRowTime = elapsedTime - delay;\n      if(elapsedRowTime <= 0) {\n        completed = false;\n        continue;\n      }\n\n      const progress = easeInOutSine(elapsedRowTime, 0, 1, DURATION);\n\n      ctx.beginPath();\n      ctx.rect(0, this.dialogHeight * i, width, this.dialogHeight);\n      ctx.fillStyle = `rgba(0, 0, 0, ${progress})`;\n      ctx.fill();\n\n      if(progress < 1) {\n        completed = false;\n      }\n    }\n\n    // const totalRadius = Math.sqrt(width ** 2 + height ** 2);\n    // const gradient = ctx.createRadialGradient(\n    //   0, 0, 0,\n    //   0, 0, totalRadius);\n    // gradient.addColorStop(0, 'rgba(0, 0, 0, 1)');\n    // gradient.addColorStop(progress, 'rgba(0, 0, 0, 0)');\n    // gradient.addColorStop(1, 'rgba(0, 0, 0, 0)');\n\n    // const gradient = ctx.createLinearGradient(0, 0, 0, height);\n    // gradient.addColorStop(0, 'rgba(0, 0, 0, 1)');\n    // gradient.addColorStop(progress, 'rgba(0, 0, 0, 0)');\n    // gradient.addColorStop(1, 'rgba(0, 0, 0, 0)');\n\n    // ctx.fillStyle = gradient;\n    // ctx.fillRect(0, 0, width, height);\n\n    ctx.globalCompositeOperation = 'source-over';\n\n    if(completed) {\n      this.remove();\n    }\n  }\n\n  private renderFrame() {\n    this.shimmer.on();\n    this.renderDetachAnimationFrame();\n  }\n\n  private startAnimation() {\n    const {canvas, shimmer} = this;\n    const tempId = ++this.tempId;\n    const pattern = this.createPattern();\n\n    shimmer.settings({\n      canvas,\n      fillStyle: pattern\n    });\n\n    const middleware = () => {\n      return this.tempId === tempId;\n    };\n\n    this.renderFrame();\n    animate(() => {\n      if(!middleware()) {\n        return false;\n      }\n\n      // ! should've removed the loop if animations are disabled\n      if(rootScope.settings.animationsEnabled) {\n        this.renderFrame();\n      }\n\n      // ! tempId can be changed during renderFrame\n      return middleware();\n    });\n\n    rootScope.addEventListener('theme_change', this.onThemeChange);\n    mediaSizes.addEventListener('resize', this.onResize);\n  }\n\n  private stopAnimation() {\n    ++this.tempId;\n    rootScope.removeEventListener('theme_change', this.onThemeChange);\n    mediaSizes.removeEventListener('resize', this.onResize);\n  }\n\n  private onThemeChange = () => {\n    this.stopAnimation();\n    this.startAnimation();\n  };\n\n  private onResize = () => {\n    const {canvas} = this;\n    const {width, height, dpr} = canvas;\n    this.updateCanvasSize();\n    if(canvas.width === width && canvas.height === height && canvas.dpr === dpr) {\n      return;\n    }\n\n    this.stopAnimation();\n    this.startAnimation();\n  };\n\n  private createPattern() {\n    const {canvas, ctx} = this;\n\n    const patternCanvas = document.createElement('canvas');\n    const patternContext = patternCanvas.getContext('2d');\n    const dpr = canvas.dpr;\n    patternCanvas.dpr = dpr;\n    patternCanvas.width = canvas.width;\n    patternCanvas.height = canvas.height;\n\n    patternContext.fillStyle = customProperties.getProperty('surface-color');\n    patternContext.fillRect(0, 0, patternCanvas.width, patternCanvas.height);\n\n    patternContext.fillStyle = '#000';\n    patternContext.globalCompositeOperation = 'destination-out';\n\n    const dialogHeight = this.dialogHeight = (this.avatarSize + this.marginVertical * 2) * dpr;\n    const length = this.length = Math.ceil(canvas.height / dialogHeight);\n    for(let i = 0; i < length; ++i) {\n      this.drawChat(patternContext, i, i * dialogHeight);\n    }\n\n    return ctx.createPattern(patternCanvas, 'no-repeat');\n  }\n\n  private drawChat(ctx: CanvasRenderingContext2D, i: number, y: number) {\n    let generatedValues = this.generatedValues[i];\n    if(!generatedValues) {\n      generatedValues = this.generatedValues[i] = {\n        firstLineWidth: 40 + Math.random() * 100, // 120\n        secondLineWidth: 120 + Math.random() * 130, // 240\n        statusWidth: 24 + Math.random() * 16\n      };\n    }\n\n    const {\n      firstLineWidth,\n      secondLineWidth,\n      statusWidth\n    } = generatedValues;\n\n    const {canvas} = ctx;\n    const {dpr} = canvas;\n    y /= dpr;\n\n    const {\n      avatarSize,\n      marginVertical,\n      lineHeight,\n      lineBorderRadius,\n      lineMarginVertical\n    } = this;\n\n    let marginLeft = 17;\n    drawCircleFromStart(ctx, marginLeft, y + marginVertical, avatarSize / 2, true);\n\n    marginLeft += avatarSize + 10;\n    roundRect(ctx, marginLeft, y + marginVertical + lineMarginVertical, firstLineWidth, lineHeight, lineBorderRadius, true);\n    roundRect(ctx, marginLeft, y + marginVertical + avatarSize - lineHeight - lineMarginVertical, secondLineWidth, lineHeight, lineBorderRadius, true);\n\n    roundRect(ctx, canvas.width / dpr - 24 - statusWidth, y + marginVertical + lineMarginVertical, statusWidth, lineHeight, lineBorderRadius, true);\n  }\n}\n","export default function drawCircle(ctx: CanvasRenderingContext2D, x: number, y: number, radius: number, fill?: boolean, stroke?: boolean) {\n  const dpr = ctx.canvas.dpr;\n  if(dpr) {\n    x *= dpr;\n    y *= dpr;\n    radius *= dpr;\n  }\n\n  ctx.beginPath();\n  ctx.arc(x, y, radius, 0, 2 * Math.PI, false);\n  ctx.closePath();\n\n  if(fill) {\n    ctx.fill();\n  }\n\n  if(stroke) {\n    ctx.stroke();\n  }\n}\n\nexport function drawCircleFromStart(ctx: CanvasRenderingContext2D, x: number, y: number, radius: number, fill?: boolean, stroke?: boolean) {\n  return drawCircle(ctx, x + radius, y + radius, radius, fill, stroke);\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport type {MyDialogFilter as DialogFilter, MyDialogFilter} from '../storages/filters';\nimport type LazyLoadQueue from '../../components/lazyLoadQueue';\nimport type {Dialog, MyMessage} from './appMessagesManager';\nimport type {MyPhoto} from './appPhotosManager';\nimport type {MyDocument} from './appDocsManager';\nimport type {State} from '../../config/state';\nimport AvatarElement from '../../components/avatar';\nimport DialogsContextMenu from '../../components/dialogsContextMenu';\nimport {horizontalMenu} from '../../components/horizontalMenu';\nimport ripple from '../../components/ripple';\nimport Scrollable, {ScrollableX, SliceSides} from '../../components/scrollable';\nimport {formatDateAccordingToTodayNew} from '../../helpers/date';\nimport {IS_MOBILE_SAFARI, IS_SAFARI} from '../../environment/userAgent';\nimport {logger, LogTypes} from '../logger';\nimport rootScope from '../rootScope';\nimport appImManager from './appImManager';\nimport Button from '../../components/button';\nimport SetTransition from '../../components/singleTransition';\nimport {MyDraftMessage} from './appDraftsManager';\nimport DEBUG, {MOUNT_CLASS_TO} from '../../config/debug';\nimport PeerTitle from '../../components/peerTitle';\nimport I18n, {FormatterArguments, i18n, LangPackKey, _i18n} from '../langPack';\nimport findUpTag from '../../helpers/dom/findUpTag';\nimport lottieLoader from '../rlottie/lottieLoader';\nimport {wrapPhoto} from '../../components/wrappers';\nimport AppEditFolderTab from '../../components/sidebarLeft/tabs/editFolder';\nimport appSidebarLeft, {SettingSection} from '../../components/sidebarLeft';\nimport {attachClickEvent} from '../../helpers/dom/clickEvent';\nimport positionElementByIndex from '../../helpers/dom/positionElementByIndex';\nimport replaceContent from '../../helpers/dom/replaceContent';\nimport ConnectionStatusComponent from '../../components/connectionStatus';\nimport {renderImageFromUrlPromise} from '../../helpers/dom/renderImageFromUrl';\nimport {fastRafConventional, fastRafPromise} from '../../helpers/schedulers';\nimport SortedUserList from '../../components/sortedUserList';\nimport IS_TOUCH_SUPPORTED from '../../environment/touchSupport';\nimport handleTabSwipe from '../../helpers/dom/handleTabSwipe';\nimport windowSize from '../../helpers/windowSize';\nimport isInDOM from '../../helpers/dom/isInDOM';\nimport {setSendingStatus} from '../../components/sendingStatus';\nimport SortedList, {SortedElementBase} from '../../helpers/sortedList';\nimport debounce from '../../helpers/schedulers/debounce';\nimport {FOLDER_ID_ALL, FOLDER_ID_ARCHIVE, NULL_PEER_ID, REAL_FOLDERS, REAL_FOLDER_ID} from '../mtproto/mtproto_config';\nimport groupCallActiveIcon from '../../components/groupCallActiveIcon';\nimport {Chat, Message, NotifyPeer} from '../../layer';\nimport IS_GROUP_CALL_SUPPORTED from '../../environment/groupCallSupport';\nimport mediaSizes from '../../helpers/mediaSizes';\nimport appNavigationController, {NavigationItem} from '../../components/appNavigationController';\nimport assumeType from '../../helpers/assumeType';\nimport appMediaPlaybackController from '../../components/appMediaPlaybackController';\nimport setInnerHTML from '../../helpers/dom/setInnerHTML';\nimport {AppManagers} from './managers';\nimport appSidebarRight from '../../components/sidebarRight';\nimport PopupElement from '../../components/popups';\nimport choosePhotoSize from './utils/photos/choosePhotoSize';\nimport wrapEmojiText from '../richTextProcessor/wrapEmojiText';\nimport wrapMessageForReply from '../../components/wrappers/messageForReply';\nimport isMessageRestricted from './utils/messages/isMessageRestricted';\nimport getMediaFromMessage from './utils/messages/getMediaFromMessage';\nimport getMessageSenderPeerIdOrName from './utils/messages/getMessageSenderPeerIdOrName';\nimport wrapStickerEmoji from '../../components/wrappers/stickerEmoji';\nimport getDialogIndexKey from './utils/dialogs/getDialogIndexKey';\nimport getProxiedManagers from './getProxiedManagers';\nimport getDialogIndex from './utils/dialogs/getDialogIndex';\nimport {attachContextMenuListener} from '../../helpers/dom/attachContextMenuListener';\nimport deferredPromise, {CancellablePromise} from '../../helpers/cancellablePromise';\nimport wrapPeerTitle from '../../components/wrappers/peerTitle';\nimport middlewarePromise from '../../helpers/middlewarePromise';\nimport appDownloadManager from './appDownloadManager';\nimport groupCallsController from '../calls/groupCallsController';\nimport callsController from '../calls/callsController';\nimport cancelEvent from '../../helpers/dom/cancelEvent';\nimport noop from '../../helpers/noop';\nimport DialogsPlaceholder from '../../helpers/dialogsPlaceholder';\nimport pause from '../../helpers/schedulers/pause';\nimport apiManagerProxy from '../mtproto/mtprotoworker';\nimport filterAsync from '../../helpers/array/filterAsync';\nimport forEachReverse from '../../helpers/array/forEachReverse';\nimport indexOfAndSplice from '../../helpers/array/indexOfAndSplice';\nimport whichChild from '../../helpers/dom/whichChild';\n\nexport const DIALOG_LIST_ELEMENT_TAG = 'A';\n\nexport type DialogDom = {\n  avatarEl: AvatarElement,\n  captionDiv: HTMLDivElement,\n  titleSpan: HTMLSpanElement,\n  titleSpanContainer: HTMLSpanElement,\n  statusSpan: HTMLSpanElement,\n  lastTimeSpan: HTMLSpanElement,\n  unreadBadge: HTMLElement,\n  callIcon?: ReturnType<typeof groupCallActiveIcon>,\n  mentionsBadge?: HTMLElement,\n  lastMessageSpan: HTMLSpanElement,\n  containerEl: HTMLElement,\n  listEl: HTMLElement,\n  subtitleEl: HTMLElement,\n\n  setLastMessagePromise?: CancellablePromise<void>,\n  setUnreadMessagePromise?: CancellablePromise<void>\n};\n\ninterface SortedDialog extends SortedElementBase {\n  dom: DialogDom,\n  loadPromises?: Promise<any>[]\n}\n\nfunction setPromiseMiddleware<T extends {[smth in K as K]?: CancellablePromise<void>}, K extends keyof T>(obj: T, key: K) {\n  const oldPromise: CancellablePromise<void> = obj[key] as any;\n  if(oldPromise) {\n    oldPromise.reject();\n  }\n\n  // @ts-ignore\n  const deferred = obj[key] = deferredPromise<void>();\n  deferred.catch(() => {}).finally(() => {\n    if((obj[key] as any) === deferred) {\n      delete obj[key];\n    }\n  });\n\n  const middleware = middlewarePromise(() => (obj[key] as any) === deferred);\n  return {deferred, middleware};\n}\n\nclass SortedDialogList extends SortedList<SortedDialog> {\n  constructor(\n    public managers: AppManagers,\n    public list: HTMLUListElement,\n    public indexKey: ReturnType<typeof getDialogIndexKey>,\n    public onListLengthChange?: () => void\n  ) {\n    super({\n      getIndex: (element) => managers.dialogsStorage.getDialogIndex(element.id, this.indexKey),\n      onDelete: (element) => {\n        element.dom.listEl.remove();\n        this.onListLengthChange && this.onListLengthChange();\n      },\n      onSort: (element, idx) => {\n        const willChangeLength = element.dom.listEl.parentElement !== this.list;\n        positionElementByIndex(element.dom.listEl, this.list, idx);\n\n        if(willChangeLength) {\n          this.onListLengthChange && this.onListLengthChange();\n        }\n      },\n      onElementCreate: (base, batch) => {\n        const loadPromises: Promise<any>[] = batch ? [] : undefined;\n\n        const {dom} = appDialogsManager.addListDialog({peerId: base.id, loadPromises, isBatch: batch});\n        (base as SortedDialog).dom = dom;\n\n        if(loadPromises?.length) {\n          (base as SortedDialog).loadPromises = loadPromises;\n          Promise.all(loadPromises).finally(() => {\n            delete (base as SortedDialog).loadPromises;\n          });\n        }\n\n        return base as SortedDialog;\n      },\n      updateElementWith: fastRafConventional\n    });\n  }\n\n  public clear() {\n    this.list.textContent = '';\n    super.clear();\n  }\n}\n\n// const testScroll = false;\n// let testTopSlice = 1;\n\nexport class AppDialogsManager {\n  private chatsContainer = document.getElementById('chatlist-container') as HTMLDivElement;\n\n  private loadDialogsPromise: Promise<{cached: boolean, renderPromise: AppDialogsManager['loadDialogsRenderPromise']}>;\n  private loadDialogsRenderPromise: Promise<void>;\n\n  private scroll: Scrollable = null;\n\n  private log = logger('DIALOGS', LogTypes.Log | LogTypes.Error | LogTypes.Warn | LogTypes.Debug);\n\n  private contextMenu: DialogsContextMenu;\n\n  private sortedList: SortedDialogList;\n  public placeholders: {[filterId: number]: DialogsPlaceholder} = {};\n  public sortedLists: {[filterId: number]: SortedDialogList} = {};\n  public scrollables: {[filterId: number]: Scrollable} = {};\n  public filterId: number;\n  private folders: {[k in 'menu' | 'container' | 'menuScrollContainer']: HTMLElement} = {\n    menu: document.getElementById('folders-tabs'),\n    menuScrollContainer: null,\n    container: document.getElementById('folders-container')\n  };\n  private filtersRendered: {\n    [filterId: string]: {\n      menu: HTMLElement,\n      container: HTMLElement,\n      unread: HTMLElement,\n      title: HTMLElement\n    }\n  } = {};\n  private showFiltersPromise: Promise<void>;\n\n  private sliceTimeout: number;\n\n  private lastActiveElements: Set<HTMLElement> = new Set();\n\n  private offsets: {top: number, bottom: number} = {top: 0, bottom: 0};\n\n  private loadContacts: () => void;\n  private processContact: (peerId: PeerId) => void;\n\n  private indexKey: ReturnType<typeof getDialogIndexKey>;\n\n  private initedListeners = false;\n\n  private onListLengthChange: () => Promise<void>;\n  private loadedDialogsAtLeastOnce = false;\n  private allChatsIntlElement: I18n.IntlElement;\n\n  private emptyDialogsPlaceholderSubtitle: I18n.IntlElement;\n  private updateContactsLengthPromise: Promise<number>;\n\n  private filtersNavigationItem: NavigationItem;\n\n  private managers: AppManagers;\n  private selectTab: ReturnType<typeof horizontalMenu>;\n\n  public start() {\n    const managers = this.managers = getProxiedManagers();\n\n    this.contextMenu = new DialogsContextMenu(managers);\n\n    this.folders.menuScrollContainer = this.folders.menu.parentElement;\n\n    this.onListLengthChange = debounce(this._onListLengthChange, 100, false, true);\n\n    const bottomPart = document.createElement('div');\n    bottomPart.classList.add('connection-status-bottom');\n    bottomPart.append(this.folders.container);\n\n    /* if(isTouchSupported && isSafari) {\n      let allowUp: boolean, allowDown: boolean, slideBeginY: number;\n      const container = this.scroll.container;\n      container.addEventListener('touchstart', (event) => {\n        allowUp = container.scrollTop > 0;\n        allowDown = (container.scrollTop < container.scrollHeight - container.clientHeight);\n        // @ts-ignore\n        slideBeginY = event.pageY;\n      });\n\n      container.addEventListener('touchmove', (event: any) => {\n        var up = (event.pageY > slideBeginY);\n        var down = (event.pageY < slideBeginY);\n        slideBeginY = event.pageY;\n        if((up && allowUp) || (down && allowDown)) {\n          event.stopPropagation();\n        } else if(up || down) {\n          event.preventDefault();\n        }\n      });\n    } */\n\n    if(IS_TOUCH_SUPPORTED) {\n      handleTabSwipe({\n        element: this.folders.container,\n        onSwipe: (xDiff) => {\n          const prevId = selectTab.prevId();\n          selectTab(xDiff > 0 ? prevId + 1 : prevId - 1);\n        }\n      });\n    }\n\n    this.allChatsIntlElement = new I18n.IntlElement({\n      key: 'FilterAllChatsShort'\n    });\n\n    /* if(testScroll) {\n      let i = 0;\n      let add = () => {\n        let li = document.createElement('li');\n        li.dataset.id = '' + i;\n        li.id = '' + i;\n        li.innerHTML = `<div class=\"rp\"><avatar-element style=\"background-color: rgb(166, 149, 231); font-size: 0px;\"><img src=\"assets/img/pepe.jpg\"></avatar-element><div class=\"user-caption\"><p><span class=\"user-title\">${i}</span><span><span class=\"message-status\"></span><span class=\"message-time\">18:33</span></span></p><p><span class=\"user-last-message\"><b>-_-_-_-: </b>qweasd</span><span></span></p></div></div>`;\n        i++;\n        this.scroll.append(li);\n      };\n      for(let i = 0; i < 500; ++i) {\n        add();\n      }\n      (window as any).addElement = add;\n    } */\n\n    rootScope.addEventListener('premium_toggle', async(isPremium) => {\n      if(isPremium) {\n        return;\n      }\n\n      const isFolderAvailable = await this.managers.filtersStorage.isFilterIdAvailable(this.filterId);\n      if(!isFolderAvailable) {\n        selectTab(whichChild(this.filtersRendered[FOLDER_ID_ALL].menu), false);\n      }\n    });\n\n    rootScope.addEventListener('state_cleared', () => {\n      const clearCurrent = REAL_FOLDERS.has(this.filterId);\n      // setTimeout(() =>\n      apiManagerProxy.getState().then(async(state) => {\n        this.loadedDialogsAtLeastOnce = false;\n\n        /* const clearPromises: Promise<any>[] = [];\n        for(const name in this.managers.appStateManager.storagesResults) {\n          const results = this.managers.appStateManager.storagesResults[name as keyof AppStateManager['storages']];\n          const storage = this.managers.appStateManager.storages[name as keyof AppStateManager['storages']];\n          results.length = 0;\n          clearPromises.push(storage.clear());\n        } */\n\n        if(clearCurrent) {\n          this.sortedList.clear();\n          this.onTabChange();\n        }\n\n        this.onStateLoaded(state);\n      })// , 5000);\n    });\n\n    this.setFilterId(FOLDER_ID_ALL, FOLDER_ID_ALL);\n    this.addFilter({\n      id: FOLDER_ID_ALL,\n      title: '',\n      localId: FOLDER_ID_ALL\n    });\n\n    const foldersScrollable = new ScrollableX(this.folders.menuScrollContainer);\n    bottomPart.prepend(this.folders.menuScrollContainer);\n    const selectTab = this.selectTab = horizontalMenu(this.folders.menu, this.folders.container, async(id, tabContent) => {\n      /* if(id !== 0) {\n        id += 1;\n      } */\n\n      const _id = id;\n      id = +tabContent.dataset.filterId || FOLDER_ID_ALL;\n\n      const isFilterAvailable = REAL_FOLDERS.has(id) || await this.managers.filtersStorage.isFilterIdAvailable(id);\n      if(!isFilterAvailable) {\n        return false;\n      }\n\n      const wasFilterId = this.filterId;\n      if(!IS_MOBILE_SAFARI) {\n        if(_id) {\n          if(!this.filtersNavigationItem) {\n            this.filtersNavigationItem = {\n              type: 'filters',\n              onPop: () => {\n                selectTab(0);\n                this.filtersNavigationItem = undefined;\n              }\n            };\n\n            appNavigationController.spliceItems(1, 0, this.filtersNavigationItem);\n          }\n        } else if(this.filtersNavigationItem) {\n          appNavigationController.removeItem(this.filtersNavigationItem);\n          this.filtersNavigationItem = undefined;\n        }\n      }\n\n      if(wasFilterId === id) return;\n\n      this.sortedLists[id].clear();\n      const promise = this.setFilterIdAndChangeTab(id).then(({cached, renderPromise}) => {\n        if(cached) {\n          return renderPromise;\n        }\n      });\n\n      if(wasFilterId !== -1) {\n        return promise;\n      }\n    }, () => {\n      for(const folderId in this.sortedLists) {\n        if(+folderId !== this.filterId) {\n          this.sortedLists[folderId].clear();\n          const placeholder = this.placeholders[folderId];\n          if(placeholder) {\n            placeholder.remove();\n          }\n        }\n      }\n    }, undefined, foldersScrollable);\n\n    apiManagerProxy.getState().then((state) => {\n      // * it should've had a better place :(\n      appMediaPlaybackController.setPlaybackParams(state.playbackParams);\n      appMediaPlaybackController.addEventListener('playbackParams', (params) => {\n        this.managers.appStateManager.pushToState('playbackParams', params);\n      });\n\n      return this.onStateLoaded(state);\n    })/* .then(() => {\n      const isLoadedMain = this.managers.appMessagesManager.dialogsStorage.isDialogsLoaded(0);\n      const isLoadedArchive = this.managers.appMessagesManager.dialogsStorage.isDialogsLoaded(1);\n      const wasLoaded = isLoadedMain || isLoadedArchive;\n      const a: Promise<any> = isLoadedMain ? Promise.resolve() : this.managers.appMessagesManager.getConversationsAll('', 0);\n      const b: Promise<any> = isLoadedArchive ? Promise.resolve() : this.managers.appMessagesManager.getConversationsAll('', 1);\n      a.finally(() => {\n        b.then(() => {\n          if(wasLoaded) {\n            (apiUpdatesManager.updatesState.syncLoading || Promise.resolve()).then(() => {\n              this.managers.appMessagesManager.refreshConversations();\n            });\n          }\n        });\n      });\n    }) */;\n\n    mediaSizes.addEventListener('resize', () => {\n      this.changeFiltersAllChatsKey();\n    });\n\n    new ConnectionStatusComponent(this.managers, this.chatsContainer);\n    this.chatsContainer.append(bottomPart);\n\n    setTimeout(() => {\n      lottieLoader.loadLottieWorkers();\n    }, 200);\n\n    PopupElement.MANAGERS = rootScope.managers = managers;\n    appDownloadManager.construct(managers);\n    appSidebarLeft.construct(managers);\n    appSidebarRight.construct(managers);\n    groupCallsController.construct(managers);\n    callsController.construct(managers);\n    appImManager.construct(managers);\n\n    // start\n\n    this.sortedList = this.sortedLists[this.filterId];\n    this.scroll = this.scrollables[this.filterId];\n\n    // selectTab(0, false);\n  }\n\n  public get chatList() {\n    return this.sortedList.list;\n  }\n\n  public setFilterId(filterId: number, localId: MyDialogFilter['localId']) {\n    this.filterId = filterId;\n    this.indexKey = getDialogIndexKey(REAL_FOLDERS.has(filterId) ? filterId as REAL_FOLDER_ID : localId);\n  }\n\n  public async setFilterIdAndChangeTab(filterId: number) {\n    this.filterId = filterId;\n    this.indexKey = await this.managers.dialogsStorage.getDialogIndexKeyByFilterId(filterId);\n    return this.onTabChange();\n  }\n\n  private setOnlineStatus(element: HTMLElement, online: boolean) {\n    const className = 'is-online';\n    const hasClassName = element.classList.contains(className);\n    !hasClassName && online && element.classList.add(className);\n    SetTransition(element, 'is-visible', online, 250, online ? undefined : () => {\n      element.classList.remove(className);\n    }, online && !hasClassName ? 2 : 0);\n  }\n\n  private initListeners() {\n    rootScope.addEventListener('user_update', async(userId) => {\n      // console.log('updating user:', user, dialog);\n\n      const peerId = userId.toPeerId();\n      const dom = this.getDialogDom(peerId);\n      if(dom && peerId !== rootScope.myId && !(await this.managers.appUsersManager.isBot(userId))) {\n        const user = await this.managers.appUsersManager.getUser(userId);\n        const online = user.status?._ === 'userStatusOnline';\n        this.setOnlineStatus(dom.avatarEl, online);\n      }\n    });\n\n    rootScope.addEventListener('chat_update', async(chatId) => {\n      const peerId = chatId.toPeerId(true);\n      const dialog = await this.managers.appMessagesManager.getDialogOnly(peerId);\n      if(dialog) {\n        this.processDialogForCallStatus(dialog);\n      }\n    });\n\n    rootScope.addEventListener('folder_unread', (folder) => {\n      this.setFilterUnreadCount(folder.id);\n    });\n\n    rootScope.addEventListener('contacts_update', (userId) => {\n      this.processContact && this.processContact(userId.toPeerId());\n    });\n\n    rootScope.addEventListener('dialog_flush', ({dialog}) => {\n      if(!dialog) {\n        return;\n      }\n\n      this.setLastMessageN({\n        dialog,\n        setUnread: true\n      });\n      this.validateDialogForFilter(dialog);\n      this.setFiltersUnreadCount();\n    });\n\n    rootScope.addEventListener('dialogs_multiupdate', (dialogs) => {\n      for(const [peerId, dialog] of dialogs) {\n        this.updateDialog(dialog);\n\n        if(this.processContact) {\n          this.processContact(peerId.toPeerId());\n        }\n\n        this.validateDialogForFilter(dialog);\n      }\n    });\n\n    rootScope.addEventListener('dialog_drop', ({peerId}) => {\n      this.deleteDialog(peerId);\n\n      if(this.processContact) {\n        this.processContact(peerId);\n      }\n    });\n\n    rootScope.addEventListener('dialog_unread', ({dialog}) => {\n      if(!dialog) {\n        return;\n      }\n\n      this.setUnreadMessagesN({dialog});\n      this.validateDialogForFilter(dialog);\n    });\n\n    rootScope.addEventListener('dialog_notify_settings', (dialog) => {\n      this.validateDialogForFilter(dialog);\n      this.setUnreadMessagesN({dialog}); //    ,    is-muted\n    });\n\n    rootScope.addEventListener('dialog_draft', ({dialog, drop, peerId}) => {\n      if(drop) {\n        this.sortedList.delete(peerId);\n      } else {\n        this.updateDialog(dialog);\n      }\n\n      if(this.processContact) {\n        this.processContact(peerId);\n      }\n    });\n\n    appImManager.addEventListener('peer_changed', (peerId) => {\n      // const perf = performance.now();\n      for(const element of this.lastActiveElements) {\n        if(element.dataset.peerId.toPeerId() !== peerId) {\n          this.setDialogActive(element, false);\n        }\n      }\n\n      const elements = Array.from(document.querySelectorAll(`[data-autonomous=\"0\"] .chatlist-chat[data-peer-id=\"${peerId}\"]`)) as HTMLElement[];\n      elements.forEach((element) => {\n        this.setDialogActive(element, true);\n      });\n      // this.log('peer_changed total time:', performance.now() - perf);\n    });\n\n    rootScope.addEventListener('filter_update', async(filter) => {\n      if(REAL_FOLDERS.has(filter.id)) {\n        return;\n      }\n\n      if(!this.filtersRendered[filter.id]) {\n        this.addFilter(filter);\n        return;\n      } else if(filter.id === this.filterId) { //     ,    dialogs_multiupdate\n        const dialogs = await this.managers.dialogsStorage.getCachedDialogs(true);\n        await this.validateListForFilter();\n        for(let i = 0, length = dialogs.length; i < length; ++i) {\n          const dialog = dialogs[i];\n          this.updateDialog(dialog);\n        }\n      }\n\n      const elements = this.filtersRendered[filter.id];\n      setInnerHTML(elements.title, wrapEmojiText(filter.title));\n    });\n\n    rootScope.addEventListener('filter_delete', (filter) => {\n      const elements = this.filtersRendered[filter.id];\n      if(!elements) return;\n\n      // set tab\n      // (this.folders.menu.firstElementChild.children[Math.max(0, filter.id - 2)] as HTMLElement).click();\n      elements.container.remove();\n      elements.menu.remove();\n\n      delete this.sortedLists[filter.id];\n      delete this.scrollables[filter.id];\n      delete this.filtersRendered[filter.id];\n\n      this.onFiltersLengthChange();\n\n      if(this.filterId === filter.id) {\n        this.selectTab(0, false);\n      }\n    });\n\n    rootScope.addEventListener('filter_order', async(order) => {\n      order = order.slice();\n      indexOfAndSplice(order, FOLDER_ID_ARCHIVE);\n\n      const containerToAppend = this.folders.menu as HTMLElement;\n      const r = await Promise.all(order.map(async(filterId) => {\n        return {\n          indexKey: await this.managers.dialogsStorage.getDialogIndexKeyByFilterId(filterId),\n          filter: await this.managers.filtersStorage.getFilter(filterId)\n        };\n      }));\n\n      order.forEach((filterId, idx) => {\n        const {indexKey, filter} = r[idx];\n        const renderedFilter = this.filtersRendered[filterId];\n\n        const sortedList = this.sortedLists[filterId];\n        sortedList.indexKey = indexKey;\n\n        positionElementByIndex(renderedFilter.menu, containerToAppend, filter.localId);\n        positionElementByIndex(renderedFilter.container, this.folders.container, filter.localId);\n      });\n\n      this.indexKey = await this.managers.dialogsStorage.getDialogIndexKeyByFilterId(this.filterId);\n\n      /* if(this.filterId) {\n        const tabIndex = order.indexOf(this.filterId) + 1;\n        selectTab.prevId = tabIndex;\n      } */\n    });\n\n    rootScope.addEventListener('peer_typings', async({peerId, typings}) => {\n      const dialog = await this.managers.appMessagesManager.getDialogOnly(peerId);\n      if(!dialog) return;\n\n      if(typings.length) {\n        this.setTyping(dialog);\n      } else {\n        this.unsetTyping(dialog);\n      }\n    });\n  }\n\n  private setDialogActive(listEl: HTMLElement, active: boolean) {\n    // @ts-ignore\n    const dom = listEl.dialogDom as DialogDom;\n    listEl.classList.toggle('active', active);\n    if(active) {\n      this.lastActiveElements.add(listEl);\n    } else {\n      this.lastActiveElements.delete(listEl);\n    }\n\n    if(dom?.callIcon) {\n      dom.callIcon.setActive(active);\n    }\n  }\n\n  private async onStateLoaded(state: State) {\n    const filtersArr = state.filtersArr;\n    const haveFilters = filtersArr.length > REAL_FOLDERS.size;\n    // const filter = filtersArr.find((filter) => filter.id !== FOLDER_ID_ARCHIVE);\n\n    const addFilters = (filters: MyDialogFilter[]) => {\n      for(const filter of filters) {\n        this.addFilter(filter);\n      }\n    };\n\n    let addFiltersPromise: Promise<any>;\n    if(haveFilters) {\n      addFilters(filtersArr);\n    } else {\n      addFiltersPromise = this.managers.filtersStorage.getDialogFilters().then(addFilters);\n    }\n\n    const loadDialogsPromise = this.onChatsScroll();\n    await loadDialogsPromise;\n    this.loadDialogsRenderPromise = undefined;\n\n    addFiltersPromise && await addFiltersPromise;\n    // this.folders.menu.children[0].classList.add('active');\n\n    this.filterId = -1;\n    this.selectTab(0, false);\n\n    if(!this.initedListeners) {\n      this.initListeners();\n      this.initedListeners = true;\n    }\n\n    haveFilters && this.showFiltersPromise && await this.showFiltersPromise;\n\n    this.managers.appNotificationsManager.getNotifyPeerTypeSettings();\n\n    await (await loadDialogsPromise).renderPromise.catch(noop);\n    this.managers.appMessagesManager.fillConversations();\n  }\n\n  /* private getOffset(side: 'top' | 'bottom'): {index: number, pos: number} {\n    if(!this.scroll.loadedAll[side]) {\n      const element = (side === 'top' ? this.chatList.firstElementChild : this.chatList.lastElementChild) as HTMLElement;\n      if(element) {\n        const peerId = element.dataset.peerId;\n        const dialog = this.managers.appMessagesManager.getDialogByPeerId(peerId);\n        return {index: dialog[0].index, pos: dialog[1]};\n      }\n    }\n\n    return {index: 0, pos: -1};\n  } */\n  private getOffsetIndex(side: 'top' | 'bottom') {\n    return {index: this.scroll.loadedAll[side] ? 0 : this.offsets[side]};\n  }\n\n  private isDialogMustBeInViewport(dialog: Dialog) {\n    if(dialog.migratedTo !== undefined || !this.testDialogForFilter(dialog)) return false;\n    // return true;\n    const topOffset = this.getOffsetIndex('top');\n    const bottomOffset = this.getOffsetIndex('bottom');\n\n    if(!topOffset.index && !bottomOffset.index) {\n      return true;\n    }\n\n    const index = getDialogIndex(dialog, this.indexKey);\n    return (!topOffset.index || index <= topOffset.index) && (!bottomOffset.index || index >= bottomOffset.index);\n  }\n\n  private deleteDialog(peerId: PeerId) {\n    this.sortedList.delete(peerId);\n  }\n\n  private updateDialog(dialog: Dialog) {\n    if(this.isDialogMustBeInViewport(dialog)) {\n      if(!this.sortedList.has(dialog.peerId)) {\n        this.sortedList.add(dialog.peerId);\n        return;\n      }\n    } else {\n      this.deleteDialog(dialog.peerId);\n      return;\n    }\n\n    const dom = this.getDialogDom(dialog.peerId);\n    if(dom) {\n      this.setLastMessageN({\n        dialog,\n        dom,\n        setUnread: true\n      });\n      this.sortedList.update(dialog.peerId);\n    }\n  }\n\n  public onTabChange = () => {\n    this.scroll = this.scrollables[this.filterId];\n    this.scroll.loadedAll.top = true;\n    this.scroll.loadedAll.bottom = false;\n    this.offsets.top = this.offsets.bottom = 0;\n    this.loadDialogsRenderPromise = undefined;\n    this.loadDialogsPromise = undefined;\n    this.sortedList = this.sortedLists[this.filterId];\n    return this.onChatsScroll();\n  };\n\n  private async setFilterUnreadCount(filterId: number) {\n    if(filterId === FOLDER_ID_ALL) {\n      return;\n    }\n\n    const unreadSpan = this.filtersRendered[filterId]?.unread;\n    if(!unreadSpan) {\n      return;\n    }\n\n    const {unreadUnmutedCount, unreadCount} = await this.managers.dialogsStorage.getFolderUnreadCount(filterId);\n    unreadSpan.classList.toggle('badge-gray', !unreadUnmutedCount);\n    unreadSpan.innerText = unreadCount ? '' + unreadCount : '';\n  }\n\n  private setFiltersUnreadCount() {\n    for(const filterId in this.filtersRendered) {\n      this.setFilterUnreadCount(+filterId);\n    }\n  }\n\n  /**\n   *     ,    (!)\n   */\n  private async validateListForFilter() {\n    this.sortedList.getAll().forEach(async(element) => {\n      const dialog = await this.managers.appMessagesManager.getDialogOnly(element.id);\n      if(!this.testDialogForFilter(dialog)) {\n        this.deleteDialog(element.id);\n      }\n    });\n  }\n\n  /**\n   *     ,    (!)\n   */\n  private validateDialogForFilter(dialog: Dialog) {\n    if(!this.getDialogDom(dialog.peerId)) {\n      return;\n    }\n\n    if(!this.testDialogForFilter(dialog)) {\n      this.deleteDialog(dialog.peerId);\n    }\n  }\n\n  public testDialogForFilter(dialog: Dialog) {\n    if(\n      !dialog ||\n      (!REAL_FOLDERS.has(this.filterId) ? getDialogIndex(dialog, this.indexKey) === undefined : this.filterId !== dialog.folder_id)\n      // (filter && !(await this.managers.filtersStorage.testDialogForFilter(dialog, filter)))\n    ) {\n      return false;\n    }\n\n    return true;\n  }\n\n  public generateScrollable(list: HTMLUListElement, filter: Parameters<AppDialogsManager['addFilter']>[0]) {\n    const filterId = filter.id;\n    const scrollable = new Scrollable(null, 'CL', 500);\n    scrollable.container.addEventListener('scroll', this.onChatsRegularScroll);\n    scrollable.container.dataset.filterId = '' + filterId;\n    scrollable.onScrolledTop = this.onChatsScrollTop;\n    scrollable.onScrolledBottom = this.onChatsScroll;\n    scrollable.setVirtualContainer(list);\n\n    const sortedDialogList = new SortedDialogList(\n      this.managers,\n      list,\n      getDialogIndexKey(filter.localId),\n      this.onListLengthChange\n    );\n\n    this.scrollables[filterId] = scrollable;\n    this.sortedLists[filterId] = sortedDialogList;\n\n    // list.classList.add('hide');\n    // scrollable.container.style.backgroundColor = '#' + (Math.random() * (16 ** 6 - 1) | 0).toString(16);\n\n    return scrollable;\n  }\n\n  private addFilter(filter: Pick<DialogFilter, 'title' | 'id' | 'localId'>) {\n    if(filter.id === FOLDER_ID_ARCHIVE) {\n      return;\n    }\n\n    const containerToAppend = this.folders.menu as HTMLElement;\n    const renderedFilter = this.filtersRendered[filter.id];\n    if(renderedFilter) {\n      positionElementByIndex(renderedFilter.menu, containerToAppend, filter.localId);\n      positionElementByIndex(renderedFilter.container, this.folders.container, filter.localId);\n      return;\n    }\n\n    const menuTab = document.createElement('div');\n    menuTab.classList.add('menu-horizontal-div-item');\n    const span = document.createElement('span');\n    const titleSpan = document.createElement('span');\n    titleSpan.classList.add('text-super');\n    if(filter.id === FOLDER_ID_ALL) titleSpan.append(this.allChatsIntlElement.element);\n    else setInnerHTML(titleSpan, wrapEmojiText(filter.title));\n    const unreadSpan = document.createElement('div');\n    unreadSpan.classList.add('badge', 'badge-20', 'badge-primary');\n    const i = document.createElement('i');\n    span.append(titleSpan, unreadSpan, i);\n    ripple(menuTab);\n    menuTab.append(span);\n\n    menuTab.dataset.filterId = '' + filter.id;\n\n    positionElementByIndex(menuTab, containerToAppend, filter.localId);\n    // containerToAppend.append(li);\n\n    const ul = this.createChatList();\n    const scrollable = this.generateScrollable(ul, filter);\n\n    scrollable.container.classList.add('tabs-tab', 'chatlist-parts');\n\n    /* const parts = document.createElement('div');\n    parts.classList.add('chatlist-parts'); */\n\n    const top = document.createElement('div');\n    top.classList.add('chatlist-top');\n\n    const bottom = document.createElement('div');\n    bottom.classList.add('chatlist-bottom');\n\n    top.append(ul);\n    scrollable.container.append(top, bottom);\n    /* parts.append(top, bottom);\n    scrollable.container.append(parts); */\n\n    const div = scrollable.container;\n    // this.folders.container.append(div);\n    positionElementByIndex(scrollable.container, this.folders.container, filter.localId);\n\n    this.setListClickListener(ul, null, true);\n\n    this.filtersRendered[filter.id] = {\n      menu: menuTab,\n      container: div,\n      unread: unreadSpan,\n      title: titleSpan\n    };\n\n    this.onFiltersLengthChange();\n  }\n\n  private changeFiltersAllChatsKey() {\n    const scrollable = this.folders.menuScrollContainer.firstElementChild;\n    const key: LangPackKey = scrollable.scrollWidth > scrollable.clientWidth ? 'FilterAllChatsShort' : 'FilterAllChats';\n    this.allChatsIntlElement.compareAndUpdate({key});\n  }\n\n  private onFiltersLengthChange() {\n    if(!this.showFiltersPromise) {\n      this.showFiltersPromise = new Promise<void>((resolve) => {\n        window.setTimeout(() => {\n          const length = Object.keys(this.filtersRendered).length;\n          const show = length > 1;\n          const wasShowing = !this.folders.menuScrollContainer.classList.contains('hide');\n\n          if(show !== wasShowing) {\n            this.folders.menuScrollContainer.classList.toggle('hide', !show);\n            if(show && !wasShowing) {\n              this.setFiltersUnreadCount();\n            }\n\n            this.chatsContainer.classList.toggle('has-filters', show);\n          }\n\n          this.changeFiltersAllChatsKey();\n\n          this.showFiltersPromise = undefined;\n          resolve();\n        }, 0);\n      });\n    }\n\n    return this.showFiltersPromise;\n  }\n\n  private loadDialogs(side: SliceSides) {\n    /* if(testScroll) {\n      return;\n    } */\n\n    this.log.warn('load', side);\n\n    if(this.loadDialogsPromise || this.loadDialogsRenderPromise/*  || 1 === 1 */) return this.loadDialogsPromise;\n    else if(this.scroll.loadedAll[side]) {\n      return Promise.resolve({\n        cached: true,\n        renderPromise: Promise.resolve()\n      });\n    }\n\n    const cachedInfoPromise = deferredPromise<boolean>();\n    const renderPromise = new Promise<void>(async(resolve, reject) => {\n      const {chatList, filterId, indexKey} = this;\n\n      // return;\n\n      // let loadCount = 30/*this.chatsLoadCount */;\n      let loadCount = windowSize.height / 72 * 1.25 | 0;\n      let offsetIndex = 0;\n\n      const {index: currentOffsetIndex} = this.getOffsetIndex(side);\n      if(currentOffsetIndex) {\n        if(side === 'top') {\n          const storage = await this.managers.dialogsStorage.getFolderDialogs(filterId, true);\n          const index = storage.findIndex((dialog) => getDialogIndex(dialog, indexKey) <= currentOffsetIndex);\n          const needIndex = Math.max(0, index - loadCount);\n          loadCount = index - needIndex;\n          offsetIndex = getDialogIndex(storage[needIndex], indexKey) + 1;\n        } else {\n          offsetIndex = currentOffsetIndex;\n        }\n      }\n\n      // let offset = storage[storage.length - 1]?.index || 0;\n\n      let placeholder = this.placeholders[filterId];\n      try {\n        const getConversationsResult = this.managers.acknowledged.appMessagesManager.getConversations('', offsetIndex, loadCount, filterId, true);\n        if(\n          !chatList.childElementCount &&\n          !placeholder &&\n          (\n            !this.loadedDialogsAtLeastOnce ||\n            !(await getConversationsResult).cached\n          )\n        ) {\n          placeholder = this.placeholders[filterId] = new DialogsPlaceholder();\n          const getRectFrom = filterId === FOLDER_ID_ARCHIVE ? this.chatsContainer : this.folders.container;\n          placeholder.attach({\n            container: chatList.parentElement,\n            getRectFrom,\n            onRemove: () => {\n              delete this.placeholders[filterId];\n            },\n            blockScrollable: this.scroll\n          });\n\n          cachedInfoPromise.resolve(false);\n        }\n\n        const a = await getConversationsResult;\n        const result = await a.result;\n        if(this.loadDialogsRenderPromise !== renderPromise) {\n          reject();\n          cachedInfoPromise.reject();\n          return;\n        }\n\n        cachedInfoPromise.resolve(a.cached);\n\n        // console.timeEnd('getDialogs time');\n\n        // * loaded all\n        // if(!result.dialogs.length || chatList.childElementCount === result.count) {\n        // !result.dialogs.length  ,      getConversations   .\n        // if(chatList.childElementCount === result.count) {\n        if(side === 'bottom') {\n          if(result.isEnd) {\n            this.scroll.loadedAll[side] = true;\n          }\n        } else if(result.isTopEnd) {\n          this.scroll.loadedAll[side] = true;\n        }\n\n        this.loadedDialogsAtLeastOnce = true;\n\n        if(result.dialogs.length) {\n          const dialogs = side === 'top' ? result.dialogs.slice().reverse() : result.dialogs;\n\n          const loadPromises: Promise<any>[] = [];\n\n          const callbacks: (() => void)[] = [];\n          const cccc = (callback: () => void) => {\n            callbacks.push(callback);\n          };\n\n          dialogs.forEach((dialog) => {\n            // :(\n            // const isBuggedDialog = !this.managers.appMessagesManager.getDialogOnly(dialog.peerId);\n            // if(isBuggedDialog) {\n            //   return;\n            // }\n\n            const element = this.sortedList.add(dialog.peerId, true, /* undefined, false,  */cccc, false);\n            if(element.loadPromises) {\n              loadPromises.push(...element.loadPromises);\n            }\n          });\n\n          loadPromises.push(fastRafPromise()); // it is needed here\n          await Promise.all(loadPromises).finally();\n          if(this.loadDialogsRenderPromise !== renderPromise) {\n            reject();\n            cachedInfoPromise.reject();\n            return;\n          }\n\n          callbacks.forEach((callback) => callback());\n        } else {\n          this.onListLengthChange();\n        }\n\n        const offsetDialog = result.dialogs[side === 'top' ? 0 : result.dialogs.length - 1];\n        if(offsetDialog) {\n          this.offsets[side] = getDialogIndex(offsetDialog, indexKey);\n        }\n\n        this.log.debug('getDialogs ' + loadCount + ' dialogs by offset:', offsetIndex, result, chatList.childElementCount);\n\n        setTimeout(() => {\n          this.scroll.onScroll();\n        }, 0);\n      } catch(err) {\n        this.log.error(err);\n      }\n\n      if(placeholder) {\n        // await pause(500);\n        placeholder.detach(chatList.childElementCount);\n      }\n\n      resolve();\n    }).finally(() => {\n      if(this.loadDialogsRenderPromise === renderPromise) {\n        this.loadDialogsRenderPromise = undefined;\n        this.loadDialogsPromise = undefined;\n      }\n    });\n\n    this.loadDialogsRenderPromise = renderPromise;\n    return this.loadDialogsPromise = cachedInfoPromise.then((cached) => ({\n      cached,\n      renderPromise\n    }));\n  }\n\n  private generateEmptyPlaceholder(options: {\n    title: LangPackKey,\n    subtitle?: LangPackKey,\n    subtitleArgs?: FormatterArguments,\n    classNameType: string\n  }) {\n    const BASE_CLASS = 'empty-placeholder';\n    const container = document.createElement('div');\n    container.classList.add(BASE_CLASS, BASE_CLASS + '-' + options.classNameType);\n\n    const header = document.createElement('div');\n    header.classList.add(BASE_CLASS + '-header');\n    _i18n(header, options.title);\n\n    const subtitle = document.createElement('div');\n    subtitle.classList.add(BASE_CLASS + '-subtitle');\n    if(options.subtitle) {\n      _i18n(subtitle, options.subtitle, options.subtitleArgs);\n    }\n\n    container.append(header, subtitle);\n\n    return {container, header, subtitle};\n  }\n\n  private checkIfPlaceholderNeeded() {\n    if(this.filterId === FOLDER_ID_ARCHIVE) {\n      return;\n    }\n\n    const chatList = this.chatList;\n    const part = chatList.parentElement as HTMLElement;\n    let placeholderContainer = (Array.from(part.children) as HTMLElement[]).find((el) => el.matches('.empty-placeholder'));\n    const needPlaceholder = this.scroll.loadedAll.bottom && !chatList.childElementCount/*  || true */;\n    // chatList.style.display = 'none';\n\n    if(needPlaceholder && placeholderContainer) {\n      return;\n    } else if(!needPlaceholder) {\n      if(placeholderContainer) {\n        part.classList.remove('with-placeholder');\n        placeholderContainer.remove();\n      }\n\n      return;\n    }\n\n    let placeholder: ReturnType<AppDialogsManager['generateEmptyPlaceholder']>, type: 'dialogs' | 'folder';\n    if(!this.filterId) {\n      placeholder = this.generateEmptyPlaceholder({\n        title: 'ChatList.Main.EmptyPlaceholder.Title',\n        classNameType: type = 'dialogs'\n      });\n\n      placeholderContainer = placeholder.container;\n\n      const img = document.createElement('img');\n      img.classList.add('empty-placeholder-dialogs-icon');\n\n      this.emptyDialogsPlaceholderSubtitle = new I18n.IntlElement({\n        element: placeholder.subtitle\n      });\n\n      Promise.all([\n        this.updateContactsLength(false),\n        renderImageFromUrlPromise(img, 'assets/img/EmptyChats.svg'),\n        fastRafPromise()\n      ]).then(([usersLength]) => {\n        placeholderContainer.classList.add('visible');\n        part.classList.toggle('has-contacts', !!usersLength);\n      });\n\n      placeholderContainer.prepend(img);\n    } else {\n      placeholder = this.generateEmptyPlaceholder({\n        title: 'FilterNoChatsToDisplay',\n        subtitle: 'FilterNoChatsToDisplayInfo',\n        classNameType: type = 'folder'\n      });\n\n      placeholderContainer = placeholder.container;\n\n      const div = document.createElement('div');\n      const emoji = '';\n      const size = 128;\n      wrapStickerEmoji({\n        div,\n        emoji: emoji,\n        width: size,\n        height: size\n      });\n\n      placeholderContainer.prepend(div);\n\n      const button = Button('btn-primary btn-color-primary btn-control tgico', {\n        text: 'FilterHeaderEdit',\n        icon: 'settings'\n      });\n\n      attachClickEvent(button, async() => {\n        appSidebarLeft.createTab(AppEditFolderTab).open(await this.managers.filtersStorage.getFilter(this.filterId));\n      });\n\n      placeholderContainer.append(button);\n    }\n\n    part.append(placeholderContainer);\n    part.classList.add('with-placeholder');\n    part.dataset.placeholderType = type;\n  }\n\n  private updateContactsLength(updatePartClassName: boolean) {\n    if(this.updateContactsLengthPromise) return this.updateContactsLengthPromise;\n    return this.updateContactsLengthPromise = this.managers.appUsersManager.getContacts().then((users) => {\n      const subtitle = this.emptyDialogsPlaceholderSubtitle;\n      if(subtitle) {\n        let key: LangPackKey, args: FormatterArguments;\n\n        if(users.length/*  && false */) {\n          key = 'ChatList.Main.EmptyPlaceholder.Subtitle';\n          args = [i18n('Contacts.Count', [users.length])];\n        } else {\n          key = 'ChatList.Main.EmptyPlaceholder.SubtitleNoContacts';\n          args = [];\n        }\n\n        subtitle.compareAndUpdate({\n          key,\n          args\n        });\n      }\n\n      if(updatePartClassName) {\n        const chatList = this.chatList;\n        const part = chatList.parentElement as HTMLElement;\n        part.classList.toggle('has-contacts', !!users.length);\n      }\n\n      this.updateContactsLengthPromise = undefined;\n\n      return users.length;\n    });\n  }\n\n  private removeContactsPlaceholder() {\n    const chatList = this.chatList;\n    const parts = chatList.parentElement.parentElement;\n    const bottom = chatList.parentElement.nextElementSibling as HTMLElement;\n    parts.classList.remove('with-contacts');\n    bottom.innerHTML = '';\n    this.loadContacts = undefined;\n    this.processContact = undefined;\n  }\n\n  private _onListLengthChange = () => {\n    if(!this.loadedDialogsAtLeastOnce) {\n      return;\n    }\n\n    this.checkIfPlaceholderNeeded();\n\n    if(this.filterId !== FOLDER_ID_ALL) return;\n\n    const chatList = this.chatList;\n    const count = chatList.childElementCount;\n\n    const parts = chatList.parentElement.parentElement;\n    const bottom = chatList.parentElement.nextElementSibling as HTMLElement;\n    const hasContacts = !!bottom.childElementCount;\n    if(count >= 10) {\n      if(hasContacts) {\n        this.removeContactsPlaceholder();\n      }\n\n      return;\n    } else if(hasContacts) return;\n\n    parts.classList.add('with-contacts');\n\n    const section = new SettingSection({\n      name: 'Contacts',\n      noDelimiter: true,\n      fakeGradientDelimiter: true\n    });\n\n    section.container.classList.add('hide');\n\n    this.managers.appUsersManager.getContactsPeerIds(undefined, undefined, 'online').then((contacts) => {\n      let ready = false;\n      const onListLengthChange = () => {\n        if(ready) {\n          section.container.classList.toggle('hide', !sortedUserList.list.childElementCount);\n        }\n\n        this.updateContactsLength(true);\n      };\n\n      const sortedUserList = new SortedUserList({\n        avatarSize: 42,\n        createChatListOptions: {\n          dialogSize: 48,\n          new: true\n        },\n        autonomous: false,\n        onListLengthChange,\n        managers: this.managers\n      });\n\n      this.loadContacts = () => {\n        const pageCount = windowSize.height / 60 | 0;\n        const promise = filterAsync(contacts.splice(0, pageCount), this.verifyPeerIdForContacts);\n\n        promise.then((arr) => {\n          arr.forEach((peerId) => {\n            sortedUserList.add(peerId);\n          });\n        });\n\n        if(!contacts.length) {\n          this.loadContacts = undefined;\n        }\n      };\n\n      this.loadContacts();\n\n      this.processContact = async(peerId) => {\n        if(peerId.isAnyChat()) {\n          return;\n        }\n\n        const good = await this.verifyPeerIdForContacts(peerId);\n        const added = sortedUserList.has(peerId);\n        if(!added && good) sortedUserList.add(peerId);\n        else if(added && !good) sortedUserList.delete(peerId);\n      };\n\n      const list = sortedUserList.list;\n      list.classList.add('chatlist-new');\n      this.setListClickListener(list);\n      section.content.append(list);\n\n      ready = true;\n      onListLengthChange();\n    });\n\n    bottom.append(section.container);\n  };\n\n  private verifyPeerIdForContacts = async(peerId: PeerId) => {\n    return await this.managers.appPeersManager.isContact(peerId) && !(await this.managers.appMessagesManager.getDialogOnly(peerId));\n  };\n\n  public onChatsRegularScroll = () => {\n    // return;\n\n    if(this.sliceTimeout) clearTimeout(this.sliceTimeout);\n    this.sliceTimeout = window.setTimeout(() => {\n      this.sliceTimeout = undefined;\n\n      if(!this.chatList.childElementCount || this.processContact) {\n        return;\n      }\n\n      /* const observer = new IntersectionObserver((entries) => {\n        const\n      });\n\n      Array.from(this.chatList.children).forEach((el) => {\n        observer.observe(el);\n      }); */\n\n      fastRafConventional(() => {\n        const perf = performance.now();\n\n        const scrollTopWas = this.scroll.scrollTop;\n\n        const firstElementChild = this.chatList.firstElementChild;\n        const rectContainer = this.scroll.container.getBoundingClientRect();\n        const rectTarget = firstElementChild.getBoundingClientRect();\n        const children = Array.from(this.scroll.splitUp.children) as HTMLElement[];\n\n        // const padding = 8;\n        // const offsetTop = this.folders.container.offsetTop;\n        let offsetTop = this.scroll.splitUp.offsetTop;\n        if(offsetTop && scrollTopWas < offsetTop) offsetTop -= scrollTopWas;\n        // const offsetTop = scrollTopWas < padding ? padding - scrollTopWas : 0;\n        const firstY = rectContainer.y + offsetTop;\n        const lastY = rectContainer.y/*  - 8 */; // 8px - .chatlist padding-bottom\n\n        const firstElement = findUpTag(document.elementFromPoint(Math.ceil(rectTarget.x), Math.ceil(firstY + 1)), firstElementChild.tagName) as HTMLElement;\n        const lastElement = findUpTag(document.elementFromPoint(Math.ceil(rectTarget.x), Math.floor(lastY + rectContainer.height - 1)), firstElementChild.tagName) as HTMLElement;\n\n        // alert('got element:' + rect.y);\n\n        if(!firstElement || !lastElement) {\n          return;\n        }\n\n        // alert('got element:' + !!firstElement);\n\n        const firstElementRect = firstElement.getBoundingClientRect();\n        const elementOverflow = firstElementRect.y - firstY;\n\n        const sliced: HTMLElement[] = [];\n        const firstIndex = children.indexOf(firstElement);\n        const lastIndex = children.indexOf(lastElement);\n\n        const saveLength = 10;\n\n        const sliceFromStart = IS_SAFARI ? [] : children.slice(0, Math.max(0, firstIndex - saveLength));\n        const sliceFromEnd = children.slice(lastIndex + saveLength);\n\n        /* if(sliceFromStart.length !== sliceFromEnd.length) {\n        console.log('not equal', sliceFromStart.length, sliceFromEnd.length);\n      }\n\n      if(sliceFromStart.length > sliceFromEnd.length) {\n        const diff = sliceFromStart.length - sliceFromEnd.length;\n        sliceFromStart.splice(0, diff);\n      } else if(sliceFromEnd.length > sliceFromStart.length) {\n        const diff = sliceFromEnd.length - sliceFromStart.length;\n        sliceFromEnd.splice(sliceFromEnd.length - diff, diff);\n      } */\n\n        if(sliceFromStart.length) {\n          this.scroll.loadedAll.top = false;\n        }\n\n        if(sliceFromEnd.length) {\n          this.scroll.loadedAll.bottom = false;\n        }\n\n        sliced.push(...sliceFromStart);\n        sliced.push(...sliceFromEnd);\n\n        sliced.forEach((el) => {\n          const peerId = el.dataset.peerId.toPeerId();\n          this.deleteDialog(peerId);\n        });\n\n        this.setOffsets();\n\n        // this.log('[slicer] elements', firstElement, lastElement, rect, sliced, sliceFromStart.length, sliceFromEnd.length);\n\n        // this.log('[slicer] reset scrollTop', this.scroll.scrollTop, firstElement.offsetTop, firstElementRect.y, rect.y, elementOverflow);\n\n        // alert('left length:' + children.length);\n\n        this.scroll.scrollTop = firstElement.offsetTop - elementOverflow;\n\n        this.log('slice time', performance.now() - perf);\n        /* const firstElementRect = firstElement.getBoundingClientRect();\n      const scrollTop =  */\n\n      // this.scroll.scrollIntoView(firstElement, false);\n      });\n    }, 200);\n  };\n\n  private async setOffsets() {\n    const chatList = this.chatList;\n    const firstDialog = await this.getDialogFromElement(chatList.firstElementChild as HTMLElement);\n    const lastDialog = await this.getDialogFromElement(chatList.lastElementChild as HTMLElement);\n\n    const indexKey = this.indexKey;\n    this.offsets.top = getDialogIndex(firstDialog, indexKey);\n    this.offsets.bottom = getDialogIndex(lastDialog, indexKey);\n  }\n\n  private getDialogFromElement(element: HTMLElement) {\n    return this.managers.appMessagesManager.getDialogOnly(element.dataset.peerId.toPeerId());\n  }\n\n  public onChatsScrollTop = () => {\n    return this.onChatsScroll('top');\n  };\n\n  public onChatsScroll = (side: SliceSides = 'bottom') => {\n    if(this.scroll.loadedAll[side]) {\n      if(this.loadContacts) {\n        this.loadContacts();\n      }\n    }\n\n    this.log('onChatsScroll', side);\n    return this.loadDialogs(side);\n  };\n\n  public setListClickListener(list: HTMLUListElement, onFound?: () => void, withContext = false, autonomous = false, openInner = false) {\n    let lastActiveListElement: HTMLElement;\n\n    const setPeerFunc = (openInner ? appImManager.setInnerPeer : appImManager.setPeer).bind(appImManager);\n\n    list.dataset.autonomous = '' + +autonomous;\n    list.addEventListener('mousedown', (e) => {\n      if(e.button !== 0) return;\n\n      this.log('dialogs click list');\n      const target = e.target as HTMLElement;\n      const elem = findUpTag(target, DIALOG_LIST_ELEMENT_TAG);\n\n      if(!elem) {\n        return;\n      }\n\n      const peerId = elem.dataset.peerId.toPeerId();\n\n      if(e.ctrlKey || e.metaKey) {\n        window.open((elem as HTMLAnchorElement).href || ('#' + peerId), '_blank');\n        cancelEvent(e);\n        return;\n      }\n\n      if(autonomous) {\n        const sameElement = lastActiveListElement === elem;\n        if(lastActiveListElement && !sameElement) {\n          lastActiveListElement.classList.remove('active');\n        }\n\n        if(elem) {\n          elem.classList.add('active');\n          lastActiveListElement = elem;\n          this.lastActiveElements.add(elem);\n        }\n      }\n\n      if(elem) {\n        if(onFound) onFound();\n\n        const lastMsgId = +elem.dataset.mid || undefined;\n\n        setPeerFunc({\n          peerId, lastMsgId\n        });\n      } else {\n        setPeerFunc();\n      }\n    }, {capture: true});\n\n    // cancel link click\n    // ! do not change it to attachClickEvent\n    list.addEventListener('click', (e) => {\n      if(e.button === 0) {\n        cancelEvent(e);\n      }\n    }, {capture: true});\n\n    if(DEBUG) {\n      list.addEventListener('dblclick', (e) => {\n        const li = findUpTag(e.target, DIALOG_LIST_ELEMENT_TAG);\n        if(li) {\n          const peerId = li.dataset.peerId.toPeerId();\n          this.log('debug dialog:', this.managers.appMessagesManager.getDialogByPeerId(peerId));\n        }\n      });\n    }\n\n    if(withContext) {\n      attachContextMenuListener(list, this.contextMenu.onContextMenu);\n    }\n  }\n\n  public createChatList(options: {\n    // avatarSize?: number,\n    // handheldsSize?: number,\n    // size?: number,\n    new?: boolean,\n    dialogSize?: number,\n    ignoreClick?: boolean\n  } = {}) {\n    const list = document.createElement('ul');\n    list.classList.add('chatlist'/* ,\n      'chatlist-avatar-' + (options.avatarSize || 54) *//* , 'chatlist-' + (options.size || 72) */);\n\n    if(options.new) {\n      list.classList.add('chatlist-new');\n    }\n\n    if(options.dialogSize) {\n      list.classList.add('chatlist-' + options.dialogSize);\n    }\n\n    // if(options.ignoreClick) {\n    //   list.classList.add('disable-hover');\n    // }\n\n    /* if(options.handheldsSize) {\n      list.classList.add('chatlist-handhelds-' + options.handheldsSize);\n    } */\n\n    return list;\n  }\n\n  public setLastMessageN(options: {\n    dialog: Dialog,\n    lastMessage?: Message.message | Message.messageService,\n    dom?: DialogDom,\n    highlightWord?: string,\n    isBatch?: boolean,\n    setUnread?: boolean\n  }) {\n    const promise = this.setLastMessage(options.dialog, options.lastMessage, options.dom, options.highlightWord, options.isBatch, options.setUnread);\n    return promise.catch(noop);\n  }\n\n  private async setLastMessage(\n    dialog: Dialog,\n    lastMessage: Message.message | Message.messageService,\n    dom: DialogDom,\n    highlightWord?: string,\n    isBatch = false,\n    setUnread = false\n  ) {\n    if(!dom) {\n      dom = this.getDialogDom(dialog.peerId);\n\n      if(!dom) {\n        return;\n      }\n    }\n\n    const {deferred: promise, middleware} = setPromiseMiddleware(dom, 'setLastMessagePromise');\n\n    let draftMessage: MyDraftMessage;\n    if(!lastMessage) {\n      if(dialog.draft?._ === 'draftMessage') {\n        draftMessage = dialog.draft;\n      }\n\n      lastMessage = dialog.topMessage;\n      if(!lastMessage || lastMessage.mid !== dialog.top_message) {\n        const promise = this.managers.appMessagesManager.getMessageByPeer(dialog.peerId, dialog.top_message);\n        lastMessage = await middleware(promise);\n      }\n    }\n\n    if(setUnread) {\n      this.setUnreadMessagesN({dialog, dom, isBatch, setLastMessagePromise: promise});\n    }\n\n    if(!lastMessage/*  || (lastMessage._ === 'messageService' && !lastMessage.rReply) */) {\n      dom.lastMessageSpan.textContent = '';\n      dom.lastTimeSpan.textContent = '';\n      delete dom.listEl.dataset.mid;\n\n      promise.resolve();\n      return;\n    }\n\n    const peerId = dialog.peerId;\n    const isRestricted = lastMessage && isMessageRestricted(lastMessage as Message.message);\n\n    /* if(!dom.lastMessageSpan.classList.contains('user-typing')) */ {\n      let mediaContainer: HTMLElement;\n      const willPrepend: (Promise<any> | HTMLElement)[] = [];\n      if(lastMessage && !draftMessage && !isRestricted) {\n        const media: MyDocument | MyPhoto = getMediaFromMessage(lastMessage);\n        const videoTypes: Set<MyDocument['type']> = new Set(['video', 'gif', 'round']);\n        if(media && (media._ === 'photo' || videoTypes.has(media.type))) {\n          const size = choosePhotoSize(media, 20, 20);\n\n          if(size._ !== 'photoSizeEmpty') {\n            mediaContainer = document.createElement('div');\n            mediaContainer.classList.add('dialog-subtitle-media');\n\n            if((media as MyDocument).type === 'round') {\n              mediaContainer.classList.add('is-round');\n            }\n\n            willPrepend.push(wrapPhoto({\n              photo: media,\n              message: lastMessage,\n              container: mediaContainer,\n              withoutPreloader: true,\n              size\n            }).then(() => mediaContainer));\n\n            if(videoTypes.has((media as MyDocument).type)) {\n              const playIcon = document.createElement('span');\n              playIcon.classList.add('tgico-play');\n\n              mediaContainer.append(playIcon);\n            }\n          }\n        }\n      }\n\n      /* if(lastMessage.from_id === auth.id) { // You:  */\n      if(draftMessage) {\n        const bold = document.createElement('b');\n        bold.classList.add('danger');\n        bold.append(i18n('Draft'), ': ');\n        willPrepend.unshift(bold);\n      } else if(peerId.isAnyChat() && peerId !== lastMessage.fromId && !(lastMessage as Message.messageService).action) {\n        const senderBold = document.createElement('b');\n\n        if(lastMessage.fromId === rootScope.myId) {\n          senderBold.append(i18n('FromYou'));\n          willPrepend.unshift(senderBold);\n        } else {\n          // str = sender.first_name || sender.last_name || sender.username;\n          const p = middleware(wrapPeerTitle({\n            peerId: lastMessage.fromId,\n            onlyFirstName: true\n          })).then((element) => {\n            senderBold.prepend(element);\n            return senderBold;\n          }, noop);\n\n          willPrepend.unshift(p);\n        }\n\n        senderBold.append(': ');\n        // console.log(sender, senderBold.innerText);\n      }\n\n      const withoutMediaType = !!mediaContainer && !!(lastMessage as Message.message)?.message;\n\n      let fragment: DocumentFragment;\n      if(highlightWord && (lastMessage as Message.message).message) {\n        fragment = await middleware(wrapMessageForReply(lastMessage, undefined, undefined, false, highlightWord, withoutMediaType));\n      } else if(draftMessage) {\n        fragment = await middleware(wrapMessageForReply(draftMessage));\n      } else if(lastMessage) {\n        fragment = await middleware(wrapMessageForReply(lastMessage, undefined, undefined, false, undefined, withoutMediaType));\n      } else { // rare case\n        fragment = document.createDocumentFragment();\n      }\n\n      if(willPrepend.length) {\n        const elements = await middleware(Promise.all(willPrepend));\n        fragment.prepend(...elements);\n      }\n\n      replaceContent(dom.lastMessageSpan, fragment);\n    }\n\n    if(lastMessage || draftMessage/*  && lastMessage._ !== 'draftMessage' */) {\n      const date = draftMessage ? Math.max(draftMessage.date, lastMessage.date || 0) : lastMessage.date;\n      replaceContent(dom.lastTimeSpan, formatDateAccordingToTodayNew(new Date(date * 1000)));\n    } else dom.lastTimeSpan.textContent = '';\n\n    if(setUnread !== null && !setUnread) { // means search\n      dom.listEl.dataset.mid = '' + lastMessage.mid;\n    }\n\n    promise.resolve();\n  }\n\n  private setUnreadMessagesN(options: {\n    dialog: Dialog,\n    dom?: DialogDom,\n    isBatch?: boolean,\n    setLastMessagePromise?: Promise<void>\n  }) {\n    return this.setUnreadMessages(options.dialog, options.dom, options.isBatch, options.setLastMessagePromise).catch(() => {});\n  }\n\n  private async setUnreadMessages(\n    dialog: Dialog,\n    dom = this.getDialogDom(dialog.peerId),\n    isBatch = false,\n    setLastMessagePromise?: Promise<void>\n  ) {\n    if(!dom) {\n      // this.log.error('setUnreadMessages no dom!', dialog);\n      return;\n    }\n\n    const {deferred, middleware} = setPromiseMiddleware(dom, 'setUnreadMessagePromise');\n\n    const isMuted = await middleware(this.managers.appNotificationsManager.isPeerLocalMuted(dialog.peerId, true));\n    const wasMuted = dom.listEl.classList.contains('is-muted');\n\n    let setStatusMessage: MyMessage;\n    if(dialog.draft?._ !== 'draftMessage') {\n      const lastMessage: MyMessage = await middleware(this.managers.appMessagesManager.getMessageByPeer(dialog.peerId, dialog.top_message));\n      if(lastMessage && lastMessage.pFlags.out && lastMessage.peerId !== rootScope.myId) {\n        setStatusMessage = lastMessage;\n      }\n    }\n\n    const filter = await middleware(this.managers.filtersStorage.getFilter(this.filterId));\n    let isPinned: boolean;\n    if(filter) {\n      isPinned = filter.pinnedPeerIds.indexOf(dialog.peerId) !== -1;\n    } else {\n      isPinned = !!dialog.pFlags.pinned;\n    }\n\n    const isDialogUnread = await middleware(this.managers.appMessagesManager.isDialogUnread(dialog));\n    const hasUnreadBadge = isPinned || isDialogUnread;\n    // dom.messageEl.classList.toggle('has-badge', hasBadge);\n\n    // * have to await all promises before modifying something\n\n    if(setLastMessagePromise) {\n      try {\n        await middleware(setLastMessagePromise);\n      } catch(err) {\n        // return;\n      }\n    }\n\n    const transitionDuration = isBatch ? 0 : 200;\n\n    if(isMuted !== wasMuted) {\n      SetTransition(dom.listEl, 'is-muted', isMuted, transitionDuration);\n    }\n\n    setSendingStatus(dom.statusSpan, setStatusMessage, true);\n\n    const isUnreadBadgeMounted = isInDOM(dom.unreadBadge);\n    if(hasUnreadBadge && !isUnreadBadgeMounted) {\n      dom.subtitleEl.append(dom.unreadBadge);\n    }\n\n    const hasMentionsBadge = dialog.unread_mentions_count && (dialog.unread_mentions_count > 1 || dialog.unread_count > 1);\n    const isMentionBadgeMounted = dom.mentionsBadge && isInDOM(dom.mentionsBadge);\n    if(hasMentionsBadge) {\n      if(!dom.mentionsBadge) {\n        dom.mentionsBadge = document.createElement('div');\n        dom.mentionsBadge.className = 'dialog-subtitle-badge badge badge-24 mention mention-badge';\n        dom.mentionsBadge.innerText = '@';\n        dom.subtitleEl.insertBefore(dom.mentionsBadge, dom.lastMessageSpan.nextSibling);\n      }\n    }\n\n    SetTransition(dom.unreadBadge, 'is-visible', hasUnreadBadge, transitionDuration, hasUnreadBadge ? undefined : () => {\n      dom.unreadBadge.remove();\n    }, !isUnreadBadgeMounted ? 2 : 0);\n\n    if(dom.mentionsBadge) {\n      SetTransition(dom.mentionsBadge, 'is-visible', hasMentionsBadge, transitionDuration, hasMentionsBadge ? undefined : () => {\n        dom.mentionsBadge.remove();\n        delete dom.mentionsBadge;\n      }, !isMentionBadgeMounted ? 2 : 0);\n    }\n\n    if(!hasUnreadBadge) {\n      deferred.resolve();\n      return;\n    }\n\n    if(isPinned) {\n      dom.unreadBadge.classList.add('tgico-chatspinned', 'tgico');\n    } else {\n      dom.unreadBadge.classList.remove('tgico-chatspinned', 'tgico');\n    }\n\n    let isUnread = true, isMention = false;\n    if(dialog.unread_mentions_count && dialog.unread_count === 1) {\n      dom.unreadBadge.innerText = '@';\n      isMention = true;\n      // dom.unreadBadge.classList.add('tgico-mention', 'tgico');\n    } else if(isDialogUnread) {\n      // dom.unreadMessagesSpan.innerText = '' + (dialog.unread_count ? formatNumber(dialog.unread_count, 1) : ' ');\n      dom.unreadBadge.innerText = '' + (dialog.unread_count || ' ');\n    } else {\n      dom.unreadBadge.innerText = '';\n      isUnread = false;\n    }\n\n    dom.unreadBadge.classList.toggle('unread', isUnread);\n    dom.unreadBadge.classList.toggle('mention', isMention);\n    deferred.resolve();\n  }\n\n  private getDialogDom(peerId: PeerId) {\n    // return this.doms[peerId];\n    const element = this.sortedList.get(peerId);\n    return element?.dom;\n  }\n\n  private async getDialog(dialog: Dialog | PeerId) {\n    if(typeof(dialog) !== 'object') {\n      const originalDialog = await this.managers.appMessagesManager.getDialogOnly(dialog);\n      if(!originalDialog) {\n        const peerId = dialog || NULL_PEER_ID;\n        return {\n          peerId,\n          peer: await this.managers.appPeersManager.getOutputPeer(peerId),\n          pFlags: {}\n        } as any as Dialog;\n      }\n\n      return originalDialog;\n    }\n\n    return dialog as Dialog;\n  }\n\n  private setCallStatus(dom: DialogDom, visible: boolean) {\n    let {callIcon, listEl} = dom;\n    if(!callIcon && visible) {\n      const {canvas, startAnimation} = dom.callIcon = callIcon = groupCallActiveIcon(listEl.classList.contains('active'));\n      canvas.classList.add('dialog-group-call-icon');\n      listEl.append(canvas);\n      startAnimation();\n    }\n\n    if(!callIcon) {\n      return;\n    }\n\n    SetTransition(dom.callIcon.canvas, 'is-visible', visible, 200, visible ? undefined : () => {\n      dom.callIcon.canvas.remove();\n      dom.callIcon = undefined;\n    }, visible ? 2 : 0);\n  }\n\n  public addListDialog(options: Parameters<AppDialogsManager['addDialogNew']>[0] & {isBatch?: boolean}) {\n    options.autonomous = false;\n\n    const ret = this.addDialogNew(options);\n\n    if(ret) {\n      const promise = this.getDialog(options.peerId).then((dialog) => {\n        const {peerId} = dialog;\n        const promises: Promise<any>[] = [];\n        if(!peerId.isUser()) {\n          promises.push(this.processDialogForCallStatus(dialog, ret.dom));\n        }\n\n        if(peerId !== rootScope.myId && peerId.isUser()) {\n          promises.push(this.managers.appUsersManager.getUser(peerId).then((user) => {\n            if(user.status?._ === 'userStatusOnline') {\n              this.setOnlineStatus(ret.dom.avatarEl, true);\n            }\n          }));\n        }\n\n        promises.push(this.setLastMessageN({\n          dialog,\n          dom: ret.dom,\n          isBatch: options.isBatch,\n          setUnread: true\n        }));\n\n        return Promise.all(promises);\n      });\n\n      if(options.loadPromises) {\n        options.loadPromises.push(promise);\n      }\n    }\n\n    return ret;\n  }\n\n  private async processDialogForCallStatus(dialog: Dialog, dom?: DialogDom) {\n    if(!IS_GROUP_CALL_SUPPORTED) {\n      return;\n    }\n\n    if(!dom) dom = this.getDialogDom(dialog.peerId);\n    if(!dom) return;\n\n    const chat: Chat.chat | Chat.channel = await this.managers.appChatsManager.getChat(dialog.peerId.toChatId());\n    this.setCallStatus(dom, !!(chat.pFlags.call_active && chat.pFlags.call_not_empty));\n  }\n\n  /**\n   * use for rendering search result\n   */\n  public addDialogAndSetLastMessage(options: Omit<Parameters<AppDialogsManager['addDialogNew']>[0], 'dialog'> & {\n    message: MyMessage,\n    peerId: PeerId,\n    query?: string\n  }) {\n    const {peerId, message, query} = options;\n    const ret = this.addDialogNew({\n      ...options,\n      ...getMessageSenderPeerIdOrName(message),\n      peerId\n    });\n\n    this.setLastMessage({_: 'dialog', peerId} as any, message, ret.dom, query);\n\n    if(message.peerId !== peerId) {\n      ret.dom.listEl.dataset.peerId = '' + message.peerId;\n    }\n\n    return ret;\n  }\n\n  public addDialogNew(options: {\n    peerId: Parameters<AppDialogsManager['addDialog']>[0],\n    container?: Parameters<AppDialogsManager['addDialog']>[1],\n    rippleEnabled?: boolean,\n    onlyFirstName?: boolean,\n    meAsSaved?: boolean,\n    append?: boolean,\n    avatarSize?: number,\n    autonomous?: boolean,\n    lazyLoadQueue?: LazyLoadQueue,\n    loadPromises?: Promise<any>[],\n    fromName?: string,\n    noIcons?: boolean\n  }) {\n    return this.addDialog(options.peerId, options.container, options.rippleEnabled, options.onlyFirstName, options.meAsSaved, options.append, options.avatarSize, options.autonomous, options.lazyLoadQueue, options.loadPromises, options.fromName, options.noIcons);\n  }\n\n  public addDialog(\n    peerId: PeerId,\n    container?: HTMLElement | Scrollable | DocumentFragment | false,\n    rippleEnabled = true,\n    onlyFirstName = false,\n    meAsSaved = true,\n    append = true,\n    avatarSize = 54,\n    autonomous = !!container,\n    lazyLoadQueue?: LazyLoadQueue,\n    loadPromises?: Promise<any>[],\n    fromName?: string,\n    noIcons?: boolean\n  ) {\n    // const dialog = await this.getDialog(_dialog);\n    const avatarEl = new AvatarElement();\n    avatarEl.classList.add('dialog-avatar', 'avatar-' + avatarSize);\n    avatarEl.updateWithOptions({\n      loadPromises,\n      lazyLoadQueue,\n      isDialog: !!meAsSaved,\n      peerId,\n      peerTitle: fromName\n    });\n\n    const captionDiv = document.createElement('div');\n    captionDiv.classList.add('user-caption');\n\n    const titleSpanContainer = document.createElement('span');\n    titleSpanContainer.classList.add('user-title');\n\n    const peerTitle = new PeerTitle();\n    const peerTitlePromise = peerTitle.update({\n      peerId,\n      fromName,\n      dialog: meAsSaved,\n      onlyFirstName,\n      plainText: false,\n      withIcons: !noIcons\n    });\n\n    if(loadPromises) {\n      loadPromises.push(peerTitlePromise);\n    }\n\n    titleSpanContainer.append(peerTitle.element);\n    // p.classList.add('')\n\n    //        (  -   )\n    // if(!container) {\n\n    // for muted icon\n    titleSpanContainer.classList.add('tgico'); // *       !container,  \n\n    // const titleIconsPromise = generateTitleIcons(peerId).then((elements) => {\n    //   titleSpanContainer.append(...elements);\n    // });\n\n    // if(loadPromises) {\n    //   loadPromises.push(titleIconsPromise);\n    // }\n    // }\n\n    const span = document.createElement('span');\n    span.classList.add('user-last-message');\n    span.setAttribute('dir', 'auto');\n\n    // captionDiv.append(titleSpan);\n    // captionDiv.append(span);\n\n    const li = document.createElement(DIALOG_LIST_ELEMENT_TAG);\n    li.classList.add('chatlist-chat');\n    if(!autonomous) (li as HTMLAnchorElement).href = '#' + peerId;\n    if(rippleEnabled) {\n      ripple(li);\n    }\n\n    li.append(avatarEl, captionDiv);\n    li.dataset.peerId = '' + peerId;\n\n    const statusSpan = document.createElement('span');\n    statusSpan.classList.add('message-status', 'sending-status'/* , 'transition', 'reveal' */);\n\n    const lastTimeSpan = document.createElement('span');\n    lastTimeSpan.classList.add('message-time');\n\n    const unreadBadge = document.createElement('div');\n    unreadBadge.className = 'dialog-subtitle-badge badge badge-24';\n\n    const titleP = document.createElement('p');\n    titleP.classList.add('dialog-title');\n\n    const rightSpan = document.createElement('span');\n    rightSpan.classList.add('dialog-title-details');\n    rightSpan.append(statusSpan, lastTimeSpan);\n    titleP.append(titleSpanContainer, rightSpan);\n\n    const subtitleEl = document.createElement('p');\n    subtitleEl.classList.add('dialog-subtitle');\n    subtitleEl.append(span);\n\n    captionDiv.append(titleP, subtitleEl);\n\n    const dom: DialogDom = {\n      avatarEl,\n      captionDiv,\n      titleSpan: peerTitle.element,\n      titleSpanContainer,\n      statusSpan,\n      lastTimeSpan,\n      unreadBadge,\n      lastMessageSpan: span,\n      containerEl: li,\n      listEl: li,\n      subtitleEl\n    };\n\n    /* let good = false;\n    for(const folderId in this.chatLists) {\n      if(this.chatLists[folderId] === container) {\n        good = true;\n      }\n    } */\n    if(container) {\n      const method = append ? 'append' : 'prepend';\n      container[method](li);\n    }\n\n    if(!autonomous) {\n      // @ts-ignore\n      li.dialogDom = dom;\n\n      if(appImManager.chat?.peerId === peerId) {\n        this.setDialogActive(li, true);\n      }\n    }\n\n    return {dom};\n  }\n\n  public async setTyping(dialog: Dialog) {\n    const dom = this.getDialogDom(dialog.peerId);\n    if(!dom) {\n      return;\n    }\n\n    const oldTypingElement = dom.lastMessageSpan.querySelector('.peer-typing-container') as HTMLElement;\n    const newTypingElement = await appImManager.getPeerTyping(dialog.peerId, oldTypingElement);\n    if(!oldTypingElement && newTypingElement) {\n      replaceContent(dom.lastMessageSpan, newTypingElement);\n      dom.lastMessageSpan.classList.add('user-typing');\n    }\n  }\n\n  public unsetTyping(dialog: Dialog) {\n    const dom = this.getDialogDom(dialog.peerId);\n    if(!dom) {\n      return;\n    }\n\n    dom.lastMessageSpan.classList.remove('user-typing');\n    this.setLastMessageN({\n      dialog,\n      lastMessage: null,\n      dom,\n      setUnread: null\n    });\n  }\n}\n\nconst appDialogsManager = new AppDialogsManager();\nMOUNT_CLASS_TO.appDialogsManager = appDialogsManager;\nexport default appDialogsManager;\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport type {DownloadMediaOptions, DownloadOptions} from '../mtproto/apiFileManager';\r\nimport type {AppMessagesManager} from './appMessagesManager';\r\nimport type {MyDocument} from './appDocsManager';\r\nimport deferredPromise, {CancellablePromise} from '../../helpers/cancellablePromise';\r\nimport {InputFile, Photo, PhotoSize} from '../../layer';\r\nimport getFileNameForUpload from '../../helpers/getFileNameForUpload';\r\nimport {AppManagers} from './managers';\r\nimport rootScope from '../rootScope';\r\nimport {MOUNT_CLASS_TO} from '../../config/debug';\r\nimport noop from '../../helpers/noop';\r\nimport getDownloadMediaDetails from './utils/download/getDownloadMediaDetails';\r\nimport getDownloadFileNameFromOptions from './utils/download/getDownloadFileNameFromOptions';\r\nimport indexOfAndSplice from '../../helpers/array/indexOfAndSplice';\r\nimport makeError from '../../helpers/makeError';\r\nimport createDownloadAnchor from '../../helpers/dom/createDownloadAnchor';\r\nimport {getFileNameByLocation} from '../../helpers/fileName';\r\nimport getDocumentDownloadOptions from './utils/docs/getDocumentDownloadOptions';\r\nimport getPhotoDownloadOptions from './utils/photos/getPhotoDownloadOptions';\r\nimport apiManagerProxy from '../mtproto/mtprotoworker';\r\n\r\nexport type ResponseMethodBlob = 'blob';\r\nexport type ResponseMethodJson = 'json';\r\nexport type ResponseMethod = ResponseMethodBlob | ResponseMethodJson;\r\n\r\n/* export type DownloadBlob = {promise: Promise<Blob>, controller: AbortController};\r\nexport type DownloadJson = {promise: Promise<any>, controller: AbortController}; */\r\nexport type DownloadBlob = CancellablePromise<Blob>;\r\nexport type DownloadUrl = CancellablePromise<string>;\r\nexport type DownloadJson = CancellablePromise<any>;\r\n// export type Download = DownloadBlob/*  | DownloadJson */;\r\nexport type Download = DownloadBlob | DownloadUrl/*  | DownloadJson */;\r\n\r\nexport type Progress = {done: number, fileName: string, total: number, offset: number};\r\nexport type ProgressCallback = (details: Progress) => void;\r\n\r\ntype DownloadType = 'url' | 'blob' | 'void' | 'disc';\r\n\r\nexport class AppDownloadManager {\r\n  private downloads: {[fileName: string]: {main: Download} & {[type in DownloadType]?: Download}} = {};\r\n  // private downloadsToDisc: {[fileName: string]: Download} = {};\r\n  private progress: {[fileName: string]: Progress} = {};\r\n  // private progressCallbacks: {[fileName: string]: Array<ProgressCallback>} = {};\r\n  private managers: AppManagers;\r\n\r\n  public construct(managers: AppManagers) {\r\n    this.managers = managers;\r\n    rootScope.addEventListener('download_progress', (details) => {\r\n      // const callbacks = this.progressCallbacks[details.fileName];\r\n      // if(callbacks) {\r\n      //   callbacks.forEach((callback) => callback(details));\r\n      // }\r\n\r\n      const download = this.downloads[details.fileName];\r\n      if(download?.main?.notifyAll) {\r\n        this.progress[details.fileName] = details;\r\n        download.main.notifyAll(details);\r\n      }\r\n    });\r\n  }\r\n\r\n  private getNewDeferred<T>(fileName: string, type?: DownloadType) {\r\n    const deferred = deferredPromise<T>();\r\n\r\n    let download = this.downloads[fileName];\r\n    if(!download) {\r\n      download = this.downloads[fileName] = {\r\n        main: deferred as any\r\n      };\r\n\r\n      deferred.cancel = () => {\r\n        const error = makeError('DOWNLOAD_CANCELED');\r\n\r\n        this.managers.apiFileManager.cancelDownload(fileName);\r\n\r\n        deferred.reject(error);\r\n        deferred.cancel = noop;\r\n      };\r\n\r\n      deferred.catch(() => {\r\n        this.clearDownload(fileName, type);\r\n      }).finally(() => {\r\n        delete this.progress[fileName];\r\n        // delete this.progressCallbacks[fileName];\r\n      });\r\n    } else {\r\n      const main = download.main;\r\n      (['cancel', 'addNotifyListener', 'notify', 'notifyAll'] as (keyof CancellablePromise<void>)[]).forEach((key) => {\r\n        if(!main[key]) {\r\n          return;\r\n        }\r\n\r\n        // @ts-ignore\r\n        deferred[key] = main[key].bind(main);\r\n      });\r\n    }\r\n\r\n    const haveToClear = type === 'disc';\r\n    if(haveToClear) {\r\n      deferred.catch(noop).finally(() => {\r\n        this.clearDownload(fileName, type);\r\n      });\r\n    }\r\n\r\n    return download[type] = deferred as any;\r\n  }\r\n\r\n  public getNewDeferredForUpload<T extends Promise<any>>(fileName: string, promise: T) {\r\n    const deferred = this.getNewDeferred<InputFile>(fileName);\r\n    promise.then(deferred.resolve, deferred.reject);\r\n\r\n    deferred.finally(() => {\r\n      this.clearDownload(fileName);\r\n    });\r\n\r\n    return deferred as CancellablePromise<Awaited<T>>;\r\n  }\r\n\r\n  private clearDownload(fileName: string, type?: DownloadType) {\r\n    const downloads = this.downloads[fileName];\r\n    if(!downloads) {\r\n      return;\r\n    }\r\n\r\n    delete downloads[type];\r\n\r\n    const length = Object.keys(downloads).length;\r\n    if(!length || (downloads.main && length === 1)) {\r\n      delete this.downloads[fileName];\r\n    }\r\n  }\r\n\r\n  public getUpload(fileName: string): ReturnType<AppMessagesManager['sendFile']>['promise'] {\r\n    let deferred: CancellablePromise<any> = this.getDownload(fileName);\r\n    if(deferred) {\r\n      return deferred;\r\n    }\r\n\r\n    deferred = this.getNewDeferred(fileName);\r\n    this.managers.appMessagesManager.getUploadPromise(fileName).then(deferred.resolve, deferred.reject);\r\n    return deferred;\r\n  }\r\n\r\n  /* public fakeDownload(fileName: string, value: Blob | string) {\r\n    const deferred = this.getNewDeferred<Blob>(fileName);\r\n    if(typeof(value) === 'string') {\r\n      fetch(value)\r\n      .then((response) => response.blob())\r\n      .then((blob) => deferred.resolve(blob));\r\n    } else {\r\n      deferred.resolve(value);\r\n    }\r\n\r\n    return deferred;\r\n  } */\r\n\r\n  private d(fileName: string, getPromise: () => Promise<any>, type?: DownloadType) {\r\n    let deferred = this.getDownload(fileName, type);\r\n    if(deferred) return deferred;\r\n\r\n    deferred = this.getNewDeferred<Blob>(fileName, type);\r\n    getPromise().then(deferred.resolve, deferred.reject);\r\n    return deferred;\r\n  }\r\n\r\n  public download(options: DownloadOptions): DownloadBlob {\r\n    const fileName = getDownloadFileNameFromOptions(options);\r\n    return this.d(fileName, () => this.managers.apiFileManager.download(options), 'blob') as any;\r\n  }\r\n\r\n  public downloadMedia(options: DownloadMediaOptions, type: DownloadType = 'blob', promiseBefore?: Promise<any>): DownloadBlob {\r\n    const {downloadOptions, fileName} = getDownloadMediaDetails(options);\r\n\r\n    return this.d(fileName, () => {\r\n      let cb: any;\r\n      if(type === 'url') {\r\n        cb = this.managers.apiFileManager.downloadMediaURL;\r\n      } else if(type === 'void'/*  || type === 'disc' */) {\r\n        cb = this.managers.apiFileManager.downloadMediaVoid;\r\n      } else /* if(type === 'blob') */ {\r\n        cb = this.managers.apiFileManager.downloadMedia;\r\n      }\r\n\r\n      if(promiseBefore) {\r\n        return promiseBefore.then(() => cb(options));\r\n      }\r\n\r\n      return cb(options);\r\n    }, type) as any;\r\n  }\r\n\r\n  public downloadMediaURL(options: DownloadMediaOptions): DownloadUrl {\r\n    return this.downloadMedia(options, 'url') as any;\r\n  }\r\n\r\n  public downloadMediaVoid(options: DownloadMediaOptions): DownloadBlob {\r\n    return this.downloadMedia(options, 'void');\r\n  }\r\n\r\n  public upload(file: File | Blob, fileName?: string, promise?: Promise<any>) {\r\n    if(!fileName) {\r\n      fileName = getFileNameForUpload(file);\r\n    }\r\n\r\n    if(!promise) {\r\n      promise = this.managers.apiFileManager.upload({file, fileName});\r\n    }\r\n\r\n    const deferred = this.getNewDeferredForUpload(fileName, promise);\r\n    return deferred as any as CancellablePromise<InputFile>;\r\n  }\r\n\r\n  public getDownload(fileName: string, type?: DownloadType) {\r\n    const d = this.downloads[fileName];\r\n    return d && d[type];\r\n  }\r\n\r\n  // public addProgressCallback(fileName: string, callback: ProgressCallback) {\r\n  //   const progress = this.progress[fileName];\r\n  //   (this.progressCallbacks[fileName] ?? (this.progressCallbacks[fileName] = [])).push(callback);\r\n\r\n  //   if(progress) {\r\n  //     callback(progress);\r\n  //   }\r\n  // }\r\n\r\n  public downloadToDisc(options: DownloadMediaOptions, justAttach?: boolean) {\r\n    const media = options.media;\r\n    const isDocument = media._ === 'document';\r\n    if(!isDocument && !options.thumb) {\r\n      options.thumb = (media as Photo.photo).sizes.slice().pop() as PhotoSize.photoSize;\r\n    }\r\n\r\n    // const {fileName: cacheFileName} = getDownloadMediaDetails(options);\r\n    // if(justAttach) {\r\n    //   const promise = this.downloadsToDisc[cacheFileName];\r\n    //   if(promise) {\r\n    //     return promise;\r\n    //   }\r\n    // }\r\n\r\n    // const {downloadOptions, fileName} = getDownloadMediaDetails(options);\r\n    // if(downloadOptions.size && downloadOptions.size > MAX_FILE_SAVE_SIZE) {\r\n    const id = '' + (Math.random() * 0x7FFFFFFF | 0);\r\n    // const id = 'test';\r\n    const url = `download/${id}`;\r\n    options.downloadId = id;\r\n\r\n    const pingPromise = apiManagerProxy.pingServiceWorkerWithIframe();\r\n\r\n    const promise = this.downloadMedia(options, 'disc', pingPromise);\r\n    // this.downloadsToDisc[cacheFileName] = promise;\r\n\r\n    if(justAttach) {\r\n      return promise;\r\n    }\r\n\r\n    const iframe = document.createElement('iframe');\r\n    iframe.hidden = true;\r\n\r\n    pingPromise.then(() => {\r\n      iframe.src = url;\r\n      document.body.append(iframe);\r\n    });\r\n\r\n    // createDownloadAnchor(url, 'asd.txt');\r\n\r\n    // const events = [\r\n    //   'emptied',\r\n    //   'abort',\r\n    //   'suspend',\r\n    //   'reset',\r\n    //   'error',\r\n    //   'ended',\r\n    //   'load'\r\n    // ].forEach((event) => {\r\n    //   iframe.addEventListener(event, () => alert(event));\r\n    //   iframe.contentWindow.addEventListener(event, () => alert(event));\r\n    // });\r\n\r\n    let element: HTMLElement, hadProgress = false;\r\n    const onProgress = () => {\r\n      if(hadProgress) {\r\n        return;\r\n      }\r\n\r\n      hadProgress = true;\r\n      element = iframe;\r\n\r\n      indexOfAndSplice(promise.listeners, onProgress);\r\n    };\r\n\r\n    promise.addNotifyListener(onProgress);\r\n    promise.then((blob) => {\r\n      if(!blob) {\r\n        return;\r\n      }\r\n\r\n      const url = URL.createObjectURL(blob);\r\n      const downloadOptions = isDocument ?\r\n        getDocumentDownloadOptions(media) :\r\n        getPhotoDownloadOptions(media as any, options.thumb as PhotoSize.photoSize);\r\n      const fileName = (options.media as MyDocument).file_name || getFileNameByLocation(downloadOptions.location);\r\n      createDownloadAnchor(url, downloadOptions.fileName || fileName, () => {\r\n        URL.revokeObjectURL(url);\r\n      });\r\n    }).catch(noop).finally(() => {\r\n      if(!hadProgress) {\r\n        onProgress();\r\n      }\r\n\r\n      setTimeout(() => {\r\n        element?.remove();\r\n      }, 1000);\r\n\r\n      // if(this.downloadsToDisc[cacheFileName] === promise) {\r\n      //   delete this.downloadsToDisc[cacheFileName];\r\n      // }\r\n    });\r\n\r\n    return promise;\r\n  }\r\n}\r\n\r\nconst appDownloadManager = new AppDownloadManager();\r\nMOUNT_CLASS_TO && (MOUNT_CLASS_TO.appDownloadManager = appDownloadManager);\r\nexport default appDownloadManager;\r\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nexport default function createDownloadAnchor(url: string, fileName: string, onRemove?: () => void) {\n  const a = document.createElement('a');\n  a.href = url;\n  a.download = fileName;\n  a.target = '_blank';\n\n  a.style.position = 'absolute';\n  a.style.top = '1px';\n  a.style.left = '1px';\n\n  document.body.append(a);\n\n  try {\n    const clickEvent = document.createEvent('MouseEvents');\n    clickEvent.initMouseEvent('click', true, false, window, 0, 0, 0, 0, 0, false, false, false, false, 0, null);\n    a.dispatchEvent(clickEvent);\n  } catch(e) {\n    console.error('Download click error', e);\n    try {\n      a.click();\n    } catch(e) {\n      window.open(url as string, '_blank');\n    }\n  }\n\n  setTimeout(() => {\n    a.remove();\n    onRemove && onRemove();\n  }, 100);\n}\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport rootScope from '../../lib/rootScope';\r\n// import { generatePathData } from \"../../helpers/dom\";\r\nimport {MyMessage} from '../../lib/appManagers/appMessagesManager';\r\nimport type Chat from './chat';\r\nimport indexOfAndSplice from '../../helpers/array/indexOfAndSplice';\r\nimport insertInDescendSortedArray from '../../helpers/array/insertInDescendSortedArray';\r\nimport positionElementByIndex from '../../helpers/dom/positionElementByIndex';\r\nimport AvatarElement from '../avatar';\r\nimport {Message} from '../../layer';\r\nimport {NULL_PEER_ID, REPLIES_PEER_ID} from '../../lib/mtproto/mtproto_config';\r\nimport {SERVICE_AS_REGULAR, STICKY_OFFSET} from './bubbles';\r\nimport forEachReverse from '../../helpers/array/forEachReverse';\r\nimport partition from '../../helpers/array/partition';\r\n\r\ntype GroupItem = {\r\n  bubble: HTMLElement,\r\n  fromId: PeerId,\r\n  mid: number,\r\n  groupMid?: number,\r\n  timestamp: number,\r\n  dateTimestamp: number,\r\n  mounted: boolean,\r\n  single: boolean,\r\n  group?: BubbleGroup,\r\n  message: Message.message | Message.messageService // use it only to set avatar\r\n};\r\n\r\nclass BubbleGroup {\r\n  container: HTMLElement;\r\n  chat: Chat;\r\n  groups: BubbleGroups;\r\n  items: GroupItem[]; // descend sorted\r\n  avatarContainer: HTMLElement;\r\n  avatarLoadPromise: ReturnType<AvatarElement['updateWithOptions']>;\r\n  avatar: AvatarElement;\r\n  mounted: boolean;\r\n  dateTimestamp: number;\r\n  offset: number;\r\n\r\n  constructor(chat: Chat, groups: BubbleGroups, dateTimestamp: number) {\r\n    this.container = document.createElement('div');\r\n    this.container.classList.add('bubbles-group');\r\n    this.chat = chat;\r\n    this.groups = groups;\r\n    this.items = [];\r\n    this.dateTimestamp = dateTimestamp;\r\n    this.offset = 0;\r\n  }\r\n\r\n  createAvatar(message: Message.message | Message.messageService) {\r\n    if(this.avatarLoadPromise) {\r\n      return this.avatarLoadPromise;\r\n    } else if(message._ === 'messageService') {\r\n      return;\r\n    }\r\n\r\n    this.avatarContainer = document.createElement('div');\r\n    this.avatarContainer.classList.add('bubbles-group-avatar-container');\r\n    ++this.offset;\r\n\r\n    const fwdFrom = message.fwd_from;\r\n    const fwdFromId = message.fwdFromId;\r\n    const isForwardFromChannel = message.from_id && message.from_id._ === 'peerChannel' && message.fromId === fwdFromId;\r\n    const currentPeerId = this.chat.peerId;\r\n    const avatar = this.avatar = new AvatarElement();\r\n    this.avatar.classList.add('bubbles-group-avatar', 'user-avatar', 'avatar-40'/* , 'can-zoom-fade' */);\r\n    const peerId = ((fwdFrom && (currentPeerId === rootScope.myId || currentPeerId === REPLIES_PEER_ID)) || isForwardFromChannel ? fwdFromId : message.fromId) || NULL_PEER_ID;\r\n    const avatarLoadPromise = this.avatar.updateWithOptions({\r\n      lazyLoadQueue: this.chat.bubbles.lazyLoadQueue,\r\n      peerId,\r\n      peerTitle: !fwdFromId && fwdFrom && fwdFrom.from_name ? /* ' FF ' */fwdFrom.from_name : undefined\r\n    });\r\n\r\n    this.avatarLoadPromise = Promise.all([\r\n      avatarLoadPromise,\r\n      peerId && peerId.isUser() ? this.chat.managers.appUsersManager.getUser(peerId.toUserId()) : undefined\r\n    ]).then(([result, user]) => {\r\n      if(user?.pFlags?.premium) {\r\n        avatar.classList.add('is-premium', 'tgico-star');\r\n      }\r\n\r\n      return result;\r\n    });\r\n\r\n    this.avatarContainer.append(this.avatar);\r\n    this.container.append(this.avatarContainer);\r\n\r\n    return this.avatarLoadPromise;\r\n  }\r\n\r\n  get firstTimestamp() {\r\n    return this.firstItem.timestamp;\r\n  }\r\n\r\n  get firstMid() {\r\n    return this.firstItem.mid;\r\n  }\r\n\r\n  get firstItem() {\r\n    return this.items[this.items.length - 1];\r\n  }\r\n\r\n  get lastTimestamp() {\r\n    return this.lastItem.timestamp;\r\n  }\r\n\r\n  get lastMid() {\r\n    return this.lastItem.mid;\r\n  }\r\n\r\n  get lastItem() {\r\n    return this.items[0];\r\n  }\r\n\r\n  updateClassNames() {\r\n    const items = this.items;\r\n    const length = items.length;\r\n    if(!length) {\r\n      return;\r\n    }\r\n\r\n    // const elements = Array.from(this.container.children);\r\n    // if(this.offset) elements.splice(0, this.offset);\r\n\r\n    // const length = elements.length;\r\n    // if(!length) {\r\n    //   return;\r\n    // }\r\n\r\n    const first = items[length - 1].bubble;\r\n\r\n    if(items.length === 1) {\r\n      first.classList.add('is-group-first', 'is-group-last');\r\n      // this.setClipIfNeeded(first);\r\n      return;\r\n    } else {\r\n      first.classList.remove('is-group-last');\r\n      first.classList.add('is-group-first');\r\n      // this.setClipIfNeeded(first, true);\r\n    }\r\n\r\n    for(let i = 1, _length = length - 1; i < _length; ++i) {\r\n      const bubble = items[i].bubble;\r\n      bubble.classList.remove('is-group-last', 'is-group-first');\r\n      // this.setClipIfNeeded(bubble, true);\r\n    }\r\n\r\n    const last = items[0].bubble;\r\n    last.classList.remove('is-group-first');\r\n    last.classList.add('is-group-last');\r\n    // this.setClipIfNeeded(last);\r\n  }\r\n\r\n  insertItem(item: GroupItem) {\r\n    const {items} = this;\r\n    insertInDescendSortedArray(items, item, this.groups.sortGroupItemsKey);\r\n\r\n    item.group = this;\r\n    if(items.length === 1) {\r\n      this.groups.insertGroup(this);\r\n    }\r\n  }\r\n\r\n  removeItem(item: GroupItem) {\r\n    indexOfAndSplice(this.items, item);\r\n\r\n    if(!this.items.length) {\r\n      indexOfAndSplice(this.groups.groups, this);\r\n    }\r\n\r\n    item.group = undefined;\r\n  }\r\n\r\n  mount(updateClassNames?: boolean) {\r\n    if(!this.groups.groups.includes(this) || !this.items.length) { // group can be already removed\r\n      debugger;\r\n\r\n      if(this.mounted) {\r\n        this.onItemUnmount();\r\n      }\r\n\r\n      return;\r\n    }\r\n\r\n    const {offset, items} = this;\r\n    const {length} = items;\r\n    forEachReverse(items, (item, idx) => {\r\n      this.mountItem(item, length - 1 - idx, offset);\r\n    });\r\n\r\n    if(updateClassNames) {\r\n      this.updateClassNames();\r\n    }\r\n\r\n    this.onItemMount();\r\n  }\r\n\r\n  mountItem(item: GroupItem, idx = this.items.indexOf(item), offset = this.offset) {\r\n    if(item.mounted) {\r\n      return;\r\n    }\r\n\r\n    positionElementByIndex(item.bubble, this.container, offset + idx);\r\n    item.mounted = true;\r\n  }\r\n\r\n  unmountItem(item: GroupItem) {\r\n    if(!item.mounted) {\r\n      return;\r\n    }\r\n\r\n    item.bubble.remove();\r\n    item.mounted = false;\r\n    this.onItemUnmount();\r\n  }\r\n\r\n  onItemMount() {\r\n    if(this.mounted) {\r\n      return;\r\n    }\r\n\r\n    const dateContainer = this.chat.bubbles.getDateContainerByTimestamp(this.dateTimestamp / 1000);\r\n    // const idx = this.groups.indexOf(group);\r\n    const dateGroups = this.groups.groups.filter((_group) => _group.dateTimestamp === this.dateTimestamp);\r\n    const dateGroupsLength = dateGroups.length;\r\n    const idx = dateGroups.indexOf(this);\r\n    const unmountedLength = dateGroups.slice(idx + 1).reduce((acc, v) => acc + (v.mounted ? 0 : 1), 0);\r\n    positionElementByIndex(this.container, dateContainer.container, STICKY_OFFSET + dateGroupsLength - 1 - idx - unmountedLength);\r\n    this.mounted = true;\r\n  }\r\n\r\n  onItemUnmount() {\r\n    if(!this.mounted) {\r\n      return;\r\n    }\r\n\r\n    if(!this.items.length) {\r\n      this.container.remove();\r\n      this.chat.bubbles.deleteEmptyDateGroups();\r\n      this.mounted = false;\r\n    } else {\r\n      this.updateClassNames();\r\n    }\r\n  }\r\n}\r\n\r\n// class BubbleGroupItem implements GroupItem {\r\n//   bubble: HTMLElement;\r\n//   fromId: PeerId;\r\n//   mid: number;\r\n//   timestamp: number;\r\n//   dateTimestamp: number;\r\n//   mounted: boolean;\r\n//   single: boolean;\r\n//   group: BubbleGroup;\r\n\r\n//   constructor(details: GroupItem) {\r\n//     Object.assign(this, details);\r\n//   }\r\n// }\r\n\r\nexport default class BubbleGroups {\r\n  public itemsArr: Array<GroupItem> = []; // descend sorted\r\n  private itemsMap: Map<HTMLElement, GroupItem> = new Map();\r\n  public groups: Array<BubbleGroup> = []; // descend sorted\r\n  private newGroupDiff = 121; // * 121 in scheduled messages\r\n  private sortItemsKey: Extract<keyof GroupItem, 'timestamp' | 'mid'>;\r\n  private sortGroupsKey: Extract<keyof BubbleGroup, 'lastMid' | 'lastTimestamp'>;\r\n  public sortGroupItemsKey: Extract<keyof GroupItem, 'groupMid' | 'timestamp'>;\r\n\r\n  constructor(private chat: Chat) {\r\n    this.sortItemsKey = chat.type === 'scheduled' ? 'timestamp' : 'mid';\r\n    this.sortGroupsKey = chat.type === 'scheduled' ? 'lastTimestamp' : 'lastMid';\r\n    this.sortGroupItemsKey = /* chat.type === 'scheduled' ? 'timestamp' :  */'groupMid';\r\n  }\r\n\r\n  removeItem(item: GroupItem) {\r\n    item.group.removeItem(item);\r\n    this.removeItemFromCache(item);\r\n  }\r\n\r\n  removeAndUnmountBubble(bubble: HTMLElement) {\r\n    const item = this.getItemByBubble(bubble);\r\n    if(!item) {\r\n      return;\r\n    }\r\n\r\n    const items = this.itemsArr;\r\n    const index = items.indexOf(item);\r\n    const siblings = this.getSiblingsAtIndex(index, items);\r\n\r\n    const group = item.group;\r\n    this.removeItem(item);\r\n    group.unmountItem(item);\r\n\r\n    const modifiedGroups: Set<BubbleGroup> = new Set();\r\n    modifiedGroups.add(group);\r\n\r\n    const [previousSibling, nextSibling] = siblings;\r\n    if(\r\n      previousSibling &&\r\n      nextSibling &&\r\n      this.canItemsBeGrouped(previousSibling, nextSibling) &&\r\n      previousSibling.group !== nextSibling.group\r\n    ) {\r\n      const group = nextSibling.group;\r\n      this.f(nextSibling.group.items);\r\n      group.onItemUnmount();\r\n      modifiedGroups.add(previousSibling.group);\r\n      this.groupUngrouped();\r\n    }\r\n\r\n    this.mountUnmountGroups(Array.from(modifiedGroups));\r\n  }\r\n\r\n  mountUnmountGroups(groups: BubbleGroup[]) {\r\n    // groups.sort((a, b) => (b.lastItem?.mid ?? 0) - (a.lastItem?.mid ?? 0));\r\n\r\n    const [toMount, toUnmount] = partition(groups, (group) => !!group.items.length);\r\n    toUnmount.forEach((group) => {\r\n      group.onItemUnmount();\r\n    })\r\n\r\n    toMount.forEach((group) => {\r\n      group.mount(true);\r\n    });\r\n\r\n    // toMount.forEach((group) => {\r\n    //   group.updateClassNames();\r\n    // });\r\n  }\r\n\r\n  f(items: GroupItem[], index: number = 0, length = items.length) {\r\n    for(; index < length; ++index) {\r\n      const item = items[index];\r\n      item.mounted = false;\r\n      item.group.removeItem(item);\r\n      --length;\r\n      --index;\r\n    }\r\n  }\r\n\r\n  getItemByBubble(bubble: HTMLElement) {\r\n    return this.itemsMap.get(bubble);\r\n  }\r\n\r\n  getLastGroup() {\r\n    return this.groups[0];\r\n  }\r\n\r\n  changeBubbleMid(bubble: HTMLElement, mid: number) {\r\n    const item = this.getItemByBubble(bubble);\r\n    if(!item) {\r\n      return;\r\n    }\r\n\r\n    item.mid = mid;\r\n\r\n    // indexOfAndSplice(item.group.items, item);\r\n    // // const canChangeGroupMid = !item.group.items.length || item.group.items.every((item) => item.groupMid === item.mid);\r\n    // // if(canChangeGroupMid) item.groupMid = mid;\r\n    // item.group.insertItem(item);\r\n\r\n    indexOfAndSplice(this.itemsArr, item);\r\n    this.insertItemToArray(item, this.itemsArr);\r\n  }\r\n\r\n  changeItemBubble(item: GroupItem, bubble: HTMLElement) {\r\n    this.itemsMap.delete(item.bubble);\r\n    item.bubble = bubble;\r\n    this.itemsMap.set(bubble, item);\r\n  }\r\n\r\n  changeBubbleByBubble(from: HTMLElement, to: HTMLElement) {\r\n    const item = this.getItemByBubble(from);\r\n    if(!item) {\r\n      return;\r\n    }\r\n\r\n    this.changeItemBubble(item, to);\r\n  }\r\n\r\n  canItemsBeGrouped(item1: GroupItem, item2: GroupItem) {\r\n    return item2.fromId === item1.fromId &&\r\n      Math.abs(item2.timestamp - item1.timestamp) <= this.newGroupDiff &&\r\n      item1.dateTimestamp === item2.dateTimestamp &&\r\n      !item1.single &&\r\n      !item2.single;\r\n  }\r\n\r\n  getSiblingsAtIndex(itemIndex: number, items: GroupItem[]) {\r\n    return [items[itemIndex - 1], items[itemIndex + 1]] as const;\r\n  }\r\n\r\n  // findGroupSiblingInSiblings(item: GroupItem, siblings: ReturnType<BubbleGroups['getSiblingsAtIndex']>) {\r\n  //   return siblings.find((sibling) => sibling && this.canItemsBeGrouped(item, sibling));\r\n  // }\r\n\r\n  findGroupSiblingByItem(item: GroupItem, items: GroupItem[]) {\r\n    items = items.slice();\r\n    const idx = this.insertItemToArray(item, items);\r\n    // return this.findGroupSiblingInSiblings(item, this.getSiblingsAtIndex(idx, items));\r\n    return this.findGroupSiblingInItems(item, items, idx);\r\n  }\r\n\r\n  findGroupSiblingInItems(item: GroupItem, items: GroupItem[], index = items.indexOf(item), length = items.length) {\r\n    const previousItem = items[index - 1];\r\n    let siblingGroupedItem: GroupItem;\r\n    if(previousItem?.group && this.canItemsBeGrouped(item, previousItem)) {\r\n      siblingGroupedItem = previousItem;\r\n    } else {\r\n      for(let k = index + 1; k < length; ++k) {\r\n        const nextItem = items[k];\r\n        if(this.canItemsBeGrouped(item, nextItem)) {\r\n          if(nextItem.group) {\r\n            siblingGroupedItem = nextItem;\r\n          }\r\n        } else {\r\n          break;\r\n        }\r\n      }\r\n    }\r\n\r\n    return siblingGroupedItem;\r\n  }\r\n\r\n  addItemToGroup(item: GroupItem, group: BubbleGroup) {\r\n    group.insertItem(item);\r\n    this.addItemToCache(item);\r\n  }\r\n\r\n  insertItemToArray(item: GroupItem, array: GroupItem[]) {\r\n    return insertInDescendSortedArray(array, item, this.sortItemsKey);\r\n  }\r\n\r\n  insertGroup(group: BubbleGroup) {\r\n    return insertInDescendSortedArray(this.groups, group, this.sortGroupsKey);\r\n  }\r\n\r\n  addItemToCache(item: GroupItem) {\r\n    this.insertItemToArray(item, this.itemsArr);\r\n    this.itemsMap.set(item.bubble, item);\r\n  }\r\n\r\n  removeItemFromCache(item: GroupItem) {\r\n    indexOfAndSplice(this.itemsArr, item);\r\n    this.itemsMap.delete(item.bubble);\r\n  }\r\n\r\n  getMessageFromId(message: MyMessage) {\r\n    let fromId = message.viaBotId || message.fromId;\r\n\r\n    // fix for saved messages forward to self\r\n    if(fromId === rootScope.myId && message.peerId === rootScope.myId && (message as Message.message).fwdFromId === fromId) {\r\n      fromId = fromId.toPeerId(true);\r\n    }\r\n\r\n    return fromId;\r\n  }\r\n\r\n  createItem(bubble: HTMLElement, message: MyMessage) {\r\n    const single = !(message._ === 'message' || (message.action && SERVICE_AS_REGULAR.has(message.action._)));\r\n    const {mid, date: timestamp} = message;\r\n    const {dateTimestamp} = this.chat.bubbles.getDateForDateContainer(timestamp);\r\n    const item: GroupItem = {\r\n      mid,\r\n      groupMid: this.chat.type === 'scheduled' ? +`${(timestamp * 1000 - dateTimestamp) / 1000}.${mid}` : mid,\r\n      fromId: this.getMessageFromId(message),\r\n      bubble,\r\n      // timestamp: this.chat.type === 'scheduled' ? +`${(timestamp * 1000 - dateTimestamp) / 1000}.${mid}` : timestamp,\r\n      timestamp,\r\n      dateTimestamp,\r\n      mounted: false,\r\n      single,\r\n      message\r\n    };\r\n\r\n    return item;\r\n  }\r\n\r\n  splitSiblingsOnGrouping(siblings: ReturnType<BubbleGroups['getSiblingsAtIndex']>) {\r\n    const [previousSibling, nextSibling] = siblings;\r\n    const previousGroup = previousSibling?.group;\r\n    const nextGroup = nextSibling?.group;\r\n\r\n    if(!previousGroup) {\r\n      return;\r\n    }\r\n\r\n    // will refresh group\r\n    // if(previousGroup === nextGroup) {\r\n    const items = previousGroup.items;\r\n    const index = items.indexOf(previousSibling) + 1;\r\n    const length = items.length;\r\n    if(index === length) {\r\n      return;\r\n    }\r\n\r\n    const modifiedGroups: BubbleGroup[] = [previousGroup];\r\n    // if(previousGroup !== nextGroup && nextGroup) {\r\n    //   modifiedGroups.push(nextGroup);\r\n    // }\r\n\r\n    this.f(items, index, length);\r\n    return modifiedGroups;\r\n    // }\r\n  }\r\n\r\n  prepareForGrouping(bubble: HTMLElement, message: MyMessage) {\r\n    const foundItem = this.getItemByBubble(bubble);\r\n    if(foundItem) { // should happen only on edit\r\n      // debugger;\r\n      return;\r\n    }\r\n\r\n    const item = this.createItem(bubble, message);\r\n    this.addItemToCache(item);\r\n  }\r\n\r\n  groupUngrouped() {\r\n    const items = this.itemsArr;\r\n    const length = items.length;\r\n    const modifiedGroups: Set<BubbleGroup> = new Set();\r\n    // for(let i = length - 1; i >= 0; --i) {\r\n    for(let i = 0; i < length; ++i) {\r\n      const item = items[i];\r\n      if(item.group) {\r\n        continue;\r\n      }\r\n\r\n      let hadGroup = true;\r\n      const siblings = this.getSiblingsAtIndex(i, items);\r\n      const siblingGroupedItem = this.findGroupSiblingInItems(item, items, i, length);\r\n\r\n      // const foundItem = this.findGroupSiblingInSiblings(item, siblings);\r\n      const foundItem = siblingGroupedItem;\r\n      const group = foundItem?.group ?? (hadGroup = false, new BubbleGroup(this.chat, this, item.dateTimestamp));\r\n\r\n      modifiedGroups.add(group);\r\n      group.insertItem(item);\r\n\r\n      if(!hadGroup) {\r\n        const splittedGroups = this.splitSiblingsOnGrouping(siblings);\r\n        if(splittedGroups) {\r\n          splittedGroups.forEach((group) => modifiedGroups.add(group));\r\n        }\r\n      }\r\n    }\r\n\r\n    return modifiedGroups;\r\n  }\r\n\r\n  // addBubble(bubble: HTMLElement, message: MyMessage, unmountIfFound?: boolean) {\r\n  //   const oldItem = this.getItemByBubble(bubble);\r\n  //   if(unmountIfFound) { // updating position\r\n  //     this.removeAndUnmountBubble(bubble);\r\n  //   } else if(oldItem) { // editing\r\n  //     const group = oldItem.group;\r\n  //     this.changeItemBubble(oldItem, bubble);\r\n  //     oldItem.mounted = false;\r\n\r\n  //     return {item: oldItem, group};\r\n  //   }\r\n\r\n  //   const item = this.createItem(bubble, message);\r\n\r\n  //   const foundItem = this.findSameGroupItem(item, this.itemsArr);\r\n\r\n  //   const group = foundItem?.group ?? new BubbleGroup(this.chat, this, item.dateTimestamp);\r\n  //   this.addItemToGroup(item, group);\r\n\r\n  //   return {item, group};\r\n  // }\r\n\r\n  /* setClipIfNeeded(bubble: HTMLDivElement, remove = false) {\r\n    //console.log('setClipIfNeeded', bubble, remove);\r\n    const className = bubble.className;\r\n    if(className.includes('is-message-empty') && (className.includes('photo') || className.includes('video'))) {\r\n      let container = bubble.querySelector('.bubble__media-container') as SVGSVGElement;\r\n      //console.log('setClipIfNeeded', bubble, remove, container);\r\n      if(!container) return;\r\n\r\n      try {\r\n        Array.from(container.children).forEach((object) => {\r\n          if(object instanceof SVGDefsElement) return;\r\n\r\n          if(remove) {\r\n            object.removeAttributeNS(null, 'clip-path');\r\n          } else {\r\n            let clipId = container.dataset.clipId;\r\n            let path = container.firstElementChild.firstElementChild.lastElementChild as SVGPathElement;\r\n            let width = +object.getAttributeNS(null, 'width');\r\n            let height = +object.getAttributeNS(null, 'height');\r\n            let isOut = className.includes('is-out');\r\n            let isReply = className.includes('is-reply');\r\n            let d = '';\r\n\r\n            //console.log('setClipIfNeeded', object, width, height, isOut);\r\n\r\n            let tr: number, tl: number;\r\n            if(className.includes('forwarded') || isReply) {\r\n              tr = tl = 0;\r\n            } else if(isOut) {\r\n              tr = className.includes('is-group-first') ? 12 : 6;\r\n              tl = 12;\r\n            } else {\r\n              tr = 12;\r\n              tl = className.includes('is-group-first') ? 12 : 6;\r\n            }\r\n\r\n            if(isOut) {\r\n              d = generatePathData(0, 0, width - 9, height, tl, tr, 0, 12);\r\n            } else {\r\n              d = generatePathData(9, 0, width - 9, height, tl, tr, 12, 0);\r\n            }\r\n\r\n            path.setAttributeNS(null, 'd', d);\r\n            object.setAttributeNS(null, 'clip-path', 'url(#' + clipId + ')');\r\n          }\r\n        });\r\n      } catch(err) {}\r\n    }\r\n  } */\r\n\r\n  // updateGroupByMessageId(mid: number) {\r\n  //   const item = this.itemsArr.find((g) => g.mid === mid);\r\n  //   if(item) {\r\n  //     item.group.updateGroup();\r\n  //   }\r\n  // }\r\n\r\n  cleanup() {\r\n    this.itemsArr = [];\r\n    this.groups = [];\r\n    this.itemsMap.clear();\r\n  }\r\n\r\n  // findIncorrentPositions() {\r\n  //   var bubbles = Array.from(this.chat.bubbles.chatInner.querySelectorAll('.bubbles-group .bubble')).reverse();\r\n  //   var items = this.itemsArr;\r\n  //   for(var i = 0, length = items.length; i < length; ++i) {\r\n  //     const item = items[i];\r\n  //     const foundBubble = bubbles[i];\r\n  //     if(item.bubble !== foundBubble) {\r\n  //       console.log('incorrect position', i, item, foundBubble);\r\n  //       // debugger;\r\n  //       // break;\r\n  //     }\r\n  //   }\r\n  // }\r\n}\r\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nexport default function partition<T>(arr: T[], callback: (item: T, idx: number, arr: T[]) => boolean) {\n  const good: T[] = [], bad: T[] = [];\n  for(let i = 0, length = arr.length; i < length; ++i) {\n    const item = arr[i];\n    (callback(item, i, arr) ? good : bad).push(item);\n  }\n\n  return [good, bad];\n}\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport PopupElement, {PopupOptions} from '.';\r\nimport {attachClickEvent} from '../../helpers/dom/clickEvent';\r\nimport mediaSizes from '../../helpers/mediaSizes';\r\nimport I18n, {FormatterArguments, i18n, LangPackKey} from '../../lib/langPack';\r\nimport InputField from '../inputField';\r\n\r\nexport default class PopupDatePicker extends PopupElement {\r\n  protected controlsDiv: HTMLElement;\r\n  protected monthTitle: HTMLElement;\r\n  protected prevBtn: HTMLElement;\r\n  protected nextBtn: HTMLElement;\r\n\r\n  protected monthsContainer: HTMLElement;\r\n  protected month: HTMLElement;\r\n\r\n  protected minMonth: Date;\r\n  protected maxMonth: Date;\r\n  protected minDate: Date;\r\n  protected maxDate: Date;\r\n  protected selectedDate: Date;\r\n  protected selectedMonth: Date;\r\n  protected selectedEl: HTMLElement;\r\n\r\n  protected timeDiv: HTMLDivElement;\r\n  protected hoursInputField: InputField;\r\n  protected minutesInputField: InputField;\r\n\r\n  constructor(initDate: Date, public onPick: (timestamp: number) => void, protected options: Partial<{\r\n    noButtons: true,\r\n    noTitle: true,\r\n    minDate: Date,\r\n    maxDate: Date\r\n    withTime: true,\r\n    showOverflowMonths: true\r\n  }> & PopupOptions = {}) {\r\n    super('popup-date-picker', {\r\n      body: true,\r\n      overlayClosable: true,\r\n      buttons: options.noButtons ? [] : [{\r\n        langKey: 'JumpToDate',\r\n        callback: () => {\r\n          if(this.onPick) {\r\n            this.onPick(this.selectedDate.getTime() / 1000 | 0);\r\n          }\r\n        }\r\n      }, {\r\n        langKey: 'Cancel',\r\n        isCancel: true\r\n      }],\r\n      title: true,\r\n      ...options\r\n    });\r\n\r\n    this.minDate = options.minDate || new Date('2013-08-01T00:00:00');\r\n\r\n    if(initDate < this.minDate) {\r\n      initDate.setFullYear(this.minDate.getFullYear(), this.minDate.getMonth(), this.minDate.getDate());\r\n    }\r\n\r\n    // Controls\r\n    this.controlsDiv = document.createElement('div');\r\n    this.controlsDiv.classList.add('date-picker-controls');\r\n\r\n    this.prevBtn = document.createElement('button');\r\n    this.prevBtn.classList.add('btn-icon', 'tgico-down', 'date-picker-prev');\r\n    attachClickEvent(this.prevBtn, this.onPrevClick, {listenerSetter: this.listenerSetter});\r\n\r\n    this.nextBtn = document.createElement('button');\r\n    this.nextBtn.classList.add('btn-icon', 'tgico-down', 'date-picker-next');\r\n    attachClickEvent(this.nextBtn, this.onNextClick, {listenerSetter: this.listenerSetter});\r\n\r\n    this.monthTitle = document.createElement('div');\r\n    this.monthTitle.classList.add('date-picker-month-title');\r\n\r\n    this.controlsDiv.append(this.prevBtn, this.monthTitle, this.nextBtn);\r\n\r\n    // Month\r\n    this.monthsContainer = document.createElement('div');\r\n    this.monthsContainer.classList.add('date-picker-months');\r\n    attachClickEvent(this.monthsContainer, this.onDateClick, {listenerSetter: this.listenerSetter});\r\n\r\n    this.body.append(this.controlsDiv, this.monthsContainer);\r\n\r\n    // Time inputs\r\n    if(options.withTime) {\r\n      this.timeDiv = document.createElement('div');\r\n      this.timeDiv.classList.add('date-picker-time');\r\n\r\n      const delimiter = document.createElement('div');\r\n      delimiter.classList.add('date-picker-time-delimiter');\r\n      delimiter.append(':');\r\n\r\n      const handleTimeInput = (max: number, inputField: InputField, onInput: (length: number) => void, onOverflow?: (number: number) => void) => {\r\n        const maxString = '' + max;\r\n        this.listenerSetter.add(inputField.input)('input', (e) => {\r\n          let value = inputField.value.replace(/\\D/g, '');\r\n          if(value.length > 2) {\r\n            value = value.slice(0, 2);\r\n          } else {\r\n            if((value.length === 1 && +value[0] > +maxString[0]) || (value.length === 2 && +value > max)) {\r\n              if(value.length === 2 && onOverflow) {\r\n                onOverflow(+value[1]);\r\n              }\r\n\r\n              value = '0' + value[0];\r\n            }\r\n          }\r\n\r\n          inputField.setValueSilently(value);\r\n          onInput(value.length);\r\n        });\r\n      };\r\n\r\n      this.hoursInputField = new InputField({plainText: true});\r\n      this.minutesInputField = new InputField({plainText: true});\r\n\r\n      handleTimeInput(23, this.hoursInputField, (length) => {\r\n        if(length === 2) {\r\n          this.minutesInputField.input.focus();\r\n        }\r\n\r\n        this.setTimeTitle();\r\n      }, (number) => {\r\n        this.minutesInputField.value = (number + this.minutesInputField.value).slice(0, 2);\r\n      });\r\n      handleTimeInput(59, this.minutesInputField, (length) => {\r\n        if(!length) {\r\n          this.hoursInputField.input.focus();\r\n        }\r\n\r\n        this.setTimeTitle();\r\n      });\r\n\r\n      this.selectedDate = initDate;\r\n\r\n      initDate.setMinutes(initDate.getMinutes() + 10);\r\n\r\n      this.hoursInputField.setValueSilently(('0' + initDate.getHours()).slice(-2));\r\n      this.minutesInputField.setValueSilently(('0' + initDate.getMinutes()).slice(-2));\r\n\r\n      initDate.setHours(0, 0, 0, 0);\r\n\r\n      this.timeDiv.append(this.hoursInputField.container, delimiter, this.minutesInputField.container);\r\n\r\n      attachClickEvent(this.btnConfirm, () => {\r\n        if(this.onPick) {\r\n          this.selectedDate.setHours(+this.hoursInputField.value || 0, +this.minutesInputField.value || 0, 0, 0);\r\n          this.onPick(this.selectedDate.getTime() / 1000 | 0);\r\n        }\r\n\r\n        this.hide();\r\n      }, {listenerSetter: this.listenerSetter});\r\n\r\n      this.body.append(this.timeDiv);\r\n\r\n      this.prevBtn.classList.add('primary');\r\n      this.nextBtn.classList.add('primary');\r\n    }\r\n\r\n    const popupCenterer = document.createElement('div');\r\n    popupCenterer.classList.add('popup-centerer');\r\n    popupCenterer.append(this.container);\r\n    this.element.append(popupCenterer);\r\n\r\n    // const passed = (initDate.getTime() - (initDate.getTimezoneOffset() * 60000)) % 86400000;\r\n    // this.selectedDate = this.maxDate = new Date(initDate.getTime() - passed);\r\n    initDate.setHours(0, 0, 0, 0);\r\n    this.selectedDate = initDate;\r\n\r\n    this.maxDate = options.maxDate || new Date();\r\n    this.maxDate.setHours(0, 0, 0, 0);\r\n\r\n    this.selectedMonth = new Date(this.selectedDate);\r\n    this.selectedMonth.setDate(1);\r\n\r\n    this.maxMonth = new Date(this.maxDate);\r\n    this.maxMonth.setDate(1);\r\n\r\n    this.minMonth = new Date(this.minDate);\r\n    this.minMonth.setHours(0, 0, 0, 0);\r\n    this.minMonth.setDate(1);\r\n\r\n    if(this.selectedMonth.getTime() === this.minMonth.getTime()) {\r\n      this.prevBtn.setAttribute('disabled', 'true');\r\n    }\r\n\r\n    if(this.selectedMonth.getTime() === this.maxMonth.getTime()) {\r\n      this.nextBtn.setAttribute('disabled', 'true');\r\n    }\r\n\r\n    if(options.noTitle) {\r\n      this.setTitle = () => {};\r\n    }\r\n\r\n    this.setTimeTitle();\r\n    this.setTitle();\r\n    this.setMonth();\r\n  }\r\n\r\n  onPrevClick = (e: MouseEvent) => {\r\n    this.selectedMonth.setMonth(this.selectedMonth.getMonth() - 1);\r\n    this.setMonth();\r\n\r\n    if(this.selectedMonth.getTime() === this.minMonth.getTime()) {\r\n      this.prevBtn.setAttribute('disabled', 'true');\r\n    }\r\n\r\n    this.nextBtn.removeAttribute('disabled');\r\n  };\r\n\r\n  onNextClick = (e: MouseEvent) => {\r\n    this.selectedMonth.setMonth(this.selectedMonth.getMonth() + 1);\r\n    this.setMonth();\r\n\r\n    if(this.selectedMonth.getTime() === this.maxMonth.getTime()) {\r\n      this.nextBtn.setAttribute('disabled', 'true');\r\n    }\r\n\r\n    this.prevBtn.removeAttribute('disabled');\r\n  };\r\n\r\n  onDateClick = (e: MouseEvent) => {\r\n    // cancelEvent(e);\r\n    const target = e.target as HTMLElement;\r\n\r\n    if(!target.dataset.timestamp) return;\r\n\r\n    if(this.selectedEl) {\r\n      if(this.selectedEl === target) return;\r\n      this.selectedEl.classList.remove('active');\r\n    }\r\n\r\n    this.selectedEl = target;\r\n\r\n    target.classList.add('active');\r\n    const timestamp = +target.dataset.timestamp;\r\n\r\n    this.selectedDate = new Date(timestamp);\r\n\r\n    this.setTitle();\r\n    this.setTimeTitle();\r\n  };\r\n\r\n  public setTimeTitle() {\r\n    if(this.btnConfirm && this.selectedDate) {\r\n      let key: LangPackKey;\r\n      const args: FormatterArguments = [];\r\n      const date = new Date();\r\n      date.setHours(0, 0, 0, 0);\r\n\r\n      const timeOptions: Intl.DateTimeFormatOptions = {\r\n        minute: '2-digit',\r\n        hour: '2-digit'\r\n      };\r\n\r\n      const sendDate = new Date(this.selectedDate.getTime());\r\n      sendDate.setHours(+this.hoursInputField.value, +this.minutesInputField.value);\r\n\r\n      if(this.selectedDate.getTime() === date.getTime()) {\r\n        key = 'Schedule.SendToday';\r\n      }/*  else if(this.selectedDate.getTime() === (date.getTime() + 86400e3)) {\r\n        dayStr = 'Tomorrow';\r\n      } */ else {\r\n        key = 'Schedule.SendDate';\r\n\r\n        const dateOptions: Intl.DateTimeFormatOptions = {\r\n          month: 'short',\r\n          day: 'numeric'\r\n        };\r\n\r\n        if(sendDate.getFullYear() !== date.getFullYear()) {\r\n          dateOptions.year = 'numeric';\r\n        }\r\n\r\n        args.push(new I18n.IntlDateElement({\r\n          date: sendDate,\r\n          options: dateOptions\r\n        }).element);\r\n      }\r\n\r\n      args.push(new I18n.IntlDateElement({\r\n        date: sendDate,\r\n        options: timeOptions\r\n      }).element);\r\n\r\n      this.btnConfirm.firstChild.replaceWith(i18n(key, args));\r\n    }\r\n  }\r\n\r\n  public setTitle() {\r\n    // const splitted = this.selectedDate.toString().split(' ', 3);\r\n    // this.title.innerText = splitted[0] + ', ' + splitted[1] + ' ' + splitted[2];\r\n    this.title.textContent = '';\r\n    this.title.append(new I18n.IntlDateElement({\r\n      date: this.selectedDate,\r\n      options: {\r\n        day: 'numeric',\r\n        month: 'long',\r\n        weekday: 'short'\r\n      }\r\n    }).element);\r\n  }\r\n\r\n  private renderElement(disabled: boolean, innerText: string | HTMLElement = '') {\r\n    const el = document.createElement('button');\r\n    el.classList.add('btn-icon', 'date-picker-month-date');\r\n\r\n    if(disabled) {\r\n      el.setAttribute('disabled', 'true');\r\n    }\r\n\r\n    if(innerText) {\r\n      el.append(innerText);\r\n    }\r\n\r\n    return el;\r\n  }\r\n\r\n  public setMonth() {\r\n    const firstDate = new Date(this.selectedMonth);\r\n\r\n    const options: Intl.DateTimeFormatOptions = {\r\n      year: 'numeric',\r\n      month: this.timeDiv && mediaSizes.isMobile ? 'short' : 'long'\r\n    };\r\n\r\n    this.monthTitle.textContent = '';\r\n    this.monthTitle.append(new I18n.IntlDateElement({date: firstDate, options}).element);\r\n    // this.monthTitle.innerText = (this.timeDiv && mediaSizes.isMobile ? monthName.slice(0, 3) : monthName) + ' ' + this.selectedMonth.getFullYear();\r\n\r\n    if(this.month) {\r\n      this.month.remove();\r\n    }\r\n\r\n    this.month = document.createElement('div');\r\n    this.month.classList.add('date-picker-month');\r\n\r\n    const weekStartDate = new Date();\r\n    const day = weekStartDate.getDay();\r\n    if(day !== 1) {\r\n      weekStartDate.setHours(-24 * (day - 1));\r\n    }\r\n\r\n    for(let i = 0; i < 7; ++i) {\r\n      const el = this.renderElement(true, new I18n.IntlDateElement({date: weekStartDate, options: {weekday: 'narrow'}}).element);\r\n      el.classList.remove('date-picker-month-date');\r\n      el.classList.add('date-picker-month-day');\r\n      this.month.append(el);\r\n      weekStartDate.setDate(weekStartDate.getDate() + 1);\r\n    }\r\n\r\n    // 0 - sunday\r\n    let dayIndex = firstDate.getDay() - 1;\r\n    if(dayIndex === -1) dayIndex = 7 - 1;\r\n\r\n    const clonedDate = new Date(firstDate.getTime());\r\n    clonedDate.setDate(clonedDate.getDate() - dayIndex - 1);\r\n\r\n    // Padding first week\r\n    for(let i = 0; i < dayIndex; ++i) {\r\n      if(this.options.showOverflowMonths) {\r\n        clonedDate.setDate(clonedDate.getDate() + 1);\r\n        this.month.append(this.renderElement(true, '' + clonedDate.getDate()));\r\n      } else {\r\n        this.month.append(this.renderElement(true));\r\n      }\r\n    }\r\n\r\n    do {\r\n      const date = firstDate.getDate();\r\n      const el = this.renderElement(firstDate > this.maxDate || firstDate < this.minDate, '' + date);\r\n      el.dataset.timestamp = '' + firstDate.getTime();\r\n\r\n      if(firstDate.getTime() === this.selectedDate.getTime()) {\r\n        this.selectedEl = el;\r\n        el.classList.add('active');\r\n      }\r\n\r\n      this.month.append(el);\r\n\r\n      firstDate.setDate(date + 1);\r\n    } while(firstDate.getDate() !== 1);\r\n\r\n    const remainder = this.month.childElementCount % 7;\r\n    if(this.options.showOverflowMonths && remainder) {\r\n      for(let i = remainder; i < 7; ++i) {\r\n        this.month.append(this.renderElement(true, '' + firstDate.getDate()));\r\n        firstDate.setDate(firstDate.getDate() + 1);\r\n      }\r\n    }\r\n\r\n    const lines = Math.ceil(this.month.childElementCount / 7);\r\n    this.container.dataset.lines = '' + lines;\r\n\r\n    this.monthsContainer.append(this.month);\r\n  }\r\n}\r\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport callbackify from '../../helpers/callbackify';\nimport formatNumber from '../../helpers/number/formatNumber';\nimport {fastRaf} from '../../helpers/schedulers';\nimport {MessagePeerReaction, ReactionCount} from '../../layer';\nimport {AppManagers} from '../../lib/appManagers/managers';\nimport getPeerId from '../../lib/appManagers/utils/peers/getPeerId';\nimport RLottiePlayer from '../../lib/rlottie/rlottiePlayer';\nimport rootScope from '../../lib/rootScope';\nimport SetTransition from '../singleTransition';\nimport StackedAvatars from '../stackedAvatars';\nimport {wrapSticker, wrapStickerAnimation} from '../wrappers';\nimport {Awaited} from '../../types';\n\nconst CLASS_NAME = 'reaction';\nconst TAG_NAME = CLASS_NAME + '-element';\nconst REACTION_INLINE_SIZE = 14;\nconst REACTION_BLOCK_SIZE = 22;\n\nexport const REACTION_DISPLAY_INLINE_COUNTER_AT = 2;\nexport const REACTION_DISPLAY_BLOCK_COUNTER_AT = 4;\n\nexport type ReactionLayoutType = 'block' | 'inline';\n\nexport default class ReactionElement extends HTMLElement {\n  private type: ReactionLayoutType;\n  private counter: HTMLElement;\n  private stickerContainer: HTMLElement;\n  private stackedAvatars: StackedAvatars;\n  private canRenderAvatars: boolean;\n  private _reactionCount: ReactionCount;\n  private wrapStickerPromise: Awaited<ReturnType<typeof wrapSticker>>['render'];\n  private managers: AppManagers;\n\n  constructor() {\n    super();\n    this.classList.add(CLASS_NAME);\n    this.managers = rootScope.managers;\n  }\n\n  public get reactionCount() {\n    return this._reactionCount;\n  }\n\n  public set reactionCount(reactionCount: ReactionCount) {\n    this._reactionCount = reactionCount;\n  }\n\n  public get count() {\n    return this.reactionCount.count;\n  }\n\n  public init(type: ReactionLayoutType) {\n    this.type = type;\n    this.classList.add(CLASS_NAME + '-' + type);\n  }\n\n  public setCanRenderAvatars(canRenderAvatars: boolean) {\n    this.canRenderAvatars = canRenderAvatars;\n  }\n\n  public render(doNotRenderSticker?: boolean) {\n    const hadStickerContainer = !!this.stickerContainer;\n    if(!hadStickerContainer) {\n      this.stickerContainer = document.createElement('div');\n      this.stickerContainer.classList.add(CLASS_NAME + '-sticker');\n      this.append(this.stickerContainer);\n    }\n\n    const reactionCount = this.reactionCount;\n    if(!doNotRenderSticker && !hadStickerContainer) {\n      const availableReaction = this.managers.appReactionsManager.getReaction(reactionCount.reaction);\n      callbackify(availableReaction, (availableReaction) => {\n        if(!availableReaction.center_icon) {\n          this.stickerContainer.classList.add('is-static');\n        }\n\n        if(availableReaction.pFlags.inactive) {\n          this.classList.add('is-inactive');\n        }\n\n        const size = this.type === 'inline' ? REACTION_INLINE_SIZE : REACTION_BLOCK_SIZE;\n        const wrapPromise = this.wrapStickerPromise = wrapSticker({\n          div: this.stickerContainer,\n          doc: availableReaction.center_icon ?? availableReaction.static_icon,\n          width: size,\n          height: size,\n          static: true,\n          managers: this.managers\n        }).then(({render}) => render).finally(() => {\n          if(this.wrapStickerPromise === wrapPromise) {\n            this.wrapStickerPromise = undefined;\n          }\n        });\n      });\n    }\n  }\n\n  public renderCounter() {\n    const reactionCount = this.reactionCount;\n    const displayOn = this.type === 'inline' ? REACTION_DISPLAY_INLINE_COUNTER_AT : REACTION_DISPLAY_BLOCK_COUNTER_AT;\n    if(reactionCount.count >= displayOn || (this.type === 'block' && !this.canRenderAvatars)) {\n      if(!this.counter) {\n        this.counter = document.createElement(this.type === 'inline' ? 'i' : 'span');\n        this.counter.classList.add(CLASS_NAME + '-counter');\n      }\n\n      const formatted = formatNumber(reactionCount.count);\n      if(this.counter.textContent !== formatted) {\n        this.counter.textContent = formatted;\n      }\n\n      if(!this.counter.parentElement) {\n        this.append(this.counter);\n      }\n    } else if(this.counter?.parentElement) {\n      this.counter.remove();\n      this.counter = undefined;\n    }\n  }\n\n  public renderAvatars(recentReactions: MessagePeerReaction[]) {\n    if(this.type === 'inline') {\n      return;\n    }\n\n    if(this.reactionCount.count >= REACTION_DISPLAY_BLOCK_COUNTER_AT || !this.canRenderAvatars) {\n      if(this.stackedAvatars) {\n        this.stackedAvatars.container.remove();\n        this.stackedAvatars = undefined;\n      }\n\n      return;\n    }\n\n    if(!this.stackedAvatars) {\n      this.stackedAvatars = new StackedAvatars({\n        avatarSize: 24\n      });\n\n      this.append(this.stackedAvatars.container);\n    }\n\n    this.stackedAvatars.render(recentReactions.map((reaction) => getPeerId(reaction.peer_id)));\n  }\n\n  public setIsChosen(isChosen = !!this.reactionCount.pFlags.chosen) {\n    if(this.type === 'inline') return;\n    const wasChosen = this.classList.contains('is-chosen') && !this.classList.contains('backwards');\n    if(wasChosen !== isChosen) {\n      SetTransition(this, 'is-chosen', isChosen, this.isConnected ? 300 : 0);\n    }\n  }\n\n  public fireAroundAnimation() {\n    callbackify(this.managers.appReactionsManager.getReaction(this.reactionCount.reaction), (availableReaction) => {\n      const size = this.type === 'inline' ? REACTION_INLINE_SIZE + 14 : REACTION_BLOCK_SIZE + 18;\n      const div = document.createElement('div');\n      div.classList.add(CLASS_NAME + '-sticker-activate');\n\n      Promise.all([\n        wrapSticker({\n          div: div,\n          doc: availableReaction.center_icon,\n          width: size,\n          height: size,\n          withThumb: false,\n          needUpscale: true,\n          play: false,\n          skipRatio: 1,\n          group: 'none',\n          needFadeIn: false,\n          managers: this.managers\n        }).then(({render}) => render as Promise<RLottiePlayer>),\n\n        wrapStickerAnimation({\n          doc: availableReaction.around_animation,\n          size: 80,\n          target: this.stickerContainer,\n          side: 'center',\n          skipRatio: 1,\n          play: false,\n          managers: this.managers\n        }).stickerPromise\n      ]).then(([iconPlayer, aroundPlayer]) => {\n        const remove = () => {\n          // if(!isInDOM(div)) return;\n          fastRaf(() => {\n            // if(!isInDOM(div)) return;\n            iconPlayer.remove();\n            div.remove();\n            this.stickerContainer.classList.remove('has-animation');\n          });\n        };\n\n        iconPlayer.addEventListener('enterFrame', (frameNo) => {\n          if(frameNo === iconPlayer.maxFrame) {\n            if(this.wrapStickerPromise) { // wait for fade in animation\n              this.wrapStickerPromise.then(() => {\n                setTimeout(remove, 1e3);\n              });\n            } else {\n              remove();\n            }\n          }\n        });\n\n        iconPlayer.addEventListener('firstFrame', () => {\n          this.stickerContainer.append(div);\n          this.stickerContainer.classList.add('has-animation');\n          iconPlayer.play();\n          aroundPlayer.play();\n        }, {once: true});\n      });\n    });\n  }\n}\n\ncustomElements.define(TAG_NAME, ReactionElement);\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport forEachReverse from '../../helpers/array/forEachReverse';\nimport positionElementByIndex from '../../helpers/dom/positionElementByIndex';\nimport {Message, ReactionCount} from '../../layer';\nimport appImManager from '../../lib/appManagers/appImManager';\nimport {AppManagers} from '../../lib/appManagers/managers';\nimport rootScope from '../../lib/rootScope';\nimport ReactionElement, {ReactionLayoutType, REACTION_DISPLAY_BLOCK_COUNTER_AT} from './reaction';\n\nconst CLASS_NAME = 'reactions';\nconst TAG_NAME = CLASS_NAME + '-element';\n\nconst REACTIONS_ELEMENTS: Map<string, Set<ReactionsElement>> = new Map();\nexport {REACTIONS_ELEMENTS};\n\nexport default class ReactionsElement extends HTMLElement {\n  private message: Message.message;\n  private key: string;\n  private isPlaceholder: boolean;\n  private type: ReactionLayoutType;\n  private sorted: ReactionElement[];\n  private onConnectCallback: () => void;\n  private managers: AppManagers;\n\n  constructor() {\n    super();\n    this.classList.add(CLASS_NAME);\n    this.sorted = [];\n    this.managers = rootScope.managers;\n  }\n\n  connectedCallback() {\n    let set = REACTIONS_ELEMENTS.get(this.key);\n    if(!set) {\n      REACTIONS_ELEMENTS.set(this.key, set = new Set());\n    }\n\n    set.add(this);\n\n    if(this.onConnectCallback && this.isConnected) {\n      this.onConnectCallback();\n      this.onConnectCallback = undefined;\n    }\n  }\n\n  disconnectedCallback() {\n    const set = REACTIONS_ELEMENTS.get(this.key);\n    set.delete(this);\n    if(!set.size) {\n      REACTIONS_ELEMENTS.delete(this.key);\n    }\n  }\n\n  public getReactionCount(reactionElement: ReactionElement) {\n    return this.sorted[this.sorted.indexOf(reactionElement)].reactionCount;\n  }\n\n  public getMessage() {\n    return this.message;\n  }\n\n  public init(message: Message.message, type: ReactionLayoutType, isPlaceholder?: boolean) {\n    if(this.key !== undefined) {\n      this.disconnectedCallback();\n    }\n\n    this.message = message;\n    this.key = this.message.peerId + '_' + this.message.mid;\n    this.isPlaceholder = isPlaceholder;\n\n    if(this.type !== type) {\n      this.type = type;\n      this.classList.add(CLASS_NAME + '-' + type);\n    }\n\n    this.connectedCallback();\n  }\n\n  public changeMessage(message: Message.message) {\n    return this.init(message, this.type, this.isPlaceholder);\n  }\n\n  public update(message: Message.message, changedResults?: ReactionCount[]) {\n    this.message = message;\n    this.render(changedResults);\n  }\n\n  public render(changedResults?: ReactionCount[]) {\n    const reactions = this.message.reactions;\n    const hasReactions = !!(reactions && reactions.results.length);\n    this.classList.toggle('has-no-reactions', !hasReactions);\n    if(!hasReactions && !this.sorted.length) return;\n\n    const availableReactionsResult = this.managers.appReactionsManager.getAvailableReactions();\n    // callbackify(availableReactionsResult, () => {\n    const counts = hasReactions ? (\n        availableReactionsResult instanceof Promise ?\n          reactions.results :\n          reactions.results.filter((reactionCount) => {\n            return this.managers.appReactionsManager.isReactionActive(reactionCount.reaction);\n          })\n      ) : [];\n\n    forEachReverse(this.sorted, (reactionElement, idx, arr) => {\n      const reaction = reactionElement.reactionCount.reaction;\n      const found = counts.some((reactionCount) => reactionCount.reaction === reaction);\n      if(!found) {\n        arr.splice(idx, 1);\n        reactionElement.remove();\n      }\n    });\n\n    const totalReactions = counts.reduce((acc, c) => acc + c.count, 0);\n    const canRenderAvatars = reactions && !!reactions.pFlags.can_see_list && totalReactions < REACTION_DISPLAY_BLOCK_COUNTER_AT;\n    this.sorted = counts.map((reactionCount, idx) => {\n      const reactionElementIdx = this.sorted.findIndex((reactionElement) => reactionElement.reactionCount.reaction === reactionCount.reaction);\n      let reactionElement = reactionElementIdx !== -1 && this.sorted[reactionElementIdx];\n      if(!reactionElement) {\n        reactionElement = new ReactionElement();\n        reactionElement.init(this.type);\n      }\n\n      positionElementByIndex(reactionElement, this, idx);\n\n      const recentReactions = reactions.recent_reactions ? reactions.recent_reactions.filter((reaction) => reaction.reaction === reactionCount.reaction) : [];\n      reactionElement.reactionCount = {...reactionCount};\n      reactionElement.setCanRenderAvatars(canRenderAvatars);\n      reactionElement.render(this.isPlaceholder);\n      reactionElement.renderCounter();\n      reactionElement.renderAvatars(recentReactions);\n      reactionElement.setIsChosen();\n\n      return reactionElement;\n    });\n\n    // this.sorted.forEach((reactionElement, idx) => {\n    //   /* if(this.type === 'block' && this.childElementCount !== this.sorted.length) { // because of appended time\n    //     idx += 1;\n    //   } */\n\n    //   positionElementByIndex(reactionElement, this, idx);\n    // });\n\n    if(!this.isPlaceholder && changedResults?.length) {\n      if(this.isConnected) {\n        this.handleChangedResults(changedResults);\n      } else {\n        this.onConnectCallback = () => {\n          this.handleChangedResults(changedResults);\n        };\n      }\n    }\n    // });\n\n    // !       ,     \n    if(!this.sorted.length && this.type === 'block') {\n      const parentElement = this.parentElement;\n      this.remove();\n\n      if(parentElement.classList.contains('document-message') && !parentElement.childNodes.length) {\n        parentElement.remove();\n        return;\n      }\n\n      const timeSpan = this.querySelector('.time');\n      if(timeSpan) {\n        parentElement.append(timeSpan);\n      }\n    }\n  }\n\n  private handleChangedResults(changedResults: ReactionCount[]) {\n    // ! temp\n    if(this.message.peerId !== appImManager.chat.peerId) return;\n\n    changedResults.forEach((reactionCount) => {\n      const reactionElement = this.sorted.find((reactionElement) => reactionElement.reactionCount.reaction === reactionCount.reaction);\n      if(reactionElement) {\n        reactionElement.fireAroundAnimation();\n      }\n    });\n  }\n}\n\ncustomElements.define(TAG_NAME, ReactionsElement);\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport {Message} from '../../layer';\r\nimport rootScope from '../../lib/rootScope';\r\nimport ripple from '../ripple';\r\nimport I18n from '../../lib/langPack';\r\nimport replaceContent from '../../helpers/dom/replaceContent';\r\nimport StackedAvatars from '../stackedAvatars';\r\nimport formatNumber from '../../helpers/number/formatNumber';\r\nimport {AppManagers} from '../../lib/appManagers/managers';\r\nimport getPeerId from '../../lib/appManagers/utils/peers/getPeerId';\r\nimport type LazyLoadQueue from '../lazyLoadQueue';\r\n\r\nconst TAG_NAME = 'replies-element';\r\n\r\nrootScope.addEventListener('replies_updated', (message) => {\r\n  (Array.from(document.querySelectorAll(TAG_NAME + `[data-post-key=\"${message.peerId}_${message.mid}\"]`)) as RepliesElement[]).forEach((element) => {\r\n    element.message = message;\r\n    element.render();\r\n  });\r\n});\r\n\r\nexport default class RepliesElement extends HTMLElement {\r\n  public message: Message.message;\r\n  public type: 'footer' | 'beside';\r\n  public loadPromises: Promise<any>[];\r\n  public lazyLoadQueue: LazyLoadQueue;\r\n  public stackedAvatars: StackedAvatars;\r\n  public text: I18n.IntlElement;\r\n  public managers: AppManagers;\r\n\r\n  private updated = false;\r\n\r\n  constructor() {\r\n    super();\r\n    this.managers = rootScope.managers;\r\n  }\r\n\r\n  public init() {\r\n    this.render();\r\n    this.dataset.postKey = this.message.peerId + '_' + this.message.mid;\r\n    this.classList.add('replies', 'replies-' + this.type);\r\n  }\r\n\r\n  public render() {\r\n    const replies = this.message.replies;\r\n\r\n    /* if(this.firstChild) {\r\n      this.innerHTML = '';\r\n    } */\r\n\r\n    if(this.type === 'footer') {\r\n      let leftPart: HTMLElement;\r\n      if(this.firstElementChild) {\r\n        leftPart = this.firstElementChild as HTMLElement;\r\n      }\r\n\r\n      if(replies?.recent_repliers) {\r\n        if(leftPart && !leftPart.classList.contains('replies-footer-avatars')) {\r\n          this.innerHTML = '';\r\n          leftPart = null;\r\n        }\r\n\r\n        if(!this.stackedAvatars) {\r\n          this.stackedAvatars = new StackedAvatars({\r\n            lazyLoadQueue: this.lazyLoadQueue,\r\n            avatarSize: 30\r\n          });\r\n\r\n          this.stackedAvatars.container.classList.add('replies-footer-avatars');\r\n        }\r\n\r\n        leftPart = this.stackedAvatars.container;\r\n\r\n        this.stackedAvatars.render(replies.recent_repliers.map((peer) => getPeerId(peer)), this.loadPromises);\r\n      } else {\r\n        if(leftPart && !leftPart.classList.contains('tgico-comments')) {\r\n          leftPart.remove();\r\n          leftPart = null;\r\n        }\r\n\r\n        if(!leftPart) {\r\n          leftPart = document.createElement('span');\r\n          leftPart.classList.add('tgico-comments');\r\n        }\r\n      }\r\n\r\n      if(!leftPart.parentElement) {\r\n        this.prepend(leftPart);\r\n      }\r\n\r\n      if(!this.text) {\r\n        this.text = new I18n.IntlElement();\r\n      }\r\n\r\n      const text = this.text;\r\n      if(replies) {\r\n        if(replies.replies) {\r\n          text.compareAndUpdate({key: 'Comments', args: [replies.replies]});\r\n        } else {\r\n          text.compareAndUpdate({key: 'LeaveAComment'});\r\n        }\r\n      } else {\r\n        text.compareAndUpdate({key: 'ViewInChat'});\r\n      }\r\n\r\n      if(replies) {\r\n        // const historyStorage = appMessagesManager.getHistoryStorage(replies.channel_id.toPeerId(true));\r\n        let isUnread = false;\r\n        if(replies.replies) {\r\n          if(replies.read_max_id !== undefined && replies.max_id !== undefined) {\r\n            isUnread = replies.read_max_id < replies.max_id;\r\n          }/*  else {\r\n            isUnread = !historyStorage.readMaxId || historyStorage.readMaxId < (replies.max_id || 0);\r\n          } */\r\n        }\r\n        this.classList.toggle('is-unread', isUnread);\r\n      }\r\n\r\n      let textSpan = this.children[1] as HTMLElement;\r\n      if(!textSpan) {\r\n        textSpan = document.createElement('span');\r\n        textSpan.classList.add('replies-footer-text');\r\n\r\n        const iconSpan = document.createElement('span');\r\n        iconSpan.classList.add('tgico-next');\r\n\r\n        const rippleContainer = document.createElement('div');\r\n        ripple(rippleContainer);\r\n\r\n        this.append(textSpan, iconSpan, rippleContainer);\r\n      }\r\n\r\n      replaceContent(textSpan, text.element);\r\n    } else {\r\n      this.classList.add('bubble-beside-button');\r\n      this.innerHTML = `<span class=\"tgico-commentssticker\"></span><span class=\"replies-beside-text\">${replies?.replies ? formatNumber(replies.replies, 0) : ''}</span>`;\r\n    }\r\n\r\n    if(replies && !this.updated && !this.message.pFlags.is_outgoing) {\r\n      this.managers.appMessagesManager.subscribeRepliesThread(this.message.peerId, this.message.mid);\r\n      this.managers.appMessagesManager.updateMessage(this.message.peerId, this.message.mid, 'replies_updated');\r\n      this.updated = true;\r\n    }\r\n\r\n    if(this.loadPromises) {\r\n      this.loadPromises = undefined;\r\n    }\r\n  }\r\n}\r\n\r\ncustomElements.define(TAG_NAME, RepliesElement);\r\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport {formatTime, getFullDate} from '../../helpers/date';\nimport setInnerHTML from '../../helpers/dom/setInnerHTML';\nimport formatNumber from '../../helpers/number/formatNumber';\nimport {Message} from '../../layer';\nimport getPeerId from '../../lib/appManagers/utils/peers/getPeerId';\nimport {i18n, _i18n} from '../../lib/langPack';\nimport wrapEmojiText from '../../lib/richTextProcessor/wrapEmojiText';\nimport rootScope from '../../lib/rootScope';\nimport type LazyLoadQueue from '../lazyLoadQueue';\nimport PeerTitle from '../peerTitle';\nimport {wrapReply} from '../wrappers';\nimport Chat, {ChatType} from './chat';\nimport ReactionsElement from './reactions';\nimport RepliesElement from './replies';\n\nconst NBSP = '&nbsp;';\n\nconst makeEdited = () => {\n  const edited = document.createElement('i');\n  edited.classList.add('edited');\n  _i18n(edited, 'EditedMessage');\n  return edited;\n};\n\nconst makeSponsored = () => i18n('SponsoredMessage');\n\nexport namespace MessageRender {\n  /* export const setText = () => {\n\n  }; */\n\n  export const setTime = (options: {\n    chatType: ChatType,\n    message: Message.message | Message.messageService,\n    reactionsMessage?: Message.message\n  }) => {\n    const {chatType, message} = options;\n    const date = new Date(message.date * 1000);\n    const args: (HTMLElement | string)[] = [];\n\n    let editedSpan: HTMLElement, sponsoredSpan: HTMLElement, reactionsElement: ReactionsElement, reactionsMessage: Message.message;\n\n    const isSponsored = !!(message as Message.message).pFlags.sponsored;\n    const isMessage = !('action' in message) && !isSponsored;\n    let hasReactions: boolean;\n\n    const time: HTMLElement = isSponsored ? undefined : formatTime(date);\n    if(isMessage) {\n      if(message.views) {\n        const postAuthor = message.post_author || message.fwd_from?.post_author;\n\n        const postViewsSpan = document.createElement('span');\n        postViewsSpan.classList.add('post-views');\n        postViewsSpan.innerHTML = formatNumber(message.views, 1);\n\n        const channelViews = document.createElement('i');\n        channelViews.classList.add('tgico-channelviews', 'time-icon');\n\n        args.push(postViewsSpan, channelViews);\n        if(postAuthor) {\n          const span = document.createElement('span');\n          setInnerHTML(span, wrapEmojiText(postAuthor));\n          span.insertAdjacentHTML('beforeend', ',' + NBSP)\n          args.push(span);\n        }\n      }\n\n      if(message.edit_date && chatType !== 'scheduled' && !message.pFlags.edit_hide) {\n        args.unshift(editedSpan = makeEdited());\n      }\n\n      if(chatType !== 'pinned' && message.pFlags.pinned) {\n        const i = document.createElement('i');\n        i.classList.add('tgico-pinnedchat', 'time-icon');\n        args.unshift(i);\n      }\n\n      if(message.peer_id._ === 'peerUser'/*  && message.reactions?.results?.length */) {\n        hasReactions = true;\n\n        reactionsMessage = options.reactionsMessage;\n        reactionsElement = new ReactionsElement();\n        reactionsElement.init(reactionsMessage, 'inline', true);\n        reactionsElement.render();\n        args.unshift(reactionsElement);\n      }\n    } else if(isSponsored) {\n      args.push(sponsoredSpan = makeSponsored());\n    }\n\n    if(time) {\n      args.push(time);\n    }\n\n    let title = isSponsored ? undefined : getFullDate(date);\n    if(isMessage) {\n      title += (message.edit_date && !message.pFlags.edit_hide ? `\\nEdited: ${getFullDate(new Date(message.edit_date * 1000))}` : '') +\n        (message.fwd_from ? `\\nOriginal: ${getFullDate(new Date(message.fwd_from.date * 1000))}` : '');\n    }\n\n    const timeSpan = document.createElement('span');\n    timeSpan.classList.add('time', 'tgico');\n    // if(title) timeSpan.title = title;\n    timeSpan.append(...args);\n\n    const inner = document.createElement('div');\n    inner.classList.add('inner', 'tgico');\n    if(title) inner.title = title;\n\n    let clonedArgs = args;\n    if(editedSpan) {\n      clonedArgs[clonedArgs.indexOf(editedSpan)] = makeEdited();\n    }\n    if(sponsoredSpan) {\n      clonedArgs[clonedArgs.indexOf(sponsoredSpan)] = makeSponsored();\n    }\n    if(reactionsElement) {\n      const _reactionsElement = clonedArgs[clonedArgs.indexOf(reactionsElement)] = new ReactionsElement();\n      _reactionsElement.init(reactionsMessage, 'inline');\n      _reactionsElement.render();\n    }\n    clonedArgs = clonedArgs.map((a) => a instanceof HTMLElement && !a.classList.contains('i18n') && !a.classList.contains('reactions') ? a.cloneNode(true) as HTMLElement : a);\n    if(time) {\n      clonedArgs[clonedArgs.length - 1] = formatTime(date); // clone time\n    }\n    inner.append(...clonedArgs);\n\n    timeSpan.append(inner);\n\n    return timeSpan;\n  };\n\n  export const renderReplies = ({bubble, bubbleContainer, message, messageDiv, loadPromises, lazyLoadQueue}: {\n    bubble: HTMLElement,\n    bubbleContainer: HTMLElement,\n    message: Message.message,\n    messageDiv: HTMLElement,\n    loadPromises?: Promise<any>[],\n    lazyLoadQueue?: LazyLoadQueue\n  }) => {\n    const isFooter = !bubble.classList.contains('sticker') && !bubble.classList.contains('emoji-big') && !bubble.classList.contains('round');\n    const repliesFooter = new RepliesElement();\n    repliesFooter.message = message;\n    repliesFooter.type = isFooter ? 'footer' : 'beside';\n    repliesFooter.loadPromises = loadPromises;\n    repliesFooter.lazyLoadQueue = lazyLoadQueue;\n    repliesFooter.init();\n    bubbleContainer.prepend(repliesFooter);\n    return isFooter;\n  };\n\n  export const setReply = async({chat, bubble, bubbleContainer, message}: {\n    chat: Chat,\n    bubble: HTMLElement,\n    bubbleContainer?: HTMLElement,\n    message: Message.message\n  }) => {\n    const isReplacing = !bubbleContainer;\n    if(isReplacing) {\n      bubbleContainer = bubble.querySelector('.bubble-content');\n    }\n\n    const currentReplyDiv = isReplacing ? bubbleContainer.querySelector('.reply') : null;\n    if(!message.reply_to_mid) {\n      if(currentReplyDiv) {\n        currentReplyDiv.remove();\n      }\n\n      bubble.classList.remove('is-reply');\n      return;\n    }\n\n\n    const replyToPeerId = message.reply_to.reply_to_peer_id ? getPeerId(message.reply_to.reply_to_peer_id) : chat.peerId;\n\n    const originalMessage = await rootScope.managers.appMessagesManager.getMessageByPeer(replyToPeerId, message.reply_to_mid);\n    let originalPeerTitle: string | HTMLElement;\n\n    // ///////this.log('message to render reply', originalMessage, originalPeerTitle, bubble, message);\n\n    let titlePeerId: PeerId;\n    // need to download separately\n    if(!originalMessage) {\n      // ////////this.log('message to render reply empty, need download', message, message.reply_to_mid);\n      rootScope.managers.appMessagesManager.fetchMessageReplyTo(message);\n      chat.bubbles.needUpdate.push({replyToPeerId, replyMid: message.reply_to_mid, mid: message.mid});\n\n      originalPeerTitle = i18n('Loading');\n    } else {\n      const originalMessageFwdFromId = (originalMessage as Message.message).fwdFromId;\n      titlePeerId = message.fwdFromId && message.fwdFromId === originalMessageFwdFromId ? message.fwdFromId : originalMessage.fromId || originalMessageFwdFromId;\n      originalPeerTitle = new PeerTitle({\n        peerId: titlePeerId,\n        dialog: false,\n        onlyFirstName: false,\n        plainText: false\n      }).element;\n    }\n\n    const {container, fillPromise} = wrapReply(originalPeerTitle, undefined, originalMessage, chat.isAnyGroup ? titlePeerId : undefined);\n    await fillPromise;\n    if(currentReplyDiv) {\n      currentReplyDiv.replaceWith(container);\n    } else {\n      bubbleContainer.append(container);\n    }\n    // bubbleContainer.insertBefore(, nameContainer);\n    bubble.classList.add('is-reply');\n  };\n}\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport {MOUNT_CLASS_TO} from '../../config/debug';\r\n\r\nexport function getElementByPoint(container: HTMLElement, verticalSide: 'top' | 'bottom', horizontalSide: 'center' | 'left'): HTMLElement {\r\n  // return null;\r\n  const rect = container.getBoundingClientRect();\r\n  const x = horizontalSide === 'center' ? Math.ceil(rect.left + ((rect.right - rect.left) / 2) + 1) : Math.ceil(rect.left + 1);\r\n  const y = verticalSide === 'bottom' ? Math.floor(rect.top + rect.height - 1) : Math.ceil(rect.top + 1);\r\n  return document.elementFromPoint(x, y) as any;\r\n};\r\n\r\nMOUNT_CLASS_TO.getElementByPoint = getElementByPoint;\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nexport default function reflowScrollableElement(element: HTMLElement) {\r\n  element.style.display = 'none';\r\n  void element.offsetLeft; // reflow\r\n  element.style.display = '';\r\n}\r\n","export const SEND_WHEN_ONLINE_TIMESTAMP = 0x7FFFFFFE;\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nexport enum INTERNAL_LINK_TYPE {\n  MESSAGE,\n  PRIVATE_POST,\n  STICKER_SET,\n  JOIN_CHAT,\n  VOICE_CHAT,\n  USER_PHONE_NUMBER,\n  INVOICE\n};\n\nexport type InternalLink = InternalLink.InternalLinkMessage | InternalLink.InternalLinkPrivatePost | InternalLink.InternalLinkStickerSet | InternalLink.InternalLinkJoinChat | InternalLink.InternalLinkVoiceChat | InternalLink.InternalLinkUserPhoneNumber | InternalLink.InternalLinkInvoice;\n\nexport namespace InternalLink {\n  export interface InternalLinkMessage {\n    _: INTERNAL_LINK_TYPE.MESSAGE,\n    domain: string,\n    post?: string,\n    comment?: string,\n    start?: string\n  }\n\n  export interface InternalLinkPrivatePost {\n    _: INTERNAL_LINK_TYPE.PRIVATE_POST,\n    channel: string,\n    post: string,\n    thread?: string,\n    comment?: string\n  }\n\n  export interface InternalLinkStickerSet {\n    _: INTERNAL_LINK_TYPE.STICKER_SET,\n    set: string\n  }\n\n  export interface InternalLinkJoinChat {\n    _: INTERNAL_LINK_TYPE.JOIN_CHAT,\n    invite: string\n  }\n\n  /**\n   * LOCAL LINK\n   */\n  export interface InternalLinkVoiceChat {\n    _: INTERNAL_LINK_TYPE.VOICE_CHAT,\n    id: string,\n    access_hash: string,\n    chat_id: string\n  }\n\n  export interface InternalLinkUserPhoneNumber {\n    _: INTERNAL_LINK_TYPE.USER_PHONE_NUMBER,\n    phone: string\n  }\n\n  export interface InternalLinkInvoice {\n    _: INTERNAL_LINK_TYPE.INVOICE,\n    slug: string\n  }\n}\n\nexport type InternalLinkTypeMap = {\n  [INTERNAL_LINK_TYPE.MESSAGE]: InternalLink.InternalLinkMessage,\n  [INTERNAL_LINK_TYPE.PRIVATE_POST]: InternalLink.InternalLinkPrivatePost,\n  [INTERNAL_LINK_TYPE.STICKER_SET]: InternalLink.InternalLinkStickerSet,\n  [INTERNAL_LINK_TYPE.JOIN_CHAT]: InternalLink.InternalLinkJoinChat,\n  [INTERNAL_LINK_TYPE.VOICE_CHAT]: InternalLink.InternalLinkVoiceChat,\n  [INTERNAL_LINK_TYPE.USER_PHONE_NUMBER]: InternalLink.InternalLinkUserPhoneNumber,\n  [INTERNAL_LINK_TYPE.INVOICE]: InternalLink.InternalLinkInvoice\n};\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport PopupElement, {addCancelButton} from '.';\r\nimport setInnerHTML from '../../helpers/dom/setInnerHTML';\r\nimport numberThousandSplitter from '../../helpers/number/numberThousandSplitter';\r\nimport {ChatInvite} from '../../layer';\r\nimport appImManager from '../../lib/appManagers/appImManager';\r\nimport {i18n, _i18n} from '../../lib/langPack';\r\nimport {NULL_PEER_ID} from '../../lib/mtproto/mtproto_config';\r\nimport wrapEmojiText from '../../lib/richTextProcessor/wrapEmojiText';\r\nimport AvatarElement from '../avatar';\r\nimport putPhoto from '../putPhoto';\r\nimport {toastNew} from '../toast';\r\nimport {wrapPhoto} from '../wrappers';\r\n\r\n// const FAKE_CHAT_ID = Number.MAX_SAFE_INTEGER - 0x1000;\r\n\r\nexport default class PopupJoinChatInvite extends PopupElement {\r\n  constructor(\r\n    private hash: string,\r\n    private chatInvite: ChatInvite.chatInvite\r\n  ) {\r\n    super('popup-join-chat-invite', {\r\n      closable: true,\r\n      overlayClosable: true,\r\n      body: true,\r\n      buttons: addCancelButton([{\r\n        langKey: chatInvite.pFlags.request_needed ? 'RequestJoin.Button' : (chatInvite.pFlags.broadcast ? 'JoinByPeekChannelTitle' : 'JoinByPeekGroupTitle'),\r\n        callback: () => {\r\n          this.managers.appChatsManager.importChatInvite(hash)\r\n          .then((chatId) => {\r\n            const peerId = chatId.toPeerId(true);\r\n            appImManager.setInnerPeer({peerId});\r\n          }, (error) => {\r\n            if(error.type === 'INVITE_REQUEST_SENT') {\r\n              toastNew({langPackKey: 'RequestToJoinSent'});\r\n            }\r\n          });\r\n        }\r\n      }])\r\n    });\r\n\r\n    this.construct();\r\n  }\r\n\r\n  private async construct() {\r\n    this.header.remove();\r\n    /* const fakeChat: Chat.channel | Chat.chat = {\r\n      _: chatInvite.pFlags.channel ? 'channel' : 'chat',\r\n      id: FAKE_CHAT_ID,\r\n      title: chatInvite.title,\r\n      photo: chatInvite.photo as any,\r\n      date: Date.now() / 1000 | 0,\r\n      version: 0,\r\n      participants_count: chatInvite.participants_count,\r\n      pFlags: chatInvite.pFlags as any\r\n    };\r\n\r\n    appChatsManager.saveApiChat(fakeChat); */\r\n\r\n    const {chatInvite, managers, hash} = this;\r\n\r\n    const avatarElem = new AvatarElement();\r\n    avatarElem.classList.add('avatar-100');\r\n    avatarElem.isDialog = false;\r\n    if(chatInvite.photo._ === 'photo') {\r\n      chatInvite.photo = await managers.appPhotosManager.savePhoto(chatInvite.photo);\r\n      wrapPhoto({\r\n        container: avatarElem,\r\n        message: null,\r\n        photo: chatInvite.photo,\r\n        boxHeight: 100,\r\n        boxWidth: 100,\r\n        withoutPreloader: true\r\n      });\r\n      avatarElem.style.width = avatarElem.style.height = '';\r\n    } else {\r\n      putPhoto(avatarElem, NULL_PEER_ID, false, chatInvite.title);\r\n    }\r\n\r\n    const title = document.createElement('div');\r\n    title.classList.add('chat-title');\r\n    setInnerHTML(title, wrapEmojiText(chatInvite.title));\r\n    // avatarElem.setAttribute('peer', '' + -fakeChat.id);\r\n\r\n    const isBroadcast = chatInvite.pFlags.broadcast;\r\n    const peopleCount = i18n(isBroadcast ? 'Subscribers' : 'Members', [numberThousandSplitter(chatInvite.participants_count)]);\r\n    peopleCount.classList.add('chat-participants-count');\r\n\r\n    this.body.append(avatarElem, title, peopleCount);\r\n\r\n    if(chatInvite.pFlags.request_needed) {\r\n      const caption = document.createElement('div');\r\n      _i18n(caption, isBroadcast ? 'RequestToJoinChannelDescription' : 'RequestToJoinGroupDescription');\r\n      caption.classList.add('chat-participants-count', 'request-caption');\r\n\r\n      this.body.append(caption);\r\n    }\r\n\r\n    this.show();\r\n  }\r\n}\r\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport Scrollable from '../components/scrollable';\nimport {MOUNT_CLASS_TO} from '../config/debug';\nimport {IS_SAFARI} from '../environment/userAgent';\nimport getVisibleRect from './dom/getVisibleRect';\nimport reflowScrollableElement from './dom/reflowScrollableElement';\n\nexport default class ScrollSaver {\n  private scrollHeight: number;\n  private scrollHeightMinusTop: number;\n  private scrollTop: number;\n  private clientHeight: number;\n  private elements: {element: HTMLElement, rect: DOMRect}[];\n\n  /**\n   *\n   * @param scrollable to reset scroll position and direction\n   * @param reverse true means top\n   */\n  constructor(\n    private scrollable: Scrollable,\n    private query: string,\n    private reverse: boolean\n  ) {\n\n  }\n\n  private get container() {\n    return this.scrollable.container;\n  }\n\n  public getSaved() {\n    return {\n      scrollHeight: this.scrollHeight,\n      scrollTop: this.scrollTop,\n      clientHeight: this.clientHeight\n    };\n  }\n\n  public findElements() {\n    if(!this.query) return [];\n\n    const {container} = this;\n    const containerRect = container.getBoundingClientRect();\n    const bubbles = Array.from(container.querySelectorAll(this.query)) as HTMLElement[];\n    const elements: ScrollSaver['elements'] = [];\n    for(const bubble of bubbles) {\n      const elementRect = bubble.getBoundingClientRect();\n      const visibleRect = getVisibleRect(bubble, container, undefined, elementRect, containerRect);\n      if(visibleRect) {\n        elements.push({element: bubble, rect: elementRect});\n        // break; // find first\n      } else if(elements.length) { // find last\n        break;\n      }\n    }\n\n    if(!elements.length) {\n      const bubble = bubbles[0];\n      if(bubble) {\n        elements.push({element: bubble, rect: bubble.getBoundingClientRect()});\n      }\n    }\n\n    return elements;\n  }\n\n  public replaceSaved(from: HTMLElement, to: HTMLElement) {\n    if(!this.elements) {\n      return;\n    }\n\n    const idx = this.elements.findIndex(({element}) => from === element);\n    if(idx !== -1) {\n      this.elements[idx].element = to;\n    }\n  }\n\n  public findAndSetElements() {\n    this.elements = this.findElements();\n  }\n\n  public save() {\n    this.findAndSetElements();\n    // console.warn('scroll save', this.elements);\n    this._save();\n  }\n\n  public _save() {\n    const {scrollTop, scrollHeight, clientHeight} = this.container;\n\n    // previousScrollHeight = scrollHeight;\n    // previousScrollHeight = scrollHeight + padding;\n    this.scrollHeight = scrollHeight;\n    this.scrollTop = scrollTop;\n    this.clientHeight = clientHeight;\n    this.scrollHeightMinusTop = this.reverse ? scrollHeight - scrollTop : scrollTop;\n\n    // this.chatInner.style.paddingTop = padding + 'px';\n    /* if(reverse) {\n      previousScrollHeightMinusTop = this.scrollable.scrollHeight - scrollTop;\n    } else {\n      previousScrollHeightMinusTop = scrollTop;\n    } */\n  }\n\n  private onRestore(useReflow?: boolean) {\n    if(IS_SAFARI && useReflow/*  && !isAppleMobile */) { // * fix blinking and jumping\n      reflowScrollableElement(this.container);\n    }\n  }\n\n  private setScrollTop(newScrollTop: number, useReflow?: boolean) {\n    // touchSupport for safari iOS\n    // isTouchSupported && isApple && (container.container.style.overflow = 'hidden');\n    this.scrollable.setScrollTopSilently(this.scrollTop = newScrollTop);\n    // container.scrollTop = scrollHeight;\n    // isTouchSupported && isApple && (container.container.style.overflow = '');\n\n    this.onRestore(useReflow);\n  }\n\n  public restore(useReflow?: boolean) {\n    const {scrollTop, scrollHeight} = this.scrollable;\n    this.scrollHeight = scrollHeight;\n\n    if(!this.elements.length) { // maybe all messages have been deleted\n      this._restore(useReflow);\n      return;\n    }\n\n    let anchor: ScrollSaver['elements'][0];\n    // for(let i = this.elements.length - 1; i >= 0; --i) {\n    //   const _anchor = this.elements[i];\n    //   if(_anchor.element.parentElement) {\n    //     anchor = _anchor;\n    //     break;\n    //   }\n    // }\n    anchor = this.elements[this.elements.length - 1];\n\n    if(!anchor?.element?.parentElement) { // try to find new anchor\n      this.findAndSetElements();\n      anchor = this.elements[this.elements.length - 1];\n\n      if(!anchor) { // fallback to old method if smth is really strange\n        this._restore(useReflow);\n        return;\n      }\n    }\n\n    const {element, rect} = anchor;\n    const newRect = element.getBoundingClientRect();\n    const diff = newRect.bottom - rect.bottom;\n    this.setScrollTop(scrollTop + diff, useReflow);\n    // if(diff) debugger;\n    // console.warn('scroll restore', rect, diff, newRect);\n  }\n\n  public _restore(useReflow?: boolean) {\n    const {scrollHeightMinusTop: previousScrollHeightMinusTop, scrollable} = this;\n    // if(previousScrollHeightMinusTop === undefined) {\n    //   throw new Error('scroll was not saved');\n    // }\n\n    // const scrollHeight = container.scrollHeight;\n    const scrollHeight = this.scrollHeight;\n    // if(scrollHeight === this.scrollHeight) {\n    //   return;\n    // }\n\n    // this.scrollHeight = scrollHeight;\n\n    /* const scrollHeight = container.scrollHeight;\n    const addedHeight = scrollHeight - previousScrollHeight;\n\n    this.chatInner.style.paddingTop = (10000 - addedHeight) + 'px'; */\n    /* const scrollHeight = scrollHeight;\n    const addedHeight = scrollHeight - previousScrollHeight;\n\n    this.chatInner.style.paddingTop = (padding - addedHeight) + 'px';\n\n    //const newScrollTop = reverse ? scrollHeight - previousScrollHeightMinusTop : previousScrollHeightMinusTop;\n    const newScrollTop = reverse ? scrollHeight - addedHeight - previousScrollHeightMinusTop : previousScrollHeightMinusTop;\n    this.log('performHistoryResult: will set scrollTop',\n    previousScrollHeightMinusTop, scrollHeight,\n    newScrollTop, container.container.clientHeight); */\n    // const newScrollTop = reverse ? scrollHeight - previousScrollHeightMinusTop : previousScrollHeightMinusTop;\n    const newScrollTop = this.reverse ? scrollHeight - previousScrollHeightMinusTop : previousScrollHeightMinusTop;\n\n    /* if(DEBUG) {\n      this.log('performHistoryResult: will set up scrollTop:', newScrollTop, this.isHeavyAnimationInProgress);\n    } */\n\n    this.setScrollTop(newScrollTop, useReflow);\n\n    /* if(DEBUG) {\n      this.log('performHistoryResult: have set up scrollTop:', newScrollTop, container.scrollTop, container.scrollHeight, this.isHeavyAnimationInProgress);\n    } */\n  }\n}\n\nMOUNT_CLASS_TO && (MOUNT_CLASS_TO.ScrollSaver = ScrollSaver);\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nexport type IntersectionTarget = Element;\nexport type IntersectionCallback = (entry: IntersectionObserverEntry) => void;\n\nexport default class SuperIntersectionObserver {\n  private observing: Map<IntersectionTarget, Set<IntersectionCallback>>;\n  private observingQueue: SuperIntersectionObserver['observing'];\n  private observer: IntersectionObserver;\n  private freezedObservingNew: boolean;\n\n  constructor(init?: IntersectionObserverInit) {\n    this.observing = new Map();\n    this.observingQueue = new Map();\n    this.freezedObservingNew = false;\n\n    this.observer = new IntersectionObserver((entries) => {\n      const observing = this.observing;\n      for(let i = 0, length = entries.length; i < length; ++i) {\n        const entry = entries[i];\n        const callbacks = observing.get(entry.target);\n        if(!callbacks) {\n          debugger;\n        }\n\n        for(const callback of callbacks) {\n          try {\n            callback(entry);\n          } catch(err) {\n            console.error('intersection process callback error:', err);\n          }\n        }\n      }\n    }, init);\n  }\n\n  public disconnect() {\n    this.observing.clear();\n    this.observingQueue.clear();\n    this.observer.disconnect();\n  }\n\n  public toggleObservingNew(value: boolean) {\n    if(this.freezedObservingNew === value) {\n      return;\n    }\n\n    this.freezedObservingNew = value;\n\n    const queue = this.observingQueue;\n    if(!value && queue.size) {\n      for(const [target, callbacks] of queue) {\n        for(const callback of callbacks) {\n          this.observe(target, callback);\n        }\n      }\n\n      queue.clear();\n    }\n  }\n\n  public has(target: IntersectionTarget, callback: IntersectionCallback, observing = this.observing) {\n    const callbacks = observing.get(target);\n    return !!(callbacks && callbacks.has(callback));\n  }\n\n  public observe(target: IntersectionTarget, callback: IntersectionCallback) {\n    if(this.freezedObservingNew && this.has(target, callback)) {\n      return;\n    }\n\n    const observing = this.freezedObservingNew ? this.observingQueue : this.observing;\n    let callbacks = observing.get(target);\n    if(callbacks && callbacks.has(callback)) {\n      return;\n    }\n\n    if(!callbacks) {\n      callbacks = new Set();\n      observing.set(target, callbacks);\n\n      if(observing === this.observing) {\n        this.observer.observe(target);\n      }\n    }\n\n    callbacks.add(callback);\n  }\n\n  public unobserve(target: IntersectionTarget, callback: IntersectionCallback) {\n    const observing = this.freezedObservingNew && !this.has(target, callback) ? this.observingQueue : this.observing;\n    const callbacks = observing.get(target);\n    if(!callbacks) {\n      return;\n    }\n\n    callbacks.delete(callback);\n    if(!callbacks.size) {\n      observing.delete(target);\n      this.observer.unobserve(target);\n    }\n  }\n}\n","import type {MyDocument} from '../../appDocsManager';\nimport type {MyMessage} from '../../appMessagesManager';\nimport {Message, MessageMedia} from '../../../../layer';\n\nexport default function isMentionUnread(message: MyMessage) {\n  if(!message) {\n    return false;\n  }\n\n  const doc = ((message as Message.message).media as MessageMedia.messageMediaDocument)?.document as MyDocument;\n  return !!(\n    message.pFlags.media_unread &&\n    message.pFlags.mentioned &&\n    (\n      !doc ||\n      !(['voice', 'round'] as MyDocument['type'][]).includes(doc.type)\n    )\n  );\n}\n","function cacheCallback<A, T>(callback: (str: A) => T) {\n  const stringResults: any = {}, numberResults: any = {};\n  return (value: A): T => {\n    const key = '_' + value;\n    return (typeof(value) === 'string' ? stringResults : numberResults)[key] ??= callback(value);\n  };\n}\n\nexport default cacheCallback;\n","export default function replaceNonNumber(str: string) {\n  return str.replace(/\\D/g, '');\n}\n","import cacheCallback from '../cacheCallback';\nimport replaceNonNumber from '../string/replaceNonNumber';\n\nconst CARD_BRAND_REGEXP: {[brand: string]: RegExp} = {\n  visa: /^4/,\n  mastercard: /^(51|52|53|54|55|222|23|24|25|26|27)/,\n  amex: /^(34|37)/,\n  discover: /^(60|64|65)/,\n  diners: /^(30|38|39)/,\n  diners14: /^(36)/,\n  jcb: /^(35)/,\n  unionpay: /^(62[0-6,8-9]|627[0-6,8-9]|6277[0-7,9]|62778[1-9]|81)/,\n  elo: /^(5067|509|636368|627780)/,\n  mir: /^(220[0-4])/\n};\n\n// * taken from Stripe\nexport const CARD_BRANDS: {[b: string]: {\n  minLength: number,\n  maxLength: number,\n  cvcMaxLength: number,\n  cvcMinLength: number | null\n}} = {\n  visa: {\n    minLength: 16,\n    maxLength: 16,\n    cvcMaxLength: 3,\n    cvcMinLength: null\n  },\n  mastercard: {\n    minLength: 16,\n    maxLength: 16,\n    cvcMaxLength: 3,\n    cvcMinLength: null\n  },\n  amex: {\n    minLength: 15,\n    maxLength: 15,\n    cvcMaxLength: 4,\n    cvcMinLength: 3\n  },\n  unionpay: {\n    minLength: 13,\n    maxLength: 19,\n    cvcMaxLength: 3,\n    cvcMinLength: null\n  },\n  diners: {\n    minLength: 16,\n    maxLength: 16,\n    cvcMaxLength: 3,\n    cvcMinLength: null\n  },\n  diners14: {\n    minLength: 14,\n    maxLength: 14,\n    cvcMaxLength: 3,\n    cvcMinLength: null\n  },\n  discover: {\n    minLength: 16,\n    maxLength: 16,\n    cvcMaxLength: 3,\n    cvcMinLength: null\n  },\n  jcb: {\n    minLength: 16,\n    maxLength: 16,\n    cvcMaxLength: 3,\n    cvcMinLength: null\n  },\n  elo: {\n    minLength: 16,\n    maxLength: 16,\n    cvcMaxLength: 3,\n    cvcMinLength: null\n  },\n  mir: {\n    minLength: 16,\n    maxLength: 16,\n    cvcMaxLength: 3,\n    cvcMinLength: null\n  },\n  unknown: {\n    minLength: 16,\n    maxLength: 16,\n    cvcMaxLength: 4,\n    cvcMinLength: 3\n  }\n};\n\nexport const detectCardBrand = cacheCallback((card: string = '') => {\n  const keys = Object.keys(CARD_BRAND_REGEXP);\n  const sanitizedCard = replaceNonNumber(card);\n  let brand: string;\n  let last = 0;\n  keys.forEach((key) => {\n    const regExp = CARD_BRAND_REGEXP[key];\n    const match = sanitizedCard.match(regExp);\n    if(match) {\n      const result = match[0];\n      if(result && result.length > last) {\n        brand = key;\n        last = result.length;\n      }\n    }\n  });\n\n  return brand || 'unknown';\n});\n\nexport function cardBrandToUnifiedBrand(brand: string) {\n  return brand === 'diners14' ? 'diners' : brand;\n}\n\nexport function detectUnifiedCardBrand(card = '') {\n  const brand = detectCardBrand(card);\n  return cardBrandToUnifiedBrand(brand);\n}\n","export default function createArray<T1>(length: number, fill?: T1, map?: any): T1[] {\n  const arr = new Array<T1>(length);\n  arr.fill(fill);\n  return map ? arr.map(map) : arr;\n}\n","const delta = ''.charCodeAt(0) - '0'.charCodeAt(0);\nconst buggedRegExp = /[-]/g;\n\n// function hasBuggedNumbers(str: string) {\n//   return !!str.match(a);\n// }\n\nfunction getDistanceFromBuggedToNormal(char: string) {\n  return String.fromCharCode(char.charCodeAt(0) - delta);\n}\n\nexport function fixBuggedNumbers(str: string) {\n  return str.replace(buggedRegExp, getDistanceFromBuggedToNormal);\n}\n","import {fixBuggedNumbers} from '../string/buggedNumbers';\nimport replaceNonNumber from '../string/replaceNonNumber';\n\nexport type PatternCharacter = {\n  type: 'optional',\n  result: string,\n  consumed: number\n} | {\n  type: 'required',\n  result: string,\n  consumed: number,\n  partial?: boolean\n} | {\n  type: 'formatting',\n  result: string,\n  consumed: number\n};\n\nexport type PatternFunction = (str: string) => ((str: string) => PatternCharacter)[];\n\nfunction makeOptionalCharacter(result: string, consumed: number): PatternCharacter {\n  return {type: 'optional', result, consumed};\n}\n\nfunction makeRequiredCharacter(result: string, consumed: number, partial?: boolean): PatternCharacter {\n  return {type: 'required', result, consumed, partial};\n}\n\nfunction makeFormattingCharacter(result: string, consumed: number): PatternCharacter {\n  return {type: 'formatting', result, consumed};\n}\n\nfunction wrapCharacterRegExpFactory(regExp: RegExp, optional?: boolean) {\n  return (str: string) => {\n    const _regExp = new RegExp('^'.concat(regExp.source.replace(/^\\^/, '')));\n    const match = str.match(_regExp);\n    const makeCharacter = optional ? makeOptionalCharacter : makeRequiredCharacter;\n    if(match) {\n      const result = match[0];\n      return makeCharacter(result, match.index + result.length);\n    }\n\n    return makeCharacter('', str.length);\n  };\n}\n\nfunction makeCapitalPatternCharacter(str: string) {\n  const char = wrapCharacterRegExpFactory(/\\w/)(str);\n  return char.result ? makeRequiredCharacter(char.result.toUpperCase(), char.consumed) : char;\n}\n\nconst makeMonthDigitPatternCharacter = wrapCharacterRegExpFactory(/1[0-2]|0?[1-9]|0/);\n\nfunction digit(str: string) {\n  return wrapCharacterRegExpFactory(/[0-9]/)(fixBuggedNumbers(str));\n}\n\nconst patternCharacters = {\n  digit,\n  capitalCharacter: makeCapitalPatternCharacter,\n  month: (str: string) => {\n    const char = makeMonthDigitPatternCharacter(fixBuggedNumbers(str));\n    const cleanedResult = replaceNonNumber(char.result);\n    const isPartial = ['0', '1'].includes(char.result) && str.length === 1;\n    if(isPartial || (char.result === '0' && str.length >= 2)) {\n      return makeRequiredCharacter(char.result, str.length, true);\n    }\n\n    return makeRequiredCharacter(cleanedResult.length === 1 ? '0' + cleanedResult : cleanedResult, char.consumed);\n  },\n  formattingCharacter: (str: string) => {\n    return (str1: string) => {\n      const consumed = str === str1[0] ? 1 : 0;\n      return makeFormattingCharacter(str, consumed);\n    }\n  },\n  optionalPattern: (regExp: RegExp) => {\n    return (str: string) => {\n      const char = wrapCharacterRegExpFactory(regExp, true)(str);\n      return char.result ? char : makeOptionalCharacter('', 0);\n    };\n  }\n};\n\nexport default patternCharacters;\n","import {IS_ANDROID} from '../../environment/userAgent';\nimport createArray from '../array/createArray';\nimport cacheCallback from '../cacheCallback';\nimport replaceNonNumber from '../string/replaceNonNumber';\nimport {CARD_BRANDS, detectCardBrand} from './cardBrands';\nimport patternCharacters from './patternCharacters';\n\nconst digit = patternCharacters.digit;\nconst capitalCharacter = patternCharacters.capitalCharacter;\nconst spaceCharacter = patternCharacters.formattingCharacter(' ');\nconst yearOptionalPattern = patternCharacters.optionalPattern(/\\d\\d/);\nconst sixteenPattern = [digit, digit, digit, digit, spaceCharacter, digit, digit, digit, digit, digit, digit, spaceCharacter, digit, digit, digit, digit, digit];\nconst fifteenPattern = [digit, digit, digit, digit, spaceCharacter, digit, digit, digit, digit, digit, digit, spaceCharacter, digit, digit, digit, digit];\n\nconst requiredPostcodes = new Set(['DZ', 'AR', 'AM', 'AU', 'AT', 'AZ', 'PT', 'BD', 'BY', 'BE', 'BA', 'BR', 'BN', 'BG', 'CA', 'IC', 'CN', 'CO', 'HR', 'CY', 'CZ', 'DK', 'EC', 'GB', 'EE', 'FO', 'FI', 'FR', 'GE', 'DE', 'GR', 'GL', 'GU', 'GG', 'NL', 'HU', 'IN', 'ID', 'IL', 'IT', 'JP', 'JE', 'KZ', 'KR', 'FM', 'KG', 'LV', 'LI', 'LT', 'LU', 'MK', 'MG', 'PT', 'MY', 'MH', 'MQ', 'YT', 'MX', 'MN', 'ME', 'NL', 'NZ', 'GB', 'NO', 'PK', 'PH', 'PL', 'FM', 'PT', 'PR', 'RE', 'RU', 'SA', 'SF', 'RS', 'SG', 'SK', 'SI', 'ZA', 'ES', 'LK', 'SX', 'VI', 'VI', 'SE', 'CH', 'TW', 'TJ', 'TH', 'TU', 'TN', 'TR', 'TM', 'VI', 'UA', 'GB', 'US', 'UY', 'UZ', 'VA', 'VN', 'GB', 'FM']);\n\nconst generateFourPattern = cacheCallback((length: number) => {\n  const out: Array<typeof digit | typeof spaceCharacter> = [];\n\n  for(let i = 0, k = 0; i < length;) {\n    if(k === 4) {\n      out.push(spaceCharacter);\n      k = 0;\n    } else {\n      out.push(digit);\n      ++i;\n      ++k;\n    }\n  }\n\n  return out;\n});\n\nfunction generateCardNumberPattern(card: string) {\n  const brand = detectCardBrand(card);\n  if(brand === 'amex') return sixteenPattern;\n  if(brand === 'diners14') return fifteenPattern;\n  const {minLength, maxLength} = CARD_BRANDS[brand];\n  const s = replaceNonNumber(card).length;\n  const d = Math.min(Math.max(minLength, s), maxLength);\n  return generateFourPattern(d);\n}\n\nconst cardFormattingPatterns = {\n  cardNumber: generateCardNumberPattern,\n  cardExpiry: () => [patternCharacters.month, patternCharacters.formattingCharacter('/'), digit, digit, yearOptionalPattern],\n  cardCvc: (card?: string) => cardFormattingPatterns.cardCvcFromBrand(detectCardBrand(card)),\n  cardCvcFromBrand: cacheCallback((brand: string) => {\n    const info = CARD_BRANDS[brand];\n    const {cvcMinLength, cvcMaxLength} = info;\n    const pattern = createArray(cvcMinLength || cvcMaxLength, digit);\n    if(cvcMinLength && cvcMinLength < cvcMaxLength) {\n      const i = cvcMaxLength - cvcMinLength;\n      const h = patternCharacters.optionalPattern(/\\d/);\n      if(i) {\n        pattern.push(...createArray(i, h));\n      }\n    }\n\n    return pattern;\n  }),\n  postalCodeFromCountry: cacheCallback((iso2: string) => {\n    switch(iso2) {\n      case 'US':\n        return createArray(5, digit);\n      case 'CA':\n        return IS_ANDROID ? null : [capitalCharacter, capitalCharacter, capitalCharacter, spaceCharacter, capitalCharacter, capitalCharacter, capitalCharacter];\n      default:\n        const optionalDigits = createArray(10, patternCharacters.optionalPattern(/\\d/));\n        if(requiredPostcodes.has(iso2)) {\n          optionalDigits[0] = digit;\n        }\n        return optionalDigits;\n    }\n  })\n};\n\nexport default cardFormattingPatterns;\n","import accumulate from '../array/accumulate';\nimport {PatternFunction} from './patternCharacters';\n\nfunction accumulateLengths(strs: string[]) {\n  return accumulate(strs.map((str) => str.length), 0);\n}\n\nfunction formatValueByPattern(\n  getPattern: PatternFunction,\n  value: string,\n  options: Partial<{\n    selectionStart: number,\n    selectionEnd: number\n  }> = {},\n  pushRest?: boolean\n) {\n  const pattern = getPattern(value);\n\n  if(!pattern) {\n    return {\n      value: value,\n      selection: null as typeof options,\n      autocorrectComplete: !!value\n    };\n  }\n\n  const length = pattern.length;\n  const c: string[] = [];\n  const s: string[] = [];\n\n  let l = 0;\n  let i = 0;\n  let f = options.selectionStart === 0 ? 0 : null;\n  let d = options.selectionEnd === 0 ? 0 : null;\n  const p = () => {\n    if(f === null && (i + 1) >= options.selectionStart) f = accumulateLengths(c) + (pushRest ? s.length : 0);\n    if(d === null && (i + 1) >= options.selectionEnd) d = accumulateLengths(c) + (pushRest ? s.length : 0);\n  };\n  const m = (e: number) => {\n    if(e > 0) {\n      p();\n      i += e;\n    }\n  };\n\n  for(; l < length;) {\n    const getCharacter = pattern[l];\n    const character = getCharacter(value.slice(i));\n    const {type, result, consumed} = character;\n    if(type === 'required') {\n      if(result) {\n        c.push(...s, result);\n        s.length = 0;\n        ++l;\n\n        if(character.partial) {\n          m(value.length - i);\n          break;\n        }\n\n        m(consumed);\n      } else {\n        if(!consumed) {\n          break;\n        }\n\n        m(1);\n      }\n    } else if(type === 'optional') {\n      if(result) {\n        c.push(...s, result);\n        s.length = 0;\n        m(consumed);\n      }\n\n      ++l;\n    } else if(type === 'formatting') {\n      if(!pushRest && i >= value.length) {\n        break;\n      }\n\n      s.push(result);\n      ++l;\n      m(consumed);\n    }\n  }\n\n  if(pushRest) {\n    c.push(...s);\n  }\n\n  return {\n    value: c.join(''),\n    selection: {\n      selectionStart: f === null || value.length && options.selectionStart === value.length ? accumulateLengths(c) : f,\n      selectionEnd: d === null || value.length && options.selectionEnd === value.length ? accumulateLengths(c) : d\n    },\n    autocorrectComplete: l === length\n  };\n}\n\nexport default formatValueByPattern;\n","import {CARD_BRANDS, detectCardBrand} from './cardBrands';\nimport formatInputValueByPattern from './formatInputValueByPattern';\nimport NBSP from '../string/nbsp';\nimport replaceNonNumber from '../string/replaceNonNumber';\n\nexport type PatternValidationOptions = Partial<{\n  ignoreIncomplete: boolean\n}>;\n\nconst nbspRegExp = new RegExp(NBSP, 'g');\n\nfunction makeValidationError(code?: string) {\n  return code ? {\n    type: 'invalid',\n    code\n  } : null;\n}\n\n// Luhn algorithm\nfunction validateCompleteCardNumber(card: string) {\n  const t = '0'.charCodeAt(0);\n  const n = card.length % 2;\n  let a = 0;\n  for(let i = card.length - 1; i >= 0; --i) {\n    const c = n === (i % 2);\n    let o = card.charCodeAt(i) - t;\n    if(c) o *= 2;\n    if(o > 9) o -= 9;\n    a += o;\n  }\n  return !(a % 10);\n}\n\nfunction validateExpiry(year: number, month: number, options?: PatternValidationOptions) {\n  const date = new Date(Date.now());\n  const _year = year < 100 ? date.getFullYear() % 100 : date.getFullYear();\n  const nextMonth = date.getMonth() + 1;\n\n  if(isNaN(year) || isNaN(month)) {\n    return options?.ignoreIncomplete ? null : 'incomplete';\n  }\n\n  if((year - _year) < 0) {\n    return 'invalid_expiry_year_past';\n  }\n\n  if((year - _year) > 50) {\n    return 'invalid_expiry_year';\n  }\n\n  return !(year - _year) && month < nextMonth ? 'invalid_expiry_month_past' : null;\n}\n\nfunction getCardInfoByNumber(card: string) {\n  const sanitized = replaceNonNumber(card);\n  const brand = detectCardBrand(card);\n  return {\n    sanitized,\n    brand,\n    minLength: CARD_BRANDS[brand].minLength\n  };\n}\n\nfunction makeCardNumberError(str: string, length: number, ignoreIncomplete: boolean) {\n  if(str.length >= length) {\n    return validateCompleteCardNumber(str) || detectCardBrand(str) === 'mir' ? null : makeValidationError('invalid');\n  }\n\n  return ignoreIncomplete ? null : makeValidationError('incomplete');\n}\n\nexport function validateCardNumber(str: string, options: PatternValidationOptions = {}) {\n  const {sanitized, minLength} = getCardInfoByNumber(str);\n  return makeCardNumberError(sanitized, minLength, options.ignoreIncomplete);\n}\n\nexport function validateCardExpiry(str: string, options: PatternValidationOptions = {}) {\n  const sanitized = str.replace(nbspRegExp, '').split(/ ?\\/ ?/);\n  const [monthStr, yearStr = ''] = sanitized;\n  const [month, year] = [monthStr, yearStr].map((str) => +str);\n  const s = yearStr.length === 2 ? year % 100 : year;\n  return yearStr.length < 2 || yearStr.length === 3 ? (options.ignoreIncomplete ? null : makeValidationError('incomplete')) : makeValidationError(validateExpiry(s, month, options));\n}\n\nexport function validateAnyIncomplete(formatted: ReturnType<typeof formatInputValueByPattern>, str: string, options: PatternValidationOptions = {}) {\n  return formatted.meta.autocorrectComplete || options.ignoreIncomplete ? null : makeValidationError('incomplete');\n}\n","const NBSP = '';\nexport default NBSP;\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport PopupElement from '.';\nimport appImManager from '../../lib/appManagers/appImManager';\nimport {TelegramWebviewEventCallback} from '../../types';\n\nconst weakMap: WeakMap<Window, TelegramWebviewEventCallback> = new WeakMap();\nwindow.addEventListener('message', (e) => {\n  const callback = weakMap.get(e.source as Window);\n  if(!callback) {\n    return;\n  }\n\n  callback(JSON.parse(e.data));\n});\n\nexport function createVerificationIframe(url: string, callback: TelegramWebviewEventCallback) {\n  const iframe = document.createElement('iframe');\n  // iframe.title = 'Complete Payment';\n  iframe.allow = 'payment';\n  // iframe.setAttribute('sandbox', 'allow-forms allow-scripts allow-same-origin allow-top-navigation allow-modals');\n  iframe.setAttribute('sandbox', 'allow-forms allow-scripts allow-same-origin allow-modals');\n  iframe.classList.add('payment-verification');\n  iframe.src = url;\n\n  iframe.addEventListener('load', () => {\n    weakMap.set(iframe.contentWindow, callback);\n  }, {once: true});\n\n  return iframe;\n}\n\nexport default class PopupPaymentVerification extends PopupElement<{\n  finish: () => void\n}> {\n  constructor(private url: string) {\n    super('popup-payment popup-payment-verification', {\n      closable: true,\n      overlayClosable: true,\n      body: true,\n      title: 'Checkout.WebConfirmation.Title'\n    });\n\n    this.d();\n  }\n\n  private d() {\n    const iframe = createVerificationIframe(this.url, (event) => {\n      if(event.eventType !== 'web_app_open_tg_link') {\n        return;\n      }\n\n      this.dispatchEvent('finish');\n      this.hide();\n      appImManager.openUrl('https://t.me' + event.eventData.path_full);\n    });\n\n    this.body.append(iframe);\n    this.show();\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport PopupElement from '.';\nimport cardFormattingPatterns from '../../helpers/cards/cardFormattingPatterns';\nimport {detectUnifiedCardBrand} from '../../helpers/cards/cardBrands';\nimport formatInputValueByPattern from '../../helpers/cards/formatInputValueByPattern';\nimport {validateAnyIncomplete, validateCardExpiry, validateCardNumber} from '../../helpers/cards/validateCard';\nimport placeCaretAtEnd from '../../helpers/dom/placeCaretAtEnd';\nimport {renderImageFromUrlPromise} from '../../helpers/dom/renderImageFromUrl';\nimport noop from '../../helpers/noop';\nimport {PaymentsPaymentForm} from '../../layer';\nimport {LangPackKey, _i18n} from '../../lib/langPack';\nimport {TelegramWebviewEvent} from '../../types';\nimport CheckboxField from '../checkboxField';\nimport confirmationPopup from '../confirmationPopup';\nimport CountryInputField from '../countryInputField';\nimport InputField, {InputFieldOptions, InputState} from '../inputField';\nimport Row from '../row';\nimport {SettingSection} from '../sidebarLeft';\nimport {getPaymentBrandIconPath, PaymentButton, PaymentsCredentialsToken} from './payment';\nimport {createVerificationIframe} from './paymentVerification';\n\nexport type PaymentCardDetails = {\n  cardNumber: string;\n  cardholderName: string;\n  expiryFull: string;\n  expiryMonth: string;\n  expiryYear: string;\n  cvc: string;\n  country: string;\n  zip: string;\n  save?: boolean;\n};\n\nexport type PaymentCardDetailsShort = {\n  title: string,\n  save?: boolean;\n  icon?: string;\n};\n\nexport type PaymentCardDetailsResult = PaymentCardDetails | PaymentCardDetailsShort;\n\nexport class InputFieldCorrected extends InputField {\n  private lastKeyDown: string;\n  private lastTransformed: ReturnType<typeof formatInputValueByPattern>;\n\n  constructor(public options: InputFieldOptions & {\n    formatMethod: typeof cardFormattingPatterns['cardNumber'],\n    validateMethod?: typeof validateCardNumber,\n    errorKeys?: {[code: string]: LangPackKey},\n    optional?: boolean,\n    onChange?: (transformed: InputFieldCorrected['lastTransformed']) => void,\n    onKeyDown?: (e: KeyboardEvent) => void\n  }) {\n    super(options);\n\n    // const handleIncomplete = (t?: any) => {\n    //   if(\n    //     (!lastTransformed.value && t) ||\n    //     lastTransformed.meta.autocorrectComplete ||\n    //     lastTransformed.meta.error ||\n    //     optional\n    //   ) {\n    //     return;\n    //   }\n\n\n    // };\n\n    this.input.addEventListener('keydown', this.onKeyDown);\n    this.input.addEventListener('input', this.onInput);\n    this.input.addEventListener('blur', this.onBlur);\n  }\n\n  private onKeyDown = (e: KeyboardEvent) => {\n    this.lastKeyDown = e.key;\n    this.options.onKeyDown?.(e);\n  };\n\n  private onInput = () => {\n    const value = this.value;\n    const deleting = this.lastKeyDown === 'Backspace' && (((this.lastTransformed && this.lastTransformed.value.length) || 0) - value.length) === 1;\n    const result = this.lastTransformed = formatInputValueByPattern({\n      value: value,\n      getPattern: this.options.formatMethod,\n      deleting,\n      input: this.input\n    });\n\n    const transformedValue = result.value;\n    if(transformedValue !== value) {\n      this.setValueSilently(transformedValue);\n\n      if(result.selection) {\n        (this.input as HTMLInputElement).selectionStart = result.selection.selectionStart;\n        (this.input as HTMLInputElement).selectionEnd = result.selection.selectionEnd;\n      }\n    }\n\n    this.validateNew(transformedValue, {ignoreIncomplete: true/* !result.meta.autocorrectComplete */});\n\n    this.options.onChange?.(result);\n  };\n\n  private onBlur = () => {\n    const value = this.lastTransformed?.value;\n    if(value) {\n      this.validateNew(value);\n    }\n  };\n\n  public update() {\n    this.onInput();\n  }\n\n  public validate = () => {\n    return this.validateNew();\n  };\n\n  public validateNew(\n    value = this.lastTransformed?.value ?? '',\n    t: any = {},\n    justReturn?: boolean\n  ) {\n    let result: ReturnType<InputFieldCorrected['options']['validateMethod']>;\n    if(this.options.validateMethod) {\n      result = this.options.validateMethod?.(value, t);\n    } else {\n      result = validateAnyIncomplete(this.lastTransformed, value, t);\n    }\n\n    if(result?.code) {\n      const langPackKey: LangPackKey = this.options.errorKeys?.[result.code];\n      !justReturn && this.setState(InputState.Error, langPackKey);\n      return false;\n    }\n\n    !justReturn && this.setState(InputState.Neutral);\n    return true;\n  }\n}\n\nexport function handleInputFieldsOnChange(inputFields: (CountryInputField | InputField | InputFieldCorrected)[], _onChange: (valid: boolean) => void) {\n  const onChange = () => {\n    const valid = inputFields.every((inputField) => {\n      return 'validateNew' in inputField ? inputField.validateNew(undefined, undefined, true) : inputField.isValid();\n    });\n\n    _onChange(valid);\n  };\n\n  inputFields.forEach((inputField) => {\n    if(inputField instanceof InputFieldCorrected) {\n      const original = inputField.options.onChange;\n      inputField.options.onChange = (...args: any[]) => {\n        // @ts-ignore\n        original?.(...args);\n        onChange();\n      };\n\n      if('update' in inputField) {\n        inputField.update();\n      }\n    } else {\n      inputField.input.addEventListener('input', onChange);\n    }\n  });\n\n  return {validate: onChange};\n}\n\nexport function createCountryZipFields(country?: boolean, zip?: boolean) {\n  let countryInputField: CountryInputField, postcodeInputField: InputFieldCorrected;\n  if(country || zip) {\n    if(country) countryInputField = new CountryInputField({\n      noPhoneCodes: true,\n      onCountryChange: () => {\n        postcodeInputField?.update();\n      },\n      required: true,\n      autocomplete: 'country'\n    });\n    if(zip) postcodeInputField = new InputFieldCorrected({\n      label: 'PaymentShippingZipPlaceholder',\n      plainText: true,\n      inputMode: 'numeric',\n      autocomplete: 'postal-code',\n      formatMethod: (/* ...args */) => {\n        const {country} = countryInputField.getSelected();\n        const iso2 = country?.iso2;\n        return cardFormattingPatterns.postalCodeFromCountry(iso2 && iso2.toUpperCase());\n      }\n    });\n  }\n\n  return {countryInputField, postcodeInputField};\n}\n\nexport type PaymentsNativeProvider = 'stripe' | 'smartglocal';\nexport type PaymentsNativeParams = {\n  need_country?: boolean,\n  need_zip?: boolean,\n  need_cardholder_name?: boolean,\n  publishable_key?: string, // stripe\n  public_token?: string, // smartglocal\n  gpay_params: string,\n};\nconst SUPPORTED_NATIVE_PROVIDERS: Set<PaymentsNativeProvider> = new Set(['stripe', 'smartglocal']);\n\nexport default class PopupPaymentCard extends PopupElement<{\n  finish: (obj: {token: any, card: PaymentCardDetailsResult}) => void\n}> {\n  constructor(private paymentForm: PaymentsPaymentForm, private savedCard?: PaymentCardDetails) {\n    super('popup-payment popup-payment-card', {\n      closable: true,\n      overlayClosable: true,\n      body: true,\n      scrollable: SUPPORTED_NATIVE_PROVIDERS.has(paymentForm.native_provider as PaymentsNativeProvider),\n      title: 'PaymentCardInfo'\n    });\n\n    if(SUPPORTED_NATIVE_PROVIDERS.has(paymentForm.native_provider as PaymentsNativeProvider)) {\n      this.d();\n    } else {\n      const iframe = createVerificationIframe(paymentForm.url, (event) => {\n        if(event.eventType !== 'payment_form_submit') {\n          return;\n        }\n\n        const data = event.eventData;\n\n        const cardOut = {title: data.title, save: false} as any as PaymentCardDetails;\n        this.dispatchEvent('finish', {\n          token: data.credentials,\n          card: cardOut\n        });\n\n        this.hide();\n\n        if(paymentForm.pFlags.can_save_credentials) {\n          confirmationPopup({\n            titleLangKey: 'PaymentCardSavePaymentInformation',\n            descriptionLangKey: 'PaymentCardSavePaymentInformationInfoLine1',\n            button: {\n              langKey: 'Save'\n            }\n          }).then(() => {\n            cardOut.save = true;\n          }, noop);\n        }\n      });\n\n      // putPreloader(this.body, true);\n      this.body.append(iframe);\n      this.show();\n    }\n  }\n\n  private d() {\n    const savedCard = this.savedCard;\n    const cardSection = new SettingSection({name: 'PaymentInfo.Card.Title', noDelimiter: true, noShadow: true});\n\n    const nativeParams: PaymentsNativeParams = JSON.parse(this.paymentForm.native_params.data);\n\n    let lastBrand: string, brandIconTempId = 0, lastBrandImg: HTMLImageElement;\n    const setBrandIcon = (brand: string) => {\n      if(lastBrand === brand) {\n        return;\n      }\n\n      const tempId = ++brandIconTempId;\n      lastBrand = brand;\n\n      const path = getPaymentBrandIconPath(brand);\n      if(!path) {\n        if(lastBrandImg) {\n          lastBrandImg.remove();\n          lastBrandImg = undefined;\n        }\n\n        return;\n      }\n\n      const img = new Image();\n      img.classList.add('input-field-icon');\n      renderImageFromUrlPromise(img, path, false).then(() => {\n        if(brandIconTempId !== tempId) {\n          return;\n        }\n\n        if(lastBrandImg) {\n          lastBrandImg.replaceWith(img);\n        } else {\n          cardInputField.container.append(img);\n        }\n\n        lastBrandImg = img;\n      });\n    };\n    const cardInputField = new InputFieldCorrected({\n      label: 'PaymentCardNumber',\n      plainText: true,\n      inputMode: 'numeric',\n      autocomplete: 'cc-number',\n      formatMethod: cardFormattingPatterns.cardNumber,\n      validateMethod: validateCardNumber,\n      errorKeys: {\n        invalid: 'PaymentCard.Error.Invalid',\n        incomplete: 'PaymentCard.Error.Incomplete'\n      },\n      onChange: (transformed) => {\n        setBrandIcon(detectUnifiedCardBrand(transformed.value));\n        cvcInputField.update(); // format cvc\n      }\n    });\n\n    let nameInputField: InputField;\n    if(nativeParams.need_cardholder_name) nameInputField = new InputField({\n      label: 'Checkout.NewCard.CardholderNamePlaceholder',\n      maxLength: 255,\n      required: true,\n      autocomplete: 'cc-name'\n    });\n\n    const expireInputField = new InputFieldCorrected({\n      label: 'SecureId.Identity.Placeholder.ExpiryDate',\n      plainText: true,\n      inputMode: 'numeric',\n      autocomplete: 'cc-exp',\n      formatMethod: cardFormattingPatterns.cardExpiry,\n      validateMethod: validateCardExpiry\n    });\n\n    const cvcInputField = new InputFieldCorrected({\n      labelText: 'CVC',\n      plainText: true,\n      inputMode: 'numeric',\n      autocomplete: 'cc-csc',\n      formatMethod: () => cardFormattingPatterns.cardCvc(cardInputField.value)\n      // validateMethod: (...args) => _5AH3.a.cardCvc(cardInputField.value)(...args)\n    });\n\n    const switchFocusOrder: (InputFieldCorrected | InputField)[] = [\n      cardInputField,\n      expireInputField,\n      cvcInputField,\n      nameInputField\n    ].filter(Boolean);\n    switchFocusOrder.forEach((inputField) => {\n      const onKeyDown = (e: KeyboardEvent) => {\n        if(!inputField.value && e.key === 'Backspace') {\n          const previousInputField = switchFocusOrder[switchFocusOrder.indexOf(inputField) - 1];\n          if(previousInputField) {\n            // previousInputField.value = previousInputField.value.slice(0, -1);\n            placeCaretAtEnd(previousInputField.input, true);\n          }\n        }\n      };\n\n      if(inputField instanceof InputFieldCorrected) {\n        inputField.options.onKeyDown = onKeyDown;\n\n        const original = inputField.options.onChange;\n        inputField.options.onChange = (transformed) => {\n          original?.(transformed);\n\n          if(document.activeElement === inputField.input && transformed.meta.autocorrectComplete) {\n            for(let i = switchFocusOrder.indexOf(inputField), length = switchFocusOrder.length; i < length; ++i) {\n              const nextInputField = switchFocusOrder[i];\n              if(\n                nextInputField instanceof InputFieldCorrected ?\n                !nextInputField.validateNew(undefined, undefined, true) :\n                !nextInputField.value\n              ) {\n                placeCaretAtEnd(nextInputField.input, true);\n                break;\n              }\n            }\n          }\n        };\n      } else {\n        inputField.input.addEventListener('keydown', onKeyDown);\n      }\n    });\n\n    const inputFieldsRow = document.createElement('div');\n    inputFieldsRow.classList.add('input-fields-row');\n    inputFieldsRow.append(expireInputField.container, cvcInputField.container);\n\n    cardSection.content.append(...[\n      cardInputField.container,\n      inputFieldsRow,\n      nameInputField?.container\n    ].filter(Boolean));\n\n    let billingSection: SettingSection;\n    // let saveCheckboxField: CheckboxField;\n    const {countryInputField, postcodeInputField} = createCountryZipFields(nativeParams.need_country, nativeParams.need_zip);\n    if(nativeParams.need_country || nativeParams.need_zip) {\n      billingSection = new SettingSection({name: 'PaymentInfo.Billing.Title', noDelimiter: true, noShadow: true});\n\n      // const inputFieldsRow2 = inputFieldsRow.cloneNode() as HTMLElement;\n      // inputFieldsRow2.append(countryInputField.container, postcodeInputField.container);\n      // billingSection.content.append(inputFieldsRow2);\n      billingSection.content.append(...[countryInputField, postcodeInputField].filter(Boolean).map((i) => i.container));\n    }\n\n    const canSave = !!this.paymentForm.pFlags.can_save_credentials;\n    const saveCheckboxField = new CheckboxField({\n      text: 'PaymentCardSavePaymentInformation',\n      checked: !!canSave\n    });\n    const saveRow = new Row({\n      checkboxField: saveCheckboxField,\n      subtitleLangKey: canSave ? 'PaymentCardSavePaymentInformationInfoLine1' : 'Checkout.2FA.Text',\n      noCheckboxSubtitle: true\n    });\n\n    if(!canSave) {\n      saveRow.container.classList.add('is-disabled');\n    }\n\n    (billingSection || cardSection).content.append(saveRow.container);\n\n    this.scrollable.append(...[cardSection, billingSection].filter(Boolean).map((s) => s.container));\n\n    const payButton = PaymentButton({\n      key: 'PaymentInfo.Done',\n      onClick: async() => {\n        const data: PaymentCardDetails = {\n          cardNumber: cardInputField.value,\n          expiryFull: expireInputField.value,\n          expiryMonth: expireInputField.value.split('/')[0],\n          expiryYear: expireInputField.value.split('/')[1],\n          cvc: cvcInputField.value,\n\n          cardholderName: nameInputField?.value,\n          country: countryInputField?.value,\n          zip: postcodeInputField?.value,\n\n          save: saveCheckboxField?.checked\n        };\n\n        const nativeProvider: PaymentsNativeProvider = this.paymentForm.native_provider as any;\n        let out: PaymentsCredentialsToken;\n        if(nativeProvider === 'stripe') {\n          const url = new URL('https://api.stripe.com/v1/tokens');\n          url.search = new URLSearchParams({\n            'card[number]': data.cardNumber,\n            'card[exp_month]': data.expiryMonth,\n            'card[exp_year]': data.expiryYear,\n            'card[cvc]': data.cvc,\n            'card[address_zip]': data.zip,\n            'card[address_country]': data.country,\n            'card[name]': data.cardholderName\n          }).toString();\n\n          const response = await fetch(url.toString(), {\n            method: 'POST',\n            credentials: 'same-origin',\n            headers: {\n              'Content-Type': 'application/x-www-form-urlencoded',\n              'Authorization': `Bearer ${nativeParams.publishable_key}`\n            }\n          });\n\n          out = await response.json();\n        } else if(nativeProvider === 'smartglocal') {\n          const params = {\n            card: {\n              number: data.cardNumber.replace(/[^\\d]+/g, ''),\n              expiration_month: data.expiryMonth,\n              expiration_year: data.expiryYear,\n              security_code: data.cvc.replace(/[^\\d]+/g, '')\n            }\n          };\n\n          const url = /* DEBUG_PAYMENT_SMART_GLOCAL */false ?\n            'https://tgb-playground.smart-glocal.com/cds/v1/tokenize/card' :\n            'https://tgb.smart-glocal.com/cds/v1/tokenize/card';\n\n          const response = await fetch(url, {\n            method: 'POST',\n            headers: {\n              'Accept': 'application/json',\n              'Content-Type': 'application/json',\n              'X-PUBLIC-TOKEN': nativeParams.public_token\n            },\n            body: JSON.stringify(params)\n          });\n\n          const json: { // smartglocal\n            data: {\n              info: {\n                card_network: string,\n                card_type: string,\n                masked_card_number: string\n              },\n              token: string\n            },\n            status: 'ok'\n          } = await response.json();\n\n          out = {type: 'card', token: json.data.token}\n        }\n\n        this.dispatchEvent('finish', {token: out, card: data});\n        this.hide();\n      }\n    });\n\n    const inputFields = ([\n      cardInputField,\n      nameInputField,\n      expireInputField,\n      cvcInputField,\n      countryInputField,\n      postcodeInputField\n    ] as const).filter(Boolean);\n    handleInputFieldsOnChange(inputFields, (valid) => {\n      payButton.disabled = !valid;\n      // payButton.classList.toggle('btn-disabled', !valid);\n    });\n\n    if(savedCard) {\n      cardInputField.value = savedCard.cardNumber;\n      expireInputField.value = savedCard.expiryFull;\n      cvcInputField.value = savedCard.cvc;\n      nameInputField && (nameInputField.value = savedCard.cardholderName);\n      countryInputField && (countryInputField.value = savedCard.country);\n      postcodeInputField && (postcodeInputField.value = savedCard.zip);\n    }\n\n    this.body.append(this.btnConfirmOnEnter = payButton);\n\n    this.show();\n\n    if(!cardInputField.validateNew(undefined, undefined, true)) {\n      placeCaretAtEnd(cardInputField.input);\n    }\n  }\n}\n","import formatValueByPattern from './formatValueByPattern';\n\nexport default function formatInputValueByPattern(options: {\n  value: string,\n  getPattern: Parameters<typeof formatValueByPattern>[0],\n  deleting?: boolean,\n  input?: HTMLElement\n}) {\n  const {value: originalValue, getPattern, deleting, input} = options;\n  const pushRest = !deleting && !!originalValue.length;\n  const result = formatValueByPattern(getPattern, originalValue, {\n    selectionStart: input ? (input as HTMLInputElement).selectionStart : 0,\n    selectionEnd: input ? (input as HTMLInputElement).selectionEnd : 0\n  }, pushRest)\n  const {value, selection} = result;\n\n  return {\n    value,\n    meta: {\n      autocorrectComplete: result.autocorrectComplete,\n      empty: !value\n    },\n    selection\n  };\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport PopupElement from '.';\nimport placeCaretAtEnd from '../../helpers/dom/placeCaretAtEnd';\nimport {AccountPassword, AccountTmpPassword} from '../../layer';\nimport {InputState} from '../inputField';\nimport PasswordInputField from '../passwordInputField';\nimport {SettingSection} from '../sidebarLeft';\nimport {PaymentButton} from './payment';\n\nexport default class PopupPaymentCardConfirmation extends PopupElement<{\n  finish: (tmpPassword: AccountTmpPassword) => void\n}> {\n  constructor(card: string, passwordState: AccountPassword) {\n    super('popup-payment popup-payment-card-confirmation', {\n      closable: true,\n      overlayClosable: true,\n      body: true,\n      scrollable: true,\n      title: 'Checkout.PasswordEntry.Title'\n    });\n\n    const section = new SettingSection({noDelimiter: true, noShadow: true, caption: 'Checkout.PasswordEntry.Text', captionArgs: [card]});\n    const passwordInputField = new PasswordInputField({labelText: passwordState.hint});\n    section.content.append(passwordInputField.container);\n    this.scrollable.append(section.container);\n\n    const onInput = () => {\n      payButton.disabled = !passwordInputField.value;\n      passwordInputField.setState(InputState.Neutral);\n    };\n\n    passwordInputField.input.addEventListener('input', onInput);\n\n    const payButton = PaymentButton({\n      key: 'Checkout.PasswordEntry.Pay',\n      onClick: async() => {\n        try {\n          const inputCheckPassword = await this.managers.passwordManager.getInputCheckPassword(passwordInputField.value, passwordState);\n          const tmpPassword = await this.managers.apiManager.invokeApi('account.getTmpPassword', {\n            password: inputCheckPassword,\n            period: 60\n          });\n\n          this.dispatchEvent('finish', tmpPassword);\n          this.hide();\n        } catch(err) {\n          if((err as ApiError).type === 'PASSWORD_HASH_INVALID') {\n            (err as ApiError).handled = true;\n            passwordInputField.setError('PASSWORD_HASH_INVALID');\n          }\n\n          throw err;\n        }\n      }\n    });\n    this.body.append(this.btnConfirmOnEnter = payButton);\n\n    onInput();\n\n    this.show();\n\n    placeCaretAtEnd(passwordInputField.input);\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport PopupElement from '.';\nimport placeCaretAtEnd from '../../helpers/dom/placeCaretAtEnd';\nimport {InputInvoice, PaymentRequestedInfo, PaymentsPaymentForm, PaymentsValidatedRequestedInfo} from '../../layer';\nimport matchEmail from '../../lib/richTextProcessor/matchEmail';\nimport CheckboxField from '../checkboxField';\nimport CountryInputField from '../countryInputField';\nimport InputField from '../inputField';\nimport Row from '../row';\nimport {SettingSection} from '../sidebarLeft';\nimport TelInputField from '../telInputField';\nimport {PaymentButton} from './payment';\nimport {createCountryZipFields, handleInputFieldsOnChange, InputFieldCorrected} from './paymentCard';\n\nexport type PaymentShippingAddress = PaymentRequestedInfo;\n\ntype ShippingFocusField = 'name' | 'email' | 'phone';\n\nexport default class PopupPaymentShipping extends PopupElement<{\n  finish: (o: {shippingAddress: PaymentShippingAddress, requestedInfo: PaymentsValidatedRequestedInfo}) => void\n}> {\n  constructor(\n    private paymentForm: PaymentsPaymentForm,\n    private inputInvoice: InputInvoice,\n    private focus?: ShippingFocusField\n  ) {\n    super('popup-payment popup-payment-shipping', {\n      closable: true,\n      overlayClosable: true,\n      body: true,\n      scrollable: true,\n      title: 'PaymentShippingInfo'\n    });\n\n    this.d();\n  }\n\n  private d() {\n    const paymentForm = this.paymentForm;\n    const invoice = paymentForm.invoice;\n    const savedInfo = this.paymentForm.saved_info;\n\n    let addressSection: SettingSection,\n      address1InputField: InputField,\n      address2InputField: InputField,\n      cityInputField: InputField,\n      stateInputField: InputField,\n      countryInputField: CountryInputField,\n      postcodeInputField: InputFieldCorrected;\n    if(invoice.pFlags.shipping_address_requested) {\n      addressSection = new SettingSection({name: 'PaymentShippingAddress', noDelimiter: true, noShadow: true});\n      address1InputField = new InputField({label: 'PaymentShippingAddress1Placeholder', maxLength: 64, required: true});\n      address2InputField = new InputField({label: 'PaymentShippingAddress2Placeholder', maxLength: 64});\n      cityInputField = new InputField({label: 'PaymentShippingCityPlaceholder', maxLength: 64, required: true});\n      stateInputField = new InputField({label: 'PaymentShippingStatePlaceholder', maxLength: 64});\n      const res = createCountryZipFields(true, true);\n      countryInputField = res.countryInputField;\n      postcodeInputField = res.postcodeInputField;\n\n      addressSection.content.append(...[\n        address1InputField,\n        address2InputField,\n        cityInputField,\n        stateInputField,\n        countryInputField,\n        postcodeInputField\n      ].filter(Boolean).map((inputField) => inputField.container));\n    }\n\n    let receiverSection: SettingSection;\n    let nameInputField: InputField, emailInputField: InputField, telInputField: TelInputField;\n    if([invoice.pFlags.name_requested, invoice.pFlags.email_requested, invoice.pFlags.phone_requested].includes(true)) {\n      receiverSection = new SettingSection({name: 'PaymentShippingReceiver', noDelimiter: true, noShadow: true});\n\n      const validateEmail = () => {\n        const value = emailInputField.value;\n        const match = matchEmail(value);\n        if(!match || match[0].length !== value.length) {\n          return false;\n        }\n\n        return true;\n      };\n\n      const validatePhone = () => {\n        return !!telInputField.value.match(/\\d/);\n      };\n\n      if(invoice.pFlags.name_requested) nameInputField = new InputField({label: 'PaymentShippingName', maxLength: 256, required: true});\n      if(invoice.pFlags.email_requested) emailInputField = new InputField({label: 'PaymentShippingEmailPlaceholder', maxLength: 64, required: true, validate: validateEmail});\n      if(invoice.pFlags.phone_requested) telInputField = new TelInputField({required: true, validate: validatePhone});\n\n      receiverSection.content.append(...[\n        nameInputField,\n        emailInputField,\n        telInputField\n      ].filter(Boolean).map((inputField) => inputField.container));\n    }\n\n    const saveCheckboxField = new CheckboxField({\n      text: 'PaymentShippingSave',\n      checked: true\n    });\n    const saveRow = new Row({\n      checkboxField: saveCheckboxField,\n      subtitleLangKey: 'PaymentShippingSaveInfo',\n      noCheckboxSubtitle: true\n    });\n\n    (receiverSection || addressSection).content.append(saveRow.container);\n\n    this.scrollable.append(...[addressSection, receiverSection].filter(Boolean).map((section) => section.container));\n\n    const payButton = PaymentButton({\n      key: 'PaymentInfo.Done',\n      onClick: async() => {\n        const selectedCountry = countryInputField && countryInputField.getSelected().country;\n        const data: PaymentShippingAddress = {\n          _: 'paymentRequestedInfo',\n          shipping_address: selectedCountry && {\n            _: 'postAddress',\n            street_line1: address1InputField.value,\n            street_line2: address2InputField.value,\n            city: cityInputField.value,\n            state: stateInputField.value,\n            // country: countryInputField.value,\n            country_iso2: selectedCountry?.iso2,\n            post_code: postcodeInputField.value\n          },\n          name: nameInputField?.value,\n          email: emailInputField?.value,\n          phone: telInputField?.value\n        };\n\n        try {\n          const requestedInfo = await this.managers.appPaymentsManager.validateRequestedInfo(this.inputInvoice, data, saveCheckboxField?.checked);\n\n          this.dispatchEvent('finish', {\n            shippingAddress: data,\n            requestedInfo\n          });\n\n          this.hide();\n        } catch(err: any) {\n          const errorMap: {[err: string]: InputField} = {\n            ADDRESS_STREET_LINE1_INVALID: address1InputField,\n            ADDRESS_STREET_LINE2_INVALID: address2InputField,\n            ADDRESS_COUNTRY_INVALID: countryInputField,\n            ADDRESS_CITY_INVALID: cityInputField,\n            ADDRESS_STATE_INVALID: stateInputField,\n            ADDRESS_POSTCODE_INVALID: postcodeInputField,\n\n            REQ_INFO_NAME_INVALID: nameInputField,\n            REQ_INFO_EMAIL_INVALID: emailInputField,\n            REQ_INFO_PHONE_INVALID: telInputField\n          };\n\n          const inputField = errorMap[(err as ApiError).type];\n          if(inputField) {\n            inputField.setError();\n            (err as any).handled = true;\n          }\n\n          throw err;\n        }\n      }\n    });\n    this.body.append(this.btnConfirmOnEnter = payButton);\n\n    if(savedInfo) {\n      const shippingAddress = savedInfo.shipping_address;\n      if(shippingAddress) {\n        address1InputField.value = shippingAddress.street_line1;\n        address2InputField.value = shippingAddress.street_line2;\n        cityInputField.value = shippingAddress.city;\n        stateInputField.value = shippingAddress.state;\n        countryInputField.selectCountryByIso2(shippingAddress.country_iso2);\n        postcodeInputField.value = shippingAddress.post_code;\n      }\n\n      savedInfo.name && nameInputField && (nameInputField.value = savedInfo.name);\n      savedInfo.email && emailInputField && (emailInputField.value = savedInfo.email);\n      savedInfo.phone && telInputField && (telInputField.value = savedInfo.phone);\n    }\n\n    const {validate} = handleInputFieldsOnChange([\n      address1InputField,\n      address2InputField,\n      cityInputField,\n      stateInputField,\n      countryInputField,\n      postcodeInputField,\n      nameInputField,\n      emailInputField,\n      telInputField\n    ].filter(Boolean), (valid) => {\n      payButton.disabled = !valid;\n    });\n\n    validate();\n\n    this.show();\n\n    let focusField: InputField;\n    if(this.focus) {\n      const focusMap: {[field in ShippingFocusField]?: InputField} = {\n        name: nameInputField,\n        email: emailInputField,\n        phone: telInputField\n      };\n\n      focusField = focusMap[this.focus];\n    } else {\n      focusField = address1InputField;\n    }\n\n    if(focusField) {\n      placeCaretAtEnd(focusField.input);\n    }\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport PopupElement from '.';\nimport accumulate from '../../helpers/array/accumulate';\nimport {attachClickEvent} from '../../helpers/dom/clickEvent';\nimport paymentsWrapCurrencyAmount from '../../helpers/paymentsWrapCurrencyAmount';\nimport {PaymentsPaymentForm, PaymentsValidatedRequestedInfo, ShippingOption} from '../../layer';\nimport Button from '../button';\nimport RadioField from '../radioField';\nimport Row, {RadioFormFromRows} from '../row';\nimport {SettingSection} from '../sidebarLeft';\nimport {PaymentButton} from './payment';\n\nexport default class PopupPaymentShippingMethods extends PopupElement<{\n  finish: (shippingOption: ShippingOption) => void\n}> {\n  constructor(\n    private paymentForm: PaymentsPaymentForm,\n    private requestedInfo: PaymentsValidatedRequestedInfo,\n    private shippingOption: ShippingOption\n  ) {\n    super('popup-payment popup-payment-shipping-methods', {\n      closable: true,\n      overlayClosable: true,\n      body: true,\n      scrollable: true,\n      title: 'PaymentShippingMethod'\n    });\n\n    this.d();\n  }\n\n  private d() {\n    const section = new SettingSection({name: 'PaymentCheckoutShippingMethod', noDelimiter: true, noShadow: true});\n\n    const rows = this.requestedInfo.shipping_options.map((shippingOption) => {\n      return new Row({\n        radioField: new RadioField({\n          text: shippingOption.title,\n          name: 'shipping-method',\n          value: shippingOption.id\n        }),\n        subtitle: paymentsWrapCurrencyAmount(\n          accumulate(shippingOption.prices.map(({amount}) => +amount), 0),\n          this.paymentForm.invoice.currency\n        )\n      });\n    });\n\n    let lastShippingId: string;\n    const form = RadioFormFromRows(rows, (value) => {\n      lastShippingId = value;\n    });\n\n    if(this.shippingOption) {\n      rows.find((row) => row.radioField.input.value === this.shippingOption.id).radioField.checked = true;\n    } else {\n      rows[0].radioField.checked = true;\n    }\n\n    section.content.append(form);\n\n    this.scrollable.append(section.container);\n\n    const payButton = PaymentButton({\n      key: 'PaymentInfo.Done',\n      onClick: () => {\n        this.dispatchEvent('finish', this.requestedInfo.shipping_options.find((option) => option.id === lastShippingId));\n        this.hide();\n      }\n    });\n    this.body.append(this.btnConfirmOnEnter = payButton);\n\n    this.show();\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport PopupElement from '.';\nimport Currencies from '../../config/currencies';\nimport {FontFamily, FontSize} from '../../config/font';\nimport accumulate from '../../helpers/array/accumulate';\nimport getTextWidth from '../../helpers/canvas/getTextWidth';\nimport {detectUnifiedCardBrand} from '../../helpers/cards/cardBrands';\nimport {attachClickEvent, simulateClickEvent} from '../../helpers/dom/clickEvent';\nimport findUpAsChild from '../../helpers/dom/findUpAsChild';\nimport findUpClassName from '../../helpers/dom/findUpClassName';\nimport placeCaretAtEnd from '../../helpers/dom/placeCaretAtEnd';\nimport {renderImageFromUrlPromise} from '../../helpers/dom/renderImageFromUrl';\nimport replaceContent from '../../helpers/dom/replaceContent';\nimport setInnerHTML from '../../helpers/dom/setInnerHTML';\nimport toggleDisability from '../../helpers/dom/toggleDisability';\nimport {formatPhoneNumber} from '../../helpers/formatPhoneNumber';\nimport paymentsWrapCurrencyAmount from '../../helpers/paymentsWrapCurrencyAmount';\nimport ScrollSaver from '../../helpers/scrollSaver';\nimport tsNow from '../../helpers/tsNow';\nimport {AccountTmpPassword, InputInvoice, InputPaymentCredentials, LabeledPrice, Message, MessageMedia, PaymentRequestedInfo, PaymentSavedCredentials, PaymentsPaymentForm, PaymentsPaymentReceipt, PaymentsValidatedRequestedInfo, PostAddress, ShippingOption} from '../../layer';\nimport I18n, {i18n, LangPackKey, _i18n} from '../../lib/langPack';\nimport wrapEmojiText from '../../lib/richTextProcessor/wrapEmojiText';\nimport wrapRichText from '../../lib/richTextProcessor/wrapRichText';\nimport rootScope from '../../lib/rootScope';\nimport AvatarElement from '../avatar';\nimport Button from '../button';\nimport CheckboxField from '../checkboxField';\nimport PeerTitle from '../peerTitle';\nimport {putPreloader} from '../putPreloader';\nimport Row from '../row';\nimport {toastNew} from '../toast';\nimport {wrapPhoto} from '../wrappers';\nimport wrapPeerTitle from '../wrappers/peerTitle';\nimport PopupPaymentCard, {PaymentCardDetails, PaymentCardDetailsResult} from './paymentCard';\nimport PopupPaymentCardConfirmation from './paymentCardConfirmation';\nimport PopupPaymentShipping, {PaymentShippingAddress} from './paymentShipping';\nimport PopupPaymentShippingMethods from './paymentShippingMethods';\nimport PopupPaymentVerification from './paymentVerification';\n\nconst iconPath = 'assets/img/';\nconst icons = [\n  'amex',\n  'card',\n  'diners',\n  'discover',\n  'jcb',\n  'mastercard',\n  'visa',\n  'unionpay',\n  'mir',\n  'logo'\n];\n\nexport function getPaymentBrandIconPath(brand: string) {\n  if(!icons.includes(brand)) {\n    return;\n  }\n\n  return `${iconPath}${brand}.svg`;\n}\n\nexport function PaymentButton(options: {\n  onClick: () => Promise<any> | void,\n  key?: LangPackKey,\n  textEl?: I18n.IntlElement\n}) {\n  const textEl = options.textEl ?? new I18n.IntlElement({key: options.key ?? 'PaymentInfo.Done'});\n  const key = textEl.key;\n  const payButton = Button('btn-primary btn-color-primary payment-item-pay');\n  payButton.append(textEl.element);\n  attachClickEvent(payButton, async() => {\n    const result = options.onClick();\n    if(!(result instanceof Promise)) {\n      return;\n    }\n\n    const d = putPreloader(payButton);\n    const toggle = toggleDisability([payButton], true);\n    textEl.compareAndUpdate({key: 'PleaseWait'});\n    try {\n      await result;\n    } catch(err) {\n      if(!(err as any).handled) {\n        console.error('payment button error', err);\n      }\n\n      toggle();\n      textEl.compareAndUpdate({key});\n      d.remove();\n    }\n  });\n  return payButton;\n}\n\nexport type PaymentsCredentialsToken = {type: 'card', token?: string, id?: string};\n\nexport default class PopupPayment extends PopupElement {\n  private tipButtonsMap: Map<number, HTMLElement>;\n\n  constructor(\n    private message: Message.message,\n    private inputInvoice: InputInvoice,\n    private paymentForm?: PaymentsPaymentForm | PaymentsPaymentReceipt\n  ) {\n    super('popup-payment', {\n      closable: true,\n      overlayClosable: true,\n      body: true,\n      scrollable: true,\n      title: true\n    });\n\n    this.tipButtonsMap = new Map();\n    this.d();\n  }\n\n  private async d() {\n    this.element.classList.add('is-loading');\n    this.show();\n\n    let confirmed = false;\n    const onConfirmed = () => {\n      if(confirmed) {\n        return;\n      }\n\n      confirmed = true;\n      if(popupPaymentVerification) {\n        popupPaymentVerification.hide();\n      }\n\n      this.hide();\n    };\n\n    let {paymentForm, message} = this;\n\n    if(message) {\n      this.listenerSetter.add(rootScope)('payment_sent', ({peerId, mid}) => {\n        if(message.peerId === peerId && message.mid === mid) {\n          onConfirmed();\n        }\n      });\n    }\n\n    const mediaInvoice = message?.media as MessageMedia.messageMediaInvoice;\n    const isReceipt = mediaInvoice ? !!mediaInvoice.receipt_msg_id : paymentForm._ === 'payments.paymentReceipt';\n    const isTest = mediaInvoice ? mediaInvoice.pFlags.test : paymentForm.invoice.pFlags.test;\n\n    const photo = mediaInvoice ? mediaInvoice.photo : paymentForm.photo;\n    const title = mediaInvoice ? mediaInvoice.title : paymentForm.title;\n    const description = mediaInvoice ? mediaInvoice.description : paymentForm.description;\n\n    _i18n(this.title, isReceipt ? 'PaymentReceipt' : 'PaymentCheckout');\n    if(isTest) {\n      this.title.append(' (Test)');\n    }\n\n    const className = 'payment-item';\n\n    const itemEl = document.createElement('div');\n    itemEl.classList.add(className);\n\n    const detailsClassName = className + '-details';\n    const details = document.createElement('div');\n    details.classList.add(detailsClassName);\n\n    let photoEl: HTMLElement;\n    if(photo) {\n      photoEl = document.createElement('div');\n      photoEl.classList.add(detailsClassName + '-photo', 'media-container-contain');\n      wrapPhoto({\n        photo: photo,\n        container: photoEl,\n        boxWidth: 100,\n        boxHeight: 100,\n        size: {_: 'photoSizeEmpty', type: ''}\n      });\n      details.append(photoEl);\n    }\n\n    const linesClassName = detailsClassName + '-lines';\n    const linesEl = document.createElement('div');\n    linesEl.classList.add(linesClassName);\n\n    const titleEl = document.createElement('div');\n    titleEl.classList.add(linesClassName + '-title');\n\n    const descriptionEl = document.createElement('div');\n    descriptionEl.classList.add(linesClassName + '-description');\n\n    const botName = document.createElement('div');\n    botName.classList.add(linesClassName + '-bot-name');\n\n    linesEl.append(titleEl, descriptionEl, botName);\n\n    setInnerHTML(titleEl, wrapEmojiText(title));\n    setInnerHTML(descriptionEl, wrapEmojiText(description));\n\n    const peerTitle = new PeerTitle();\n    botName.append(peerTitle.element);\n\n    details.append(linesEl);\n    itemEl.append(details);\n    this.scrollable.append(itemEl);\n\n    const preloaderContainer = document.createElement('div');\n    preloaderContainer.classList.add(className + '-preloader-container');\n    const preloader = putPreloader(preloaderContainer, true);\n    this.scrollable.container.append(preloaderContainer);\n\n    const inputInvoice = this.inputInvoice;\n    if(!paymentForm) {\n      if(isReceipt) paymentForm = await this.managers.appPaymentsManager.getPaymentReceipt(message.peerId, mediaInvoice.receipt_msg_id);\n      else paymentForm = await this.managers.appPaymentsManager.getPaymentForm(inputInvoice);\n      this.paymentForm = paymentForm;\n    }\n\n    let savedInfo = (paymentForm as PaymentsPaymentForm).saved_info || (paymentForm as PaymentsPaymentReceipt).info;\n    const savedCredentials = (paymentForm as PaymentsPaymentForm).saved_credentials?.[0];\n    let [lastRequestedInfo, passwordState, providerPeerTitle] = await Promise.all([\n      !isReceipt && savedInfo && this.managers.appPaymentsManager.validateRequestedInfo(inputInvoice, savedInfo),\n      savedCredentials && this.managers.passwordManager.getState(),\n      wrapPeerTitle({peerId: paymentForm.provider_id.toPeerId()})\n    ]);\n\n    console.log(paymentForm, lastRequestedInfo);\n\n    await peerTitle.update({peerId: paymentForm.bot_id.toPeerId()});\n    preloaderContainer.remove();\n    this.element.classList.remove('is-loading');\n\n    const wrapAmount = (amount: string | number, skipSymbol?: boolean) => {\n      return paymentsWrapCurrencyAmount(amount, currency, skipSymbol);\n    };\n\n    const {invoice} = paymentForm;\n    const currency = invoice.currency;\n\n    const isRecurring = invoice.pFlags.recurring && !isReceipt;\n\n    await peerTitle.update({peerId: paymentForm.bot_id.toPeerId()});\n    const peerTitle2 = isRecurring ? await wrapPeerTitle({peerId: paymentForm.bot_id.toPeerId()}) : undefined;\n    preloaderContainer.remove();\n    this.element.classList.remove('is-loading');\n\n    const makeLabel = () => {\n      const labelEl = document.createElement('div');\n      labelEl.classList.add(pricesClassName + '-price');\n\n      const left = document.createElement('span');\n      const right = document.createElement('span');\n      labelEl.append(left, right);\n      return {label: labelEl, left, right};\n    };\n\n    const pricesClassName = className + '-prices';\n    const prices = document.createElement('div');\n    prices.classList.add(pricesClassName);\n    const makePricesElements = (prices: LabeledPrice[]) => {\n      return prices.map((price) => {\n        const {amount, label} = price;\n\n        const _label = makeLabel();\n        _label.left.textContent = label;\n\n        const wrappedAmount = wrapAmount(amount);\n        _label.right.textContent = wrappedAmount;\n\n        return _label.label;\n      });\n    };\n\n    const pricesElements = makePricesElements(invoice.prices);\n\n    let getTipsAmount = (): number => 0;\n    let shippingAmount = 0;\n\n    const getTotalTotal = () => totalAmount + getTipsAmount() + shippingAmount;\n    const setTotal = () => {\n      const wrapped = wrapAmount(getTotalTotal());\n      totalLabel.right.textContent = wrapped;\n      payI18n.compareAndUpdate({\n        key: 'PaymentCheckoutPay',\n        args: [wrapped]\n      });\n    };\n\n    const payI18n = new I18n.IntlElement();\n\n    const totalLabel = makeLabel();\n    totalLabel.label.classList.add('is-total');\n    _i18n(totalLabel.left, 'PaymentTransactionTotal');\n    const totalAmount = accumulate(invoice.prices.map(({amount}) => +amount), 0);\n\n    const canTip = (invoice.max_tip_amount !== undefined && !isReceipt) || !!(paymentForm as PaymentsPaymentReceipt).tip_amount;\n    if(canTip) {\n      const tipsClassName = className + '-tips';\n\n      const currencyData = Currencies[currency];\n\n      getTipsAmount = () => +getInputValue().replace(/\\D/g, '');\n\n      const getInputValue = () => {\n        // return input.textContent;\n        return input.value;\n      };\n\n      const setInputWidth = () => {\n        const width = getTextWidth(getInputValue(), `500 ${FontSize} ${FontFamily}`);\n        input.style.width = width + 'px';\n      };\n\n      const setInputValue = (amount: string | number) => {\n        amount = Math.min(+amount, +invoice.max_tip_amount);\n        const wrapped = wrapAmount(amount, true);\n\n        input.value = wrapped;\n        // input.textContent = wrapped;\n        if(document.activeElement === input) {\n          placeCaretAtEnd(input);\n        }\n\n        unsetActiveTip && unsetActiveTip();\n        const tipEl = this.tipButtonsMap.get(amount);\n        if(tipEl) {\n          tipEl.classList.add('active');\n        }\n\n        setInputWidth();\n        setTotal();\n      };\n\n      const tipsLabel = makeLabel();\n      _i18n(tipsLabel.left, isReceipt ? 'PaymentTip' : 'PaymentTipOptional');\n      const input = document.createElement('input');\n      input.type = 'tel';\n      // const input: HTMLElement = document.createElement('div');\n      // input.contentEditable = 'true';\n      input.classList.add('input-clear', tipsClassName + '-input');\n      tipsLabel.right.append(input);\n\n      if(!isReceipt) {\n        tipsLabel.label.style.cursor = 'text';\n      } else {\n        tipsLabel.label.classList.add('disable-hover');\n      }\n\n      tipsLabel.label.addEventListener('mousedown', (e) => {\n        if(!findUpAsChild(e.target as HTMLElement, input)) {\n          placeCaretAtEnd(input);\n        }\n      });\n\n      const haveToIgnoreEvents = input instanceof HTMLInputElement ? 1 : 2;\n      const onSelectionChange = () => {\n        if(ignoreNextSelectionChange) {\n          --ignoreNextSelectionChange;\n          return;\n        }\n\n        // setTimeout(() => {\n        ignoreNextSelectionChange = haveToIgnoreEvents;\n        placeCaretAtEnd(input);\n        // }, 0);\n      };\n\n      const onFocus = () => {\n        // cancelEvent(e);\n        setTimeout(() => {\n          ignoreNextSelectionChange = haveToIgnoreEvents;\n          placeCaretAtEnd(input);\n          document.addEventListener('selectionchange', onSelectionChange);\n        }, 0);\n      };\n\n      const onFocusOut = () => {\n        input.addEventListener('focus', onFocus, {once: true});\n        document.removeEventListener('selectionchange', onSelectionChange);\n      };\n\n      let ignoreNextSelectionChange: number;\n      input.addEventListener('focusout', onFocusOut);\n      onFocusOut();\n\n      input.addEventListener('input', () => {\n        setInputValue(getTipsAmount());\n      });\n\n      const s = [currencyData.symbol, currencyData.space_between ? ' ' : ''];\n      if(!currencyData.symbol_left) s.reverse();\n      tipsLabel.right[currencyData.symbol_left ? 'prepend' : 'append'](s.join(''));\n\n      pricesElements.push(tipsLabel.label);\n\n      //\n      let unsetActiveTip: () => void;\n      if(!isReceipt) {\n        const tipsEl = document.createElement('div');\n        tipsEl.classList.add(tipsClassName);\n\n        const tipClassName = tipsClassName + '-tip';\n        const tipButtons = invoice.suggested_tip_amounts.map((tipAmount) => {\n          const button = Button(tipClassName, {noRipple: true});\n          button.textContent = wrapAmount(tipAmount);\n\n          this.tipButtonsMap.set(+tipAmount, button);\n          return button;\n        });\n\n        unsetActiveTip = () => {\n          const prevTipEl = tipsEl.querySelector('.active');\n          if(prevTipEl) {\n            prevTipEl.classList.remove('active');\n          }\n        };\n\n        attachClickEvent(tipsEl, (e) => {\n          const tipEl = findUpClassName(e.target, tipClassName);\n          if(!tipEl) {\n            return;\n          }\n\n          let tipAmount = 0;\n          if(tipEl.classList.contains('active')) {\n            tipEl.classList.remove('active');\n          } else {\n            unsetActiveTip();\n            tipEl.classList.add('active');\n\n            for(const [amount, el] of this.tipButtonsMap) {\n              if(el === tipEl) {\n                tipAmount = amount;\n                break;\n              }\n            }\n          }\n\n          setInputValue(tipAmount);\n        });\n\n        setInputValue(0);\n\n        tipsEl.append(...tipButtons);\n        pricesElements.push(tipsEl);\n      } else {\n        setInputValue((paymentForm as PaymentsPaymentReceipt).tip_amount);\n      }\n    } else {\n      setTotal();\n    }\n\n    pricesElements.push(totalLabel.label);\n\n    prices.append(...pricesElements);\n    itemEl.append(prices);\n\n    // /\n\n    const setRowIcon = async(row: Row, icon?: string) => {\n      const img = document.createElement('img');\n      img.classList.add('media-photo');\n      await renderImageFromUrlPromise(img, getPaymentBrandIconPath(icon));\n      let container = row.media;\n      if(!container) {\n        container = row.createMedia('small');\n        container.classList.add('media-container-cover');\n        container.append(img);\n      } else {\n        replaceContent(container, img);\n      }\n    };\n\n    const createRow = (options: ConstructorParameters<typeof Row>[0]) => {\n      if(options.titleLangKey) {\n        options.subtitleLangKey = options.titleLangKey;\n      }\n\n      options.noWrap = true;\n      const row = new Row(options);\n      row.container.classList.add(className + '-row');\n\n      if(options.titleLangKey) {\n        row.subtitle.classList.add('hide');\n      }\n\n      return row;\n    };\n\n    const setRowTitle = (row: Row, textContent: string) => {\n      row.title.textContent = textContent;\n      if(!textContent) {\n        const e = I18n.weakMap.get(row.subtitle.firstElementChild as HTMLElement) as I18n.IntlElement;\n        row.title.append(i18n(e.key));\n      }\n\n      row.subtitle.classList.toggle('hide', !textContent);\n    };\n\n    const setCardSubtitle = (card: PaymentCardDetailsResult) => {\n      let brand: string;\n      let str: string;\n      let icon: string;\n      if('title' in card) {\n        brand = card.title.split(' ').shift();\n        str = card.title;\n        icon = card.icon;\n      } else {\n        brand = detectUnifiedCardBrand(card.cardNumber);\n        str = brand + ' *' + card.cardNumber.split(' ').pop();\n      }\n\n      methodRow.title.classList.remove('tgico', 'tgico-card_outline');\n      setRowIcon(methodRow, icon || brand.toLowerCase());\n      setRowTitle(methodRow, str);\n    };\n\n    const onMethodClick = () => {\n      new PopupPaymentCard(paymentForm as PaymentsPaymentForm, previousCardDetails as PaymentCardDetails).addEventListener('finish', ({token, card}) => {\n        previousToken = token, previousCardDetails = card;\n\n        setCardSubtitle(card);\n      });\n    };\n\n    let previousCardDetails: PaymentCardDetailsResult, previousToken: PaymentsCredentialsToken;\n    const methodRow = createRow({\n      titleLangKey: 'PaymentCheckoutMethod',\n      clickable: isReceipt ? undefined : onMethodClick,\n      icon: 'card_outline'\n    });\n\n    methodRow.container.classList.add(className + '-method-row');\n\n    if(savedCredentials) {\n      setCardSubtitle(savedCredentials);\n    } else if((paymentForm as PaymentsPaymentReceipt).credentials_title) {\n      setCardSubtitle({title: (paymentForm as PaymentsPaymentReceipt).credentials_title});\n    }\n\n    const providerRow = createRow({\n      title: providerPeerTitle,\n      subtitleLangKey: 'PaymentCheckoutProvider'\n    });\n\n    const providerAvatar = new AvatarElement();\n    providerAvatar.classList.add('avatar-32');\n    providerRow.createMedia('small').append(providerAvatar);\n    /* await */ providerAvatar.updateWithOptions({peerId: paymentForm.provider_id.toPeerId()});\n\n    let shippingAddressRow: Row, shippingNameRow: Row, shippingEmailRow: Row, shippingPhoneRow: Row, shippingMethodRow: Row;\n    let lastShippingOption: ShippingOption, onShippingAddressClick: (focus?: ConstructorParameters<typeof PopupPaymentShipping>[2]) => void, onShippingMethodClick: () => void;\n    const setShippingTitle = invoice.pFlags.shipping_address_requested ? (shippingAddress?: PaymentShippingAddress) => {\n      if(!shippingAddress) {\n        shippingMethodRow.subtitle.classList.add('hide');\n        replaceContent(shippingMethodRow.title, i18n('PaymentShippingAddress'));\n        return;\n      }\n\n      const postAddress = shippingAddress.shipping_address;\n      setRowTitle(shippingAddressRow, [postAddress.city, postAddress.street_line1, postAddress.street_line2].filter(Boolean).join(', '));\n\n      shippingMethodRow.container.classList.toggle('hide', !lastRequestedInfo && !isReceipt);\n    } : undefined;\n\n    const setShippingInfo = (info: PaymentRequestedInfo) => {\n      setShippingTitle && setShippingTitle(info);\n      shippingNameRow && setRowTitle(shippingNameRow, info.name);\n      shippingEmailRow && setRowTitle(shippingEmailRow, info.email);\n      shippingPhoneRow && setRowTitle(shippingPhoneRow, info.phone && ('+' + formatPhoneNumber(info.phone).formatted));\n    };\n\n    if(!isReceipt) {\n      onShippingAddressClick = (focus) => {\n        new PopupPaymentShipping(paymentForm as PaymentsPaymentForm, inputInvoice, focus).addEventListener('finish', ({shippingAddress, requestedInfo}) => {\n          lastRequestedInfo = requestedInfo;\n          savedInfo = (paymentForm as PaymentsPaymentForm).saved_info = shippingAddress;\n          setShippingInfo(shippingAddress);\n        });\n      };\n    }\n\n    if(invoice.pFlags.shipping_address_requested) {\n      const setShippingOption = (shippingOption?: ShippingOption) => {\n        const scrollSaver = new ScrollSaver(this.scrollable, undefined, true);\n        scrollSaver.save();\n        if(lastShippingPricesElements) {\n          lastShippingPricesElements.forEach((node) => node.remove());\n        }\n\n        if(!shippingOption) {\n          shippingAmount = 0;\n\n          setTotal();\n          scrollSaver.restore();\n          this.onContentUpdate();\n          return;\n        }\n\n        lastShippingOption = shippingOption;\n        setRowTitle(shippingMethodRow, shippingOption.title);\n\n        shippingAmount = accumulate(shippingOption.prices.map(({amount}) => +amount), 0);\n        lastShippingPricesElements = makePricesElements(shippingOption.prices);\n        let l = totalLabel.label;\n        if(canTip) {\n          l = l.previousElementSibling as any;\n          if(!isReceipt) {\n            l = l.previousElementSibling as any;\n          }\n        }\n\n        lastShippingPricesElements.forEach((element) => l.parentElement.insertBefore(element, l));\n\n        setTotal();\n        scrollSaver.restore();\n        this.onContentUpdate();\n      };\n\n      shippingAddressRow = createRow({\n        icon: 'location',\n        titleLangKey: 'PaymentShippingAddress',\n        clickable: !isReceipt && onShippingAddressClick.bind(null, undefined)\n      });\n\n      let lastShippingPricesElements: HTMLElement[];\n      shippingMethodRow = createRow({\n        icon: 'shipping',\n        titleLangKey: 'PaymentCheckoutShippingMethod',\n        clickable: !isReceipt && (onShippingMethodClick = () => {\n          new PopupPaymentShippingMethods(paymentForm as PaymentsPaymentForm, lastRequestedInfo, lastShippingOption).addEventListener('finish', (shippingOption) => {\n            setShippingOption(shippingOption);\n          });\n        })\n      });\n\n      shippingMethodRow.container.classList.add('hide');\n\n      const shippingOption = (paymentForm as PaymentsPaymentReceipt).shipping;\n      if(shippingOption) {\n        setShippingOption(shippingOption);\n      }\n    }\n\n    if(invoice.pFlags.name_requested) {\n      shippingNameRow = createRow({\n        icon: 'newprivate',\n        titleLangKey: 'PaymentCheckoutName',\n        clickable: !isReceipt && onShippingAddressClick.bind(null, 'name')\n      });\n    }\n\n    if(invoice.pFlags.email_requested) {\n      shippingEmailRow = createRow({\n        icon: 'mention',\n        titleLangKey: 'PaymentShippingEmailPlaceholder',\n        clickable: !isReceipt && onShippingAddressClick.bind(null, 'email')\n      });\n    }\n\n    if(invoice.pFlags.phone_requested) {\n      shippingPhoneRow = createRow({\n        icon: 'phone',\n        titleLangKey: 'PaymentCheckoutPhoneNumber',\n        clickable: !isReceipt && onShippingAddressClick.bind(null, 'phone')\n      });\n    }\n\n    if(savedInfo) {\n      setShippingInfo(savedInfo);\n    }\n\n    const rows = [\n      methodRow,\n      providerRow,\n      shippingAddressRow,\n      shippingMethodRow,\n      shippingNameRow,\n      shippingEmailRow,\n      shippingPhoneRow\n    ].filter(Boolean);\n\n    const acceptTermsCheckboxField = isRecurring && new CheckboxField({\n      text: 'Payments.Recurrent.Accept',\n      textArgs: [wrapRichText(invoice.recurring_terms_url), peerTitle2]\n    });\n\n    const acceptTermsRow = isRecurring && createRow({\n      checkboxField: acceptTermsCheckboxField,\n      noCheckboxSubtitle: true\n    });\n\n    const recurringElements = isRecurring ? [document.createElement('hr'), acceptTermsRow.container] : [];\n\n    this.scrollable.append(...[\n      document.createElement('hr'),\n      ...rows.map((row) => row.container),\n      ...recurringElements\n    ].filter(Boolean));\n\n    // /\n    let popupPaymentVerification: PopupPaymentVerification, lastTmpPasword: AccountTmpPassword;\n    const onClick = () => {\n      const missingInfo = invoice.pFlags.name_requested && !savedInfo?.name ? 'name' : (invoice.pFlags.email_requested && !savedInfo?.email ? 'email' : (invoice.pFlags.phone_requested && !savedInfo?.phone ? 'phone' : undefined));\n      if(invoice.pFlags.shipping_address_requested) {\n        if(!lastRequestedInfo) {\n          onShippingAddressClick();\n          return;\n        } else if(!lastShippingOption) {\n          onShippingMethodClick();\n          return;\n        }\n      } else if(missingInfo) {\n        onShippingAddressClick(missingInfo);\n        return;\n      }\n\n      if(!previousCardDetails && !lastTmpPasword) {\n        if(!savedCredentials) {\n          onMethodClick();\n          return;\n        }\n\n        Promise.resolve(passwordState ?? this.managers.passwordManager.getState()).then((_passwordState) => {\n          new PopupPaymentCardConfirmation(savedCredentials.title, _passwordState).addEventListener('finish', (tmpPassword) => {\n            passwordState = undefined;\n            lastTmpPasword = tmpPassword;\n            simulateClickEvent(payButton);\n\n            // * reserve 5 seconds\n            const diff = tmpPassword.valid_until - tsNow(true) - 5;\n            setTimeout(() => {\n              if(lastTmpPasword === tmpPassword) {\n                lastTmpPasword = undefined;\n              }\n            }, diff * 1000);\n          });\n        });\n\n        return;\n      }\n\n      return Promise.resolve().then(async() => {\n        const credentials: InputPaymentCredentials = lastTmpPasword ? {\n          _: 'inputPaymentCredentialsSaved',\n          id: savedCredentials.id,\n          tmp_password: lastTmpPasword.tmp_password\n        } : {\n          _: 'inputPaymentCredentials',\n          data: {\n            _: 'dataJSON',\n            data: JSON.stringify(previousToken.token ? previousToken : {type: previousToken.type, id: previousToken.id})\n          },\n          pFlags: {\n            save: previousCardDetails.save || undefined\n          }\n        };\n\n        try {\n          const paymentResult = await this.managers.appPaymentsManager.sendPaymentForm(\n            inputInvoice,\n            (paymentForm as PaymentsPaymentForm).form_id,\n            lastRequestedInfo?.id,\n            lastShippingOption?.id,\n            credentials,\n            getTipsAmount()\n          );\n\n          if(paymentResult._ === 'payments.paymentResult') {\n            onConfirmed();\n          } else {\n            popupPaymentVerification = new PopupPaymentVerification(paymentResult.url);\n            popupPaymentVerification.addEventListener('finish', () => {\n              popupPaymentVerification = undefined;\n\n              onConfirmed();\n            });\n            await new Promise<void>((resolve, reject) => {\n              popupPaymentVerification.addEventListener('close', () => {\n                popupPaymentVerification = undefined;\n                if(confirmed) {\n                  resolve();\n                } else {\n                  const err = new Error('payment not finished');\n                  (err as ApiError).handled = true;\n                  reject(err);\n                }\n              });\n            });\n          }\n        } catch(err) {\n          if((err as ApiError).type === 'BOT_PRECHECKOUT_TIMEOUT') {\n            toastNew({langPackKey: 'Error.AnError'});\n            (err as ApiError).handled = true;\n          } else if((err as ApiError).type === 'TMP_PASSWORD_INVALID') {\n            passwordState = lastTmpPasword = undefined;\n            simulateClickEvent(payButton);\n            (err as ApiError).handled = true;\n          }\n\n          throw err;\n        }\n      });\n    };\n\n    const onChange = () => {\n      payButton.disabled = !!(acceptTermsCheckboxField && !acceptTermsCheckboxField.checked);\n    };\n\n    let payButton: HTMLButtonElement;\n    if(isReceipt) {\n      payButton = PaymentButton({\n        onClick: () => this.hide(),\n        key: 'Done'\n      });\n    } else {\n      payButton = PaymentButton({\n        onClick: onClick,\n        textEl: payI18n\n      });\n    }\n\n    onChange();\n    if(acceptTermsCheckboxField) {\n      acceptTermsCheckboxField.input.addEventListener('change', onChange);\n    }\n\n    this.body.append(this.btnConfirmOnEnter = payButton);\n\n    this.onContentUpdate();\n  }\n}\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport type {AppImManager, ChatSavedPosition} from '../../lib/appManagers/appImManager';\r\nimport type {HistoryResult, MyMessage} from '../../lib/appManagers/appMessagesManager';\r\nimport type {MyDocument} from '../../lib/appManagers/appDocsManager';\r\nimport type Chat from './chat';\r\nimport {CHAT_ANIMATION_GROUP} from '../../lib/appManagers/appImManager';\r\nimport IS_TOUCH_SUPPORTED from '../../environment/touchSupport';\r\nimport {logger} from '../../lib/logger';\r\nimport rootScope from '../../lib/rootScope';\r\nimport BubbleGroups from './bubbleGroups';\r\nimport PopupDatePicker from '../popups/datePicker';\r\nimport PopupForward from '../popups/forward';\r\nimport PopupStickers from '../popups/stickers';\r\nimport ProgressivePreloader from '../preloader';\r\nimport Scrollable, {SliceSides} from '../scrollable';\r\nimport StickyIntersector from '../stickyIntersector';\r\nimport animationIntersector from '../animationIntersector';\r\nimport mediaSizes from '../../helpers/mediaSizes';\r\nimport {IS_ANDROID, IS_APPLE, IS_MOBILE, IS_SAFARI} from '../../environment/userAgent';\r\nimport I18n, {FormatterArguments, i18n, langPack, LangPackKey, UNSUPPORTED_LANG_PACK_KEY, _i18n} from '../../lib/langPack';\r\nimport AvatarElement from '../avatar';\r\nimport ripple from '../ripple';\r\nimport {wrapAlbum, wrapPhoto, wrapVideo, wrapDocument, wrapSticker, wrapPoll, wrapGroupedDocuments} from '../wrappers';\r\nimport {MessageRender} from './messageRender';\r\nimport LazyLoadQueue from '../lazyLoadQueue';\r\nimport ListenerSetter from '../../helpers/listenerSetter';\r\nimport PollElement from '../poll';\r\nimport AudioElement from '../audio';\r\nimport {ChatInvite, Document, Message, MessageEntity,  MessageMedia,  MessageReplyHeader, Photo, PhotoSize, ReactionCount, ReplyMarkup, SponsoredMessage, Update, User, WebPage} from '../../layer';\r\nimport {BOT_START_PARAM, NULL_PEER_ID, REPLIES_PEER_ID} from '../../lib/mtproto/mtproto_config';\r\nimport {FocusDirection, ScrollStartCallbackDimensions} from '../../helpers/fastSmoothScroll';\r\nimport useHeavyAnimationCheck, {getHeavyAnimationPromise, dispatchHeavyAnimationEvent, interruptHeavyAnimation} from '../../hooks/useHeavyAnimationCheck';\r\nimport {fastRaf, fastRafPromise} from '../../helpers/schedulers';\r\nimport deferredPromise from '../../helpers/cancellablePromise';\r\nimport RepliesElement from './replies';\r\nimport DEBUG from '../../config/debug';\r\nimport {SliceEnd} from '../../helpers/slicedArray';\r\nimport PeerTitle from '../peerTitle';\r\nimport findUpClassName from '../../helpers/dom/findUpClassName';\r\nimport findUpTag from '../../helpers/dom/findUpTag';\r\nimport {toast, toastNew} from '../toast';\r\nimport {getElementByPoint} from '../../helpers/dom/getElementByPoint';\r\nimport {getMiddleware} from '../../helpers/middleware';\r\nimport cancelEvent from '../../helpers/dom/cancelEvent';\r\nimport {attachClickEvent, simulateClickEvent} from '../../helpers/dom/clickEvent';\r\nimport htmlToDocumentFragment from '../../helpers/dom/htmlToDocumentFragment';\r\nimport reflowScrollableElement from '../../helpers/dom/reflowScrollableElement';\r\nimport replaceContent from '../../helpers/dom/replaceContent';\r\nimport setInnerHTML from '../../helpers/dom/setInnerHTML';\r\nimport whichChild from '../../helpers/dom/whichChild';\r\nimport {cancelAnimationByKey} from '../../helpers/animation';\r\nimport assumeType from '../../helpers/assumeType';\r\nimport debounce, {DebounceReturnType} from '../../helpers/schedulers/debounce';\r\nimport {SEND_WHEN_ONLINE_TIMESTAMP} from '../../lib/mtproto/constants';\r\nimport windowSize from '../../helpers/windowSize';\r\nimport {formatPhoneNumber} from '../../helpers/formatPhoneNumber';\r\nimport AppMediaViewer from '../appMediaViewer';\r\nimport SetTransition from '../singleTransition';\r\nimport handleHorizontalSwipe from '../../helpers/dom/handleHorizontalSwipe';\r\nimport findUpAttribute from '../../helpers/dom/findUpAttribute';\r\nimport findUpAsChild from '../../helpers/dom/findUpAsChild';\r\nimport formatCallDuration from '../../helpers/formatCallDuration';\r\nimport IS_CALL_SUPPORTED from '../../environment/callSupport';\r\nimport Button from '../button';\r\nimport {CallType} from '../../lib/calls/types';\r\nimport getVisibleRect from '../../helpers/dom/getVisibleRect';\r\nimport PopupJoinChatInvite from '../popups/joinChatInvite';\r\nimport {InternalLink, INTERNAL_LINK_TYPE} from '../../lib/appManagers/internalLink';\r\nimport ReactionsElement, {REACTIONS_ELEMENTS} from './reactions';\r\nimport type ReactionElement from './reaction';\r\nimport RLottiePlayer from '../../lib/rlottie/rlottiePlayer';\r\nimport pause from '../../helpers/schedulers/pause';\r\nimport ScrollSaver from '../../helpers/scrollSaver';\r\nimport getObjectKeysAndSort from '../../helpers/object/getObjectKeysAndSort';\r\nimport forEachReverse from '../../helpers/array/forEachReverse';\r\nimport formatNumber from '../../helpers/number/formatNumber';\r\nimport getViewportSlice from '../../helpers/dom/getViewportSlice';\r\nimport SuperIntersectionObserver from '../../helpers/dom/superIntersectionObserver';\r\nimport generateFakeIcon from '../generateFakeIcon';\r\nimport copyFromElement from '../../helpers/dom/copyFromElement';\r\nimport PopupElement from '../popups';\r\nimport setAttachmentSize from '../../helpers/setAttachmentSize';\r\nimport wrapWebPageDescription from '../wrappers/webPageDescription';\r\nimport wrapWebPageTitle from '../wrappers/webPageTitle';\r\nimport wrapEmojiText from '../../lib/richTextProcessor/wrapEmojiText';\r\nimport wrapRichText from '../../lib/richTextProcessor/wrapRichText';\r\nimport wrapMessageActionTextNew from '../wrappers/messageActionTextNew';\r\nimport isMentionUnread from '../../lib/appManagers/utils/messages/isMentionUnread';\r\nimport getMediaFromMessage from '../../lib/appManagers/utils/messages/getMediaFromMessage';\r\nimport getPeerColorById from '../../lib/appManagers/utils/peers/getPeerColorById';\r\nimport getPeerId from '../../lib/appManagers/utils/peers/getPeerId';\r\nimport getServerMessageId from '../../lib/appManagers/utils/messageId/getServerMessageId';\r\nimport generateMessageId from '../../lib/appManagers/utils/messageId/generateMessageId';\r\nimport {AppManagers} from '../../lib/appManagers/managers';\r\nimport {Awaited} from '../../types';\r\nimport idleController from '../../helpers/idleController';\r\nimport overlayCounter from '../../helpers/overlayCounter';\r\nimport {cancelContextMenuOpening} from '../../helpers/dom/attachContextMenuListener';\r\nimport contextMenuController from '../../helpers/contextMenuController';\r\nimport {AckedResult} from '../../lib/mtproto/superMessagePort';\r\nimport middlewarePromise from '../../helpers/middlewarePromise';\r\nimport {EmoticonsDropdown} from '../emoticonsDropdown';\r\nimport indexOfAndSplice from '../../helpers/array/indexOfAndSplice';\r\nimport noop from '../../helpers/noop';\r\nimport getAlbumText from '../../lib/appManagers/utils/messages/getAlbumText';\r\nimport paymentsWrapCurrencyAmount from '../../helpers/paymentsWrapCurrencyAmount';\r\nimport PopupPayment from '../popups/payment';\r\nimport isInDOM from '../../helpers/dom/isInDOM';\r\nimport getStickerEffectThumb from '../../lib/appManagers/utils/stickers/getStickerEffectThumb';\r\nimport attachStickerViewerListeners from '../stickerViewer';\r\nimport {makeMediaSize, MediaSize} from '../../helpers/mediaSize';\r\n\r\nconst USE_MEDIA_TAILS = false;\r\nconst IGNORE_ACTIONS: Set<Message.messageService['action']['_']> = new Set([\r\n  'messageActionHistoryClear',\r\n  'messageActionChatCreate'/* ,\r\n  'messageActionChannelMigrateFrom' */\r\n]);\r\n\r\nexport const SERVICE_AS_REGULAR: Set<Message.messageService['action']['_']> = new Set();\r\n\r\nif(IS_CALL_SUPPORTED) {\r\n  SERVICE_AS_REGULAR.add('messageActionPhoneCall');\r\n}\r\n\r\nconst TEST_SCROLL_TIMES: number = undefined;\r\nlet TEST_SCROLL = TEST_SCROLL_TIMES;\r\n\r\nlet queueId = 0;\r\n\r\ntype GenerateLocalMessageType<IsService> = IsService extends true ? Message.messageService : Message.message;\r\n\r\nconst SPONSORED_MESSAGE_ID_OFFSET = 1;\r\nexport const STICKY_OFFSET = 3;\r\nconst SCROLLED_DOWN_THRESHOLD = 300;\r\nconst PEER_CHANGED_ERROR = new Error('peer changed');\r\n\r\nconst DO_NOT_SLICE_VIEWPORT = false;\r\nconst DO_NOT_SLICE_VIEWPORT_ON_RENDER = false;\r\nconst DO_NOT_UPDATE_MESSAGE_VIEWS = false;\r\nconst DO_NOT_UPDATE_MESSAGE_REACTIONS = false;\r\nconst DO_NOT_UPDATE_MESSAGE_REPLY = false;\r\n\r\ntype Bubble = {\r\n  bubble: HTMLElement,\r\n  mids: Set<number>,\r\n  groupedId?: string\r\n};\r\n\r\ntype MyHistoryResult = HistoryResult | {history: number[]};\r\n\r\nfunction getMainMidForGrouped(mids: number[]) {\r\n  return Math.max(...mids);\r\n}\r\n\r\nexport default class ChatBubbles {\r\n  public container: HTMLDivElement;\r\n  public chatInner: HTMLDivElement;\r\n  public scrollable: Scrollable;\r\n\r\n  private getHistoryTopPromise: Promise<boolean>;\r\n  private getHistoryBottomPromise: Promise<boolean>;\r\n\r\n  // public messagesCount: number = -1;\r\n\r\n  private unreadOut = new Set<number>();\r\n  public needUpdate: {replyToPeerId: PeerId, replyMid: number, mid: number}[] = []; // if need wrapSingleMessage\r\n\r\n  public bubbles: {[mid: string]: HTMLElement} = {};\r\n  public skippedMids: Set<number> = new Set();\r\n  public bubblesNewByGroupedId: {[groupId: string]: Bubble} = {};\r\n  public bubblesNew: {[mid: string]: Bubble} = {};\r\n  private dateMessages: {[timestamp: number]: {\r\n    div: HTMLElement,\r\n    firstTimestamp: number,\r\n    container: HTMLElement,\r\n    timeout?: number\r\n  }} = {};\r\n\r\n  private scrolledDown = true;\r\n  private isScrollingTimeout = 0;\r\n\r\n  private stickyIntersector: StickyIntersector;\r\n\r\n  private unreaded: Map<HTMLElement, number> = new Map();\r\n  private unreadedSeen: Set<number> = new Set();\r\n  private readPromise: Promise<void>;\r\n\r\n  private bubbleGroups: BubbleGroups;\r\n\r\n  private preloader: ProgressivePreloader = null;\r\n\r\n  public messagesQueuePromise: Promise<void> = null;\r\n  private messagesQueue: ReturnType<ChatBubbles['safeRenderMessage']>[] = [];\r\n  // private messagesQueueOnRender: () => void = null;\r\n  private messagesQueueOnRenderAdditional: () => void = null;\r\n\r\n  private firstUnreadBubble: HTMLElement = null;\r\n  private attachedUnreadBubble: boolean;\r\n\r\n  public lazyLoadQueue: LazyLoadQueue;\r\n\r\n  private middleware = getMiddleware();\r\n\r\n  private log: ReturnType<typeof logger>;\r\n\r\n  public listenerSetter: ListenerSetter;\r\n\r\n  private replyFollowHistory: number[] = [];\r\n\r\n  private isHeavyAnimationInProgress = false;\r\n  private scrollingToBubble: HTMLElement;\r\n\r\n  private isFirstLoad = true;\r\n  private needReflowScroll: boolean;\r\n\r\n  private fetchNewPromise: Promise<void>;\r\n\r\n  private passEntities: Partial<{\r\n    [_ in MessageEntity['_']]: boolean\r\n  }> = {};\r\n\r\n  private onAnimateLadder: () => Promise<any> | void;\r\n  // private ladderDeferred: CancellablePromise<void>;\r\n  private resolveLadderAnimation: () => Promise<any>;\r\n  private emptyPlaceholderBubble: HTMLElement;\r\n\r\n  private viewsMids: Set<number> = new Set();\r\n  private sendViewCountersDebounced: () => Promise<void>;\r\n\r\n  private isTopPaddingSet = false;\r\n\r\n  private getSponsoredMessagePromise: Promise<void>;\r\n\r\n  private previousStickyDate: HTMLElement;\r\n  private sponsoredMessage: SponsoredMessage.sponsoredMessage;\r\n\r\n  private hoverBubble: HTMLElement;\r\n  private hoverReaction: HTMLElement;\r\n  private sliceViewportDebounced: DebounceReturnType<ChatBubbles['sliceViewport']>;\r\n  private resizeObserver: ResizeObserver;\r\n  private willScrollOnLoad: boolean;\r\n  private observer: SuperIntersectionObserver;\r\n\r\n  private renderingMessages: Set<number> = new Set();\r\n  private setPeerCached: boolean;\r\n  private attachPlaceholderOnRender: () => void;\r\n\r\n  private bubblesToEject: Set<HTMLElement> = new Set();\r\n  private bubblesToReplace: Map<HTMLElement, HTMLElement> = new Map(); // TO -> FROM\r\n  private updatePlaceholderPosition: () => void;\r\n  private setPeerOptions: {lastMsgId: number; topMessage: number;};\r\n\r\n  private setPeerTempId: number = 0;\r\n\r\n  private renderNewPromises: Set<Promise<any>> = new Set();\r\n\r\n  // private reactions: Map<number, ReactionsElement>;\r\n\r\n  constructor(\r\n    private chat: Chat,\r\n    private managers: AppManagers\r\n  ) {\r\n    this.log = this.chat.log;\r\n    // this.chat.log.error('Bubbles construction');\r\n\r\n    this.listenerSetter = new ListenerSetter();\r\n\r\n    this.constructBubbles();\r\n\r\n    // * constructor end\r\n\r\n    this.bubbleGroups = new BubbleGroups(this.chat);\r\n    this.preloader = new ProgressivePreloader({\r\n      cancelable: false\r\n    });\r\n    this.lazyLoadQueue = new LazyLoadQueue();\r\n    this.lazyLoadQueue.queueId = ++queueId;\r\n\r\n    // this.reactions = new Map();\r\n\r\n    // * events\r\n\r\n    // will call when sent for update pos\r\n    this.listenerSetter.add(rootScope)('history_update', async({storageKey, sequential, message}) => {\r\n      if(this.chat.messagesStorageKey !== storageKey || this.chat.type === 'scheduled') {\r\n        return;\r\n      }\r\n\r\n      const {mid} = message;\r\n      const log = false ? this.log.bindPrefix('history_update-' + mid) : undefined;\r\n      log && log('start');\r\n\r\n      const bubble = this.bubbles[mid];\r\n      if(!bubble) return;\r\n\r\n      if(this.renderNewPromises.size) {\r\n        log && log.error('will await new messages render');\r\n        await Promise.all(Array.from(this.renderNewPromises));\r\n      }\r\n\r\n      if(this.messagesQueuePromise) {\r\n        log && log.error('messages render in process');\r\n        await this.messagesQueuePromise;\r\n      }\r\n\r\n      if(this.bubbles[mid] !== bubble) return;\r\n\r\n      // await getHeavyAnimationPromise();\r\n\r\n      const item = this.bubbleGroups.getItemByBubble(bubble);\r\n      if(!item) { // probably a group item\r\n        log && log.error('no item by bubble', bubble);\r\n        return;\r\n      } else if(item.mid === mid) {\r\n        log && log.warn('wow what', item, mid);\r\n        return;\r\n      }\r\n\r\n      if(sequential) {\r\n        const group = item.group;\r\n        const newItem = this.bubbleGroups.createItem(bubble, message);\r\n        // newItem.mid = item.mid;\r\n        const _items = this.bubbleGroups.itemsArr.slice();\r\n        indexOfAndSplice(_items, item);\r\n        const foundItem = this.bubbleGroups.findGroupSiblingByItem(newItem, _items);\r\n        if(\r\n          group === foundItem?.group ||\r\n          (group === this.bubbleGroups.getLastGroup() && group.items.length === 1 && newItem.dateTimestamp === item.dateTimestamp) ||\r\n          (this.peerId === rootScope.myId && sequential && newItem.dateTimestamp === item.dateTimestamp)\r\n        ) {\r\n          log && log('item has correct position', item);\r\n          this.bubbleGroups.changeBubbleMid(bubble, mid);\r\n          return;\r\n        }\r\n      }\r\n\r\n      // return;\r\n\r\n      // await fastRafPromise();\r\n      // if(this.bubbles[mid] !== bubble) return;\r\n\r\n      // const groupIndex = this.bubbleGroups.groups.indexOf(group);\r\n      this.bubbleGroups.removeAndUnmountBubble(bubble);\r\n      // if(!group.items.length) { // group has collapsed, next message can have higher mid so have to reposition them too\r\n      //   log && log('group has collapsed', item);\r\n\r\n      //   const siblingGroups = this.bubbleGroups.groups.slice(0, groupIndex + 1);\r\n      //   for(let length = siblingGroups.length, i = length - 2; i >= 0; --i) {\r\n      //     const siblingGroup = siblingGroups[i];\r\n      //     const siblingItems = siblingGroup.items;\r\n      //     const nextGroup = siblingGroups[i + 1];\r\n      //     const nextItems = nextGroup.items;\r\n\r\n      //     let _break = false, moved = false;\r\n      //     for(let j = siblingItems.length - 1; j >= 0; --j) {\r\n      //       const siblingItem = siblingItems[j];\r\n      //       const foundItem = this.bubbleGroups.findGroupSiblingByItem(siblingItem, nextItems);\r\n      //       if(!foundItem) {\r\n      //         _break = true;\r\n      //         break;\r\n      //       }\r\n\r\n      //       log('will move item', siblingItem, nextGroup);\r\n      //       this.bubbleGroups.removeAndUnmountBubble(siblingItem.bubble);\r\n      //       this.bubbleGroups.addItemToGroup(siblingItem, nextGroup);\r\n      //       moved = true;\r\n      //     }\r\n\r\n      //     if(moved) {\r\n      //       nextGroup.mount();\r\n      //     }\r\n\r\n      //     if(_break) {\r\n      //       break;\r\n      //     }\r\n      //   }\r\n      // }\r\n\r\n      const {groups} = this.groupBubbles([{bubble, message}]);\r\n      this.bubbleGroups.mountUnmountGroups(groups);\r\n\r\n      if(this.scrollingToBubble) {\r\n        this.scrollToEnd();\r\n      }\r\n\r\n      log && log('end');\r\n\r\n      // this.bubbleGroups.findIncorrentPositions();\r\n    });\r\n\r\n    this.listenerSetter.add(rootScope)('dialog_flush', ({peerId}) => {\r\n      if(this.peerId === peerId) {\r\n        this.deleteMessagesByIds(Object.keys(this.bubbles).map((m) => +m));\r\n      }\r\n    });\r\n\r\n    // Calls when message successfully sent and we have an id\r\n    this.listenerSetter.add(rootScope)('message_sent', async(e) => {\r\n      const {storageKey, tempId, tempMessage, mid, message} = e;\r\n\r\n      // ! can't use peerId to validate here, because id can be the same in 'scheduled' and 'chat' types\r\n      if(this.chat.messagesStorageKey !== storageKey) {\r\n        return;\r\n      }\r\n\r\n      const bubbles = this.bubbles;\r\n      const _bubble = bubbles[tempId];\r\n      if(_bubble) {\r\n        const bubble = bubbles[tempId];\r\n        bubbles[mid] = bubble;\r\n        bubble.dataset.mid = '' + mid;\r\n        delete bubbles[tempId];\r\n\r\n        fastRaf(() => {\r\n          const mid = +bubble.dataset.mid;\r\n          if(bubbles[mid] === bubble && bubble.classList.contains('is-outgoing')) {\r\n            bubble.classList.remove('is-sending', 'is-outgoing');\r\n            bubble.classList.add((this.peerId === rootScope.myId && this.chat.type !== 'scheduled') || !this.unreadOut.has(mid) ? 'is-read' : 'is-sent');\r\n          }\r\n        });\r\n      }\r\n\r\n      if(this.unreadOut.has(tempId)) {\r\n        this.unreadOut.delete(tempId);\r\n        this.unreadOut.add(mid);\r\n      }\r\n\r\n      // * check timing of scheduled message\r\n      if(this.chat.type === 'scheduled') {\r\n        const timestamp = Date.now() / 1000 | 0;\r\n        const maxTimestamp = tempMessage.date - 10;\r\n        if(timestamp >= maxTimestamp) {\r\n          this.deleteMessagesByIds([mid]);\r\n        }\r\n      }\r\n\r\n      if(!_bubble) {\r\n        return;\r\n      }\r\n\r\n      let messages: (Message.message | Message.messageService)[], tempIds: number[];\r\n      const groupedId = (message as Message.message).grouped_id;\r\n      if(groupedId) {\r\n        messages = await this.managers.appMessagesManager.getMessagesByAlbum(groupedId);\r\n        const mids = messages.map(({mid}) => mid);\r\n        if(!mids.length || getMainMidForGrouped(mids) !== mid || bubbles[mid] !== _bubble) {\r\n          return;\r\n        }\r\n\r\n        if(bubbles[mid] !== _bubble) {\r\n          return;\r\n        }\r\n\r\n        tempIds = (Array.from(_bubble.querySelectorAll('.grouped-item')) as HTMLElement[]).map((el) => +el.dataset.mid);\r\n      } else {\r\n        messages = [message];\r\n        tempIds = [tempId];\r\n      }\r\n\r\n      const reactionsElements = Array.from(_bubble.querySelectorAll('reactions-element')) as ReactionsElement[];\r\n      if(reactionsElements.length) {\r\n        reactionsElements.forEach((reactionsElement) => {\r\n          reactionsElement.changeMessage(message as Message.message);\r\n        });\r\n      }\r\n\r\n      (messages as Message.message[]).forEach((message, idx) => {\r\n        if(!message) {\r\n          return;\r\n        }\r\n\r\n        const tempId = tempIds[idx];\r\n        const mid = message.mid;\r\n        const bubble: HTMLElement = _bubble.querySelector(`.document-container[data-mid=\"${mid}\"]`) || _bubble;\r\n\r\n        if(message._ !== 'message') {\r\n          return;\r\n        }\r\n\r\n        if(message.replies) {\r\n          const repliesElement = _bubble.querySelector('replies-element') as RepliesElement;\r\n          if(repliesElement) {\r\n            repliesElement.message = message;\r\n            repliesElement.init();\r\n          }\r\n        }\r\n\r\n        const media = message.media ?? {} as MessageMedia.messageMediaEmpty;\r\n        const doc = (media as MessageMedia.messageMediaDocument).document as Document.document;\r\n        const poll = (media as MessageMedia.messageMediaPoll).poll;\r\n        const webPage = (media as MessageMedia.messageMediaWebPage).webpage as WebPage.webPage;\r\n        if(doc) {\r\n          const div = bubble.querySelector(`.document-container[data-mid=\"${tempId}\"] .document`);\r\n          if(div) {\r\n            const container = findUpClassName(div, 'document-container');\r\n\r\n            if(!tempMessage.media?.document?.thumbs?.length && doc.thumbs?.length) {\r\n              getHeavyAnimationPromise().then(async() => {\r\n                const timeSpan = div.querySelector('.time');\r\n                const newDiv = await wrapDocument({message});\r\n                div.replaceWith(newDiv);\r\n\r\n                if(timeSpan) {\r\n                  newDiv.querySelector('.document').append(timeSpan);\r\n                }\r\n              });\r\n            }\r\n\r\n            if(container) {\r\n              container.dataset.mid = '' + mid;\r\n            }\r\n          }\r\n\r\n          const element = bubble.querySelector(`audio-element[data-mid=\"${tempId}\"], .document[data-doc-id=\"${tempId}\"], .media-round[data-mid=\"${tempId}\"]`) as HTMLElement;\r\n          if(element) {\r\n            if(element instanceof AudioElement || element.classList.contains('media-round')) {\r\n              element.dataset.mid = '' + message.mid;\r\n              delete element.dataset.isOutgoing;\r\n              (element as any).message = message;\r\n              (element as any).onLoad(true);\r\n            } else {\r\n              element.dataset.docId = '' + doc.id;\r\n              (element as any).doc = doc;\r\n            }\r\n          }\r\n        } else if(poll) {\r\n          const pollElement = bubble.querySelector('poll-element') as PollElement;\r\n          if(pollElement) {\r\n            pollElement.message = message;\r\n            pollElement.setAttribute('poll-id', '' + poll.id);\r\n            pollElement.setAttribute('message-id', '' + mid);\r\n          }\r\n        } else if(webPage && !bubble.querySelector('.web')) {\r\n          getHeavyAnimationPromise().then(() => {\r\n            this.safeRenderMessage(message, true, bubble);\r\n            this.scrollToBubbleIfLast(bubble);\r\n          });\r\n        }\r\n\r\n        // set new mids to album items for mediaViewer\r\n        if(groupedId) {\r\n          const item = (bubble.querySelector(`.grouped-item[data-mid=\"${tempId}\"]`) as HTMLElement) || bubble; // * it can be .document-container\r\n          if(item) {\r\n            item.dataset.mid = '' + mid;\r\n          }\r\n        }\r\n      });\r\n    });\r\n\r\n    this.listenerSetter.add(rootScope)('message_edit', async({storageKey, message}) => {\r\n      if(storageKey !== this.chat.messagesStorageKey) return;\r\n\r\n      const bubble = this.bubbles[message.mid];\r\n      if(!bubble) return;\r\n\r\n      await getHeavyAnimationPromise();\r\n      if(this.bubbles[message.mid] !== bubble) return;\r\n\r\n      this.safeRenderMessage(message, true, bubble);\r\n    });\r\n\r\n    this.listenerSetter.add(rootScope)('message_error', async({storageKey, tempId}) => {\r\n      if(storageKey !== this.chat.messagesStorageKey) return;\r\n\r\n      const bubble = this.bubbles[tempId];\r\n      if(!bubble) return;\r\n\r\n      await getHeavyAnimationPromise();\r\n      if(this.bubbles[tempId] !== bubble) return;\r\n\r\n      bubble.classList.remove('is-outgoing');\r\n      bubble.classList.add('is-error');\r\n    });\r\n\r\n    this.listenerSetter.add(rootScope)('album_edit', ({peerId, messages, deletedMids}) => {\r\n      if(peerId !== this.peerId) return;\r\n\r\n      const mids = messages.map(({mid}) => mid);\r\n      const oldMids = mids.concat(Array.from(deletedMids));\r\n      const wasMainMid = getMainMidForGrouped(oldMids);\r\n      const bubble = this.bubbles[wasMainMid];\r\n      if(!bubble) {\r\n        return;\r\n      }\r\n\r\n      const mainMid = getMainMidForGrouped(mids);\r\n      const message = messages.find((message) => message.mid === mainMid);\r\n      this.safeRenderMessage(message, true, bubble);\r\n    });\r\n\r\n    this.listenerSetter.add(rootScope)('peer_title_edit', async(peerId) => {\r\n      if(peerId.isUser()) {\r\n        const middleware = this.getMiddleware();\r\n        const user = await this.managers.appUsersManager.getUser(peerId.toUserId());\r\n        if(!middleware()) return;\r\n\r\n        const isPremium = user?.pFlags?.premium;\r\n        const groups = this.bubbleGroups.groups.filter((group) => group.avatar?.peerId === peerId);\r\n        groups.forEach((group) => {\r\n          group.avatar.classList.toggle('is-premium', isPremium);\r\n          group.avatar.classList.toggle('tgico-star', isPremium);\r\n        });\r\n      }\r\n    });\r\n\r\n    if(this.chat.type !== 'scheduled' && !DO_NOT_UPDATE_MESSAGE_REACTIONS/*  && false */) {\r\n      this.listenerSetter.add(rootScope)('messages_reactions', async(arr) => {\r\n        let scrollSaver: ScrollSaver;\r\n\r\n        const a = arr.map(async({message, changedResults}) => {\r\n          if(this.peerId !== message.peerId) {\r\n            return;\r\n          }\r\n\r\n          const result = await this.getMountedBubble(message.mid, message);\r\n          if(!result) {\r\n            return;\r\n          }\r\n\r\n          return {bubble: result.bubble, message, changedResults};\r\n        });\r\n\r\n        let top: number;\r\n        (await Promise.all(a)).filter(Boolean).forEach(({bubble, message, changedResults}) => {\r\n          if(!scrollSaver) {\r\n            scrollSaver = this.createScrollSaver(false);\r\n            scrollSaver.save();\r\n          }\r\n\r\n          const key = message.peerId + '_' + message.mid;\r\n          const set = REACTIONS_ELEMENTS.get(key);\r\n          if(set) {\r\n            for(const element of set) {\r\n              element.update(message, changedResults);\r\n            }\r\n          } else if(!message.reactions || !message.reactions.results.length) {\r\n            return;\r\n          } else {\r\n            this.appendReactionsElementToBubble(bubble, message, message, changedResults);\r\n          }\r\n        });\r\n\r\n        if(scrollSaver) {\r\n          scrollSaver.restore();\r\n        }\r\n      });\r\n    }\r\n\r\n    !DO_NOT_UPDATE_MESSAGE_REPLY && this.listenerSetter.add(rootScope)('messages_downloaded', async({peerId, mids}) => {\r\n      const middleware = this.getMiddleware();\r\n      await getHeavyAnimationPromise();\r\n      if(!middleware()) return;\r\n\r\n      (mids as number[]).forEach((mid) => {\r\n        const needUpdate = this.needUpdate;\r\n        const filtered: typeof needUpdate[0][] = [];\r\n        forEachReverse(this.needUpdate, (obj, idx) => {\r\n          if(obj.replyMid === mid && obj.replyToPeerId === peerId) {\r\n            this.needUpdate.splice(idx, 1)[0];\r\n            filtered.push(obj);\r\n          }\r\n        });\r\n\r\n        filtered.forEach(async({mid, replyMid, replyToPeerId}) => {\r\n          const bubble = this.bubbles[mid];\r\n          if(!bubble) return;\r\n\r\n          const message = (await this.chat.getMessage(mid)) as Message.message;\r\n\r\n          MessageRender.setReply({\r\n            chat: this.chat,\r\n            bubble,\r\n            message\r\n          });\r\n        });\r\n      });\r\n    });\r\n\r\n    attachStickerViewerListeners({listenTo: this.scrollable.container, listenerSetter: this.listenerSetter, selector: '.attachment.media-sticker-wrapper'});\r\n    attachClickEvent(this.scrollable.container, this.onBubblesClick, {listenerSetter: this.listenerSetter});\r\n    // this.listenerSetter.add(this.bubblesContainer)('click', this.onBubblesClick/* , {capture: true, passive: false} */);\r\n\r\n    this.listenerSetter.add(this.scrollable.container)('mousedown', (e) => {\r\n      if(e.button !== 0) return;\r\n\r\n      const code: HTMLElement = findUpTag(e.target, 'CODE');\r\n      if(code) {\r\n        cancelEvent(e);\r\n        copyFromElement(code);\r\n        toastNew({langPackKey: 'TextCopied'});\r\n        return;\r\n      }\r\n    });\r\n\r\n    /* if(false)  */this.stickyIntersector = new StickyIntersector(this.scrollable.container, (stuck, target) => {\r\n      for(const timestamp in this.dateMessages) {\r\n        const dateMessage = this.dateMessages[timestamp];\r\n        if(dateMessage.container === target) {\r\n          const dateBubble = dateMessage.div;\r\n\r\n          // dateMessage.container.classList.add('has-sticky-dates');\r\n\r\n          // SetTransition(dateBubble, 'kek', stuck, this.previousStickyDate ? 300 : 0);\r\n          // if(this.previousStickyDate) {\r\n          // dateBubble.classList.add('kek');\r\n          // }\r\n\r\n          dateBubble.classList.toggle('is-sticky', stuck);\r\n          if(stuck) {\r\n            this.previousStickyDate = dateBubble;\r\n          }\r\n\r\n          break;\r\n        }\r\n      }\r\n\r\n      if(this.previousStickyDate) {\r\n        // fastRaf(() => {\r\n        // this.bubblesContainer.classList.add('has-sticky-dates');\r\n        // });\r\n      }\r\n    });\r\n\r\n    if(!IS_SAFARI) {\r\n      this.sliceViewportDebounced = debounce(this.sliceViewport.bind(this), 3000, false, true);\r\n    }\r\n\r\n    let middleware: ReturnType<ChatBubbles['getMiddleware']>;\r\n    useHeavyAnimationCheck(() => {\r\n      this.isHeavyAnimationInProgress = true;\r\n      this.lazyLoadQueue.lock();\r\n      middleware = this.getMiddleware();\r\n\r\n      // if(this.sliceViewportDebounced) {\r\n      //   this.sliceViewportDebounced.clearTimeout();\r\n      // }\r\n    }, () => {\r\n      this.isHeavyAnimationInProgress = false;\r\n\r\n      if(middleware && middleware()) {\r\n        this.lazyLoadQueue.unlock();\r\n        this.lazyLoadQueue.refresh();\r\n\r\n        // if(this.sliceViewportDebounced) {\r\n        //   this.sliceViewportDebounced();\r\n        // }\r\n      }\r\n\r\n      middleware = null;\r\n    }, this.listenerSetter);\r\n  }\r\n\r\n  private constructBubbles() {\r\n    const container = this.container = document.createElement('div');\r\n    container.classList.add('bubbles', 'scrolled-down');\r\n\r\n    const chatInner = this.chatInner = document.createElement('div');\r\n    chatInner.classList.add('bubbles-inner');\r\n\r\n    this.setScroll();\r\n\r\n    container.append(this.scrollable.container);\r\n  }\r\n\r\n  public attachContainerListeners() {\r\n    const container = this.container;\r\n\r\n    this.chat.contextMenu.attachTo(container);\r\n    this.chat.selection.attachListeners(container, new ListenerSetter());\r\n\r\n    if(DEBUG) {\r\n      this.listenerSetter.add(container)('dblclick', async(e) => {\r\n        const bubble = findUpClassName(e.target, 'grouped-item') || findUpClassName(e.target, 'bubble');\r\n        if(bubble) {\r\n          const mid = +bubble.dataset.mid\r\n          this.log('debug message:', await this.chat.getMessage(mid));\r\n          this.highlightBubble(bubble);\r\n        }\r\n      });\r\n    }\r\n\r\n    if(this.chat.type !== 'pinned' && this.chat.type !== 'scheduled') {\r\n      if(!IS_MOBILE) {\r\n        this.listenerSetter.add(container)('dblclick', async(e) => {\r\n          if(this.chat.selection.isSelecting ||\r\n            !(await this.chat.canSend())) {\r\n            return;\r\n          }\r\n\r\n          const target = e.target as HTMLElement;\r\n          const bubble = target.classList.contains('bubble') ?\r\n            target :\r\n            (target.classList.contains('document-selection') ? target.parentElement : null);\r\n          if(bubble && !bubble.classList.contains('bubble-first')) {\r\n            const mid = +bubble.dataset.mid;\r\n            const message = await this.chat.getMessage(mid);\r\n            if(message.pFlags.is_outgoing) {\r\n              return;\r\n            }\r\n\r\n            this.chat.input.initMessageReply(mid);\r\n          }\r\n        });\r\n      } else if(IS_TOUCH_SUPPORTED) {\r\n        const className = 'is-gesturing-reply';\r\n        const MAX = 64;\r\n        const replyAfter = MAX * .75;\r\n        let shouldReply = false;\r\n        let target: HTMLElement;\r\n        let icon: HTMLElement;\r\n        handleHorizontalSwipe({\r\n          element: container,\r\n          verifyTouchTarget: async(e) => {\r\n            if(this.chat.selection.isSelecting || !(await this.chat.canSend())) {\r\n              return false;\r\n            }\r\n\r\n            // cancelEvent(e);\r\n            target = findUpClassName(e.target, 'bubble');\r\n            if(target) {\r\n              SetTransition(target, className, true, 250);\r\n              void target.offsetLeft; // reflow\r\n\r\n              if(!icon) {\r\n                icon = document.createElement('span');\r\n                icon.classList.add('tgico-reply_filled', 'bubble-gesture-reply-icon');\r\n              } else {\r\n                icon.classList.remove('is-visible');\r\n                icon.style.opacity = '';\r\n              }\r\n\r\n              target/* .querySelector('.bubble-content') */.append(icon);\r\n            }\r\n\r\n            return !!target;\r\n          },\r\n          onSwipe: (xDiff, yDiff) => {\r\n            shouldReply = xDiff >= replyAfter;\r\n\r\n            if(shouldReply && !icon.classList.contains('is-visible')) {\r\n              icon.classList.add('is-visible');\r\n            }\r\n            icon.style.opacity = '' + Math.min(1, xDiff / replyAfter);\r\n\r\n            const x = -Math.max(0, Math.min(MAX, xDiff));\r\n            target.style.transform = `translateX(${x}px)`;\r\n            cancelContextMenuOpening();\r\n          },\r\n          onReset: () => {\r\n            const _target = target;\r\n            SetTransition(_target, className, false, 250, () => {\r\n              if(icon.parentElement === _target) {\r\n                icon.classList.remove('is-visible');\r\n                icon.remove();\r\n              }\r\n            });\r\n\r\n            fastRaf(() => {\r\n              _target.style.transform = ``;\r\n\r\n              if(shouldReply) {\r\n                const {mid} = _target.dataset;\r\n                this.chat.input.initMessageReply(+mid);\r\n                shouldReply = false;\r\n              }\r\n            });\r\n          },\r\n          listenerOptions: {capture: true}\r\n        });\r\n      }\r\n    }\r\n  }\r\n\r\n  public constructPeerHelpers() {\r\n    // will call when message is sent (only 1)\r\n    this.listenerSetter.add(rootScope)('history_append', async({storageKey, message}) => {\r\n      if(storageKey !== this.chat.messagesStorageKey) return;\r\n\r\n      if(!this.scrollable.loadedAll.bottom) {\r\n        this.chat.setMessageId();\r\n      } else {\r\n        this.renderNewMessage(message, true);\r\n      }\r\n\r\n      if(rootScope.settings.animationsEnabled) {\r\n        const gradientRenderer = this.chat.gradientRenderer;\r\n        if(gradientRenderer) {\r\n          gradientRenderer.toNextPosition();\r\n        }\r\n      }\r\n    });\r\n\r\n    this.listenerSetter.add(rootScope)('history_multiappend', (message) => {\r\n      if(this.peerId !== message.peerId) return;\r\n      this.renderNewMessage(message);\r\n    });\r\n\r\n    this.listenerSetter.add(rootScope)('history_delete', ({peerId, msgs}) => {\r\n      if(peerId === this.peerId) {\r\n        this.deleteMessagesByIds(Array.from(msgs));\r\n      }\r\n    });\r\n\r\n    this.listenerSetter.add(rootScope)('dialog_unread', ({peerId}) => {\r\n      if(peerId === this.peerId) {\r\n        this.chat.input.setUnreadCount();\r\n\r\n        getHeavyAnimationPromise().then(() => {\r\n          this.updateUnreadByDialog();\r\n        });\r\n      }\r\n    });\r\n\r\n    this.listenerSetter.add(rootScope)('dialogs_multiupdate', (dialogs) => {\r\n      if(dialogs.has(this.peerId)) {\r\n        this.chat.input.setUnreadCount();\r\n      }\r\n    });\r\n\r\n    this.listenerSetter.add(rootScope)('dialog_notify_settings', (dialog) => {\r\n      if(this.peerId === dialog.peerId) {\r\n        this.chat.input.setUnreadCount();\r\n      }\r\n    });\r\n\r\n    this.listenerSetter.add(rootScope)('chat_update', async(chatId) => {\r\n      if(this.peerId === chatId.toPeerId(true)) {\r\n        const hadRights = this.chatInner.classList.contains('has-rights');\r\n        const hasRights = await this.chat.canSend();\r\n\r\n        if(hadRights !== hasRights) {\r\n          const callbacks = await Promise.all([\r\n            this.finishPeerChange(),\r\n            this.chat.input.finishPeerChange()\r\n          ]);\r\n\r\n          callbacks.forEach((callback) => callback());\r\n        }\r\n      }\r\n    });\r\n\r\n    this.listenerSetter.add(rootScope)('settings_updated', async({key}) => {\r\n      if(key === 'settings.emoji.big') {\r\n        const middleware = this.getMiddleware();\r\n        const mids = getObjectKeysAndSort(this.bubbles, 'desc');\r\n        const m = mids.map(async(mid) => {\r\n          const bubble = this.bubbles[mid];\r\n          if(bubble.classList.contains('can-have-big-emoji')) {\r\n            return {bubble, message: await this.chat.getMessage(mid)};\r\n          }\r\n        });\r\n\r\n        const awaited = await Promise.all(m);\r\n        if(!middleware()) {\r\n          return;\r\n        }\r\n\r\n        awaited.filter(Boolean).forEach(({bubble, message}) => {\r\n          if(this.bubbles[message.mid] !== bubble) {\r\n            return;\r\n          }\r\n\r\n          this.safeRenderMessage(message, true, bubble);\r\n        });\r\n      }\r\n    });\r\n\r\n    !DO_NOT_UPDATE_MESSAGE_VIEWS && this.listenerSetter.add(rootScope)('messages_views', (arr) => {\r\n      fastRaf(() => {\r\n        let scrollSaver: ScrollSaver;\r\n        for(const {peerId, views, mid} of arr) {\r\n          if(this.peerId !== peerId) continue;\r\n\r\n          const bubble = this.bubbles[mid];\r\n          if(!bubble) continue;\r\n\r\n          const postViewsElements = Array.from(bubble.querySelectorAll('.post-views')) as HTMLElement[];\r\n          if(!postViewsElements.length) continue;\r\n\r\n          const str = formatNumber(views, 1);\r\n          let different = false;\r\n          postViewsElements.forEach((postViews) => {\r\n            if(different || postViews.textContent !== str) {\r\n              if(!scrollSaver) {\r\n                scrollSaver = this.createScrollSaver(true);\r\n                scrollSaver.save();\r\n              }\r\n\r\n              different = true;\r\n              postViews.textContent = str;\r\n            }\r\n          });\r\n        }\r\n\r\n        if(scrollSaver) {\r\n          scrollSaver.restore();\r\n        }\r\n      });\r\n    });\r\n\r\n    this.observer = new SuperIntersectionObserver({root: this.scrollable.container});\r\n\r\n    this.listenerSetter.add(this.chat.appImManager)('chat_changing', ({to}) => {\r\n      const freeze = to !== this.chat;\r\n\r\n      const cb = () => {\r\n        this.observer.toggleObservingNew(freeze);\r\n      };\r\n\r\n      if(!freeze) {\r\n        setTimeout(() => {\r\n          cb();\r\n        }, 400);\r\n      } else {\r\n        cb();\r\n      }\r\n    });\r\n\r\n    this.sendViewCountersDebounced = debounce(() => {\r\n      const mids = [...this.viewsMids];\r\n      this.viewsMids.clear();\r\n\r\n      this.managers.appMessagesManager.incrementMessageViews(this.peerId, mids);\r\n    }, 1000, false, true);\r\n  }\r\n\r\n  private get peerId() {\r\n    return this.chat.peerId;\r\n  }\r\n\r\n  private createScrollSaver(reverse = true) {\r\n    const scrollSaver = new ScrollSaver(this.scrollable, '.bubble:not(.is-date)', reverse);\r\n    return scrollSaver;\r\n  }\r\n\r\n  private unreadedObserverCallback = (entry: IntersectionObserverEntry) => {\r\n    if(entry.isIntersecting) {\r\n      const target = entry.target as HTMLElement;\r\n      const mid = this.unreaded.get(target as HTMLElement);\r\n      this.onUnreadedInViewport(target, mid);\r\n    }\r\n  };\r\n\r\n  private viewsObserverCallback = (entry: IntersectionObserverEntry) => {\r\n    if(entry.isIntersecting) {\r\n      const mid = +(entry.target as HTMLElement).dataset.mid;\r\n      this.observer.unobserve(entry.target, this.viewsObserverCallback);\r\n\r\n      if(mid) {\r\n        this.viewsMids.add(mid);\r\n        this.sendViewCountersDebounced();\r\n      } else {\r\n        const {sponsoredMessage} = this;\r\n        if(sponsoredMessage && sponsoredMessage.random_id) {\r\n          delete sponsoredMessage.random_id;\r\n          this.managers.appChatsManager.viewSponsoredMessage(this.peerId.toChatId(), sponsoredMessage.random_id);\r\n        }\r\n      }\r\n    }\r\n  };\r\n\r\n  private stickerEffectObserverCallback = (entry: IntersectionObserverEntry) => {\r\n    if(entry.isIntersecting) {\r\n      this.observer.unobserve(entry.target, this.stickerEffectObserverCallback);\r\n\r\n      const attachmentDiv: HTMLElement = entry.target.querySelector('.attachment');\r\n      getHeavyAnimationPromise().then(() => {\r\n        if(isInDOM(attachmentDiv)) {\r\n          simulateClickEvent(attachmentDiv);\r\n        }\r\n      });\r\n    }\r\n  };\r\n\r\n  private createResizeObserver() {\r\n    if(!('ResizeObserver' in window) || this.resizeObserver) {\r\n      return;\r\n    }\r\n\r\n    const container = this.scrollable.container;\r\n    let wasHeight = 0/* container.offsetHeight */;\r\n    let resizing = false;\r\n    let skip = false;\r\n    let scrolled = 0;\r\n    let part = 0;\r\n    let rAF = 0;\r\n    // let skipNext = true;\r\n\r\n    const onResizeEnd = () => {\r\n      const height = container.offsetHeight;\r\n      const isScrolledDown = this.scrollable.isScrolledDown;\r\n      if(height !== wasHeight && (!skip || !isScrolledDown)) { // * fix opening keyboard while ESG is active, offsetHeight will change right between 'start' and this first frame\r\n        part += wasHeight - height;\r\n      }\r\n\r\n      /* if(DEBUG) {\r\n        this.log('resize end', scrolled, part, this.scrollable.scrollTop, height, wasHeight, this.scrollable.isScrolledDown);\r\n      } */\r\n\r\n      if(part) {\r\n        this.scrollable.setScrollTopSilently(this.scrollable.scrollTop + Math.round(part));\r\n      }\r\n\r\n      wasHeight = height;\r\n      scrolled = 0;\r\n      rAF = 0;\r\n      part = 0;\r\n      resizing = false;\r\n      skip = false;\r\n    };\r\n\r\n    const setEndRAF = (single: boolean) => {\r\n      if(rAF) window.cancelAnimationFrame(rAF);\r\n      rAF = window.requestAnimationFrame(single ? onResizeEnd : () => {\r\n        rAF = window.requestAnimationFrame(onResizeEnd);\r\n        // this.log('resize after RAF', part);\r\n      });\r\n    };\r\n\r\n    const processEntries: ResizeObserverCallback = (entries) => {\r\n      /* if(skipNext) {\r\n        skipNext = false;\r\n        return;\r\n      } */\r\n\r\n      if(skip) {\r\n        setEndRAF(false);\r\n        return;\r\n      }\r\n\r\n      const entry = entries[0];\r\n      const height = entry.contentRect.height;/* Math.ceil(entry.contentRect.height); */\r\n\r\n      if(!wasHeight) {\r\n        wasHeight = height;\r\n        return;\r\n      }\r\n\r\n      const realDiff = wasHeight - height;\r\n      let diff = realDiff + part;\r\n      const _part = diff % 1;\r\n      diff -= _part;\r\n\r\n      if(!resizing) {\r\n        resizing = true;\r\n\r\n        /* if(DEBUG) {\r\n          this.log('resize start', realDiff, this.scrollable.scrollTop, this.scrollable.container.offsetHeight, this.scrollable.isScrolledDown);\r\n        } */\r\n\r\n        if(realDiff < 0 && this.scrollable.isScrolledDown) {\r\n          // if(isSafari) { // * fix opening keyboard while ESG is active\r\n          part = -realDiff;\r\n          // }\r\n\r\n          skip = true;\r\n          setEndRAF(false);\r\n          return;\r\n        }\r\n      }\r\n\r\n      scrolled += diff;\r\n\r\n      /* if(DEBUG) {\r\n        this.log('resize', wasHeight - height, diff, this.scrollable.container.offsetHeight, this.scrollable.isScrolledDown, height, wasHeight);\r\n      } */\r\n\r\n      if(diff) {\r\n        const needScrollTop = this.scrollable.scrollTop + diff;\r\n        this.scrollable.setScrollTopSilently(needScrollTop);\r\n      }\r\n\r\n      setEndRAF(false);\r\n\r\n      part = _part;\r\n      wasHeight = height;\r\n    };\r\n\r\n    const resizeObserver = this.resizeObserver = new ResizeObserver(processEntries);\r\n    resizeObserver.observe(container);\r\n  }\r\n\r\n  private destroyResizeObserver() {\r\n    const resizeObserver = this.resizeObserver;\r\n    if(!resizeObserver) {\r\n      return;\r\n    }\r\n\r\n    resizeObserver.disconnect();\r\n    this.resizeObserver = undefined;\r\n  }\r\n\r\n  private onBubblesMouseMove = async(e: MouseEvent) => {\r\n    const content = findUpClassName(e.target, 'bubble-content');\r\n    if(content && !this.chat.selection.isSelecting) {\r\n      const bubble = findUpClassName(content, 'bubble');\r\n      if(!this.chat.selection.canSelectBubble(bubble)) {\r\n        this.unhoverPrevious();\r\n        return;\r\n      }\r\n\r\n      let {hoverBubble, hoverReaction} = this;\r\n      if(bubble === hoverBubble) {\r\n        return;\r\n      }\r\n\r\n      this.unhoverPrevious();\r\n\r\n      hoverBubble = this.hoverBubble = bubble;\r\n      hoverReaction = this.hoverReaction;\r\n      // hoverReaction = contentWrapper.querySelector('.bubble-hover-reaction');\r\n      if(!hoverReaction) {\r\n        hoverReaction = this.hoverReaction = document.createElement('div');\r\n        hoverReaction.classList.add('bubble-hover-reaction');\r\n\r\n        const stickerWrapper = document.createElement('div');\r\n        stickerWrapper.classList.add('bubble-hover-reaction-sticker');\r\n        hoverReaction.append(stickerWrapper);\r\n\r\n        content.append(hoverReaction);\r\n\r\n        let message = (await this.chat.getMessage(+bubble.dataset.mid)) as Message.message;\r\n        message = await this.managers.appMessagesManager.getGroupsFirstMessage(message);\r\n\r\n        const middleware = this.getMiddleware(() => this.hoverReaction === hoverReaction);\r\n        Promise.all([\r\n          this.managers.appReactionsManager.getAvailableReactionsByMessage(message),\r\n          pause(400)\r\n        ]).then(([availableReactions]) => {\r\n          const availableReaction = availableReactions[0];\r\n          if(!availableReaction) {\r\n            hoverReaction.remove();\r\n            return;\r\n          }\r\n\r\n          wrapSticker({\r\n            div: stickerWrapper,\r\n            doc: availableReaction.select_animation,\r\n            width: 18,\r\n            height: 18,\r\n            needUpscale: true,\r\n            middleware,\r\n            group: CHAT_ANIMATION_GROUP,\r\n            withThumb: false,\r\n            needFadeIn: false\r\n          }).then(({render}) => render).then((player) => {\r\n            assumeType<RLottiePlayer>(player);\r\n\r\n            player.addEventListener('firstFrame', () => {\r\n              if(!middleware()) {\r\n                // debugger;\r\n                return;\r\n              }\r\n\r\n              hoverReaction.dataset.loaded = '1';\r\n              this.setHoverVisible(hoverReaction, true);\r\n            }, {once: true});\r\n\r\n            attachClickEvent(hoverReaction, (e) => {\r\n              cancelEvent(e); // cancel triggering selection\r\n\r\n              this.managers.appReactionsManager.sendReaction(message, availableReaction.reaction);\r\n              this.unhoverPrevious();\r\n            }, {listenerSetter: this.listenerSetter});\r\n          }, noop);\r\n        });\r\n      } else if(hoverReaction.dataset.loaded) {\r\n        this.setHoverVisible(hoverReaction, true);\r\n      }\r\n    } else {\r\n      this.unhoverPrevious();\r\n    }\r\n  };\r\n\r\n  public setReactionsHoverListeners() {\r\n    this.listenerSetter.add(contextMenuController)('toggle', this.unhoverPrevious);\r\n    this.listenerSetter.add(overlayCounter)('change', this.unhoverPrevious);\r\n    this.listenerSetter.add(this.chat.selection)('toggle', this.unhoverPrevious);\r\n    this.listenerSetter.add(this.container)('mousemove', this.onBubblesMouseMove);\r\n  }\r\n\r\n  private setHoverVisible(hoverReaction: HTMLElement, visible: boolean) {\r\n    SetTransition(hoverReaction, 'is-visible', visible, 200, visible ? undefined : () => {\r\n      hoverReaction.remove();\r\n    }, 2);\r\n  }\r\n\r\n  private unhoverPrevious = () => {\r\n    const {hoverBubble, hoverReaction} = this;\r\n    if(hoverBubble) {\r\n      this.setHoverVisible(hoverReaction, false);\r\n      this.hoverBubble = undefined;\r\n      this.hoverReaction = undefined;\r\n    }\r\n  };\r\n\r\n  public setStickyDateManually() {\r\n    return;\r\n\r\n    const timestamps = Object.keys(this.dateMessages).map((k) => +k).sort((a, b) => b - a);\r\n    let lastVisible: HTMLElement;\r\n\r\n    // if(this.chatInner.classList.contains('is-scrolling')) {\r\n    const {scrollTop} = this.scrollable.container;\r\n    const isOverflown = scrollTop > 0;\r\n    if(isOverflown) {\r\n      for(const timestamp of timestamps) {\r\n        const dateMessage = this.dateMessages[timestamp];\r\n        const visibleRect = getVisibleRect(dateMessage.container, this.scrollable.container);\r\n        if(visibleRect && visibleRect.overflow.top) {\r\n          lastVisible = dateMessage.div;\r\n        } else if(lastVisible) {\r\n          break;\r\n        }\r\n      }\r\n    }\r\n    // }\r\n\r\n    if(lastVisible === this.previousStickyDate) {\r\n      return;\r\n    }\r\n\r\n    if(lastVisible) {\r\n      const needReflow = /* !!this.chat.setPeerPromise ||  */!this.previousStickyDate;\r\n      if(needReflow) {\r\n        lastVisible.classList.add('no-transition');\r\n      }\r\n\r\n      lastVisible.classList.add('is-sticky');\r\n\r\n      if(needReflow) {\r\n        void lastVisible.offsetLeft; // reflow\r\n        lastVisible.classList.remove('no-transition');\r\n      }\r\n    }\r\n\r\n    if(this.previousStickyDate && this.previousStickyDate !== lastVisible) {\r\n      this.previousStickyDate.classList.remove('is-sticky');\r\n    }\r\n\r\n    this.previousStickyDate = lastVisible;\r\n  }\r\n\r\n  public getRenderedLength() {\r\n    return Object.keys(this.bubbles).length - this.skippedMids.size;\r\n  }\r\n\r\n  private onUnreadedInViewport(target: HTMLElement, mid: number) {\r\n    this.unreadedSeen.add(mid);\r\n    this.observer.unobserve(target, this.unreadedObserverCallback);\r\n    this.unreaded.delete(target);\r\n    this.readUnreaded();\r\n  }\r\n\r\n  private readUnreaded() {\r\n    if(this.readPromise) return;\r\n\r\n    const middleware = this.getMiddleware();\r\n    this.readPromise = idleController.getFocusPromise().then(async() => {\r\n      if(!middleware()) return;\r\n      let maxId = Math.max(...Array.from(this.unreadedSeen));\r\n\r\n      // ? if message with maxId is not rendered ?\r\n      if(this.scrollable.loadedAll.bottom) {\r\n        const bubblesMaxId = Math.max(...Object.keys(this.bubbles).map((i) => +i));\r\n        if(maxId >= bubblesMaxId) {\r\n          maxId = Math.max((await this.chat.getHistoryMaxId()) || 0, maxId);\r\n        }\r\n      }\r\n\r\n      this.unreaded.forEach((mid, target) => {\r\n        if(mid <= maxId) {\r\n          this.onUnreadedInViewport(target, mid);\r\n        }\r\n      });\r\n\r\n      const readContents: number[] = [];\r\n      for(const mid of this.unreadedSeen) {\r\n        const message: MyMessage = await this.chat.getMessage(mid);\r\n        if(isMentionUnread(message)) {\r\n          readContents.push(mid);\r\n        }\r\n      }\r\n\r\n      this.managers.appMessagesManager.readMessages(this.peerId, readContents);\r\n\r\n      this.unreadedSeen.clear();\r\n\r\n      if(DEBUG) {\r\n        this.log('will readHistory by maxId:', maxId);\r\n      }\r\n\r\n      // return;\r\n\r\n      return this.managers.appMessagesManager.readHistory(this.peerId, maxId, this.chat.threadId).catch((err: any) => {\r\n        this.log.error('readHistory err:', err);\r\n        this.managers.appMessagesManager.readHistory(this.peerId, maxId, this.chat.threadId);\r\n      }).finally(() => {\r\n        if(!middleware()) return;\r\n        this.readPromise = undefined;\r\n\r\n        if(this.unreadedSeen.size) {\r\n          this.readUnreaded();\r\n        }\r\n      });\r\n    });\r\n  }\r\n\r\n  public constructPinnedHelpers() {\r\n    this.listenerSetter.add(rootScope)('peer_pinned_messages', (e) => {\r\n      const {peerId, mids, pinned} = e;\r\n      if(peerId !== this.peerId) return;\r\n\r\n      if(mids) {\r\n        if(!pinned) {\r\n          this.deleteMessagesByIds(mids);\r\n        }\r\n      }\r\n    });\r\n  }\r\n\r\n  public constructScheduledHelpers() {\r\n    const onUpdate = async() => {\r\n      this.chat.topbar.setTitle((await this.managers.appMessagesManager.getScheduledMessagesStorage(this.peerId)).size);\r\n    };\r\n\r\n    this.listenerSetter.add(rootScope)('scheduled_new', (message) => {\r\n      if(message.peerId !== this.peerId) return;\r\n\r\n      this.renderNewMessage(message);\r\n      onUpdate();\r\n    });\r\n\r\n    this.listenerSetter.add(rootScope)('scheduled_delete', ({peerId, mids}) => {\r\n      if(peerId !== this.peerId) return;\r\n\r\n      this.deleteMessagesByIds(mids);\r\n      onUpdate();\r\n    });\r\n  }\r\n\r\n  public onBubblesClick = async(e: Event) => {\r\n    let target = e.target as HTMLElement;\r\n    let bubble: HTMLElement = null;\r\n    try {\r\n      bubble = findUpClassName(target, 'bubble');\r\n    } catch(err) {}\r\n\r\n    if(!bubble && !this.chat.selection.isSelecting) {\r\n      const avatar = findUpClassName(target, 'user-avatar');\r\n      if(!avatar) {\r\n        return;\r\n      }\r\n\r\n      const peerId = avatar.dataset.peerId.toPeerId();\r\n      if(peerId !== NULL_PEER_ID) {\r\n        this.chat.appImManager.setInnerPeer({peerId});\r\n      } else {\r\n        toast(I18n.format('HidAccount', true));\r\n      }\r\n      return;\r\n    }\r\n\r\n    if(bubble.classList.contains('is-date') && findUpClassName(target, 'bubble-content')) {\r\n      if(bubble.classList.contains('is-sticky') && !this.chatInner.classList.contains('is-scrolling')) {\r\n        return;\r\n      }\r\n\r\n      for(const timestamp in this.dateMessages) {\r\n        const d = this.dateMessages[timestamp];\r\n        if(d.div === bubble) {\r\n          PopupElement.createPopup(PopupDatePicker, new Date(+timestamp), this.onDatePick).show();\r\n          break;\r\n        }\r\n      }\r\n\r\n      return;\r\n    }\r\n\r\n    if(!IS_TOUCH_SUPPORTED && findUpClassName(target, 'time')) {\r\n      this.chat.selection.toggleByElement(bubble);\r\n      return;\r\n    }\r\n\r\n    // ! Trusted - due to audio autoclick\r\n    if(this.chat.selection.isSelecting && e.isTrusted) {\r\n      if(bubble.classList.contains('service') && bubble.dataset.mid === undefined) {\r\n        return;\r\n      }\r\n\r\n      cancelEvent(e);\r\n      // console.log('bubble click', e);\r\n\r\n      if(IS_TOUCH_SUPPORTED && this.chat.selection.selectedText) {\r\n        this.chat.selection.selectedText = undefined;\r\n        return;\r\n      }\r\n\r\n      // this.chatSelection.toggleByBubble(bubble);\r\n      this.chat.selection.toggleByElement(findUpClassName(target, 'grouped-item') || bubble);\r\n      return;\r\n    }\r\n\r\n    const contactDiv: HTMLElement = findUpClassName(target, 'contact');\r\n    if(contactDiv) {\r\n      this.chat.appImManager.setInnerPeer({\r\n        peerId: contactDiv.dataset.peerId.toPeerId()\r\n      });\r\n      return;\r\n    }\r\n\r\n    const callDiv: HTMLElement = findUpClassName(target, 'bubble-call');\r\n    if(callDiv) {\r\n      this.chat.appImManager.callUser(this.peerId.toUserId(), callDiv.dataset.type as any);\r\n      return;\r\n    }\r\n\r\n    const buyButton: HTMLElement = findUpClassName(target, 'is-buy');\r\n    if(buyButton) {\r\n      cancelEvent(e);\r\n\r\n      const message = await this.chat.getMessage(+bubble.dataset.mid);\r\n      if(!message) {\r\n        return;\r\n      }\r\n\r\n      new PopupPayment(\r\n        message as Message.message,\r\n        await this.managers.appPaymentsManager.getInputInvoiceByPeerId(message.peerId, message.mid)\r\n      );\r\n      return;\r\n    }\r\n\r\n    const reactionElement = findUpTag(target, 'REACTION-ELEMENT') as ReactionElement;\r\n    if(reactionElement) {\r\n      cancelEvent(e);\r\n      if(reactionElement.classList.contains('is-inactive')) {\r\n        return;\r\n      }\r\n\r\n      const reactionsElement = reactionElement.parentElement as ReactionsElement;\r\n      const reactionCount = reactionsElement.getReactionCount(reactionElement);\r\n\r\n      const message = reactionsElement.getMessage();\r\n      this.managers.appReactionsManager.sendReaction(message, reactionCount.reaction);\r\n\r\n      return;\r\n    }\r\n\r\n    const commentsDiv: HTMLElement = findUpClassName(target, 'replies');\r\n    if(commentsDiv) {\r\n      const bubbleMid = +bubble.dataset.mid;\r\n      if(this.peerId === REPLIES_PEER_ID) {\r\n        const message = await this.chat.getMessage(bubbleMid) as Message.message;\r\n        const peerId = getPeerId(message.reply_to.reply_to_peer_id);\r\n        const threadId = message.reply_to.reply_to_top_id;\r\n        const lastMsgId = message.fwd_from.saved_from_msg_id;\r\n        this.chat.appImManager.openThread(peerId, lastMsgId, threadId);\r\n      } else {\r\n        const message1 = await this.chat.getMessage(bubbleMid);\r\n        const message = await this.managers.appMessagesManager.getMessageWithReplies(message1 as Message.message);\r\n        const replies = message.replies;\r\n        if(replies) {\r\n          this.managers.appMessagesManager.getDiscussionMessage(this.peerId, message.mid).then((message) => {\r\n            this.chat.appImManager.setInnerPeer({\r\n              peerId: replies.channel_id.toPeerId(true),\r\n              type: 'discussion',\r\n              threadId: (message as MyMessage).mid\r\n            });\r\n          });\r\n        }\r\n      }\r\n\r\n      return;\r\n    }\r\n\r\n    const via = findUpClassName(target, 'is-via');\r\n    if(via) {\r\n      const el = via.querySelector('.peer-title') as HTMLElement;\r\n      if(target === el || findUpAsChild(target, el)) {\r\n        const message = el.innerText + ' ';\r\n        this.managers.appDraftsManager.setDraft(this.peerId, this.chat.threadId, message);\r\n        cancelEvent(e);\r\n\r\n        return;\r\n      }\r\n    }\r\n\r\n    const nameDiv = findUpClassName(target, 'peer-title') || findUpTag(target, 'AVATAR-ELEMENT') || findUpAttribute(target, 'data-saved-from');\r\n    if(nameDiv && nameDiv !== bubble) {\r\n      target = nameDiv || target;\r\n      const peerIdStr = target.dataset.peerId || target.getAttribute('peer') || (target as AvatarElement).peerId;\r\n      const savedFrom = target.dataset.savedFrom;\r\n      if(typeof(peerIdStr) === 'string' || savedFrom) {\r\n        if(savedFrom) {\r\n          const [peerId, mid] = savedFrom.split('_');\r\n          if(target.classList.contains('is-receipt-link')) {\r\n            const message = await this.managers.appMessagesManager.getMessageByPeer(peerId.toPeerId(), +mid);\r\n            if(message) {\r\n              const inputInvoice = await this.managers.appPaymentsManager.getInputInvoiceByPeerId(this.peerId, +bubble.dataset.mid);\r\n              new PopupPayment(message as Message.message, inputInvoice);\r\n            }\r\n          } else {\r\n            this.chat.appImManager.setInnerPeer({\r\n              peerId: peerId.toPeerId(),\r\n              lastMsgId: +mid\r\n            });\r\n          }\r\n        } else {\r\n          const peerId = peerIdStr.toPeerId();\r\n          if(peerId !== NULL_PEER_ID) {\r\n            this.chat.appImManager.setInnerPeer({peerId});\r\n          } else {\r\n            toast(I18n.format('HidAccount', true));\r\n          }\r\n        }\r\n      }\r\n\r\n      return;\r\n    }\r\n\r\n    // this.log('chatInner click:', target);\r\n    // const isVideoComponentElement = target.tagName === 'SPAN' && findUpClassName(target, 'media-container');\r\n    /* if(isVideoComponentElement) {\r\n      const video = target.parentElement.querySelector('video') as HTMLElement;\r\n      if(video) {\r\n        video.click(); // hot-fix for time and play button\r\n        return;\r\n      }\r\n    } */\r\n\r\n    if(bubble.classList.contains('sticker') && target.parentElement.classList.contains('attachment')) {\r\n      const messageId = +bubble.dataset.mid;\r\n      const message = await this.chat.getMessage(messageId);\r\n\r\n      const doc = ((message as Message.message).media as MessageMedia.messageMediaDocument)?.document as Document.document;\r\n\r\n      if(doc?.stickerSetInput) {\r\n        new PopupStickers(doc.stickerSetInput).show();\r\n      }\r\n\r\n      return;\r\n    }\r\n\r\n    const documentDiv = findUpClassName(target, 'document-with-thumb');\r\n    if((target.tagName === 'IMG' && !target.classList.contains('emoji') && !target.classList.contains('document-thumb')) ||\r\n      target.classList.contains('album-item') ||\r\n      // || isVideoComponentElement\r\n      (target.tagName === 'VIDEO' && !bubble.classList.contains('round')) ||\r\n      (documentDiv && !documentDiv.querySelector('.preloader-container')) ||\r\n      target.classList.contains('canvas-thumbnail')) {\r\n      const groupedItem = findUpClassName(target, 'album-item') || findUpClassName(target, 'document-container');\r\n      const preloader = (groupedItem || bubble).querySelector<HTMLElement>('.preloader-container');\r\n      if(preloader) {\r\n        simulateClickEvent(preloader);\r\n        cancelEvent(e);\r\n        return;\r\n      }\r\n\r\n      cancelEvent(e);\r\n      const messageId = +(groupedItem || bubble).dataset.mid;\r\n      const message = await this.chat.getMessage(messageId);\r\n      if(!message) {\r\n        this.log.warn('no message by messageId:', messageId);\r\n        return;\r\n      }\r\n\r\n      const SINGLE_MEDIA_CLASSNAME = 'webpage';\r\n      const isSingleMedia = bubble.classList.contains(SINGLE_MEDIA_CLASSNAME);\r\n\r\n      const f = documentDiv ? (media: any) => {\r\n        return AppMediaViewer.isMediaCompatibleForDocumentViewer(media);\r\n      } : (media: any) => {\r\n        return media._ === 'photo' || ['video', 'gif'].includes(media.type);\r\n      };\r\n\r\n      const targets: {element: HTMLElement, mid: number, peerId: PeerId}[] = [];\r\n      const ids = isSingleMedia ? [messageId] : (await Promise.all(Object.keys(this.bubbles).map((k) => +k).map(async(mid) => {\r\n        /* if(isSingleMedia && !this.bubbles[id].classList.contains(SINGLE_MEDIA_CLASSNAME)) {\r\n          return false;\r\n        }  */\r\n        // if(!this.scrollable.visibleElements.find((e) => e.element === this.bubbles[id])) return false;\r\n\r\n        const message = await this.chat.getMessage(mid);\r\n        const media = getMediaFromMessage(message);\r\n\r\n        return media && f(media) && mid;\r\n      }))).filter(Boolean).sort((a, b) => a - b);\r\n\r\n      ids.forEach((id) => {\r\n        let selector: string;\r\n        if(documentDiv) {\r\n          selector = '.document-container';\r\n        } else {\r\n          const withTail = this.bubbles[id].classList.contains('with-media-tail');\r\n          selector = '.album-item video, .album-item img, .preview video, .preview img, ';\r\n          if(withTail) {\r\n            selector += '.bubble__media-container';\r\n          } else {\r\n            selector += '.attachment video, .attachment img';\r\n          }\r\n        }\r\n\r\n        const elements = Array.from(this.bubbles[id].querySelectorAll(selector)) as HTMLElement[];\r\n        const parents: Set<HTMLElement> = new Set();\r\n        if(documentDiv) {\r\n          elements.forEach((element) => {\r\n            targets.push({\r\n              element: element.querySelector('.document-ico'),\r\n              mid: +element.dataset.mid,\r\n              peerId: this.peerId\r\n            });\r\n          });\r\n        } else {\r\n          const hasAspecter = !!this.bubbles[id].querySelector('.media-container-aspecter');\r\n          elements.forEach((element) => {\r\n            if(hasAspecter && !findUpClassName(element, 'media-container-aspecter')) return;\r\n            const albumItem = findUpClassName(element, 'album-item');\r\n            const parent = albumItem || element.parentElement;\r\n            if(parents.has(parent)) return;\r\n            parents.add(parent);\r\n            targets.push({\r\n              element,\r\n              mid: albumItem ? +albumItem.dataset.mid : id,\r\n              peerId: this.peerId\r\n            });\r\n          });\r\n        }\r\n      });\r\n\r\n      targets.sort((a, b) => a.mid - b.mid);\r\n\r\n      const idx = targets.findIndex((t) => t.mid === messageId);\r\n\r\n      if(DEBUG) {\r\n        this.log('open mediaViewer single with ids:', ids, idx, targets);\r\n      }\r\n\r\n      if(!targets[idx]) {\r\n        this.log('no target for media viewer!', target);\r\n        return;\r\n      }\r\n\r\n      new AppMediaViewer()\r\n      .setSearchContext({\r\n        threadId: this.chat.threadId,\r\n        peerId: this.peerId,\r\n        inputFilter: {_: documentDiv ? 'inputMessagesFilterDocument' : 'inputMessagesFilterPhotoVideo'},\r\n        useSearch: this.chat.type !== 'scheduled' && !isSingleMedia,\r\n        isScheduled: this.chat.type === 'scheduled'\r\n      })\r\n      .openMedia(message, targets[idx].element, 0, true, targets.slice(0, idx), targets.slice(idx + 1));\r\n\r\n      // appMediaViewer.openMedia(message, target as HTMLImageElement);\r\n      return;\r\n    }\r\n\r\n    if(['IMG', 'DIV', 'SPAN'/* , 'A' */].indexOf(target.tagName) === -1) target = findUpTag(target, 'DIV');\r\n\r\n    if(['DIV', 'SPAN'].indexOf(target.tagName) !== -1/*  || target.tagName === 'A' */) {\r\n      if(target.classList.contains('goto-original')) {\r\n        const savedFrom = bubble.dataset.savedFrom;\r\n        const [peerId, mid] = savedFrom.split('_');\r\n        // //this.log('savedFrom', peerId, msgID);\r\n        this.chat.appImManager.setInnerPeer({\r\n          peerId: peerId.toPeerId(),\r\n          lastMsgId: +mid\r\n        });\r\n        return;\r\n      } else if(target.classList.contains('forward')) {\r\n        const mid = +bubble.dataset.mid;\r\n        const message = await this.managers.appMessagesManager.getMessageByPeer(this.peerId, mid);\r\n        new PopupForward({\r\n          [this.peerId]: await this.managers.appMessagesManager.getMidsByMessage(message)\r\n        });\r\n        // appSidebarRight.forwardTab.open([mid]);\r\n        return;\r\n      }\r\n\r\n      let isReplyClick = false;\r\n\r\n      try {\r\n        isReplyClick = !!findUpClassName(e.target, 'reply');\r\n      } catch(err) {}\r\n\r\n      if(isReplyClick && bubble.classList.contains('is-reply')/*  || bubble.classList.contains('forwarded') */) {\r\n        const bubbleMid = +bubble.dataset.mid;\r\n        this.replyFollowHistory.push(bubbleMid);\r\n\r\n        const message = (await this.chat.getMessage(bubbleMid)) as Message.message;\r\n\r\n        const replyToPeerId = message.reply_to.reply_to_peer_id ? getPeerId(message.reply_to.reply_to_peer_id) : this.peerId;\r\n        const replyToMid = message.reply_to.reply_to_msg_id;\r\n\r\n        this.chat.appImManager.setInnerPeer({\r\n          peerId: replyToPeerId,\r\n          lastMsgId: replyToMid,\r\n          type: this.chat.type,\r\n          threadId: this.chat.threadId\r\n        });\r\n\r\n        /* if(this.chat.type === 'discussion') {\r\n          this.chat.appImManager.setMessageId(, originalMessageId);\r\n        } else {\r\n          this.chat.appImManager.setInnerPeer(this.peerId, originalMessageId);\r\n        } */\r\n        // this.chat.setMessageId(, originalMessageId);\r\n      }\r\n    }\r\n\r\n    // console.log('chatInner click', e);\r\n  };\r\n\r\n  public async onGoDownClick() {\r\n    if(!this.replyFollowHistory.length) {\r\n      // this.onScroll(true, undefined, true);\r\n      this.chat.setMessageId(/* , dialog.top_message */);\r\n      // const dialog = this.appMessagesManager.getDialogByPeerId(this.peerId)[0];\r\n\r\n      // if(dialog) {\r\n      //   this.chat.setPeer(this.peerId/* , dialog.top_message */);\r\n      // } else {\r\n      //   this.log('will scroll down 3');\r\n      //   this.scroll.scrollTop = this.scroll.scrollHeight;\r\n      // }\r\n\r\n      return;\r\n    }\r\n\r\n    const middleware = this.getMiddleware();\r\n    const slice = this.replyFollowHistory.slice();\r\n    const messages = await Promise.all(slice.map((mid) => this.chat.getMessage(mid)));\r\n    if(!middleware()) return;\r\n\r\n    slice.forEach((mid, idx) => {\r\n      const message = messages[idx];\r\n\r\n      const bubble = this.bubbles[mid];\r\n      let bad = true;\r\n      if(bubble) {\r\n        const rect = bubble.getBoundingClientRect();\r\n        bad = (windowSize.height / 2) > rect.top;\r\n      } else if(message) {\r\n        bad = false;\r\n      }\r\n\r\n      if(bad) {\r\n        this.replyFollowHistory.splice(this.replyFollowHistory.indexOf(mid), 1);\r\n      }\r\n    });\r\n\r\n    this.replyFollowHistory.sort((a, b) => b - a);\r\n\r\n    const mid = this.replyFollowHistory.pop();\r\n    this.chat.setMessageId(mid);\r\n  }\r\n\r\n  public getBubbleByPoint(verticalSide: 'top' | 'bottom') {\r\n    let element = getElementByPoint(this.scrollable.container, verticalSide, 'center');\r\n    /* if(element) {\r\n      if(element.classList.contains('bubbles-date-group')) {\r\n        const children = Array.from(element.children) as HTMLElement[];\r\n        if(verticalSide === 'top') {\r\n          element = children[this.stickyIntersector ? 2 : 1];\r\n        } else {\r\n          element = children[children.length - 1];\r\n        }\r\n      } else {\r\n        element = findUpClassName(element, 'bubble');\r\n        if(element && element.classList.contains('is-date')) {\r\n          element = element.nextElementSibling as HTMLElement;\r\n        }\r\n      }\r\n    } */\r\n    if(element) element = findUpClassName(element, 'bubble');\r\n\r\n    return element;\r\n  }\r\n\r\n  public async getGroupedBubble(groupId: string) {\r\n    const mids = await this.managers.appMessagesManager.getMidsByAlbum(groupId);\r\n    for(const mid of mids) {\r\n      if(this.bubbles[mid] && !this.skippedMids.has(mid)) {\r\n        // const maxId = Math.max(...mids); // * because in scheduled album can be rendered by lowest mid during sending\r\n        return {\r\n          bubble: this.bubbles[mid],\r\n          mid: mid\r\n          // message: await this.chat.getMessage(maxId) as Message.message\r\n        };\r\n      }\r\n    }\r\n  }\r\n\r\n  public getBubbleGroupedItems(bubble: HTMLElement) {\r\n    return Array.from(bubble.querySelectorAll('.grouped-item')) as HTMLElement[];\r\n  }\r\n\r\n  public async getMountedBubble(mid: number, message?: Message.message | Message.messageService) {\r\n    if(message === undefined) {\r\n      message = await this.chat.getMessage(mid);\r\n    }\r\n\r\n    if(!message) {\r\n      return;\r\n    }\r\n\r\n    const groupedId = (message as Message.message).grouped_id;\r\n    if(groupedId) {\r\n      const a = await this.getGroupedBubble(groupedId);\r\n      if(a) {\r\n        a.bubble = a.bubble.querySelector(`.document-container[data-mid=\"${mid}\"]`) || a.bubble;\r\n        return a;\r\n      }\r\n    }\r\n\r\n    const bubble = this.bubbles[mid];\r\n    if(!bubble) return;\r\n\r\n    return {bubble, mid};\r\n  }\r\n\r\n  private findNextMountedBubbleByMsgId(mid: number, prev?: boolean) {\r\n    const mids = getObjectKeysAndSort(this.bubbles, prev ? 'desc' : 'asc');\r\n\r\n    let filterCallback: (_mid: number) => boolean;\r\n    if(prev) filterCallback = (_mid) => _mid < mid;\r\n    else filterCallback = (_mid) => mid < _mid;\r\n\r\n    const foundMid = mids.find((_mid) => {\r\n      if(!filterCallback(_mid)) return false;\r\n      return !!this.bubbles[_mid]?.parentElement;\r\n    });\r\n\r\n    return this.bubbles[foundMid];\r\n  }\r\n\r\n  public loadMoreHistory(top: boolean, justLoad = false) {\r\n    // this.log('loadMoreHistory', top);\r\n    if(\r\n      !this.peerId ||\r\n      /* TEST_SCROLL || */\r\n      this.chat.setPeerPromise ||\r\n      this.isHeavyAnimationInProgress ||\r\n      (top && (this.getHistoryTopPromise || this.scrollable.loadedAll.top)) ||\r\n      (!top && (this.getHistoryBottomPromise || this.scrollable.loadedAll.bottom))\r\n    ) {\r\n      return;\r\n    }\r\n\r\n    // warning,         (     )\r\n    // some messages can have negative id (such as sponsored message)\r\n    const history = Object.keys(this.bubbles)\r\n    .map((id) => +id)\r\n    .filter((id) => id > 0 && !this.skippedMids.has(id))\r\n    .sort((a, b) => a - b);\r\n\r\n    if(!history.length) {\r\n      history.push(0);\r\n    }\r\n\r\n    if(top) {\r\n      if(DEBUG) {\r\n        this.log('Will load more (up) history by id:', history[0], 'maxId:', history[history.length - 1], justLoad/* , history */);\r\n      }\r\n\r\n      this.getHistory1(history[0], true, undefined, undefined, justLoad);\r\n    } else {\r\n      // let dialog = this.appMessagesManager.getDialogByPeerId(this.peerId)[0];\r\n      // const historyMaxId = await this.chat.getHistoryMaxId();\r\n\r\n      // // if scroll down after search\r\n      // if(history.indexOf(historyMaxId) !== -1) {\r\n      //   this.setLoaded('bottom', true);\r\n      //   return;\r\n      // }\r\n\r\n      if(DEBUG) {\r\n        this.log('Will load more (down) history by id:', history[history.length - 1], justLoad/* , history */);\r\n      }\r\n\r\n      this.getHistory1(history[history.length - 1], false, true, undefined, justLoad);\r\n    }\r\n  }\r\n\r\n  public onScroll = (ignoreHeavyAnimation?: boolean, scrollDimensions?: ScrollStartCallbackDimensions, forceDown?: boolean) => {\r\n    // return;\r\n\r\n    if(this.isHeavyAnimationInProgress) {\r\n      if(this.sliceViewportDebounced) {\r\n        this.sliceViewportDebounced.clearTimeout();\r\n      }\r\n\r\n      // *   ,         ,          \r\n      if(this.scrolledDown && !ignoreHeavyAnimation) {\r\n        return;\r\n      }\r\n    } else {\r\n      if(this.chat.topbar.pinnedMessage) {\r\n        this.chat.topbar.pinnedMessage.setCorrectIndexThrottled(this.scrollable.lastScrollDirection);\r\n      }\r\n\r\n      if(this.sliceViewportDebounced) {\r\n        this.sliceViewportDebounced();\r\n      }\r\n\r\n      this.setStickyDateManually();\r\n    }\r\n\r\n    // lottieLoader.checkAnimations(false, 'chat');\r\n\r\n    if(scrollDimensions && scrollDimensions.distanceToEnd < SCROLLED_DOWN_THRESHOLD && this.scrolledDown) {\r\n      return;\r\n    }\r\n\r\n    const distanceToEnd = forceDown ? 0 : scrollDimensions?.distanceToEnd ?? this.scrollable.getDistanceToEnd();\r\n    if(/* !IS_TOUCH_SUPPORTED &&  */(this.scrollable.lastScrollDirection !== 0 && distanceToEnd > 0) || scrollDimensions || forceDown) {\r\n    // if(/* !IS_TOUCH_SUPPORTED &&  */(this.scrollable.lastScrollDirection !== 0 || scrollDimensions) && distanceToEnd > 0) {\r\n      if(this.isScrollingTimeout) {\r\n        clearTimeout(this.isScrollingTimeout);\r\n      } else if(!this.chatInner.classList.contains('is-scrolling')) {\r\n        this.chatInner.classList.add('is-scrolling');\r\n      }\r\n\r\n      this.isScrollingTimeout = window.setTimeout(() => {\r\n        this.chatInner.classList.remove('is-scrolling');\r\n        this.isScrollingTimeout = 0;\r\n      }, 1350 + (scrollDimensions?.duration ?? 0));\r\n    }\r\n\r\n    if(distanceToEnd < SCROLLED_DOWN_THRESHOLD && (forceDown || this.scrollable.loadedAll.bottom || this.chat.setPeerPromise || !this.peerId)) {\r\n      this.container.classList.add('scrolled-down');\r\n      this.scrolledDown = true;\r\n    } else if(this.container.classList.contains('scrolled-down')) {\r\n      this.container.classList.remove('scrolled-down');\r\n      this.scrolledDown = false;\r\n    }\r\n  };\r\n\r\n  public setScroll() {\r\n    if(this.scrollable) {\r\n      this.destroyScrollable();\r\n    }\r\n\r\n    this.scrollable = new Scrollable(null, 'IM', /* 10300 */300);\r\n    this.setLoaded('top', false, false);\r\n    this.setLoaded('bottom', false, false);\r\n\r\n    this.scrollable.container.append(this.chatInner);\r\n\r\n    /* const getScrollOffset = () => {\r\n      //return Math.round(Math.max(300, appPhotosManager.windowH / 1.5));\r\n      return 300;\r\n    };\r\n\r\n    window.addEventListener('resize', () => {\r\n      this.scrollable.onScrollOffset = getScrollOffset();\r\n    });\r\n\r\n    this.scrollable = new Scrollable(this.bubblesContainer, 'y', 'IM', this.chatInner, getScrollOffset()); */\r\n\r\n    this.scrollable.onAdditionalScroll = this.onScroll;\r\n    this.scrollable.onScrolledTop = () => this.loadMoreHistory(true);\r\n    this.scrollable.onScrolledBottom = () => this.loadMoreHistory(false);\r\n    // this.scrollable.attachSentinels(undefined, 300);\r\n\r\n    if(IS_TOUCH_SUPPORTED && false) {\r\n      this.scrollable.container.addEventListener('touchmove', () => {\r\n        if(this.isScrollingTimeout) {\r\n          clearTimeout(this.isScrollingTimeout);\r\n        } else if(!this.chatInner.classList.contains('is-scrolling')) {\r\n          this.chatInner.classList.add('is-scrolling');\r\n        }\r\n      }, {passive: true});\r\n\r\n      this.scrollable.container.addEventListener('touchend', () => {\r\n        if(!this.chatInner.classList.contains('is-scrolling')) {\r\n          return;\r\n        }\r\n\r\n        if(this.isScrollingTimeout) {\r\n          clearTimeout(this.isScrollingTimeout);\r\n        }\r\n\r\n        this.isScrollingTimeout = window.setTimeout(() => {\r\n          this.chatInner.classList.remove('is-scrolling');\r\n          this.isScrollingTimeout = 0;\r\n        }, 1350);\r\n      }, {passive: true});\r\n    }\r\n  }\r\n\r\n  public async updateUnreadByDialog() {\r\n    const historyStorage = await this.chat.getHistoryStorage();\r\n    const maxId = this.peerId === rootScope.myId ? historyStorage.readMaxId : historyStorage.readOutboxMaxId;\r\n\r\n    // /////this.log('updateUnreadByDialog', maxId, dialog, this.unreadOut);\r\n\r\n    for(const msgId of this.unreadOut) {\r\n      if(msgId > 0 && msgId <= maxId) {\r\n        const bubble = this.bubbles[msgId];\r\n        if(bubble) {\r\n          this.unreadOut.delete(msgId);\r\n\r\n          if(bubble.classList.contains('is-outgoing') || bubble.classList.contains('is-error')) {\r\n            continue;\r\n          }\r\n\r\n          bubble.classList.remove('is-sent', 'is-sending', 'is-outgoing'); // is-sending can be when there are bulk of updates (e.g. sending command to Stickers bot)\r\n          bubble.classList.add('is-read');\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  public deleteMessagesByIds(mids: number[], permanent = true, ignoreOnScroll?: boolean) {\r\n    let deleted = false;\r\n    mids.forEach((mid) => {\r\n      const bubble = this.bubbles[mid];\r\n      if(!bubble) return;\r\n\r\n      deleted = true;\r\n      /* const mounted = this.getMountedBubble(mid);\r\n      if(!mounted) return; */\r\n\r\n      delete this.bubbles[mid];\r\n      this.skippedMids.delete(mid);\r\n\r\n      if(this.firstUnreadBubble === bubble) {\r\n        this.firstUnreadBubble = null;\r\n      }\r\n\r\n      this.bubbleGroups.removeAndUnmountBubble(bubble);\r\n      if(this.observer) {\r\n        this.observer.unobserve(bubble, this.unreadedObserverCallback);\r\n        this.unreaded.delete(bubble);\r\n\r\n        this.observer.unobserve(bubble, this.viewsObserverCallback);\r\n        this.viewsMids.delete(mid);\r\n\r\n        this.observer.unobserve(bubble, this.stickerEffectObserverCallback);\r\n      }\r\n\r\n      if(this.emptyPlaceholderBubble === bubble) {\r\n        this.emptyPlaceholderBubble = undefined;\r\n      }\r\n\r\n      // this.reactions.delete(mid);\r\n    });\r\n\r\n    if(!deleted) {\r\n      return;\r\n    }\r\n\r\n    this.scrollable.ignoreNextScrollEvent();\r\n    if(permanent && this.chat.selection.isSelecting) {\r\n      this.chat.selection.deleteSelectedMids(this.peerId, mids);\r\n    }\r\n\r\n    animationIntersector.checkAnimations(false, CHAT_ANIMATION_GROUP);\r\n    this.deleteEmptyDateGroups();\r\n\r\n    if(!ignoreOnScroll) {\r\n      this.scrollable.onScroll();\r\n      // this.onScroll();\r\n    }\r\n  }\r\n\r\n  private setTopPadding(middleware = this.getMiddleware()) {\r\n    let isPaddingNeeded = false;\r\n    let setPaddingTo: HTMLElement;\r\n    if(!this.isTopPaddingSet && this.chat.type !== 'scheduled') {\r\n      const {clientHeight, scrollHeight} = this.scrollable.container;\r\n      isPaddingNeeded = clientHeight === scrollHeight;\r\n      /* const firstEl = this.chatInner.firstElementChild as HTMLElement;\r\n      if(this.chatInner.firstElementChild) {\r\n        const visibleRect = getVisibleRect(firstEl, this.scrollable.container);\r\n        isPaddingNeeded = !visibleRect.overflow.top && (visibleRect.rect.top - firstEl.offsetTop) !== this.scrollable.container.getBoundingClientRect().top;\r\n      } else {\r\n        isPaddingNeeded = true;\r\n      } */\r\n\r\n      if(isPaddingNeeded) {\r\n        /* const add = clientHeight - scrollHeight;\r\n        this.chatInner.style.paddingTop = add + 'px';\r\n        this.scrollable.scrollTop += add; */\r\n        setPaddingTo = this.chatInner;\r\n        setPaddingTo.style.paddingTop = clientHeight + 'px';\r\n        this.scrollable.setScrollTopSilently(scrollHeight);\r\n        this.isTopPaddingSet = true;\r\n      }\r\n    }\r\n\r\n    return {\r\n      isPaddingNeeded,\r\n      unsetPadding: isPaddingNeeded ? () => {\r\n        if(middleware() && isPaddingNeeded) {\r\n          setPaddingTo.style.paddingTop = '';\r\n          this.isTopPaddingSet = false;\r\n        }\r\n      } : undefined\r\n    };\r\n  }\r\n\r\n  private renderNewMessage(message: MyMessage, scrolledDown?: boolean) {\r\n    const promise = this._renderNewMessage(message, scrolledDown);\r\n    this.renderNewPromises.add(promise);\r\n    promise.catch(noop).finally(() => {\r\n      this.renderNewPromises.delete(promise);\r\n    });\r\n    return promise;\r\n  }\r\n\r\n  private async _renderNewMessage(message: MyMessage, scrolledDown?: boolean) {\r\n    if(!this.scrollable.loadedAll.bottom) { // seems search active or sliced\r\n      // this.log('renderNewMessagesByIds: seems search is active, skipping render:', mids);\r\n      const setPeerPromise = this.chat.setPeerPromise;\r\n      if(setPeerPromise) {\r\n        const middleware = this.getMiddleware();\r\n        setPeerPromise.then(async() => {\r\n          if(!middleware()) return;\r\n          const newMessage = await this.chat.getMessage(message.mid);\r\n          if(!middleware()) return;\r\n          this.renderNewMessage(newMessage);\r\n        });\r\n      }\r\n\r\n      return;\r\n    }\r\n\r\n    if(this.chat.threadId) {\r\n      const replyTo = message?.reply_to as MessageReplyHeader;\r\n      if(!(replyTo && (replyTo.reply_to_top_id || replyTo.reply_to_msg_id) === this.chat.threadId)) {\r\n        return;\r\n      }\r\n    }\r\n\r\n    if(this.bubbles[message.mid]) {\r\n      return;\r\n    }\r\n    // ! should scroll even without new messages\r\n    /* if(!mids.length) {\r\n      return;\r\n    } */\r\n\r\n    if(!scrolledDown) {\r\n      scrolledDown = this.scrolledDown && (\r\n        !this.scrollingToBubble ||\r\n        this.scrollingToBubble === this.getLastBubble() ||\r\n        this.scrollingToBubble === this.chatInner\r\n      );\r\n    }\r\n\r\n    const middleware = this.getMiddleware();\r\n    const {isPaddingNeeded, unsetPadding} = this.setTopPadding(middleware);\r\n\r\n    const promise = this.performHistoryResult({history: [message]}, false);\r\n    if(scrolledDown) {\r\n      promise.then(() => {\r\n        if(!middleware()) return;\r\n        // this.log('renderNewMessagesByIDs: messagesQueuePromise after', this.scrollable.isScrolledDown);\r\n        // this.scrollable.scrollTo(this.scrollable.scrollHeight, 'top', true, true, 5000);\r\n        // const bubble = this.bubbles[Math.max(...mids)];\r\n\r\n        let bubble: HTMLElement;\r\n        if(this.chat.type === 'scheduled') {\r\n          bubble = this.bubbles[message.mid];\r\n        }\r\n\r\n        const promise = bubble ? this.scrollToBubbleEnd(bubble) : this.scrollToEnd();\r\n        if(isPaddingNeeded) {\r\n          // it will be called only once even if was set multiple times (that won't happen)\r\n          promise.then(unsetPadding);\r\n        }\r\n\r\n        // this.scrollable.scrollIntoViewNew(this.chatInner, 'end');\r\n\r\n        /* setTimeout(() => {\r\n          this.log('messagesQueuePromise afterafter:', this.chatInner.childElementCount, this.scrollable.scrollHeight);\r\n        }, 10); */\r\n      });\r\n    }\r\n\r\n    return promise;\r\n  }\r\n\r\n  public getLastBubble() {\r\n    const group = this.bubbleGroups.getLastGroup();\r\n    return group?.lastItem?.bubble;\r\n  }\r\n\r\n  public scrollToBubble(\r\n    element: HTMLElement,\r\n    position: ScrollLogicalPosition,\r\n    forceDirection?: FocusDirection,\r\n    forceDuration?: number\r\n  ) {\r\n    const bubble = findUpClassName(element, 'bubble');\r\n\r\n    if(!element.parentElement) {\r\n      this.log.error('element is not connected', bubble);\r\n    }\r\n\r\n    let fallbackToElementStartWhenCentering: HTMLElement;\r\n    // * if it's a start, then scroll to start of the group\r\n    if(bubble && position !== 'end') {\r\n      const item = this.bubbleGroups.getItemByBubble(bubble);\r\n      if(item.group.firstItem === item && whichChild(item.group.container) === (this.stickyIntersector ? STICKY_OFFSET : 1)) {\r\n        const dateGroup = item.group.container.parentElement;\r\n        // if(whichChild(dateGroup) === 0) {\r\n        fallbackToElementStartWhenCentering = dateGroup;\r\n        // position = 'start';\r\n        // element = dateGroup;\r\n        // }\r\n      }\r\n    }\r\n\r\n    // const isLastBubble = this.getLastBubble() === bubble;\r\n    /* if(isLastBubble) {\r\n      element = this.getLastDateGroup();\r\n    } */\r\n\r\n    const margin = 4; // * 4 = .25rem\r\n    /* if(isLastBubble && this.chat.type === 'chat' && this.bubblesContainer.classList.contains('is-chat-input-hidden')) {\r\n      margin = 20;\r\n    } */\r\n\r\n    const isChangingHeight = (this.chat.input.messageInput && this.chat.input.messageInput.classList.contains('is-changing-height')) || this.chat.container.classList.contains('is-toggling-helper');\r\n    const promise = this.scrollable.scrollIntoViewNew({\r\n      element,\r\n      position,\r\n      margin,\r\n      forceDirection,\r\n      forceDuration,\r\n      axis: 'y',\r\n      getNormalSize: isChangingHeight ? ({rect}) => {\r\n        // return rect.height;\r\n\r\n        let height = windowSize.height;\r\n        // height -= this.chat.topbar.container.getBoundingClientRect().height;\r\n        height -= this.container.offsetTop;\r\n        height -= mediaSizes.isMobile || windowSize.height < 570 ? 58 : 78;\r\n        return height;\r\n\r\n        /* const rowsWrapperHeight = this.chat.input.rowsWrapper.getBoundingClientRect().height;\r\n        const diff = rowsWrapperHeight - 54;\r\n        return rect.height + diff; */\r\n      } : undefined,\r\n      fallbackToElementStartWhenCentering,\r\n      startCallback: (dimensions) => {\r\n        // this.onScroll(true, this.scrolledDown && dimensions.distanceToEnd <= SCROLLED_DOWN_THRESHOLD ? undefined : dimensions);\r\n        this.onScroll(true, dimensions);\r\n      }\r\n    });\r\n\r\n    // fix flickering date when opening unread chat and focusing message\r\n    if(forceDirection === FocusDirection.Static) {\r\n      this.scrollable.lastScrollPosition = this.scrollable.scrollTop;\r\n    }\r\n\r\n    return promise;\r\n  }\r\n\r\n  public scrollToEnd() {\r\n    return this.scrollToBubbleEnd(this.chatInner);\r\n  }\r\n\r\n  public async scrollToBubbleEnd(bubble: HTMLElement) {\r\n    /* if(DEBUG) {\r\n      this.log('scrollToNewLastBubble: will scroll into view:', bubble);\r\n    } */\r\n\r\n    if(bubble) {\r\n      this.scrollingToBubble = bubble;\r\n      const middleware = this.getMiddleware();\r\n      await this.scrollToBubble(bubble, 'end', undefined, undefined);\r\n      if(!middleware()) return;\r\n      this.scrollingToBubble = undefined;\r\n    }\r\n  }\r\n\r\n  // ! can't get it by chatInner.lastElementChild because placeholder can be the last...\r\n  // private getLastDateGroup() {\r\n  //   let lastTime = 0, lastElem: HTMLElement;\r\n  //   for(const i in this.dateMessages) {\r\n  //     const dateMessage = this.dateMessages[i];\r\n  //     if(dateMessage.firstTimestamp > lastTime) {\r\n  //       lastElem = dateMessage.container;\r\n  //       lastTime = dateMessage.firstTimestamp;\r\n  //     }\r\n  //   }\r\n\r\n  //   return lastElem;\r\n  // }\r\n\r\n  public async scrollToBubbleIfLast(bubble: HTMLElement) {\r\n    if(this.getLastBubble() === bubble) {\r\n      // return this.scrollToBubbleEnd(bubble);\r\n      return this.scrollToEnd();\r\n    }\r\n  }\r\n\r\n  public highlightBubble(element: HTMLElement) {\r\n    const datasetKey = 'highlightTimeout';\r\n    if(element.dataset[datasetKey]) {\r\n      clearTimeout(+element.dataset[datasetKey]);\r\n      element.classList.remove('is-highlighted');\r\n      void element.offsetWidth; // reflow\r\n    }\r\n\r\n    element.classList.add('is-highlighted');\r\n    element.dataset[datasetKey] = '' + setTimeout(() => {\r\n      element.classList.remove('is-highlighted');\r\n      delete element.dataset[datasetKey];\r\n    }, 2000);\r\n  }\r\n\r\n  private createDateBubble(timestamp: number, date: Date = new Date(timestamp * 1000)) {\r\n    let dateElement: HTMLElement;\r\n\r\n    const today = new Date();\r\n    today.setHours(0, 0, 0, 0);\r\n\r\n    const isScheduled = this.chat.type === 'scheduled';\r\n\r\n    if(today.getTime() === date.getTime()) {\r\n      dateElement = i18n(isScheduled ? 'Chat.Date.ScheduledForToday' : 'Date.Today');\r\n    } else if(isScheduled && timestamp === SEND_WHEN_ONLINE_TIMESTAMP) {\r\n      dateElement = i18n('MessageScheduledUntilOnline');\r\n    } else {\r\n      const options: Intl.DateTimeFormatOptions = {\r\n        day: 'numeric',\r\n        month: 'long'\r\n      };\r\n\r\n      if(date.getFullYear() !== today.getFullYear()) {\r\n        options.year = 'numeric';\r\n      }\r\n\r\n      dateElement = new I18n.IntlDateElement({\r\n        date,\r\n        options\r\n      }).element;\r\n\r\n      if(isScheduled) {\r\n        dateElement = i18n('Chat.Date.ScheduledFor', [dateElement]);\r\n      }\r\n    }\r\n\r\n    const bubble = document.createElement('div');\r\n    bubble.className = 'bubble service is-date';\r\n    const bubbleContent = document.createElement('div');\r\n    bubbleContent.classList.add('bubble-content');\r\n    const serviceMsg = document.createElement('div');\r\n    serviceMsg.classList.add('service-msg');\r\n\r\n    serviceMsg.append(dateElement);\r\n\r\n    bubbleContent.append(serviceMsg);\r\n    bubble.append(bubbleContent);\r\n\r\n    return bubble;\r\n  }\r\n\r\n  public getDateForDateContainer(timestamp: number) {\r\n    const date = new Date(timestamp * 1000);\r\n    date.setHours(0, 0, 0);\r\n    return {date, dateTimestamp: date.getTime()};\r\n  }\r\n\r\n  public getDateContainerByTimestamp(timestamp: number) {\r\n    const {date, dateTimestamp} = this.getDateForDateContainer(timestamp);\r\n    if(!this.dateMessages[dateTimestamp]) {\r\n      const bubble = this.createDateBubble(timestamp, date);\r\n      // bubble.classList.add('is-sticky');\r\n      const fakeBubble = this.createDateBubble(timestamp, date);\r\n      fakeBubble.classList.add('is-fake');\r\n\r\n      const container = document.createElement('section');\r\n      container.className = 'bubbles-date-group';\r\n      container.append(bubble, fakeBubble);\r\n\r\n      this.dateMessages[dateTimestamp] = {\r\n        div: bubble,\r\n        container,\r\n        firstTimestamp: date.getTime()\r\n      };\r\n\r\n      const haveTimestamps = getObjectKeysAndSort(this.dateMessages, 'asc');\r\n      const length = haveTimestamps.length;\r\n      let i = 0, insertBefore: HTMLElement; // there can be 'first bubble' (e.g. bot description) so can't insert by index\r\n      for(; i < haveTimestamps.length; ++i) {\r\n        const t = haveTimestamps[i];\r\n        insertBefore = this.dateMessages[t].container;\r\n        if(dateTimestamp < t) {\r\n          break;\r\n        }\r\n      }\r\n\r\n      if(i === length && insertBefore) {\r\n        insertBefore = insertBefore.nextElementSibling as HTMLElement;\r\n      }\r\n\r\n      if(!insertBefore) {\r\n        this.chatInner.append(container);\r\n      } else {\r\n        this.chatInner.insertBefore(container, insertBefore);\r\n      }\r\n\r\n      if(this.stickyIntersector) {\r\n        this.stickyIntersector.observeStickyHeaderChanges(container);\r\n      }\r\n\r\n      if(this.chatInner.parentElement) {\r\n        this.container.classList.add('has-groups');\r\n      }\r\n    }\r\n\r\n    return this.dateMessages[dateTimestamp];\r\n  }\r\n\r\n  private destroyScrollable() {\r\n    this.scrollable.destroy();\r\n  }\r\n\r\n  public destroy() {\r\n    // this.chat.log.error('Bubbles destroying');\r\n\r\n    this.destroyScrollable();\r\n\r\n    this.listenerSetter.removeAll();\r\n\r\n    this.lazyLoadQueue.clear();\r\n    this.observer && this.observer.disconnect();\r\n    this.stickyIntersector && this.stickyIntersector.disconnect();\r\n\r\n    delete this.lazyLoadQueue;\r\n    this.observer && delete this.observer;\r\n    this.stickyIntersector && delete this.stickyIntersector;\r\n  }\r\n\r\n  public cleanup(bubblesToo = false) {\r\n    this.bubbles = {}; // clean it before so sponsored message won't be deleted faster on peer changing\r\n    // //console.time('appImManager cleanup');\r\n    this.setLoaded('top', false, false);\r\n    this.setLoaded('bottom', false, false);\r\n\r\n    // cancel scroll\r\n    cancelAnimationByKey(this.scrollable.container);\r\n\r\n    // do not wait ending of previous scale animation\r\n    interruptHeavyAnimation();\r\n\r\n    if(TEST_SCROLL !== undefined) {\r\n      TEST_SCROLL = TEST_SCROLL_TIMES;\r\n    }\r\n\r\n    this.skippedMids.clear();\r\n    this.dateMessages = {};\r\n    this.bubbleGroups.cleanup();\r\n    this.unreadOut.clear();\r\n    this.needUpdate.length = 0;\r\n    this.lazyLoadQueue.clear();\r\n    this.renderNewPromises.clear();\r\n\r\n    // clear messages\r\n    if(bubblesToo) {\r\n      this.scrollable.container.textContent = '';\r\n      this.chatInner.textContent = '';\r\n      this.cleanupPlaceholders();\r\n    }\r\n\r\n    this.firstUnreadBubble = null;\r\n    this.attachedUnreadBubble = false;\r\n\r\n    this.messagesQueue.length = 0;\r\n    this.messagesQueuePromise = null;\r\n\r\n    this.getHistoryTopPromise = this.getHistoryBottomPromise = undefined;\r\n    this.fetchNewPromise = undefined;\r\n    this.getSponsoredMessagePromise = undefined;\r\n\r\n    if(this.stickyIntersector) {\r\n      this.stickyIntersector.disconnect();\r\n    }\r\n\r\n    if(this.observer) {\r\n      this.observer.disconnect();\r\n\r\n      this.unreaded.clear();\r\n      this.unreadedSeen.clear();\r\n      this.readPromise = undefined;\r\n\r\n      this.viewsMids.clear();\r\n    }\r\n\r\n    this.middleware.clean();\r\n\r\n    this.onAnimateLadder = undefined;\r\n    this.resolveLadderAnimation = undefined;\r\n    this.attachPlaceholderOnRender = undefined;\r\n    this.emptyPlaceholderBubble = undefined;\r\n    this.sponsoredMessage = undefined;\r\n    this.previousStickyDate = undefined;\r\n\r\n    this.scrollingToBubble = undefined;\r\n    // //console.timeEnd('appImManager cleanup');\r\n\r\n    this.isTopPaddingSet = false;\r\n\r\n    this.renderingMessages.clear();\r\n    this.bubblesToEject.clear();\r\n    this.bubblesToReplace.clear();\r\n\r\n    // this.reactions.clear();\r\n\r\n    if(this.isScrollingTimeout) {\r\n      clearTimeout(this.isScrollingTimeout);\r\n      this.isScrollingTimeout = 0;\r\n    }\r\n\r\n    this.container.classList.remove('has-sticky-dates');\r\n    this.scrollable.cancelMeasure();\r\n  }\r\n\r\n  private cleanupPlaceholders(bubble = this.emptyPlaceholderBubble) {\r\n    if(bubble) {\r\n      bubble.remove();\r\n\r\n      if(this.emptyPlaceholderBubble === bubble) {\r\n        this.emptyPlaceholderBubble = undefined;\r\n      }\r\n    }\r\n  }\r\n\r\n  public async setPeer(samePeer: boolean, peerId: PeerId, lastMsgId?: number, startParam?: string): Promise<{cached?: boolean, promise: Chat['setPeerPromise']}> {\r\n    const tempId = ++this.setPeerTempId;\r\n\r\n    if(!peerId) {\r\n      this.cleanup(true);\r\n      this.preloader.detach();\r\n      return null;\r\n    }\r\n\r\n    const perf = performance.now();\r\n    const log = this.log.bindPrefix('setPeer');\r\n    log.warn('start');\r\n\r\n    const middleware = () => {\r\n      return this.setPeerTempId === tempId;\r\n    };\r\n\r\n    const m = middlewarePromise(middleware, PEER_CHANGED_ERROR);\r\n\r\n    if(!samePeer) {\r\n      await m(this.chat.onChangePeer(m));\r\n    }\r\n\r\n    /* if(samePeer && this.chat.setPeerPromise) {\r\n      return {cached: true, promise: this.chat.setPeerPromise};\r\n    } */\r\n\r\n    const chatType = this.chat.type;\r\n\r\n    if(chatType === 'scheduled' || this.chat.isRestricted) {\r\n      lastMsgId = 0;\r\n    }\r\n\r\n    const historyStorage = await m(this.chat.getHistoryStorage());\r\n    const topMessage = chatType === 'pinned' ? await m(this.managers.appMessagesManager.getPinnedMessagesMaxId(peerId)) : historyStorage.maxId ?? 0;\r\n    const isTarget = lastMsgId !== undefined;\r\n\r\n    // * this one will fix topMessage for null message in history (e.g. channel comments with only 1 comment and it is a topMessage)\r\n    /* if(chatType !== 'pinned' && topMessage && !historyStorage.history.slice.includes(topMessage)) {\r\n      topMessage = 0;\r\n    } */\r\n\r\n    let followingUnread: boolean;\r\n    let readMaxId = 0, savedPosition: ReturnType<AppImManager['getChatSavedPosition']>, overrideAdditionMsgId: number;\r\n    if(!isTarget) {\r\n      if(!samePeer) {\r\n        savedPosition = this.chat.appImManager.getChatSavedPosition(this.chat);\r\n      }\r\n\r\n      if(savedPosition) {\r\n\r\n      } else if(topMessage) {\r\n        readMaxId = await m(this.managers.appMessagesManager.getReadMaxIdIfUnread(peerId, this.chat.threadId));\r\n        const dialog = await m(this.managers.appMessagesManager.getDialogOnly(peerId));\r\n        if(/* dialog.unread_count */readMaxId && !samePeer && (!dialog || dialog.unread_count !== 1)) {\r\n          const foundSlice = historyStorage.history.findSliceOffset(readMaxId);\r\n          if(foundSlice && foundSlice.slice.isEnd(SliceEnd.Bottom)) {\r\n            overrideAdditionMsgId = foundSlice.slice[foundSlice.offset - 25] || foundSlice.slice[0] || readMaxId;\r\n          }\r\n\r\n          followingUnread = !isTarget;\r\n          lastMsgId = readMaxId;\r\n        } else {\r\n          lastMsgId = topMessage;\r\n          // lastMsgID = topMessage;\r\n        }\r\n      }\r\n    }\r\n\r\n    const isJump = lastMsgId !== topMessage/*  && overrideAdditionMsgId === undefined */;\r\n\r\n    if(startParam === undefined && await m(this.chat.isStartButtonNeeded())) {\r\n      startParam = BOT_START_PARAM;\r\n    }\r\n\r\n    if(samePeer) {\r\n      const mounted = await m(this.getMountedBubble(lastMsgId));\r\n      if(mounted) {\r\n        if(isTarget) {\r\n          this.scrollToBubble(mounted.bubble, 'center');\r\n          this.highlightBubble(mounted.bubble);\r\n          this.chat.dispatchEvent('setPeer', lastMsgId, false);\r\n        } else if(topMessage && !isJump) {\r\n          // log('will scroll down', this.scroll.scrollTop, this.scroll.scrollHeight);\r\n          // scrollable.setScrollTopSilently(scrollable.scrollHeight);\r\n          this.scrollToEnd();\r\n          this.chat.dispatchEvent('setPeer', lastMsgId, true);\r\n        }\r\n\r\n        if(startParam !== undefined) {\r\n          this.chat.input.setStartParam(startParam);\r\n        }\r\n\r\n        return null;\r\n      }\r\n    } else {\r\n      if(this.peerId) { // * set new queue id if new peer (setting not from 0)\r\n        this.lazyLoadQueue.queueId = ++queueId;\r\n        this.managers.apiFileManager.setQueueId(this.chat.bubbles.lazyLoadQueue.queueId);\r\n      }\r\n\r\n      this.replyFollowHistory.length = 0;\r\n\r\n      this.passEntities = {\r\n        messageEntityBotCommand: await m(this.managers.appPeersManager.isAnyGroup(peerId)) || this.chat.isBot\r\n      };\r\n    }\r\n\r\n    if(DEBUG) {\r\n      log('setPeer peerId:', peerId, historyStorage, lastMsgId, topMessage);\r\n    }\r\n\r\n    // add last message, bc in getHistory will load < max_id\r\n    const additionMsgId = overrideAdditionMsgId ?? (isJump || chatType === 'scheduled' || this.chat.isRestricted ? 0 : topMessage);\r\n\r\n    let maxBubbleId = 0;\r\n    if(samePeer) {\r\n      const el = this.getBubbleByPoint('bottom'); // ! this may not work if being called when chat is hidden\r\n      // this.chat.log('[PM]: setCorrectIndex: get last element perf:', performance.now() - perf, el);\r\n      if(el) {\r\n        maxBubbleId = +el.dataset.mid;\r\n      }\r\n\r\n      if(maxBubbleId <= 0) {\r\n        maxBubbleId = Math.max(...Object.keys(this.bubbles).map((mid) => +mid));\r\n      }\r\n    } else {\r\n      this.isFirstLoad = true;\r\n      this.destroyResizeObserver();\r\n    }\r\n\r\n    const oldChatInner = this.chatInner;\r\n    const oldPlaceholderBubble = this.emptyPlaceholderBubble;\r\n    this.cleanup();\r\n    const chatInner = this.chatInner = document.createElement('div');\r\n    if(samePeer) {\r\n      chatInner.className = oldChatInner.className;\r\n      chatInner.classList.remove('disable-hover', 'is-scrolling');\r\n    } else {\r\n      chatInner.classList.add('bubbles-inner');\r\n    }\r\n\r\n    this.lazyLoadQueue.lock();\r\n\r\n    // const haveToScrollToBubble = (topMessage && (isJump || samePeer)) || isTarget;\r\n    const haveToScrollToBubble = samePeer || (topMessage && isJump) || isTarget;\r\n    const fromUp = maxBubbleId > 0 && (!lastMsgId || maxBubbleId < lastMsgId || lastMsgId < 0);\r\n    const scrollFromDown = !fromUp && samePeer;\r\n    const scrollFromUp = !scrollFromDown && fromUp/*  && (samePeer || forwardingUnread) */;\r\n    this.willScrollOnLoad = scrollFromDown || scrollFromUp;\r\n\r\n    this.setPeerOptions = {\r\n      lastMsgId,\r\n      topMessage\r\n    };\r\n\r\n    let result: Awaited<ReturnType<ChatBubbles['getHistory']>>;\r\n    if(!savedPosition) {\r\n      result = await m(this.getHistory1(lastMsgId, true, isJump, additionMsgId));\r\n    } else {\r\n      result = {\r\n        promise: getHeavyAnimationPromise().then(() => {\r\n          return this.performHistoryResult({history: savedPosition.mids}, true);\r\n        }) as any,\r\n        cached: true,\r\n        waitPromise: Promise.resolve()\r\n      };\r\n    }\r\n\r\n    this.setPeerCached = result.cached;\r\n\r\n    log.warn('got history');// warning\r\n\r\n    const {promise, cached} = result;\r\n\r\n    if(!cached && !samePeer) {\r\n      await m(this.chat.finishPeerChange(isTarget, isJump, lastMsgId, startParam));\r\n      this.scrollable.container.textContent = '';\r\n      // oldContainer.textContent = '';\r\n      // oldChatInner.remove();\r\n      this.preloader.attach(this.container);\r\n    }\r\n\r\n    /* this.ladderDeferred && this.ladderDeferred.resolve();\r\n    this.ladderDeferred = deferredPromise<void>(); */\r\n\r\n    animationIntersector.lockGroup(CHAT_ANIMATION_GROUP);\r\n    const setPeerPromise = m(promise).then(async() => {\r\n      log.warn('promise fulfilled');\r\n\r\n      const mountedByLastMsgId = haveToScrollToBubble ? await m(lastMsgId ? this.getMountedBubble(lastMsgId) : {bubble: this.getLastBubble()}) : undefined;\r\n      if(cached && !samePeer) {\r\n        log.warn('finishing peer change');\r\n        await m(this.chat.finishPeerChange(isTarget, isJump, lastMsgId, startParam)); // * \r\n        log.warn('finished peer change');\r\n      }\r\n\r\n      this.preloader.detach();\r\n\r\n      if(this.resolveLadderAnimation) {\r\n        this.resolveLadderAnimation();\r\n        this.resolveLadderAnimation = undefined;\r\n      }\r\n\r\n      this.setPeerCached = undefined;\r\n\r\n      // this.ladderDeferred.resolve();\r\n\r\n      const scrollable = this.scrollable;\r\n      scrollable.lastScrollDirection = 0;\r\n      scrollable.lastScrollPosition = 0;\r\n      replaceContent(scrollable.container, chatInner);\r\n      // this.chat.topbar.container.nextElementSibling.replaceWith(container);\r\n\r\n      if(oldPlaceholderBubble) {\r\n        this.cleanupPlaceholders(oldPlaceholderBubble);\r\n      }\r\n\r\n      if(this.attachPlaceholderOnRender) {\r\n        this.attachPlaceholderOnRender();\r\n      }\r\n\r\n      if(!isTarget && this.chat.type === 'chat' && this.chat.topbar.pinnedMessage) {\r\n        this.chat.topbar.pinnedMessage.setCorrectIndex(0);\r\n      }\r\n\r\n      this.container.classList.toggle('has-groups', !!Object.keys(this.dateMessages).length);\r\n\r\n      log.warn('mounted chat', this.chatInner === chatInner, this.chatInner.parentElement, performance.now() - perf);\r\n\r\n      animationIntersector.unlockGroup(CHAT_ANIMATION_GROUP);\r\n      animationIntersector.checkAnimations(false, CHAT_ANIMATION_GROUP/* , true */);\r\n\r\n      // fastRaf(() => {\r\n      this.lazyLoadQueue.unlock();\r\n      // });\r\n\r\n      // if(dialog && lastMsgID && lastMsgID !== topMessage && (this.bubbles[lastMsgID] || this.firstUnreadBubble)) {\r\n      if(savedPosition) {\r\n        scrollable.setScrollTopSilently(savedPosition.top);\r\n        /* const mountedByLastMsgId = this.getMountedBubble(lastMsgId);\r\n        let bubble: HTMLElement = mountedByLastMsgId?.bubble;\r\n        if(!bubble?.parentElement) {\r\n          bubble = this.findNextMountedBubbleByMsgId(lastMsgId);\r\n        }\r\n\r\n        if(bubble) {\r\n          const top = bubble.getBoundingClientRect().top;\r\n          const distance = savedPosition.top - top;\r\n          scrollable.scrollTop += distance;\r\n        } */\r\n      } else if(haveToScrollToBubble) {\r\n        let unsetPadding: () => void;\r\n        if(scrollFromDown) {\r\n          scrollable.setScrollTopSilently(99999);\r\n        } else if(scrollFromUp) {\r\n          const set = this.setTopPadding();\r\n          if(set.isPaddingNeeded) {\r\n            unsetPadding = set.unsetPadding;\r\n          }\r\n\r\n          scrollable.setScrollTopSilently(0);\r\n        }\r\n\r\n        // const mountedByLastMsgId = lastMsgId ? this.getMountedBubble(lastMsgId) : {bubble: this.getLastBubble()};\r\n        let bubble: HTMLElement = (followingUnread && this.firstUnreadBubble) || mountedByLastMsgId?.bubble;\r\n        if(!bubble?.parentElement) {\r\n          bubble = this.findNextMountedBubbleByMsgId(lastMsgId, false) || this.findNextMountedBubbleByMsgId(lastMsgId, true);\r\n        }\r\n\r\n        let promise: Promise<void>;\r\n        // ! sometimes there can be no bubble\r\n        if(bubble) {\r\n          const lastBubble = this.getLastBubble();\r\n          const position: ScrollLogicalPosition = followingUnread ? 'start' : (!isJump && !isTarget && lastBubble === bubble ? 'end' : 'center');\r\n\r\n          if(position === 'end' && lastBubble === bubble && samePeer) {\r\n            promise = this.scrollToEnd();\r\n          } else {\r\n            promise = this.scrollToBubble(bubble, position, !samePeer ? FocusDirection.Static : undefined);\r\n          }\r\n\r\n          if(!followingUnread && isTarget) {\r\n            this.highlightBubble(bubble);\r\n          }\r\n        }\r\n\r\n        if(unsetPadding) {\r\n          (promise || Promise.resolve()).then(() => {\r\n            unsetPadding();\r\n          });\r\n        }\r\n      } else {\r\n        scrollable.setScrollTopSilently(99999);\r\n      }\r\n\r\n      // if(!cached) {\r\n      this.onRenderScrollSet();\r\n      // }\r\n\r\n      this.onScroll();\r\n\r\n      const afterSetPromise = Promise.all([setPeerPromise, getHeavyAnimationPromise()]);\r\n      afterSetPromise.then(() => { // check whether list isn't full\r\n        scrollable.checkForTriggers();\r\n\r\n        // if(cached) {\r\n        // this.onRenderScrollSet();\r\n        // }\r\n      });\r\n\r\n      this.chat.dispatchEvent('setPeer', lastMsgId, !isJump);\r\n\r\n      Promise.all([\r\n        this.setFetchReactionsInterval(afterSetPromise),\r\n        this.setFetchHistoryInterval({\r\n          afterSetPromise,\r\n          lastMsgId,\r\n          samePeer,\r\n          savedPosition,\r\n          topMessage\r\n        })\r\n      ]).then(() => {\r\n        log('scrolledAllDown:', scrollable.loadedAll.bottom);\r\n        // if(!this.unreaded.length && dialog) { // lol\r\n        if(scrollable.loadedAll.bottom && topMessage && !this.unreaded.size) { // lol\r\n          this.onScrolledAllDown();\r\n        }\r\n      });\r\n\r\n      if(chatType === 'chat') {\r\n        const dialog = await m(this.managers.appMessagesManager.getDialogOnly(peerId));\r\n        if(dialog?.pFlags.unread_mark) {\r\n          this.managers.appMessagesManager.markDialogUnread(peerId, true);\r\n        }\r\n      }\r\n\r\n      // this.chatInner.classList.remove('disable-hover', 'is-scrolling'); // warning, performance!\r\n    }).catch((err) => {\r\n      log.error('getHistory promise error:', err);\r\n      if(!middleware()) {\r\n        this.preloader.detach();\r\n      }\r\n\r\n      throw err;\r\n    });\r\n\r\n    return {cached, promise: setPeerPromise};\r\n  }\r\n\r\n  private async setFetchReactionsInterval(afterSetPromise: Promise<any>) {\r\n    const middleware = this.getMiddleware();\r\n    const needReactionsInterval = this.chat.isChannel;\r\n    if(needReactionsInterval) {\r\n      const fetchReactions = async() => {\r\n        if(!middleware()) return;\r\n\r\n        const mids: number[] = [];\r\n        for(const mid in this.bubbles) {\r\n          let message = await this.chat.getMessage(+mid);\r\n          if(message?._ !== 'message') {\r\n            continue;\r\n          }\r\n\r\n          message = await this.managers.appMessagesManager.getGroupsFirstMessage(message);\r\n          mids.push(message.mid);\r\n        }\r\n\r\n        const promise = mids.length ? this.managers.appReactionsManager.getMessagesReactions(this.peerId, mids) : Promise.resolve();\r\n        promise.then(() => {\r\n          setTimeout(fetchReactions, 10e3);\r\n        });\r\n      };\r\n\r\n      Promise.all([afterSetPromise, getHeavyAnimationPromise(), pause(500)]).then(() => {\r\n        fetchReactions();\r\n      });\r\n    }\r\n  }\r\n\r\n  private async setFetchHistoryInterval({\r\n    lastMsgId,\r\n    topMessage,\r\n    afterSetPromise,\r\n    savedPosition,\r\n    samePeer\r\n  }: {\r\n    lastMsgId: number,\r\n    topMessage: number,\r\n    afterSetPromise: Promise<any>,\r\n    savedPosition: ChatSavedPosition,\r\n    samePeer: boolean\r\n  }) {\r\n    const middleware = this.getMiddleware();\r\n    const peerId = this.peerId;\r\n\r\n    const needFetchInterval = await this.managers.appMessagesManager.isFetchIntervalNeeded(peerId);\r\n    const needFetchNew = savedPosition || needFetchInterval;\r\n    if(!needFetchNew) {\r\n      return;\r\n    }\r\n\r\n    await afterSetPromise;\r\n    if(!middleware()) {\r\n      return;\r\n    }\r\n\r\n    this.setLoaded('bottom', false);\r\n    this.scrollable.checkForTriggers();\r\n\r\n    if(!needFetchInterval) {\r\n      return;\r\n    }\r\n\r\n    const f = () => {\r\n      this.fetchNewPromise = new Promise<void>(async(resolve) => {\r\n        if(!middleware() || !(await this.managers.appMessagesManager.isFetchIntervalNeeded(peerId))) {\r\n          resolve();\r\n          return;\r\n        }\r\n\r\n        this.managers.appMessagesManager.getNewHistory(peerId, this.chat.threadId).then((result) => {\r\n          if(!middleware() || !result) {\r\n            resolve();\r\n            return;\r\n          }\r\n\r\n          const {isBottomEnd} = result;\r\n          if(this.scrollable.loadedAll.bottom && this.scrollable.loadedAll.bottom !== isBottomEnd) {\r\n            this.setLoaded('bottom', isBottomEnd);\r\n            this.onScroll();\r\n          }\r\n\r\n          setTimeout(f, 30e3);\r\n          resolve();\r\n        });\r\n      }).finally(() => {\r\n        this.fetchNewPromise = undefined;\r\n      });\r\n    };\r\n\r\n    if(samePeer) {\r\n      setTimeout(f, 30e3);\r\n    } else {\r\n      f();\r\n    }\r\n  }\r\n\r\n  public async onScrolledAllDown() {\r\n    if(this.chat.type === 'chat' || this.chat.type === 'discussion') {\r\n      const historyMaxId = await this.chat.getHistoryMaxId();\r\n      this.managers.appMessagesManager.readHistory(this.peerId, historyMaxId, this.chat.threadId, true);\r\n    }\r\n  }\r\n\r\n  public async finishPeerChange() {\r\n    const [isChannel, canWrite, isAnyGroup] = await Promise.all([\r\n      this.chat.isChannel,\r\n      this.chat.canSend(),\r\n      this.chat.isAnyGroup\r\n    ]);\r\n\r\n    return () => {\r\n      this.chatInner.classList.toggle('has-rights', canWrite);\r\n      this.container.classList.toggle('is-chat-input-hidden', !canWrite);\r\n\r\n      this.chatInner.classList.toggle('is-chat', isAnyGroup);\r\n      this.chatInner.classList.toggle('is-channel', isChannel);\r\n\r\n      this.createResizeObserver();\r\n    };\r\n  }\r\n\r\n  public renderMessagesQueue(options: ChatBubbles['messagesQueue'][0]) {\r\n    this.messagesQueue.push(options);\r\n    return this.setMessagesQueuePromise();\r\n  }\r\n\r\n  public setMessagesQueuePromise() {\r\n    if(!this.messagesQueue.length) return Promise.resolve();\r\n\r\n    if(this.messagesQueuePromise) {\r\n      return this.messagesQueuePromise;\r\n    }\r\n\r\n    const middleware = this.getMiddleware();\r\n    const log = this.log.bindPrefix('queue');\r\n    const possibleError = PEER_CHANGED_ERROR;\r\n    const m = middlewarePromise(middleware, possibleError);\r\n\r\n    const processQueue = async(): Promise<void> => {\r\n      log('start');\r\n\r\n      // if(!this.chat.setPeerPromise) {\r\n      //   await pause(10000000);\r\n      // }\r\n\r\n      const renderQueue = this.messagesQueue.slice();\r\n      this.messagesQueue.length = 0;\r\n\r\n      const renderQueuePromises = renderQueue.map((promise) => {\r\n        const perf = performance.now();\r\n        promise.then((details) => {\r\n          log('render message time', performance.now() - perf, details);\r\n        });\r\n\r\n        return promise;\r\n      });\r\n\r\n      let loadQueue = await m(Promise.all(renderQueuePromises));\r\n      const filterQueue = (queue: typeof loadQueue) => {\r\n        return queue.filter((details) => {\r\n          // message can be deleted during rendering\r\n          return details && this.bubbles[details.bubble.dataset.mid] === details.bubble;\r\n        });\r\n      };\r\n\r\n      loadQueue = filterQueue(loadQueue);\r\n\r\n      log('messages rendered');\r\n\r\n      const reverse = loadQueue[0]?.reverse;\r\n\r\n      const {groups, avatarPromises} = this.groupBubbles(loadQueue.filter((details) => details.updatePosition));\r\n\r\n      // if(groups.length > 2 && loadQueue.length === 1) {\r\n      //   debugger;\r\n      // }\r\n\r\n      const promises = loadQueue.reduce((acc, details) => {\r\n        const perf = performance.now();\r\n\r\n        const promises = details.promises.slice();\r\n        const timePromises = promises.map(async(promise) => (await promise, performance.now() - perf));\r\n        Promise.all(timePromises).then((times) => {\r\n          log.groupCollapsed('media message time', performance.now() - perf, details, times);\r\n          times.forEach((time, idx) => {\r\n            log('media message time', time, idx, promises[idx]);\r\n          });\r\n          log.groupEnd();\r\n        });\r\n\r\n        // if(details.updatePosition) {\r\n        //   if(res) {\r\n        //     groups.add(res.group);\r\n        //     if(details.needAvatar) {\r\n        //       details.promises.push(res.group.createAvatar(details.message));\r\n        //     }\r\n        //   }\r\n        // }\r\n\r\n        acc.push(...details.promises);\r\n        return acc;\r\n      }, [] as Promise<any>[]);\r\n\r\n      promises.push(...avatarPromises);\r\n      // promises.push(pause(200));\r\n\r\n      // *    ,     reply  - ,    \r\n      // *     -     ,       \r\n      // promises.push(getHeavyAnimationPromise());\r\n\r\n      log('media promises to call', promises, loadQueue, this.isHeavyAnimationInProgress);\r\n      await m(Promise.all([...promises, this.setUnreadDelimiter()])); //    \r\n      await m(fastRafPromise()); // have to be the last\r\n      log('media promises end');\r\n\r\n      loadQueue = filterQueue(loadQueue);\r\n\r\n      const {restoreScroll, scrollSaver} = this.prepareToSaveScroll(reverse);\r\n      // if(this.messagesQueueOnRender) {\r\n      // this.messagesQueueOnRender();\r\n      // }\r\n\r\n      if(this.messagesQueueOnRenderAdditional) {\r\n        this.messagesQueueOnRenderAdditional();\r\n      }\r\n\r\n      this.ejectBubbles();\r\n      for(const [bubble, oldBubble] of this.bubblesToReplace) {\r\n        if(scrollSaver) {\r\n          scrollSaver.replaceSaved(oldBubble, bubble);\r\n        }\r\n\r\n        if(!loadQueue.find((details) => details.bubble === bubble)) {\r\n          continue;\r\n        }\r\n\r\n        const item = this.bubbleGroups.getItemByBubble(bubble);\r\n        item.mounted = false;\r\n        if(!groups.includes(item.group)) {\r\n          groups.push(item.group);\r\n        }\r\n\r\n        this.bubblesToReplace.delete(bubble);\r\n      }\r\n\r\n      if(this.chat.selection.isSelecting) {\r\n        loadQueue.forEach(({bubble}) => {\r\n          this.chat.selection.toggleElementCheckbox(bubble, true);\r\n        });\r\n      }\r\n\r\n      loadQueue.forEach(({message, bubble, updatePosition}) => {\r\n        if(message.pFlags.local && updatePosition) {\r\n          this.chatInner[(message as Message.message).pFlags.sponsored ? 'append' : 'prepend'](bubble);\r\n          return;\r\n        }\r\n      });\r\n\r\n      this.bubbleGroups.mountUnmountGroups(groups);\r\n      // this.bubbleGroups.findIncorrentPositions();\r\n\r\n      if(this.updatePlaceholderPosition) {\r\n        this.updatePlaceholderPosition();\r\n      }\r\n\r\n      if(restoreScroll) {\r\n        restoreScroll();\r\n      }\r\n\r\n      // this.setStickyDateManually();\r\n\r\n      if(this.messagesQueue.length) {\r\n        log('have new messages to render');\r\n        return processQueue();\r\n      } else {\r\n        log('end');\r\n      }\r\n    };\r\n\r\n    log('setting pause');\r\n    const promise = this.messagesQueuePromise = m(pause(0)).then(processQueue).finally(() => {\r\n      if(this.messagesQueuePromise === promise) {\r\n        this.messagesQueuePromise = null;\r\n      }\r\n    });\r\n\r\n    return promise;\r\n  }\r\n\r\n  private ejectBubbles() {\r\n    for(const bubble of this.bubblesToEject) {\r\n      bubble.remove();\r\n      // this.bubbleGroups.removeAndUnmountBubble(bubble);\r\n    }\r\n\r\n    this.bubblesToEject.clear();\r\n  }\r\n\r\n  public groupBubbles(items: Array<{\r\n    // Awaited<ReturnType<ChatBubbles['safeRenderMessage']>> &\r\n    bubble: HTMLElement,\r\n    message: Message.message | Message.messageService\r\n  }/*  & {\r\n    unmountIfFound?: boolean\r\n  } */>) {\r\n    let modifiedGroups: typeof groups;\r\n\r\n    if(this.chat.type === 'scheduled') {\r\n      modifiedGroups = new Set();\r\n      items.forEach(({bubble, message}) => {\r\n        const item = this.bubbleGroups.getItemByBubble(bubble);\r\n        const group = item?.group;\r\n        if(group && item.message.date !== message.date) {\r\n          this.bubbleGroups.removeItem(item);\r\n          modifiedGroups.add(group);\r\n        }\r\n      });\r\n    }\r\n\r\n    items.forEach(({bubble, message}) => {\r\n      this.bubbleGroups.prepareForGrouping(bubble, message);\r\n    });\r\n\r\n    const groups = this.bubbleGroups.groupUngrouped();\r\n\r\n    const avatarPromises = Array.from(groups).map((group) => {\r\n      if(group.avatar) return;\r\n      const firstItem = group.firstItem;\r\n      if(firstItem && this.chat.isAvatarNeeded(firstItem.message)) {\r\n        return group.createAvatar(firstItem.message);\r\n      }\r\n    }).filter(Boolean);\r\n\r\n    if(modifiedGroups) {\r\n      for(const group of modifiedGroups) {\r\n        groups.add(group);\r\n      }\r\n    }\r\n\r\n    return {\r\n      groups: [...groups],\r\n      avatarPromises\r\n    };\r\n  }\r\n\r\n  public getMiddleware(additionalCallback?: () => boolean) {\r\n    return this.middleware.get(additionalCallback);\r\n  }\r\n\r\n  private async safeRenderMessage(\r\n    message: Message.message | Message.messageService,\r\n    reverse?: boolean,\r\n    bubble?: HTMLElement,\r\n    updatePosition = true,\r\n    processResult?: (result: ReturnType<ChatBubbles['renderMessage']>, bubble: HTMLElement) => typeof result\r\n  ) {\r\n    if(!message || this.renderingMessages.has(message.mid) || (this.bubbles[message.mid] && !bubble)) {\r\n      return;\r\n    }\r\n\r\n    const middleware = this.getMiddleware();\r\n\r\n    let result: Awaited<ReturnType<ChatBubbles['renderMessage']>> & {updatePosition: typeof updatePosition};\r\n    try {\r\n      this.renderingMessages.add(message.mid);\r\n\r\n      // const groupedId = (message as Message.message).grouped_id;\r\n      const newBubble = document.createElement('div');\r\n      newBubble.dataset.mid = '' + message.mid;\r\n      newBubble.dataset.peerId = '' + message.peerId;\r\n      newBubble.dataset.timestamp = '' + message.date;\r\n\r\n      // const bubbleNew: Bubble = this.bubblesNew[message.mid] ??= {\r\n      //   bubble: newBubble,\r\n      //   mids: new Set(),\r\n      //   groupedId\r\n      // };\r\n\r\n      // bubbleNew.mids.add(message.mid);\r\n\r\n      if(bubble) {\r\n        this.skippedMids.delete(message.mid);\r\n\r\n        this.bubblesToEject.add(bubble);\r\n        this.bubblesToReplace.delete(bubble);\r\n        this.bubblesToReplace.set(newBubble, bubble);\r\n        this.bubbleGroups.changeBubbleByBubble(bubble, newBubble);\r\n      }\r\n\r\n      bubble = this.bubbles[message.mid] = newBubble;\r\n      let originalPromise = this.renderMessage(message, reverse, bubble);\r\n      if(processResult) {\r\n        originalPromise = processResult(originalPromise, bubble);\r\n      }\r\n\r\n      const promise = originalPromise.then((r) => ((r && middleware() ? {...r, updatePosition} : undefined) as typeof result));\r\n\r\n      this.renderMessagesQueue(promise.catch(() => undefined));\r\n\r\n      result = await promise;\r\n      if(!middleware()) {\r\n        return;\r\n      }\r\n\r\n      if(!result) {\r\n        this.skippedMids.add(+message.mid);\r\n      }\r\n    } catch(err) {\r\n      this.log.error('renderMessage error:', err);\r\n    }\r\n\r\n    if(!middleware()) {\r\n      return;\r\n    }\r\n\r\n    this.renderingMessages.delete(message.mid);\r\n    return result;\r\n  }\r\n\r\n  // reverse means top\r\n  private async renderMessage(\r\n    message: Message.message | Message.messageService,\r\n    reverse = false,\r\n    bubble: HTMLElement\r\n  ) {\r\n    // if(DEBUG) {\r\n    //   this.log('message to render:', message);\r\n    // }\r\n\r\n    // if(!bubble && this.bubbles[message.mid]) {\r\n    //   return;\r\n    // }\r\n\r\n    // await pause(1000);\r\n\r\n    const isMessage = message._ === 'message';\r\n    const groupedId = isMessage && message.grouped_id;\r\n    let albumMids: number[], reactionsMessage: Message.message;\r\n    const albumMessages = groupedId ? await this.managers.appMessagesManager.getMessagesByAlbum(groupedId) : undefined;\r\n\r\n    const albumMustBeRenderedFull = this.chat.type !== 'pinned';\r\n\r\n    if(groupedId && albumMustBeRenderedFull) { // will render only last album's message\r\n      albumMids = albumMessages.map((message) => message.mid);\r\n      const mainMid = getMainMidForGrouped(albumMids);\r\n      if(message.mid !== mainMid) {\r\n        return;\r\n      }\r\n    }\r\n\r\n    if(isMessage) {\r\n      reactionsMessage = groupedId ? albumMessages[0] : message;\r\n    }\r\n\r\n    // * can't use 'message.pFlags.out' here because this check will be used to define side of message (left-right)\r\n    const our = this.chat.isOurMessage(message);\r\n\r\n    const messageDiv = document.createElement('div');\r\n    messageDiv.classList.add('message', 'spoilers-container');\r\n\r\n    const contentWrapper = document.createElement('div');\r\n    contentWrapper.classList.add('bubble-content-wrapper');\r\n\r\n    const bubbleContainer = document.createElement('div');\r\n    bubbleContainer.classList.add('bubble-content');\r\n\r\n    bubble.classList.add('bubble');\r\n    contentWrapper.append(bubbleContainer);\r\n    bubble.append(contentWrapper);\r\n\r\n    const isInUnread = !our && !message.pFlags.out && (message.pFlags.unread ||\r\n      isMentionUnread(message)/*  ||\r\n      (this.historyStorage.readMaxId !== undefined && this.historyStorage.readMaxId < message.mid) */);\r\n    if(isInUnread && this.observer) {\r\n      // this.log('not our message', message, message.pFlags.unread);\r\n      this.observer.observe(bubble, this.unreadedObserverCallback);\r\n      this.unreaded.set(bubble, message.mid);\r\n    }\r\n\r\n    const loadPromises: Promise<any>[] = [];\r\n    const ret = {\r\n      bubble,\r\n      promises: loadPromises,\r\n      message,\r\n      reverse\r\n    };\r\n\r\n    if(message._ === 'messageService' && (!message.action || !SERVICE_AS_REGULAR.has(message.action._))) {\r\n      const action = message.action;\r\n      if(action) {\r\n        const _ = action._;\r\n        if(IGNORE_ACTIONS.has(_) || (langPack.hasOwnProperty(_) && !langPack[_])) {\r\n          return;\r\n        }\r\n      }\r\n\r\n      bubble.className = 'bubble service';\r\n\r\n      bubbleContainer.innerHTML = '';\r\n      const s = document.createElement('div');\r\n      s.classList.add('service-msg');\r\n      if(action) {\r\n        let promise: Promise<any>;\r\n        if(action._ === 'messageActionChannelMigrateFrom') {\r\n          const peerTitle = new PeerTitle();\r\n          promise = peerTitle.update({peerId: action.chat_id.toPeerId(true)});\r\n          s.append(i18n('ChatMigration.From', [peerTitle.element]));\r\n        } else if(action._ === 'messageActionChatMigrateTo') {\r\n          const peerTitle = new PeerTitle();\r\n          promise = peerTitle.update({peerId: action.channel_id.toPeerId(true)});\r\n          s.append(i18n('ChatMigration.To', [peerTitle.element]));\r\n        } else {\r\n          s.append(await wrapMessageActionTextNew(message));\r\n        }\r\n      }\r\n      bubbleContainer.append(s);\r\n\r\n      if(message.pFlags.is_single) { // * Ignore 'Discussion started'\r\n        bubble.classList.add('is-group-last');\r\n      }\r\n\r\n      return ret;\r\n    }\r\n\r\n    let messageMedia: MessageMedia = isMessage && message.media;\r\n\r\n    let messageMessage: string, totalEntities: MessageEntity[];\r\n    if(isMessage) {\r\n      if((messageMedia as MessageMedia.messageMediaDocument)?.document &&\r\n        !['video', 'gif'].includes(((messageMedia as MessageMedia.messageMediaDocument).document as MyDocument).type)) {\r\n        // * just filter these cases for documents caption\r\n      } else if(groupedId && albumMustBeRenderedFull) {\r\n        const t = getAlbumText(albumMessages);\r\n        messageMessage = t.message;\r\n        // totalEntities = t.entities;\r\n        totalEntities = t.totalEntities;\r\n      } else if(((messageMedia as MessageMedia.messageMediaDocument)?.document as MyDocument)?.type !== 'sticker') {\r\n        messageMessage = message.message;\r\n        // totalEntities = message.entities;\r\n        totalEntities = message.totalEntities;\r\n      }\r\n    } else {\r\n      if(message.action._ === 'messageActionPhoneCall') {\r\n        messageMedia = {\r\n          _: 'messageMediaCall',\r\n          action: message.action\r\n        };\r\n      }\r\n    }\r\n\r\n    let bigEmojis = 0, customEmojiSize: MediaSize;\r\n    if(totalEntities && !messageMedia) {\r\n      const emojiEntities = totalEntities.filter((e) => e._ === 'messageEntityEmoji'/*  || e._ === 'messageEntityCustomEmoji' */);\r\n      const strLength = messageMessage.replace(/\\s/g, '').length;\r\n      const emojiStrLength = emojiEntities.reduce((acc, curr) => acc + curr.length, 0);\r\n\r\n      if(emojiStrLength === strLength /* && emojiEntities.length <= 3 *//*  && totalEntities.length === emojiEntities.length */) {\r\n        bigEmojis = Math.min(4, emojiEntities.length);\r\n\r\n        customEmojiSize = mediaSizes.active.customEmoji;\r\n        const sizes: {[size: number]: number} = {\r\n          1: 96,\r\n          2: 64,\r\n          3: 52,\r\n          4: 36\r\n        };\r\n\r\n        const size = sizes[bigEmojis];\r\n        if(size) {\r\n          customEmojiSize = makeMediaSize(size, size);\r\n          bubble.style.setProperty('--emoji-size', size + 'px');\r\n        }\r\n      }\r\n    }\r\n\r\n    const richText = wrapRichText(messageMessage, {\r\n      entities: totalEntities,\r\n      passEntities: this.passEntities,\r\n      loadPromises,\r\n      lazyLoadQueue: this.lazyLoadQueue,\r\n      customEmojiSize\r\n    });\r\n\r\n    let canHaveTail = true;\r\n    let isStandaloneMedia = false;\r\n    let needToSetHTML = true;\r\n    if(bigEmojis) {\r\n      if(rootScope.settings.emoji.big) {\r\n        const sticker = bigEmojis === 1 &&\r\n          !totalEntities.find((entity) => entity._ === 'messageEntityCustomEmoji') &&\r\n          await this.managers.appStickersManager.getAnimatedEmojiSticker(messageMessage);\r\n        if(bigEmojis === 1 && !messageMedia && sticker) {\r\n          messageMedia = {\r\n            _: 'messageMediaDocument',\r\n            document: sticker\r\n          };\r\n        } else {\r\n          const attachmentDiv = document.createElement('div');\r\n          attachmentDiv.classList.add('attachment', 'spoilers-container');\r\n\r\n          setInnerHTML(attachmentDiv, richText);\r\n\r\n          bubbleContainer.append(attachmentDiv);\r\n        }\r\n\r\n        bubble.classList.add('is-message-empty', 'emoji-big');\r\n        isStandaloneMedia = true;\r\n        canHaveTail = false;\r\n        needToSetHTML = false;\r\n      }\r\n\r\n      bubble.classList.add('can-have-big-emoji');\r\n    }\r\n\r\n    if(needToSetHTML) {\r\n      setInnerHTML(messageDiv, richText);\r\n    }\r\n\r\n    const timeSpan = MessageRender.setTime({\r\n      chatType: this.chat.type,\r\n      message,\r\n      reactionsMessage\r\n    });\r\n    messageDiv.append(timeSpan);\r\n    bubbleContainer.prepend(messageDiv);\r\n    // bubble.prepend(timeSpan, messageDiv); // that's bad\r\n\r\n    if(isMessage && message.views) {\r\n      bubble.classList.add('channel-post');\r\n\r\n      if(!message.fwd_from?.saved_from_msg_id && this.chat.type !== 'pinned') {\r\n        const forward = document.createElement('div');\r\n        forward.classList.add('bubble-beside-button', 'forward', 'tgico-forward_filled');\r\n        bubbleContainer.prepend(forward);\r\n        bubble.classList.add('with-beside-button');\r\n      }\r\n\r\n      if(!message.pFlags.is_outgoing && this.observer) {\r\n        this.observer.observe(bubble, this.viewsObserverCallback);\r\n      }\r\n    }\r\n\r\n    const replyMarkup = isMessage && message.reply_markup;\r\n    if(replyMarkup && replyMarkup._ === 'replyInlineMarkup' && replyMarkup.rows && replyMarkup.rows.length) {\r\n      const rows = replyMarkup.rows;\r\n\r\n      const containerDiv = document.createElement('div');\r\n      containerDiv.classList.add('reply-markup');\r\n      rows.forEach((row) => {\r\n        const buttons = row.buttons;\r\n        if(!buttons || !buttons.length) return;\r\n\r\n        const rowDiv = document.createElement('div');\r\n        rowDiv.classList.add('reply-markup-row');\r\n\r\n        buttons.forEach((button) => {\r\n          let text: DocumentFragment | HTMLElement | string = wrapRichText(button.text, {noLinks: true, noLinebreaks: true});\r\n\r\n          let buttonEl: HTMLButtonElement | HTMLAnchorElement;\r\n\r\n          switch(button._) {\r\n            case 'keyboardButtonUrl': {\r\n              const r = wrapRichText(' ', {\r\n                entities: [{\r\n                  _: 'messageEntityTextUrl',\r\n                  length: 1,\r\n                  offset: 0,\r\n                  url: button.url\r\n                }]\r\n              });\r\n\r\n              buttonEl = htmlToDocumentFragment(r).firstElementChild as HTMLAnchorElement;\r\n              buttonEl.classList.add('is-link');\r\n\r\n              break;\r\n            }\r\n\r\n            case 'keyboardButtonSwitchInline': {\r\n              buttonEl = document.createElement('button');\r\n              buttonEl.classList.add('is-switch-inline');\r\n              attachClickEvent(buttonEl, (e) => {\r\n                cancelEvent(e);\r\n\r\n                const botId = message.viaBotId || message.fromId;\r\n                let promise: Promise<PeerId>;\r\n                if(button.pFlags.same_peer) promise = Promise.resolve(this.peerId);\r\n                else promise = this.managers.appInlineBotsManager.checkSwitchReturn(botId).then((peerId) => {\r\n                  if(peerId) {\r\n                    return peerId;\r\n                  }\r\n\r\n                  return new Promise<PeerId>((resolve, reject) => {\r\n                    const popup = new PopupForward({\r\n                      [this.peerId]: []\r\n                    }, (peerId) => {\r\n                      resolve(peerId);\r\n                    }, true);\r\n\r\n                    popup.addEventListener('close', () => {\r\n                      reject();\r\n                    });\r\n                  });\r\n                });\r\n\r\n                promise.then((peerId) => {\r\n                  const threadId = this.peerId === peerId ? this.chat.threadId : undefined;\r\n                  this.chat.appImManager.setInnerPeer({peerId});\r\n                  this.managers.appInlineBotsManager.switchInlineQuery(peerId, threadId, botId, button.query);\r\n                });\r\n              });\r\n              break;\r\n            }\r\n\r\n            case 'keyboardButtonBuy': {\r\n              buttonEl = document.createElement('button');\r\n              buttonEl.classList.add('is-buy');\r\n\r\n              if(messageMedia?._ === 'messageMediaInvoice') {\r\n                if(messageMedia.receipt_msg_id) {\r\n                  text = i18n('Message.ReplyActionButtonShowReceipt');\r\n                }\r\n              }\r\n\r\n              break;\r\n            }\r\n\r\n            default: {\r\n              buttonEl = document.createElement('button');\r\n              break;\r\n            }\r\n          }\r\n\r\n          buttonEl.classList.add('reply-markup-button', 'rp', 'tgico');\r\n          if(typeof(text) === 'string') {\r\n            buttonEl.insertAdjacentHTML('beforeend', text);\r\n          } else {\r\n            buttonEl.append(text);\r\n          }\r\n\r\n          ripple(buttonEl);\r\n\r\n          rowDiv.append(buttonEl);\r\n        });\r\n\r\n        containerDiv.append(rowDiv);\r\n      });\r\n\r\n      attachClickEvent(containerDiv, (e) => {\r\n        let target = e.target as HTMLElement;\r\n\r\n        if(!target.classList.contains('reply-markup-button')) target = findUpClassName(target, 'reply-markup-button');\r\n        if(\r\n          !target ||\r\n          target.classList.contains('is-link') ||\r\n          target.classList.contains('is-switch-inline') ||\r\n          target.classList.contains('is-buy')\r\n        ) return;\r\n\r\n        cancelEvent(e);\r\n\r\n        const column = whichChild(target);\r\n        const row = rows[whichChild(target.parentElement)];\r\n\r\n        if(!row.buttons || !row.buttons[column]) {\r\n          this.log.warn('no such button', row, column, message);\r\n          return;\r\n        }\r\n\r\n        const button = row.buttons[column];\r\n        this.managers.appInlineBotsManager.callbackButtonClick(this.peerId, message.mid, button).then((callbackAnswer) => {\r\n          if(typeof callbackAnswer.message === 'string' && callbackAnswer.message.length) {\r\n            toast(wrapRichText(callbackAnswer.message, {noLinks: true, noLinebreaks: true}));\r\n          }\r\n\r\n          // console.log('callbackButtonClick callbackAnswer:', callbackAnswer);\r\n        });\r\n      });\r\n\r\n      canHaveTail = false;\r\n      bubble.classList.add('with-reply-markup');\r\n      contentWrapper.append(containerDiv);\r\n    }\r\n\r\n    const isOutgoing = message.pFlags.is_outgoing/*  && this.peerId !== rootScope.myId */;\r\n    if(our) {\r\n      if(message.pFlags.unread || isOutgoing) this.unreadOut.add(message.mid);\r\n      let status = '';\r\n      if(message.error) status = 'is-error';\r\n      else if(isOutgoing) status = 'is-sending';\r\n      else status = message.pFlags.unread || (message as Message.message).pFlags.is_scheduled ? 'is-sent' : 'is-read';\r\n      bubble.classList.add(status);\r\n    }\r\n\r\n    if(isOutgoing && !message.error) {\r\n      bubble.classList.add('is-outgoing');\r\n    }\r\n\r\n    const messageWithReplies = isMessage && await this.managers.appMessagesManager.getMessageWithCommentReplies(message);\r\n    const withReplies = !!messageWithReplies && message.mid > 0;\r\n\r\n    if(withReplies) {\r\n      bubble.classList.add('with-replies');\r\n    }\r\n\r\n    const fwdFrom = isMessage && message.fwd_from;\r\n    const fwdFromId = isMessage && message.fwdFromId;\r\n\r\n    const isOut = this.chat.isOutMessage(message);\r\n    let nameContainer: HTMLElement = bubbleContainer;\r\n\r\n    const canHideNameIfMedia = !message.viaBotId && (message.fromId === rootScope.myId || !message.pFlags.out);\r\n\r\n    // media\r\n    if(messageMedia/*  && messageMedia._ === 'messageMediaPhoto' */) {\r\n      let attachmentDiv = document.createElement('div');\r\n      attachmentDiv.classList.add('attachment');\r\n\r\n      if(!messageMessage) {\r\n        bubble.classList.add('is-message-empty');\r\n      }\r\n\r\n      let processingWebPage = false;\r\n\r\n      /* if(isMessage)  */switch(messageMedia._) {\r\n        case 'messageMediaPhoto': {\r\n          const photo = messageMedia.photo;\r\n          // //////this.log('messageMediaPhoto', photo);\r\n\r\n          if(!messageMessage) {\r\n            canHaveTail = false;\r\n          }\r\n\r\n          if(canHideNameIfMedia) {\r\n            bubble.classList.add('hide-name');\r\n          }\r\n\r\n          bubble.classList.add('photo');\r\n\r\n          if(albumMustBeRenderedFull && groupedId && albumMids.length !== 1) {\r\n            bubble.classList.add('is-album', 'is-grouped');\r\n            wrapAlbum({\r\n              messages: albumMessages,\r\n              attachmentDiv,\r\n              middleware: this.getMiddleware(),\r\n              isOut: our,\r\n              lazyLoadQueue: this.lazyLoadQueue,\r\n              chat: this.chat,\r\n              loadPromises,\r\n              autoDownload: this.chat.autoDownload\r\n            });\r\n\r\n            break;\r\n          }\r\n\r\n          const withTail = !IS_ANDROID && canHaveTail && !withReplies && USE_MEDIA_TAILS;\r\n          if(withTail) bubble.classList.add('with-media-tail');\r\n          wrapPhoto({\r\n            photo: photo as Photo.photo,\r\n            message,\r\n            container: attachmentDiv,\r\n            withTail,\r\n            isOut,\r\n            lazyLoadQueue: this.lazyLoadQueue,\r\n            middleware: this.getMiddleware(),\r\n            loadPromises,\r\n            autoDownloadSize: this.chat.autoDownload.photo\r\n          });\r\n\r\n          break;\r\n        }\r\n\r\n        case 'messageMediaWebPage': {\r\n          processingWebPage = true;\r\n\r\n          const webPage: WebPage = messageMedia.webpage;\r\n          // //////this.log('messageMediaWebPage', webpage);\r\n          if(webPage._ !== 'webPage') {\r\n            break;\r\n          }\r\n\r\n          bubble.classList.add('webpage');\r\n\r\n          const box = document.createElement('div');\r\n          box.classList.add('web');\r\n\r\n          const quote = document.createElement('div');\r\n          quote.classList.add('quote');\r\n\r\n          let previewResizer: HTMLDivElement, preview: HTMLDivElement;\r\n          const photo: Photo.photo = webPage.photo as any;\r\n          if(photo || webPage.document) {\r\n            previewResizer = document.createElement('div');\r\n            previewResizer.classList.add('preview-resizer');\r\n            preview = document.createElement('div');\r\n            preview.classList.add('preview');\r\n            previewResizer.append(preview);\r\n          }\r\n\r\n          const quoteTextDiv = document.createElement('div');\r\n          quoteTextDiv.classList.add('quote-text');\r\n\r\n          const doc = webPage.document as MyDocument;\r\n          if(doc) {\r\n            if(doc.type === 'gif' || doc.type === 'video' || doc.type === 'round') {\r\n              // if(doc.size <= 20e6) {\r\n              const mediaSize = doc.type === 'round' ? mediaSizes.active.round : mediaSizes.active.webpage;\r\n              if(doc.type === 'round') {\r\n                bubble.classList.add('round');\r\n                preview.classList.add('is-round');\r\n              } else {\r\n                bubble.classList.add('video');\r\n              }\r\n              wrapVideo({\r\n                doc,\r\n                container: preview,\r\n                message: message as Message.message,\r\n                boxWidth: mediaSize.width,\r\n                boxHeight: mediaSize.height,\r\n                lazyLoadQueue: this.lazyLoadQueue,\r\n                middleware: this.getMiddleware(),\r\n                isOut,\r\n                group: CHAT_ANIMATION_GROUP,\r\n                loadPromises,\r\n                autoDownload: this.chat.autoDownload,\r\n                noInfo: message.mid < 0\r\n              });\r\n              // }\r\n            } else {\r\n              const docDiv = await wrapDocument({\r\n                message: message as Message.message,\r\n                autoDownloadSize: this.chat.autoDownload.file,\r\n                lazyLoadQueue: this.lazyLoadQueue,\r\n                loadPromises,\r\n                sizeType: 'documentName',\r\n                searchContext: {\r\n                  useSearch: false,\r\n                  peerId: this.peerId,\r\n                  inputFilter: {\r\n                    _: 'inputMessagesFilterEmpty'\r\n                  }\r\n                }\r\n              });\r\n              preview.append(docDiv);\r\n              preview.classList.add('preview-with-document');\r\n              quoteTextDiv.classList.add('has-document');\r\n              // messageDiv.classList.add((webpage.type || 'document') + '-message');\r\n              // doc = null;\r\n            }\r\n          }\r\n\r\n          if(previewResizer) {\r\n            quoteTextDiv.append(previewResizer);\r\n          }\r\n\r\n          let t: HTMLElement;\r\n          if(webPage.site_name) {\r\n            const html = wrapRichText(webPage.url);\r\n            const a: HTMLAnchorElement = htmlToDocumentFragment(html).firstElementChild as any;\r\n            a.classList.add('webpage-name');\r\n            const strong = document.createElement('strong');\r\n            setInnerHTML(strong, wrapEmojiText(webPage.site_name));\r\n            a.textContent = '';\r\n            a.append(strong);\r\n            quoteTextDiv.append(a);\r\n            t = a;\r\n          }\r\n\r\n          const title = wrapWebPageTitle(webPage);\r\n          if(title.textContent) {\r\n            const titleDiv = document.createElement('div');\r\n            titleDiv.classList.add('title');\r\n            const strong = document.createElement('strong');\r\n            setInnerHTML(strong, title);\r\n            titleDiv.append(strong);\r\n            quoteTextDiv.append(titleDiv);\r\n            t = titleDiv;\r\n          }\r\n\r\n          const description = wrapWebPageDescription(webPage);\r\n          if(description.textContent) {\r\n            const textDiv = document.createElement('div');\r\n            textDiv.classList.add('text');\r\n            setInnerHTML(textDiv, description);\r\n            quoteTextDiv.append(textDiv);\r\n            t = textDiv;\r\n          }\r\n\r\n          /* if(t) {\r\n            t.append(timeSpan);\r\n          } else {\r\n            box.classList.add('no-text');\r\n          } */\r\n\r\n          quote.append(quoteTextDiv);\r\n\r\n          if(photo && !doc) {\r\n            bubble.classList.add('photo');\r\n\r\n            const size: PhotoSize.photoSize = photo.sizes[photo.sizes.length - 1] as any;\r\n            let isSquare = false;\r\n            if(size.w === size.h && t) {\r\n              bubble.classList.add('is-square-photo');\r\n              isSquare = true;\r\n              setAttachmentSize(photo, preview, 48, 48, false);\r\n\r\n              /* if(t) {\r\n                t.append(timeSpan);\r\n              } */\r\n            } else if(size.h > size.w) {\r\n              bubble.classList.add('is-vertical-photo');\r\n            }\r\n\r\n            wrapPhoto({\r\n              photo,\r\n              message,\r\n              container: preview,\r\n              boxWidth: isSquare ? 0 : mediaSizes.active.webpage.width,\r\n              boxHeight: isSquare ? 0 : mediaSizes.active.webpage.height,\r\n              isOut,\r\n              lazyLoadQueue: this.lazyLoadQueue,\r\n              middleware: this.getMiddleware(),\r\n              loadPromises,\r\n              withoutPreloader: isSquare,\r\n              autoDownloadSize: this.chat.autoDownload.photo\r\n            });\r\n          }\r\n\r\n          box.append(quote);\r\n\r\n          // bubble.prepend(box);\r\n          // if(timeSpan.parentElement === messageDiv) {\r\n          messageDiv.insertBefore(box, timeSpan);\r\n          // } else {\r\n          //   messageDiv.append(box);\r\n          // }\r\n\r\n          // this.log('night running', bubble.scrollHeight);\r\n\r\n          break;\r\n        }\r\n\r\n        case 'messageMediaDocument': {\r\n          const doc = messageMedia.document as MyDocument;\r\n\r\n          // this.log('messageMediaDocument', doc, bubble);\r\n\r\n          if(doc.sticker/*  && doc.size <= 1e6 */) {\r\n            bubble.classList.add('sticker');\r\n            canHaveTail = false;\r\n            isStandaloneMedia = true;\r\n\r\n            if(doc.animated) {\r\n              bubble.classList.add('sticker-animated');\r\n            }\r\n\r\n            const sizes = mediaSizes.active;\r\n            const isEmoji = bubble.classList.contains('emoji-big');\r\n            const boxSize = isEmoji ? sizes.emojiSticker : (doc.animated ? sizes.animatedSticker : sizes.staticSticker);\r\n            setAttachmentSize(doc, attachmentDiv, boxSize.width, boxSize.height);\r\n            // let preloader = new ProgressivePreloader(attachmentDiv, false);\r\n            bubbleContainer.style.minWidth = attachmentDiv.style.width;\r\n            bubbleContainer.style.minHeight = attachmentDiv.style.height;\r\n            // appPhotosManager.setAttachmentSize(doc, bubble);\r\n            wrapSticker({\r\n              doc,\r\n              div: attachmentDiv,\r\n              middleware: this.getMiddleware(),\r\n              lazyLoadQueue: this.lazyLoadQueue,\r\n              group: CHAT_ANIMATION_GROUP,\r\n              // play: !!message.pending || !multipleRender,\r\n              play: true,\r\n              loop: true,\r\n              emoji: isEmoji ? messageMessage : undefined,\r\n              withThumb: true,\r\n              loadPromises,\r\n              isOut,\r\n              noPremium: messageMedia?.pFlags?.nopremium\r\n            });\r\n\r\n            if(getStickerEffectThumb(doc) && (isInUnread || isOutgoing)/*  || true */) {\r\n              this.observer.observe(bubble, this.stickerEffectObserverCallback);\r\n            }\r\n          } else if(doc.type === 'video' || doc.type === 'gif' || doc.type === 'round'/*  && doc.size <= 20e6 */) {\r\n            // this.log('never get free 2', doc);\r\n\r\n            const isRound = doc.type === 'round';\r\n            if(isRound) {\r\n              isStandaloneMedia = true;\r\n            }\r\n\r\n            if(isRound || !messageMessage) {\r\n              canHaveTail = false;\r\n            }\r\n\r\n            if(canHideNameIfMedia) {\r\n              bubble.classList.add('hide-name');\r\n            }\r\n\r\n            bubble.classList.add(isRound ? 'round' : 'video');\r\n            if(albumMustBeRenderedFull && groupedId && albumMids.length !== 1) {\r\n              bubble.classList.add('is-album', 'is-grouped');\r\n\r\n              wrapAlbum({\r\n                messages: albumMessages,\r\n                attachmentDiv,\r\n                middleware: this.getMiddleware(),\r\n                isOut: our,\r\n                lazyLoadQueue: this.lazyLoadQueue,\r\n                chat: this.chat,\r\n                loadPromises,\r\n                autoDownload: this.chat.autoDownload\r\n              });\r\n            } else {\r\n              const withTail = !IS_ANDROID && !IS_APPLE && !isRound && canHaveTail && !withReplies && USE_MEDIA_TAILS;\r\n              if(withTail) bubble.classList.add('with-media-tail');\r\n              wrapVideo({\r\n                doc,\r\n                container: attachmentDiv,\r\n                message: message as Message.message,\r\n                boxWidth: mediaSizes.active.regular.width,\r\n                boxHeight: mediaSizes.active.regular.height,\r\n                withTail,\r\n                isOut,\r\n                lazyLoadQueue: this.lazyLoadQueue,\r\n                middleware: this.getMiddleware(),\r\n                group: CHAT_ANIMATION_GROUP,\r\n                loadPromises,\r\n                autoDownload: this.chat.autoDownload,\r\n                searchContext: isRound ? {\r\n                  peerId: this.peerId,\r\n                  inputFilter: {_: 'inputMessagesFilterRoundVoice'},\r\n                  threadId: this.chat.threadId,\r\n                  useSearch: !(message as Message.message).pFlags.is_scheduled,\r\n                  isScheduled: (message as Message.message).pFlags.is_scheduled\r\n                } : undefined,\r\n                noInfo: message.mid < 0\r\n              });\r\n            }\r\n          } else {\r\n            const newNameContainer = await wrapGroupedDocuments({\r\n              albumMustBeRenderedFull,\r\n              message,\r\n              bubble,\r\n              messageDiv,\r\n              chat: this.chat,\r\n              loadPromises,\r\n              autoDownloadSize: this.chat.autoDownload.file,\r\n              lazyLoadQueue: this.lazyLoadQueue,\r\n              searchContext: doc.type === 'voice' || doc.type === 'audio' ? {\r\n                peerId: this.peerId,\r\n                inputFilter: {_: doc.type === 'voice' ? 'inputMessagesFilterRoundVoice' : 'inputMessagesFilterMusic'},\r\n                threadId: this.chat.threadId,\r\n                useSearch: !(message as Message.message).pFlags.is_scheduled,\r\n                isScheduled: (message as Message.message).pFlags.is_scheduled\r\n              } : undefined,\r\n              sizeType: 'documentName'\r\n            });\r\n\r\n            if(newNameContainer) {\r\n              nameContainer = newNameContainer;\r\n            }\r\n\r\n            const lastContainer = messageDiv.lastElementChild.querySelector('.document-message, .document, .audio');\r\n            // lastContainer && lastContainer.append(timeSpan.cloneNode(true));\r\n            lastContainer && lastContainer.append(timeSpan);\r\n\r\n            bubble.classList.remove('is-message-empty');\r\n            messageDiv.classList.add((!(['photo', 'pdf'] as MyDocument['type'][]).includes(doc.type) ? doc.type || 'document' : 'document') + '-message');\r\n            processingWebPage = true;\r\n          }\r\n\r\n          break;\r\n        }\r\n\r\n        case 'messageMediaCall': {\r\n          const action = messageMedia.action;\r\n          const div = document.createElement('div');\r\n          div.classList.add('bubble-call', action.pFlags.video ? 'tgico-videocamera' : 'tgico-phone');\r\n\r\n          const type: CallType = action.pFlags.video ? 'video' : 'voice';\r\n          div.dataset.type = type;\r\n\r\n          const title = document.createElement('div');\r\n          title.classList.add('bubble-call-title');\r\n\r\n          _i18n(title, isOut ?\r\n            (action.pFlags.video ? 'CallMessageVideoOutgoing' : 'CallMessageOutgoing') :\r\n            (action.pFlags.video ? 'CallMessageVideoIncoming' : 'CallMessageIncoming'));\r\n\r\n          const subtitle = document.createElement('div');\r\n          subtitle.classList.add('bubble-call-subtitle');\r\n\r\n          if(action.duration !== undefined) {\r\n            subtitle.append(formatCallDuration(action.duration));\r\n          } else {\r\n            let langPackKey: LangPackKey;\r\n            switch(action.reason._) {\r\n              case 'phoneCallDiscardReasonBusy':\r\n                langPackKey = 'Call.StatusBusy';\r\n                break;\r\n              case 'phoneCallDiscardReasonMissed':\r\n                langPackKey = 'Chat.Service.Call.Missed';\r\n                break;\r\n              // case 'phoneCallDiscardReasonHangup':\r\n              default:\r\n                langPackKey = 'Chat.Service.Call.Cancelled';\r\n                break;\r\n            }\r\n\r\n            subtitle.classList.add('is-reason');\r\n            _i18n(subtitle, langPackKey);\r\n          }\r\n\r\n          subtitle.classList.add('tgico', 'arrow-' + (action.duration !== undefined ? 'green' : 'red'));\r\n\r\n          div.append(title, subtitle);\r\n\r\n          processingWebPage = true;\r\n\r\n          bubble.classList.remove('is-message-empty');\r\n          messageDiv.classList.add('call-message');\r\n          messageDiv.append(div);\r\n\r\n          break;\r\n        }\r\n\r\n        case 'messageMediaContact': {\r\n          // this.log('wrapping contact', message);\r\n\r\n          const contact = messageMedia;\r\n          const contactDiv = document.createElement('div');\r\n          contactDiv.classList.add('contact');\r\n          contactDiv.dataset.peerId = '' + contact.user_id;\r\n\r\n          processingWebPage = true;\r\n\r\n          const contactDetails = document.createElement('div');\r\n          contactDetails.className = 'contact-details';\r\n          const contactNameDiv = document.createElement('div');\r\n          contactNameDiv.className = 'contact-name';\r\n          contactNameDiv.append(\r\n            wrapEmojiText([\r\n              contact.first_name,\r\n              contact.last_name\r\n            ].filter(Boolean).join(' '))\r\n          );\r\n\r\n          const contactNumberDiv = document.createElement('div');\r\n          contactNumberDiv.className = 'contact-number';\r\n          contactNumberDiv.textContent = contact.phone_number ? '+' + formatPhoneNumber(contact.phone_number).formatted : 'Unknown phone number';\r\n\r\n          contactDiv.append(contactDetails);\r\n          contactDetails.append(contactNameDiv, contactNumberDiv);\r\n\r\n          const avatarElem = new AvatarElement();\r\n          avatarElem.updateWithOptions({\r\n            lazyLoadQueue: this.lazyLoadQueue,\r\n            peerId: contact.user_id.toPeerId()\r\n          });\r\n          avatarElem.classList.add('contact-avatar', 'avatar-54');\r\n\r\n          contactDiv.prepend(avatarElem);\r\n\r\n          bubble.classList.remove('is-message-empty');\r\n          messageDiv.classList.add('contact-message');\r\n          messageDiv.append(contactDiv);\r\n\r\n          break;\r\n        }\r\n\r\n        case 'messageMediaPoll': {\r\n          bubble.classList.remove('is-message-empty');\r\n\r\n          const pollElement = wrapPoll(message);\r\n          messageDiv.prepend(pollElement);\r\n          messageDiv.classList.add('poll-message');\r\n\r\n          break;\r\n        }\r\n\r\n        case 'messageMediaInvoice': {\r\n          const isTest = messageMedia.pFlags.test;\r\n          const photo = messageMedia.photo;\r\n\r\n          const priceEl = document.createElement(photo ? 'span' : 'div');\r\n          const f = document.createDocumentFragment();\r\n          const l = i18n(messageMedia.receipt_msg_id ? 'PaymentReceipt' : (isTest ? 'PaymentTestInvoice' : 'PaymentInvoice'));\r\n          l.classList.add('text-uppercase');\r\n          const joiner = ' ';\r\n          const p = document.createElement('span');\r\n          p.classList.add('text-bold');\r\n          p.textContent = paymentsWrapCurrencyAmount(messageMedia.total_amount, messageMedia.currency) + joiner;\r\n          f.append(p, l);\r\n          if(isTest && messageMedia.receipt_msg_id) {\r\n            const a = document.createElement('span');\r\n            a.classList.add('text-uppercase', 'pre-wrap');\r\n            a.append(joiner + '(Test)');\r\n            f.append(a);\r\n          }\r\n          setInnerHTML(priceEl, f);\r\n\r\n          if(photo) {\r\n            const mediaSize = mediaSizes.active.invoice;\r\n            wrapPhoto({\r\n              photo,\r\n              container: attachmentDiv,\r\n              withTail: false,\r\n              isOut,\r\n              lazyLoadQueue: this.lazyLoadQueue,\r\n              middleware: this.getMiddleware(),\r\n              loadPromises,\r\n              boxWidth: mediaSize.width,\r\n              boxHeight: mediaSize.height\r\n            });\r\n\r\n            bubble.classList.add('photo');\r\n\r\n            priceEl.classList.add('video-time');\r\n            attachmentDiv.append(priceEl);\r\n          } else {\r\n            attachmentDiv = undefined;\r\n          }\r\n\r\n          const titleDiv = document.createElement('div');\r\n          titleDiv.classList.add('bubble-primary-color');\r\n          setInnerHTML(titleDiv, wrapEmojiText(messageMedia.title));\r\n\r\n          const richText = wrapEmojiText(messageMedia.description);\r\n          messageDiv.prepend(...[titleDiv, !photo && priceEl, richText].filter(Boolean));\r\n\r\n          bubble.classList.remove('is-message-empty');\r\n          bubble.classList.add('is-invoice');\r\n\r\n          break;\r\n        }\r\n\r\n        default:\r\n          attachmentDiv = undefined;\r\n          bubble.classList.remove('is-message-empty');\r\n          messageDiv.append(i18n(UNSUPPORTED_LANG_PACK_KEY), timeSpan);\r\n          this.log.warn('unrecognized media type:', messageMedia._, message);\r\n          break;\r\n      }\r\n\r\n      if(!processingWebPage && attachmentDiv) {\r\n        bubbleContainer.append(attachmentDiv);\r\n      }\r\n\r\n      /* if(bubble.classList.contains('is-message-empty') && (bubble.classList.contains('photo') || bubble.classList.contains('video'))) {\r\n        bubble.classList.add('no-tail');\r\n\r\n        if(!bubble.classList.contains('with-media-tail')) {\r\n          bubble.classList.add('use-border-radius');\r\n        }\r\n      } */\r\n    }\r\n\r\n    if(isStandaloneMedia) {\r\n      bubble.classList.add('just-media');\r\n    }\r\n\r\n    let savedFrom = '';\r\n\r\n    // const needName = ((peerId.isAnyChat() && (peerId !== message.fromId || our)) && message.fromId !== rootScope.myId) || message.viaBotId;\r\n    const needName = (message.fromId !== rootScope.myId && this.chat.isAnyGroup) || message.viaBotId || (message as Message.message).pFlags.sponsored;\r\n    if(needName || fwdFrom || message.reply_to_mid) { // chat\r\n      let title: HTMLElement | DocumentFragment;\r\n      let titleVia: typeof title;\r\n\r\n      const isForwardFromChannel = message.from_id && message.from_id._ === 'peerChannel' && message.fromId === fwdFromId;\r\n\r\n      const isHidden = fwdFrom && !fwdFrom.from_id;\r\n      if(message.viaBotId) {\r\n        titleVia = document.createElement('span');\r\n        titleVia.innerText = '@' + (await this.managers.appUsersManager.getUser(message.viaBotId)).username;\r\n        titleVia.classList.add('peer-title');\r\n        bubble.classList.add('must-have-name');\r\n      }\r\n\r\n      if(isHidden) {\r\n        // /////this.log('message to render hidden', message);\r\n        title = document.createElement('span');\r\n        setInnerHTML(title, wrapEmojiText(fwdFrom.from_name));\r\n        title.classList.add('peer-title');\r\n        // title = fwdFrom.from_name;\r\n        bubble.classList.add('hidden-profile');\r\n      } else {\r\n        title = new PeerTitle({peerId: fwdFromId || message.fromId}).element;\r\n      }\r\n\r\n      if(message.reply_to_mid && message.reply_to_mid !== this.chat.threadId && isMessage) {\r\n        await MessageRender.setReply({\r\n          chat: this.chat,\r\n          bubble,\r\n          bubbleContainer,\r\n          message\r\n        });\r\n      }\r\n\r\n      // this.log(title);\r\n\r\n      let nameDiv: HTMLElement;\r\n      if((fwdFromId || fwdFrom)) {\r\n        if(this.peerId !== rootScope.myId && !isForwardFromChannel) {\r\n          bubble.classList.add('forwarded');\r\n        }\r\n\r\n        if(message.savedFrom) {\r\n          savedFrom = message.savedFrom;\r\n          title.dataset.savedFrom = savedFrom;\r\n        }\r\n\r\n        nameDiv = document.createElement('div');\r\n        title.dataset.peerId = '' + fwdFromId;\r\n\r\n        if((this.peerId === rootScope.myId || this.peerId === REPLIES_PEER_ID || isForwardFromChannel) && !isStandaloneMedia) {\r\n          nameDiv.style.color = getPeerColorById(fwdFromId, false);\r\n          nameDiv.append(title);\r\n        } else {\r\n          /* const fromTitle = message.fromId === this.myID || appPeersManager.isBroadcast(fwdFromId || message.fromId) ? '' : `<div class=\"name\" data-peer-id=\"${message.fromId}\" style=\"color: ${appPeersManager.getPeerColorByID(message.fromId, false)};\">${appPeersManager.getPeerTitle(message.fromId)}</div>`;\r\n          nameDiv.innerHTML = fromTitle + 'Forwarded from ' + title; */\r\n          const args: FormatterArguments = [title];\r\n          if(isStandaloneMedia) {\r\n            args.unshift(document.createElement('br'));\r\n          }\r\n          nameDiv.append(i18n('ForwardedFrom', [args]));\r\n        }\r\n      } else if(!message.viaBotId) {\r\n        if(!isStandaloneMedia && needName) {\r\n          nameDiv = document.createElement('div');\r\n          nameDiv.append(title);\r\n\r\n          const peer = await this.managers.appPeersManager.getPeer(message.fromId);\r\n          const pFlags = (peer as User.user)?.pFlags;\r\n          if(pFlags && (pFlags.scam || pFlags.fake)) {\r\n            nameDiv.append(generateFakeIcon(pFlags.scam));\r\n          }\r\n\r\n          if(!our) {\r\n            nameDiv.style.color = getPeerColorById(message.fromId, false);\r\n          }\r\n\r\n          nameDiv.dataset.peerId = '' + message.fromId;\r\n        } else /* if(!message.reply_to_mid) */ {\r\n          bubble.classList.add('hide-name');\r\n        }\r\n      }\r\n\r\n      if(message.viaBotId) {\r\n        if(!nameDiv) {\r\n          nameDiv = document.createElement('div');\r\n        } else {\r\n          nameDiv.append(' ');\r\n        }\r\n\r\n        const span = document.createElement('span');\r\n        span.append(i18n('ViaBot'), ' ', titleVia);\r\n        span.classList.add('is-via');\r\n\r\n        nameDiv.append(span);\r\n      }\r\n\r\n      if(nameDiv) {\r\n        nameDiv.classList.add('name');\r\n        nameContainer.append(nameDiv);\r\n      }\r\n    } else {\r\n      bubble.classList.add('hide-name');\r\n    }\r\n\r\n    if(this.chat.type === 'pinned') {\r\n      savedFrom = `${this.chat.peerId}_${message.mid}`;\r\n    }\r\n\r\n    const isThreadStarter = messageWithReplies && messageWithReplies.mid === this.chat.threadId;\r\n    if(isThreadStarter) {\r\n      bubble.classList.add('is-thread-starter', 'is-group-last');\r\n    }\r\n\r\n    if(savedFrom && (this.chat.type === 'pinned' || fwdFrom.saved_from_msg_id) && this.peerId !== REPLIES_PEER_ID) {\r\n      const goto = document.createElement('div');\r\n      goto.classList.add('bubble-beside-button', 'goto-original', 'tgico-arrow_next');\r\n      bubbleContainer.append(goto);\r\n      bubble.dataset.savedFrom = savedFrom;\r\n      bubble.classList.add('with-beside-button');\r\n    }\r\n\r\n    bubble.classList.add(isOut ? 'is-out' : 'is-in');\r\n\r\n    if(withReplies) {\r\n      const isFooter = MessageRender.renderReplies({\r\n        bubble,\r\n        bubbleContainer,\r\n        message: messageWithReplies,\r\n        messageDiv,\r\n        loadPromises,\r\n        lazyLoadQueue: this.lazyLoadQueue\r\n      });\r\n\r\n      if(isFooter) {\r\n        canHaveTail = true;\r\n      }\r\n    }\r\n\r\n    if(isMessage) {\r\n      this.appendReactionsElementToBubble(bubble, message, reactionsMessage);\r\n    }\r\n\r\n    /* if(isMessage) {\r\n      const reactionHover = document.createElement('div');\r\n      reactionHover.classList.add('bubble-reaction-hover');\r\n      contentWrapper.append(reactionHover);\r\n    } */\r\n\r\n    if(canHaveTail) {\r\n      bubble.classList.add('can-have-tail');\r\n\r\n      bubbleContainer.append(generateTail());\r\n    }\r\n\r\n    return ret;\r\n  }\r\n\r\n  private appendReactionsElementToBubble(bubble: HTMLElement, message: Message.message, reactionsMessage: Message.message, changedResults?: ReactionCount[]) {\r\n    if(this.peerId.isUser()/*  || true */) {\r\n      return;\r\n    }\r\n\r\n    if(!reactionsMessage?.reactions || !reactionsMessage.reactions.results.length) {\r\n      return;\r\n    }\r\n\r\n    // message = this.appMessagesManager.getMessageWithReactions(message);\r\n\r\n    const reactionsElement = new ReactionsElement();\r\n    reactionsElement.init(reactionsMessage, 'block');\r\n    reactionsElement.render(changedResults);\r\n\r\n    if(bubble.classList.contains('is-message-empty')) {\r\n      bubble.querySelector('.bubble-content-wrapper').append(reactionsElement);\r\n    } else {\r\n      const messageDiv = bubble.querySelector('.message');\r\n      if(bubble.classList.contains('is-multiple-documents')) {\r\n        const documentContainer = messageDiv.lastElementChild as HTMLElement;\r\n        let documentMessageDiv = documentContainer.querySelector('.document-message');\r\n\r\n        let timeSpan: HTMLElement = documentMessageDiv && documentMessageDiv.querySelector('.time');\r\n        if(!timeSpan) {\r\n          timeSpan = MessageRender.setTime({\r\n            chatType: this.chat.type,\r\n            message,\r\n            reactionsMessage\r\n          });\r\n        }\r\n\r\n        reactionsElement.append(timeSpan);\r\n\r\n        if(!documentMessageDiv) {\r\n          documentMessageDiv = document.createElement('div');\r\n          documentMessageDiv.classList.add('document-message');\r\n          documentContainer.querySelector('.document-wrapper').prepend(documentMessageDiv);\r\n        }\r\n\r\n        documentMessageDiv.append(reactionsElement);\r\n      } else {\r\n        const timeSpan = Array.from(bubble.querySelectorAll('.time')).pop();\r\n        reactionsElement.append(timeSpan);\r\n\r\n        messageDiv.append(reactionsElement);\r\n      }\r\n    }\r\n  }\r\n\r\n  private prepareToSaveScroll(reverse?: boolean) {\r\n    const isMounted = !!this.chatInner.parentElement;\r\n    if(!isMounted) {\r\n      return {};\r\n    }\r\n\r\n    const log = this.log.bindPrefix('prepareToSaveScroll');\r\n    log('save');\r\n    const scrollSaver = this.createScrollSaver(reverse);\r\n    scrollSaver.save(); // * let's save scroll position by point before the slicing, not after\r\n\r\n    if(this.getRenderedLength() && !this.chat.setPeerPromise) {\r\n      const viewportSlice = this.getViewportSlice();\r\n      this.deleteViewportSlice(viewportSlice, true);\r\n    }\r\n\r\n    // scrollSaver.save(); // ! slicing will corrupt scroll position\r\n    // const saved = scrollSaver.getSaved();\r\n    // const hadScroll = saved.scrollHeight !== saved.clientHeight;\r\n\r\n    return {\r\n      restoreScroll: () => {\r\n        log('restore');\r\n        // scrollSaver.restore(_history.length === 1 && !reverse ? false : true);\r\n        scrollSaver.restore(reverse);\r\n        this.onRenderScrollSet(scrollSaver.getSaved());\r\n      },\r\n      scrollSaver\r\n    };\r\n  }\r\n\r\n  public async performHistoryResult(historyResult: HistoryResult | {history: (Message.message | Message.messageService | number)[]}, reverse: boolean) {\r\n    const log = false ? this.log.bindPrefix('perform-' + (Math.random() * 1000 | 0)) : undefined;\r\n    log && log('start', this.chatInner.parentElement);\r\n\r\n    let history = historyResult.history;\r\n    history = history.slice(); // need\r\n\r\n    if(this.needReflowScroll) {\r\n      reflowScrollableElement(this.scrollable.container);\r\n      this.needReflowScroll = false;\r\n    }\r\n\r\n    const cb = (message: Message.message | Message.messageService) => {\r\n      if(!message) {\r\n        return;\r\n      } else if(message.pFlags.local) {\r\n        return this.processLocalMessageRender(message);\r\n      } else {\r\n        return this.safeRenderMessage(message, reverse);\r\n      }\r\n    };\r\n\r\n    const messages = await Promise.all(history.map((mid) => {\r\n      return typeof(mid) === 'number' ? this.chat.getMessage(mid) : mid;\r\n    }));\r\n\r\n    const setLoadedPromises: Promise<any>[] = [];\r\n    if(!this.scrollable.loadedAll['bottom'] || !this.scrollable.loadedAll['top']) {\r\n      let isEnd = (historyResult as HistoryResult).isEnd;\r\n      if(!isEnd) {\r\n        const historyStorage = await this.chat.getHistoryStorage();\r\n        const firstSlice = historyStorage.history.first;\r\n        const lastSlice = historyStorage.history.last;\r\n        isEnd = {top: false, bottom: false, both: false};\r\n        if(firstSlice.isEnd(SliceEnd.Bottom) && (!firstSlice.length || history.includes(firstSlice[0]))) {\r\n          isEnd.bottom = true;\r\n        }\r\n\r\n        if(lastSlice.isEnd(SliceEnd.Top) && (!lastSlice.length || history.includes(lastSlice[lastSlice.length - 1]))) {\r\n          isEnd.top = true;\r\n        }\r\n      }\r\n\r\n      if(!isEnd.bottom && this.setPeerOptions) {\r\n        const {lastMsgId, topMessage} = this.setPeerOptions;\r\n        this.setPeerOptions = undefined;\r\n        if(!lastMsgId || this.bubbles[topMessage] || lastMsgId === topMessage) {\r\n          isEnd.bottom = true;\r\n        }\r\n      }\r\n\r\n      if(isEnd.top) setLoadedPromises.push(this.setLoaded('top', true));\r\n      if(isEnd.bottom) setLoadedPromises.push(this.setLoaded('bottom', true));\r\n    }\r\n\r\n    await Promise.all(setLoadedPromises);\r\n\r\n    // ! it is important to insert bubbles to group reversed way\r\n    // const length = history.length, promises: Promise<any>[] = [];\r\n    // if(reverse) for(let i = 0; i < length; ++i) promises.push(cb(messages[i]));\r\n    // else for(let i = length - 1; i >= 0; --i) promises.push(cb(messages[i]));\r\n    const promises = messages.map(cb);\r\n\r\n    // cannot combine them into one promise\r\n    await Promise.all(promises);\r\n    await this.messagesQueuePromise;\r\n\r\n    if(this.scrollable.loadedAll.top && this.messagesQueueOnRenderAdditional) {\r\n      this.messagesQueueOnRenderAdditional();\r\n\r\n      if(this.messagesQueueOnRenderAdditional) {\r\n        this.messagesQueueOnRenderAdditional();\r\n      }\r\n    }\r\n\r\n    log && log('performHistoryResult end');\r\n  }\r\n\r\n  private onRenderScrollSet(state?: {scrollHeight: number, clientHeight: number}) {\r\n    const className = 'has-sticky-dates';\r\n    if(!this.container.classList.contains(className)) {\r\n      const isLoading = !this.preloader.detached;\r\n\r\n      if(isLoading ||\r\n        (\r\n          state ??= {\r\n            scrollHeight: this.scrollable.scrollHeight,\r\n            clientHeight: this.scrollable.container.clientHeight\r\n          },\r\n          state.scrollHeight !== state.clientHeight\r\n        )\r\n      ) {\r\n        /* for(const timestamp in this.dateMessages) {\r\n          const dateMessage = this.dateMessages[timestamp];\r\n          dateMessage.div.classList.add('is-sticky');\r\n        } */\r\n\r\n        const middleware = this.getMiddleware();\r\n        const callback = () => {\r\n          if(!middleware()) return;\r\n          this.container.classList.add(className);\r\n        };\r\n\r\n        if(this.willScrollOnLoad) {\r\n          callback();\r\n        } else {\r\n          setTimeout(callback, 600);\r\n        }\r\n\r\n        return;\r\n      }\r\n    }\r\n\r\n    this.willScrollOnLoad = undefined;\r\n  }\r\n\r\n  public onDatePick = (timestamp: number) => {\r\n    const peerId = this.peerId;\r\n    this.managers.appMessagesManager.requestHistory(peerId, 0, 2, -1, timestamp, this.chat.threadId).then((history) => {\r\n      if(!history?.messages?.length) {\r\n        this.log.error('no history!');\r\n        return;\r\n      } else if(this.peerId !== peerId) {\r\n        return;\r\n      }\r\n\r\n      this.chat.setMessageId((history.messages[0] as MyMessage).mid);\r\n      // console.log('got history date:', history);\r\n    });\r\n  };\r\n\r\n  public requestHistory(maxId: number, loadCount: number, backLimit: number) {\r\n    // const middleware = this.getMiddleware();\r\n    if(this.chat.type === 'chat' || this.chat.type === 'discussion') {\r\n      return this.managers.acknowledged.appMessagesManager.getHistory(this.peerId, maxId, loadCount, backLimit, this.chat.threadId);\r\n    } else if(this.chat.type === 'pinned') {\r\n      return this.managers.acknowledged.appMessagesManager.getSearch({\r\n        peerId: this.peerId,\r\n        inputFilter: {_: 'inputMessagesFilterPinned'},\r\n        maxId,\r\n        limit: loadCount,\r\n        backLimit\r\n      }).then((ackedResult) => {\r\n        return {\r\n          cached: ackedResult.cached,\r\n          result: Promise.resolve(ackedResult.result).then((value) => {\r\n            return {history: value.history.map((m) => m.mid)};\r\n          })\r\n        };\r\n      });\r\n    } else if(this.chat.type === 'scheduled') {\r\n      return this.managers.acknowledged.appMessagesManager.getScheduledMessages(this.peerId).then((ackedResult) => {\r\n        // this.setLoaded('top', true);\r\n        // this.setLoaded('bottom', true);\r\n        return {\r\n          cached: ackedResult.cached,\r\n          result: Promise.resolve(ackedResult.result).then((mids) => ({history: mids.slice().reverse()}))\r\n        };\r\n      });\r\n    }\r\n  }\r\n\r\n  private async animateAsLadder(additionMsgId: number, additionMsgIds: number[], isAdditionRender: boolean, backLimit: number, maxId: number) {\r\n    /* const middleware = this.getMiddleware();\r\n    await this.ladderDeferred; */\r\n\r\n    const log = this.log.bindPrefix('ladder');\r\n    if(this.chat.setPeerPromise && !this.resolveLadderAnimation) {\r\n      log.warn('will be delayed');\r\n      // @ts-ignore\r\n      this.resolveLadderAnimation = this.animateAsLadder.bind(this, additionMsgId, additionMsgIds, isAdditionRender, backLimit, maxId);\r\n      return;\r\n    }\r\n\r\n    /* if(!middleware()) {\r\n      return;\r\n    } */\r\n\r\n    if(!Object.keys(this.bubbles).length) {\r\n      log.warn('no bubbles');\r\n      return;\r\n    }\r\n\r\n    let sortedMids = getObjectKeysAndSort(this.bubbles, 'desc');\r\n\r\n    if(isAdditionRender && additionMsgIds.length) {\r\n      sortedMids = sortedMids.filter((mid) => !additionMsgIds.includes(mid));\r\n    }\r\n\r\n    let targetMid: number;\r\n    if(backLimit) {\r\n      targetMid = maxId || Math.max(...sortedMids); // * on discussion enter\r\n    } else {\r\n      if(additionMsgId) {\r\n        targetMid = additionMsgId;\r\n      } else { // * if maxId === 0\r\n        targetMid = Math.max(...sortedMids);\r\n      }\r\n    }\r\n\r\n    const topIds = sortedMids.slice(sortedMids.findIndex((mid) => targetMid > mid));\r\n    const middleIds = isAdditionRender ? [] : [targetMid];\r\n    const bottomIds = isAdditionRender ? [] : sortedMids.slice(0, sortedMids.findIndex((mid) => targetMid >= mid)).reverse();\r\n\r\n    if(DEBUG) {\r\n      log('targeting mid:', targetMid, maxId, additionMsgId,\r\n        topIds.map((m) => getServerMessageId(m)),\r\n        bottomIds.map((m) => getServerMessageId(m)));\r\n    }\r\n\r\n    const setBubbles: HTMLElement[] = [];\r\n\r\n    this.chatInner.classList.add('zoom-fading');\r\n    const delay = isAdditionRender ? 10 : 40;\r\n    const offsetIndex = isAdditionRender ? 0 : 1;\r\n    const animateAsLadder = (mids: number[], offsetIndex = 0) => {\r\n      const animationPromise = deferredPromise<void>();\r\n      let lastMsDelay = 0;\r\n      mids.forEach((mid, idx) => {\r\n        const bubble = this.bubbles[mid];\r\n        if(!bubble || this.skippedMids.has(mid)) {\r\n          log.warn('no bubble by mid:', mid);\r\n          return;\r\n        }\r\n\r\n        lastMsDelay = ((idx + offsetIndex) || 0.1) * delay;\r\n        // lastMsDelay = (idx + offsetIndex) * delay;\r\n        // lastMsDelay = (idx || 0.1) * 1000;\r\n\r\n        const contentWrapper = bubble.lastElementChild as HTMLElement;\r\n        const elementsToAnimate: HTMLElement[] = [contentWrapper];\r\n        const item = this.bubbleGroups.getItemByBubble(bubble);\r\n        if(item && item.group.avatar && item.group.lastItem === item) {\r\n          elementsToAnimate.push(item.group.avatar);\r\n        }\r\n\r\n        elementsToAnimate.forEach((element) => {\r\n          element.classList.add('zoom-fade', 'can-zoom-fade');\r\n          element.style.transitionDelay = lastMsDelay + 'ms';\r\n        });\r\n\r\n        if(idx === (mids.length - 1)) {\r\n          const onTransitionEnd = (e: TransitionEvent) => {\r\n            if(e.target !== contentWrapper) {\r\n              return;\r\n            }\r\n\r\n            animationPromise.resolve();\r\n            contentWrapper.removeEventListener('transitionend', onTransitionEnd);\r\n          };\r\n\r\n          contentWrapper.addEventListener('transitionend', onTransitionEnd);\r\n        }\r\n\r\n        setBubbles.push(...elementsToAnimate);\r\n      });\r\n\r\n      if(!mids.length) {\r\n        animationPromise.resolve();\r\n      }\r\n\r\n      return {lastMsDelay, animationPromise};\r\n    };\r\n\r\n    const topRes = animateAsLadder(topIds, offsetIndex);\r\n    const middleRes = animateAsLadder(middleIds);\r\n    const bottomRes = animateAsLadder(bottomIds, offsetIndex);\r\n    const promises = [topRes.animationPromise, middleRes.animationPromise, bottomRes.animationPromise];\r\n    const delays: number[] = [topRes.lastMsDelay, middleRes.lastMsDelay, bottomRes.lastMsDelay];\r\n\r\n    if(this.onAnimateLadder) {\r\n      await this.onAnimateLadder();\r\n    }\r\n\r\n    fastRaf(() => {\r\n      this.setStickyDateManually(); // ! maybe it's not efficient\r\n\r\n      setBubbles.forEach((element) => {\r\n        element.classList.remove('zoom-fade');\r\n      });\r\n    });\r\n\r\n    let promise: Promise<any>;\r\n    if(topIds.length || middleIds.length || bottomIds.length) {\r\n      promise = Promise.all(promises);\r\n\r\n      dispatchHeavyAnimationEvent(promise, Math.max(...delays) + 200) // * 200 - transition time\r\n      .then(() => {\r\n        fastRaf(() => {\r\n          setBubbles.forEach((element) => {\r\n            element.style.transitionDelay = '';\r\n            element.classList.remove('can-zoom-fade');\r\n          });\r\n\r\n          this.chatInner.classList.remove('zoom-fading');\r\n        });\r\n\r\n        // !  , -  - zoom-fade        ,\r\n        // ! ..   ,  ,     translateZ    scrollable\r\n        // if(!IS_SAFARI) {\r\n        //   this.needReflowScroll = true;\r\n        // }\r\n      });\r\n    }\r\n\r\n    return promise;\r\n  }\r\n\r\n  private async renderEmptyPlaceholder(\r\n    type: 'group' | 'saved' | 'noMessages' | 'noScheduledMessages' | 'greeting' | 'restricted',\r\n    bubble: HTMLElement,\r\n    message: any,\r\n    elements: (Node | string)[]\r\n  ) {\r\n    const BASE_CLASS = 'empty-bubble-placeholder';\r\n    bubble.classList.add(BASE_CLASS, BASE_CLASS + '-' + type);\r\n\r\n    let title: HTMLElement;\r\n    if(type === 'group') title = i18n('GroupEmptyTitle1');\r\n    else if(type === 'saved') title = i18n('ChatYourSelfTitle');\r\n    else if(type === 'noMessages' || type === 'greeting') title = i18n('NoMessages');\r\n    else if(type === 'noScheduledMessages') title = i18n('NoScheduledMessages');\r\n    else if(type === 'restricted') {\r\n      title = document.createElement('span');\r\n      title.innerText = await this.managers.appPeersManager.getRestrictionReasonText(this.peerId);\r\n    }\r\n    title.classList.add('center', BASE_CLASS + '-title');\r\n\r\n    elements.push(title);\r\n\r\n    let listElements: HTMLElement[];\r\n    if(type === 'group') {\r\n      elements.push(i18n('GroupEmptyTitle2'));\r\n      listElements = [\r\n        i18n('GroupDescription1'),\r\n        i18n('GroupDescription2'),\r\n        i18n('GroupDescription3'),\r\n        i18n('GroupDescription4')\r\n      ];\r\n    } else if(type === 'saved') {\r\n      listElements = [\r\n        i18n('ChatYourSelfDescription1'),\r\n        i18n('ChatYourSelfDescription2'),\r\n        i18n('ChatYourSelfDescription3'),\r\n        i18n('ChatYourSelfDescription4')\r\n      ];\r\n    } else if(type === 'greeting') {\r\n      const subtitle = i18n('NoMessagesGreetingsDescription');\r\n      subtitle.classList.add('center', BASE_CLASS + '-subtitle');\r\n\r\n      // findAndSplice(this.messagesQueue, q => q.bubble === bubble);\r\n\r\n      const stickerDiv = document.createElement('div');\r\n      stickerDiv.classList.add(BASE_CLASS + '-sticker');\r\n\r\n      const middleware = this.getMiddleware();\r\n\r\n      await this.managers.appStickersManager.getGreetingSticker().then(async(doc) => {\r\n        if(!middleware()) return;\r\n\r\n        const loadPromises: Promise<any>[] = [];\r\n        await wrapSticker({\r\n          doc,\r\n          // doc: appDocsManager.getDoc(\"5431607541660389336\"), // cubigator mockup\r\n          div: stickerDiv,\r\n          middleware,\r\n          lazyLoadQueue: this.lazyLoadQueue,\r\n          group: CHAT_ANIMATION_GROUP,\r\n          // play: !!message.pending || !multipleRender,\r\n          play: true,\r\n          loop: true,\r\n          withThumb: true,\r\n          loadPromises\r\n        });\r\n\r\n        attachClickEvent(stickerDiv, (e) => {\r\n          cancelEvent(e);\r\n          EmoticonsDropdown.onMediaClick({target: e.target});\r\n        });\r\n\r\n        return Promise.all(loadPromises);\r\n      });\r\n\r\n      // this.renderMessagesQueue({\r\n      //   message,\r\n      //   bubble,\r\n      //   reverse: false,\r\n      //   promises: [loadPromise]\r\n      // });\r\n\r\n      elements.push(subtitle, stickerDiv);\r\n    }\r\n\r\n    if(listElements) {\r\n      elements.push(\r\n        ...listElements.map((elem) => {\r\n          const span = document.createElement('span');\r\n          span.classList.add(BASE_CLASS + '-list-item');\r\n          span.append(elem);\r\n          return span;\r\n        })\r\n      );\r\n\r\n      if(type === 'group') {\r\n        listElements.forEach((elem) => {\r\n          const i = document.createElement('span');\r\n          i.classList.add('tgico-check');\r\n          elem.prepend(i);\r\n        });\r\n      } else if(type === 'saved') {\r\n        listElements.forEach((elem) => {\r\n          const i = document.createElement('span');\r\n          i.classList.add(BASE_CLASS + '-list-bullet');\r\n          i.innerText = '';\r\n          elem.prepend(i);\r\n        });\r\n      }\r\n    }\r\n\r\n    if(elements.length > 1) {\r\n      bubble.classList.add('has-description');\r\n    }\r\n\r\n    elements.forEach((element: any) => element.classList.add(BASE_CLASS + '-line'));\r\n  }\r\n\r\n  private async processLocalMessageRender(message: Message.message | Message.messageService, animate?: boolean) {\r\n    const isSponsored = !!(message as Message.message).pFlags.sponsored;\r\n    const middleware = this.getMiddleware();\r\n    const m = middlewarePromise(middleware);\r\n    return this.safeRenderMessage(message, isSponsored ? false : true, undefined, isSponsored, async(result) => {\r\n      const {bubble} = await m(result);\r\n      if(!bubble) {\r\n        return result;\r\n      }\r\n\r\n      bubble.classList.add('is-group-last', 'is-group-first');\r\n\r\n      const updatePosition = () => {\r\n        if(this.updatePlaceholderPosition === updatePosition) {\r\n          this.updatePlaceholderPosition = undefined;\r\n        }\r\n\r\n        appendTo[method](bubble);\r\n      };\r\n\r\n      if(!isSponsored) {\r\n        bubble.classList.add('bubble-first');\r\n        bubble.classList.remove('can-have-tail', 'is-in');\r\n      }\r\n\r\n      const elements: (Node | string)[] = [];\r\n      const isBot = this.chat.isBot;\r\n      let renderPromise: Promise<any>, appendTo = this.container, method: 'append' | 'prepend' = 'append';\r\n      if(this.chat.isRestricted) {\r\n        renderPromise = this.renderEmptyPlaceholder('restricted', bubble, message, elements);\r\n      } else if(isSponsored) {\r\n        let text: LangPackKey, mid: number, startParam: string, callback: () => void;\r\n\r\n        bubble.classList.add('avoid-selection');\r\n\r\n        const sponsoredMessage = this.sponsoredMessage = (message as Message.message).sponsoredMessage;\r\n        const peerId = getPeerId(sponsoredMessage.from_id);\r\n        // const peer = this.appPeersManager.getPeer(peerId);\r\n        if(sponsoredMessage.channel_post) {\r\n          text = 'OpenChannelPost';\r\n          mid = generateMessageId(sponsoredMessage.channel_post);\r\n        } else if(sponsoredMessage.start_param || isBot) {\r\n          text = 'Chat.Message.ViewBot';\r\n          startParam = sponsoredMessage.start_param;\r\n        } else {\r\n          text = await this.managers.appPeersManager.isAnyGroup(peerId) ? 'Chat.Message.ViewGroup' : 'Chat.Message.ViewChannel';\r\n        }\r\n\r\n        if(sponsoredMessage.chat_invite) {\r\n          callback = () => {\r\n            new PopupJoinChatInvite(sponsoredMessage.chat_invite_hash, sponsoredMessage.chat_invite as ChatInvite.chatInvite);\r\n          };\r\n        } else if(sponsoredMessage.chat_invite_hash) {\r\n          callback = () => {\r\n            const link: InternalLink = {\r\n              _: INTERNAL_LINK_TYPE.JOIN_CHAT,\r\n              invite: sponsoredMessage.chat_invite_hash\r\n            };\r\n\r\n            this.chat.appImManager.processInternalLink(link);\r\n          };\r\n        } else {\r\n          callback = () => {\r\n            this.chat.appImManager.setInnerPeer({\r\n              peerId,\r\n              lastMsgId: mid,\r\n              startParam\r\n            });\r\n          };\r\n        }\r\n\r\n        const button = Button('btn-primary btn-primary-transparent bubble-view-button', {\r\n          text\r\n        });\r\n\r\n        this.observer.observe(button, this.viewsObserverCallback);\r\n\r\n        if(callback) {\r\n          attachClickEvent(button, callback);\r\n        }\r\n\r\n        bubble.querySelector('.bubble-content').prepend(button);\r\n\r\n        return result;\r\n      } else if(isBot && message._ === 'message') {\r\n        const b = document.createElement('b');\r\n        b.append(i18n('BotInfoTitle'));\r\n        elements.push(b, '\\n\\n');\r\n        appendTo = this.chatInner;\r\n        method = 'prepend';\r\n      } else if(await m(this.managers.appPeersManager.isAnyGroup(this.peerId)) && (await m(this.managers.appPeersManager.getPeer(this.peerId))).pFlags.creator) {\r\n        renderPromise = this.renderEmptyPlaceholder('group', bubble, message, elements);\r\n      } else if(this.chat.type === 'scheduled') {\r\n        renderPromise = this.renderEmptyPlaceholder('noScheduledMessages', bubble, message, elements);\r\n      } else if(rootScope.myId === this.peerId) {\r\n        renderPromise = this.renderEmptyPlaceholder('saved', bubble, message, elements);\r\n      } else if(this.peerId.isUser() && !isBot && await m(this.chat.canSend()) && this.chat.type === 'chat') {\r\n        renderPromise = this.renderEmptyPlaceholder('greeting', bubble, message, elements);\r\n      } else {\r\n        renderPromise = this.renderEmptyPlaceholder('noMessages', bubble, message, elements);\r\n      }\r\n\r\n      if(renderPromise) {\r\n        await renderPromise;\r\n      }\r\n\r\n      if(elements.length) {\r\n        const messageDiv = bubble.querySelector('.message, .service-msg');\r\n        messageDiv.prepend(...elements);\r\n      }\r\n\r\n      const isWaitingForAnimation = !!this.messagesQueueOnRenderAdditional;\r\n      const noTransition = this.setPeerCached && !isWaitingForAnimation;\r\n      if(noTransition) {\r\n        const setOn = bubble.firstElementChild;\r\n        setOn.classList.add('no-transition');\r\n\r\n        if(this.chat.setPeerPromise) {\r\n          this.chat.setPeerPromise.catch(noop).finally(() => {\r\n            setOn.classList.remove('no-transition');\r\n          });\r\n        }\r\n      }\r\n\r\n      if(animate === undefined && !noTransition) {\r\n        animate = true;\r\n      }\r\n\r\n      if(isWaitingForAnimation || animate) {\r\n        this.updatePlaceholderPosition = updatePosition;\r\n\r\n        this.onAnimateLadder = () => {\r\n          // appendTo[method](bubble);\r\n          this.onAnimateLadder = undefined;\r\n\r\n          // need raf here because animation won't fire if this message is single\r\n          if(!this.messagesQueuePromise) {\r\n            return fastRafPromise();\r\n          }\r\n        };\r\n      } else if(this.chat.setPeerPromise) {\r\n        this.attachPlaceholderOnRender = () => {\r\n          this.attachPlaceholderOnRender = undefined;\r\n          updatePosition();\r\n          // appendTo[method](bubble);\r\n        };\r\n      } else {\r\n        this.updatePlaceholderPosition = updatePosition;\r\n        // appendTo[method](bubble);\r\n      }\r\n\r\n      if(!isWaitingForAnimation && animate) {\r\n        await m(getHeavyAnimationPromise());\r\n        const additionMsgIds = getObjectKeysAndSort(this.bubbles);\r\n        indexOfAndSplice(additionMsgIds, message.mid);\r\n        this.animateAsLadder(message.mid, additionMsgIds, false, 0, 0);\r\n      }\r\n\r\n      // if(!isSponsored) {\r\n      this.emptyPlaceholderBubble = bubble;\r\n      // }\r\n\r\n      return result;\r\n    });\r\n  }\r\n\r\n  private generateLocalMessageId(addOffset = 0) {\r\n    // const INCREMENT = 0x10;\r\n    const offset = (this.chat.type === 'scheduled' ? -1 : 0) + addOffset;\r\n    // offset = generateMessageId(offset);\r\n    // id: -Math.abs(+this.peerId * INCREMENT + offset),\r\n    const id = -Math.abs(offset);\r\n    const mid = -Math.abs(generateMessageId(id));\r\n    return {id, mid};\r\n  }\r\n\r\n  private async generateLocalFirstMessage<T extends boolean>(service?: T, fill?: (message: GenerateLocalMessageType<T>) => void, addOffset = 0): Promise<GenerateLocalMessageType<T>> {\r\n    const {id, mid} = this.generateLocalMessageId(addOffset);\r\n    let message: Omit<Message.message | Message.messageService, 'message'> & {message?: string} = {\r\n      _: service ? 'messageService' : 'message',\r\n      date: 0,\r\n      id,\r\n      mid,\r\n      peer_id: await this.managers.appPeersManager.getOutputPeer(this.peerId),\r\n      pFlags: {\r\n        local: true\r\n      }\r\n    };\r\n\r\n    if(!service) {\r\n      message.message = '';\r\n    }/*  else {\r\n      (message as Message.messageService).action = {} as any;\r\n    } */\r\n\r\n    assumeType<GenerateLocalMessageType<T>>(message);\r\n\r\n    fill && fill(message);\r\n\r\n    const savedMessages = await this.managers.appMessagesManager.saveMessages([message], {storage: new Map() as any});\r\n    message = savedMessages[0];\r\n    message.mid = mid;\r\n    return message as any;\r\n  }\r\n\r\n  public getViewportSlice() {\r\n    // this.log.trace('viewport slice');\r\n    return getViewportSlice({\r\n      overflowElement: this.scrollable.container,\r\n      selector: '.bubbles-date-group .bubble:not(.is-date)',\r\n      extraSize: Math.max(700, windowSize.height) * 2\r\n    });\r\n  }\r\n\r\n  public deleteViewportSlice(slice: ReturnType<ChatBubbles['getViewportSlice']>, ignoreScrollSaving?: boolean) {\r\n    if(DO_NOT_SLICE_VIEWPORT_ON_RENDER) {\r\n      return;\r\n    }\r\n\r\n    const {invisibleTop, invisibleBottom} = slice;\r\n    const invisible = invisibleTop.concat(invisibleBottom);\r\n    if(!invisible.length) {\r\n      return;\r\n    }\r\n\r\n    if(invisibleTop.length) {\r\n      this.setLoaded('top', false);\r\n      this.getHistoryTopPromise = undefined;\r\n    }\r\n\r\n    if(invisibleBottom.length) {\r\n      this.setLoaded('bottom', false);\r\n      this.getHistoryBottomPromise = undefined;\r\n    }\r\n\r\n    const mids = invisible.map(({element}) => +element.dataset.mid);\r\n\r\n    let scrollSaver: ScrollSaver;\r\n    if(!!invisibleTop.length !== !!invisibleBottom.length && !ignoreScrollSaving) {\r\n      scrollSaver = this.createScrollSaver(!!invisibleTop.length);\r\n      scrollSaver.save();\r\n    }\r\n\r\n    this.deleteMessagesByIds(mids, false, true);\r\n\r\n    if(scrollSaver) {\r\n      scrollSaver.restore();\r\n    } else if(invisibleTop.length) {\r\n      this.scrollable.lastScrollPosition = this.scrollable.scrollTop;\r\n    }\r\n  }\r\n\r\n  public sliceViewport(ignoreHeavyAnimation?: boolean) {\r\n    // Safari cannot reset the scroll.\r\n    if(IS_SAFARI || (this.isHeavyAnimationInProgress && !ignoreHeavyAnimation) || DO_NOT_SLICE_VIEWPORT) {\r\n      return;\r\n    }\r\n\r\n    // const scrollSaver = new ScrollSaver(this.scrollable, true);\r\n    // scrollSaver.save();\r\n    const slice = this.getViewportSlice();\r\n    // if(IS_SAFARI) slice.invisibleTop = [];\r\n    this.deleteViewportSlice(slice);\r\n    // scrollSaver.restore();\r\n  }\r\n\r\n  private async setLoaded(side: SliceSides, value: boolean, checkPlaceholders = true) {\r\n    const willChange = this.scrollable.loadedAll[side] !== value;\r\n    if(!willChange) {\r\n      return;\r\n    }\r\n\r\n    const log = this.log.bindPrefix('setLoaded');\r\n    log('change', side, value);\r\n\r\n    this.scrollable.loadedAll[side] = value;\r\n    this.scrollable.onScroll(); // ! WARNING\r\n    // return;\r\n\r\n    if(!checkPlaceholders) {\r\n      return;\r\n    }\r\n\r\n    if(!this.chat.isRestricted) {\r\n      if(side === 'bottom' && this.chat.isBroadcast/*  && false */) {\r\n        this.toggleSponsoredMessage(value);\r\n      }\r\n\r\n      if(side === 'top' && value && this.chat.isBot) {\r\n        return this.renderBotPlaceholder();\r\n      }\r\n    }\r\n\r\n    return this.checkIfEmptyPlaceholderNeeded();\r\n  }\r\n\r\n  private async toggleSponsoredMessage(value: boolean) {\r\n    const _log = this.log.bindPrefix('sponsored');\r\n    _log('checking');\r\n    const {mid} = this.generateLocalMessageId(SPONSORED_MESSAGE_ID_OFFSET);\r\n    if(value) {\r\n      const middleware = this.getMiddleware(() => {\r\n        return this.scrollable.loadedAll.bottom && !this.bubbles[mid] && this.getSponsoredMessagePromise === promise;\r\n      });\r\n\r\n      const promise = this.getSponsoredMessagePromise = this.managers.appChatsManager.getSponsoredMessage(this.peerId.toChatId())\r\n      .then(async(sponsoredMessages) => {\r\n        const sponsoredMessage = sponsoredMessages.messages[0];\r\n        if(!sponsoredMessage) {\r\n          _log('no message');\r\n          return;\r\n        }\r\n\r\n        const messagePromise = this.generateLocalFirstMessage(false, (message) => {\r\n          message.message = sponsoredMessage.message;\r\n          message.from_id = sponsoredMessage.from_id;\r\n          message.entities = sponsoredMessage.entities;\r\n          message.pFlags.sponsored = true;\r\n          message.sponsoredMessage = sponsoredMessage;\r\n        }, SPONSORED_MESSAGE_ID_OFFSET);\r\n\r\n        return Promise.all([\r\n          messagePromise,\r\n          this.getHistoryTopPromise, // wait for top load and execute rendering after or with it\r\n          this.messagesQueuePromise\r\n        ]).then(([message]) => {\r\n          if(!middleware()) return;\r\n          // this.processLocalMessageRender(message);\r\n          _log('rendering', message);\r\n          const promise = this.performHistoryResult({history: [message]}, false);\r\n        });\r\n      }).finally(() => {\r\n        this.getSponsoredMessagePromise = undefined;\r\n      });\r\n    } else {\r\n      _log('clearing rendered', mid);\r\n      this.deleteMessagesByIds([mid]);\r\n      this.getSponsoredMessagePromise = undefined;\r\n    }\r\n  }\r\n\r\n  private async renderBotPlaceholder() {\r\n    const _log = this.log.bindPrefix('bot placeholder');\r\n\r\n    const middleware = this.getMiddleware();\r\n    const result = await this.managers.acknowledged.appProfileManager.getProfile(this.peerId.toUserId());\r\n    _log('getting profile, cached:', result.cached);\r\n    const processPromise = result.result.then(async(userFull) => {\r\n      if(!middleware()) {\r\n        return;\r\n      }\r\n\r\n      if(!userFull.bot_info?.description) {\r\n        _log.warn('no description');\r\n        return this.checkIfEmptyPlaceholderNeeded();\r\n      }\r\n\r\n      const message = await this.generateLocalFirstMessage(false, (message) => {\r\n        const botInfo = userFull.bot_info;\r\n        message.message = botInfo.description;\r\n        if(botInfo.description_document) message.media = {_: 'messageMediaDocument', document: botInfo.description_document};\r\n        if(botInfo.description_photo) message.media = {_: 'messageMediaPhoto', photo: botInfo.description_photo};\r\n      });\r\n\r\n      if(!middleware()) {\r\n        return;\r\n      }\r\n\r\n      _log('rendering');\r\n      const renderPromise = this.processLocalMessageRender(message, !result.cached).then(() => {\r\n        _log('done');\r\n      });\r\n\r\n      return {renderPromise};\r\n    });\r\n\r\n    if(!result.cached) {\r\n      return;\r\n    }\r\n\r\n    return processPromise;\r\n  }\r\n\r\n  public async checkIfEmptyPlaceholderNeeded() {\r\n    if(this.scrollable.loadedAll.top &&\r\n      this.scrollable.loadedAll.bottom &&\r\n      this.emptyPlaceholderBubble === undefined &&\r\n      (\r\n        this.chat.isRestricted ||\r\n        !(await this.chat.getHistoryStorage()).count ||\r\n        (\r\n          !Object.keys(this.bubbles).length ||\r\n          // ! WARNING ! ! ! ! ! ! REPLACE LINE ABOVE WITH THESE\r\n          Object.keys(this.bubbles).length &&\r\n          !this.getRenderedLength()\r\n        ) ||\r\n        (this.chat.type === 'scheduled' && !Object.keys(this.bubbles).length)\r\n      )\r\n    ) {\r\n      this.log('inject empty peer placeholder');\r\n\r\n      const message = await this.generateLocalFirstMessage(true);\r\n      return {renderPromise: this.processLocalMessageRender(message)};\r\n    }\r\n  }\r\n\r\n  public getHistory1(maxId?: number, reverse?: boolean, isBackLimit?: boolean, additionMsgId?: number, justLoad?: boolean) {\r\n    const middleware = this.getMiddleware(justLoad ? undefined : () => {\r\n      return (reverse ? this.getHistoryTopPromise : this.getHistoryBottomPromise) === waitPromise;\r\n    });\r\n\r\n    const result = this.getHistory(maxId, reverse, isBackLimit, additionMsgId, justLoad, middleware);\r\n    const waitPromise = result.then((res) => res && (res.waitPromise || res.promise));\r\n\r\n    (reverse ? this.getHistoryTopPromise = waitPromise : this.getHistoryBottomPromise = waitPromise);\r\n    waitPromise.then(() => {\r\n      if(!middleware()) {\r\n        return;\r\n      }\r\n\r\n      (reverse ? this.getHistoryTopPromise = undefined : this.getHistoryBottomPromise = undefined);\r\n\r\n      if(!justLoad) {\r\n        // preload more\r\n        // if(!isFirstMessageRender) {\r\n        if(this.chat.type === 'chat'/*  || this.chat.type === 'discussion' */) {\r\n          /* const storage = this.appMessagesManager.getHistoryStorage(peerId, this.chat.threadId);\r\n            const isMaxIdInHistory = storage.history.indexOf(maxId) !== -1;\r\n            if(isMaxIdInHistory || true) { // * otherwise it is a search or jump */\r\n          setTimeout(() => {\r\n            if(reverse) {\r\n              this.loadMoreHistory(true, true);\r\n            } else {\r\n              this.loadMoreHistory(false, true);\r\n            }\r\n          }, 0);\r\n          // }\r\n        }\r\n        // }\r\n\r\n        // this.scrollable.onScroll();\r\n      }\r\n    });\r\n\r\n    return result;\r\n  }\r\n\r\n  /**\r\n   * Load and render history\r\n   * @param maxId max message id\r\n   * @param reverse 'true' means up\r\n   * @param isBackLimit is search\r\n   * @param additionMsgId for the last message\r\n   * @param justLoad do not render\r\n   */\r\n  public async getHistory(\r\n    maxId = 0,\r\n    reverse = false,\r\n    isBackLimit = false,\r\n    additionMsgId = 0,\r\n    justLoad = false,\r\n    middleware?: () => boolean\r\n  ): Promise<{cached: boolean, promise: Promise<void>, waitPromise: Promise<any>}> {\r\n    const peerId = this.peerId;\r\n\r\n    const isBroadcast = this.chat.isBroadcast;\r\n    // console.time('appImManager call getHistory');\r\n    const pageCount = Math.min(30, windowSize.height / 40/*  * 1.25 */ | 0);\r\n    // const loadCount = Object.keys(this.bubbles).length > 0 ? 50 : pageCount;\r\n    const realLoadCount = isBroadcast ? 20 : (Object.keys(this.bubbles).length > 0 ? Math.max(35, pageCount) : pageCount);\r\n    // const realLoadCount = pageCount;//const realLoadCount = 50;\r\n    let loadCount = realLoadCount;\r\n\r\n    /* if(TEST_SCROLL) {\r\n      //loadCount = 1;\r\n      if(Object.keys(this.bubbles).length > 0)\r\n      return {cached: false, promise: Promise.resolve(true)};\r\n    } */\r\n    if(TEST_SCROLL !== undefined) {\r\n      if(TEST_SCROLL) {\r\n        if(Object.keys(this.bubbles).length > 0) {\r\n          --TEST_SCROLL;\r\n        }\r\n      } else {\r\n        return {cached: false, promise: Promise.resolve(), waitPromise: Promise.resolve()};\r\n      }\r\n    }\r\n\r\n    // //console.time('render history total');\r\n\r\n    let backLimit = 0;\r\n    if(isBackLimit) {\r\n      backLimit = loadCount;\r\n\r\n      if(!reverse) { // if not jump\r\n        loadCount = 0;\r\n        // maxId = this.appMessagesManager.incrementMessageId(maxId, 1);\r\n      }\r\n    }\r\n\r\n    let additionMsgIds: number[];\r\n    if(additionMsgId && !isBackLimit) {\r\n      if(this.chat.type === 'pinned') {\r\n        additionMsgIds = [additionMsgId];\r\n      } else {\r\n        const historyStorage = await this.chat.getHistoryStorage();\r\n        const slice = historyStorage.history.slice;\r\n        if(slice.length < loadCount && !slice.isEnd(SliceEnd.Both)) {\r\n          additionMsgIds = slice.slice();\r\n\r\n          // * filter last album, because we don't know is it the last item\r\n          for(let i = additionMsgIds.length - 1; i >= 0; --i) {\r\n            const message = await this.chat.getMessage(additionMsgIds[i]);\r\n            if((message as Message.message)?.grouped_id) additionMsgIds.splice(i, 1);\r\n            else break;\r\n          }\r\n\r\n          maxId = additionMsgIds[additionMsgIds.length - 1] || maxId;\r\n        }\r\n      }\r\n    }\r\n\r\n    /* const result = additionMsgID ?\r\n      {history: [additionMsgID]} :\r\n      appMessagesManager.getHistory(this.peerId, maxId, loadCount, backLimit); */\r\n    let result: AckedResult<MyHistoryResult> = await this.requestHistory(maxId, loadCount, backLimit) as any;\r\n    let resultPromise: typeof result['result'];\r\n\r\n    // const isFirstMessageRender = !!additionMsgID && result.cached && !appMessagesManager.getMessage(additionMsgID).grouped_id;\r\n    const isAdditionRender = additionMsgIds?.length && !result.cached;\r\n    const isFirstMessageRender = (this.isFirstLoad && backLimit && !result.cached) || isAdditionRender;\r\n    if(isAdditionRender) {\r\n      resultPromise = result.result;\r\n\r\n      result = {\r\n        cached: true,\r\n        result: Promise.resolve({history: additionMsgIds})\r\n      };\r\n\r\n      // additionMsgID = 0;\r\n    }\r\n\r\n    this.isFirstLoad = false;\r\n\r\n    const processResult = async(historyResult: Awaited<typeof result['result']>) => {\r\n      if((historyResult as HistoryResult).isEnd?.top) {\r\n        if(this.chat.type === 'discussion') { // * inject discussion start\r\n          const serviceStartMessageId = await this.managers.appMessagesManager.getThreadServiceMessageId(this.peerId, this.chat.threadId);\r\n          if(serviceStartMessageId) historyResult.history.push(serviceStartMessageId);\r\n          const mids = await this.chat.getMidsByMid(this.chat.threadId);\r\n          historyResult.history.push(...mids.reverse());\r\n        }\r\n\r\n        // synchronize bot placeholder appearance\r\n        await this.managers.appProfileManager.getProfileByPeerId(peerId);\r\n\r\n        // await this.setLoaded('top', true);\r\n      }\r\n    };\r\n\r\n    const sup = (historyResult: Awaited<typeof result['result']>) => {\r\n      return getHeavyAnimationPromise().then(() => {\r\n        return processResult(historyResult);\r\n      }).then(() => {\r\n        if(!isAdditionRender && additionMsgId) {\r\n          historyResult.history.unshift(additionMsgId);\r\n        }\r\n\r\n        return this.performHistoryResult(historyResult, reverse);\r\n      });\r\n    };\r\n\r\n    const processPromise = (_promise: typeof result['result']) => {\r\n      const promise = Promise.resolve(_promise).then((result) => {\r\n        if(middleware && !middleware()) {\r\n          throw PEER_CHANGED_ERROR;\r\n        }\r\n\r\n        if(justLoad) {\r\n          //   -  \r\n          this.scrollable.onScroll();\r\n          // fastRaf(() => {\r\n          //   this.scrollable.checkForTriggers();\r\n          // });\r\n          return;\r\n        }\r\n\r\n        return sup(result);\r\n      }, (err) => {\r\n        this.log.error('getHistory error:', err);\r\n        throw err;\r\n      });\r\n\r\n      return promise;\r\n    };\r\n\r\n    let promise: Promise<void>, cached: boolean;\r\n    if(!result.cached) {\r\n      cached = false;\r\n      promise = processPromise(result.result);\r\n    } else if(justLoad) {\r\n      //   -  \r\n      this.scrollable.onScroll();\r\n      return null;\r\n    } else {\r\n      cached = true;\r\n      promise = sup(await result.result);\r\n    }\r\n\r\n    const waitPromise = isAdditionRender ? processPromise(resultPromise) : promise;\r\n\r\n    if(isFirstMessageRender && rootScope.settings.animationsEnabled/*  && false */) {\r\n      let times = isAdditionRender ? 2 : 1;\r\n      this.messagesQueueOnRenderAdditional = () => {\r\n        this.log('messagesQueueOnRenderAdditional');\r\n\r\n        if(--times) return;\r\n\r\n        this.messagesQueueOnRenderAdditional = undefined;\r\n\r\n        const promise = this.animateAsLadder(additionMsgId, additionMsgIds, isAdditionRender, backLimit, maxId);\r\n        promise.then(() => {\r\n          setTimeout(() => { // preload messages\r\n            this.loadMoreHistory(reverse, true);\r\n          }, 0);\r\n        });\r\n      };\r\n    } else {\r\n      this.messagesQueueOnRenderAdditional = undefined;\r\n    }\r\n\r\n    if(justLoad) {\r\n      return null;\r\n    }\r\n\r\n    return {cached, promise, waitPromise};\r\n  }\r\n\r\n  public async setUnreadDelimiter() {\r\n    if(!(this.chat.type === 'chat' || this.chat.type === 'discussion')) {\r\n      return;\r\n    }\r\n\r\n    if(this.attachedUnreadBubble) {\r\n      return;\r\n    }\r\n\r\n    const historyMaxId = await this.chat.getHistoryMaxId();\r\n    let readMaxId = await this.managers.appMessagesManager.getReadMaxIdIfUnread(this.peerId, this.chat.threadId);\r\n    if(!readMaxId) return;\r\n\r\n    readMaxId = Object.keys(this.bubbles)\r\n    .filter((mid) => !this.bubbles[mid].classList.contains('is-out'))\r\n    .map((i) => +i)\r\n    .sort((a, b) => a - b)\r\n    .find((i) => i > readMaxId);\r\n\r\n    if(readMaxId && this.bubbles[readMaxId]) {\r\n      const bubble = this.bubbles[readMaxId];\r\n      if(this.firstUnreadBubble && this.firstUnreadBubble !== bubble) {\r\n        this.firstUnreadBubble.classList.remove('is-first-unread');\r\n        this.firstUnreadBubble = null;\r\n      }\r\n\r\n      if(readMaxId !== historyMaxId) {\r\n        bubble.classList.add('is-first-unread');\r\n      }\r\n\r\n      this.firstUnreadBubble = bubble;\r\n      this.attachedUnreadBubble = true;\r\n    }\r\n  }\r\n\r\n  public deleteEmptyDateGroups() {\r\n    const mustBeCount = this.stickyIntersector ? STICKY_OFFSET : 1;\r\n    let deleted = false;\r\n    for(const i in this.dateMessages) {\r\n      const dateMessage = this.dateMessages[i];\r\n\r\n      if(dateMessage.container.childElementCount === mustBeCount) { // only date div + sentinel div\r\n        dateMessage.container.remove();\r\n        if(this.stickyIntersector) {\r\n          this.stickyIntersector.unobserve(dateMessage.container, dateMessage.div);\r\n        }\r\n        delete this.dateMessages[i];\r\n        deleted = true;\r\n\r\n        // * no sense in it\r\n        /* if(dateMessage.div === this.previousStickyDate) {\r\n          this.previousStickyDate = undefined;\r\n        } */\r\n      }\r\n    }\r\n\r\n    if(!deleted) {\r\n      return;\r\n    }\r\n\r\n    if(!Object.keys(this.dateMessages).length) {\r\n      this.container.classList.remove('has-groups');\r\n    }\r\n\r\n    this.checkIfEmptyPlaceholderNeeded();\r\n    this.setStickyDateManually();\r\n  }\r\n}\r\n\r\nexport function generateTail() {\r\n  const svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');\r\n  svg.setAttributeNS(null, 'viewBox', '0 0 11 20');\r\n  svg.setAttributeNS(null, 'width', '11');\r\n  svg.setAttributeNS(null, 'height', '20');\r\n  svg.classList.add('bubble-tail');\r\n\r\n  const use = document.createElementNS('http://www.w3.org/2000/svg', 'use');\r\n  use.setAttributeNS(null, 'href', '#message-tail-filled');\r\n\r\n  svg.append(use);\r\n\r\n  return svg;\r\n}\r\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport {copyTextToClipboard} from '../clipboard';\n// import SelectionSaver from \"../selectionSaver\";\n// import selectElementContents from \"./selectElementContents\";\n\nexport default function copyFromElement(element: HTMLElement) {\n  copyTextToClipboard(element.textContent);\n  // const saver = new SelectionSaver();\n  // saver.save();\n  // selectElementContents(element);\n  // document.execCommand('copy');\n  // saver.restore();\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport getVisibleRect from './getVisibleRect';\n\nexport type ViewportSlicePart = {element: HTMLElement, rect: DOMRect, visibleRect: ReturnType<typeof getVisibleRect>}[];\n\nexport default function getViewportSlice({overflowElement, selector, extraSize}: {\n  overflowElement: HTMLElement,\n  selector: string,\n  extraSize?: number\n}) {\n  // const perf = performance.now();\n  const overflowRect = overflowElement.getBoundingClientRect();\n  const elements = Array.from(overflowElement.querySelectorAll<HTMLElement>(selector));\n\n  const invisibleTop: ViewportSlicePart = [],\n    visible: typeof invisibleTop = [],\n    invisibleBottom: typeof invisibleTop = [];\n  let foundVisible = false;\n  for(const element of elements) {\n    const rect = element.getBoundingClientRect();\n    const visibleRect = getVisibleRect(element, overflowElement, false, rect, overflowRect);\n\n    const isVisible = !!visibleRect;\n    let array: typeof invisibleTop;\n    if(isVisible) {\n      foundVisible = true;\n      array = visible;\n    } else if(foundVisible) {\n      array = invisibleBottom;\n    } else {\n      array = invisibleTop;\n    }\n\n    array.push({\n      element,\n      rect,\n      visibleRect\n    });\n  }\n\n  if(extraSize && visible.length) {\n    const maxTop = visible[0].rect.top;\n    const minTop = maxTop - extraSize;\n    const minBottom = visible[visible.length - 1].rect.bottom;\n    const maxBottom = minBottom + extraSize;\n\n    for(let length = invisibleTop.length, i = length - 1; i >= 0; --i) {\n      const element = invisibleTop[i];\n      if(element.rect.top >= minTop) {\n        invisibleTop.splice(i, 1);\n        visible.unshift(element);\n      }\n    }\n\n    for(let i = 0, length = invisibleBottom.length; i < length; ++i) {\n      const element = invisibleBottom[i];\n      if(element.rect.bottom <= maxBottom) {\n        invisibleBottom.splice(i--, 1);\n        --length;\n        visible.push(element);\n      }\n    }\n  }\n\n  // console.log('getViewportSlice time:', performance.now() - perf);\n\n  return {invisibleTop, visible, invisibleBottom};\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport PopupElement, {addCancelButton} from '.';\nimport PopupPeer, {PopupPeerButtonCallbackCheckboxes, PopupPeerOptions} from './peer';\nimport rootScope from '../../lib/rootScope';\nimport {FormatterArguments, LangPackKey} from '../../lib/langPack';\nimport PeerTitle from '../peerTitle';\n\nexport default class PopupPinMessage {\n  constructor(private peerId: PeerId, private mid: number, private unpin?: true, private onConfirm?: () => void) {\n    this.construct();\n  }\n\n  private async construct() {\n    const {peerId, mid, unpin, onConfirm} = this;\n    let title: LangPackKey, description: LangPackKey, descriptionArgs: FormatterArguments;\n    const buttons: PopupPeerOptions['buttons'] = [], checkboxes: PopupPeerOptions['checkboxes'] = [];\n\n    const managers = PopupElement.MANAGERS;\n\n    const canUnpin = await managers.appPeersManager.canPinMessage(peerId);\n\n    const callback = (checked: PopupPeerButtonCallbackCheckboxes, oneSide?: boolean, silent?: boolean) => {\n      setTimeout(() => { // * ,   document.elementFromPoint  popup-peer    \n        let promise: Promise<any>;\n        if(unpin && !mid) {\n          if(canUnpin) {\n            promise = managers.appMessagesManager.unpinAllMessages(peerId);\n          } else {\n            promise = managers.appMessagesManager.hidePinnedMessages(peerId);\n          }\n        } else {\n          promise = managers.appMessagesManager.updatePinnedMessage(peerId, mid, unpin, silent, oneSide);\n        }\n\n        if(onConfirm) {\n          promise.then(onConfirm);\n        }\n      }, 300);\n    };\n\n    if(unpin) {\n      let buttonText: LangPackKey = 'UnpinMessage';\n      if(!mid) {\n        if(canUnpin) {\n          title = 'Popup.Unpin.AllTitle';\n          description = 'Chat.UnpinAllMessagesConfirmation';\n          descriptionArgs = ['' + ((await managers.appMessagesManager.getPinnedMessagesCount(peerId)) || 1)];\n        } else {\n          title = 'Popup.Unpin.HideTitle';\n          description = 'Popup.Unpin.HideDescription';\n          buttonText = 'Popup.Unpin.Hide';\n        }\n      } else {\n        title = 'UnpinMessageAlertTitle';\n        description = 'Chat.Confirm.Unpin';\n      }\n\n      buttons.push({\n        langKey: buttonText,\n        isDanger: true,\n        callback\n      });\n    } else {\n      title = 'PinMessageAlertTitle';\n      const pinButtonText: LangPackKey = 'PinMessage';\n\n      if(peerId.isAnyChat()) {\n        buttons.push({\n          langKey: pinButtonText,\n          callback: (checked) => callback(checked, false, !checked.size)\n        });\n\n        if(await managers.appChatsManager.isBroadcast(peerId.toChatId())) {\n          description = 'PinMessageAlertChannel';\n        } else {\n          description = 'PinMessageAlert';\n\n          checkboxes.push({\n            text: 'PinNotify',\n            checked: true\n          });\n        }\n      } else {\n        description = 'PinMessageAlertChat';\n\n        if(peerId === rootScope.myId) {\n          buttons.push({\n            langKey: pinButtonText,\n            callback\n          });\n        } else {\n          buttons.push({\n            langKey: pinButtonText,\n            callback: (checked) => callback(checked, !checked.size)\n          });\n\n          checkboxes.push({\n            text: 'PinAlsoFor',\n            textArgs: [new PeerTitle({peerId}).element],\n            checked: true\n          });\n        }\n      }\n    }\n\n    addCancelButton(buttons);\n\n    const popup = new PopupPeer('popup-delete-chat', {\n      peerId,\n      titleLangKey: title,\n      descriptionLangKey: description,\n      descriptionLangArgs: descriptionArgs,\n      buttons,\n      checkboxes\n    });\n\n    popup.show();\n  }\n}\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nexport default function isSelectionEmpty(selection = window.getSelection()) {\r\n  if(!selection || !selection.rangeCount) {\r\n    return true;\r\n  }\r\n\r\n  const selectionRange = selection.getRangeAt(0);\r\n  if(!selectionRange.toString() || !selectionRange.START_TO_END) {\r\n    return true;\r\n  }\r\n\r\n  return false;\r\n}\r\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport appDownloadManager from '../lib/appManagers/appDownloadManager';\nimport lottieLoader from '../lib/rlottie/lottieLoader';\nimport rootScope from '../lib/rootScope';\nimport {getEmojiToneIndex} from '../vendor/emoji';\nimport mediaSizes from './mediaSizes';\nimport {saveLottiePreview} from './saveLottiePreview';\n\nexport default function preloadAnimatedEmojiSticker(emoji: string, width?: number, height?: number) {\n  return rootScope.managers.appStickersManager.preloadAnimatedEmojiSticker(emoji).then(({doc}) => {\n    if(!doc) {\n      return;\n    }\n\n    return appDownloadManager.downloadMedia({media: doc})\n    .then(async(blob) => {\n      const mediaSize = mediaSizes.active.emojiSticker;\n      const toneIndex = getEmojiToneIndex(emoji);\n      const animation = await lottieLoader.loadAnimationWorker({\n        container: undefined,\n        animationData: blob,\n        width: width ?? mediaSize.width,\n        height: height ?? mediaSize.height,\n        name: 'doc' + doc.id,\n        autoplay: false,\n        loop: false,\n        toneIndex\n      }, 'none');\n\n      animation.addEventListener('firstFrame', () => {\n        saveLottiePreview(doc, animation.canvas[0], toneIndex);\n        animation.remove();\n      }, {once: true});\n    });\n  });\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport {ReportReason} from '../../layer';\nimport InputField from '../inputField';\nimport {toastNew} from '../toast';\nimport wrapStickerEmoji from '../wrappers/stickerEmoji';\nimport PopupPeer from './peer';\n\nexport default class PopupReportMessagesConfirm extends PopupPeer {\n  public static STICKER_EMOJI = '';\n  constructor(peerId: PeerId, mids: number[], reason: ReportReason['_'], onConfirm?: () => void) {\n    super('popup-report-messages-confirm', {\n      noTitle: true,\n      descriptionLangKey: 'ReportInfo',\n      buttons: [{\n        langKey: 'ReportChat',\n        callback: () => {\n          if(!inputField.isValid()) {\n            return;\n          }\n\n          onConfirm && onConfirm();\n          this.managers.appMessagesManager.reportMessages(peerId, mids, reason, inputField.value).then((bool) => {\n            if(!bool) return;\n\n            toastNew({\n              langPackKey: 'ReportSentInfo'\n            });\n          });\n        }\n      }],\n      body: true\n    });\n\n    const div = document.createElement('div');\n    const size = 100;\n    wrapStickerEmoji({\n      div,\n      emoji: PopupReportMessagesConfirm.STICKER_EMOJI,\n      width: size,\n      height: size\n    }).then(({render}) => render).finally(() => {\n      this.show();\n    });\n\n    this.header.append(div);\n\n    const inputField = new InputField({\n      label: 'ReportHint',\n      maxLength: 512,\n      placeholder: 'ReportChatDescription'\n    });\n\n    inputField.input.addEventListener('input', () => {\n      this.buttons[0].element.toggleAttribute('disabled', !inputField.isValid());\n    });\n\n    this.body.append(inputField.container);\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport {attachClickEvent} from '../../helpers/dom/clickEvent';\nimport findUpClassName from '../../helpers/dom/findUpClassName';\nimport whichChild from '../../helpers/dom/whichChild';\nimport preloadAnimatedEmojiSticker from '../../helpers/preloadAnimatedEmojiSticker';\nimport {ReportReason} from '../../layer';\nimport {LangPackKey} from '../../lib/langPack';\nimport Button from '../button';\nimport PopupPeer from './peer';\nimport PopupReportMessagesConfirm from './reportMessagesConfirm';\n\nexport default class PopupReportMessages extends PopupPeer {\n  constructor(peerId: PeerId, mids: number[], onConfirm?: () => void) {\n    super('popup-report-messages', {titleLangKey: 'ChatTitle.ReportMessages', buttons: [], body: true});\n\n    mids = mids.slice();\n\n    const buttons: [LangPackKey, ReportReason['_']][] = [\n      ['ReportChatSpam', 'inputReportReasonSpam'],\n      ['ReportChatViolence', 'inputReportReasonViolence'],\n      ['ReportChatChild', 'inputReportReasonChildAbuse'],\n      ['ReportChatPornography', 'inputReportReasonPornography'],\n      ['ReportChatOther', 'inputReportReasonOther'],\n      ['ReportChatPersonalDetails', 'inputReportReasonPersonalDetails'],\n      ['ReportChatIllegalDrugs', 'inputReportReasonIllegalDrugs']\n    ];\n\n    const className = 'btn-primary btn-transparent';\n    buttons.forEach((b) => {\n      const button = Button(className, {/* icon: 'edit',  */text: b[0]});\n      this.body.append(button);\n    });\n\n    const preloadStickerPromise = preloadAnimatedEmojiSticker(PopupReportMessagesConfirm.STICKER_EMOJI);\n\n    attachClickEvent(this.body, (e) => {\n      const target = findUpClassName(e.target, 'btn-primary');\n      const reason = buttons[whichChild(target)][1];\n\n      preloadStickerPromise.then(() => {\n        this.hide();\n\n        new PopupReportMessagesConfirm(peerId, mids, reason, onConfirm);\n      });\n    }, {listenerSetter: this.listenerSetter});\n\n    this.body.style.margin = '0 -1rem';\n    this.buttonsEl.style.marginTop = '.5rem';\n\n    this.show();\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport I18n, {i18n} from '../../lib/langPack';\nimport PopupPeer from './peer';\n\nexport default class PopupSponsored extends PopupPeer {\n  constructor() {\n    super('popup-sponsored', {\n      titleLangKey: 'Chat.Message.Sponsored.What',\n      descriptionLangKey: 'Chat.Message.Ad.Text',\n      descriptionLangArgs: [i18n('Chat.Message.Sponsored.Link')],\n      buttons: [{\n        langKey: 'OK',\n        isCancel: true\n      }, {\n        langKey: 'Chat.Message.Ad.ReadMore',\n        callback: () => {\n          window.open(I18n.format('Chat.Message.Sponsored.Link', true));\n        },\n        isCancel: true\n      }],\n      scrollable: true\n    });\n\n    this.scrollable.append(this.description);\n\n    this.show();\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport PopupElement from '.';\nimport {Message} from '../../layer';\nimport {SettingSection} from '../sidebarLeft';\nimport ReactionsElement from '../chat/reactions';\nimport {horizontalMenu} from '../horizontalMenu';\nimport Scrollable from '../scrollable';\nimport ScrollableLoader from '../../helpers/scrollableLoader';\nimport appDialogsManager from '../../lib/appManagers/appDialogsManager';\nimport replaceContent from '../../helpers/dom/replaceContent';\nimport {wrapSticker} from '../wrappers';\nimport ReactionElement from '../chat/reaction';\nimport getUserStatusString from '../wrappers/getUserStatusString';\n\nexport default class PopupReactedList extends PopupElement {\n  constructor(\n    private message: Message.message\n  ) {\n    super('popup-reacted-list', {closable: true, overlayClosable: true, body: true});\n\n    this.init();\n  }\n\n  private async init() {\n    const message = await this.managers.appMessagesManager.getGroupsFirstMessage(this.message);\n\n    const canViewReadParticipants = await this.managers.appMessagesManager.canViewMessageReadParticipants(message);\n\n    // this.body.append(generateDelimiter());\n\n    const reactionsElement = new ReactionsElement();\n    const newMessage: Message.message = {\n      ...message,\n      mid: 0,\n      id: 0,\n      reactions: {\n        _: 'messageReactions',\n        results: [],\n\n        ...message.reactions,\n\n        pFlags: {},\n        recent_reactions: []\n      }\n    };\n\n    newMessage.reactions.results = newMessage.reactions.results.map((reactionCount) => {\n      return {\n        ...reactionCount,\n        pFlags: {}\n      };\n    });\n\n    reactionsElement.init(newMessage, 'block');\n    reactionsElement.render();\n    reactionsElement.classList.add('no-stripe');\n    reactionsElement.classList.remove('has-no-reactions');\n\n    reactionsElement.append(this.btnClose);\n\n    this.header.append(reactionsElement);\n\n    const tabsContainer = document.createElement('div');\n    tabsContainer.classList.add('tabs-container');\n    tabsContainer.dataset.animation = 'tabs';\n\n    const loaders: Map<HTMLElement, ScrollableLoader> = new Map();\n\n    let hasAllReactions = false;\n    if(newMessage.reactions.results.length) {\n      const reaction = this.createFakeReaction('reactions', newMessage.reactions.results.reduce((acc, r) => acc + r.count, 0));\n\n      reactionsElement.prepend(reaction);\n      newMessage.reactions.results.unshift(reaction.reactionCount);\n      hasAllReactions = true;\n    }\n\n    let hasReadParticipants = false;\n    if(canViewReadParticipants) {\n      try {\n        const readUserIds = await this.managers.appMessagesManager.getMessageReadParticipants(message.peerId, message.mid);\n        if(!readUserIds.length) {\n          throw '';\n        }\n\n        const reaction = this.createFakeReaction('checks', readUserIds.length);\n\n        reactionsElement.prepend(reaction);\n        newMessage.reactions.results.unshift(reaction.reactionCount);\n        hasReadParticipants = true;\n      } catch(err) {\n\n      }\n    }\n\n    newMessage.reactions.results.forEach((reactionCount) => {\n      const scrollable = new Scrollable(undefined);\n      scrollable.container.classList.add('tabs-tab');\n\n      const section = new SettingSection({\n        noShadow: true,\n        noDelimiter: true\n      });\n\n      const chatlist = appDialogsManager.createChatList({\n        dialogSize: 72\n      });\n\n      appDialogsManager.setListClickListener(chatlist, () => {\n        this.hide();\n      }, undefined, false, true);\n\n      section.content.append(chatlist);\n      scrollable.container.append(section.container);\n\n      const skipReadParticipants = reactionCount.reaction !== 'checks';\n      const skipReactionsList = reactionCount.reaction === 'checks';\n      if(['checks', 'reactions'].includes(reactionCount.reaction)) {\n        reactionCount.reaction = undefined;\n      }\n\n      let nextOffset: string;\n      const loader = new ScrollableLoader({\n        scrollable,\n        getPromise: async() => {\n          const result = await this.managers.appMessagesManager.getMessageReactionsListAndReadParticipants(message, undefined, reactionCount.reaction, nextOffset, skipReadParticipants, skipReactionsList);\n          nextOffset = result.nextOffset;\n\n          await Promise.all(result.combined.map(async({peerId, reaction}) => {\n            const {dom} = appDialogsManager.addDialogNew({\n              peerId: peerId,\n              autonomous: true,\n              container: chatlist,\n              avatarSize: 54,\n              rippleEnabled: false,\n              meAsSaved: false\n            });\n\n            if(reaction) {\n              const stickerContainer = document.createElement('div');\n              stickerContainer.classList.add('reacted-list-reaction-icon');\n              const availableReaction = await this.managers.appReactionsManager.getReactionCached(reaction);\n\n              wrapSticker({\n                doc: availableReaction.static_icon,\n                div: stickerContainer,\n                width: 24,\n                height: 24\n              });\n\n              dom.listEl.append(stickerContainer);\n            }\n\n            replaceContent(dom.lastMessageSpan, getUserStatusString(await this.managers.appUsersManager.getUser(peerId.toUserId())));\n          }));\n\n          return !nextOffset;\n        }\n      });\n\n      loaders.set(scrollable.container, loader);\n\n      tabsContainer.append(scrollable.container);\n    });\n\n    this.body.append(tabsContainer);\n\n    const selectTab = horizontalMenu(reactionsElement, tabsContainer, (id, tabContent) => {\n      if(id === (reactionsElement.childElementCount - 1)) {\n        return false;\n      }\n\n      const reaction = reactionsElement.children[id] as ReactionElement;\n      const prevId = selectTab.prevId();\n      if(prevId !== -1) {\n        (reactionsElement.children[prevId] as ReactionElement).setIsChosen(false);\n      }\n\n      reaction.setIsChosen(true);\n\n      const loader = loaders.get(tabContent);\n      loader.load();\n    }, undefined, undefined, undefined, this.listenerSetter);\n\n    // selectTab(hasAllReactions && hasReadParticipants ? 1 : 0, false);\n    selectTab(0, false);\n\n    this.show();\n  }\n\n  private createFakeReaction(icon: string, count: number) {\n    const reaction = new ReactionElement();\n    reaction.init('block');\n    reaction.reactionCount = {\n      _: 'reactionCount',\n      count: count,\n      reaction: icon\n    };\n    reaction.setCanRenderAvatars(false);\n    reaction.renderCounter();\n\n    const allReactionsSticker = document.createElement('div');\n    allReactionsSticker.classList.add('reaction-counter', 'reaction-sticker-icon', 'tgico-' + icon);\n    reaction.prepend(allReactionsSticker);\n\n    return reaction;\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport IS_TOUCH_SUPPORTED from '../../environment/touchSupport';\nimport {IS_MOBILE, IS_SAFARI} from '../../environment/userAgent';\nimport assumeType from '../../helpers/assumeType';\nimport callbackify from '../../helpers/callbackify';\nimport {attachClickEvent} from '../../helpers/dom/clickEvent';\nimport findUpClassName from '../../helpers/dom/findUpClassName';\nimport getVisibleRect from '../../helpers/dom/getVisibleRect';\nimport {getMiddleware} from '../../helpers/middleware';\nimport noop from '../../helpers/noop';\nimport {fastRaf} from '../../helpers/schedulers';\nimport {Message, AvailableReaction} from '../../layer';\nimport {AppManagers} from '../../lib/appManagers/managers';\nimport lottieLoader from '../../lib/rlottie/lottieLoader';\nimport RLottiePlayer from '../../lib/rlottie/rlottiePlayer';\nimport rootScope from '../../lib/rootScope';\nimport animationIntersector, {AnimationItemGroup} from '../animationIntersector';\nimport Scrollable, {ScrollableBase, ScrollableX} from '../scrollable';\nimport {wrapSticker} from '../wrappers';\n\nconst REACTIONS_CLASS_NAME = 'btn-menu-reactions';\nconst REACTION_CLASS_NAME = REACTIONS_CLASS_NAME + '-reaction';\n\nconst REACTION_SIZE = 26;\nconst PADDING = 4;\nexport const REACTION_CONTAINER_SIZE = REACTION_SIZE + PADDING * 2;\n\nconst CAN_USE_TRANSFORM = !IS_SAFARI;\n\ntype ChatReactionsMenuPlayers = {\n  select?: RLottiePlayer,\n  appear?: RLottiePlayer,\n  selectWrapper: HTMLElement,\n  appearWrapper: HTMLElement,\n  reaction: string\n};\nexport class ChatReactionsMenu {\n  public widthContainer: HTMLElement;\n  public container: HTMLElement;\n  private reactionsMap: Map<HTMLElement, ChatReactionsMenuPlayers>;\n  public scrollable: ScrollableBase;\n  private animationGroup: AnimationItemGroup;\n  private middleware: ReturnType<typeof getMiddleware>;\n  private message: Message.message;\n\n  constructor(\n    private managers: AppManagers,\n    private type: 'horizontal' | 'vertical',\n    middleware: ChatReactionsMenu['middleware']\n  ) {\n    const widthContainer = this.widthContainer = document.createElement('div');\n    widthContainer.classList.add(REACTIONS_CLASS_NAME + '-container');\n    widthContainer.classList.add(REACTIONS_CLASS_NAME + '-container-' + type);\n\n    const reactionsContainer = this.container = document.createElement('div');\n    reactionsContainer.classList.add(REACTIONS_CLASS_NAME);\n\n    const reactionsScrollable = this.scrollable = type === 'vertical' ? new Scrollable(undefined) : new ScrollableX(undefined);\n    reactionsContainer.append(reactionsScrollable.container);\n    reactionsScrollable.onAdditionalScroll = this.onScroll;\n    reactionsScrollable.setListeners();\n\n    reactionsScrollable.container.classList.add('no-scrollbar');\n\n    // ['big'].forEach((type) => {\n    //   const bubble = document.createElement('div');\n    //   bubble.classList.add(REACTIONS_CLASS_NAME + '-bubble', REACTIONS_CLASS_NAME + '-bubble-' + type);\n    //   reactionsContainer.append(bubble);\n    // });\n\n    this.reactionsMap = new Map();\n    this.animationGroup = `CHAT-MENU-REACTIONS-${Date.now()}`;\n    animationIntersector.setOverrideIdleGroup(this.animationGroup, true);\n\n    if(!IS_TOUCH_SUPPORTED) {\n      reactionsContainer.addEventListener('mousemove', this.onMouseMove);\n    }\n\n    attachClickEvent(reactionsContainer, (e) => {\n      const reactionDiv = findUpClassName(e.target, REACTION_CLASS_NAME);\n      if(!reactionDiv) return;\n\n      const players = this.reactionsMap.get(reactionDiv);\n      if(!players) return;\n\n      this.managers.appReactionsManager.sendReaction(this.message, players.reaction);\n    });\n\n    widthContainer.append(reactionsContainer);\n\n    this.middleware = middleware ?? getMiddleware();\n  }\n\n  public init(message: Message.message) {\n    this.message = message;\n\n    const middleware = this.middleware.get();\n    // const result = Promise.resolve(this.appReactionsManager.getAvailableReactionsForPeer(message.peerId)).then((res) => pause(1000).then(() => res));\n    const result = this.managers.appReactionsManager.getAvailableReactionsByMessage(message);\n    callbackify(result, (reactions) => {\n      if(!middleware() || !reactions.length) return;\n      reactions.forEach((reaction) => {\n        if(reaction.pFlags.premium && !rootScope.premium) return;\n        this.renderReaction(reaction);\n      });\n\n      const setVisible = () => {\n        this.container.classList.add('is-visible');\n      };\n\n      if(result instanceof Promise) {\n        fastRaf(setVisible);\n      } else {\n        setVisible();\n      }\n    });\n  }\n\n  public cleanup() {\n    this.middleware.clean();\n    this.scrollable.removeListeners();\n    this.reactionsMap.clear();\n    animationIntersector.setOverrideIdleGroup(this.animationGroup, false);\n    animationIntersector.checkAnimations(true, this.animationGroup, true);\n  }\n\n  private onScroll = () => {\n    this.reactionsMap.forEach((players, div) => {\n      this.onScrollProcessItem(div, players);\n    });\n  };\n\n  private canUseAnimations() {\n    return rootScope.settings.animationsEnabled && !IS_MOBILE;\n  }\n\n  private renderReaction(reaction: AvailableReaction) {\n    const reactionDiv = document.createElement('div');\n    reactionDiv.classList.add(REACTION_CLASS_NAME);\n\n    const scaleContainer = document.createElement('div');\n    scaleContainer.classList.add(REACTION_CLASS_NAME + '-scale');\n\n    const appearWrapper = document.createElement('div');\n    let selectWrapper: HTMLElement;;\n    appearWrapper.classList.add(REACTION_CLASS_NAME + '-appear');\n\n    if(this.canUseAnimations()) {\n      selectWrapper = document.createElement('div');\n      selectWrapper.classList.add(REACTION_CLASS_NAME + '-select', 'hide');\n    }\n\n    const players: ChatReactionsMenuPlayers = {\n      selectWrapper,\n      appearWrapper,\n      reaction: reaction.reaction\n    };\n    this.reactionsMap.set(reactionDiv, players);\n\n    const middleware = this.middleware.get();\n\n    const hoverScale = IS_TOUCH_SUPPORTED ? 1 : 1.25;\n    const size = REACTION_SIZE * hoverScale;\n\n    const options = {\n      width: size,\n      height: size,\n      skipRatio: 1,\n      needFadeIn: false,\n      withThumb: false,\n      group: this.animationGroup,\n      middleware\n    };\n\n    if(!this.canUseAnimations()) {\n      delete options.needFadeIn;\n      delete options.withThumb;\n\n      wrapSticker({\n        doc: reaction.static_icon,\n        div: appearWrapper,\n        ...options\n      });\n    } else {\n      let isFirst = true;\n      wrapSticker({\n        doc: reaction.appear_animation,\n        div: appearWrapper,\n        play: true,\n        ...options\n      }).then(({render}) => render).then((player) => {\n        assumeType<RLottiePlayer>(player);\n\n        players.appear = player;\n\n        player.addEventListener('enterFrame', (frameNo) => {\n          if(player.maxFrame === frameNo) {\n            selectLoadPromise.then((selectPlayer) => {\n              assumeType<RLottiePlayer>(selectPlayer);\n              appearWrapper.classList.add('hide');\n              selectWrapper.classList.remove('hide');\n\n              if(isFirst) {\n                players.select = selectPlayer;\n                isFirst = false;\n              }\n            }, noop);\n          }\n        });\n      }, noop);\n\n      const selectLoadPromise = wrapSticker({\n        doc: reaction.select_animation,\n        div: selectWrapper,\n        ...options\n      }).then(({render}) => render).then((player) => {\n        assumeType<RLottiePlayer>(player);\n\n        return lottieLoader.waitForFirstFrame(player);\n      }).catch(noop);\n    }\n\n    scaleContainer.append(appearWrapper);\n    selectWrapper && scaleContainer.append(selectWrapper);\n    reactionDiv.append(scaleContainer);\n    this.scrollable.append(reactionDiv);\n  }\n\n  private onScrollProcessItem(div: HTMLElement, players: ChatReactionsMenuPlayers) {\n    // return;\n\n    const scaleContainer = div.firstElementChild as HTMLElement;\n    const visibleRect = getVisibleRect(div, this.scrollable.container);\n    let transform: string;\n    if(!visibleRect) {\n      if(!players.appearWrapper.classList.contains('hide') || !players.appear) {\n        return;\n      }\n\n      if(players.select) {\n        players.select.stop();\n      }\n\n      players.appear.stop();\n      players.appear.autoplay = true;\n      players.appearWrapper.classList.remove('hide');\n      players.selectWrapper.classList.add('hide');\n\n      transform = '';\n    } else if(visibleRect.overflow.left || visibleRect.overflow.right) {\n      const diff = Math.abs(visibleRect.rect.left - visibleRect.rect.right);\n      const scale = Math.min(diff ** 2 / REACTION_CONTAINER_SIZE ** 2, 1);\n\n      transform = 'scale(' + scale + ')';\n    } else {\n      transform = '';\n    }\n\n    if(CAN_USE_TRANSFORM) {\n      scaleContainer.style.transform = transform;\n    }\n  }\n\n  private onMouseMove = (e: MouseEvent) => {\n    const reactionDiv = findUpClassName(e.target, REACTION_CLASS_NAME);\n    if(!reactionDiv) {\n      return;\n    }\n\n    const players = this.reactionsMap.get(reactionDiv);\n    if(!players) {\n      return;\n    }\n\n    // do not play select animation when appearing\n    if(!players.appear?.paused) {\n      return;\n    }\n\n    const player = players.select;\n    if(!player) {\n      return;\n    }\n\n    if(player.paused) {\n      player.autoplay = true;\n      player.restart();\n    }\n  };\n}\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport type {MyDocument} from '../../lib/appManagers/appDocsManager';\r\nimport type Chat from './chat';\r\nimport IS_TOUCH_SUPPORTED from '../../environment/touchSupport';\r\nimport ButtonMenu, {ButtonMenuItemOptions} from '../buttonMenu';\r\nimport PopupDeleteMessages from '../popups/deleteMessages';\r\nimport PopupForward from '../popups/forward';\r\nimport PopupPinMessage from '../popups/unpinMessage';\r\nimport {copyTextToClipboard} from '../../helpers/clipboard';\r\nimport PopupSendNow from '../popups/sendNow';\r\nimport {toast} from '../toast';\r\nimport I18n, {i18n, LangPackKey} from '../../lib/langPack';\r\nimport findUpClassName from '../../helpers/dom/findUpClassName';\r\nimport cancelEvent from '../../helpers/dom/cancelEvent';\r\nimport {attachClickEvent, simulateClickEvent} from '../../helpers/dom/clickEvent';\r\nimport isSelectionEmpty from '../../helpers/dom/isSelectionEmpty';\r\nimport {Message, Poll, Chat as MTChat, MessageMedia, AvailableReaction} from '../../layer';\r\nimport PopupReportMessages from '../popups/reportMessages';\r\nimport assumeType from '../../helpers/assumeType';\r\nimport PopupSponsored from '../popups/sponsored';\r\nimport ListenerSetter from '../../helpers/listenerSetter';\r\nimport {getMiddleware} from '../../helpers/middleware';\r\nimport PeerTitle from '../peerTitle';\r\nimport StackedAvatars from '../stackedAvatars';\r\nimport {IS_APPLE} from '../../environment/userAgent';\r\nimport PopupReactedList from '../popups/reactedList';\r\nimport {ChatReactionsMenu, REACTION_CONTAINER_SIZE} from './reactionsMenu';\r\nimport getPeerId from '../../lib/appManagers/utils/peers/getPeerId';\r\nimport getServerMessageId from '../../lib/appManagers/utils/messageId/getServerMessageId';\r\nimport {AppManagers} from '../../lib/appManagers/managers';\r\nimport positionMenu, {MenuPositionPadding} from '../../helpers/positionMenu';\r\nimport contextMenuController from '../../helpers/contextMenuController';\r\nimport {attachContextMenuListener} from '../../helpers/dom/attachContextMenuListener';\r\nimport filterAsync from '../../helpers/array/filterAsync';\r\nimport appDownloadManager from '../../lib/appManagers/appDownloadManager';\r\nimport {SERVICE_PEER_ID} from '../../lib/mtproto/mtproto_config';\r\nimport {MessagesStorageKey} from '../../lib/appManagers/appMessagesManager';\r\n\r\nexport default class ChatContextMenu {\r\n  private buttons: (ButtonMenuItemOptions & {verify: () => boolean | Promise<boolean>, notDirect?: () => boolean, withSelection?: true, isSponsored?: true})[];\r\n  private element: HTMLElement;\r\n\r\n  private isSelectable: boolean;\r\n  private isSelected: boolean;\r\n  private target: HTMLElement;\r\n  private isTargetAGroupedItem: boolean;\r\n  private isTextSelected: boolean;\r\n  private isAnchorTarget: boolean;\r\n  private isUsernameTarget: boolean;\r\n  private isSponsored: boolean;\r\n  private isOverBubble: boolean;\r\n  private peerId: PeerId;\r\n  private mid: number;\r\n  private message: Message.message | Message.messageService;\r\n  private noForwards: boolean;\r\n\r\n  private reactionsMenu: ChatReactionsMenu;\r\n  private listenerSetter: ListenerSetter;\r\n  private attachListenerSetter: ListenerSetter;\r\n\r\n  private viewerPeerId: PeerId;\r\n  private middleware: ReturnType<typeof getMiddleware>;\r\n  private canOpenReactedList: boolean;\r\n\r\n  constructor(\r\n    private chat: Chat,\r\n    private managers: AppManagers\r\n  ) {\r\n    this.listenerSetter = new ListenerSetter();\r\n    this.attachListenerSetter = new ListenerSetter();\r\n    this.middleware = getMiddleware();\r\n  }\r\n\r\n  public attachTo(element: HTMLElement) {\r\n    this.attachListenerSetter.removeAll();\r\n\r\n    if(IS_TOUCH_SUPPORTED/*  && false */) {\r\n      attachClickEvent(element, (e) => {\r\n        if(this.chat.selection.isSelecting) {\r\n          return;\r\n        }\r\n\r\n        this.chat.log('touchend', e);\r\n\r\n        const badSelectors = [\r\n          '.name',\r\n          '.peer-title',\r\n          '.reply',\r\n          '.document',\r\n          'audio-element',\r\n          'avatar-element',\r\n          'a',\r\n          '.bubble-beside-button',\r\n          'replies-element',\r\n          '[data-saved-from]:not(.bubble)',\r\n          'poll-element',\r\n          '.attachment',\r\n          '.reply-markup-button'\r\n        ];\r\n        const good = !(e.target as HTMLElement).closest(badSelectors.join(', '));\r\n        if(good) {\r\n          cancelEvent(e);\r\n          // onContextMenu((e as TouchEvent).changedTouches[0]);\r\n          // onContextMenu((e as TouchEvent).changedTouches ? (e as TouchEvent).changedTouches[0] : e as MouseEvent);\r\n          this.onContextMenu(e);\r\n        }\r\n      }, {listenerSetter: this.attachListenerSetter});\r\n    } else attachContextMenuListener(element, this.onContextMenu, this.attachListenerSetter);\r\n  }\r\n\r\n  private onContextMenu = (e: MouseEvent | Touch | TouchEvent) => {\r\n    let bubble: HTMLElement, contentWrapper: HTMLElement;\r\n\r\n    try {\r\n      contentWrapper = findUpClassName(e.target, 'bubble-content-wrapper');\r\n      bubble = contentWrapper ? contentWrapper.parentElement : findUpClassName(e.target, 'bubble');\r\n    } catch(e) {}\r\n\r\n    // ! context menu click by date bubble (there is no pointer-events)\r\n    if(!bubble || bubble.classList.contains('bubble-first')) return;\r\n\r\n    let element = this.element;\r\n    if(e instanceof MouseEvent || e.hasOwnProperty('preventDefault')) (e as any).preventDefault();\r\n    if(element && element.classList.contains('active')) {\r\n      return false;\r\n    }\r\n    if(e instanceof MouseEvent || e.hasOwnProperty('cancelBubble')) (e as any).cancelBubble = true;\r\n\r\n    let mid = +bubble.dataset.mid;\r\n    if(!mid) return;\r\n\r\n    const r = async() => {\r\n      const isSponsored = this.isSponsored = mid < 0;\r\n      this.isSelectable = this.chat.selection.canSelectBubble(bubble);\r\n      this.peerId = this.chat.peerId;\r\n      // this.msgID = msgID;\r\n      this.target = e.target as HTMLElement;\r\n      this.isTextSelected = !isSelectionEmpty();\r\n      this.isAnchorTarget = this.target.tagName === 'A' && (\r\n        (this.target as HTMLAnchorElement).target === '_blank' ||\r\n        this.target.classList.contains('anchor-url')\r\n      );\r\n      this.isUsernameTarget = this.target.tagName === 'A' && this.target.classList.contains('mention');\r\n\r\n      // *         ,     ,    \r\n      if(this.chat.selection.isSelecting && !contentWrapper) {\r\n        if(isSponsored) {\r\n          return;\r\n        }\r\n\r\n        const mids = await this.chat.getMidsByMid(mid);\r\n        if(mids.length > 1) {\r\n          const selectedMid = this.chat.selection.isMidSelected(this.peerId, mid) ?\r\n            mid :\r\n            mids.find((mid) => this.chat.selection.isMidSelected(this.peerId, mid));\r\n          if(selectedMid) {\r\n            mid = selectedMid;\r\n          }\r\n        }\r\n      }\r\n\r\n      this.isOverBubble = !!contentWrapper;\r\n\r\n      const groupedItem = findUpClassName(this.target, 'grouped-item');\r\n      this.isTargetAGroupedItem = !!groupedItem;\r\n      if(groupedItem) {\r\n        this.mid = +groupedItem.dataset.mid;\r\n      } else {\r\n        this.mid = mid;\r\n      }\r\n\r\n      this.isSelected = this.chat.selection.isMidSelected(this.peerId, this.mid);\r\n      this.message = await this.chat.getMessage(this.mid);\r\n      this.noForwards = !isSponsored && !(await this.managers.appMessagesManager.canForward(this.message));\r\n      this.viewerPeerId = undefined;\r\n      this.canOpenReactedList = undefined;\r\n\r\n      const initResult = await this.init();\r\n      if(!initResult) {\r\n        return;\r\n      }\r\n\r\n      element = initResult.element;\r\n      const {cleanup, destroy, menuPadding, reactionsMenu, reactionsMenuPosition} = initResult;\r\n      let isReactionsMenuVisible = false;\r\n      if(reactionsMenu) {\r\n        const className = 'is-visible';\r\n        isReactionsMenuVisible = reactionsMenu.container.classList.contains(className);\r\n        if(isReactionsMenuVisible) reactionsMenu.container.classList.remove(className);\r\n\r\n        if(reactionsMenuPosition === 'horizontal') {\r\n          const offsetSize = element[/* reactionsMenuPosition === 'vertical' ? 'offsetHeight' :  */'offsetWidth'];\r\n          // if(reactionsMenu.scrollable.container.scrollWidth > offsetWidth) {\r\n          const INNER_CONTAINER_PADDING = 8;\r\n          const visibleLength = (offsetSize - INNER_CONTAINER_PADDING) / REACTION_CONTAINER_SIZE;\r\n          const nextVisiblePart = visibleLength % 1;\r\n          const MIN_NEXT_VISIBLE_PART = 0.65;\r\n          if(nextVisiblePart < MIN_NEXT_VISIBLE_PART) {\r\n            const minSize = (offsetSize + (MIN_NEXT_VISIBLE_PART - nextVisiblePart) * REACTION_CONTAINER_SIZE) | 0;\r\n            element.style[/* reactionsMenuPosition === 'vertical' ? 'minHeight' :  */'minWidth'] = minSize + 'px';\r\n          }\r\n          // }\r\n        }\r\n      }\r\n\r\n      const side: 'left' | 'right' = bubble.classList.contains('is-in') ? 'left' : 'right';\r\n      // bubble.parentElement.append(element);\r\n      // appImManager.log('contextmenu', e, bubble, side);\r\n      positionMenu((e as TouchEvent).touches ? (e as TouchEvent).touches[0] : e as MouseEvent, element, side, menuPadding);\r\n\r\n      if(reactionsMenu) {\r\n        reactionsMenu.widthContainer.style.top = element.style.top;\r\n        reactionsMenu.widthContainer.style.left = element.style.left;\r\n        reactionsMenu.widthContainer.style.setProperty('--menu-width', element[reactionsMenuPosition === 'vertical' ? 'offsetHeight' : 'offsetWidth'] + 'px');\r\n        element.parentElement.append(reactionsMenu.widthContainer);\r\n        if(isReactionsMenuVisible) void reactionsMenu.container.offsetLeft; // reflow\r\n      }\r\n\r\n      contextMenuController.openBtnMenu(element, () => {\r\n        if(reactionsMenu) {\r\n          reactionsMenu.container.classList.remove('is-visible');\r\n        }\r\n\r\n        this.mid = 0;\r\n        this.peerId = undefined;\r\n        this.target = null;\r\n        this.viewerPeerId = undefined;\r\n        this.canOpenReactedList = undefined;\r\n        cleanup();\r\n\r\n        setTimeout(() => {\r\n          destroy();\r\n        }, 300);\r\n      });\r\n\r\n      if(isReactionsMenuVisible) {\r\n        reactionsMenu.container.classList.add('is-visible');\r\n      }\r\n    };\r\n\r\n    r();\r\n  };\r\n\r\n  public cleanup() {\r\n    this.listenerSetter.removeAll();\r\n    this.reactionsMenu && this.reactionsMenu.cleanup();\r\n    this.middleware.clean();\r\n  }\r\n\r\n  public destroy() {\r\n    this.cleanup();\r\n    this.attachListenerSetter.removeAll();\r\n  }\r\n\r\n  private async filterButtons(buttons: ChatContextMenu['buttons']) {\r\n    if(this.isSponsored) {\r\n      return buttons.filter((button) => {\r\n        return button.isSponsored;\r\n      });\r\n    } else {\r\n      return filterAsync(buttons, async(button) => {\r\n        let good: boolean;\r\n\r\n        // if((appImManager.chatSelection.isSelecting && !button.withSelection) || (button.withSelection && !appImManager.chatSelection.isSelecting)) {\r\n        if(this.chat.selection.isSelecting && !button.withSelection) {\r\n          good = false;\r\n        } else {\r\n          good = this.isOverBubble || IS_TOUCH_SUPPORTED || true ?\r\n            await button.verify() :\r\n            button.notDirect && await button.verify() && button.notDirect();\r\n        }\r\n\r\n        return !!good;\r\n      });\r\n    }\r\n  }\r\n\r\n  private setButtons() {\r\n    const verifyFavoriteSticker = async(toAdd: boolean) => {\r\n      const doc = ((this.message as Message.message).media as MessageMedia.messageMediaDocument)?.document;\r\n      if(!(doc as MyDocument)?.sticker) {\r\n        return false;\r\n      }\r\n\r\n      const favedStickers = await this.managers.acknowledged.appStickersManager.getFavedStickersStickers();\r\n      if(!favedStickers.cached) {\r\n        return false;\r\n      }\r\n\r\n      const found = (await favedStickers.result).some((_doc) => _doc.id === doc.id);\r\n      return toAdd ? !found : found;\r\n    };\r\n\r\n    this.buttons = [{\r\n      icon: 'send2',\r\n      text: 'MessageScheduleSend',\r\n      onClick: this.onSendScheduledClick,\r\n      verify: () => this.chat.type === 'scheduled' && !this.message.pFlags.is_outgoing\r\n    }, {\r\n      icon: 'send2',\r\n      text: 'Message.Context.Selection.SendNow',\r\n      onClick: this.onSendScheduledClick,\r\n      verify: () => this.chat.type === 'scheduled' && this.isSelected && !this.chat.selection.selectionSendNowBtn.hasAttribute('disabled'),\r\n      notDirect: () => true,\r\n      withSelection: true\r\n    }, {\r\n      icon: 'schedule',\r\n      text: 'MessageScheduleEditTime',\r\n      onClick: () => {\r\n        this.chat.input.scheduleSending(() => {\r\n          assumeType<Message.message>(this.message);\r\n          this.managers.appMessagesManager.editMessage(this.message, this.message.message, {\r\n            scheduleDate: this.chat.input.scheduleDate,\r\n            entities: this.message.entities\r\n          });\r\n\r\n          this.chat.input.onMessageSent(false, false);\r\n        }, new Date(this.message.date * 1000));\r\n      },\r\n      verify: () => this.chat.type === 'scheduled'\r\n    }, {\r\n      icon: 'reply',\r\n      text: 'Reply',\r\n      onClick: this.onReplyClick,\r\n      verify: async() => await this.chat.canSend() &&\r\n        !this.message.pFlags.is_outgoing &&\r\n        !!this.chat.input.messageInput &&\r\n        this.chat.type !== 'scheduled'/* ,\r\n      cancelEvent: true */\r\n    }, {\r\n      icon: 'favourites',\r\n      text: 'AddToFavorites',\r\n      onClick: this.onFaveStickerClick.bind(this, false),\r\n      verify: () => verifyFavoriteSticker(true)\r\n    }, {\r\n      icon: 'favourites',\r\n      text: 'DeleteFromFavorites',\r\n      onClick: this.onFaveStickerClick.bind(this, true),\r\n      verify: () => verifyFavoriteSticker(false)\r\n    }, {\r\n      icon: 'edit',\r\n      text: 'Edit',\r\n      onClick: this.onEditClick,\r\n      verify: async() => (await this.managers.appMessagesManager.canEditMessage(this.message, 'text')) && !!this.chat.input.messageInput\r\n    }, {\r\n      icon: 'copy',\r\n      text: 'Copy',\r\n      onClick: this.onCopyClick,\r\n      verify: () => !this.noForwards && !!(this.message as Message.message).message && !this.isTextSelected && (!this.isAnchorTarget || (this.message as Message.message).message !== this.target.innerText)\r\n    }, {\r\n      icon: 'copy',\r\n      text: 'Chat.CopySelectedText',\r\n      onClick: this.onCopyClick,\r\n      verify: () => !this.noForwards && !!(this.message as Message.message).message && this.isTextSelected\r\n    }, {\r\n      icon: 'copy',\r\n      text: 'Message.Context.Selection.Copy',\r\n      onClick: this.onCopyClick,\r\n      verify: async() => {\r\n        if(!this.isSelected || this.noForwards) {\r\n          return false;\r\n        }\r\n\r\n        for(const [peerId, mids] of this.chat.selection.selectedMids) {\r\n          const storageKey: MessagesStorageKey = `${peerId}_${this.chat.type === 'scheduled' ? 'scheduled' : 'history'}`;\r\n          for(const mid of mids) {\r\n            const message = (await this.managers.appMessagesManager.getMessageFromStorage(storageKey, mid)) as Message.message;\r\n            if(!!message.message) {\r\n              return true;\r\n            }\r\n          }\r\n        }\r\n\r\n        return false;\r\n      },\r\n      notDirect: () => true,\r\n      withSelection: true\r\n    }, {\r\n      icon: 'copy',\r\n      text: 'CopyLink',\r\n      onClick: this.onCopyAnchorLinkClick,\r\n      verify: () => this.isAnchorTarget,\r\n      withSelection: true\r\n    }, {\r\n      icon: 'copy',\r\n      text: 'Text.Context.Copy.Username',\r\n      onClick: () => {\r\n        copyTextToClipboard(this.target.innerHTML);\r\n      },\r\n      verify: () => this.isUsernameTarget,\r\n      withSelection: true\r\n    }, {\r\n      icon: 'copy',\r\n      text: 'Text.Context.Copy.Hashtag',\r\n      onClick: () => {\r\n        copyTextToClipboard(this.target.innerHTML);\r\n      },\r\n      verify: () => this.target.classList.contains('anchor-hashtag'),\r\n      withSelection: true\r\n    }, {\r\n      icon: 'link',\r\n      text: 'MessageContext.CopyMessageLink1',\r\n      onClick: this.onCopyLinkClick,\r\n      verify: async() => await this.managers.appPeersManager.isChannel(this.peerId) && !this.message.pFlags.is_outgoing\r\n    }, {\r\n      icon: 'pin',\r\n      text: 'Message.Context.Pin',\r\n      onClick: this.onPinClick,\r\n      verify: async() => !this.message.pFlags.is_outgoing &&\r\n        this.message._ !== 'messageService' &&\r\n        !this.message.pFlags.pinned &&\r\n        await this.managers.appPeersManager.canPinMessage(this.peerId) &&\r\n        this.chat.type !== 'scheduled'\r\n    }, {\r\n      icon: 'unpin',\r\n      text: 'Message.Context.Unpin',\r\n      onClick: this.onUnpinClick,\r\n      verify: async() => (this.message as Message.message).pFlags.pinned && await this.managers.appPeersManager.canPinMessage(this.peerId)\r\n    }, {\r\n      icon: 'download',\r\n      text: 'MediaViewer.Context.Download',\r\n      onClick: () => {\r\n        appDownloadManager.downloadToDisc({media: (this.message as any).media.document});\r\n      },\r\n      verify: () => {\r\n        if(this.message.pFlags.is_outgoing) {\r\n          return false;\r\n        }\r\n\r\n        const doc: MyDocument = ((this.message as Message.message).media as MessageMedia.messageMediaDocument)?.document as any;\r\n        if(!doc) return false;\r\n\r\n        let hasTarget = !!IS_TOUCH_SUPPORTED;\r\n        const isGoodType = !doc.type || !(['gif', 'video'/* , 'sticker' */] as MyDocument['type'][]).includes(doc.type);\r\n        if(isGoodType) hasTarget ||= !!findUpClassName(this.target, 'document') || !!findUpClassName(this.target, 'audio') || !!findUpClassName(this.target, 'media-sticker-wrapper');\r\n        return isGoodType && hasTarget;\r\n      }\r\n    }, {\r\n      icon: 'checkretract',\r\n      text: 'Chat.Poll.Unvote',\r\n      onClick: this.onRetractVote,\r\n      verify: () => {\r\n        const poll = (this.message as any).media?.poll as Poll;\r\n        return poll && poll.chosenIndexes.length && !poll.pFlags.closed && !poll.pFlags.quiz;\r\n      }/* ,\r\n      cancelEvent: true */\r\n    }, {\r\n      icon: 'stop',\r\n      text: 'Chat.Poll.Stop',\r\n      onClick: this.onStopPoll,\r\n      verify: async() => {\r\n        const poll = (this.message as any).media?.poll;\r\n        return await this.managers.appMessagesManager.canEditMessage(this.message, 'poll') && poll && !poll.pFlags.closed && !this.message.pFlags.is_outgoing;\r\n      }/* ,\r\n      cancelEvent: true */\r\n    }, {\r\n      icon: 'forward',\r\n      text: 'Forward',\r\n      onClick: this.onForwardClick, // let forward the message if it's outgoing but not ours (like a changelog)\r\n      verify: () => !this.noForwards && this.chat.type !== 'scheduled' && (!this.message.pFlags.is_outgoing || this.message.fromId === SERVICE_PEER_ID) && this.message._ !== 'messageService'\r\n    }, {\r\n      icon: 'forward',\r\n      text: 'Message.Context.Selection.Forward',\r\n      onClick: this.onForwardClick,\r\n      verify: () => this.chat.selection.selectionForwardBtn &&\r\n        this.isSelected &&\r\n        !this.chat.selection.selectionForwardBtn.hasAttribute('disabled'),\r\n      notDirect: () => true,\r\n      withSelection: true\r\n    }, {\r\n      icon: 'flag',\r\n      text: 'ReportChat',\r\n      onClick: () => {\r\n        new PopupReportMessages(this.peerId, [this.mid]);\r\n      },\r\n      verify: async() => !this.message.pFlags.out && this.message._ === 'message' && !this.message.pFlags.is_outgoing && await this.managers.appPeersManager.isChannel(this.peerId),\r\n      notDirect: () => true,\r\n      withSelection: true\r\n    }, {\r\n      icon: 'select',\r\n      text: 'Message.Context.Select',\r\n      onClick: this.onSelectClick,\r\n      verify: () => !(this.message as Message.messageService).action && !this.isSelected && this.isSelectable,\r\n      notDirect: () => true,\r\n      withSelection: true\r\n    }, {\r\n      icon: 'select',\r\n      text: 'Message.Context.Selection.Clear',\r\n      onClick: this.onClearSelectionClick,\r\n      verify: () => this.isSelected,\r\n      notDirect: () => true,\r\n      withSelection: true\r\n    }, {\r\n      onClick: () => {\r\n        if(this.viewerPeerId) {\r\n          this.chat.appImManager.setInnerPeer({\r\n            peerId: this.viewerPeerId\r\n          });\r\n        } else if(this.canOpenReactedList) {\r\n          new PopupReactedList(this.message as Message.message);\r\n        } else {\r\n          return false;\r\n        }\r\n      },\r\n      verify: async() => !this.peerId.isUser() && (!!(this.message as Message.message).reactions?.recent_reactions?.length || await this.managers.appMessagesManager.canViewMessageReadParticipants(this.message)),\r\n      notDirect: () => true\r\n    }, {\r\n      icon: 'delete danger',\r\n      text: 'Delete',\r\n      onClick: this.onDeleteClick,\r\n      verify: async() => this.managers.appMessagesManager.canDeleteMessage(this.message)\r\n    }, {\r\n      icon: 'delete danger',\r\n      text: 'Message.Context.Selection.Delete',\r\n      onClick: this.onDeleteClick,\r\n      verify: () => this.isSelected && !this.chat.selection.selectionDeleteBtn.hasAttribute('disabled'),\r\n      notDirect: () => true,\r\n      withSelection: true\r\n    }, {\r\n      icon: 'info',\r\n      text: 'Chat.Message.Sponsored.What',\r\n      onClick: () => {\r\n        new PopupSponsored();\r\n      },\r\n      verify: () => false,\r\n      isSponsored: true\r\n    }];\r\n  }\r\n\r\n  private async init() {\r\n    this.cleanup();\r\n    this.setButtons();\r\n\r\n    const filteredButtons = await this.filterButtons(this.buttons);\r\n    if(!filteredButtons.length) {\r\n      return;\r\n    }\r\n\r\n    const element = this.element = ButtonMenu(filteredButtons, this.listenerSetter);\r\n    element.id = 'bubble-contextmenu';\r\n    element.classList.add('contextmenu');\r\n\r\n    const viewsButton = filteredButtons.find((button) => !button.icon);\r\n    if(viewsButton) {\r\n      const reactions = (this.message as Message.message).reactions;\r\n      const recentReactions = reactions?.recent_reactions;\r\n      const isViewingReactions = !!recentReactions?.length;\r\n      const participantsCount = await this.managers.appMessagesManager.canViewMessageReadParticipants(this.message) ? ((await this.managers.appPeersManager.getPeer(this.peerId)) as MTChat.chat).participants_count : undefined;\r\n      const reactedLength = reactions ? reactions.results.reduce((acc, r) => acc + r.count, 0) : undefined;\r\n\r\n      viewsButton.element.classList.add('tgico-' + (isViewingReactions ? 'reactions' : 'checks'));\r\n      const i18nElem = new I18n.IntlElement({\r\n        key: isViewingReactions ? (\r\n          participantsCount === undefined ? 'Chat.Context.ReactedFast' : 'Chat.Context.Reacted'\r\n        ) : 'NobodyViewed',\r\n        args: isViewingReactions ? (\r\n          participantsCount === undefined ? [reactedLength] : [participantsCount, participantsCount]\r\n        ) : undefined,\r\n        element: viewsButton.textElement\r\n      });\r\n\r\n      let fakeText: HTMLElement;\r\n      if(isViewingReactions) {\r\n        if(participantsCount === undefined) {\r\n          fakeText = i18n('Chat.Context.ReactedFast', [reactedLength]);\r\n        } else {\r\n          fakeText = i18n(\r\n            recentReactions.length === participantsCount ? 'Chat.Context.ReactedFast' : 'Chat.Context.Reacted',\r\n            [recentReactions.length, participantsCount]\r\n          );\r\n        }\r\n      } else {\r\n        fakeText = i18n('Loading');\r\n      }\r\n\r\n      fakeText.classList.add('btn-menu-item-text-fake');\r\n      viewsButton.element.append(fakeText);\r\n\r\n      const AVATAR_SIZE = 22;\r\n      const MAX_AVATARS = 3;\r\n      const PADDING_PER_AVATAR = 1.125;\r\n      i18nElem.element.style.visibility = 'hidden';\r\n      i18nElem.element.style.paddingRight = isViewingReactions ? PADDING_PER_AVATAR * Math.min(MAX_AVATARS, recentReactions.length) + 'rem' : '1rem';\r\n      const middleware = this.middleware.get();\r\n      this.managers.appMessagesManager.getMessageReactionsListAndReadParticipants(this.message as Message.message).then((result) => {\r\n        if(!middleware()) {\r\n          return;\r\n        }\r\n\r\n        if(fakeText) {\r\n          fakeText.remove();\r\n        }\r\n\r\n        const reactions = result.combined;\r\n        const reactedLength = participantsCount === undefined ?\r\n          result.reactionsCount :\r\n          (\r\n            isViewingReactions ?\r\n              reactions.filter((reaction) => reaction.reaction).length :\r\n              reactions.length\r\n          );\r\n\r\n        let fakeElem: HTMLElement;\r\n        if(reactions.length === 1) {\r\n          fakeElem = new PeerTitle({\r\n            peerId: reactions[0].peerId,\r\n            onlyFirstName: true,\r\n            dialog: false\r\n          }).element;\r\n\r\n          if(!isViewingReactions || result.readParticipants.length <= 1) {\r\n            this.viewerPeerId = reactions[0].peerId;\r\n          }\r\n        } else if(isViewingReactions) {\r\n          const isFull = reactedLength === reactions.length || participantsCount === undefined;\r\n          fakeElem = i18n(\r\n            isFull ? 'Chat.Context.ReactedFast' : 'Chat.Context.Reacted',\r\n            isFull ? [reactedLength] : [reactedLength, reactions.length]\r\n          );\r\n        } else {\r\n          if(!reactions.length) {\r\n            i18nElem.element.style.visibility = '';\r\n          } else {\r\n            fakeElem = i18n('MessageSeen', [reactions.length]);\r\n          }\r\n        }\r\n\r\n        if(fakeElem) {\r\n          fakeElem.style.paddingRight = PADDING_PER_AVATAR * Math.min(MAX_AVATARS, reactedLength) + 'rem';\r\n          fakeElem.classList.add('btn-menu-item-text-fake');\r\n          viewsButton.element.append(fakeElem);\r\n        }\r\n\r\n        if(reactions.length) {\r\n          const avatars = new StackedAvatars({avatarSize: AVATAR_SIZE});\r\n          avatars.render(recentReactions ? recentReactions.map((r) => getPeerId(r.peer_id)) : reactions.map((reaction) => reaction.peerId));\r\n          viewsButton.element.append(avatars.container);\r\n\r\n          // if(reactions.length > 1) {\r\n          // if(isViewingReactions) {\r\n          this.canOpenReactedList = true;\r\n          // }\r\n        }\r\n      });\r\n    }\r\n\r\n    let menuPadding: MenuPositionPadding;\r\n    let reactionsMenu: ChatReactionsMenu;\r\n    let reactionsMenuPosition: 'horizontal' | 'vertical';\r\n    if(this.message._ === 'message' && !this.chat.selection.isSelecting && !this.message.pFlags.is_outgoing && !this.message.pFlags.is_scheduled) {\r\n      reactionsMenuPosition = (IS_APPLE || IS_TOUCH_SUPPORTED)/*  && false */ ? 'horizontal' : 'vertical';\r\n      reactionsMenu = this.reactionsMenu = new ChatReactionsMenu(this.managers, reactionsMenuPosition, this.middleware);\r\n      reactionsMenu.init(await this.managers.appMessagesManager.getGroupsFirstMessage(this.message));\r\n      // element.prepend(reactionsMenu.widthContainer);\r\n\r\n      const size = 36;\r\n      const margin = 8;\r\n      const totalSize = size + margin;\r\n      const paddingLeft = 0, paddingRight = 0;\r\n      if(reactionsMenuPosition === 'vertical') {\r\n        menuPadding = {\r\n          top: paddingLeft,\r\n          // bottom: 36, // positionMenu will detect it itself somehow\r\n          left: totalSize\r\n        };\r\n      } else {\r\n        menuPadding = {\r\n          top: totalSize,\r\n          right: paddingRight,\r\n          left: paddingLeft\r\n        };\r\n      }\r\n    }\r\n\r\n    this.chat.container.append(element);\r\n\r\n    return {\r\n      element,\r\n      cleanup: () => {\r\n        this.cleanup();\r\n        reactionsMenu && reactionsMenu.cleanup();\r\n      },\r\n      destroy: () => {\r\n        element.remove();\r\n        reactionsMenu && reactionsMenu.widthContainer.remove();\r\n      },\r\n      menuPadding,\r\n      reactionsMenu,\r\n      reactionsMenuPosition\r\n    };\r\n  }\r\n\r\n  private onSendScheduledClick = async() => {\r\n    if(this.chat.selection.isSelecting) {\r\n      simulateClickEvent(this.chat.selection.selectionSendNowBtn);\r\n    } else {\r\n      new PopupSendNow(this.peerId, await this.chat.getMidsByMid(this.mid));\r\n    }\r\n  };\r\n\r\n  private onReplyClick = () => {\r\n    this.chat.input.initMessageReply(this.mid);\r\n  };\r\n\r\n  private onFaveStickerClick = (unfave?: boolean) => {\r\n    const docId = ((this.message as Message.message).media as MessageMedia.messageMediaDocument).document.id;\r\n    this.managers.appStickersManager.faveSticker(docId, unfave);\r\n  };\r\n\r\n  private onEditClick = () => {\r\n    this.chat.input.initMessageEditing(this.mid);\r\n  };\r\n\r\n  private onCopyClick = async() => {\r\n    if(isSelectionEmpty()) {\r\n      const mids = this.chat.selection.isSelecting ?\r\n        [...this.chat.selection.selectedMids.get(this.peerId)].sort((a, b) => a - b) :\r\n        [this.mid];\r\n\r\n      const parts: string[] = await Promise.all(mids.map(async(mid) => {\r\n        const message = (await this.chat.getMessage(mid)) as Message.message;\r\n        return message?.message ? message.message + '\\n' : '';\r\n      }));\r\n\r\n      const str = parts.join('');\r\n\r\n      copyTextToClipboard(str);\r\n    } else {\r\n      document.execCommand('copy');\r\n      // cancelSelection();\r\n    }\r\n  };\r\n\r\n  private onCopyAnchorLinkClick = () => {\r\n    copyTextToClipboard((this.target as HTMLAnchorElement).href);\r\n  };\r\n\r\n  private onCopyLinkClick = async() => {\r\n    let threadMessage: Message.message;\r\n    const {peerId, mid} = this;\r\n    const threadId = this.chat.threadId;\r\n    if(this.chat.type === 'discussion') {\r\n      threadMessage = (await this.managers.appMessagesManager.getMessageByPeer(peerId, threadId)) as Message.message;\r\n    }\r\n\r\n    const username = await this.managers.appPeersManager.getPeerUsername(threadMessage ? threadMessage.fromId : peerId);\r\n    const msgId = getServerMessageId(mid);\r\n    let url = 'https://t.me/';\r\n    let key: LangPackKey;\r\n    if(username) {\r\n      url += username + '/' + (threadMessage ? getServerMessageId(threadMessage.fwd_from.channel_post) : msgId);\r\n      if(threadMessage) url += '?comment=' + msgId;\r\n      key = 'LinkCopied';\r\n    } else {\r\n      url += 'c/' + peerId.toChatId() + '/' + msgId;\r\n      if(threadMessage) url += '?thread=' + getServerMessageId(threadMessage.mid);\r\n      key = 'LinkCopiedPrivateInfo';\r\n    }\r\n\r\n    toast(I18n.format(key, true));\r\n\r\n    copyTextToClipboard(url);\r\n  };\r\n\r\n  private onPinClick = () => {\r\n    new PopupPinMessage(this.peerId, this.mid);\r\n  };\r\n\r\n  private onUnpinClick = () => {\r\n    new PopupPinMessage(this.peerId, this.mid, true);\r\n  };\r\n\r\n  private onRetractVote = () => {\r\n    this.managers.appPollsManager.sendVote(this.message, []);\r\n  };\r\n\r\n  private onStopPoll = () => {\r\n    this.managers.appPollsManager.stopPoll(this.message);\r\n  };\r\n\r\n  private onForwardClick = async() => {\r\n    if(this.chat.selection.isSelecting) {\r\n      simulateClickEvent(this.chat.selection.selectionForwardBtn);\r\n    } else {\r\n      const peerId = this.peerId;\r\n      const mids = this.isTargetAGroupedItem ? [this.mid] : await this.chat.getMidsByMid(this.mid);\r\n      new PopupForward({\r\n        [peerId]: mids\r\n      });\r\n    }\r\n  };\r\n\r\n  private onSelectClick = () => {\r\n    this.chat.selection.toggleByElement(findUpClassName(this.target, 'grouped-item') || findUpClassName(this.target, 'bubble'));\r\n  };\r\n\r\n  private onClearSelectionClick = () => {\r\n    this.chat.selection.cancelSelection();\r\n  };\r\n\r\n  private onDeleteClick = async() => {\r\n    if(this.chat.selection.isSelecting) {\r\n      simulateClickEvent(this.chat.selection.selectionDeleteBtn);\r\n    } else {\r\n      new PopupDeleteMessages(this.peerId, this.isTargetAGroupedItem ? [this.mid] : await this.chat.getMidsByMid(this.mid), this.chat.type);\r\n    }\r\n  };\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport contextMenuController from '../../helpers/contextMenuController';\r\nimport {attachContextMenuListener} from '../../helpers/dom/attachContextMenuListener';\r\nimport cancelEvent from '../../helpers/dom/cancelEvent';\r\nimport ListenerSetter from '../../helpers/listenerSetter';\r\nimport rootScope from '../../lib/rootScope';\r\nimport ButtonMenu, {ButtonMenuItemOptions} from '../buttonMenu';\r\n\r\nexport default class SendMenu {\r\n  public sendMenu: HTMLDivElement;\r\n  private sendMenuButtons: (ButtonMenuItemOptions & {verify: () => boolean})[];\r\n  private type: 'schedule' | 'reminder';\r\n\r\n  constructor(options: {\r\n    onSilentClick: () => void,\r\n    onScheduleClick: () => void,\r\n    listenerSetter?: ListenerSetter,\r\n    openSide: string,\r\n    onContextElement: HTMLElement,\r\n    onOpen?: () => boolean\r\n  }) {\r\n    this.sendMenuButtons = [{\r\n      icon: 'mute',\r\n      text: 'Chat.Send.WithoutSound',\r\n      onClick: options.onSilentClick,\r\n      verify: () => this.type === 'schedule'\r\n    }, {\r\n      icon: 'schedule',\r\n      text: 'Chat.Send.ScheduledMessage',\r\n      onClick: options.onScheduleClick,\r\n      verify: () => this.type === 'schedule'\r\n    }, {\r\n      icon: 'schedule',\r\n      text: 'Chat.Send.SetReminder',\r\n      onClick: options.onScheduleClick,\r\n      verify: () => this.type === 'reminder'\r\n    }];\r\n\r\n    this.sendMenu = ButtonMenu(this.sendMenuButtons, options.listenerSetter);\r\n    this.sendMenu.classList.add('menu-send', options.openSide);\r\n\r\n    attachContextMenuListener(options.onContextElement, (e: any) => {\r\n      if(options.onOpen && !options.onOpen()) {\r\n        return;\r\n      }\r\n\r\n      this.sendMenuButtons.forEach((button) => {\r\n        button.element.classList.toggle('hide', !button.verify());\r\n      });\r\n\r\n      cancelEvent(e);\r\n      contextMenuController.openBtnMenu(this.sendMenu);\r\n    }, options.listenerSetter);\r\n  }\r\n\r\n  public setPeerId(peerId: PeerId) {\r\n    this.type = peerId === rootScope.myId ? 'reminder' : 'schedule';\r\n  }\r\n};\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport type Chat from '../chat/chat';\r\nimport PopupElement from '.';\r\nimport CheckboxField from '../checkboxField';\r\nimport InputField from '../inputField';\r\nimport RadioField from '../radioField';\r\nimport Scrollable from '../scrollable';\r\nimport SendContextMenu from '../chat/sendContextMenu';\r\nimport I18n, {_i18n} from '../../lib/langPack';\r\nimport findUpTag from '../../helpers/dom/findUpTag';\r\nimport cancelEvent from '../../helpers/dom/cancelEvent';\r\nimport getRichValue from '../../helpers/dom/getRichValue';\r\nimport isInputEmpty from '../../helpers/dom/isInputEmpty';\r\nimport whichChild from '../../helpers/dom/whichChild';\r\nimport {attachClickEvent} from '../../helpers/dom/clickEvent';\r\nimport {Poll} from '../../layer';\r\n\r\nconst MAX_LENGTH_QUESTION = 255;\r\nconst MAX_LENGTH_OPTION = 100;\r\nconst MAX_LENGTH_SOLUTION = 200;\r\n\r\nexport default class PopupCreatePoll extends PopupElement {\r\n  private questionInputField: InputField;\r\n  private questions: HTMLElement;\r\n  protected scrollable: Scrollable;\r\n  private tempId = 0;\r\n\r\n  private anonymousCheckboxField: CheckboxField;\r\n  private multipleCheckboxField: PopupCreatePoll['anonymousCheckboxField'];\r\n  private quizCheckboxField: PopupCreatePoll['anonymousCheckboxField'];\r\n\r\n  private correctAnswers: Uint8Array[];\r\n  private quizSolutionField: InputField;\r\n  private optionInputFields: InputField[];\r\n\r\n  constructor(private chat: Chat) {\r\n    super('popup-create-poll popup-new-media', {closable: true, withConfirm: 'Create', body: true, title: 'NewPoll'});\r\n    this.construct();\r\n  }\r\n\r\n  private async construct() {\r\n    this.questionInputField = new InputField({\r\n      placeholder: 'AskAQuestion',\r\n      label: 'AskAQuestion',\r\n      name: 'question',\r\n      maxLength: MAX_LENGTH_QUESTION\r\n    });\r\n\r\n    this.listenerSetter.add(this.questionInputField.input)('input', () => {\r\n      this.handleChange();\r\n    });\r\n\r\n    this.optionInputFields = [];\r\n\r\n    if(this.chat.type !== 'scheduled') {\r\n      const sendMenu = new SendContextMenu({\r\n        onSilentClick: () => {\r\n          this.chat.input.sendSilent = true;\r\n          this.send();\r\n        },\r\n        onScheduleClick: () => {\r\n          this.chat.input.scheduleSending(() => {\r\n            this.send();\r\n          });\r\n        },\r\n        openSide: 'bottom-left',\r\n        onContextElement: this.btnConfirm\r\n      });\r\n\r\n      sendMenu.setPeerId(this.chat.peerId);\r\n\r\n      this.header.append(sendMenu.sendMenu);\r\n    }\r\n\r\n    this.header.append(this.questionInputField.container);\r\n\r\n    const hr = document.createElement('hr');\r\n    const d = document.createElement('div');\r\n    d.classList.add('caption');\r\n    _i18n(d, 'PollOptions');\r\n\r\n    this.questions = document.createElement('form');\r\n    this.questions.classList.add('poll-create-questions');\r\n\r\n    const dd = document.createElement('div');\r\n    dd.classList.add('poll-create-settings');\r\n\r\n    const settingsCaption = document.createElement('div');\r\n    settingsCaption.classList.add('caption');\r\n    _i18n(settingsCaption, 'Settings');\r\n\r\n    if(!(await this.chat.managers.appPeersManager.isBroadcast(this.chat.peerId))) {\r\n      this.anonymousCheckboxField = new CheckboxField({\r\n        text: 'NewPoll.Anonymous',\r\n        name: 'anonymous'\r\n      });\r\n      this.anonymousCheckboxField.input.checked = true;\r\n      dd.append(this.anonymousCheckboxField.label);\r\n    }\r\n\r\n    this.multipleCheckboxField = new CheckboxField({\r\n      text: 'NewPoll.MultipleChoice',\r\n      name: 'multiple'\r\n    });\r\n    this.quizCheckboxField = new CheckboxField({\r\n      text: 'NewPoll.Quiz',\r\n      name: 'quiz'\r\n    });\r\n\r\n    this.listenerSetter.add(this.multipleCheckboxField.input)('change', () => {\r\n      const checked = this.multipleCheckboxField.input.checked;\r\n      this.quizCheckboxField.input.toggleAttribute('disabled', checked);\r\n    });\r\n\r\n    this.listenerSetter.add(this.quizCheckboxField.input)('change', () => {\r\n      const checked = this.quizCheckboxField.input.checked;\r\n\r\n      (Array.from(this.questions.children) as HTMLElement[]).map((el) => {\r\n        el.classList.toggle('radio-field', checked);\r\n      });\r\n\r\n      if(!checked) {\r\n        this.correctAnswers = undefined;\r\n        this.quizSolutionField.setValueSilently('');\r\n      }\r\n\r\n      quizElements.forEach((el) => el.classList.toggle('hide', !checked));\r\n\r\n      this.multipleCheckboxField.input.toggleAttribute('disabled', checked);\r\n      this.handleChange();\r\n    });\r\n\r\n    dd.append(this.multipleCheckboxField.label, this.quizCheckboxField.label);\r\n\r\n    const quizElements: HTMLElement[] = [];\r\n\r\n    const quizSolutionCaption = document.createElement('div');\r\n    quizSolutionCaption.classList.add('caption');\r\n    _i18n(quizSolutionCaption, 'AccDescrQuizExplanation');\r\n\r\n    const quizHr = document.createElement('hr');\r\n\r\n    const quizSolutionContainer = document.createElement('div');\r\n    quizSolutionContainer.classList.add('poll-create-questions');\r\n\r\n    this.quizSolutionField = new InputField({\r\n      placeholder: 'NewPoll.Explanation.Placeholder',\r\n      label: 'NewPoll.Explanation.Placeholder',\r\n      name: 'solution',\r\n      maxLength: MAX_LENGTH_SOLUTION\r\n    });\r\n\r\n    this.listenerSetter.add(this.questionInputField.input)('input', () => {\r\n      this.handleChange();\r\n    });\r\n\r\n    const quizSolutionSubtitle = document.createElement('div');\r\n    quizSolutionSubtitle.classList.add('subtitle');\r\n    _i18n(quizSolutionSubtitle, 'AddAnExplanationInfo');\r\n\r\n    quizSolutionContainer.append(this.quizSolutionField.container, quizSolutionSubtitle);\r\n\r\n    quizElements.push(quizHr, quizSolutionCaption, quizSolutionContainer);\r\n    quizElements.forEach((el) => el.classList.add('hide'));\r\n\r\n    this.body.parentElement.insertBefore(hr, this.body);\r\n    this.body.append(d, this.questions, document.createElement('hr'), settingsCaption, dd, ...quizElements);\r\n\r\n    attachClickEvent(this.btnConfirm, this.onSubmitClick, {listenerSetter: this.listenerSetter});\r\n\r\n    this.scrollable = new Scrollable(this.body);\r\n    this.appendMoreField();\r\n\r\n    this.onEscape = () => {\r\n      return !this.getFilledAnswers().length;\r\n    };\r\n\r\n    this.handleChange();\r\n  }\r\n\r\n  private getFilledAnswers() {\r\n    const answers = Array.from(this.questions.children).map((el, idx) => {\r\n      const input = el.querySelector('.input-field-input') as HTMLElement;\r\n      return input instanceof HTMLInputElement ? input.value : getRichValue(input, false).value;\r\n    }).filter((v) => !!v.trim());\r\n\r\n    return answers;\r\n  }\r\n\r\n  private onSubmitClick = () => {\r\n    this.send();\r\n  };\r\n\r\n  private validate() {\r\n    const question = this.questionInputField.value;\r\n    if(!question) {\r\n      return false;\r\n    }\r\n\r\n    if(question.length > MAX_LENGTH_QUESTION) {\r\n      return false;\r\n    }\r\n\r\n    if(this.quizCheckboxField.input.checked && !this.correctAnswers?.length) {\r\n      return false;\r\n    }\r\n\r\n    const answers = this.getFilledAnswers();\r\n    if(answers.length < 2) {\r\n      return false;\r\n    }\r\n\r\n    const tooLongOption = answers.find((a) => a.length > MAX_LENGTH_OPTION);\r\n    if(tooLongOption) {\r\n      return false;\r\n    }\r\n\r\n    const {value: quizSolution} = getRichValue(this.quizSolutionField.input, false);\r\n    if(quizSolution.length > MAX_LENGTH_SOLUTION) {\r\n      return false;\r\n    }\r\n\r\n    return true;\r\n  }\r\n\r\n  private handleChange() {\r\n    const valid = this.validate();\r\n    this.btnConfirm.toggleAttribute('disabled', !valid);\r\n  }\r\n\r\n  public async send(force = false) {\r\n    const question = this.questionInputField.value;\r\n\r\n    const answers = this.getFilledAnswers();\r\n\r\n    const {value: quizSolution, entities: quizSolutionEntities} = getRichValue(this.quizSolutionField.input);\r\n\r\n    if(this.chat.type === 'scheduled' && !force) {\r\n      this.chat.input.scheduleSending(() => {\r\n        this.send(true);\r\n      });\r\n\r\n      return;\r\n    }\r\n\r\n    this.hide();\r\n\r\n    // const randomID = [nextRandomInt(0xFFFFFFFF), nextRandomInt(0xFFFFFFFF)];\r\n    // const randomIDS = bigint(randomID[0]).shiftLeft(32).add(bigint(randomID[1])).toString();\r\n\r\n    const pFlags: Poll['pFlags'] = {};\r\n\r\n    if(this.anonymousCheckboxField && !this.anonymousCheckboxField.input.checked) {\r\n      pFlags.public_voters = true;\r\n    }\r\n\r\n    if(this.multipleCheckboxField.input.checked) {\r\n      pFlags.multiple_choice = true;\r\n    }\r\n\r\n    if(this.quizCheckboxField.input.checked) {\r\n      pFlags.quiz = true;\r\n    }\r\n\r\n    const poll: Poll = {\r\n      _: 'poll',\r\n      pFlags,\r\n      question,\r\n      answers: answers.map((value, idx) => {\r\n        return {\r\n          _: 'pollAnswer',\r\n          text: value,\r\n          option: new Uint8Array([idx])\r\n        };\r\n      }),\r\n      id: undefined\r\n    };\r\n    // poll.id = randomIDS;\r\n\r\n    const inputMediaPoll = await this.chat.managers.appPollsManager.getInputMediaPoll(poll, this.correctAnswers, quizSolution, quizSolutionEntities);\r\n\r\n    // console.log('Will try to create poll:', inputMediaPoll);\r\n\r\n    this.chat.managers.appMessagesManager.sendOther(this.chat.peerId, inputMediaPoll, {\r\n      ...this.chat.getMessageSendingParams()\r\n    });\r\n\r\n    if(this.chat.input.helperType === 'reply') {\r\n      this.chat.input.clearHelper();\r\n    }\r\n\r\n    this.chat.input.onMessageSent(false, false);\r\n  }\r\n\r\n  onInput = (e: Event) => {\r\n    const target = e.target as HTMLInputElement;\r\n\r\n    const radioLabel = findUpTag(target, 'LABEL');\r\n    const isEmpty = isInputEmpty(target);\r\n    if(!isEmpty) {\r\n      target.parentElement.classList.add('is-filled');\r\n      radioLabel.classList.remove('hidden-widget');\r\n      radioLabel.firstElementChild.removeAttribute('disabled');\r\n    }\r\n\r\n    const isLast = !radioLabel.nextElementSibling;\r\n    if(isLast && !isEmpty && this.questions.childElementCount < 10) {\r\n      this.appendMoreField();\r\n    }\r\n\r\n    this.handleChange();\r\n  };\r\n\r\n  onDeleteClick = (e: MouseEvent) => {\r\n    const target = e.target as HTMLSpanElement;\r\n    const label = findUpTag(target, 'LABEL');\r\n    const idx = whichChild(label);\r\n\r\n    if(this.correctAnswers && this.correctAnswers[0][0] === idx) {\r\n      this.correctAnswers = undefined;\r\n    }\r\n\r\n    label.remove();\r\n    this.optionInputFields.splice(idx, 1);\r\n\r\n    this.optionInputFields.forEach((inputField, idx) => {\r\n      inputField.options.labelOptions.length = 0;\r\n      inputField.options.labelOptions.push(idx + 1);\r\n      const i18nElement = I18n.weakMap.get(inputField.label.firstElementChild as HTMLElement);\r\n      i18nElement.update();\r\n    });\r\n\r\n    this.handleChange();\r\n  };\r\n\r\n  private appendMoreField() {\r\n    const tempId = this.tempId++;\r\n    const idx = this.questions.childElementCount + 1;\r\n    const questionField = new InputField({\r\n      placeholder: 'NewPoll.OptionsAddOption',\r\n      label: 'NewPoll.OptionLabel',\r\n      labelOptions: [idx],\r\n      name: 'question-' + tempId,\r\n      maxLength: MAX_LENGTH_OPTION\r\n    });\r\n    this.listenerSetter.add(questionField.input)('input', this.onInput);\r\n\r\n    const radioField = new RadioField({\r\n      text: '',\r\n      name: 'question'\r\n    });\r\n    radioField.main.append(questionField.container);\r\n    attachClickEvent(questionField.input, cancelEvent, {listenerSetter: this.listenerSetter});\r\n    radioField.label.classList.add('hidden-widget');\r\n    radioField.input.disabled = true;\r\n    if(!this.quizCheckboxField.input.checked) {\r\n      radioField.label.classList.remove('radio-field');\r\n    }\r\n    this.listenerSetter.add(radioField.input)('change', () => {\r\n      const checked = radioField.input.checked;\r\n      if(checked) {\r\n        const idx = whichChild(radioField.label);\r\n        this.correctAnswers = [new Uint8Array([idx])];\r\n        this.handleChange();\r\n      }\r\n    });\r\n\r\n    const deleteBtn = document.createElement('span');\r\n    deleteBtn.classList.add('btn-icon', 'tgico-close');\r\n    questionField.container.append(deleteBtn);\r\n\r\n    attachClickEvent(deleteBtn, this.onDeleteClick, {listenerSetter: this.listenerSetter, once: true});\r\n\r\n    this.questions.append(radioField.label);\r\n\r\n    this.scrollable.scrollIntoViewNew({\r\n      element: this.questions.lastElementChild as HTMLElement,\r\n      position: 'center'\r\n    });\r\n    // this.scrollable.scrollTo(this.scrollable.scrollHeight, 'top', true, true);\r\n\r\n    this.optionInputFields.push(questionField);\r\n  }\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport pause from './schedulers/pause';\r\nimport {makeMediaSize} from './mediaSize';\r\nimport scaleMediaElement from './canvas/scaleMediaElement';\r\nimport preloadVideo from './preloadVideo';\r\n\r\nexport function createPosterFromMedia(media: HTMLVideoElement | HTMLImageElement) {\r\n  let width: number, height: number;\r\n  if(media instanceof HTMLVideoElement) {\r\n    width = media.videoWidth;\r\n    height = media.videoHeight;\r\n  } else {\r\n    width = media.naturalWidth;\r\n    height = media.naturalHeight;\r\n  }\r\n\r\n  return scaleMediaElement({\r\n    media,\r\n    mediaSize: makeMediaSize(width, height),\r\n    boxSize: makeMediaSize(320, 240),\r\n    quality: .9\r\n  });\r\n}\r\n\r\nexport function createPosterFromVideo(video: HTMLVideoElement): ReturnType<typeof scaleMediaElement> {\r\n  return new Promise((resolve, reject) => {\r\n    video.onseeked = () => {\r\n      video.onseeked = () => {\r\n        createPosterFromMedia(video).then(resolve);\r\n\r\n        video.onseeked = undefined;\r\n      };\r\n\r\n      video.currentTime = 0;\r\n    };\r\n\r\n    video.onerror = reject;\r\n    video.currentTime = Math.min(video.duration, 1);\r\n  });\r\n}\r\n\r\nexport async function createPosterForVideo(url: string) {\r\n  const video = await preloadVideo(url);\r\n\r\n  return Promise.race([\r\n    pause(2000) as Promise<undefined>,\r\n    createPosterFromVideo(video)\r\n  ]);\r\n}\r\n\r\n\r\n","/**\n * @returns duration in ms\n */\nexport default function getGifDuration(image: HTMLImageElement) {\n  const src = image.src;\n\n  return fetch(src)\n  .then((response) => response.arrayBuffer())\n  .then((arrayBuffer) => {\n    const d = new Uint8Array(arrayBuffer);\n    // Thanks to http://justinsomnia.org/2006/10/gif-animation-duration-calculation/\n    // And http://www.w3.org/Graphics/GIF/spec-gif89a.txt\n    let duration = 0;\n    for(let i = 0, length = d.length; i < length; ++i) {\n      // Find a Graphic Control Extension hex(21F904__ ____ __00)\n      if(d[i] == 0x21 &&\n       d[i + 1] == 0xF9 &&\n       d[i + 2] == 0x04 &&\n       d[i + 7] == 0x00) {\n        // Swap 5th and 6th bytes to get the delay per frame\n        const delay = (d[i + 5] << 8) | (d[i + 4] & 0xFF);\n\n        // Should be aware browsers have a minimum frame delay\n        // e.g. 6ms for IE, 2ms modern browsers (50fps)\n        duration += delay < 2 ? 10 : delay;\n      }\n    }\n\n    return duration / 1000;\n  });\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport type Chat from '../chat/chat';\nimport InputField from '../inputField';\nimport PopupElement from '.';\nimport Scrollable from '../scrollable';\nimport {toast} from '../toast';\nimport {wrapDocument} from '../wrappers';\nimport CheckboxField from '../checkboxField';\nimport SendContextMenu from '../chat/sendContextMenu';\nimport {createPosterFromMedia, createPosterFromVideo} from '../../helpers/createPoster';\nimport {MyDocument} from '../../lib/appManagers/appDocsManager';\nimport I18n, {FormatterArguments, i18n, LangPackKey} from '../../lib/langPack';\nimport calcImageInBox from '../../helpers/calcImageInBox';\nimport placeCaretAtEnd from '../../helpers/dom/placeCaretAtEnd';\nimport {attachClickEvent} from '../../helpers/dom/clickEvent';\nimport MEDIA_MIME_TYPES_SUPPORTED from '../../environment/mediaMimeTypesSupport';\nimport getGifDuration from '../../helpers/getGifDuration';\nimport replaceContent from '../../helpers/dom/replaceContent';\nimport createVideo from '../../helpers/dom/createVideo';\nimport prepareAlbum from '../prepareAlbum';\nimport {MediaSize} from '../../helpers/mediaSize';\nimport {ThumbCache} from '../../lib/storages/thumbs';\nimport onMediaLoad from '../../helpers/onMediaLoad';\nimport apiManagerProxy from '../../lib/mtproto/mtprotoworker';\nimport {THUMB_TYPE_FULL} from '../../lib/mtproto/mtproto_config';\n\ntype SendFileParams = Partial<{\n  file: File,\n  objectURL: string,\n  thumb: {\n    blob: Blob,\n    url: string,\n    size: MediaSize\n  },\n  width: number,\n  height: number,\n  duration: number,\n  noSound: boolean,\n  itemDiv: HTMLElement\n}>;\n\nlet currentPopup: PopupNewMedia;\n\nexport function getCurrentNewMediaPopup() {\n  return currentPopup;\n}\n\nexport default class PopupNewMedia extends PopupElement {\n  private input: HTMLElement;\n  private mediaContainer: HTMLElement;\n  private groupCheckboxField: CheckboxField;\n  private mediaCheckboxField: CheckboxField;\n  private wasInputValue: string;\n\n  private willAttach: Partial<{\n    type: 'media' | 'document',\n    isMedia: true,\n    group: boolean,\n    sendFileDetails: SendFileParams[]\n  }>;\n  private inputField: InputField;\n  private captionLengthMax: number;\n\n  constructor(private chat: Chat, private files: File[], willAttachType: PopupNewMedia['willAttach']['type']) {\n    super('popup-send-photo popup-new-media', {closable: true, withConfirm: 'Modal.Send', confirmShortcutIsSendShortcut: true, body: true, title: true});\n    this.construct(willAttachType);\n  }\n\n  private async construct(willAttachType: PopupNewMedia['willAttach']['type']) {\n    this.willAttach = {\n      type: willAttachType,\n      sendFileDetails: [],\n      group: false\n    };\n\n    const config = await this.managers.apiManager.getConfig();\n    this.captionLengthMax = config.caption_length_max;\n\n    attachClickEvent(this.btnConfirm, () => this.send(), {listenerSetter: this.listenerSetter});\n\n    if(this.chat.type !== 'scheduled') {\n      const sendMenu = new SendContextMenu({\n        onSilentClick: () => {\n          this.chat.input.sendSilent = true;\n          this.send();\n        },\n        onScheduleClick: () => {\n          this.chat.input.scheduleSending(() => {\n            this.send();\n          });\n        },\n        openSide: 'bottom-left',\n        onContextElement: this.btnConfirm,\n        listenerSetter: this.listenerSetter\n      });\n\n      sendMenu.setPeerId(this.chat.peerId);\n\n      this.header.append(sendMenu.sendMenu);\n    }\n\n    this.mediaContainer = document.createElement('div');\n    this.mediaContainer.classList.add('popup-photo');\n    const scrollable = new Scrollable(null);\n    scrollable.container.append(this.mediaContainer);\n\n    this.inputField = new InputField({\n      placeholder: 'PreviewSender.CaptionPlaceholder',\n      label: 'Caption',\n      name: 'photo-caption',\n      maxLength: this.captionLengthMax,\n      withLinebreaks: true\n    });\n    this.input = this.inputField.input;\n\n    this.inputField.value = this.wasInputValue = this.chat.input.messageInputField.input.innerHTML;\n    this.chat.input.messageInputField.value = '';\n\n    this.body.append(scrollable.container);\n    this.container.append(this.inputField.container);\n\n    this.attachFiles();\n\n    this.addEventListener('close', () => {\n      this.files = [];\n      currentPopup = undefined;\n    });\n\n    currentPopup = this;\n  }\n\n  public appendDrops(element: HTMLElement) {\n    this.body.append(element);\n  }\n\n  get type() {\n    return this.willAttach.type;\n  }\n\n  set type(type: PopupNewMedia['willAttach']['type']) {\n    this.willAttach.type = type;\n  }\n\n  private appendGroupCheckboxField() {\n    const good = this.files.length > 1;\n    if(good && !this.groupCheckboxField) {\n      this.groupCheckboxField = new CheckboxField({\n        text: 'PreviewSender.GroupItems',\n        name: 'group-items'\n      });\n      this.container.append(...[this.groupCheckboxField.label, this.mediaCheckboxField?.label, this.inputField.container].filter(Boolean));\n\n      this.willAttach.group = true;\n      this.groupCheckboxField.setValueSilently(this.willAttach.group);\n\n      this.listenerSetter.add(this.groupCheckboxField.input)('change', () => {\n        const checked = this.groupCheckboxField.checked;\n\n        this.willAttach.group = checked;\n\n        this.attachFiles();\n      });\n    } else if(this.groupCheckboxField) {\n      this.groupCheckboxField.label.classList.toggle('hide', !good);\n    }\n  }\n\n  private appendMediaCheckboxField() {\n    const good = !!this.files.find((file) => MEDIA_MIME_TYPES_SUPPORTED.has(file.type));\n    if(good && !this.mediaCheckboxField) {\n      this.mediaCheckboxField = new CheckboxField({\n        text: 'PreviewSender.CompressFile',\n        name: 'compress-items'\n      });\n      this.container.append(...[this.groupCheckboxField?.label, this.mediaCheckboxField.label, this.inputField.container].filter(Boolean));\n\n      this.mediaCheckboxField.setValueSilently(this.willAttach.type === 'media');\n\n      this.listenerSetter.add(this.mediaCheckboxField.input)('change', () => {\n        const checked = this.mediaCheckboxField.checked;\n\n        this.willAttach.type = checked ? 'media' : 'document';\n\n        this.attachFiles();\n      });\n    } else if(this.mediaCheckboxField) {\n      this.mediaCheckboxField.label.classList.toggle('hide', !good);\n    }\n  }\n\n  public addFiles(files: File[]) {\n    const toPush = files.filter((file) => {\n      const found = this.files.find((_file) => {\n        return _file.lastModified === file.lastModified && _file.name === file.name && _file.size === file.size;\n      });\n\n      return !found;\n    });\n\n    if(toPush.length) {\n      this.files.push(...toPush);\n      this.attachFiles();\n    }\n  }\n\n  private onKeyDown = (e: KeyboardEvent) => {\n    const target = e.target as HTMLElement;\n    if(target !== this.input) {\n      if(target.tagName === 'INPUT' || target.hasAttribute('contenteditable')) {\n        return;\n      }\n\n      this.input.focus();\n      placeCaretAtEnd(this.input);\n    }\n  };\n\n  private send(force = false) {\n    if(this.chat.type === 'scheduled' && !force) {\n      this.chat.input.scheduleSending(() => {\n        this.send(true);\n      });\n\n      return;\n    }\n\n    let caption = this.inputField.value;\n    if(caption.length > this.captionLengthMax) {\n      toast(I18n.format('Error.PreviewSender.CaptionTooLong', true));\n      return;\n    }\n\n    this.hide();\n    const willAttach = this.willAttach;\n    willAttach.isMedia = willAttach.type === 'media' ? true : undefined;\n    const {sendFileDetails, isMedia} = willAttach;\n\n    // console.log('will send files with options:', willAttach);\n\n    const {peerId, input} = this.chat;\n\n    sendFileDetails.forEach((d) => {\n      d.itemDiv = undefined;\n    });\n\n    const {length} = sendFileDetails;\n    const sendingParams = this.chat.getMessageSendingParams();\n    this.iterate((sendFileDetails) => {\n      if(caption && sendFileDetails.length !== length) {\n        this.managers.appMessagesManager.sendText(peerId, caption, {\n          ...sendingParams,\n          clearDraft: true\n        });\n\n        caption = undefined;\n      }\n\n      const w = {\n        ...willAttach,\n        sendFileDetails\n      };\n\n      this.managers.appMessagesManager.sendAlbum(peerId, w.sendFileDetails.map((d) => d.file), Object.assign({\n        ...sendingParams,\n        caption,\n        isMedia: isMedia,\n        clearDraft: true as true\n      }, w));\n\n      caption = undefined;\n    });\n\n    input.replyToMsgId = this.chat.threadId;\n    input.onMessageSent();\n  }\n\n  private async attachMedia(params: SendFileParams, itemDiv: HTMLElement) {\n    itemDiv.classList.add('popup-item-media');\n\n    const file = params.file;\n    const isVideo = file.type.startsWith('video/');\n\n    let promise: Promise<void>;\n    if(isVideo) {\n      const video = createVideo();\n      const source = document.createElement('source');\n      source.src = params.objectURL = await apiManagerProxy.invoke('createObjectURL', file);\n      video.autoplay = true;\n      video.controls = false;\n      video.muted = true;\n\n      video.addEventListener('timeupdate', () => {\n        video.pause();\n      }, {once: true});\n\n      promise = onMediaLoad(video).then(async() => {\n        params.width = video.videoWidth;\n        params.height = video.videoHeight;\n        params.duration = Math.floor(video.duration);\n\n        const audioDecodedByteCount = (video as any).webkitAudioDecodedByteCount;\n        if(audioDecodedByteCount !== undefined) {\n          params.noSound = !audioDecodedByteCount;\n        }\n\n        itemDiv.append(video);\n        const thumb = await createPosterFromVideo(video);\n        params.thumb = {\n          url: await apiManagerProxy.invoke('createObjectURL', thumb.blob),\n          ...thumb\n        };\n      });\n\n      video.append(source);\n    } else {\n      const img = new Image();\n      promise = new Promise<void>((resolve) => {\n        img.onload = () => {\n          params.width = img.naturalWidth;\n          params.height = img.naturalHeight;\n\n          itemDiv.append(img);\n\n          if(file.type === 'image/gif') {\n            params.noSound = true;\n\n            Promise.all([\n              getGifDuration(img).then((duration) => {\n                params.duration = Math.ceil(duration);\n              }),\n\n              createPosterFromMedia(img).then(async(thumb) => {\n                params.thumb = {\n                  url: await apiManagerProxy.invoke('createObjectURL', thumb.blob),\n                  ...thumb\n                };\n              })\n            ]).then(() => {\n              resolve();\n            });\n          } else {\n            resolve();\n          }\n        };\n      });\n\n      img.src = params.objectURL = await apiManagerProxy.invoke('createObjectURL', file);\n    }\n\n    return promise;\n  }\n\n  private async attachDocument(params: SendFileParams, itemDiv: HTMLElement): ReturnType<PopupNewMedia['attachMedia']> {\n    itemDiv.classList.add('popup-item-document');\n    const file = params.file;\n\n    const isPhoto = file.type.startsWith('image/');\n    const isAudio = file.type.startsWith('audio/');\n    if(isPhoto || isAudio || file.size < 20e6) {\n      params.objectURL = await apiManagerProxy.invoke('createObjectURL', file);\n    }\n\n    const doc = {\n      _: 'document',\n      file: file,\n      file_name: file.name || '',\n      size: file.size,\n      type: isPhoto ? 'photo' : 'doc'\n    } as MyDocument;\n\n    let cacheContext: ThumbCache;\n    if(params.objectURL) {\n      cacheContext = {\n        url: params.objectURL,\n        downloaded: file.size,\n        type: THUMB_TYPE_FULL\n      };\n    }\n\n    const docDiv = await wrapDocument({\n      message: {\n        _: 'message',\n        pFlags: {\n          is_outgoing: true\n        },\n        mid: 0,\n        peerId: 0,\n        media: {\n          _: 'messageMediaDocument',\n          document: doc\n        }\n      } as any,\n      cacheContext\n    });\n\n    const promise = new Promise<void>((resolve) => {\n      const finish = () => {\n        itemDiv.append(docDiv);\n        resolve();\n      };\n\n      if(isPhoto) {\n        const img = new Image();\n        img.src = params.objectURL;\n        img.onload = () => {\n          params.width = img.naturalWidth;\n          params.height = img.naturalHeight;\n\n          finish();\n        };\n\n        img.onerror = finish;\n      } else {\n        finish();\n      }\n    });\n\n    return promise;\n  }\n\n  private attachFile = (file: File) => {\n    const willAttach = this.willAttach;\n    const shouldCompress = this.shouldCompress(file.type);\n\n    const params: SendFileParams = {};\n    params.file = file;\n\n    const itemDiv = document.createElement('div');\n    itemDiv.classList.add('popup-item');\n\n    params.itemDiv = itemDiv;\n\n    const promise = shouldCompress ? this.attachMedia(params, itemDiv) : this.attachDocument(params, itemDiv);\n    willAttach.sendFileDetails.push(params);\n    return promise;\n  };\n\n  private shouldCompress(mimeType: string) {\n    return this.willAttach.type === 'media' && MEDIA_MIME_TYPES_SUPPORTED.has(mimeType);\n  }\n\n  private onRender() {\n    // show now\n    if(!this.element.classList.contains('active')) {\n      this.listenerSetter.add(document.body)('keydown', this.onKeyDown);\n      this.addEventListener('close', () => {\n        if(this.wasInputValue) {\n          this.chat.input.messageInputField.value = this.wasInputValue;\n        }\n      });\n      this.show();\n    }\n  }\n\n  private setTitle() {\n    const {willAttach, title, files} = this;\n    let key: LangPackKey;\n    const args: FormatterArguments = [];\n    if(willAttach.type === 'document') {\n      key = 'PreviewSender.SendFile';\n      args.push(files.length);\n    } else {\n      let foundPhotos = 0, foundVideos = 0, foundFiles = 0;\n      files.forEach((file) => {\n        if(file.type.startsWith('image/')) ++foundPhotos;\n        else if(file.type.startsWith('video/')) ++foundVideos;\n        else ++foundFiles;\n      });\n\n      if([foundPhotos, foundVideos, foundFiles].filter((n) => n > 0).length > 1) {\n        key = 'PreviewSender.SendFile';\n        args.push(files.length);\n      } else\n\n      /* const sum = foundPhotos + foundVideos;\n      if(sum > 1 && willAttach.group) {\n        key = 'PreviewSender.SendAlbum';\n        const albumsLength = Math.ceil(sum / 10);\n        args.push(albumsLength);\n      } else  */if(foundPhotos) {\n        key = 'PreviewSender.SendPhoto';\n        args.push(foundPhotos);\n      } else if(foundVideos) {\n        key = 'PreviewSender.SendVideo';\n        args.push(foundVideos);\n      }\n    }\n\n    replaceContent(title, i18n(key, args));\n  }\n\n  private appendMediaToContainer(div: HTMLElement, params: SendFileParams) {\n    if(this.shouldCompress(params.file.type)) {\n      const size = calcImageInBox(params.width, params.height, 380, 320);\n      div.style.width = size.width + 'px';\n      div.style.height = size.height + 'px';\n    }\n\n    this.mediaContainer.append(div);\n  }\n\n  private iterate(cb: (sendFileDetails: SendFileParams[]) => void) {\n    const {sendFileDetails} = this.willAttach;\n    if(!this.willAttach.group) {\n      sendFileDetails.forEach((p) => cb([p]));\n      return;\n    }\n\n    const length = sendFileDetails.length;\n    for(let i = 0; i < length;) {\n      const firstType = sendFileDetails[i].file.type;\n      let k = 0;\n      for(; k < 10 && i < length; ++i, ++k) {\n        const type = sendFileDetails[i].file.type;\n        if(this.shouldCompress(firstType) !== this.shouldCompress(type)) {\n          break;\n        }\n      }\n\n      cb(sendFileDetails.slice(i - k, i));\n    }\n  }\n\n  private attachFiles() {\n    const {files, willAttach, mediaContainer} = this;\n    willAttach.sendFileDetails.length = 0;\n\n    this.appendGroupCheckboxField();\n    this.appendMediaCheckboxField();\n\n    Promise.all(files.map(this.attachFile)).then(() => {\n      mediaContainer.innerHTML = '';\n\n      if(!files.length) {\n        return;\n      }\n\n      this.setTitle();\n\n      this.iterate((sendFileDetails) => {\n        if(this.shouldCompress(sendFileDetails[0].file.type) && sendFileDetails.length > 1) {\n          const albumContainer = document.createElement('div');\n          albumContainer.classList.add('popup-item-album', 'popup-item');\n          albumContainer.append(...sendFileDetails.map((s) => s.itemDiv));\n\n          prepareAlbum({\n            container: albumContainer,\n            items: sendFileDetails.map((o) => ({w: o.width, h: o.height})),\n            maxWidth: 380,\n            minWidth: 100,\n            spacing: 4\n          });\n\n          mediaContainer.append(albumContainer);\n        } else {\n          sendFileDetails.forEach((params) => {\n            this.appendMediaToContainer(params.itemDiv, params);\n          });\n        }\n      });\n    }).then(() => {\n      this.onRender();\n    });\n  }\n}\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport fastSmoothScroll from '../fastSmoothScroll';\r\nimport cancelEvent from './cancelEvent';\r\nimport {attachClickEvent, detachClickEvent} from './clickEvent';\r\nimport findUpAsChild from './findUpAsChild';\r\nimport findUpClassName from './findUpClassName';\r\n\r\ntype ArrowKey = 'ArrowUp' | 'ArrowDown' | 'ArrowLeft' | 'ArrowRight';\r\nconst HANDLE_EVENT = 'keydown';\r\nconst ACTIVE_CLASS_NAME = 'active';\r\n\r\nconst AXIS_Y_KEYS: ArrowKey[] = ['ArrowUp', 'ArrowDown'];\r\nconst AXIS_X_KEYS: ArrowKey[] = ['ArrowLeft', 'ArrowRight'];\r\n\r\nexport type ListNavigationOptions = {\r\n  list: HTMLElement,\r\n  type: 'xy' | 'x' | 'y',\r\n  onSelect: (target: Element) => void | boolean | Promise<boolean>,\r\n  once: boolean,\r\n  waitForKey?: string[]\r\n};\r\n\r\nexport default function attachListNavigation({list, type, onSelect, once, waitForKey}: ListNavigationOptions) {\r\n  let waitForKeySet = waitForKey?.length ? new Set(waitForKey) : undefined;\r\n  const keyNames = new Set(type === 'xy' ? AXIS_Y_KEYS.concat(AXIS_X_KEYS) : (type === 'x' ? AXIS_X_KEYS : AXIS_Y_KEYS));\r\n\r\n  let target: Element;\r\n  const getCurrentTarget = () => {\r\n    return target || list.querySelector('.' + ACTIVE_CLASS_NAME) || list.firstElementChild;\r\n  };\r\n\r\n  const setCurrentTarget = (_target: Element, scrollTo: boolean) => {\r\n    if(target === _target) {\r\n      return;\r\n    }\r\n\r\n    let hadTarget = false;\r\n    if(target) {\r\n      hadTarget = true;\r\n      target.classList.remove(ACTIVE_CLASS_NAME);\r\n    }\r\n\r\n    target = _target;\r\n    if(!target) return;\r\n    target.classList.add(ACTIVE_CLASS_NAME);\r\n\r\n    if(hadTarget && scrollable && scrollTo) {\r\n      fastSmoothScroll({\r\n        container: scrollable,\r\n        element: target as HTMLElement,\r\n        position: 'center',\r\n        forceDuration: 100,\r\n        axis: type === 'x' ? 'x' : 'y'\r\n      });\r\n    }\r\n  };\r\n\r\n  const getNextTargetX = (currentTarget: Element, isNext: boolean) => {\r\n    let nextTarget: Element;\r\n    if(isNext) nextTarget = currentTarget.nextElementSibling || list.firstElementChild;\r\n    else nextTarget = currentTarget.previousElementSibling || list.lastElementChild;\r\n\r\n    return nextTarget;\r\n  };\r\n\r\n  const getNextTargetY = (currentTarget: Element, isNext: boolean) => {\r\n    const property = isNext ? 'nextElementSibling' : 'previousElementSibling';\r\n    const endProperty = isNext ? 'firstElementChild' : 'lastElementChild';\r\n    const currentRect = currentTarget.getBoundingClientRect();\r\n\r\n    let nextTarget = currentTarget[property] || list[endProperty];\r\n    while(nextTarget !== currentTarget) {\r\n      const targetRect = nextTarget.getBoundingClientRect();\r\n      if(targetRect.x === currentRect.x && targetRect.y !== currentRect.y) {\r\n        break;\r\n      }\r\n\r\n      nextTarget = nextTarget[property] || list[endProperty];\r\n    }\r\n\r\n    return nextTarget;\r\n  };\r\n\r\n  let handleArrowKey: (currentTarget: Element, key: ArrowKey) => Element;\r\n  if(type === 'xy') { // flex-direction: row; flex-wrap: wrap;\r\n    handleArrowKey = (currentTarget, key) => {\r\n      if(key === 'ArrowUp' || key === 'ArrowDown') return getNextTargetY(currentTarget, key === 'ArrowDown');\r\n      else return getNextTargetX(currentTarget, key === 'ArrowRight');\r\n    };\r\n  } else { // flex-direction: row | column;\r\n    handleArrowKey = (currentTarget, key) => getNextTargetX(currentTarget, key === 'ArrowRight' || key === 'ArrowDown');\r\n  }\r\n\r\n  let onKeyDown = (e: KeyboardEvent) => {\r\n    const key = e.key;\r\n    if(!keyNames.has(key as any)) {\r\n      if(key === 'Enter' || (type !== 'xy' && key === 'Tab')) {\r\n        cancelEvent(e);\r\n        fireSelect(getCurrentTarget());\r\n      }\r\n\r\n      return;\r\n    }\r\n\r\n    cancelEvent(e);\r\n\r\n    if(list.childElementCount > 1) {\r\n      let currentTarget = getCurrentTarget();\r\n      currentTarget = handleArrowKey(currentTarget, key as any);\r\n      setCurrentTarget(currentTarget, true);\r\n    }\r\n  };\r\n\r\n  const scrollable = findUpClassName(list, 'scrollable');\r\n  list.classList.add('navigable-list');\r\n\r\n  const onMouseMove = (e: MouseEvent) => {\r\n    const target = findUpAsChild(e.target as HTMLElement, list) as HTMLElement;\r\n    if(!target) {\r\n      return;\r\n    }\r\n\r\n    setCurrentTarget(target, false);\r\n  };\r\n\r\n  const onClick = (e: Event) => {\r\n    cancelEvent(e); // cancel keyboard closening\r\n\r\n    const target = findUpAsChild(e.target as HTMLElement, list) as HTMLElement;\r\n    if(!target) {\r\n      return;\r\n    }\r\n\r\n    setCurrentTarget(target, false);\r\n    fireSelect(getCurrentTarget());\r\n  };\r\n\r\n  const fireSelect = async(target: Element) => {\r\n    const canContinue = await onSelect(target);\r\n    if(canContinue !== undefined ? !canContinue : once) {\r\n      detach();\r\n    }\r\n  };\r\n\r\n  let attached = false;\r\n  const attach = () => {\r\n    if(attached) return;\r\n    attached = true;\r\n    // const input = document.activeElement as HTMLElement;\r\n    // input.addEventListener(HANDLE_EVENT, onKeyDown, {capture: true, passive: false});\r\n    document.addEventListener(HANDLE_EVENT, onKeyDown, {capture: true, passive: false});\r\n    list.addEventListener('mousemove', onMouseMove, {passive: true});\r\n    attachClickEvent(list, onClick);\r\n  };\r\n\r\n  const detach = () => {\r\n    if(!attached) return;\r\n    attached = false;\r\n    // input.removeEventListener(HANDLE_EVENT, onKeyDown, {capture: true});\r\n    document.removeEventListener(HANDLE_EVENT, onKeyDown, {capture: true});\r\n    list.removeEventListener('mousemove', onMouseMove);\r\n    detachClickEvent(list, onClick);\r\n  };\r\n\r\n  const resetTarget = () => {\r\n    if(waitForKeySet) return;\r\n    setCurrentTarget(list.firstElementChild, false);\r\n  };\r\n\r\n  if(waitForKeySet) {\r\n    const _onKeyDown = onKeyDown;\r\n    onKeyDown = (e) => {\r\n      if(waitForKeySet.has(e.key)) {\r\n        cancelEvent(e);\r\n\r\n        document.removeEventListener(HANDLE_EVENT, onKeyDown, {capture: true});\r\n        onKeyDown = _onKeyDown;\r\n        document.addEventListener(HANDLE_EVENT, onKeyDown, {capture: true, passive: false});\r\n\r\n        waitForKeySet = undefined;\r\n        resetTarget();\r\n      }\r\n    };\r\n  } else {\r\n    resetTarget();\r\n  }\r\n\r\n  attach();\r\n\r\n  return {\r\n    attach,\r\n    detach,\r\n    resetTarget\r\n  };\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport attachListNavigation, {ListNavigationOptions} from '../../helpers/dom/attachListNavigation';\r\nimport EventListenerBase from '../../helpers/eventListenerBase';\r\nimport {IS_MOBILE} from '../../environment/userAgent';\r\nimport rootScope from '../../lib/rootScope';\r\nimport appNavigationController, {NavigationItem} from '../appNavigationController';\r\nimport SetTransition from '../singleTransition';\r\nimport AutocompleteHelperController from './autocompleteHelperController';\r\nimport safeAssign from '../../helpers/object/safeAssign';\r\n\r\nexport default class AutocompleteHelper extends EventListenerBase<{\r\n  hidden: () => void,\r\n  visible: () => void,\r\n  hiding: () => void\r\n}> {\r\n  protected hidden = true;\r\n  protected container: HTMLElement;\r\n  protected list: HTMLElement;\r\n  protected resetTarget: () => void;\r\n  protected attach: () => void;\r\n  protected detach: () => void;\r\n  protected init?(): void;\r\n\r\n  protected controller: AutocompleteHelperController;\r\n  protected listType: 'xy' | 'x' | 'y';\r\n  protected onSelect: ListNavigationOptions['onSelect'];\r\n  protected waitForKey?: string[];\r\n\r\n  protected navigationItem: NavigationItem;\r\n\r\n  constructor(options: {\r\n    appendTo: HTMLElement,\r\n    controller?: AutocompleteHelper['controller'],\r\n    listType: AutocompleteHelper['listType'],\r\n    onSelect: AutocompleteHelper['onSelect'],\r\n    waitForKey?: AutocompleteHelper['waitForKey']\r\n  }) {\r\n    super(false);\r\n\r\n    safeAssign(this, options);\r\n\r\n    this.container = document.createElement('div');\r\n    this.container.classList.add('autocomplete-helper', 'z-depth-1');\r\n\r\n    options.appendTo.append(this.container);\r\n\r\n    this.attachNavigation();\r\n\r\n    this.controller && this.controller.addHelper(this);\r\n  }\r\n\r\n  public toggleListNavigation(enabled: boolean) {\r\n    if(enabled) {\r\n      this.attach && this.attach();\r\n    } else {\r\n      this.detach && this.detach();\r\n    }\r\n  }\r\n\r\n  protected onVisible = () => {\r\n    if(this.detach) { // it can be so because 'visible' calls before animation's end\r\n      this.detach();\r\n    }\r\n\r\n    const list = this.list;\r\n    const {attach, detach, resetTarget} = attachListNavigation({\r\n      list,\r\n      type: this.listType,\r\n      onSelect: this.onSelect,\r\n      once: true,\r\n      waitForKey: this.waitForKey\r\n    });\r\n\r\n    this.attach = attach;\r\n    this.detach = detach;\r\n    this.resetTarget = resetTarget;\r\n    if(!IS_MOBILE && !this.navigationItem) {\r\n      this.navigationItem = {\r\n        type: 'autocomplete-helper',\r\n        onPop: () => {\r\n          this.navigationItem = undefined;\r\n          this.toggle(true);\r\n        },\r\n        noBlurOnPop: true\r\n      };\r\n\r\n      appNavigationController.pushItem(this.navigationItem);\r\n    }\r\n\r\n    this.addEventListener('hidden', () => {\r\n      this.resetTarget = undefined;\r\n      this.attach = undefined;\r\n      this.detach = undefined;\r\n\r\n      list.innerHTML = '';\r\n      detach();\r\n\r\n      if(this.navigationItem) {\r\n        appNavigationController.removeItem(this.navigationItem);\r\n        this.navigationItem = undefined;\r\n      }\r\n    }, {once: true});\r\n  };\r\n\r\n  protected attachNavigation() {\r\n    this.addEventListener('visible', this.onVisible);\r\n  }\r\n\r\n  public toggle(hide?: boolean, fromController = false, skipAnimation?: boolean) {\r\n    if(this.init) {\r\n      return;\r\n    }\r\n\r\n    if(hide === undefined) {\r\n      hide = this.container.classList.contains('is-visible') && !this.container.classList.contains('backwards');\r\n    }\r\n\r\n    if(this.hidden === hide) {\r\n      if(!hide) {\r\n        this.dispatchEvent('visible'); // reset target and listener\r\n      }\r\n\r\n      return;\r\n    }\r\n\r\n    this.hidden = hide;\r\n\r\n    if(!hide) {\r\n      this.controller && this.controller.hideOtherHelpers(this);\r\n      this.dispatchEvent('visible'); // fire it before so target will be set\r\n    } else {\r\n      if(this.navigationItem) {\r\n        appNavigationController.removeItem(this.navigationItem);\r\n        this.navigationItem = undefined;\r\n      }\r\n\r\n      if(!fromController && this.controller) {\r\n        this.controller.hideOtherHelpers();\r\n      }\r\n\r\n      if(this.detach) { // force detach here\r\n        this.detach();\r\n      }\r\n    }\r\n\r\n    const useRafs = this.controller || hide ? 0 : 2;\r\n\r\n    if(hide) {\r\n      this.dispatchEvent('hiding');\r\n    }\r\n\r\n    SetTransition(\r\n      this.container,\r\n      'is-visible',\r\n      !hide,\r\n      rootScope.settings.animationsEnabled && !skipAnimation ? 300 : 0,\r\n      () => {\r\n        this.hidden && this.dispatchEvent('hidden');\r\n      },\r\n      useRafs\r\n    );\r\n  }\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport ListenerSetter from '../../helpers/listenerSetter';\r\nimport mediaSizes from '../../helpers/mediaSizes';\r\nimport preloadAnimatedEmojiSticker from '../../helpers/preloadAnimatedEmojiSticker';\r\nimport {MyDocument} from '../../lib/appManagers/appDocsManager';\r\nimport {CHAT_ANIMATION_GROUP} from '../../lib/appManagers/appImManager';\r\nimport {AppManagers} from '../../lib/appManagers/managers';\r\nimport rootScope from '../../lib/rootScope';\r\nimport {EmoticonsDropdown} from '../emoticonsDropdown';\r\nimport {SuperStickerRenderer} from '../emoticonsDropdown/tabs/stickers';\r\nimport LazyLoadQueue from '../lazyLoadQueue';\r\nimport Scrollable from '../scrollable';\r\nimport attachStickerViewerListeners from '../stickerViewer';\r\nimport AutocompleteHelper from './autocompleteHelper';\r\nimport AutocompleteHelperController from './autocompleteHelperController';\r\n\r\nexport default class StickersHelper extends AutocompleteHelper {\r\n  private scrollable: Scrollable;\r\n  private superStickerRenderer: SuperStickerRenderer;\r\n  private lazyLoadQueue: LazyLoadQueue;\r\n  private onChangeScreen: () => void;\r\n  private listenerSetter: ListenerSetter;\r\n\r\n  constructor(\r\n    appendTo: HTMLElement,\r\n    controller: AutocompleteHelperController,\r\n    private managers: AppManagers\r\n  ) {\r\n    super({\r\n      appendTo,\r\n      controller,\r\n      listType: 'xy',\r\n      onSelect: async(target) => {\r\n        return !(await EmoticonsDropdown.onMediaClick({target}, true));\r\n      },\r\n      waitForKey: ['ArrowUp', 'ArrowDown']\r\n    });\r\n\r\n    this.container.classList.add('stickers-helper');\r\n\r\n    this.addEventListener('visible', () => {\r\n      setTimeout(() => { // it is not rendered yet\r\n        this.scrollable.container.scrollTop = 0;\r\n      }, 0);\r\n\r\n      rootScope.dispatchEvent('choosing_sticker', true);\r\n    });\r\n\r\n    this.addEventListener('hidden', () => {\r\n      if(this.onChangeScreen) {\r\n        mediaSizes.removeEventListener('changeScreen', this.onChangeScreen);\r\n        this.onChangeScreen = undefined;\r\n\r\n        this.listenerSetter.removeAll();\r\n        this.listenerSetter = undefined;\r\n      }\r\n\r\n      rootScope.dispatchEvent('choosing_sticker', false);\r\n    });\r\n  }\r\n\r\n  public checkEmoticon(emoticon: string) {\r\n    const middleware = this.controller.getMiddleware();\r\n\r\n    if(this.lazyLoadQueue) {\r\n      this.lazyLoadQueue.clear();\r\n    }\r\n\r\n    preloadAnimatedEmojiSticker(emoticon);\r\n    this.managers.appStickersManager.getStickersByEmoticon(emoticon)\r\n    .then((stickers) => {\r\n      if(!middleware()) {\r\n        return;\r\n      }\r\n\r\n      if(this.init) {\r\n        this.init();\r\n        this.init = null;\r\n      }\r\n\r\n      const container = this.list.cloneNode() as HTMLElement;\r\n\r\n      let ready: Promise<void>;\r\n\r\n      this.lazyLoadQueue.clear();\r\n      if(stickers.length) {\r\n        ready = new Promise<void>((resolve) => {\r\n          const promises: Promise<any>[] = [];\r\n          stickers.forEach((sticker) => {\r\n            container.append(this.superStickerRenderer.renderSticker(sticker as MyDocument, undefined, promises));\r\n          });\r\n\r\n          (Promise.all(promises) as Promise<any>).finally(resolve);\r\n        });\r\n      } else {\r\n        ready = Promise.resolve();\r\n      }\r\n\r\n      ready.then(() => {\r\n        this.list.replaceWith(container);\r\n        this.list = container;\r\n\r\n        if(!this.onChangeScreen) {\r\n          this.onChangeScreen = () => {\r\n            const width = (this.list.childElementCount * mediaSizes.active.esgSticker.width) + (this.list.childElementCount - 1 * 1);\r\n            this.list.style.width = width + 'px';\r\n          };\r\n          mediaSizes.addEventListener('changeScreen', this.onChangeScreen);\r\n\r\n          this.listenerSetter = new ListenerSetter();\r\n          attachStickerViewerListeners({listenTo: this.container, listenerSetter: this.listenerSetter});\r\n        }\r\n\r\n        this.onChangeScreen();\r\n\r\n        this.toggle(!stickers.length);\r\n        this.scrollable.scrollTop = 0;\r\n      });\r\n    });\r\n  }\r\n\r\n  protected init() {\r\n    this.list = document.createElement('div');\r\n    this.list.classList.add('stickers-helper-stickers', 'super-stickers');\r\n\r\n    this.container.append(this.list);\r\n\r\n    this.scrollable = new Scrollable(this.container);\r\n    this.lazyLoadQueue = new LazyLoadQueue();\r\n    this.superStickerRenderer = new SuperStickerRenderer(this.lazyLoadQueue, CHAT_ANIMATION_GROUP, this.managers);\r\n  }\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport {attachClickEvent} from '../../helpers/dom/clickEvent';\r\nimport {SEND_WHEN_ONLINE_TIMESTAMP} from '../../lib/mtproto/constants';\r\nimport Button from '../button';\r\nimport PopupDatePicker from './datePicker';\r\n\r\nconst getMinDate = () => {\r\n  const date = new Date();\r\n  // date.setDate(date.getDate() - 1);\r\n  date.setHours(0, 0, 0, 0);\r\n  return date;\r\n};\r\n\r\nconst getMaxDate = () => {\r\n  const date = new Date();\r\n  date.setFullYear(date.getFullYear() + 1);\r\n  date.setDate(date.getDate() - 1);\r\n  return date;\r\n};\r\n\r\nconst checkDate = (date: Date) => {\r\n  return date.getTime() > getMaxDate().getTime() ? new Date() : date;\r\n};\r\n\r\nexport default class PopupSchedule extends PopupDatePicker {\r\n  constructor(initDate: Date, onPick: (timestamp: number) => void, canSendWhenOnline: boolean) {\r\n    super(checkDate(initDate), onPick, {\r\n      noButtons: true,\r\n      noTitle: true,\r\n      closable: true,\r\n      withConfirm: true,\r\n      minDate: getMinDate(),\r\n      maxDate: getMaxDate(),\r\n      withTime: true,\r\n      showOverflowMonths: true,\r\n      confirmShortcutIsSendShortcut: true,\r\n      title: true\r\n    });\r\n\r\n    this.element.classList.add('popup-schedule');\r\n    this.header.append(this.controlsDiv);\r\n    this.title.replaceWith(this.monthTitle);\r\n    this.body.append(this.btnConfirm);\r\n\r\n    if(canSendWhenOnline) {\r\n      const btnSendWhenOnline = Button('btn-primary btn-secondary btn-primary-transparent primary', {text: 'Schedule.SendWhenOnline'});\r\n      this.body.append(btnSendWhenOnline);\r\n\r\n      attachClickEvent(btnSendWhenOnline, () => {\r\n        onPick(SEND_WHEN_ONLINE_TIMESTAMP);\r\n        this.hide();\r\n      });\r\n    }\r\n  }\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n *\r\n * Originally from:\r\n * https://github.com/zhukov/webogram\r\n * Copyright (C) 2014 Igor Zhukov <igor.beatle@gmail.com>\r\n * https://github.com/zhukov/webogram/blob/master/LICENSE\r\n */\r\n\r\nimport {MessageEntity} from '../../layer';\r\nimport combineSameEntities from '../../lib/richTextProcessor/combineSameEntities';\r\nimport getRichElementValue from './getRichElementValue';\r\n\r\nexport default function getRichValueWithCaret(field: HTMLElement, withEntities = true) {\r\n  const lines: string[] = [];\r\n  const line: string[] = [];\r\n\r\n  const sel = window.getSelection();\r\n  let selNode: Node;\r\n  let selOffset: number;\r\n  if(sel && sel.rangeCount) {\r\n    const range = sel.getRangeAt(0);\r\n    const startOffset = range.startOffset;\r\n    if(\r\n      range.startContainer &&\r\n      range.startContainer == range.endContainer &&\r\n      startOffset == range.endOffset\r\n    ) {\r\n      // * if focused on img, or caret has been set via placeCaretAtEnd\r\n      const possibleChildrenFocusOffset = startOffset - 1;\r\n      const childNodes = field.childNodes;\r\n      if(range.startContainer === field && childNodes[possibleChildrenFocusOffset]) {\r\n        selNode = childNodes[possibleChildrenFocusOffset];\r\n        selOffset = 0;\r\n\r\n        for(let i = 0; i < range.endOffset; ++i) {\r\n          const node = childNodes[i];\r\n          const value = node.nodeValue || (node as HTMLImageElement).alt;\r\n\r\n          if(value) {\r\n            selOffset += value.length;\r\n          }\r\n        }\r\n      } else {\r\n        selNode = range.startContainer;\r\n        selOffset = startOffset;\r\n      }\r\n    }\r\n  }\r\n\r\n  const entities: MessageEntity[] = withEntities ? [] : undefined;\r\n  getRichElementValue(field, lines, line, selNode, selOffset, entities);\r\n\r\n  if(line.length) {\r\n    lines.push(line.join(''));\r\n  }\r\n\r\n  let value = lines.join('\\n');\r\n  const caretPos = value.indexOf('\\x01');\r\n  if(caretPos != -1) {\r\n    value = value.substr(0, caretPos) + value.substr(caretPos + 1);\r\n  }\r\n  value = value.replace(/\\u00A0/g, ' ');\r\n\r\n  if(entities) {\r\n    combineSameEntities(entities);\r\n  }\r\n\r\n  return {value, entities, caretPos};\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport type ChatInput from './input';\r\nimport {appendEmoji, getEmojiFromElement} from '../emoticonsDropdown/tabs/emoji';\r\nimport {ScrollableX} from '../scrollable';\r\nimport AutocompleteHelper from './autocompleteHelper';\r\nimport AutocompleteHelperController from './autocompleteHelperController';\r\nimport {AppManagers} from '../../lib/appManagers/managers';\r\n\r\nexport default class EmojiHelper extends AutocompleteHelper {\r\n  private scrollable: ScrollableX;\r\n\r\n  constructor(\r\n    appendTo: HTMLElement,\r\n    controller: AutocompleteHelperController,\r\n    chatInput: ChatInput,\r\n    private managers: AppManagers\r\n  ) {\r\n    super({\r\n      appendTo,\r\n      controller,\r\n      listType: 'x',\r\n      onSelect: (target) => {\r\n        chatInput.onEmojiSelected(getEmojiFromElement(target as any), true);\r\n      }\r\n    });\r\n\r\n    this.container.classList.add('emoji-helper');\r\n  }\r\n\r\n  protected init() {\r\n    this.list = document.createElement('div');\r\n    this.list.classList.add('emoji-helper-emojis', 'super-emojis');\r\n\r\n    this.container.append(this.list);\r\n\r\n    this.scrollable = new ScrollableX(this.container);\r\n\r\n    this.addEventListener('visible', () => {\r\n      setTimeout(() => { // it is not rendered yet\r\n        this.scrollable.container.scrollLeft = 0;\r\n      }, 0);\r\n    });\r\n  }\r\n\r\n  public render(emojis: string[], waitForKey: boolean) {\r\n    if(this.init) {\r\n      if(!emojis.length) {\r\n        return;\r\n      }\r\n\r\n      this.init();\r\n      this.init = null;\r\n    }\r\n\r\n    emojis = emojis.slice(0, 80);\r\n\r\n    if(emojis.length) {\r\n      this.list.innerHTML = '';\r\n      emojis.forEach((emoji) => {\r\n        appendEmoji(emoji, this.list, false, true);\r\n      });\r\n    }\r\n\r\n    this.waitForKey = waitForKey ? ['ArrowUp', 'ArrowDown'] : undefined;\r\n    this.toggle(!emojis.length);\r\n\r\n    /* window.requestAnimationFrame(() => {\r\n      this.container.style.width = (3 * 2) + (emojis.length * 44) + 'px';\r\n    }); */\r\n  }\r\n\r\n  public checkQuery(query: string, firstChar: string) {\r\n    const middleware = this.controller.getMiddleware();\r\n    this.managers.appEmojiManager.getBothEmojiKeywords().then(async() => {\r\n      if(!middleware()) {\r\n        return;\r\n      }\r\n\r\n      const q = query.replace(/^:/, '');\r\n      const emojis = await this.managers.appEmojiManager.searchEmojis(q);\r\n      if(!middleware()) {\r\n        return;\r\n      }\r\n\r\n      this.render(emojis, firstChar !== ':');\r\n      // console.log(emojis);\r\n    });\r\n  }\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport setInnerHTML from '../../helpers/dom/setInnerHTML';\r\nimport wrapEmojiText from '../../lib/richTextProcessor/wrapEmojiText';\r\nimport AvatarElement from '../avatar';\r\nimport PeerTitle from '../peerTitle';\r\nimport Scrollable from '../scrollable';\r\nimport AutocompleteHelper from './autocompleteHelper';\r\nimport AutocompleteHelperController from './autocompleteHelperController';\r\n\r\nexport default class AutocompletePeerHelper extends AutocompleteHelper {\r\n  protected static BASE_CLASS = 'autocomplete-peer-helper';\r\n  protected static BASE_CLASS_LIST_ELEMENT = AutocompletePeerHelper.BASE_CLASS + '-list-element';\r\n  private scrollable: Scrollable;\r\n\r\n  constructor(\r\n    appendTo: HTMLElement,\r\n    controller: AutocompleteHelperController,\r\n    protected className: string,\r\n    onSelect: (target: Element) => boolean | void\r\n  ) {\r\n    super({\r\n      appendTo,\r\n      controller,\r\n      listType: 'y',\r\n      onSelect\r\n    });\r\n\r\n    this.container.classList.add(AutocompletePeerHelper.BASE_CLASS, className);\r\n  }\r\n\r\n  protected init() {\r\n    this.list = document.createElement('div');\r\n    this.list.classList.add(AutocompletePeerHelper.BASE_CLASS + '-list', this.className + '-list');\r\n\r\n    this.container.append(this.list);\r\n\r\n    this.scrollable = new Scrollable(this.container);\r\n\r\n    this.addEventListener('visible', () => {\r\n      setTimeout(() => { // it is not rendered yet\r\n        this.scrollable.container.scrollTop = 0;\r\n      }, 0);\r\n    });\r\n  }\r\n\r\n  public render(data: {peerId: PeerId, name?: string, description?: string}[], doNotShow?: boolean) {\r\n    if(this.init) {\r\n      if(!data.length) {\r\n        return;\r\n      }\r\n\r\n      this.init();\r\n      this.init = null;\r\n    }\r\n\r\n    if(data.length) {\r\n      this.list.innerHTML = '';\r\n      data.forEach((d) => {\r\n        const div = AutocompletePeerHelper.listElement({\r\n          className: this.className,\r\n          peerId: d.peerId,\r\n          name: d.name,\r\n          description: d.description\r\n        });\r\n\r\n        this.list.append(div);\r\n      });\r\n    }\r\n\r\n    if(!doNotShow) {\r\n      this.toggle(!data.length);\r\n    }\r\n  }\r\n\r\n  public static listElement(options: {\r\n    className: string,\r\n    peerId: PeerId,\r\n    name?: string,\r\n    description?: string\r\n  }) {\r\n    const BASE = AutocompletePeerHelper.BASE_CLASS_LIST_ELEMENT;\r\n    options.className += '-list-element';\r\n\r\n    const div = document.createElement('div');\r\n    div.classList.add(BASE, options.className);\r\n    div.dataset.peerId = '' + options.peerId;\r\n\r\n    const avatar = new AvatarElement();\r\n    avatar.classList.add('avatar-30', BASE + '-avatar', options.className + '-avatar');\r\n    avatar.updateWithOptions({\r\n      isDialog: false,\r\n      peerId: options.peerId\r\n    });\r\n\r\n    const name = document.createElement('div');\r\n    name.classList.add(BASE + '-name', options.className + '-name');\r\n    if(!options.name) {\r\n      name.append(new PeerTitle({\r\n        peerId: options.peerId,\r\n        dialog: false,\r\n        onlyFirstName: false,\r\n        plainText: false\r\n      }).element);\r\n    } else {\r\n      setInnerHTML(name, wrapEmojiText(options.name));\r\n    }\r\n\r\n    div.append(avatar, name);\r\n\r\n    if(options.description) {\r\n      const description = document.createElement('div');\r\n      description.classList.add(BASE + '-description', options.className + '-description');\r\n      setInnerHTML(description, wrapEmojiText(options.description));\r\n      div.append(description);\r\n    }\r\n\r\n    return div;\r\n  }\r\n}\r\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport type ChatInput from './input';\nimport type {BotInfo, ChatFull, UserFull} from '../../layer';\nimport AutocompleteHelperController from './autocompleteHelperController';\nimport AutocompletePeerHelper from './autocompletePeerHelper';\nimport SearchIndex from '../../lib/searchIndex';\nimport {AppManagers} from '../../lib/appManagers/managers';\n\nexport function processPeerFullForCommands(peerId: PeerId, full: ChatFull.chatFull | ChatFull.channelFull | UserFull.userFull, query?: string) {\n  const botInfos: BotInfo.botInfo[] = [].concat(full.bot_info);\n  let index: SearchIndex<string>;\n\n  if(query !== undefined) {\n    index = new SearchIndex<string>({\n      ignoreCase: true\n    });\n  }\n\n  type T = {peerId: PeerId, name: string, description: string, index: number, command: string};\n  const commands: Map<string, T> = new Map();\n  botInfos.forEach((botInfo) => {\n    if(!botInfo.commands) {\n      return;\n    }\n\n    botInfo.commands.forEach(({command, description}, idx) => {\n      const c = '/' + command;\n      commands.set(command, {\n        peerId: botInfo.user_id ? botInfo.user_id.toPeerId(false) : peerId,\n        command: command,\n        name: c,\n        description: description,\n        index: idx\n      });\n\n      if(index) {\n        index.indexObject(command, c);\n      }\n    });\n  });\n\n  let out: T[];\n  if(!index) {\n    out = [...commands.values()];\n  } else {\n    const found = index.search(query);\n    out = Array.from(found).map((command) => commands.get(command));\n  }\n\n  out = out.sort((a, b) => commands.get(a.command).index - commands.get(b.command).index);\n\n  return out;\n}\n\nexport default class CommandsHelper extends AutocompletePeerHelper {\n  constructor(\n    appendTo: HTMLElement,\n    controller: AutocompleteHelperController,\n    chatInput: ChatInput,\n    private managers: AppManagers\n  ) {\n    super(appendTo,\n      controller,\n      'commands-helper',\n      (target) => {\n        const innerHTML = target.querySelector(`.${AutocompletePeerHelper.BASE_CLASS_LIST_ELEMENT}-name`).innerHTML;\n        return chatInput.getReadyToSend(() => {\n          chatInput.messageInput.innerHTML = innerHTML;\n          chatInput.sendMessage(true);\n        });\n      }\n    );\n  }\n\n  public async checkQuery(query: string, peerId: PeerId) {\n    if(!(await this.managers.appUsersManager.isBot(peerId))) {\n      return false;\n    }\n\n    const middleware = this.controller.getMiddleware();\n    this.managers.appProfileManager.getProfileByPeerId(peerId).then((full) => {\n      if(!middleware()) {\n        return;\n      }\n\n      const filtered = processPeerFullForCommands(peerId, full, query);\n      this.render(filtered);\n      // console.log('found commands', found, filtered);\n    });\n\n    return true;\n  }\n}\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport {getMiddleware} from '../../helpers/middleware';\r\nimport AutocompleteHelper from './autocompleteHelper';\r\n\r\nexport default class AutocompleteHelperController {\r\n  private helpers: Set<AutocompleteHelper> = new Set();\r\n  private middleware = getMiddleware();\r\n  /* private tempId = 0;\r\n\r\n  public incrementToggleCount() {\r\n    return ++this.tempId;\r\n  }\r\n\r\n  public getToggleCount() {\r\n    return this.tempId;\r\n  } */\r\n\r\n  public toggleListNavigation(enabled: boolean) {\r\n    for(const helper of this.helpers) {\r\n      helper.toggleListNavigation(enabled);\r\n    }\r\n  }\r\n\r\n  public getMiddleware() {\r\n    this.middleware.clean();\r\n    return this.middleware.get();\r\n  }\r\n\r\n  public addHelper(helper: AutocompleteHelper) {\r\n    this.helpers.add(helper);\r\n  }\r\n\r\n  public hideOtherHelpers(preserveHelper?: AutocompleteHelper) {\r\n    this.helpers.forEach((helper) => {\r\n      if(helper !== preserveHelper) {\r\n        helper.toggle(true, true);\r\n      }\r\n    });\r\n\r\n    if(!preserveHelper) {\r\n      this.middleware.clean();\r\n    }\r\n  }\r\n}\r\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport type ChatInput from './input';\nimport type {MessageEntity} from '../../layer';\nimport AutocompleteHelperController from './autocompleteHelperController';\nimport AutocompletePeerHelper from './autocompletePeerHelper';\nimport {AppManagers} from '../../lib/appManagers/managers';\n\nexport default class MentionsHelper extends AutocompletePeerHelper {\n  constructor(\n    appendTo: HTMLElement,\n    controller: AutocompleteHelperController,\n    chatInput: ChatInput,\n    private managers: AppManagers\n  ) {\n    super(\n      appendTo,\n      controller,\n      'mentions-helper',\n      (target) => {\n        const userId = (target as HTMLElement).dataset.peerId.toUserId();\n        const user = Promise.resolve(managers.appUsersManager.getUser(userId)).then((user) => {\n          let str = '', entity: MessageEntity;\n          if(user.username) {\n            str = '@' + user.username;\n          } else {\n            str = user.first_name || user.last_name;\n            entity = {\n              _: 'messageEntityMentionName',\n              length: str.length,\n              offset: 0,\n              user_id: user.id\n            };\n          }\n\n          str += ' ';\n          chatInput.insertAtCaret(str, entity);\n        });\n      }\n    );\n  }\n\n  public checkQuery(query: string, peerId: PeerId, topMsgId: number) {\n    const trimmed = query.trim(); // check that there is no whitespace\n    if(query.length !== trimmed.length) return false;\n\n    const middleware = this.controller.getMiddleware();\n    this.managers.appProfileManager.getMentions(peerId && peerId.toChatId(), trimmed, topMsgId).then(async(peerIds) => {\n      if(!middleware()) return;\n\n      const username = trimmed.slice(1).toLowerCase();\n\n      const p = peerIds.map(async(peerId) => {\n        const user = await this.managers.appUsersManager.getUser(peerId);\n        if(user.username && user.username.toLowerCase() === username) { // hide full matched suggestion\n          return;\n        }\n\n        return {\n          peerId,\n          description: user.username ? '@' + user.username : undefined\n        };\n      });\n\n      this.render((await Promise.all(p)).filter(Boolean));\n    });\n\n    return true;\n  }\n}\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport type ChatInput from './input';\r\nimport DropdownHover from '../../helpers/dropdownHover';\r\nimport {KeyboardButton, ReplyMarkup} from '../../layer';\r\nimport rootScope from '../../lib/rootScope';\r\nimport ListenerSetter, {Listener} from '../../helpers/listenerSetter';\r\nimport findUpClassName from '../../helpers/dom/findUpClassName';\r\nimport IS_TOUCH_SUPPORTED from '../../environment/touchSupport';\r\nimport findUpAsChild from '../../helpers/dom/findUpAsChild';\r\nimport cancelEvent from '../../helpers/dom/cancelEvent';\r\nimport {getHeavyAnimationPromise} from '../../hooks/useHeavyAnimationCheck';\r\nimport confirmationPopup from '../confirmationPopup';\r\nimport safeAssign from '../../helpers/object/safeAssign';\r\nimport setInnerHTML from '../../helpers/dom/setInnerHTML';\r\nimport wrapEmojiText from '../../lib/richTextProcessor/wrapEmojiText';\r\nimport {AppManagers} from '../../lib/appManagers/managers';\r\nimport {attachClickEvent} from '../../helpers/dom/clickEvent';\r\n\r\nexport default class ReplyKeyboard extends DropdownHover {\r\n  private static BASE_CLASS = 'reply-keyboard';\r\n  private appendTo: HTMLElement;\r\n  private listenerSetter: ListenerSetter;\r\n  private managers: AppManagers;\r\n  private btnHover: HTMLElement;\r\n  private peerId: PeerId;\r\n  private touchListener: Listener;\r\n  private chatInput: ChatInput;\r\n\r\n  constructor(options: {\r\n    listenerSetter: ListenerSetter,\r\n    managers: AppManagers,\r\n    appendTo: HTMLElement,\r\n    btnHover: HTMLElement,\r\n    chatInput: ChatInput\r\n  }) {\r\n    super({\r\n      element: document.createElement('div')\r\n    });\r\n\r\n    safeAssign(this, options);\r\n\r\n    this.element.classList.add(ReplyKeyboard.BASE_CLASS);\r\n    this.element.style.display = 'none';\r\n\r\n    this.attachButtonListener(this.btnHover, this.listenerSetter);\r\n    this.listenerSetter.add(rootScope)('history_reply_markup', async({peerId}) => {\r\n      if(this.peerId === peerId) {\r\n        if(this.checkAvailability() && this.isActive()) {\r\n          await this.render();\r\n        }\r\n\r\n        getHeavyAnimationPromise().then(() => {\r\n          this.checkForceReply();\r\n        });\r\n      }\r\n    });\r\n  }\r\n\r\n  protected init() {\r\n    this.appendTo.append(this.element);\r\n\r\n    this.listenerSetter.add(this)('open', async() => {\r\n      await this.render();\r\n\r\n      if(IS_TOUCH_SUPPORTED) {\r\n        this.touchListener = this.listenerSetter.add(document.body)('touchstart', this.onBodyTouchStart, {passive: false, capture: true}) as any as Listener;\r\n        this.listenerSetter.add(this)('close', () => {\r\n          this.listenerSetter.remove(this.touchListener);\r\n        }, {once: true});\r\n      }\r\n    });\r\n\r\n    attachClickEvent(this.element, (e) => {\r\n      const target = findUpClassName(e.target, 'btn');\r\n      if(!target) {\r\n        return;\r\n      }\r\n\r\n      const type = target.dataset.type as KeyboardButton['_'];\r\n      const {peerId} = this;\r\n      switch(type) {\r\n        case 'keyboardButtonRequestPhone': {\r\n          confirmationPopup({\r\n            titleLangKey: 'ShareYouPhoneNumberTitle',\r\n            button: {\r\n              langKey: 'OK'\r\n            },\r\n            descriptionLangKey: 'AreYouSureShareMyContactInfoBot'\r\n          }).then(() => {\r\n            this.managers.appMessagesManager.sendContact(peerId, rootScope.myId);\r\n          });\r\n          break;\r\n        }\r\n\r\n        default: {\r\n          this.managers.appMessagesManager.sendText(peerId, target.dataset.text);\r\n          break;\r\n        }\r\n      }\r\n\r\n      this.toggle(false);\r\n    }, {listenerSetter: this.listenerSetter});\r\n\r\n    return super.init();\r\n  }\r\n\r\n  private onBodyTouchStart = (e: TouchEvent) => {\r\n    const target = e.touches[0].target as HTMLElement;\r\n    if(!findUpAsChild(target, this.element) && target !== this.btnHover) {\r\n      cancelEvent(e);\r\n      this.toggle(false);\r\n    }\r\n  };\r\n\r\n  public async checkForceReply() {\r\n    const replyMarkup = await this.getReplyMarkup();\r\n    if(replyMarkup._ === 'replyKeyboardForceReply' &&\r\n      !replyMarkup.pFlags.hidden &&\r\n      !replyMarkup.pFlags.used) {\r\n      replyMarkup.pFlags.used = true;\r\n      this.chatInput.initMessageReply(replyMarkup.mid);\r\n    }\r\n  }\r\n\r\n  private async getReplyMarkup() {\r\n    return (await this.managers.appMessagesManager.getHistoryStorageTransferable(this.peerId)).replyMarkup ?? {\r\n      _: 'replyKeyboardHide'\r\n    };\r\n  }\r\n\r\n  public async render(replyMarkup?: ReplyMarkup.replyKeyboardMarkup) {\r\n    if(replyMarkup === undefined) {\r\n      replyMarkup = await this.getReplyMarkup() as any;\r\n    }\r\n\r\n    this.element.textContent = '';\r\n\r\n    for(const row of replyMarkup.rows) {\r\n      const div = document.createElement('div');\r\n      div.classList.add(ReplyKeyboard.BASE_CLASS + '-row');\r\n\r\n      for(const button of row.buttons) {\r\n        const btn = document.createElement('button');\r\n        btn.classList.add(ReplyKeyboard.BASE_CLASS + '-button', 'btn');\r\n        setInnerHTML(btn, wrapEmojiText(button.text));\r\n        btn.dataset.text = button.text;\r\n        btn.dataset.type = button._;\r\n        div.append(btn);\r\n      }\r\n\r\n      this.element.append(div);\r\n    }\r\n  }\r\n\r\n  public async checkAvailability(replyMarkup?: ReplyMarkup) {\r\n    if(replyMarkup === undefined) {\r\n      replyMarkup = await this.getReplyMarkup();\r\n    }\r\n\r\n    const hide = replyMarkup._ === 'replyKeyboardHide' || !(replyMarkup as ReplyMarkup.replyInlineMarkup).rows?.length;\r\n    this.btnHover.classList.toggle('hide', hide);\r\n\r\n    if(hide) {\r\n      this.toggle(false);\r\n    }\r\n\r\n    return !hide;\r\n  }\r\n\r\n  public setPeer(peerId: PeerId) {\r\n    this.peerId = peerId;\r\n\r\n    this.checkAvailability();\r\n    this.checkForceReply();\r\n  }\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport type Chat from './chat';\r\nimport debounce from '../../helpers/schedulers/debounce';\r\nimport {WebDocument} from '../../layer';\r\nimport {MyDocument} from '../../lib/appManagers/appDocsManager';\r\nimport LazyLoadQueue from '../lazyLoadQueue';\r\nimport Scrollable from '../scrollable';\r\nimport {wrapPhoto} from '../wrappers';\r\nimport AutocompleteHelper from './autocompleteHelper';\r\nimport AutocompleteHelperController from './autocompleteHelperController';\r\nimport Button from '../button';\r\nimport {attachClickEvent} from '../../helpers/dom/clickEvent';\r\nimport {MyPhoto} from '../../lib/appManagers/appPhotosManager';\r\nimport assumeType from '../../helpers/assumeType';\r\nimport GifsMasonry from '../gifsMasonry';\r\nimport {SuperStickerRenderer} from '../emoticonsDropdown/tabs/stickers';\r\nimport mediaSizes from '../../helpers/mediaSizes';\r\nimport readBlobAsDataURL from '../../helpers/blob/readBlobAsDataURL';\r\nimport setInnerHTML from '../../helpers/dom/setInnerHTML';\r\nimport renderMediaWithFadeIn from '../../helpers/dom/renderMediaWithFadeIn';\r\nimport {AppManagers} from '../../lib/appManagers/managers';\r\nimport wrapEmojiText from '../../lib/richTextProcessor/wrapEmojiText';\r\nimport wrapRichText from '../../lib/richTextProcessor/wrapRichText';\r\nimport generateQId from '../../lib/appManagers/utils/inlineBots/generateQId';\r\nimport appDownloadManager from '../../lib/appManagers/appDownloadManager';\r\nimport {AnimationItemGroup} from '../animationIntersector';\r\n\r\nconst ANIMATION_GROUP: AnimationItemGroup = 'INLINE-HELPER';\r\n// const GRID_ITEMS = 5;\r\n\r\nexport default class InlineHelper extends AutocompleteHelper {\r\n  private scrollable: Scrollable;\r\n  private lazyLoadQueue: LazyLoadQueue;\r\n  private gifsMasonry: GifsMasonry;\r\n  private superStickerRenderer: SuperStickerRenderer;\r\n  private onChangeScreen: () => void;\r\n  public checkQuery: (peerId: PeerId, username: string, query: string) => ReturnType<InlineHelper['_checkQuery']>;\r\n\r\n  constructor(\r\n    appendTo: HTMLElement,\r\n    controller: AutocompleteHelperController,\r\n    private chat: Chat,\r\n    private managers: AppManagers\r\n  ) {\r\n    super({\r\n      appendTo,\r\n      controller,\r\n      listType: 'xy',\r\n      waitForKey: ['ArrowUp', 'ArrowDown'],\r\n      onSelect: (target) => {\r\n        if(!target) return false; // can happen when there is only button\r\n        const {peerId, botId, queryId} = this.list.dataset;\r\n        return this.chat.input.getReadyToSend(() => {\r\n          const queryAndResultIds = generateQId(queryId, (target as HTMLElement).dataset.resultId);\r\n          this.managers.appInlineBotsManager.sendInlineResult(peerId.toPeerId(), botId, queryAndResultIds, {\r\n            ...this.chat.getMessageSendingParams(),\r\n            clearDraft: true\r\n          });\r\n\r\n          this.chat.input.onMessageSent(true, true);\r\n        });\r\n      }\r\n    });\r\n\r\n    this.container.classList.add('inline-helper');\r\n\r\n    this.addEventListener('visible', () => {\r\n      setTimeout(() => { // it is not rendered yet\r\n        this.scrollable.container.scrollTop = 0;\r\n      }, 0);\r\n    });\r\n\r\n    this.checkQuery = debounce(this._checkQuery, 200, true, true);\r\n\r\n    this.addEventListener('hidden', () => {\r\n      if(this.onChangeScreen) {\r\n        mediaSizes.removeEventListener('changeScreen', this.onChangeScreen);\r\n        this.onChangeScreen = undefined;\r\n      }\r\n    });\r\n  }\r\n\r\n  public _checkQuery = async(peerId: PeerId, username: string, query: string) => {\r\n    const middleware = this.controller.getMiddleware();\r\n\r\n    const peer = await this.managers.appUsersManager.resolveUsername(username);\r\n    if(!middleware()) {\r\n      throw 'PEER_CHANGED';\r\n    }\r\n\r\n    if(peer._ !== 'user') {\r\n      throw 'NOT_A_BOT';\r\n    }\r\n\r\n    const renderPromise = this.managers.appInlineBotsManager.getInlineResults(peerId, peer.id, query).then((botResults) => {\r\n      if(!middleware()) {\r\n        throw 'PEER_CHANGED';\r\n      }\r\n\r\n      if(this.init) {\r\n        this.init();\r\n        this.init = null;\r\n      }\r\n\r\n      const list = this.list.cloneNode() as HTMLElement;\r\n      list.dataset.peerId = '' + peerId;\r\n      list.dataset.botId = '' + peer.id;\r\n      list.dataset.queryId = '' + botResults.query_id;\r\n\r\n      const gifsMasonry = new GifsMasonry(null, ANIMATION_GROUP, this.scrollable, false);\r\n\r\n      this.lazyLoadQueue.clear();\r\n      this.superStickerRenderer.clear();\r\n\r\n      const loadPromises: Promise<any>[] = [];\r\n      const isGallery = !!botResults.pFlags.gallery;\r\n      // botResults.results.length = 3;\r\n      for(const item of botResults.results) {\r\n        const container = document.createElement('div');\r\n        container.classList.add('inline-helper-result');\r\n        container.dataset.resultId = item.id;\r\n\r\n        const preview = isGallery ? undefined : document.createElement('div');\r\n        if(preview) {\r\n          preview.classList.add('inline-helper-result-preview');\r\n\r\n          container.append(preview);\r\n        }\r\n\r\n        list.append(container);\r\n\r\n        if(!isGallery) {\r\n          preview.classList.add('empty');\r\n          setInnerHTML(preview, wrapEmojiText([...item.title.trim()][0]));\r\n\r\n          const title = document.createElement('div');\r\n          title.classList.add('inline-helper-result-title');\r\n          setInnerHTML(title, wrapEmojiText(item.title));\r\n\r\n          const description = document.createElement('div');\r\n          description.classList.add('inline-helper-result-description');\r\n          setInnerHTML(description, wrapRichText(item.description, {\r\n            noCommands: true,\r\n            noLinks: true\r\n          }));\r\n\r\n          container.append(title, description);\r\n\r\n          const separator = document.createElement('div');\r\n          separator.classList.add('inline-helper-separator');\r\n\r\n          list.append(separator);\r\n        } else {\r\n          container.classList.add('grid-item');\r\n        }\r\n\r\n        if(item._ === 'botInlineResult') {\r\n          if(item.thumb && item.thumb.mime_type.indexOf('image/') === 0) {\r\n            let mediaContainer: HTMLElement;\r\n            if(preview) {\r\n              mediaContainer = document.createElement('div');\r\n              preview.append(mediaContainer);\r\n            } else {\r\n              mediaContainer = container;\r\n            }\r\n\r\n            mediaContainer.classList.add('media-container');\r\n            isGallery && mediaContainer.classList.add('no-border-radius');\r\n\r\n            this.lazyLoadQueue.push({\r\n              div: container,\r\n              load: () => {\r\n                return appDownloadManager.download({\r\n                  dcId: 4,\r\n                  location: {\r\n                    _: 'inputWebFileLocation',\r\n                    access_hash: (item.thumb as WebDocument.webDocument).access_hash,\r\n                    url: item.thumb.url\r\n                  },\r\n                  size: item.thumb.size,\r\n                  mimeType: item.thumb.mime_type\r\n                }).then((blob) => {\r\n                  const image = new Image();\r\n                  image.classList.add('media-photo');\r\n                  readBlobAsDataURL(blob).then((dataURL) => {\r\n                    renderMediaWithFadeIn(mediaContainer, image, dataURL, true);\r\n                  });\r\n                });\r\n              }\r\n            });\r\n          }\r\n        } else {\r\n          const media = item.document as MyDocument || item.photo as MyPhoto;\r\n          if((['sticker', 'gif'] as MyDocument['type'][]).includes((media as MyDocument)?.type) && isGallery) {\r\n            assumeType<MyDocument>(media);\r\n\r\n            if(media.type === 'gif') {\r\n              gifsMasonry.add(media, container);\r\n            } else if(media.type === 'sticker') {\r\n              container.classList.add('super-sticker');\r\n              this.superStickerRenderer.renderSticker(media, container, loadPromises);\r\n              if(media.animated) {\r\n                this.superStickerRenderer.observeAnimated(container);\r\n              }\r\n            }\r\n          } else if(media) {\r\n            const size = isGallery ? 48 : undefined;\r\n            isGallery && container.classList.add('no-border-radius');\r\n            wrapPhoto({\r\n              photo: media,\r\n              container: isGallery ? container : preview,\r\n              boxWidth: size,\r\n              boxHeight: size,\r\n              middleware,\r\n              lazyLoadQueue: this.lazyLoadQueue,\r\n              loadPromises\r\n            });\r\n          }\r\n        }\r\n      }\r\n\r\n      return Promise.all(loadPromises).then(() => {\r\n        if(!middleware()) {\r\n          gifsMasonry.clear();\r\n          return;\r\n        }\r\n\r\n        list.classList.toggle('is-gallery', isGallery);\r\n        list.classList.toggle('super-stickers', isGallery);\r\n        this.container.classList.toggle('is-gallery', isGallery);\r\n\r\n        /* if(isGallery) {\r\n          list.style.gridTemplateColumns = `repeat(${Math.min(botResults.results.length, 4)}, 1fr)`;\r\n        }\r\n\r\n        this.container.style.setProperty('width', isGallery ? `${Math.min(botResults.results.length, 4) * 25}%` : '', 'important'); */\r\n\r\n        const parent = this.list.parentElement;\r\n        parent.textContent = '';\r\n        if(botResults.switch_pm) {\r\n          const btnSwitchToPM = Button('btn-primary btn-secondary btn-primary-transparent primary');\r\n          setInnerHTML(btnSwitchToPM, wrapEmojiText(botResults.switch_pm.text));\r\n          attachClickEvent(btnSwitchToPM, (e) => {\r\n            this.chat.appImManager.setInnerPeer({peerId});\r\n            this.managers.appInlineBotsManager.switchToPM(peerId, peer.id, botResults.switch_pm.start_param);\r\n          });\r\n          parent.append(btnSwitchToPM);\r\n        }\r\n        parent.append(this.list = list);\r\n\r\n        if(this.gifsMasonry) {\r\n          this.gifsMasonry.detach();\r\n        }\r\n        this.gifsMasonry = gifsMasonry;\r\n        gifsMasonry.attach();\r\n\r\n        if(!this.onChangeScreen) {\r\n          this.onChangeScreen = () => {\r\n            if(this.list.classList.contains('is-gallery')) {\r\n              const width = (this.list.childElementCount * mediaSizes.active.esgSticker.width) + (this.list.childElementCount - 1 * 1);\r\n              this.list.style.width = width + 'px';\r\n            } else {\r\n              this.list.style.width = '';\r\n            }\r\n          };\r\n          mediaSizes.addEventListener('changeScreen', this.onChangeScreen);\r\n        }\r\n\r\n        this.onChangeScreen();\r\n\r\n        this.toggle(!botResults.results.length && !botResults.switch_pm);\r\n        this.scrollable.scrollTop = 0;\r\n      });\r\n    });\r\n\r\n    return {user: peer, renderPromise};\r\n  };\r\n\r\n  protected init() {\r\n    this.list = document.createElement('div');\r\n    this.list.classList.add('inline-helper-results');\r\n\r\n    this.container.append(this.list);\r\n\r\n    this.scrollable = new Scrollable(this.container);\r\n    this.lazyLoadQueue = new LazyLoadQueue();\r\n    this.superStickerRenderer = new SuperStickerRenderer(this.lazyLoadQueue, ANIMATION_GROUP, this.managers);\r\n  }\r\n}\r\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport type ChatInput from './input';\nimport callbackify from '../../helpers/callbackify';\nimport AutocompletePeerHelper from './autocompletePeerHelper';\nimport {processPeerFullForCommands} from './commandsHelper';\nimport {AppManagers} from '../../lib/appManagers/managers';\n\nconst CLASS_NAME = 'bot-commands';\nexport default class ChatBotCommands extends AutocompletePeerHelper {\n  private userId: UserId;\n\n  constructor(\n    appendTo: HTMLElement,\n    chatInput: ChatInput,\n    private managers: AppManagers\n  ) {\n    super(appendTo, undefined, CLASS_NAME, (target) => {\n      const innerHTML = target.querySelector(`.${AutocompletePeerHelper.BASE_CLASS_LIST_ELEMENT}-name`).innerHTML;\n      return chatInput.getReadyToSend(() => {\n        chatInput.messageInput.innerHTML = innerHTML;\n        chatInput.sendMessage(true);\n        this.toggle(true);\n      });\n    });\n  }\n\n  public setUserId(userId: UserId, middleware: () => boolean) {\n    if(this.userId === userId && this.list?.childElementCount) {\n      this.toggle(false);\n      return;\n    }\n\n    this.userId = userId;\n    return callbackify(this.managers.appProfileManager.getProfile(userId), (full) => {\n      if(!middleware()) return;\n      const filtered = processPeerFullForCommands(userId.toPeerId(false), full);\n\n      const PADDING_TOP = 8;\n      // const PADDING_BOTTOM = 8;\n      const PADDING_BOTTOM = 24;\n      const height = filtered.length * 50 + PADDING_TOP + PADDING_BOTTOM;\n      this.container.style.setProperty('--height', height + 'px');\n\n      this.render(filtered);\n\n      // this.container.style.top =\n    });\n  }\n}\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport {AckedResult} from '../lib/mtproto/superMessagePort';\r\nimport {Modify} from '../types';\r\n\r\nexport default async function modifyAckedResult<T>(acked: AckedResult<T>): Promise<Modify<AckedResult<T>, {result: T | Promise<T>}>> {\r\n  return {\r\n    cached: acked.cached,\r\n    result: acked.cached ? await acked.result : acked.result\r\n  };\r\n}\r\n\r\nexport function modifyAckedPromise<T>(promise: Promise<AckedResult<T>>) {\r\n  return promise.then(modifyAckedResult);\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport indexOfAndSplice from '../../helpers/array/indexOfAndSplice';\r\nimport callbackify from '../../helpers/callbackify';\r\nimport ListenerSetter from '../../helpers/listenerSetter';\r\nimport {getMiddleware} from '../../helpers/middleware';\r\nimport {modifyAckedPromise} from '../../helpers/modifyAckedResult';\r\nimport {ChatFull} from '../../layer';\r\nimport {AppManagers} from '../../lib/appManagers/managers';\r\nimport getPeerId from '../../lib/appManagers/utils/peers/getPeerId';\r\nimport {i18n} from '../../lib/langPack';\r\nimport {AckedResult} from '../../lib/mtproto/superMessagePort';\r\nimport rootScope from '../../lib/rootScope';\r\nimport AvatarElement from '../avatar';\r\nimport ButtonMenu, {ButtonMenuItemOptions} from '../buttonMenu';\r\nimport ButtonMenuToggle from '../buttonMenuToggle';\r\nimport PeerTitle from '../peerTitle';\r\nimport SetTransition from '../singleTransition';\r\nimport getChatMembersString from '../wrappers/getChatMembersString';\r\n\r\nconst SEND_AS_ANIMATION_DURATION = 300;\r\n\r\nexport default class ChatSendAs {\r\n  private avatar: AvatarElement;\r\n  private container: HTMLElement;\r\n  private closeBtn: HTMLElement;\r\n  private btnMenu: HTMLElement;\r\n  private sendAsPeerIds: PeerId[];\r\n  private sendAsPeerId: PeerId;\r\n  private updatingPromise: ReturnType<ChatSendAs['updateManual']>;\r\n  private middleware: ReturnType<typeof getMiddleware>;\r\n  private listenerSetter: ListenerSetter;\r\n  private peerId: PeerId;\r\n  private addedListener: boolean;\r\n\r\n  constructor(\r\n    private managers: AppManagers,\r\n    private onReady: (container: HTMLElement, skipAnimation?: boolean) => void,\r\n    private onChange: (sendAsPeerId: PeerId) => void\r\n  ) {\r\n    this.middleware = getMiddleware();\r\n    this.listenerSetter = new ListenerSetter();\r\n    this.construct();\r\n  }\r\n\r\n  private construct() {\r\n    this.container = document.createElement('div');\r\n    this.container.classList.add('new-message-send-as-container');\r\n\r\n    this.closeBtn = document.createElement('div');\r\n    this.closeBtn.classList.add('new-message-send-as-close', 'new-message-send-as-avatar', 'tgico-close');\r\n\r\n    const sendAsButtons: ButtonMenuItemOptions[] = [{\r\n      text: 'SendMessageAsTitle',\r\n      onClick: undefined\r\n    }];\r\n\r\n    let previousAvatar: HTMLElement;\r\n    const onSendAsMenuToggle = (visible: boolean) => {\r\n      if(visible) {\r\n        previousAvatar = this.avatar;\r\n      }\r\n\r\n      const isChanged = this.avatar !== previousAvatar;\r\n      const useRafs = !visible && isChanged ? 2 : 0;\r\n\r\n      SetTransition(this.closeBtn, 'is-visible', visible, SEND_AS_ANIMATION_DURATION, undefined, useRafs);\r\n      if(!isChanged) {\r\n        SetTransition(previousAvatar, 'is-visible', !visible, SEND_AS_ANIMATION_DURATION, undefined, useRafs);\r\n      }\r\n    };\r\n\r\n    ButtonMenuToggle({\r\n      noRipple: true,\r\n      listenerSetter: this.listenerSetter,\r\n      container: this.container\r\n    }, 'top-right', sendAsButtons, () => {\r\n      onSendAsMenuToggle(true);\r\n    }, () => {\r\n      onSendAsMenuToggle(false);\r\n    });\r\n\r\n    sendAsButtons[0].element.classList.add('btn-menu-item-header');\r\n    this.btnMenu = this.container.firstElementChild as any;\r\n    this.btnMenu.classList.add('scrollable', 'scrollable-y');\r\n    this.container.append(this.closeBtn);\r\n  }\r\n\r\n  private async updateButtons(peerIds: PeerId[]) {\r\n    const promises: Promise<ButtonMenuItemOptions>[] = peerIds.map(async(sendAsPeerId, idx) => {\r\n      const textElement = document.createElement('div');\r\n\r\n      const subtitle = document.createElement('div');\r\n      subtitle.classList.add('btn-menu-item-subtitle');\r\n      if(sendAsPeerId.isUser()) {\r\n        subtitle.append(i18n('Chat.SendAs.PersonalAccount'));\r\n      } else if(sendAsPeerId === this.peerId) {\r\n        subtitle.append(i18n('VoiceChat.DiscussionGroup'));\r\n      } else {\r\n        subtitle.append(await getChatMembersString(sendAsPeerId.toChatId()));\r\n      }\r\n\r\n      textElement.append(\r\n        new PeerTitle({peerId: sendAsPeerId}).element,\r\n        subtitle\r\n      );\r\n\r\n      return {\r\n        onClick: idx ? async() => {\r\n          const currentPeerId = this.peerId;\r\n          this.changeSendAsPeerId(sendAsPeerId);\r\n\r\n          const middleware = this.middleware.get();\r\n          const executeButtonsUpdate = () => {\r\n            if(this.sendAsPeerId !== sendAsPeerId || !middleware()) return;\r\n            const peerIds = this.sendAsPeerIds.slice();\r\n            indexOfAndSplice(peerIds, sendAsPeerId);\r\n            peerIds.unshift(sendAsPeerId);\r\n            this.updateButtons(peerIds);\r\n          };\r\n\r\n          if(rootScope.settings.animationsEnabled) {\r\n            setTimeout(executeButtonsUpdate, 250);\r\n          } else {\r\n            executeButtonsUpdate();\r\n          }\r\n\r\n          // return;\r\n          this.managers.appMessagesManager.saveDefaultSendAs(currentPeerId, sendAsPeerId);\r\n        } : undefined,\r\n        textElement\r\n      };\r\n    });\r\n\r\n    const buttons = await Promise.all(promises);\r\n    const btnMenu = ButtonMenu(buttons/* , this.listenerSetter */);\r\n    buttons.forEach((button, idx) => {\r\n      const peerId = peerIds[idx];\r\n      const avatar = new AvatarElement();\r\n      avatar.classList.add('avatar-26', 'btn-menu-item-icon');\r\n      avatar.updateWithOptions({peerId});\r\n\r\n      if(!idx) {\r\n        avatar.classList.add('active');\r\n      }\r\n\r\n      button.element.prepend(avatar);\r\n    });\r\n\r\n    Array.from(this.btnMenu.children).slice(1).forEach((node) => node.remove());\r\n    this.btnMenu.append(...Array.from(btnMenu.children));\r\n  }\r\n\r\n  private async updateAvatar(sendAsPeerId: PeerId, skipAnimation?: boolean) {\r\n    const previousAvatar = this.avatar;\r\n    if(previousAvatar) {\r\n      if(previousAvatar.peerId === sendAsPeerId) {\r\n        return;\r\n      }\r\n    }\r\n\r\n    if(!previousAvatar) {\r\n      skipAnimation = true;\r\n    }\r\n\r\n    const useRafs = skipAnimation ? 0 : 2;\r\n    const duration = skipAnimation ? 0 : SEND_AS_ANIMATION_DURATION;\r\n    const avatar = this.avatar = new AvatarElement();\r\n    avatar.classList.add('new-message-send-as-avatar', 'avatar-30');\r\n    await avatar.updateWithOptions({\r\n      isDialog: false,\r\n      peerId: sendAsPeerId\r\n    });\r\n\r\n    SetTransition(avatar, 'is-visible', true, duration, undefined, useRafs);\r\n    if(previousAvatar) {\r\n      SetTransition(previousAvatar, 'is-visible', false, duration, () => {\r\n        previousAvatar.remove();\r\n      }, useRafs);\r\n    }\r\n\r\n    this.container.append(avatar);\r\n  }\r\n\r\n  private changeSendAsPeerId(sendAsPeerId: PeerId, skipAnimation?: boolean) {\r\n    this.sendAsPeerId = sendAsPeerId;\r\n    this.onChange(sendAsPeerId);\r\n    return this.updateAvatar(sendAsPeerId, skipAnimation);\r\n  }\r\n\r\n  private getDefaultSendAs(): Promise<AckedResult<PeerId>> {\r\n    // return rootScope.myId;\r\n    return this.managers.acknowledged.appProfileManager.getChannelFull(this.peerId.toChatId()).then((acked) => {\r\n      return {\r\n        cached: acked.cached,\r\n        result: acked.result.then((channelFull) => {\r\n          return channelFull.default_send_as ? getPeerId(channelFull.default_send_as) : undefined\r\n        })\r\n      };\r\n    });\r\n  }\r\n\r\n  public async updateManual(skipAnimation?: boolean): Promise<() => void> {\r\n    const peerId = this.peerId;\r\n    if(this.updatingPromise || !(await this.managers.appPeersManager.isChannel(peerId))) {\r\n      return;\r\n    }\r\n\r\n    const middleware = this.middleware.get(() => {\r\n      return !this.updatingPromise || this.updatingPromise === updatingPromise;\r\n    });\r\n\r\n    const {container} = this;\r\n    const chatId = peerId.toChatId();\r\n    const result = (await modifyAckedPromise(this.getDefaultSendAs())).result;\r\n    // const result = Promise.resolve(this.getDefaultSendAs());\r\n\r\n    const wasSkippingAnimation = skipAnimation;\r\n    if(result instanceof Promise) {\r\n      skipAnimation = undefined;\r\n    }\r\n\r\n    const auto = wasSkippingAnimation && !skipAnimation;\r\n\r\n    const updatingPromise = this.updatingPromise = callbackify(result, async(sendAsPeerId) => {\r\n      if(!middleware() || sendAsPeerId === undefined) return;\r\n\r\n      await this.changeSendAsPeerId(sendAsPeerId, skipAnimation);\r\n      if(!middleware()) return;\r\n\r\n      this.managers.appChatsManager.getSendAs(chatId).then((peers) => {\r\n        if(!middleware()) return;\r\n\r\n        const peerIds = peers.map((peer) => getPeerId(peer));\r\n        this.sendAsPeerIds = peerIds.slice();\r\n\r\n        indexOfAndSplice(peerIds, sendAsPeerId);\r\n        peerIds.unshift(sendAsPeerId);\r\n        this.updateButtons(peerIds);\r\n      });\r\n\r\n      const callback = () => {\r\n        this.onReady(container, skipAnimation);\r\n\r\n        if(!this.addedListener) {\r\n          this.listenerSetter.add(rootScope)('peer_full_update', (peerId) => {\r\n            if(this.peerId === peerId) {\r\n              this.update();\r\n            }\r\n          });\r\n\r\n          this.addedListener = true;\r\n        }\r\n      };\r\n\r\n      if(auto) {\r\n        callback();\r\n        return;\r\n      }\r\n\r\n      return callback;\r\n    });\r\n\r\n    updatingPromise.finally(() => {\r\n      if(this.updatingPromise === updatingPromise) {\r\n        this.updatingPromise = undefined;\r\n      }\r\n    });\r\n\r\n    if(!auto) {\r\n      return updatingPromise;\r\n    }\r\n  }\r\n\r\n  public update(skipAnimation?: boolean) {\r\n    return this.updateManual(skipAnimation).then((callback) => callback && callback());\r\n  }\r\n\r\n  public setPeerId(peerId?: PeerId) {\r\n    /* if(this.avatar) {\r\n      this.avatar.remove();\r\n      this.avatar = undefined;\r\n    } */\r\n\r\n    this.middleware.clean();\r\n    this.updatingPromise = undefined;\r\n    this.peerId = peerId;\r\n  }\r\n\r\n  public destroy() {\r\n    this.container.remove();\r\n    this.setPeerId();\r\n    this.listenerSetter.removeAll();\r\n  }\r\n}\r\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport {_i18n} from '../lib/langPack';\nimport InputField, {InputFieldOptions} from './inputField';\nimport SetTransition from './singleTransition';\n\nexport default class InputFieldAnimated extends InputField {\n  public inputFake: HTMLElement;\n\n  // public onLengthChange: (length: number, isOverflow: boolean) => void;\n  // protected wasInputFakeClientHeight: number;\n  // protected showScrollDebounced: () => void;\n\n  constructor(options?: InputFieldOptions) {\n    super(options);\n\n    this.input.addEventListener('input', () => {\n      this.inputFake.innerHTML = this.input.innerHTML;\n      this.onFakeInput();\n    });\n\n    if(options.placeholder) {\n      _i18n(this.inputFake, options.placeholder, undefined, 'placeholder');\n    }\n\n    this.input.classList.add('scrollable', 'scrollable-y');\n    // this.wasInputFakeClientHeight = 0;\n    // this.showScrollDebounced = debounce(() => this.input.classList.remove('no-scrollbar'), 150, false, true);\n    this.inputFake = document.createElement('div');\n    this.inputFake.setAttribute('contenteditable', 'true');\n    this.inputFake.className = this.input.className + ' input-field-input-fake';\n  }\n\n  public onFakeInput(setHeight = true) {\n    const {scrollHeight: newHeight/* , clientHeight */} = this.inputFake;\n    /* if(this.wasInputFakeClientHeight && this.wasInputFakeClientHeight !== clientHeight) {\n      this.input.classList.add('no-scrollbar'); // !         ,      reflow   overflow.\n      this.showScrollDebounced();\n    } */\n\n    const currentHeight = +this.input.style.height.replace('px', '');\n    if(currentHeight === newHeight) {\n      return;\n    }\n\n    const TRANSITION_DURATION_FACTOR = 50;\n    const transitionDuration = Math.round(\n      TRANSITION_DURATION_FACTOR * Math.log(Math.abs(newHeight - currentHeight))\n    );\n\n    // this.wasInputFakeClientHeight = clientHeight;\n    this.input.style.transitionDuration = `${transitionDuration}ms`;\n\n    if(setHeight) {\n      this.input.style.height = newHeight ? newHeight + 'px' : '';\n    }\n\n    const className = 'is-changing-height';\n    SetTransition(this.input, className, true, transitionDuration, () => {\n      this.input.classList.remove(className);\n    });\n  }\n\n  public setValueSilently(value: string, fromSet?: boolean) {\n    super.setValueSilently(value, fromSet);\n\n    this.inputFake.innerHTML = value;\n    if(!fromSet) {\n      this.onFakeInput();\n    }\n  }\n}\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport type {MyDocument} from '../../lib/appManagers/appDocsManager';\r\nimport type {AppImManager} from '../../lib/appManagers/appImManager';\r\nimport type {MyDraftMessage} from '../../lib/appManagers/appDraftsManager';\r\nimport type Chat from './chat';\r\nimport Recorder from '../../../public/recorder.min';\r\nimport IS_TOUCH_SUPPORTED from '../../environment/touchSupport';\r\n// import Recorder from '../opus-recorder/dist/recorder.min';\r\nimport opusDecodeController from '../../lib/opusDecodeController';\r\nimport ButtonMenu, {ButtonMenuItemOptions} from '../buttonMenu';\r\nimport emoticonsDropdown from '../emoticonsDropdown';\r\nimport PopupCreatePoll from '../popups/createPoll';\r\nimport PopupForward from '../popups/forward';\r\nimport PopupNewMedia from '../popups/newMedia';\r\nimport {toast, toastNew} from '../toast';\r\nimport {wrapReply} from '../wrappers';\r\nimport {MessageEntity, DraftMessage, WebPage, Message, UserFull} from '../../layer';\r\nimport StickersHelper from './stickersHelper';\r\nimport ButtonIcon from '../buttonIcon';\r\nimport ButtonMenuToggle from '../buttonMenuToggle';\r\nimport ListenerSetter, {Listener} from '../../helpers/listenerSetter';\r\nimport Button from '../button';\r\nimport PopupSchedule from '../popups/schedule';\r\nimport SendMenu from './sendContextMenu';\r\nimport rootScope from '../../lib/rootScope';\r\nimport PopupPinMessage from '../popups/unpinMessage';\r\nimport tsNow from '../../helpers/tsNow';\r\nimport appNavigationController, {NavigationItem} from '../appNavigationController';\r\nimport {IS_MOBILE, IS_MOBILE_SAFARI} from '../../environment/userAgent';\r\nimport I18n, {i18n, join, LangPackKey} from '../../lib/langPack';\r\nimport {generateTail} from './bubbles';\r\nimport findUpClassName from '../../helpers/dom/findUpClassName';\r\nimport ButtonCorner from '../buttonCorner';\r\nimport blurActiveElement from '../../helpers/dom/blurActiveElement';\r\nimport cancelEvent from '../../helpers/dom/cancelEvent';\r\nimport cancelSelection from '../../helpers/dom/cancelSelection';\r\nimport {attachClickEvent, simulateClickEvent} from '../../helpers/dom/clickEvent';\r\nimport getRichValue from '../../helpers/dom/getRichValue';\r\nimport isInputEmpty from '../../helpers/dom/isInputEmpty';\r\nimport isSendShortcutPressed from '../../helpers/dom/isSendShortcutPressed';\r\nimport placeCaretAtEnd from '../../helpers/dom/placeCaretAtEnd';\r\nimport {MarkdownType, markdownTags} from '../../helpers/dom/getRichElementValue';\r\nimport getRichValueWithCaret from '../../helpers/dom/getRichValueWithCaret';\r\nimport EmojiHelper from './emojiHelper';\r\nimport CommandsHelper from './commandsHelper';\r\nimport AutocompleteHelperController from './autocompleteHelperController';\r\nimport AutocompleteHelper from './autocompleteHelper';\r\nimport MentionsHelper from './mentionsHelper';\r\nimport fixSafariStickyInput from '../../helpers/dom/fixSafariStickyInput';\r\nimport ReplyKeyboard from './replyKeyboard';\r\nimport InlineHelper from './inlineHelper';\r\nimport debounce from '../../helpers/schedulers/debounce';\r\nimport noop from '../../helpers/noop';\r\nimport {putPreloader} from '../putPreloader';\r\nimport SetTransition from '../singleTransition';\r\nimport PeerTitle from '../peerTitle';\r\nimport {fastRaf} from '../../helpers/schedulers';\r\nimport PopupDeleteMessages from '../popups/deleteMessages';\r\nimport fixSafariStickyInputFocusing, {IS_STICKY_INPUT_BUGGED} from '../../helpers/dom/fixSafariStickyInputFocusing';\r\nimport PopupPeer from '../popups/peer';\r\nimport MEDIA_MIME_TYPES_SUPPORTED from '../../environment/mediaMimeTypesSupport';\r\nimport appMediaPlaybackController from '../appMediaPlaybackController';\r\nimport {BOT_START_PARAM, NULL_PEER_ID} from '../../lib/mtproto/mtproto_config';\r\nimport setCaretAt from '../../helpers/dom/setCaretAt';\r\nimport CheckboxField from '../checkboxField';\r\nimport DropdownHover from '../../helpers/dropdownHover';\r\nimport RadioForm from '../radioForm';\r\nimport findUpTag from '../../helpers/dom/findUpTag';\r\nimport toggleDisability from '../../helpers/dom/toggleDisability';\r\nimport callbackify from '../../helpers/callbackify';\r\nimport ChatBotCommands from './botCommands';\r\nimport copy from '../../helpers/object/copy';\r\nimport toHHMMSS from '../../helpers/string/toHHMMSS';\r\nimport documentFragmentToHTML from '../../helpers/dom/documentFragmentToHTML';\r\nimport PopupElement from '../popups';\r\nimport getEmojiEntityFromEmoji from '../../lib/richTextProcessor/getEmojiEntityFromEmoji';\r\nimport mergeEntities from '../../lib/richTextProcessor/mergeEntities';\r\nimport parseEntities from '../../lib/richTextProcessor/parseEntities';\r\nimport parseMarkdown from '../../lib/richTextProcessor/parseMarkdown';\r\nimport wrapDraftText from '../../lib/richTextProcessor/wrapDraftText';\r\nimport wrapDraft from '../wrappers/draft';\r\nimport wrapMessageForReply from '../wrappers/messageForReply';\r\nimport getServerMessageId from '../../lib/appManagers/utils/messageId/getServerMessageId';\r\nimport {AppManagers} from '../../lib/appManagers/managers';\r\nimport contextMenuController from '../../helpers/contextMenuController';\r\nimport {emojiFromCodePoints} from '../../vendor/emoji';\r\nimport {modifyAckedPromise} from '../../helpers/modifyAckedResult';\r\nimport ChatSendAs from './sendAs';\r\nimport filterAsync from '../../helpers/array/filterAsync';\r\nimport InputFieldAnimated from '../inputFieldAnimated';\r\nimport getStickerEffectThumb from '../../lib/appManagers/utils/stickers/getStickerEffectThumb';\r\nimport PopupStickers from '../popups/stickers';\r\nimport wrapPeerTitle from '../wrappers/peerTitle';\r\n\r\nconst RECORD_MIN_TIME = 500;\r\nconst POSTING_MEDIA_NOT_ALLOWED = 'Posting media content isn\\'t allowed in this group.';\r\n\r\ntype ChatInputHelperType = 'edit' | 'webpage' | 'forward' | 'reply';\r\n\r\nexport default class ChatInput {\r\n  // private static AUTO_COMPLETE_REG_EXP = /(\\s|^)((?::|.)(?!.*[:@]).*|(?:[@\\/]\\S*))$/;\r\n  private static AUTO_COMPLETE_REG_EXP = /(\\s|^)((?:(?:@|^\\/)\\S*)|(?::|^[^:@\\/])(?!.*[:@\\/]).*)$/;\r\n  public messageInput: HTMLElement;\r\n  public messageInputField: InputFieldAnimated;\r\n  private fileInput: HTMLInputElement;\r\n  private inputMessageContainer: HTMLDivElement;\r\n  private btnSend: HTMLButtonElement;\r\n  private btnCancelRecord: HTMLButtonElement;\r\n  private lastUrl = '';\r\n  private lastTimeType = 0;\r\n\r\n  public chatInput: HTMLElement;\r\n  public inputContainer: HTMLElement;\r\n  public rowsWrapper: HTMLDivElement;\r\n  private newMessageWrapper: HTMLDivElement;\r\n  private btnToggleEmoticons: HTMLButtonElement;\r\n  private btnToggleReplyMarkup: HTMLButtonElement;\r\n  private btnSendContainer: HTMLDivElement;\r\n\r\n  private replyKeyboard: ReplyKeyboard;\r\n\r\n  private attachMenu: HTMLElement;\r\n  private attachMenuButtons: (ButtonMenuItemOptions & {verify: (peerId: PeerId, threadId: number) => boolean | Promise<boolean>})[];\r\n\r\n  private sendMenu: SendMenu;\r\n\r\n  private replyElements: {\r\n    container: HTMLElement,\r\n    cancelBtn: HTMLButtonElement,\r\n    iconBtn: HTMLButtonElement\r\n  } = {} as any;\r\n\r\n  private forwardElements: {\r\n    changePeer: ButtonMenuItemOptions,\r\n    showSender: ButtonMenuItemOptions,\r\n    hideSender: ButtonMenuItemOptions,\r\n    showCaption: ButtonMenuItemOptions,\r\n    hideCaption: ButtonMenuItemOptions,\r\n    container: HTMLElement,\r\n    modifyArgs?: ButtonMenuItemOptions[]\r\n  };\r\n  private forwardHover: DropdownHover;\r\n  private forwardWasDroppingAuthor: boolean;\r\n\r\n  private getWebPagePromise: Promise<void>;\r\n  private willSendWebPage: WebPage = null;\r\n  private forwarding: {[fromPeerId: PeerId]: number[]};\r\n  public replyToMsgId: number;\r\n  public editMsgId: number;\r\n  public editMessage: Message.message;\r\n  private noWebPage: true;\r\n  public scheduleDate: number;\r\n  public sendSilent: true;\r\n  public startParam: string;\r\n\r\n  private recorder: any;\r\n  public recording = false;\r\n  private recordCanceled = false;\r\n  private recordTimeEl: HTMLElement;\r\n  private recordRippleEl: HTMLElement;\r\n  private recordStartTime = 0;\r\n  private recordingOverlayListener: Listener;\r\n  private recordingNavigationItem: NavigationItem;\r\n\r\n  // private scrollTop = 0;\r\n  // private scrollOffsetTop = 0;\r\n  // private scrollDiff = 0;\r\n\r\n  public helperType: Exclude<ChatInputHelperType, 'webpage'>;\r\n  private helperFunc: () => void | Promise<void>;\r\n  private helperWaitingForward: boolean;\r\n\r\n  public willAttachType: 'document' | 'media';\r\n\r\n  private lockRedo = false;\r\n  private canRedoFromHTML = '';\r\n  private readonly undoHistory: string[] = [];\r\n  private readonly executedHistory: string[] = [];\r\n  private canUndoFromHTML = '';\r\n\r\n  private autocompleteHelperController: AutocompleteHelperController;\r\n  private stickersHelper: StickersHelper;\r\n  private emojiHelper: EmojiHelper;\r\n  private commandsHelper: CommandsHelper;\r\n  private mentionsHelper: MentionsHelper;\r\n  private inlineHelper: InlineHelper;\r\n  private listenerSetter: ListenerSetter;\r\n\r\n  private pinnedControlBtn: HTMLButtonElement;\r\n\r\n  private goDownBtn: HTMLButtonElement;\r\n  private goDownUnreadBadge: HTMLElement;\r\n  private goMentionBtn: HTMLButtonElement;\r\n  private goMentionUnreadBadge: HTMLSpanElement;\r\n  private btnScheduled: HTMLButtonElement;\r\n\r\n  private btnPreloader: HTMLButtonElement;\r\n\r\n  private saveDraftDebounced: () => void;\r\n\r\n  private fakeRowsWrapper: HTMLDivElement;\r\n\r\n  private previousQuery: string;\r\n\r\n  private releaseMediaPlayback: () => void;\r\n\r\n  private botStartBtn: HTMLButtonElement;\r\n  private rowsWrapperWrapper: HTMLDivElement;\r\n  private controlContainer: HTMLElement;\r\n  private fakeSelectionWrapper: HTMLDivElement;\r\n\r\n  private fakeWrapperTo: HTMLElement;\r\n  private toggleBotStartBtnDisability: () => void;\r\n\r\n  private botCommandsToggle: HTMLElement;\r\n  private botCommands: ChatBotCommands;\r\n  private botCommandsIcon: HTMLDivElement;\r\n  private hasBotCommands: boolean;\r\n\r\n  // private activeContainer: HTMLElement;\r\n\r\n  private sendAs: ChatSendAs;\r\n  public sendAsPeerId: PeerId;\r\n\r\n  constructor(\r\n    private chat: Chat,\r\n    private appImManager: AppImManager,\r\n    private managers: AppManagers\r\n  ) {\r\n    this.listenerSetter = new ListenerSetter();\r\n  }\r\n\r\n  public construct() {\r\n    this.chatInput = document.createElement('div');\r\n    this.chatInput.classList.add('chat-input', 'hide');\r\n\r\n    this.inputContainer = document.createElement('div');\r\n    this.inputContainer.classList.add('chat-input-container');\r\n\r\n    this.rowsWrapperWrapper = document.createElement('div');\r\n    this.rowsWrapperWrapper.classList.add('rows-wrapper-wrapper');\r\n\r\n    this.rowsWrapper = document.createElement('div');\r\n    this.rowsWrapper.classList.add('rows-wrapper', 'chat-input-wrapper');\r\n\r\n    this.rowsWrapperWrapper.append(this.rowsWrapper);\r\n\r\n    const tail = generateTail();\r\n    this.rowsWrapper.append(tail);\r\n\r\n    const fakeRowsWrapper = this.fakeRowsWrapper = document.createElement('div');\r\n    fakeRowsWrapper.classList.add('fake-wrapper', 'fake-rows-wrapper');\r\n\r\n    const fakeSelectionWrapper = this.fakeSelectionWrapper = document.createElement('div');\r\n    fakeSelectionWrapper.classList.add('fake-wrapper', 'fake-selection-wrapper');\r\n\r\n    this.inputContainer.append(this.rowsWrapperWrapper, fakeRowsWrapper, fakeSelectionWrapper);\r\n    this.chatInput.append(this.inputContainer);\r\n\r\n    this.goDownBtn = ButtonCorner({icon: 'arrow_down', className: 'bubbles-corner-button bubbles-go-down hide'});\r\n    this.inputContainer.append(this.goDownBtn);\r\n\r\n    attachClickEvent(this.goDownBtn, (e) => {\r\n      cancelEvent(e);\r\n      this.chat.bubbles.onGoDownClick();\r\n    }, {listenerSetter: this.listenerSetter});\r\n\r\n    // * constructor end\r\n\r\n    /* let setScrollTopTimeout: number;\r\n    // @ts-ignore\r\n    let height = window.visualViewport.height; */\r\n    // @ts-ignore\r\n    // this.listenerSetter.add(window.visualViewport)('resize', () => {\r\n    //   const scrollable = this.chat.bubbles.scrollable;\r\n    //   const wasScrolledDown = scrollable.isScrolledDown;\r\n\r\n    //   /* if(wasScrolledDown) {\r\n    //     this.saveScroll();\r\n    //   } */\r\n\r\n    //   // @ts-ignore\r\n    //   let newHeight = window.visualViewport.height;\r\n    //   const diff = height - newHeight;\r\n    //   const scrollTop = scrollable.scrollTop;\r\n    //   const needScrollTop = wasScrolledDown ? scrollable.scrollHeight : scrollTop + diff; // * wasScrolledDown     ,     \r\n\r\n    //   console.log('resize before', scrollable.scrollTop, scrollable.container.clientHeight, scrollable.scrollHeight, wasScrolledDown, scrollable.lastScrollTop, diff, needScrollTop);\r\n\r\n    //   scrollable.scrollTop = needScrollTop;\r\n\r\n    //   if(setScrollTopTimeout) clearTimeout(setScrollTopTimeout);\r\n    //   setScrollTopTimeout = window.setTimeout(() => {\r\n    //     const diff = height - newHeight;\r\n    //     const isScrolledDown = scrollable.scrollHeight - Math.round(scrollable.scrollTop + scrollable.container.offsetHeight + diff) <= 1;\r\n    //     height = newHeight;\r\n\r\n    //     scrollable.scrollTop = needScrollTop;\r\n\r\n    //     console.log('resize after', scrollable.scrollTop, scrollable.container.clientHeight, scrollable.scrollHeight, scrollable.isScrolledDown, scrollable.lastScrollTop, isScrolledDown);\r\n\r\n    //     /* if(isScrolledDown) {\r\n    //       scrollable.scrollTop = scrollable.scrollHeight;\r\n    //     } */\r\n\r\n    //     //scrollable.scrollTop += diff;\r\n    //     setScrollTopTimeout = 0;\r\n    //   }, 0);\r\n    // });\r\n\r\n    // ! Can't use it with resizeObserver\r\n    /* this.listenerSetter.add(window.visualViewport)('resize', () => {\r\n      const scrollable = this.chat.bubbles.scrollable;\r\n      const wasScrolledDown = scrollable.isScrolledDown;\r\n\r\n      // @ts-ignore\r\n      let newHeight = window.visualViewport.height;\r\n      const diff = height - newHeight;\r\n      const needScrollTop = wasScrolledDown ? scrollable.scrollHeight : scrollable.scrollTop + diff; // * wasScrolledDown     ,     \r\n\r\n      //console.log('resize before', scrollable.scrollTop, scrollable.container.clientHeight, scrollable.scrollHeight, wasScrolledDown, scrollable.lastScrollTop, diff, needScrollTop);\r\n\r\n      scrollable.scrollTop = needScrollTop;\r\n      height = newHeight;\r\n\r\n      if(setScrollTopTimeout) clearTimeout(setScrollTopTimeout);\r\n      setScrollTopTimeout = window.setTimeout(() => { // * try again for scrolled down Android Chrome\r\n        scrollable.scrollTop = needScrollTop;\r\n\r\n        //console.log('resize after', scrollable.scrollTop, scrollable.container.clientHeight, scrollable.scrollHeight, scrollable.isScrolledDown, scrollable.lastScrollTop, isScrolledDown);\r\n        setScrollTopTimeout = 0;\r\n      }, 0);\r\n    }); */\r\n\r\n    const c = this.controlContainer = document.createElement('div');\r\n    c.classList.add('chat-input-control', 'chat-input-wrapper');\r\n    this.inputContainer.append(c);\r\n  }\r\n\r\n  public constructPeerHelpers() {\r\n    this.replyElements.container = document.createElement('div');\r\n    this.replyElements.container.classList.add('reply-wrapper');\r\n\r\n    this.replyElements.iconBtn = ButtonIcon('');\r\n    this.replyElements.cancelBtn = ButtonIcon('close reply-cancel', {noRipple: true});\r\n\r\n    this.replyElements.container.append(this.replyElements.iconBtn, this.replyElements.cancelBtn);\r\n\r\n    //\r\n\r\n    const onHideAuthorClick = () => {\r\n      isChangingAuthor = true;\r\n      return this.canToggleHideAuthor();\r\n    };\r\n\r\n    const onHideCaptionClick = () => {\r\n      isChangingAuthor = false;\r\n    };\r\n\r\n    const forwardElements: ChatInput['forwardElements'] = this.forwardElements = {} as any;\r\n    let isChangingAuthor = false;\r\n    const forwardButtons: ButtonMenuItemOptions[] = [\r\n      forwardElements.showSender = {\r\n        text: 'Chat.Alert.Forward.Action.Show1',\r\n        onClick: onHideAuthorClick,\r\n        checkboxField: new CheckboxField({checked: true})\r\n      },\r\n      forwardElements.hideSender = {\r\n        text: 'Chat.Alert.Forward.Action.Hide1',\r\n        onClick: onHideAuthorClick,\r\n        checkboxField: new CheckboxField({checked: false})\r\n      },\r\n      forwardElements.showCaption = {\r\n        text: 'Chat.Alert.Forward.Action.ShowCaption',\r\n        onClick: onHideCaptionClick,\r\n        checkboxField: new CheckboxField({checked: true})\r\n      },\r\n      forwardElements.hideCaption = {\r\n        text: 'Chat.Alert.Forward.Action.HideCaption',\r\n        onClick: onHideCaptionClick,\r\n        checkboxField: new CheckboxField({checked: false})\r\n      },\r\n      forwardElements.changePeer = {\r\n        text: 'Chat.Alert.Forward.Action.Another',\r\n        onClick: () => {\r\n          this.changeForwardRecipient();\r\n        },\r\n        icon: 'replace'\r\n      }\r\n    ];\r\n    const forwardBtnMenu = forwardElements.container = ButtonMenu(forwardButtons, this.listenerSetter);\r\n    // forwardBtnMenu.classList.add('top-center');\r\n\r\n    const children = Array.from(forwardBtnMenu.children) as HTMLElement[];\r\n    const groups: {\r\n      elements: HTMLElement[],\r\n      onChange: (value: string, event: Event) => void\r\n    }[] = [{\r\n      elements: children.slice(0, 2),\r\n      onChange: (value, e) => {\r\n        const checked = !!+value;\r\n        if(isChangingAuthor) {\r\n          this.forwardWasDroppingAuthor = !checked;\r\n        }\r\n\r\n        const replyTitle = this.replyElements.container.querySelector('.reply-title');\r\n        if(replyTitle) {\r\n          const el = replyTitle.firstElementChild as HTMLElement;\r\n          const i = I18n.weakMap.get(el) as I18n.IntlElement;\r\n          const langPackKey: LangPackKey = forwardElements.showSender.checkboxField.checked ? 'Chat.Accessory.Forward' : 'Chat.Accessory.Hidden';\r\n          i.key = langPackKey;\r\n          i.update();\r\n        }\r\n      }\r\n    }, {\r\n      elements: children.slice(2, 4),\r\n      onChange: (value) => {\r\n        const checked = !!+value;\r\n        let b: ButtonMenuItemOptions;\r\n        if(checked && this.forwardWasDroppingAuthor !== undefined) {\r\n          b = this.forwardWasDroppingAuthor ? forwardElements.hideSender : forwardElements.showSender;\r\n        } else {\r\n          b = checked ? forwardElements.showSender : forwardElements.hideSender;\r\n        }\r\n\r\n        b.checkboxField.checked = true;\r\n      }\r\n    }];\r\n    groups.forEach((group) => {\r\n      const container = RadioForm(group.elements.map((e) => {\r\n        return {\r\n          container: e,\r\n          input: e.querySelector('input')\r\n        };\r\n      }), group.onChange);\r\n\r\n      const hr = document.createElement('hr');\r\n      container.append(hr);\r\n      forwardBtnMenu.append(container);\r\n    });\r\n\r\n    forwardBtnMenu.append(forwardElements.changePeer.element);\r\n\r\n    if(!IS_TOUCH_SUPPORTED) {\r\n      const forwardHover = this.forwardHover = new DropdownHover({\r\n        element: forwardBtnMenu\r\n      });\r\n    }\r\n\r\n    forwardElements.modifyArgs = forwardButtons.slice(0, -1);\r\n    this.replyElements.container.append(forwardBtnMenu);\r\n\r\n    forwardElements.modifyArgs.forEach((b, idx) => {\r\n      const {input} = b.checkboxField;\r\n      input.type = 'radio';\r\n      input.name = idx < 2 ? 'author' : 'caption';\r\n      input.value = '' + +!(idx % 2);\r\n    });\r\n\r\n    //\r\n\r\n    this.newMessageWrapper = document.createElement('div');\r\n    this.newMessageWrapper.classList.add('new-message-wrapper');\r\n\r\n    this.btnToggleEmoticons = ButtonIcon('none toggle-emoticons', {noRipple: true});\r\n\r\n    this.inputMessageContainer = document.createElement('div');\r\n    this.inputMessageContainer.classList.add('input-message-container');\r\n\r\n    if(this.chat.type === 'chat') {\r\n      this.goDownUnreadBadge = document.createElement('span');\r\n      this.goDownUnreadBadge.classList.add('badge', 'badge-24', 'badge-primary');\r\n      this.goDownBtn.append(this.goDownUnreadBadge);\r\n\r\n      this.goMentionBtn = ButtonCorner({icon: 'mention', className: 'bubbles-corner-button bubbles-go-mention'});\r\n      this.goMentionUnreadBadge = document.createElement('span');\r\n      this.goMentionUnreadBadge.classList.add('badge', 'badge-24', 'badge-primary');\r\n      this.goMentionBtn.append(this.goMentionUnreadBadge);\r\n      this.inputContainer.append(this.goMentionBtn);\r\n\r\n      attachClickEvent(this.goMentionBtn, (e) => {\r\n        cancelEvent(e);\r\n        const middleware = this.chat.bubbles.getMiddleware();\r\n        this.managers.appMessagesManager.goToNextMention(this.chat.peerId).then((mid) => {\r\n          if(!middleware()) {\r\n            return;\r\n          }\r\n\r\n          if(mid) {\r\n            this.chat.setMessageId(mid);\r\n          }\r\n        });\r\n      }, {listenerSetter: this.listenerSetter});\r\n\r\n      this.btnScheduled = ButtonIcon('scheduled btn-scheduled float hide', {noRipple: true});\r\n\r\n      attachClickEvent(this.btnScheduled, (e) => {\r\n        this.appImManager.openScheduled(this.chat.peerId);\r\n      }, {listenerSetter: this.listenerSetter});\r\n\r\n      this.listenerSetter.add(rootScope)('scheduled_new', ({peerId}) => {\r\n        if(this.chat.peerId !== peerId) {\r\n          return;\r\n        }\r\n\r\n        this.btnScheduled.classList.remove('hide');\r\n      });\r\n\r\n      this.listenerSetter.add(rootScope)('scheduled_delete', ({peerId}) => {\r\n        if(this.chat.peerId !== peerId) {\r\n          return;\r\n        }\r\n\r\n        this.managers.appMessagesManager.getScheduledMessages(this.chat.peerId).then((value) => {\r\n          this.btnScheduled.classList.toggle('hide', !value.length);\r\n        });\r\n      });\r\n\r\n      this.btnToggleReplyMarkup = ButtonIcon('botcom toggle-reply-markup float hide', {noRipple: true});\r\n      this.replyKeyboard = new ReplyKeyboard({\r\n        appendTo: this.rowsWrapper,\r\n        listenerSetter: this.listenerSetter,\r\n        managers: this.managers,\r\n        btnHover: this.btnToggleReplyMarkup,\r\n        chatInput: this\r\n      });\r\n      this.listenerSetter.add(this.replyKeyboard)('open', () => this.btnToggleReplyMarkup.classList.add('active'));\r\n      this.listenerSetter.add(this.replyKeyboard)('close', () => this.btnToggleReplyMarkup.classList.remove('active'));\r\n\r\n      this.botCommands = new ChatBotCommands(this.rowsWrapper, this, this.managers);\r\n      this.botCommandsToggle = document.createElement('div');\r\n      this.botCommandsToggle.classList.add('new-message-bot-commands');\r\n\r\n      const scaler = document.createElement('div');\r\n      scaler.classList.add('new-message-bot-commands-icon-scale');\r\n\r\n      const icon = this.botCommandsIcon = document.createElement('div');\r\n      icon.classList.add('animated-menu-icon', 'animated-menu-close-icon');\r\n      scaler.append(icon);\r\n      this.botCommandsToggle.append(scaler);\r\n\r\n      attachClickEvent(this.botCommandsToggle, (e) => {\r\n        cancelEvent(e);\r\n        const isShown = icon.classList.contains('state-back');\r\n        if(isShown) {\r\n          this.botCommands.toggle(true);\r\n          icon.classList.remove('state-back');\r\n        } else {\r\n          this.botCommands.setUserId(this.chat.peerId.toUserId(), this.chat.bubbles.getMiddleware());\r\n          icon.classList.add('state-back');\r\n        }\r\n      }, {listenerSetter: this.listenerSetter});\r\n\r\n      this.botCommands.addEventListener('visible', () => {\r\n        icon.classList.add('state-back');\r\n      });\r\n\r\n      this.botCommands.addEventListener('hiding', () => {\r\n        icon.classList.remove('state-back');\r\n      });\r\n    }\r\n\r\n    this.attachMenuButtons = [{\r\n      icon: 'image',\r\n      text: 'Chat.Input.Attach.PhotoOrVideo',\r\n      onClick: () => {\r\n        this.fileInput.value = '';\r\n        const accept = [...MEDIA_MIME_TYPES_SUPPORTED].join(', ');\r\n        this.fileInput.setAttribute('accept', accept);\r\n        this.willAttachType = 'media';\r\n        this.fileInput.click();\r\n      },\r\n      verify: () => this.chat.canSend('send_media')\r\n    }, {\r\n      icon: 'document',\r\n      text: 'Chat.Input.Attach.Document',\r\n      onClick: () => {\r\n        this.fileInput.value = '';\r\n        this.fileInput.removeAttribute('accept');\r\n        this.willAttachType = 'document';\r\n        this.fileInput.click();\r\n      },\r\n      verify: () => this.chat.canSend('send_media')\r\n    }, {\r\n      icon: 'poll',\r\n      text: 'Poll',\r\n      onClick: () => {\r\n        PopupElement.createPopup(PopupCreatePoll, this.chat).show();\r\n      },\r\n      verify: (peerId) => peerId.isAnyChat() && this.chat.canSend('send_polls')\r\n    }];\r\n\r\n    this.attachMenu = ButtonMenuToggle({noRipple: true, listenerSetter: this.listenerSetter}, 'top-left', this.attachMenuButtons);\r\n    this.attachMenu.classList.add('attach-file', 'tgico-attach');\r\n    this.attachMenu.classList.remove('tgico-more');\r\n\r\n    // this.inputContainer.append(this.sendMenu);\r\n\r\n    this.recordTimeEl = document.createElement('div');\r\n    this.recordTimeEl.classList.add('record-time');\r\n\r\n    this.fileInput = document.createElement('input');\r\n    this.fileInput.type = 'file';\r\n    this.fileInput.multiple = true;\r\n    this.fileInput.style.display = 'none';\r\n\r\n    this.newMessageWrapper.append(...[this.botCommandsToggle, this.btnToggleEmoticons, this.inputMessageContainer, this.btnScheduled, this.btnToggleReplyMarkup, this.attachMenu, this.recordTimeEl, this.fileInput].filter(Boolean));\r\n\r\n    this.rowsWrapper.append(this.replyElements.container);\r\n    this.autocompleteHelperController = new AutocompleteHelperController();\r\n    this.stickersHelper = new StickersHelper(this.rowsWrapper, this.autocompleteHelperController, this.managers);\r\n    this.emojiHelper = new EmojiHelper(this.rowsWrapper, this.autocompleteHelperController, this, this.managers);\r\n    this.commandsHelper = new CommandsHelper(this.rowsWrapper, this.autocompleteHelperController, this, this.managers);\r\n    this.mentionsHelper = new MentionsHelper(this.rowsWrapper, this.autocompleteHelperController, this, this.managers);\r\n    this.inlineHelper = new InlineHelper(this.rowsWrapper, this.autocompleteHelperController, this.chat, this.managers);\r\n    this.rowsWrapper.append(this.newMessageWrapper);\r\n\r\n    this.btnCancelRecord = ButtonIcon('delete btn-circle z-depth-1 btn-record-cancel');\r\n\r\n    this.btnSendContainer = document.createElement('div');\r\n    this.btnSendContainer.classList.add('btn-send-container');\r\n\r\n    this.recordRippleEl = document.createElement('div');\r\n    this.recordRippleEl.classList.add('record-ripple');\r\n\r\n    this.btnSend = ButtonIcon('none btn-circle z-depth-1 btn-send animated-button-icon');\r\n    this.btnSend.insertAdjacentHTML('afterbegin', `\r\n    <span class=\"tgico tgico-send\"></span>\r\n    <span class=\"tgico tgico-schedule\"></span>\r\n    <span class=\"tgico tgico-check\"></span>\r\n    <span class=\"tgico tgico-microphone_filled\"></span>\r\n    `);\r\n\r\n    this.btnSendContainer.append(this.recordRippleEl, this.btnSend);\r\n\r\n    if(this.chat.type !== 'scheduled') {\r\n      this.sendMenu = new SendMenu({\r\n        onSilentClick: () => {\r\n          this.sendSilent = true;\r\n          this.sendMessage();\r\n        },\r\n        onScheduleClick: () => {\r\n          this.scheduleSending(undefined);\r\n        },\r\n        listenerSetter: this.listenerSetter,\r\n        openSide: 'top-left',\r\n        onContextElement: this.btnSend,\r\n        onOpen: () => {\r\n          return !this.isInputEmpty() || !!Object.keys(this.forwarding).length;\r\n        }\r\n      });\r\n\r\n      this.btnSendContainer.append(this.sendMenu.sendMenu);\r\n    }\r\n\r\n    this.inputContainer.append(this.btnCancelRecord, this.btnSendContainer);\r\n\r\n    emoticonsDropdown.attachButtonListener(this.btnToggleEmoticons, this.listenerSetter);\r\n    this.listenerSetter.add(emoticonsDropdown)('open', this.onEmoticonsOpen);\r\n    this.listenerSetter.add(emoticonsDropdown)('close', this.onEmoticonsClose);\r\n\r\n    this.attachMessageInputField();\r\n\r\n    /* this.attachMenu.addEventListener('mousedown', (e) => {\r\n      const hidden = this.attachMenu.querySelectorAll('.hide');\r\n      if(hidden.length === this.attachMenuButtons.length) {\r\n        toast(POSTING_MEDIA_NOT_ALLOWED);\r\n        cancelEvent(e);\r\n        return false;\r\n      }\r\n    }, {passive: false, capture: true}); */\r\n\r\n    this.listenerSetter.add(rootScope)('settings_updated', () => {\r\n      if(this.stickersHelper || this.emojiHelper) {\r\n        // this.previousQuery = undefined;\r\n        this.previousQuery = '';\r\n        this.checkAutocomplete();\r\n        /* if(!rootScope.settings.stickers.suggest) {\r\n          this.stickersHelper.checkEmoticon('');\r\n        } else {\r\n          this.onMessageInput();\r\n        } */\r\n      }\r\n\r\n      if(this.messageInputField) {\r\n        this.messageInputField.onFakeInput();\r\n      }\r\n    });\r\n\r\n    this.listenerSetter.add(rootScope)('draft_updated', ({peerId, threadId, draft, force}) => {\r\n      if(this.chat.threadId !== threadId || this.chat.peerId !== peerId) return;\r\n      this.setDraft(draft, true, force);\r\n    });\r\n\r\n    this.listenerSetter.add(this.appImManager)('peer_changing', (chat) => {\r\n      if(this.chat === chat) {\r\n        this.saveDraft();\r\n      }\r\n    });\r\n\r\n    this.listenerSetter.add(this.appImManager)('chat_changing', ({from, to}) => {\r\n      if(this.chat === from) {\r\n        this.autocompleteHelperController.toggleListNavigation(false);\r\n      } else if(this.chat === to) {\r\n        this.autocompleteHelperController.toggleListNavigation(true);\r\n      }\r\n    });\r\n\r\n    if(this.chat.type === 'scheduled') {\r\n      this.listenerSetter.add(rootScope)('scheduled_delete', ({peerId, mids}) => {\r\n        if(this.chat.peerId === peerId && mids.includes(this.editMsgId)) {\r\n          this.onMessageSent();\r\n        }\r\n      });\r\n    } else {\r\n      this.listenerSetter.add(rootScope)('history_delete', ({peerId, msgs}) => {\r\n        if(this.chat.peerId === peerId) {\r\n          if(msgs.has(this.editMsgId)) {\r\n            this.onMessageSent();\r\n          }\r\n\r\n          if(this.replyToMsgId && msgs.has(this.replyToMsgId)) {\r\n            this.clearHelper('reply');\r\n          }\r\n\r\n          /* if(this.chat.isStartButtonNeeded()) {\r\n            this.setStartParam(BOT_START_PARAM);\r\n          } */\r\n        }\r\n      });\r\n\r\n      this.listenerSetter.add(rootScope)('dialogs_multiupdate', (dialogs) => {\r\n        if(dialogs.has(this.chat.peerId)) {\r\n          if(this.startParam === BOT_START_PARAM) {\r\n            this.setStartParam();\r\n          } else { // updateNewMessage comes earlier than dialog appers\r\n            this.center(true);\r\n          }\r\n        }\r\n      });\r\n    }\r\n\r\n    try {\r\n      this.recorder = new Recorder({\r\n        // encoderBitRate: 32,\r\n        // encoderPath: \"../dist/encoderWorker.min.js\",\r\n        encoderSampleRate: 48000,\r\n        monitorGain: 0,\r\n        numberOfChannels: 1,\r\n        recordingGain: 1,\r\n        reuseWorker: true\r\n      });\r\n    } catch(err) {\r\n      console.error('Recorder constructor error:', err);\r\n    }\r\n\r\n    this.updateSendBtn();\r\n\r\n    this.listenerSetter.add(this.fileInput)('change', (e) => {\r\n      const files = (e.target as HTMLInputElement & EventTarget).files;\r\n      if(!files.length) {\r\n        return;\r\n      }\r\n\r\n      PopupElement.createPopup(PopupNewMedia, this.chat, Array.from(files).slice(), this.willAttachType);\r\n      this.fileInput.value = '';\r\n    }, false);\r\n\r\n    /* let time = Date.now();\r\n    this.btnSend.addEventListener('touchstart', (e) => {\r\n      time = Date.now();\r\n    });\r\n\r\n    let eventName1 = 'touchend';\r\n    this.btnSend.addEventListener(eventName1, (e: Event) => {\r\n      //cancelEvent(e);\r\n      console.log(eventName1 + ', time: ' + (Date.now() - time));\r\n    });\r\n\r\n    let eventName = 'mousedown';\r\n    this.btnSend.addEventListener(eventName, (e: Event) => {\r\n      cancelEvent(e);\r\n      console.log(eventName + ', time: ' + (Date.now() - time));\r\n    }); */\r\n    attachClickEvent(this.btnSend, this.onBtnSendClick, {listenerSetter: this.listenerSetter, touchMouseDown: true});\r\n\r\n    if(this.recorder) {\r\n      attachClickEvent(this.btnCancelRecord, this.onCancelRecordClick, {listenerSetter: this.listenerSetter});\r\n\r\n      this.recorder.onstop = () => {\r\n        this.setRecording(false);\r\n        this.chatInput.classList.remove('is-locked');\r\n        this.recordRippleEl.style.transform = '';\r\n      };\r\n\r\n      this.recorder.ondataavailable = (typedArray: Uint8Array) => {\r\n        if(this.releaseMediaPlayback) {\r\n          this.releaseMediaPlayback();\r\n          this.releaseMediaPlayback = undefined;\r\n        }\r\n\r\n        if(this.recordingOverlayListener) {\r\n          this.listenerSetter.remove(this.recordingOverlayListener);\r\n          this.recordingOverlayListener = undefined;\r\n        }\r\n\r\n        if(this.recordingNavigationItem) {\r\n          appNavigationController.removeItem(this.recordingNavigationItem);\r\n          this.recordingNavigationItem = undefined;\r\n        }\r\n\r\n        if(this.recordCanceled) {\r\n          return;\r\n        }\r\n\r\n        const {peerId, threadId} = this.chat;\r\n        const replyToMsgId = this.replyToMsgId;\r\n\r\n        const duration = (Date.now() - this.recordStartTime) / 1000 | 0;\r\n        const dataBlob = new Blob([typedArray], {type: 'audio/ogg'});\r\n        /* const fileName = new Date().toISOString() + \".opus\";\r\n        console.log('Recorder data received', typedArray, dataBlob); */\r\n\r\n        // let perf = performance.now();\r\n        opusDecodeController.decode(typedArray, true).then((result) => {\r\n          // console.log('WAVEFORM!:', /* waveform,  */performance.now() - perf);\r\n\r\n          opusDecodeController.setKeepAlive(false);\r\n\r\n          //  objectURL    audio/wav\r\n          this.managers.appMessagesManager.sendFile(peerId, dataBlob, {\r\n            isVoiceMessage: true,\r\n            isMedia: true,\r\n            duration,\r\n            waveform: result.waveform,\r\n            objectURL: result.url,\r\n            replyToMsgId,\r\n            threadId,\r\n            clearDraft: true\r\n          });\r\n\r\n          this.onMessageSent(false, true);\r\n        });\r\n      };\r\n    }\r\n\r\n    attachClickEvent(this.replyElements.cancelBtn, this.onHelperCancel, {listenerSetter: this.listenerSetter});\r\n    attachClickEvent(this.replyElements.container, this.onHelperClick, {listenerSetter: this.listenerSetter});\r\n\r\n    this.saveDraftDebounced = debounce(() => this.saveDraft(), 2500, false, true);\r\n\r\n    this.botStartBtn = Button('btn-primary btn-transparent text-bold chat-input-control-button');\r\n    this.botStartBtn.append(i18n('BotStart'));\r\n\r\n    attachClickEvent(this.botStartBtn, () => {\r\n      const {startParam} = this;\r\n      if(startParam === undefined) {\r\n        return;\r\n      }\r\n\r\n      const toggle = this.toggleBotStartBtnDisability = toggleDisability([this.botStartBtn], true);\r\n      const peerId = this.chat.peerId;\r\n      const middleware = this.chat.bubbles.getMiddleware(() => {\r\n        return this.chat.peerId === peerId && this.startParam === startParam && this.toggleBotStartBtnDisability === toggle;\r\n      });\r\n\r\n      this.managers.appMessagesManager.startBot(peerId.toUserId(), undefined, startParam).then(() => {\r\n        if(middleware()) {\r\n          toggle();\r\n          this.toggleBotStartBtnDisability = undefined;\r\n          this.setStartParam();\r\n        }\r\n      });\r\n    }, {listenerSetter: this.listenerSetter});\r\n\r\n    this.controlContainer.append(this.botStartBtn);\r\n  }\r\n\r\n  public constructPinnedHelpers() {\r\n    this.pinnedControlBtn = Button('btn-primary btn-transparent text-bold chat-input-control-button', {icon: 'unpin'});\r\n    this.controlContainer.append(this.pinnedControlBtn);\r\n\r\n    this.listenerSetter.add(this.pinnedControlBtn)('click', () => {\r\n      const peerId = this.chat.peerId;\r\n\r\n      new PopupPinMessage(peerId, 0, true, () => {\r\n        this.chat.appImManager.setPeer(); // * close tab\r\n\r\n        // ! ,     ,  ,      \r\n        const originalChat = this.chat.appImManager.chat;\r\n        if(originalChat.topbar.pinnedMessage) {\r\n          originalChat.topbar.pinnedMessage.pinnedMessageContainer.toggle(true);\r\n        }\r\n      });\r\n    });\r\n\r\n    this.chatInput.classList.add('type-pinned');\r\n  }\r\n\r\n  public _center(neededFakeContainer: HTMLElement, animate?: boolean) {\r\n    if(!neededFakeContainer && !this.inputContainer.classList.contains('is-centering')) {\r\n      return;\r\n    }\r\n\r\n    if(neededFakeContainer === this.fakeWrapperTo) {\r\n      return;\r\n    }\r\n\r\n    /* if(neededFakeContainer === this.botStartContainer && this.fakeWrapperTo === this.fakeSelectionWrapper) {\r\n      this.inputContainer.classList.remove('is-centering');\r\n      void this.rowsWrapper.offsetLeft; // reflow\r\n      // this.inputContainer.classList.add('is-centering');\r\n      // void this.rowsWrapper.offsetLeft; // reflow\r\n    } */\r\n\r\n    const fakeSelectionWrapper = neededFakeContainer || this.fakeWrapperTo;\r\n    const forwards = !!neededFakeContainer;\r\n    const oldFakeWrapperTo = this.fakeWrapperTo;\r\n    let transform = '', borderRadius = '', needTranslateX: number;\r\n    // if(forwards) {]\r\n    const fakeSelectionRect = fakeSelectionWrapper.getBoundingClientRect();\r\n    const fakeRowsRect = this.fakeRowsWrapper.getBoundingClientRect();\r\n    const widthFrom = fakeRowsRect.width;\r\n    const widthTo = fakeSelectionRect.width;\r\n\r\n    if(widthFrom !== widthTo) {\r\n      const scale = (widthTo/*  - 8 */) / widthFrom;\r\n      const initTranslateX = (widthFrom - widthTo) / 2;\r\n      needTranslateX = fakeSelectionRect.left - fakeRowsRect.left - initTranslateX;\r\n\r\n      if(forwards) {\r\n        transform = `translateX(${needTranslateX}px) scaleX(${scale})`;\r\n        // transform = `translateX(0px) scaleX(${scale})`;\r\n\r\n        if(scale < 1) {\r\n          const br = 12;\r\n          borderRadius = '' + (br + br * (1 - scale)) + 'px';\r\n        }\r\n      }\r\n      // scale = widthTo / widthFrom;\r\n    }\r\n    // }\r\n\r\n    this.fakeWrapperTo = neededFakeContainer;\r\n\r\n    const duration = animate ? 200 : 0;\r\n    SetTransition(this.inputContainer, 'is-centering', forwards, duration);\r\n    SetTransition(this.rowsWrapperWrapper, 'is-centering-to-control', !!(forwards && neededFakeContainer && neededFakeContainer.classList.contains('chat-input-control')), duration);\r\n    this.rowsWrapper.style.transform = transform;\r\n    this.rowsWrapper.style.borderRadius = borderRadius;\r\n\r\n    return {\r\n      transform,\r\n      borderRadius,\r\n      needTranslateX: oldFakeWrapperTo && (\r\n          (\r\n            neededFakeContainer &&\r\n            neededFakeContainer.classList.contains('chat-input-control') &&\r\n            oldFakeWrapperTo === this.fakeSelectionWrapper\r\n          ) || oldFakeWrapperTo.classList.contains('chat-input-control')\r\n        ) ? needTranslateX * -.5 : needTranslateX,\r\n      widthFrom,\r\n      widthTo\r\n    };\r\n  }\r\n\r\n  public async center(animate = false) {\r\n    return this._center(await this.getNeededFakeContainer(), animate);\r\n  }\r\n\r\n  public setStartParam(startParam?: string) {\r\n    if(this.startParam === startParam) {\r\n      return;\r\n    }\r\n\r\n    this.startParam = startParam;\r\n    this.center(true);\r\n  }\r\n\r\n  public async getNeededFakeContainer(startParam = this.startParam) {\r\n    if(this.chat.selection.isSelecting) {\r\n      return this.fakeSelectionWrapper;\r\n    } else if(\r\n      startParam !== undefined ||\r\n      !(await this.chat.canSend()) ||\r\n      this.chat.type === 'pinned' ||\r\n      await this.chat.isStartButtonNeeded()\r\n    ) {\r\n      return this.controlContainer;\r\n    }\r\n  }\r\n\r\n  // public getActiveContainer() {\r\n  //   if(this.chat.selection.isSelecting) {\r\n  //     return this.chat\r\n  //   }\r\n  //   return this.startParam !== undefined ? this.botStartContainer : this.rowsWrapper;\r\n  // }\r\n\r\n  // public setActiveContainer() {\r\n  //   const container = this.activeContainer;\r\n  //   const newContainer = this.getActiveContainer();\r\n  //   if(newContainer === container) {\r\n  //     return;\r\n  //   }\r\n\r\n\r\n  // }\r\n\r\n  private onCancelRecordClick = (e?: Event) => {\r\n    if(e) {\r\n      cancelEvent(e);\r\n    }\r\n\r\n    this.recordCanceled = true;\r\n    this.recorder.stop();\r\n    opusDecodeController.setKeepAlive(false);\r\n  };\r\n\r\n  private onEmoticonsOpen = () => {\r\n    const toggleClass = IS_TOUCH_SUPPORTED ? 'flip-icon' : 'active';\r\n    this.btnToggleEmoticons.classList.toggle(toggleClass, true);\r\n  };\r\n\r\n  private onEmoticonsClose = () => {\r\n    const toggleClass = IS_TOUCH_SUPPORTED ? 'flip-icon' : 'active';\r\n    this.btnToggleEmoticons.classList.toggle(toggleClass, false);\r\n  };\r\n\r\n  public getReadyToSend(callback: () => void) {\r\n    return this.chat.type === 'scheduled' ? (this.scheduleSending(callback), true) : (callback(), false);\r\n  }\r\n\r\n  public scheduleSending = async(callback: () => void = this.sendMessage.bind(this, true), initDate = new Date()) => {\r\n    const {peerId} = this.chat;\r\n    const middleware = this.chat.bubbles.getMiddleware();\r\n    const canSendWhenOnline = rootScope.myId !== peerId && peerId.isUser() && await this.managers.appUsersManager.isUserOnlineVisible(peerId);\r\n\r\n    new PopupSchedule(initDate, (timestamp) => {\r\n      if(!middleware()) {\r\n        return;\r\n      }\r\n\r\n      const minTimestamp = (Date.now() / 1000 | 0) + 10;\r\n      if(timestamp <= minTimestamp) {\r\n        timestamp = undefined;\r\n      }\r\n\r\n      this.scheduleDate = timestamp;\r\n      callback();\r\n\r\n      if(this.chat.type !== 'scheduled' && timestamp) {\r\n        setTimeout(() => { // ! need timeout here because .forwardMessages will be called after timeout\r\n          if(!middleware()) {\r\n            return;\r\n          }\r\n\r\n          const popups = PopupElement.getPopups(PopupStickers);\r\n          popups.forEach((popup) => popup.hide());\r\n\r\n          this.appImManager.openScheduled(peerId);\r\n        }, 0);\r\n      }\r\n    }, canSendWhenOnline).show();\r\n  };\r\n\r\n  public async setUnreadCount() {\r\n    if(!this.goDownUnreadBadge) {\r\n      return;\r\n    }\r\n\r\n    const dialog = await this.managers.appMessagesManager.getDialogOnly(this.chat.peerId);\r\n    const count = dialog?.unread_count;\r\n    this.goDownUnreadBadge.innerText = '' + (count || '');\r\n    this.goDownUnreadBadge.classList.toggle('badge-gray', await this.managers.appNotificationsManager.isPeerLocalMuted(this.chat.peerId, true));\r\n\r\n    if(this.goMentionUnreadBadge && this.chat.type === 'chat') {\r\n      const hasMentions = !!(dialog?.unread_mentions_count && dialog.unread_count);\r\n      this.goMentionUnreadBadge.innerText = hasMentions ? '' + (dialog.unread_mentions_count) : '';\r\n      this.goMentionBtn.classList.toggle('is-visible', hasMentions);\r\n    }\r\n  }\r\n\r\n  public saveDraft() {\r\n    if(!this.chat.peerId || this.editMsgId || this.chat.type === 'scheduled') return;\r\n\r\n    const {value, entities} = getRichValue(this.messageInputField.input);\r\n\r\n    let draft: DraftMessage.draftMessage;\r\n    if(value.length || this.replyToMsgId) {\r\n      draft = {\r\n        _: 'draftMessage',\r\n        date: tsNow(true),\r\n        message: value,\r\n        entities: entities.length ? entities : undefined,\r\n        pFlags: {\r\n          no_webpage: this.noWebPage\r\n        },\r\n        reply_to_msg_id: this.replyToMsgId\r\n      };\r\n    }\r\n\r\n    this.managers.appDraftsManager.syncDraft(this.chat.peerId, this.chat.threadId, draft);\r\n  }\r\n\r\n  public destroy() {\r\n    // this.chat.log.error('Input destroying');\r\n\r\n    this.listenerSetter.removeAll();\r\n  }\r\n\r\n  public cleanup(helperToo = true) {\r\n    if(!this.chat.peerId) {\r\n      this.chatInput.classList.add('hide');\r\n      this.goDownBtn.classList.add('hide');\r\n    }\r\n\r\n    cancelSelection();\r\n\r\n    this.lastTimeType = 0;\r\n    this.startParam = undefined;\r\n\r\n    if(this.toggleBotStartBtnDisability) {\r\n      this.toggleBotStartBtnDisability();\r\n      this.toggleBotStartBtnDisability = undefined;\r\n    }\r\n\r\n    if(this.messageInput) {\r\n      this.clearInput();\r\n      helperToo && this.clearHelper();\r\n    }\r\n  }\r\n\r\n  public async setDraft(draft?: MyDraftMessage, fromUpdate = true, force = false) {\r\n    if((!force && !isInputEmpty(this.messageInput)) || this.chat.type === 'scheduled') return false;\r\n\r\n    if(!draft) {\r\n      draft = await this.managers.appDraftsManager.getDraft(this.chat.peerId, this.chat.threadId);\r\n\r\n      if(!draft) {\r\n        if(force) { // this situation can only happen when sending message with clearDraft\r\n          /* const height = this.chatInput.getBoundingClientRect().height;\r\n          const willChangeHeight = 78 - height;\r\n          this.willChangeHeight = willChangeHeight; */\r\n          if(this.chat.container.classList.contains('is-helper-active')) {\r\n            this.t();\r\n          }\r\n\r\n          this.messageInputField.inputFake.textContent = '';\r\n          this.messageInputField.onFakeInput(false);\r\n\r\n          ((this.chat.bubbles.messagesQueuePromise || Promise.resolve()) as Promise<any>).then(() => {\r\n            fastRaf(() => {\r\n              this.onMessageSent();\r\n            });\r\n          });\r\n        }\r\n\r\n        return false;\r\n      }\r\n    }\r\n\r\n    const wrappedDraft = wrapDraft(draft);\r\n\r\n    if(this.messageInputField.value === wrappedDraft && this.replyToMsgId === draft.reply_to_msg_id) return false;\r\n\r\n    if(fromUpdate) {\r\n      this.clearHelper();\r\n    }\r\n\r\n    this.noWebPage = draft.pFlags.no_webpage;\r\n    if(draft.reply_to_msg_id) {\r\n      this.initMessageReply(draft.reply_to_msg_id);\r\n    }\r\n\r\n    this.setInputValue(wrappedDraft, fromUpdate, fromUpdate);\r\n    return true;\r\n  }\r\n\r\n  private createSendAs() {\r\n    this.sendAsPeerId = undefined;\r\n\r\n    if(this.chat.type === 'chat' || this.chat.type === 'discussion') {\r\n      let firstChange = true;\r\n      this.sendAs = new ChatSendAs(\r\n        this.managers,\r\n        (container, skipAnimation) => {\r\n          let useRafs = 0;\r\n          if(!container.parentElement) {\r\n            this.newMessageWrapper.prepend(container);\r\n            useRafs = 2;\r\n          }\r\n\r\n          this.updateOffset('as', true, skipAnimation, useRafs);\r\n        },\r\n        (sendAsPeerId) => {\r\n          this.sendAsPeerId = sendAsPeerId;\r\n\r\n          // do not change placeholder earlier than finishPeerChange does\r\n          if(firstChange) {\r\n            firstChange = false;\r\n            return;\r\n          }\r\n\r\n          this.getPlaceholderKey().then((key) => {\r\n            this.updateMessageInputPlaceholder(key);\r\n          });\r\n        }\r\n      );\r\n    } else {\r\n      this.sendAs = undefined;\r\n    }\r\n\r\n    return this.sendAs;\r\n  }\r\n\r\n  public async finishPeerChange(startParam?: string) {\r\n    const peerId = this.chat.peerId;\r\n\r\n    const {forwardElements, btnScheduled, replyKeyboard, sendMenu, goDownBtn, chatInput, botCommandsToggle} = this;\r\n\r\n    const previousSendAs = this.sendAs;\r\n    const sendAs = this.createSendAs();\r\n\r\n    const [\r\n      isBroadcast,\r\n      canPinMessage,\r\n      isBot,\r\n      canSend,\r\n      neededFakeContainer,\r\n      ackedPeerFull,\r\n      ackedScheduledMids,\r\n      setSendAsCallback,\r\n      filteredAttachMenuButtons\r\n    ] = await Promise.all([\r\n      this.managers.appPeersManager.isBroadcast(peerId),\r\n      this.managers.appPeersManager.canPinMessage(peerId),\r\n      this.managers.appPeersManager.isBot(peerId),\r\n      this.chat.canSend(),\r\n      this.getNeededFakeContainer(startParam),\r\n      modifyAckedPromise(this.managers.acknowledged.appProfileManager.getProfileByPeerId(peerId)),\r\n      btnScheduled ? modifyAckedPromise(this.managers.acknowledged.appMessagesManager.getScheduledMessages(peerId)) : undefined,\r\n      sendAs ? (sendAs.setPeerId(this.chat.peerId), sendAs.updateManual(true)) : undefined,\r\n      this.filterAttachMenuButtons()\r\n    ]);\r\n\r\n    const placeholderKey = this.messageInput ? await this.getPlaceholderKey() : undefined;\r\n\r\n    return () => {\r\n      // console.warn('[input] finishpeerchange start');\r\n\r\n      chatInput.classList.remove('hide');\r\n      goDownBtn.classList.toggle('is-broadcast', isBroadcast);\r\n      goDownBtn.classList.remove('hide');\r\n\r\n      if(this.goDownUnreadBadge) {\r\n        this.setUnreadCount();\r\n      }\r\n\r\n      if(this.chat.type === 'pinned') {\r\n        chatInput.classList.toggle('can-pin', canPinMessage);\r\n      }/*  else if(this.chat.type === 'chat') {\r\n      } */\r\n\r\n      if(forwardElements) {\r\n        this.forwardWasDroppingAuthor = false;\r\n        forwardElements.showCaption.checkboxField.setValueSilently(true);\r\n        forwardElements.showSender.checkboxField.setValueSilently(true);\r\n      }\r\n\r\n      if(btnScheduled && ackedScheduledMids) {\r\n        btnScheduled.classList.add('hide');\r\n        const middleware = this.chat.bubbles.getMiddleware();\r\n        callbackify(ackedScheduledMids.result, (mids) => {\r\n          if(!middleware() || !mids) return;\r\n          btnScheduled.classList.toggle('hide', !mids.length);\r\n        });\r\n      }\r\n\r\n      if(this.newMessageWrapper) {\r\n        this.updateOffset(null, false, true);\r\n      }\r\n\r\n      if(botCommandsToggle) {\r\n        this.hasBotCommands = undefined;\r\n        this.botCommands.toggle(true, undefined, true);\r\n        this.updateBotCommandsToggle(true);\r\n        botCommandsToggle.remove();\r\n        if(isBot) {\r\n          const middleware = this.chat.bubbles.getMiddleware();\r\n          const result = ackedPeerFull.result;\r\n          callbackify(result, (userFull) => {\r\n            if(!middleware()) return;\r\n            this.updateBotCommands(userFull as UserFull.userFull, !(result instanceof Promise));\r\n          });\r\n        }\r\n      }\r\n\r\n      if(previousSendAs) {\r\n        previousSendAs.destroy();\r\n      }\r\n\r\n      if(setSendAsCallback) {\r\n        setSendAsCallback();\r\n      }\r\n\r\n      if(replyKeyboard) {\r\n        replyKeyboard.setPeer(peerId);\r\n      }\r\n\r\n      if(sendMenu) {\r\n        sendMenu.setPeerId(peerId);\r\n      }\r\n\r\n      if(this.messageInput) {\r\n        this.updateMessageInput(canSend, placeholderKey, filteredAttachMenuButtons);\r\n      } else if(this.pinnedControlBtn) {\r\n        this.pinnedControlBtn.append(i18n(canPinMessage ? 'Chat.Input.UnpinAll' : 'Chat.Pinned.DontShow'));\r\n      }\r\n\r\n      // * testing\r\n      // this.startParam = this.appPeersManager.isBot(peerId) ? '123' : undefined;\r\n\r\n      this.startParam = startParam;\r\n\r\n      this._center(neededFakeContainer, false);\r\n\r\n      // console.warn('[input] finishpeerchange ends');\r\n    };\r\n  }\r\n\r\n  private updateOffset(type: 'commands' | 'as', forwards: boolean, skipAnimation?: boolean, useRafs?: number) {\r\n    if(type) {\r\n      this.newMessageWrapper.dataset.offset = type;\r\n    } else {\r\n      delete this.newMessageWrapper.dataset.offset;\r\n    }\r\n\r\n    SetTransition(this.newMessageWrapper, 'has-offset', forwards, skipAnimation ? 0 : 300, undefined, useRafs);\r\n  }\r\n\r\n  private updateBotCommands(userFull: UserFull.userFull, skipAnimation?: boolean) {\r\n    this.hasBotCommands = !!userFull.bot_info?.commands?.length;\r\n    this.updateBotCommandsToggle(skipAnimation);\r\n  }\r\n\r\n  private updateBotCommandsToggle(skipAnimation?: boolean) {\r\n    const {botCommandsToggle, hasBotCommands} = this;\r\n\r\n    const show = !!hasBotCommands && this.isInputEmpty();\r\n    if(!hasBotCommands) {\r\n      if(!botCommandsToggle.parentElement) {\r\n        return;\r\n      }\r\n\r\n      botCommandsToggle.remove();\r\n    }\r\n\r\n    const forwards = show;\r\n    const useRafs = botCommandsToggle.parentElement ? 0 : 2;\r\n\r\n    if(!botCommandsToggle.parentElement) {\r\n      this.newMessageWrapper.prepend(botCommandsToggle);\r\n    }\r\n\r\n    this.updateOffset('commands', forwards, skipAnimation, useRafs);\r\n  }\r\n\r\n  private async getPlaceholderKey() {\r\n    const {peerId, threadId} = this.chat;\r\n    let key: LangPackKey;\r\n    if(threadId) {\r\n      key = 'Comment';\r\n    } else if(await this.managers.appPeersManager.isBroadcast(peerId)) {\r\n      key = 'ChannelBroadcast';\r\n    } else if(\r\n      (this.sendAsPeerId !== undefined && this.sendAsPeerId !== rootScope.myId) ||\r\n      await this.managers.appMessagesManager.isAnonymousSending(peerId)\r\n    ) {\r\n      key = 'SendAnonymously';\r\n    } else {\r\n      key = 'Message';\r\n    }\r\n\r\n    return key;\r\n  }\r\n\r\n  private updateMessageInputPlaceholder(key: LangPackKey) {\r\n    // console.warn('[input] update placeholder');\r\n    const i = I18n.weakMap.get(this.messageInput) as I18n.IntlElement;\r\n    if(!i) {\r\n      return;\r\n    }\r\n\r\n    i.compareAndUpdate({key});\r\n  }\r\n\r\n  private filterAttachMenuButtons() {\r\n    if(!this.attachMenuButtons) return;\r\n    const {peerId, threadId} = this.chat;\r\n    return filterAsync(this.attachMenuButtons, (button) => {\r\n      return button.verify(peerId, threadId);\r\n    });\r\n  }\r\n\r\n  public updateMessageInput(canSend: boolean, placeholderKey: LangPackKey, visible: ChatInput['attachMenuButtons']) {\r\n    const {chatInput, attachMenu, messageInput} = this;\r\n    const {peerId, threadId} = this.chat;\r\n    const isHidden = chatInput.classList.contains('is-hidden');\r\n    const willBeHidden = !canSend;\r\n    if(isHidden !== willBeHidden) {\r\n      chatInput.classList.add('no-transition');\r\n      chatInput.classList.toggle('is-hidden', !canSend);\r\n      void chatInput.offsetLeft; // reflow\r\n      chatInput.classList.remove('no-transition');\r\n    }\r\n\r\n    this.updateMessageInputPlaceholder(placeholderKey);\r\n\r\n    this.attachMenuButtons && this.attachMenuButtons.forEach((button) => {\r\n      button.element.classList.toggle('hide', !visible.includes(button));\r\n    });\r\n\r\n    if(!canSend) {\r\n      messageInput.removeAttribute('contenteditable');\r\n    } else {\r\n      messageInput.setAttribute('contenteditable', 'true');\r\n      this.setDraft(undefined, false);\r\n\r\n      if(!messageInput.innerHTML) {\r\n        this.messageInputField.onFakeInput();\r\n      }\r\n    }\r\n\r\n    if(attachMenu) {\r\n      attachMenu.toggleAttribute('disabled', !visible.length);\r\n      attachMenu.classList.toggle('btn-disabled', !visible.length);\r\n    }\r\n\r\n    this.updateSendBtn();\r\n  }\r\n\r\n  private attachMessageInputField() {\r\n    const oldInputField = this.messageInputField;\r\n    this.messageInputField = new InputFieldAnimated({\r\n      placeholder: 'Message',\r\n      name: 'message',\r\n      withLinebreaks: true\r\n    });\r\n\r\n    this.messageInputField.input.classList.replace('input-field-input', 'input-message-input');\r\n    this.messageInputField.inputFake.classList.replace('input-field-input', 'input-message-input');\r\n    this.messageInput = this.messageInputField.input;\r\n    this.messageInput.classList.add('no-scrollbar');\r\n    this.attachMessageInputListeners();\r\n\r\n    if(IS_STICKY_INPUT_BUGGED) {\r\n      fixSafariStickyInputFocusing(this.messageInput);\r\n    }\r\n\r\n    if(oldInputField) {\r\n      oldInputField.input.replaceWith(this.messageInputField.input);\r\n      oldInputField.inputFake.replaceWith(this.messageInputField.inputFake);\r\n    } else {\r\n      this.inputMessageContainer.append(this.messageInputField.input, this.messageInputField.inputFake);\r\n    }\r\n  }\r\n\r\n  private attachMessageInputListeners() {\r\n    this.listenerSetter.add(this.messageInput)('keydown', (e: KeyboardEvent) => {\r\n      const key = e.key;\r\n      if(isSendShortcutPressed(e)) {\r\n        cancelEvent(e);\r\n        this.sendMessage();\r\n      } else if(e.ctrlKey || e.metaKey) {\r\n        this.handleMarkdownShortcut(e);\r\n      } else if((key === 'PageUp' || key === 'PageDown') && !e.shiftKey) { // * fix pushing page to left (Chrome Windows)\r\n        e.preventDefault();\r\n\r\n        if(key === 'PageUp') {\r\n          const range = document.createRange();\r\n          const sel = window.getSelection();\r\n\r\n          range.setStart(this.messageInput.childNodes[0] || this.messageInput, 0);\r\n          range.collapse(true);\r\n\r\n          sel.removeAllRanges();\r\n          sel.addRange(range);\r\n        } else {\r\n          placeCaretAtEnd(this.messageInput);\r\n        }\r\n      }\r\n    });\r\n\r\n    if(IS_TOUCH_SUPPORTED) {\r\n      attachClickEvent(this.messageInput, (e) => {\r\n        this.appImManager.selectTab(1); // * set chat tab for album orientation\r\n        // this.saveScroll();\r\n        emoticonsDropdown.toggle(false);\r\n      }, {listenerSetter: this.listenerSetter});\r\n\r\n      /* this.listenerSetter.add(window)('resize', () => {\r\n        this.restoreScroll();\r\n      }); */\r\n\r\n      /* if(isSafari) {\r\n        this.listenerSetter.add(this.messageInput)('mousedown', () => {\r\n          window.requestAnimationFrame(() => {\r\n            window.requestAnimationFrame(() => {\r\n              emoticonsDropdown.toggle(false);\r\n            });\r\n          });\r\n        });\r\n      } */\r\n    }\r\n\r\n    /* this.listenerSetter.add(this.messageInput)('beforeinput', (e: Event) => {\r\n      // * validate due to manual formatting through browser's context menu\r\n      const inputType = (e as InputEvent).inputType;\r\n      //console.log('message beforeinput event', e);\r\n\r\n      if(inputType.indexOf('format') === 0) {\r\n        //console.log('message beforeinput format', e, inputType, this.messageInput.innerHTML);\r\n        const markdownType = inputType.split('format')[1].toLowerCase() as MarkdownType;\r\n        if(this.applyMarkdown(markdownType)) {\r\n          cancelEvent(e); // * cancel legacy markdown event\r\n        }\r\n      }\r\n    }); */\r\n    this.listenerSetter.add(this.messageInput)('input', this.onMessageInput);\r\n    this.listenerSetter.add(this.messageInput)('keyup', () => {\r\n      this.checkAutocomplete();\r\n    });\r\n\r\n    if(this.chat.type === 'chat' || this.chat.type === 'discussion') {\r\n      this.listenerSetter.add(this.messageInput)('focusin', () => {\r\n        if(this.chat.bubbles.scrollable.loadedAll.bottom) {\r\n          this.managers.appMessagesManager.readAllHistory(this.chat.peerId, this.chat.threadId);\r\n        }\r\n      });\r\n    }\r\n  }\r\n\r\n  private prepareDocumentExecute = () => {\r\n    this.executedHistory.push(this.messageInput.innerHTML);\r\n    return () => this.canUndoFromHTML = this.messageInput.innerHTML;\r\n  };\r\n\r\n  private undoRedo = (e: Event, type: 'undo' | 'redo', needHTML: string) => {\r\n    cancelEvent(e); // cancel legacy event\r\n\r\n    let html = this.messageInput.innerHTML;\r\n    if(html && html !== needHTML) {\r\n      this.lockRedo = true;\r\n\r\n      let sameHTMLTimes = 0;\r\n      do {\r\n        document.execCommand(type, false, null);\r\n        const currentHTML = this.messageInput.innerHTML;\r\n        if(html === currentHTML) {\r\n          if(++sameHTMLTimes > 2) { // * unlink, removeFormat (   , :    (  ),  )\r\n            break;\r\n          }\r\n        } else {\r\n          sameHTMLTimes = 0;\r\n        }\r\n\r\n        html = currentHTML;\r\n      } while(html !== needHTML);\r\n\r\n      this.lockRedo = false;\r\n    }\r\n  };\r\n\r\n  public applyMarkdown(type: MarkdownType, href?: string) {\r\n    const MONOSPACE_FONT = 'var(--font-monospace)';\r\n    const SPOILER_FONT = 'spoiler';\r\n    const commandsMap: Partial<{[key in typeof type]: string | (() => void)}> = {\r\n      bold: 'Bold',\r\n      italic: 'Italic',\r\n      underline: 'Underline',\r\n      strikethrough: 'Strikethrough',\r\n      monospace: () => document.execCommand('fontName', false, MONOSPACE_FONT),\r\n      link: href ? () => document.execCommand('createLink', false, href) : () => document.execCommand('unlink', false, null),\r\n      spoiler: () => document.execCommand('fontName', false, SPOILER_FONT)\r\n    };\r\n\r\n    if(!commandsMap[type]) {\r\n      return false;\r\n    }\r\n\r\n    const command = commandsMap[type];\r\n\r\n    // type = 'monospace';\r\n\r\n    const saveExecuted = this.prepareDocumentExecute();\r\n    const executed: any[] = [];\r\n    /**\r\n     * * clear previous formatting, due to Telegram's inability to handle several entities\r\n     */\r\n    /* const checkForSingle = () => {\r\n      const nodes = getSelectedNodes();\r\n      //console.log('Using formatting:', commandsMap[type], nodes, this.executedHistory);\r\n\r\n      const parents = [...new Set(nodes.map((node) => node.parentNode))];\r\n      //const differentParents = !!nodes.find((node) => node.parentNode !== firstParent);\r\n      const differentParents = parents.length > 1;\r\n\r\n      let notSingle = false;\r\n      if(differentParents) {\r\n        notSingle = true;\r\n      } else {\r\n        const node = nodes[0];\r\n        if(node && (node.parentNode as HTMLElement) !== this.messageInput && (node.parentNode.parentNode as HTMLElement) !== this.messageInput) {\r\n          notSingle = true;\r\n        }\r\n      }\r\n\r\n      if(notSingle) {\r\n        //if(type === 'monospace') {\r\n          executed.push(document.execCommand('styleWithCSS', false, 'true'));\r\n        //}\r\n\r\n        executed.push(document.execCommand('unlink', false, null));\r\n        executed.push(document.execCommand('removeFormat', false, null));\r\n        executed.push(typeof(command) === 'function' ? command() : document.execCommand(command, false, null));\r\n\r\n        //if(type === 'monospace') {\r\n          executed.push(document.execCommand('styleWithCSS', false, 'false'));\r\n        //}\r\n      }\r\n    }; */\r\n\r\n    executed.push(document.execCommand('styleWithCSS', false, 'true'));\r\n\r\n    const checkType = (type: MarkdownType) => {\r\n      let haveThisType = false;\r\n      // executed.push(document.execCommand('styleWithCSS', false, 'true'));\r\n\r\n      const selection = window.getSelection();\r\n      if(!selection.isCollapsed) {\r\n        const range = selection.getRangeAt(0);\r\n        const tag = markdownTags[type];\r\n\r\n        const node = range.commonAncestorContainer;\r\n        if((node.parentNode as HTMLElement).matches(tag.match) || (node instanceof HTMLElement && node.matches(tag.match))) {\r\n          haveThisType = true;\r\n        }\r\n      }\r\n\r\n      return haveThisType;\r\n    };\r\n\r\n    // * monospace can't be combined with different types\r\n    if(type === 'monospace' || type === 'spoiler') {\r\n      // executed.push(document.execCommand('styleWithCSS', false, 'true'));\r\n\r\n      const haveThisType = checkType(type);\r\n      // executed.push(document.execCommand('removeFormat', false, null));\r\n\r\n      if(haveThisType) {\r\n        executed.push(this.resetCurrentFontFormatting());\r\n      } else {\r\n        if(type === 'monospace' || checkType('monospace')) {\r\n          executed.push(this.resetCurrentFormatting());\r\n        }\r\n\r\n        executed.push(typeof(command) === 'function' ? command() : document.execCommand(command, false, null));\r\n      }\r\n    } else {\r\n      if(checkType('monospace')) {\r\n        executed.push(this.resetCurrentFormatting());\r\n      }\r\n\r\n      executed.push(typeof(command) === 'function' ? command() : document.execCommand(command, false, null));\r\n    }\r\n\r\n    executed.push(document.execCommand('styleWithCSS', false, 'false'));\r\n\r\n    // checkForSingle();\r\n    saveExecuted();\r\n    if(this.appImManager.markupTooltip) {\r\n      this.appImManager.markupTooltip.setActiveMarkupButton();\r\n    }\r\n\r\n    return true;\r\n  }\r\n\r\n  private resetCurrentFormatting() {\r\n    return document.execCommand('removeFormat', false, null);\r\n  }\r\n\r\n  private resetCurrentFontFormatting() {\r\n    return document.execCommand('fontName', false, 'Roboto');\r\n  }\r\n\r\n  private handleMarkdownShortcut = (e: KeyboardEvent) => {\r\n    // console.log('handleMarkdownShortcut', e);\r\n    const formatKeys: {[key: string]: MarkdownType} = {\r\n      'KeyB': 'bold',\r\n      'KeyI': 'italic',\r\n      'KeyU': 'underline',\r\n      'KeyS': 'strikethrough',\r\n      'KeyM': 'monospace',\r\n      'KeyP': 'spoiler'\r\n    };\r\n\r\n    if(this.appImManager.markupTooltip) {\r\n      formatKeys['KeyK'] = 'link';\r\n    }\r\n\r\n    const code = e.code;\r\n    const applyMarkdown = formatKeys[code];\r\n\r\n    const selection = document.getSelection();\r\n    if(selection.toString().trim().length && applyMarkdown) {\r\n      // * \r\n      if(code === 'KeyK') {\r\n        this.appImManager.markupTooltip.showLinkEditor();\r\n      } else {\r\n        this.applyMarkdown(applyMarkdown);\r\n      }\r\n\r\n      cancelEvent(e); // cancel legacy event\r\n    }\r\n\r\n    // return;\r\n    if(code === 'KeyZ') {\r\n      let html = this.messageInput.innerHTML;\r\n\r\n      if(e.shiftKey) {\r\n        if(this.undoHistory.length) {\r\n          this.executedHistory.push(html);\r\n          html = this.undoHistory.pop();\r\n          this.undoRedo(e, 'redo', html);\r\n          html = this.messageInput.innerHTML;\r\n          this.canRedoFromHTML = this.undoHistory.length ? html : '';\r\n          this.canUndoFromHTML = html;\r\n        }\r\n      } else {\r\n        // * ,        ,     saveExecuted\r\n        if(this.executedHistory.length && (!this.canUndoFromHTML || html === this.canUndoFromHTML)) {\r\n          this.undoHistory.push(html);\r\n          html = this.executedHistory.pop();\r\n          this.undoRedo(e, 'undo', html);\r\n\r\n          // *      ,    -,       \r\n          this.canUndoFromHTML = this.canRedoFromHTML = this.messageInput.innerHTML;\r\n        }\r\n      }\r\n    }\r\n  };\r\n\r\n  private onMessageInput = (e?: Event) => {\r\n    // * validate due to manual formatting through browser's context menu\r\n    /* const inputType = (e as InputEvent).inputType;\r\n    console.log('message input event', e);\r\n    if(inputType === 'formatBold') {\r\n      console.log('message input format', this.messageInput.innerHTML);\r\n      cancelEvent(e);\r\n    }\r\n\r\n    if(!isSelectionSingle()) {\r\n      alert('not single');\r\n    } */\r\n\r\n    // console.log('messageInput input', this.messageInput.innerText);\r\n    // const value = this.messageInput.innerText;\r\n    const {value: richValue, entities: markdownEntities, caretPos} = getRichValueWithCaret(this.messageInputField.input);\r\n\r\n    // const entities = parseEntities(value);\r\n    const value = parseMarkdown(richValue, markdownEntities, true);\r\n    const entities = mergeEntities(markdownEntities, parseEntities(value));\r\n\r\n    // this.chat.log('messageInput entities', richValue, value, markdownEntities, caretPos);\r\n\r\n    if(this.canRedoFromHTML && !this.lockRedo && this.messageInput.innerHTML !== this.canRedoFromHTML) {\r\n      this.canRedoFromHTML = '';\r\n      this.undoHistory.length = 0;\r\n    }\r\n\r\n    const urlEntities: Array<MessageEntity.messageEntityUrl | MessageEntity.messageEntityTextUrl> = (!this.editMessage?.media || this.editMessage.media._ === 'messageMediaWebPage') && entities.filter((e) => e._ === 'messageEntityUrl' || e._ === 'messageEntityTextUrl') as any;\r\n    if(urlEntities.length) {\r\n      for(const entity of urlEntities) {\r\n        let url: string;\r\n        if(entity._ === 'messageEntityTextUrl') {\r\n          url = entity.url;\r\n        } else {\r\n          url = richValue.slice(entity.offset, entity.offset + entity.length);\r\n\r\n          if(!(url.includes('http://') || url.includes('https://'))) {\r\n            continue;\r\n          }\r\n        }\r\n\r\n        // console.log('messageInput url:', url);\r\n\r\n        if(this.lastUrl !== url) {\r\n          this.lastUrl = url;\r\n          // this.willSendWebPage = null;\r\n          const promise = this.getWebPagePromise = this.managers.appWebPagesManager.getWebPage(url).then((webpage) => {\r\n            if(this.getWebPagePromise === promise) this.getWebPagePromise = undefined;\r\n            if(this.lastUrl !== url) return;\r\n            if(webpage._  === 'webPage') {\r\n              // console.log('got webpage: ', webpage);\r\n\r\n              this.setTopInfo('webpage', () => {}, webpage.site_name || webpage.title || 'Webpage', webpage.description || webpage.url || '');\r\n              delete this.noWebPage;\r\n              this.willSendWebPage = webpage;\r\n            } else if(this.willSendWebPage) {\r\n              this.onHelperCancel();\r\n            }\r\n          });\r\n        }\r\n\r\n        break;\r\n      }\r\n    } else if(this.lastUrl) {\r\n      this.lastUrl = '';\r\n      delete this.noWebPage;\r\n      this.willSendWebPage = null;\r\n\r\n      if(this.helperType) {\r\n        this.helperFunc();\r\n      } else {\r\n        this.clearHelper();\r\n      }\r\n    }\r\n\r\n    const isEmpty = !richValue.trim();\r\n    if(isEmpty) {\r\n      if(this.lastTimeType) {\r\n        this.managers.appMessagesManager.setTyping(this.chat.peerId, {_: 'sendMessageCancelAction'});\r\n      }\r\n\r\n      if(this.appImManager.markupTooltip) {\r\n        this.appImManager.markupTooltip.hide();\r\n      }\r\n\r\n      // * Chrome has a bug - it will preserve the formatting if the input with monospace text is cleared\r\n      // * so have to reset formatting\r\n      if(document.activeElement === this.messageInput) {\r\n        // document.execCommand('styleWithCSS', false, 'true');\r\n        setTimeout(() => {\r\n          if(document.activeElement === this.messageInput) {\r\n            this.resetCurrentFontFormatting();\r\n          }\r\n        }, 0);\r\n        // document.execCommand('styleWithCSS', false, 'false');\r\n      }\r\n    } else {\r\n      const time = Date.now();\r\n      if(time - this.lastTimeType >= 6000) {\r\n        this.lastTimeType = time;\r\n        this.managers.appMessagesManager.setTyping(this.chat.peerId, {_: 'sendMessageTypingAction'});\r\n      }\r\n\r\n      if(this.botCommands) {\r\n        this.botCommands.toggle(true);\r\n      }\r\n    }\r\n\r\n    if(this.botCommands) {\r\n      this.updateBotCommandsToggle();\r\n    }\r\n\r\n    if(!this.editMsgId) {\r\n      this.saveDraftDebounced();\r\n    }\r\n\r\n    this.checkAutocomplete(richValue, caretPos, entities);\r\n\r\n    this.updateSendBtn();\r\n  };\r\n\r\n  public insertAtCaret(insertText: string, insertEntity?: MessageEntity, isHelper = true) {\r\n    const {value: fullValue, caretPos, entities} = getRichValueWithCaret(this.messageInput);\r\n    const pos = caretPos >= 0 ? caretPos : fullValue.length;\r\n    const prefix = fullValue.substr(0, pos);\r\n    const suffix = fullValue.substr(pos);\r\n\r\n    const matches = isHelper ? prefix.match(ChatInput.AUTO_COMPLETE_REG_EXP) : null;\r\n\r\n    const matchIndex = matches ? matches.index + (matches[0].length - matches[2].length) : prefix.length;\r\n    const newPrefix = prefix.slice(0, matchIndex);\r\n    const newValue = newPrefix + insertText + suffix;\r\n\r\n    // merge emojis\r\n    const hadEntities = parseEntities(fullValue);\r\n    mergeEntities(entities, hadEntities);\r\n\r\n    // max for additional whitespace\r\n    const insertLength = insertEntity ? Math.max(insertEntity.length, insertText.length) : insertText.length;\r\n    const addEntities: MessageEntity[] = [];\r\n    if(insertEntity) {\r\n      addEntities.push(insertEntity);\r\n      insertEntity.offset = matchIndex;\r\n    }\r\n\r\n    // add offset to entities next to emoji\r\n    const diff = matches ? insertLength - matches[2].length : insertLength;\r\n    entities.forEach((entity) => {\r\n      if(entity.offset >= matchIndex) {\r\n        entity.offset += diff;\r\n      }\r\n    });\r\n\r\n    mergeEntities(entities, addEntities);\r\n\r\n    if(/* caretPos !== -1 && caretPos !== fullValue.length */true) {\r\n      const caretEntity: MessageEntity.messageEntityCaret = {\r\n        _: 'messageEntityCaret',\r\n        offset: matchIndex + insertLength,\r\n        length: 0\r\n      };\r\n\r\n      let insertCaretAtIndex = 0;\r\n      for(let length = entities.length; insertCaretAtIndex < length; ++insertCaretAtIndex) {\r\n        const entity = entities[insertCaretAtIndex];\r\n        if(entity.offset > caretEntity.offset) {\r\n          break;\r\n        }\r\n      }\r\n\r\n      entities.splice(insertCaretAtIndex, 0, caretEntity);\r\n    }\r\n\r\n    // const saveExecuted = this.prepareDocumentExecute();\r\n    // can't exec .value here because it will instantly check for autocomplete\r\n    const value = documentFragmentToHTML(wrapDraftText(newValue, {entities}));\r\n    this.messageInputField.setValueSilently(value);\r\n\r\n    const caret = this.messageInput.querySelector('.composer-sel');\r\n    if(caret) {\r\n      setCaretAt(caret);\r\n      caret.remove();\r\n    }\r\n\r\n    // but it's needed to be checked only here\r\n    this.onMessageInput();\r\n\r\n    // saveExecuted();\r\n\r\n    // document.execCommand('insertHTML', true, wrapEmojiText(emoji));\r\n  }\r\n\r\n  public onEmojiSelected = (emoji: string, autocomplete: boolean) => {\r\n    this.insertAtCaret(emoji, getEmojiEntityFromEmoji(emoji), autocomplete);\r\n  };\r\n\r\n  private async checkAutocomplete(value?: string, caretPos?: number, entities?: MessageEntity[]) {\r\n    // return;\r\n\r\n    if(value === undefined) {\r\n      const r = getRichValueWithCaret(this.messageInputField.input, true);\r\n      value = r.value;\r\n      caretPos = r.caretPos;\r\n      entities = r.entities;\r\n    }\r\n\r\n    if(caretPos === -1) {\r\n      caretPos = value.length;\r\n    }\r\n\r\n    if(entities === undefined) {\r\n      const _value = parseMarkdown(value, entities, true);\r\n      entities = mergeEntities(entities, parseEntities(_value));\r\n    }\r\n\r\n    value = value.slice(0, caretPos);\r\n\r\n    if(this.previousQuery === value) {\r\n      return;\r\n    }\r\n\r\n    this.previousQuery = value;\r\n\r\n    const matches = value.match(ChatInput.AUTO_COMPLETE_REG_EXP);\r\n    let foundHelper: AutocompleteHelper;\r\n    if(matches) {\r\n      const entity = entities[0];\r\n\r\n      let query = matches[2];\r\n      const firstChar = query[0];\r\n\r\n      if(this.stickersHelper &&\r\n        rootScope.settings.stickers.suggest &&\r\n        await this.chat.canSend('send_stickers') &&\r\n        entity?._ === 'messageEntityEmoji' && entity.length === value.length && !entity.offset) {\r\n        foundHelper = this.stickersHelper;\r\n        this.stickersHelper.checkEmoticon(value);\r\n      } else if(firstChar === '@') { // mentions\r\n        const topMsgId = this.chat.threadId ? getServerMessageId(this.chat.threadId) : undefined;\r\n        if(await this.mentionsHelper.checkQuery(query, this.chat.peerId.isUser() ? NULL_PEER_ID : this.chat.peerId, topMsgId)) {\r\n          foundHelper = this.mentionsHelper;\r\n        }\r\n      } else if(!matches[1] && firstChar === '/') { // commands\r\n        if(await this.commandsHelper.checkQuery(query, this.chat.peerId)) {\r\n          foundHelper = this.commandsHelper;\r\n        }\r\n      } else if(rootScope.settings.emoji.suggest) { // emoji\r\n        query = query.replace(/^\\s*/, '');\r\n        if(!value.match(/^\\s*:(.+):\\s*$/) && !value.match(/:[;!@#$%^&*()-=|]/) && query) {\r\n          foundHelper = this.emojiHelper;\r\n          this.emojiHelper.checkQuery(query, firstChar);\r\n        }\r\n      }\r\n    }\r\n\r\n    foundHelper = this.checkInlineAutocomplete(value, foundHelper);\r\n\r\n    this.autocompleteHelperController.hideOtherHelpers(foundHelper);\r\n  }\r\n\r\n  private checkInlineAutocomplete(value: string, foundHelper?: AutocompleteHelper): AutocompleteHelper {\r\n    let needPlaceholder = false;\r\n\r\n    if(!foundHelper) {\r\n      const inlineMatch = value.match(/^@([a-zA-Z\\\\d_]{3,32})\\s/);\r\n      if(inlineMatch) {\r\n        const username = inlineMatch[1];\r\n        const query = value.slice(inlineMatch[0].length);\r\n        needPlaceholder = inlineMatch[0].length === value.length;\r\n\r\n        foundHelper = this.inlineHelper;\r\n\r\n        if(!this.btnPreloader) {\r\n          this.btnPreloader = ButtonIcon('none btn-preloader float show disable-hover', {noRipple: true});\r\n          putPreloader(this.btnPreloader, true);\r\n          this.inputMessageContainer.parentElement.insertBefore(this.btnPreloader, this.inputMessageContainer.nextSibling);\r\n        } else {\r\n          SetTransition(this.btnPreloader, 'show', true, 400);\r\n        }\r\n\r\n        this.inlineHelper.checkQuery(this.chat.peerId, username, query).then(({user, renderPromise}) => {\r\n          if(needPlaceholder && user.bot_inline_placeholder) {\r\n            this.messageInput.dataset.inlinePlaceholder = user.bot_inline_placeholder;\r\n          }\r\n\r\n          renderPromise.then(() => {\r\n            SetTransition(this.btnPreloader, 'show', false, 400);\r\n          });\r\n        }).catch(noop);\r\n      }\r\n    }\r\n\r\n    if(!needPlaceholder) {\r\n      delete this.messageInput.dataset.inlinePlaceholder;\r\n    }\r\n\r\n    if(foundHelper !== this.inlineHelper) {\r\n      if(this.btnPreloader) {\r\n        SetTransition(this.btnPreloader, 'show', false, 400);\r\n      }\r\n    }\r\n\r\n    return foundHelper;\r\n  }\r\n\r\n  private setRecording(value: boolean) {\r\n    if(this.recording === value) {\r\n      return;\r\n    }\r\n\r\n    SetTransition(this.chatInput, 'is-recording', value, 200);\r\n    this.recording = value;\r\n    this.updateSendBtn();\r\n  }\r\n\r\n  private onBtnSendClick = async(e: Event) => {\r\n    cancelEvent(e);\r\n\r\n    if(!this.recorder || this.recording || !this.isInputEmpty() || this.forwarding || this.editMsgId) {\r\n      if(this.recording) {\r\n        if((Date.now() - this.recordStartTime) < RECORD_MIN_TIME) {\r\n          this.onCancelRecordClick();\r\n        } else {\r\n          this.recorder.stop();\r\n        }\r\n      } else {\r\n        this.sendMessage();\r\n      }\r\n    } else {\r\n      const isAnyChat = this.chat.peerId.isAnyChat();\r\n      if(isAnyChat && !(await this.chat.canSend('send_media'))) {\r\n        toast(POSTING_MEDIA_NOT_ALLOWED);\r\n        return;\r\n      }\r\n\r\n      this.chatInput.classList.add('is-locked');\r\n      blurActiveElement();\r\n\r\n      let restricted = false;\r\n      if(!isAnyChat) {\r\n        const userFull = await this.managers.appProfileManager.getProfile(this.chat.peerId.toUserId());\r\n        if(userFull?.pFlags.voice_messages_forbidden) {\r\n          toastNew({\r\n            langPackKey: 'Chat.SendVoice.PrivacyError',\r\n            langPackArguments: [await wrapPeerTitle({peerId: this.chat.peerId})]\r\n          });\r\n          restricted = true;\r\n        }\r\n      }\r\n\r\n      if(restricted) {\r\n        this.chatInput.classList.remove('is-locked');\r\n        return;\r\n      }\r\n\r\n      this.recorder.start().then(() => {\r\n        this.releaseMediaPlayback = appMediaPlaybackController.setSingleMedia();\r\n        this.recordCanceled = false;\r\n\r\n        this.setRecording(true);\r\n        opusDecodeController.setKeepAlive(true);\r\n\r\n        const showDiscardPopup = () => {\r\n          new PopupPeer('popup-cancel-record', {\r\n            titleLangKey: 'DiscardVoiceMessageTitle',\r\n            descriptionLangKey: 'DiscardVoiceMessageDescription',\r\n            buttons: [{\r\n              langKey: 'DiscardVoiceMessageAction',\r\n              callback: () => {\r\n                simulateClickEvent(this.btnCancelRecord);\r\n              }\r\n            }, {\r\n              langKey: 'Continue',\r\n              isCancel: true\r\n            }]\r\n          }).show();\r\n        };\r\n\r\n        this.recordingOverlayListener = this.listenerSetter.add(document.body)('mousedown', (e) => {\r\n          if(!findUpClassName(e.target, 'chat-input') && !findUpClassName(e.target, 'popup-cancel-record')) {\r\n            cancelEvent(e);\r\n            showDiscardPopup();\r\n          }\r\n        }, {capture: true, passive: false}) as any;\r\n\r\n        appNavigationController.pushItem(this.recordingNavigationItem = {\r\n          type: 'voice',\r\n          onPop: () => {\r\n            setTimeout(() => {\r\n              showDiscardPopup();\r\n            }, 0);\r\n\r\n            return false;\r\n          }\r\n        });\r\n\r\n        this.recordStartTime = Date.now();\r\n\r\n        const sourceNode: MediaStreamAudioSourceNode = this.recorder.sourceNode;\r\n        const context = sourceNode.context;\r\n\r\n        const analyser = context.createAnalyser();\r\n        sourceNode.connect(analyser);\r\n        // analyser.connect(context.destination);\r\n        analyser.fftSize = 32;\r\n\r\n        const frequencyData = new Uint8Array(analyser.frequencyBinCount);\r\n        const max = frequencyData.length * 255;\r\n        const min = 54 / 150;\r\n        const r = () => {\r\n          if(!this.recording) return;\r\n\r\n          analyser.getByteFrequencyData(frequencyData);\r\n\r\n          let sum = 0;\r\n          frequencyData.forEach((value) => {\r\n            sum += value;\r\n          });\r\n\r\n          const percents = Math.min(1, (sum / max) + min);\r\n          // console.log('frequencyData', frequencyData, percents);\r\n\r\n          this.recordRippleEl.style.transform = `scale(${percents})`;\r\n\r\n          const diff = Date.now() - this.recordStartTime;\r\n          const ms = diff % 1000;\r\n\r\n          const formatted = toHHMMSS(diff / 1000) + ',' + ('00' + Math.round(ms / 10)).slice(-2);\r\n\r\n          this.recordTimeEl.innerText = formatted;\r\n\r\n          fastRaf(r);\r\n        };\r\n\r\n        r();\r\n      }).catch((e: Error) => {\r\n        switch(e.name as string) {\r\n          case 'NotAllowedError': {\r\n            toast('Please allow access to your microphone');\r\n            break;\r\n          }\r\n\r\n          case 'NotReadableError': {\r\n            toast(e.message);\r\n            break;\r\n          }\r\n\r\n          default:\r\n            console.error('Recorder start error:', e, e.name, e.message);\r\n            toast(e.message);\r\n            break;\r\n        }\r\n\r\n        this.setRecording(false);\r\n        this.chatInput.classList.remove('is-locked');\r\n      });\r\n    }\r\n  };\r\n\r\n  private onHelperCancel = async(e?: Event, force?: boolean) => {\r\n    if(e) {\r\n      cancelEvent(e);\r\n    }\r\n\r\n    if(this.willSendWebPage) {\r\n      const lastUrl = this.lastUrl;\r\n      let needReturn = false;\r\n      if(this.helperType) {\r\n        // if(this.helperFunc) {\r\n        await this.helperFunc();\r\n        // }\r\n\r\n        needReturn = true;\r\n      }\r\n\r\n      // * restore values\r\n      this.lastUrl = lastUrl;\r\n      this.noWebPage = true;\r\n      this.willSendWebPage = null;\r\n\r\n      if(needReturn) return;\r\n    }\r\n\r\n    if(this.helperType === 'edit' && !force) {\r\n      const message = this.editMessage\r\n      const value = parseMarkdown(this.messageInputField.value, []);\r\n      if(message.message !== value) {\r\n        new PopupPeer('discard-editing', {\r\n          buttons: [{\r\n            langKey: 'Alert.Confirm.Discard',\r\n            callback: () => {\r\n              this.onHelperCancel(undefined, true);\r\n            }\r\n          }],\r\n          descriptionLangKey: 'Chat.Edit.Cancel.Text'\r\n        }).show();\r\n\r\n        return;\r\n      }\r\n    }\r\n\r\n    this.clearHelper();\r\n    this.updateSendBtn();\r\n  };\r\n\r\n  private onHelperClick = (e: Event) => {\r\n    cancelEvent(e);\r\n\r\n    if(!findUpClassName(e.target, 'reply')) return;\r\n    if(this.helperType === 'forward') {\r\n      const {forwardElements} = this;\r\n      if(forwardElements && IS_TOUCH_SUPPORTED && !forwardElements.container.classList.contains('active')) {\r\n        contextMenuController.openBtnMenu(forwardElements.container);\r\n      }\r\n    } else if(this.helperType === 'reply') {\r\n      this.chat.setMessageId(this.replyToMsgId);\r\n    } else if(this.helperType === 'edit') {\r\n      this.chat.setMessageId(this.editMsgId);\r\n    }\r\n  };\r\n\r\n  private changeForwardRecipient() {\r\n    if(this.helperWaitingForward) return;\r\n    this.helperWaitingForward = true;\r\n\r\n    const forwarding = copy(this.forwarding);\r\n    const helperFunc = this.helperFunc;\r\n    this.clearHelper();\r\n    this.updateSendBtn();\r\n    let selected = false;\r\n    const popup = new PopupForward(forwarding, () => {\r\n      selected = true;\r\n    });\r\n\r\n    popup.addEventListener('close', () => {\r\n      this.helperWaitingForward = false;\r\n\r\n      if(!selected) {\r\n        helperFunc();\r\n      }\r\n    });\r\n  }\r\n\r\n  public async clearInput(canSetDraft = true, fireEvent = true, clearValue = '') {\r\n    if(document.activeElement === this.messageInput && IS_MOBILE_SAFARI) { // fix first char uppercase\r\n      const i = document.createElement('input');\r\n      document.body.append(i);\r\n      fixSafariStickyInput(i);\r\n      this.messageInputField.setValueSilently(clearValue);\r\n      fixSafariStickyInput(this.messageInput);\r\n      i.remove();\r\n    } else {\r\n      this.messageInputField.setValueSilently(clearValue);\r\n    }\r\n\r\n    if(IS_TOUCH_SUPPORTED) {\r\n      // this.messageInput.innerText = '';\r\n    } else {\r\n      // this.attachMessageInputField();\r\n      // this.messageInput.innerText = '';\r\n\r\n      // clear executions\r\n      this.canRedoFromHTML = '';\r\n      this.undoHistory.length = 0;\r\n      this.executedHistory.length = 0;\r\n      this.canUndoFromHTML = '';\r\n    }\r\n\r\n    let set = false;\r\n    if(canSetDraft) {\r\n      set = await this.setDraft(undefined, false);\r\n    }\r\n\r\n    if(!set && fireEvent) {\r\n      this.onMessageInput();\r\n    }\r\n  }\r\n\r\n  public isInputEmpty() {\r\n    return isInputEmpty(this.messageInput);\r\n  }\r\n\r\n  public updateSendBtn() {\r\n    let icon: 'send' | 'record' | 'edit' | 'schedule';\r\n\r\n    const isInputEmpty = this.isInputEmpty();\r\n\r\n    if(this.editMsgId) icon = 'edit';\r\n    else if(!this.recorder || this.recording || !isInputEmpty || this.forwarding) icon = this.chat.type === 'scheduled' ? 'schedule' : 'send';\r\n    else icon = 'record';\r\n\r\n    ['send', 'record', 'edit', 'schedule'].forEach((i) => {\r\n      this.btnSend.classList.toggle(i, icon === i);\r\n    });\r\n\r\n    if(this.btnScheduled) {\r\n      this.btnScheduled.classList.toggle('show', isInputEmpty);\r\n    }\r\n\r\n    if(this.btnToggleReplyMarkup) {\r\n      this.btnToggleReplyMarkup.classList.toggle('show', isInputEmpty);\r\n    }\r\n  }\r\n\r\n  public onMessageSent(clearInput = true, clearReply?: boolean) {\r\n    if(this.chat.type !== 'scheduled') {\r\n      this.managers.appMessagesManager.readAllHistory(this.chat.peerId, this.chat.threadId, true);\r\n    }\r\n\r\n    this.scheduleDate = undefined;\r\n    this.sendSilent = undefined;\r\n\r\n    const value = this.messageInputField.value;\r\n    const entities = parseEntities(value);\r\n    const emojiEntities: MessageEntity.messageEntityEmoji[] = entities.filter((entity) => entity._ === 'messageEntityEmoji') as any;\r\n    emojiEntities.forEach((entity) => {\r\n      const emoji = emojiFromCodePoints(entity.unicode);\r\n      this.managers.appEmojiManager.pushRecentEmoji(emoji);\r\n    });\r\n\r\n    if(clearInput) {\r\n      this.lastUrl = '';\r\n      delete this.noWebPage;\r\n      this.willSendWebPage = null;\r\n      this.clearInput();\r\n    }\r\n\r\n    if(clearReply || clearInput) {\r\n      this.clearHelper();\r\n    }\r\n\r\n    this.updateSendBtn();\r\n  }\r\n\r\n  public sendMessage(force = false) {\r\n    const {editMsgId, chat} = this;\r\n    if(chat.type === 'scheduled' && !force && !editMsgId) {\r\n      this.scheduleSending();\r\n      return;\r\n    }\r\n\r\n    const {peerId} = chat;\r\n    const {noWebPage} = this;\r\n    const sendingParams = this.chat.getMessageSendingParams();\r\n\r\n    const {value, entities} = getRichValue(this.messageInputField.input);\r\n\r\n    // return;\r\n    if(editMsgId) {\r\n      const message = this.editMessage;\r\n      if(value.trim() || message.media) {\r\n        this.managers.appMessagesManager.editMessage(message, value, {\r\n          entities,\r\n          noWebPage: noWebPage\r\n        });\r\n\r\n        this.onMessageSent();\r\n      } else {\r\n        new PopupDeleteMessages(peerId, [editMsgId], chat.type);\r\n\r\n        return;\r\n      }\r\n    } else if(value.trim()) {\r\n      this.managers.appMessagesManager.sendText(peerId, value, {\r\n        entities,\r\n        ...sendingParams,\r\n        noWebPage: noWebPage,\r\n        webPage: this.getWebPagePromise ? undefined : this.willSendWebPage,\r\n        clearDraft: true\r\n      });\r\n\r\n      if(this.chat.type === 'scheduled') {\r\n        this.onMessageSent(true);\r\n      } else {\r\n        this.onMessageSent(false, false);\r\n      }\r\n      // this.onMessageSent();\r\n    }\r\n\r\n    // * wait for sendText set messageId for invokeAfterMsg\r\n    if(this.forwarding) {\r\n      const forwarding = copy(this.forwarding);\r\n      // setTimeout(() => {\r\n      for(const fromPeerId in forwarding) {\r\n        this.managers.appMessagesManager.forwardMessages(peerId, fromPeerId.toPeerId(), forwarding[fromPeerId], {\r\n          ...sendingParams,\r\n          dropAuthor: this.forwardElements && this.forwardElements.hideSender.checkboxField.checked,\r\n          dropCaptions: this.isDroppingCaptions()\r\n        }).catch(async(err: ApiError) => {\r\n          if(err.type === 'VOICE_MESSAGES_FORBIDDEN') {\r\n            toastNew({\r\n              langPackKey: 'Chat.SendVoice.PrivacyError',\r\n              langPackArguments: [await wrapPeerTitle({peerId})]\r\n            });\r\n          }\r\n        });\r\n      }\r\n\r\n      if(!value) {\r\n        this.onMessageSent();\r\n      }\r\n      // }, 0);\r\n    }\r\n\r\n    // this.onMessageSent();\r\n  }\r\n\r\n  public async sendMessageWithDocument(\r\n    document: MyDocument | DocId,\r\n    force = false,\r\n    clearDraft = false,\r\n    silent = false\r\n  ) {\r\n    document = await this.managers.appDocsManager.getDoc(document);\r\n\r\n    const flag = document.type === 'sticker' ? 'send_stickers' : (document.type === 'gif' ? 'send_gifs' : 'send_media');\r\n    if(this.chat.peerId.isAnyChat() && !(await this.chat.canSend(flag))) {\r\n      toast(POSTING_MEDIA_NOT_ALLOWED);\r\n      return false;\r\n    }\r\n\r\n    if(this.chat.type === 'scheduled' && !force) {\r\n      this.scheduleSending(() => this.sendMessageWithDocument(document, true, clearDraft, silent));\r\n      return false;\r\n    }\r\n\r\n    if(!document) {\r\n      return false;\r\n    }\r\n\r\n    if(getStickerEffectThumb(document) && !rootScope.premium) {\r\n      return false;\r\n    }\r\n\r\n    this.managers.appMessagesManager.sendFile(this.chat.peerId, document, {\r\n      ...this.chat.getMessageSendingParams(),\r\n      isMedia: true,\r\n      clearDraft: clearDraft || undefined,\r\n      silent\r\n    });\r\n    this.onMessageSent(clearDraft, true);\r\n\r\n    if(document.type === 'sticker') {\r\n      emoticonsDropdown.stickersTab?.unshiftRecentSticker(document);\r\n    }\r\n\r\n    return true;\r\n  }\r\n\r\n  private canToggleHideAuthor() {\r\n    const {forwardElements} = this;\r\n    if(!forwardElements) return false;\r\n    const hideCaptionCheckboxField = forwardElements.hideCaption.checkboxField;\r\n    return !hideCaptionCheckboxField.checked ||\r\n      findUpTag(hideCaptionCheckboxField.label, 'FORM').classList.contains('hide');\r\n  }\r\n\r\n  private isDroppingCaptions() {\r\n    return !this.canToggleHideAuthor();\r\n  }\r\n\r\n  /* public sendSomething(callback: () => void, force = false) {\r\n    if(this.chat.type === 'scheduled' && !force) {\r\n      this.scheduleSending(() => this.sendSomething(callback, true));\r\n      return false;\r\n    }\r\n\r\n    callback();\r\n    this.onMessageSent(false, true);\r\n\r\n    return true;\r\n  } */\r\n\r\n  public async initMessageEditing(mid: number) {\r\n    const message = (await this.chat.getMessage(mid)) as Message.message;\r\n\r\n    let input = documentFragmentToHTML(wrapDraftText(message.message, {entities: message.totalEntities}));\r\n    const f = async() => {\r\n      const replyFragment = await wrapMessageForReply(message, undefined, [message.mid]);\r\n      this.setTopInfo('edit', f, i18n('AccDescrEditing'), replyFragment, input, message);\r\n\r\n      this.editMsgId = mid;\r\n      this.editMessage = message;\r\n      input = undefined;\r\n    };\r\n    f();\r\n  }\r\n\r\n  public initMessagesForward(fromPeerIdsMids: {[fromPeerId: PeerId]: number[]}) {\r\n    const f = async() => {\r\n      // const peerTitles: string[]\r\n      const fromPeerIds = Object.keys(fromPeerIdsMids).map((fromPeerId) => fromPeerId.toPeerId());\r\n      const smth: Set<string> = new Set();\r\n      let length = 0, messagesWithCaptionsLength = 0;\r\n\r\n      const p = fromPeerIds.map(async(fromPeerId) => {\r\n        const mids = fromPeerIdsMids[fromPeerId];\r\n        const promises = mids.map(async(mid) => {\r\n          const message = (await this.managers.appMessagesManager.getMessageByPeer(fromPeerId, mid)) as Message.message;\r\n          if(message.fwd_from?.from_name && !message.fromId && !message.fwdFromId) {\r\n            smth.add('N' + message.fwd_from.from_name);\r\n          } else {\r\n            smth.add('P' + message.fromId);\r\n          }\r\n\r\n          if(message.media && message.message) {\r\n            ++messagesWithCaptionsLength;\r\n          }\r\n        });\r\n\r\n        await Promise.all(promises);\r\n\r\n        length += mids.length;\r\n      });\r\n\r\n      await Promise.all(p);\r\n\r\n      const onlyFirstName = smth.size > 2;\r\n      const peerTitles = [...smth].map((smth) => {\r\n        const type = smth[0];\r\n        smth = smth.slice(1);\r\n        if(type === 'P') {\r\n          const peerId = smth.toPeerId();\r\n          return peerId === rootScope.myId ? i18n('Chat.Accessory.Forward.You') : new PeerTitle({peerId, dialog: false, onlyFirstName}).element;\r\n        } else {\r\n          return onlyFirstName ? smth.split(' ')[0] : smth;\r\n        }\r\n      });\r\n\r\n      const {forwardElements} = this;\r\n      const form = findUpTag(forwardElements.showCaption.checkboxField.label, 'FORM');\r\n      form.classList.toggle('hide', !messagesWithCaptionsLength);\r\n      const hideCaption = forwardElements.hideCaption.checkboxField.checked;\r\n      if(messagesWithCaptionsLength && hideCaption) {\r\n        forwardElements.hideSender.checkboxField.setValueSilently(true);\r\n      } else if(this.forwardWasDroppingAuthor !== undefined) {\r\n        (this.forwardWasDroppingAuthor ? forwardElements.hideSender : forwardElements.showSender).checkboxField.setValueSilently(true);\r\n      }\r\n\r\n      const titleKey: LangPackKey = forwardElements.showSender.checkboxField.checked ? 'Chat.Accessory.Forward' : 'Chat.Accessory.Hidden';\r\n      const title = i18n(titleKey, [length]);\r\n\r\n      const senderTitles = document.createDocumentFragment();\r\n      if(peerTitles.length < 3) {\r\n        senderTitles.append(...join(peerTitles, false));\r\n      } else {\r\n        senderTitles.append(peerTitles[0], i18n('AndOther', [peerTitles.length - 1]));\r\n      }\r\n\r\n      let firstMessage: Message.message, usingFullAlbum: boolean;\r\n      if(fromPeerIds.length === 1) {\r\n        const fromPeerId = fromPeerIds[0];\r\n        const mids = fromPeerIdsMids[fromPeerId];\r\n        firstMessage = (await this.managers.appMessagesManager.getMessageByPeer(fromPeerId, mids[0])) as Message.message;\r\n\r\n        usingFullAlbum = !!firstMessage.grouped_id;\r\n        if(usingFullAlbum) {\r\n          const albumMids = await this.managers.appMessagesManager.getMidsByMessage(firstMessage);\r\n          if(albumMids.length !== length || albumMids.find((mid) => !mids.includes(mid))) {\r\n            usingFullAlbum = false;\r\n          }\r\n        }\r\n      }\r\n\r\n      const subtitleFragment = document.createDocumentFragment();\r\n      const delimiter = ': ';\r\n      if(usingFullAlbum || length === 1) {\r\n        const mids = fromPeerIdsMids[fromPeerIds[0]];\r\n        const replyFragment = await wrapMessageForReply(firstMessage, undefined, mids);\r\n        subtitleFragment.append(\r\n          senderTitles,\r\n          delimiter,\r\n          replyFragment\r\n        );\r\n      } else {\r\n        subtitleFragment.append(\r\n          i18n('Chat.Accessory.Forward.From'),\r\n          delimiter,\r\n          senderTitles\r\n        );\r\n      }\r\n\r\n      const newReply = this.setTopInfo('forward', f, title, subtitleFragment);\r\n\r\n      forwardElements.modifyArgs.forEach((b, idx) => {\r\n        const text = b.textElement;\r\n        const intl: I18n.IntlElement = I18n.weakMap.get(text) as any;\r\n        intl.args = [idx < 2 ? fromPeerIds.length : messagesWithCaptionsLength];\r\n        intl.update();\r\n      });\r\n\r\n      if(this.forwardHover) {\r\n        this.forwardHover.attachButtonListener(newReply, this.listenerSetter);\r\n      }\r\n\r\n      this.forwarding = fromPeerIdsMids;\r\n    };\r\n\r\n    f();\r\n  }\r\n\r\n  public async initMessageReply(mid: number) {\r\n    if(this.replyToMsgId === mid) {\r\n      return;\r\n    }\r\n\r\n    let message = await this.chat.getMessage(mid);\r\n    const f = () => {\r\n      let peerTitleEl: HTMLElement;\r\n      if(!message) { // load missing replying message\r\n        peerTitleEl = i18n('Loading');\r\n\r\n        this.managers.appMessagesManager.wrapSingleMessage(this.chat.peerId, mid).then((_message) => {\r\n          if(this.replyToMsgId !== mid) {\r\n            return;\r\n          }\r\n\r\n          message = _message;\r\n          if(!message) {\r\n            this.clearHelper('reply');\r\n          } else {\r\n            f();\r\n          }\r\n        });\r\n      } else {\r\n        peerTitleEl = new PeerTitle({\r\n          peerId: message.fromId,\r\n          dialog: false\r\n        }).element;\r\n      }\r\n\r\n      this.setTopInfo('reply', f, peerTitleEl, message && (message as Message.message).message, undefined, message);\r\n      this.replyToMsgId = mid;\r\n    };\r\n    f();\r\n  }\r\n\r\n  public clearHelper(type?: ChatInputHelperType) {\r\n    if(this.helperType === 'edit' && type !== 'edit') {\r\n      this.clearInput();\r\n    }\r\n\r\n    if(type) {\r\n      this.lastUrl = '';\r\n      delete this.noWebPage;\r\n      this.willSendWebPage = null;\r\n    }\r\n\r\n    if(type !== 'reply') {\r\n      this.replyToMsgId = undefined;\r\n      this.forwarding = undefined;\r\n    }\r\n\r\n    this.editMsgId = this.editMessage = undefined;\r\n    this.helperType = this.helperFunc = undefined;\r\n\r\n    if(this.chat.container.classList.contains('is-helper-active')) {\r\n      appNavigationController.removeByType('input-helper');\r\n      this.chat.container.classList.remove('is-helper-active');\r\n      this.t();\r\n    }\r\n  }\r\n\r\n  private t() {\r\n    const className = 'is-toggling-helper';\r\n    SetTransition(this.chat.container, className, true, 150, () => {\r\n      this.chat.container.classList.remove(className);\r\n    });\r\n  }\r\n\r\n  public setInputValue(value: string, clear = true, focus = true) {\r\n    if(!value) value = '';\r\n\r\n    if(clear) this.clearInput(false, false, value);\r\n    else this.messageInputField.setValueSilently(value);\r\n\r\n    fastRaf(() => {\r\n      focus && placeCaretAtEnd(this.messageInput);\r\n      this.onMessageInput();\r\n      this.messageInput.scrollTop = this.messageInput.scrollHeight;\r\n    });\r\n  }\r\n\r\n  public setTopInfo(\r\n    type: ChatInputHelperType,\r\n    callerFunc: () => void,\r\n    title: Parameters<typeof wrapReply>[0] = '',\r\n    subtitle: Parameters<typeof wrapReply>[1] = '',\r\n    input?: string,\r\n    message?: any\r\n  ) {\r\n    if(this.willSendWebPage && type === 'reply') {\r\n      return;\r\n    }\r\n\r\n    if(type !== 'webpage') {\r\n      this.clearHelper(type);\r\n      this.helperType = type;\r\n      this.helperFunc = callerFunc;\r\n    }\r\n\r\n    const replyParent = this.replyElements.container;\r\n    const oldReply = replyParent.lastElementChild.previousElementSibling;\r\n    const haveReply = oldReply.classList.contains('reply');\r\n\r\n    this.replyElements.iconBtn.replaceWith(this.replyElements.iconBtn = ButtonIcon((type === 'webpage' ? 'link' : type) + ' active reply-icon', {noRipple: true}));\r\n    const {container} = wrapReply(title, subtitle, message);\r\n    if(haveReply) {\r\n      oldReply.replaceWith(container);\r\n    } else {\r\n      replyParent.insertBefore(container, replyParent.lastElementChild);\r\n    }\r\n\r\n    if(type === 'webpage') {\r\n      container.style.cursor = 'default';\r\n    }\r\n\r\n    if(!this.chat.container.classList.contains('is-helper-active')) {\r\n      this.chat.container.classList.add('is-helper-active');\r\n      this.t();\r\n    }\r\n\r\n    /* const scroll = appImManager.scrollable;\r\n    if(scroll.isScrolledDown && !scroll.scrollLocked && !appImManager.messagesQueuePromise && !appImManager.setPeerPromise) {\r\n      scroll.scrollTo(scroll.scrollHeight, 'top', true, true, 200);\r\n    } */\r\n\r\n    if(!IS_MOBILE) {\r\n      appNavigationController.pushItem({\r\n        type: 'input-helper',\r\n        onPop: () => {\r\n          this.onHelperCancel();\r\n        }\r\n      });\r\n    }\r\n\r\n    if(input !== undefined) {\r\n      this.setInputValue(input);\r\n    }\r\n\r\n    setTimeout(() => {\r\n      this.updateSendBtn();\r\n    }, 0);\r\n\r\n    return container;\r\n  }\r\n\r\n  // public saveScroll() {\r\n  //   this.scrollTop = this.chat.bubbles.scrollable.container.scrollTop;\r\n  //   this.scrollOffsetTop = this.chatInput.offsetTop;\r\n  // }\r\n\r\n  // public restoreScroll() {\r\n  //   if(this.chatInput.style.display) return;\r\n  //   //console.log('input resize', offsetTop, this.chatInput.offsetTop);\r\n  //   let newOffsetTop = this.chatInput.offsetTop;\r\n  //   let container = this.chat.bubbles.scrollable.container;\r\n  //   let scrollTop = container.scrollTop;\r\n  //   let clientHeight = container.clientHeight;\r\n  //   let maxScrollTop = container.scrollHeight;\r\n\r\n  //   if(newOffsetTop < this.scrollOffsetTop) {\r\n  //     this.scrollDiff = this.scrollOffsetTop - newOffsetTop;\r\n  //     container.scrollTop += this.scrollDiff;\r\n  //   } else if(scrollTop !== this.scrollTop) {\r\n  //     let endDiff = maxScrollTop - (scrollTop + clientHeight);\r\n  //     if(endDiff < this.scrollDiff/*  && false */) {\r\n  //       //container.scrollTop -= endDiff;\r\n  //     } else {\r\n  //       container.scrollTop -= this.scrollDiff;\r\n  //     }\r\n  //   }\r\n  // }\r\n}\r\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport documentFragmentToHTML from '../../helpers/dom/documentFragmentToHTML';\nimport {DraftMessage} from '../../layer';\nimport mergeEntities from '../../lib/richTextProcessor/mergeEntities';\nimport parseEntities from '../../lib/richTextProcessor/parseEntities';\nimport wrapDraftText from '../../lib/richTextProcessor/wrapDraftText';\n\nexport default function wrapDraft(draft: DraftMessage.draftMessage) {\n  const myEntities = parseEntities(draft.message);\n  const apiEntities = draft.entities || [];\n  const totalEntities = mergeEntities(apiEntities.slice(), myEntities); // ! only in this order, otherwise bold and emoji formatting won't work\n\n  return documentFragmentToHTML(wrapDraftText(draft.message, {entities: totalEntities}));\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nexport default function setCaretAt(node: Node) {\n  // node.appendChild(document.createTextNode(''));\n\n  const originalNode = node;\n  node = node.previousSibling;\n\n  if(node.nodeType === 1) {\n    const newNode = document.createTextNode('');\n    node.parentNode.insertBefore(newNode, !originalNode.nextSibling || originalNode.nextSibling.nodeType === node.nodeType ? originalNode : originalNode.nextSibling);\n    node = newNode;\n  }\n\n  if(window.getSelection && document.createRange) {\n    const range = document.createRange();\n    if(node) {\n      range.setStartAfter(node);\n      range.insertNode(node);\n      range.setStart(node, node.nodeValue.length);\n    }\n\n    range.collapse(true);\n\n    const sel = window.getSelection();\n    sel.removeAllRanges();\n    sel.addRange(range);\n  }\n}\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport type Chat from './chat';\r\nimport type ChatTopbar from './topbar';\r\nimport mediaSizes from '../../helpers/mediaSizes';\r\nimport DivAndCaption from '../divAndCaption';\r\nimport ripple from '../ripple';\r\nimport ListenerSetter from '../../helpers/listenerSetter';\r\nimport cancelEvent from '../../helpers/dom/cancelEvent';\r\nimport {attachClickEvent} from '../../helpers/dom/clickEvent';\r\nimport {Message} from '../../layer';\r\nimport safeAssign from '../../helpers/object/safeAssign';\r\n\r\nconst classNames: string[] = ['is-pinned-message-shown', 'is-pinned-audio-shown'];\r\nconst CLASSNAME_BASE = 'pinned-container';\r\nconst HEIGHT = 52;\r\n\r\nexport default class PinnedContainer {\r\n  public wrapperUtils: HTMLElement;\r\n  public btnClose: HTMLElement;\r\n  protected wrapper: HTMLElement;\r\n\r\n  protected topbar: ChatTopbar;\r\n  protected chat: Chat;\r\n  protected listenerSetter: ListenerSetter;\r\n  public className: string;\r\n  public divAndCaption: DivAndCaption<(title: string | HTMLElement | DocumentFragment, subtitle: string | HTMLElement | DocumentFragment, message?: any) => void>;\r\n\r\n  protected floating = false;\r\n\r\n  public onClose?: () => void | Promise<boolean>;\r\n\r\n  constructor(options: {\r\n    topbar: PinnedContainer['topbar'],\r\n    chat: PinnedContainer['chat'],\r\n    listenerSetter: PinnedContainer['listenerSetter'],\r\n    className: PinnedContainer['className'],\r\n    divAndCaption: PinnedContainer['divAndCaption'],\r\n    onClose?: PinnedContainer['onClose'],\r\n    floating?: PinnedContainer['floating']\r\n  }) {\r\n    safeAssign(this, options);\r\n\r\n    const {divAndCaption, className} = this;\r\n    divAndCaption.container.classList.add(CLASSNAME_BASE, 'hide');\r\n    divAndCaption.title.classList.add(CLASSNAME_BASE + '-title');\r\n    divAndCaption.subtitle.classList.add(CLASSNAME_BASE + '-subtitle');\r\n    divAndCaption.content.classList.add(CLASSNAME_BASE + '-content');\r\n\r\n    this.btnClose = document.createElement('button');\r\n    this.btnClose.classList.add(CLASSNAME_BASE + '-close', `pinned-${className}-close`, 'btn-icon', 'tgico-close');\r\n\r\n    this.wrapper = document.createElement('div');\r\n    this.wrapper.classList.add(CLASSNAME_BASE + '-wrapper');\r\n    ripple(this.wrapper);\r\n\r\n    this.wrapperUtils = document.createElement('div');\r\n    this.wrapperUtils.classList.add(CLASSNAME_BASE + '-wrapper-utils');\r\n    this.wrapperUtils.append(this.btnClose);\r\n\r\n    this.wrapper.append(...Array.from(divAndCaption.container.children), this.wrapperUtils);\r\n\r\n    divAndCaption.container.append(this.wrapper/* , this.close */);\r\n\r\n    this.attachOnCloseEvent(this.btnClose);\r\n  }\r\n\r\n  public attachOnCloseEvent(elem: HTMLElement) {\r\n    attachClickEvent(elem, (e) => {\r\n      cancelEvent(e);\r\n\r\n      ((this.onClose ? this.onClose() : null) || Promise.resolve(true)).then((needClose) => {\r\n        if(needClose) {\r\n          this.toggle(true);\r\n        }\r\n      });\r\n    }, {listenerSetter: this.listenerSetter});\r\n  }\r\n\r\n  public toggle(hide?: boolean) {\r\n    const isHidden = this.divAndCaption.container.classList.contains('hide');\r\n    if(hide === undefined) {\r\n      hide = !isHidden;\r\n    } else if(hide === isHidden) {\r\n      return;\r\n    }\r\n\r\n    // const scrollable = this.chat.bubbles.scrollable;\r\n\r\n    const isFloating = (this.floating || mediaSizes.isMobile) && !hide;\r\n    // const scrollTop = isFloating || this.divAndCaption.container.classList.contains('is-floating') ? scrollable.scrollTop : undefined;\r\n\r\n    this.divAndCaption.container.classList.toggle('is-floating', isFloating);\r\n    this.divAndCaption.container.classList.toggle('hide', hide);\r\n\r\n    this.topbar.container.classList.toggle('is-pinned-floating', isFloating);\r\n    this.topbar.container.classList.toggle(`is-pinned-${this.className}-shown`, !hide);\r\n\r\n    // const active = classNames.filter((className) => this.topbar.container.classList.contains(className));\r\n    // const maxActive = hide ? 0 : 1;\r\n\r\n    // * not sure when it became unneeded\r\n    // if(scrollTop !== undefined && active.length <= maxActive/*  && !scrollable.isScrolledDown */) {\r\n    //   scrollable.scrollTop = scrollTop + ((hide ? -1 : 1) * HEIGHT);\r\n    // }\r\n\r\n    this.topbar.setFloating();\r\n    this.topbar.setUtilsWidth();\r\n  }\r\n\r\n  public isVisible() {\r\n    return !this.divAndCaption.container.classList.contains('hide');\r\n  }\r\n\r\n  public isFloating() {\r\n    return this.divAndCaption.container.classList.contains('is-floating');\r\n  }\r\n\r\n  public fill(title: string | HTMLElement | DocumentFragment, subtitle: string | HTMLElement | DocumentFragment, message: Message.message) {\r\n    this.divAndCaption.container.dataset.peerId = '' + message.peerId;\r\n    this.divAndCaption.container.dataset.mid = '' + message.mid;\r\n    this.divAndCaption.fill(title, subtitle, message);\r\n    this.topbar.setUtilsWidth();\r\n  }\r\n}\r\n","// https://github.com/evgeny-nadymov/telegram-react/blob/master/src/Components/ColumnMiddle/PinnedMessageBorder.js\n\nenum BAR_HEIGHTS {\n  ONE = 32,\n  TWO = 15,\n  THREE = 10,\n  FOUR = 8,\n  MORE = 8\n};\n\nconst GAP = 1;\nconst WIDTH = 2;\nconst BASE_CLASS = 'pinned-message-border';\n\nexport default class PinnedMessageBorder {\n  private border: HTMLElement;\n  private wrapper: HTMLElement;\n  private svg: SVGSVGElement;\n  private defs: SVGDefsElement;\n  private clipPath: SVGClipPathElement;\n  private path: SVGPathElement;\n  private mark: HTMLElement;\n\n  private count: number;\n  private index: number;\n\n  private drawRect = (x: number, y: number, width: number, height: number, radius: number) => {\n    return `M${x},${y + radius}a${radius},${radius},0,0,1,${width},0v${height - 2 * radius}a${radius},${radius},0,0,1,${-width},0Z`;\n  };\n\n  private getClipPath = (id: string, barHeight: number, count: number) => {\n    const radius = 1;\n\n    let d = '';\n    /* if(count === 3) {\n      d = this.drawRect(0, 0, WIDTH, barHeight, radius)\n        + this.drawRect(0, barHeight + GAP, WIDTH, barHeight + 1, radius)\n        + this.drawRect(0, barHeight * 2 + GAP * 2 + 1, WIDTH, barHeight, radius);\n    } */if(count === 2) {\n      d = this.drawRect(0, 0, WIDTH, barHeight, radius) + this.drawRect(0, barHeight + GAP * 2, WIDTH, barHeight, radius);\n    } else {\n      for(let i = 0; i < count; ++i) {\n        d += this.drawRect(0, (barHeight + GAP) * i, WIDTH, barHeight, radius);\n      }\n    }\n\n    if(!this.clipPath) {\n      this.clipPath = document.createElementNS('http://www.w3.org/2000/svg', 'clipPath');\n      this.path = document.createElementNS('http://www.w3.org/2000/svg', 'path');\n\n      this.clipPath.append(this.path);\n    }\n\n    this.clipPath.id = id;\n    this.path.setAttributeNS(null, 'd', d);\n\n    return this.clipPath;\n  };\n\n  private getBarHeight = (count: number, index: number) => {\n    let barHeight: number;\n    if(count <= 1) {\n      barHeight = BAR_HEIGHTS.ONE;\n    } else if(count === 2) {\n      barHeight = BAR_HEIGHTS.TWO;\n    } else if(count === 3) {\n      barHeight = BAR_HEIGHTS.THREE;\n    } else if(count === 4) {\n      barHeight = BAR_HEIGHTS.FOUR;\n    } else if(count > 3) {\n      barHeight = BAR_HEIGHTS.MORE;\n    }\n\n    return barHeight;\n  };\n\n  private getMarkHeight = (count: number, index: number) => {\n    let markHeight: number;\n    if(count <= 1) {\n      markHeight = BAR_HEIGHTS.ONE;\n    } else if(count === 2) {\n      markHeight = BAR_HEIGHTS.TWO;\n    } else if(count === 3) {\n      markHeight = BAR_HEIGHTS.THREE;\n    } else if(count === 4) {\n      markHeight = BAR_HEIGHTS.FOUR;\n    } else if(count > 3) {\n      markHeight = BAR_HEIGHTS.MORE;\n    }\n\n    return markHeight;\n  };\n\n  private getMarkTranslateY = (index: number, barHeight: number, count: number) => {\n    if(count === 1) {\n      return 0;\n    } else if(count === 2) {\n      return !index ? 0 : barHeight + GAP;\n    }\n\n    if(count === 3) {\n      if(!index) {\n        return 0;\n      } else if(index === 1) {\n        return barHeight + GAP;\n      }\n\n      return barHeight * 2 + GAP * 2 + 1;\n    } else {\n      return (barHeight + GAP) * index;\n    }\n  };\n\n  private getTrackTranslateY = (index: number, count: number, barHeight: number, trackHeight: number) => {\n    if(count <= 4) {\n      return 0;\n    }\n\n    if(index <= 1) {\n      return 0;\n    } else if(index >= (count - 2)) {\n      return trackHeight - BAR_HEIGHTS.ONE - barHeight;\n    }\n\n    // return (index + 1) * barHeight + index * GAP;\n    return (index - 2) * barHeight + index * GAP;\n    // return (barHeight + GAP * 2) / 2 + (index - 2) * (barHeight + GAP);\n  };\n\n  private getTrackHeight = (count: number, barHeight: number) => {\n    return count <= 3 ? BAR_HEIGHTS.ONE : barHeight * count + GAP * (count - 1);\n  };\n\n  public render(count: number, index: number) {\n    if(!this.border) {\n      this.border = document.createElement('div');\n      this.border.classList.add(BASE_CLASS);\n\n      this.wrapper = document.createElement('div');\n      this.border.append(this.wrapper);\n    }\n\n    if(count === 1) {\n      if(this.count !== count) {\n        this.wrapper.className = BASE_CLASS + '-wrapper-1';\n        this.border.classList.remove(BASE_CLASS + '-mask');\n        this.wrapper.innerHTML = this.wrapper.style.cssText = '';\n      }\n\n      return this.border;\n    }\n\n    const barHeight = this.getBarHeight(count, index);\n    const markHeight = this.getMarkHeight(count, index);\n    const trackHeight = this.getTrackHeight(count, barHeight);\n\n    const clipPathId = `clipPath_${count}`;\n    const clipPath = this.getClipPath(clipPathId, barHeight, count);\n\n    const markTranslateY = this.getMarkTranslateY(index, barHeight, count);\n    const trackTranslateY = this.getTrackTranslateY(index, count, barHeight, trackHeight);\n\n    this.border.classList.toggle(BASE_CLASS + '-mask', count > 4);\n\n    if(index <= 1) {\n      this.border.classList.add('mask-bottom');\n      this.border.classList.remove('mask-top');\n    } else if(index >= (count - 2)) {\n      this.border.classList.add('mask-top');\n      this.border.classList.remove('mask-bottom');\n    } else {\n      this.border.classList.add('mask-top', 'mask-bottom');\n    }\n\n    this.wrapper.className = BASE_CLASS + '-wrapper';\n    this.wrapper.style.cssText = `clip-path: url(#${clipPathId}); width: 2px; height: ${trackHeight}px; transform: translateY(-${trackTranslateY}px);`;\n\n    if(!this.svg) {\n      this.svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');\n      this.svg.setAttributeNS(null, 'height', '0');\n      this.svg.setAttributeNS(null, 'width', '0');\n\n      this.defs = document.createElementNS('http://www.w3.org/2000/svg', 'defs');\n      this.defs.append(clipPath);\n\n      this.svg.append(this.defs);\n\n      this.mark = document.createElement('div');\n      this.mark.classList.add(BASE_CLASS + '-mark');\n    }\n\n    if(!this.svg.parentElement) {\n      this.wrapper.append(this.svg, this.mark);\n    }\n\n    this.mark.style.cssText = `height: ${markHeight}px; transform: translateY(${markTranslateY}px);`;\n\n    this.count = count;\n    this.index = index;\n\n    return this.border;\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport type {AppMessagesManager} from '../../lib/appManagers/appMessagesManager';\nimport type ChatTopbar from './topbar';\nimport rootScope from '../../lib/rootScope';\nimport appMediaPlaybackController, {AppMediaPlaybackController} from '../appMediaPlaybackController';\nimport DivAndCaption from '../divAndCaption';\nimport PinnedContainer from './pinnedContainer';\nimport Chat from './chat';\nimport cancelEvent from '../../helpers/dom/cancelEvent';\nimport {attachClickEvent} from '../../helpers/dom/clickEvent';\nimport replaceContent from '../../helpers/dom/replaceContent';\nimport PeerTitle from '../peerTitle';\nimport {i18n} from '../../lib/langPack';\nimport {formatFullSentTime} from '../../helpers/date';\nimport ButtonIcon from '../buttonIcon';\nimport {DocumentAttribute} from '../../layer';\nimport MediaProgressLine from '../mediaProgressLine';\nimport VolumeSelector from '../volumeSelector';\nimport wrapEmojiText from '../../lib/richTextProcessor/wrapEmojiText';\nimport {AppManagers} from '../../lib/appManagers/managers';\n\nexport default class ChatAudio extends PinnedContainer {\n  private toggleEl: HTMLElement;\n  private progressLine: MediaProgressLine;\n  private volumeSelector: VolumeSelector;\n  private fasterEl: HTMLElement;\n  private repeatEl: HTMLButtonElement;\n\n  constructor(protected topbar: ChatTopbar, protected chat: Chat, protected managers: AppManagers) {\n    super({\n      topbar,\n      chat,\n      listenerSetter: topbar.listenerSetter,\n      className: 'audio',\n      divAndCaption: new DivAndCaption(\n        'pinned-audio',\n        (title: string | HTMLElement | DocumentFragment, subtitle: string | HTMLElement | DocumentFragment) => {\n          replaceContent(this.divAndCaption.title, title);\n          replaceContent(this.divAndCaption.subtitle, subtitle);\n        }\n      ),\n      onClose: () => {\n        appMediaPlaybackController.stop();\n      },\n      floating: true\n    });\n\n    this.divAndCaption.border.remove();\n\n    const prevEl = ButtonIcon('fast_rewind active', {noRipple: true});\n    const nextEl = ButtonIcon('fast_forward active', {noRipple: true});\n\n    const attachClick = (elem: HTMLElement, callback: () => void) => {\n      attachClickEvent(elem, (e) => {\n        cancelEvent(e);\n        callback();\n      }, {listenerSetter: this.topbar.listenerSetter});\n    };\n\n    attachClick(prevEl, () => {\n      appMediaPlaybackController.previous();\n    });\n\n    attachClick(nextEl, () => {\n      appMediaPlaybackController.next();\n    });\n\n    this.toggleEl = ButtonIcon('', {noRipple: true});\n    this.toggleEl.classList.add('active', 'pinned-audio-ico', 'tgico');\n    attachClick(this.toggleEl, () => {\n      appMediaPlaybackController.toggle();\n    });\n    this.wrapper.prepend(this.wrapper.firstElementChild, prevEl, this.toggleEl, nextEl);\n\n    this.volumeSelector = new VolumeSelector(this.listenerSetter, true);\n    const volumeProgressLineContainer = document.createElement('div');\n    volumeProgressLineContainer.classList.add('progress-line-container');\n    volumeProgressLineContainer.append(this.volumeSelector.container);\n    const tunnel = document.createElement('div');\n    tunnel.classList.add('pinned-audio-volume-tunnel');\n    this.volumeSelector.btn.classList.add('pinned-audio-volume', 'active');\n    this.volumeSelector.btn.prepend(tunnel);\n    this.volumeSelector.btn.append(volumeProgressLineContainer);\n\n    this.repeatEl = ButtonIcon('audio_repeat', {noRipple: true});\n    attachClick(this.repeatEl, () => {\n      const params = appMediaPlaybackController.getPlaybackParams();\n      if(!params.round) {\n        appMediaPlaybackController.round = true;\n      } else if(params.loop) {\n        appMediaPlaybackController.round = false;\n        appMediaPlaybackController.loop = false;\n      } else {\n        appMediaPlaybackController.loop = !appMediaPlaybackController.loop;\n      }\n    });\n\n    const fasterEl = this.fasterEl = ButtonIcon('playback_2x', {noRipple: true});\n    attachClick(fasterEl, () => {\n      appMediaPlaybackController.playbackRate = fasterEl.classList.contains('active') ? 1 : 1.75;\n    });\n\n    this.wrapperUtils.prepend(this.volumeSelector.btn, fasterEl, this.repeatEl);\n\n    const progressWrapper = document.createElement('div');\n    progressWrapper.classList.add('pinned-audio-progress-wrapper');\n\n    this.progressLine = new MediaProgressLine(undefined, undefined, true, true);\n    this.progressLine.container.classList.add('pinned-audio-progress');\n    progressWrapper.append(this.progressLine.container);\n    this.wrapper.insertBefore(progressWrapper, this.wrapperUtils);\n\n    this.topbar.listenerSetter.add(appMediaPlaybackController)('play', this.onMediaPlay);\n    this.topbar.listenerSetter.add(appMediaPlaybackController)('pause', this.onPause);\n    this.topbar.listenerSetter.add(appMediaPlaybackController)('stop', this.onStop);\n    this.topbar.listenerSetter.add(appMediaPlaybackController)('playbackParams', this.onPlaybackParams);\n\n    const playingDetails = appMediaPlaybackController.getPlayingDetails();\n    if(playingDetails) {\n      this.onMediaPlay(playingDetails);\n      this.onPlaybackParams(playingDetails.playbackParams);\n    }\n  }\n\n  public destroy() {\n    if(this.progressLine) {\n      this.progressLine.removeListeners();\n    }\n  }\n\n  private onPlaybackParams = (playbackParams: ReturnType<AppMediaPlaybackController['getPlaybackParams']>) => {\n    this.fasterEl.classList.toggle('active', playbackParams.playbackRate > 1);\n\n    this.repeatEl.classList.remove('tgico-audio_repeat', 'tgico-audio_repeat_single');\n    this.repeatEl.classList.add(playbackParams.loop ? 'tgico-audio_repeat_single' : 'tgico-audio_repeat');\n    this.repeatEl.classList.toggle('active', playbackParams.loop || playbackParams.round);\n  };\n\n  private onPause = () => {\n    this.toggleEl.classList.remove('flip-icon');\n  };\n\n  private onStop = () => {\n    this.toggle(true);\n  };\n\n  private onMediaPlay = ({doc, message, media, playbackParams}: ReturnType<AppMediaPlaybackController['getPlayingDetails']>) => {\n    let title: string | HTMLElement | DocumentFragment, subtitle: string | HTMLElement | DocumentFragment;\n    const isMusic = doc.type !== 'voice' && doc.type !== 'round';\n    if(!isMusic) {\n      title = new PeerTitle({peerId: message.fromId, fromName: message.fwd_from?.from_name}).element;\n\n      // subtitle = 'Voice message';\n      subtitle = formatFullSentTime(message.date);\n    } else {\n      const audioAttribute = doc.attributes.find((attr) => attr._ === 'documentAttributeAudio') as DocumentAttribute.documentAttributeAudio;\n      title = wrapEmojiText(audioAttribute?.title ?? doc.file_name);\n      subtitle = audioAttribute?.performer ? wrapEmojiText(audioAttribute.performer) : i18n('AudioUnknownArtist');\n    }\n\n    this.fasterEl.classList.toggle('hide', isMusic);\n    this.repeatEl.classList.toggle('hide', !isMusic);\n\n    this.onPlaybackParams(playbackParams);\n    this.volumeSelector.setVolume();\n\n    this.progressLine.setMedia(media);\n\n    this.fill(title, subtitle, message);\n    // this.toggleEl.classList.add('flip-icon');\n    this.toggleEl.classList.toggle('flip-icon', !media.paused);\n    this.toggle(false);\n  };\n}\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport type ChatTopbar from './topbar';\r\nimport PopupPinMessage from '../popups/unpinMessage';\r\nimport PinnedContainer from './pinnedContainer';\r\nimport PinnedMessageBorder from './pinnedMessageBorder';\r\nimport ReplyContainer, {wrapReplyDivAndCaption} from './replyContainer';\r\nimport rootScope from '../../lib/rootScope';\r\nimport Chat from './chat';\r\nimport ListenerSetter from '../../helpers/listenerSetter';\r\nimport ButtonIcon from '../buttonIcon';\r\nimport {getHeavyAnimationPromise} from '../../hooks/useHeavyAnimationCheck';\r\nimport {i18n} from '../../lib/langPack';\r\nimport cancelEvent from '../../helpers/dom/cancelEvent';\r\nimport {attachClickEvent} from '../../helpers/dom/clickEvent';\r\nimport handleScrollSideEvent from '../../helpers/dom/handleScrollSideEvent';\r\nimport debounce from '../../helpers/schedulers/debounce';\r\nimport throttle from '../../helpers/schedulers/throttle';\r\nimport {AppManagers} from '../../lib/appManagers/managers';\r\nimport {Message} from '../../layer';\r\nimport {logger} from '../../lib/logger';\r\n\r\nclass AnimatedSuper {\r\n  static DURATION = 200;\r\n  static BASE_CLASS = 'animated-super';\r\n  container: HTMLDivElement;\r\n  rows: {[index: string]: {element: HTMLElement, timeout?: number, new?: true}} = {};\r\n  clearTimeout: number;\r\n\r\n  constructor() {\r\n    this.container = document.createElement('div');\r\n    this.container.className = AnimatedSuper.BASE_CLASS;\r\n  }\r\n\r\n  public getRow(index: number, animateFirst = false) {\r\n    if(this.rows[index]) return this.rows[index].element;\r\n    const row = document.createElement('div');\r\n    const isFirst = !Object.keys(this.rows).length && !animateFirst;\r\n    row.className = AnimatedSuper.BASE_CLASS + '-row' + (isFirst ? '' : ' is-hiding hide');\r\n    this.rows[index] = {element: row, new: true};\r\n    this.container.append(row);\r\n    return row;\r\n  }\r\n\r\n  public clearRow(index: number) {\r\n    if(!this.rows[index]) return;\r\n    this.rows[index].element.remove();\r\n    delete this.rows[index];\r\n  }\r\n\r\n  public clearRows(currentIndex?: number) {\r\n    if(this.clearTimeout) clearTimeout(this.clearTimeout);\r\n    this.clearTimeout = window.setTimeout(() => {\r\n      for(const i in this.rows) {\r\n        if(+i === currentIndex) continue;\r\n        this.clearRow(+i);\r\n      }\r\n    }, AnimatedSuper.DURATION);\r\n  }\r\n\r\n  public setNewRow(index: number, reflow = false) {\r\n    const row = this.rows[index];\r\n    if(row.new) {\r\n      if(reflow) {\r\n        row.element.classList.remove('hide');\r\n        void row.element.offsetLeft; // reflow\r\n      } else {\r\n        row.element.classList.remove('is-hiding', 'hide');\r\n      }\r\n\r\n      delete row.new;\r\n    }\r\n\r\n    this.clearRows(index);\r\n  }\r\n\r\n  public animate(index: number, previousIndex: number, fromTop = index > previousIndex, ignorePrevious = false) {\r\n    if(index === previousIndex) { // * handle if set index 0 and previousIndex 0\r\n      return this.setNewRow(index);\r\n    }\r\n\r\n    const row = this.rows[index];\r\n    const previousRow = this.rows[previousIndex];\r\n    if(!previousRow && !ignorePrevious) {\r\n      return this.setNewRow(index);\r\n    }\r\n\r\n    const sides = ['from-top', 'from-bottom'];\r\n    if(!fromTop) sides.reverse();\r\n\r\n    row.element.classList.add(sides[0]);\r\n    row.element.classList.remove(sides[1]);\r\n    if(previousRow) {\r\n      previousRow.element.classList.add(sides[1]);\r\n      previousRow.element.classList.remove(sides[0]);\r\n    }\r\n\r\n    if(row.new) {\r\n      this.setNewRow(index, true);\r\n    }\r\n\r\n    row.element.classList.toggle('is-hiding', false);\r\n    previousRow && previousRow.element.classList.toggle('is-hiding', true);\r\n\r\n    /* const height = row.element.getBoundingClientRect().height;\r\n    row.element.style.transform = `translateY(${fromTop ? height * -1 : height}px)`;\r\n    if(previousRow) {\r\n      previousRow.element.style.transform = `translateY(${fromTop ? height : height * -1}px)`;\r\n    } */\r\n\r\n    /* row.element.style.setProperty('--height', row.element.getBoundingClientRect().height + 'px');\r\n    if(previousRow) {\r\n      previousRow.element.style.setProperty('--height', previousRow.element.getBoundingClientRect().height + 'px');\r\n    } */\r\n\r\n    this.clearRows(index);\r\n  }\r\n}\r\n\r\nclass AnimatedCounter {\r\n  static EMPTY_INDEX = -1;\r\n  static BASE_CLASS = 'animated-counter';\r\n  container: HTMLElement;\r\n  decimals: {\r\n    container: HTMLElement,\r\n    placeholder: HTMLElement,\r\n    animatedSuper: AnimatedSuper\r\n  }[] = [];\r\n  previousNumber = 0;\r\n  clearTimeout: number;\r\n\r\n  constructor(private reverse = false) {\r\n    this.container = document.createElement('div');\r\n    this.container.className = AnimatedCounter.BASE_CLASS;\r\n  }\r\n\r\n  getDecimal(index: number) {\r\n    if(this.decimals[index]) return this.decimals[index];\r\n    const item = document.createElement('div');\r\n    item.className = AnimatedCounter.BASE_CLASS + '-decimal';\r\n\r\n    const placeholder = document.createElement('div');\r\n    placeholder.className = AnimatedCounter.BASE_CLASS + '-decimal-placeholder';\r\n\r\n    const animatedSuper = new AnimatedSuper();\r\n    animatedSuper.container.className = AnimatedCounter.BASE_CLASS + '-decimal-wrapper';\r\n\r\n    item.append(placeholder, animatedSuper.container);\r\n\r\n    this.container.append(item);\r\n\r\n    return this.decimals[index] = {container: item, placeholder, animatedSuper};\r\n  }\r\n\r\n  clear(number: number) {\r\n    if(this.clearTimeout) clearTimeout(this.clearTimeout);\r\n\r\n    const decimals = ('' + number).length;\r\n    if(decimals >= this.decimals.length) {\r\n      return;\r\n    }\r\n\r\n    this.clearTimeout = window.setTimeout(() => {\r\n      const byDecimal = this.decimals.splice(decimals, this.decimals.length - decimals);\r\n      byDecimal.forEach((decimal) => {\r\n        decimal.container.remove();\r\n      });\r\n    }, AnimatedSuper.DURATION);\r\n  }\r\n\r\n  /* prepareNumber(number: number) {\r\n    const decimals = ('' + number).length;\r\n    if(this.decimals.length < decimals) {\r\n      for(let i = this.decimals.length; i < decimals; ++i) {\r\n        this.getDecimal(i);\r\n      }\r\n    }\r\n  } */\r\n\r\n  hideLeft(number: number) {\r\n    const decimals = ('' + number).length;\r\n    const byDecimal = this.decimals.slice(decimals);// this.decimals.splice(deleteCount, this.decimals.length - deleteCount);\r\n    byDecimal.forEach((decimal) => {\r\n      const previousDecimalNumber = +decimal.placeholder.innerText || 0;\r\n      const row = decimal.animatedSuper.getRow(AnimatedCounter.EMPTY_INDEX, true);\r\n      decimal.animatedSuper.animate(AnimatedCounter.EMPTY_INDEX, previousDecimalNumber, this.reverse ? number < this.previousNumber : number > this.previousNumber, true);\r\n    });\r\n\r\n    this.clear(number);\r\n  }\r\n\r\n  setCount(number: number) {\r\n    // this.prepareNumber(number);\r\n\r\n    const previousByDecimal = Array.from('' + this.previousNumber).map((n) => +n);\r\n    const byDecimal = Array.from('' + number).map((n) => +n);\r\n    byDecimal.forEach((decimalNumber, idx) => {\r\n      const decimal = this.getDecimal(idx);\r\n      // const row = decimal.animatedSuper.getRow(number, true);\r\n      const row = decimal.animatedSuper.getRow(decimalNumber, true);\r\n      const previousDecimalNumber = previousByDecimal[idx] ?? AnimatedCounter.EMPTY_INDEX;\r\n      row.innerText = decimal.placeholder.innerText = '' + decimalNumber;\r\n      // decimal.animatedSuper.animate(number, this.previousNumber, this.reverse ? number < this.previousNumber : number > this.previousNumber, true);\r\n      decimal.animatedSuper.animate(decimalNumber, previousDecimalNumber, this.reverse ? number < this.previousNumber : number > this.previousNumber, true);\r\n    });\r\n\r\n    this.hideLeft(number);\r\n    // this.clear(number);\r\n    this.previousNumber = number;\r\n  }\r\n}\r\n\r\nexport default class ChatPinnedMessage {\r\n  private static LOAD_COUNT = 50;\r\n  private static LOAD_OFFSET = 5;\r\n\r\n  public pinnedMessageContainer: PinnedContainer;\r\n  private pinnedMessageBorder: PinnedMessageBorder;\r\n\r\n  private pinnedMaxMid = 0;\r\n  public pinnedMid = 0;\r\n  public pinnedIndex = -1;\r\n  private wasPinnedIndex = 0;\r\n  private wasPinnedMediaIndex = 0;\r\n\r\n  public locked = false;\r\n  private waitForScrollBottom = false;\r\n\r\n  public count = 0;\r\n  private mids: number[] = [];\r\n  private offsetIndex = 0;\r\n\r\n  private loading = false;\r\n  private loadedBottom = false;\r\n  private loadedTop = false;\r\n\r\n  private animatedSubtitle: AnimatedSuper;\r\n  private animatedMedia: AnimatedSuper;\r\n  private animatedCounter: AnimatedCounter;\r\n\r\n  private listenerSetter: ListenerSetter;\r\n  private scrollDownListenerSetter: ListenerSetter = null;\r\n\r\n  public hidden = false;\r\n\r\n  private getCurrentIndexPromise: Promise<any> = null;\r\n  private btnOpen: HTMLButtonElement;\r\n\r\n  private setPinnedMessage: () => void;\r\n\r\n  private isStatic: boolean;\r\n\r\n  private debug: boolean;\r\n\r\n  public setCorrectIndexThrottled: (lastScrollDirection?: number) => void;\r\n\r\n  private log: ReturnType<typeof logger>;\r\n\r\n  constructor(private topbar: ChatTopbar, private chat: Chat, private managers: AppManagers) {\r\n    this.listenerSetter = new ListenerSetter();\r\n    this.log = logger('PM');\r\n    this.debug = true;\r\n    this.isStatic = false;\r\n\r\n    const dAC = new ReplyContainer('pinned-message');\r\n    this.pinnedMessageContainer = new PinnedContainer({\r\n      topbar,\r\n      chat,\r\n      listenerSetter: this.listenerSetter,\r\n      className: 'message',\r\n      divAndCaption: dAC,\r\n      onClose: async() => {\r\n        if(await managers.appPeersManager.canPinMessage(this.chat.peerId)) {\r\n          new PopupPinMessage(this.chat.peerId, this.pinnedMid, true);\r\n        } else {\r\n          new PopupPinMessage(this.chat.peerId, 0, true);\r\n        }\r\n\r\n        return false;\r\n      }\r\n    });\r\n\r\n    this.pinnedMessageBorder = new PinnedMessageBorder();\r\n    dAC.border.replaceWith(this.pinnedMessageBorder.render(1, 0));\r\n\r\n    this.animatedSubtitle = new AnimatedSuper();\r\n    dAC.subtitle.append(this.animatedSubtitle.container);\r\n\r\n    this.animatedMedia = new AnimatedSuper();\r\n    this.animatedMedia.container.classList.add('pinned-message-media-container');\r\n    dAC.content.prepend(this.animatedMedia.container);\r\n\r\n    this.animatedCounter = new AnimatedCounter(true);\r\n    dAC.title.append(i18n('PinnedMessage'), ' ', this.animatedCounter.container);\r\n\r\n    const btnClose = this.pinnedMessageContainer.btnClose.cloneNode(true) as HTMLElement;\r\n    this.pinnedMessageContainer.attachOnCloseEvent(btnClose);\r\n    dAC.container.prepend(btnClose);\r\n\r\n    this.btnOpen = ButtonIcon('pinlist pinned-container-close pinned-message-pinlist', {noRipple: true});\r\n\r\n    this.pinnedMessageContainer.wrapperUtils.prepend(this.btnOpen);\r\n\r\n    attachClickEvent(this.btnOpen, (e) => {\r\n      cancelEvent(e);\r\n      this.topbar.openPinned(true);\r\n    }, {listenerSetter: this.listenerSetter});\r\n\r\n    this.listenerSetter.add(rootScope)('peer_pinned_messages', ({peerId}) => {\r\n      if(peerId === this.chat.peerId) {\r\n        // this.wasPinnedIndex = 0;\r\n        // setTimeout(() => {\r\n        if(this.hidden) {\r\n          this.pinnedMessageContainer.toggle(this.hidden = false);\r\n        }\r\n\r\n        this.loadedTop = this.loadedBottom = false;\r\n        this.pinnedIndex = -1;\r\n        this.pinnedMid = 0;\r\n        this.count = 0;\r\n        this.mids = [];\r\n        this.offsetIndex = 0;\r\n        this.pinnedMaxMid = 0;\r\n        this.setCorrectIndex(0);\r\n        // }, 300);\r\n      }\r\n    });\r\n\r\n    this.listenerSetter.add(rootScope)('peer_pinned_hidden', ({peerId}) => {\r\n      if(peerId === this.chat.peerId) {\r\n        this.pinnedMessageContainer.toggle(this.hidden = true);\r\n      }\r\n    });\r\n\r\n    // * 200 - no lags\r\n    // * 100 - need test\r\n    this.setPinnedMessage = debounce(() => this._setPinnedMessage(), 100, true, true);\r\n    this.setCorrectIndexThrottled = throttle(this.setCorrectIndex.bind(this), 100, false);\r\n\r\n    this.isStatic = this.chat.type === 'discussion';\r\n  }\r\n\r\n  public destroy() {\r\n    this.pinnedMessageContainer.divAndCaption.container.remove();\r\n    this.pinnedMessageContainer.toggle(true);\r\n    this.listenerSetter.removeAll();\r\n    this.unsetScrollDownListener(false);\r\n  }\r\n\r\n  public setCorrectIndex(lastScrollDirection?: number) {\r\n    if(this.isStatic) return;\r\n    // return;\r\n\r\n    if(this.locked || this.hidden/*  || this.chat.setPeerPromise || this.chat.bubbles.messagesQueuePromise */) {\r\n      return;\r\n    }\r\n\r\n    if((this.loadedBottom || this.loadedTop) && !this.count) {\r\n      return;\r\n    }\r\n\r\n    // const perf = performance.now();\r\n    const el = this.chat.bubbles.getBubbleByPoint('bottom');\r\n    // this.log('setCorrectIndex: get last element perf:', performance.now() - perf, el);\r\n    if(!el) return;\r\n\r\n    // return;\r\n\r\n    const mid = el.dataset.mid;\r\n    if(el && mid !== undefined) {\r\n      // this.log('setCorrectIndex will test mid:', mid);\r\n      this.testMid(+mid, lastScrollDirection);\r\n    }\r\n  }\r\n\r\n  public testMid(mid: number, lastScrollDirection?: number) {\r\n    if(this.isStatic) return;\r\n\r\n    // if(lastScrollDirection !== undefined) return;\r\n    if(this.hidden) return;\r\n\r\n    // this.log('testMid', mid);\r\n\r\n    let currentIndex: number = this.mids.findIndex((_mid) => _mid <= mid);\r\n    if(currentIndex !== -1 && !this.isNeededMore(currentIndex)) {\r\n      currentIndex += this.offsetIndex;\r\n    } else if(this.loadedTop && mid < this.mids[this.mids.length - 1]) {\r\n      // currentIndex = 0;\r\n      currentIndex = this.mids.length - 1 + this.offsetIndex;\r\n    } else {\r\n      if(!this.getCurrentIndexPromise) {\r\n        this.getCurrentIndexPromise = this.getCurrentIndex(mid, lastScrollDirection !== undefined);\r\n      }\r\n\r\n      return;\r\n    }\r\n\r\n    // const idx = Math.max(0, this.mids.indexOf(mid));\r\n\r\n    /* if(currentIndex === this.count) {\r\n      currentIndex = 0;\r\n    } */\r\n\r\n    // this.log('testMid: pinned currentIndex', currentIndex, mid);\r\n\r\n    const changed = this.pinnedIndex !== currentIndex;\r\n    if(changed) {\r\n      if(this.waitForScrollBottom && lastScrollDirection !== undefined) {\r\n        if(this.pinnedIndex === 0 || this.pinnedIndex > currentIndex) { //          - \r\n          return;\r\n        }\r\n      }\r\n\r\n      this.pinnedIndex = currentIndex;\r\n      this.pinnedMid = this.mids.find((_mid) => _mid <= mid) || this.mids[this.mids.length - 1];\r\n      this.setPinnedMessage();\r\n    }\r\n  }\r\n\r\n  private isNeededMore(currentIndex: number) {\r\n    return (this.count > ChatPinnedMessage.LOAD_COUNT &&\r\n      (\r\n        (!this.loadedBottom && currentIndex <= ChatPinnedMessage.LOAD_OFFSET) ||\r\n        (!this.loadedTop && (this.count - 1 - currentIndex) <= ChatPinnedMessage.LOAD_OFFSET)\r\n      )\r\n    );\r\n  }\r\n\r\n  private async getCurrentIndex(mid: number, correctAfter = true) {\r\n    if(this.loading) return;\r\n    this.loading = true;\r\n\r\n    try {\r\n      const log = this.debug ? this.log.bindPrefix('getCurrentIndex') : undefined;\r\n      log && log('start', mid, correctAfter);\r\n\r\n      let gotRest = false;\r\n      const promises = [\r\n        this.managers.appMessagesManager.getSearch({\r\n          peerId: this.chat.peerId,\r\n          inputFilter: {_: 'inputMessagesFilterPinned'},\r\n          maxId: mid,\r\n          limit: ChatPinnedMessage.LOAD_COUNT,\r\n          backLimit: ChatPinnedMessage.LOAD_COUNT\r\n        })\r\n        .then((r) => {\r\n          gotRest = true;\r\n          return r;\r\n        })\r\n      ];\r\n\r\n      if(!this.pinnedMaxMid) {\r\n        const promise = this.managers.appMessagesManager.getPinnedMessage(this.chat.peerId).then((p) => {\r\n          if(!p.maxId) return;\r\n          this.pinnedMaxMid = p.maxId;\r\n\r\n          if(!gotRest && correctAfter) {\r\n            this.mids = [this.pinnedMaxMid];\r\n            this.count = p.count;\r\n            this.pinnedIndex = 0;\r\n            this.pinnedMid = this.mids[0];\r\n            this.setPinnedMessage();\r\n            // this.pinnedMessageContainer.toggle(false);\r\n          }\r\n        });\r\n\r\n        promises.push(promise as any);\r\n      }\r\n\r\n      const result = (await Promise.all(promises))[0];\r\n\r\n      let backLimited = result.history.findIndex((message) => message.mid <= mid);\r\n      if(backLimited === -1) {\r\n        backLimited = result.history.length;\r\n      }/*  else {\r\n        backLimited -= 1;\r\n      } */\r\n\r\n      this.offsetIndex = result.offset_id_offset ? result.offset_id_offset - backLimited : 0;\r\n      this.mids = result.history.map((message) => message.mid).slice();\r\n      this.count = result.count;\r\n\r\n      if(!this.count) {\r\n        this.pinnedMessageContainer.toggle(true);\r\n      }\r\n\r\n      this.loadedTop = (this.offsetIndex + this.mids.length) === this.count;\r\n      this.loadedBottom = !this.offsetIndex;\r\n\r\n      log && log('result', mid, result, backLimited, this.offsetIndex, this.loadedTop, this.loadedBottom);\r\n    } catch(err) {\r\n      this.log.error('getCurrentIndex error', err);\r\n    }\r\n\r\n    this.loading = false;\r\n\r\n    if(this.locked) {\r\n      this.testMid(mid);\r\n    } else if(correctAfter) {\r\n      this.setCorrectIndex(0);\r\n    }\r\n\r\n    this.getCurrentIndexPromise = null;\r\n    // return result.offset_id_offset || 0;\r\n  }\r\n\r\n  public setScrollDownListener() {\r\n    this.waitForScrollBottom = true;\r\n\r\n    if(!this.scrollDownListenerSetter) {\r\n      this.scrollDownListenerSetter = new ListenerSetter();\r\n      handleScrollSideEvent(this.chat.bubbles.scrollable.container, 'bottom', () => {\r\n        this.unsetScrollDownListener();\r\n      }, this.scrollDownListenerSetter);\r\n    }\r\n  }\r\n\r\n  public unsetScrollDownListener(refreshPosition = true) {\r\n    this.waitForScrollBottom = false;\r\n\r\n    if(this.scrollDownListenerSetter) {\r\n      this.scrollDownListenerSetter.removeAll();\r\n      this.scrollDownListenerSetter = null;\r\n    }\r\n\r\n    if(refreshPosition) {\r\n      this.setCorrectIndex(0);\r\n    }\r\n  }\r\n\r\n  public async handleFollowingPinnedMessage() {\r\n    this.locked = true;\r\n\r\n    this.debug && this.log('handleFollowingPinnedMessage');\r\n    try {\r\n      this.setScrollDownListener();\r\n\r\n      const setPeerPromise = this.chat.setPeerPromise;\r\n      if(setPeerPromise instanceof Promise) {\r\n        await setPeerPromise;\r\n      }\r\n\r\n      // await this.chat.bubbles.scrollable.scrollLockedPromise;\r\n      await getHeavyAnimationPromise();\r\n\r\n      if(this.getCurrentIndexPromise) {\r\n        await this.getCurrentIndexPromise;\r\n      }\r\n\r\n      this.debug && this.log('handleFollowingPinnedMessage: unlock');\r\n      this.locked = false;\r\n\r\n      /* // ,   \r\n      setTimeout(() => {\r\n        this.log('handleFollowingPinnedMessage: unlock');\r\n        this.locked = false;\r\n      }, 50); */\r\n    } catch(err) {\r\n      this.log.error('handleFollowingPinnedMessage error:', err);\r\n\r\n      this.locked = false;\r\n      this.waitForScrollBottom = false;\r\n      this.setCorrectIndex(0);\r\n    }\r\n  }\r\n\r\n  public async followPinnedMessage(mid: number) {\r\n    const message = await this.chat.getMessage(mid);\r\n    if(!message) {\r\n      return;\r\n    }\r\n\r\n    this.chat.setMessageId(mid);\r\n    (this.chat.setPeerPromise || Promise.resolve()).then(() => { // * debounce fast clicker\r\n      this.handleFollowingPinnedMessage();\r\n      this.testMid(this.pinnedIndex >= (this.count - 1) ? this.pinnedMaxMid : mid - 1);\r\n    });\r\n  }\r\n\r\n  public async _setPinnedMessage() {\r\n    // ///this.log('setting pinned message', message);\r\n    // return;\r\n    /* const promise: Promise<any> = this.chat.setPeerPromise || this.chat.bubbles.messagesQueuePromise || Promise.resolve();\r\n    Promise.all([\r\n      promise\r\n    ]).then(() => { */\r\n    // const mids = results[0];\r\n    const count = this.count;\r\n    if(count) {\r\n      const pinnedIndex = this.pinnedIndex;\r\n      const message = await this.chat.getMessage(this.pinnedMid);\r\n\r\n      // this.animatedCounter.prepareNumber(count);\r\n\r\n      // setTimeout(() => {\r\n      const isLast = pinnedIndex === 0;\r\n      this.animatedCounter.container.classList.toggle('is-last', isLast);\r\n      // SetTransition(this.animatedCounter.container, 'is-last', isLast, AnimatedSuper.DURATION);\r\n      if(!isLast) {\r\n        this.animatedCounter.setCount(count - pinnedIndex);\r\n      }\r\n      // }, 100);\r\n\r\n      // this.pinnedMessageContainer.fill(undefined, message.message, message);\r\n      this.pinnedMessageContainer.toggle(false);\r\n\r\n      const fromTop = pinnedIndex > this.wasPinnedIndex;\r\n\r\n      this.debug && this.log('setPinnedMessage: fromTop', fromTop, pinnedIndex, this.wasPinnedIndex);\r\n\r\n      const writeTo = this.animatedSubtitle.getRow(pinnedIndex);\r\n      const writeMediaTo = this.animatedMedia.getRow(pinnedIndex);\r\n      writeMediaTo.classList.add('pinned-message-media');\r\n      // writeMediaTo.innerHTML = writeMediaTo.style.cssText = writeMediaTo.dataset.docId = '';\r\n      const loadPromises: Promise<any>[] = [];\r\n      const isMediaSet = await wrapReplyDivAndCaption({\r\n        title: undefined,\r\n        titleEl: null,\r\n        subtitle: (message as Message.message).message,\r\n        subtitleEl: writeTo,\r\n        message,\r\n        mediaEl: writeMediaTo,\r\n        loadPromises\r\n      });\r\n\r\n      await Promise.all(loadPromises);\r\n\r\n      this.pinnedMessageContainer.divAndCaption.container.classList.toggle('is-media', isMediaSet);\r\n\r\n      // if(this.wasPinnedIndex !== this.pinnedIndex) {\r\n      this.animatedSubtitle.animate(pinnedIndex, this.wasPinnedIndex);\r\n      if(isMediaSet) {\r\n        this.animatedMedia.animate(pinnedIndex, this.wasPinnedMediaIndex); // * wasPinnedMediaIndex - ,      \r\n        this.wasPinnedMediaIndex = pinnedIndex;\r\n      } else {\r\n        this.animatedMedia.clearRows();\r\n      }\r\n      // }\r\n\r\n      this.pinnedMessageBorder.render(count, count - pinnedIndex - 1);\r\n      this.wasPinnedIndex = pinnedIndex;\r\n      this.pinnedMessageContainer.divAndCaption.container.dataset.mid = '' + message.mid;\r\n    } else {\r\n      this.pinnedMessageContainer.toggle(true);\r\n      this.wasPinnedIndex = 0;\r\n    }\r\n\r\n    this.pinnedMessageContainer.divAndCaption.container.classList.toggle('is-many', this.count > 1);\r\n    // });\r\n  }\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport type ListenerSetter from '../listenerSetter';\r\nimport IS_TOUCH_SUPPORTED from '../../environment/touchSupport';\r\n\r\nexport default function handleScrollSideEvent(elem: HTMLElement, side: 'top' | 'bottom', callback: () => void, listenerSetter: ListenerSetter) {\r\n  if(IS_TOUCH_SUPPORTED) {\r\n    let lastY: number;\r\n    const options = {passive: true};\r\n    listenerSetter.add(elem)('touchstart', (e) => {\r\n      if(e.touches.length > 1) {\r\n        onTouchEnd();\r\n        return;\r\n      }\r\n\r\n      lastY = e.touches[0].clientY;\r\n\r\n      listenerSetter.add(elem)('touchmove', onTouchMove, options);\r\n      listenerSetter.add(elem)('touchend', onTouchEnd, options);\r\n    }, options);\r\n\r\n    const onTouchMove = (e: TouchEvent) => {\r\n      const clientY = e.touches[0].clientY;\r\n\r\n      const isDown = clientY < lastY;\r\n      if(side === 'bottom' && isDown) callback();\r\n      else if(side === 'top' && !isDown) callback();\r\n      lastY = clientY;\r\n      // alert('isDown: ' + !!isDown);\r\n    };\r\n\r\n    const onTouchEnd = () => {\r\n      listenerSetter.removeManual(elem, 'touchmove', onTouchMove, options);\r\n      listenerSetter.removeManual(elem, 'touchend', onTouchEnd, options);\r\n    };\r\n  } else {\r\n    listenerSetter.add(elem)('wheel', (e) => {\r\n      const isDown = e.deltaY > 0;\r\n      // this.log('wheel', e, isDown);\r\n      if(side === 'bottom' && isDown) callback();\r\n      else if(side === 'top' && !isDown) callback();\r\n    }, {passive: true});\r\n  }\r\n}\r\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport type {Channel} from '../../lib/appManagers/appChatsManager';\nimport type {AppSidebarRight} from '../sidebarRight';\nimport type Chat from './chat';\nimport {RIGHT_COLUMN_ACTIVE_CLASSNAME} from '../sidebarRight';\nimport mediaSizes, {ScreenSize} from '../../helpers/mediaSizes';\nimport {IS_SAFARI} from '../../environment/userAgent';\nimport rootScope from '../../lib/rootScope';\nimport AvatarElement from '../avatar';\nimport Button from '../button';\nimport ButtonIcon from '../buttonIcon';\nimport ButtonMenuToggle from '../buttonMenuToggle';\nimport ChatAudio from './audio';\nimport ChatPinnedMessage from './pinnedMessage';\nimport {ButtonMenuItemOptions} from '../buttonMenu';\nimport ListenerSetter from '../../helpers/listenerSetter';\nimport PopupDeleteDialog from '../popups/deleteDialog';\nimport appNavigationController from '../appNavigationController';\nimport {LEFT_COLUMN_ACTIVE_CLASSNAME} from '../sidebarLeft';\nimport PeerTitle from '../peerTitle';\nimport {i18n} from '../../lib/langPack';\nimport findUpClassName from '../../helpers/dom/findUpClassName';\nimport blurActiveElement from '../../helpers/dom/blurActiveElement';\nimport cancelEvent from '../../helpers/dom/cancelEvent';\nimport {attachClickEvent} from '../../helpers/dom/clickEvent';\nimport findUpTag from '../../helpers/dom/findUpTag';\nimport {toast, toastNew} from '../toast';\nimport replaceContent from '../../helpers/dom/replaceContent';\nimport {ChatFull, Chat as MTChat, GroupCall} from '../../layer';\nimport PopupPickUser from '../popups/pickUser';\nimport PopupPeer from '../popups/peer';\nimport AppEditContactTab from '../sidebarRight/tabs/editContact';\nimport appMediaPlaybackController from '../appMediaPlaybackController';\nimport IS_GROUP_CALL_SUPPORTED from '../../environment/groupCallSupport';\nimport IS_CALL_SUPPORTED from '../../environment/callSupport';\nimport {CallType} from '../../lib/calls/types';\nimport PopupMute from '../popups/mute';\nimport {AppManagers} from '../../lib/appManagers/managers';\nimport hasRights from '../../lib/appManagers/utils/chats/hasRights';\nimport wrapPeerTitle from '../wrappers/peerTitle';\nimport groupCallsController from '../../lib/calls/groupCallsController';\nimport apiManagerProxy from '../../lib/mtproto/mtprotoworker';\n\ntype ButtonToVerify = {element?: HTMLElement, verify: () => boolean | Promise<boolean>};\n\nexport default class ChatTopbar {\n  public container: HTMLDivElement;\n  private btnBack: HTMLButtonElement;\n  private chatInfo: HTMLDivElement;\n  private avatarElement: AvatarElement;\n  private title: HTMLDivElement;\n  private subtitle: HTMLDivElement;\n  private chatUtils: HTMLDivElement;\n  private btnJoin: HTMLButtonElement;\n  private btnPinned: HTMLButtonElement;\n  private btnCall: HTMLButtonElement;\n  private btnGroupCall: HTMLButtonElement;\n  private btnMute: HTMLButtonElement;\n  private btnSearch: HTMLButtonElement;\n  private btnMore: HTMLElement;\n\n  private chatAudio: ChatAudio;\n  public pinnedMessage: ChatPinnedMessage;\n\n  private setUtilsRAF: number;\n  private setPeerStatusInterval: number;\n\n  public listenerSetter: ListenerSetter;\n\n  private menuButtons: (ButtonMenuItemOptions & {verify: ButtonToVerify['verify']})[];\n  private buttonsToVerify: ButtonToVerify[];\n  private chatInfoContainer: HTMLDivElement;\n\n  constructor(\n    private chat: Chat,\n    private appSidebarRight: AppSidebarRight,\n    private managers: AppManagers\n  ) {\n    this.listenerSetter = new ListenerSetter();\n\n    this.menuButtons = [];\n    this.buttonsToVerify = [];\n  }\n\n  public construct() {\n    // this.chat.log.error('Topbar construction');\n\n    this.container = document.createElement('div');\n    this.container.classList.add('sidebar-header', 'topbar', 'hide');\n    this.container.dataset.floating = '0';\n\n    this.btnBack = ButtonIcon('left sidebar-close-button', {noRipple: true});\n\n    // * chat info section\n    this.chatInfoContainer = document.createElement('div');\n    this.chatInfoContainer.classList.add('chat-info-container');\n\n    this.chatInfo = document.createElement('div');\n    this.chatInfo.classList.add('chat-info');\n\n    const person = document.createElement('div');\n    person.classList.add('person');\n\n    const content = document.createElement('div');\n    content.classList.add('content');\n\n    const top = document.createElement('div');\n    top.classList.add('top');\n\n    this.title = document.createElement('div');\n    this.title.classList.add('user-title');\n\n    top.append(this.title);\n\n    const bottom = document.createElement('div');\n    bottom.classList.add('bottom');\n\n    if(this.subtitle) {\n      bottom.append(this.subtitle);\n    }\n\n    content.append(top, bottom);\n    if(this.avatarElement) {\n      person.append(this.avatarElement);\n    }\n\n    person.append(content);\n    this.chatInfo.append(person);\n\n    // * chat utils section\n    this.chatUtils = document.createElement('div');\n    this.chatUtils.classList.add('chat-utils');\n\n    this.chatAudio = new ChatAudio(this, this.chat, this.managers);\n\n    if(this.menuButtons.length) {\n      this.btnMore = ButtonMenuToggle({listenerSetter: this.listenerSetter}, 'bottom-left', this.menuButtons, this.verifyButtons);\n    }\n\n    this.chatUtils.append(...[\n      // this.chatAudio ? this.chatAudio.divAndCaption.container : null,\n      this.pinnedMessage ? this.pinnedMessage.pinnedMessageContainer.divAndCaption.container : null,\n      this.btnJoin,\n      this.btnPinned,\n      this.btnCall,\n      this.btnGroupCall,\n      this.btnMute,\n      this.btnSearch,\n      this.btnMore\n    ].filter(Boolean));\n\n    this.pushButtonToVerify(this.btnCall, this.verifyCallButton.bind(this, 'voice'));\n    this.pushButtonToVerify(this.btnGroupCall, this.verifyVideoChatButton);\n\n    this.chatInfoContainer.append(this.btnBack, this.chatInfo, this.chatUtils);\n    this.container.append(this.chatInfoContainer);\n\n    if(this.chatAudio) {\n      // this.container.append(this.chatAudio.divAndCaption.container, this.chatUtils);\n      this.container.append(this.chatAudio.divAndCaption.container);\n    }\n\n    // * construction end\n\n    // * fix topbar overflow section\n\n    this.listenerSetter.add(window)('resize', this.onResize);\n    this.listenerSetter.add(mediaSizes)('changeScreen', this.onChangeScreen);\n\n    attachClickEvent(this.container, (e) => {\n      const container = findUpClassName(e.target, 'pinned-container');\n      blurActiveElement();\n      if(container) {\n        cancelEvent(e);\n\n        if(findUpClassName(e.target, 'progress-line')) {\n          return;\n        }\n\n        const mid = +container.dataset.mid;\n        if(container.classList.contains('pinned-message')) {\n          // if(!this.pinnedMessage.locked) {\n          this.pinnedMessage.followPinnedMessage(mid);\n          // }\n        } else {\n          const peerId = container.dataset.peerId.toPeerId();\n          const searchContext = appMediaPlaybackController.getSearchContext();\n          this.chat.appImManager.setInnerPeer({\n            peerId,\n            lastMsgId: mid,\n            type: searchContext.isScheduled ? 'scheduled' : (searchContext.threadId ? 'discussion' : undefined),\n            threadId: searchContext.threadId\n          });\n        }\n      } else {\n        if(mediaSizes.activeScreen === ScreenSize.medium && document.body.classList.contains(LEFT_COLUMN_ACTIVE_CLASSNAME)) {\n          onBtnBackClick();\n        } else if(findUpTag(e.target, 'AVATAR-ELEMENT')) {\n          this.appSidebarRight.toggleSidebar(!document.body.classList.contains(RIGHT_COLUMN_ACTIVE_CLASSNAME));\n        } else {\n          this.appSidebarRight.toggleSidebar(true);\n        }\n      }\n    }, {listenerSetter: this.listenerSetter});\n\n    const onBtnBackClick = (e?: Event) => {\n      if(e) {\n        cancelEvent(e);\n      }\n\n      // const item = appNavigationController.findItemByType('chat');\n      // * return manually to chat by arrow, since can't get back to\n      if(mediaSizes.activeScreen === ScreenSize.medium && document.body.classList.contains(LEFT_COLUMN_ACTIVE_CLASSNAME)) {\n        this.chat.appImManager.setPeer({peerId: this.peerId});\n      } else {\n        const isFirstChat = this.chat.appImManager.chats.indexOf(this.chat) === 0;\n        appNavigationController.back(isFirstChat ? 'im' : 'chat');\n        /* return;\n\n        if(mediaSizes.activeScreen === ScreenSize.medium && !appNavigationController.findItemByType('chat')) {\n          this.chat.appImManager.setPeer(0);\n          blurActiveElement();\n        } else {\n          appNavigationController.back('chat');\n        } */\n      }\n    };\n\n    attachClickEvent(this.btnBack, onBtnBackClick, {listenerSetter: this.listenerSetter});\n  }\n\n  private pushButtonToVerify(element: HTMLElement, verify: ButtonToVerify['verify']) {\n    if(!element) {\n      return;\n    }\n\n    this.buttonsToVerify.push({element, verify});\n  }\n\n  private verifyButtons = (e?: Event) => {\n    const isMenuOpen = !!e || !!(this.btnMore && this.btnMore.classList.contains('menu-open'));\n\n    e && cancelEvent(e);\n\n    const r = async() => {\n      const deleteButtonText = await this.managers.appPeersManager.getDeleteButtonText(this.peerId);\n      if(isMenuOpen) {\n        // delete button\n        this.menuButtons[this.menuButtons.length - 1].element.lastChild.replaceWith(i18n(deleteButtonText));\n      }\n\n      const buttons = this.buttonsToVerify.concat(isMenuOpen ? this.menuButtons : []);\n      const results = await Promise.all(buttons.map(async(button) => {\n        return {\n          result: await button.verify(),\n          button\n        }\n      }));\n\n      results.forEach(({button, result}) => {\n        button.element.classList.toggle('hide', !result);\n      });\n    };\n\n    r();\n  };\n\n  private verifyVideoChatButton = async(type?: 'group' | 'broadcast') => {\n    if(!IS_GROUP_CALL_SUPPORTED || this.peerId.isUser()) return false;\n\n    const currentGroupCall = groupCallsController.groupCall;\n    const chatId = this.peerId.toChatId();\n    if(currentGroupCall?.chatId === chatId) {\n      return false;\n    }\n\n    if(type) {\n      if(((await this.managers.appPeersManager.isBroadcast(this.peerId)) && type === 'group') ||\n        ((await this.managers.appPeersManager.isAnyGroup(this.peerId)) && type === 'broadcast')) {\n        return false;\n      }\n    }\n\n    const chat = await this.managers.appChatsManager.getChatTyped(chatId);\n    return (chat as MTChat.chat).pFlags?.call_active || hasRights(chat, 'manage_call');\n  };\n\n  private verifyCallButton = async(type?: CallType) => {\n    if(!IS_CALL_SUPPORTED || !this.peerId.isUser()) return false;\n    const userId = this.peerId.toUserId();\n    const userFull = await this.managers.appProfileManager.getCachedFullUser(userId);\n\n    return !!userFull && !!(type === 'voice' ? userFull.pFlags.phone_calls_available : userFull.pFlags.video_calls_available);\n  };\n\n  public constructUtils() {\n    this.menuButtons = [{\n      icon: 'search',\n      text: 'Search',\n      onClick: () => {\n        this.chat.initSearch();\n      },\n      verify: () => mediaSizes.isMobile\n    }, /* {\n      icon: 'pinlist',\n      text: 'Pinned Messages',\n      onClick: () => this.openPinned(false),\n      verify: () => mediaSizes.isMobile\n    }, */{\n      icon: 'mute',\n      text: 'ChatList.Context.Mute',\n      onClick: this.onMuteClick,\n      verify: async() => this.chat.type === 'chat' && rootScope.myId !== this.peerId && !(await this.managers.appNotificationsManager.isPeerLocalMuted(this.peerId, false))\n    }, {\n      icon: 'unmute',\n      text: 'ChatList.Context.Unmute',\n      onClick: () => {\n        this.managers.appMessagesManager.togglePeerMute(this.peerId);\n      },\n      verify: async() => this.chat.type === 'chat' && rootScope.myId !== this.peerId && (await this.managers.appNotificationsManager.isPeerLocalMuted(this.peerId, false))\n    }, {\n      icon: 'comments',\n      text: 'ViewDiscussion',\n      onClick: () => {\n        const middleware = this.chat.bubbles.getMiddleware();\n        Promise.resolve(this.managers.appProfileManager.getChannelFull(this.peerId.toChatId())).then((channelFull) => {\n          if(middleware() && channelFull.linked_chat_id) {\n            this.chat.appImManager.setInnerPeer({\n              peerId: channelFull.linked_chat_id.toPeerId(true)\n            });\n          }\n        });\n      },\n      verify: async() => {\n        const chatFull = await this.managers.appProfileManager.getCachedFullChat(this.peerId.toChatId());\n        return this.chat.type === 'chat' && !!(chatFull as ChatFull.channelFull)?.linked_chat_id;\n      }\n    }, {\n      icon: 'phone',\n      text: 'Call',\n      onClick: this.onCallClick.bind(this, 'voice'),\n      verify: this.verifyCallButton.bind(this, 'voice')\n    }, {\n      icon: 'videocamera',\n      text: 'VideoCall',\n      onClick: this.onCallClick.bind(this, 'video'),\n      verify: this.verifyCallButton.bind(this, 'video')\n    }, {\n      icon: 'videochat',\n      text: 'PeerInfo.Action.LiveStream',\n      onClick: this.onJoinGroupCallClick,\n      verify: this.verifyVideoChatButton.bind(this, 'broadcast')\n    }, {\n      icon: 'videochat',\n      text: 'PeerInfo.Action.VoiceChat',\n      onClick: this.onJoinGroupCallClick,\n      verify: this.verifyVideoChatButton.bind(this, 'group')\n    }, {\n      icon: 'select',\n      text: 'Chat.Menu.SelectMessages',\n      onClick: () => {\n        const selection = this.chat.selection;\n        selection.toggleSelection(true, true);\n        apiManagerProxy.getState().then((state) => {\n          if(state.chatContextMenuHintWasShown) {\n            return;\n          }\n\n          const original = selection.toggleByElement.bind(selection);\n          selection.toggleByElement = async(bubble) => {\n            this.managers.appStateManager.pushToState('chatContextMenuHintWasShown', true);\n            toast(i18n('Chat.Menu.Hint'));\n\n            selection.toggleByElement = original;\n            selection.toggleByElement(bubble);\n          };\n        });\n      },\n      verify: () => !this.chat.selection.isSelecting && !!this.chat.bubbles.getRenderedLength()\n    }, {\n      icon: 'select',\n      text: 'Chat.Menu.ClearSelection',\n      onClick: () => {\n        this.chat.selection.cancelSelection();\n      },\n      verify: () => this.chat.selection.isSelecting\n    }, {\n      icon: 'adduser',\n      text: 'AddContact',\n      onClick: () => {\n        if(!this.appSidebarRight.isTabExists(AppEditContactTab)) {\n          const tab = this.appSidebarRight.createTab(AppEditContactTab);\n          tab.peerId = this.peerId;\n          tab.open();\n\n          this.appSidebarRight.toggleSidebar(true);\n        }\n      },\n      verify: async() => this.peerId.isUser() && !(await this.managers.appPeersManager.isContact(this.peerId))\n    }, {\n      icon: 'forward',\n      text: 'ShareContact',\n      onClick: () => {\n        const contactPeerId = this.peerId;\n        new PopupPickUser({\n          peerTypes: ['dialogs', 'contacts'],\n          onSelect: (peerId) => {\n            return new Promise((resolve, reject) => {\n              new PopupPeer('', {\n                titleLangKey: 'SendMessageTitle',\n                descriptionLangKey: 'SendContactToGroupText',\n                descriptionLangArgs: [new PeerTitle({peerId, dialog: true}).element],\n                buttons: [{\n                  langKey: 'Send',\n                  callback: () => {\n                    resolve();\n\n                    this.managers.appMessagesManager.sendContact(peerId, contactPeerId);\n                    this.chat.appImManager.setInnerPeer({peerId});\n                  }\n                }, {\n                  langKey: 'Cancel',\n                  callback: () => {\n                    reject();\n                  },\n                  isCancel: true\n                }],\n                peerId,\n                overlayClosable: true\n              }).show();\n            });\n          },\n          placeholder: 'ShareModal.Search.Placeholder',\n          chatRightsAction: 'send_messages',\n          selfPresence: 'ChatYourSelf'\n        });\n      },\n      verify: async() => rootScope.myId !== this.peerId && this.peerId.isUser() && (await this.managers.appPeersManager.isContact(this.peerId)) && !!(await this.managers.appUsersManager.getUser(this.peerId.toUserId())).phone\n    }, {\n      icon: 'lock',\n      text: 'BlockUser',\n      onClick: () => {\n        new PopupPeer('', {\n          peerId: this.peerId,\n          titleLangKey: 'BlockUser',\n          descriptionLangKey: 'AreYouSureBlockContact2',\n          descriptionLangArgs: [new PeerTitle({peerId: this.peerId}).element],\n          buttons: [{\n            langKey: 'BlockUser',\n            isDanger: true,\n            callback: () => {\n              this.managers.appUsersManager.toggleBlock(this.peerId, true).then((value) => {\n                if(value) {\n                  toastNew({langPackKey: 'UserBlocked'});\n                }\n              });\n            }\n          }]\n        }).show();\n      },\n      verify: async() => {\n        if(!this.peerId.isUser()) return false;\n        const userFull = await this.managers.appProfileManager.getCachedFullUser(this.peerId.toUserId());\n        return this.peerId !== rootScope.myId && userFull && !userFull.pFlags?.blocked;\n      }\n    }, {\n      icon: 'lockoff',\n      text: 'Unblock',\n      onClick: () => {\n        this.managers.appUsersManager.toggleBlock(this.peerId, false).then((value) => {\n          if(value) {\n            toastNew({langPackKey: 'UserUnblocked'});\n          }\n        });\n      },\n      verify: async() => {\n        const userFull = await this.managers.appProfileManager.getCachedFullUser(this.peerId.toUserId());\n        return !!userFull?.pFlags?.blocked;\n      }\n    }, {\n      icon: 'delete danger',\n      text: 'Delete',\n      onClick: () => {\n        new PopupDeleteDialog(this.peerId/* , 'leave' */);\n      },\n      verify: async() => this.chat.type === 'chat' && !!(await this.managers.appMessagesManager.getDialogOnly(this.peerId))\n    }];\n\n    this.btnSearch = ButtonIcon('search');\n    this.attachClickEvent(this.btnSearch, (e) => {\n      this.chat.initSearch();\n    }, true);\n  }\n\n  public attachClickEvent(el: HTMLElement, cb: (e: MouseEvent) => void, noBlur?: boolean) {\n    attachClickEvent(el, (e) => {\n      cancelEvent(e);\n      !noBlur && blurActiveElement();\n      cb(e);\n    }, {listenerSetter: this.listenerSetter});\n  }\n\n  private onCallClick(type: CallType) {\n    this.chat.appImManager.callUser(this.peerId.toUserId(), type);\n  }\n\n  private onJoinGroupCallClick = () => {\n    this.chat.appImManager.joinGroupCall(this.peerId);\n  };\n\n  private constructAvatar() {\n    const avatarElement = new AvatarElement();\n    avatarElement.isDialog = true;\n    avatarElement.classList.add('avatar-42', 'person-avatar');\n    return avatarElement;\n  }\n\n  private get peerId() {\n    return this.chat.peerId;\n  }\n\n  public constructPeerHelpers() {\n    this.avatarElement = this.constructAvatar();\n\n    this.subtitle = document.createElement('div');\n    this.subtitle.classList.add('info');\n\n    this.pinnedMessage = new ChatPinnedMessage(this, this.chat, this.managers);\n\n    this.btnJoin = Button('btn-primary btn-color-primary chat-join hide');\n    this.btnCall = ButtonIcon('phone');\n    this.btnGroupCall = ButtonIcon('videochat');\n    this.btnPinned = ButtonIcon('pinlist');\n    this.btnMute = ButtonIcon('mute');\n\n    this.attachClickEvent(this.btnCall, this.onCallClick.bind(this, 'voice'));\n    this.attachClickEvent(this.btnGroupCall, this.onJoinGroupCallClick);\n\n    this.attachClickEvent(this.btnPinned, () => {\n      this.openPinned(true);\n    });\n\n    this.attachClickEvent(this.btnMute, this.onMuteClick);\n\n    this.attachClickEvent(this.btnJoin, async() => {\n      const middleware = this.chat.bubbles.getMiddleware();\n      this.btnJoin.setAttribute('disabled', 'true');\n\n      const chatId = this.peerId.toChatId();\n      let promise: Promise<any>;\n      if(await this.managers.appChatsManager.isChannel(chatId)) {\n        promise = this.managers.appChatsManager.joinChannel(chatId);\n      } else {\n        promise = this.managers.appChatsManager.addChatUser(chatId, rootScope.myId);\n      }\n\n      promise.finally(() => {\n        if(!middleware()) {\n          return;\n        }\n\n        this.btnJoin.removeAttribute('disabled');\n      });\n    });\n\n    this.listenerSetter.add(rootScope)('chat_update', async(chatId) => {\n      if(this.peerId === chatId.toPeerId(true)) {\n        const chat = await this.managers.appChatsManager.getChat(chatId) as Channel/*  | Chat */;\n\n        this.btnJoin.classList.toggle('hide', !(chat as Channel)?.pFlags?.left);\n        this.setUtilsWidth();\n        this.verifyButtons();\n      }\n    });\n\n    this.listenerSetter.add(rootScope)('dialog_notify_settings', (dialog) => {\n      if(dialog.peerId === this.peerId) {\n        this.setMutedState();\n      }\n    });\n\n    this.listenerSetter.add(rootScope)('peer_typings', ({peerId}) => {\n      if(this.peerId === peerId) {\n        this.setPeerStatus();\n      }\n    });\n\n    this.listenerSetter.add(rootScope)('user_update', (userId) => {\n      if(this.peerId === userId.toPeerId()) {\n        this.setPeerStatus();\n      }\n    });\n\n    this.listenerSetter.add(rootScope)('peer_full_update', (peerId) => {\n      if(this.peerId === peerId) {\n        this.verifyButtons();\n      }\n    });\n\n    if(this.pinnedMessage) {\n      this.chat.addEventListener('setPeer', (mid, isTopMessage) => {\n        const middleware = this.chat.bubbles.getMiddleware();\n        apiManagerProxy.getState().then((state) => {\n          if(!middleware()) return;\n\n          this.pinnedMessage.hidden = !!state.hiddenPinnedMessages[this.chat.peerId];\n\n          if(isTopMessage) {\n            this.pinnedMessage.unsetScrollDownListener();\n            this.pinnedMessage.testMid(mid, 0); // * because slider will not let get bubble by document.elementFromPoint\n          } else if(!this.pinnedMessage.locked) {\n            this.pinnedMessage.handleFollowingPinnedMessage();\n            this.pinnedMessage.testMid(mid);\n          }\n        });\n      });\n    }\n\n    this.setPeerStatusInterval = window.setInterval(this.setPeerStatus, 60e3);\n\n    return this;\n  }\n\n  public constructPinnedHelpers() {\n    this.listenerSetter.add(rootScope)('peer_pinned_messages', ({peerId, mids}) => {\n      if(peerId !== this.peerId) return;\n\n      if(mids) {\n        this.setTitle();\n      }\n    });\n  }\n\n  public constructDiscussionHelpers() {\n    this.pinnedMessage = new ChatPinnedMessage(this, this.chat, this.managers);\n  }\n\n  public openPinned(byCurrent: boolean) {\n    this.chat.appImManager.setInnerPeer({\n      peerId: this.peerId,\n      lastMsgId: byCurrent ? +this.pinnedMessage.pinnedMessageContainer.divAndCaption.container.dataset.mid : 0,\n      type: 'pinned'\n    });\n  }\n\n  private onMuteClick = () => {\n    new PopupMute(this.peerId);\n  };\n\n  private onResize = () => {\n    this.setUtilsWidth(true);\n    this.setFloating();\n  };\n\n  private onChangeScreen = (from: ScreenSize, to: ScreenSize) => {\n    this.container.classList.toggle('is-pinned-floating', mediaSizes.isMobile);\n    // this.chatAudio && this.chatAudio.divAndCaption.container.classList.toggle('is-floating', to === ScreenSize.mobile);\n    this.pinnedMessage && this.pinnedMessage.pinnedMessageContainer.divAndCaption.container.classList.toggle('is-floating', to === ScreenSize.mobile);\n    this.onResize();\n  };\n\n  public destroy() {\n    // this.chat.log.error('Topbar destroying');\n    this.listenerSetter.removeAll();\n    window.clearInterval(this.setPeerStatusInterval);\n\n    if(this.pinnedMessage) {\n      this.pinnedMessage.destroy(); // *     \n    }\n\n    if(this.chatAudio) {\n      this.chatAudio.destroy();\n    }\n\n    delete this.chatAudio;\n    delete this.pinnedMessage;\n  }\n\n  public cleanup() {\n    if(!this.chat.peerId) {\n      this.container.classList.add('hide');\n    }\n  }\n\n  public async finishPeerChange(isTarget: boolean) {\n    const peerId = this.peerId;\n\n    let newAvatar: AvatarElement;\n    if(this.avatarElement) {\n      newAvatar = this.constructAvatar();\n    }\n\n    const [isBroadcast, isAnyChat, chat, _, setTitleCallback, setStatusCallback, state] = await Promise.all([\n      this.managers.appPeersManager.isBroadcast(peerId),\n      this.managers.appPeersManager.isAnyChat(peerId),\n      peerId.isAnyChat() ? this.managers.appChatsManager.getChat(peerId.toChatId()) : undefined,\n      newAvatar ? newAvatar.updateWithOptions({peerId}) : undefined,\n      this.setTitleManual(),\n      this.setPeerStatusManual(true),\n      apiManagerProxy.getState()\n    ]);\n\n    return () => {\n      this.btnMute && this.btnMute.classList.toggle('hide', !isBroadcast);\n      if(this.btnJoin) {\n        if(isAnyChat) {\n          replaceContent(this.btnJoin, i18n(isBroadcast ? 'Chat.Subscribe' : 'ChannelJoin'));\n          this.btnJoin.classList.toggle('hide', !chat?.pFlags?.left);\n        } else {\n          this.btnJoin.classList.add('hide');\n        }\n      }\n\n      if(newAvatar) {\n        this.avatarElement.replaceWith(newAvatar);\n        this.avatarElement = newAvatar;\n      }\n\n      this.setUtilsWidth();\n\n      this.verifyButtons();\n\n      if(this.pinnedMessage) { // * replace with new one\n        if(this.chat.type === 'chat') {\n          if(this.chat.wasAlreadyUsed) { // * change\n            const newPinnedMessage = new ChatPinnedMessage(this, this.chat, this.managers);\n            this.pinnedMessage.pinnedMessageContainer.divAndCaption.container.replaceWith(newPinnedMessage.pinnedMessageContainer.divAndCaption.container);\n            this.pinnedMessage.destroy();\n            // this.pinnedMessage.pinnedMessageContainer.toggle(true);\n            this.pinnedMessage = newPinnedMessage;\n          }\n\n          this.pinnedMessage.hidden = !!state.hiddenPinnedMessages[peerId];\n        } else if(this.chat.type === 'discussion') {\n          this.pinnedMessage.pinnedMid = this.chat.threadId;\n          this.pinnedMessage.count = 1;\n          this.pinnedMessage.pinnedIndex = 0;\n          this.pinnedMessage._setPinnedMessage();\n        }\n      }\n\n      setTitleCallback();\n      setStatusCallback && setStatusCallback();\n      this.setMutedState();\n\n      this.container.classList.remove('hide');\n    };\n  }\n\n  public async setTitleManual(count?: number) {\n    const peerId = this.peerId;\n    const middleware = () => this.peerId === peerId;\n    let titleEl: HTMLElement, icons: Element[];\n    if(this.chat.type === 'pinned') {\n      if(count === undefined) titleEl = i18n('Loading');\n      else titleEl = i18n('PinnedMessagesCount', [count]);\n\n      if(count === undefined) {\n        this.managers.appMessagesManager.getSearchCounters(peerId, [{_: 'inputMessagesFilterPinned'}], false).then((result) => {\n          if(!middleware()) return;\n          const count = result[0].count;\n          this.setTitle(count);\n\n          // !  2,      \n          if(!count) {\n            this.chat.appImManager.setPeer(); // * close tab\n\n            // ! ,     ,  ,      \n            const originalChat = this.chat.appImManager.chat;\n            if(originalChat.topbar.pinnedMessage) {\n              originalChat.topbar.pinnedMessage.pinnedMessageContainer.toggle(true);\n            }\n          }\n        });\n      }\n    } else if(this.chat.type === 'scheduled') {\n      titleEl = i18n(peerId === rootScope.myId ? 'Reminders' : 'ScheduledMessages');\n    } else if(this.chat.type === 'discussion') {\n      if(count === undefined) {\n        const result = await this.managers.acknowledged.appMessagesManager.getHistory(peerId, 0, 1, 0, this.chat.threadId);\n        if(result.cached) {\n          const historyResult = await result.result;\n          count = historyResult.count;\n        } else result.result.then((historyResult) => this.setTitle(historyResult.count));\n      }\n\n      if(count === undefined) titleEl = i18n('Loading');\n      else titleEl = i18n('Chat.Title.Comments', [count]);\n    } else if(this.chat.type === 'chat') {\n      [titleEl/* , icons */] = await Promise.all([\n        wrapPeerTitle({\n          peerId,\n          dialog: true,\n          withIcons: true\n        })\n        // generateTitleIcons(peerId)\n      ]);\n\n      if(!middleware()) {\n        return;\n      }\n    }\n\n    return () => {\n      replaceContent(this.title, titleEl);\n      // if(icons) {\n      //   this.title.append(...icons);\n      // }\n    };\n  }\n\n  public setTitle(count?: number) {\n    this.setTitleManual(count).then((setTitleCallback) => setTitleCallback());\n  }\n\n  public async setMutedState() {\n    if(!this.btnMute) return;\n\n    const peerId = this.peerId;\n    const muted = await this.managers.appNotificationsManager.isPeerLocalMuted(peerId, false);\n    if(await this.managers.appPeersManager.isBroadcast(peerId)) { // not human\n      this.btnMute.classList.remove('tgico-mute', 'tgico-unmute');\n      this.btnMute.classList.add(muted ? 'tgico-unmute' : 'tgico-mute');\n      this.btnMute.style.display = '';\n    } else {\n      this.btnMute.style.display = 'none';\n    }\n  }\n\n  // !    ,    -    ,          ,    !\n  public setUtilsWidth = (resize = false) => {\n    // return;\n    if(this.setUtilsRAF) window.cancelAnimationFrame(this.setUtilsRAF);\n\n    if(IS_SAFARI && resize) {\n      this.chatUtils.classList.add('hide');\n    }\n\n    // mutationObserver.disconnect();\n    this.setUtilsRAF = window.requestAnimationFrame(() => {\n      // mutationRAF = window.requestAnimationFrame(() => {\n\n      // setTimeout(() => {\n      if(IS_SAFARI && resize) {\n        this.chatUtils.classList.remove('hide');\n      }\n      /* this.chatInfo.style.removeProperty('--utils-width');\n          void this.chatInfo.offsetLeft; // reflow */\n      const width = /* chatUtils.scrollWidth */this.chatUtils.getBoundingClientRect().width;\n      this.chat.log('utils width:', width);\n      this.container.style.setProperty('--utils-width', width + 'px');\n      // this.chatInfo.classList.toggle('have-utils-width', !!width);\n      // }, 0);\n\n      this.setUtilsRAF = 0;\n\n      // mutationObserver.observe(chatUtils, observeOptions);\n      // });\n    });\n  };\n\n  public setFloating = () => {\n    const containers = [this.chatAudio, this.pinnedMessage && this.pinnedMessage.pinnedMessageContainer].filter(Boolean);\n    const count = containers.reduce((acc, container) => {\n      const isFloating = container.isFloating();\n      this.container.classList.toggle(`is-pinned-${container.className}-floating`, isFloating);\n\n      if(!container.isVisible()) {\n        return acc;\n      }\n\n      return acc + +isFloating;\n    }, 0);\n    this.container.dataset.floating = '' + count;\n  };\n\n  public setPeerStatusManual = async(needClear = false) => {\n    if(!this.subtitle) return;\n\n    const peerId = this.peerId;\n    return this.chat.appImManager.setPeerStatus(\n      peerId,\n      this.subtitle,\n      needClear,\n      false,\n      () => peerId === this.peerId\n    );\n  };\n\n  public setPeerStatus = (needClear?: boolean) => {\n    return this.setPeerStatusManual(needClear).then((callback) => {\n      if(callback) {\n        callback();\n      }\n    });\n  };\n}\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport appSidebarRight from '..';\r\nimport {attachClickEvent} from '../../../helpers/dom/clickEvent';\r\nimport AppSearch, {SearchGroup} from '../../appSearch';\r\nimport ButtonIcon from '../../buttonIcon';\r\nimport InputSearch from '../../inputSearch';\r\nimport PopupElement from '../../popups';\r\nimport PopupDatePicker from '../../popups/datePicker';\r\nimport {SliderSuperTab} from '../../slider';\r\n\r\nexport default class AppPrivateSearchTab extends SliderSuperTab {\r\n  private inputSearch: InputSearch;\r\n  private appSearch: AppSearch;\r\n  private btnPickDate: HTMLElement;\r\n\r\n  private peerId: PeerId;\r\n  private threadId = 0;\r\n  private query = '';\r\n  private onDatePick: (timestamp: number) => void;\r\n\r\n  onOpenAfterTimeout() {\r\n    this.appSearch.beginSearch(this.peerId, this.threadId, this.query);\r\n  }\r\n\r\n  protected init() {\r\n    this.container.id = 'search-private-container';\r\n    this.container.classList.add('chatlist-container');\r\n    this.inputSearch = new InputSearch('Search');\r\n    this.title.replaceWith(this.inputSearch.container);\r\n\r\n    this.btnPickDate = ButtonIcon('calendar sidebar-header-right');\r\n    this.header.append(this.btnPickDate);\r\n\r\n    const c = document.createElement('div');\r\n    c.classList.add('chatlist-container');\r\n    this.scrollable.container.replaceWith(c);\r\n    this.appSearch = new AppSearch(c, this.inputSearch, {\r\n      messages: new SearchGroup('Chat.Search.PrivateSearch', 'messages')\r\n    });\r\n  }\r\n\r\n  open(peerId: PeerId, threadId?: number, onDatePick?: AppPrivateSearchTab['onDatePick'], query?: string) {\r\n    const ret = super.open();\r\n\r\n    if(!this.peerId) {\r\n      this.query = query;\r\n      this.peerId = peerId;\r\n      this.threadId = threadId;\r\n      this.onDatePick = onDatePick;\r\n\r\n      this.btnPickDate.classList.toggle('hide', !this.onDatePick);\r\n      if(this.onDatePick) {\r\n        attachClickEvent(this.btnPickDate, () => {\r\n          PopupElement.createPopup(PopupDatePicker, new Date(), this.onDatePick).show();\r\n        });\r\n      }\r\n\r\n      query && this.appSearch.searchInput.inputField.setValueSilently(query);\r\n\r\n      appSidebarRight.toggleSidebar(true);\r\n    } else {\r\n      this.appSearch.beginSearch(this.peerId, this.threadId, query);\r\n    }\r\n\r\n    return ret;\r\n  }\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport type ChatTopbar from './topbar';\r\nimport AppSearch, {SearchGroup} from '../appSearch';\r\nimport PopupDatePicker from '../popups/datePicker';\r\nimport ripple from '../ripple';\r\nimport InputSearch from '../inputSearch';\r\nimport type Chat from './chat';\r\nimport findUpTag from '../../helpers/dom/findUpTag';\r\nimport cancelEvent from '../../helpers/dom/cancelEvent';\r\nimport whichChild from '../../helpers/dom/whichChild';\r\nimport replaceContent from '../../helpers/dom/replaceContent';\r\nimport {i18n} from '../../lib/langPack';\r\nimport ListenerSetter from '../../helpers/listenerSetter';\r\nimport {attachClickEvent} from '../../helpers/dom/clickEvent';\r\nimport appNavigationController, {NavigationItem} from '../appNavigationController';\r\nimport {IS_MOBILE_SAFARI} from '../../environment/userAgent';\r\nimport PopupElement from '../popups';\r\nimport {DIALOG_LIST_ELEMENT_TAG} from '../../lib/appManagers/appDialogsManager';\r\n\r\nexport default class ChatSearch {\r\n  private element: HTMLElement;\r\n  private backBtn: HTMLElement;\r\n  private inputSearch: InputSearch;\r\n\r\n  private results: HTMLElement;\r\n\r\n  private footer: HTMLElement;\r\n  private dateBtn: HTMLElement;\r\n  private foundCountEl: HTMLElement;\r\n  private controls: HTMLElement;\r\n  private downBtn: HTMLElement;\r\n  private upBtn: HTMLElement;\r\n\r\n  private appSearch: AppSearch;\r\n  private searchGroup: SearchGroup;\r\n\r\n  private foundCount = 0;\r\n  private selectedIndex = 0;\r\n  private setPeerPromise: Promise<any>;\r\n  private listenerSetter: ListenerSetter;\r\n  private navigationItem: NavigationItem;\r\n\r\n  constructor(private topbar: ChatTopbar, private chat: Chat, query?: string) {\r\n    this.element = document.createElement('div');\r\n    this.element.classList.add('sidebar-header', 'chat-search', 'chatlist-container');\r\n\r\n    this.backBtn = document.createElement('button');\r\n    this.backBtn.classList.add('btn-icon', 'tgico-left', 'sidebar-close-button');\r\n    ripple(this.backBtn);\r\n\r\n    const listenerSetter = this.listenerSetter = new ListenerSetter();\r\n\r\n    const attachClick = (element: HTMLElement, callback: (e: MouseEvent) => void) => {\r\n      attachClickEvent(element, callback, {listenerSetter});\r\n    };\r\n\r\n    attachClick(this.backBtn, () => {\r\n      this.destroy();\r\n    });\r\n\r\n    this.inputSearch = new InputSearch('Search');\r\n\r\n    // Results\r\n    this.results = document.createElement('div');\r\n    this.results.classList.add('chat-search-results', 'chatlist-container');\r\n\r\n    this.searchGroup = new SearchGroup(false, 'messages', undefined, '', false);\r\n    attachClick(this.searchGroup.list, this.onResultsClick);\r\n\r\n    this.appSearch = new AppSearch(this.results, this.inputSearch, {\r\n      messages: this.searchGroup\r\n    }, (count) => {\r\n      this.foundCount = count;\r\n\r\n      if(!this.foundCount) {\r\n        replaceContent(this.foundCountEl, this.inputSearch.value ? i18n('NoResult') : '');\r\n        this.results.classList.remove('active');\r\n        this.chat.bubbles.container.classList.remove('search-results-active');\r\n        this.upBtn.setAttribute('disabled', 'true');\r\n        this.downBtn.setAttribute('disabled', 'true');\r\n      } else {\r\n        this.selectResult(this.searchGroup.list.children[0] as HTMLElement);\r\n      }\r\n    });\r\n    this.appSearch.beginSearch(this.chat.peerId, this.chat.threadId);\r\n\r\n    // appImManager.topbar.parentElement.insertBefore(this.results, appImManager.bubblesContainer);\r\n    this.chat.bubbles.container.append(this.results);\r\n\r\n    // Footer\r\n    this.footer = document.createElement('div');\r\n    this.footer.classList.add('chat-search-footer');\r\n\r\n    attachClick(this.footer, this.onFooterClick);\r\n    ripple(this.footer);\r\n\r\n    this.foundCountEl = document.createElement('span');\r\n    this.foundCountEl.classList.add('chat-search-count');\r\n\r\n    this.dateBtn = document.createElement('button');\r\n    this.dateBtn.classList.add('btn-icon', 'tgico-calendar');\r\n\r\n    this.controls = document.createElement('div');\r\n    this.controls.classList.add('chat-search-controls');\r\n\r\n    this.upBtn = document.createElement('button');\r\n    this.upBtn.classList.add('btn-icon', 'tgico-up');\r\n    this.downBtn = document.createElement('button');\r\n    this.downBtn.classList.add('btn-icon', 'tgico-down');\r\n\r\n    this.upBtn.setAttribute('disabled', 'true');\r\n    this.downBtn.setAttribute('disabled', 'true');\r\n\r\n    attachClick(this.dateBtn, this.onDateClick);\r\n    attachClick(this.upBtn, this.onUpClick);\r\n    attachClick(this.downBtn, this.onDownClick);\r\n    this.controls.append(this.upBtn, this.downBtn);\r\n\r\n    this.footer.append(this.foundCountEl, this.dateBtn, this.controls);\r\n\r\n    this.topbar.container.parentElement.insertBefore(this.footer, chat.input.chatInput);\r\n\r\n    // Append container\r\n    this.element.append(this.backBtn, this.inputSearch.container);\r\n\r\n    this.topbar.container.classList.add('hide-pinned');\r\n    this.topbar.container.parentElement.append(this.element);\r\n\r\n    this.inputSearch.input.focus();\r\n\r\n    if(query) {\r\n      this.setQuery(query);\r\n    }\r\n\r\n    if(!IS_MOBILE_SAFARI) {\r\n      this.navigationItem = {\r\n        type: 'mobile-search',\r\n        onPop: () => {\r\n          this.destroy();\r\n        }\r\n      };\r\n\r\n      appNavigationController.pushItem(this.navigationItem);\r\n    }\r\n  }\r\n\r\n  public destroy() {\r\n    this.topbar.container.classList.remove('hide-pinned');\r\n    this.element.remove();\r\n    this.inputSearch.remove();\r\n    this.results.remove();\r\n    this.footer.remove();\r\n    this.listenerSetter.removeAll();\r\n    this.chat.bubbles.container.classList.remove('search-results-active');\r\n    this.chat.search = undefined;\r\n    appNavigationController.removeItem(this.navigationItem);\r\n  }\r\n\r\n  public setQuery(query: string) {\r\n    this.inputSearch.inputField.value = query;\r\n  }\r\n\r\n  private onDateClick = (e: MouseEvent) => {\r\n    cancelEvent(e);\r\n    PopupElement.createPopup(PopupDatePicker, new Date(), this.chat.bubbles.onDatePick).show();\r\n  };\r\n\r\n  private selectResult(elem: HTMLElement) {\r\n    if(this.setPeerPromise) return this.setPeerPromise;\r\n\r\n    const peerId = elem.dataset.peerId.toPeerId();\r\n    const lastMsgId = +elem.dataset.mid || undefined;\r\n\r\n    const index = whichChild(elem);\r\n\r\n    if(index === (this.foundCount - 1)) {\r\n      this.upBtn.setAttribute('disabled', 'true');\r\n    } else {\r\n      this.upBtn.removeAttribute('disabled');\r\n    }\r\n\r\n    if(!index) {\r\n      this.downBtn.setAttribute('disabled', 'true');\r\n    } else {\r\n      this.downBtn.removeAttribute('disabled');\r\n    }\r\n\r\n    this.results.classList.remove('active');\r\n    this.chat.bubbles.container.classList.remove('search-results-active');\r\n\r\n    const res = this.chat.setPeer(peerId, lastMsgId);\r\n    this.setPeerPromise = ((res instanceof Promise ? res : Promise.resolve(res)) as Promise<any>).then(() => {\r\n      this.selectedIndex = index;\r\n      replaceContent(this.foundCountEl, i18n('Of', [index + 1, this.foundCount]));\r\n\r\n      const renderedCount = this.searchGroup.list.childElementCount;\r\n      if(this.selectedIndex >= (renderedCount - 6)) {\r\n        this.appSearch.searchMore();\r\n      }\r\n    }).finally(() => {\r\n      this.setPeerPromise = null;\r\n    });\r\n  }\r\n\r\n  private onResultsClick = (e: MouseEvent) => {\r\n    const target = findUpTag(e.target, DIALOG_LIST_ELEMENT_TAG);\r\n    if(target) {\r\n      this.selectResult(target);\r\n    }\r\n  };\r\n\r\n  private onFooterClick = (e: MouseEvent) => {\r\n    if(this.foundCount) {\r\n      this.chat.bubbles.container.classList.toggle('search-results-active');\r\n      this.results.classList.toggle('active');\r\n    }\r\n  };\r\n\r\n  private onUpClick = (e: MouseEvent) => {\r\n    cancelEvent(e);\r\n    this.selectResult(this.searchGroup.list.children[this.selectedIndex + 1] as HTMLElement);\r\n  };\r\n\r\n  private onDownClick = (e: MouseEvent) => {\r\n    cancelEvent(e);\r\n    this.selectResult(this.searchGroup.list.children[this.selectedIndex - 1] as HTMLElement);\r\n  };\r\n}\r\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport indexOfAndSplice from '../../helpers/array/indexOfAndSplice';\nimport deepEqual from '../../helpers/object/deepEqual';\nimport {renderImageFromUrlPromise} from '../../helpers/dom/renderImageFromUrl';\nimport mediaSizes, {ScreenSize} from '../../helpers/mediaSizes';\n\ntype ChatBackgroundPatternRendererInitOptions = {\n  url: string,\n  width: number,\n  height: number,\n  mask?: boolean\n};\n\nexport default class ChatBackgroundPatternRenderer {\n  private static INSTANCES: ChatBackgroundPatternRenderer[] = [];\n\n  // private pattern: CanvasPattern;\n  private objectUrl: string;\n  private options: ChatBackgroundPatternRendererInitOptions;\n  private canvases: Set<HTMLCanvasElement>;\n  // private createCanvasPatternPromise: Promise<CanvasPattern>;\n  // private exportCanvasPatternToImagePromise: Promise<string>;\n  private renderImageFromUrlPromise: Promise<HTMLImageElement>;\n  private img: HTMLImageElement;\n\n  constructor() {\n    this.canvases = new Set();\n  }\n\n  public static getInstance(options: ChatBackgroundPatternRendererInitOptions) {\n    let instance = this.INSTANCES.find((instance) => {\n      return deepEqual(instance.options, options);\n    });\n\n    if(!instance) {\n      instance = new ChatBackgroundPatternRenderer();\n      instance.init(options);\n      this.INSTANCES.push(instance);\n    }\n\n    return instance;\n  }\n\n  public init(options: ChatBackgroundPatternRendererInitOptions) {\n    // if(this.options) {\n    //   if(this.options.width !== options.width || this.options.height !== options.height) {\n    //     this.createCanvasPatternPromise =\n    //       this.pattern =\n    //       this.exportCanvasPatternToImagePromise =\n    //       undefined;\n    //   }\n    // }\n\n    this.options = options;\n  }\n\n  public renderToCanvas(canvas: HTMLCanvasElement) {\n    // return this.createCanvasPattern(canvas).then(() => {\n    // return this.fillCanvas(canvas);\n    // });\n\n    return this.renderImageFromUrl(this.options.url).then(() => {\n      return this.fillCanvas(canvas);\n    });\n  }\n\n  private renderImageFromUrl(url: string) {\n    if(this.renderImageFromUrlPromise) return this.renderImageFromUrlPromise;\n    const img = this.img = document.createElement('img');\n    img.crossOrigin = 'anonymous';\n    return this.renderImageFromUrlPromise = renderImageFromUrlPromise(img, url, false).then(() => img);\n  }\n\n  /* private createCanvasPattern(canvas: HTMLCanvasElement) {\n    if(this.createCanvasPatternPromise) return this.createCanvasPatternPromise;\n    return this.createCanvasPatternPromise = this.renderImageFromUrl(this.options.url).then((img) => {\n      let createPatternFrom: HTMLImageElement | HTMLCanvasElement;\n      if(IS_SAFARI) {\n        const canvas = createPatternFrom = document.createElement('canvas');\n        canvas.width = img.naturalWidth;\n        canvas.height = img.naturalHeight;\n        const ctx = canvas.getContext('2d');\n        ctx.drawImage(img, 0, 0, canvas.width, canvas.height);\n      } else {\n        createPatternFrom = img;\n      }\n\n      const perf = performance.now();\n      this.pattern = canvas.getContext('2d').createPattern(createPatternFrom, 'repeat-x');\n      console.warn('creating pattern time:', performance.now() - perf);\n\n      return this.pattern;\n    });\n  }\n\n  public exportCanvasPatternToImage(canvas: HTMLCanvasElement) {\n    if(this.exportCanvasPatternToImagePromise) return this.exportCanvasPatternToImagePromise;\n    return this.exportCanvasPatternToImagePromise = new Promise<string>((resolve) => {\n      canvas.toBlob((blob) => {\n        const newUrl = this.objectUrl = URL.createObjectURL(blob);\n        resolve(newUrl);\n      }, 'image/png');\n    });\n  } */\n\n  public cleanup(canvas: HTMLCanvasElement) {\n    this.canvases.delete(canvas);\n\n    if(!this.canvases.size) {\n      indexOfAndSplice(ChatBackgroundPatternRenderer.INSTANCES, this);\n\n      if(this.objectUrl) {\n        URL.revokeObjectURL(this.objectUrl);\n      }\n    }\n  }\n\n  public fillCanvas(canvas: HTMLCanvasElement) {\n    const context = canvas.getContext('2d');\n    const {width, height} = canvas;\n    // const perf = performance.now();\n    // if(context.fillStyle instanceof CanvasPattern) {\n    //   context.clearRect(0, 0, width, height);\n    // }\n\n    const img = this.img;\n\n    let imageWidth = img.width, imageHeight = img.height;\n    // if(imageHeight < height) {\n    let patternHeight = 1480 * canvas.dpr;\n    // * correct\n    // if(+canvas.dataset.originalHeight !== height) hhh *= 2 / 3;\n    // * but have to make it good\n    if(+canvas.dataset.originalHeight !== height) patternHeight *= .875;\n    const ratio = patternHeight / imageHeight;\n    imageWidth *= ratio;\n    imageHeight = patternHeight;\n    // }\n\n    if(this.options.mask) {\n      context.fillStyle = '#000';\n      context.fillRect(0, 0, width, height);\n      context.globalCompositeOperation = 'destination-out';\n    } else {\n      context.globalCompositeOperation = 'source-over';\n    }\n\n    const d = (y: number) => {\n      for(let x = 0; x < width; x += imageWidth) {\n        context.drawImage(img, x, y, imageWidth, imageHeight);\n      }\n    };\n\n    const centerY = height / 2 - imageHeight / 2;\n    d(centerY);\n\n    if(centerY > 0) {\n      let topY = centerY;\n      do {\n        d(topY -= imageHeight);\n      } while(topY >= 0);\n    }\n\n    const endY = height - 1;\n    for(let bottomY = centerY + imageHeight; bottomY < endY; bottomY += imageHeight) {\n      d(bottomY);\n    }\n\n    // for(let x = 0; x < width; x += imageWidth) {\n    //   for(let y = 0; y < height; y += imageHeight) {\n    //     context.drawImage(img, x, y, imageWidth, imageHeight);\n    //   }\n    // }\n    // context.fillStyle = this.pattern;\n    // context.fillRect(0, 0, width, height);\n    // console.warn('fill canvas time', performance.now() - perf);\n  }\n\n  public setCanvasDimensions(canvas: HTMLCanvasElement) {\n    const devicePixelRatio = Math.min(2, window.devicePixelRatio);\n    const width = this.options.width * devicePixelRatio;\n    let height = this.options.height * devicePixelRatio;\n\n    canvas.dpr = devicePixelRatio;\n    canvas.dataset.originalHeight = '' + height;\n    if(mediaSizes.activeScreen === ScreenSize.large) height *= 1.5;\n    canvas.width = width;\n    canvas.height = height;\n  }\n\n  public createCanvas() {\n    const canvas = document.createElement('canvas');\n    this.canvases.add(canvas);\n    this.setCanvasDimensions(canvas);\n    return canvas;\n  }\n\n  public resize(width: number, height: number) {\n    this.init({\n      ...this.options,\n      width,\n      height\n    });\n\n    const promises: Promise<any>[] = [];\n    for(const canvas of this.canvases) {\n      this.setCanvasDimensions(canvas);\n      promises.push(this.renderToCanvas(canvas));\n    }\n\n    return Promise.all(promises);\n  }\n\n  public static resizeInstances(width: number, height: number) {\n    return Promise.all(this.INSTANCES.map((instance) => instance.resize(width, height)));\n  }\n\n  /* public setResizeMode(resizing: boolean) {\n    const canvases = Array.from(this.canvases);\n    const canvas = canvases[canvases.length - 1];\n    canvas.style.display = resizing ? 'none' : '';\n    const img = this.img;\n    img.style.display = resizing ? '' : 'none';\n\n    return {img, canvas};\n  } */\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport type {ChatRights} from '../../lib/appManagers/appChatsManager';\nimport type {AppImManager} from '../../lib/appManagers/appImManager';\nimport type {MessagesStorageKey} from '../../lib/appManagers/appMessagesManager';\nimport EventListenerBase from '../../helpers/eventListenerBase';\nimport {logger, LogTypes} from '../../lib/logger';\nimport rootScope from '../../lib/rootScope';\nimport appSidebarRight from '../sidebarRight';\nimport ChatBubbles from './bubbles';\nimport ChatContextMenu from './contextMenu';\nimport ChatInput from './input';\nimport ChatSelection from './selection';\nimport ChatTopbar from './topbar';\nimport {NULL_PEER_ID, REPLIES_PEER_ID} from '../../lib/mtproto/mtproto_config';\nimport SetTransition from '../singleTransition';\nimport AppPrivateSearchTab from '../sidebarRight/tabs/search';\nimport renderImageFromUrl from '../../helpers/dom/renderImageFromUrl';\nimport mediaSizes from '../../helpers/mediaSizes';\nimport ChatSearch from './search';\nimport IS_TOUCH_SUPPORTED from '../../environment/touchSupport';\nimport getAutoDownloadSettingsByPeerId, {ChatAutoDownloadSettings} from '../../helpers/autoDownload';\nimport ChatBackgroundGradientRenderer from './gradientRenderer';\nimport ChatBackgroundPatternRenderer from './patternRenderer';\nimport pause from '../../helpers/schedulers/pause';\nimport {AppManagers} from '../../lib/appManagers/managers';\nimport SlicedArray from '../../helpers/slicedArray';\nimport themeController from '../../helpers/themeController';\nimport AppSharedMediaTab from '../sidebarRight/tabs/sharedMedia';\nimport noop from '../../helpers/noop';\nimport middlewarePromise from '../../helpers/middlewarePromise';\nimport indexOfAndSplice from '../../helpers/array/indexOfAndSplice';\nimport {Message} from '../../layer';\n\nexport type ChatType = 'chat' | 'pinned' | 'replies' | 'discussion' | 'scheduled';\n\nexport default class Chat extends EventListenerBase<{\n  setPeer: (mid: number, isTopMessage: boolean) => void\n}> {\n  public container: HTMLElement;\n  public backgroundEl: HTMLElement;\n\n  public topbar: ChatTopbar;\n  public bubbles: ChatBubbles;\n  public input: ChatInput;\n  public selection: ChatSelection;\n  public contextMenu: ChatContextMenu;\n  public search: ChatSearch;\n\n  public wasAlreadyUsed: boolean;\n  // public initPeerId = 0;\n  public peerId: PeerId;\n  public threadId: number;\n  public setPeerPromise: Promise<void>;\n  public peerChanged: boolean;\n\n  public log: ReturnType<typeof logger>;\n\n  public type: ChatType;\n  public messagesStorageKey: MessagesStorageKey;\n\n  public noForwards: boolean;\n\n  public inited: boolean;\n\n  public isRestricted: boolean;\n  public autoDownload: ChatAutoDownloadSettings;\n\n  public gradientRenderer: ChatBackgroundGradientRenderer;\n  public patternRenderer: ChatBackgroundPatternRenderer;\n  public gradientCanvas: HTMLCanvasElement;\n  public patternCanvas: HTMLCanvasElement;\n  public backgroundTempId: number;\n  public setBackgroundPromise: Promise<void>;\n  public sharedMediaTab: AppSharedMediaTab;\n  public sharedMediaTabs: AppSharedMediaTab[];\n  // public renderDarkPattern: () => Promise<void>;\n\n  public isBot: boolean;\n  public isChannel: boolean;\n  public isBroadcast: boolean;\n  public isAnyGroup: boolean;\n  public isMegagroup: boolean;\n\n  constructor(\n    public appImManager: AppImManager,\n    public managers: AppManagers\n  ) {\n    super();\n\n    this.type = 'chat';\n\n    this.container = document.createElement('div');\n    this.container.classList.add('chat', 'tabs-tab');\n\n    this.backgroundEl = document.createElement('div');\n    this.backgroundEl.classList.add('chat-background');\n\n    // * constructor end\n\n    this.log = logger('CHAT', LogTypes.Log | LogTypes.Warn | LogTypes.Debug | LogTypes.Error);\n    // this.log.error('Chat construction');\n\n    this.peerId = NULL_PEER_ID;\n\n    this.container.append(this.backgroundEl);\n    this.appImManager.chatsContainer.append(this.container);\n\n    this.backgroundTempId = 0;\n    this.sharedMediaTabs = [];\n  }\n\n  public setBackground(url: string, skipAnimation?: boolean): Promise<void> {\n    const theme = themeController.getTheme();\n\n    let item: HTMLElement;\n    const isColorBackground = !!theme.background.color && !theme.background.slug && !theme.background.intensity;\n    if(\n      isColorBackground &&\n      document.documentElement.style.cursor === 'grabbing' &&\n      this.gradientRenderer &&\n      !this.patternRenderer\n    ) {\n      this.gradientCanvas.dataset.colors = theme.background.color;\n      this.gradientRenderer.init(this.gradientCanvas);\n      return Promise.resolve();\n    }\n\n    const tempId = ++this.backgroundTempId;\n\n    const previousGradientRenderer = this.gradientRenderer;\n    const previousPatternRenderer = this.patternRenderer;\n    const previousGradientCanvas = this.gradientCanvas;\n    const previousPatternCanvas = this.patternCanvas;\n\n    this.gradientRenderer =\n      this.patternRenderer =\n      this.gradientCanvas =\n      this.patternCanvas =\n      // this.renderDarkPattern =\n      undefined;\n\n    const intensity = theme.background.intensity && theme.background.intensity / 100;\n    const isDarkPattern = !!intensity && intensity < 0;\n\n    let patternRenderer: ChatBackgroundPatternRenderer;\n    let patternCanvas = item?.firstElementChild as HTMLCanvasElement;\n    let gradientCanvas: HTMLCanvasElement;\n    if(!item) {\n      item = document.createElement('div');\n      item.classList.add('chat-background-item');\n\n      if(url) {\n        if(intensity) {\n          item.classList.add('is-pattern');\n\n          const rect = this.appImManager.chatsContainer.getBoundingClientRect();\n          patternRenderer = this.patternRenderer = ChatBackgroundPatternRenderer.getInstance({\n            url,\n            width: rect.width,\n            height: rect.height,\n            mask: isDarkPattern\n          });\n\n          patternCanvas = this.patternCanvas = patternRenderer.createCanvas();\n          patternCanvas.classList.add('chat-background-item-canvas', 'chat-background-item-pattern-canvas');\n\n          if(isDarkPattern) {\n            item.classList.add('is-dark');\n          }\n\n          // if(isDarkPattern) {\n          //   this.renderDarkPattern = () => {\n          //     return patternRenderer.exportCanvasPatternToImage(patternCanvas).then((url) => {\n          //       if(this.backgroundTempId !== tempId) {\n          //         return;\n          //       }\n\n          //       gradientCanvas.style.webkitMaskImage = `url(${url})`;\n          //     });\n          //   };\n          // }\n        } else if(theme.background.slug) {\n          item.classList.add('is-image');\n        }\n      } else if(theme.background.color) {\n        item.classList.add('is-color');\n      }\n    }\n\n    let gradientRenderer: ChatBackgroundGradientRenderer;\n    const color = theme.background.color;\n    if(color) {\n      // if(color.includes(',')) {\n      const {canvas, gradientRenderer: _gradientRenderer} = ChatBackgroundGradientRenderer.create(color);\n      gradientRenderer = this.gradientRenderer = _gradientRenderer;\n      gradientCanvas = this.gradientCanvas = canvas;\n      gradientCanvas.classList.add('chat-background-item-canvas', 'chat-background-item-color-canvas');\n\n      if(rootScope.settings.animationsEnabled) {\n        gradientRenderer.scrollAnimate(true);\n      }\n      // } else {\n      //   item.style.backgroundColor = color;\n      //   item.style.backgroundImage = 'none';\n      // }\n    }\n\n    if(patternRenderer) {\n      const setOpacityTo = isDarkPattern ? gradientCanvas : patternCanvas;\n      setOpacityTo.style.setProperty('--opacity-max', '' + Math.abs(intensity));\n    }\n\n    const promise = new Promise<void>((resolve) => {\n      const cb = () => {\n        if(this.backgroundTempId !== tempId) {\n          if(patternRenderer) {\n            patternRenderer.cleanup(patternCanvas);\n          }\n\n          if(gradientRenderer) {\n            gradientRenderer.cleanup();\n          }\n\n          return;\n        }\n\n        const prev = this.backgroundEl.lastElementChild as HTMLElement;\n\n        if(prev === item) {\n          resolve();\n          return;\n        }\n\n        const append = [\n          gradientCanvas,\n          // isDarkPattern && this.renderDarkPattern ? undefined : patternCanvas\n          patternCanvas\n        ].filter(Boolean);\n        if(append.length) {\n          item.append(...append);\n        }\n\n        this.backgroundEl.append(item);\n\n        SetTransition(item, 'is-visible', true, !skipAnimation ? 200 : 0, prev ? () => {\n          if(previousPatternRenderer) {\n            previousPatternRenderer.cleanup(previousPatternCanvas);\n          }\n\n          if(previousGradientRenderer) {\n            previousGradientRenderer.cleanup();\n          }\n\n          prev.remove();\n        } : null, 2);\n\n        resolve();\n      };\n\n      if(patternRenderer) {\n        const renderPatternPromise = patternRenderer.renderToCanvas(patternCanvas);\n        renderPatternPromise.then(() => {\n          if(this.backgroundTempId !== tempId) {\n            return;\n          }\n\n          // let promise: Promise<any>;\n          // if(isDarkPattern && this.renderDarkPattern) {\n          //   promise = this.renderDarkPattern();\n          // } else {\n          // const promise = Promise.resolve();\n          // }\n\n          // promise.then(cb);\n          cb();\n        });\n      } else if(url) {\n        renderImageFromUrl(item, url, cb);\n      } else {\n        cb();\n      }\n    });\n\n    return this.setBackgroundPromise = Promise.race([\n      pause(500),\n      promise\n    ]);\n  }\n\n  public setType(type: ChatType) {\n    this.type = type;\n  }\n\n  public init(/* peerId: PeerId */) {\n    // this.initPeerId = peerId;\n\n    this.topbar = new ChatTopbar(this, appSidebarRight, this.managers);\n    this.bubbles = new ChatBubbles(this, this.managers);\n    this.input = new ChatInput(this, this.appImManager, this.managers);\n    this.contextMenu = new ChatContextMenu(this, this.managers);\n    this.selection = new ChatSelection(this, this.bubbles, this.input, this.managers);\n\n    if(this.type === 'chat') {\n      this.topbar.constructUtils();\n      this.topbar.constructPeerHelpers();\n    } else if(this.type === 'pinned') {\n      this.topbar.constructPinnedHelpers();\n    } else if(this.type === 'discussion') {\n      this.topbar.constructUtils();\n      this.topbar.constructDiscussionHelpers();\n    }\n\n    this.topbar.construct();\n    this.input.construct();\n\n    if(this.type === 'chat') { // *   ,   -   \n      this.bubbles.constructPeerHelpers();\n      this.input.constructPeerHelpers();\n    } else if(this.type === 'pinned') {\n      this.bubbles.constructPinnedHelpers();\n      this.input.constructPinnedHelpers();\n    } else if(this.type === 'scheduled') {\n      this.bubbles.constructScheduledHelpers();\n      this.input.constructPeerHelpers();\n    } else if(this.type === 'discussion') {\n      this.bubbles.constructPeerHelpers();\n      this.input.constructPeerHelpers();\n    }\n\n    if(this.type !== 'scheduled' && !IS_TOUCH_SUPPORTED) {\n      this.bubbles.setReactionsHoverListeners();\n    }\n\n    this.bubbles.attachContainerListeners();\n\n    this.container.classList.add('type-' + this.type);\n    this.container.append(this.topbar.container, this.bubbles.container, this.input.chatInput);\n\n    this.bubbles.listenerSetter.add(rootScope)('dialog_migrate', ({migrateFrom, migrateTo}) => {\n      if(this.peerId === migrateFrom) {\n        this.setPeer(migrateTo);\n      }\n    });\n\n    this.bubbles.listenerSetter.add(rootScope)('dialog_drop', (e) => {\n      if(e.peerId === this.peerId) {\n        this.appImManager.setPeer();\n      }\n    });\n  }\n\n  public beforeDestroy() {\n    this.bubbles.cleanup();\n  }\n\n  private cleanupBackground() {\n    ++this.backgroundTempId;\n    if(this.patternRenderer) {\n      this.patternRenderer.cleanup(this.patternCanvas);\n      this.patternRenderer = undefined;\n    }\n\n    if(this.gradientRenderer) {\n      this.gradientRenderer.cleanup();\n      this.gradientRenderer = undefined;\n    }\n  }\n\n  public destroy() {\n    // const perf = performance.now();\n\n    this.topbar.destroy();\n    this.bubbles.destroy();\n    this.input.destroy();\n    this.contextMenu && this.contextMenu.destroy();\n    this.selection && this.selection.attachListeners(undefined, undefined);\n\n    this.cleanupBackground();\n\n    delete this.topbar;\n    delete this.bubbles;\n    delete this.input;\n    delete this.selection;\n    delete this.contextMenu;\n\n    this.container.remove();\n\n    // this.log.error('Chat destroy time:', performance.now() - perf);\n  }\n\n  public cleanup(helperToo = true) {\n    this.input.cleanup(helperToo);\n    this.topbar.cleanup();\n    this.selection.cleanup();\n  }\n\n  public async onChangePeer(m: ReturnType<typeof middlewarePromise>) {\n    const {peerId} = this;\n\n    const searchTab = appSidebarRight.getTab(AppPrivateSearchTab);\n    if(searchTab) {\n      searchTab.close();\n    }\n\n    const [\n      noForwards,\n      isRestricted,\n      isAnyGroup,\n      _,\n      isMegagroup,\n      isBroadcast,\n      isChannel,\n      isBot\n    ] = await m(Promise.all([\n      this.managers.appPeersManager.noForwards(peerId),\n      this.managers.appPeersManager.isRestricted(peerId),\n      this._isAnyGroup(peerId),\n      this.setAutoDownloadMedia(),\n      this.managers.appPeersManager.isMegagroup(peerId),\n      this.managers.appPeersManager.isBroadcast(peerId),\n      this.managers.appPeersManager.isChannel(peerId),\n      this.managers.appPeersManager.isBot(peerId)\n    ]));\n\n    this.noForwards = noForwards;\n    this.isRestricted = isRestricted;\n    this.isAnyGroup = isAnyGroup;\n    this.isMegagroup = isMegagroup;\n    this.isBroadcast = isBroadcast;\n    this.isChannel = isChannel;\n    this.isBot = isBot;\n\n    this.container.classList.toggle('no-forwards', this.noForwards);\n\n    this.sharedMediaTab = appSidebarRight.createSharedMediaTab();\n    this.sharedMediaTabs.push(this.sharedMediaTab);\n\n    this.sharedMediaTab.setPeer(peerId, this.threadId);\n    this.input.clearHelper(); // \n    this.selection.cleanup(); // TODO: REFACTOR !!!!!!\n  }\n\n  public setPeer(peerId: PeerId, lastMsgId?: number, startParam?: string) {\n    if(!peerId) {\n      this.inited = undefined;\n    } else if(!this.inited) {\n      if(this.init) {\n        this.init(/* peerId */);\n        this.init = null;\n      }\n\n      this.inited = true;\n    }\n\n    // const appMediaViewer = (window as any).appMediaViewer as AppMediaViewerBase<any, any, any>;\n    // if(appMediaViewer) {\n    //   appMediaViewer.close();\n    // }\n\n    const samePeer = this.peerId === peerId;\n    if(!samePeer) {\n      this.appImManager.dispatchEvent('peer_changing', this);\n      this.peerId = peerId || NULL_PEER_ID;\n      this.messagesStorageKey = `${this.peerId}_${this.type === 'scheduled' ? 'scheduled' : 'history'}`;\n    } else if(this.setPeerPromise) {\n      return;\n    }\n\n    if(!peerId) {\n      appSidebarRight.toggleSidebar(false);\n      this.cleanup(true);\n      this.bubbles.setPeer(false, peerId);\n      this.appImManager.dispatchEvent('peer_changed', peerId);\n\n      appSidebarRight.replaceSharedMediaTab();\n      this.destroySharedMediaTab();\n      this.sharedMediaTab = undefined;\n\n      return;\n    }\n\n    this.peerChanged = samePeer;\n\n    const bubblesSetPeerPromise = this.bubbles.setPeer(samePeer, peerId, lastMsgId, startParam);\n    const setPeerPromise = this.setPeerPromise = bubblesSetPeerPromise.then((result) => {\n      return result.promise;\n    }).catch(noop).finally(() => {\n      if(this.setPeerPromise === setPeerPromise) {\n        this.setPeerPromise = null;\n      }\n    });\n\n    return bubblesSetPeerPromise;\n  }\n\n  public destroySharedMediaTab(tab = this.sharedMediaTab) {\n    indexOfAndSplice(this.sharedMediaTabs, tab);\n    tab.destroy();\n  }\n\n  public async setAutoDownloadMedia() {\n    this.autoDownload = await getAutoDownloadSettingsByPeerId(this.peerId);\n  }\n\n  public setMessageId(messageId?: number) {\n    return this.setPeer(this.peerId, messageId);\n  }\n\n  public async finishPeerChange(isTarget: boolean, isJump: boolean, lastMsgId: number, startParam?: string) {\n    if(this.peerChanged) return;\n\n    const peerId = this.peerId;\n    this.peerChanged = true;\n    this.wasAlreadyUsed = true;\n\n    const middleware = this.bubbles.getMiddleware();\n\n    this.cleanup(false);\n\n    const sharedMediaTab = this.sharedMediaTab;\n    sharedMediaTab.loadSidebarMedia(true);\n\n    const callbacksPromise = Promise.all([\n      this.topbar.finishPeerChange(isTarget),\n      this.bubbles.finishPeerChange(),\n      this.input.finishPeerChange(startParam)\n    ]);\n\n    const [callbacks] = await Promise.all([\n      callbacksPromise,\n      sharedMediaTab.fillProfileElements()\n    ]);\n\n    if(!middleware()) {\n      return;\n    }\n\n    callbacks.forEach((callback) => {\n      callback();\n    });\n\n    appSidebarRight.replaceSharedMediaTab(sharedMediaTab);\n\n    this.sharedMediaTabs.filter((tab) => tab !== sharedMediaTab).forEach((tab) => this.destroySharedMediaTab(tab));\n\n    this.log.setPrefix('CHAT-' + peerId + '-' + this.type);\n\n    this.appImManager.dispatchEvent('peer_changed', peerId);\n  }\n\n  public getMessage(mid: number) {\n    return this.managers.appMessagesManager.getMessageFromStorage(this.messagesStorageKey, mid);\n  }\n\n  public async getMidsByMid(mid: number) {\n    return this.managers.appMessagesManager.getMidsByMessage(await this.getMessage(mid));\n  }\n\n  public getHistoryStorage(ignoreThreadId?: boolean) {\n    return this.managers.appMessagesManager.getHistoryStorageTransferable(this.peerId, ignoreThreadId ? undefined : this.threadId)\n    .then((historyStorageTransferable) => {\n      return {\n        ...historyStorageTransferable,\n        history: SlicedArray.fromJSON<number>(historyStorageTransferable.historySerialized)\n      }\n    });\n  }\n\n  public getHistoryMaxId() {\n    return this.getHistoryStorage().then((historyStorage) => historyStorage.maxId);\n  }\n\n  public async _isAnyGroup(peerId: PeerId) {\n    return peerId === rootScope.myId || peerId === REPLIES_PEER_ID || (await this.managers.appPeersManager.isAnyGroup(peerId));\n  }\n\n  public initSearch(query?: string) {\n    if(!this.peerId) return;\n\n    if(mediaSizes.isMobile) {\n      if(!this.search) {\n        this.search = new ChatSearch(this.topbar, this, query);\n      } else {\n        this.search.setQuery(query);\n      }\n    } else {\n      let tab = appSidebarRight.getTab(AppPrivateSearchTab);\n      if(!tab) {\n        tab = appSidebarRight.createTab(AppPrivateSearchTab);\n      }\n\n      tab.open(this.peerId, this.threadId, this.bubbles.onDatePick, query);\n    }\n  }\n\n  public canSend(action?: ChatRights) {\n    return this.managers.appMessagesManager.canSendToPeer(this.peerId, this.threadId, action);\n  }\n\n  public isStartButtonNeeded() {\n    return Promise.all([\n      this.managers.appPeersManager.isBot(this.peerId),\n      this.managers.appMessagesManager.getDialogOnly(this.peerId),\n      this.getHistoryStorage(true)\n    ]).then(([isBot, dialog, historyStorage]) => {\n      return isBot && !dialog && !historyStorage.history.length;\n    });\n  }\n\n  public getMessageSendingParams() {\n    return {\n      threadId: this.threadId,\n      replyToMsgId: this.input.replyToMsgId,\n      scheduleDate: this.input.scheduleDate,\n      sendSilent: this.input.sendSilent,\n      sendAsPeerId: this.input.sendAsPeerId\n    };\n  }\n\n  public isOurMessage(message: Message.message | Message.messageService) {\n    return message.fromId === rootScope.myId || (!!message.pFlags.out && this.isMegagroup);\n  }\n\n  public isOutMessage(message: Message.message | Message.messageService) {\n    const fwdFrom = (message as Message.message).fwd_from;\n    const isOut = this.isOurMessage(message) && (!fwdFrom || this.peerId !== rootScope.myId);\n    return !!isOut;\n  }\n\n  public isAvatarNeeded(message: Message.message | Message.messageService) {\n    return this.isAnyGroup && !this.isOutMessage(message);\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport type {State} from '../config/state';\nimport rootScope from '../lib/rootScope';\n\nexport type ChatAutoDownloadSettings = {\n  photo: number,\n  video: number,\n  file: number\n};\n\nexport default async function getAutoDownloadSettingsByPeerId(peerId: PeerId): Promise<ChatAutoDownloadSettings> {\n  let type: keyof State['settings']['autoDownload'];\n\n  let photoSizeMax = 0, videoSizeMax = 0, fileSizeMax = 0;\n  const settings = rootScope.settings;\n  const appPeersManager = rootScope.managers.appPeersManager;\n  if(!settings.autoDownloadNew.pFlags.disabled && peerId) {\n    if(peerId.isUser()) {\n      if(await appPeersManager.isContact(peerId)) {\n        type = 'contacts';\n      } else {\n        type = 'private';\n      }\n    } else if(await appPeersManager.isBroadcast(peerId)) {\n      type = 'channels';\n    } else {\n      type = 'groups';\n    }\n\n    if(settings.autoDownload.photo[type]) photoSizeMax = settings.autoDownloadNew.photo_size_max;\n    if(settings.autoDownload.video[type]) videoSizeMax = settings.autoDownloadNew.video_size_max;\n    if(settings.autoDownload.file[type]) fileSizeMax = settings.autoDownloadNew.file_size_max;\n  }\n\n  return {\n    photo: photoSizeMax,\n    video: videoSizeMax,\n    file: fileSizeMax\n  };\n}\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport type {AppImManager} from '../../lib/appManagers/appImManager';\r\nimport ButtonIcon from '../buttonIcon';\r\nimport IS_TOUCH_SUPPORTED from '../../environment/touchSupport';\r\nimport {IS_APPLE, IS_MOBILE} from '../../environment/userAgent';\r\nimport appNavigationController from '../appNavigationController';\r\nimport {_i18n} from '../../lib/langPack';\r\nimport cancelEvent from '../../helpers/dom/cancelEvent';\r\nimport {attachClickEvent} from '../../helpers/dom/clickEvent';\r\nimport getSelectedNodes from '../../helpers/dom/getSelectedNodes';\r\nimport isSelectionEmpty from '../../helpers/dom/isSelectionEmpty';\r\nimport {MarkdownType, markdownTags} from '../../helpers/dom/getRichElementValue';\r\nimport getVisibleRect from '../../helpers/dom/getVisibleRect';\r\nimport clamp from '../../helpers/number/clamp';\r\nimport matchUrl from '../../lib/richTextProcessor/matchUrl';\r\nimport matchUrlProtocol from '../../lib/richTextProcessor/matchUrlProtocol';\r\n// import { logger } from \"../../lib/logger\";\r\n\r\nexport default class MarkupTooltip {\r\n  public container: HTMLElement;\r\n  private wrapper: HTMLElement;\r\n  private buttons: {[type in MarkdownType]: HTMLElement} = {} as any;\r\n  private linkBackButton: HTMLElement;\r\n  private linkApplyButton: HTMLButtonElement;\r\n  private hideTimeout: number;\r\n  private addedListener = false;\r\n  private waitingForMouseUp = false;\r\n  private linkInput: HTMLInputElement;\r\n  private savedRange: Range;\r\n  private mouseUpCounter: number = 0;\r\n  // private log: ReturnType<typeof logger>;\r\n\r\n  constructor(private appImManager: AppImManager) {\r\n    // this.log = logger('MARKUP');\r\n  }\r\n\r\n  private init() {\r\n    this.container = document.createElement('div');\r\n    this.container.classList.add('markup-tooltip', 'z-depth-1', 'hide');\r\n\r\n    this.wrapper = document.createElement('div');\r\n    this.wrapper.classList.add('markup-tooltip-wrapper');\r\n\r\n    const tools1 = document.createElement('div');\r\n    const tools2 = document.createElement('div');\r\n    tools1.classList.add('markup-tooltip-tools');\r\n    tools2.classList.add('markup-tooltip-tools');\r\n\r\n    const arr = ['bold', 'italic', 'underline', 'strikethrough', 'monospace', 'spoiler', 'link'] as (keyof MarkupTooltip['buttons'])[];\r\n    arr.forEach((c) => {\r\n      const button = ButtonIcon(c, {noRipple: true});\r\n      tools1.append(this.buttons[c] = button);\r\n\r\n      if(c !== 'link') {\r\n        button.addEventListener('mousedown', (e) => {\r\n          cancelEvent(e);\r\n          this.appImManager.chat.input.applyMarkdown(c);\r\n          this.cancelClosening();\r\n\r\n          /* this.mouseUpCounter = 0;\r\n          this.setMouseUpEvent(); */\r\n          // this.hide();\r\n        });\r\n      } else {\r\n        attachClickEvent(button, (e) => {\r\n          cancelEvent(e);\r\n          this.showLinkEditor();\r\n          this.cancelClosening();\r\n        });\r\n      }\r\n    });\r\n\r\n    this.linkBackButton = ButtonIcon('left', {noRipple: true});\r\n    this.linkInput = document.createElement('input');\r\n    _i18n(this.linkInput, 'MarkupTooltip.LinkPlaceholder', undefined, 'placeholder');\r\n    this.linkInput.classList.add('input-clear');\r\n    this.linkInput.addEventListener('keydown', (e) => {\r\n      const valid = !this.linkInput.value.length || !!matchUrl(this.linkInput.value);// /^(http)|(https):\\/\\//i.test(this.linkInput.value);\r\n\r\n      if(e.key === 'Enter') {\r\n        if(!valid) {\r\n          if(this.linkInput.classList.contains('error')) {\r\n            this.linkInput.classList.remove('error');\r\n            void this.linkInput.offsetLeft; // reflow\r\n          }\r\n\r\n          this.linkInput.classList.add('error');\r\n        } else {\r\n          this.applyLink(e);\r\n        }\r\n      }\r\n    });\r\n\r\n    this.linkInput.addEventListener('input', (e) => {\r\n      const valid = this.isLinkValid();\r\n\r\n      this.linkInput.classList.toggle('is-valid', valid);\r\n      this.linkInput.classList.remove('error');\r\n    });\r\n\r\n    this.linkBackButton.addEventListener('mousedown', (e) => {\r\n      // this.log('linkBackButton click');\r\n      cancelEvent(e);\r\n      this.container.classList.remove('is-link');\r\n      // input.value = '';\r\n      this.resetSelection();\r\n      this.setTooltipPosition();\r\n      this.cancelClosening();\r\n    });\r\n\r\n    this.linkApplyButton = ButtonIcon('check markup-tooltip-link-apply', {noRipple: true});\r\n    this.linkApplyButton.addEventListener('mousedown', (e) => {\r\n      // this.log('linkApplyButton click');\r\n      this.applyLink(e);\r\n    });\r\n\r\n    const applyDiv = document.createElement('div');\r\n    applyDiv.classList.add('markup-tooltip-link-apply-container');\r\n\r\n    const delimiter1 = document.createElement('span');\r\n    const delimiter2 = document.createElement('span');\r\n    const delimiter3 = document.createElement('span');\r\n    delimiter1.classList.add('markup-tooltip-delimiter');\r\n    delimiter2.classList.add('markup-tooltip-delimiter');\r\n    delimiter3.classList.add('markup-tooltip-delimiter');\r\n    tools1.insertBefore(delimiter1, this.buttons.link);\r\n    applyDiv.append(delimiter3, this.linkApplyButton);\r\n    tools2.append(this.linkBackButton, delimiter2, this.linkInput, applyDiv);\r\n    // tools1.insertBefore(delimiter2, this.buttons.link.nextSibling);\r\n\r\n    this.wrapper.append(tools1, tools2);\r\n    this.container.append(this.wrapper);\r\n    document.body.append(this.container);\r\n\r\n    window.addEventListener('resize', () => {\r\n      this.hide();\r\n    });\r\n  }\r\n\r\n  public showLinkEditor() {\r\n    if(!this.container || !this.container.classList.contains('is-visible')) { // * if not inited yet (Ctrl+A + Ctrl+K)\r\n      this.show();\r\n    }\r\n\r\n    const button = this.buttons.link;\r\n    this.container.classList.add('is-link');\r\n\r\n    const selection = document.getSelection();\r\n    this.savedRange = selection.getRangeAt(0);\r\n\r\n    if(button.classList.contains('active')) {\r\n      const startContainer = this.savedRange.startContainer;\r\n      const anchor = startContainer.parentElement as HTMLAnchorElement;\r\n      this.linkInput.value = anchor.href;\r\n    } else {\r\n      this.linkInput.value = '';\r\n    }\r\n\r\n    this.setTooltipPosition(true);\r\n\r\n    setTimeout(() => {\r\n      this.linkInput.focus(); // !!! instant focus will break animation\r\n    }, 200);\r\n    this.linkInput.classList.toggle('is-valid', this.isLinkValid());\r\n  }\r\n\r\n  private applyLink(e: Event) {\r\n    cancelEvent(e);\r\n    this.resetSelection();\r\n    let url = this.linkInput.value;\r\n    if(url && !matchUrlProtocol(url)) {\r\n      url = 'https://' + url;\r\n    }\r\n    this.appImManager.chat.input.applyMarkdown('link', url);\r\n    setTimeout(() => {\r\n      this.hide();\r\n    }, 0);\r\n  }\r\n\r\n  private isLinkValid() {\r\n    return !this.linkInput.value.length || !!matchUrl(this.linkInput.value);\r\n  }\r\n\r\n  private resetSelection(range: Range = this.savedRange) {\r\n    const selection = window.getSelection();\r\n    selection.removeAllRanges();\r\n    selection.addRange(range);\r\n    this.appImManager.chat.input.messageInput.focus();\r\n  }\r\n\r\n  public hide() {\r\n    // return;\r\n\r\n    if(this.init) return;\r\n\r\n    this.container.classList.remove('is-visible');\r\n    // document.removeEventListener('mouseup', this.onMouseUp);\r\n    document.removeEventListener('mouseup', this.onMouseUpSingle);\r\n    this.waitingForMouseUp = false;\r\n\r\n    appNavigationController.removeByType('markup');\r\n\r\n    if(this.hideTimeout) clearTimeout(this.hideTimeout);\r\n    this.hideTimeout = window.setTimeout(() => {\r\n      this.hideTimeout = undefined;\r\n      this.container.classList.add('hide');\r\n      this.container.classList.remove('is-link');\r\n    }, 200);\r\n  }\r\n\r\n  public getActiveMarkupButton() {\r\n    const nodes = getSelectedNodes();\r\n    const parents = [...new Set(nodes.map((node) => node.parentNode))];\r\n    // if(parents.length > 1 && parents) return [];\r\n\r\n    const currentMarkups: Set<HTMLElement> = new Set();\r\n    (parents as HTMLElement[]).forEach((node) => {\r\n      for(const type in markdownTags) {\r\n        const tag = markdownTags[type as MarkdownType];\r\n        const closest = node.closest(tag.match + ', [contenteditable]');\r\n        if(closest !== this.appImManager.chat.input.messageInput) {\r\n          currentMarkups.add(this.buttons[type as MarkdownType]);\r\n        }\r\n      }\r\n    });\r\n\r\n\r\n    return [...currentMarkups];\r\n  }\r\n\r\n  public setActiveMarkupButton() {\r\n    const activeButtons = this.getActiveMarkupButton();\r\n\r\n    for(const i in this.buttons) {\r\n      // @ts-ignore\r\n      const button = this.buttons[i];\r\n      button.classList.toggle('active', activeButtons.includes(button));\r\n    }\r\n  }\r\n\r\n  private setTooltipPosition(isLinkToggle = false) {\r\n    const selection = document.getSelection();\r\n    const range = selection.getRangeAt(0);\r\n\r\n    const bodyRect = document.body.getBoundingClientRect();\r\n    const selectionRect = range.getBoundingClientRect();\r\n    const inputRect = this.appImManager.chat.input.rowsWrapper.getBoundingClientRect();\r\n\r\n    this.container.style.maxWidth = inputRect.width + 'px';\r\n\r\n    const visibleRect = getVisibleRect(undefined, this.appImManager.chat.input.messageInput, false, selectionRect);\r\n\r\n    const selectionTop = visibleRect.rect.top/* selectionRect.top */ + (bodyRect.top * -1);\r\n\r\n    const currentTools = this.container.classList.contains('is-link') ? this.wrapper.lastElementChild : this.wrapper.firstElementChild;\r\n\r\n    const sizesRect = currentTools.getBoundingClientRect();\r\n    const top = selectionTop - sizesRect.height - 8;\r\n\r\n    const minX = inputRect.left;\r\n    const maxX = (inputRect.left + inputRect.width) - Math.min(inputRect.width, sizesRect.width);\r\n    let left: number;\r\n    if(isLinkToggle) {\r\n      const containerRect = this.container.getBoundingClientRect();\r\n      left = clamp(containerRect.left, minX, maxX);\r\n    } else {\r\n      const x = selectionRect.left + (selectionRect.width - sizesRect.width) / 2;\r\n      left = clamp(x, minX, maxX);\r\n    }\r\n\r\n    /* const isClamped = x !== minX && x !== maxX && (left === minX || left === maxX || this.container.getBoundingClientRect().left >= maxX);\r\n\r\n    if(isLinkToggle && this.container.classList.contains('is-link') && !isClamped) return; */\r\n\r\n    this.container.style.transform = `translate3d(${left}px, ${top}px, 0)`;\r\n  }\r\n\r\n  public show() {\r\n    if(this.init) {\r\n      this.init();\r\n      this.init = null;\r\n    }\r\n\r\n    if(isSelectionEmpty()) {\r\n      this.hide();\r\n      return;\r\n    }\r\n\r\n    if(this.hideTimeout !== undefined) {\r\n      clearTimeout(this.hideTimeout);\r\n    }\r\n\r\n    if(this.container.classList.contains('is-visible')) {\r\n      return;\r\n    }\r\n\r\n    this.setActiveMarkupButton();\r\n\r\n    this.container.classList.remove('is-link');\r\n    const isFirstShow = this.container.classList.contains('hide');\r\n    if(isFirstShow) {\r\n      this.container.classList.remove('hide');\r\n      this.container.classList.add('no-transition');\r\n    }\r\n\r\n    this.setTooltipPosition();\r\n\r\n    if(isFirstShow) {\r\n      void this.container.offsetLeft; // reflow\r\n      this.container.classList.remove('no-transition');\r\n    }\r\n\r\n    this.container.classList.add('is-visible');\r\n\r\n    if(!IS_MOBILE) {\r\n      appNavigationController.pushItem({\r\n        type: 'markup',\r\n        onPop: () => {\r\n          this.hide();\r\n        }\r\n      });\r\n    }\r\n\r\n    // this.log('selection', selectionRect, activeButton);\r\n  }\r\n\r\n  /* private onMouseUp = (e: Event) => {\r\n    this.log('onMouseUp');\r\n    if(findUpClassName(e.target, 'markup-tooltip')) return;\r\n\r\n    this.hide();\r\n    //document.removeEventListener('mouseup', this.onMouseUp);\r\n  }; */\r\n\r\n  private onMouseUpSingle = (e?: Event) => {\r\n    // this.log('onMouseUpSingle');\r\n    this.waitingForMouseUp = false;\r\n\r\n    if(IS_TOUCH_SUPPORTED) {\r\n      e && cancelEvent(e);\r\n      if(this.mouseUpCounter++ === 0) {\r\n        this.resetSelection(this.savedRange);\r\n      } else {\r\n        this.hide();\r\n        return;\r\n      }\r\n    }\r\n\r\n    this.show();\r\n\r\n    /* !isTouchSupported && document.addEventListener('mouseup', this.onMouseUp); */\r\n  };\r\n\r\n  public setMouseUpEvent() {\r\n    if(this.waitingForMouseUp) return;\r\n    this.waitingForMouseUp = true;\r\n\r\n    // this.log('setMouseUpEvent');\r\n\r\n    document.addEventListener('mouseup', this.onMouseUpSingle, {once: true});\r\n  }\r\n\r\n  public cancelClosening() {\r\n    if(IS_TOUCH_SUPPORTED && !IS_APPLE) {\r\n      document.removeEventListener('mouseup', this.onMouseUpSingle);\r\n      document.addEventListener('mouseup', (e) => {\r\n        cancelEvent(e);\r\n        this.mouseUpCounter = 1;\r\n        this.waitingForMouseUp = false;\r\n        this.setMouseUpEvent();\r\n      }, {once: true});\r\n    }\r\n  }\r\n\r\n  public handleSelection() {\r\n    if(this.addedListener) return;\r\n    this.addedListener = true;\r\n    document.addEventListener('selectionchange', (e) => {\r\n      // this.log('selectionchange');\r\n\r\n      if(document.activeElement === this.linkInput) {\r\n        return;\r\n      }\r\n\r\n      const messageInput = this.appImManager.chat.input.messageInput;\r\n      if(document.activeElement !== messageInput) {\r\n        this.hide();\r\n        return;\r\n      }\r\n\r\n      const selection = document.getSelection();\r\n      if(isSelectionEmpty(selection)) {\r\n        this.hide();\r\n        return;\r\n      }\r\n\r\n      if(IS_TOUCH_SUPPORTED) {\r\n        if(IS_APPLE) {\r\n          this.show();\r\n          this.setTooltipPosition(); // * because can skip this in .show();\r\n        } else {\r\n          if(this.mouseUpCounter === 2) {\r\n            this.mouseUpCounter = 0;\r\n            return;\r\n          }\r\n\r\n          this.savedRange = selection.getRangeAt(0);\r\n          this.setMouseUpEvent();\r\n          /* document.addEventListener('touchend', (e) => {\r\n            cancelEvent(e);\r\n            this.resetSelection(range);\r\n            this.show();\r\n          }, {once: true, passive: false}); */\r\n        }\r\n      } else if(this.container && this.container.classList.contains('is-visible')) {\r\n        this.setTooltipPosition();\r\n      } else if(messageInput.matches(':active')) {\r\n        this.setMouseUpEvent();\r\n      } else {\r\n        this.show();\r\n      }\r\n    });\r\n  }\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nexport default function getSelectedNodes() {\r\n  const nodes: Node[] = [];\r\n  const selection = window.getSelection();\r\n  for(let i = 0; i < selection.rangeCount; ++i) {\r\n    const range = selection.getRangeAt(i);\r\n    let {startContainer, endContainer} = range;\r\n    if(endContainer.nodeType !== 3) endContainer = endContainer.firstChild;\r\n\r\n    while(startContainer && startContainer !== endContainer) {\r\n      nodes.push(startContainer.nodeType === 3 ? startContainer : startContainer.firstChild);\r\n      startContainer = startContainer.nextSibling;\r\n    }\r\n\r\n    if(nodes[nodes.length - 1] !== endContainer) {\r\n      nodes.push(endContainer);\r\n    }\r\n  }\r\n\r\n  // * filter null's due to <br>\r\n  return nodes.filter((node) => !!node);\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport generatePathData from '../../helpers/generatePathData';\r\nimport {FormatterArguments, i18n, LangPackKey} from '../../lib/langPack';\r\n\r\nexport default class ChatDragAndDrop {\r\n  container: HTMLDivElement;\r\n  svg: SVGSVGElement;\r\n  outlineWrapper: HTMLDivElement;\r\n  path: SVGPathElement;\r\n\r\n  constructor(appendTo: HTMLElement, private options: {\r\n    icon?: string,\r\n    header: LangPackKey,\r\n    headerArgs?: FormatterArguments,\r\n    subtitle?: LangPackKey,\r\n    onDrop: (e: DragEvent) => void\r\n  }) {\r\n    this.container = document.createElement('div');\r\n    this.container.classList.add('drop', 'z-depth-1');\r\n\r\n    this.outlineWrapper = document.createElement('div');\r\n    this.outlineWrapper.classList.add('drop-outline-wrapper');\r\n\r\n    this.svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');\r\n    this.svg.classList.add('drop-outline');\r\n\r\n    this.path = document.createElementNS('http://www.w3.org/2000/svg', 'path');\r\n    this.path.classList.add('drop-outline-path');\r\n\r\n    let dropIcon: HTMLElement;\r\n    if(options.icon) {\r\n      dropIcon = document.createElement('div');\r\n      dropIcon.classList.add('drop-icon', 'tgico-' + options.icon);\r\n    }\r\n\r\n    const dropHeader = document.createElement('div');\r\n    dropHeader.classList.add('drop-header');\r\n    dropHeader.append(i18n(options.header, options.headerArgs));\r\n\r\n    let dropSubtitle: HTMLElement;\r\n    if(options.subtitle) {\r\n      dropSubtitle = document.createElement('div');\r\n      dropSubtitle.classList.add('drop-subtitle');\r\n      dropSubtitle.append(i18n(options.subtitle));\r\n    }\r\n\r\n    this.svg.append(this.path);\r\n    this.outlineWrapper.append(this.svg);\r\n\r\n    this.container.append(...[this.outlineWrapper, dropIcon, dropHeader, dropSubtitle].filter(Boolean));\r\n    appendTo.append(this.container);\r\n\r\n    this.container.addEventListener('dragover', this.onDragOver);\r\n    this.container.addEventListener('dragleave', this.onDragLeave);\r\n    this.container.addEventListener('drop', this.onDrop);\r\n  }\r\n\r\n  onDragOver = (e: DragEvent) => {\r\n    this.container.classList.add('is-dragover');\r\n    // SetTransition(this.container, 'is-dragover', true, 500);\r\n  };\r\n\r\n  onDragLeave = (e: DragEvent) => {\r\n    this.container.classList.remove('is-dragover');\r\n    // SetTransition(this.container, 'is-dragover', false, 500);\r\n  };\r\n\r\n  onDrop = (e: DragEvent) => {\r\n    this.options.onDrop(e);\r\n  };\r\n\r\n  destroy() {\r\n    delete this.options;\r\n    this.container.remove();\r\n    this.container.removeEventListener('dragover', this.onDragOver);\r\n    this.container.removeEventListener('dragleave', this.onDragLeave);\r\n    this.container.removeEventListener('drop', this.onDrop);\r\n  }\r\n\r\n  setPath() {\r\n    const rect = this.outlineWrapper.getBoundingClientRect();\r\n    this.svg.setAttributeNS(null, 'preserveAspectRatio', 'none');\r\n    this.svg.setAttributeNS(null, 'viewBox', `0 0 ${rect.width} ${rect.height}`);\r\n    this.svg.setAttributeNS(null, 'width', `${rect.width}`);\r\n    this.svg.setAttributeNS(null, 'height', `${rect.height}`);\r\n\r\n    const radius = 10;\r\n    // const strokeWidth = 2;\r\n    const sizeX = rect.width - radius;\r\n    const sizeY = rect.height - radius;\r\n    const pos = radius / 2;\r\n    const d = generatePathData(pos, pos, sizeX, sizeY, radius, radius, radius, radius);\r\n    this.path.setAttributeNS(null, 'd', d);\r\n  }\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport {doubleRaf} from '../schedulers';\r\n\r\nexport default function disableTransition(elements: HTMLElement[]) {\r\n  elements.forEach((el) => el.classList.add('no-transition'));\r\n\r\n  doubleRaf().then(() => {\r\n    elements.forEach((el) => el.classList.remove('no-transition'));\r\n  });\r\n}\r\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n *\n * Originally from:\n * https://github.com/evgeny-nadymov/telegram-react\n * Copyright (C) 2018 Evgeny Nadymov\n * https://github.com/evgeny-nadymov/telegram-react/blob/master/LICENSE\n */\n\nexport const MAX_SPEED = 8.2;\nexport const MIN_SPEED = 0.8;\n\n// import { MIN_SPEED, MAX_SPEED } from './BlobDrawable';\n\ntype Radius = number[];\n\nexport default class LineBlobDrawable {\n  public maxRadius: number;\n  public minRadius: number;\n  private N: number;\n  private radius: Radius;\n  private radiusNext: Radius;\n  private progress: number[];\n  private speed: number[];\n\n  constructor(n: number) {\n    this.maxRadius = 10;\n    this.minRadius = 0;\n\n    this.N = n;\n    this.radius = new Array(n + 1);\n\n    this.radiusNext = new Array(n + 1);\n    this.progress = new Array(n + 1);\n    this.speed = new Array(n + 1);\n\n    for(let i = 0; i <= n; i++) {\n      this.generateBlob(this.radius, i);\n      this.generateBlob(this.radiusNext, i);\n      this.progress[i] = 0;\n    }\n  }\n\n  private generateBlob(radius: Radius, i: number) {\n    const {maxRadius, minRadius, speed} = this;\n\n    const radDif = maxRadius - minRadius;\n    radius[i] = minRadius + Math.random() * radDif;\n    speed[i] = 0.017 + 0.003 * Math.random();\n  }\n\n  private generateNextBlob() {\n    const {radius, radiusNext, progress, N} = this;\n    for(let i = 0; i < N; i++) {\n      this.generateBlob(radius, i);\n      this.generateBlob(radiusNext, i);\n      progress[i] = 0.0;\n    }\n  }\n\n  public update(amplitude: number, speedScale: number) {\n    const {N, progress, speed, radius, radiusNext} = this;\n    for(let i = 0; i <= N; i++) {\n      progress[i] += (speed[i] * MIN_SPEED) + amplitude * speed[i] * MAX_SPEED * speedScale;\n      if(progress[i] >= 1.0) {\n        progress[i] = 0.0;\n        radius[i] = radiusNext[i];\n        this.generateBlob(radiusNext, i);\n      }\n    }\n  }\n\n  public draw(left: number, top: number, right: number, bottom: number, canvas: HTMLCanvasElement, paint: (ctx: CanvasRenderingContext2D) => void, pinnedTop: number, progressToPinned: number) {\n    if(canvas.getContext) {\n      const ctx = canvas.getContext('2d');\n      // ctx.globalAlpha = 0.5;\n      // ctx.lineWidth = 1;\n\n      ctx.beginPath();\n      ctx.moveTo(right, bottom);\n      ctx.lineTo(left, bottom);\n\n      const {radius, radiusNext, N} = this;\n      for(let i = 0; i <= N; i++) {\n        if(i === 0) {\n          const progress = this.progress[i];\n          const r1 = radius[i] * (1.0 - progress) + radiusNext[i] * progress;\n          const y = (top - r1) * progressToPinned + pinnedTop * (1.0 - progressToPinned);\n          ctx.lineTo(left, y);\n        } else {\n          const progress = this.progress[i - 1];\n          const r1 = radius[i - 1] * (1.0 - progress) + radiusNext[i - 1] * progress;\n          const progressNext = this.progress[i];\n          const r2 = radius[i] * (1.0 - progressNext) + radiusNext[i] * progressNext;\n          const x1 = (right - left) / N * (i - 1);\n          const x2 = (right - left) / N * i;\n          const cx = x1 + (x2 - x1) / 2;\n\n          const y1 = (top - r1) * progressToPinned + pinnedTop * (1.0 - progressToPinned);\n          const y2 = (top - r2) * progressToPinned + pinnedTop * (1.0 - progressToPinned);\n          ctx.bezierCurveTo(cx, y1, cx, y2, x2, y2);\n          if(i === N) {\n            ctx.lineTo(right, bottom);\n          }\n        }\n      }\n\n      // ctx.scale(1.0, 1.0);\n      paint(ctx);\n      ctx.fill();\n      ctx.closePath();\n    }\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n *\n * Originally from:\n * https://github.com/evgeny-nadymov/telegram-react\n * Copyright (C) 2018 Evgeny Nadymov\n * https://github.com/evgeny-nadymov/telegram-react/blob/master/LICENSE\n */\n\nimport GROUP_CALL_STATE from '../lib/calls/groupCallState';\nimport LineBlobDrawable from './lineBlobDrawable';\n\nexport class WeavingState {\n  public shader: (ctx: CanvasRenderingContext2D, left: number, top: number, right: number, bottom: number) => void;\n\n  constructor(public stateId: GROUP_CALL_STATE) {\n    this.createGradient(stateId);\n  }\n\n  public createGradient(stateId: GROUP_CALL_STATE) {\n    this.shader = (ctx, left, top, right, bottom) => {\n      ctx.fillStyle = WeavingState.getGradientFromType(ctx, stateId, left, top, right, bottom);\n    };\n  }\n\n  // Android colors\n  static getGradientFromType(ctx: CanvasRenderingContext2D, type: GROUP_CALL_STATE, x0: number, y0: number, x1: number, y1: number) {\n    const gradient = ctx.createLinearGradient(x0, y0, x1, y1);\n    if(type === GROUP_CALL_STATE.MUTED_BY_ADMIN) {\n      gradient.addColorStop(0, '#F05459');\n      gradient.addColorStop(.4, '#766EE9');\n      gradient.addColorStop(1, '#57A4FE');\n    } else if(type === GROUP_CALL_STATE.UNMUTED) {\n      gradient.addColorStop(0, '#52CE5D');\n      gradient.addColorStop(1, '#00B1C0');\n    } else if(type === GROUP_CALL_STATE.MUTED) {\n      gradient.addColorStop(0, '#0976E3');\n      gradient.addColorStop(1, '#2BCEFF');\n    } else if(type === GROUP_CALL_STATE.CONNECTING) {\n      gradient.addColorStop(0, '#8599aa');\n      gradient.addColorStop(1, '#8599aa');\n    }\n\n    return gradient;\n  }\n\n  update(height: number, width: number, dt: number, amplitude: number) {\n    // TODO: move gradient here\n  }\n}\n\nexport default class TopbarWeave {\n  private focused: boolean;\n  private resizing: boolean;\n  private lastUpdateTime: number;\n  private amplitude: number;\n  private amplitude2: number;\n\n  private states: Map<GROUP_CALL_STATE, WeavingState>;\n  private previousState: WeavingState;\n  private currentState: WeavingState;\n  private progressToState: number;\n\n  private scale: number;\n  private left: number;\n  private top: number;\n  private right: number;\n  private bottom: number;\n\n  private mounted: boolean;\n  private media: MediaQueryList;\n\n  private container: HTMLDivElement;\n  private canvas: HTMLCanvasElement;\n\n  private resizeHandler: number;\n  private raf: number;\n\n  private lbd: LineBlobDrawable;\n  private lbd1: LineBlobDrawable;\n  private lbd2: LineBlobDrawable;\n\n  private animateToAmplitude: number;\n  private animateAmplitudeDiff: number;\n  private animateAmplitudeDiff2: number;\n\n  constructor() {\n    this.focused = true;\n    this.resizing = false;\n    this.lastUpdateTime = Date.now();\n    this.amplitude = 0.0;\n    this.amplitude2 = 0.0;\n\n    this.states = new Map([\n      [GROUP_CALL_STATE.UNMUTED, new WeavingState(GROUP_CALL_STATE.UNMUTED)],\n      [GROUP_CALL_STATE.MUTED, new WeavingState(GROUP_CALL_STATE.MUTED)],\n      [GROUP_CALL_STATE.MUTED_BY_ADMIN, new WeavingState(GROUP_CALL_STATE.MUTED_BY_ADMIN)],\n      [GROUP_CALL_STATE.CONNECTING, new WeavingState(GROUP_CALL_STATE.CONNECTING)]\n    ]);\n    this.previousState = null;\n    this.currentState = this.states.get(GROUP_CALL_STATE.CONNECTING);\n    this.progressToState = 1.0;\n  }\n\n  public componentDidMount() {\n    if(this.mounted) {\n      return;\n    }\n\n    this.mounted = true;\n    // window.addEventListener('blur', this.handleBlur);\n    // window.addEventListener('focus', this.handleFocus);\n    window.addEventListener('resize', this.handleResize);\n    this.media = window.matchMedia('screen and (min-resolution: 2dppx)');\n    this.media.addEventListener('change', this.handleDevicePixelRatioChanged);\n\n    this.setSize();\n    this.forceUpdate();\n\n    this.lbd = new LineBlobDrawable(3);\n    this.lbd1 = new LineBlobDrawable(7);\n    this.lbd2 = new LineBlobDrawable(8);\n    this.setAmplitude(this.amplitude);\n\n    this.draw();\n  }\n\n  public componentWillUnmount() {\n    this.mounted = false;\n    // window.removeEventListener('blur', this.handleBlur);\n    // window.removeEventListener('focus', this.handleFocus);\n    window.removeEventListener('resize', this.handleResize);\n    this.media.addEventListener('change', this.handleDevicePixelRatioChanged);\n\n    const {canvas} = this;\n    const ctx = canvas.getContext('2d');\n    ctx.clearRect(0, 0, canvas.width, canvas.height);\n  }\n\n  private setSize() {\n    this.scale = window.devicePixelRatio;\n    this.top = 20 * this.scale;\n    this.right = (this.mounted ? this.container.offsetWidth : 1261) * this.scale;\n    this.bottom = (this.mounted ? this.container.offsetHeight : 68) * this.scale;\n    this.left = 0 * this.scale;\n    this.setCanvasSize();\n  }\n\n  private setCanvasSize() {\n    this.canvas.width = this.right;\n    this.canvas.height = this.bottom;\n  }\n\n  private handleDevicePixelRatioChanged = (e: Event) => {\n    this.setSize();\n    this.forceUpdate();\n  }\n\n  private handleResize = () => {\n    if(this.resizeHandler) {\n      clearTimeout(this.resizeHandler);\n      this.resizeHandler = null;\n    }\n\n    this.resizing = true;\n    this.resizeCanvas();\n    this.resizeHandler = window.setTimeout(() => {\n      this.resizing = false;\n      this.invokeDraw();\n    }, 250);\n  }\n\n  private resizeCanvas() {\n    this.scale = window.devicePixelRatio;\n    this.right = this.container.offsetWidth * this.scale;\n\n    this.forceUpdate();\n    this.invokeDraw();\n  }\n\n  public handleFocus = () => {\n    this.focused = true;\n    this.invokeDraw();\n  }\n\n  public handleBlur = () => {\n    this.focused = false;\n  }\n\n  private invokeDraw = () => {\n    if(this.raf) return;\n\n    this.draw();\n  }\n\n  private draw = (force = false) => {\n    this.raf = null;\n    if(!this.mounted) {\n      return;\n    }\n    const {lbd, lbd1, lbd2, scale, left, top, right, bottom, currentState, previousState, focused, resizing, canvas} = this;\n    if(!focused && !resizing && this.progressToState >= 1.0) {\n      return;\n    }\n\n    // console.log('[top] draw', [focused, resizing, this.mounted]);\n\n    const newTime = Date.now();\n    let dt = (newTime - this.lastUpdateTime);\n    if(dt > 20) {\n      dt = 17;\n    }\n\n    // console.log('draw start', this.amplitude, this.animateToAmplitude);\n    if(this.animateToAmplitude !== this.amplitude) {\n      this.amplitude += this.animateAmplitudeDiff * dt;\n      if(this.animateAmplitudeDiff > 0) {\n        if(this.amplitude > this.animateToAmplitude) {\n          this.amplitude = this.animateToAmplitude;\n        }\n      } else {\n        if(this.amplitude < this.animateToAmplitude) {\n          this.amplitude = this.animateToAmplitude;\n        }\n      }\n    }\n\n    if(this.animateToAmplitude !== this.amplitude2) {\n      this.amplitude2 += this.animateAmplitudeDiff2 * dt;\n      if(this.animateAmplitudeDiff2 > 0) {\n        if(this.amplitude2 > this.animateToAmplitude) {\n          this.amplitude2 = this.animateToAmplitude;\n        }\n      } else {\n        if(this.amplitude2 < this.animateToAmplitude) {\n          this.amplitude2 = this.animateToAmplitude;\n        }\n      }\n    }\n\n    if(previousState) {\n      this.progressToState += dt / 250;\n      if(this.progressToState > 1) {\n        this.progressToState = 1;\n        this.previousState = null;\n      }\n    }\n\n    const {amplitude, amplitude2, progressToState} = this;\n\n    const top1 = 6 * amplitude2 * scale;\n    const top2 = 6 * amplitude2 * scale;\n\n    const ctx = canvas.getContext('2d');\n    ctx.clearRect(0, 0, canvas.width, canvas.height);\n\n    lbd.minRadius = 0;\n    lbd.maxRadius = (2 + 2 * amplitude) * scale;\n    lbd1.minRadius = 0;\n    lbd1.maxRadius = (3 + 9 * amplitude) * scale;\n    lbd2.minRadius = 0;\n    lbd2.maxRadius = (3 + 9 * amplitude) * scale;\n\n    lbd.update(amplitude, 0.3);\n    lbd1.update(amplitude, 0.7);\n    lbd2.update(amplitude, 0.7);\n\n    for(let i = 0; i < 2; i++) {\n      if(i === 0 && !previousState) {\n        continue;\n      }\n\n      let alpha = 1;\n      let state: WeavingState = null;\n      if(i === 0) {\n        alpha = 1 - progressToState;\n        state = previousState;\n        // previousState.setToPaint(paint);\n      } else {\n        alpha = previousState ? progressToState : 1;\n        currentState.update(bottom - top, right - left, dt, amplitude);\n        state = currentState;\n        // currentState.setToPaint(paint);\n      }\n\n      const paint1 = (ctx: CanvasRenderingContext2D) => {\n        ctx.globalAlpha = 0.3 * alpha;\n        state.shader(ctx, left, top, right, bottom);\n      };\n      const paint = (ctx: CanvasRenderingContext2D) => {\n        ctx.globalAlpha = i === 0 ? 1 : alpha;\n        state.shader(ctx, left, top, right, bottom);\n      };\n\n      lbd1.draw(left, top - top1, right, bottom, canvas, paint1, top, 1.0);\n      lbd2.draw(left, top - top2, right, bottom, canvas, paint1, top, 1.0);\n      lbd.draw(left, top, right, bottom, canvas, paint, top, 1.0);\n    }\n\n    if(!force) {\n      this.raf = requestAnimationFrame(() => this.draw());\n    }\n  };\n\n  public setCurrentState = (stateId: GROUP_CALL_STATE, animated: boolean) => {\n    const {currentState, states} = this;\n\n    if(currentState?.stateId === stateId) {\n      return;\n    }\n\n    this.previousState = animated ? currentState : null;\n    this.currentState = states.get(stateId);\n    this.progressToState = this.previousState ? 0.0 : 1.0;\n  };\n\n  public setAmplitude(value: number) {\n    const {amplitude} = this;\n    this.animateToAmplitude = value;\n    this.animateAmplitudeDiff = (value - amplitude) / 250;\n    this.animateAmplitudeDiff2 = (value - amplitude) / 120;\n  }\n\n  private forceUpdate() {\n    this.setCanvasSize();\n  }\n\n  public render(className: string) {\n    const container = this.container = document.createElement('div');\n    container.classList.add(className);\n\n    const canvas = this.canvas = document.createElement('canvas');\n    canvas.classList.add(className + '-canvas');\n\n    container.append(canvas);\n\n    return container;\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport noop from '../../helpers/noop';\nimport safeAssign from '../../helpers/object/safeAssign';\nimport rootScope from '../rootScope';\nimport lottieLoader, {LottieAssetName} from './lottieLoader';\nimport type RLottiePlayer from './rlottiePlayer';\nimport {RLottieColor} from './rlottiePlayer';\n\nexport type RLottieIconOptions = {\n  width: number,\n  height: number,\n  container?: HTMLElement,\n  skipAnimation?: boolean\n};\n\nexport type RLottieIconItemPartOptions = {\n  startFrame: number,\n  endFrame: number,\n  name?: string\n};\n\nexport type RLottieIconItemOptions = {\n  name: LottieAssetName,\n  parts: RLottieIconItemPartOptions[],\n  initFrame?: number,\n  player?: RLottiePlayer,\n  autoplay?: boolean,\n  color?: RLottieColor,\n  inverseColor?: RLottieColor,\n};\n\nexport class RLottieIconItemPart implements RLottieIconItemPartOptions {\n  public startFrame: number;\n  public endFrame: number;\n  public name?: string;\n\n  constructor(public item: RLottieIconItem, options: RLottieIconItemPartOptions) {\n    safeAssign(this, options);\n  }\n\n  public play(callback?: () => void) {\n    return this.item.playPart(this, callback);\n  }\n}\n\n// export type RLottieIconItemPart = RLottieIconItemPartOptions;\n\nexport class RLottieIconItem implements RLottieIconItemOptions {\n  public name: LottieAssetName;\n  public parts: RLottieIconItemPart[];\n  public player: RLottiePlayer;\n  public initFrame: number;\n  public autoplay: boolean;\n  public color: RLottieColor;\n  public inverseColor: RLottieColor;\n  public loadPromise: Promise<void>;\n  public onLoadForPart: () => void;\n  public onLoadForColor: () => void;\n\n  constructor(public icon: RLottieIcon, options: RLottieIconItemOptions) {\n    this.autoplay = false;\n\n    safeAssign(this, options);\n\n    this.parts = this.parts.map((options) => this.createPart(options));\n  }\n\n  public load() {\n    let loadPromise = this.loadPromise;\n    if(loadPromise) {\n      return loadPromise;\n    }\n\n    const {container, canvas, width, height} = this.icon;\n    loadPromise = lottieLoader.loadAnimationAsAsset({\n      container,\n      canvas,\n      width,\n      height,\n      group: 'none',\n      loop: false,\n      autoplay: this.autoplay ?? false,\n      initFrame: this.initFrame,\n      skipFirstFrameRendering: this.initFrame === undefined,\n      color: this.color,\n      inverseColor: this.inverseColor\n    }, this.name).then((player) => {\n      return lottieLoader.waitForFirstFrame(player);\n    }).then((player) => {\n      this.player = player;\n\n      if(this.onLoadForColor) {\n        this.onLoadForColor();\n        this.onLoadForColor = undefined;\n      }\n\n      if(this.onLoadForPart) {\n        this.onLoadForPart();\n        this.onLoadForPart = undefined;\n      }\n    });\n\n    this.loadPromise = loadPromise;\n    this.icon.loadPromises.set(this.name, loadPromise);\n    return loadPromise;\n  }\n\n  public createPart(options: RLottieIconItemPartOptions) {\n    return new RLottieIconItemPart(this, options);\n  }\n\n  public getPart(index: string | number | RLottieIconItemPart) {\n    if(index instanceof RLottieIconItemPart) return index;\n    else if(typeof(index) === 'string') return this.parts.find((part) => part.name === index);\n    else return this.parts[index];\n  }\n\n  public playPart(part: RLottieIconItemPart, callback?: () => void) {\n    return this.icon.playPart(this, part, callback);\n  }\n}\n\nexport default class RLottieIcon {\n  public container: HTMLElement;\n  public canvas: HTMLCanvasElement;\n  public width: number;\n  public height: number;\n\n  protected items: Map<LottieAssetName, RLottieIconItem>;\n  public loadPromises: Map<LottieAssetName, Promise<void>>;\n\n  protected skipAnimation: boolean;\n\n  constructor(options: RLottieIconOptions) {\n    safeAssign(this, options);\n\n    if(!this.container) this.container = document.createElement('div');\n    this.container.classList.add('rlottie-icon');\n\n    const {width, height} = this;\n    this.container.style.width = width + 'px';\n    this.container.style.height = height + 'px';\n\n    const canvas = this.canvas = document.createElement('canvas');\n    canvas.classList.add('rlottie');\n    canvas.width = width;\n    canvas.height = height;\n\n    this.items = new Map();\n    this.loadPromises = new Map();\n  }\n\n  public get loadPromise() {\n    return Promise.all([...this.loadPromises.values()]).then(noop);\n  }\n\n  public getItem(name?: LottieAssetName): RLottieIconItem {\n    return !name && this.items.size === 1 ? this.items.values().next().value : this.items.get(name);\n  }\n\n  public add(options: Omit<RLottieIconItemOptions, 'player'>) {\n    const item = new RLottieIconItem(this, options);\n    this.items.set(options.name, item);\n\n    return item;\n  }\n\n  public playPart(item: RLottieIconItem, index: Parameters<RLottieIconItem['getPart']>[0], callback?: () => void) {\n    if(!item.player) {\n      item.onLoadForPart = () => {\n        this.playPart(item, index, callback);\n      };\n\n      return;\n    }\n\n    const part = item.getPart(index);\n    item.player.playPart({\n      from: rootScope.settings.animationsEnabled && !this.skipAnimation ? part.startFrame : part.endFrame,\n      to: part.endFrame,\n      callback\n    });\n  }\n\n  /* public playToPart(item: RLottieIconItem, index: Parameters<RLottieIconItem['getPart']>[0], toEnd: boolean) {\n    if(!item.player) return;\n    const part = item.getPart(index);\n    const toFrame = toEnd ? part.endFrame : part.startFrame;\n    item.player.playToFrame({\n      frame: toFrame\n    });\n  } */\n\n  public static generateEqualParts(length: number, frameCount: number): RLottieIconItemPartOptions[] {\n    return new Array(length).fill(0).map((_, idx) => {\n      const startFrame = idx * frameCount;\n      return {startFrame, endFrame: startFrame + frameCount - 1};\n    });\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport noop from '../helpers/noop';\nimport safeAssign from '../helpers/object/safeAssign';\nimport {LottieAssetName} from '../lib/rlottie/lottieLoader';\nimport RLottieIcon, {RLottieIconItemPartOptions, RLottieIconItemPart} from '../lib/rlottie/rlottieIcon';\nimport {RLottieColor} from '../lib/rlottie/rlottiePlayer';\n\nexport type SuperRLottieIconAddItemOptions = {name: LottieAssetName, parts: RLottieIconItemPartOptions};\nexport type SuperRLottieIconGetInfoResult = RLottieIconItemPart;\nexport class SuperRLottieIcon<Options extends {\n  PartState: any,\n  ColorState?: any,\n  Items?: {\n    name: string\n  }[]\n}> extends RLottieIcon {\n  protected getPart: (state: Options['PartState'], prevState?: Options['PartState']) => SuperRLottieIconGetInfoResult;\n  protected getColor?: (state: Options['ColorState'], prevState?: Options['ColorState']) => RLottieColor;\n\n  protected partState: Options['PartState'];\n  protected colorState: Options['ColorState'];\n  protected loaded: boolean;\n\n  constructor(options: {\n    width: number,\n    height: number,\n    skipAnimation?: boolean,\n    getPart: (state: Options['PartState'], prevState?: Options['PartState']) => SuperRLottieIconGetInfoResult,\n    getColor?: (state: Options['ColorState'], prevState?: Options['ColorState']) => RLottieColor,\n  }) {\n    super({\n      width: options.width,\n      height: options.height\n    });\n\n    safeAssign(this, options);\n\n    // hook the first call\n    /* const originalFunction = this.setState.bind(this);\n    this.setState = (partState, colorState) => {\n      this.setState = originalFunction;\n      this.load(partState, colorState);\n      return originalFunction(partState, colorState);\n    }; */\n  }\n\n  public load(partState: Options['PartState'], colorState?: Options['ColorState']) {\n    if(this.loaded) {\n      return this.loadPromise;\n    }\n\n    this.loaded = true;\n    this.partState = partState;\n    this.colorState = colorState;\n\n    const part = this.getPart(partState);\n    const color = colorState !== undefined && this.getColor && this.getColor(colorState);\n\n    const item = part.item;\n    item.initFrame = part.endFrame;\n    item.color = color;\n\n    const promises = [...this.items.values()].map((item) => item.load());\n    return Promise.all(promises).then(noop);\n  }\n\n  /**\n   * Will redirect setting color state to part callback to synchronize the rendering\n   */\n  public setState(partState: Options['PartState'], colorState?: Options['ColorState'], partCallback?: () => void) {\n    if(!this.loaded) this.load(partState, colorState);\n\n    let changedPartState = false, changedColorState = false;\n    if(partState !== undefined) changedPartState = this.setPartState(partState, colorState, partCallback);\n    else if(colorState !== undefined) changedColorState = this.setColorState(colorState);\n\n    return changedPartState || changedColorState;\n  }\n\n  public setPartState(state: Options['PartState'], colorState?: Options['ColorState'], callback?: () => void) {\n    const {partState: prevState} = this;\n    if(prevState === state) {\n      return colorState !== undefined ? this.setColorState(colorState) : false;\n    }\n\n    if(colorState !== undefined) {\n      this.setColorState(colorState, false);\n    }\n\n    this.partState = state;\n\n    const part = this.getPart(state, prevState);\n    part.play(callback);\n\n    return true;\n  }\n\n  public setColorState(state: Options['ColorState'], renderIfPaused = true) {\n    const {colorState: prevState} = this;\n    if(prevState === state || !this.getColor) {\n      return false;\n    }\n\n    this.colorState = state;\n\n    const item = this.getItem();\n    const color = this.getColor(state, prevState);\n    const invoke = () => {\n      item.player.setColor(color, renderIfPaused);\n    };\n\n    if(item.player) {\n      invoke();\n    } else {\n      item.onLoadForColor = invoke;\n    }\n\n    return true;\n  }\n\n  public destroy() {\n    this.items.forEach((item) => {\n      item.loadPromise.then(() => {\n        item.player.remove();\n      });\n    });\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport {RLottieIconItemPartOptions} from '../../lib/rlottie/rlottieIcon';\nimport {GROUP_CALL_MICROPHONE_BUTTON_STATE} from '.';\nimport {SuperRLottieIcon} from '../superIcon';\n\nexport default class GroupCallMicrophoneIcon extends SuperRLottieIcon<{\n  PartState: GROUP_CALL_MICROPHONE_BUTTON_STATE\n}> {\n  constructor() {\n    super({\n      width: 36,\n      height: 36,\n      getPart: (state, prevState) => {\n        const states = GROUP_CALL_MICROPHONE_BUTTON_STATE;\n        let partName: string;\n        switch(state) {\n          case states.HAND:\n            partName = prevState === states.MUTED ? 'muted-to-hand' : 'unmuted-to-hand';\n            break;\n          case states.MUTED:\n            partName = prevState === states.HAND ? 'hand-to-muted' : 'mute';\n            break;\n          case states.UNMUTED:\n            partName = 'unmute';\n            break;\n        }\n\n        return this.getItem().getPart(partName);\n      }\n    });\n\n    const className = 'group-call-microphone-icon';\n    this.container.classList.add(className + '-container');\n\n    const parts: RLottieIconItemPartOptions[] = [{\n      startFrame: 0,\n      endFrame: 35,\n      name: 'hand-to-muted'\n    }, {\n      startFrame: 36,\n      endFrame: 68,\n      name: 'unmute'\n    }, {\n      startFrame: 69,\n      endFrame: 98,\n      name: 'mute'\n    }, {\n      startFrame: 99,\n      endFrame: 135,\n      name: 'muted-to-hand'\n    }, {\n      startFrame: 136,\n      endFrame: 172,\n      name: 'unmuted-to-hand'\n    }, {\n      startFrame: 173,\n      endFrame: 201,\n      name: 'scheduled-crossing'\n    }, {\n      startFrame: 202,\n      endFrame: 236,\n      name: 'scheduled-to-muted'\n    }, {\n      startFrame: 237,\n      endFrame: 273,\n      name: 'scheduled-to-hand'\n    }, {\n      startFrame: 274,\n      endFrame: 310,\n      name: 'scheduled-crossed-to-hand'\n    }, {\n      startFrame: 311,\n      endFrame: 343,\n      name: 'scheduled-uncrossing'\n    }, {\n      startFrame: 344,\n      endFrame: 375,\n      name: 'scheduled-to-muted'\n    }, {\n      startFrame: 376,\n      endFrame: 403,\n      name: 'play-to-muted'\n    }];\n\n    this.add({\n      name: 'voip_filled',\n      parts\n    });\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport RLottieIcon from '../../lib/rlottie/rlottieIcon';\nimport {GROUP_CALL_PARTICIPANT_CLEARED_MUTED_STATE, GROUP_CALL_PARTICIPANT_MUTED_STATE, getColorByMutedState, clearMutedStateModifier} from '.';\nimport {SuperRLottieIcon} from '../superIcon';\n\nexport default class GroupCallParticipantMutedIcon extends SuperRLottieIcon<{\n  PartState: GROUP_CALL_PARTICIPANT_CLEARED_MUTED_STATE,\n  ColorState: GROUP_CALL_PARTICIPANT_MUTED_STATE\n}> {\n  constructor(private colored: boolean) {\n    super({\n      width: 32,\n      height: 32,\n      getPart: (state, prevState) => {\n        const states = GROUP_CALL_PARTICIPANT_MUTED_STATE;\n\n        let index: number;\n        switch(state) {\n          case states.HAND:\n            index = 3;\n            break;\n          case states.MUTED:\n            index = prevState === states.HAND ? 0 : 2;\n            break;\n          case states.UNMUTED:\n            index = 1;\n            break;\n        }\n\n        return this.getItem().getPart(index);\n      },\n      getColor: colored ? (state, prevState) => {\n        return getColorByMutedState(state);\n      } : undefined\n    });\n\n    const className = 'group-call-participant-muted-icon';\n    this.container.classList.add(className + '-container');\n\n    const parts = RLottieIcon.generateEqualParts(4, 21);\n    this.add({\n      name: 'voice_outlined2',\n      parts\n    });\n  }\n\n  public setState(state: GROUP_CALL_PARTICIPANT_MUTED_STATE) {\n    return super.setState(clearMutedStateModifier(state), state);\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport PopupElement from '../popups';\nimport {hexToRgb} from '../../helpers/color';\nimport {attachClickEvent} from '../../helpers/dom/clickEvent';\nimport customProperties from '../../helpers/dom/customProperties';\nimport {GroupCall, GroupCallParticipant} from '../../layer';\nimport type {AppChatsManager} from '../../lib/appManagers/appChatsManager';\nimport type {AppGroupCallsManager} from '../../lib/appManagers/appGroupCallsManager';\nimport type {AppPeersManager} from '../../lib/appManagers/appPeersManager';\nimport GROUP_CALL_STATE from '../../lib/calls/groupCallState';\nimport {RLottieColor} from '../../lib/rlottie/rlottiePlayer';\nimport rootScope from '../../lib/rootScope';\nimport ButtonIcon from '../buttonIcon';\nimport GroupCallMicrophoneIcon from './microphoneIcon';\nimport GroupCallParticipantsElement from './participants';\nimport GroupCallParticipantsVideoElement from './participantVideos';\nimport PopupPeer from '../popups/peer';\nimport GroupCallDescriptionElement from './description';\nimport GroupCallTitleElement from './title';\nimport {addFullScreenListener, cancelFullScreen, isFullScreen, requestFullScreen} from '../../helpers/dom/fullScreen';\nimport Scrollable from '../scrollable';\nimport {MovableState} from '../movableElement';\nimport animationIntersector from '../animationIntersector';\nimport {IS_APPLE_MOBILE} from '../../environment/userAgent';\nimport throttle from '../../helpers/schedulers/throttle';\nimport IS_SCREEN_SHARING_SUPPORTED from '../../environment/screenSharingSupport';\nimport GroupCallInstance from '../../lib/calls/groupCallInstance';\nimport makeButton from '../call/button';\nimport MovablePanel from '../../helpers/movablePanel';\nimport findUpClassName from '../../helpers/dom/findUpClassName';\nimport safeAssign from '../../helpers/object/safeAssign';\nimport toggleClassName from '../../helpers/toggleClassName';\nimport {AppManagers} from '../../lib/appManagers/managers';\nimport themeController from '../../helpers/themeController';\nimport groupCallsController from '../../lib/calls/groupCallsController';\n\nexport enum GROUP_CALL_PARTICIPANT_MUTED_STATE {\n  UNMUTED,\n  MUTED,\n  MUTED_FOR_ME,\n  MUTED_BY_ADMIN,\n  HAND\n}\n\nexport type GROUP_CALL_PARTICIPANT_CLEARED_MUTED_STATE = Exclude<GROUP_CALL_PARTICIPANT_MUTED_STATE, GROUP_CALL_PARTICIPANT_MUTED_STATE.MUTED_BY_ADMIN | GROUP_CALL_PARTICIPANT_MUTED_STATE.MUTED_FOR_ME>;\n\nexport function getGroupCallParticipantMutedState(participant: GroupCallParticipant) {\n  const states = GROUP_CALL_PARTICIPANT_MUTED_STATE;\n  if(participant.pFlags.muted_by_you) {\n    return states.MUTED_FOR_ME;\n  } else if(participant.raise_hand_rating !== undefined) {\n    return states.HAND;\n  } else if(participant.pFlags.muted) {\n    return participant.pFlags.can_self_unmute ? states.MUTED : states.MUTED_BY_ADMIN;\n  } else {\n    return states.UNMUTED;\n  }\n}\n\nexport function clearMutedStateModifier(state: GROUP_CALL_PARTICIPANT_MUTED_STATE): GROUP_CALL_PARTICIPANT_CLEARED_MUTED_STATE {\n  const states = GROUP_CALL_PARTICIPANT_MUTED_STATE;\n  switch(state) {\n    case states.MUTED_BY_ADMIN:\n    case states.MUTED_FOR_ME:\n      return states.MUTED;\n    default:\n      return state;\n  }\n}\n\nexport function getColorByMutedState(state: GROUP_CALL_PARTICIPANT_MUTED_STATE) {\n  const states = GROUP_CALL_PARTICIPANT_MUTED_STATE;\n  let colorStr: 'blue' | 'green' | 'secondary' | 'red';\n  switch(state) {\n    case states.HAND:\n      colorStr = 'blue';\n      break;\n    case states.MUTED:\n    case states.MUTED_FOR_ME:\n    case states.MUTED_BY_ADMIN:\n      colorStr = state === states.MUTED ? 'secondary' : 'red';\n      break;\n    case states.UNMUTED:\n      colorStr = 'green';\n      break;\n  }\n\n  const propertyValue = customProperties.getProperty('gc-' + colorStr + '-text-color');\n  const color: RLottieColor = hexToRgb(propertyValue);\n\n  return color;\n}\n\nexport enum GROUP_CALL_MICROPHONE_BUTTON_STATE {\n  HAND,\n  MUTED,\n  UNMUTED,\n}\n\nexport function getGroupCallMicrophoneButtonState(groupCall: GroupCall.groupCall, participant: GroupCallParticipant) {\n  const states = GROUP_CALL_MICROPHONE_BUTTON_STATE;\n  if(!participant.pFlags.can_self_unmute) {\n    return states.HAND;\n  } else if(participant.pFlags.muted) {\n    return states.MUTED\n  } else {\n    return states.UNMUTED;\n  }\n}\n\nlet previousState: MovableState = {\n  width: 420,\n  height: 640\n};\n\nconst className = 'group-call';\n\nexport default class PopupGroupCall extends PopupElement {\n  private instance: GroupCallInstance;\n  private groupCallTitle: GroupCallTitleElement;\n  private groupCallDescription: GroupCallDescriptionElement;\n  private groupCallBodyHeaderDescription: GroupCallDescriptionElement;\n  private groupCallParticipants: GroupCallParticipantsElement;\n  private groupCallParticipantsVideo: GroupCallParticipantsVideoElement;\n  private groupCallMicrophoneIcon: GroupCallMicrophoneIcon;\n  private videosCount: number;\n  private btnFullScreen: HTMLButtonElement;\n  private btnExitFullScreen: HTMLButtonElement;\n  private btnInvite: HTMLButtonElement;\n  private btnShowColumn: HTMLButtonElement;\n  private movablePanel: MovablePanel;\n  private buttonsContainer: HTMLDivElement;\n  private btnFullScreen2: HTMLButtonElement;\n  private btnVideo: HTMLDivElement;\n  private btnScreen: HTMLDivElement;\n\n  constructor() {\n    super('popup-group-call', {\n      body: true,\n      withoutOverlay: true,\n      closable: true,\n      title: true\n    });\n\n    this.videosCount = 0;\n    this.container.classList.add(className, 'night');\n\n    const instance = this.instance = groupCallsController.groupCall;\n    const {listenerSetter} = this;\n\n    if(!IS_APPLE_MOBILE) {\n      const btnFullScreen = this.btnFullScreen = ButtonIcon('fullscreen');\n      const btnFullScreen2 = this.btnFullScreen2 = ButtonIcon('fullscreen ' + className + '-cfs');\n      const btnExitFullScreen = this.btnExitFullScreen = ButtonIcon('smallscreen');\n\n      attachClickEvent(btnFullScreen, this.onFullScreenClick, {listenerSetter});\n      attachClickEvent(btnFullScreen2, this.onFullScreenClick, {listenerSetter});\n\n      attachClickEvent(btnExitFullScreen, () => {\n        cancelFullScreen();\n      }, {listenerSetter});\n\n      addFullScreenListener(this.container, this.onFullScreenChange, listenerSetter);\n    }\n\n    const btnInvite = this.btnInvite = ButtonIcon('adduser');\n    const btnShowColumn = this.btnShowColumn = ButtonIcon('rightpanel ' + className + '-only-big');\n\n    attachClickEvent(btnShowColumn, this.toggleRightColumn, {listenerSetter});\n\n    const headerInfo = document.createElement('div');\n    headerInfo.classList.add(className + '-header-info');\n\n    this.title.classList.add(className + '-header-title');\n\n    const subtitle = document.createElement('div');\n    subtitle.classList.add(className + '-header-subtitle');\n\n    headerInfo.append(this.title, subtitle);\n\n    this.header.classList.add(className + '-header');\n    this.header.append(...[this.btnExitFullScreen, headerInfo/* , btnInvite */, this.btnFullScreen, btnShowColumn].filter(Boolean));\n\n    const newHeader = this.header.cloneNode(false) as HTMLElement;\n    const newHeaderInfo = headerInfo.cloneNode(false) as HTMLElement;\n    const newHeaderTitle = this.title.cloneNode(false) as HTMLElement;\n\n    newHeaderInfo.append(newHeaderTitle);\n\n    const btnHideColumn = ButtonIcon('rightpanel');\n    newHeader.append(...[btnHideColumn, newHeaderInfo, this.btnFullScreen2].filter(Boolean));\n\n    attachClickEvent(btnHideColumn, this.toggleRightColumn, {listenerSetter});\n\n    this.body.prepend(newHeader);\n\n    const videosScrollable = new Scrollable(undefined);\n    videosScrollable.container.classList.add('group-call-big-video-container');\n    this.container.append(videosScrollable.container);\n\n    this.groupCallTitle = new GroupCallTitleElement(this.title);\n    this.groupCallDescription = new GroupCallDescriptionElement(subtitle);\n    this.groupCallBodyHeaderDescription = new GroupCallDescriptionElement(newHeaderTitle);\n    this.constructButtons();\n\n    this.groupCallParticipantsVideo = new GroupCallParticipantsVideoElement({\n      appendTo: videosScrollable.container,\n      instance,\n      listenerSetter,\n      displayPinned: true,\n      onLengthChange: (length) => {\n        this.videosCount = length;\n        this.toggleBigLayout();\n      },\n      managers: this.managers\n    });\n    this.groupCallParticipants = new GroupCallParticipantsElement({\n      appendTo: this.body,\n      instance,\n      listenerSetter,\n      managers: this.managers\n    });\n\n    this.movablePanel = new MovablePanel({\n      listenerSetter,\n      movableOptions: {\n        minWidth: 400,\n        minHeight: 480,\n        element: this.element,\n        verifyTouchTarget: (e) => {\n          const target = e.target;\n          if(findUpClassName(target, 'chatlist') ||\n            findUpClassName(target, 'group-call-button') ||\n            findUpClassName(target, 'btn-icon') ||\n            findUpClassName(target, 'group-call-participants-video-container') ||\n            isFullScreen()) {\n            return false;\n          }\n\n          return true;\n        }\n      },\n      onResize: () => this.toggleBigLayout(),\n      previousState\n    });\n\n    listenerSetter.add(instance)('state', () => {\n      this.updateInstance();\n    });\n\n    listenerSetter.add(rootScope)('group_call_update', (groupCall) => {\n      if(this.instance?.id === groupCall.id) {\n        this.updateInstance();\n      }\n    });\n\n    listenerSetter.add(instance)('pinned', () => {\n      this.setHasPinned();\n    });\n\n    listenerSetter.add(this.groupCallParticipantsVideo)('toggleControls', this.onToggleControls);\n\n    this.addEventListener('close', () => {\n      const {movablePanel} = this;\n      previousState = movablePanel.state;\n\n      this.groupCallParticipantsVideo.destroy();\n      this.groupCallParticipants.destroy();\n      this.groupCallMicrophoneIcon.destroy();\n\n      movablePanel.destroy();\n    });\n\n    this.toggleRightColumn();\n    this.onFullScreenChange();\n\n    this.updateInstance();\n  }\n\n  private constructButtons() {\n    const buttons = this.buttonsContainer = document.createElement('div');\n    buttons.classList.add(className + '-buttons');\n\n    const _makeButton = makeButton.bind(null, className, this.listenerSetter);\n\n    const btnVideo = this.btnVideo = _makeButton({\n      // text: 'VoiceChat.Video.Stream.Video',\n      callback: this.onVideoClick,\n      icon: 'videocamera_filled'\n    });\n\n    const btnScreen = this.btnScreen = _makeButton({\n      // text: 'VoiceChat.Video.Stream.Screencast',\n      callback: this.onScreenClick,\n      icon: 'sharescreen_filled'\n    });\n\n    btnScreen.classList.toggle('hide', !IS_SCREEN_SHARING_SUPPORTED);\n\n    const btnMute = _makeButton({\n      noRipple: true,\n      callback: throttle(this.onMuteClick, 600, true)\n    });\n    btnMute.classList.add(className + '-microphone-button');\n\n    const microphoneIcon = this.groupCallMicrophoneIcon = new GroupCallMicrophoneIcon();\n    btnMute.append(microphoneIcon.container);\n\n    const btnMore = _makeButton({\n      // text: 'VoiceChat.Video.Stream.More'\n      icon: 'settings_filled'\n    });\n\n    btnMore.classList.add('btn-disabled');\n    btnMore.classList.toggle('hide', !IS_SCREEN_SHARING_SUPPORTED);\n\n    const btnLeave = _makeButton({\n      // text: 'VoiceChat.Leave',\n      isDanger: true,\n      callback: this.onLeaveClick,\n      icon: 'close'\n    });\n\n    buttons.append(btnVideo, btnScreen, btnMute, btnMore, btnLeave);\n\n    this.container.append(buttons);\n  }\n\n  private onFullScreenClick = () => {\n    requestFullScreen(this.container);\n  };\n\n  private onToggleControls = (show: boolean) => {\n    this.container.classList.toggle('show-controls', show);\n    this.buttonsContainer.classList.toggle('show-controls', show);\n  };\n\n  private toggleDisability = toggleClassName.bind(null, 'btn-disabled');\n\n  private onVideoClick = () => {\n    const toggle = this.toggleDisability([this.btnVideo], true);\n    this.instance.toggleVideoSharing().finally(() => {\n      toggle();\n    });\n  };\n\n  private onScreenClick = () => {\n    const toggle = this.toggleDisability([this.btnScreen], true);\n    this.instance.toggleScreenSharing().finally(() => {\n      toggle();\n    });\n  };\n\n  private onMuteClick = () => {\n    const participant = this.instance.participant;\n    if(!participant.pFlags.can_self_unmute) {\n      if(participant.raise_hand_rating === undefined) {\n        this.instance.changeRaiseHand(true);\n      }\n    } else {\n      this.instance.toggleMuted();\n    }\n  };\n\n  private onLeaveClick = async() => {\n    const hangUp = (discard: boolean) => {\n      this.instance.hangUp(discard);\n    };\n\n    if(await this.managers.appChatsManager.hasRights(this.instance.chatId, 'manage_call')) {\n      new PopupPeer('popup-end-video-chat', {\n        titleLangKey: 'VoiceChat.End.Title',\n        descriptionLangKey: 'VoiceChat.End.Text',\n        checkboxes: [{\n          text: 'VoiceChat.End.Third'\n        }],\n        buttons: [{\n          langKey: 'VoiceChat.End.OK',\n          callback: (checkboxes) => {\n            hangUp(!!checkboxes.size);\n          },\n          isDanger: true\n        }]\n      }).show();\n    } else {\n      hangUp(false);\n    }\n  };\n\n  public getContainer() {\n    return this.container;\n  }\n\n  private onFullScreenChange = () => {\n    this.toggleBigLayout();\n    const isFull = isFullScreen();\n\n    const {btnFullScreen, btnExitFullScreen} = this;\n\n    const wasFullScreen = this.container.classList.contains('is-full-screen');\n    this.container.classList.toggle('is-full-screen', isFull);\n    btnFullScreen && btnFullScreen.classList.toggle('hide', isFull);\n    btnExitFullScreen && btnExitFullScreen.classList.toggle('hide', !isFull);\n    this.btnClose.classList.toggle('hide', isFull);\n\n    if(isFull !== wasFullScreen) {\n      animationIntersector.checkAnimations(isFull);\n\n      themeController.setThemeColor(isFull ? '#000000' : undefined);\n    }\n  };\n\n  private toggleBigLayout = () => {\n    const isFull = isFullScreen();\n    const movable = this.movablePanel?.movable;\n    const isBig = (isFull || !!(movable && movable.width >= 680)) && !!this.videosCount;\n\n    /* if(!isBig && isFull) {\n      cancelFullScreen();\n      return;\n    } */\n\n    const wasBig = this.container.classList.contains('is-big-layout');\n    let buttons: HTMLElement[];\n    if(isBig && !wasBig) { // fix buttons transition to 0 opacity\n      buttons = Array.from(this.buttonsContainer.children) as HTMLElement[];\n      buttons.forEach((element) => {\n        element.style.opacity = '0';\n      });\n\n      void this.buttonsContainer.offsetLeft;\n    }\n\n    this.container.classList.toggle('is-big-layout', isBig);\n    this.btnInvite.classList.toggle('hide', isBig);\n    this.btnShowColumn.classList.toggle('hide', !isBig);\n\n    if(buttons) {\n      // window.requestAnimationFrame(() => {\n      buttons.forEach((element) => {\n        element.style.opacity = '';\n      });\n      // });\n    }\n  };\n\n  private toggleRightColumn = () => {\n    this.container.classList.toggle('is-right-column-shown');\n  };\n\n  private setHasPinned() {\n    this.container.classList.toggle('has-pinned', !!this.instance.pinnedSource);\n  }\n\n  private updateInstance() {\n    if(this.instance.state === GROUP_CALL_STATE.CLOSED) {\n      if(this.container.classList.contains('is-full-screen')) {\n        cancelFullScreen();\n      }\n\n      this.hide();\n      return;\n    }\n\n    const {participant, groupCall} = this.instance;\n    if(!participant) {\n      return;\n    }\n\n    this.setTitle();\n    this.setDescription();\n    this.setHasPinned();\n\n    const microphoneButtonState = getGroupCallMicrophoneButtonState(groupCall as any, participant);\n    this.container.dataset.micState = microphoneButtonState === GROUP_CALL_MICROPHONE_BUTTON_STATE.HAND ? 'hand' : (microphoneButtonState === GROUP_CALL_MICROPHONE_BUTTON_STATE.MUTED ? 'muted' : 'unmuted');\n    this.groupCallMicrophoneIcon.setState(microphoneButtonState);\n  }\n\n  private setTitle() {\n    this.groupCallTitle.update(this.instance);\n  }\n\n  private setDescription() {\n    this.groupCallDescription.update(this.instance);\n    this.groupCallBodyHeaderDescription.update(this.instance);\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport replaceContent from '../../helpers/dom/replaceContent';\nimport setInnerHTML from '../../helpers/dom/setInnerHTML';\nimport {GroupCallParticipant} from '../../layer';\nimport {i18n} from '../../lib/langPack';\nimport {GROUP_CALL_PARTICIPANT_MUTED_STATE} from '.';\nimport {GroupCallParticipantVideoType} from './participantVideo';\nimport wrapEmojiText from '../../lib/richTextProcessor/wrapEmojiText';\n\nconst className = 'group-call-participant-status';\nexport default class GroupCallParticipantStatusElement {\n  public container: HTMLElement;\n\n  constructor(private withIcons: GroupCallParticipantVideoType[]) {\n    this.container = document.createElement('div');\n    this.container.classList.add(className + '-container');\n  }\n\n  public setState(state: GROUP_CALL_PARTICIPANT_MUTED_STATE, participant: GroupCallParticipant) {\n    const states = GROUP_CALL_PARTICIPANT_MUTED_STATE;\n    const icons = this.withIcons.filter((type) => !!participant[type]).map((type) => {\n      const iconClassName = `tgico-${type === 'presentation' ? 'listscreenshare' : 'videocamera_filled'}`;\n      const i = document.createElement('i');\n      i.classList.add(className + '-icon', className + '-icon-' + type, iconClassName);\n      return i;\n    });\n\n    let element2: HTMLElement, actionClassName: string;\n    if(state === states.MUTED_FOR_ME) {\n      element2 = i18n('VoiceChat.Status.MutedForYou');\n      actionClassName = 'is-muted';\n    } else if(state === states.UNMUTED) {\n      element2 = i18n('VoiceChat.Status.Speaking');\n      actionClassName = 'is-speaking';\n    } else if(state === states.HAND) {\n      element2 = i18n('VoiceChat.Status.WantsSpeak');\n      actionClassName = 'is-waiting';\n    } else if(participant.about && !icons.length) {\n      setInnerHTML(this.container, wrapEmojiText(participant.about));\n      return;\n    } else {\n      element2 = i18n('VoiceChat.Status.Listening');\n      actionClassName = 'is-listening';\n    }\n\n    const span = document.createElement('span');\n    span.classList.add(className, actionClassName);\n    span.append(...icons, element2);\n\n    replaceContent(this.container, span);\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport positionElementByIndex from '../../helpers/dom/positionElementByIndex';\nimport replaceContent from '../../helpers/dom/replaceContent';\nimport {fastRaf} from '../../helpers/schedulers';\nimport SortedList, {SortedElementBase} from '../../helpers/sortedList';\nimport {GroupCallParticipant} from '../../layer';\nimport appDialogsManager, {DialogDom, AppDialogsManager} from '../../lib/appManagers/appDialogsManager';\nimport {getGroupCallParticipantMutedState} from '.';\nimport GroupCallParticipantMutedIcon from './participantMutedIcon';\nimport GroupCallParticipantStatusElement from './participantStatus';\nimport type GroupCallInstance from '../../lib/calls/groupCallInstance';\nimport type LazyLoadQueue from '../lazyLoadQueue';\n\ninterface SortedParticipant extends SortedElementBase {\n  dom: DialogDom,\n  mutedIcon: GroupCallParticipantMutedIcon,\n  status: GroupCallParticipantStatusElement\n}\n\nexport default class GroupCallParticipantsList extends SortedList<SortedParticipant> {\n  public list: HTMLUListElement;\n\n  protected lazyLoadQueue: LazyLoadQueue;\n  protected avatarSize = 54;\n  protected rippleEnabled = true;\n  protected autonomous = true;\n  protected createChatListOptions: Parameters<AppDialogsManager['createChatList']>[0] = {/* new: true,  */dialogSize: 72};\n\n  constructor(private instance: GroupCallInstance) {\n    super({\n      getIndex: async(element) => (await this.instance.getParticipantByPeerId(element.id)).date,\n      onDelete: (element) => {\n        element.dom.listEl.remove();\n        this.onElementDestroy(element);\n      },\n      onUpdate: async(element) => {\n        const participant = await this.instance.getParticipantByPeerId(element.id);\n        const state = getGroupCallParticipantMutedState(participant);\n\n        element.mutedIcon.setState(state);\n        element.status.setState(state, participant);\n      },\n      onSort: (element, idx) => {\n        positionElementByIndex(element.dom.listEl, this.list, idx);\n      },\n      onElementCreate: (base) => {\n        const {dom} = appDialogsManager.addDialogNew({\n          peerId: base.id,\n          container: false,\n          avatarSize: this.avatarSize,\n          autonomous: this.autonomous,\n          meAsSaved: false,\n          rippleEnabled: this.rippleEnabled,\n          lazyLoadQueue: this.lazyLoadQueue\n        });\n\n        const className = 'group-call-participant';\n        dom.listEl.classList.add(className);\n\n        const mutedIcon = new GroupCallParticipantMutedIcon(true);\n        const status = new GroupCallParticipantStatusElement(['presentation', 'video']);\n        replaceContent(dom.lastMessageSpan, status.container);\n        dom.listEl.append(mutedIcon.container);\n        (base as SortedParticipant).mutedIcon = mutedIcon;\n        (base as SortedParticipant).status = status;\n\n        /* instance.getParticipantByPeerId(base.id).then((participant) => {\n          const mutedState = getGroupCallParticipantMutedState(participant);\n\n          mutedIcon.setState(mutedState);\n          status.setState(mutedState, participant);\n        }); */\n\n        (base as SortedParticipant).dom = dom;\n\n        return base as SortedParticipant;\n      },\n      updateElementWith: fastRaf\n    });\n\n    this.list = appDialogsManager.createChatList(this.createChatListOptions);\n  }\n\n  public destroy() {\n    this.elements.forEach((element) => {\n      this.onElementDestroy(element);\n    });\n  }\n\n  protected onElementDestroy(element: SortedParticipant) {\n    element.mutedIcon.destroy();\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport {animate} from '../../helpers/animation';\n\nexport default function callVideoCanvasBlur(video: HTMLVideoElement) {\n  const canvas = document.createElement('canvas');\n  canvas.classList.add('call-video-blur');\n  const size = 16;\n  canvas.width = size;\n  canvas.height = size;\n\n  const ctx = canvas.getContext('2d', {alpha: false});\n  ctx.filter = 'blur(2px)';\n  const renderFrame = () => {\n    ctx.drawImage(video, 0, 0, video.videoWidth, video.videoHeight, 0, 0, canvas.width, canvas.height);\n  };\n\n  animate(() => {\n    renderFrame();\n    return canvas.isConnected;\n  });\n\n  renderFrame();\n\n  return canvas;\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport {GroupCallParticipant} from '../../layer';\nimport type {GroupCallOutputSource} from '../../lib/appManagers/appGroupCallsManager';\nimport {i18n} from '../../lib/langPack';\nimport PeerTitle from '../peerTitle';\nimport {getGroupCallParticipantMutedState} from '.';\nimport GroupCallParticipantMutedIcon from './participantMutedIcon';\nimport GroupCallParticipantStatusElement from './participantStatus';\nimport GroupCallInstance from '../../lib/calls/groupCallInstance';\nimport callVideoCanvasBlur from '../call/videoCanvasBlur';\nimport getPeerId from '../../lib/appManagers/utils/peers/getPeerId';\nimport {AppManagers} from '../../lib/appManagers/managers';\n\nconst className = 'group-call-participant-video';\n\nexport type GroupCallParticipantVideoType = 'video' | 'presentation';\nexport default class GroupCallParticipantVideoElement {\n  public container: HTMLElement;\n  private peerTitle: PeerTitle;\n  private subtitle: HTMLElement;\n  private info: HTMLElement;\n  private left: HTMLElement;\n  private right: HTMLElement;\n  private header: HTMLElement;\n  private groupCallParticipantMutedIcon: GroupCallParticipantMutedIcon;\n  private groupCallParticipantStatus: GroupCallParticipantStatusElement;\n\n  constructor(private managers: AppManagers, private instance: GroupCallInstance, public source: GroupCallOutputSource) {\n    this.container = document.createElement('div');\n    this.container.classList.add(className + '-container');\n\n    this.info = document.createElement('div');\n    this.info.classList.add(className + '-info');\n\n    this.left = document.createElement('div');\n    this.left.classList.add(className + '-info-left');\n\n    this.right = document.createElement('div');\n    this.right.classList.add(className + '-info-right');\n\n    this.info.append(this.left, this.right);\n\n    this.container.append(this.info);\n  }\n\n  public setPinned(value: boolean) {\n    if(!value) {\n      if(this.header) {\n        this.header.remove();\n        this.header = undefined;\n      }\n\n      return;\n    } else if(this.header) {\n      return;\n    }\n\n    // if(!this.header) {\n    this.header = document.createElement('div');\n    this.header.classList.add(className + '-header');\n\n    const icon = document.createElement('i');\n    icon.classList.add('group-call-pin-icon', 'tgico-pin');\n    this.header.append(icon);\n\n    this.container.append(this.header);\n    // }\n\n    // this.container.classList.toggle('is-pinned', value);\n  }\n\n  public setParticipant(participant: GroupCallParticipant, type: GroupCallParticipantVideoType, video: HTMLVideoElement) {\n    let peerTitleElement: HTMLElement;\n    if(participant.pFlags.self) {\n      peerTitleElement = i18n('VoiceChat.Status.You');\n      peerTitleElement.classList.add('peer-title');\n    } else {\n      this.peerTitle = new PeerTitle({\n        peerId: getPeerId(participant.peer)\n      });\n\n      peerTitleElement = this.peerTitle.element;\n    }\n\n    this.groupCallParticipantMutedIcon = new GroupCallParticipantMutedIcon(false);\n    this.groupCallParticipantStatus = new GroupCallParticipantStatusElement([type]);\n\n    this.left.append(peerTitleElement, this.groupCallParticipantStatus.container);\n\n    this.right.append(this.groupCallParticipantMutedIcon.container);\n\n    video.classList.add(className, 'call-video');\n\n    if(video.paused) {\n      video.play();\n    }\n\n    const canvas = callVideoCanvasBlur(video);\n    canvas.classList.add(className + '-blur');\n\n    this.container.prepend(canvas, video);\n\n    this.updateParticipant(participant);\n  }\n\n  public updateParticipant(participant: GroupCallParticipant) {\n    const state = getGroupCallParticipantMutedState(participant);\n\n    this.groupCallParticipantMutedIcon.setState(state);\n    this.groupCallParticipantStatus.setState(state, participant);\n  }\n\n  public destroy() {\n    this.groupCallParticipantMutedIcon.destroy();\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport {attachClickEvent} from '../../helpers/dom/clickEvent';\nimport ControlsHover from '../../helpers/dom/controlsHover';\nimport findUpClassName from '../../helpers/dom/findUpClassName';\nimport ListenerSetter from '../../helpers/listenerSetter';\nimport safeAssign from '../../helpers/object/safeAssign';\nimport {GroupCallParticipant} from '../../layer';\nimport {GroupCallOutputSource} from '../../lib/appManagers/appGroupCallsManager';\nimport {AppManagers} from '../../lib/appManagers/managers';\nimport getPeerId from '../../lib/appManagers/utils/peers/getPeerId';\nimport GroupCallInstance from '../../lib/calls/groupCallInstance';\nimport rootScope from '../../lib/rootScope';\nimport GroupCallParticipantVideoElement, {GroupCallParticipantVideoType} from './participantVideo';\n\nexport default class GroupCallParticipantsVideoElement extends ControlsHover {\n  private container: HTMLDivElement;\n  private instance: GroupCallInstance;\n  private participantsElements: Map<PeerId, Map<GroupCallParticipantVideoType, GroupCallParticipantVideoElement>>;\n  private displayPinned: boolean;\n  private containers: Map<HTMLElement, GroupCallParticipantVideoElement>;\n  private onLengthChange: (length: number) => void;\n  private managers: AppManagers;\n\n  constructor(options: {\n    appendTo: HTMLElement,\n    instance: GroupCallInstance,\n    listenerSetter: ListenerSetter,\n    displayPinned: boolean,\n    onLengthChange?: GroupCallParticipantsVideoElement['onLengthChange'],\n    managers: AppManagers\n  }) {\n    super();\n    safeAssign(this, options);\n\n    const className = 'group-call-participants-video';\n    const container = this.container = document.createElement('div');\n    this.container.classList.add(className + '-container');\n\n    options.appendTo.append(container);\n\n    this.participantsElements = new Map();\n    this.containers = new Map();\n\n    const {listenerSetter} = this;\n\n    listenerSetter.add(rootScope)('group_call_participant', ({groupCallId, participant}) => {\n      if(this.instance.id === groupCallId) {\n        this.updateParticipant(participant);\n      }\n    });\n\n    listenerSetter.add(this.instance)('pinned', (source) => {\n      this.participantsElements.forEach((map) => {\n        map.forEach((element) => {\n          this.setElementDisplay(element, source);\n        });\n      });\n    });\n\n    attachClickEvent(this.container, (e) => {\n      const container = findUpClassName(e.target, 'group-call-participant-video-container');\n      if(!container) {\n        return;\n      }\n\n      const element = this.containers.get(container);\n      if(this.instance.pinnedSource === element.source) {\n        this.instance.unpinAll();\n        return;\n      }\n\n      this.instance.pinSource(element.source);\n    }, {listenerSetter});\n\n    this.setInstance(this.instance);\n\n    this.setup({\n      element: container,\n      listenerSetter: listenerSetter,\n      showOnLeaveToClassName: 'group-call-buttons'\n    });\n  }\n\n  private shouldDisplayElement(element: GroupCallParticipantVideoElement, pinnedSource: GroupCallOutputSource) {\n    return this.displayPinned ? !pinnedSource || element.source === pinnedSource : pinnedSource && element.source !== pinnedSource;\n  }\n\n  private setElementDisplay(element: GroupCallParticipantVideoElement, pinnedSource: GroupCallOutputSource) {\n    const shouldDisplay = this.shouldDisplayElement(element, pinnedSource);\n    element.container.classList.toggle('video-hidden', !shouldDisplay);\n\n    const isPinned = element.source === pinnedSource;\n    element.setPinned(isPinned);\n  }\n\n  private updateParticipant(participant: GroupCallParticipant) {\n    const peerId = getPeerId(participant.peer);\n    const types: GroupCallParticipantVideoType[] = ['video', 'presentation'];\n    const hasAnyVideo = types.some((type) => !!participant[type]);\n    let participantElements = this.participantsElements.get(peerId);\n    if(!hasAnyVideo && !participantElements) {\n      return;\n    }\n\n    if(!participantElements) {\n      this.participantsElements.set(peerId, participantElements = new Map());\n    }\n\n    types.forEach((type) => {\n      let element = participantElements.get(type);\n      const participantVideo = participant[type];\n      if(!!participantVideo === !!element) {\n        if(element) {\n          element.updateParticipant(participant);\n        }\n\n        return;\n      }\n\n      if(participantVideo) {\n        const result = this.instance.getVideoElementFromParticipantByType(participant, type);\n        if(!result) {\n          return;\n        }\n\n        const {video, source} = result;\n\n        element = new GroupCallParticipantVideoElement(this.managers, this.instance, source);\n\n        this.containers.set(element.container, element);\n\n        this.setElementDisplay(element, this.instance.pinnedSource);\n        participantElements.set(type, element);\n        element.setParticipant(participant, type, video);\n\n        this.container.prepend(element.container);\n      } else {\n        participantElements.delete(type);\n        element.container.remove();\n\n        if(!participantElements.size) {\n          this.participantsElements.delete(peerId);\n          this.containers.delete(element.container);\n          element.destroy();\n        }\n      }\n\n      this._onLengthChange();\n    });\n  }\n\n  private _onLengthChange() {\n    const length = this.container.childElementCount;\n    this.container.dataset.length = '' + length;\n    this.container.dataset.layout = length <= 2 ? '1' : (length === 3 ? '3' : '4');\n\n    this.onLengthChange && this.onLengthChange(length);\n  }\n\n  public async setInstance(instance: GroupCallInstance) {\n    (await instance.participants).forEach((participant) => {\n      this.updateParticipant(participant);\n    });\n  }\n\n  public destroy() {\n    this.containers.forEach((element) => {\n      element.destroy();\n    });\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport PopupGroupCall from '.';\nimport filterAsync from '../../helpers/array/filterAsync';\nimport contextMenuController from '../../helpers/contextMenuController';\nimport {attachContextMenuListener} from '../../helpers/dom/attachContextMenuListener';\nimport cancelEvent from '../../helpers/dom/cancelEvent';\nimport findUpClassName from '../../helpers/dom/findUpClassName';\nimport {addFullScreenListener, isFullScreen} from '../../helpers/dom/fullScreen';\nimport ListenerSetter from '../../helpers/listenerSetter';\nimport noop from '../../helpers/noop';\nimport safeAssign from '../../helpers/object/safeAssign';\nimport positionMenu from '../../helpers/positionMenu';\nimport ScrollableLoader from '../../helpers/scrollableLoader';\nimport {GroupCallParticipant} from '../../layer';\nimport type {AppChatsManager} from '../../lib/appManagers/appChatsManager';\nimport type {AppGroupCallsManager} from '../../lib/appManagers/appGroupCallsManager';\nimport appImManager from '../../lib/appManagers/appImManager';\nimport type {AppPeersManager} from '../../lib/appManagers/appPeersManager';\nimport {AppManagers} from '../../lib/appManagers/managers';\nimport getPeerId from '../../lib/appManagers/utils/peers/getPeerId';\nimport GroupCallInstance from '../../lib/calls/groupCallInstance';\nimport rootScope from '../../lib/rootScope';\nimport ButtonMenu, {ButtonMenuItemOptions} from '../buttonMenu';\nimport confirmationPopup from '../confirmationPopup';\nimport PeerTitle from '../peerTitle';\nimport PopupElement from '../popups';\nimport Scrollable from '../scrollable';\nimport GroupCallParticipantsList from './participantsList';\nimport GroupCallParticipantsVideoElement from './participantVideos';\n\nexport class GroupCallParticipantContextMenu {\n  private buttons: (ButtonMenuItemOptions & {verify: (peerId: PeerId) => boolean | Promise<boolean>})[];\n  private element: HTMLDivElement;\n  private chatId: ChatId;\n  private targetPeerId: PeerId;\n  private participant: GroupCallParticipant;\n  private instance: GroupCallInstance;\n  private canManageCall: boolean;\n  private managers: AppManagers;\n\n  constructor(options: {\n    listenerSetter: ListenerSetter,\n    onContextElement: HTMLElement,\n    managers: AppManagers,\n    instance: GroupCallInstance,\n  }) {\n    this.buttons = [{\n      icon: 'gc_microphoneoff',\n      text: 'VoiceChat.MutePeer',\n      verify: () => this.canManageCall && this.participant.pFlags.can_self_unmute,\n      onClick: () => this.toggleParticipantMuted(true)\n    }, {\n      icon: 'gc_microphone',\n      text: 'VoiceChat.UnmutePeer',\n      verify: () => this.canManageCall && !this.participant.pFlags.can_self_unmute,\n      onClick: () => this.toggleParticipantMuted(false)\n    }, {\n      icon: 'gc_microphoneoff',\n      text: 'VoiceChat.MuteForMe',\n      verify: () => !this.canManageCall && !this.participant.pFlags.muted_by_you,\n      onClick: () => this.toggleParticipantMuted(true)\n    }, {\n      icon: 'gc_microphone',\n      text: 'VoiceChat.UnmuteForMe',\n      verify: () => !this.canManageCall && this.participant.pFlags.muted_by_you,\n      onClick: () => this.toggleParticipantMuted(false)\n    }, {\n      icon: 'newprivate',\n      text: 'VoiceChat.OpenProfile',\n      verify: () => true,\n      onClick: this.onOpenProfileClick\n    }, {\n      icon: 'deleteuser danger',\n      text: 'VoiceChat.RemovePeer',\n      verify: () => this.managers.appChatsManager.hasRights(this.chatId, 'ban_users'),\n      onClick: async() => {\n        confirmationPopup({\n          peerId: this.targetPeerId,\n          title: new PeerTitle({peerId: this.targetPeerId}).element,\n          descriptionLangKey: await this.managers.appChatsManager.isBroadcast(this.chatId) ? 'VoiceChat.RemovePeer.Confirm.Channel' : 'VoiceChat.RemovePeer.Confirm',\n          descriptionLangArgs: [new PeerTitle({peerId: this.targetPeerId}).element],\n          button: {\n            langKey: 'VoiceChat.RemovePeer.Confirm.OK',\n            isDanger: true\n          }\n        }).then(() => {\n          this.managers.appChatsManager.kickFromChat(this.chatId, this.targetPeerId);\n        }, noop);\n      }\n    }];\n\n    const {listenerSetter} = options;\n    this.managers = options.managers;\n    this.instance = options.instance;\n    this.chatId = this.instance.chatId;\n\n    this.element = ButtonMenu(this.buttons, listenerSetter);\n    this.element.classList.add('group-call-participant-menu', 'night');\n\n    attachContextMenuListener(options.onContextElement, async(e: any) => {\n      const li = findUpClassName(e.target, 'group-call-participant');\n      if(!li) {\n        return;\n      }\n\n      if(this.element.parentElement !== appendTo) {\n        appendTo.append(this.element);\n      }\n\n      cancelEvent(e);\n\n      const peerId = this.targetPeerId = li.dataset.peerId.toPeerId();\n      this.participant = await this.instance.getParticipantByPeerId(peerId);\n      if(this.participant.pFlags.self) {\n        return;\n      }\n\n      this.canManageCall = await this.managers.appChatsManager.hasRights(this.chatId, 'manage_call');\n\n      await filterAsync(this.buttons, async(button) => {\n        const good = await button.verify(peerId);\n        button.element.classList.toggle('hide', !good);\n        return good;\n      });\n\n      positionMenu((e as TouchEvent).touches ? (e as TouchEvent).touches[0] : e as MouseEvent, this.element, 'right');\n      contextMenuController.openBtnMenu(this.element);\n    }, listenerSetter);\n\n    listenerSetter.add(rootScope)('group_call_participant', ({groupCallId, participant}) => {\n      if(this.instance.id === groupCallId) {\n        const peerId = getPeerId(participant.peer);\n        if(this.targetPeerId === peerId) {\n          contextMenuController.close();\n        }\n      }\n    });\n\n    let appendTo: HTMLElement = document.body;\n    addFullScreenListener(document.body, () => {\n      const isFull = isFullScreen();\n      appendTo = isFull ? PopupElement.getPopups(PopupGroupCall)[0].getContainer(): document.body;\n\n      if(!isFull) {\n        contextMenuController.close();\n      }\n    }, listenerSetter);\n  }\n\n  private onOpenProfileClick = () => {\n    const popup = PopupElement.getPopups(PopupGroupCall)[0];\n    if(popup) {\n      popup.hide();\n    }\n\n    appImManager.setInnerPeer({peerId: this.targetPeerId});\n  };\n\n  private toggleParticipantMuted = (muted: boolean) => {\n    this.instance.editParticipant(this.participant, {\n      muted\n    });\n  };\n};\n\nexport default class GroupCallParticipantsElement {\n  private container: HTMLDivElement;\n  private sortedList: GroupCallParticipantsList;\n  private instance: GroupCallInstance;\n  private listenerSetter: ListenerSetter;\n  private groupCallParticipantsVideo: GroupCallParticipantsVideoElement;\n  private contextMenu: GroupCallParticipantContextMenu;\n  private managers: AppManagers;\n\n  constructor(options: {\n    appendTo: HTMLElement,\n    instance: GroupCallInstance,\n    listenerSetter: ListenerSetter,\n    managers: AppManagers\n  }) {\n    safeAssign(this, options);\n\n    const className = 'group-call-participants';\n\n    const scrollable = new Scrollable(undefined);\n    scrollable.container.classList.add(className + '-scrollable');\n\n    const container = this.container = document.createElement('div');\n    container.classList.add(className);\n\n    // const invite = Button(`btn-primary btn-transparent ${className}-invite`, {icon: 'adduser', text: 'VoiceChat.Invite.InviteMembers'});\n\n    const sortedList = this.sortedList = new GroupCallParticipantsList(this.instance);\n\n    const {instance, listenerSetter} = this;\n    this.contextMenu = new GroupCallParticipantContextMenu({\n      ...options,\n      onContextElement: sortedList.list,\n      listenerSetter,\n      instance\n    });\n\n    this.groupCallParticipantsVideo = new GroupCallParticipantsVideoElement({\n      ...options,\n      appendTo: scrollable.container,\n      displayPinned: false\n    });\n\n    scrollable.append(/* invite,  */sortedList.list);\n    container.append(scrollable.container);\n\n    options.appendTo.append(container);\n\n    listenerSetter.add(rootScope)('group_call_participant', ({groupCallId, participant}) => {\n      if(this.instance.id === groupCallId) {\n        this.updateParticipant(participant);\n      }\n    });\n\n    const scrollableLoader = new ScrollableLoader({\n      scrollable,\n      getPromise: () => {\n        return this.managers.appGroupCallsManager.getGroupCallParticipants(this.instance.id).then(({participants, isEnd}) => {\n          participants.forEach((participant) => {\n            this.updateParticipant(participant);\n          });\n\n          return isEnd;\n        });\n      }\n    });\n\n    this.setInstance(instance);\n  }\n\n  private updateParticipant(participant: GroupCallParticipant) {\n    const peerId = getPeerId(participant.peer);\n    const has = this.sortedList.has(peerId);\n    if(participant.pFlags.left) {\n      if(has) {\n        this.sortedList.delete(peerId);\n      }\n\n      return;\n    }\n\n    if(!has) {\n      this.sortedList.add(peerId);\n      return;\n    }\n\n    this.sortedList.update(peerId);\n  }\n\n  public async setInstance(instance: GroupCallInstance) {\n    // @ts-ignore\n    /* const users = appUsersManager.users;\n    for(const userId in users) {\n      const participant: GroupCallParticipant = {\n        _: 'groupCallParticipant',\n        date: 0,\n        peer: {_: 'peerUser', user_id: userId.toPeerId()},\n        pFlags: {\n          muted: true\n        },\n        source: 1\n      };\n\n      instance.participants.set(userId.toPeerId(), participant);\n      this.updateParticipant(participant);\n    } */\n    const participants = await instance.participants;\n    participants.forEach((participant) => {\n      this.updateParticipant(participant);\n    });\n  }\n\n  public destroy() {\n    this.sortedList.destroy();\n    this.groupCallParticipantsVideo.destroy();\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport {GroupCall} from '../../layer';\nimport GroupCallInstance from '../../lib/calls/groupCallInstance';\nimport GROUP_CALL_STATE from '../../lib/calls/groupCallState';\nimport I18n, {LangPackKey, FormatterArguments} from '../../lib/langPack';\n\nexport default class GroupCallDescriptionElement {\n  private descriptionIntl: I18n.IntlElement;\n\n  constructor(private appendTo: HTMLElement) {\n    this.descriptionIntl = new I18n.IntlElement({\n      key: 'VoiceChat.Status.Connecting'\n    });\n\n    this.descriptionIntl.element.classList.add('group-call-description');\n  }\n\n  public detach() {\n    this.descriptionIntl.element.remove();\n  }\n\n  public update(instance: GroupCallInstance) {\n    const {state} = instance;\n\n    let key: LangPackKey, args: FormatterArguments;\n    if(state === GROUP_CALL_STATE.CONNECTING) {\n      key = 'VoiceChat.Status.Connecting';\n    } else {\n      key = 'VoiceChat.Status.Members';\n      args = [(instance.groupCall as GroupCall.groupCall).participants_count];\n    }\n\n    const {descriptionIntl} = this;\n    descriptionIntl.compareAndUpdate({\n      key,\n      args\n    });\n\n    if(!this.descriptionIntl.element.parentElement) {\n      this.appendTo.append(this.descriptionIntl.element);\n    }\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport setInnerHTML from '../../helpers/dom/setInnerHTML';\nimport {GroupCall} from '../../layer';\nimport GroupCallInstance from '../../lib/calls/groupCallInstance';\nimport wrapEmojiText from '../../lib/richTextProcessor/wrapEmojiText';\nimport PeerTitle from '../peerTitle';\n\nexport default class GroupCallTitleElement {\n  private peerTitle: PeerTitle;\n\n  constructor(private appendTo: HTMLElement) {\n    this.peerTitle = new PeerTitle({peerId: 0});\n  }\n\n  public update(instance: GroupCallInstance) {\n    const {peerTitle, appendTo} = this;\n    const groupCall = instance.groupCall as GroupCall.groupCall;\n    const peerId = instance.chatId.toPeerId(true);\n    if(groupCall.title) {\n      setInnerHTML(appendTo, wrapEmojiText(groupCall.title));\n    } else {\n      if(peerTitle.peerId !== peerId) {\n        peerTitle.peerId = peerId;\n        peerTitle.update();\n      }\n\n      if(peerTitle.element.parentElement !== appendTo) {\n        appendTo.append(peerTitle.element);\n      }\n    }\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport {attachClickEvent} from '../../helpers/dom/clickEvent';\nimport ListenerSetter from '../../helpers/listenerSetter';\nimport {i18n, LangPackKey} from '../../lib/langPack';\nimport ripple from '../ripple';\n\nexport default function makeButton(className: string, listenerSetter: ListenerSetter, options: {\n  text?: LangPackKey | HTMLElement,\n  isDanger?: boolean,\n  noRipple?: boolean,\n  callback?: () => void,\n  icon?: string,\n  isConfirm?: boolean,\n}) {\n  const _className = className + '-button';\n  const buttonDiv = document.createElement('div');\n  buttonDiv.classList.add(_className, 'call-button', 'rp-overflow');\n\n  if(options.icon) {\n    buttonDiv.classList.add('tgico-' + options.icon);\n  }\n\n  if(!options.noRipple) {\n    ripple(buttonDiv);\n  }\n\n  if(options.isDanger) {\n    buttonDiv.classList.add(_className + '-red');\n  }\n\n  if(options.isConfirm) {\n    buttonDiv.classList.add(_className + '-green');\n  }\n\n  if(options.callback) {\n    attachClickEvent(buttonDiv, options.callback, {listenerSetter});\n  }\n\n  let ret = buttonDiv;\n  if(options.text) {\n    const div = document.createElement('div');\n    div.classList.add(_className + '-container', 'call-button-container');\n\n    const textEl = typeof(options.text) === 'string' ? i18n(options.text) : options.text;\n    textEl.classList.add(_className + '-text', 'call-button-text');\n\n    div.append(buttonDiv, textEl);\n\n    ret = div;\n  }\n\n  return ret;\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport findUpClassName from '../helpers/dom/findUpClassName';\nimport EventListenerBase from '../helpers/eventListenerBase';\nimport mediaSizes from '../helpers/mediaSizes';\nimport clamp from '../helpers/number/clamp';\nimport safeAssign from '../helpers/object/safeAssign';\nimport windowSize from '../helpers/windowSize';\nimport SwipeHandler from './swipeHandler';\n\ntype ResizeSide = 'n' | 'e' | 's' | 'w' | 'ne' | 'se' | 'sw' | 'nw';\nexport type MovableState = {\n  top?: number;\n  left?: number;\n  width: number;\n  height: number;\n};\n\nconst className = 'movable-element';\nconst resizeHandlerClassName = className + '-resize-handler';\n\nexport type MovableElementOptions = {\n  minWidth: MovableElement['minWidth'],\n  minHeight: MovableElement['minHeight'],\n  element: MovableElement['element'],\n  verifyTouchTarget?: MovableElement['verifyTouchTarget']\n};\n\nexport default class MovableElement extends EventListenerBase<{\n  resize: () => void\n}> {\n  private minWidth: number;\n  private minHeight: number;\n  private element: HTMLElement;\n  private verifyTouchTarget: (e: TouchEvent | MouseEvent) => boolean;\n\n  private top: number;\n  private left: number;\n  private _width: number;\n  private _height: number;\n\n  private swipeHandler: SwipeHandler;\n  private handlers: HTMLElement[];\n\n  constructor(options: MovableElementOptions) {\n    super(true);\n    safeAssign(this, options);\n\n    this.top = this.left = this.width = this.height = 0;\n    this.element.classList.add(className);\n\n    this.addResizeHandlers();\n    this.setSwipeHandler();\n\n    mediaSizes.addEventListener('resize', this.onResize);\n  }\n\n  private onResize = () => {\n    this.fixDimensions();\n    this.fixPosition();\n    this.setPosition();\n  };\n\n  public destroyElements() {\n    this.element.classList.remove(className);\n\n    if(this.handlers) {\n      this.handlers.forEach((handler) => {\n        handler.remove();\n      });\n    }\n  }\n\n  public destroy() {\n    mediaSizes.removeEventListener('resize', this.onResize);\n    this.swipeHandler.removeListeners();\n  }\n\n  private addResizeHandlers() {\n    const sides: ResizeSide[] = ['n', 'e', 's', 'w', 'ne', 'se', 'sw', 'nw'];\n    this.handlers = sides.map((side) => {\n      const div = document.createElement('div');\n      div.dataset.side = side;\n      div.classList.add(resizeHandlerClassName, resizeHandlerClassName + '-side-' + side);\n      this.element.append(div);\n      return div;\n    });\n  }\n\n  private setSwipeHandler() {\n    let startTop: number, startLeft: number, startWidth: number, startHeight: number, resizingSide: ResizeSide;\n    const swipeHandler = this.swipeHandler = new SwipeHandler({\n      element: this.element,\n      onSwipe: (xDiff, yDiff, e) => {\n        xDiff *= -1; // to right will be positive\n        yDiff *= -1; // to bottom will be positive\n        // console.log(xDiff, yDiff, e);\n\n        if(resizingSide) {\n          if(resizingSide.includes('e') || resizingSide.includes('w')) {\n            const isEnlarging = resizingSide.includes('e') && xDiff > 0 || resizingSide.includes('w') && xDiff < 0;\n            const resizeDiff = Math.abs(xDiff) * (isEnlarging ? 1 : -1);\n\n            const maxPossible = resizingSide.includes('e') ? windowSize.width - startLeft : startWidth + startLeft;\n            this.width = Math.min(maxPossible, startWidth + resizeDiff);\n          }\n\n          if(resizingSide.includes('n') || resizingSide.includes('s')) {\n            const isEnlarging = resizingSide.includes('s') && yDiff > 0 || resizingSide.includes('n') && yDiff < 0;\n            const resizeDiff = Math.abs(yDiff) * (isEnlarging ? 1 : -1);\n\n            const maxPossible = resizingSide.includes('s') ? windowSize.height - startTop : startHeight + startTop;\n            this.height = Math.min(maxPossible, startHeight + resizeDiff);\n          }\n\n          this.fixDimensions();\n\n          if(resizingSide.includes('w')) {\n            this.left = Math.min(startLeft + startWidth - this.minWidth, startLeft + xDiff);\n          }\n\n          if(resizingSide.includes('n')) {\n            this.top = Math.min(startTop + startHeight - this.minHeight, startTop + yDiff);\n          }\n        } else {\n          this.top = startTop + yDiff;\n          this.left = startLeft + xDiff;\n        }\n\n        this.fixPosition();\n        this.setPosition();\n      },\n      verifyTouchTarget: (e) => {\n        const target = e.target;\n        if(this.verifyTouchTarget && !this.verifyTouchTarget(e)) {\n          return false;\n        }\n\n        const resizeHandler = findUpClassName(target, resizeHandlerClassName);\n        if(resizeHandler) {\n          resizingSide = resizeHandler.dataset.side as ResizeSide;\n          swipeHandler.setCursor('');\n        } else {\n          resizingSide = undefined;\n          swipeHandler.setCursor('grabbing');\n        }\n\n        return true;\n      },\n      onFirstSwipe: () => {\n        startTop = this.top;\n        startLeft = this.left;\n        startWidth = this.width;\n        startHeight = this.height;\n      }\n    });\n  }\n\n  public setPositionToCenter() {\n    this.top = (windowSize.height / 2) - (this.height / 2);\n    this.left = (windowSize.width / 2) - (this.width / 2);\n    this.setPosition();\n  }\n\n  private fixDimensions() {\n    this.width = clamp(this.width, this.minWidth, windowSize.width);\n    this.height = clamp(this.height, this.minHeight, windowSize.height);\n  }\n\n  private fixPosition() {\n    this.top = clamp(this.top, 0, windowSize.height - this.height);\n    this.left = clamp(this.left, 0, windowSize.width - this.width);\n  }\n\n  private setPosition() {\n    this.element.style.top = this.top + 'px';\n    this.element.style.left = this.left + 'px';\n    this.element.style.right = 'auto';\n    this.element.style.bottom = 'auto';\n    this.element.style.width = this.width + 'px';\n    this.element.style.height = this.height + 'px';\n\n    this.dispatchEvent('resize');\n  }\n\n  public get width() {\n    return this._width;\n  }\n\n  public get height() {\n    return this._height;\n  }\n\n  private set width(value: number) {\n    this._width = value;\n  }\n\n  private set height(value: number) {\n    this._height = value;\n  }\n\n  public get state(): MovableState {\n    const {top, left, width, height} = this;\n    return {\n      top,\n      left,\n      width,\n      height\n    };\n  }\n\n  public set state(state: MovableState) {\n    const {top, left, width, height} = state;\n    this.top = top;\n    this.left = left;\n    this.width = width;\n    this.height = height;\n    this.onResize();\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport MovableElement, {MovableElementOptions, MovableState} from '../components/movableElement';\nimport IS_TOUCH_SUPPORTED from '../environment/touchSupport';\nimport ListenerSetter from './listenerSetter';\nimport mediaSizes, {ScreenSize} from './mediaSizes';\nimport safeAssign from './object/safeAssign';\n\nexport default class MovablePanel {\n  #movable: MovableElement;\n  private listenerSetter: ListenerSetter;\n  private previousState: MovableState;\n  private onResize: () => void;\n  private movableOptions: MovableElementOptions;\n\n  constructor(options: {\n    listenerSetter: ListenerSetter,\n    previousState: MovableState,\n    onResize?: () => void,\n    movableOptions: MovableElementOptions\n  }) {\n    safeAssign(this, options);\n\n    this.toggleMovable(!IS_TOUCH_SUPPORTED);\n\n    this.listenerSetter.add(mediaSizes)('changeScreen', (from, to) => {\n      if(to === ScreenSize.mobile || from === ScreenSize.mobile) {\n        this.toggleMovable(!IS_TOUCH_SUPPORTED);\n      }\n    });\n  }\n\n  public destroy() {\n    const movable = this.movable;\n    if(movable) {\n      movable.destroy();\n    }\n  }\n\n  public get movable() {\n    return this.#movable;\n  }\n\n  public get state() {\n    return this.movable ? this.movable.state : this.previousState;\n  }\n\n  public set state(state: MovableState) {\n    this.previousState = state;\n  }\n\n  private toggleMovable(enabled: boolean) {\n    let {movable} = this;\n    if(enabled) {\n      if(movable) {\n        return;\n      }\n\n      movable = this.#movable = new MovableElement(this.movableOptions);\n\n      movable.state = this.previousState;\n      if(this.previousState.top === undefined) {\n        movable.setPositionToCenter();\n      }\n\n      if(this.onResize) {\n        this.listenerSetter.add(movable)('resize', this.onResize);\n      }\n    } else {\n      if(!movable) {\n        return;\n      }\n\n      this.previousState = movable.state;\n      movable.destroyElements();\n      movable.destroy();\n      this.#movable = undefined;\n    }\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nexport default function toggleClassName(className: string, elements: HTMLElement[], disable: boolean) {\n  elements.forEach((element) => {\n    element.classList.toggle(className, disable);\n  });\n\n  return () => toggleClassName(className, elements, !disable);\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport replaceContent from '../../helpers/dom/replaceContent';\nimport toHHMMSS from '../../helpers/string/toHHMMSS';\nimport CALL_STATE from '../../lib/calls/callState';\nimport {i18n, LangPackKey} from '../../lib/langPack';\n\nexport default class CallDescriptionElement {\n  private container: HTMLElement;\n  private state: CALL_STATE;\n  private interval: number;\n\n  constructor(private appendTo: HTMLElement) {\n    this.container = document.createElement('div');\n    this.container.classList.add('call-description');\n  }\n\n  public detach() {\n    if(this.interval !== undefined) {\n      clearInterval(this.interval);\n      this.interval = undefined;\n    }\n\n    this.container.remove();\n    this.state = undefined;\n  }\n\n  public update(instance: any) {\n    const {connectionState} = instance;\n\n    if(this.state === connectionState) {\n      return;\n    }\n\n    this.state = connectionState;\n\n    let element: HTMLElement;\n    if(connectionState === CALL_STATE.CONNECTED) {\n      element = document.createElement('span');\n      element.classList.add('call-description-duration');\n\n      const setTime = () => {\n        element.innerText = toHHMMSS(instance.duration, true);\n      };\n\n      this.interval = window.setInterval(setTime, 1000);\n      setTime();\n    } else {\n      let langPackKey: LangPackKey;\n      switch(connectionState) {\n        case CALL_STATE.PENDING:\n          langPackKey = instance.isOutgoing ? 'Call.StatusRinging' : 'Call.StatusCalling';\n          break;\n        case CALL_STATE.REQUESTING:\n          langPackKey = 'Call.StatusRequesting';\n          break;\n        case CALL_STATE.EXCHANGING_KEYS:\n          langPackKey = 'VoipExchangingKeys';\n          break;\n        case CALL_STATE.CLOSED:\n          langPackKey = instance.connectedAt !== undefined ? 'Call.StatusEnded' : 'Call.StatusFailed';\n          break;\n        default:\n          langPackKey = 'Call.StatusConnecting';\n          break;\n      }\n\n      element = i18n(langPackKey);\n      if(this.interval !== undefined) {\n        clearInterval(this.interval);\n        this.interval = undefined;\n      }\n    }\n\n    this.container.classList.toggle('has-duration', connectionState === CALL_STATE.CONNECTED);\n    replaceContent(this.container, element);\n\n    if(!this.container.parentElement) {\n      this.appendTo.append(this.container);\n    }\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport {SuperRLottieIcon} from '../superIcon';\n\nexport default class GroupCallMicrophoneIconMini extends SuperRLottieIcon<{\n  PartState: boolean,\n  ColorState: boolean,\n  Items: {\n    name: 'voice_mini'\n  }[]\n}> {\n  constructor(colored?: boolean, skipAnimation?: boolean) {\n    super({\n      width: 36,\n      height: 36,\n      getPart: (state) => {\n        return this.getItem().getPart(state ? 'unmute' : 'mute');\n      },\n      getColor: colored ? (state) => {\n        return state ? [255, 255, 255] : [158, 158, 158];\n      } : undefined,\n      skipAnimation\n    });\n\n    this.add({\n      name: 'voice_mini',\n      parts: [{\n        startFrame: 0,\n        endFrame: 35,\n        name: 'hand-to-muted'\n      }, {\n        startFrame: 36,\n        endFrame: 68,\n        name: 'unmute'\n      }, {\n        startFrame: 69,\n        endFrame: 98,\n        name: 'mute'\n      }, {\n        startFrame: 99,\n        endFrame: 135,\n        name: 'muted-to-hand'\n      }, {\n        startFrame: 136,\n        endFrame: 171,\n        name: 'unmuted-to-hand'\n      }]\n    });\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport IS_SCREEN_SHARING_SUPPORTED from '../../environment/screenSharingSupport';\nimport {IS_MOBILE} from '../../environment/userAgent';\nimport {attachClickEvent} from '../../helpers/dom/clickEvent';\nimport ControlsHover from '../../helpers/dom/controlsHover';\nimport findUpClassName from '../../helpers/dom/findUpClassName';\nimport {addFullScreenListener, cancelFullScreen, isFullScreen, requestFullScreen} from '../../helpers/dom/fullScreen';\nimport replaceContent from '../../helpers/dom/replaceContent';\nimport MovablePanel from '../../helpers/movablePanel';\nimport onMediaLoad from '../../helpers/onMediaLoad';\nimport themeController from '../../helpers/themeController';\nimport toggleClassName from '../../helpers/toggleClassName';\nimport CallInstance from '../../lib/calls/callInstance';\nimport CALL_STATE from '../../lib/calls/callState';\nimport I18n, {i18n} from '../../lib/langPack';\nimport wrapEmojiText from '../../lib/richTextProcessor/wrapEmojiText';\nimport animationIntersector from '../animationIntersector';\nimport AvatarElement from '../avatar';\nimport ButtonIcon from '../buttonIcon';\nimport GroupCallMicrophoneIconMini from '../groupCall/microphoneIconMini';\nimport {MovableState} from '../movableElement';\nimport PeerTitle from '../peerTitle';\nimport PopupElement from '../popups';\nimport SetTransition from '../singleTransition';\nimport makeButton from './button';\nimport CallDescriptionElement from './description';\nimport callVideoCanvasBlur from './videoCanvasBlur';\n\nconst className = 'call';\n\nconst MIN_WIDTH = 400;\nconst MIN_HEIGHT = 580;\n\nconst INIT_STATE: MovableState = {\n  width: MIN_WIDTH,\n  height: MIN_HEIGHT\n};\n\nlet previousState: MovableState = {...INIT_STATE};\n\nexport default class PopupCall extends PopupElement {\n  private peerId: PeerId;\n\n  private description: CallDescriptionElement;\n  private emojisSubtitle: HTMLElement;\n\n  private partyStates: HTMLElement;\n  private partyMutedState: HTMLElement;\n\n  private firstButtonsRow: HTMLElement;\n  private secondButtonsRow: HTMLElement;\n\n  private declineI18nElement: I18n.IntlElement;\n\n  private makeButton: (options: Parameters<typeof makeButton>[2]) => HTMLElement;\n  private btnAccept: HTMLElement;\n  private btnDecline: HTMLElement;\n  private btnVideo: HTMLElement;\n  private btnScreen: HTMLElement;\n  private btnMute: HTMLElement;\n  private btnFullScreen: HTMLButtonElement;\n  private btnExitFullScreen: HTMLButtonElement;\n\n  private movablePanel: MovablePanel;\n  private microphoneIcon: GroupCallMicrophoneIconMini;\n  private muteI18nElement: I18n.IntlElement;\n\n  private videoContainers: {\n    input?: HTMLElement,\n    output?: HTMLElement\n  };\n\n  private controlsHover: ControlsHover;\n\n  constructor(private instance: CallInstance) {\n    super('popup-call', {\n      withoutOverlay: true,\n      closable: true\n    });\n\n    this.videoContainers = {};\n\n    const {container, listenerSetter} = this;\n    container.classList.add(className, 'night');\n\n    const avatarContainer = document.createElement('div');\n    avatarContainer.classList.add(className + '-avatar');\n\n    const peerId = this.peerId = this.instance.interlocutorUserId.toPeerId();\n    const avatar = new AvatarElement();\n    avatar.classList.add('avatar-full');\n    avatar.updateWithOptions({\n      isBig: true,\n      peerId: peerId\n    });\n    avatarContainer.append(avatar);\n\n    const title = new PeerTitle({\n      peerId\n    }).element;\n\n    title.classList.add(className + '-title');\n\n    const subtitle = document.createElement('div');\n    subtitle.classList.add(className + '-subtitle');\n\n    const description = this.description = new CallDescriptionElement(subtitle);\n\n    const emojisSubtitle = this.emojisSubtitle = document.createElement('div');\n    emojisSubtitle.classList.add(className + '-emojis');\n\n    container.append(avatarContainer, title, subtitle);\n\n    if(!IS_MOBILE) {\n      this.btnFullScreen = ButtonIcon('fullscreen');\n      this.btnExitFullScreen = ButtonIcon('smallscreen hide');\n      attachClickEvent(this.btnFullScreen, this.onFullScreenClick, {listenerSetter});\n      attachClickEvent(this.btnExitFullScreen, () => cancelFullScreen(), {listenerSetter});\n      addFullScreenListener(this.container, this.onFullScreenChange, listenerSetter);\n      this.header.prepend(this.btnExitFullScreen);\n      this.header.append(this.btnFullScreen);\n\n      container.append(emojisSubtitle);\n    } else {\n      this.header.append(emojisSubtitle);\n    }\n\n    this.partyStates = document.createElement('div');\n    this.partyStates.classList.add(className + '-party-states');\n\n    this.partyMutedState = document.createElement('div');\n    this.partyMutedState.classList.add(className + '-party-state');\n    const stateText = i18n('VoipUserMicrophoneIsOff', [new PeerTitle({peerId, onlyFirstName: true, limitSymbols: 18}).element]);\n    stateText.classList.add(className + '-party-state-text');\n    const mutedIcon = new GroupCallMicrophoneIconMini(false, true);\n    mutedIcon.setState(false, false);\n    this.partyMutedState.append(\n      mutedIcon.container,\n      stateText\n    );\n\n    this.partyStates.append(this.partyMutedState);\n    this.container.append(this.partyStates);\n\n    this.makeButton = makeButton.bind(null, className, this.listenerSetter);\n    this.constructFirstButtons();\n    this.constructSecondButtons();\n\n    listenerSetter.add(instance)('state', () => {\n      this.updateInstance();\n    });\n\n    listenerSetter.add(instance)('mediaState', () => {\n      this.updateInstance();\n    });\n\n    this.movablePanel = new MovablePanel({\n      listenerSetter,\n      movableOptions: {\n        minWidth: MIN_WIDTH,\n        minHeight: MIN_HEIGHT,\n        element: this.element,\n        verifyTouchTarget: (e) => {\n          const target = e.target;\n          if(findUpClassName(target, 'call-button') ||\n            findUpClassName(target, 'btn-icon') ||\n            isFullScreen()) {\n            return false;\n          }\n\n          return true;\n        }\n      },\n      // onResize: () => this.toggleBigLayout(),\n      previousState: !this.instance.wasTryingToJoin && !this.instance.isOutgoing ? {...INIT_STATE} : previousState\n    });\n\n    const movableElement = this.movablePanel.movable;\n    if(movableElement) {\n      this.listenerSetter.add(movableElement)('resize', () => {\n        this.resizeVideoContainers();\n      });\n    }\n\n    const controlsHover = this.controlsHover = new ControlsHover();\n    controlsHover.setup({\n      element: this.container,\n      listenerSetter: this.listenerSetter,\n      showOnLeaveToClassName: 'call-buttons'\n    });\n    controlsHover.showControls(false);\n\n    this.addEventListener('close', () => {\n      const {movablePanel} = this;\n      previousState = movablePanel.state;\n\n      this.microphoneIcon.destroy();\n\n      movablePanel.destroy();\n    });\n\n    this.updateInstance();\n  }\n\n  public getCallInstance() {\n    return this.instance;\n  }\n\n  private constructFirstButtons() {\n    const buttons = this.firstButtonsRow = document.createElement('div');\n    buttons.classList.add(className + '-buttons', 'is-first');\n\n    const toggleDisability = toggleClassName.bind(null, 'btn-disabled');\n\n    const btnVideo = this.btnVideo = this.makeButton({\n      text: 'Call.Camera',\n      icon: 'videocamera_filled',\n      callback: () => {\n        const toggle = toggleDisability([btnVideo, btnScreen], true);\n        this.instance.toggleVideoSharing().finally(toggle);\n      }\n    });\n\n    const btnScreen = this.btnScreen = this.makeButton({\n      text: 'Call.Screen',\n      icon: 'sharescreen_filled',\n      callback: () => {\n        const toggle = toggleDisability([btnVideo, btnScreen], true);\n        this.instance.toggleScreenSharing().finally(toggle);\n      }\n    });\n\n    if(!IS_SCREEN_SHARING_SUPPORTED) {\n      btnScreen.classList.add('hide');\n      this.container.classList.add('no-screen');\n    }\n\n    this.muteI18nElement = new I18n.IntlElement({\n      key: 'Call.Mute'\n    });\n    const btnMute = this.btnMute = this.makeButton({\n      text: this.muteI18nElement.element,\n      callback: () => {\n        this.instance.toggleMuted();\n      }\n    });\n\n    const microphoneIcon = this.microphoneIcon = new GroupCallMicrophoneIconMini(true, true);\n    btnMute.firstElementChild.append(microphoneIcon.container);\n\n    // btnVideo.classList.add('disabled');\n    // btnScreen.classList.add('disabled');\n\n    buttons.append(btnVideo, btnScreen, btnMute);\n    this.container.append(buttons);\n  }\n\n  private constructSecondButtons() {\n    const buttons = this.secondButtonsRow = document.createElement('div');\n    buttons.classList.add(className + '-buttons', 'is-second');\n\n    this.declineI18nElement = new I18n.IntlElement({\n      key: 'Call.Decline'\n    });\n    const btnDecline = this.btnDecline = this.makeButton({\n      text: this.declineI18nElement.element,\n      icon: 'endcall_filled',\n      callback: () => {\n        this.instance.hangUp('phoneCallDiscardReasonHangup');\n      },\n      isDanger: true\n    });\n\n    const btnAccept = this.btnAccept = this.makeButton({\n      text: 'Call.Accept',\n      icon: 'phone_filled',\n      callback: () => {\n        this.instance.acceptCall();\n      },\n      isConfirm: true\n    });\n\n    buttons.append(btnDecline, btnAccept);\n    this.container.append(buttons);\n  }\n\n  private onFullScreenClick = () => {\n    requestFullScreen(this.container);\n  };\n\n  private onFullScreenChange = () => {\n    const isFull = isFullScreen();\n\n    const {btnFullScreen, btnExitFullScreen} = this;\n\n    const wasFullScreen = this.container.classList.contains('is-full-screen');\n    this.container.classList.toggle('is-full-screen', isFull);\n    btnFullScreen && btnFullScreen.classList.toggle('hide', isFull);\n    btnExitFullScreen && btnExitFullScreen.classList.toggle('hide', !isFull);\n    this.btnClose.classList.toggle('hide', isFull);\n\n    if(isFull !== wasFullScreen) {\n      animationIntersector.checkAnimations(isFull);\n\n      themeController.setThemeColor(isFull ? '#000000' : undefined);\n\n      this.resizeVideoContainers();\n    }\n  };\n\n  private createVideoContainer(video: HTMLVideoElement) {\n    const _className = className + '-video';\n    const container = document.createElement('div');\n    container.classList.add(_className + '-container');\n\n    video.classList.add(_className);\n    if(video.paused) {\n      video.play();\n    }\n\n    attachClickEvent(container, () => {\n      if(!container.classList.contains('small')) {\n        return;\n      }\n\n      const big = Object.values(this.videoContainers).find((container) => !container.classList.contains('small'));\n      big.classList.add('small');\n      big.style.cssText = container.style.cssText;\n      container.classList.remove('small');\n      container.style.cssText = '';\n\n      this.resizeVideoContainers();\n    });\n\n    const canvas = callVideoCanvasBlur(video);\n    canvas.classList.add(_className + '-blur');\n\n    container.append(canvas, video);\n\n    return container;\n  }\n\n  private updateInstance() {\n    const {instance} = this;\n    const {connectionState} = instance;\n    if(connectionState === CALL_STATE.CLOSED) {\n      if(this.container.classList.contains('is-full-screen')) {\n        cancelFullScreen();\n      }\n\n      this.btnVideo.classList.add('disabled');\n\n      this.hide();\n      return;\n    }\n\n    const isPendingIncoming = !instance.isOutgoing && connectionState === CALL_STATE.PENDING;\n    this.declineI18nElement.compareAndUpdate({\n      key: connectionState === CALL_STATE.PENDING ? 'Call.Decline' : 'Call.End'\n    });\n    this.btnAccept.classList.toggle('disable', !isPendingIncoming);\n    this.btnAccept.classList.toggle('hide-me', !isPendingIncoming);\n    this.container.classList.toggle('two-button-rows', isPendingIncoming);\n\n    const isMuted = instance.isMuted;\n    const onFrame = () => {\n      this.btnMute.firstElementChild.classList.toggle('active', isMuted);\n    };\n\n    const player = this.microphoneIcon.getItem().player;\n    this.microphoneIcon.setState(!isMuted, !isMuted, onFrame);\n    if(!player) {\n      onFrame();\n    }\n\n    this.muteI18nElement.compareAndUpdate({\n      key: isMuted ? 'VoipUnmute' : 'Call.Mute'\n    });\n\n    const isSharingVideo = instance.isSharingVideo;\n    this.btnVideo.firstElementChild.classList.toggle('active', isSharingVideo);\n\n    const isSharingScreen = instance.isSharingScreen;\n    this.btnScreen.firstElementChild.classList.toggle('active', isSharingScreen);\n\n    const outputState = instance.getMediaState('output');\n\n    SetTransition(this.partyMutedState, 'is-visible', !!outputState?.muted, 300);\n\n    const containers = this.videoContainers;\n    const oldContainers = {...containers};\n    ['input' as const, 'output' as const].forEach((type) => {\n      const mediaState = instance.getMediaState(type);\n      const video = instance.getVideoElement(type) as HTMLVideoElement;\n\n      const hasFrame = !!(video && video.videoWidth && video.videoHeight);\n      if(video && !hasFrame && !video.dataset.hasPromise) {\n        video.dataset.hasPromise = '1';\n        // container.classList.add('hide');\n        onMediaLoad(video).then(() => {\n          delete video.dataset.hasPromise;\n          this.updateInstance();\n          // this.resizeVideoContainers();\n          // container.classList.remove('hide');\n        });\n      }\n\n      const isActive = !!video && hasFrame && !!(mediaState && (mediaState.videoState === 'active' || mediaState.screencastState === 'active'));\n      let videoContainer = containers[type];\n\n      if(isActive && video && !videoContainer) {\n        videoContainer = containers[type] = this.createVideoContainer(video);\n        this.container.append(videoContainer);\n      }\n\n      if(!isActive && videoContainer) {\n        videoContainer.remove();\n        delete containers[type];\n      }\n    });\n\n    {\n      const input = containers.input;\n      const output = containers.output;\n      if(Object.keys(oldContainers).length !== Object.keys(containers).length && input) {\n        input.classList.toggle('small', !!output);\n      }\n\n      if(output && !input) {\n        output.classList.remove('small');\n      }\n    }\n\n    this.resizeVideoContainers();\n\n    this.container.classList.toggle('no-video', !Object.keys(containers).length);\n\n    if(!this.emojisSubtitle.textContent && connectionState < CALL_STATE.EXCHANGING_KEYS) {\n      Promise.resolve(instance.getEmojisFingerprint()).then((emojis) => {\n        replaceContent(this.emojisSubtitle, wrapEmojiText(emojis.join('')));\n      });\n    }\n\n    this.setDescription();\n  }\n\n  private resizeVideoContainers() {\n    Object.values(this.videoContainers).forEach((container) => {\n      const isSmall = container.classList.contains('small');\n      if(isSmall) {\n        const video = container.querySelector('video');\n        const popupWidth = this.movablePanel.state;\n        const MAX_WIDTH_PX = 240;\n        const MAX_HEIGHT_PX = 240;\n\n        const isVertical = video.videoHeight > video.videoWidth;\n        const MAX_SIZE = isVertical ? MAX_HEIGHT_PX : MAX_WIDTH_PX;\n\n        const biggestSideSize = 1 / 3 * (isFullScreen() ? 0xFFFF : (isVertical ? popupWidth.height : popupWidth.width));\n        const widthRatio = isVertical ? video.videoWidth / video.videoHeight : 1;\n        const heightRatio = isVertical ? 1 : video.videoHeight / video.videoWidth;\n        container.style.width = biggestSideSize * widthRatio + 'px';\n        container.style.height = biggestSideSize * heightRatio + 'px';\n        container.style.maxWidth = MAX_SIZE * widthRatio + 'px';\n        container.style.maxHeight = MAX_SIZE * heightRatio + 'px';\n      } else {\n        container.style.cssText = '';\n      }\n    });\n  }\n\n  private setDescription() {\n    this.description.update(this.instance);\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport cancelEvent from '../helpers/dom/cancelEvent';\nimport {attachClickEvent} from '../helpers/dom/clickEvent';\nimport ListenerSetter from '../helpers/listenerSetter';\nimport GROUP_CALL_STATE from '../lib/calls/groupCallState';\nimport rootScope from '../lib/rootScope';\nimport ButtonIcon from './buttonIcon';\nimport TopbarWeave from './topbarWeave';\nimport SetTransition from './singleTransition';\nimport PopupGroupCall from './groupCall';\nimport GroupCallDescriptionElement from './groupCall/description';\nimport GroupCallTitleElement from './groupCall/title';\nimport PopupElement from './popups';\nimport throttle from '../helpers/schedulers/throttle';\nimport GroupCallInstance from '../lib/calls/groupCallInstance';\nimport CALL_STATE from '../lib/calls/callState';\nimport replaceContent from '../helpers/dom/replaceContent';\nimport PeerTitle from './peerTitle';\nimport CallDescriptionElement from './call/description';\nimport PopupCall from './call';\nimport GroupCallMicrophoneIconMini from './groupCall/microphoneIconMini';\nimport CallInstance from '../lib/calls/callInstance';\nimport {AppManagers} from '../lib/appManagers/managers';\nimport groupCallsController from '../lib/calls/groupCallsController';\nimport StreamManager from '../lib/calls/streamManager';\nimport callsController from '../lib/calls/callsController';\n\nfunction convertCallStateToGroupState(state: CALL_STATE, isMuted: boolean) {\n  switch(state) {\n    case CALL_STATE.CLOSING:\n    case CALL_STATE.CLOSED:\n      return GROUP_CALL_STATE.CLOSED;\n    case CALL_STATE.CONNECTED:\n      return isMuted ? GROUP_CALL_STATE.MUTED : GROUP_CALL_STATE.UNMUTED;\n    default:\n      return GROUP_CALL_STATE.CONNECTING;\n  }\n}\n\nconst CLASS_NAME = 'topbar-call';\n\nexport default class TopbarCall {\n  public container: HTMLElement;\n  private listenerSetter: ListenerSetter;\n  private weave: TopbarWeave;\n  private center: HTMLDivElement;\n  private groupCallTitle: GroupCallTitleElement;\n  private groupCallDescription: GroupCallDescriptionElement;\n  private groupCallMicrophoneIconMini: GroupCallMicrophoneIconMini;\n  private callDescription: CallDescriptionElement;\n\n  private currentDescription: GroupCallDescriptionElement | CallDescriptionElement;\n\n  private instance: GroupCallInstance | any/* CallInstance */;\n  private instanceListenerSetter: ListenerSetter;\n\n  constructor(\n    private managers: AppManagers\n  ) {\n    const listenerSetter = this.listenerSetter = new ListenerSetter();\n\n    listenerSetter.add(callsController)('instance', ({instance}) => {\n      if(!this.instance) {\n        this.updateInstance(instance);\n      }\n    });\n\n    listenerSetter.add(callsController)('accepting', (instance) => {\n      if(this.instance !== instance) {\n        this.updateInstance(instance);\n      }\n    });\n\n    listenerSetter.add(groupCallsController)('instance', (instance) => {\n      this.updateInstance(instance);\n    });\n\n    listenerSetter.add(rootScope)('group_call_update', (groupCall) => {\n      const instance = groupCallsController.groupCall;\n      if(instance?.id === groupCall.id) {\n        this.updateInstance(instance);\n      }\n    });\n\n    listenerSetter.add(StreamManager.ANALYSER_LISTENER)('amplitude', ({amplitudes, type}) => {\n      const {weave} = this;\n      if(!amplitudes.length || !weave/*  || type !== 'input' */) return;\n\n      let max = 0;\n      for(let i = 0; i < amplitudes.length; ++i) {\n        const {type, value} = amplitudes[i];\n        max = value > max ? value : max;\n      }\n\n      weave.setAmplitude(max);\n    });\n  }\n\n  private onState = () => {\n    this.updateInstance(this.instance);\n  };\n\n  private clearCurrentInstance() {\n    if(!this.instance) return;\n    this.center.textContent = '';\n\n    if(this.currentDescription) {\n      this.currentDescription.detach();\n      this.currentDescription = undefined;\n    }\n\n    this.instance = undefined;\n    this.instanceListenerSetter.removeAll();\n  }\n\n  private updateInstance(instance: TopbarCall['instance']) {\n    if(this.construct) {\n      this.construct();\n      this.construct = undefined;\n    }\n\n    const isChangingInstance = this.instance !== instance;\n    if(isChangingInstance) {\n      this.clearCurrentInstance();\n\n      this.instance = instance;\n      this.instanceListenerSetter = new ListenerSetter();\n\n      this.instanceListenerSetter.add(instance as GroupCallInstance)('state', this.onState);\n\n      if(instance instanceof GroupCallInstance) {\n        this.currentDescription = this.groupCallDescription;\n      } else {\n        this.currentDescription = this.callDescription;\n        this.instanceListenerSetter.add(instance)('muted', this.onState);\n      }\n\n      this.container.classList.toggle('is-call', !(instance instanceof GroupCallInstance));\n    }\n\n    const isMuted = this.instance.isMuted;\n    const state = instance instanceof GroupCallInstance ? instance.state : convertCallStateToGroupState(instance.connectionState, isMuted);\n\n    const {weave} = this;\n\n    weave.componentDidMount();\n\n    const isClosed = state === GROUP_CALL_STATE.CLOSED;\n    if((!document.body.classList.contains('is-calling') || isChangingInstance) || isClosed) {\n      if(isClosed) {\n        weave.setAmplitude(0);\n      }\n\n      SetTransition(document.body, 'is-calling', !isClosed, 250, isClosed ? () => {\n        weave.componentWillUnmount();\n\n        this.clearCurrentInstance();\n      }: undefined);\n    }\n\n    if(isClosed) {\n      return;\n    }\n\n    weave.setCurrentState(state, true);\n    // if(state === GROUP_CALL_STATE.CONNECTING) {\n    //   weave.setCurrentState(state, true);\n    // } else {\n    //   /* var a = 0;\n    //   animate(() => {\n    //     a += 0.1;\n    //     if(a > 1) a = 0;\n    //     weave.setAmplitude(a);\n    //     return true;\n    //   });\n    //   weave.setAmplitude(1); */\n    //   weave.setCurrentState(state, true);\n    // }\n\n    this.setTitle(instance);\n    this.setDescription(instance);\n    this.groupCallMicrophoneIconMini.setState(!isMuted);\n  }\n\n  private setDescription(instance: TopbarCall['instance']) {\n    return this.currentDescription.update(instance as any);\n  }\n\n  private setTitle(instance: TopbarCall['instance']) {\n    if(instance instanceof GroupCallInstance) {\n      return this.groupCallTitle.update(instance);\n    } else {\n      replaceContent(this.center, new PeerTitle({peerId: instance.interlocutorUserId.toPeerId()}).element);\n    }\n  }\n\n  private construct() {\n    const {listenerSetter} = this;\n    const container = this.container = document.createElement('div');\n    container.classList.add('sidebar-header', CLASS_NAME + '-container');\n\n    const left = document.createElement('div');\n    left.classList.add(CLASS_NAME + '-left');\n\n    const groupCallMicrophoneIconMini = this.groupCallMicrophoneIconMini = new GroupCallMicrophoneIconMini();\n\n    const mute = ButtonIcon();\n    mute.append(groupCallMicrophoneIconMini.container);\n    left.append(mute);\n\n    const throttledMuteClick = throttle(() => {\n      this.instance.toggleMuted();\n    }, 600, true);\n\n    attachClickEvent(mute, (e) => {\n      cancelEvent(e);\n      throttledMuteClick();\n    }, {listenerSetter});\n\n    const center = this.center = document.createElement('div');\n    center.classList.add(CLASS_NAME + '-center');\n\n    this.groupCallTitle = new GroupCallTitleElement(center);\n    this.groupCallDescription = new GroupCallDescriptionElement(left);\n\n    this.callDescription = new CallDescriptionElement(left);\n\n    const right = document.createElement('div');\n    right.classList.add(CLASS_NAME + '-right');\n\n    const end = ButtonIcon('endcall_filled');\n    right.append(end);\n\n    attachClickEvent(end, (e) => {\n      cancelEvent(e);\n\n      const {instance} = this;\n      if(!instance) {\n        return;\n      }\n\n      if(instance instanceof GroupCallInstance) {\n        instance.hangUp();\n      } else {\n        instance.hangUp('phoneCallDiscardReasonHangup');\n      }\n    }, {listenerSetter});\n\n    attachClickEvent(container, () => {\n      if(this.instance instanceof GroupCallInstance) {\n        if(PopupElement.getPopups(PopupGroupCall).length) {\n          return;\n        }\n\n        new PopupGroupCall().show();\n      } else if(this.instance instanceof CallInstance) {\n        const popups = PopupElement.getPopups(PopupCall);\n        if(popups.find((popup) => popup.getCallInstance() === this.instance)) {\n          return;\n        }\n\n        new PopupCall(this.instance).show();\n      }\n    }, {listenerSetter});\n\n    container.append(left, center, right);\n\n    const weave = this.weave = new TopbarWeave();\n    const weaveContainer = weave.render(CLASS_NAME + '-weave');\n    container.prepend(weaveContainer);\n\n    document.getElementById('column-center').prepend(container);\n    weave.componentDidMount();\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport getPeerTitle from '../../components/wrappers/getPeerTitle';\nimport wrapMessageForReply from '../../components/wrappers/messageForReply';\nimport {MOUNT_CLASS_TO} from '../../config/debug';\nimport {FontFamily} from '../../config/font';\nimport {IS_MOBILE} from '../../environment/userAgent';\nimport IS_VIBRATE_SUPPORTED from '../../environment/vibrateSupport';\nimport deferredPromise, {CancellablePromise} from '../../helpers/cancellablePromise';\nimport idleController from '../../helpers/idleController';\nimport deepEqual from '../../helpers/object/deepEqual';\nimport tsNow from '../../helpers/tsNow';\nimport {Message, MessagePeerReaction, PeerNotifySettings} from '../../layer';\nimport I18n, {FormatterArguments, LangPackKey} from '../langPack';\nimport apiManagerProxy from '../mtproto/mtprotoworker';\nimport singleInstance from '../mtproto/singleInstance';\nimport webPushApiManager, {PushSubscriptionNotify} from '../mtproto/webPushApiManager';\nimport fixEmoji from '../richTextProcessor/fixEmoji';\nimport wrapPlainText from '../richTextProcessor/wrapPlainText';\nimport rootScope from '../rootScope';\nimport appImManager from './appImManager';\nimport appRuntimeManager from './appRuntimeManager';\nimport {AppManagers} from './managers';\nimport generateMessageId from './utils/messageId/generateMessageId';\nimport getPeerId from './utils/peers/getPeerId';\n\ntype MyNotification = Notification & {\n  hidden?: boolean,\n  show?: () => void,\n};\n\nexport type NotifyOptions = Partial<{\n  tag: string;\n  image: string;\n  key: string;\n  title: string;\n  message: string;\n  silent: boolean;\n  onclick: () => void;\n  noIncrement: boolean;\n}>;\n\nexport type NotificationSettings = {\n  nodesktop: boolean,\n  volume: number,\n  novibrate: boolean,\n  nopreview: boolean,\n  nopush: boolean,\n  nosound: boolean\n};\n\nexport class UiNotificationsManager {\n  private notificationsUiSupport: boolean;\n  private notificationsShown: {[key: string]: MyNotification | true} = {};\n  private notificationIndex = 0;\n  private notificationsCount = 0;\n  private soundsPlayed: {[tag: string]: number} = {};\n  private vibrateSupport = IS_VIBRATE_SUPPORTED;\n  private nextSoundAt: number;\n  private prevSoundVolume: number;\n\n  private faviconEl: HTMLLinkElement = document.head.querySelector('link[rel=\"icon\"]');\n\n  private titleBackup = document.title;\n  private titleChanged = false;\n  private titleInterval: number;\n  private prevFavicon: string;\n\n  private notifySoundEl: HTMLElement;\n\n  private stopped = false;\n\n  private topMessagesDeferred: CancellablePromise<void>;\n\n  private settings: NotificationSettings = {} as any;\n\n  private registeredDevice: any;\n  private pushInited = false;\n\n  private managers: AppManagers;\n  private setAppBadge: (contents?: any) => Promise<void>;\n\n  construct(managers: AppManagers) {\n    this.managers = managers;\n\n    navigator.vibrate = navigator.vibrate || (navigator as any).mozVibrate || (navigator as any).webkitVibrate;\n    this.setAppBadge = (navigator as any).setAppBadge && (navigator as any).setAppBadge.bind(navigator);\n    this.setAppBadge && this.setAppBadge(0);\n\n    this.notificationsUiSupport = ('Notification' in window) || ('mozNotification' in navigator);\n\n    this.notifySoundEl = document.createElement('div');\n    this.notifySoundEl.id = 'notify-sound';\n    document.body.append(this.notifySoundEl);\n\n    this.topMessagesDeferred = deferredPromise<void>();\n\n    singleInstance.addEventListener('deactivated', () => {\n      this.stop();\n    });\n\n    singleInstance.addEventListener('activated', () => {\n      if(this.stopped) {\n        this.start();\n      }\n    });\n\n    idleController.addEventListener('change', (idle) => {\n      if(this.stopped) {\n        return;\n      }\n\n      if(!idle) {\n        this.clear();\n      }\n\n      this.toggleToggler();\n    });\n\n    rootScope.addEventListener('notification_reset', (peerString) => {\n      this.soundReset(peerString);\n    });\n\n    rootScope.addEventListener('notification_cancel', (str) => {\n      this.cancel(str);\n    });\n\n    if(this.setAppBadge) {\n      rootScope.addEventListener('folder_unread', (folder) => {\n        if(folder.id === 0) {\n          this.setAppBadge(folder.unreadUnmutedPeerIds.size);\n        }\n      });\n    }\n\n    webPushApiManager.addEventListener('push_init', (tokenData) => {\n      this.pushInited = true;\n      if(!this.settings.nodesktop && !this.settings.nopush) {\n        if(tokenData) {\n          this.registerDevice(tokenData);\n        } else {\n          webPushApiManager.subscribe();\n        }\n      } else {\n        this.unregisterDevice(tokenData);\n      }\n    });\n    webPushApiManager.addEventListener('push_subscribe', (tokenData) => {\n      this.registerDevice(tokenData);\n    });\n    webPushApiManager.addEventListener('push_unsubscribe', (tokenData) => {\n      this.unregisterDevice(tokenData);\n    });\n\n    rootScope.addEventListener('dialogs_multiupdate', () => {\n      // unregisterTopMsgs()\n      this.topMessagesDeferred.resolve();\n    }, {once: true});\n\n    webPushApiManager.addEventListener('push_notification_click', (notificationData) => {\n      if(notificationData.action === 'push_settings') {\n        /* this.topMessagesDeferred.then(() => {\n          $modal.open({\n            templateUrl: templateUrl('settings_modal'),\n            controller: 'SettingsModalController',\n            windowClass: 'settings_modal_window mobile_modal',\n            backdrop: 'single'\n          })\n        }); */\n        return;\n      }\n\n      if(notificationData.action === 'mute1d') {\n        this.managers.apiManager.invokeApi('account.updateDeviceLocked', {\n          period: 86400\n        }).then(() => {\n          // var toastData = toaster.pop({\n          //   type: 'info',\n          //   body: _('push_action_mute1d_success'),\n          //   bodyOutputType: 'trustedHtml',\n          //   clickHandler: () => {\n          //     toaster.clear(toastData)\n          //   },\n          //   showCloseButton: false\n          // })\n        });\n\n        return;\n      }\n\n      const peerId = notificationData.custom && notificationData.custom.peerId.toPeerId();\n      console.log('click', notificationData, peerId);\n      if(peerId) {\n        this.topMessagesDeferred.then(async() => {\n          if(notificationData.custom.channel_id &&\n              !(await this.managers.appChatsManager.hasChat(notificationData.custom.channel_id))) {\n            return;\n          }\n\n          if(peerId.isUser() && !(await this.managers.appUsersManager.hasUser(peerId))) {\n            return;\n          }\n\n          appImManager.setInnerPeer({\n            peerId,\n            lastMsgId: generateMessageId(+notificationData.custom.msg_id)\n          });\n        });\n      }\n    });\n  }\n\n  public async buildNotification({message, fwdCount, peerReaction, peerTypeNotifySettings}: {\n    message: Message.message | Message.messageService,\n    fwdCount?: number,\n    peerReaction?: MessagePeerReaction,\n    peerTypeNotifySettings?: PeerNotifySettings\n  }) {\n    const peerId = message.peerId;\n    const isAnyChat = peerId.isAnyChat();\n    const notification: NotifyOptions = {};\n    const peerString = await this.managers.appPeersManager.getPeerString(peerId);\n    let notificationMessage: string;\n\n    if(peerTypeNotifySettings.show_previews) {\n      if(message._ === 'message' && message.fwd_from && fwdCount > 1) {\n        notificationMessage = I18n.format('Notifications.Forwarded', true, [fwdCount]);\n      } else {\n        notificationMessage = await wrapMessageForReply(message, undefined, undefined, true);\n\n        if(peerReaction) {\n          const langPackKey: LangPackKey = /* isAnyChat ? 'Notification.Group.Reacted' :  */'Notification.Contact.Reacted';\n          const args: FormatterArguments = [\n            fixEmoji(peerReaction.reaction), // can be plain heart\n            notificationMessage\n          ];\n\n          /* if(isAnyChat) {\n            args.unshift(appPeersManager.getPeerTitle(message.fromId, true));\n          } */\n\n          notificationMessage = I18n.format(langPackKey, true, args);\n        }\n      }\n    } else {\n      notificationMessage = I18n.format('Notifications.New', true);\n    }\n\n    if(peerReaction) {\n      notification.noIncrement = true;\n      notification.silent = true;\n    }\n\n    const notificationFromPeerId = peerReaction ? getPeerId(peerReaction.peer_id) : message.fromId;\n    notification.title = await getPeerTitle(peerId, true, undefined, undefined, this.managers);\n    if(isAnyChat && notificationFromPeerId !== message.peerId) {\n      notification.title = await getPeerTitle(notificationFromPeerId, true, undefined, undefined, this.managers) +\n        ' @ ' +\n        notification.title;\n    }\n\n    notification.title = wrapPlainText(notification.title);\n\n    notification.onclick = () => {\n      appImManager.setInnerPeer({peerId, lastMsgId: message.mid});\n    };\n\n    notification.message = notificationMessage;\n    notification.key = 'msg' + message.mid;\n    notification.tag = peerString;\n    notification.silent = true;// message.pFlags.silent || false;\n\n    const peerPhoto = await this.managers.appPeersManager.getPeerPhoto(peerId);\n    if(peerPhoto) {\n      this.managers.appAvatarsManager.loadAvatar(peerId, peerPhoto, 'photo_small').then((url) => {\n        // ! WARNING, message can be already read\n        if(message.pFlags.unread || peerReaction) {\n          notification.image = url;\n          this.notify(notification);\n        }\n      });\n    } else {\n      this.notify(notification);\n    }\n  }\n\n  private toggleToggler(enable = idleController.isIdle) {\n    if(IS_MOBILE) return;\n\n    const resetTitle = (isBlink?: boolean) => {\n      this.titleChanged = false;\n      document.title = this.titleBackup;\n      this.setFavicon();\n    };\n\n    window.clearInterval(this.titleInterval);\n    this.titleInterval = 0;\n\n    if(!enable) {\n      resetTitle();\n    } else {\n      this.titleInterval = window.setInterval(() => {\n        const count = this.notificationsCount;\n        if(!count) {\n          this.toggleToggler(false);\n        } else if(this.titleChanged) {\n          resetTitle(true);\n        } else {\n          this.titleChanged = true;\n          document.title = I18n.format('Notifications.Count', true, [count]);\n          // this.setFavicon('assets/img/favicon_unread.ico');\n\n          // fetch('assets/img/favicon.ico')\n          // .then((res) => res.blob())\n          // .then((blob) => {\n          // const img = document.createElement('img');\n          // img.src = URL.createObjectURL(blob);\n\n          const canvas = document.createElement('canvas');\n          canvas.width = 32 * window.devicePixelRatio;\n          canvas.height = canvas.width;\n\n          const ctx = canvas.getContext('2d');\n          ctx.beginPath();\n          ctx.arc(canvas.width / 2, canvas.height / 2, canvas.width / 2, 0, 2 * Math.PI, false);\n          ctx.fillStyle = '#3390ec';\n          ctx.fill();\n\n          let fontSize = 24;\n          let str = '' + count;\n          if(count < 10) {\n            fontSize = 22;\n          } else if(count < 100) {\n            fontSize = 20;\n          } else {\n            str = '99+';\n            fontSize = 16;\n          }\n\n          fontSize *= window.devicePixelRatio;\n\n          ctx.font = `700 ${fontSize}px ${FontFamily}`;\n          ctx.textBaseline = 'middle';\n          ctx.textAlign = 'center';\n          ctx.fillStyle = 'white';\n          ctx.fillText(str, canvas.width / 2, canvas.height * .5625);\n\n          /* const ctx = canvas.getContext('2d');\n            ctx.drawImage(img, 0, 0, canvas.width, canvas.height); */\n\n          this.setFavicon(canvas.toDataURL());\n          // });\n        }\n      }, 1000);\n    }\n  }\n\n  private setFavicon(href: string = 'assets/img/favicon.ico') {\n    if(this.prevFavicon === href) {\n      return;\n    }\n\n    const link = this.faviconEl.cloneNode() as HTMLLinkElement;\n    link.href = href;\n    this.faviconEl.parentNode.replaceChild(link, this.faviconEl);\n    this.faviconEl = link;\n\n    this.prevFavicon = href;\n  }\n\n  public notify(data: NotifyOptions) {\n    // console.log('notify', data, rootScope.idle.isIDLE, this.notificationsUiSupport, this.stopped);\n\n    if(this.stopped) {\n      return;\n    }\n\n    // FFOS Notification blob src bug workaround\n    /* if(Config.Navigator.ffos && !Config.Navigator.ffos2p) {\n      data.image = 'https://telegram.org/img/t_logo.png'\n    }\n    else if (data.image && !angular.isString(data.image)) {\n      if (Config.Navigator.ffos2p) {\n        FileManager.getDataUrl(data.image, 'image/jpeg').then(function (url) {\n          data.image = url\n          notify(data)\n        })\n        return false\n      } else {\n        data.image = FileManager.getUrl(data.image, 'image/jpeg')\n      }\n    }\n    else */ if(!data.image) {\n      data.image = 'assets/img/logo_filled_rounded.png';\n    }\n    // console.log('notify image', data.image)\n\n    if(!data.noIncrement) {\n      ++this.notificationsCount;\n    }\n\n    if(!this.titleInterval) {\n      this.toggleToggler();\n    }\n\n    const idx = ++this.notificationIndex;\n    const key = data.key || 'k' + idx;\n    this.notificationsShown[key] = true;\n\n    const now = tsNow();\n    if(this.settings.volume > 0 && !this.settings.nosound/* &&\n      (\n        !data.tag ||\n        !this.soundsPlayed[data.tag] ||\n        now > this.soundsPlayed[data.tag] + 60000\n      ) */\n    ) {\n      this.testSound(this.settings.volume);\n      this.soundsPlayed[data.tag] = now;\n    }\n\n    if(!this.notificationsUiSupport ||\n      'Notification' in window && Notification.permission !== 'granted') {\n      return false;\n    }\n\n    if(this.settings.nodesktop) {\n      if(this.vibrateSupport && !this.settings.novibrate) {\n        navigator.vibrate([200, 100, 200]);\n        return;\n      }\n\n      return;\n    }\n\n    let notification: MyNotification;\n\n    if('Notification' in window) {\n      try {\n        if(data.tag) {\n          for(const i in this.notificationsShown) {\n            const notification = this.notificationsShown[i];\n            if(typeof(notification) !== 'boolean' && notification.tag === data.tag) {\n              notification.hidden = true;\n            }\n          }\n        }\n\n        notification = new Notification(data.title, {\n          icon: data.image || '',\n          body: data.message || '',\n          tag: data.tag || '',\n          silent: data.silent || false\n        });\n\n        // console.log('notify constructed notification');\n      } catch(e) {\n        this.notificationsUiSupport = false;\n        webPushApiManager.setLocalNotificationsDisabled();\n        return;\n      }\n    } /* else if('mozNotification' in navigator) {\n      notification = navigator.mozNotification.createNotification(data.title, data.message || '', data.image || '')\n    } else if(notificationsMsSiteMode) {\n      window.external.msSiteModeClearIconOverlay()\n      window.external.msSiteModeSetIconOverlay('img/icons/icon16.png', data.title)\n      window.external.msSiteModeActivate()\n      notification = {\n        index: idx\n      }\n    } */ else {\n      return;\n    }\n\n    notification.onclick = () => {\n      notification.close();\n      appRuntimeManager.focus();\n      this.clear();\n      if(data.onclick) {\n        data.onclick();\n      }\n    };\n\n    notification.onclose = () => {\n      if(!notification.hidden) {\n        delete this.notificationsShown[key];\n        this.clear();\n      }\n    };\n\n    if(notification.show) {\n      notification.show();\n    }\n    this.notificationsShown[key] = notification;\n\n    if(!IS_MOBILE) {\n      setTimeout(() => {\n        this.hide(key);\n      }, 8000);\n    }\n  }\n\n  public updateLocalSettings = () => {\n    const keys = ['notify_nodesktop', 'notify_volume', 'notify_novibrate', 'notify_nopreview', 'notify_nopush'];\n    const promises = keys.map(() => undefined);\n    // const promises = keys.map((k) => stateStorage.get(k as any));\n    Promise.all(promises)\n    .then((updSettings) => {\n      this.settings.nodesktop = updSettings[0];\n      this.settings.volume = updSettings[1] === undefined ? 0.5 : updSettings[1];\n      this.settings.novibrate = updSettings[2];\n      this.settings.nopreview = updSettings[3];\n      this.settings.nopush = updSettings[4];\n\n      if(this.pushInited) {\n        const needPush = !this.settings.nopush && !this.settings.nodesktop && webPushApiManager.isAvailable || false;\n        const hasPush = this.registeredDevice !== false;\n        if(needPush !== hasPush) {\n          if(needPush) {\n            webPushApiManager.subscribe();\n          } else {\n            webPushApiManager.unsubscribe();\n          }\n        }\n      }\n\n      webPushApiManager.setSettings(this.settings);\n    });\n\n    apiManagerProxy.getState().then((state) => {\n      this.settings.nosound = !state.settings.notifications.sound;\n    });\n  }\n\n  public getLocalSettings() {\n    return this.settings;\n  }\n\n  private hide(key: string) {\n    const notification = this.notificationsShown[key];\n    if(notification && typeof(notification) !== 'boolean') {\n      try {\n        if(notification.close) {\n          notification.hidden = true;\n          notification.close();\n        }\n      } catch(e) {}\n    }\n  }\n\n  public soundReset(tag: string) {\n    delete this.soundsPlayed[tag];\n  }\n\n  private requestPermission = () => {\n    Notification.requestPermission();\n    window.removeEventListener('click', this.requestPermission);\n  };\n\n  public testSound(volume: number) {\n    const now = tsNow();\n    if(this.nextSoundAt && now < this.nextSoundAt && this.prevSoundVolume === volume) {\n      return;\n    }\n\n    this.nextSoundAt = now + 1000;\n    this.prevSoundVolume = volume;\n    const filename = 'assets/audio/notification.mp3';\n    const audio = document.createElement('audio');\n    audio.autoplay = true;\n    audio.setAttribute('mozaudiochannel', 'notification');\n    audio.volume = volume;\n    audio.innerHTML = `\n      <source src=\"${filename}\" type=\"audio/mpeg\" />\n      <embed hidden=\"true\" autostart=\"true\" loop=\"false\" volume=\"${volume * 100}\" src=\"${filename}\" />\n    `;\n    this.notifySoundEl.append(audio);\n\n    audio.addEventListener('ended', () => {\n      audio.remove();\n    }, {once: true});\n  }\n\n  public cancel(key: string) {\n    const notification = this.notificationsShown[key];\n    if(notification) {\n      if(this.notificationsCount > 0) {\n        --this.notificationsCount;\n      }\n\n      try {\n        if(typeof(notification) !== 'boolean' && notification.close) {\n          notification.hidden = true;\n          notification.close();\n        }/*  else if(notificationsMsSiteMode &&\n          notification.index === notificationIndex) {\n          window.external.msSiteModeClearIconOverlay()\n        } */\n      } catch(e) {}\n\n      delete this.notificationsShown[key];\n    }\n  }\n\n  public clear() {\n    /* if(notificationsMsSiteMode) {\n      window.external.msSiteModeClearIconOverlay()\n    } else { */\n    for(const i in this.notificationsShown) {\n      const notification = this.notificationsShown[i];\n      try {\n        if(typeof(notification) !== 'boolean' && notification.close) {\n          notification.close();\n        }\n      } catch(e) {}\n    }\n    /* } */\n    this.notificationsShown = {};\n    this.notificationsCount = 0;\n\n    webPushApiManager.hidePushNotifications();\n  }\n\n  public start() {\n    this.updateLocalSettings();\n    rootScope.addEventListener('settings_updated', this.updateLocalSettings);\n    webPushApiManager.start();\n\n    if(!this.notificationsUiSupport) {\n      return false;\n    }\n\n    if('Notification' in window && Notification.permission !== 'granted' && Notification.permission !== 'denied') {\n      window.addEventListener('click', this.requestPermission);\n    }\n\n    try {\n      if('onbeforeunload' in window) {\n        window.addEventListener('beforeunload', this.clear);\n      }\n    } catch(e) {}\n  }\n\n  private stop() {\n    this.clear();\n    window.clearInterval(this.titleInterval);\n    this.titleInterval = 0;\n    this.setFavicon();\n    this.stopped = true;\n  }\n\n  private registerDevice(tokenData: PushSubscriptionNotify) {\n    if(this.registeredDevice && deepEqual(this.registeredDevice, tokenData)) {\n      return false;\n    }\n\n    this.managers.apiManager.invokeApi('account.registerDevice', {\n      token_type: tokenData.tokenType,\n      token: tokenData.tokenValue,\n      other_uids: [],\n      app_sandbox: false,\n      secret: new Uint8Array()\n    }).then(() => {\n      this.registeredDevice = tokenData;\n    }, (error) => {\n      error.handled = true;\n    });\n  }\n\n  private unregisterDevice(tokenData: PushSubscriptionNotify) {\n    if(!this.registeredDevice) {\n      return false;\n    }\n\n    this.managers.apiManager.invokeApi('account.unregisterDevice', {\n      token_type: tokenData.tokenType,\n      token: tokenData.tokenValue,\n      other_uids: []\n    }).then(() => {\n      this.registeredDevice = false;\n    }, (error) => {\n      error.handled = true;\n    });\n  }\n}\n\nconst uiNotificationsManager = new UiNotificationsManager();\nMOUNT_CLASS_TO && (MOUNT_CLASS_TO.uiNotificationsManager = uiNotificationsManager);\nexport default uiNotificationsManager;\n","export default async function getFilesFromEvent(e: ClipboardEvent | DragEvent, onlyTypes = false): Promise<any[]> {\n  const files: any[] = [];\n\n  const scanFiles = async(entry: any, item: DataTransferItem) => {\n    if(entry.isDirectory) {\n      const directoryReader = entry.createReader();\n      await new Promise<void>((resolve, reject) => {\n        directoryReader.readEntries(async(entries: any) => {\n          for(const entry of entries) {\n            await scanFiles(entry, item);\n          }\n\n          resolve();\n        });\n      });\n    } else if(entry) {\n      if(onlyTypes) {\n        files.push(entry.type);\n      } else {\n        const itemFile = item.getAsFile(); // * Safari can't handle entry.file with pasting\n        const file = entry instanceof File ?\n          entry :\n          (\n            entry instanceof DataTransferItem ?\n              entry.getAsFile() :\n              await new Promise((resolve, reject) => entry.file(resolve, (err: any) => resolve(itemFile)))\n          );\n\n        /* if(!onlyTypes) {\n          console.log('getFilesFromEvent: got file', item, file);\n        } */\n\n        if(!file) return;\n        files.push(file);\n      }\n    }\n  };\n\n  if(e instanceof DragEvent && e.dataTransfer.files && !e.dataTransfer.items) {\n    for(let i = 0; i < e.dataTransfer.files.length; i++) {\n      const file = e.dataTransfer.files[i];\n      files.push(onlyTypes ? file.type : file);\n    }\n  } else {\n    // @ts-ignore\n    const items = (e.dataTransfer || e.clipboardData || e.originalEvent.clipboardData).items;\n\n    const promises: Promise<any>[] = [];\n    for(let i = 0; i < items.length; ++i) {\n      const item: DataTransferItem = items[i];\n      if(item.kind === 'file') {\n        const entry = (onlyTypes ? item : item.webkitGetAsEntry()) || item.getAsFile();\n        promises.push(scanFiles(entry, item));\n      }\n    }\n\n    await Promise.all(promises);\n  }\n\n  /* if(!onlyTypes) {\n    console.log('getFilesFromEvent: got files:', e, files);\n  } */\n\n  return files;\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport animationIntersector, {AnimationItemGroup} from '../../components/animationIntersector';\nimport appSidebarLeft, {LEFT_COLUMN_ACTIVE_CLASSNAME} from '../../components/sidebarLeft';\nimport appSidebarRight, {RIGHT_COLUMN_ACTIVE_CLASSNAME} from '../../components/sidebarRight';\nimport mediaSizes, {ScreenSize} from '../../helpers/mediaSizes';\nimport {logger, LogTypes} from '../logger';\nimport rootScope from '../rootScope';\nimport Chat, {ChatType} from '../../components/chat/chat';\nimport PopupNewMedia, {getCurrentNewMediaPopup} from '../../components/popups/newMedia';\nimport MarkupTooltip from '../../components/chat/markupTooltip';\nimport IS_TOUCH_SUPPORTED from '../../environment/touchSupport';\nimport SetTransition from '../../components/singleTransition';\nimport ChatDragAndDrop from '../../components/chat/dragAndDrop';\nimport {doubleRaf} from '../../helpers/schedulers';\nimport lottieLoader from '../rlottie/lottieLoader';\nimport useHeavyAnimationCheck, {dispatchHeavyAnimationEvent} from '../../hooks/useHeavyAnimationCheck';\nimport stateStorage from '../stateStorage';\nimport {MOUNT_CLASS_TO} from '../../config/debug';\nimport appNavigationController from '../../components/appNavigationController';\nimport AppPrivateSearchTab from '../../components/sidebarRight/tabs/search';\nimport I18n, {i18n, join, LangPackKey} from '../langPack';\nimport {ChatFull, ChatInvite, ChatParticipant, ChatParticipants, Message, MessageAction, MessageMedia, SendMessageAction} from '../../layer';\nimport PeerTitle from '../../components/peerTitle';\nimport PopupPeer from '../../components/popups/peer';\nimport blurActiveElement from '../../helpers/dom/blurActiveElement';\nimport cancelEvent from '../../helpers/dom/cancelEvent';\nimport disableTransition from '../../helpers/dom/disableTransition';\nimport placeCaretAtEnd from '../../helpers/dom/placeCaretAtEnd';\nimport replaceContent from '../../helpers/dom/replaceContent';\nimport whichChild from '../../helpers/dom/whichChild';\nimport PopupElement from '../../components/popups';\nimport singleInstance, {InstanceDeactivateReason, SingleInstance} from '../mtproto/singleInstance';\nimport PopupStickers from '../../components/popups/stickers';\nimport PopupJoinChatInvite from '../../components/popups/joinChatInvite';\nimport {toast, toastNew} from '../../components/toast';\nimport debounce from '../../helpers/schedulers/debounce';\nimport pause from '../../helpers/schedulers/pause';\nimport {InternalLink, InternalLinkTypeMap, INTERNAL_LINK_TYPE} from './internalLink';\nimport MEDIA_MIME_TYPES_SUPPORTED from '../../environment/mediaMimeTypesSupport';\nimport {NULL_PEER_ID} from '../mtproto/mtproto_config';\nimport telegramMeWebManager from '../mtproto/telegramMeWebManager';\nimport {ONE_DAY} from '../../helpers/date';\nimport type {GroupCallId, MyGroupCall} from './appGroupCallsManager';\nimport TopbarCall from '../../components/topbarCall';\nimport confirmationPopup from '../../components/confirmationPopup';\nimport IS_GROUP_CALL_SUPPORTED from '../../environment/groupCallSupport';\nimport IS_CALL_SUPPORTED from '../../environment/callSupport';\nimport {CallType} from '../calls/types';\nimport {Awaited, Modify, SendMessageEmojiInteractionData} from '../../types';\nimport htmlToSpan from '../../helpers/dom/htmlToSpan';\nimport getVisibleRect from '../../helpers/dom/getVisibleRect';\nimport {attachClickEvent, simulateClickEvent} from '../../helpers/dom/clickEvent';\nimport PopupCall from '../../components/call';\nimport copy from '../../helpers/object/copy';\nimport getObjectKeysAndSort from '../../helpers/object/getObjectKeysAndSort';\nimport type GroupCallInstance from '../calls/groupCallInstance';\nimport type CallInstance from '../calls/callInstance';\nimport numberThousandSplitter from '../../helpers/number/numberThousandSplitter';\nimport ChatBackgroundPatternRenderer from '../../components/chat/patternRenderer';\nimport {IS_FIREFOX} from '../../environment/userAgent';\nimport compareVersion from '../../helpers/compareVersion';\nimport {AppManagers} from './managers';\nimport uiNotificationsManager from './uiNotificationsManager';\nimport appMediaPlaybackController from '../../components/appMediaPlaybackController';\nimport {PHONE_NUMBER_REG_EXP} from '../richTextProcessor';\nimport wrapEmojiText from '../richTextProcessor/wrapEmojiText';\nimport wrapRichText from '../richTextProcessor/wrapRichText';\nimport wrapUrl from '../richTextProcessor/wrapUrl';\nimport generateMessageId from './utils/messageId/generateMessageId';\nimport getUserStatusString from '../../components/wrappers/getUserStatusString';\nimport getChatMembersString from '../../components/wrappers/getChatMembersString';\nimport {STATE_INIT} from '../../config/state';\nimport CacheStorageController from '../files/cacheStorage';\nimport themeController from '../../helpers/themeController';\nimport overlayCounter from '../../helpers/overlayCounter';\nimport appDialogsManager from './appDialogsManager';\nimport idleController from '../../helpers/idleController';\nimport EventListenerBase from '../../helpers/eventListenerBase';\nimport {AckedResult} from '../mtproto/superMessagePort';\nimport groupCallsController from '../calls/groupCallsController';\nimport callsController from '../calls/callsController';\nimport getFilesFromEvent from '../../helpers/files/getFilesFromEvent';\nimport apiManagerProxy from '../mtproto/mtprotoworker';\nimport appRuntimeManager from './appRuntimeManager';\nimport paymentsWrapCurrencyAmount from '../../helpers/paymentsWrapCurrencyAmount';\nimport findUpClassName from '../../helpers/dom/findUpClassName';\nimport {CLICK_EVENT_NAME} from '../../helpers/dom/clickEvent';\nimport PopupPayment from '../../components/popups/payment';\n\nexport const CHAT_ANIMATION_GROUP: AnimationItemGroup = 'chat';\n\nexport type ChatSavedPosition = {\n  mids: number[],\n  top: number\n};\n\nexport type ChatSetPeerOptions = {\n  peerId?: PeerId,\n  lastMsgId?: number,\n  threadId?: number,\n  startParam?: string\n};\n\nexport type ChatSetInnerPeerOptions = Modify<ChatSetPeerOptions, {\n  peerId: PeerId\n}> & {\n  type?: ChatType\n};\n\nexport class AppImManager extends EventListenerBase<{\n  chat_changing: (details: {from: Chat, to: Chat}) => void,\n  peer_changed: (peerId: PeerId) => void,\n  peer_changing: (chat: Chat) => void,\n}> {\n  public columnEl = document.getElementById('column-center') as HTMLDivElement;\n  public chatsContainer: HTMLElement;\n\n  public offline = false;\n  public updateStatusInterval = 0;\n\n  public log: ReturnType<typeof logger>;\n\n  public setPeerPromise: Promise<void> = null;\n\n  public tabId = -1;\n\n  public chats: Chat[] = [];\n  private prevTab: HTMLElement;\n  private chatsSelectTabDebounced: () => void;\n\n  public markupTooltip: MarkupTooltip;\n  private backgroundPromises: {[slug: string]: Promise<string>};\n\n  private topbarCall: TopbarCall;\n  public emojiAnimationContainer: HTMLDivElement;\n\n  private lastBackgroundUrl: string;\n\n  public managers: AppManagers;\n\n  public cacheStorage = new CacheStorageController('cachedFiles');\n\n  get myId() {\n    return rootScope.myId;\n  }\n\n  get chat(): Chat {\n    return this.chats[this.chats.length - 1];\n  }\n\n  public construct(managers: AppManagers) {\n    this.managers = managers;\n\n    const {\n      apiUpdatesManager\n    } = managers;\n    apiUpdatesManager.attach(I18n.lastRequestedLangCode);\n\n    appMediaPlaybackController.construct(managers);\n    uiNotificationsManager.construct(managers);\n    uiNotificationsManager.start();\n\n    this.log = logger('IM', LogTypes.Log | LogTypes.Warn | LogTypes.Debug | LogTypes.Error);\n\n    this.backgroundPromises = {};\n    STATE_INIT.settings.themes.forEach((theme) => {\n      if(theme.background.slug) {\n        const url = 'assets/img/' + theme.background.slug + '.svg' + (IS_FIREFOX ? '?1' : '');\n        this.backgroundPromises[theme.background.slug] = Promise.resolve(url);\n      }\n    });\n\n    this.selectTab(0);\n\n    idleController.addEventListener('change', (idle) => {\n      this.offline = idle;\n      this.updateStatus();\n      if(idle) {\n        clearInterval(this.updateStatusInterval);\n      } else {\n        this.updateStatusInterval = window.setInterval(() => this.updateStatus(), 50e3);\n      }\n    });\n\n    this.chatsContainer = document.createElement('div');\n    this.chatsContainer.classList.add('chats-container', 'tabs-container');\n    this.chatsContainer.dataset.animation = 'navigation';\n\n    this.emojiAnimationContainer = document.createElement('div');\n    this.emojiAnimationContainer.classList.add('emoji-animation-container');\n    this.appendEmojiAnimationContainer(mediaSizes.activeScreen);\n\n    this.columnEl.append(this.chatsContainer);\n\n    this.createNewChat();\n    this.chatsSelectTab(this.chat.container);\n\n    appNavigationController.onHashChange = this.onHashChange;\n    // window.addEventListener('hashchange', this.onHashChange);\n\n    this.setSettings();\n    rootScope.addEventListener('settings_updated', this.setSettings);\n\n    const onPremiumToggle = (isPremium: boolean) => {\n      document.body.classList.toggle('is-premium', isPremium);\n    };\n    rootScope.addEventListener('premium_toggle', onPremiumToggle);\n    onPremiumToggle(rootScope.premium);\n\n    useHeavyAnimationCheck(() => {\n      animationIntersector.setOnlyOnePlayableGroup('lock');\n      animationIntersector.checkAnimations(true);\n    }, () => {\n      animationIntersector.setOnlyOnePlayableGroup();\n      animationIntersector.checkAnimations(false);\n    });\n\n    if(IS_FIREFOX && apiManagerProxy.oldVersion && compareVersion(apiManagerProxy.oldVersion, '1.4.3') === -1) {\n      this.deleteFilesIterative((response) => {\n        return response.headers.get('Content-Type') === 'image/svg+xml';\n      }).then(() => {\n        this.applyCurrentTheme();\n      });\n    } else {\n      this.applyCurrentTheme();\n    }\n\n    // * fix simultaneous opened both sidebars, can happen when floating sidebar is opened with left sidebar\n    mediaSizes.addEventListener('changeScreen', (from, to) => {\n      if(document.body.classList.contains(LEFT_COLUMN_ACTIVE_CLASSNAME) &&\n        document.body.classList.contains(RIGHT_COLUMN_ACTIVE_CLASSNAME)) {\n        appSidebarRight.toggleSidebar(false);\n      }\n\n      this.appendEmojiAnimationContainer(to);\n    });\n\n    mediaSizes.addEventListener('resize', () => {\n      // const perf = performance.now();\n      const rect = this.chatsContainer.getBoundingClientRect();\n      ChatBackgroundPatternRenderer.resizeInstances(rect.width, rect.height).then(() => {\n        // this.log.warn('resize bg time:', performance.now() - perf);\n        // for(const chat of this.chats) {\n        //   if(chat.renderDarkPattern) {\n        //     chat.renderDarkPattern();\n        //   }\n        // }\n      });\n    });\n\n    this.addEventListener('peer_changing', (chat) => {\n      this.saveChatPosition(chat);\n    });\n\n    rootScope.addEventListener('theme_change', () => {\n      this.applyCurrentTheme();\n    });\n\n    rootScope.addEventListener('choosing_sticker', (choosing) => {\n      this.setChoosingStickerTyping(!choosing);\n    });\n\n    rootScope.addEventListener('peer_typings', ({peerId, typings}) => {\n      const chat = this.chat;\n      if(\n        !chat ||\n        chat.peerId !== peerId ||\n        overlayCounter.isOverlayActive || (\n          mediaSizes.activeScreen === ScreenSize.mobile &&\n          this.tabId !== 1\n        )\n      ) {\n        return;\n      }\n\n      const typing = typings.find((typing) => typing.action._ === 'sendMessageEmojiInteraction');\n      if(typing?.action?._ === 'sendMessageEmojiInteraction') {\n        const action = typing.action;\n        const bubble = chat.bubbles.bubbles[generateMessageId(typing.action.msg_id)];\n        if(bubble && bubble.classList.contains('emoji-big') && bubble.classList.contains('sticker') && getVisibleRect(bubble, chat.bubbles.scrollable.container)) {\n          const stickerWrapper: HTMLElement = bubble.querySelector('.media-sticker-wrapper:not(.bubble-hover-reaction-sticker):not(.reaction-sticker)');\n\n          const data: SendMessageEmojiInteractionData = JSON.parse(action.interaction.data);\n          data.a.forEach((a) => {\n            setTimeout(() => {\n              simulateClickEvent(stickerWrapper);\n            }, a.t * 1000);\n          });\n\n          this.managers.appMessagesManager.setTyping(peerId, {\n            _: 'sendMessageEmojiInteractionSeen',\n            emoticon: action.emoticon\n          });\n        }\n      }\n    });\n\n    const onInstanceDeactivated = (reason: InstanceDeactivateReason) => {\n      const isUpdated = reason === 'version';\n      const popup = new PopupElement('popup-instance-deactivated', {overlayClosable: true});\n      const c = document.createElement('div');\n      c.classList.add('instance-deactivated-container');\n      (popup as any).container.replaceWith(c);\n\n      const header = document.createElement('div');\n      header.classList.add('header');\n      header.append(i18n(isUpdated ? 'Deactivated.Version.Title' : 'Deactivated.Title'));\n\n      const subtitle = document.createElement('div');\n      subtitle.classList.add('subtitle');\n      subtitle.append(i18n(isUpdated ? 'Deactivated.Version.Subtitle' : 'Deactivated.Subtitle'));\n\n      c.append(header, subtitle);\n\n      document.body.classList.add('deactivated');\n\n      const onClose = isUpdated ? () => {\n        appRuntimeManager.reload();\n      } : () => {\n        document.body.classList.add('deactivated-backwards');\n\n        singleInstance.activateInstance();\n\n        setTimeout(() => {\n          document.body.classList.remove('deactivated', 'deactivated-backwards');\n        }, 333);\n      };\n\n      popup.addEventListener('close', onClose);\n      popup.show();\n    };\n\n    singleInstance.addEventListener('deactivated', onInstanceDeactivated);\n    if(singleInstance.deactivatedReason) {\n      onInstanceDeactivated(singleInstance.deactivatedReason);\n    }\n\n    // remove scroll listener when setting chat to tray\n    this.addEventListener('chat_changing', ({to}) => {\n      this.toggleChatGradientAnimation(to);\n    });\n\n    rootScope.addEventListener('service_notification', (update) => {\n      confirmationPopup({\n        button: {langKey: 'OK', isCancel: true},\n        description: wrapRichText(update.message)\n      });\n    });\n\n    rootScope.addEventListener('payment_sent', async({peerId, mid, receiptMessage}) => {\n      const message = await this.managers.appMessagesManager.getMessageByPeer(peerId, mid);\n      if(!message) {\n        return;\n      }\n\n      const action = receiptMessage.action as MessageAction.messageActionPaymentSent;\n      toastNew({\n        langPackKey: 'PaymentInfoHint',\n        langPackArguments: [\n          paymentsWrapCurrencyAmount(action.total_amount, action.currency),\n          wrapEmojiText(((message as Message.message).media as MessageMedia.messageMediaInvoice).title)\n        ]\n      });\n    });\n\n    (window as any).onSpoilerClick = (e: MouseEvent) => {\n      const spoiler = findUpClassName(e.target, 'spoiler');\n      const parentElement = findUpClassName(spoiler, 'spoilers-container') || spoiler.parentElement;\n\n      const className = 'is-spoiler-visible';\n      const isVisible = parentElement.classList.contains(className);\n      if(!isVisible) {\n        cancelEvent(e);\n\n        if(CLICK_EVENT_NAME !== 'click') {\n          window.addEventListener('click', cancelEvent, {capture: true, once: true});\n        }\n      }\n\n      const duration = 400 / 2;\n      const showDuration = 5000;\n      const useRafs = !isVisible ? 2 : 0;\n      if(useRafs) {\n        parentElement.classList.add('will-change');\n      }\n\n      const spoilerTimeout = parentElement.dataset.spoilerTimeout;\n      if(spoilerTimeout !== null) {\n        clearTimeout(+spoilerTimeout);\n        delete parentElement.dataset.spoilerTimeout;\n      }\n\n      SetTransition(parentElement, className, true, duration, () => {\n        parentElement.dataset.spoilerTimeout = '' + window.setTimeout(() => {\n          SetTransition(parentElement, className, false, duration, () => {\n            parentElement.classList.remove('will-change');\n            delete parentElement.dataset.spoilerTimeout;\n          });\n        }, showDuration);\n      }, useRafs);\n    };\n\n    rootScope.addEventListener('sticker_updated', ({type, faved}) => {\n      if(type === 'faved') {\n        toastNew({\n          langPackKey: faved ? 'AddedToFavorites' : 'RemovedFromFavorites'\n        });\n      } else if(!faved) {\n        toastNew({\n          langPackKey: 'RemovedFromRecent'\n        });\n      }\n    });\n\n    apiManagerProxy.addEventListener('notificationBuild', (options) => {\n      if(this.chat.peerId === options.message.peerId && !idleController.isIdle) {\n        return;\n      }\n\n      uiNotificationsManager.buildNotification(options);\n    });\n\n    this.addEventListener('peer_changed', async(peerId) => {\n      document.body.classList.toggle('has-chat', !!peerId);\n\n      this.emojiAnimationContainer.textContent = '';\n\n      this.overrideHash(peerId);\n\n      apiManagerProxy.updateTabState('chatPeerIds', this.chats.map((chat) => chat.peerId).filter(Boolean));\n    });\n\n    // stateStorage.get('chatPositions').then((c) => {\n    stateStorage.setToCache('chatPositions', /* c ||  */{});\n    // });\n\n    if(IS_CALL_SUPPORTED || IS_GROUP_CALL_SUPPORTED) {\n      this.topbarCall = new TopbarCall(managers);\n    }\n\n    if(IS_CALL_SUPPORTED) {\n      callsController.addEventListener('instance', ({instance/* , hasCurrent */}) => {\n        // if(hasCurrent) {\n        // return;\n        // }\n\n        const popup = new PopupCall(instance);\n\n        instance.addEventListener('acceptCallOverride', () => {\n          return this.discardCurrentCall(instance.interlocutorUserId.toPeerId(), undefined, instance)\n          .then(() => {\n            callsController.dispatchEvent('accepting', instance);\n            return true;\n          })\n          .catch(() => false);\n        });\n\n        popup.addEventListener('close', () => {\n          const currentCall = callsController.currentCall;\n          if(currentCall && currentCall !== instance && !instance.wasTryingToJoin) {\n            instance.hangUp('phoneCallDiscardReasonBusy');\n          }\n        }, {once: true});\n\n        popup.show();\n      });\n\n      callsController.addEventListener('incompatible', (userId) => {\n        toastNew({\n          langPackKey: 'VoipPeerIncompatible',\n          langPackArguments: [\n            new PeerTitle({peerId: userId.toPeerId()}).element\n          ]\n        });\n      });\n    }\n\n    // ! do not remove this line\n    // ! instance can be deactivated before the UI starts, because it waits in background for RAF that is delayed\n    singleInstance.activateInstance();\n\n    const setAuthorized = () => {\n      telegramMeWebManager.setAuthorized(true);\n    };\n\n    setInterval(setAuthorized, ONE_DAY);\n    setAuthorized();\n\n    this.addAnchorListener<{}>({\n      name: 'showMaskedAlert',\n      callback: (params, element) => {\n        const href = element.href;\n\n        const a = element.cloneNode(true) as HTMLAnchorElement;\n        a.className = 'anchor-url';\n        a.innerText = href;\n        a.removeAttribute('onclick');\n\n        new PopupPeer('popup-masked-url', {\n          titleLangKey: 'OpenUrlTitle',\n          descriptionLangKey: 'OpenUrlAlert2',\n          descriptionLangArgs: [a],\n          buttons: [{\n            langKey: 'Open',\n            callback: () => {\n              a.click();\n            }\n          }]\n        }).show();\n      }\n    });\n\n    this.addAnchorListener<{uriParams: {command: string, bot: string}}>({\n      name: 'execBotCommand',\n      callback: ({uriParams}) => {\n        const {command, bot} = uriParams;\n\n        /* const promise = bot ? this.openUsername(bot).then(() => this.chat.peerId) : Promise.resolve(this.chat.peerId);\n        promise.then((peerId) => {\n          this.managers.appMessagesManager.sendText(peerId, '/' + command);\n        }); */\n\n        this.managers.appMessagesManager.sendText(this.chat.peerId, '/' + command + (bot ? '@' + bot : ''));\n\n        // console.log(command, bot);\n      }\n    });\n\n    this.addAnchorListener<{uriParams: {hashtag: string}}>({\n      name: 'searchByHashtag',\n      callback: ({uriParams}) => {\n        const {hashtag} = uriParams;\n        if(!hashtag) {\n          return;\n        }\n\n        this.chat.initSearch('#' + hashtag + ' ');\n      }\n    });\n\n    this.addAnchorListener<{pathnameParams: ['addstickers', string]}>({\n      name: 'addstickers',\n      callback: ({pathnameParams}) => {\n        const link: InternalLink = {\n          _: INTERNAL_LINK_TYPE.STICKER_SET,\n          set: pathnameParams[1]\n        };\n\n        this.processInternalLink(link);\n      }\n    });\n\n    // * t.me/invoice/asdasdad\n    // * t.me/$asdasdad\n    this.addAnchorListener<{pathnameParams: ['invoice', string] | string}>({\n      name: 'invoice',\n      callback: ({pathnameParams}) => {\n        const link: InternalLink = {\n          _: INTERNAL_LINK_TYPE.INVOICE,\n          slug: pathnameParams.length > 1 ? pathnameParams[1] : pathnameParams[0].slice(1)\n        };\n\n        this.processInternalLink(link);\n      }\n    });\n\n    // Support old t.me/joinchat/asd and new t.me/+asd\n    this.addAnchorListener<{pathnameParams: ['joinchat', string]}>({\n      name: 'joinchat',\n      callback: ({pathnameParams}) => {\n        const link: InternalLink = {\n          _: INTERNAL_LINK_TYPE.JOIN_CHAT,\n          invite: pathnameParams[1] || decodeURIComponent(pathnameParams[0]).slice(1)\n        };\n\n        this.processInternalLink(link);\n      }\n    });\n\n    if(IS_GROUP_CALL_SUPPORTED) {\n      this.addAnchorListener<{\n        uriParams: Omit<InternalLink.InternalLinkVoiceChat, '_'>\n      }>({\n        name: 'voicechat',\n        protocol: 'tg',\n        callback: ({uriParams}) => {\n          const link = this.makeLink(INTERNAL_LINK_TYPE.VOICE_CHAT, uriParams);\n          this.processInternalLink(link);\n        }\n      });\n    }\n\n    this.addAnchorListener<{\n    //   pathnameParams: ['c', string, string],\n    //   uriParams: {thread?: number}\n    // } | {\n    //   pathnameParams: [string, string?],\n    //   uriParams: {comment?: number}\n      pathnameParams: ['c', string, string] | [string, string?],\n      uriParams: {thread?: string, comment?: string} | {comment?: string, start?: string}\n    }>({\n      name: 'im',\n      callback: async({pathnameParams, uriParams}) => {\n        let link: InternalLink;\n        if(PHONE_NUMBER_REG_EXP.test(pathnameParams[0])) {\n          link = {\n            _: INTERNAL_LINK_TYPE.USER_PHONE_NUMBER,\n            phone: pathnameParams[0].slice(1)\n          };\n        } else if(pathnameParams[0] === 'c') {\n          link = {\n            _: INTERNAL_LINK_TYPE.PRIVATE_POST,\n            channel: pathnameParams[1],\n            post: pathnameParams[2],\n            thread: 'thread' in uriParams && uriParams.thread,\n            comment: uriParams.comment\n          };\n        } else {\n          link = {\n            _: INTERNAL_LINK_TYPE.MESSAGE,\n            domain: pathnameParams[0],\n            post: pathnameParams[1],\n            comment: uriParams.comment,\n            start: 'start' in uriParams ? uriParams.start : undefined\n          };\n        }\n\n        this.processInternalLink(link);\n      }\n    });\n\n    this.addAnchorListener<{\n      uriParams: {\n        domain: string,\n\n        // telegrampassport\n        scope?: string,\n        nonce?: string,\n        payload?: string,\n        bot_id?: string,\n        public_key?: string,\n        callback_url?: string,\n\n        // regular\n        start?: string,\n        startgroup?: string,\n        game?: string,\n        voicechat?: string,\n        post?: string,\n        thread?: string,\n        comment?: string,\n        phone?: string\n      }\n    }>({\n      name: 'resolve',\n      protocol: 'tg',\n      callback: ({uriParams}) => {\n        let link: InternalLink;\n        if(uriParams.phone) {\n          link = this.makeLink(INTERNAL_LINK_TYPE.USER_PHONE_NUMBER, uriParams as Required<typeof uriParams>);\n        } else if(uriParams.domain === 'telegrampassport') {\n\n        } else {\n          link = this.makeLink(INTERNAL_LINK_TYPE.MESSAGE, uriParams);\n        }\n\n        this.processInternalLink(link);\n      }\n    });\n\n    this.addAnchorListener<{\n      uriParams: {\n        channel: string,\n        post: string,\n        thread?: string,\n        comment?: string\n      }\n    }>({\n      name: 'privatepost',\n      protocol: 'tg',\n      callback: ({uriParams}) => {\n        const link = this.makeLink(INTERNAL_LINK_TYPE.PRIVATE_POST, uriParams);\n        this.processInternalLink(link);\n      }\n    });\n\n    this.addAnchorListener<{\n      uriParams: {\n        set: string\n      }\n    }>({\n      name: 'addstickers',\n      protocol: 'tg',\n      callback: ({uriParams}) => {\n        const link = this.makeLink(INTERNAL_LINK_TYPE.STICKER_SET, uriParams);\n        this.processInternalLink(link);\n      }\n    });\n\n    this.addAnchorListener<{\n      uriParams: {\n        slug: string\n      }\n    }>({\n      name: 'invoice',\n      protocol: 'tg',\n      callback: ({uriParams}) => {\n        const link = this.makeLink(INTERNAL_LINK_TYPE.INVOICE, uriParams);\n        this.processInternalLink(link);\n      }\n    });\n\n    ['joinchat' as const, 'join' as const].forEach((name) => {\n      this.addAnchorListener<{\n        uriParams: {\n          invite: string\n        }\n      }>({\n        name,\n        protocol: 'tg',\n        callback: ({uriParams}) => {\n          const link = this.makeLink(INTERNAL_LINK_TYPE.JOIN_CHAT, uriParams);\n          this.processInternalLink(link);\n        }\n      });\n    });\n\n    this.onHashChange(true);\n    this.attachKeydownListener();\n  }\n\n  private deleteFilesIterative(callback: (response: Response) => boolean) {\n    return this.cacheStorage.timeoutOperation((cache) => {\n      const perf = performance.now();\n      return cache.keys().then((requests) => {\n        const promises = requests.map((request) => {\n          return cache.match(request).then((response) => {\n            return callback(response);\n          });\n        });\n\n        return Promise.all(promises).then((values) => {\n          values.map((isBad, idx) => {\n            if(!isBad) {\n              return;\n            }\n\n            const request = requests[idx];\n            return cache.delete(request);\n          });\n\n          return Promise.all(values.filter(Boolean));\n        });\n      }).then(() => {\n        this.log('deleted files', performance.now() - perf);\n      });\n    });\n  }\n\n  private toggleChatGradientAnimation(activatingChat: Chat) {\n    this.chats.forEach((chat) => {\n      if(chat.gradientRenderer) {\n        chat.gradientRenderer.scrollAnimate(rootScope.settings.animationsEnabled && chat === activatingChat);\n      }\n    });\n  }\n\n  private appendEmojiAnimationContainer(screen: ScreenSize) {\n    const appendTo = screen === ScreenSize.mobile ? this.columnEl : document.body;\n    if(this.emojiAnimationContainer.parentElement !== appendTo) {\n      appendTo.append(this.emojiAnimationContainer)\n    }\n  }\n\n  private attachKeydownListener() {\n    const IGNORE_KEYS = new Set(['PageUp', 'PageDown', 'Meta', 'Control']);\n    const onKeyDown = (e: KeyboardEvent) => {\n      const key = e.key;\n      if(overlayCounter.isOverlayActive || IGNORE_KEYS.has(key)) return;\n\n      const target = e.target as HTMLElement;\n\n      // if(target.tagName === 'INPUT') return;\n\n      // this.log('onkeydown', e, document.activeElement);\n\n      const chat = this.chat;\n\n      if(e.code === 'KeyC' && (e.ctrlKey || e.metaKey) && target.tagName !== 'INPUT') {\n        return;\n      } else if(e.altKey && (key === 'ArrowUp' || key === 'ArrowDown')) {\n        cancelEvent(e);\n        this.managers.dialogsStorage.getNextDialog(this.chat.peerId, key === 'ArrowDown', appDialogsManager.filterId).then((dialog) => {\n          if(dialog) {\n            this.setPeer({peerId: dialog.peerId});\n          }\n        });\n      } else if(key === 'ArrowUp' && this.chat.type !== 'scheduled') {\n        if(!chat.input.editMsgId && chat.input.isInputEmpty()) {\n          this.managers.appMessagesManager.getFirstMessageToEdit(chat.peerId, chat.threadId).then((message) => {\n            if(message) {\n              chat.input.initMessageEditing(message.mid);\n              cancelEvent(e); // * prevent from scrolling\n            }\n          });\n        } else {\n          return;\n        }\n      } else if(key === 'ArrowDown') {\n        return;\n      }\n\n      if(\n        chat?.input?.messageInput &&\n        e.target !== chat.input.messageInput &&\n        target.tagName !== 'INPUT' &&\n        !target.hasAttribute('contenteditable') &&\n        !IS_TOUCH_SUPPORTED &&\n        (!mediaSizes.isMobile || this.tabId === 1) &&\n        !chat.selection.isSelecting &&\n        !chat.input.recording\n      ) {\n        chat.input.messageInput.focus();\n        placeCaretAtEnd(chat.input.messageInput);\n\n        // clone and dispatch same event to new input. it is needed for sending message if input was blurred\n        const newEvent = new KeyboardEvent(e.type, e);\n        chat.input.messageInput.dispatchEvent(newEvent);\n      }\n    };\n\n    document.body.addEventListener('keydown', onKeyDown);\n  }\n\n  private makeLink<T extends INTERNAL_LINK_TYPE>(type: T, uriParams: Omit<InternalLinkTypeMap[T], '_'>) {\n    return {\n      _: type,\n      ...uriParams\n    } as any as InternalLinkTypeMap[T];\n  }\n\n  public async processInternalLink(link: InternalLink) {\n    switch(link?._) {\n      case INTERNAL_LINK_TYPE.MESSAGE: {\n        const postId = link.post ? generateMessageId(+link.post) : undefined;\n        const commentId = link.comment ? generateMessageId(+link.comment) : undefined;\n\n        this.openUsername({\n          userName: link.domain,\n          lastMsgId: postId,\n          commentId,\n          startParam: link.start\n        });\n        break;\n      }\n\n      case INTERNAL_LINK_TYPE.PRIVATE_POST: {\n        const chatId = link.channel.toChatId();\n        const peerId = chatId.toPeerId(true);\n\n        const chat = await this.managers.appChatsManager.getChat(chatId);\n        if(chat.deleted) {\n          try {\n            await this.managers.appChatsManager.resolveChannel(chatId);\n          } catch(err) {\n            toastNew({langPackKey: 'LinkNotFound'});\n            throw err;\n          }\n        }\n\n        const postId = generateMessageId(+link.post);\n        const threadId = link.thread ? generateMessageId(+link.thread) : undefined;\n\n        if(threadId) this.openThread(peerId, postId, threadId);\n        else this.setInnerPeer({\n          peerId,\n          lastMsgId: postId,\n          threadId\n        });\n        break;\n      }\n\n      case INTERNAL_LINK_TYPE.STICKER_SET: {\n        new PopupStickers({id: link.set}).show();\n        break;\n      }\n\n      case INTERNAL_LINK_TYPE.JOIN_CHAT: {\n        this.managers.appChatsManager.checkChatInvite(link.invite).then((chatInvite) => {\n          if((chatInvite as ChatInvite.chatInvitePeek).chat) {\n            this.managers.appChatsManager.saveApiChat((chatInvite as ChatInvite.chatInvitePeek).chat, true);\n          }\n\n          // console.log(chatInvite);\n\n          if(chatInvite._ === 'chatInviteAlready' ||\n            chatInvite._ === 'chatInvitePeek'/*  && chatInvite.expires > tsNow(true) */) {\n            this.setInnerPeer({\n              peerId: chatInvite.chat.id.toPeerId(true)\n            });\n            return;\n          }\n\n          new PopupJoinChatInvite(link.invite, chatInvite);\n        }, (err) => {\n          if(err.type === 'INVITE_HASH_EXPIRED') {\n            toast(i18n('InviteExpired'));\n          }\n        });\n        break;\n      }\n\n      case INTERNAL_LINK_TYPE.VOICE_CHAT: {\n        if(IS_GROUP_CALL_SUPPORTED) {\n          this.joinGroupCall(link.chat_id.toPeerId(true), link.id);\n        }\n\n        break;\n      }\n\n      case INTERNAL_LINK_TYPE.USER_PHONE_NUMBER: {\n        this.managers.appUsersManager.resolvePhone(link.phone).then((user) => {\n          this.setInnerPeer({\n            peerId: user.id.toPeerId(false)\n          });\n        }).catch((err) => {\n          if(err.type === 'PHONE_NOT_OCCUPIED') {\n            toastNew({langPackKey: 'Alert.UserDoesntExists'});\n          }\n        });\n\n        break;\n      }\n\n      case INTERNAL_LINK_TYPE.INVOICE: {\n        this.managers.appPaymentsManager.getInputInvoiceBySlug(link.slug).then((inputInvoice) => {\n          this.managers.appPaymentsManager.getPaymentForm(inputInvoice).then((paymentForm) => {\n            // const message: Message.message = {\n            //   _: 'message',\n            //   date: 0,\n            //   id: 0,\n            //   peerId: 0,\n            //   peer_id: undefined,\n            //   message: '',\n            //   media: {\n            //     _: 'messageMediaInvoice',\n            //     currency: paymentForm.invoice.currency,\n            //     description: paymentForm.description,\n\n            //   }\n            // };\n            new PopupPayment(undefined, inputInvoice, paymentForm);\n          });\n        });\n        break;\n      }\n\n      default: {\n        this.log.warn('Not supported internal link:', link);\n        break;\n      }\n    }\n  }\n\n  public openUrl(url: string) {\n    const {url: wrappedUrl, onclick} = wrapUrl(url);\n    const a = document.createElement('a');\n    a.href = wrappedUrl;\n\n    (window as any)[onclick](a);\n  }\n\n  private addAnchorListener<Params extends {pathnameParams?: any, uriParams?: any}>(options: {\n    name: 'showMaskedAlert' | 'execBotCommand' | 'searchByHashtag' | 'addstickers' | 'im' |\n          'resolve' | 'privatepost' | 'addstickers' | 'voicechat' | 'joinchat' | 'join' | 'invoice',\n    protocol?: 'tg',\n    callback: (params: Params, element?: HTMLAnchorElement) => boolean | any,\n    noPathnameParams?: boolean,\n    noUriParams?: boolean\n  }) {\n    (window as any)[(options.protocol ? options.protocol + '_' : '') + options.name] = (element?: HTMLAnchorElement/* , e: Event */) => {\n      cancelEvent(null);\n\n      const href = element.href;\n      let pathnameParams: any[];\n      let uriParams: any;\n\n      if(!options.noPathnameParams) pathnameParams = new URL(element.href).pathname.split('/').slice(1);\n      if(!options.noUriParams) uriParams = this.parseUriParams(href);\n\n      const res = options.callback({pathnameParams, uriParams} as Params, element);\n      return res === undefined ? res : false;\n    };\n  }\n\n  private parseUriParams(uri: string, splitted = uri.split('?')) {\n    const params: any = {};\n    if(!splitted[1]) return params;\n    splitted[1].split('&').forEach((item) => {\n      params[item.split('=')[0]] = decodeURIComponent(item.split('=')[1]);\n    });\n\n    return params;\n  }\n\n  private onHashChange = (saveState?: boolean) => {\n    const hash = location.hash;\n    if(!saveState) {\n      appNavigationController.replaceState();\n    }\n\n    const splitted = hash.split('?');\n    const params = this.parseUriParams(hash, splitted);\n    this.log('hashchange', hash, splitted[0], params);\n    if(!hash) {\n      return;\n    }\n\n    if(params.tgaddr) {\n      const {onclick} = wrapUrl(params.tgaddr);\n      if(onclick) {\n        const a = document.createElement('a');\n        a.href = params.tgaddr;\n        (window as any)[onclick](a);\n      }\n      return;\n    }\n\n    switch(splitted[0]) {\n      default: {\n        params.p = splitted[0].slice(1);\n      }\n\n      case '#/im': {\n        const p: string = params.p;\n        const postId = params.post !== undefined ? generateMessageId(+params.post) : undefined;\n\n        switch(p[0]) {\n          case '@': {\n            this.openUsername({\n              userName: p,\n              lastMsgId: postId\n            });\n            break;\n          }\n\n          default: { // peerId\n            this.setInnerPeer({\n              peerId: postId ? p.toPeerId(true) : p.toPeerId(),\n              lastMsgId: postId\n            });\n            break;\n          }\n        }\n      }\n    }\n\n    // appNavigationController.replaceState();\n    // location.hash = '';\n  };\n\n  public openUsername(options: {\n    userName: string,\n    lastMsgId?: number,\n    threadId?: number,\n    commentId?: number,\n    startParam?: string\n  }) {\n    const {userName, lastMsgId, threadId, commentId, startParam} = options;\n    return this.managers.appUsersManager.resolveUsername(userName).then((peer) => {\n      const isUser = peer._ === 'user';\n      const peerId = peer.id.toPeerId(!isUser);\n\n      if(threadId) {\n        return this.openThread(peerId, lastMsgId, threadId);\n      } else if(commentId) {\n        return this.openComment(peerId, lastMsgId, commentId);\n      }\n\n      return this.setInnerPeer({\n        peerId,\n        lastMsgId,\n        startParam: startParam\n      });\n    }, (err) => {\n      if(err.type === 'USERNAME_NOT_OCCUPIED') {\n        toastNew({langPackKey: 'NoUsernameFound'});\n      } else if(err.type === 'USERNAME_INVALID') {\n        toastNew({langPackKey: 'Alert.UserDoesntExists'});\n      }\n    });\n  }\n\n  /**\n   * Opens thread when peerId of discussion group is known\n   */\n  public openThread(peerId: PeerId, lastMsgId: number, threadId: number) {\n    return this.managers.appMessagesManager.wrapSingleMessage(peerId, threadId).then((message) => {\n      // const message: Message = this.managers.appMessagesManager.getMessageByPeer(peerId, threadId);\n      if(!message) {\n        lastMsgId = undefined;\n      } else {\n        this.managers.appMessagesManager.generateThreadServiceStartMessage(message);\n      }\n\n      return this.setInnerPeer({\n        peerId,\n        lastMsgId,\n        threadId,\n        type: 'discussion'\n      });\n    });\n  }\n\n  /**\n   * Opens comment directly from original channel\n   */\n  public openComment(peerId: PeerId, msgId: number, commentId: number) {\n    return this.managers.appMessagesManager.getDiscussionMessage(peerId, msgId).then((message) => {\n      return this.openThread(message.peerId, commentId, message.mid);\n    });\n  }\n\n  public async callUser(userId: UserId, type: CallType) {\n    const call = callsController.getCallByUserId(userId);\n    if(call) {\n      return;\n    }\n\n    const userFull = await this.managers.appProfileManager.getProfile(userId);\n    if(userFull.pFlags.phone_calls_private) {\n      confirmationPopup({\n        descriptionLangKey: 'Call.PrivacyErrorMessage',\n        descriptionLangArgs: [new PeerTitle({peerId: userId.toPeerId()}).element],\n        button: {\n          langKey: 'OK',\n          isCancel: true\n        }\n      });\n\n      return;\n    }\n\n    await this.discardCurrentCall(userId.toPeerId());\n\n    callsController.startCallInternal(userId, type === 'video');\n  }\n\n  private discardCurrentCall(toPeerId: PeerId, ignoreGroupCall?: GroupCallInstance, ignoreCall?: CallInstance) {\n    if(groupCallsController.groupCall && groupCallsController.groupCall !== ignoreGroupCall) return this.discardGroupCallConfirmation(toPeerId);\n    else if(callsController.currentCall && callsController.currentCall !== ignoreCall) return this.discardCallConfirmation(toPeerId);\n    else return Promise.resolve();\n  }\n\n  private async discardCallConfirmation(toPeerId: PeerId) {\n    const currentCall = callsController.currentCall;\n    if(currentCall) {\n      await confirmationPopup({\n        titleLangKey: 'Call.Confirm.Discard.Call.Header',\n        descriptionLangKey: toPeerId.isUser() ? 'Call.Confirm.Discard.Call.ToCall.Text' : 'Call.Confirm.Discard.Call.ToVoice.Text',\n        descriptionLangArgs: [\n          new PeerTitle({peerId: currentCall.interlocutorUserId.toPeerId(false)}).element,\n          new PeerTitle({peerId: toPeerId}).element\n        ],\n        button: {\n          langKey: 'OK'\n        }\n      });\n\n      if(!currentCall.isClosing) {\n        await currentCall.hangUp('phoneCallDiscardReasonDisconnect');\n      }\n    }\n  }\n\n  private async discardGroupCallConfirmation(toPeerId: PeerId) {\n    const currentGroupCall = groupCallsController.groupCall;\n    if(currentGroupCall) {\n      await confirmationPopup({\n        titleLangKey: 'Call.Confirm.Discard.Voice.Header',\n        descriptionLangKey: toPeerId.isUser() ? 'Call.Confirm.Discard.Voice.ToCall.Text' : 'Call.Confirm.Discard.Voice.ToVoice.Text',\n        descriptionLangArgs: [\n          new PeerTitle({peerId: currentGroupCall.chatId.toPeerId(true)}).element,\n          new PeerTitle({peerId: toPeerId}).element\n        ],\n        button: {\n          langKey: 'OK'\n        }\n      });\n\n      if(groupCallsController.groupCall === currentGroupCall) {\n        await currentGroupCall.hangUp();\n      }\n    }\n  }\n\n  public async joinGroupCall(peerId: PeerId, groupCallId?: GroupCallId) {\n    const chatId = peerId.toChatId();\n    const hasRights = this.managers.appChatsManager.hasRights(chatId, 'manage_call');\n    const next = async() => {\n      const chatFull = await this.managers.appProfileManager.getChatFull(chatId);\n      let call: MyGroupCall;\n      if(!chatFull.call) {\n        if(!hasRights) {\n          return;\n        }\n\n        call = await this.managers.appGroupCallsManager.createGroupCall(chatId);\n      } else {\n        call = chatFull.call;\n      }\n\n      groupCallsController.joinGroupCall(chatId, call.id, true, false);\n    };\n\n    if(groupCallId) {\n      const groupCall = await this.managers.appGroupCallsManager.getGroupCallFull(groupCallId);\n      if(groupCall._ === 'groupCallDiscarded') {\n        if(!hasRights) {\n          toastNew({\n            langPackKey: 'VoiceChat.Chat.Ended'\n          });\n\n          return;\n        }\n\n        await confirmationPopup({\n          descriptionLangKey: 'VoiceChat.Chat.StartNew',\n          button: {\n            langKey: 'VoiceChat.Chat.StartNew.OK'\n          }\n        });\n      }\n    }\n\n    // await this.discardCurrentCall(peerId);\n\n    next();\n  };\n\n  public setCurrentBackground(broadcastEvent = false): ReturnType<AppImManager['setBackground']> {\n    const theme = themeController.getTheme();\n\n    if(theme.background.slug) {\n      const defaultTheme = STATE_INIT.settings.themes.find((t) => t.name === theme.name);\n      // const isDefaultBackground = theme.background.blur === defaultTheme.background.blur &&\n      // theme.background.slug === defaultTheme.background.slug;\n\n      // if(!isDefaultBackground) {\n      return this.getBackground(theme.background.slug).then((url) => {\n        return this.setBackground(url, broadcastEvent);\n      }, () => { // * if NO_ENTRY_FOUND\n        theme.background = copy(defaultTheme.background); // * reset background\n        return this.setCurrentBackground(true);\n      });\n      // }\n    }\n\n    return this.setBackground('', broadcastEvent);\n  }\n\n  private getBackground(slug: string) {\n    if(this.backgroundPromises[slug]) return this.backgroundPromises[slug];\n    return this.backgroundPromises[slug] = this.cacheStorage.getFile('backgrounds/' + slug).then((blob) => {\n      return URL.createObjectURL(blob);\n    });\n  }\n\n  public setBackground(url: string, broadcastEvent = true): Promise<void> {\n    this.lastBackgroundUrl = url;\n    const promises = this.chats.map((chat) => chat.setBackground(url));\n    return promises[promises.length - 1].then(() => {\n      if(broadcastEvent) {\n        rootScope.dispatchEvent('background_change');\n      }\n    });\n  }\n\n  public saveChatPosition(chat: Chat) {\n    if(!(['chat', 'discussion'] as ChatType[]).includes(chat.type) || !chat.peerId) {\n      return;\n    }\n\n    // const bubble = chat.bubbles.getBubbleByPoint('top');\n    // if(bubble) {\n    // const top = bubble.getBoundingClientRect().top;\n    const chatBubbles = chat.bubbles;\n    const key = chat.peerId + (chat.threadId ? '_' + chat.threadId : '');\n    const chatPositions = stateStorage.getFromCache('chatPositions');\n    if(!(chatBubbles.scrollable.getDistanceToEnd() <= 16 && chatBubbles.scrollable.loadedAll.bottom) && chatBubbles.getRenderedLength()) {\n      chatBubbles.sliceViewport(true);\n      const top = chatBubbles.scrollable.scrollTop;\n\n      const position = {\n        mids: getObjectKeysAndSort(chatBubbles.bubbles, 'desc').filter((mid) => !chatBubbles.skippedMids.has(mid)),\n        top\n      };\n\n      chatPositions[key] = position;\n\n      this.log('saved chat position:', position);\n    } else {\n      delete chatPositions[key];\n\n      this.log('deleted chat position');\n    }\n\n    stateStorage.set({chatPositions}, true);\n    // }\n  }\n\n  public getChatSavedPosition(chat: Chat): ChatSavedPosition {\n    if(!(['chat', 'discussion'] as ChatType[]).includes(chat.type) || !chat.peerId) {\n      return;\n    }\n\n    const key = chat.peerId + (chat.threadId ? '_' + chat.threadId : '');\n    const cache = stateStorage.getFromCache('chatPositions');\n    return cache && cache[key];\n  }\n\n  public applyCurrentTheme(slug?: string, backgroundUrl?: string, broadcastEvent?: boolean) {\n    if(backgroundUrl) {\n      this.backgroundPromises[slug] = Promise.resolve(backgroundUrl);\n    }\n\n    themeController.setTheme();\n\n    return this.setCurrentBackground(broadcastEvent === undefined ? !!slug : broadcastEvent);\n  }\n\n  private setSettings = () => {\n    document.documentElement.style.setProperty('--messages-text-size', rootScope.settings.messagesTextSize + 'px');\n\n    document.body.classList.toggle('animation-level-0', !rootScope.settings.animationsEnabled);\n    document.body.classList.toggle('animation-level-1', false);\n    document.body.classList.toggle('animation-level-2', rootScope.settings.animationsEnabled);\n\n    this.chatsSelectTabDebounced = debounce(() => {\n      const topbar = this.chat.topbar;\n      if(topbar.pinnedMessage) { // *   ,     ,       \n        topbar.pinnedMessage.setCorrectIndex(0);\n      }\n\n      this.managers.apiFileManager.setQueueId(this.chat.bubbles.lazyLoadQueue.queueId);\n    }, rootScope.settings.animationsEnabled ? 250 : 0, false, true);\n\n    lottieLoader.setLoop(rootScope.settings.stickers.loop);\n    animationIntersector.checkAnimations(false);\n\n    for(const chat of this.chats) {\n      chat.setAutoDownloadMedia();\n    }\n\n    I18n.setTimeFormat(rootScope.settings.timeFormat);\n\n    this.toggleChatGradientAnimation(this.chat);\n  };\n\n  // *     TransitionSlider,       \n  // * (   )     (. scrollTop)\n  private chatsSelectTab(tab: HTMLElement, animate?: boolean) {\n    if(this.prevTab === tab) {\n      return;\n    }\n\n    if(animate === false && this.prevTab) { // * will be used for Safari iOS history swipe\n      disableTransition([tab, this.prevTab].filter(Boolean));\n    }\n\n    if(this.prevTab) {\n      this.prevTab.classList.remove('active');\n      this.chatsSelectTabDebounced();\n\n      // !    animation,         250\n      if(rootScope.settings.animationsEnabled && animate !== false) {\n        dispatchHeavyAnimationEvent(pause(250 + 150), 250 + 150);\n      }\n\n      const prevIdx = whichChild(this.prevTab);\n      const idx = whichChild(tab);\n      if(idx > prevIdx) {\n        appNavigationController.pushItem({\n          type: 'chat',\n          onPop: (canAnimate) => {\n            this.setPeer({}, canAnimate);\n            blurActiveElement();\n          }\n        });\n      }\n    }\n\n    tab.classList.add('active');\n    this.prevTab = tab;\n  }\n\n  private init() {\n    document.addEventListener('paste', this.onDocumentPaste, true);\n\n    if(!IS_TOUCH_SUPPORTED) {\n      this.attachDragAndDropListeners();\n    }\n\n    // if(!isTouchSupported) {\n    this.markupTooltip = new MarkupTooltip(this);\n    this.markupTooltip.handleSelection();\n    // }\n  }\n\n  private attachDragAndDropListeners() {\n    const drops: ChatDragAndDrop[] = [];\n    const mediaDrops: ChatDragAndDrop[] = [];\n    let mounted = false;\n    const toggle = async(e: DragEvent, mount: boolean) => {\n      if(mount === mounted) return;\n\n      const _types = e.dataTransfer.types;\n      // @ts-ignore\n      const isFiles = _types.contains ? _types.contains('Files') : _types.indexOf('Files') >= 0;\n\n      const newMediaPopup = getCurrentNewMediaPopup();\n      const types: string[] = await getFilesFromEvent(e, true);\n      if(!isFiles || (!(await this.canDrag()) && !newMediaPopup)) { // * skip dragging text case\n        counter = 0;\n        return;\n      }\n\n      const _dropsContainer = newMediaPopup ? mediaDropsContainer : dropsContainer;\n      const _drops = newMediaPopup ? mediaDrops : drops;\n\n      if(mount && !_drops.length) {\n        const force = isFiles && !types.length; // * can't get file items not from 'drop' on Safari\n\n        const foundMedia = types.filter((t) => MEDIA_MIME_TYPES_SUPPORTED.has(t)).length;\n        // const foundDocuments = types.length - foundMedia;\n\n        this.log('drag files', types);\n\n        if(newMediaPopup) {\n          newMediaPopup.appendDrops(_dropsContainer);\n\n          if(types.length || force) {\n            _drops.push(new ChatDragAndDrop(_dropsContainer, {\n              header: 'Preview.Dragging.AddItems',\n              headerArgs: [types.length],\n              onDrop: (e: DragEvent) => {\n                toggle(e, false);\n                this.log('drop', e);\n                this.onDocumentPaste(e, 'document');\n              }\n            }));\n          }\n        } else {\n          if(types.length || force) {\n            _drops.push(new ChatDragAndDrop(_dropsContainer, {\n              icon: 'dragfiles',\n              header: 'Chat.DropTitle',\n              subtitle: 'Chat.DropAsFilesDesc',\n              onDrop: (e: DragEvent) => {\n                toggle(e, false);\n                this.log('drop', e);\n                this.onDocumentPaste(e, 'document');\n              }\n            }));\n          }\n\n          // if((foundMedia && !foundDocuments) || force) {\n          if(foundMedia || force) {\n            _drops.push(new ChatDragAndDrop(_dropsContainer, {\n              icon: 'dragmedia',\n              header: 'Chat.DropTitle',\n              subtitle: 'Chat.DropQuickDesc',\n              onDrop: (e: DragEvent) => {\n                toggle(e, false);\n                this.log('drop', e);\n                this.onDocumentPaste(e, 'media');\n              }\n            }));\n          }\n\n          this.chat.container.append(_dropsContainer);\n        }\n      }\n\n      // if(!mount) return;\n\n      SetTransition(_dropsContainer, 'is-visible', mount, 200, () => {\n        if(!mount) {\n          _drops.forEach((drop) => {\n            drop.destroy();\n          });\n\n          _drops.length = 0;\n        }\n      });\n\n      if(mount) {\n        _drops.forEach((drop) => {\n          drop.setPath();\n        });\n      } else {\n        counter = 0;\n      }\n\n      document.body.classList.toggle('is-dragging', mount);\n      mounted = mount;\n    };\n\n    /* document.body.addEventListener('dragover', (e) => {\n      cancelEvent(e);\n    }); */\n\n    let counter = 0;\n    document.body.addEventListener('dragenter', (e) => {\n      counter++;\n    });\n\n    document.body.addEventListener('dragover', (e) => {\n      // this.log('dragover', e/* , e.dataTransfer.types[0] */);\n      toggle(e, true);\n      cancelEvent(e);\n    });\n\n    document.body.addEventListener('dragleave', (e) => {\n      // this.log('dragleave', e, counter);\n      // if((e.pageX <= 0 || e.pageX >= this.managers.appPhotosManager.windowW) || (e.pageY <= 0 || e.pageY >= this.managers.appPhotosManager.windowH)) {\n      counter--;\n      if(counter === 0) {\n      // if(!findUpClassName(e.target, 'drops-container')) {\n        toggle(e, false);\n      }\n    });\n\n    const dropsContainer = document.createElement('div');\n    dropsContainer.classList.add('drops-container');\n\n    const mediaDropsContainer = dropsContainer.cloneNode(true) as HTMLElement;\n  }\n\n  private async canDrag() {\n    const chat = this.chat;\n    const peerId = chat?.peerId;\n    return !(!peerId || overlayCounter.isOverlayActive || !(await chat.canSend('send_media')));\n  }\n\n  private onDocumentPaste = async(e: ClipboardEvent | DragEvent, attachType?: 'media' | 'document') => {\n    const newMediaPopup = getCurrentNewMediaPopup();\n\n    // console.log('document paste');\n    // console.log('item', event.clipboardData.getData());\n\n    if(e instanceof DragEvent) {\n      const _types = e.dataTransfer.types;\n      // @ts-ignore\n      const isFiles = _types.contains ? _types.contains('Files') : _types.indexOf('Files') >= 0;\n      if(isFiles) {\n        cancelEvent(e);\n      }\n    }\n\n    const files = await getFilesFromEvent(e);\n    if(!(await this.canDrag()) && !newMediaPopup) return;\n    if(files.length) {\n      if(newMediaPopup) {\n        newMediaPopup.addFiles(files);\n        return;\n      }\n\n      const chatInput = this.chat.input;\n      chatInput.willAttachType = attachType || (MEDIA_MIME_TYPES_SUPPORTED.has(files[0].type) ? 'media' : 'document');\n      PopupElement.createPopup(PopupNewMedia, this.chat, files, chatInput.willAttachType);\n    }\n  };\n\n  private async overrideHash(peerId?: PeerId) {\n    let str: string;\n    if(peerId) {\n      const username = await this.managers.appPeersManager.getPeerUsername(peerId);\n      str = username ? '@' + username : '' + peerId;\n    }\n\n    appNavigationController.overrideHash(str);\n  }\n\n  public selectTab(id: number, animate?: boolean) {\n    if(animate === false) { // * will be used for Safari iOS history swipe\n      disableTransition([appSidebarLeft.sidebarEl, this.columnEl, appSidebarRight.sidebarEl]);\n    }\n\n    document.body.classList.toggle(LEFT_COLUMN_ACTIVE_CLASSNAME, id === 0);\n\n    const prevTabId = this.tabId;\n    if(prevTabId !== -1) {\n      this.overrideHash(id > 0 ? this.chat?.peerId : undefined);\n    }\n\n    this.log('selectTab', id, prevTabId);\n\n    let animationPromise: Promise<any> = rootScope.settings.animationsEnabled ? doubleRaf() : Promise.resolve();\n    if(prevTabId !== -1 && prevTabId !== id && rootScope.settings.animationsEnabled && animate !== false && mediaSizes.activeScreen !== ScreenSize.large) {\n      const transitionTime = (mediaSizes.isMobile ? 250 : 200) + 100; // * cause transition time could be > 250ms\n      animationPromise = pause(transitionTime);\n      dispatchHeavyAnimationEvent(animationPromise, transitionTime);\n\n      // ! it's very heavy operation. will blink in firefox\n      /* this.columnEl.classList.add('disable-hover');\n      animationPromise.finally(() => {\n        this.columnEl.classList.remove('disable-hover');\n      }); */\n    }\n\n    this.tabId = id;\n    blurActiveElement();\n    if(mediaSizes.isMobile && prevTabId === 2 && id < 2) {\n      document.body.classList.remove(RIGHT_COLUMN_ACTIVE_CLASSNAME);\n    }\n\n    if(prevTabId !== -1 && id > prevTabId) {\n      if(id < 2 || !appNavigationController.findItemByType('im')) {\n        appNavigationController.pushItem({\n          type: 'im',\n          onPop: (canAnimate) => {\n            // this.selectTab(prevTabId, !isSafari);\n            this.setPeer({}, canAnimate);\n          }\n        });\n      }\n    }\n\n    const onImTabChange = (window as any).onImTabChange;\n    onImTabChange && onImTabChange(id);\n\n    // this._selectTab(id, mediaSizes.isMobile);\n    // document.body.classList.toggle(RIGHT_COLUMN_ACTIVE_CLASSNAME, id === 2);\n\n    return animationPromise;\n  }\n\n  public updateStatus() {\n    return this.managers.appUsersManager.updateMyOnlineStatus(this.offline);\n  }\n\n  private createNewChat() {\n    const chat = new Chat(\n      this,\n      this.managers\n    );\n\n    if(this.chats.length) {\n      chat.setBackground(this.lastBackgroundUrl, true);\n    }\n\n    this.chats.push(chat);\n\n    return chat;\n  }\n\n  private spliceChats(fromIndex: number, justReturn = true, animate?: boolean, spliced?: Chat[]) {\n    if(fromIndex >= this.chats.length) return;\n\n    const chatFrom = this.chat;\n    if(this.chats.length > 1 && justReturn) {\n      this.dispatchEvent('peer_changing', this.chat);\n    }\n\n    if(!spliced) {\n      spliced = this.chats.splice(fromIndex, this.chats.length - fromIndex);\n    }\n\n    const chatTo = this.chat;\n    this.dispatchEvent('chat_changing', {from: chatFrom, to: chatTo});\n\n    // * -1 because one item is being sliced when closing the chat by calling .removeByType\n    for(let i = 0; i < spliced.length - 1; ++i) {\n      appNavigationController.removeByType('chat', true);\n    }\n\n    // * fix middle chat z-index on animation\n    if(spliced.length > 1) {\n      spliced.slice(0, -1).forEach((chat) => {\n        chat.container.remove();\n      });\n    }\n\n    this.chatsSelectTab(chatTo.container, animate);\n\n    if(justReturn) {\n      this.dispatchEvent('peer_changed', chatTo.peerId);\n\n      const searchTab = appSidebarRight.getTab(AppPrivateSearchTab);\n      if(searchTab) {\n        searchTab.close();\n      }\n\n      appSidebarRight.replaceSharedMediaTab(chatTo.sharedMediaTab);\n    }\n\n    spliced.forEach((chat) => {\n      chat.beforeDestroy();\n    });\n\n    setTimeout(() => {\n      // chat.setPeer(0);\n      spliced.forEach((chat) => {\n        chat.destroy();\n      });\n    }, 250 + 100);\n  }\n\n  public async setPeer(options: ChatSetPeerOptions = {}, animate?: boolean): Promise<boolean> {\n    if(this.init) {\n      this.init();\n      this.init = null;\n    }\n\n    options.peerId ??= NULL_PEER_ID;\n\n    const {peerId, lastMsgId} = options;\n\n    const chat = this.chat;\n    const chatIndex = this.chats.indexOf(chat);\n\n    if(!peerId) {\n      if(chatIndex > 0) {\n        this.spliceChats(chatIndex, undefined, animate);\n        return;\n      } else if(mediaSizes.activeScreen === ScreenSize.medium) { // * floating sidebar case\n        this.selectTab(+!this.tabId, animate);\n        return;\n      }\n    } else if(chatIndex > 0 && chat.peerId && chat.peerId !== peerId) {\n      // const firstChat = this.chats[0];\n      // if(firstChat.peerId !== chat.peerId) {\n      /* // * slice idx > 0, set background and slice first, so new one will be the first\n        const spliced = this.chats.splice(1, this.chats.length - 1);\n        this.createNewChat();\n        this.chats.splice(0, 1); */\n      const spliced = this.chats.splice(1, this.chats.length - 1);\n      if(this.chat.peerId === peerId) {\n        this.spliceChats(0, true, true, spliced);\n        return;\n      } else {\n        const ret = this.setPeer(options);\n        this.spliceChats(0, false, false, spliced);\n        return ret;\n      }\n      // } else {\n      //   this.spliceChats(1, false, animate);\n      // }\n\n      // return ret;\n    }\n\n    // * don't reset peer if returning\n    if(peerId === chat.peerId && mediaSizes.activeScreen <= ScreenSize.medium && document.body.classList.contains(LEFT_COLUMN_ACTIVE_CLASSNAME)) {\n      this.selectTab(1, animate);\n      return false;\n    }\n\n    if(peerId || mediaSizes.activeScreen !== ScreenSize.mobile) {\n      const result = await chat.setPeer(peerId, lastMsgId, options.startParam);\n\n      // * wait for cached render\n      const promise = result?.cached ? result.promise : Promise.resolve();\n      if(peerId) {\n        Promise.all([\n          promise,\n          chat.setBackgroundPromise\n        ]).then(() => {\n          // window.requestAnimationFrame(() => {\n          setTimeout(() => { // * setTimeout is better here\n            setTimeout(() => {\n              this.chatsSelectTab(this.chat.container);\n            }, 0);\n            this.selectTab(1, animate);\n          }, 0);\n        });\n      }\n    }\n\n    if(!peerId) {\n      this.selectTab(0, animate);\n      return false;\n    }\n  }\n\n  public setInnerPeer(options: ChatSetInnerPeerOptions) {\n    const {peerId} = options;\n    if(peerId === NULL_PEER_ID || !peerId) {\n      return;\n    }\n\n    if(options.threadId) {\n      options.type = 'discussion';\n    }\n\n    const type = options.type ??= 'chat';\n\n    // * prevent opening already opened peer\n    const existingIndex = this.chats.findIndex((chat) => chat.peerId === peerId && chat.type === type);\n    if(existingIndex !== -1) {\n      this.spliceChats(existingIndex + 1);\n      return this.setPeer(options);\n    }\n\n    const oldChat = this.chat;\n    let chat = oldChat;\n    if(oldChat.inited) { // * use first not inited chat\n      chat = this.createNewChat();\n    }\n\n    if(type) {\n      chat.setType(type);\n\n      if(options.threadId) {\n        chat.threadId = options.threadId;\n      }\n    }\n\n    this.dispatchEvent('chat_changing', {from: oldChat, to: chat});\n\n    // this.chatsSelectTab(chat.container);\n\n    return this.setPeer(options);\n  }\n\n  public openScheduled(peerId: PeerId) {\n    this.setInnerPeer({\n      peerId,\n      type: 'scheduled'\n    });\n  }\n\n  private getTypingElement(action: SendMessageAction) {\n    const el = document.createElement('span');\n    let c = 'peer-typing';\n    el.classList.add(c);\n    el.dataset.action = action._;\n    switch(action._) {\n      case 'sendMessageTypingAction': {\n      // default: {\n        c += '-text';\n        for(let i = 0; i < 3; ++i) {\n          const dot = document.createElement('span');\n          dot.className = c + '-dot';\n          el.append(dot);\n        }\n        break;\n      }\n\n      case 'sendMessageUploadAudioAction':\n      case 'sendMessageUploadDocumentAction':\n      case 'sendMessageUploadRoundAction':\n      case 'sendMessageUploadVideoAction':\n      case 'sendMessageUploadPhotoAction': {\n        c += '-upload';\n        /* const trail = document.createElement('span');\n        trail.className = c + '-trail';\n        el.append(trail); */\n        break;\n      }\n\n      case 'sendMessageRecordAudioAction':\n      case 'sendMessageRecordRoundAction':\n      case 'sendMessageRecordVideoAction': {\n        c += '-record';\n        break;\n      }\n\n      case 'sendMessageEmojiInteractionSeen':\n      case 'sendMessageChooseStickerAction': {\n        c += '-choosing-sticker';\n        for(let i = 0; i < 2; ++i) {\n          const eye = document.createElement('div');\n          eye.className = c + '-eye';\n          el.append(eye);\n        }\n        break;\n      }\n    }\n\n    el.classList.add(c);\n\n    return el;\n  }\n\n  public async getPeerTyping(peerId: PeerId, container?: HTMLElement) {\n    // const log = this.log.bindPrefix('getPeerTyping-' + peerId);\n    // log('getting peer typing');\n\n    const isUser = peerId.isUser();\n    if(isUser && await this.managers.appUsersManager.isBot(peerId)) {\n      // log('a bot');\n      return;\n    }\n\n    const typings = await this.managers.appProfileManager.getPeerTypings(peerId);\n    if(!typings?.length) {\n      // log('have no typing');\n      return;\n    }\n\n    const typing = typings[0];\n\n    const langPackKeys: {\n      [peerType in 'private' | 'chat' | 'multi']?: Partial<{[action in SendMessageAction['_']]: LangPackKey}>\n    } = {\n      private: {\n        'sendMessageTypingAction': 'Peer.Activity.User.TypingText',\n        'sendMessageUploadAudioAction': 'Peer.Activity.User.SendingFile',\n        'sendMessageUploadDocumentAction': 'Peer.Activity.User.SendingFile',\n        'sendMessageUploadPhotoAction': 'Peer.Activity.User.SendingPhoto',\n        'sendMessageUploadVideoAction': 'Peer.Activity.User.SendingVideo',\n        'sendMessageUploadRoundAction': 'Peer.Activity.User.SendingVideo',\n        'sendMessageRecordVideoAction': 'Peer.Activity.User.RecordingVideo',\n        'sendMessageRecordAudioAction': 'Peer.Activity.User.RecordingAudio',\n        'sendMessageRecordRoundAction': 'Peer.Activity.User.RecordingVideo',\n        'sendMessageGamePlayAction': 'Peer.Activity.User.PlayingGame',\n        'sendMessageChooseStickerAction': 'Peer.Activity.User.ChoosingSticker',\n        'sendMessageEmojiInteractionSeen': 'Peer.Activity.User.EnjoyingAnimations'\n      },\n      chat: {\n        'sendMessageTypingAction': 'Peer.Activity.Chat.TypingText',\n        'sendMessageUploadAudioAction': 'Peer.Activity.Chat.SendingFile',\n        'sendMessageUploadDocumentAction': 'Peer.Activity.Chat.SendingFile',\n        'sendMessageUploadPhotoAction': 'Peer.Activity.Chat.SendingPhoto',\n        'sendMessageUploadVideoAction': 'Peer.Activity.Chat.SendingVideo',\n        'sendMessageUploadRoundAction': 'Peer.Activity.Chat.SendingVideo',\n        'sendMessageRecordVideoAction': 'Peer.Activity.Chat.RecordingVideo',\n        'sendMessageRecordAudioAction': 'Peer.Activity.Chat.RecordingAudio',\n        'sendMessageRecordRoundAction': 'Peer.Activity.Chat.RecordingVideo',\n        'sendMessageGamePlayAction': 'Peer.Activity.Chat.PlayingGame',\n        'sendMessageChooseStickerAction': 'Peer.Activity.Chat.ChoosingSticker',\n        'sendMessageEmojiInteractionSeen': 'Peer.Activity.Chat.EnjoyingAnimations'\n      },\n      multi: {\n        'sendMessageTypingAction': 'Peer.Activity.Chat.Multi.TypingText1',\n        'sendMessageUploadAudioAction': 'Peer.Activity.Chat.Multi.SendingFile1',\n        'sendMessageUploadDocumentAction': 'Peer.Activity.Chat.Multi.SendingFile1',\n        'sendMessageUploadPhotoAction': 'Peer.Activity.Chat.Multi.SendingPhoto1',\n        'sendMessageUploadVideoAction': 'Peer.Activity.Chat.Multi.SendingVideo1',\n        'sendMessageUploadRoundAction': 'Peer.Activity.Chat.Multi.SendingVideo1',\n        'sendMessageRecordVideoAction': 'Peer.Activity.Chat.Multi.RecordingVideo1',\n        'sendMessageRecordAudioAction': 'Peer.Activity.Chat.Multi.RecordingAudio1',\n        'sendMessageRecordRoundAction': 'Peer.Activity.Chat.Multi.RecordingVideo1',\n        'sendMessageGamePlayAction': 'Peer.Activity.Chat.Multi.PlayingGame1',\n        'sendMessageChooseStickerAction': 'Peer.Activity.Chat.Multi.ChoosingSticker1'\n      }\n    };\n\n    const mapa = isUser ? langPackKeys.private : (typings.length > 1 ? langPackKeys.multi : langPackKeys.chat);\n    let action = typing.action;\n\n    if(typings.length > 1) {\n      const s: any = {};\n      typings.forEach((typing) => {\n        const type = typing.action._;\n        if(s[type] === undefined) s[type] = 0;\n        ++s[type];\n      });\n\n      if(Object.keys(s).length > 1) {\n        action = {\n          _: 'sendMessageTypingAction'\n        };\n      }\n    }\n\n    const langPackKey = mapa[action._];\n    if(!langPackKey) {\n      // log('no langPackKey');\n      return;\n    }\n\n    let peerTitlePromise: Promise<any>;\n    let args: any[];\n    if(peerId.isAnyChat()) {\n      const peerTitle = new PeerTitle();\n      peerTitlePromise = peerTitle.update({peerId: typing.userId.toPeerId(false), onlyFirstName: true});\n      args = [\n        peerTitle.element,\n        typings.length - 1\n      ];\n\n      await peerTitlePromise;\n    }\n\n    if(!container) {\n      container = document.createElement('span');\n      container.classList.add('online', 'peer-typing-container');\n    }\n\n    container.classList.toggle('peer-typing-flex', action._ === 'sendMessageChooseStickerAction' || action._ === 'sendMessageEmojiInteractionSeen');\n\n    let typingElement = container.firstElementChild as HTMLElement;\n    if(!typingElement) {\n      typingElement = this.getTypingElement(action);\n      container.prepend(typingElement);\n    } else {\n      if(typingElement.dataset.action !== action._) {\n        typingElement.replaceWith(this.getTypingElement(action));\n      }\n    }\n\n    if(action._ === 'sendMessageEmojiInteractionSeen') {\n      if(args) {\n        args.pop();\n      } else {\n        args = [];\n      }\n\n      const span = htmlToSpan(wrapEmojiText(action.emoticon));\n      args.push(span);\n    }\n\n    const descriptionElement = i18n(langPackKey, args);\n    descriptionElement.classList.add('peer-typing-description');\n\n    if(container.childElementCount > 1) container.lastElementChild.replaceWith(descriptionElement);\n    else container.append(descriptionElement);\n\n    // log('returning typing');\n    return container;\n  }\n\n  private async getChatStatus(chatId: ChatId): Promise<AckedResult<HTMLElement>> {\n    const typingEl = await this.getPeerTyping(chatId.toPeerId(true));\n    if(typingEl) {\n      return {cached: true, result: Promise.resolve(typingEl)};\n    }\n\n    const result = await this.managers.acknowledged.appProfileManager.getChatFull(chatId);\n    const dooo = async(chatInfo: ChatFull) => {\n      // this.chat.log('chatInfo res:', chatInfo);\n\n      const participants_count = (chatInfo as ChatFull.channelFull).participants_count ||\n        ((chatInfo as ChatFull.chatFull).participants as ChatParticipants.chatParticipants)?.participants?.length ||\n        1;\n      // if(participants_count) {\n      let subtitle = await getChatMembersString(chatId);\n\n      if(participants_count < 2) {\n        return subtitle;\n      }\n\n      const onlines = await this.managers.appProfileManager.getOnlines(chatId);\n      if(onlines > 1) {\n        const span = document.createElement('span');\n\n        span.append(...join([subtitle, i18n('OnlineCount', [numberThousandSplitter(onlines)])], false));\n        subtitle = span;\n      }\n\n      return subtitle;\n      // }\n    };\n\n    const promise = Promise.resolve(result.result).then(dooo);\n    return {\n      cached: result.cached,\n      result: promise\n    };\n  }\n\n  private async getUserStatus(userId: UserId, ignoreSelf?: boolean) {\n    const result: AckedResult<HTMLElement> = {\n      cached: true,\n      result: Promise.resolve(undefined as HTMLElement)\n    };\n\n    const user = await this.managers.appUsersManager.getUser(userId);\n    if(!user || (user.pFlags.self && !ignoreSelf)) {\n      return result;\n    }\n\n    const subtitle = getUserStatusString(user);\n\n    if(!user.pFlags.bot) {\n      let typingEl = await this.getPeerTyping(userId.toPeerId());\n      if(!typingEl && user.status?._ === 'userStatusOnline') {\n        typingEl = document.createElement('span');\n        typingEl.classList.add('online');\n        typingEl.append(subtitle);\n      }\n\n      if(typingEl) {\n        result.result = Promise.resolve(typingEl);\n        return result;\n      }\n    }\n\n    result.result = Promise.resolve(subtitle);\n    return result;\n  }\n\n  private async getPeerStatus(peerId: PeerId, ignoreSelf?: boolean) {\n    if(!peerId) return;\n    let promise: Promise<AckedResult<HTMLElement>>;\n    if(peerId.isAnyChat()) {\n      promise = this.getChatStatus(peerId.toChatId());\n    } else {\n      promise = this.getUserStatus(peerId.toUserId(), ignoreSelf);\n    }\n\n    return promise;\n  }\n\n  public async setPeerStatus(\n    peerId: PeerId,\n    element: HTMLElement,\n    needClear: boolean,\n    useWhitespace: boolean,\n    middleware: () => boolean,\n    ignoreSelf?: boolean\n  ) {\n    // const log = this.log.bindPrefix('status-' + peerId);\n    // log('setting status', element);\n\n    if(!needClear) {\n      // * good good good\n      const typingContainer = element.querySelector('.peer-typing-container') as HTMLElement;\n      if(typingContainer && await this.getPeerTyping(peerId, typingContainer)) {\n        // log('already have a status');\n        return;\n      }\n    }\n\n    const result = await this.getPeerStatus(peerId, ignoreSelf);\n    // log('getPeerStatus result', result);\n    if(!middleware()) {\n      // log.warn('middleware');\n      return;\n    }\n\n    const set = async() => {\n      const subtitle = result && await result.result;\n      if(!middleware()) {\n        return;\n      }\n\n      return () => replaceContent(element, subtitle || placeholder);\n    };\n\n    const placeholder = useWhitespace ? '' : ''; // ! HERE U CAN FIND WHITESPACE\n    if(!result || result.cached) {\n      return await set();\n    } else if(needClear) {\n      return () => {\n        element.textContent = placeholder;\n        return set().then((callback) => callback && callback());\n      };\n    }\n  }\n\n  public setChoosingStickerTyping(cancel: boolean) {\n    this.managers.appMessagesManager.setTyping(this.chat.peerId, {_: cancel ? 'sendMessageCancelAction' : 'sendMessageChooseStickerAction'});\n  }\n}\n\nconst appImManager = new AppImManager();\nMOUNT_CLASS_TO && (MOUNT_CLASS_TO.appImManager = appImManager);\nexport default appImManager;\n","import {Document, Message, MessageAction, MessageMedia, Photo, WebPage} from '../../../../layer';\n\nexport default function getMediaFromMessage(message: Message) {\n  if(!message) return;\n\n  const media = (message as Message.messageService).action ?\n    ((message as Message.messageService).action as MessageAction.messageActionChannelEditPhoto).photo :\n    (message as Message.message).media && (\n      ((message as Message.message).media as MessageMedia.messageMediaPhoto).photo ||\n      ((message as Message.message).media as MessageMedia.messageMediaDocument).document || (\n        ((message as Message.message).media as MessageMedia.messageMediaWebPage).webpage && (\n          (((message as Message.message).media as MessageMedia.messageMediaWebPage).webpage as WebPage.webPage).document ||\n          (((message as Message.message).media as MessageMedia.messageMediaWebPage).webpage as WebPage.webPage).photo\n        )\n      )\n    );\n\n  return media as Photo.photo | Document.document;\n}\n","import {Message} from '../../../../layer';\nimport type {MyMessage} from '../../appMessagesManager';\n\nexport default function getMessageSenderPeerIdOrName(message: MyMessage) {\n  if(message.fromId) {\n    return {\n      peerId: message.fromId\n    };\n  } else {\n    return {\n      fromName: (message as Message.message).fwd_from?.from_name\n    };\n  }\n}\n","import {isRestricted} from '../../../../helpers/restrictions';\nimport {Message} from '../../../../layer';\n\nexport default function isMessageRestricted(message: Message.message) {\n  return !!(message.restriction_reason && isRestricted(message.restriction_reason));\n}\n","// https://github.com/eelcohn/Telegram-API/wiki/Calculating-color-for-a-Telegram-user-on-IRC\n/*\n  HTML-color  IRC-color  Description\n  #c03d33     4          red\n  #4fad2d     3          green\n  #d09306     7          yellow\n  #168acd     10         blue\n  #8544d6     6          purple\n  #cd4073     13         pink\n  #2996ad     11         sea\n  #ce671b     5          orange\n*/\nconst DialogColorsFg = ['#fc5c51', '#0fb297', '#d09306', '#3d72ed', '#895dd5', '#cd4073', '#00c1a6', '#fa790f'];\nconst DialogColors = ['red', 'green', 'yellow', 'blue', 'violet', 'pink', 'cyan', 'orange'];\nconst DialogColorsMap = [0, 7, 4, 1, 6, 3, 5];\n\nexport default function getPeerColorById(peerId: PeerId, pic = true) {\n  if(!peerId) return '';\n\n  const idx = DialogColorsMap[Math.abs(+peerId) % 7];\n  const color = (pic ? DialogColors : DialogColorsFg)[idx];\n  return color;\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport type {MyDocument} from '../../appDocsManager';\nimport type {MyPhoto} from '../../appPhotosManager';\nimport type {PhotoSize, VideoSize, WebDocument} from '../../../../layer';\nimport calcImageInBox from '../../../../helpers/calcImageInBox';\nimport {THUMB_TYPE_FULL} from '../../../mtproto/mtproto_config';\n\nexport default function choosePhotoSize(\n  photo: MyPhoto | MyDocument | WebDocument,\n  boxWidth = 0,\n  boxHeight = 0,\n  useBytes = false,\n  pushDocumentSize = false\n) {\n  if(window.devicePixelRatio > 1) {\n    boxWidth *= 2;\n    boxHeight *= 2;\n  }\n\n  /*\n  s box 100x100\n  m box 320x320\n  x box 800x800\n  y box 1280x1280\n  w box 2560x2560\n  a crop  160x160\n  b crop  320x320\n  c crop  640x640\n  d crop  1280x1280 */\n\n  let sizes: PhotoSize[] = (photo as MyPhoto).sizes || (photo as MyDocument).thumbs as PhotoSize[];\n  let bestPhotoSize: typeof sizes[0] = {_: 'photoSizeEmpty', type: THUMB_TYPE_FULL};\n  if(pushDocumentSize && sizes && photo._ !== 'photo') {\n    sizes = sizes.concat({\n      _: 'photoSize',\n      w: photo.w,\n      h: photo.h,\n      size: photo.size,\n      type: THUMB_TYPE_FULL\n    });\n  }\n\n  if(sizes?.length) {\n    for(let i = 0, length = sizes.length; i < length; ++i) {\n      const photoSize = sizes[i];\n      if(!('w' in photoSize) && !('h' in photoSize)) continue;\n\n      bestPhotoSize = photoSize;\n\n      const size = calcImageInBox(photoSize.w, photoSize.h, boxWidth, boxHeight);\n      if(size.width >= boxWidth || size.height >= boxHeight) {\n        break;\n      }\n    }\n\n    if(useBytes && bestPhotoSize._ === 'photoSizeEmpty' && sizes[0]._ === 'photoStrippedSize') {\n      bestPhotoSize = sizes[0];\n    }\n  }\n\n  return bestPhotoSize;\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport safeAssign from '../../helpers/object/safeAssign';\nimport {logger} from '../logger';\nimport createDataChannel from './helpers/createDataChannel';\nimport createPeerConnection from './helpers/createPeerConnection';\nimport LocalConferenceDescription from './localConferenceDescription';\nimport StreamManager from './streamManager';\nimport {Ssrc} from './types';\n\nexport type CallConnectionInstanceOptions = {\n  streamManager: StreamManager,\n  connection?: RTCPeerConnection,\n  log?: ReturnType<typeof logger>\n};\n\nexport default abstract class CallConnectionInstanceBase {\n  public connection: RTCPeerConnection;\n  public streamManager: StreamManager;\n  public dataChannel: RTCDataChannel;\n  public description: LocalConferenceDescription;\n  public sources: {\n    audio: Ssrc,\n    video?: Ssrc,\n  };\n  protected negotiating: Promise<void>;\n  protected log: ReturnType<typeof logger>;\n\n  constructor(options: CallConnectionInstanceOptions) {\n    safeAssign(this, options);\n\n    if(!this.log) {\n      this.log = this.connection?.log || logger('CALL-CONNECTION-BASE');\n    }\n\n    this.sources = {} as any;\n  }\n\n  public createPeerConnection(config?: RTCConfiguration) {\n    return this.connection || (this.connection = createPeerConnection(config, this.log.bindPrefix('connection')).connection);\n  }\n\n  public createDataChannel(dict?: RTCDataChannelInit) {\n    return this.dataChannel || (this.dataChannel = createDataChannel(this.connection, dict, this.log.bindPrefix('data')));\n  }\n\n  public createDescription() {\n    return this.description || (this.description = new LocalConferenceDescription(this.connection));\n  }\n\n  public appendStreamToConference() {\n    return this.streamManager.appendToConference(this.description);\n  }\n\n  public closeConnection() {\n    const {connection} = this;\n    if(!connection) {\n      return;\n    }\n\n    try {\n      connection.log('close');\n      connection.close();\n    } catch(e) {\n      this.log.error(e);\n    }\n  }\n\n  public closeConnectionAndStream(stopStream: boolean) {\n    this.closeConnection();\n    stopStream && this.streamManager.stop();\n  }\n\n  protected abstract negotiateInternal(): CallConnectionInstanceBase['negotiating'];\n\n  public negotiate() {\n    const promise = this.negotiating;\n    if(promise) {\n      return promise;\n    }\n\n    return this.negotiating = this.negotiateInternal().finally(() => {\n      this.negotiating = undefined;\n    });\n  }\n\n  public sendDataChannelData(data: any) {\n    if(this.dataChannel.readyState !== 'open') {\n      return;\n    }\n\n    this.dataChannel.send(JSON.stringify(data));\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport {Logger, logger} from '../../logger';\n\nexport default function createPeerConnection(config: RTCConfiguration, log?: Logger) {\n  if(!log) {\n    log = logger('RTCPeerConnection');\n  }\n\n  log('constructor');\n\n  // @ts-ignore\n  const connection = new RTCPeerConnection(config);\n  connection.addEventListener('track', (event) => {\n    log('ontrack', event);\n  });\n  connection.addEventListener('signalingstatechange', () => {\n    log('onsignalingstatechange', connection.signalingState);\n  });\n  connection.addEventListener('connectionstatechange', () => {\n    log('onconnectionstatechange', connection.connectionState);\n  });\n  connection.addEventListener('negotiationneeded', () => { // * will be fired every time input device changes\n    log('onnegotiationneeded', connection.signalingState);\n  });\n  connection.addEventListener('icecandidate', (event) => {\n    log('onicecandidate', event);\n  });\n  connection.addEventListener('iceconnectionstatechange', () => {\n    log('oniceconnectionstatechange', connection.iceConnectionState);\n  });\n  connection.addEventListener('datachannel', () => {\n    log('ondatachannel');\n  });\n\n  connection.log = log;\n\n  return {connection};\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport {Logger, logger} from '../../logger';\n\nexport default function createDataChannel(connection: RTCPeerConnection, dict?: RTCDataChannelInit, log?: Logger) {\n  // return;\n\n  if(!log) {\n    log = logger('RTCDataChannel');\n  }\n\n  const channel = connection.createDataChannel('data', dict);\n\n  channel.addEventListener('message', (e) => {\n    log('onmessage', e);\n  });\n  channel.addEventListener('open', () => {\n    log('onopen');\n  });\n  channel.addEventListener('close', () => {\n    log('onclose');\n  });\n\n  channel.log = log;\n\n  return channel;\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport SDP from '../sdp';\nimport {CallSignalingData, P2PVideoCodec} from '../types';\nimport parseMediaSectionInfo from './parseMediaSectionInfo';\n\nexport default function parseSignalingData(sdp: SDP) {\n  const info = parseMediaSectionInfo(sdp, sdp.media[0]);\n\n  const data: CallSignalingData.initialSetup = {\n    '@type': 'InitialSetup',\n    'fingerprints': [info.fingerprint],\n    'ufrag': info.ufrag,\n    'pwd': info.pwd,\n    'audio': undefined,\n    'video': undefined,\n    'screencast': undefined\n  };\n\n  const convertNumber = (number: number) => '' + number;\n\n  for(const section of sdp.media) {\n    const mediaType = section.mediaType;\n    if(mediaType === 'application' || !section.isSending) {\n      continue;\n    }\n\n    const codec: P2PVideoCodec = data[mediaType === 'video' && data['video'] ? 'screencast' : mediaType] = {} as any;\n    const info = parseMediaSectionInfo(sdp, section);\n    codec.ssrc = convertNumber(info.source);\n\n    if(info.sourceGroups) {\n      codec.ssrcGroups = info.sourceGroups.map((sourceGroup) => ({semantics: sourceGroup.semantics, ssrcs: sourceGroup.sources.map(convertNumber)}));\n    }\n\n    const rtpExtensions: P2PVideoCodec['rtpExtensions'] = codec.rtpExtensions = [];\n    section.attributes.get('extmap').forEach((attribute) => {\n      rtpExtensions.push({\n        id: +attribute.key,\n        uri: attribute.value\n      });\n    });\n\n    const payloadTypesMap: Map<number, P2PVideoCodec['payloadTypes'][0]> = new Map();\n\n    const getPayloadType = (id: number) => {\n      let payloadType = payloadTypesMap.get(id);\n      if(!payloadType) {\n        payloadTypesMap.set(id, payloadType = {\n          id\n        } as any);\n      }\n\n      return payloadType;\n    };\n\n    section.attributes.get('rtpmap').forEach((attribute) => {\n      const id = +attribute.key;\n      const payloadType = getPayloadType(id);\n      const splitted = attribute.value.split('/');\n      const [name, clockrate, channels] = splitted;\n      payloadType.name = name;\n      payloadType.clockrate = +clockrate;\n      payloadType.channels = channels ? +channels : 0;\n    });\n\n    section.attributes.get('rtcp-fb').forEach((attribute) => {\n      const id = +attribute.key;\n      const payloadType = getPayloadType(id);\n      payloadType.feedbackTypes = attribute.lines.map((line) => {\n        const splitted = line.split(' ');\n        const [type, subtype] = splitted;\n        return {\n          type,\n          subtype: subtype || ''\n        };\n      });\n    });\n\n    section.attributes.get('fmtp').forEach((attribute) => {\n      const id = +attribute.key;\n      const payloadType = getPayloadType(id);\n      const parameters: P2PVideoCodec['payloadTypes'][0]['parameters'] = payloadType.parameters = {};\n      const splitted = attribute.value.split(';');\n      for(const str of splitted) {\n        const [key, value] = str.split('=');\n        parameters[key] = value;\n      }\n    });\n\n    codec.payloadTypes = Array.from(payloadTypesMap.values());\n\n    /* if(codec.payloadTypes.length > 5) {\n      codec.payloadTypes.length = Math.min(codec.payloadTypes.length, 5);\n    } */\n  }\n\n  return data;\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport CallConnectionInstanceBase, {CallConnectionInstanceOptions} from './callConnectionInstanceBase';\nimport CallInstance from './callInstance';\nimport parseSignalingData from './helpers/parseSignalingData';\nimport {parseSdp} from './sdp/utils';\n\nexport default class CallConnectionInstance extends CallConnectionInstanceBase {\n  private call: CallInstance;\n\n  constructor(options: CallConnectionInstanceOptions & {\n    call: CallConnectionInstance['call']\n  }) {\n    super(options);\n  }\n\n  protected async negotiateInternal() {\n    const {connection, call} = this;\n\n    if(!connection.localDescription && !connection.remoteDescription && !call.isOutgoing) {\n      return;\n    }\n\n    let descriptionInit: RTCSessionDescriptionInit;\n    if(call.offerReceived) {\n      call.offerReceived = false;\n\n      const answer = descriptionInit = await connection.createAnswer();\n\n      this.log('[sdp] local', answer.type, answer.sdp);\n      await connection.setLocalDescription(answer);\n\n      this.log('[InitialSetup] send 2');\n    } else {\n      const offer = descriptionInit = await connection.createOffer();\n\n      this.log('[sdp] local', offer.sdp);\n      await connection.setLocalDescription(offer);\n\n      call.offerSent = true;\n\n      this.log('[InitialSetup] send 0');\n    }\n\n    const initialSetup = parseSignalingData(parseSdp(descriptionInit.sdp));\n    call.sendCallSignalingData(initialSetup);\n  }\n}\n","const subtle = typeof(window) !== 'undefined' && 'crypto' in window ? window.crypto.subtle : self.crypto.subtle;\n\nexport default subtle;\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n *\n * Originally from:\n * https://github.com/evgeny-nadymov/telegram-react\n * Copyright (C) 2018 Evgeny Nadymov\n * https://github.com/evgeny-nadymov/telegram-react/blob/master/LICENSE\n */\n\nimport bufferConcats from '../../../helpers/bytes/bufferConcats';\nimport subtle from '../../crypto/subtle';\nimport sha256 from '../../crypto/utils/sha256';\n\nconst kMaxIncomingPacketSize = 128 * 1024 * 1024;\n\nexport default class P2PEncryptor {\n  private type: 'Signaling';\n  private counter: number;\n  private seqMap: Map<number, number>;\n\n  constructor(private isOutgoing: boolean, private p2pKey: Uint8Array) {\n    this.type = 'Signaling';\n    this.counter = 0;\n    this.seqMap = new Map();\n  }\n\n  private concatSHA256(parts: Uint8Array[]) {\n    return sha256(bufferConcats(...parts));\n  }\n\n  private async encryptPrepared(buffer: Uint8Array) {\n    const result = {\n      counter: 0, // this.counterFromSeq(this.readSeq(buffer)),\n      bytes: new Uint8Array(16 + buffer.length)\n    };\n\n    const x = (this.isOutgoing ? 0 : 8) + (this.type === 'Signaling' ? 128 : 0);\n    const key = this.p2pKey;\n\n    const msgKeyLarge = await this.concatSHA256([key.subarray(x + 88, x + 88 + 32), buffer]);\n    const msgKey = result.bytes;\n    for(let i = 0; i < 16; ++i) {\n      msgKey[i] = msgKeyLarge[i + 8];\n    }\n\n    const aesKeyIv = await this.prepareAesKeyIv(key, msgKey, x);\n\n    const bytes = await this.aesProcessCtr(buffer, buffer.length, aesKeyIv, true);\n\n    result.bytes = new Uint8Array([...result.bytes.subarray(0, 16), ...bytes]);\n\n    return result;\n  }\n\n  public encryptRawPacket(buffer: Uint8Array) {\n    const seq = ++this.counter;\n    const arr = new ArrayBuffer(4);\n    const view = new DataView(arr);\n    view.setUint32(0, seq >>> 0, false); // byteOffset = 0; litteEndian = false\n\n    const result = new Uint8Array([...new Uint8Array(arr), ...buffer]);\n\n    return this.encryptPrepared(result);\n  }\n\n  private async prepareAesKeyIv(key: Uint8Array, msgKey: Uint8Array, x: number) {\n    const [sha256a, sha256b] = await Promise.all([\n      this.concatSHA256([\n        msgKey.subarray(0, 16),\n        key.subarray(x, x + 36)\n      ]),\n\n      this.concatSHA256([\n        key.subarray(40 + x, 40 + x + 36),\n        msgKey.subarray(0, 16)\n      ])\n    ]);\n\n    return {\n      key: new Uint8Array([\n        ...sha256a.subarray(0, 8),\n        ...sha256b.subarray(8, 8 + 16),\n        ...sha256a.subarray(24, 24 + 8)\n      ]),\n      iv: new Uint8Array([\n        ...sha256b.subarray(0, 4),\n        ...sha256a.subarray(8, 8 + 8),\n        ...sha256b.subarray(24, 24 + 4)\n      ])\n    };\n  }\n\n  private async aesProcessCtr(encryptedData: Uint8Array, dataSize: number, aesKeyIv: {key: Uint8Array, iv: Uint8Array}, encrypt = true) {\n    const cryptoKey = await subtle.importKey(\n      'raw',\n      aesKeyIv.key,\n      {name: 'AES-CTR'},\n      false,\n      [encrypt ? 'encrypt' : 'decrypt']\n    );\n\n    const buffer: ArrayBuffer = await subtle[encrypt ? 'encrypt' : 'decrypt']({\n      name: 'AES-CTR',\n      counter: aesKeyIv.iv,\n      length: aesKeyIv.iv.length * 8\n    },\n    cryptoKey,\n    encryptedData\n    );\n\n    return new Uint8Array(buffer);\n  }\n\n  private constTimeIsDifferent(a: Uint8Array, b: Uint8Array, count: number) {\n    let msgKeyEquals = true;\n    for(let i = 0; i < count; ++i) {\n      if(a[i] !== b[i]) {\n        msgKeyEquals = false;\n      }\n    }\n\n    return !msgKeyEquals;\n  }\n\n  public async decryptRawPacket(buffer: Uint8Array) {\n    if(buffer.length < 21 || buffer.length > kMaxIncomingPacketSize) {\n      return;\n    }\n\n    const {isOutgoing, type} = this;\n\n    const x = (isOutgoing ? 8 : 0) + (type === 'Signaling' ? 128 : 0);\n    const key = this.p2pKey;\n\n    const msgKey = buffer.subarray(0, 16);\n    const encryptedData = buffer.subarray(16);\n    const encryptedDataSize = buffer.length - 16;\n\n    const aesKeyIv = await this.prepareAesKeyIv(key, msgKey, x);\n\n    const decryptionBuffer = await this.aesProcessCtr(encryptedData, encryptedDataSize, aesKeyIv, false);\n\n    const msgKeyLarge = await this.concatSHA256([\n      key.subarray(88 + x, 88 + x + 32),\n      decryptionBuffer\n    ]);\n\n    if(this.constTimeIsDifferent(msgKeyLarge.subarray(8), msgKey, 16)) {\n      return;\n    }\n\n    const dataView = new DataView(decryptionBuffer.buffer);\n    const seq = dataView.getUint32(0);\n    if(this.seqMap.has(seq)) {\n      return;\n    }\n    this.seqMap.set(seq, seq);\n\n    return decryptionBuffer.slice(4);\n  }\n}\n","import convertToUint8Array from '../../../helpers/bytes/convertToUint8Array';\nimport subtle from '../subtle';\n// import sha256 from '@cryptography/sha256';\n\nexport default function sha256(bytes: Parameters<typeof convertToUint8Array>[0]) {\n  return subtle.digest('SHA-256', convertToUint8Array(bytes)).then((b) => {\n    // console.log('legacy', performance.now() - perfS);\n    return new Uint8Array(b);\n  });\n  /* //console.log('SHA-256 hash start');\n\n  let perfS = performance.now();\n\n\n  let perfD = performance.now();\n  let words = typeof(bytes) === 'string' ? bytes : bytesToWordss(bytes as any);\n  let hash = sha256(words);\n  console.log('darutkin', performance.now() - perfD);\n\n  //console.log('SHA-256 hash finish', hash, sha256(words, 'hex'));\n\n  return bytesFromWordss(hash); */\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n *\n * Originally from:\n * https://github.com/evgeny-nadymov/telegram-react\n * Copyright (C) 2018 Evgeny Nadymov\n * https://github.com/evgeny-nadymov/telegram-react/blob/master/LICENSE\n */\n\nimport StringFromLineBuilder from '../stringFromLineBuilder';\nimport {addDataChannel, addExtmap, addPayloadTypes, addSsrc} from './p2PSdpBuilder';\n\nexport default class ChromeP2PSdpBuilder {\n  static generateOffer(info: any) {\n    const {fingerprints, ufrag, pwd, audio, video} = info;\n    audio.type = 'audio';\n    video.type = 'video';\n    const media = [audio, video];\n\n    const stringBuilder = new StringFromLineBuilder();\n    stringBuilder.add(\n      'v=0',\n      'o=- 1 2 IN IP4 127.0.0.1',\n      's=-',\n      't=0 0'\n    );\n\n    if(fingerprints) {\n      fingerprints.forEach((x: any) => {\n        const {hash, fingerprint, setup} = x;\n        stringBuilder.add(\n          `a=fingerprint:${hash} ${fingerprint}`,\n          `a=setup:${setup}`\n        );\n      });\n    }\n    if(ufrag && pwd) {\n      stringBuilder.add(\n        `a=ice-ufrag:${ufrag}`,\n        `a=ice-pwd:${pwd}`\n      );\n    }\n\n    stringBuilder.add(\n      'a=group:BUNDLE 0 1 2',\n      'a=extmap-allow-mixed',\n      'a=msid-semantic: WMS *'\n    );\n    const streamName = 'stream' + media.map((x) => x.ssrc).join('_');\n    for(let i = 0; i < media.length; i++) {\n      const m = media[i];\n      const {type, ssrc, ssrcGroups, payloadTypes, rtpExtensions} = m;\n      switch(type) {\n        case 'audio': {\n          stringBuilder.add(\n            `m=audio 56930 UDP/TLS/RTP/SAVPF ${payloadTypes.map((x: any) => x.id).join(' ')}`,\n            'c=IN IP4 0.0.0.0',\n            'a=rtcp:9 IN IP4 0.0.0.0',\n            'a=ice-options:trickle',\n            `a=mid:${i}`,\n            'a=sendrecv',\n            addExtmap(rtpExtensions)\n          );\n          if(ssrc) {\n            stringBuilder.add(`a=msid:${streamName} audio${ssrc}`);\n          }\n          stringBuilder.add(\n            'a=rtcp-mux',\n            addPayloadTypes(payloadTypes),\n            addSsrc(type, ssrc, ssrcGroups, streamName)\n          );\n\n          break;\n        }\n\n        case 'video': {\n          stringBuilder.add(\n            `m=video 61986 UDP/TLS/RTP/SAVPF ${payloadTypes.map((x: any) => x.id).join(' ')}`,\n            'c=IN IP4 0.0.0.0',\n            'a=rtcp:9 IN IP4 0.0.0.0',\n            'a=ice-options:trickle',\n            `a=mid:${i}`,\n            'a=sendrecv',\n            addExtmap(rtpExtensions)\n          );\n          if(ssrc) {\n            stringBuilder.add(`a=msid:${streamName} video${ssrc}`);\n          }\n          stringBuilder.add(\n            'a=rtcp-mux',\n            'a=rtcp-rsize',\n            addPayloadTypes(payloadTypes),\n            addSsrc(type, ssrc, ssrcGroups, streamName)\n          );\n          break;\n        }\n      }\n    }\n    stringBuilder.add(addDataChannel(2));\n    return stringBuilder.finalize();\n  }\n\n  static generateAnswer(info: any) {\n    const {fingerprints, ufrag, pwd, audio, video} = info;\n    audio.type = 'audio';\n    video.type = 'video';\n    const media = [audio, video];\n\n    const stringBuilder = new StringFromLineBuilder();\n    stringBuilder.add(\n      'v=0',\n      'o=- 1 2 IN IP4 127.0.0.1',\n      's=-',\n      't=0 0'\n    );\n\n    if(fingerprints) {\n      fingerprints.forEach((x: any) => {\n        const {hash, fingerprint, setup} = x;\n        stringBuilder.add(\n          `a=fingerprint:${hash} ${fingerprint}`,\n          `a=setup:${setup}`\n        );\n      });\n    }\n    if(ufrag && pwd) {\n      stringBuilder.add(\n        `a=ice-ufrag:${ufrag}`,\n        `a=ice-pwd:${pwd}`\n      );\n    }\n\n    stringBuilder.add(\n      'a=group:BUNDLE 0 1 2',\n      'a=extmap-allow-mixed',\n      'a=msid-semantic: WMS *'\n    );\n    const streamName = 'stream' + media.map((x) => x.ssrc).join('_');\n    for(let i = 0; i < media.length; i++) {\n      const m = media[i];\n      const {type, ssrc, ssrcGroups, payloadTypes, rtpExtensions} = m;\n      switch(type) {\n        case 'audio': {\n          stringBuilder.add(\n            `m=audio 56930 UDP/TLS/RTP/SAVPF ${payloadTypes.map((x: any) => x.id).join(' ')}`,\n            'c=IN IP4 0.0.0.0',\n            'a=rtcp:9 IN IP4 0.0.0.0',\n            'a=ice-options:trickle',\n            `a=mid:${i}`,\n            'a=sendrecv',\n            addExtmap(rtpExtensions)\n          );\n          if(ssrc) {\n            stringBuilder.add(`a=msid:${streamName} audio${ssrc}`);\n          }\n          stringBuilder.add(\n            'a=rtcp-mux',\n            addPayloadTypes(payloadTypes),\n            addSsrc(type, ssrc, ssrcGroups, streamName)\n          );\n          break;\n        }\n\n        case 'video': {\n          stringBuilder.add(\n            `m=video 61986 UDP/TLS/RTP/SAVPF ${payloadTypes.map((x: any) => x.id).join(' ')}`,\n            'c=IN IP4 0.0.0.0',\n            'a=rtcp:9 IN IP4 0.0.0.0',\n            'a=ice-options:trickle',\n            `a=mid:${i}`,\n            'a=sendrecv',\n            addExtmap(rtpExtensions)\n          );\n          if(ssrc) {\n            stringBuilder.add(`a=msid:${streamName} video${ssrc}`);\n          }\n\n          stringBuilder.add(\n            'a=rtcp-mux',\n            'a=rtcp-rsize',\n            addPayloadTypes(payloadTypes),\n            addSsrc(type, ssrc, ssrcGroups, streamName)\n          );\n          break;\n        }\n      }\n    }\n    stringBuilder.add(addDataChannel(2));\n    return stringBuilder.finalize();\n  }\n}\n","/*\n*  Copyright (c) 2018-present, Evgeny Nadymov\n*\n* This source code is licensed under the GPL v.3.0 license found in the\n* LICENSE file in the root directory of this source tree.\n*/\n\nimport ChromeP2PSdpBuilder from './chromeP2PSdpBuilder';\nimport { FirefoxP2PSdpBuilder } from './firefoxP2PSdpBuilder';\nimport { SafariP2PSdpBuilder } from './safariP2PSdpBuilder';\n// import { TG_CALLS_SDP_STRING } from '../../Stores/CallStore';\n\nexport function p2pParseCandidate(candidate) {\n  if(!candidate || !candidate.startsWith('candidate:')) {\n    return;\n  }\n  \n  const sdpString = candidate;\n  candidate = candidate.substr('candidate:'.length);\n  \n  const [foundation, component, protocol, priority, ip, port, ...other] = candidate.split(' ');\n  const c = {\n    sdpString,\n    foundation,\n    component,\n    protocol,\n    priority,\n    address: { ip, port }\n  };\n  \n  for(let i = 0; i < other.length; i += 2) {\n    switch(other[i]) {\n      case 'typ': {\n        c.type = other[i + 1];\n        break;\n      }\n      case 'raddr': {\n        if(!c.relAddress) {\n          c.relAddress = {};\n        }\n        \n        c.relAddress.ip = other[i + 1];\n        break;\n      }\n      case 'rport': {\n        if(!c.relAddress) {\n          c.relAddress = {};\n        }\n        \n        c.relAddress.port = other[i + 1];\n        break;\n      }\n      case 'generation': {\n        c.generation = other[i + 1];\n        break;\n      }\n      case 'tcptype': {\n        c.tcpType = other[i + 1];\n        break;\n      }\n      case 'network-id': {\n        c.networkId = other[i + 1];\n        break;\n      }\n      case 'network-cost': {\n        c.networkCost = other[i + 1];\n        break;\n      }\n      case 'ufrag': {\n        c.username = other[i + 1];\n        break;\n      }\n    }\n  }\n  \n  return c;\n}\n\nexport function p2pParseSdp(sdp) {\n  const lines = sdp.split('\\r\\n');\n  const lookup = (prefix, force = true, lineFrom = 0, lineTo = Number.MAX_VALUE) => {\n    if (lineTo === -1) {\n      lineTo = Number.MAX_VALUE;\n    }\n    for (let i = lineFrom; i < lines.length && i < lineTo; i++) {\n      const line = lines[i];\n      if (line.startsWith(prefix)) {\n        return line.substr(prefix.length);\n      }\n    }\n    \n    if (force) {\n      console.error(\"Can't find prefix\", prefix);\n    }\n    \n    return null;\n  };\n  const findIndex = (prefix, lineFrom = 0, lineTo = Number.MAX_VALUE) => {\n    if (lineTo === -1) {\n      lineTo = Number.MAX_VALUE;\n    }\n    for (let i = lineFrom; i < lines.length && i < lineTo; i++) {\n      const line = lines[i];\n      if (line.startsWith(prefix)) {\n        return i;\n      }\n    }\n    \n    return -1;\n  };\n  \n  const pwdIndex = findIndex('a=ice-pwd:');\n  const ufragIndex = findIndex('a=ice-ufrag:');\n  if (pwdIndex === -1 && ufragIndex === -1) {\n    return {\n      // sessionId: lookup('o=').split(' ')[1],\n      ufrag: null,\n      pwd: null,\n      fingerprints: []\n    };\n  }\n  \n  const info = {\n    // sessionId: lookup('o=').split(' ')[1],\n    ufrag: null,\n    pwd: null,\n    fingerprints: []\n  };\n  \n  let mediaIndex = findIndex('m=');\n  const fingerprint = lookup('a=fingerprint:', false);\n  const setup = lookup('a=setup:', false);\n  if (fingerprint && setup) {\n    info.fingerprints.push({\n      hash: fingerprint.split(' ')[0],\n      fingerprint: fingerprint.split(' ')[1],\n      setup\n    });\n  }\n  \n  const ufrag = lookup('a=ice-ufrag:', false);\n  const pwd = lookup('a=ice-pwd:', false);\n  if (ufrag && pwd) {\n    info.ufrag = ufrag;\n    info.pwd = pwd;\n  }\n  \n  while (mediaIndex !== -1) {\n    let nextMediaIndex = findIndex('m=', mediaIndex + 1);\n    \n    const extmap = [];\n    const types = [];\n    const mediaType = lookup('m=', true, mediaIndex, nextMediaIndex).split(' ')[0];\n    const media = {\n      // type: lookup('m=', true, mediaIndex, nextMediaIndex).split(' ')[0],\n      // mid: lookup('a=mid:', true, mediaIndex, nextMediaIndex),\n      // dir: findDirection(mediaIndex, nextMediaIndex),\n      rtpExtensions: extmap,\n      payloadTypes: types\n    }\n    \n    const lineTo = nextMediaIndex === -1 ? lines.length : nextMediaIndex;\n    const fmtp = new Map();\n    const rtcpFb = new Map();\n    for (let i = mediaIndex; i < lineTo; i++) {\n      const line = lines[i];\n      if (line.startsWith('a=extmap:')) {\n        const [ id, uri ] = line.substr('a=extmap:'.length).split(' ');\n        extmap.push({ id: parseInt(id), uri });\n      } else if (line.startsWith('a=fmtp:')) {\n        const [ id, str ] = line.substr('a=fmtp:'.length).split(' ');\n        const obj = { };\n        const arr =  str.split(';').map(x => {\n          const [ key, value ] = x.split('=');\n          obj[key] = value;\n          return { [key]: value };\n        });\n        fmtp.set(parseInt(id), obj);\n      } else if (line.startsWith('a=rtcp-fb:')) {\n        const [ id, type = '', subtype = '' ] = line.substr('a=rtcp-fb:'.length).split(' ');\n        if (rtcpFb.has(parseInt(id))) {\n          rtcpFb.get(parseInt(id)).push({ type, subtype });\n        } else {\n          rtcpFb.set(parseInt(id), [{ type, subtype }])\n        }\n      } else if (line.startsWith('a=rtpmap')) {\n        const [ id, str ] = line.substr('a=rtpmap:'.length).split(' ');\n        const [ name, clockrate, channels = '0' ] = str.split('/');\n        const obj = { id: parseInt(id), name, clockrate: parseInt(clockrate), channels: parseInt(channels) };\n        \n        types.push(obj);\n      }\n    }\n    \n    for (let i = 0; i < types.length; i++) {\n      const { id } = types[i];\n      if (rtcpFb.has(id)) {\n        types[i].feedbackTypes = rtcpFb.get(id);\n      }\n      if (fmtp.has(id)) {\n        types[i].parameters = fmtp.get(id);\n      }\n    }\n    \n    const ssrc = lookup('a=ssrc:', false, mediaIndex, nextMediaIndex);\n    if (ssrc) {\n      media.ssrc = ssrc.split(' ')[0];\n    }\n    \n    const ssrcGroup = lookup('a=ssrc-group:', false, mediaIndex, nextMediaIndex);\n    if (ssrcGroup) {\n      const [ semantics, ...ssrcs ] = ssrcGroup.split(' ');\n      media.ssrcGroups = [{\n        semantics,\n        ssrcs\n      }]\n    }\n    \n    switch (mediaType) {\n      case 'audio': {\n        info.audio = media;\n        break;\n      }\n      case 'video': {\n        info.video = media;\n        break;\n      }\n    }\n    \n    mediaIndex = nextMediaIndex;\n  }\n\n  if(!info.video.ssrcGroups) {\n    info.video.ssrcGroups = [];\n  }\n\n  info['@type'] = 'InitialSetup';\n  \n  // console.log('[p2pParseSdp]', sdp, info);\n  return info;\n}\n\nexport function isFirefox() {\n  return navigator.userAgent.toLowerCase().indexOf('firefox') > -1;\n}\n\nfunction isSafari() {\n  return navigator.userAgent.toLowerCase().indexOf('safari') > -1 && navigator.userAgent.toLowerCase().indexOf('chrome') === -1;\n}\n\nexport function addExtmap(extmap) {\n  let sdp = [];\n  // return sdp;\n  for (let j = 0; j < extmap.length; j++) {\n    const ext = extmap[j];\n    const { id, uri } = ext;\n    // if (isFirefox() && uri.indexOf(''))\n    console.log('[extmap] add', id, uri);\n    sdp.push(`a=extmap:${id} ${uri}`);\n  }\n  \n  return sdp.join('\\n');\n}\n\nexport function addPayloadTypes(types) {\n  let sdp = [];\n  console.log('[SDP] addPayloadTypes', types);\n  for (let i = 0; i < types.length; i++) {\n    const type = types[i];\n    const { id, name, clockrate, channels, feedbackTypes, parameters } = type;\n    sdp.push(`a=rtpmap:${id} ${name}/${clockrate}${channels ? '/' + channels : ''}`);\n    if (feedbackTypes) {\n      feedbackTypes.forEach(x => {\n        const { type, subtype } = x;\n        sdp.push(`a=rtcp-fb:${id} ${[type, subtype].join(' ')}`);\n      });\n    }\n    if (parameters) {\n      const fmtp = [];\n      Object.getOwnPropertyNames(parameters).forEach(pName => {\n        fmtp.push(`${pName}=${parameters[pName]}`);\n      });\n      \n      sdp.push(`a=fmtp:${id} ${fmtp.join(';')}`);\n    }\n  }\n  \n  return sdp.join('\\n');\n}\n\nexport function addSsrc(type, ssrc, ssrcGroups, streamName) {\n  let sdp = [];\n  \n  if (ssrcGroups && ssrcGroups.length > 0) {\n    ssrcGroups.forEach(ssrcGroup => {\n      if (ssrcGroup && ssrcGroup.ssrcs.length > 0) {\n        sdp.push(`a=ssrc-group:${ssrcGroup.semantics} ${ssrcGroup.ssrcs.join(' ')}`);\n        ssrcGroup.ssrcs.forEach(ssrc => {\n          sdp.push(\n            `a=ssrc:${ssrc} cname:stream${ssrc}`,\n            `a=ssrc:${ssrc} msid:${streamName} ${type}${ssrc}`,\n            `a=ssrc:${ssrc} mslabel:${type}${ssrc}`,\n            `a=ssrc:${ssrc} label:${type}${ssrc}`\n          );\n        });\n      }\n    });\n  } else if (ssrc) {\n    sdp.push(\n      `a=ssrc:${ssrc} cname:stream${ssrc}`,\n      `a=ssrc:${ssrc} msid:${streamName} ${type}${ssrc}`,\n      `a=ssrc:${ssrc} mslabel:${type}${ssrc}`,\n      `a=ssrc:${ssrc} label:${type}${ssrc}`\n    );\n  }\n  \n  return sdp.join('\\n');\n}\n\nexport function addDataChannel(mid) {\n  return `m=application 9 UDP/DTLS/SCTP webrtc-datachannel\nc=IN IP4 0.0.0.0\na=ice-options:trickle\na=mid:2\na=sctp-port:5000\na=max-message-size:262144`;\n}\n\nexport class P2PSdpBuilder {\n  static generateCandidate(info) {\n    if (!info) return null;\n    \n    const { sdpString, sdpMLineIndex, sdpMid, foundation, component, protocol, priority, address, type, relAddress, generation, tcpType, networkId, networkCost, username } = info;\n    if (/* TG_CALLS_SDP_STRING */true) {\n      if (sdpString) {\n        return {\n          candidate: sdpString,\n          sdpMLineIndex,\n          sdpMid\n        };\n      }\n    }\n    throw 'no sdpString';\n    \n    let candidate = `candidate:${foundation} ${component} ${protocol} ${priority} ${address.ip} ${address.port}`;\n    const attrs = []\n    if (type) {\n      attrs.push(`typ ${type}`);\n    }\n    if (relAddress) {\n      attrs.push(`raddr ${relAddress.ip}`);\n      attrs.push(`rport ${relAddress.port}`);\n    }\n    if (tcpType) {\n      attrs.push(`tcptype ${tcpType}`);\n    }\n    if (generation) {\n      attrs.push(`generation ${generation}`);\n    }\n    if (username) {\n      attrs.push(`ufrag ${username}`);\n    }\n    if (networkId) {\n      attrs.push(`network-id ${networkId}`);\n    }\n    if (networkCost) {\n      attrs.push(`network-cost ${networkCost}`);\n    }\n    if (attrs.length > 0) {\n      candidate += ` ${attrs.join(' ')}`;\n    }\n    \n    return { candidate, sdpMid, sdpMLineIndex };\n  }\n  \n  static generateOffer(info) {\n    if (isFirefox()) {\n      return FirefoxP2PSdpBuilder.generateOffer(info);\n    } else if (isSafari()) {\n      return SafariP2PSdpBuilder.generateOffer(info);\n    }\n    \n    return ChromeP2PSdpBuilder.generateOffer(info);\n  }\n  \n  static generateAnswer(info) {\n    if (isFirefox()) {\n      return FirefoxP2PSdpBuilder.generateAnswer(info);\n    } else if (isSafari()) {\n      return SafariP2PSdpBuilder.generateAnswer(info);\n    }\n    \n    return ChromeP2PSdpBuilder.generateAnswer(info);\n  }\n}","/*\n *  Copyright (c) 2018-present, Evgeny Nadymov\n *\n * This source code is licensed under the GPL v.3.0 license found in the\n * LICENSE file in the root directory of this source tree.\n */\n\nimport { addDataChannel, addExtmap, addPayloadTypes, addSsrc } from './p2PSdpBuilder';\n\nexport class FirefoxP2PSdpBuilder {\n    static generateOffer(info) {\n        const { fingerprints, ufrag, pwd, audio, video } = info;\n        audio.type = 'audio';\n        video.type = 'video';\n        const media = [audio, video];\n\n        let sdp = `v=0\no=- 1 0 IN IP4 0.0.0.0\ns=-\nt=0 0`;\n        if (fingerprints) {\n            fingerprints.forEach(x => {\n                const { hash, fingerprint, setup } = x;\n                sdp += `\na=fingerprint:${hash} ${fingerprint}\na=setup:${setup}`;\n            });\n        }\n        if (ufrag && pwd) {\n            sdp += `\na=ice-ufrag:${ufrag}\na=ice-pwd:${pwd}`;\n        }\n\n        sdp += `\na=group:BUNDLE 0 1 2\na=ice-options:trickle\na=msid-semantic:WMS *`;\n        const streamName = 'stream' + media.map(x => x.ssrc).join('_');\n        for (let i = 0; i < media.length; i++) {\n            const m = media[i];\n            const { type, ssrc, ssrcGroups, payloadTypes, rtpExtensions } = m;\n            switch (type) {\n                case 'audio': {\n                    sdp += `\nm=audio 9 UDP/TLS/RTP/SAVPF ${payloadTypes.map(x => x.id).join(' ')}\nc=IN IP4 0.0.0.0\na=mid:${i}\na=sendrecv`;\n                    sdp += addExtmap(rtpExtensions);\n                    sdp += `\na=rtcp-mux`;\n                    sdp += addPayloadTypes(payloadTypes);\n                    sdp += addSsrc(type, ssrc, ssrcGroups, streamName);\n\n                    break;\n                }\n                case 'video': {\n                    sdp += `\nm=video 9 UDP/TLS/RTP/SAVPF ${payloadTypes.map(x => x.id).join(' ')}\nc=IN IP4 0.0.0.0\na=mid:${i}\na=sendrecv`;\n                    sdp += addExtmap(rtpExtensions);\n                    sdp += `\na=rtcp-mux\na=rtcp-rsize`;\n                    sdp += addPayloadTypes(payloadTypes);\n                    sdp += addSsrc(type, ssrc, ssrcGroups, streamName);\n\n                    break;\n                }\n            }\n        }\n        sdp += addDataChannel(2);\n        sdp += `\n`;\n\n        return sdp;\n    }\n\n    static generateAnswer(info) {\n        const { fingerprints, ufrag, pwd, audio, video } = info;\n        audio.type = 'audio';\n        video.type = 'video';\n        const media = [audio, video];\n\n        let sdp = `v=0\no=- 1 0 IN IP4 0.0.0.0\ns=-\nt=0 0`;\n        if (fingerprints) {\n            fingerprints.forEach(x => {\n                const { hash, fingerprint, setup } = x;\n                sdp += `\na=fingerprint:${hash} ${fingerprint}\na=setup:${setup}`;\n            });\n        }\n        if (ufrag && pwd) {\n            sdp += `\na=ice-ufrag:${ufrag}\na=ice-pwd:${pwd}`;\n        }\n\n        sdp += `\na=group:BUNDLE 0 1 2\na=ice-options:trickle\na=msid-semantic:WMS *`;\n        const streamName = 'stream' + media.map(x => x.ssrc).join('_');\n        for (let i = 0; i < media.length; i++) {\n            const m = media[i];\n            const { type, mid, ssrc, ssrcGroups, payloadTypes, dir, rtpExtensions } = m;\n            switch (type) {\n                case 'audio': {\n                    sdp += `\nm=audio 9 UDP/TLS/RTP/SAVPF ${payloadTypes.map(x => x.id).join(' ')}\nc=IN IP4 0.0.0.0\na=mid:${i}\na=sendrecv`;\n                    sdp += addExtmap(rtpExtensions);\n                    sdp += `\na=rtcp-mux`;\n                    sdp += addPayloadTypes(payloadTypes);\n                    sdp += addSsrc(type, ssrc, ssrcGroups, streamName);\n\n                    break;\n                }\n                case 'video': {\n                    sdp += `\nm=video 9 UDP/TLS/RTP/SAVPF ${payloadTypes.map(x => x.id).join(' ')}\nc=IN IP4 0.0.0.0\na=mid:${i}\na=sendrecv`;\n                    sdp += addExtmap(rtpExtensions);\n                    sdp += `\na=rtcp-mux\na=rtcp-rsize`;\n                    sdp += addPayloadTypes(payloadTypes);\n                    sdp += addSsrc(type, ssrc, ssrcGroups, streamName);\n                    break;\n                }\n            }\n        }\n        sdp += addDataChannel(2);\n        sdp += `\n`;\n\n        return sdp;\n    }\n}","/*\n *  Copyright (c) 2018-present, Evgeny Nadymov\n *\n * This source code is licensed under the GPL v.3.0 license found in the\n * LICENSE file in the root directory of this source tree.\n */\n\nimport { addDataChannel, addExtmap, addPayloadTypes, addSsrc } from './p2PSdpBuilder';\n\nexport class SafariP2PSdpBuilder {\n    static generateOffer(info) {\n        const { fingerprints, ufrag, pwd, audio, video } = info;\n        audio.type = 'audio';\n        video.type = 'video';\n        const media = [audio, video];\n\n        if (!media.length) {\n            return `v=0\no=- 1 2 IN IP4 127.0.0.1\ns=-\nt=0 0\na=msid-semantic: WMS\n`;\n        }\n\n        let sdp = `v=0\no=- 1 2 IN IP4 127.0.0.1\ns=-\nt=0 0`;\n        if (fingerprints) {\n            fingerprints.forEach(x => {\n                const { hash, fingerprint, setup } = x;\n                sdp += `\na=fingerprint:${hash} ${fingerprint}\na=setup:${setup}`;\n            });\n        }\n        if (ufrag && pwd) {\n            sdp += `\na=ice-ufrag:${ufrag}\na=ice-pwd:${pwd}`;\n        }\n\n        sdp += `\na=group:BUNDLE 0 1 2\na=extmap-allow-mixed\na=msid-semantic: WMS *`;\n        const streamName = 'stream' + media.map(x => x.ssrc).join('_');\n        for (let i = 0; i < media.length; i++) {\n            const m = media[i];\n            const { type, ssrc, ssrcGroups, payloadTypes, rtpExtensions } = m;\n            switch (type) {\n                case 'audio': {\n                    sdp += `\nm=audio 9 UDP/TLS/RTP/SAVPF ${payloadTypes.map(x => x.id).join(' ')}\nc=IN IP4 0.0.0.0\na=rtcp:9 IN IP4 0.0.0.0\na=ice-options:trickle\na=mid:${i}\na=sendrecv`;\n                    sdp += addExtmap(rtpExtensions);\n                    if (ssrc) {\n                        sdp += `\na=msid:${streamName} audio${ssrc}`;\n                    }\n                    sdp += `\na=rtcp-mux`;\n                    sdp += addPayloadTypes(payloadTypes);\n                    sdp += addSsrc(type, ssrc, ssrcGroups, streamName);\n\n                    break;\n                }\n                case 'video': {\n                    sdp += `\nm=video 9 UDP/TLS/RTP/SAVPF ${payloadTypes.map(x => x.id).join(' ')}\nc=IN IP4 0.0.0.0\na=rtcp:9 IN IP4 0.0.0.0\na=ice-options:trickle\na=mid:${i}\na=sendrecv`;\n                    sdp += addExtmap(rtpExtensions);\n                    if (ssrc) {\n                        sdp += `\na=msid:${streamName} video${ssrc}`;\n                    }\n                    sdp += `\na=rtcp-mux\na=rtcp-rsize`;\n                    sdp += addPayloadTypes(payloadTypes);\n                    sdp += addSsrc(type, ssrc, ssrcGroups, streamName);\n                    break;\n                }\n            }\n        }\n        sdp += addDataChannel(2);\n        sdp += `\n`;\n\n        return sdp;\n    }\n\n    static generateAnswer(info) {\n        const { fingerprints, ufrag, pwd, audio, video } = info;\n        audio.type = 'audio';\n        video.type = 'video';\n        const media = [audio, video];\n\n        if (!media.length) {\n            return `v=0\no=- 1 2 IN IP4 127.0.0.1\ns=-\nt=0 0\na=msid-semantic: WMS\n`;\n        }\n\n        let sdp = `v=0\no=- 1 2 IN IP4 127.0.0.1\ns=-\nt=0 0`;\n        if (fingerprints) {\n            fingerprints.forEach(x => {\n                const { hash, fingerprint, setup } = x;\n                sdp += `\na=fingerprint:${hash} ${fingerprint}\na=setup:${setup}`;\n            });\n        }\n        if (ufrag && pwd) {\n            sdp += `\na=ice-ufrag:${ufrag}\na=ice-pwd:${pwd}`;\n        }\n\n        sdp += `\na=group:BUNDLE 0 1 2\na=extmap-allow-mixed\na=msid-semantic: WMS *`;\n        const streamName = 'stream' + media.map(x => x.ssrc).join('_');\n        for (let i = 0; i < media.length; i++) {\n            const m = media[i];\n            const { type, ssrc, ssrcGroups, payloadTypes, rtpExtensions } = m;\n            switch (type) {\n                case 'audio': {\n                    sdp += `\nm=audio 9 UDP/TLS/RTP/SAVPF ${payloadTypes.map(x => x.id).join(' ')}\nc=IN IP4 0.0.0.0\na=rtcp:9 IN IP4 0.0.0.0\na=ice-options:trickle\na=mid:${i}\na=sendrecv`;\n                    sdp += addExtmap(rtpExtensions);\n                    if (ssrc) {\n                        sdp += `\na=msid:${streamName} audio${ssrc}`;\n                    }\n                    sdp += `\na=rtcp-mux`;\n                    sdp += addPayloadTypes(payloadTypes);\n                    sdp += addSsrc(type, ssrc, ssrcGroups, streamName);\n\n                    break;\n                }\n                case 'video': {\n                    sdp += `\nm=video 9 UDP/TLS/RTP/SAVPF ${payloadTypes.map(x => x.id).join(' ')}\nc=IN IP4 0.0.0.0\na=rtcp:9 IN IP4 0.0.0.0\na=ice-options:trickle\na=mid:${i}\na=sendrecv`;\n                    sdp += addExtmap(rtpExtensions);\n                    if (ssrc) {\n                        sdp += `\na=msid:${streamName} video${ssrc}`;\n                    }\n                    sdp += `\na=rtcp-mux\na=rtcp-rsize`;\n                    sdp += addPayloadTypes(payloadTypes);\n                    sdp += addSsrc(type, ssrc, ssrcGroups, streamName);\n                    break;\n                }\n            }\n        }\n        sdp += addDataChannel(2);\n        sdp += `\n`;\n\n        return sdp;\n    }\n}","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport ctx from '../../environment/ctx';\nimport {IS_SAFARI} from '../../environment/userAgent';\nimport safeAssign from '../../helpers/object/safeAssign';\nimport debounce from '../../helpers/schedulers/debounce';\nimport {GroupCallParticipantVideoSourceGroup, PhoneCall, PhoneCallDiscardReason, PhoneCallProtocol, Update} from '../../layer';\nimport {emojiFromCodePoints} from '../../vendor/emoji';\nimport type {CallId} from '../appManagers/appCallsManager';\nimport type {AppManagers} from '../appManagers/managers';\nimport {logger} from '../logger';\nimport apiManagerProxy from '../mtproto/mtprotoworker';\nimport CallConnectionInstance from './callConnectionInstance';\nimport CallInstanceBase from './callInstanceBase';\nimport callsController from './callsController';\nimport CALL_STATE from './callState';\nimport {GROUP_CALL_AMPLITUDE_ANALYSE_INTERVAL_MS} from './constants';\nimport parseSignalingData from './helpers/parseSignalingData';\nimport stopTrack from './helpers/stopTrack';\nimport localConferenceDescription, {ConferenceEntry, generateSsrc} from './localConferenceDescription';\nimport getCallProtocol from './p2P/getCallProtocol';\nimport getRtcConfiguration from './p2P/getRtcConfiguration';\nimport P2PEncryptor from './p2P/p2PEncryptor';\nimport {p2pParseCandidate, P2PSdpBuilder} from './p2P/p2PSdpBuilder';\nimport {parseSdp} from './sdp/utils';\nimport {WebRTCLineType} from './sdpBuilder';\nimport StreamManager from './streamManager';\nimport {AudioCodec, CallMediaState, CallSignalingData, DiffieHellmanInfo, P2PAudioCodec, P2PVideoCodec, VideoCodec} from './types';\n\nexport default class CallInstance extends CallInstanceBase<{\n  state: (state: CALL_STATE) => void,\n  id: (id: CallId, prevId: CallId) => void,\n  muted: (muted: boolean) => void,\n  mediaState: (mediaState: CallMediaState) => void,\n  acceptCallOverride: () => Promise<boolean>,\n}> {\n  public dh: Partial<DiffieHellmanInfo.a & DiffieHellmanInfo.b>;\n  public id: CallId;\n  public call: PhoneCall;\n  public interlocutorUserId: UserId;\n  public protocol: PhoneCallProtocol;\n  public isOutgoing: boolean;\n  public encryptionKey: Uint8Array;\n  public connectionInstance: CallConnectionInstance;\n  public encryptor: P2PEncryptor;\n  public decryptor: P2PEncryptor;\n  public candidates: RTCIceCandidate[];\n\n  public offerReceived: boolean;\n  public offerSent: boolean;\n\n  public createdParticipantEntries: boolean;\n  public release: () => Promise<void>;\n  public _connectionState: CALL_STATE;\n\n  public createdAt: number;\n  public connectedAt: number;\n  public discardReason: string;\n\n  private managers: AppManagers;\n\n  private hangUpTimeout: number;\n\n  private mediaStates: {\n    input: CallMediaState,\n    output?: CallMediaState\n  };\n\n  private sendMediaState: () => Promise<void>;\n\n  private decryptQueue: Uint8Array[];\n\n  private getEmojisFingerprintPromise: Promise<CallInstance['emojisFingerprint']>;\n  private emojisFingerprint: [string, string, string, string];\n\n  private wasStartingScreen: boolean;\n  private wasStartingVideo: boolean;\n  public wasTryingToJoin: boolean;\n\n  public streamManager: StreamManager;\n\n  constructor(options: {\n    isOutgoing: boolean,\n    interlocutorUserId: UserId,\n    managers: CallInstance['managers'],\n    protocol?: PhoneCallProtocol\n  }) {\n    super();\n\n    this.log = logger('CALL');\n\n    if(!this.protocol) {\n      this.protocol = getCallProtocol();\n    }\n\n    safeAssign(this, options);\n\n    this.createdAt = Date.now();\n    this.offerReceived = false;\n    this.offerSent = false;\n    this.decryptQueue = [];\n    this.candidates = [];\n\n    this.addEventListener('state', (state) => {\n      this.log('state', CALL_STATE[state]);\n\n      if(state === CALL_STATE.CLOSED) {\n        this.cleanup();\n      }\n    });\n\n    const streamManager = this.streamManager = new StreamManager(GROUP_CALL_AMPLITUDE_ANALYSE_INTERVAL_MS);\n    streamManager.direction = 'sendrecv';\n    streamManager.types.push('screencast');\n    if(!this.isOutgoing) {\n      streamManager.locked = true;\n      streamManager.canCreateConferenceEntry = false;\n    }\n\n    let mediaState: CallMediaState = {\n      '@type': 'MediaState',\n      'type': 'input',\n      'lowBattery': false,\n      'muted': true,\n      'screencastState': 'inactive',\n      'videoRotation': 0,\n      'videoState': 'inactive'\n    };\n\n    const self = this;\n    mediaState = new Proxy(mediaState, {\n      set: function(target, key, value) {\n        // @ts-ignore\n        target[key] = value;\n        self.setMediaState(mediaState);\n        self.sendMediaState();\n        return true;\n      }\n    });\n\n    this.mediaStates = {\n      input: mediaState\n    };\n\n    this.sendMediaState = debounce(this._sendMediaState.bind(this), 0, false, true);\n  }\n\n  get connectionState() {\n    const {_connectionState, connectionInstance} = this;\n    if(_connectionState !== undefined) {\n      return _connectionState;\n    } else if(!connectionInstance) {\n      return CALL_STATE.CONNECTING;\n    } else {\n      const {iceConnectionState} = connectionInstance.connection;\n      if(iceConnectionState === 'closed') {\n        return CALL_STATE.CLOSED;\n      } else if(iceConnectionState !== 'connected' && (!IS_SAFARI || iceConnectionState !== 'completed')) {\n        return CALL_STATE.CONNECTING;\n      } else {\n        return CALL_STATE.CONNECTED;\n      }\n    }\n  }\n\n  get sortIndex() {\n    const connectionState = this.connectionState;\n    const state = CALL_STATE.CLOSED - connectionState + 1;\n    let index = state * 10000000000000;\n    index += 2147483647000 - (connectionState === CALL_STATE.PENDING && this.isOutgoing ? 0 : this.createdAt);\n    return index;\n  }\n\n  public getVideoElement(type: CallMediaState['type']) {\n    if(type === 'input') return this.elements.get('main');\n    else {\n      const mediaState = this.getMediaState('output');\n      if(!mediaState) {\n        return;\n      }\n\n      const type: WebRTCLineType = mediaState.videoState === 'active' ? 'video' : (mediaState.screencastState === 'active' ? 'screencast' : undefined);\n      if(!type) {\n        return;\n      }\n\n      const entry = this.description.findEntry((entry) => entry.type === type);\n      if(!entry) {\n        return;\n      }\n\n      return this.elements.get('' + entry.recvEntry.source);\n    }\n  }\n\n  public async startScreenSharingInternal() {\n    try {\n      this.wasStartingScreen = true;\n      this.wasStartingVideo = false;\n      this.streamManager.types = ['audio', 'screencast'];\n      await this.requestScreen();\n    } catch(err) {\n      this.log.error('startScreenSharing error', err);\n    }\n  }\n\n  public async toggleScreenSharing() {\n    if(this.isSharingVideo) {\n      await this.stopVideoSharing();\n    }\n\n    if(this.isSharingScreen) {\n      return this.stopVideoSharing();\n    } else {\n      return this.startScreenSharingInternal();\n    }\n  }\n\n  public async startVideoSharingInternal() {\n    try {\n      this.wasStartingScreen = false;\n      this.wasStartingVideo = true;\n      this.streamManager.types = ['audio', 'video'];\n      await this.requestInputSource(false, true, false);\n    } catch(err) {\n      this.log.error('startVideoSharing error', err);\n    }\n  }\n\n  public async stopVideoSharing() {\n    const mediaState = this.getMediaState('input');\n    mediaState.videoState = mediaState.screencastState = 'inactive';\n\n    const {streamManager, description} = this;\n    const track = streamManager.inputStream.getVideoTracks()[0];\n    if(track) {\n      stopTrack(track);\n      streamManager.appendToConference(description); // clear sender track\n    }\n  }\n\n  public async toggleVideoSharing() {\n    if(this.isSharingScreen) {\n      await this.stopVideoSharing();\n    }\n\n    if(this.isSharingVideo) {\n      return this.stopVideoSharing();\n    } else {\n      return this.startVideoSharingInternal();\n    }\n  }\n\n  public getMediaState(type: CallMediaState['type']) {\n    return this.mediaStates[type];\n  }\n\n  public setMediaState(mediaState: CallMediaState) {\n    this.mediaStates[mediaState.type] = mediaState;\n    this.dispatchEvent('mediaState', mediaState);\n  }\n\n  public isSharingVideoType(type: 'video' | 'screencast') {\n    try {\n      const hasVideoTrack = super.isSharingVideo;\n      return hasVideoTrack && !!((this.wasStartingScreen && type === 'screencast') || (this.wasStartingVideo && type === 'video'));\n\n      // ! it will be used before the track appears\n      // return !!this.description.entries.find((entry) => entry.type === type && entry.transceiver.sender.track.enabled);\n    } catch(err) {\n      return false;\n    }\n  }\n\n  public get isSharingVideo() {\n    return this.isSharingVideoType('video');\n  }\n\n  public get isSharingScreen() {\n    return this.isSharingVideoType('screencast');\n  }\n\n  public get isMuted() {\n    const audioTrack = this.streamManager.inputStream.getAudioTracks()[0];\n    return !audioTrack?.enabled;\n  }\n\n  public get isClosing() {\n    const {connectionState} = this;\n    return connectionState === CALL_STATE.CLOSING || connectionState === CALL_STATE.CLOSED;\n  }\n\n  public get description(): localConferenceDescription {\n    return this.connectionInstance?.description;\n  }\n\n  public setHangUpTimeout(timeout: number, reason: PhoneCallDiscardReason['_']) {\n    this.clearHangUpTimeout();\n    this.hangUpTimeout = ctx.setTimeout(() => {\n      this.hangUpTimeout = undefined;\n      this.hangUp(reason);\n    }, timeout);\n  }\n\n  public clearHangUpTimeout() {\n    if(this.hangUpTimeout !== undefined) {\n      clearTimeout(this.hangUpTimeout);\n      this.hangUpTimeout = undefined;\n    }\n  }\n\n  public setPhoneCall(phoneCall: PhoneCall) {\n    this.call = phoneCall;\n\n    const {id} = phoneCall;\n    if(this.id !== id) {\n      const prevId = this.id;\n      this.id = id;\n      this.dispatchEvent('id', id, prevId);\n    }\n  }\n\n  public async acceptCall() {\n    const canAccept = (await Promise.all(this.dispatchResultableEvent('acceptCallOverride')))[0] ?? true;\n    if(this.isClosing || !canAccept) {\n      return;\n    }\n\n    // this.clearHangUpTimeout();\n    this.overrideConnectionState(CALL_STATE.EXCHANGING_KEYS);\n\n    const call = this.call as PhoneCall.phoneCallRequested;\n    this.requestInputSource(true, !!call.pFlags.video, false);\n\n    const g_a_hash = call.g_a_hash;\n    this.managers.appCallsManager.generateDh().then(async(dh) => {\n      this.dh = { // ! it is correct\n        g_a_hash,\n        b: dh.a,\n        g_b: dh.g_a,\n        g_b_hash: dh.g_a_hash,\n        p: dh.p\n      };\n\n      return this.managers.apiManager.invokeApi('phone.acceptCall', {\n        peer: await this.managers.appCallsManager.getCallInput(this.id),\n        protocol: this.protocol,\n        g_b: this.dh.g_b\n      });\n    }).then(async(phonePhoneCall) => {\n      await this.managers.appCallsManager.savePhonePhoneCall(phonePhoneCall);\n    }).catch((err) => {\n      this.log.error('accept call error', err);\n      // if(err.type === 'CALL_PROTOCOL_COMPAT_LAYER_INVALID') {\n\n      // }\n\n      this.hangUp('phoneCallDiscardReasonHangup');\n    });\n  }\n\n  public joinCall() {\n    this.log('joinCall');\n\n    this.getEmojisFingerprint();\n\n    this.overrideConnectionState();\n\n    const {isOutgoing, encryptionKey, streamManager} = this;\n\n    const configuration = getRtcConfiguration(this.call as PhoneCall.phoneCall);\n    this.log('joinCall configuration', configuration);\n    if(!configuration) return;\n\n    const connectionInstance = this.connectionInstance = new CallConnectionInstance({\n      call: this,\n      streamManager,\n      log: this.log.bindPrefix('connection')\n    });\n\n    const connection = connectionInstance.createPeerConnection(configuration);\n    connection.addEventListener('iceconnectionstatechange', () => {\n      const state = this.connectionState;\n      if(this.connectedAt === undefined && state === CALL_STATE.CONNECTED) {\n        this.connectedAt = Date.now();\n      }\n\n      this.dispatchEvent('state', state);\n    });\n    connection.addEventListener('negotiationneeded', () => {\n      connectionInstance.negotiate();\n    });\n    connection.addEventListener('icecandidate', (event) => {\n      const {candidate} = event;\n      connection.log('onicecandidate', candidate);\n      if(candidate?.candidate) {\n        this.sendIceCandidate(candidate);\n      }\n    });\n    connection.addEventListener('track', (event) => {\n      const {track} = event;\n      connection.log('ontrack', track);\n      this.onTrack(event);\n    });\n\n    const description = connectionInstance.createDescription();\n\n    this.encryptor = new P2PEncryptor(isOutgoing, encryptionKey);\n    this.decryptor = new P2PEncryptor(!isOutgoing, encryptionKey);\n\n    this.log('currentCall', this);\n\n    if(isOutgoing) {\n      connectionInstance.appendStreamToConference();\n    }\n\n    this.createDataChannel();\n\n    this.processDecryptQueue();\n  }\n\n  private createDataChannelEntry() {\n    const dataChannelEntry = this.description.createEntry('application');\n    dataChannelEntry.setDirection('sendrecv');\n    dataChannelEntry.sendEntry = dataChannelEntry.recvEntry = dataChannelEntry;\n  }\n\n  private createDataChannel() {\n    if(this.connectionInstance.dataChannel) {\n      return;\n    }\n\n    const channel = this.connectionInstance.createDataChannel({\n      id: 0,\n      negotiated: true\n    });\n    channel.addEventListener('message', (e) => {\n      this.applyDataChannelData(JSON.parse(e.data));\n    });\n    channel.addEventListener('open', () => {\n      this.sendMediaState();\n    });\n  }\n\n  private applyDataChannelData(data: CallMediaState) {\n    switch(data['@type']) {\n      case 'MediaState': {\n        data.type = 'output';\n        this.log('got output media state', data);\n        this.setMediaState(data);\n        break;\n      }\n\n      default:\n        this.log.error('unknown data channel data:', data);\n        break;\n    }\n  }\n\n  private _sendMediaState() {\n    const {connectionInstance} = this;\n    if(!connectionInstance) return;\n\n    const mediaState = {...this.getMediaState('input')};\n    // mediaState.videoRotation = 90;\n    delete mediaState.type;\n    this.log('sendMediaState', mediaState);\n\n    connectionInstance.sendDataChannelData(mediaState);\n  }\n\n  public async sendCallSignalingData(data: CallSignalingData) {\n    /* if(data['@type'] === 'InitialSetup') {\n      this.filterNotVP8(data);\n    } */\n\n    const json = JSON.stringify(data);\n    const arr = new TextEncoder().encode(json);\n    const {bytes} = await this.encryptor.encryptRawPacket(arr);\n\n    this.log('sendCallSignalingData', this.id, json);\n    await this.managers.apiManager.invokeApi('phone.sendSignalingData', {\n      peer: await this.managers.appCallsManager.getCallInput(this.id),\n      data: bytes\n    });\n  }\n\n  public sendIceCandidate(iceCandidate: RTCIceCandidate) {\n    this.log('sendIceCandidate', iceCandidate);\n    const {candidate, sdpMLineIndex} = iceCandidate;\n    if(sdpMLineIndex !== 0) {\n      return;\n    }\n\n    const parsed = p2pParseCandidate(candidate);\n    // const parsed = {sdpString: candidate};\n    /* if(parsed.address.ip !== '') {\n      return;\n    } */\n\n    this.sendCallSignalingData({\n      '@type': 'Candidates',\n      'candidates': [parsed]\n    });\n  }\n\n  public async confirmCall() {\n    const {protocol, id, call} = this;\n    const dh = this.dh as DiffieHellmanInfo.a;\n\n    // this.clearHangUpTimeout();\n    this.overrideConnectionState(CALL_STATE.EXCHANGING_KEYS);\n    const {key, key_fingerprint} = await this.managers.appCallsManager.computeKey((call as PhoneCall.phoneCallAccepted).g_b, dh.a, dh.p);\n\n    const phonePhoneCall = await this.managers.apiManager.invokeApi('phone.confirmCall', {\n      peer: await this.managers.appCallsManager.getCallInput(id),\n      protocol: protocol,\n      g_a: dh.g_a,\n      key_fingerprint: key_fingerprint\n    });\n\n    this.encryptionKey = key;\n    await this.managers.appCallsManager.savePhonePhoneCall(phonePhoneCall);\n    this.joinCall();\n  }\n\n  public getEmojisFingerprint() {\n    if(this.emojisFingerprint) return this.emojisFingerprint;\n    if(this.getEmojisFingerprintPromise) return this.getEmojisFingerprintPromise;\n    return this.getEmojisFingerprintPromise = apiManagerProxy.invokeCrypto('get-emojis-fingerprint', this.encryptionKey, this.dh.g_a).then((codePoints) => {\n      this.getEmojisFingerprintPromise = undefined;\n      return this.emojisFingerprint = codePoints.map((codePoints) => emojiFromCodePoints(codePoints)) as [string, string, string, string];\n    });\n  }\n\n  private unlockStreamManager() {\n    this.connectionInstance.streamManager.locked = false;\n    this.connectionInstance.appendStreamToConference();\n  }\n\n  private async doTheMagic() {\n    this.connectionInstance.appendStreamToConference();\n\n    const connection = this.connectionInstance.connection;\n\n    let answer = await connection.createAnswer();\n\n    this.log('[sdp] local', answer.type, answer.sdp);\n    await connection.setLocalDescription(answer);\n\n    connection.getTransceivers().filter((transceiver) => transceiver.direction === 'recvonly').forEach((transceiver) => {\n      const entry = this.connectionInstance.description.getEntryByMid(transceiver.mid);\n      entry.transceiver = entry.recvEntry.transceiver = transceiver;\n      transceiver.direction = 'sendrecv';\n    });\n\n    const isAnswer = false;\n\n    const description = this.description;\n    const bundle = description.entries.map((entry) => entry.mid);\n    const sdpDescription: RTCSessionDescriptionInit = {\n      type: isAnswer ? 'answer' : 'offer',\n      sdp: description.generateSdp({\n        bundle,\n        entries: description.entries.filter((entry) => bundle.includes(entry.mid)),\n        // isAnswer: isAnswer\n        isAnswer: !isAnswer\n      })\n    };\n\n    await connection.setRemoteDescription(sdpDescription);\n\n    answer = await connection.createAnswer();\n\n    await connection.setLocalDescription(answer);\n\n    const initialSetup = parseSignalingData(parseSdp(answer.sdp));\n    this.log('[InitialSetup] send 1');\n    this.sendCallSignalingData(initialSetup);\n\n    this.unlockStreamManager();\n  }\n\n  public overrideConnectionState(state?: CALL_STATE) {\n    this._connectionState = state;\n    this.dispatchEvent('state', this.connectionState);\n  }\n\n  public get duration() {\n    return this.connectedAt !== undefined ? (Date.now() - this.connectedAt) / 1000 | 0 : 0;\n  }\n\n  protected onInputStream(stream: MediaStream): void {\n    super.onInputStream(stream);\n\n    const videoTrack = stream.getVideoTracks()[0];\n    if(videoTrack) {\n      const state = this.getMediaState('input');\n\n      // handle starting camera\n      if(!this.wasStartingScreen && !this.wasStartingVideo) {\n        this.wasStartingVideo = true;\n      }\n\n      if(this.isSharingVideo) {\n        state.videoState = 'active';\n      } else if(this.isSharingScreen) {\n        state.screencastState = 'active';\n      }\n\n      videoTrack.addEventListener('ended', () => {\n        this.stopVideoSharing();\n      }, {once: true});\n    }\n\n    if(stream.getAudioTracks().length) {\n      this.onMutedChange();\n    }\n  }\n\n  private onMutedChange() {\n    const isMuted = this.isMuted;\n    this.dispatchEvent('muted', isMuted);\n\n    const state = this.getMediaState('input');\n    state.muted = isMuted;\n  }\n\n  public toggleMuted(): Promise<void> {\n    return this.requestAudioSource(true).then(() => {\n      this.setMuted();\n      this.onMutedChange();\n    });\n  }\n\n  public async hangUp(discardReason?: PhoneCallDiscardReason['_'], discardedByOtherParty?: boolean) {\n    if(this.isClosing) {\n      return;\n    }\n\n    this.discardReason = discardReason;\n    this.log('hangUp', discardReason);\n    this.overrideConnectionState(CALL_STATE.CLOSED);\n\n    if(this.connectionInstance) {\n      this.connectionInstance.closeConnectionAndStream(true);\n    }\n\n    if(discardReason && !discardedByOtherParty) {\n      let hasVideo = false;\n      for(const type in this.mediaStates) {\n        const mediaState = this.mediaStates[type as 'input' | 'output'];\n        hasVideo = mediaState.videoState === 'active' || mediaState.screencastState === 'active' || hasVideo;\n      }\n\n      await this.managers.appCallsManager.discardCall(this.id, this.duration, discardReason, hasVideo);\n    }\n  }\n\n  private performCodec(_codec: P2PAudioCodec | P2PVideoCodec) {\n    const payloadTypes: AudioCodec['payload-types'] = _codec.payloadTypes.map((payloadType) => {\n      return {\n        ...payloadType,\n        'rtcp-fbs': payloadType.feedbackTypes\n      }\n    });\n\n    const codec: AudioCodec = {\n      'rtp-hdrexts': _codec.rtpExtensions,\n      'payload-types': payloadTypes\n    };\n\n    return codec;\n  }\n\n  private setDataToDescription(data: CallSignalingData.initialSetup) {\n    this.description.setData({\n      transport: {\n        'pwd': data.pwd,\n        'ufrag': data.ufrag,\n        'fingerprints': data.fingerprints,\n        'rtcp-mux': true\n      },\n      audio: this.performCodec(data.audio),\n      video: data.video ? this.performCodec(data.video) as VideoCodec : undefined,\n      screencast: data.screencast ? this.performCodec(data.screencast) as VideoCodec : undefined\n    });\n  }\n\n  private filterNotVP8(initialSetup: CallSignalingData.initialSetup) {\n    if(!this.isOutgoing) { // only VP8 works now\n      [initialSetup.video, initialSetup.screencast].filter(Boolean).forEach((codec) => {\n        const payloadTypes = codec.payloadTypes;\n        const idx = payloadTypes.findIndex((payloadType) => payloadType.name === 'VP8');\n        const vp8PayloadType = payloadTypes[idx];\n        const rtxIdx = payloadTypes.findIndex((payloadType) => +payloadType.parameters?.apt === vp8PayloadType.id);\n        codec.payloadTypes = [payloadTypes[idx], payloadTypes[rtxIdx]];\n      });\n    }\n  }\n\n  public async applyCallSignalingData(data: CallSignalingData) {\n    this.log('applyCallSignalingData', this, data);\n\n    const {connection, description} = this.connectionInstance;\n\n    switch(data['@type']) {\n      case 'InitialSetup': {\n        this.log('[sdp] InitialSetup', data);\n\n        this.filterNotVP8(data);\n        this.setDataToDescription(data);\n\n        const performSsrcGroups = (ssrcGroups: P2PVideoCodec['ssrcGroups']): GroupCallParticipantVideoSourceGroup[] => {\n          return ssrcGroups.map((ssrcGroup) => {\n            return {\n              _: 'groupCallParticipantVideoSourceGroup',\n              semantics: ssrcGroup.semantics,\n              sources: ssrcGroup.ssrcs.map((source) => +source)\n            };\n          });\n        };\n\n        const ssrcs = [\n          generateSsrc('audio', +data.audio.ssrc),\n          data.video ? generateSsrc('video', performSsrcGroups(data.video.ssrcGroups)) : undefined,\n          data.screencast ? generateSsrc('screencast', performSsrcGroups(data.screencast.ssrcGroups)) : undefined\n        ].filter(Boolean);\n\n        ssrcs.forEach((ssrc) => {\n          let entry = description.getEntryBySource(ssrc.source);\n          if(entry) {\n            return;\n          }\n\n          const sendRecvEntry = description.findFreeSendRecvEntry(ssrc.type, false);\n          entry = new ConferenceEntry(sendRecvEntry.mid, ssrc.type);\n          entry.setDirection('sendrecv');\n          sendRecvEntry.recvEntry = entry;\n\n          description.setEntrySource(entry, ssrc.sourceGroups || ssrc.source);\n        });\n\n        this.createDataChannelEntry();\n\n        const isAnswer = this.offerSent;\n        this.offerSent = false;\n\n        const bundle = description.entries.map((entry) => entry.mid);\n        const sdpDescription: RTCSessionDescriptionInit = {\n          type: isAnswer ? 'answer' : 'offer',\n          sdp: description.generateSdp({\n            bundle,\n            entries: description.entries.filter((entry) => bundle.includes(entry.mid)),\n            // isAnswer: isAnswer\n            isAnswer: !isAnswer\n          })\n        };\n\n        this.log('[sdp] remote', sdpDescription.sdp);\n\n        await connection.setRemoteDescription(sdpDescription);\n\n        await this.tryToReleaseCandidates();\n\n        if(!isAnswer) {\n          await this.doTheMagic();\n        }\n\n        break;\n      }\n\n      case 'Candidates': {\n        for(const candidate of data.candidates) {\n          const init: RTCIceCandidateInit = P2PSdpBuilder.generateCandidate(candidate);\n          init.sdpMLineIndex = 0;\n          const iceCandidate = new RTCIceCandidate(init);\n          this.candidates.push(iceCandidate);\n        }\n\n        await this.tryToReleaseCandidates();\n        break;\n      }\n\n      default: {\n        this.log.error('unrecognized signaling data', data);\n      }\n    }\n  }\n\n  public async tryToReleaseCandidates() {\n    const {connectionInstance} = this;\n    if(!connectionInstance) {\n      return;\n    }\n\n    const {connection} = connectionInstance;\n    if(connection.remoteDescription) {\n      const promises: Promise<void>[] = this.candidates.map((candidate) => this.addIceCandidate(connection, candidate));\n      this.candidates.length = 0;\n\n      await Promise.all(promises);\n    } else {\n      this.log('[candidates] postpone');\n    }\n  }\n\n  private async addIceCandidate(connection: RTCPeerConnection, candidate: RTCIceCandidate) {\n    this.log('[candidate] start', candidate);\n    try {\n      // if(!candidate.address) return;\n      await connection.addIceCandidate(candidate);\n      this.log('[candidate] add', candidate);\n    } catch(e) {\n      this.log.error('[candidate] error', candidate, e);\n    }\n  }\n\n  private async processDecryptQueue() {\n    const {encryptor} = this;\n    if(!encryptor) {\n      this.log.warn('got encrypted signaling data before the encryption key');\n      return;\n    }\n\n    const length = this.decryptQueue.length;\n    if(!length) {\n      return;\n    }\n\n    const queue = this.decryptQueue.slice();\n    this.decryptQueue.length = 0;\n\n    for(const data of queue) {\n      const decryptedData = await encryptor.decryptRawPacket(data);\n      if(!decryptedData) {\n        continue;\n      }\n\n      // this.log('[update] updateNewCallSignalingData', update, decryptedData);\n\n      const str = new TextDecoder().decode(decryptedData);\n      try {\n        const signalingData: CallSignalingData = JSON.parse(str);\n        this.log('[update] updateNewCallSignalingData', signalingData);\n        this.applyCallSignalingData(signalingData);\n      } catch(err) {\n        this.log.error('wrong signaling data', str);\n        this.hangUp('phoneCallDiscardReasonDisconnect');\n        callsController.dispatchEvent('incompatible', this.interlocutorUserId);\n      }\n    }\n  }\n\n  public onUpdatePhoneCallSignalingData(data: Uint8Array) {\n    this.decryptQueue.push(data);\n    this.processDecryptQueue();\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n *\n * Originally from:\n * https://github.com/evgeny-nadymov/telegram-react\n * Copyright (C) 2018 Evgeny Nadymov\n * https://github.com/evgeny-nadymov/telegram-react/blob/master/LICENSE\n */\n\nimport {PhoneCallProtocol} from '../../../layer';\n\nexport default function getCallProtocol(): PhoneCallProtocol {\n  return {\n    _: 'phoneCallProtocol',\n    pFlags: {\n      udp_p2p: true,\n      udp_reflector: true\n    },\n    min_layer: 92,\n    max_layer: 92,\n    library_versions: ['4.0.0']\n  };\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n *\n * Originally from:\n * https://github.com/evgeny-nadymov/telegram-react\n * Copyright (C) 2018 Evgeny Nadymov\n * https://github.com/evgeny-nadymov/telegram-react/blob/master/LICENSE\n */\n\nimport {PhoneCall} from '../../../layer';\n\nexport default function getRtcConfiguration(call: PhoneCall.phoneCall): RTCConfiguration {\n  const iceServers: RTCIceServer[] = [];\n  call.connections.forEach((connection) => {\n    switch(connection._) {\n      /* case 'callServerTypeTelegramReflector': {\n        break;\n      } */\n      case 'phoneConnectionWebrtc': {\n        const {ip, ipv6, port, username, password} = connection;\n        const urls: string[] = [];\n        if(connection.pFlags.turn) {\n          if(ip) {\n            urls.push(`turn:${ip}:${port}`);\n          }\n          if(ipv6) {\n            urls.push(`turn:[${ipv6}]:${port}`);\n          }\n        } else if(connection.pFlags.stun) {\n          if(ip) {\n            urls.push(`stun:${ip}:${port}`);\n          }\n          if(ipv6) {\n            urls.push(`stun:[${ipv6}]:${port}`);\n          }\n        }\n\n        if(urls.length > 0) {\n          iceServers.push({\n            urls,\n            username,\n            credential: password\n          });\n        }\n        break;\n      }\n    }\n  });\n\n  return {\n    iceServers,\n    iceTransportPolicy: call.pFlags.p2p_allowed ? 'all' : 'relay'\n  };\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport getScreenStream from './getScreenStream';\nimport getStream from './getStream';\n\n/**\n * ! Use multiple constraints together only with first invoke\n */\nexport default function getStreamCached() {\n  const _cache: {\n    main: Partial<{\n      audio: Promise<MediaStream>,\n      video: Promise<MediaStream>\n    }>,\n    screen: Partial<{\n      audio: Promise<MediaStream>,\n      video: Promise<MediaStream>\n    }>\n  } = {\n    main: {},\n    screen: {}\n  };\n\n  return async(options: {\n    isScreen: true,\n    constraints: DisplayMediaStreamConstraints,\n  } | {\n    isScreen?: false,\n    constraints: MediaStreamConstraints,\n    muted: boolean\n  }) => {\n    const {isScreen, constraints} = options;\n    const cache = _cache[isScreen ? 'screen' : 'main'];\n    let promise: Promise<MediaStream> = cache[constraints.audio ? 'audio' : 'video'];\n\n    if(!promise) {\n      promise = (isScreen ? getScreenStream : getStream)(constraints, (options as any).muted);\n      if(constraints.audio && !cache.audio) cache.audio = promise.finally(() => cache.audio = undefined);\n      if(constraints.video && !cache.video) cache.video = promise.finally(() => cache.video = undefined);\n    }\n\n    try {\n      return await promise;\n      /* let out: Partial<{\n        audio: MediaStream,\n        video: MediaStream\n      }> = {};\n\n      await Promise.all([\n        constraints.audio && cache.audio.then((stream) => out.audio = stream),\n        constraints.video && cache.video.then((stream) => out.video = stream)\n      ].filter(Boolean));\n\n      return out; */\n    } catch(err) {\n      throw err;\n    }\n  };\n}\n\n(window as any).getStreamCached = getStreamCached;\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport EventListenerBase, {EventListenerListeners} from '../../helpers/eventListenerBase';\nimport noop from '../../helpers/noop';\nimport {logger} from '../logger';\nimport getAudioConstraints from './helpers/getAudioConstraints';\nimport getScreenConstraints from './helpers/getScreenConstraints';\nimport getStreamCached from './helpers/getStreamCached';\nimport getVideoConstraints from './helpers/getVideoConstraints';\nimport stopTrack from './helpers/stopTrack';\nimport LocalConferenceDescription from './localConferenceDescription';\nimport StreamManager, {StreamItem} from './streamManager';\n\nexport type TryAddTrackOptions = {\n  stream: MediaStream,\n  track: MediaStreamTrack,\n  type: StreamItem['type'],\n  source?: string\n};\n\nexport default abstract class CallInstanceBase<E extends EventListenerListeners> extends EventListenerBase<E> {\n  protected log: ReturnType<typeof logger>;\n  protected outputDeviceId: string;\n\n  protected player: HTMLElement;\n  protected elements: Map<string, HTMLMediaElement>;\n\n  protected audio: HTMLAudioElement;\n  // protected fixedSafariAudio: boolean;\n\n  protected getStream: ReturnType<typeof getStreamCached>;\n\n  constructor() {\n    super(false);\n\n    const player = this.player = document.createElement('div');\n    player.classList.add('call-player');\n    player.style.display = 'none';\n    document.body.append(player);\n\n    this.elements = new Map();\n\n    // possible Safari fix\n    const audio = this.audio = new Audio();\n    audio.autoplay = true;\n    audio.volume = 1.0;\n    this.player.append(audio);\n    this.elements.set('audio', audio);\n\n    this.fixSafariAudio();\n\n    this.getStream = getStreamCached();\n  }\n\n  public get isSharingAudio() {\n    return !!this.streamManager.hasInputTrackKind('audio');\n  }\n\n  public get isSharingVideo() {\n    return !!this.streamManager.hasInputTrackKind('video');\n  }\n\n  public abstract get isMuted(): boolean;\n  public abstract get isClosing(): boolean;\n\n  public fixSafariAudio() {\n    // if(this.fixedSafariAudio) return;\n    this.audio.play().catch(noop);\n    // this.fixedSafariAudio = true;\n  }\n\n  public requestAudioSource(muted: boolean) {\n    return this.requestInputSource(true, false, muted);\n  }\n\n  public requestInputSource(audio: boolean, video: boolean, muted: boolean) {\n    const {streamManager} = this;\n    if(streamManager) {\n      const isAudioGood = !audio || this.isSharingAudio;\n      const isVideoGood = !video || this.isSharingVideo;\n      if(isAudioGood && isVideoGood) {\n        return Promise.resolve();\n      }\n    }\n\n    const constraints: MediaStreamConstraints = {\n      audio: audio && getAudioConstraints(),\n      video: video && getVideoConstraints()\n    };\n\n    return this.getStream({\n      constraints,\n      muted\n    }).then((stream) => {\n      this.onInputStream(stream);\n    });\n  }\n\n  public requestScreen() {\n    return this.getStream({\n      isScreen: true,\n      constraints: getScreenConstraints(true)\n    }).then((stream) => {\n      this.onInputStream(stream);\n    });\n  }\n\n  public getElement(endpoint: number | string) {\n    return this.elements.get('' + endpoint);\n  }\n\n  public abstract get streamManager(): StreamManager;\n  public abstract get description(): LocalConferenceDescription;\n  public abstract toggleMuted(): Promise<void>;\n\n  public cleanup() {\n    this.player.textContent = '';\n    this.player.remove();\n    this.elements.clear();\n\n    // can have no connectionInstance but streamManager with input stream\n    this.streamManager.stop();\n\n    super.cleanup();\n  }\n\n  public onTrack(event: RTCTrackEvent) {\n    this.tryAddTrack({\n      stream: event.streams[0],\n      track: event.track,\n      type: 'output'\n    });\n  }\n\n  public saveInputVideoStream(stream: MediaStream, type?: string) {\n    const track = stream.getVideoTracks()[0];\n    this.tryAddTrack({\n      stream,\n      track,\n      type: 'input',\n      source: type || 'main'\n    });\n  }\n\n  public tryAddTrack({stream, track, type, source}: TryAddTrackOptions) {\n    if(!source) {\n      source = StreamManager.getSource(stream, type);\n    }\n\n    this.log('tryAddTrack', stream, track, type, source);\n\n    const isOutput = type === 'output';\n\n    const {player, elements, streamManager} = this;\n\n    const tagName = track.kind as StreamItem['kind'];\n    const isVideo = tagName === 'video';\n\n    const elementEndpoint = isVideo ? source : tagName;\n    let element = elements.get(elementEndpoint);\n\n    if(isVideo) {\n      track.addEventListener('ended', () => {\n        this.log('[track] onended');\n        elements.delete(elementEndpoint);\n        // element.remove();\n      }, {once: true});\n    }\n\n    if(isOutput) {\n      streamManager.addTrack(stream, track, type);\n    }\n\n    const useStream = isVideo ? stream : streamManager.outputStream;\n    if(!element) {\n      element = document.createElement(tagName);\n      element.autoplay = true;\n      element.srcObject = useStream;\n      element.volume = 1.0;\n\n      if((element as any).sinkId !== 'undefined') {\n        const {outputDeviceId} = this;\n        if(outputDeviceId) {\n          (element as any).setSinkId(outputDeviceId);\n        }\n      }\n\n      if(!isVideo) {\n        player.appendChild(element);\n      } else {\n        element.setAttribute('playsinline', 'true');\n        element.muted = true;\n      }\n      // audio.play();\n\n      elements.set(elementEndpoint, element);\n    } else {\n      if(element.paused) {\n        element.play().catch(noop);\n      }\n\n      // ! EVEN IF MEDIASTREAM IS THE SAME NEW TRACK WON'T PLAY WITHOUT REPLACING IT WHEN NEW PARTICIPANT IS ENTERING !\n      // if(element.srcObject !== useStream) {\n      element.srcObject = useStream;\n      // }\n    }\n\n    return source;\n  }\n\n  public setMuted(muted?: boolean) {\n    this.streamManager.inputStream.getAudioTracks().forEach((track) => {\n      if(track?.kind === 'audio') {\n        track.enabled = muted === undefined ? !track.enabled : !muted;\n      }\n    });\n  }\n\n  protected onInputStream(stream: MediaStream): void {\n    if(!this.isClosing) {\n      const videoTracks = stream.getVideoTracks();\n      if(videoTracks.length) {\n        this.saveInputVideoStream(stream, 'main');\n      }\n\n      const {streamManager, description} = this;\n      streamManager.addStream(stream, 'input');\n\n      if(description) {\n        streamManager.appendToConference(description);\n      }\n    } else { // if call is declined earlier than stream appears\n      stream.getTracks().forEach((track) => {\n        stopTrack(track);\n      });\n    }\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nenum CALL_STATE {\n  CONNECTED,\n  CONNECTING,\n  EXCHANGING_KEYS,\n  PENDING,\n  REQUESTING,\n  CLOSING,\n  CLOSED\n}\n\nexport default CALL_STATE;\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport AudioAssetPlayer from '../../helpers/audioAssetPlayer';\r\n\r\nexport type CallAudioAssetName = 'call_busy.mp3' | 'call_connect.mp3' | 'call_end.mp3' | 'call_incoming.mp3' | 'call_outgoing.mp3' | 'voip_failed.mp3' | 'voip_connecting.mp3';\r\n\r\nlet audioAsset: AudioAssetPlayer<CallAudioAssetName>;\r\nexport default function getCallAudioAsset() {\r\n  return audioAsset ??= new AudioAssetPlayer([\r\n    'call_busy.mp3',\r\n    'call_connect.mp3',\r\n    'call_end.mp3',\r\n    'call_incoming.mp3',\r\n    'call_outgoing.mp3',\r\n    'voip_failed.mp3'\r\n  ]);\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport getCallAudioAsset, {CallAudioAssetName} from '../../components/call/getAudioAsset';\r\nimport {MOUNT_CLASS_TO} from '../../config/debug';\r\nimport IS_CALL_SUPPORTED from '../../environment/callSupport';\r\nimport indexOfAndSplice from '../../helpers/array/indexOfAndSplice';\r\nimport insertInDescendSortedArray from '../../helpers/array/insertInDescendSortedArray';\r\nimport AudioAssetPlayer from '../../helpers/audioAssetPlayer';\r\nimport bytesCmp from '../../helpers/bytes/bytesCmp';\r\nimport EventListenerBase from '../../helpers/eventListenerBase';\r\nimport tsNow from '../../helpers/tsNow';\r\nimport {PhoneCallProtocol} from '../../layer';\r\nimport {CallId} from '../appManagers/appCallsManager';\r\nimport {AppManagers} from '../appManagers/managers';\r\nimport {logger} from '../logger';\r\nimport apiManagerProxy from '../mtproto/mtprotoworker';\r\nimport {NULL_PEER_ID} from '../mtproto/mtproto_config';\r\nimport rootScope from '../rootScope';\r\nimport CallInstance from './callInstance';\r\nimport CALL_STATE from './callState';\r\n\r\nconst CALL_REQUEST_TIMEOUT = 45e3;\r\n\r\nexport class CallsController extends EventListenerBase<{\r\n  instance: (details: {hasCurrent: boolean, instance: CallInstance}) => void,\r\n  accepting: (instance: CallInstance) => void, //  .    ,     topbarCall\r\n  incompatible: (userId: UserId) => void,\r\n}> {\r\n  private log: ReturnType<typeof logger>;\r\n  private managers: AppManagers;\r\n  private audioAsset: AudioAssetPlayer<CallAudioAssetName>;\r\n  private instances: Map<CallId, CallInstance>;\r\n  private sortedInstances: Array<CallInstance>;\r\n  private tempId: number;\r\n\r\n  public construct(managers: AppManagers) {\r\n    this.managers = managers;\r\n    this.log = logger('CC');\r\n\r\n    if(!IS_CALL_SUPPORTED) {\r\n      return;\r\n    }\r\n\r\n    this.audioAsset = getCallAudioAsset();\r\n    this.tempId = 0;\r\n    this.instances = new Map();\r\n    this.sortedInstances = [];\r\n\r\n    rootScope.addEventListener('call_update', async(call) => {\r\n      let instance = this.instances.get(call.id);\r\n\r\n      if(instance) {\r\n        instance.setPhoneCall(call);\r\n      }\r\n\r\n      switch(call._) {\r\n        case 'phoneCallDiscarded': {\r\n          if(instance) {\r\n            instance.hangUp(call.reason?._, true);\r\n          }\r\n\r\n          break;\r\n        }\r\n\r\n        case 'phoneCallAccepted': {\r\n          if(instance) {\r\n            /* if(!this.verifyProtocolCompatibility(call.protocol)) {\r\n              instance.hangUp('phoneCallDiscardReasonDisconnect');\r\n              rootScope.dispatchEvent('call_incompatible', instance.interlocutorUserId);\r\n              break;\r\n            } */\r\n\r\n            instance.confirmCall();\r\n          }\r\n\r\n          break;\r\n        }\r\n\r\n        case 'phoneCallRequested': {\r\n          if(!instance) {\r\n            /* if(!this.verifyProtocolCompatibility(call.protocol)) {\r\n              rootScope.dispatchEvent('call_incompatible', call.admin_id);\r\n              break;\r\n            } */\r\n\r\n            instance = this.createCallInstance({\r\n              isOutgoing: false,\r\n              interlocutorUserId: call.admin_id\r\n            });\r\n\r\n            instance.overrideConnectionState(CALL_STATE.PENDING);\r\n            instance.setPhoneCall(call);\r\n            instance.setHangUpTimeout(CALL_REQUEST_TIMEOUT, 'phoneCallDiscardReasonMissed');\r\n          }\r\n\r\n          break;\r\n        }\r\n\r\n        case 'phoneCall': {\r\n          if(!instance || instance.encryptionKey) {\r\n            break;\r\n          }\r\n\r\n          const g_a = instance.dh.g_a = call.g_a_or_b;\r\n          const dh = instance.dh;\r\n          const g_a_hash = await apiManagerProxy.invokeCrypto('sha256', g_a);\r\n          if(!bytesCmp(dh.g_a_hash, g_a_hash)) {\r\n            this.log.error('Incorrect g_a_hash', dh.g_a_hash, g_a_hash);\r\n            break;\r\n          }\r\n\r\n          const {key, key_fingerprint} = await this.managers.appCallsManager.computeKey(g_a, dh.b, dh.p);\r\n          if(call.key_fingerprint !== key_fingerprint) {\r\n            this.log.error('Incorrect key fingerprint', call.key_fingerprint, key_fingerprint, g_a, dh);\r\n            instance.hangUp('phoneCallDiscardReasonDisconnect');\r\n            break;\r\n          }\r\n\r\n          instance.encryptionKey = key;\r\n          instance.joinCall();\r\n\r\n          break;\r\n        }\r\n      }\r\n    });\r\n\r\n    rootScope.addEventListener('call_signaling', ({callId, data}) => {\r\n      const instance = this.instances.get(callId);\r\n      if(instance?.id !== callId) {\r\n        return;\r\n      }\r\n\r\n      instance.onUpdatePhoneCallSignalingData(data);\r\n    });\r\n  }\r\n\r\n  public get currentCall() {\r\n    return this.sortedInstances[0];\r\n  }\r\n\r\n  public getCallByUserId(userId: UserId) {\r\n    for(const [callId, instance] of this.instances) {\r\n      if(instance.interlocutorUserId === userId) {\r\n        return instance;\r\n      }\r\n    }\r\n  }\r\n\r\n  private createCallInstance(options: {\r\n    isOutgoing: boolean,\r\n    interlocutorUserId: UserId,\r\n    protocol?: PhoneCallProtocol\r\n  }) {\r\n    const call = new CallInstance({\r\n      managers: this.managers,\r\n      ...options\r\n    });\r\n\r\n    call.addEventListener('state', (state) => {\r\n      const currentCall = this.currentCall;\r\n      if(state === CALL_STATE.CLOSED) {\r\n        this.instances.delete(call.id);\r\n        indexOfAndSplice(this.sortedInstances, call);\r\n      } else {\r\n        insertInDescendSortedArray(this.sortedInstances, call, 'sortIndex');\r\n      }\r\n\r\n      if(state === CALL_STATE.EXCHANGING_KEYS) {\r\n        call.wasTryingToJoin = true;\r\n      }\r\n\r\n      const hasConnected = call.connectedAt !== undefined;\r\n      if(state === CALL_STATE.EXCHANGING_KEYS || (state === CALL_STATE.CONNECTING && hasConnected)) {\r\n        call.setHangUpTimeout(CALL_REQUEST_TIMEOUT, 'phoneCallDiscardReasonDisconnect');\r\n      } else {\r\n        call.clearHangUpTimeout();\r\n      }\r\n\r\n      if(currentCall === call || !currentCall) {\r\n        if(state === CALL_STATE.CLOSED) {\r\n          if(!call.isOutgoing && !call.wasTryingToJoin) { // incoming call has been accepted on other device or ended\r\n            this.audioAsset.stopSound();\r\n          } else if(call.wasTryingToJoin && !hasConnected) { // something has happened during the key exchanging\r\n            this.audioAsset.playSound('voip_failed.mp3');\r\n          } else {\r\n            this.audioAsset.playSound(call.discardReason === 'phoneCallDiscardReasonBusy' ? 'call_busy.mp3' : 'call_end.mp3');\r\n          }\r\n        } else if(state === CALL_STATE.PENDING) {\r\n          this.audioAsset.playSound(call.isOutgoing ? 'call_outgoing.mp3' : 'call_incoming.mp3', true);\r\n        } else if(state === CALL_STATE.EXCHANGING_KEYS) {\r\n          this.audioAsset.playSoundIfDifferent('call_connect.mp3');\r\n        } else if(state === CALL_STATE.CONNECTING) {\r\n          if(call.duration) {\r\n            this.audioAsset.playSound('voip_connecting.mp3', true);\r\n          }\r\n        } else {\r\n          this.audioAsset.stopSound();\r\n        }\r\n      }\r\n    });\r\n\r\n    call.addEventListener('id', (id, prevId) => {\r\n      if(prevId !== undefined) {\r\n        this.instances.delete(prevId);\r\n      }\r\n\r\n      const hasCurrent = !!this.currentCall;\r\n      this.instances.set(id, call);\r\n\r\n      if(prevId === undefined) {\r\n        this.dispatchEvent('instance', {instance: call, hasCurrent: hasCurrent});\r\n      }\r\n    });\r\n\r\n    return call;\r\n  }\r\n\r\n  public async startCallInternal(userId: UserId, isVideo: boolean) {\r\n    this.log('p2pStartCallInternal', userId, isVideo);\r\n\r\n    const fullInfo = await this.managers.appProfileManager.getProfile(userId);\r\n    if(!fullInfo) return;\r\n\r\n    const {video_calls_available} = fullInfo.pFlags;\r\n\r\n    const call = this.createCallInstance({\r\n      isOutgoing: true,\r\n      interlocutorUserId: userId\r\n    });\r\n\r\n    call.requestInputSource(true, !!(isVideo && video_calls_available), false);\r\n\r\n    call.overrideConnectionState(CALL_STATE.REQUESTING);\r\n    call.setPhoneCall({\r\n      _: 'phoneCallWaiting',\r\n      access_hash: '',\r\n      admin_id: NULL_PEER_ID,\r\n      date: tsNow(true),\r\n      id: --this.tempId,\r\n      participant_id: userId,\r\n      protocol: call.protocol,\r\n      pFlags: {\r\n        video: isVideo || undefined\r\n      }\r\n    });\r\n\r\n    // return;\r\n    this.managers.appCallsManager.generateDh().then(async(dh) => {\r\n      call.dh = dh;\r\n\r\n      return this.managers.appCallsManager.requestCall(userId, call.protocol, call.dh.g_a_hash, isVideo && video_calls_available);\r\n    }).then((phoneCall) => {\r\n      call.overrideConnectionState(CALL_STATE.PENDING);\r\n      call.setPhoneCall(phoneCall);\r\n      call.setHangUpTimeout(CALL_REQUEST_TIMEOUT, 'phoneCallDiscardReasonHangup');\r\n    });\r\n  }\r\n}\r\n\r\nconst callsController = new CallsController();\r\nMOUNT_CLASS_TO && (MOUNT_CLASS_TO.callsController = callsController);\r\nexport default callsController;\r\n","export const GROUP_CALL_AMPLITUDE_ANALYSE_COUNT_MAX = 50;\nexport const GROUP_CALL_AMPLITUDE_ANALYSE_INTERVAL_MS = 100;\nexport const GROUP_CALL_PARTICIPANTS_LOAD_LIMIT = 100;\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport forEachReverse from '../../helpers/array/forEachReverse';\nimport throttle from '../../helpers/schedulers/throttle';\nimport {GroupCallConnectionType, JoinGroupCallJsonPayload} from '../appManagers/appGroupCallsManager';\nimport {AppManagers} from '../appManagers/managers';\nimport rootScope from '../rootScope';\nimport CallConnectionInstanceBase, {CallConnectionInstanceOptions} from './callConnectionInstanceBase';\nimport GroupCallInstance from './groupCallInstance';\nimport filterServerCodecs from './helpers/filterServerCodecs';\nimport fixLocalOffer from './helpers/fixLocalOffer';\nimport processMediaSection from './helpers/processMediaSection';\nimport {ConferenceEntry} from './localConferenceDescription';\nimport SDP from './sdp';\nimport SDPMediaSection from './sdp/mediaSection';\nimport {WebRTCLineType} from './sdpBuilder';\nimport {UpdateGroupCallConnectionData} from './types';\n\nexport default class GroupCallConnectionInstance extends CallConnectionInstanceBase {\n  private groupCall: GroupCallInstance;\n  public updateConstraints?: boolean;\n  private type: GroupCallConnectionType;\n  private options: {\n    type: Extract<GroupCallConnectionType, 'main'>,\n    isMuted?: boolean,\n    joinVideo?: boolean,\n    rejoin?: boolean\n  } | {\n    type: Extract<GroupCallConnectionType, 'presentation'>,\n  };\n\n  private updateConstraintsInterval: number;\n  public negotiateThrottled: () => void;\n\n  private managers: AppManagers;\n\n  constructor(options: CallConnectionInstanceOptions & {\n    groupCall: GroupCallConnectionInstance['groupCall'],\n    type: GroupCallConnectionInstance['type'],\n    options: GroupCallConnectionInstance['options'],\n    managers: AppManagers\n  }) {\n    super(options);\n\n    this.negotiateThrottled = throttle(this.negotiate.bind(this), 0, false);\n  }\n\n  public createPeerConnection() {\n    return this.connection || super.createPeerConnection({\n      iceServers: [],\n      iceTransportPolicy: 'all',\n      bundlePolicy: 'max-bundle',\n      rtcpMuxPolicy: 'require',\n      iceCandidatePoolSize: 0\n      // sdpSemantics: \"unified-plan\",\n      // extmapAllowMixed: true,\n    });\n  }\n\n  public createDataChannel() {\n    if(this.dataChannel) {\n      return this.dataChannel;\n    }\n\n    const dataChannel = super.createDataChannel();\n\n    dataChannel.addEventListener('open', () => {\n      this.maybeUpdateRemoteVideoConstraints();\n    });\n\n    dataChannel.addEventListener('close', () => {\n      if(this.updateConstraintsInterval) {\n        clearInterval(this.updateConstraintsInterval);\n        this.updateConstraintsInterval = undefined;\n      }\n    });\n\n    return dataChannel;\n  }\n\n  public createDescription() {\n    if(this.description) {\n      return this.description;\n    }\n\n    const description = super.createDescription();\n\n    /* const perType = 0;\n    const types = ['audio' as const, 'video' as const];\n    const count = types.length * perType;\n    const init: RTCRtpTransceiverInit = {direction: 'recvonly'};\n    types.forEach((type) => {\n      for(let i = 0; i < perType; ++i) {\n        description.createEntry(type).createTransceiver(connection, init);\n      }\n    }); */\n\n    return description;\n  }\n\n  public appendStreamToConference() {\n    super.appendStreamToConference();/* .then(() => {\n      currentGroupCall.connections.main.negotiating = false;\n      this.startNegotiation({\n        type: type,\n        isMuted: muted,\n        rejoin\n      });\n    }); */\n  }\n\n  private async invokeJoinGroupCall(localSdp: SDP, mainChannels: SDPMediaSection[], options: GroupCallConnectionInstance['options']) {\n    const {groupCall, description} = this;\n    const groupCallId = groupCall.id;\n\n    const processedChannels = mainChannels.map((section) => {\n      const processed = processMediaSection(localSdp, section);\n\n      this.sources[processed.entry.type as 'video' | 'audio'] = processed.entry;\n\n      return processed;\n    });\n\n    const audioChannel = processedChannels.find((channel) => channel.media.mediaType === 'audio');\n    const videoChannel = processedChannels.find((channel) => channel.media.mediaType === 'video');\n    let {source, params} = audioChannel || {};\n    const useChannel = videoChannel || audioChannel;\n\n    const channels: {[type in WebRTCLineType]?: typeof audioChannel} = {\n      audio: audioChannel,\n      video: videoChannel\n    };\n\n    description.entries.forEach((entry) => {\n      if(entry.direction === 'sendonly') {\n        const channel = channels[entry.type];\n        if(!channel) return;\n\n        description.setEntrySource(entry, channel.sourceGroups || channel.source);\n        description.setEntryPeerId(entry, rootScope.myId);\n      }\n    });\n\n    // overwrite ssrc with audio in video params\n    if(params !== useChannel.params) {\n      const data: JoinGroupCallJsonPayload = JSON.parse(useChannel.params.data);\n      // data.ssrc = source || data.ssrc - 1; // audio channel can be missed in screensharing\n      if(source) data.ssrc = source;\n      else delete data.ssrc;\n      params = {\n        _: 'dataJSON',\n        data: JSON.stringify(data)\n      };\n    }\n\n    const update = await this.managers.appGroupCallsManager.joinGroupCall(groupCallId, params, options);\n\n    const data: UpdateGroupCallConnectionData = JSON.parse(update.params.data);\n\n    data.audio = data.audio || groupCall.connections.main.description.audio;\n    description.setData(data);\n    filterServerCodecs(mainChannels, data);\n\n    return data;\n  }\n\n  protected async negotiateInternal() {\n    const {connection, description} = this;\n    const isNewConnection = connection.iceConnectionState === 'new' && !description.getEntryByMid('0').source;\n    const log = this.log.bindPrefix('startNegotiation');\n    log('start');\n\n    const originalOffer = await connection.createOffer({iceRestart: false});\n\n    if(isNewConnection && this.dataChannel) {\n      const dataChannelEntry = description.createEntry('application');\n      dataChannelEntry.setDirection('sendrecv');\n    }\n\n    const {sdp: localSdp, offer} = fixLocalOffer({\n      offer: originalOffer,\n      data: description\n    });\n\n    log('[sdp] setLocalDescription', offer.sdp);\n    await connection.setLocalDescription(offer);\n\n    const mainChannels = localSdp.media.filter((media) => {\n      return media.mediaType !== 'application' && media.isSending;\n    });\n\n    if(isNewConnection) {\n      try {\n        await this.invokeJoinGroupCall(localSdp, mainChannels, this.options);\n      } catch(e) {\n        this.log.error('[tdweb] joinGroupCall error', e);\n      }\n    }\n\n    /* if(!data) {\n      log('abort 0');\n      this.closeConnectionAndStream(connection, streamManager);\n      return;\n    } */\n\n    /* if(connection.iceConnectionState !== 'new') {\n      log(`abort 1 connectionState=${connection.iceConnectionState}`);\n      this.closeConnectionAndStream(connection, streamManager);\n      return;\n    } */\n    /* if(this.currentGroupCall !== currentGroupCall || connectionHandler.connection !== connection) {\n      log('abort', this.currentGroupCall, currentGroupCall);\n      this.closeConnectionAndStream(connection, streamManager);\n      return;\n    } */\n\n    const isAnswer = true;\n    // const _bundleMids = bundleMids.slice();\n    const entriesToDelete: ConferenceEntry[] = [];\n    const bundle = localSdp.bundle;\n    forEachReverse(bundle, (mid, idx, arr) => {\n      const entry = description.getEntryByMid(mid);\n      if(entry.shouldBeSkipped(isAnswer)) {\n        arr.splice(idx, 1);\n        entriesToDelete.push(entry);\n      }\n    });\n\n    /* forEachReverse(description.entries, (entry, idx, arr) => {\n      const mediaSection = _parsedSdp.media.find((section) => section.oa.get('mid').oa === entry.mid);\n      const deleted = !mediaSection;\n      // const deleted = !_bundleMids.includes(entry.mid); // ! can't use it because certain mid can be missed in bundle\n      if(deleted) {\n        arr.splice(idx, 1);\n      }\n    }); */\n\n    const entries = localSdp.media.map((section) => {\n      const mid = section.mid;\n      let entry = description.getEntryByMid(mid);\n      if(!entry) {\n        entry = new ConferenceEntry(mid, section.mediaType);\n        entry.setDirection('inactive');\n      }\n\n      return entry;\n    });\n\n    const answerDescription: RTCSessionDescriptionInit = {\n      type: 'answer',\n      sdp: description.generateSdp({\n        bundle,\n        entries,\n        isAnswer\n      })\n    };\n\n    entriesToDelete.forEach((entry) => {\n      description.deleteEntry(entry);\n    });\n\n    log(`[sdp] setRemoteDescription signaling=${connection.signalingState} ice=${connection.iceConnectionState} gathering=${connection.iceGatheringState} connection=${connection.connectionState}`, answerDescription.sdp);\n    await connection.setRemoteDescription(answerDescription);\n\n    log('end');\n  }\n\n  public negotiate() {\n    let promise = this.negotiating;\n    if(promise) {\n      return promise;\n    }\n\n    promise = super.negotiate();\n\n    if(this.updateConstraints) {\n      promise.then(() => {\n        this.maybeUpdateRemoteVideoConstraints();\n        this.updateConstraints = false;\n      });\n    }\n\n    if(this.options.type === 'presentation') {\n      promise.then(() => {\n        this.connection.getTransceivers().find((transceiver) => {\n          if(transceiver.sender?.track?.kind === 'video') {\n            transceiver.sender.setParameters({\n              ...transceiver.sender.getParameters(),\n              degradationPreference: 'maintain-resolution'\n            });\n          }\n        });\n      });\n    }\n\n    return promise;\n  }\n\n  public maybeUpdateRemoteVideoConstraints() {\n    if(this.dataChannel.readyState !== 'open') {\n      return;\n    }\n\n    this.log('maybeUpdateRemoteVideoConstraints');\n\n    // * https://github.com/TelegramMessenger/tgcalls/blob/6f2746e04c9b040f8c8dfc64d916a1853d09c4ce/tgcalls/group/GroupInstanceCustomImpl.cpp#L2549\n    type VideoConstraints = {minHeight?: number, maxHeight: number};\n    const obj: {\n      colibriClass: 'ReceiverVideoConstraints',\n      constraints: {[endpoint: string]: VideoConstraints},\n      defaultConstraints: VideoConstraints,\n      onStageEndpoints: string[]\n    } = {\n      colibriClass: 'ReceiverVideoConstraints',\n      constraints: {},\n      defaultConstraints: {maxHeight: 0},\n      onStageEndpoints: []\n    };\n\n    for(const entry of this.description.entries) {\n      if(entry.direction !== 'recvonly' || entry.type !== 'video') {\n        continue;\n      }\n\n      const {endpoint} = entry;\n      obj.onStageEndpoints.push(endpoint);\n      obj.constraints[endpoint] = {\n        minHeight: 180,\n        maxHeight: 720\n      };\n    }\n\n    this.sendDataChannelData(obj);\n\n    if(!obj.onStageEndpoints.length) {\n      if(this.updateConstraintsInterval) {\n        clearInterval(this.updateConstraintsInterval);\n        this.updateConstraintsInterval = undefined;\n      }\n    } else if(!this.updateConstraintsInterval) {\n      this.updateConstraintsInterval = window.setInterval(this.maybeUpdateRemoteVideoConstraints.bind(this), 5000);\n    }\n  }\n\n  public addInputVideoStream(stream: MediaStream) {\n    // const {sources} = this;\n    // if(sources?.video) {\n    // const source = this.sources.video.source;\n    // stream.source = '' + source;\n    this.groupCall.saveInputVideoStream(stream, this.type);\n    // }\n\n    this.streamManager.addStream(stream, 'input');\n    this.appendStreamToConference(); // replace sender track\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport {DataJSON} from '../../../layer';\nimport {JoinGroupCallJsonPayload} from '../../appManagers/appGroupCallsManager';\nimport SDP from '../sdp';\nimport {Ssrc} from '../types';\nimport parseMediaSectionInfo from './parseMediaSectionInfo';\n\nexport default function processMediaSection(sdp: SDP, media: SDP['media'][0]) {\n  const sectionInfo = parseMediaSectionInfo(sdp, media);\n\n  const mediaType: Exclude<typeof media['mediaType'], 'application'> = media.mediaType as any;\n  const entry: Ssrc = {\n    source: sectionInfo.source,\n    sourceGroups: sectionInfo.sourceGroups,\n    type: mediaType\n  };\n\n  // do not change this value, otherwise onconnectionstatechange won't fire\n  sectionInfo.fingerprint.setup = 'active';\n  const payload: JoinGroupCallJsonPayload = {\n    'fingerprints': [sectionInfo.fingerprint],\n    'pwd': sectionInfo.pwd,\n    'ssrc': sectionInfo.source,\n    'ssrc-groups': sectionInfo.sourceGroups || [],\n    'ufrag': sectionInfo.ufrag\n  };\n  const paramsDataJson = JSON.stringify(payload);\n\n  const params: DataJSON = {\n    _: 'dataJSON',\n    data: paramsDataJson\n  };\n\n  return {\n    params,\n    source: sectionInfo.source,\n    media,\n    sourceGroups: sectionInfo.sourceGroups,\n    entry\n  };\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport forEachReverse from '../../../helpers/array/forEachReverse';\nimport SDPMediaSection from '../sdp/mediaSection';\nimport {UpdateGroupCallConnectionData, Codec} from '../types';\n\nexport default function filterServerCodecs(mainChannels: SDPMediaSection[], data: UpdateGroupCallConnectionData) {\n  // ! Need to filter server's extmap for Firefox\n  const performExtmap = (channel: typeof mainChannels[0]) => {\n    const out: {[id: string]: string} = {};\n    const extmap = channel.attributes.get('extmap');\n    extmap.forEach((extmap) => {\n      const id = extmap.key.split('/', 1)[0];\n      out[id] = extmap.value;\n    });\n\n    return out;\n  };\n\n  const codecsToPerform: [Codec, 'audio' | 'video'][] = /* flatten([data, dataPresentation].filter(Boolean).map((data) => {\n    return  */['audio' as const, 'video' as const].filter((type) => data[type]).map((type) => ([data[type], type]));\n  // }));\n\n  codecsToPerform.forEach(([codec, type]) => {\n    const channel = mainChannels.find((line) => line.mediaType === type);\n    if(!channel) {\n      return;\n    }\n\n    const extmap = performExtmap(channel);\n    forEachReverse(codec['rtp-hdrexts'], (value, index, arr) => {\n      if(extmap[value.id] !== value.uri) {\n        arr.splice(index, 1);\n        console.log(`[sdp] filtered extmap:`, value, index, type);\n      }\n    });\n  });\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport forEachReverse from '../../../helpers/array/forEachReverse';\nimport copy from '../../../helpers/object/copy';\nimport {ConferenceEntry} from '../localConferenceDescription';\nimport {parseSdp, addSimulcast} from '../sdp/utils';\nimport {generateMediaFirstLine, SDPBuilder} from '../sdpBuilder';\nimport {UpdateGroupCallConnectionData} from '../types';\nimport parseMediaSectionInfo from './parseMediaSectionInfo';\n\nexport default function fixLocalOffer(options: {\n  offer: RTCSessionDescriptionInit,\n  data: UpdateGroupCallConnectionData,\n  skipAddingMulticast?: boolean\n  // mids?: string[]\n}) {\n  const {offer, data} = options;\n  const sdp = parseSdp(offer.sdp);\n  let hasMunged = false;\n\n  if(!options.skipAddingMulticast) {\n    hasMunged = addSimulcast(sdp) || hasMunged;\n  }\n\n  // const bundleLine = parsedSdp.session.lines.find((line) => line.Ha?.key === 'group');\n  // const bundleMids = bundleLine.value.split(' ').slice(1);\n\n  forEachReverse(sdp.media, (section, idx, arr) => {\n    // const mid = section.oa.get('mid').oa;\n\n    //        . -    \n    // !     ,  \n    /* if(mids && !mids.includes(mid) && !bundleMids.includes(mid)) {\n      console.error('wtf');\n      hasMunged = true;\n      arr.splice(idx, 1);\n      return;\n    } */\n\n    if(/* section.mediaType !== 'video' ||  */section.isSending) {\n      return;\n    }\n\n    if(section.mediaType === 'application') {\n      return;\n    }\n\n    const mediaLine = section.mediaLine;\n    const mediaLineParts = mediaLine.mediaLineParts;\n    const mediaCodecIds = mediaLineParts.ids;\n    const localMLine = mediaLine.toString();\n\n    const codec = data[section.mediaType];\n    const payloadTypes = codec['payload-types'];\n\n    /* forEachReverse(payloadTypes, (payloadType, idx, arr) => {\n      if(!mediaCodecIds.includes('' + payloadType.id) && section.mediaType === 'video') {\n      // if(payloadType.name === 'H265') {\n        console.warn('[sdp] filtered unsupported codec', payloadType, mediaCodecIds, section.mediaType);\n        arr.splice(idx, 1);\n      }\n    }); */\n\n    const codecIds = payloadTypes.map((payload) => '' + payload.id);\n    const correctMLine = generateMediaFirstLine(section.mediaType, undefined, codecIds);\n\n    if(localMLine !== correctMLine) {\n      const sectionInfo = parseMediaSectionInfo(sdp, section);\n\n      const newData = {...data};\n      newData.transport = copy(newData.transport);\n      newData.transport.ufrag = sectionInfo.ufrag;\n      newData.transport.pwd = sectionInfo.pwd;\n      newData.transport.fingerprints = [sectionInfo.fingerprint];\n      newData.transport.candidates = [];\n\n      const entry = new ConferenceEntry(sectionInfo.mid, mediaLineParts.type);\n      entry.setPort(mediaLineParts.port);\n      sectionInfo.source && entry.setSource(sectionInfo.sourceGroups || sectionInfo.source);\n      entry.setDirection(section.direction);\n\n      const newSdp = new SDPBuilder().addSsrcEntry(entry, newData).finalize();\n\n      const newChannel = parseSdp(newSdp).media[0];\n      arr[idx] = newChannel;\n\n      hasMunged = true;\n    }\n  });\n\n  if(hasMunged) {\n    const mungedSdp = sdp.toString();\n    offer.sdp = mungedSdp;\n  }\n\n  return {offer, sdp/* , bundleMids */};\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport type {GroupCallConnectionType, GroupCallId, GroupCallOutputSource} from '../appManagers/appGroupCallsManager';\nimport {IS_SAFARI} from '../../environment/userAgent';\nimport indexOfAndSplice from '../../helpers/array/indexOfAndSplice';\nimport safeAssign from '../../helpers/object/safeAssign';\nimport throttle from '../../helpers/schedulers/throttle';\nimport {GroupCall, GroupCallParticipant} from '../../layer';\nimport {logger} from '../logger';\nimport {NULL_PEER_ID} from '../mtproto/mtproto_config';\nimport rootScope from '../rootScope';\nimport CallInstanceBase, {TryAddTrackOptions} from './callInstanceBase';\nimport GroupCallConnectionInstance from './groupCallConnectionInstance';\nimport GROUP_CALL_STATE from './groupCallState';\nimport getScreenConstraints from './helpers/getScreenConstraints';\nimport getScreenStream from './helpers/getScreenStream';\nimport getStream from './helpers/getStream';\nimport getVideoConstraints from './helpers/getVideoConstraints';\nimport stopTrack from './helpers/stopTrack';\nimport localConferenceDescription from './localConferenceDescription';\nimport {WebRTCLineType} from './sdpBuilder';\nimport StreamManager from './streamManager';\nimport {Ssrc} from './types';\nimport getPeerId from '../appManagers/utils/peers/getPeerId';\nimport {AppManagers} from '../appManagers/managers';\nimport {generateSelfVideo, makeSsrcFromParticipant, makeSsrcsFromParticipant} from './groupCallsController';\n\nexport default class GroupCallInstance extends CallInstanceBase<{\n  state: (state: GROUP_CALL_STATE) => void,\n  pinned: (source?: GroupCallOutputSource) => void,\n}> {\n  public id: GroupCallId;\n  public chatId: ChatId;\n  public handleUpdateGroupCallParticipants: boolean;\n  public updatingSdp: boolean;\n  public isSpeakingMap: Map<any, any>;\n  public connections: {[k in GroupCallConnectionType]?: GroupCallConnectionInstance};\n  public groupCall: GroupCall;\n  public participant: GroupCallParticipant;\n\n  // will be set with negotiation\n  public joined: boolean;\n\n  private pinnedSources: Array<GroupCallOutputSource>;\n  private participantsSsrcs: Map<PeerId, Ssrc[]>;\n  private hadAutoPinnedSources: Set<GroupCallOutputSource>;\n  private dispatchPinnedThrottled: () => void;\n  private startVideoSharingPromise: Promise<void>;\n  private startScreenSharingPromise: Promise<void>;\n\n  private managers: AppManagers;\n\n  constructor(options: {\n    id: GroupCallInstance['id'],\n    chatId: GroupCallInstance['chatId'],\n    isSpeakingMap?: GroupCallInstance['isSpeakingMap'],\n    connections?: GroupCallInstance['connections'],\n    managers: AppManagers\n  }) {\n    super();\n\n    safeAssign(this, options);\n\n    if(!this.log) {\n      this.log = logger('GROUP-CALL');\n    }\n\n    if(!this.connections) {\n      this.connections = {};\n    }\n\n    if(!this.isSpeakingMap) {\n      this.isSpeakingMap = new Map();\n    }\n\n    this.pinnedSources = [];\n    this.participantsSsrcs = new Map();\n    this.hadAutoPinnedSources = new Set();\n    this.dispatchPinnedThrottled = throttle(() => {\n      this.dispatchEvent('pinned', this.pinnedSource);\n    }, 0, false);\n\n    this.addEventListener('state', (state) => {\n      if(state === GROUP_CALL_STATE.CLOSED) {\n        this.cleanup();\n      }\n    });\n  }\n\n  get connectionState() {\n    return this.connections.main.connection.iceConnectionState;\n  }\n\n  get state() {\n    const {connectionState} = this;\n    if(connectionState === 'closed') {\n      return GROUP_CALL_STATE.CLOSED;\n    } else if(connectionState !== 'connected' && (!IS_SAFARI || connectionState !== 'completed')) {\n      return GROUP_CALL_STATE.CONNECTING;\n    } else {\n      const {participant} = this;\n      if(!participant.pFlags.can_self_unmute) {\n        return GROUP_CALL_STATE.MUTED_BY_ADMIN;\n      } else if(participant.pFlags.muted) {\n        return GROUP_CALL_STATE.MUTED;\n      } else {\n        return GROUP_CALL_STATE.UNMUTED;\n      }\n    }\n  }\n\n  get participants() {\n    return this.managers.appGroupCallsManager.getCachedParticipants(this.id);\n  }\n\n  get isSharingScreen() {\n    return !!this.connections.presentation;\n  }\n\n  get pinnedSource() {\n    return this.pinnedSources[this.pinnedSources.length - 1];\n  }\n\n  public get isMuted() {\n    return this.state !== GROUP_CALL_STATE.UNMUTED;\n  }\n\n  public get isClosing() {\n    const {state} = this;\n    return state === GROUP_CALL_STATE.CLOSED;\n  }\n\n  public get streamManager(): StreamManager {\n    return this.connections.main.streamManager;\n  }\n\n  public get description(): localConferenceDescription {\n    return this.connections.main.description;\n  }\n\n  public pinSource(source: GroupCallOutputSource) {\n    indexOfAndSplice(this.pinnedSources, source);\n    this.pinnedSources.push(source);\n    this.dispatchPinnedThrottled();\n  }\n\n  public unpinSource(source: GroupCallOutputSource) {\n    this.hadAutoPinnedSources.delete(source);\n    indexOfAndSplice(this.pinnedSources, source);\n    this.dispatchPinnedThrottled();\n  }\n\n  public unpinAll() {\n    this.pinnedSources.length = 0;\n    this.dispatchPinnedThrottled();\n  }\n\n  public async getParticipantByPeerId(peerId: PeerId) {\n    return NULL_PEER_ID === peerId ? this.participant : (await this.participants).get(peerId);\n  }\n\n  public toggleMuted() {\n    return this.requestAudioSource(true).then(() => this.changeUserMuted(NULL_PEER_ID));\n  }\n\n  public async changeUserMuted(peerId: PeerId, muted?: boolean) {\n    const participant = await this.getParticipantByPeerId(peerId);\n    if(NULL_PEER_ID === peerId && participant.pFlags.can_self_unmute) {\n      muted = muted === undefined ? !participant.pFlags.muted : muted;\n    }\n\n    return this.editParticipant(participant, {muted});\n  }\n\n  public getElement(endpoint: GroupCallOutputSource) {\n    return super.getElement(endpoint);\n  }\n\n  public getVideoElementFromParticipantByType(participant: GroupCallParticipant, type: 'video' | 'presentation') {\n    let source: GroupCallOutputSource;\n    if(participant.pFlags.self) {\n      const connectionType: GroupCallConnectionType = type === 'video' ? 'main' : 'presentation';\n      source = connectionType;\n    } else {\n      const codec = participant[type];\n      source = codec.source_groups[0].sources[0];\n    }\n\n    const element = this.getElement(source) as HTMLVideoElement;\n    if(!element) return;\n\n    const clone = element.cloneNode() as typeof element;\n    clone.srcObject = element.srcObject;\n    return {video: clone, source};\n  }\n\n  public createConnectionInstance(options: {\n    streamManager: StreamManager,\n    type: GroupCallConnectionType,\n    options: GroupCallConnectionInstance['options'],\n  }) {\n    return this.connections[options.type] = new GroupCallConnectionInstance({\n      groupCall: this,\n      log: this.log.bindPrefix(options.type),\n      managers: this.managers,\n      ...options\n    });\n  }\n\n  public changeRaiseHand(raise: boolean) {\n    return this.editParticipant(this.participant, {raiseHand: raise});\n  }\n\n  public async startScreenSharingInternal() {\n    try {\n      const type: GroupCallConnectionType = 'presentation';\n\n      const stream = await getScreenStream(getScreenConstraints());\n      const streamManager = new StreamManager();\n\n      const connectionInstance = this.createConnectionInstance({\n        streamManager,\n        type,\n        options: {\n          type\n        }\n      });\n\n      const connection = connectionInstance.createPeerConnection();\n      connection.addEventListener('negotiationneeded', () => {\n        connectionInstance.negotiate();\n      });\n\n      stream.getVideoTracks()[0].addEventListener('ended', () => {\n        if(this.connections.presentation) { // maybe user has stopped screensharing through browser's ui\n          this.stopScreenSharing();\n        }\n      }, {once: true});\n\n      connectionInstance.createDescription();\n      connectionInstance.addInputVideoStream(stream);\n    } catch(err) {\n      this.log.error('start screen sharing error', err);\n    }\n  }\n\n  public startScreenSharing() {\n    return this.startScreenSharingPromise ??= this.startScreenSharingInternal().finally(() => {\n      this.startScreenSharingPromise = undefined;\n    });\n  }\n\n  public stopScreenSharing() {\n    const connectionInstance = this.connections.presentation;\n    if(!connectionInstance) {\n      return Promise.resolve();\n    }\n\n    delete this.connections.presentation;\n    this.unpinSource('presentation');\n    connectionInstance.closeConnectionAndStream(true);\n\n    delete this.participant.presentation;\n    this.managers.appGroupCallsManager.saveApiParticipant(this.id, this.participant);\n\n    return this.managers.appGroupCallsManager.leaveGroupCallPresentation(this.id);\n  }\n\n  public toggleScreenSharing() {\n    if(this.isSharingScreen) {\n      return this.stopScreenSharing();\n    } else {\n      return this.startScreenSharing();\n    }\n  }\n\n  public async startVideoSharingInternal() {\n    const constraints: MediaStreamConstraints = {\n      video: getVideoConstraints()\n    };\n\n    try {\n      const stream = await getStream(constraints, false);\n      const connectionInstance = this.connections.main;\n      connectionInstance.addInputVideoStream(stream);\n\n      await this.editParticipant(this.participant, {\n        videoPaused: false,\n        videoStopped: false\n      });\n    } catch(err) {\n      this.log.error('startVideoSharing error', err, constraints);\n    }\n  }\n\n  public startVideoSharing() {\n    return this.startVideoSharingPromise ??= this.startVideoSharingInternal().finally(() => {\n      this.startVideoSharingPromise = undefined;\n    });\n  }\n\n  public async stopVideoSharing() {\n    const connectionInstance = this.connections.main;\n    const track = connectionInstance.streamManager.inputStream.getVideoTracks()[0];\n    if(!track) {\n      return;\n    }\n\n    stopTrack(track);\n    connectionInstance.streamManager.appendToConference(connectionInstance.description); // clear sender track\n\n    await this.editParticipant(this.participant, {\n      videoStopped: true\n    });\n  }\n\n  public toggleVideoSharing() {\n    if(this.isSharingVideo) {\n      return this.stopVideoSharing();\n    } else {\n      return this.startVideoSharing();\n    }\n  }\n\n  public async hangUp(discard = false, rejoin = false, isDiscarded = false) {\n    for(const type in this.connections) {\n      const connection = this.connections[type as GroupCallConnectionType];\n      connection.closeConnectionAndStream(!rejoin);\n    }\n\n    this.dispatchEvent('state', this.state);\n\n    if(isDiscarded) {\n      return;\n    }\n\n    if(!rejoin) {\n      const d = discard || (this.joined ? this.connections.main.sources.audio.source : undefined);\n      this.managers.appGroupCallsManager.hangUp(this.id, d);\n    }\n  }\n\n  public tryAddTrack(options: Omit<TryAddTrackOptions, 'streamManager'>) {\n    const {description} = this;\n    const source = super.tryAddTrack(options);\n\n    if(options.type === 'output') {\n      const entry = description.getEntryBySource(+source);\n      this.getParticipantByPeerId(entry.peerId).then((participant) => {\n        if(participant) {\n          rootScope.dispatchEvent('group_call_participant', {groupCallId: this.id, participant});\n        }\n      });\n    }\n\n    return source;\n  }\n\n  public async editParticipant(participant: GroupCallParticipant, options: Partial<{\n    muted: boolean,\n    volume: number,\n    raiseHand: boolean,\n    videoStopped: boolean,\n    videoPaused: boolean,\n    presentationPaused: boolean\n  }>) {\n    if(!Object.keys(options).length) {\n      return;\n    }\n\n    // let processUpdate = true;\n    if(participant) {\n      // const {currentGroupCall} = this;\n      // const isCurrentCall = currentGroupCall?.id === groupCallId;\n      const isCurrentCall = true;\n      const isUpdatingMeInCurrentCall = isCurrentCall && participant.pFlags.self;\n\n      if(isUpdatingMeInCurrentCall) {\n        if(options.muted !== undefined && !this.isSharingAudio) {\n          delete options.muted;\n\n          if(!Object.keys(options).length) {\n            return;\n          }\n        }\n      }\n\n      // if(isCurrentCall) {\n      const muted = options.muted;\n      if(muted !== undefined) {\n        /* const isAdmin = appChatsManager.hasRights(currentGroupCall.chatId, 'manage_call');\n          if(isAdmin) {\n            if(muted) {\n              participant.pFlags.muted = true;\n              delete participant.pFlags.can_self_unmute;\n            } else {\n              participant.pFlags.can_self_unmute = true;\n            }\n          } else  */if(participant.pFlags.self) {\n          if(muted) {\n            participant.pFlags.muted = true;\n          } else if(participant.pFlags.can_self_unmute) {\n            delete participant.pFlags.muted;\n          }\n        }/*  else {\n            if(muted) {\n              participant.pFlags.muted_by_you = true;\n            } else {\n              delete participant.pFlags.muted_by_you;\n            }\n          } */\n      }\n      // }\n\n      /* const a: [keyof GroupCallParticipant['pFlags'], keyof typeof options][] = [\n        ['muted', 'muted']\n      ];\n\n      a.forEach(([key, optionKey]) => {\n        const value = options[optionKey];\n        if(value === undefined) {\n          return;\n        }\n\n        if(value) {\n          participant.pFlags[key] = true;\n        } else {\n          delete participant.pFlags[key];\n        }\n      }); */\n\n      if(options.raiseHand !== undefined) {\n        if(options.raiseHand) participant.raise_hand_rating = '1';\n        else delete participant.raise_hand_rating;\n      }\n\n      if(isUpdatingMeInCurrentCall) {\n        if(options.videoStopped !== undefined) {\n          if(options.videoStopped) delete participant.video;\n          else participant.video = generateSelfVideo(this.connections.main.sources.video);\n        }\n\n        if(!participant.pFlags.muted && participant.pFlags.can_self_unmute) {\n          this.setMuted(false);\n        }\n\n        this.dispatchEvent('state', this.state);\n      }\n\n      // rootScope.dispatchEvent('group_call_participant', {groupCallId, participant});\n\n      /* if(participant.pFlags.self) {\n        processUpdate = false;\n      } */\n    }\n\n    return this.managers.appGroupCallsManager.editParticipant(this.id, participant, options);\n  }\n\n  public onParticipantUpdate(participant: GroupCallParticipant, doNotDispatchParticipantUpdate?: PeerId) {\n    const connectionInstance = this.connections.main;\n    const {connection, description} = connectionInstance;\n\n    const peerId = getPeerId(participant.peer);\n    const hasLeft = !!participant.pFlags.left;\n    const oldSsrcs = this.participantsSsrcs.get(peerId) || [];\n\n    if(participant.presentation && !hasLeft) {\n      const {source} = makeSsrcFromParticipant(participant, 'video', participant.presentation.source_groups, participant.presentation.endpoint);\n      if(!this.hadAutoPinnedSources.has(source)) {\n        this.hadAutoPinnedSources.add(source);\n        this.pinSource(participant.pFlags.self ? 'presentation' : source);\n      }\n    }\n\n    if(participant.pFlags.self) {\n      this.participant = participant;\n\n      if(connectionInstance.sources.audio.source !== participant.source) {\n        this.hangUp();\n      }\n\n      let mute = false;\n      if(!participant.pFlags.can_self_unmute) {\n        this.stopScreenSharing();\n        this.stopVideoSharing();\n        mute = true;\n      } else if(participant.pFlags.muted) {\n        mute = true;\n      }\n\n      if(mute) {\n        this.setMuted(true);\n      }\n\n      if(doNotDispatchParticipantUpdate !== peerId) {\n        this.dispatchEvent('state', this.state);\n      }\n\n      return;\n    }\n\n    const ssrcs = hasLeft ? [] : makeSsrcsFromParticipant(participant);\n\n    if(!hasLeft) {\n      this.participantsSsrcs.set(peerId, ssrcs);\n    } else {\n      this.participantsSsrcs.delete(peerId);\n    }\n\n    // const TEST_OLD = false;\n\n    const modifiedTypes: Set<WebRTCLineType> = new Set();\n    oldSsrcs.forEach((oldSsrc) => {\n      const oldSource = oldSsrc.source;\n      const newSsrc = ssrcs.find((ssrc) => ssrc.source === oldSource);\n      if(!newSsrc) {\n        this.unpinSource(oldSource);\n\n        const oldEntry = description.getEntryBySource(oldSource);\n        if(oldEntry && oldEntry.direction !== 'inactive') {\n          oldEntry.setDirection('inactive');\n          modifiedTypes.add(oldEntry.type);\n        }\n      }\n    });\n\n    ssrcs.forEach((ssrc) => {\n      let entry = description.getEntryBySource(ssrc.source);\n      if(entry) {\n        if(entry.direction === 'inactive') {\n          entry.setDirection(entry.originalDirection);\n          modifiedTypes.add(entry.type);\n        }\n\n        return;\n      }\n\n      entry = description.createEntry(ssrc.type);\n      description.setEntrySource(entry, ssrc.sourceGroups || ssrc.source);\n      description.setEntryPeerId(entry, peerId);\n\n      // if(TEST_OLD) {\n      //   description.bundleMids.push(entry.mid);\n      //   entry.setDirection('recvonly');\n      // } else {\n      ssrc.type === 'video' && entry.setEndpoint(ssrc.endpoint);\n      entry.createTransceiver(connection, {direction: 'recvonly'});\n      // }\n\n      modifiedTypes.add(entry.type);\n    });\n\n    /* if(TEST_OLD) {\n      this.setRemoteOffer({\n        connection,\n        description,\n        ssrcs\n      });\n    } else  */if(modifiedTypes.size) {\n      if(modifiedTypes.has('video')) {\n        connectionInstance.updateConstraints = true;\n      }\n\n      connectionInstance.negotiateThrottled();\n    }\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nenum GROUP_CALL_STATE {\n  UNMUTED,\n  MUTED,\n  MUTED_BY_ADMIN,\n  CONNECTING,\n  CLOSED\n}\n\nexport default GROUP_CALL_STATE;\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport AudioAssetPlayer from '../../helpers/audioAssetPlayer';\r\n\r\nexport type GroupCallAudioAssetName = 'group_call_connect.mp3' | 'group_call_end.mp3' | 'group_call_start.mp3' | 'voip_onallowtalk.mp3';\r\n\r\nlet audioAsset: AudioAssetPlayer<GroupCallAudioAssetName>;\r\nexport default function getGroupCallAudioAsset() {\r\n  return audioAsset ??= new AudioAssetPlayer([\r\n    'group_call_connect.mp3',\r\n    'group_call_end.mp3',\r\n    'group_call_start.mp3',\r\n    'voip_onallowtalk.mp3'\r\n  ]);\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport getGroupCallAudioAsset from '../../components/groupCall/getAudioAsset';\r\nimport {MOUNT_CLASS_TO} from '../../config/debug';\r\nimport EventListenerBase from '../../helpers/eventListenerBase';\r\nimport {GroupCallParticipant, GroupCallParticipantVideo, GroupCallParticipantVideoSourceGroup} from '../../layer';\r\nimport {GroupCallId, GroupCallConnectionType} from '../appManagers/appGroupCallsManager';\r\nimport {AppManagers} from '../appManagers/managers';\r\nimport {logger} from '../logger';\r\nimport rootScope from '../rootScope';\r\nimport GroupCallInstance from './groupCallInstance';\r\nimport GROUP_CALL_STATE from './groupCallState';\r\nimport createMainStreamManager from './helpers/createMainStreamManager';\r\nimport {generateSsrc} from './localConferenceDescription';\r\nimport {WebRTCLineType} from './sdpBuilder';\r\nimport StreamManager from './streamManager';\r\nimport {Ssrc} from './types';\r\n\r\nconst IS_MUTED = true;\r\n\r\nexport function makeSsrcsFromParticipant(participant: GroupCallParticipant) {\r\n  return [\r\n    makeSsrcFromParticipant(participant, 'audio', participant.source),\r\n    participant.video?.audio_source && makeSsrcFromParticipant(participant, 'audio', participant.video.audio_source),\r\n    participant.video && makeSsrcFromParticipant(participant, 'video', participant.video.source_groups, participant.video.endpoint),\r\n    participant.presentation?.audio_source && makeSsrcFromParticipant(participant, 'audio', participant.presentation.audio_source),\r\n    participant.presentation && makeSsrcFromParticipant(participant, 'video', participant.presentation.source_groups, participant.presentation.endpoint)\r\n  ].filter(Boolean);\r\n};\r\n\r\nexport function makeSsrcFromParticipant(participant: GroupCallParticipant, type: WebRTCLineType, source?: number | GroupCallParticipantVideoSourceGroup[], endpoint?: string): Ssrc {\r\n  return generateSsrc(type, source, endpoint);\r\n}\r\n\r\nexport function generateSelfVideo(source: Ssrc, audioSource?: number): GroupCallParticipantVideo {\r\n  return source && {\r\n    _: 'groupCallParticipantVideo',\r\n    pFlags: {},\r\n    endpoint: '',\r\n    source_groups: source.sourceGroups,\r\n    audio_source: audioSource\r\n  };\r\n}\r\n\r\nexport class GroupCallsController extends EventListenerBase<{\r\n  instance: (instance: GroupCallInstance) => void\r\n}> {\r\n  private audioAsset: ReturnType<typeof getGroupCallAudioAsset>;\r\n  private log: ReturnType<typeof logger>;\r\n  private currentGroupCall: GroupCallInstance;\r\n  private managers: AppManagers;\r\n\r\n  public construct(managers: AppManagers) {\r\n    this.managers = managers;\r\n    this.audioAsset = getGroupCallAudioAsset();\r\n    this.log = logger('GCC');\r\n\r\n    rootScope.addEventListener('group_call_update', (groupCall) => {\r\n      const {currentGroupCall} = this;\r\n      if(currentGroupCall?.id === groupCall.id) {\r\n        currentGroupCall.groupCall = groupCall;\r\n\r\n        if(groupCall._ === 'groupCallDiscarded') {\r\n          currentGroupCall.hangUp(false, false, true);\r\n        }\r\n      }\r\n    });\r\n\r\n    rootScope.addEventListener('group_call_participant', ({groupCallId, participant}) => {\r\n      const {currentGroupCall} = this;\r\n      if(currentGroupCall?.id === groupCallId) {\r\n        currentGroupCall.onParticipantUpdate(participant/* , this.doNotDispatchParticipantUpdate */);\r\n      }\r\n    });\r\n  }\r\n\r\n  get groupCall() {\r\n    return this.currentGroupCall;\r\n  }\r\n\r\n  public setCurrentGroupCall(groupCall: GroupCallInstance) {\r\n    this.currentGroupCall = groupCall;\r\n\r\n    if(groupCall) {\r\n      this.dispatchEvent('instance', groupCall);\r\n    }\r\n  }\r\n\r\n  public startConnectingSound() {\r\n    this.stopConnectingSound();\r\n    this.audioAsset.playSoundWithTimeout('group_call_connect.mp3', true, 2500);\r\n  }\r\n\r\n  public stopConnectingSound() {\r\n    this.audioAsset.stopSound();\r\n    this.audioAsset.cancelDelayedPlay();\r\n  }\r\n\r\n  public async joinGroupCall(chatId: ChatId, groupCallId: GroupCallId, muted = IS_MUTED, rejoin?: boolean, joinVideo?: boolean) {\r\n    this.audioAsset.createAudio();\r\n\r\n    this.log(`joinGroupCall chatId=${chatId} id=${groupCallId} muted=${muted} rejoin=${rejoin}`);\r\n\r\n    let streamManager: StreamManager;\r\n    if(rejoin) {\r\n      streamManager = this.currentGroupCall.connections.main.streamManager;\r\n    } else {\r\n      streamManager = await createMainStreamManager(muted, joinVideo);\r\n    }\r\n\r\n    return this.joinGroupCallInternal(chatId, groupCallId, streamManager, muted, rejoin, joinVideo);\r\n  }\r\n\r\n  public async joinGroupCallInternal(chatId: ChatId, groupCallId: GroupCallId, streamManager: StreamManager, muted: boolean, rejoin = false, joinVideo?: boolean) {\r\n    const log = this.log.bindPrefix('joinGroupCallInternal');\r\n    log('start', groupCallId);\r\n\r\n    const type: GroupCallConnectionType = 'main';\r\n\r\n    let {currentGroupCall} = this;\r\n    if(currentGroupCall && rejoin) {\r\n      // currentGroupCall.connections.main.connection = connection;\r\n      currentGroupCall.handleUpdateGroupCallParticipants = false;\r\n      currentGroupCall.updatingSdp = false;\r\n      log('update currentGroupCall', groupCallId, currentGroupCall);\r\n    } else {\r\n      currentGroupCall = new GroupCallInstance({\r\n        chatId,\r\n        id: groupCallId,\r\n        managers: this.managers\r\n      });\r\n\r\n      currentGroupCall.fixSafariAudio();\r\n\r\n      currentGroupCall.addEventListener('state', (state) => {\r\n        if(this.currentGroupCall === currentGroupCall && state === GROUP_CALL_STATE.CLOSED) {\r\n          this.setCurrentGroupCall(null);\r\n          this.stopConnectingSound();\r\n          this.audioAsset.playSound('group_call_end.mp3');\r\n          rootScope.dispatchEvent('chat_update', currentGroupCall.chatId);\r\n        }\r\n      });\r\n\r\n      currentGroupCall.groupCall = await this.managers.appGroupCallsManager.getGroupCallFull(groupCallId);\r\n\r\n      const connectionInstance = currentGroupCall.createConnectionInstance({\r\n        streamManager,\r\n        type,\r\n        options: {\r\n          type,\r\n          isMuted: muted,\r\n          joinVideo,\r\n          rejoin\r\n        }\r\n      });\r\n\r\n      const connection = connectionInstance.createPeerConnection();\r\n      connection.addEventListener('negotiationneeded', () => {\r\n        connectionInstance.negotiate();\r\n      });\r\n\r\n      connection.addEventListener('track', (event) => {\r\n        log('ontrack', event);\r\n        currentGroupCall.onTrack(event);\r\n      });\r\n\r\n      connection.addEventListener('iceconnectionstatechange', () => {\r\n        currentGroupCall.dispatchEvent('state', currentGroupCall.state);\r\n\r\n        const {iceConnectionState} = connection;\r\n        if(iceConnectionState === 'disconnected' || iceConnectionState === 'checking' || iceConnectionState === 'new') {\r\n          this.startConnectingSound();\r\n        } else {\r\n          this.stopConnectingSound();\r\n        }\r\n\r\n        switch(iceConnectionState) {\r\n          case 'checking': {\r\n            break;\r\n          }\r\n\r\n          case 'closed': {\r\n            currentGroupCall.hangUp();\r\n            break;\r\n          }\r\n\r\n          case 'completed': {\r\n            break;\r\n          }\r\n\r\n          case 'connected': {\r\n            if(!currentGroupCall.joined) {\r\n              currentGroupCall.joined = true;\r\n              this.audioAsset.playSound('group_call_start.mp3');\r\n              this.managers.appGroupCallsManager.getGroupCallParticipants(groupCallId);\r\n            }\r\n\r\n            break;\r\n          }\r\n\r\n          case 'disconnected': {\r\n            break;\r\n          }\r\n\r\n          case 'failed': {\r\n            // TODO: replace with ICE restart\r\n            currentGroupCall.hangUp();\r\n            // connection.restartIce();\r\n            break;\r\n          }\r\n\r\n          case 'new': {\r\n            break;\r\n          }\r\n        }\r\n      });\r\n\r\n      connectionInstance.createDescription();\r\n      connectionInstance.createDataChannel();\r\n\r\n      connectionInstance.appendStreamToConference();\r\n\r\n      this.setCurrentGroupCall(currentGroupCall);\r\n      log('set currentGroupCall', groupCallId, currentGroupCall);\r\n\r\n      this.startConnectingSound();\r\n\r\n      return connectionInstance.negotiate();\r\n    }\r\n  }\r\n}\r\n\r\nconst groupCallsController = new GroupCallsController();\r\nMOUNT_CLASS_TO && (MOUNT_CLASS_TO.groupCallController = groupCallsController);\r\nexport default groupCallsController;\r\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport {GROUP_CALL_AMPLITUDE_ANALYSE_INTERVAL_MS} from '../constants';\nimport StreamManager from '../streamManager';\nimport getAudioConstraints from './getAudioConstraints';\nimport getStream from './getStream';\nimport getVideoConstraints from './getVideoConstraints';\n\nexport default async function createMainStreamManager(muted?: boolean, joinVideo?: boolean) {\n  const constraints: MediaStreamConstraints = {\n    audio: getAudioConstraints(),\n    video: joinVideo && getVideoConstraints()\n  };\n\n  const streamManager = new StreamManager(GROUP_CALL_AMPLITUDE_ANALYSE_INTERVAL_MS);\n\n  try {\n    const stream = await getStream(constraints, muted);\n    streamManager.addStream(stream, 'input');\n  } catch(err) {\n    console.error('joinGroupCall getStream error', err, constraints);\n    streamManager.inputStream = new MediaStream();\n  }\n\n  return streamManager;\n}\n","import constraintSupported, {MyMediaTrackSupportedConstraints} from '../../../environment/constraintSupport';\n\nexport default function getAudioConstraints(): MediaTrackConstraints {\n  const constraints: MediaTrackConstraints = {\n    channelCount: 2\n  };\n\n  const desirable: (keyof MyMediaTrackSupportedConstraints)[] = [\n    'noiseSuppression',\n    'echoCancellation',\n    'autoGainControl'\n  ];\n\n  desirable.forEach((constraint) => {\n    if(constraintSupported(constraint)) {\n      // @ts-ignore\n      constraints[constraint] = true;\n    }\n  });\n\n  return constraints;\n}\n","export type MyMediaTrackSupportedConstraints = MediaTrackSupportedConstraints & {\n  noiseSuppression?: boolean,\n  autoGainControl?: boolean\n};\n\nexport default function constraintSupported(constraint: keyof MyMediaTrackSupportedConstraints) {\n  return (!!navigator?.mediaDevices?.getSupportedConstraints() as any as MyMediaTrackSupportedConstraints)[constraint];\n}\n","export default function getScreenConstraints(skipAudio?: boolean) {\n  const constraints: DisplayMediaStreamConstraints = {\n    video: {\n      // @ts-ignore\n      // cursor: 'always',\n      width: {max: 1920},\n      height: {max: 1080},\n      frameRate: {max: 30}\n    }\n  };\n\n  if(!skipAudio) {\n    constraints.audio = true;\n  }\n\n  return constraints;\n}\n","export default async function getScreenStream(constraints: DisplayMediaStreamConstraints) {\n  const screenStream = await navigator.mediaDevices.getDisplayMedia(constraints);\n  const track = screenStream.getVideoTracks()[0];\n  track.contentHint = 'text';\n  return screenStream;\n}\n","export default async function getStream(constraints: MediaStreamConstraints, muted: boolean) {\n  // console.log('getStream', constraints);\n\n  const stream = await navigator.mediaDevices.getUserMedia(constraints);\n  stream.getTracks().forEach((x) => {\n    x.enabled = !muted;\n  });\n\n  // console.log('getStream result', stream);\n  return stream;\n}\n\n(window as any).getStream = getStream;\n","export default function getVideoConstraints(): MediaTrackConstraints {\n  return {\n    width: {min: 1280, max: 1920/* , ideal: 1920 */},\n    height: {min: 720, max: 1080/* , ideal: 1080 */},\n    frameRate: {min: 24, max: 30}\n  };\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport SDP from '../sdp';\nimport SDPMediaSection from '../sdp/mediaSection';\nimport {toTelegramSource} from '../utils';\nimport {parseSourceGroups} from './parseSourceGroups';\n\nexport default function parseMediaSectionInfo(sdp: SDP, channel: SDPMediaSection) {\n  const clientInfo = channel.lookupAttributeKeys({\n    'ice-ufrag': true,\n    'ice-pwd': true,\n    'fingerprint': true,\n    'setup': true,\n    'ssrc': true,\n    'mid': true,\n    'ssrc-group': false\n  });\n\n  if(!clientInfo.fingerprint) { // support Firefox\n    const line = sdp.session.lines.find((line) => line.parsed?.key === 'fingerprint');\n    clientInfo.fingerprint = line.parsed.value;\n  }\n\n  const telegramSourceGroups = parseSourceGroups(clientInfo['ssrc-group']);\n  const [hash, fingerprint] = clientInfo.fingerprint.split(' ', 2);\n  const ssrc = clientInfo.ssrc && toTelegramSource(+clientInfo.ssrc.split(' ', 1)[0]);\n  // ssrc = telegramSourceGroups ? telegramSourceGroups[0].sources[0] : ssrc;\n\n  return {\n    raw: clientInfo,\n    ufrag: clientInfo['ice-ufrag'],\n    pwd: clientInfo['ice-pwd'],\n    fingerprint: {\n      fingerprint,\n      setup: clientInfo.setup,\n      hash\n    },\n    source: ssrc,\n    sourceGroups: telegramSourceGroups,\n    mid: clientInfo.mid\n  };\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport {GroupCallParticipantVideoSourceGroup} from '../../../layer';\nimport {toTelegramSource} from '../utils';\n\nexport function parseSourceGroups(sdpLines: string[]) {\n  const telegramSourceGroups = sdpLines.map((str) => {\n    const [semantics, ...rest] = str.split(' ');\n\n    const sourceGroup: GroupCallParticipantVideoSourceGroup = {\n      _: 'groupCallParticipantVideoSourceGroup',\n      semantics,\n      // sources: rest.map((ssrc) => +ssrc)\n      sources: rest.map((ssrc) => toTelegramSource(+ssrc))\n    };\n\n    return sourceGroup;\n  });\n\n  /* const simIndex = telegramSourceGroups.findIndex((g) => g.semantics === 'SIM');\n  if(simIndex !== -1) {\n    const sourceGroup = telegramSourceGroups.splice(simIndex, 1)[0];\n    telegramSourceGroups.unshift(sourceGroup);\n  } */\n\n  return telegramSourceGroups.length ? telegramSourceGroups : undefined;\n}\n","import simulateEvent from '../../../helpers/dom/dispatchEvent';\n\nexport default function stopTrack(track: MediaStreamTrack) {\n  track.stop();\n  simulateEvent(track, 'ended');\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n *\n * Originally from:\n * https://github.com/evgeny-nadymov/telegram-react\n * Copyright (C) 2018 Evgeny Nadymov\n * https://github.com/evgeny-nadymov/telegram-react/blob/master/LICENSE\n */\n\nimport indexOfAndSplice from '../../helpers/array/indexOfAndSplice';\nimport safeAssign from '../../helpers/object/safeAssign';\nimport {GroupCallParticipantVideoSourceGroup} from '../../layer';\nimport {fixMediaLineType, SDPBuilder, WebRTCLineType, WEBRTC_MEDIA_PORT} from './sdpBuilder';\nimport {AudioCodec, GroupCallConnectionTransport, Ssrc, UpdateGroupCallConnectionData, VideoCodec} from './types';\n\nexport class ConferenceEntry {\n  public source: number;\n  public sourceGroups: GroupCallParticipantVideoSourceGroup[];\n  public transceiver: RTCRtpTransceiver;\n  public originalDirection: RTCRtpTransceiverDirection;\n  public direction: RTCRtpTransceiverDirection;\n  public port: string;\n  public endpoint: string;\n  public peerId: PeerId;\n\n  public sendEntry: ConferenceEntry;\n  public recvEntry: ConferenceEntry;\n\n  constructor(public mid: string, public type: WebRTCLineType) {\n    this.port = WEBRTC_MEDIA_PORT;\n  }\n\n  public setDirection(direction: RTCRtpTransceiverDirection) {\n    if(!this.originalDirection) {\n      this.originalDirection = direction;\n    }\n\n    return this.direction = direction;\n  }\n\n  public setPort(port: string) {\n    return this.port = port;\n  }\n\n  public setEndpoint(endpoint: string) {\n    return this.endpoint = endpoint;\n  }\n\n  public setPeerId(peerId: PeerId) {\n    return this.peerId = peerId;\n  }\n\n  public createTransceiver(connection: RTCPeerConnection, init?: RTCRtpTransceiverInit) {\n    if(init?.direction) {\n      this.setDirection(init.direction);\n    }\n\n    return this.transceiver = connection.addTransceiver(fixMediaLineType(this.type), init);\n  }\n\n  public setSource(source: number | GroupCallParticipantVideoSourceGroup[]) {\n    let sourceGroups: GroupCallParticipantVideoSourceGroup[];\n    if(Array.isArray(source)) {\n      if(!source[0]) return;\n      sourceGroups = source;\n      source = sourceGroups[0].sources[0];\n    }\n\n    this.sourceGroups = sourceGroups;\n    return this.source = source;\n  }\n\n  public shouldBeSkipped(isAnswer?: boolean) {\n    return isAnswer && this.direction === 'inactive';\n  }\n}\n\nexport function generateSsrc(type: WebRTCLineType, source: number | GroupCallParticipantVideoSourceGroup[], endpoint?: string): Ssrc {\n  let sourceGroups: GroupCallParticipantVideoSourceGroup[];\n  if(Array.isArray(source)) {\n    if(!source[0]) return;\n    sourceGroups = source;\n    source = sourceGroups[0].sources[0];\n  }\n\n  return {\n    endpoint,\n    type,\n    source,\n    sourceGroups\n  };\n}\n\nexport default class LocalConferenceDescription implements UpdateGroupCallConnectionData {\n  public readonly sessionId: string;\n  // public ssrcs: Ssrc[];\n  public readonly transport: GroupCallConnectionTransport;\n  public readonly audio?: AudioCodec;\n  public readonly video: VideoCodec;\n  public readonly screencast?: VideoCodec;\n\n  private maxSeenId: number;\n  public readonly entries: ConferenceEntry[];\n  private entriesByMid: Map<ConferenceEntry['mid'], ConferenceEntry>;\n  private entriesBySource: Map<ConferenceEntry['source'], ConferenceEntry>;\n  private entriesByPeerId: Map<ConferenceEntry['peerId'], Set<ConferenceEntry>>;\n\n  constructor(public connection: RTCPeerConnection) {\n    this.sessionId = '' + Date.now();\n    // this.ssrcs = [];\n    this.maxSeenId = -1;\n    this.entries = [];\n    this.entriesByMid = new Map();\n    this.entriesBySource = new Map();\n    this.entriesByPeerId = new Map();\n  }\n\n  public setData(data: UpdateGroupCallConnectionData) {\n    return safeAssign(this, data);\n  }\n\n  public createEntry(type: WebRTCLineType) {\n    const mid = '' + ++this.maxSeenId;\n    const entry = new ConferenceEntry(mid, type);\n    this.entries.push(entry);\n    this.entriesByMid.set(mid, entry);\n    return entry;\n  }\n\n  public deleteEntry(entry: ConferenceEntry) {\n    indexOfAndSplice(this.entries, entry);\n    this.entriesByMid.delete(entry.mid);\n    this.entriesBySource.delete(entry.source);\n\n    const set = this.entriesByPeerId.get(entry.peerId);\n    if(set) {\n      set.delete(entry);\n      if(!set.size) {\n        this.entriesByPeerId.delete(entry.peerId);\n      }\n    }\n  }\n\n  public setEntrySource(entry: ConferenceEntry, source: Parameters<ConferenceEntry['setSource']>[0]) {\n    entry.setSource(source);\n    this.entriesBySource.set(entry.source, entry);\n  }\n\n  public setEntryPeerId(entry: ConferenceEntry, peerId: ConferenceEntry['peerId']) {\n    entry.setPeerId(peerId);\n    let set = this.entriesByPeerId.get(peerId);\n    if(!set) {\n      this.entriesByPeerId.set(peerId, set = new Set());\n    }\n\n    set.add(entry);\n  }\n\n  public findEntry(verify: Parameters<LocalConferenceDescription['entries']['find']>[0]) {\n    return this.entries.find(verify);\n  }\n\n  public findFreeSendRecvEntry(type: WebRTCLineType, isSending: boolean) {\n    let entry = this.entries.find((entry) => {\n      return entry.direction === 'sendrecv' && entry.type === type && !(isSending ? entry.sendEntry : entry.recvEntry);\n    });\n\n    if(!entry) {\n      entry = this.createEntry(type);\n      entry.setDirection('sendrecv');\n    }\n\n    return entry;\n  }\n\n  public getEntryByMid(mid: ConferenceEntry['mid']) {\n    return this.entriesByMid.get(mid);\n  }\n\n  public getEntryBySource(source: ConferenceEntry['source']) {\n    return this.entriesBySource.get(source);\n  }\n\n  public getEntriesByPeerId(peerId: ConferenceEntry['peerId']) {\n    return this.entriesByPeerId.get(peerId);\n  }\n\n  public generateSdp(options: Omit<Parameters<SDPBuilder['addConference']>[0], 'conference'>) {\n    return SDPBuilder.fromConference({\n      conference: this,\n      ...options\n    });\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport SDPMediaSection from './mediaSection';\nimport SDPSessionSection from './sessionSection';\n\nexport type AttributeKey = 'group' | 'rtcp' | 'ice-ufrag' |\n  'ice-pwd' | 'ice-options' | 'fingerprint' | 'setup' |\n  'mid' | 'extmap' | 'sendonly' | 'msid' | 'rtcp-mux' |\n  'rtpmap' | 'rtcp-fb' | 'fmtp' | 'ssrc' | 'ssrc-group' |\n  'extmap-allow-mixed' | 'msid-semantic';\n\nexport type AttributeMap = {[k in AttributeKey]?: boolean};\n\nexport default class SDP {\n  #session: SDPSessionSection;\n  #media: SDPMediaSection[];\n\n  constructor(session: SDP['session'], mediaSections: SDP['media']) {\n    this.#session = session;\n    this.#media = mediaSections;\n  }\n\n  public get session() {\n    return this.#session;\n  }\n\n  public get media() {\n    return this.#media;\n  }\n\n  public get bundle() {\n    const bundleLine = this.session.lines.find((line) => line.parsed?.key === 'group');\n    return bundleLine.value.split(' ').slice(1);\n  }\n\n  toString() {\n    return this.session.lines\n    .concat(...this.media.map((section) => section.lines))\n    .map((line) => line.toString()).join('\\r\\n') + '\\r\\n';\n  }\n\n  /* get buggedMedia() {\n    const bundle = this.bundle;\n    type A = {\n      mid: SDPMediaSection['mid'],\n      mediaType: SDPMediaSection['mediaType'],\n      direction: SDPMediaSection['direction']\n    };\n    const out: A[] = [];\n    for(let i = 0, length = this.media.length; i < length; ++i) {\n      const section = this.media[i];\n      const mid = section.mid;\n      if(!bundle.includes(mid)) {\n        out.push(section);\n      }\n    }\n\n    return out;\n  } */\n\n  /* get mediaTypes() {\n    return this.media.map((section) => {\n      return {mid: section.oa.get('mid').oa, type: section.mediaType, direction: section.direction};\n    });\n  } */\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nexport default function splitStringByLimitWithRest(str: string, separator: string, limit: number) {\n  const splitted = str.split(separator);\n  const out: string[] = [];\n\n  while(limit > 0 && splitted.length) {\n    out.push(splitted.shift());\n    --limit;\n  }\n\n  if(splitted.length) {\n    out.push(splitted.join(separator));\n  }\n\n  return out;\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nexport default class UniqueNumberGenerator {\n  #set: Set<number>;\n  #min: number;\n  #max: number;\n\n  constructor(min: number, max: number) {\n    this.#set = new Set();\n    this.#min = min;\n    this.#max = max;\n  }\n\n  public generate() {\n    const min = this.#min;\n    const max = this.#max;\n    const set = this.#set;\n\n    const maxTries = max - min + 1;\n    let value = Math.floor(min + maxTries * Math.random()), _try = 0;\n    while(set.has(value)) {\n      if(value < max) {\n        ++value;\n      } else {\n        value = min;\n      }\n\n      if(++_try >= maxTries) {\n        return null;\n      }\n    }\n\n    set.add(value);\n    return value;\n  }\n\n  public add(value: number) {\n    this.#set.add(value);\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport {AttributeKey} from '.';\n\nexport default class SDPAttributeSplitted {\n  #key: AttributeKey;\n  #value: string;\n\n  // key = 'ssrc-group', value = 'SIM 1 2 3'\n  constructor(key: AttributeKey, value: string) {\n    this.#key = key;\n    this.#value = value;\n  }\n\n  public get key() {\n    return this.#key;\n  }\n\n  public get value() {\n    return this.#value;\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nexport default class SDPMediaLineParts {\n  #type: 'audio' | 'video' | 'application';\n  #port: string;\n  #protocol: string;\n  #ids: string[];\n\n  constructor(\n    type: SDPMediaLineParts['type'],\n    port: SDPMediaLineParts['port'],\n    protocol: SDPMediaLineParts['protocol'],\n    ids: SDPMediaLineParts['ids']\n  ) {\n    this.#type = type;\n    this.#port = port;\n    this.#protocol = protocol;\n    this.#ids = ids;\n  }\n\n  public get type() {\n    return this.#type;\n  }\n\n  public get port() {\n    return this.#port;\n  }\n\n  public get protocol() {\n    return this.#protocol;\n  }\n\n  public get ids() {\n    return this.#ids;\n  }\n\n  toString() {\n    return this.type + ' ' + this.port + ' ' + this.protocol + ' ' + this.ids.join(' ');\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport splitStringByLimitWithRest from '../../../helpers/string/splitStringByLimitWithRest';\nimport SDPAttributeSplitted from './attributeSplitted';\nimport SDPMediaLineParts from './mediaLineParts';\n\nexport default class SDPLine {\n  #key: 'm' | 'a' | 'o' | 'v' | 's' | 't' | 'c';\n  #value: string;\n  #mediaLineParts: SDPMediaLineParts;\n  #parsed?: SDPAttributeSplitted;\n\n  // key = 'a', value = 'ssrc-group:SIM 1 2 3'\n  constructor(key: SDPLine['key'], value: string | SDPMediaLineParts | SDPAttributeSplitted) {\n    this.#key = key;\n\n    if(typeof(value) === 'string') {\n      this.#value = value;\n\n      if(key === 'm') {\n        const splitted = value.split(' ');\n        this.#mediaLineParts = new SDPMediaLineParts(splitted[0] as any, splitted[1], splitted[2], splitted.slice(3));\n      } else {\n        if(key === 'a') {\n          const result = splitStringByLimitWithRest(value, ':', 1);\n          value = result[0];\n          this.#parsed = result.length === 1 ? new SDPAttributeSplitted(value as any, null) : new SDPAttributeSplitted(value as any, result[1]);\n        }\n      }\n    } else {\n      if(value instanceof SDPMediaLineParts) {\n        this.#mediaLineParts = value;\n        this.#value = value.toString();\n      } else if(value instanceof SDPAttributeSplitted) {\n        this.#parsed = value;\n        this.#value = value.value ? `${value.key}:${value.value}` : value.key;\n      }\n    }\n  }\n\n  public get key() {\n    return this.#key;\n  }\n\n  public get value() {\n    return this.#value;\n  }\n\n  public get parsed() {\n    return this.#parsed;\n  }\n\n  public get mediaLineParts() {\n    return this.#mediaLineParts;\n  }\n\n  toString() {\n    return `${this.key}=${this.value}`;\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport splitStringByLimitWithRest from '../../../helpers/string/splitStringByLimitWithRest';\n\nexport default class SDPAttributeInner {\n  #key: string;\n  #lines: Array<string>;\n  #prefix: string;\n  #nestedMap: Map<string, SDPAttributeInner>;\n  #missed: boolean;\n  #keys: Array<string>;\n\n  constructor(key: SDPAttributeInner['key'], lines: SDPAttributeInner['lines'], prefix: string = ':', missed = false) {\n    this.#key = key;\n    this.#lines = lines;\n    this.#prefix = prefix;\n    this.#missed = missed;\n    this.#nestedMap = missed ? new Map() : null;\n    this.#keys = missed ? [] : null;\n  }\n\n  public get lines() {\n    return this.#lines;\n  }\n\n  public get value() {\n    return this.#missed || !this.lines.length ? null : this.lines[0];\n  }\n\n  public get exists() {\n    return !this.#missed;\n  }\n\n  public get key() {\n    return this.#key;\n  }\n\n  public get keys() {\n    SDPAttributeInner.fill(this);\n    return this.#keys;\n  }\n\n  public forEach(callback: Parameters<Map<string, SDPAttributeInner>['forEach']>[0]) {\n    SDPAttributeInner.fill(this);\n    this.#nestedMap.forEach(callback);\n  }\n\n  public get(key: string) {\n    SDPAttributeInner.fill(this);\n    return this.#nestedMap.get(key) || new SDPAttributeInner(key, [], ':', true);\n  }\n\n  private static fill(attribute: SDPAttributeInner) {\n    if(attribute.#nestedMap !== null) {\n      return;\n    }\n\n    const map: Map<string, Array<string>> = new Map();\n    attribute.lines.forEach((str) => {\n      const [key, rest] = splitStringByLimitWithRest(str, attribute.#prefix, 1);\n      const values = map.get(key) || [];\n      map.set(key, [...values, rest || '']);\n    });\n\n    const nestedMap = attribute.#nestedMap = SDPAttributeInner.makeAttributes(map);\n    attribute.#keys = Array.from(nestedMap.keys());\n  }\n\n  private static makeAttributes(innerParts: Map<string, Array<string>>) {\n    const out: Map<string, SDPAttributeInner> = new Map();\n\n    innerParts.forEach((lines, key) => {\n      out.set(key, new SDPAttributeInner(key, lines));\n    });\n\n    return out;\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport SDPAttributeInner from './attributeInner';\nimport SDPLine from './line';\n\nexport default class SDPAttributes {\n  #lines: SDPLine[];\n  #attributes: Map<string, SDPAttributeInner>;\n\n  constructor(lines: SDPLine[]) {\n    this.#lines = lines;\n    this.#attributes = new Map();\n    SDPAttributes.fillAttributes(this);\n  }\n\n  public get(key: string) {\n    return this.#attributes.get(key) || new SDPAttributeInner(key, [], ' ', true);\n  }\n\n  private static fillAttributes(attributes: SDPAttributes) {\n    const attributesMap: Map<string, Array<string>> = new Map();\n    attributes.#lines.forEach((line) => {\n      if(line.key === 'a') {\n        const {key, value} = line.parsed;\n\n        let linesArray = attributesMap.get(key);\n        if(!linesArray) {\n          linesArray = [];\n          attributesMap.set(key, linesArray);\n        }\n\n        linesArray.push(value || '');\n      }\n    });\n\n    attributesMap.forEach((linesArray, key) => {\n      attributes.#attributes.set(key, new SDPAttributeInner(key, linesArray, ' ', false));\n    });\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport {AttributeMap} from '.';\nimport {NoExtraProperties} from '../../../types';\nimport SDPAttributes from './attributes';\nimport SDPLine from './line';\n\nexport type SDPMediaDirection = 'sendonly' | 'recvonly' | 'inactive' | 'sendrecv';\nexport default class SDPMediaSection {\n  #lines: Array<SDPLine>;\n  #mediaLine: SDPLine;\n  #attributes: SDPAttributes;\n  #direction: SDPMediaDirection;\n\n  constructor(lines: Array<SDPLine>) {\n    this.#lines = lines;\n    this.#mediaLine = lines[0];\n    this.#attributes = this.#direction = null;\n  }\n\n  public get lines() {\n    return this.#lines;\n  }\n\n  public get mediaLine() {\n    return this.#mediaLine;\n  }\n\n  public get mediaLineParts() {\n    return this.#mediaLine.mediaLineParts;\n  }\n\n  public get mediaType() {\n    return this.mediaLineParts.type;\n  }\n\n  public get direction() {\n    if(!this.#direction) {\n      const attributes = this.attributes;\n\n      let direction: SDPMediaDirection;\n      if(attributes.get('sendonly').exists) direction = 'sendonly';\n      else if(attributes.get('recvonly').exists) direction = 'recvonly';\n      else if(attributes.get('inactive').exists) direction = 'inactive';\n      else direction = 'sendrecv';\n\n      this.#direction = direction;\n    }\n\n    return this.#direction;\n  }\n\n  public get isSending() {\n    return this.direction === 'sendrecv' || this.direction === 'sendonly';\n  }\n\n  public get isReceiving() {\n    return this.direction === 'sendrecv' || this.direction === 'recvonly';\n  }\n\n  public get attributes() {\n    this.#attributes || (this.#attributes = new SDPAttributes(this.lines));\n    return this.#attributes;\n  }\n\n  public get mid() {\n    return this.attributes.get('mid').value;\n  }\n\n  public lookupAttributeKeys<T extends AttributeMap>(keys: NoExtraProperties<AttributeMap, T>): {[k in keyof T]: T[k] extends true ? string : string[]} {\n    const out: any = {};\n\n    for(const key in keys) {\n      const result = this.attributes.get(key);\n      // @ts-ignore\n      const resultShouldBeArray = !keys[key];\n      if(!result) {\n        out[key] = resultShouldBeArray ? [] : undefined;\n      } else {\n        out[key] = resultShouldBeArray ? result.lines : result.value;\n      }\n    }\n\n    return out;\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport SDPLine from './line';\n\nexport default class SDPSessionSection {\n  #lines: SDPLine[];\n  #sessionId: string;\n\n  constructor(lines: SDPLine[]) {\n    this.#lines = lines;\n    this.#sessionId = lines.filter((line) => line.key === 'o').map((line) => line.value.split(' ')[1])[0];\n  }\n\n  public get lines() {\n    return this.#lines;\n  }\n\n  public get sessionId() {\n    return this.#sessionId;\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport SDP from '.';\nimport splitStringByLimitWithRest from '../../../helpers/string/splitStringByLimitWithRest';\nimport UniqueNumberGenerator from '../../../helpers/uniqueNumberGenerator';\nimport SDPLine from './line';\nimport SDPMediaSection from './mediaSection';\nimport SDPSessionSection from './sessionSection';\n\nexport function parseSdp(str: string) {\n  function createSection() {\n    if(sessionSection) {\n      mediaSections.push(new SDPMediaSection(lines));\n    } else {\n      sessionSection = new SDPSessionSection(lines);\n    }\n  }\n\n  let sessionSection: SDPSessionSection = null, lines: SDPLine[] = [];\n  const mediaSections: SDPMediaSection[] = [];\n  str.split(/\\r?\\n/).forEach((lineStr) => {\n    if(!isIncorrectSdpLine(lineStr)) {\n      const line = parseSdpLine(lineStr);\n      if(line.key === 'm') {\n        createSection();\n        lines = [];\n      }\n\n      lines.push(line);\n    }\n  });\n\n  createSection();\n  return new SDP(sessionSection, mediaSections);\n}\n\nexport function isIncorrectSdpLine(str: string) {\n  return /^[\\s\\xa0]*$/.test(str);\n}\n\nexport function parseSdpLine(str: string) {\n  const splitted = splitStringByLimitWithRest(str, '=', 1);\n  return new SDPLine(splitted[0] as any, splitted[1]);\n}\n\nexport function addSimulcast(sdp: SDP) {\n  let generator: UniqueNumberGenerator;\n  sdp.media.forEach((section, idx) => {\n    if(section.mediaType === 'video' && section.isSending && !section.attributes.get('ssrc-group').get('SIM').exists) {\n      if(!generator) {\n        generator = new UniqueNumberGenerator(2, 4294967295);\n      }\n\n      const originalSsrcs = section.attributes.get('ssrc-group').get('FID').value.split(' ');\n      const lines = section.lines;\n      originalSsrcs.forEach((ssrc) => generator.add(+ssrc)); // fix possible duplicates\n      const ssrcs = [originalSsrcs[0], generator.generate(), generator.generate()];\n      const ssrcs2 = [originalSsrcs[1], generator.generate(), generator.generate()];\n\n      lines.push(parseSdpLine('a=ssrc-group:SIM ' + ssrcs.join(' ')));\n\n      const ssrcsStrLines = section.attributes.get('ssrc').get(originalSsrcs[0]).lines;\n\n      ssrcs.forEach((ssrc, idx) => {\n        const ssrc2 = ssrcs2[idx];\n        if(idx > 0) {\n          lines.push(parseSdpLine('a=ssrc-group:FID ' + ssrc + ' ' + ssrc2));\n\n          ssrcsStrLines.forEach((v) => {\n            lines.push(parseSdpLine('a=ssrc:' + ssrc + ' ' + v));\n          });\n\n          ssrcsStrLines.forEach((v) => {\n            lines.push(parseSdpLine('a=ssrc:' + ssrc2 + ' ' + v));\n          });\n        }\n      });\n\n      sdp.media[idx] = new SDPMediaSection(lines);\n    }\n  });\n\n  return !!generator;\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n *\n * Originally from:\n * https://github.com/evgeny-nadymov/telegram-react\n * Copyright (C) 2018 Evgeny Nadymov\n * https://github.com/evgeny-nadymov/telegram-react/blob/master/LICENSE\n */\n\nimport {IS_FIREFOX} from '../../environment/userAgent';\nimport LocalConferenceDescription, {ConferenceEntry} from './localConferenceDescription';\nimport StringFromLineBuilder from './stringFromLineBuilder';\nimport {GroupCallConnectionTransport, PayloadType, UpdateGroupCallConnectionData} from './types';\nimport {fromTelegramSource} from './utils';\n\n// screencast is for Peer-to-Peer only\nexport type WebRTCLineTypeTrue = 'video' | 'audio' | 'application';\nexport type WebRTCLineType = WebRTCLineTypeTrue | 'screencast';\n\nexport const WEBRTC_MEDIA_PORT = '9';\n\nexport function fixMediaLineType(mediaType: WebRTCLineType) {\n  return mediaType === 'screencast' ? 'video' : mediaType;\n}\n\nexport function performCandidate(c: GroupCallConnectionTransport['candidates'][0]) {\n  const arr: string[] = [];\n  arr.push('a=candidate:');\n  arr.push(`${c.foundation} ${c.component} ${c.protocol.toUpperCase()} ${c.priority} ${c.ip} ${c.port} typ ${c.type}`);\n  if(c['rel-addr'] !== undefined) {\n    arr.push(` raddr ${c['rel-addr']} rport ${c['rel-port']}`);\n  }\n  arr.push(` generation ${c.generation}`);\n  return arr.join('');\n}\n\nexport function getConnectionTypeForMediaType(mediaType: WebRTCLineType) {\n  // return mediaType === 'application' ? 'DTLS/SCTP' : 'RTP/SAVPF';\n  return mediaType === 'application' ? 'DTLS/SCTP' : 'UDP/TLS/RTP/SAVPF';\n}\n\nexport function generateMediaFirstLine(mediaType: WebRTCLineType, port = WEBRTC_MEDIA_PORT, payloadIds: (string | number)[]) {\n  const connectionType = getConnectionTypeForMediaType(mediaType);\n  return `m=${fixMediaLineType(mediaType)} ${port} ${connectionType} ${payloadIds.join(' ')}`;\n}\n\ntype ConferenceData = UpdateGroupCallConnectionData | LocalConferenceDescription;\n\n// https://tools.ietf.org/id/draft-ietf-rtcweb-sdp-08.html\n// https://datatracker.ietf.org/doc/html/draft-roach-mmusic-unified-plan-00\nexport class SDPBuilder extends StringFromLineBuilder {\n  public addCandidate(c: GroupCallConnectionTransport['candidates'][0]) {\n    return this.add(performCandidate(c));\n  }\n\n  /* public addDataChannel(mid: string, transport: GroupCallConnectionTransport, isAnswer?: boolean) {\n    this.add(\n      'm=application 9 UDP/DTLS/SCTP webrtc-datachannel',\n      'c=IN IP4 0.0.0.0',\n      'a=ice-options:trickle',\n      `a=mid:${mid}`\n    );\n\n    // if(!isAnswer) {\n      this.add('a=sendrecv');\n    // }\n\n    this.addTransport(transport, isAnswer);\n\n    return this.add(\n      'a=sctp-port:5000',\n      'a=max-message-size:262144'\n    );\n  } */\n\n  public addHeader(sId: string, bundleMids: string[]) {\n    const bundle = bundleMids.join(' ');\n    return this.add(\n      'v=0',                          // version\n      `o=- ${sId} 2 IN IP4 0.0.0.0`,  // sessionId, 2=sessionVersion\n      's=-',                          // name of the session\n      't=0 0',                        // time when session is valid\n      'a=extmap-allow-mixed',\n      `a=group:BUNDLE ${bundle}`,\n      'a=ice-options:trickle',\n      // 'a=ice-lite',                   // ice-lite: is a minimal version of the ICE specification, intended for servers running on a public IP address.\n      'a=msid-semantic:WMS *'\n    );\n  }\n\n  public addTransport(transport: GroupCallConnectionTransport, skipCandidates?: boolean) {\n    this.add(\n      `a=ice-ufrag:${transport.ufrag}`,\n      `a=ice-pwd:${transport.pwd}`,\n      'a=ice-options:trickle'           // ! test\n    );\n\n    for(const fingerprint of transport.fingerprints) {\n      this.add(\n        `a=fingerprint:${fingerprint.hash} ${fingerprint.fingerprint}`,\n        `a=setup:${fingerprint.setup}`\n      );\n    }\n\n    if(!skipCandidates && transport.candidates) {\n      for(const candidate of transport.candidates) {\n        this.addCandidate(candidate);\n      }\n    }\n\n    return this;\n  }\n\n  public addSsrc(entry: ConferenceEntry) {\n    let streamName = 'stream';\n    let {type, sourceGroups} = entry;\n\n    // let source = ssrc.source ?? ssrc.sourceGroups[0].sources[0];\n    // source = fromTelegramSource(source);\n    const source = fromTelegramSource(entry.source);\n\n    streamName += source;\n    type += source as any;\n\n    // streamName += mid;\n    // type += mid as any;\n\n    // streamName = type = entry.transceiver.receiver.track.id as any;\n\n    const addMsid = () => {\n      this.add(`a=msid:${streamName} ${type}`);\n    };\n\n    const addSource = (ssrc: number) => {\n      this.add(\n        `a=ssrc:${ssrc} cname:${streamName}`,\n        `a=ssrc:${ssrc} msid:${streamName} ${type}`,\n        `a=ssrc:${ssrc} mslabel:${streamName}`,\n        `a=ssrc:${ssrc} label:${type}`\n      );\n    };\n\n    addMsid();\n    if(sourceGroups?.length) {\n      sourceGroups.forEach((ssrcGroup) => {\n        if(ssrcGroup.sources.length) {\n          const sources = ssrcGroup.sources.map(fromTelegramSource);\n          this.add(`a=ssrc-group:${ssrcGroup.semantics} ${sources.join(' ')}`);\n          sources.forEach(addSource);\n        }\n      });\n    } else {\n      addSource(source);\n    }\n\n    return this;\n  }\n\n  public addSsrcEntry(entry: ConferenceEntry, data: ConferenceData, isAnswer?: boolean) {\n    const add = (...x: string[]) => this.add(...x);\n\n    const {type, mid, direction, port} = entry;\n    const transport = data.transport;\n\n    /* if(type === 'application') {\n      return this.addDataChannel(mid, transport, isAnswer);\n    } */\n\n    const isApplication = type === 'application';\n    const codec = isApplication ? undefined : data[type];\n\n    const isInactive = direction === 'inactive';\n    if(entry.shouldBeSkipped(isAnswer)) {\n      return add(\n        `m=${fixMediaLineType(type)} 0 ${getConnectionTypeForMediaType(type)} 0`,\n        `c=IN IP4 0.0.0.0`,\n        `a=inactive`,\n        `a=mid:${mid}`\n      );\n    }\n\n    const payloadTypes = !isApplication ? codec['payload-types'] : [{id: 5000} as PayloadType];\n    const ids = payloadTypes.map((type) => type.id);\n    add(\n      generateMediaFirstLine(type, port, ids),\n      'c=IN IP4 0.0.0.0',\n      `a=rtcp:${port} IN IP4 0.0.0.0`\n    );\n\n    if(transport['rtcp-mux']) {\n      add('a=rtcp-mux');\n    }\n\n    add(`a=mid:${mid}`);\n    /* if(type === 'video') {\n      add('b=AS:2500');\n    } */\n\n    let setDirection = direction;\n    if(direction !== 'sendrecv' && isAnswer && !(isInactive || isApplication)) {\n      setDirection = direction === 'sendonly' ? 'recvonly' : 'sendonly';\n    }\n\n    // a=bundle-only\n    add(`a=${setDirection}`);\n\n    // this.addTransport(transport, isAnswer);\n    this.addTransport(transport);\n\n    if(!isApplication) {\n      const hdrexts = codec['rtp-hdrexts'];\n      if(hdrexts?.length) {\n        hdrexts.forEach((hdrext) => {\n          add(`a=extmap:${hdrext.id} ${hdrext.uri}`);\n        });\n      }\n\n      payloadTypes.forEach((type) => {\n        add(`a=rtpmap:${type.id} ${type.name}/${type.clockrate}${type.channels && type.channels > 1 ? `/${type.channels}` : ''}`);\n\n        const parameters = type.parameters;\n        if(Array.isArray(parameters)) {\n          if(parameters.length) {\n            console.error('parameters is array???', parameters);\n          }\n        } else if(parameters && Object.keys(parameters).length) {\n          const p: string[] = [];\n          for(const i in parameters) {\n            p.push(`${i}=${parameters[i]}`);\n          }\n          add(`a=fmtp:${type.id} ${p.join(';')}`);\n        }\n\n        const fbs = type['rtcp-fbs'];\n        if(fbs?.length) {\n          fbs.forEach((fb) => {\n            add(`a=rtcp-fb:${type.id} ${fb.type}${fb.subtype ? ' ' + fb.subtype : ''}`);\n          });\n        }\n      });\n    } else {\n      add(`a=sctpmap:${payloadTypes[0].id} webrtc-datachannel 256`);\n    }\n\n    if(entry.source && (setDirection === 'sendonly' || setDirection === 'sendrecv')) {\n      this.addSsrc(entry);\n    }\n\n    return this;\n  }\n\n  public addConference(options: {\n    conference: LocalConferenceDescription,\n    bundle: string[],\n    entries: ConferenceEntry[],\n    isAnswer?: boolean,\n  }) {\n    const {conference, entries, bundle, isAnswer} = options;\n    this.addHeader(conference.sessionId, bundle);\n\n    if(IS_FIREFOX) {\n      this.addTransport(conference.transport); // support Firefox\n    }\n\n    for(const entry of entries) {\n      // this.addSsrcEntry(entry, conference, isAnswer);\n      this.addSsrcEntry((isAnswer ? entry.recvEntry || entry.sendEntry : entry.sendEntry || entry.recvEntry) || entry, conference, isAnswer);\n    }\n\n    return this;\n  }\n\n  public static fromConference(options: Parameters<SDPBuilder['addConference']>[0]) {\n    return new SDPBuilder().addConference(options).finalize();\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n *\n * Originally from:\n * https://github.com/evgeny-nadymov/telegram-react\n * Copyright (C) 2018 Evgeny Nadymov\n * https://github.com/evgeny-nadymov/telegram-react/blob/master/LICENSE\n */\n\nimport EventListenerBase from '../../helpers/eventListenerBase';\nimport {logger} from '../logger';\nimport rootScope from '../rootScope';\nimport {GROUP_CALL_AMPLITUDE_ANALYSE_COUNT_MAX} from './constants';\nimport stopTrack from './helpers/stopTrack';\nimport LocalConferenceDescription from './localConferenceDescription';\nimport {fixMediaLineType, WebRTCLineType} from './sdpBuilder';\nimport {getAmplitude, toTelegramSource} from './utils';\n\nexport type StreamItemBase = {\n  type: 'input' | 'output',\n  track: MediaStreamTrack,\n  source: string,\n  stream: MediaStream\n};\n\nexport type StreamItem = StreamAudioItem | StreamVideoItem;\n\nexport type StreamAudioItem = StreamItemBase & {kind: 'audio', streamAnalyser: AudioStreamAnalyser};\nexport type StreamVideoItem = StreamItemBase & {kind: 'video'};\n\nexport type StreamAmplitude = {\n  type: 'input' | 'output';\n  source: string;\n  stream: MediaStream;\n  track: MediaStreamTrack;\n  value: number;\n};\n\nclass AudioStreamAnalyser {\n  public analyser: AnalyserNode;\n  public gain: GainNode;\n  public streamSource: MediaStreamAudioSourceNode;\n\n  constructor(context: AudioContext, stream: MediaStream) {\n    const streamSource = this.streamSource = context.createMediaStreamSource(stream);\n    const analyser = this.analyser = context.createAnalyser();\n    const gain = this.gain = context.createGain();\n    // const streamDestination = context.createMediaStreamDestination();\n\n    analyser.minDecibels = -100;\n    analyser.maxDecibels = -30;\n    analyser.smoothingTimeConstant = 0.05;\n    analyser.fftSize = 1024;\n\n    // connect Web Audio API\n    streamSource.connect(analyser);\n    // analyser.connect(context.destination);\n  }\n}\n\nexport default class StreamManager {\n  public static ANALYSER_LISTENER = new EventListenerBase<{amplitude: (details: {amplitudes: StreamAmplitude[], type: 'all' | 'input'}) => void}>();\n  private context: AudioContext;\n  public outputStream: MediaStream;\n  public inputStream: MediaStream;\n\n  private timer: number;\n  private counter: number;\n\n  private items: StreamItem[];\n\n  private log: ReturnType<typeof logger>;\n\n  public direction: RTCRtpTransceiver['direction'];\n  public canCreateConferenceEntry: boolean;\n  public locked: boolean;\n  public types: WebRTCLineType[];\n\n  constructor(private interval?: number) {\n    this.context = new (window.AudioContext || (window as any).webkitAudioContext)();\n    this.items = [];\n    this.outputStream = new MediaStream();\n    this.inputStream = new MediaStream();\n    this.counter = 0;\n    this.log = logger('SM');\n    this.direction = 'sendonly';\n    this.canCreateConferenceEntry = true;\n    // this.lol = true;\n    this.types = ['audio', 'video'];\n  }\n\n  public addStream(stream: MediaStream, type: StreamItem['type']) {\n    stream.getTracks().forEach((track) => {\n      this.addTrack(stream, track, type);\n    });\n  }\n\n  public addTrack(stream: MediaStream, track: MediaStreamTrack, type: StreamItem['type']) {\n    this.log('addTrack', type, track, stream);\n\n    const {context, items, inputStream, outputStream} = this;\n    const kind: StreamItem['kind'] = track.kind as any;\n    const source = StreamManager.getSource(stream, type);\n\n    // this.removeTrack(track);\n    switch(type) {\n      case 'input': {\n        if(!inputStream) {\n          this.inputStream = stream;\n        } else {\n          inputStream.addTrack(track);\n        }\n\n        break;\n      }\n\n      case 'output': {\n        for(let i = 0; i < items.length; ++i) {\n          const {track: t, type, source: itemSource} = items[i];\n          if(itemSource === source && type === 'input') {\n            items.splice(i, 1);\n            outputStream.removeTrack(t);\n            break;\n          }\n        }\n\n        if(kind !== 'video') {\n          outputStream.addTrack(track);\n        }\n\n        break;\n      }\n    }\n\n    this.finalizeAddingTrack({\n      type,\n      source,\n      stream,\n      track,\n      kind,\n      streamAnalyser: kind === 'audio' ? new AudioStreamAnalyser(context, stream) : undefined\n    });\n\n    if(kind === 'audio' && this.interval) {\n      this.changeTimer();\n    }\n  }\n\n  private finalizeAddingTrack(item: StreamItem) {\n    const {track} = item;\n    track.addEventListener('ended', () => {\n      this.removeTrack(track);\n    }, {once: true});\n\n    this.items.push(item);\n  }\n\n  public hasInputTrackKind(kind: StreamItem['kind']) {\n    return this.items.find((item) => item.type === 'input' && item.kind === kind);\n  }\n\n  public static getSource(stream: MediaStream, type: StreamItem['type']) {\n    return type === 'input' ? (stream.source || stream.id) : '' + toTelegramSource(+stream.id.substring(6));\n  }\n\n  public removeTrack(track: MediaStreamTrack) {\n    this.log('removeTrack', track);\n\n    const {items} = this;\n\n    let handled = false;\n    for(let i = 0, length = items.length; !handled && i < length; ++i) {\n      const {track: t, type} = items[i];\n      switch(type) {\n        case 'output': {\n          if(t === track) {\n            items.splice(i, 1);\n            this.outputStream.removeTrack(track);\n            handled = true;\n          }\n\n          break;\n        }\n\n        case 'input': {\n          if(t === track) {\n            items.splice(i, 1);\n            this.inputStream.removeTrack(track);\n            handled = true;\n          }\n\n          break;\n        }\n      }\n    }\n\n    if(track.kind === 'audio' && this.interval) {\n      this.changeTimer();\n    }\n  }\n\n  public replaceInputAudio(stream: MediaStream, oldTrack: MediaStreamTrack) {\n    this.removeTrack(oldTrack);\n    this.addStream(stream, 'input');\n  }\n\n  private changeTimer() {\n    if(this.timer !== undefined) {\n      clearInterval(this.timer);\n    }\n\n    if(this.items.length) {\n      this.timer = window.setInterval(this.analyse, this.interval);\n    }\n  }\n\n  public getAmplitude = (item: StreamAudioItem): StreamAmplitude => {\n    const {streamAnalyser, stream, track, source, type} = item;\n    const analyser = streamAnalyser.analyser;\n    if(!analyser) return;\n\n    const array = new Uint8Array(analyser.frequencyBinCount);\n    analyser.getByteFrequencyData(array);\n    const value = getAmplitude(array);\n\n    return {\n      type,\n      source,\n      stream,\n      track,\n      value\n    };\n  };\n\n  public analyse = () => {\n    const all = this.counter % 3 === 0;\n    const filteredItems = all ? this.items : this.items.filter((x) => x.type === 'input');\n    const audioItems = filteredItems.filter((x) => x.kind === 'audio') as StreamAudioItem[];\n    const amplitudes = audioItems.slice(0, GROUP_CALL_AMPLITUDE_ANALYSE_COUNT_MAX).map(this.getAmplitude);\n    if(++this.counter >= 1000) {\n      this.counter = 0;\n    }\n\n    StreamManager.ANALYSER_LISTENER.dispatchEvent('amplitude', {\n      amplitudes,\n      type: all ? 'all' : 'input'\n    });\n  };\n\n  /* public appendToConnection(connection: RTCPeerConnection) {\n    if(this.inputStream) {\n      this.inputStream.getTracks().forEach((track) => {\n        connection.log('addTrack', track);\n        connection.addTrack(track, this.inputStream);\n\n        if(track.kind === 'video') {\n          track.enabled = true;\n        }\n      });\n    }\n  } */\n\n  public appendToConference(conference: LocalConferenceDescription) {\n    if(this.locked) {\n      return;\n    }\n\n    const {inputStream, direction, canCreateConferenceEntry} = this;\n    const transceiverInit: RTCRtpTransceiverInit = {direction, streams: [inputStream]};\n    const types = this.types.map((type) => {\n      return [\n        type,\n        /* type === 'video' || type === 'screencast' ?\n          {sendEncodings: [{maxBitrate: 2500000}], ...transceiverInit} :  */\n        transceiverInit\n      ] as const;\n    });\n\n    const tracks = inputStream.getTracks();\n    // const transceivers = conference.connection.getTransceivers();\n    for(const [type, transceiverInit] of types) {\n      let entry = conference.findEntry((entry) => entry.direction === direction && entry.type === type);\n      if(!entry) {\n        if(!canCreateConferenceEntry) {\n          continue;\n        }\n\n        entry = conference.createEntry(type);\n      }\n      /* const entry = conference.findFreeSendRecvEntry(type, true);\n      if(!entry.transceiver) {\n        entry.transceiver = transceivers.find((transceiver) => transceiver.mid === entry.mid);\n      } */\n\n      let {transceiver} = entry;\n      if(!transceiver) {\n        transceiver = entry.createTransceiver(conference.connection, transceiverInit);\n\n        /* if(this.isScreenSharingManager) {\n          transceiver.sender.setParameters({\n            ...transceiver.sender.getParameters(),\n            degradationPreference: 'maintain-resolution'\n          });\n        } */\n      }\n\n      if(entry.direction !== transceiver.direction) {\n        transceiver.direction = entry.direction;\n      }\n\n      const mediaTrackType = fixMediaLineType(type);\n      const trackIdx = tracks.findIndex((track) => track.kind === mediaTrackType);\n      const track = trackIdx !== -1 ? tracks.splice(trackIdx, 1)[0] : undefined;\n      const sender = transceiver.sender;\n      if(sender.track === track) {\n        continue;\n      }\n\n      // try { // ! don't use await here. it will wait for adding track and fake one won't be visible in startNegotiation.\n      /* await  */sender.replaceTrack(track).catch((err) => {\n        this.log.error(err);\n      });\n      // } catch(err) {\n\n      // }\n    }\n  }\n\n  public stop() {\n    try {\n      const tracks = this.inputStream.getTracks().concat(this.outputStream.getTracks());\n      tracks.forEach((track) => {\n        stopTrack(track);\n      });\n    } catch(e) {\n      this.log.error(e);\n    }\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n *\n * Originally from:\n * https://github.com/evgeny-nadymov/telegram-react\n * Copyright (C) 2018 Evgeny Nadymov\n * https://github.com/evgeny-nadymov/telegram-react/blob/master/LICENSE\n */\n\nexport default class StringFromLineBuilder {\n  private lines: string[];\n  private newLine: string[];\n\n  constructor(private joiner = '\\r\\n') {\n    this.lines = [];\n    this.newLine = [];\n  }\n\n  public add(...strs: string[]) {\n    this.lines.push(...strs);\n    return this;\n  }\n\n  public push(word: string) {\n    this.newLine.push(word);\n    return this;\n  }\n\n  public addJoined(separator = '') {\n    this.add(this.newLine.join(separator));\n    this.newLine = [];\n    return this;\n  }\n\n  public join() {\n    return this.lines.join(this.joiner);\n  }\n\n  public finalize() {\n    return this.join() + this.joiner;\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n *\n * Originally from:\n * https://github.com/evgeny-nadymov/telegram-react\n * Copyright (C) 2018 Evgeny Nadymov\n * https://github.com/evgeny-nadymov/telegram-react/blob/master/LICENSE\n */\n\n// NOTE: telegram returns sign source, while webrtc uses unsign source internally\n// unsign => sign\nexport function toTelegramSource(source: number) {\n  return source << 0;\n}\n\n// NOTE: telegram returns sign source, while webrtc uses unsign source internally\n// sign => unsign\nexport function fromTelegramSource(source: number) {\n  return source >>> 0;\n}\n\nexport function getAmplitude(array: Uint8Array, scale = 3) {\n  if(!array) return 0;\n\n  const {length} = array;\n  let total = 0;\n  for(let i = 0; i < length; ++i) {\n    total += array[i] * array[i];\n  }\n  const rms = Math.sqrt(total / length) / 255;\n\n  return Math.min(1, rms * scale);\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport wrapEmojiText from './wrapEmojiText';\n\nexport default function getAbbreviation(str: string, onlyFirst = false) {\n  if(!str) return '';\n  const splitted = str.trim().split(' ');\n  if(!splitted[0]) return '';\n\n  const first = [...splitted[0]][0];\n\n  if(onlyFirst || splitted.length === 1) return wrapEmojiText(first);\n\n  const last = [...splitted[splitted.length - 1]][0];\n\n  return wrapEmojiText(first + last);\n}\n","import {MessageEntity} from '../../layer';\nimport {toCodePoints} from '../../vendor/emoji';\n\nexport default function getEmojiEntityFromEmoji(emoji: string): MessageEntity.messageEntityEmoji {\n  return {\n    _: 'messageEntityEmoji',\n    offset: 0,\n    length: emoji.length,\n    unicode: toCodePoints(emoji).join('-').replace(/-?fe0f/g, '')\n  };\n}\n","import {EMAIL_REG_EXP} from '.';\n\nexport default function matchEmail(text: string) {\n  return !text ? null : text.match(EMAIL_REG_EXP);\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport {MessageEntity} from '../../layer';\nimport wrapRichText from './wrapRichText';\n\nexport default function wrapDraftText(text: string, options: Partial<{\n  entities: MessageEntity[]\n}> = {}) {\n  if(!text) {\n    return wrapRichText('');\n  }\n\n  return wrapRichText(text, {\n    entities: options.entities,\n    noLinks: true,\n    wrappingDraft: true,\n    passEntities: {\n      messageEntityTextUrl: true,\n      messageEntityMentionName: true\n    }\n  });\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport parseEntities from './parseEntities';\nimport wrapRichText from './wrapRichText';\n\nexport default function wrapEmojiText(text: string, isDraft = false) {\n  if(!text) return wrapRichText('');\n\n  const entities = parseEntities(text).filter((e) => e._ === 'messageEntityEmoji');\n  return wrapRichText(text, {entities, wrappingDraft: isDraft});\n}\n","export default function setBlankToAnchor(anchor: HTMLAnchorElement) {\n  anchor.target = '_blank';\n  anchor.rel = 'noopener noreferrer';\n  return anchor;\n}\n","import IS_EMOJI_SUPPORTED from './emojiSupport';\n\nexport type EMOJI_VERSION = '' | '14';\n\nconst EMOJI_VERSIONS_SUPPORTED: {\n  [v in EMOJI_VERSION]: boolean\n} = {} as any;\n\n// Thanks to WebZ for the detect\nfunction isEmojiSupported(emoji: string) {\n  const ALLOWABLE_CALCULATION_ERROR_SIZE = 5;\n  const inlineEl = document.createElement('span');\n  inlineEl.classList.add('emoji');\n  document.body.appendChild(inlineEl);\n\n  inlineEl.innerText = emoji; // Emoji from 14.0 version\n  const newEmojiWidth = inlineEl.offsetWidth;\n  inlineEl.innerText = ''; // Emoji from 1.0 version\n  const legacyEmojiWidth = inlineEl.offsetWidth;\n\n  document.body.removeChild(inlineEl);\n\n  return Math.abs(newEmojiWidth - legacyEmojiWidth) < ALLOWABLE_CALCULATION_ERROR_SIZE;\n}\n\nif(IS_EMOJI_SUPPORTED) {\n  EMOJI_VERSIONS_SUPPORTED[''] = true;\n\n  const a: [keyof typeof EMOJI_VERSIONS_SUPPORTED, string][] = [\n    ['14', '']\n  ];\n\n  a.forEach(([version, emoji]) => {\n    EMOJI_VERSIONS_SUPPORTED[version] = isEmojiSupported(emoji);\n  });\n}\n\nexport default EMOJI_VERSIONS_SUPPORTED;\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport type {EMOJI_VERSION} from '../../environment/emojiVersionsSupport';\nimport {SITE_HASHTAGS} from '.';\nimport {EmojiVersions} from '../../config/emoji';\nimport IS_EMOJI_SUPPORTED from '../../environment/emojiSupport';\nimport {IS_SAFARI} from '../../environment/userAgent';\nimport buildURLHash from '../../helpers/buildURLHash';\nimport copy from '../../helpers/object/copy';\nimport encodeEntities from '../../helpers/string/encodeEntities';\nimport {MessageEntity} from '../../layer';\nimport encodeSpoiler from './encodeSpoiler';\nimport parseEntities from './parseEntities';\nimport setBlankToAnchor from './setBlankToAnchor';\nimport wrapUrl from './wrapUrl';\nimport EMOJI_VERSIONS_SUPPORTED from '../../environment/emojiVersionsSupport';\nimport {CLICK_EVENT_NAME} from '../../helpers/dom/clickEvent';\nimport IS_CUSTOM_EMOJI_SUPPORTED from '../../environment/customEmojiSupport';\nimport rootScope from '../rootScope';\nimport mediaSizes from '../../helpers/mediaSizes';\nimport {wrapSticker} from '../../components/wrappers';\nimport RLottiePlayer from '../rlottie/rlottiePlayer';\nimport animationIntersector from '../../components/animationIntersector';\nimport type {MyDocument} from '../appManagers/appDocsManager';\nimport LazyLoadQueue from '../../components/lazyLoadQueue';\nimport {Awaited} from '../../types';\nimport sequentialDom from '../../helpers/sequentialDom';\nimport {MediaSize} from '../../helpers/mediaSize';\nimport IS_WEBM_SUPPORTED from '../../environment/webmSupport';\n\nconst resizeObserver = new ResizeObserver((entries) => {\n  for(const entry of entries) {\n    const renderer = entry.target.parentElement as CustomEmojiRendererElement;\n    renderer.setDimensionsFromRect(entry.contentRect);\n  }\n});\n\nclass CustomEmojiElement extends HTMLElement {\n\n}\n\nexport class CustomEmojiRendererElement extends HTMLElement {\n  public canvas: HTMLCanvasElement;\n  public context: CanvasRenderingContext2D;\n\n  public players: Map<CustomEmojiElement[], RLottiePlayer>;\n  public clearedContainers: Set<CustomEmojiElement[]>;\n\n  public paused: boolean;\n  public autoplay: boolean;\n\n  public middleware: () => boolean;\n  public keys: string[];\n\n  constructor() {\n    super();\n\n    this.classList.add('custom-emoji-renderer');\n    this.canvas = document.createElement('canvas');\n    this.canvas.classList.add('custom-emoji-canvas');\n    this.context = this.canvas.getContext('2d');\n    this.append(this.canvas);\n\n    this.paused = false;\n    this.autoplay = true;\n    this.players = new Map();\n    this.clearedContainers = new Set();\n    this.keys = [];\n  }\n\n  public connectedCallback() {\n    // this.setDimensions();\n    animationIntersector.addAnimation(this, 'EMOJI');\n    resizeObserver.observe(this.canvas);\n\n    this.connectedCallback = undefined;\n  }\n\n  public disconnectedCallback() {\n    for(const key of this.keys) {\n      const l = lotties.get(key);\n      if(!l) {\n        continue;\n      }\n\n      if(!--l.counter) {\n        if(l.player instanceof RLottiePlayer) {\n          l.player.remove();\n        }\n\n        lotties.delete(key);\n\n        if(!lotties.size) {\n          clearRenderInterval();\n        }\n      }\n    }\n\n    resizeObserver.unobserve(this.canvas);\n\n    this.disconnectedCallback = undefined;\n  }\n\n  public getOffsets(offsetsMap: Map<CustomEmojiElement[], {top: number, left: number}[]> = new Map()) {\n    for(const [containers, player] of this.players) {\n      const offsets = containers.map((container) => {\n        return {\n          top: container.offsetTop,\n          left: container.offsetLeft\n        };\n      });\n\n      offsetsMap.set(containers, offsets);\n    }\n\n    return offsetsMap;\n  }\n\n  public clearCanvas() {\n    const {context, canvas} = this;\n    context.clearRect(0, 0, canvas.width, canvas.height);\n  }\n\n  public render(offsetsMap: ReturnType<CustomEmojiRendererElement['getOffsets']>) {\n    const {context, canvas} = this;\n    const {width, height, dpr} = canvas;\n    for(const [containers, player] of this.players) {\n      const frame = topFrames.get(player);\n      if(!frame) {\n        continue;\n      }\n\n      const isImageData = frame instanceof ImageData;\n      const {width: stickerWidth, height: stickerHeight} = player.canvas[0];\n      const offsets = offsetsMap.get(containers);\n      const maxTop = height - stickerHeight;\n      const maxLeft = width - stickerWidth;\n\n      if(!this.clearedContainers.has(containers)) {\n        containers.forEach((container) => {\n          container.textContent = '';\n        });\n\n        this.clearedContainers.add(containers);\n      }\n\n      offsets.forEach(({top, left}) => {\n        top = Math.round(top * dpr), left = Math.round(left * dpr);\n        if(/* top > maxTop ||  */left > maxLeft) {\n          return;\n        }\n\n        if(isImageData) {\n          context.putImageData(frame as ImageData, left, top);\n        } else {\n          // context.clearRect(left, top, width, height);\n          context.drawImage(frame as ImageBitmap, left, top, stickerWidth, stickerHeight);\n        }\n      });\n    }\n  }\n\n  public checkForAnyFrame() {\n    for(const [containers, player] of this.players) {\n      if(topFrames.has(player)) {\n        return true;\n      }\n    }\n\n    return false;\n  }\n\n  public pause() {\n    this.paused = true;\n  }\n\n  public play() {\n    this.paused = false;\n  }\n\n  public remove() {\n    this.canvas.remove();\n  }\n\n  public setDimensions() {\n    const {canvas} = this;\n    sequentialDom.mutateElement(canvas, () => {\n      const rect = canvas.getBoundingClientRect();\n      this.setDimensionsFromRect(rect);\n    });\n  }\n\n  public setDimensionsFromRect(rect: DOMRect) {\n    const {canvas} = this;\n    const dpr = canvas.dpr ??= Math.min(2, window.devicePixelRatio);\n    canvas.width = Math.round(rect.width * dpr);\n    canvas.height = Math.round(rect.height * dpr);\n  }\n}\n\ntype R = CustomEmojiRendererElement;\n\nlet renderInterval: number;\nconst top: Array<R> = [];\nconst topFrames: Map<RLottiePlayer, Parameters<RLottiePlayer['overrideRender']>[0]> = new Map();\nconst lotties: Map<string, {player: Promise<RLottiePlayer> | RLottiePlayer, middlewares: Set<() => boolean>, counter: number}> = new Map();\nconst rerere = () => {\n  const t = top.filter((r) => !r.paused && r.isConnected && r.checkForAnyFrame());\n  if(!t.length) {\n    return;\n  }\n\n  const offsetsMap: Map<CustomEmojiElement[], {top: number, left: number}[]> = new Map();\n  for(const r of t) {\n    r.getOffsets(offsetsMap);\n  }\n\n  for(const r of t) {\n    r.clearCanvas();\n  }\n\n  for(const r of t) {\n    r.render(offsetsMap);\n  }\n};\nconst CUSTOM_EMOJI_FPS = 60;\nconst CUSTOM_EMOJI_FRAME_INTERVAL = 1000 / CUSTOM_EMOJI_FPS;\nconst setRenderInterval = () => {\n  if(renderInterval) {\n    return;\n  }\n\n  renderInterval = window.setInterval(rerere, CUSTOM_EMOJI_FRAME_INTERVAL);\n  rerere();\n};\nconst clearRenderInterval = () => {\n  if(!renderInterval) {\n    return;\n  }\n\n  clearInterval(renderInterval);\n  renderInterval = undefined;\n};\n\n(window as any).lotties = lotties;\n\ncustomElements.define('custom-emoji-element', CustomEmojiElement);\ncustomElements.define('custom-emoji-renderer-element', CustomEmojiRendererElement);\n\n/**\n * * Expecting correctly sorted nested entities (RichTextProcessor.sortEntities)\n */\nexport default function wrapRichText(text: string, options: Partial<{\n  entities: MessageEntity[],\n  contextSite: string,\n  highlightUsername: string,\n  noLinks: boolean,\n  noLinebreaks: boolean,\n  noCommands: boolean,\n  wrappingDraft: boolean,\n  // mustWrapEmoji: boolean,\n  fromBot: boolean,\n  noTextFormat: boolean,\n  passEntities: Partial<{\n    [_ in MessageEntity['_']]: boolean\n  }>,\n  noEncoding: boolean,\n\n  contextHashtag?: string,\n  nasty?: {\n    i: number,\n    usedLength: number,\n    text: string,\n    lastEntity?: MessageEntity\n  },\n  voodoo?: boolean,\n  customEmojis?: {[docId: DocId]: CustomEmojiElement[]},\n  loadPromises?: Promise<any>[],\n  middleware?: () => boolean,\n  wrappingSpoiler?: boolean,\n  lazyLoadQueue?: LazyLoadQueue,\n  customEmojiSize?: MediaSize\n}> = {}) {\n  const fragment = document.createDocumentFragment();\n  if(!text) {\n    return fragment;\n  }\n\n  const nasty = options.nasty ??= {\n    i: 0,\n    usedLength: 0,\n    text\n  };\n\n  const customEmojis = options.customEmojis ??= {};\n\n  const entities = options.entities ??= parseEntities(nasty.text);\n\n  const passEntities = options.passEntities ??= {};\n  const contextSite = options.contextSite ??= 'Telegram';\n  const contextExternal = contextSite !== 'Telegram';\n\n  const textLength = nasty.text.length;\n  const length = entities.length;\n  let lastElement: HTMLElement | DocumentFragment;\n  for(; nasty.i < length; ++nasty.i) {\n    let entity = entities[nasty.i];\n\n    // * check whether text was sliced\n    // TODO: consider about moving it to other function\n    if(entity.offset >= textLength) {\n      if(entity._ !== 'messageEntityCaret') { // * can set caret to the end\n        continue;\n      }\n    } else if((entity.offset + entity.length) > textLength) {\n      entity = copy(entity);\n      entity.length = entity.offset + entity.length - textLength;\n    }\n\n    if(entity.length) {\n      nasty.lastEntity = entity;\n    }\n\n    let nextEntity = entities[nasty.i + 1];\n\n    const startOffset = entity.offset;\n    const endOffset = startOffset + entity.length;\n    const endPartOffset = Math.min(endOffset, nextEntity?.offset ?? 0xFFFF);\n    const fullEntityText = nasty.text.slice(startOffset, endOffset);\n    const sliced = nasty.text.slice(startOffset, endPartOffset);\n    let partText = sliced;\n\n    if(nasty.usedLength < startOffset) {\n      (lastElement || fragment).append(nasty.text.slice(nasty.usedLength, startOffset));\n    }\n\n    if(lastElement) {\n      lastElement = fragment;\n    }\n\n    nasty.usedLength = endPartOffset;\n\n    let element: HTMLElement,\n      property: 'textContent' | 'alt' = 'textContent',\n      usedText = false;\n    switch(entity._) {\n      case 'messageEntityBold': {\n        if(!options.noTextFormat) {\n          if(options.wrappingDraft) {\n            element = document.createElement('span');\n            element.style.fontWeight = 'bold';\n          } else {\n            element = document.createElement('strong');\n          }\n        }\n\n        break;\n      }\n\n      case 'messageEntityItalic': {\n        if(!options.noTextFormat) {\n          if(options.wrappingDraft) {\n            element = document.createElement('span');\n            element.style.fontStyle = 'italic';\n          } else {\n            element = document.createElement('em');\n          }\n        }\n\n        break;\n      }\n\n      case 'messageEntityStrike': {\n        if(options.wrappingDraft) {\n          const styleName = IS_SAFARI ? 'text-decoration' : 'text-decoration-line';\n          element = document.createElement('span');\n          element.style.cssText = `${styleName}: line-through;`;\n        } else if(!options.noTextFormat) {\n          element = document.createElement('del');\n        }\n\n        break;\n      }\n\n      case 'messageEntityUnderline': {\n        if(options.wrappingDraft) {\n          const styleName = IS_SAFARI ? 'text-decoration' : 'text-decoration-line';\n          element = document.createElement('span');\n          element.style.cssText = `${styleName}: underline;`;\n        } else if(!options.noTextFormat) {\n          element = document.createElement('u');\n        }\n\n        break;\n      }\n\n      case 'messageEntityPre':\n      case 'messageEntityCode': {\n        if(options.wrappingDraft) {\n          element = document.createElement('span');\n          element.style.fontFamily = 'var(--font-monospace)';\n        } else if(!options.noTextFormat) {\n          element = document.createElement('code');\n        }\n\n        break;\n      }\n\n      // case 'messageEntityPre': {\n      //   if(options.wrappingDraft) {\n      //     element = document.createElement('span');\n      //     element.style.fontFamily = 'var(--font-monospace)';\n      //   } else if(!options.noTextFormat) {\n      //     element = document.createElement('pre');\n      //     const inner = document.createElement('code');\n      //     if(entity.language) {\n      //       inner.className = 'language-' + entity.language;\n      //       inner.textContent = entityText;\n      //       usedText = true;\n      //     }\n      //   }\n\n      //   break;\n      // }\n\n      case 'messageEntityHighlight': {\n        element = document.createElement('i');\n        element.className = 'text-highlight';\n        break;\n      }\n\n      case 'messageEntityBotCommand': {\n        // if(!(options.noLinks || options.noCommands || contextExternal)/*  && !entity.unsafe */) {\n        if(!options.noLinks && passEntities[entity._]) {\n          let command = fullEntityText.slice(1);\n          let bot: string | boolean;\n          let atPos: number;\n          if((atPos = command.indexOf('@')) !== -1) {\n            bot = command.slice(atPos + 1);\n            command = command.slice(0, atPos);\n          } else {\n            bot = options.fromBot;\n          }\n\n          element = document.createElement('a');\n          (element as HTMLAnchorElement).href = encodeEntities('tg://bot_command?command=' + encodeURIComponent(command) + (bot ? '&bot=' + encodeURIComponent(bot) : ''));\n          if(!contextExternal) {\n            element.setAttribute('onclick', 'execBotCommand(this)');\n          }\n        }\n\n        break;\n      }\n\n      case 'messageEntityCustomEmoji': {\n        if(!IS_CUSTOM_EMOJI_SUPPORTED) {\n          break;\n        }\n\n        if(nextEntity?._ === 'messageEntityEmoji') {\n          ++nasty.i;\n          nasty.lastEntity = nextEntity;\n          nasty.usedLength += nextEntity.length;\n          nextEntity = entities[nasty.i + 1];\n        }\n\n        (customEmojis[entity.document_id] ??= []).push(element = new CustomEmojiElement());\n        element.classList.add('custom-emoji');\n\n        property = 'alt';\n        break;\n      }\n\n      case 'messageEntityEmoji': {\n        let isSupported = IS_EMOJI_SUPPORTED;\n        if(isSupported) {\n          for(const version in EmojiVersions) {\n            if(version) {\n              const emojiData = EmojiVersions[version as EMOJI_VERSION];\n              if(emojiData.hasOwnProperty(entity.unicode) && !EMOJI_VERSIONS_SUPPORTED[version as EMOJI_VERSION]) {\n                isSupported = false;\n                break;\n              }\n            }\n          }\n        }\n\n        // if(!(options.wrappingDraft && isSupported)) { // * fix safari emoji\n        if(!isSupported) { // no wrapping needed\n          // if(isSupported) { // ! contenteditable=\"false\"    ,       Safari,     ,  \n          //   insertPart(entity, '<span class=\"emoji\">', '</span>');\n          // } else {\n          element = document.createElement('img');\n          (element as HTMLImageElement).src = `assets/img/emoji/${entity.unicode}.png`;\n          property = 'alt';\n          element.className = 'emoji';\n          // }\n        // } else if(options.mustWrapEmoji) {\n        } else if(!options.wrappingDraft) {\n          element = document.createElement('span');\n          element.className = 'emoji';\n        }/*  else if(!IS_SAFARI) {\n          insertPart(entity, '<span class=\"emoji\" contenteditable=\"false\">', '</span>');\n        } */\n        /* if(!isSupported) {\n          insertPart(entity, `<img src=\"assets/img/emoji/${entity.unicode}.png\" alt=\"`, `\" class=\"emoji\">`);\n        } */\n\n        break;\n      }\n\n      case 'messageEntityCaret': {\n        element = document.createElement('span');\n        element.className = 'composer-sel';\n        break;\n      }\n\n      // case 'messageEntityLinebreak': {\n      //   if(options.noLinebreaks) {\n      //     insertPart(entity, ' ');\n      //   } else {\n      //     insertPart(entity, '<br/>');\n      //   }\n\n      //   break;\n      // }\n\n      case 'messageEntityUrl':\n      case 'messageEntityTextUrl': {\n        if(!(options.noLinks && !passEntities[entity._])) {\n          // let inner: string;\n          let url: string = (entity as MessageEntity.messageEntityTextUrl).url || fullEntityText;\n          let masked = false;\n          let onclick: string;\n\n          const wrapped = wrapUrl(url, true);\n          url = wrapped.url;\n          onclick = wrapped.onclick;\n\n          if(entity._ === 'messageEntityTextUrl') {\n            if(nextEntity?._ === 'messageEntityUrl' &&\n              nextEntity.length === entity.length &&\n              nextEntity.offset === entity.offset) {\n              nasty.lastEntity = nextEntity;\n              ++nasty.i;\n            }\n\n            if(url !== fullEntityText) {\n              masked = true;\n            }\n          } else {\n            // inner = encodeEntities(replaceUrlEncodings(entityText));\n          }\n\n          const currentContext = !!onclick;\n          if(!onclick && masked && !currentContext) {\n            onclick = 'showMaskedAlert';\n          }\n\n          if(options.wrappingDraft) {\n            onclick = undefined;\n          }\n\n          const href = (currentContext || typeof electronHelpers === 'undefined') ?\n            url :\n            `javascript:electronHelpers.openExternal('${url}');`;\n\n          element = document.createElement('a');\n          element.className = 'anchor-url';\n          (element as HTMLAnchorElement).href = href;\n\n          if(!(currentContext || typeof electronHelpers !== 'undefined')) {\n            setBlankToAnchor(element as HTMLAnchorElement);\n          }\n\n          if(onclick) {\n            element.setAttribute('onclick', onclick + '(this)');\n          }\n        }\n\n        break;\n      }\n\n      case 'messageEntityEmail': {\n        if(!options.noLinks) {\n          element = document.createElement('a');\n          (element as HTMLAnchorElement).href = encodeEntities('mailto:' + fullEntityText);\n          setBlankToAnchor(element as HTMLAnchorElement);\n        }\n\n        break;\n      }\n\n      case 'messageEntityHashtag': {\n        const contextUrl = !options.noLinks && SITE_HASHTAGS[contextSite];\n        if(contextUrl) {\n          const hashtag = fullEntityText.slice(1);\n          element = document.createElement('a');\n          element.className = 'anchor-hashtag';\n          (element as HTMLAnchorElement).href = contextUrl.replace('{1}', encodeURIComponent(hashtag));\n          if(contextExternal) {\n            setBlankToAnchor(element as HTMLAnchorElement);\n          } else {\n            element.setAttribute('onclick', 'searchByHashtag(this)');\n          }\n        }\n\n        break;\n      }\n\n      case 'messageEntityMentionName': {\n        if(!(options.noLinks && !passEntities[entity._])) {\n          element = document.createElement('a');\n          (element as HTMLAnchorElement).href = buildURLHash('' + entity.user_id);\n          element.className = 'follow';\n          element.dataset.follow = '' + entity.user_id;\n        }\n\n        break;\n      }\n\n      case 'messageEntityMention': {\n        // const contextUrl = !options.noLinks && siteMentions[contextSite];\n        if(!options.noLinks) {\n          const username = fullEntityText.slice(1);\n\n          const {url, onclick} = wrapUrl('t.me/' + username);\n\n          element = document.createElement('a');\n          element.className = 'mention';\n          (element as HTMLAnchorElement).href = url;\n          if(onclick) {\n            element.setAttribute('onclick', `${onclick}(this)`);\n          }\n\n          // insertPart(entity, `<a class=\"mention\" href=\"${contextUrl.replace('{1}', encodeURIComponent(username))}\"${contextExternal ? ' target=\"_blank\" rel=\"noopener noreferrer\"' : ''}>`, '</a>');\n        }\n\n        break;\n      }\n\n      case 'messageEntitySpoiler': {\n        if(options.noTextFormat) {\n          const encoded = encodeSpoiler(nasty.text, entity);\n          nasty.text = encoded.text;\n          partText = encoded.entityText;\n          nasty.usedLength += partText.length;\n          let n: MessageEntity;\n          for(; n = entities[nasty.i + 1], n && n.offset < endOffset;) {\n            // nasty.usedLength += n.length;\n            ++nasty.i;\n            nasty.lastEntity = n;\n            nextEntity = entities[nasty.i + 1];\n          }\n        } else if(options.wrappingDraft) {\n          element = document.createElement('span');\n          element.style.fontFamily = 'spoiler';\n        } else {\n          const container = document.createElement('span');\n          container.className = 'spoiler';\n          element = document.createElement('span');\n          element.className = 'spoiler-text';\n          element.textContent = partText;\n          usedText = true;\n          container.append(element);\n          fragment.append(container);\n\n          container[`on${CLICK_EVENT_NAME}`] = (window as any).onSpoilerClick;\n        }\n\n        break;\n      }\n    }\n\n    if(!usedText) {\n      if(element) {\n        // @ts-ignore\n        element[property] = partText;\n      } else {\n        (element || fragment).append(partText);\n      }\n    }\n\n    if(element && !element.parentElement) {\n      (lastElement || fragment).append(element);\n    }\n\n    while(nextEntity && nextEntity.offset < endOffset) {\n      ++nasty.i;\n\n      (element || fragment).append(wrapRichText(nasty.text, {\n        ...options,\n        voodoo: true\n      }));\n\n      nextEntity = entities[nasty.i + 1];\n    }\n\n    // if(!element?.parentElement) {\n    //   (lastElement || fragment).append(element ?? partText);\n    // }\n\n    if(nasty.usedLength <= endOffset) {\n      if(nasty.usedLength < endOffset) {\n        (element || fragment).append(nasty.text.slice(nasty.usedLength, endOffset));\n        nasty.usedLength = endOffset;\n      }\n\n      lastElement = fragment;\n      nasty.lastEntity = undefined;\n    } else if(entity.length > partText.length && element) {\n      lastElement = element;\n    } else {\n      lastElement = fragment;\n    }\n\n    if(options.voodoo) {\n      return fragment;\n    }\n  }\n\n  if(nasty.lastEntity) {\n    nasty.usedLength = nasty.lastEntity.offset + nasty.lastEntity.length;\n  }\n\n  if(nasty.usedLength < textLength) {\n    (lastElement || fragment).append(nasty.text.slice(nasty.usedLength));\n  }\n\n  const docIds = Object.keys(customEmojis) as DocId[];\n  if(docIds.length) {\n    const managers = rootScope.managers;\n    const middleware = options.middleware;\n    const renderer = new CustomEmojiRendererElement();\n    renderer.middleware = middleware;\n    top.push(renderer);\n    fragment.prepend(renderer);\n\n    const size = options.customEmojiSize || mediaSizes.active.customEmoji;\n    const loadPromise = managers.appEmojiManager.getCachedCustomEmojiDocuments(docIds).then((docs) => {\n      // console.log(docs);\n      if(middleware && !middleware()) return;\n\n      const loadPromises: Promise<any>[] = [];\n      const wrap = (doc: MyDocument, _loadPromises?: Promise<any>[]): Promise<Awaited<ReturnType<typeof wrapSticker>> & {onRender?: () => void}> => {\n        const containers = customEmojis[doc.id];\n        const isLottie = doc.sticker === 2;\n\n        const loadPromises: Promise<any>[] = [];\n        const promise = wrapSticker({\n          div: containers,\n          doc,\n          width: size.width,\n          height: size.height,\n          loop: true,\n          play: true,\n          managers,\n          isCustomEmoji: true,\n          group: 'none',\n          loadPromises,\n          middleware,\n          exportLoad: true,\n          needFadeIn: false,\n          loadStickerMiddleware: isLottie && middleware ? () => {\n            if(lotties.get(key) !== l) {\n              return false;\n            }\n\n            let good = !l.middlewares.size;\n            for(const middleware of l.middlewares) {\n              if(middleware()) {\n                good = true;\n              }\n            }\n\n            return good;\n          } : undefined,\n          static: doc.mime_type === 'video/webm' && !IS_WEBM_SUPPORTED\n        });\n\n        if(_loadPromises) {\n          promise.then(() => _loadPromises.push(...loadPromises));\n        }\n\n        if(!isLottie) {\n          return promise;\n        }\n\n        const onRender = (player: Awaited<Awaited<typeof promise>['render']>) => Promise.all(loadPromises).then(() => {\n          if(player instanceof RLottiePlayer && (!middleware || middleware())) {\n            l.player = player;\n\n            const playerCanvas = player.canvas[0];\n            renderer.canvas.dpr = playerCanvas.dpr;\n            renderer.players.set(containers, player);\n\n            setRenderInterval();\n\n            player.overrideRender ??= (frame) => {\n              topFrames.set(player, frame);\n              // frames.set(containers, frame);\n            };\n\n            l.middlewares.delete(middleware);\n          }\n        });\n\n        const key = [doc.id, size.width, size.height].join('-');\n        renderer.keys.push(key);\n        let l = lotties.get(key);\n        if(!l) {\n          l = {\n            player: undefined,\n            middlewares: new Set(),\n            counter: 0\n          };\n\n          lotties.set(key, l);\n        }\n\n        ++l.counter;\n\n        if(middleware) {\n          l.middlewares.add(middleware);\n        }\n\n        return promise.then((res) => ({...res, onRender}));\n      };\n\n      const missing: DocId[] = [];\n      const cachedPromises = docs.map((doc, idx) => {\n        if(!doc) {\n          missing.push(docIds[idx]);\n          return;\n        }\n\n        return wrap(doc, loadPromises);\n      }).filter(Boolean);\n\n      const uncachedPromisesPromise = managers.appEmojiManager.getCustomEmojiDocuments(missing).then((docs) => {\n        if(middleware && !middleware()) return [];\n        return docs.filter(Boolean).map((doc) => wrap(doc));\n      });\n\n      const loadFromPromises = (promises: typeof cachedPromises) => {\n        return Promise.all(promises).then((arr) => {\n          const promises = arr.map(({load, onRender}) => {\n            if(!load) {\n              return;\n            }\n\n            return load().then(onRender);\n          });\n\n          return Promise.all(promises);\n        });\n      };\n\n      const load = () => {\n        if(middleware && !middleware()) return;\n        const cached = loadFromPromises(cachedPromises);\n        const uncached = uncachedPromisesPromise.then((promises) => loadFromPromises(promises));\n        return Promise.all([cached, uncached]);\n      };\n\n      if(options.lazyLoadQueue) {\n        options.lazyLoadQueue.push({\n          div: renderer.canvas,\n          load\n        });\n      } else {\n        load();\n      }\n\n      return Promise.all(cachedPromises).then(() => Promise.all(loadPromises)).then(() => {});\n    });\n\n    // recordPromise(loadPromise, 'render emojis: ' + docIds.length);\n\n    options.loadPromises?.push(loadPromise);\n  }\n\n  return fragment;\n}\n\n(window as any).wrapRichText = wrapRichText;\n","// just for the future\nexport default function buildURLHash(str: string) {\n  return '#' + encodeURIComponent(str);\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport CAN_USE_TRANSFERABLES from '../../environment/canUseTransferables';\nimport EventListenerBase from '../../helpers/eventListenerBase';\n\nexport default class QueryableWorker extends EventListenerBase<{\n  ready: () => void,\n  frame: (reqId: number, frameNo: number, frame: Uint8ClampedArray | ImageBitmap) => void,\n  loaded: (reqId: number, frameCount: number, fps: number) => void,\n  error: (reqId: number, error: Error) => void,\n  workerError: (error: ErrorEvent) => void\n}> {\n  constructor(private worker: Worker) {\n    super();\n\n    this.worker.onerror = (error) => {\n      try {\n        this.dispatchEvent('workerError', error);\n        this.cleanup();\n        this.terminate();\n      } catch(err) {\n\n      }\n    };\n\n    this.worker.onmessage = (event) => {\n      this.dispatchEvent(event.data.queryMethodListener, ...event.data.queryMethodArguments);\n    };\n  }\n\n  public postMessage(message: any) {\n    this.worker.postMessage(message);\n  }\n\n  public terminate() {\n    this.worker.terminate();\n  }\n\n  public sendQuery(args: any[], transfer?: Transferable[]) {\n    this.worker.postMessage({\n      queryMethod: args.shift(),\n      queryMethodArguments: args\n    }, CAN_USE_TRANSFERABLES ? transfer: undefined);\n  }\n}\n","const IS_WEB_ASSEMBLY_SUPPORTED = typeof(WebAssembly) !== 'undefined';\n\nexport default IS_WEB_ASSEMBLY_SUPPORTED;\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport animationIntersector, {AnimationItemGroup} from '../../components/animationIntersector';\r\nimport {MOUNT_CLASS_TO} from '../../config/debug';\r\nimport pause from '../../helpers/schedulers/pause';\r\nimport {logger, LogTypes} from '../logger';\r\nimport RLottiePlayer, {RLottieOptions} from './rlottiePlayer';\r\nimport QueryableWorker from './queryableWorker';\r\nimport blobConstruct from '../../helpers/blob/blobConstruct';\r\nimport apiManagerProxy from '../mtproto/mtprotoworker';\r\nimport IS_WEB_ASSEMBLY_SUPPORTED from '../../environment/webAssemblySupport';\r\nimport makeError from '../../helpers/makeError';\r\n\r\nexport type LottieAssetName = 'EmptyFolder' | 'Folders_1' | 'Folders_2' |\r\n  'TwoFactorSetupMonkeyClose' | 'TwoFactorSetupMonkeyCloseAndPeek' |\r\n  'TwoFactorSetupMonkeyCloseAndPeekToIdle' | 'TwoFactorSetupMonkeyIdle' |\r\n  'TwoFactorSetupMonkeyPeek' | 'TwoFactorSetupMonkeyTracking' |\r\n  'voice_outlined2' | 'voip_filled' | 'voice_mini';\r\n\r\nexport class LottieLoader {\r\n  private loadPromise: Promise<void> = !IS_WEB_ASSEMBLY_SUPPORTED ? Promise.reject() : undefined;\r\n  private loaded = false;\r\n\r\n  private workersLimit = 4;\r\n  private players: {[reqId: number]: RLottiePlayer} = {};\r\n  private playersByCacheName: {[cacheName: string]: Set<RLottiePlayer>} = {};\r\n\r\n  private workers: QueryableWorker[] = [];\r\n  private curWorkerNum = 0;\r\n\r\n  private log = logger('LOTTIE', LogTypes.Error);\r\n\r\n  public getAnimation(element: HTMLElement) {\r\n    for(const i in this.players) {\r\n      if(this.players[i].el.includes(element)) {\r\n        return this.players[i];\r\n      }\r\n    }\r\n\r\n    return null;\r\n  }\r\n\r\n  public setLoop(loop: boolean) {\r\n    for(const i in this.players) {\r\n      const player = this.players[i];\r\n      player.loop = loop;\r\n      player.autoplay = player._autoplay;\r\n    }\r\n  }\r\n\r\n  public loadLottieWorkers() {\r\n    if(this.loadPromise) {\r\n      return this.loadPromise;\r\n    }\r\n\r\n    return this.loadPromise = new Promise((resolve, reject) => {\r\n      let remain = this.workersLimit;\r\n      for(let i = 0; i < this.workersLimit; ++i) {\r\n        const worker = new Worker(new URL('./rlottie.worker.ts', import.meta.url));\r\n        const queryableWorker = this.workers[i] = new QueryableWorker(worker);\r\n\r\n        queryableWorker.addEventListener('ready', () => {\r\n          this.log('worker #' + i + ' ready');\r\n\r\n          queryableWorker.addEventListener('frame', this.onFrame);\r\n          queryableWorker.addEventListener('loaded', this.onPlayerLoaded);\r\n          queryableWorker.addEventListener('error', this.onPlayerError);\r\n\r\n          --remain;\r\n          if(!remain) {\r\n            this.log('workers ready');\r\n            resolve();\r\n            this.loaded = true;\r\n          }\r\n        }, {once: true});\r\n\r\n        queryableWorker.addEventListener('workerError', (error) => {\r\n          reject('rlottie load error: ' + error.message);\r\n          this.loaded = false;\r\n        }, {once: true});\r\n      }\r\n    });\r\n  }\r\n\r\n  public loadAnimationAsAsset(params: Omit<RLottieOptions, 'animationData' | 'name'>, name: LottieAssetName) {\r\n    (params as RLottieOptions).name = name;\r\n    return this.loadAnimationFromURL(params, 'assets/tgs/' + name + '.json');\r\n  }\r\n\r\n  public loadAnimationFromURL(params: Omit<RLottieOptions, 'animationData'>, url: string): Promise<RLottiePlayer> {\r\n    if(!IS_WEB_ASSEMBLY_SUPPORTED) {\r\n      return this.loadPromise as any;\r\n    }\r\n\r\n    if(!this.loaded) {\r\n      this.loadLottieWorkers();\r\n    }\r\n\r\n    return fetch(url)\r\n    .then((res) => {\r\n      if(!res.headers || res.headers.get('content-type') === 'application/octet-stream') {\r\n        return res.arrayBuffer().then((data) => apiManagerProxy.invokeCrypto('gzipUncompress', data)).then((arr) => blobConstruct(arr as Uint8Array, ''))\r\n      } else {\r\n        return res.blob();\r\n      }\r\n    })\r\n    /* .then((str) => {\r\n      return new Promise<string>((resolve) => setTimeout(() => resolve(str), 2e3));\r\n    }) */\r\n    .then((blob) => {\r\n      const newParams = Object.assign(params, {animationData: blob, needUpscale: true});\r\n      if(!newParams.name) newParams.name = url;\r\n      return this.loadAnimationWorker(newParams);\r\n    });\r\n  }\r\n\r\n  public waitForFirstFrame(player: RLottiePlayer) {\r\n    return Promise.race([\r\n      /* new Promise<void>((resolve) => {\r\n        player.addEventListener('firstFrame', () => {\r\n          setTimeout(() => resolve(), 1500);\r\n        }, true);\r\n      }) */\r\n      new Promise<void>((resolve) => {\r\n        player.addEventListener('firstFrame', resolve, {once: true});\r\n      }),\r\n      pause(2500)\r\n    ]).then(() => player);\r\n  }\r\n\r\n  public async loadAnimationWorker(\r\n    params: RLottieOptions,\r\n    group: AnimationItemGroup = params.group || '',\r\n    middleware?: () => boolean\r\n  ): Promise<RLottiePlayer> {\r\n    if(!IS_WEB_ASSEMBLY_SUPPORTED) {\r\n      return this.loadPromise as any;\r\n    }\r\n\r\n    if(!this.loaded) {\r\n      await this.loadLottieWorkers();\r\n    }\r\n\r\n    if(middleware && !middleware()) {\r\n      throw makeError('MIDDLEWARE');\r\n    }\r\n\r\n    if(params.sync) {\r\n      const cacheName = RLottiePlayer.CACHE.generateName(params.name, params.width, params.height, params.color, params.toneIndex);\r\n      const players = this.playersByCacheName[cacheName];\r\n      if(players?.size) {\r\n        return Promise.resolve(players.entries().next().value[0]);\r\n      }\r\n    }\r\n\r\n    const containers = Array.isArray(params.container) ? params.container : [params.container];\r\n    if(!params.width || !params.height) {\r\n      params.width = parseInt(containers[0].style.width);\r\n      params.height = parseInt(containers[0].style.height);\r\n    }\r\n\r\n    if(!params.width || !params.height) {\r\n      throw new Error('No size for sticker!');\r\n    }\r\n\r\n    params.group = group;\r\n\r\n    const player = this.initPlayer(containers, params);\r\n\r\n    if(group !== 'none') {\r\n      animationIntersector.addAnimation(player, group);\r\n    }\r\n\r\n    return player;\r\n  }\r\n\r\n  private onPlayerLoaded = (reqId: number, frameCount: number, fps: number) => {\r\n    const player = this.players[reqId];\r\n    if(!player) {\r\n      this.log.warn('onPlayerLoaded on destroyed player:', reqId, frameCount);\r\n      return;\r\n    }\r\n\r\n    this.log.debug('onPlayerLoaded');\r\n    player.onLoad(frameCount, fps);\r\n  };\r\n\r\n  private onFrame = (reqId: number, frameNo: number, frame: Uint8ClampedArray | ImageBitmap) => {\r\n    const player = this.players[reqId];\r\n    if(!player) {\r\n      this.log.warn('onFrame on destroyed player:', reqId, frameNo);\r\n      return;\r\n    }\r\n\r\n    if(player.clamped !== undefined && frame instanceof Uint8ClampedArray) {\r\n      player.clamped = frame;\r\n    }\r\n\r\n    player.renderFrame(frame, frameNo);\r\n  };\r\n\r\n  private onPlayerError = (reqId: number, error: Error) => {\r\n    const player = this.players[reqId];\r\n    if(!player) {\r\n      return;\r\n    }\r\n\r\n    // ! will need refactoring later, this is not the best way to remove the animation\r\n    const animations = animationIntersector.getAnimations(player.el[0]);\r\n    animations.forEach((animation) => {\r\n      animationIntersector.checkAnimation(animation, true, true);\r\n    });\r\n  };\r\n\r\n  public onDestroy(reqId: number) {\r\n    delete this.players[reqId];\r\n  }\r\n\r\n  public destroyWorkers() {\r\n    if(!IS_WEB_ASSEMBLY_SUPPORTED) {\r\n      return;\r\n    }\r\n\r\n    this.workers.forEach((worker, idx) => {\r\n      worker.terminate();\r\n      this.log('worker #' + idx + ' terminated');\r\n    });\r\n\r\n    this.log('workers destroyed');\r\n    this.workers.length = 0;\r\n    this.curWorkerNum = 0;\r\n    this.loaded = false;\r\n    this.loadPromise = undefined;\r\n  }\r\n\r\n  private initPlayer(el: RLottiePlayer['el'], options: RLottieOptions) {\r\n    const player = new RLottiePlayer({\r\n      el,\r\n      worker: this.workers[this.curWorkerNum++],\r\n      options\r\n    });\r\n\r\n    const {reqId, cacheName} = player;\r\n    this.players[reqId] = player;\r\n\r\n    const playersByCacheName = cacheName ? this.playersByCacheName[cacheName] ??= new Set() : undefined;\r\n    if(cacheName) {\r\n      playersByCacheName.add(player);\r\n    }\r\n\r\n    if(this.curWorkerNum >= this.workers.length) {\r\n      this.curWorkerNum = 0;\r\n    }\r\n\r\n    player.addEventListener('destroy', () => {\r\n      this.onDestroy(reqId);\r\n      if(playersByCacheName.delete(player) && !playersByCacheName.size) {\r\n        delete this.playersByCacheName[cacheName];\r\n      }\r\n    });\r\n\r\n    player.loadFromData(options.animationData);\r\n\r\n    return player;\r\n  }\r\n}\r\n\r\nconst lottieLoader = new LottieLoader();\r\nMOUNT_CLASS_TO.lottieLoader = lottieLoader;\r\nexport default lottieLoader;\r\n","const IS_IMAGE_BITMAP_SUPPORTED = typeof(ImageBitmap) !== 'undefined';\n\nexport default IS_IMAGE_BITMAP_SUPPORTED;\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport CAN_USE_TRANSFERABLES from '../../environment/canUseTransferables';\nimport IS_APPLE_MX from '../../environment/appleMx';\nimport {IS_ANDROID, IS_APPLE_MOBILE, IS_APPLE, IS_SAFARI} from '../../environment/userAgent';\nimport EventListenerBase from '../../helpers/eventListenerBase';\nimport mediaSizes from '../../helpers/mediaSizes';\nimport clamp from '../../helpers/number/clamp';\nimport QueryableWorker from './queryableWorker';\nimport {AnimationItemGroup} from '../../components/animationIntersector';\nimport IS_IMAGE_BITMAP_SUPPORTED from '../../environment/imageBitmapSupport';\n\nexport type RLottieOptions = {\n  container: HTMLElement | HTMLElement[],\n  canvas?: HTMLCanvasElement,\n  autoplay?: boolean,\n  animationData: Blob,\n  loop?: boolean,\n  width?: number,\n  height?: number,\n  group?: AnimationItemGroup,\n  noCache?: boolean,\n  needUpscale?: boolean,\n  skipRatio?: number,\n  initFrame?: number, // index\n  color?: RLottieColor,\n  inverseColor?: RLottieColor,\n  name?: string,\n  skipFirstFrameRendering?: boolean,\n  toneIndex?: number,\n  sync?: boolean\n};\n\ntype RLottieCacheMap = Map<number, Uint8ClampedArray>;\ntype RLottieCacheMapNew = Map<number, HTMLCanvasElement | ImageBitmap>;\ntype RLottieCacheMapURLs = Map<number, string>;\ntype RLottieCacheItem = {\n  frames: RLottieCacheMap,\n  framesNew: RLottieCacheMapNew,\n  framesURLs: RLottieCacheMapURLs,\n  clearCache: () => void,\n  counter: number\n};\n\nclass RLottieCache {\n  private cache: Map<string, RLottieCacheItem>;\n\n  constructor() {\n    this.cache = new Map();\n  }\n\n  public static createCache(): RLottieCacheItem {\n    const cache: RLottieCacheItem = {\n      frames: new Map(),\n      framesNew: new Map(),\n      framesURLs: new Map(),\n      clearCache: () => {\n        cache.framesNew.forEach((value) => {\n          (value as ImageBitmap).close?.();\n        });\n\n        cache.frames.clear();\n        cache.framesNew.clear();\n        cache.framesURLs.clear();\n      },\n      counter: 0\n    };\n\n    return cache;\n  }\n\n  public getCache(name: string) {\n    let cache = this.cache.get(name);\n    if(!cache) {\n      this.cache.set(name, cache = RLottieCache.createCache());\n    } else {\n      // console.warn('[RLottieCache] cache will be reused', cache);\n    }\n\n    ++cache.counter;\n    return cache;\n  }\n\n  public releaseCache(name: string) {\n    const cache = this.cache.get(name);\n    if(cache && !--cache.counter) {\n      this.cache.delete(name);\n      // console.warn('[RLottieCache] released cache', cache);\n    }\n  }\n\n  public getCacheCounter(name: string) {\n    const cache = this.cache.get(name);\n    return cache?.counter;\n  }\n\n  public generateName(name: string, width: number, height: number, color: RLottieColor, toneIndex: number) {\n    return [\n      name,\n      width,\n      height,\n      // color ? rgbaToHexa(color) : ''\n      color ? 'colored' : '',\n      toneIndex || ''\n    ].filter(Boolean).join('-');\n  }\n}\n\nconst cache = new RLottieCache();\n\nexport type RLottieColor = [number, number, number];\n\nexport default class RLottiePlayer extends EventListenerBase<{\n  enterFrame: (frameNo: number) => void,\n  ready: () => void,\n  firstFrame: () => void,\n  cached: () => void,\n  destroy: () => void\n}> {\n  public static CACHE = cache;\n  private static reqId = 0;\n\n  public reqId = 0;\n  public curFrame: number;\n  private frameCount: number;\n  private fps: number;\n  private skipDelta: number;\n  public name: string;\n  public cacheName: string;\n  private toneIndex: number;\n\n  private worker: QueryableWorker;\n\n  private width = 0;\n  private height = 0;\n\n  public el: HTMLElement[];\n  public canvas: HTMLCanvasElement[];\n  private contexts: CanvasRenderingContext2D[];\n\n  public paused = true;\n  // public paused = false;\n  public direction = 1;\n  private speed = 1;\n  public autoplay = true;\n  public _autoplay: boolean; // ! will be used to store original value for settings.stickers.loop\n  public loop = true;\n  private _loop: boolean; // ! will be used to store original value for settings.stickers.loop\n  private group = '';\n\n  private frInterval: number;\n  private frThen: number;\n  private rafId: number;\n\n  // private caching = false;\n  // private removed = false;\n\n  private cache: RLottieCacheItem;\n  private imageData: ImageData;\n  public clamped: Uint8ClampedArray;\n  private cachingDelta = 0;\n\n  private initFrame: number;\n  private color: RLottieColor;\n  private inverseColor: RLottieColor;\n\n  public minFrame: number;\n  public maxFrame: number;\n\n  // private playedTimes = 0;\n\n  private currentMethod: RLottiePlayer['mainLoopForwards'] | RLottiePlayer['mainLoopBackwards'];\n  private frameListener: (currentFrame: number) => void;\n  private skipFirstFrameRendering: boolean;\n  private playToFrameOnFrameCallback: (frameNo: number) => void;\n\n  public overrideRender: (frame: ImageData | HTMLCanvasElement | ImageBitmap) => void;\n  private renderedFirstFrame: boolean;\n\n  constructor({el, worker, options}: {\n    el: RLottiePlayer['el'],\n    worker: QueryableWorker,\n    options: RLottieOptions\n  }) {\n    super(true);\n\n    this.reqId = ++RLottiePlayer['reqId'];\n    this.el = el;\n    this.worker = worker;\n\n    for(const i in options) {\n      if(this.hasOwnProperty(i)) {\n        // @ts-ignore\n        this[i] = options[i];\n      }\n    }\n\n    this._loop = this.loop;\n    this._autoplay = this.autoplay;\n\n    // ! :(\n    this.initFrame = options.initFrame;\n    this.color = options.color;\n    this.inverseColor = options.inverseColor;\n    this.name = options.name;\n    this.skipFirstFrameRendering = options.skipFirstFrameRendering;\n    this.toneIndex = options.toneIndex;\n\n    if(this.name) {\n      this.cacheName = cache.generateName(this.name, this.width, this.height, this.color, this.toneIndex);\n    }\n\n    // * Skip ratio (30fps)\n    let skipRatio: number;\n    if(options.skipRatio !== undefined) skipRatio = options.skipRatio;\n    else if((IS_ANDROID || IS_APPLE_MOBILE || (IS_APPLE && !IS_SAFARI && !IS_APPLE_MX)) && this.width < 100 && this.height < 100 && !options.needUpscale) {\n      skipRatio = 0.5;\n    }\n\n    this.skipDelta = skipRatio !== undefined ? 1 / skipRatio | 0 : 1;\n\n    // options.needUpscale = true;\n\n    // * Pixel ratio\n    let pixelRatio = clamp(window.devicePixelRatio, 1, 2);\n    if(pixelRatio > 1 && !options.needUpscale) {\n      if(this.width > 100 && this.height > 100) {\n        if(!IS_APPLE && mediaSizes.isMobile) {\n          pixelRatio = 1;\n        }\n      } else if(this.width > 60 && this.height > 60) {\n        pixelRatio = Math.max(1.5, pixelRatio - 1.5);\n      }\n    }\n\n    this.width = Math.round(this.width * pixelRatio);\n    this.height = Math.round(this.height * pixelRatio);\n\n    // options.noCache = true;\n\n    // * Cache frames params\n    if(!options.noCache/*  && false */) {\n      //      ,     ,   8080  6868,   75%\n      if(IS_APPLE && this.width > 100 && this.height > 100) {\n        this.cachingDelta = 2; // 2 // 50%\n      } else if(this.width < 100 && this.height < 100) {\n        this.cachingDelta = Infinity; // 100%\n      } else {\n        this.cachingDelta = 4; // 75%\n      }\n    }\n\n    // this.cachingDelta = Infinity;\n    // this.cachingDelta = 0;\n    // if(isApple) {\n    //   this.cachingDelta = 0; //2 // 50%\n    // }\n\n    if(!this.canvas) {\n      this.canvas = this.el.map(() => {\n        const canvas = document.createElement('canvas');\n        canvas.classList.add('rlottie');\n        canvas.width = this.width;\n        canvas.height = this.height;\n        canvas.dpr = pixelRatio;\n        return canvas;\n      });\n    }\n\n    this.contexts = this.canvas.map((canvas) => canvas.getContext('2d'));\n\n    if(!IS_IMAGE_BITMAP_SUPPORTED) {\n      this.imageData = new ImageData(this.width, this.height);\n\n      if(CAN_USE_TRANSFERABLES) {\n        this.clamped = new Uint8ClampedArray(this.width * this.height * 4);\n      }\n    }\n\n    if(this.name) {\n      this.cache = cache.getCache(this.cacheName);\n    } else {\n      this.cache = RLottieCache.createCache();\n    }\n  }\n\n  public clearCache() {\n    if(this.cachingDelta === Infinity) {\n      return;\n    }\n\n    if(this.cacheName && this.cache.counter > 1) { // skip clearing because same sticker can be still visible\n      return;\n    }\n\n    this.cache.clearCache();\n  }\n\n  public sendQuery(args: any[]) {\n    this.worker.sendQuery([args.shift(), this.reqId, ...args]);\n  }\n\n  public loadFromData(data: RLottieOptions['animationData']) {\n    this.sendQuery(['loadFromData', data, this.width, this.height, this.toneIndex/* , this.canvas.transferControlToOffscreen() */]);\n  }\n\n  public play() {\n    if(!this.paused) {\n      return;\n    }\n\n    this.paused = false;\n    this.setMainLoop();\n  }\n\n  public pause(clearPendingRAF = true) {\n    if(this.paused) {\n      return;\n    }\n\n    this.paused = true;\n    if(clearPendingRAF) {\n      clearTimeout(this.rafId);\n    }\n    // window.cancelAnimationFrame(this.rafId);\n  }\n\n  private resetCurrentFrame() {\n    return this.curFrame = this.initFrame ?? (this.direction === 1 ? this.minFrame : this.maxFrame);\n  }\n\n  public stop(renderFirstFrame = true) {\n    this.pause();\n\n    const curFrame = this.resetCurrentFrame();\n    if(renderFirstFrame) {\n      this.requestFrame(curFrame);\n      // this.sendQuery('renderFrame', this.curFrame);\n    }\n  }\n\n  public restart() {\n    this.stop(false);\n    this.play();\n  }\n\n  public setSpeed(speed: number) {\n    if(this.speed === speed) {\n      return;\n    }\n\n    this.speed = speed;\n\n    if(!this.paused) {\n      this.setMainLoop();\n    }\n  }\n\n  public setDirection(direction: number) {\n    if(this.direction === direction) {\n      return;\n    }\n\n    this.direction = direction;\n\n    if(!this.paused) {\n      this.setMainLoop();\n    }\n  }\n\n  public remove() {\n    this.pause();\n    this.sendQuery(['destroy']);\n    if(this.cacheName) cache.releaseCache(this.cacheName);\n    this.dispatchEvent('destroy');\n    this.cleanup();\n  }\n\n  private applyColor(frame: Uint8ClampedArray) {\n    const [r, g, b] = this.color;\n    for(let i = 0, length = frame.length; i < length; i += 4) {\n      if(frame[i + 3] !== 0) {\n        frame[i] = r;\n        frame[i + 1] = g;\n        frame[i + 2] = b;\n      }\n    }\n  }\n\n  private applyInversing(frame: Uint8ClampedArray) {\n    const [r, g, b] = this.inverseColor;\n    for(let i = 0, length = frame.length; i < length; i += 4) {\n      if(frame[i + 3] === 0) {\n        frame[i] = r;\n        frame[i + 1] = g;\n        frame[i + 2] = b;\n        frame[i + 3] = 255;\n      } else {\n        frame[i + 3] = 0;\n      }\n    }\n  }\n\n  public renderFrame2(frame: Uint8ClampedArray | HTMLCanvasElement | ImageBitmap, frameNo: number) {\n    /* this.setListenerResult('enterFrame', frameNo);\n    return; */\n\n    try {\n      if(frame instanceof Uint8ClampedArray) {\n        if(this.color) {\n          this.applyColor(frame);\n        }\n\n        if(this.inverseColor) {\n          this.applyInversing(frame);\n        }\n\n        this.imageData.data.set(frame);\n      }\n\n      // this.context.putImageData(new ImageData(frame, this.width, this.height), 0, 0);\n      this.contexts.forEach((context, idx) => {\n        let cachedSource: HTMLCanvasElement | ImageBitmap = this.cache.framesNew.get(frameNo);\n        if(!(frame instanceof Uint8ClampedArray)) {\n          cachedSource = frame;\n        } else if(idx > 0) {\n          cachedSource = this.canvas[0];\n        }\n\n        if(!cachedSource) {\n          // console.log('drawing from data');\n          const c = document.createElement('canvas');\n          c.width = context.canvas.width;\n          c.height = context.canvas.height;\n          c.getContext('2d').putImageData(this.imageData, 0, 0);\n          this.cache.framesNew.set(frameNo, c);\n          cachedSource = c;\n        }\n\n        if(this.overrideRender && this.renderedFirstFrame) {\n          this.overrideRender(cachedSource || this.imageData);\n        } else if(cachedSource) {\n          // console.log('drawing from canvas');\n          context.clearRect(0, 0, cachedSource.width, cachedSource.height);\n          context.drawImage(cachedSource, 0, 0);\n        } else {\n          context.putImageData(this.imageData, 0, 0);\n        }\n\n        if(!this.renderedFirstFrame) {\n          this.renderedFirstFrame = true;\n        }\n      });\n\n      this.dispatchEvent('enterFrame', frameNo);\n    } catch(err) {\n      console.error('RLottiePlayer renderFrame error:', err/* , frame */, this.width, this.height);\n      this.autoplay = false;\n      this.pause();\n    }\n  }\n\n  public renderFrame(frame: Parameters<RLottiePlayer['renderFrame2']>[0], frameNo: number) {\n    const canCacheFrame = this.cachingDelta && (frameNo % this.cachingDelta || !frameNo);\n    if(canCacheFrame) {\n      if(frame instanceof Uint8ClampedArray && !this.cache.frames.has(frameNo)) {\n        this.cache.frames.set(frameNo, new Uint8ClampedArray(frame));// frame;\n      } else if(IS_IMAGE_BITMAP_SUPPORTED && frame instanceof ImageBitmap && !this.cache.framesNew.has(frameNo)) {\n        this.cache.framesNew.set(frameNo, frame);\n      }\n    }\n\n    /* if(!this.listenerResults.hasOwnProperty('cached')) {\n      this.setListenerResult('enterFrame', frameNo);\n      if(frameNo === (this.frameCount - 1)) {\n        this.setListenerResult('cached');\n      }\n\n      return;\n    } */\n\n    if(this.frInterval) {\n      const now = Date.now(), delta = now - this.frThen;\n\n      if(delta < 0) {\n        const timeout = this.frInterval > -delta ? -delta % this.frInterval : this.frInterval;\n        if(this.rafId) clearTimeout(this.rafId);\n        this.rafId = window.setTimeout(() => {\n          this.renderFrame2(frame, frameNo);\n        }, timeout);\n        // await new Promise((resolve) => setTimeout(resolve, -delta % this.frInterval));\n        return;\n      }\n    }\n\n    this.renderFrame2(frame, frameNo);\n  }\n\n  public requestFrame(frameNo: number) {\n    const frame = this.cache.frames.get(frameNo);\n    const frameNew = this.cache.framesNew.get(frameNo);\n    if(frameNew) {\n      this.renderFrame(frameNew, frameNo);\n    } else if(frame) {\n      this.renderFrame(frame, frameNo);\n    } else {\n      if(this.clamped && !this.clamped.length) { // fix detached\n        this.clamped = new Uint8ClampedArray(this.width * this.height * 4);\n      }\n\n      this.sendQuery(['renderFrame', frameNo, this.clamped]);\n    }\n  }\n\n  private onLap() {\n    // this.playedTimes++;\n\n    if(!this.loop) {\n      this.pause(false);\n      return false;\n    }\n\n    return true;\n  }\n\n  private mainLoopForwards() {\n    const {skipDelta, maxFrame} = this;\n    const frame = (this.curFrame + skipDelta) > maxFrame ? this.curFrame = (this.loop ? this.minFrame : this.maxFrame) : this.curFrame += skipDelta;\n    // console.log('mainLoopForwards', this.curFrame, skipDelta, frame);\n\n    this.requestFrame(frame);\n    if((frame + skipDelta) > maxFrame) {\n      return this.onLap();\n    }\n\n    return true;\n  }\n\n  private mainLoopBackwards() {\n    const {skipDelta, minFrame} = this;\n    const frame = (this.curFrame - skipDelta) < minFrame ? this.curFrame = (this.loop ? this.maxFrame : this.minFrame) : this.curFrame -= skipDelta;\n    // console.log('mainLoopBackwards', this.curFrame, skipDelta, frame);\n\n    this.requestFrame(frame);\n    if((frame - skipDelta) < minFrame) {\n      return this.onLap();\n    }\n\n    return true;\n  }\n\n  public setMainLoop() {\n    // window.cancelAnimationFrame(this.rafId);\n    clearTimeout(this.rafId);\n\n    this.frInterval = 1000 / this.fps / this.speed * this.skipDelta;\n    this.frThen = Date.now() - this.frInterval;\n\n    // console.trace('setMainLoop', this.frInterval, this.direction, this, JSON.stringify(this.listenerResults), this.listenerResults);\n\n    const method = (this.direction === 1 ? this.mainLoopForwards : this.mainLoopBackwards).bind(this);\n    this.currentMethod = method;\n    // this.frameListener && this.removeListener('enterFrame', this.frameListener);\n\n    // setTimeout(() => {\n    // this.addListener('enterFrame', this.frameListener);\n    // }, 0);\n\n    if(this.frameListener) {\n      const lastResult = this.listenerResults.enterFrame;\n      if(lastResult !== undefined) {\n        this.frameListener(this.curFrame);\n      }\n    }\n\n    // this.mainLoop(method);\n    // this.r(method);\n    // method();\n  }\n\n  public playPart(options: {\n    from: number,\n    to: number,\n    callback?: () => void\n  }) {\n    this.pause();\n\n    const {from, to, callback} = options;\n    this.curFrame = from - 1;\n\n    return this.playToFrame({\n      frame: to,\n      direction: to > from ? 1 : -1,\n      callback\n    });\n  }\n\n  public playToFrame(options: {\n    frame: number,\n    speed?: number,\n    direction?: number,\n    callback?: () => void\n  }) {\n    this.pause();\n\n    const {frame, speed, callback, direction} = options;\n    this.setDirection(direction === undefined ? this.curFrame > frame ? -1 : 1 : direction);\n    speed !== undefined && this.setSpeed(speed);\n\n    const bounds = [this.curFrame, frame];\n    if(this.direction === -1) bounds.reverse();\n\n    this.loop = false;\n    this.setMinMax(bounds[0], bounds[1]);\n\n    if(this.playToFrameOnFrameCallback) {\n      this.removeEventListener('enterFrame', this.playToFrameOnFrameCallback);\n    }\n\n    if(callback) {\n      this.playToFrameOnFrameCallback = (frameNo: number) => {\n        if(frameNo === frame) {\n          this.removeEventListener('enterFrame', this.playToFrameOnFrameCallback);\n          callback();\n        }\n      };\n\n      this.addEventListener('enterFrame', this.playToFrameOnFrameCallback);\n    }\n\n    this.play();\n  }\n\n  public setColor(color: RLottieColor, renderIfPaused: boolean) {\n    this.color = color;\n\n    if(renderIfPaused && this.paused) {\n      this.renderFrame2(this.imageData.data, this.curFrame);\n    }\n  }\n\n  public setInverseColor(color: RLottieColor) {\n    this.inverseColor = color;\n  }\n\n  private setMinMax(minFrame = 0, maxFrame = this.frameCount - 1) {\n    this.minFrame = minFrame;\n    this.maxFrame = maxFrame;\n  }\n\n  public async onLoad(frameCount: number, fps: number) {\n    this.frameCount = frameCount;\n    this.fps = fps;\n    this.setMinMax();\n    if(this.initFrame !== undefined) {\n      this.initFrame = clamp(this.initFrame, this.minFrame, this.maxFrame);\n    }\n\n    const curFrame = this.resetCurrentFrame();\n\n    // * Handle 30fps stickers if 30fps set\n    if(this.fps < 60 && this.skipDelta !== 1) {\n      const diff = 60 / fps;\n      this.skipDelta = this.skipDelta / diff | 0;\n    }\n\n    this.frInterval = 1000 / this.fps / this.speed * this.skipDelta;\n    this.frThen = Date.now() - this.frInterval;\n    // this.sendQuery('renderFrame', 0);\n\n    //    ,   ()  519,\n    //   75%      ,  475, ..  100%   593,    84.\n\n    /* console.time('cache' + this.reqId);\n    for(let i = 0; i < frameCount; ++i) {\n      //if(this.removed) return;\n\n      if(i % 4) {\n        await new Promise((resolve) => {\n          delete this.listenerResults.enterFrame;\n          this.addListener('enterFrame', resolve, true);\n          this.requestFrame(i);\n        });\n      }\n    }\n\n    console.timeEnd('cache' + this.reqId); */\n    // console.log('cached');\n    /* this.el.innerHTML = '';\n    this.el.append(this.canvas);\n    return; */\n\n    !this.skipFirstFrameRendering && this.requestFrame(curFrame);\n    this.dispatchEvent('ready');\n    this.addEventListener('enterFrame', () => {\n      this.dispatchEvent('firstFrame');\n\n      if(!this.canvas[0].parentNode && this.el && !this.overrideRender) {\n        this.el.forEach((container, idx) => container.append(this.canvas[idx]));\n      }\n\n      // console.log('enterFrame firstFrame');\n\n      // let lastTime = this.frThen;\n      this.frameListener = () => {\n        if(this.paused) {\n          return;\n        }\n\n        const time = Date.now();\n        // console.log(`enterFrame handle${this.reqId}`, time, (time - lastTime), this.frInterval);\n        /* if(Math.round(time - lastTime + this.frInterval * 0.25) < Math.round(this.frInterval)) {\n          return;\n        } */\n\n        // lastTime = time;\n\n        this.frThen = time + this.frInterval;\n        const canContinue = this.currentMethod();\n        if(!canContinue && !this.loop && this.autoplay) {\n          this.autoplay = false;\n        }\n      };\n\n      this.addEventListener('enterFrame', this.frameListener);\n      // setInterval(this.frameListener, this.frInterval);\n\n      // ! fix autoplaying since there will be no animationIntersector for it,\n      if(this.group === 'none' && this.autoplay) {\n        this.play();\n      }\n    }, {once: true});\n  }\n}\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport Page from './page';\r\nimport lottieLoader from '../lib/rlottie/lottieLoader';\r\nimport {horizontalMenu} from '../components/horizontalMenu';\r\nimport {MOUNT_CLASS_TO} from '../config/debug';\r\nimport fastSmoothScroll from '../helpers/fastSmoothScroll';\r\nimport whichChild from '../helpers/dom/whichChild';\r\n\r\nclass PagesManager {\r\n  private pageId = -1;\r\n  private page: Page;\r\n\r\n  private selectTab: ReturnType<typeof horizontalMenu>;\r\n  public pagesDiv: HTMLDivElement;\r\n  public scrollableDiv: HTMLElement;\r\n\r\n  constructor() {\r\n    this.pagesDiv = document.getElementById('auth-pages') as HTMLDivElement;\r\n    this.scrollableDiv = this.pagesDiv.querySelector('.scrollable') as HTMLElement;\r\n    this.selectTab = horizontalMenu(null, this.scrollableDiv.querySelector('.tabs-container') as HTMLDivElement, null, () => {\r\n      if(this.page?.onShown) {\r\n        this.page.onShown();\r\n      }\r\n    });\r\n  }\r\n\r\n  public setPage(page: Page) {\r\n    if(page.isAuthPage) {\r\n      this.pagesDiv.style.display = '';\r\n\r\n      const id = whichChild(page.pageEl);\r\n      if(this.pageId === id) return;\r\n\r\n      this.selectTab(id);\r\n\r\n      if(this.pageId !== -1 && id > 1) {\r\n        lottieLoader.loadLottieWorkers();\r\n      }\r\n\r\n\r\n      this.pageId = id;\r\n\r\n      if(this.scrollableDiv) {\r\n        fastSmoothScroll({\r\n          container: this.scrollableDiv,\r\n          element: this.scrollableDiv.firstElementChild as HTMLElement,\r\n          position: 'start'\r\n        });\r\n      }\r\n    } else {\r\n      this.pagesDiv.style.display = 'none';\r\n      page.pageEl.style.display = '';\r\n\r\n      this.pageId = -1;\r\n    }\r\n\r\n    this.page = page;\r\n  }\r\n}\r\n\r\nconst pagesManager = new PagesManager();\r\nMOUNT_CLASS_TO.pagesManager = pagesManager;\r\nexport default pagesManager;\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport pagesManager from './pagesManager';\r\n\r\nexport default class Page {\r\n  public pageEl: HTMLDivElement;\r\n  private installed = false;\r\n\r\n  constructor(className: string, public isAuthPage: boolean, private onFirstMount?: (...args: any[]) => Promise<any> | void, private onMount?: (...args: any[]) => void, public onShown?: () => void) {\r\n    this.pageEl = document.body.querySelector('.' + className) as HTMLDivElement;\r\n  }\r\n\r\n  public async mount(...args: any[]) {\r\n    // this.pageEl.style.display = '';\r\n\r\n    if(this.onMount) {\r\n      this.onMount(...args);\r\n    }\r\n\r\n    if(!this.installed) {\r\n      if(this.onFirstMount) {\r\n        try {\r\n          const res = this.onFirstMount(...args);\r\n          if(res instanceof Promise) {\r\n            await res;\r\n          }\r\n        } catch(err) {\r\n          console.error('PAGE MOUNT ERROR:', err);\r\n        }\r\n      }\r\n\r\n      this.installed = true;\r\n    }\r\n\r\n    pagesManager.setPage(this);\r\n  }\r\n}\r\n","// https://github.com/twitter/twemoji-parser/blob/master/src/lib/regex.js\r\n\r\nexport function encodeEmoji(emojiText: string) {\r\n  const codepoints = toCodePoints(removeVS16s(emojiText)).join('-');\r\n  return codepoints;\r\n}\r\n\r\nconst vs16RegExp = /\\uFE0F/g;\r\n// avoid using a string literal like '\\u200D' here because minifiers expand it inline\r\nconst zeroWidthJoiner = String.fromCharCode(0x200d);\r\n\r\nconst removeVS16s = (rawEmoji: string) => (rawEmoji.indexOf(zeroWidthJoiner) < 0 ? rawEmoji.replace(vs16RegExp, '') : rawEmoji);\r\n\r\nexport function toCodePoints(unicodeSurrogates: string): Array<string> {\r\n  const points = [];\r\n  let char = 0;\r\n  let previous = 0;\r\n  let i = 0;\r\n  while(i < unicodeSurrogates.length) {\r\n    char = unicodeSurrogates.charCodeAt(i++);\r\n    if(previous) {\r\n      points.push((0x10000 + ((previous - 0xd800) << 10) + (char - 0xdc00)).toString(16));\r\n      previous = 0;\r\n    } else if(char > 0xd800 && char <= 0xdbff) {\r\n      previous = char;\r\n    } else {\r\n      points.push(char.toString(16));\r\n    }\r\n  }\r\n\r\n  if(points.length && points[0].length === 2) {\r\n    points[0] = '00' + points[0];\r\n  }\r\n\r\n  return points;\r\n}\r\n\r\nexport function getEmojiToneIndex(input: string) {\r\n  const match = input.match(/[\\uDFFB-\\uDFFF]/);\r\n  return match ? 5 - (57343 - match[0].charCodeAt(0)) : 0;\r\n}\r\n\r\nexport function getCountryEmoji(iso2: string) {\r\n  return String.fromCharCode(55356, 56741 + iso2.charCodeAt(0), 55356, 56741 + iso2.charCodeAt(1));\r\n}\r\n\r\nexport function emojiFromCodePoints(codePoints: string) {\r\n  return codePoints.split('-').reduce((prev, curr) => prev + String.fromCodePoint(parseInt(curr, 16)), '');\r\n}\n","!function(e,t){\"object\"==typeof exports&&\"object\"==typeof module?module.exports=t():\"function\"==typeof define&&define.amd?define([],t):\"object\"==typeof exports?exports.Recorder=t():e.Recorder=t()}(\"undefined\"!=typeof self?self:this,(function(){return function(e){var t={};function o(i){if(t[i])return t[i].exports;var n=t[i]={i:i,l:!1,exports:{}};return e[i].call(n.exports,n,n.exports,o),n.l=!0,n.exports}return o.m=e,o.c=t,o.d=function(e,t,i){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},o.r=function(e){\"undefined\"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:\"Module\"}),Object.defineProperty(e,\"__esModule\",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&\"object\"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(o.r(i),Object.defineProperty(i,\"default\",{enumerable:!0,value:e}),2&t&&\"string\"!=typeof e)for(var n in e)o.d(i,n,function(t){return e[t]}.bind(null,n));return i},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,\"a\",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p=\"\",o(o.s=0)}([function(e,t,o){\"use strict\";(function(t){var o=t.AudioContext||t.webkitAudioContext,i=function(e){if(!i.isRecordingSupported())throw new Error(\"Recording is not supported in this browser\");e||(e={}),this.state=\"inactive\",this.config=Object.assign({bufferLength:4096,encoderApplication:2049,encoderFrameSize:20,encoderPath:\"encoderWorker.min.js\",encoderSampleRate:48e3,maxFramesPerPage:40,mediaTrackConstraints:!0,monitorGain:0,numberOfChannels:1,recordingGain:1,resampleQuality:3,streamPages:!1,reuseWorker:!1,wavBitDepth:16},e),this.encodedSamplePosition=0};i.isRecordingSupported=function(){return o&&t.navigator&&t.navigator.mediaDevices&&t.navigator.mediaDevices.getUserMedia&&t.WebAssembly},i.prototype.clearStream=function(){this.stream&&(this.stream.getTracks?this.stream.getTracks().forEach((function(e){e.stop()})):this.stream.stop(),delete this.stream),this.audioContext&&this.closeAudioContext&&(this.audioContext.close(),delete this.audioContext)},i.prototype.encodeBuffers=function(e){if(\"recording\"===this.state){for(var t=[],o=0;o<e.numberOfChannels;o++)t[o]=e.getChannelData(o);this.encoder.postMessage({command:\"encode\",buffers:t})}},i.prototype.initAudioContext=function(e){return e&&e.context?(this.audioContext=e.context,this.closeAudioContext=!1):(this.audioContext=new o,this.closeAudioContext=!0),this.audioContext},i.prototype.initAudioGraph=function(){this.encodeBuffers=function(){delete this.encodeBuffers},this.scriptProcessorNode=this.audioContext.createScriptProcessor(this.config.bufferLength,this.config.numberOfChannels,this.config.numberOfChannels),this.scriptProcessorNode.connect(this.audioContext.destination),this.scriptProcessorNode.onaudioprocess=e=>{this.encodeBuffers(e.inputBuffer)},this.monitorGainNode=this.audioContext.createGain(),this.setMonitorGain(this.config.monitorGain),this.monitorGainNode.connect(this.audioContext.destination),this.recordingGainNode=this.audioContext.createGain(),this.setRecordingGain(this.config.recordingGain),this.recordingGainNode.connect(this.scriptProcessorNode)},i.prototype.initSourceNode=function(e){return e&&e.context?t.Promise.resolve(e):t.navigator.mediaDevices.getUserMedia({audio:this.config.mediaTrackConstraints}).then(e=>(this.stream=e,this.audioContext.createMediaStreamSource(e)))},i.prototype.loadWorker=function(){this.encoder||(this.encoder=new t.Worker(this.config.encoderPath))},i.prototype.initWorker=function(){var e=(this.config.streamPages?this.streamPage:this.storePage).bind(this);return this.recordedPages=[],this.totalLength=0,this.loadWorker(),new Promise((t,o)=>{var i=o=>{switch(o.data.message){case\"ready\":t();break;case\"page\":this.encodedSamplePosition=o.data.samplePosition,e(o.data.page);break;case\"done\":this.encoder.removeEventListener(\"message\",i),this.finish()}};this.encoder.addEventListener(\"message\",i),this.encoder.postMessage(Object.assign({command:\"init\",originalSampleRate:this.audioContext.sampleRate,wavSampleRate:this.audioContext.sampleRate},this.config))})},i.prototype.pause=function(e){if(\"recording\"===this.state){if(this.state=\"paused\",e&&this.config.streamPages){var t=this.encoder;return new Promise((e,o)=>{var i=o=>{\"flushed\"===o.data.message&&(t.removeEventListener(\"message\",i),this.onpause(),e())};t.addEventListener(\"message\",i),t.postMessage({command:\"flush\"})})}return this.onpause(),Promise.resolve()}},i.prototype.resume=function(){\"paused\"===this.state&&(this.state=\"recording\",this.onresume())},i.prototype.setRecordingGain=function(e){this.config.recordingGain=e,this.recordingGainNode&&this.audioContext&&this.recordingGainNode.gain.setTargetAtTime(e,this.audioContext.currentTime,.01)},i.prototype.setMonitorGain=function(e){this.config.monitorGain=e,this.monitorGainNode&&this.audioContext&&this.monitorGainNode.gain.setTargetAtTime(e,this.audioContext.currentTime,.01)},i.prototype.start=function(e){if(\"inactive\"===this.state)return this.initAudioContext(e),this.initAudioGraph(),this.encodedSamplePosition=0,this.initWorker().then(()=>this.initSourceNode(e)).then(e=>{this.sourceNode=e,this.state=\"recording\",this.onstart(),this.encoder.postMessage({command:\"getHeaderPages\"}),this.sourceNode.connect(this.monitorGainNode),this.sourceNode.connect(this.recordingGainNode)})},i.prototype.stop=function(){if(\"inactive\"!==this.state){this.state=\"inactive\",this.monitorGainNode.disconnect(),this.scriptProcessorNode.disconnect(),this.recordingGainNode.disconnect(),this.sourceNode.disconnect(),this.clearStream();var e=this.encoder;return new Promise(t=>{var o=i=>{\"done\"===i.data.message&&(e.removeEventListener(\"message\",o),t())};e.addEventListener(\"message\",o),e.postMessage({command:\"done\"}),this.config.reuseWorker||e.postMessage({command:\"close\"})})}return Promise.resolve()},i.prototype.destroyWorker=function(){\"inactive\"===this.state&&this.encoder&&(this.encoder.postMessage({command:\"close\"}),delete this.encoder)},i.prototype.storePage=function(e){this.recordedPages.push(e),this.totalLength+=e.length},i.prototype.streamPage=function(e){this.ondataavailable(e)},i.prototype.finish=function(){if(!this.config.streamPages){var e=new Uint8Array(this.totalLength);this.recordedPages.reduce((function(t,o){return e.set(o,t),t+o.length}),0),this.ondataavailable(e)}this.onstop(),this.config.reuseWorker||delete this.encoder},i.prototype.ondataavailable=function(){},i.prototype.onpause=function(){},i.prototype.onresume=function(){},i.prototype.onstart=function(){},i.prototype.onstop=function(){},e.exports=i}).call(this,o(1))},function(e,t){var o;o=function(){return this}();try{o=o||new Function(\"return this\")()}catch(e){\"object\"==typeof window&&(o=window)}e.exports=o}])}));"],"names":["animationIntersector","constructor","visible","Set","byGroups","lockedGroups","onlyOnePlayableGroup","intersectionLockedGroups","videosLocked","this","observer","IntersectionObserver","entries","entry","target","group","animation","find","p","el","isIntersecting","add","checkAnimation","delete","_animation","clearCache","overrideIdleGroups","doc","type","checkAnimations","idle","setOverrideIdleGroup","override","getAnimations","element","found","player","push","removeAnimation","remove","HTMLVideoElement","IS_SAFARI","setTimeout","src","load","length","unobserve","addAnimation","canvas","loop","observe","blurred","destroy","undefined","groups","Object","keys","animations","paused","pause","has","autoplay","play","getOnlyOnePlayableGroup","setOnlyOnePlayableGroup","lockGroup","unlockGroup","refreshGroup","forEach","lockIntersectionGroup","unlockIntersectionGroup","SHOULD_USE_SAFARI_FIX","navigator","userAgent","match","err","AppMediaPlaybackController","media","Map","scheduled","mediaDetails","waitingMediaForLoad","waitingScheduledMediaForLoad","waitingDocumentsForLoad","playbackRates","voice","video","audio","seekBackward","details","playingMedia","currentTime","Math","max","seekOffset","seekForward","min","duration","seekTo","seekTime","onMediaDocumentLoad","get","managers","appDocsManager","getDoc","docId","supportsStreaming","handleSafariStreamable","cacheContext","thumbsStorage","getCacheContext","url","playbackRate","set","id","size","onPlay","e","peerId","mid","pip","message","getMessageByMedia","stop","setMedia","verify","listLoader","current","getCurrent","jumpLength","withOtherSide","previous","getPrevious","idx","findIndex","getNext","go","setTargets","dispatchEvent","getPlayingDetails","pauseMediaInOtherTabs","onPause","onEnded","isTrusted","lockedSwitchers","round","next","toggle","clean","s","isScheduled","storage","playingMediaType","playItem","item","searchContext","getMedia","resolveWaitingForLoadMedia","dispatchJump","goRound","browserPlay","bindBrowserCallback","browserPause","browserStop","browserSeekBackward","browserSeekForward","browserSeekTo","browserNext","browserPrevious","seekToStart","construct","container","document","createElement","style","cssText","body","append","mediaSession","actions","seekbackward","seekforward","seekto","previoustrack","nexttrack","action","setActionHandler","console","warn","skipMediaPlayEvent","properties","key","_key","value","dispatchPlaybackParams","defineProperties","getPlaybackParams","volume","muted","setPlaybackParams","params","_volume","_muted","_playbackRate","_loop","_round","addMedia","autoload","pFlags","is_scheduled","setAttribute","addEventListener","media_unread","fromId","appMessagesManager","readMessages","once","deferred","resolve","w","waitingStorage","then","promise","isSafariBuffering","safariBuffering","setSafariBuffering","setNewMediadata","pictureInPictureElement","artwork","isVoice","title","artist","thumbs","bytes","sizes","h","thumb","appPeersManager","getPeerPhoto","attribute","attributes","_","file_name","performer","IS_APPLE","metadata","MediaMetadata","setCurrentMediadata","playbackParams","cb","willBePlayed","willBePlayedMedia","setSearchContext","context","getSearchContext","prev","reset","loadCount","loadWhenLeft","processItem","onJump","older","onEmptied","reverse","folderId","getPlaybackMediaTypeFromMessage","mediaType","setSingleMedia","wasPlaying","toggleSwitchers","playPaused","removeEventListener","enabled","setPictureInPicture","listenerSetter","removeAll","appMediaPlaybackController","AppMediaViewer","captionTimeout","super","isForDocument","inputFilter","isMediaCompatibleForDocumentViewer","onPrevClick","openMedia","getMessageByPeer","onNextClick","onDeleteClick","content","close","onForwardClick","onAuthorClick","Number","MAX_SAFE_INTEGER","threadId","tab","lastMsgId","onDownloadClick","queueId","caption","classList","setCaptionTimeout","clearTimeout","window","onAdditionalScroll","wholeDiv","buttons","btnMenuForward","icon","text","onClick","btnMenuDownload","btnMenuDelete","setBtnMenuToggle","setListeners","forward","author","onCaptionClick","a","spoiler","HTMLAnchorElement","contains","onclick","getAttribute","includes","capture","click","getScheduledMessageByPeer","setCaption","html","entities","totalEntities","firstElementChild","fromRight","prevTargets","nextTargets","setMoverPromise","fwd_from","from_name","cantForwardMessage","canForward","button","cantDownloadMessage","download","canDeleteMessage","_openMedia","date","static","mime_type","VideoPlayer","streamable","onPlaybackRackMenuToggle","onPip","onPipClose","wrapper","setup","canHideControls","playbackRateButton","showOnLeaveToClassName","ignoreClickClassName","parentNode","insertBefore","appendChild","skin","stylePlayer","controls","querySelector","progress","prepend","catch","name","finally","initDuration","buildControls","timeDuration","insertAdjacentHTML","pipButton","querySelectorAll","fullScreenButton","timeElapsed","textContent","toHHMMSS","volumeSelector","leftControls","btn","parentElement","Array","from","togglePlay","requestPictureInPicture","visibility","debounceTime","debouncedPip","debounce","listener","timeout","overlayCounter","code","good","toggleFullScreen","altKey","nextIdx","PLAYBACK_RATES","indexOf","cancelEvent","onFullScreen","bind","hideControls","showControls","setPlaybackRateIcon","onMediaLoad","IS_MOBILE","pictureInPictureEnabled","map","rate","regularText","btnMenu","PLAYBACK_RATES_ICONS","className","IS_APPLE_MOBILE","webkitEnterFullscreen","enterFullscreen","isFull","cleanup","removeListeners","MEDIA_VIEWER_CLASSNAME","AppMediaViewerBase","topButtons","tempId","preloader","preloaderStreamable","isFirstOpen","pageEl","getElementById","zoomElements","zoomSwipeStartX","zoomSwipeStartY","zoomSwipeX","zoomSwipeY","setZoomValue","rangeSelector","moversContainer","transform","btnOut","btnIn","toggleZoom","setMoverAnimationPromise","tagName","highlightSwitchersTimeout","isZooming","mover","classNames","findUpClassName","onKeyDown","ctrlKeyDown","changeZoom","ctrlKey","metaKey","onKeyUp","onWheel","scrollingUp","deltaY","rootScope","log","logger","cancelable","lazyLoadQueue","overlaysDiv","mainDiv","topbar","topbarLeft","onlyMobile","authorRight","avatarEl","nameEl","buttonsDiv","concat","noRipple","zoom","step","withTransition","setHandlers","onScrub","onMouseUp","main","innerHTML","onLoadedMore","setNewMover","moveLength","onSwipe","xDiff","yDiff","abs","windowSize","verifyTouchTarget","evt","enable","isVisible","mousedown","zoomValue","setProgress","videoPlayer","lockControls","zoomSwipeHandler","lastDiffX","lastDiffY","multiplier","onFirstSwipe","onReset","cursor","addProgress","btnMenuToggle","Promise","reject","navigationItem","appNavigationController","clear","setMoverToTarget","onAnimationEnd","appMediaViewer","removeGlobalListeners","toggleOverlay","active","toggleGlobalListeners","setGlobalListeners","passive","closing","removeCenterFromMover","wasActive","delay","realParent","rect","getBoundingClientRect","SVGImageElement","SVGForeignObjectElement","left","needOpacity","overflowElement","visibleRect","getVisibleRect","overflow","vertical","horizontal","containerRect","top","aspecter","width","HTMLImageElement","setFullAspect","offsetLeft","height","scaleX","scaleY","borderRadius","getComputedStyle","getPropertyValue","brSplitted","str","splitted","split","i","fillPropertyValue","r","parseInt","join","willBeLeft","willBeTop","path","opacity","isOut","ret","isFulfilled","isRejected","SVGSVGElement","sizeTailPath","toggleWholeActive","mediaElement","selector","queryFrom","matches","elements","pop","getContext","naturalWidth","naturalHeight","videoWidth","videoHeight","HTMLCanvasElement","drawImage","image","Image","createVideo","clipId","dataset","newClipId","newSvg","createElementNS","setAttributeNS","outerHTML","replace","lastElementChild","defs","use","SVGUseElement","d","getAttributeNS","x","y","sX","sY","br","v","generatePathData","foreignObject","renderImageFromUrl","display","proportion","upscale","start","Date","now","diff","_br","moveTheMover","toLeft","windowW","newTransform","p1","newMover","updateMediaSource","toLowerCase","setAuthorInfo","timestamp","isPeerId","wrapTitlePromise","dialog","onlyFirstName","plainText","wrapEmojiText","oldAvatar","newAvatar","cloneNode","all","updateWithOptions","peerTitle","replaceContent","replaceWith","setAuthorPromise","isDocument","isVideo","useContainerAsTarget","IS_MOBILE_SAFARI","onPop","canAnimate","maxWidth","padding","windowH","mediaSizes","maxHeight","thumbPromise","setAttachmentSize","photoSize","img","downloaded","gotThumb","getStrippedThumbIfNeeded","loadPromise","useController","div","moverVideo","canPlayThrough","createPlayer","ckin","overlay","open","otherMediaViewer","releaseSingleMedia","show","readyState","HAVE_FUTURE_DATA","attach","attachCanPlay","detach","loading","networkState","NETWORK_LOADING","isntEnoughData","unshift","appDownloadManager","error","cancellablePromise","attachPromise","imgs","haveImage","setManual","onPopState","hash","location","state","debug","isPossibleSwipe","currentHash","overriddenHash","overrideHash","onHashChange","pushState","navigations","manual","handleItem","onEscape","back","onTouchStart","touches","options","history","scrollRestoration","replaceState","pushItem","noBlurOnPop","findItemByType","index","backByItem","splice","onItemAdded","noHistory","unshiftItem","spliceItems","items","origin","pathname","search","removeItem","removeByType","single","SearchGroup","clearable","clickable","autonomous","onFound","noIcons","list","setActive","childElementCount","AppSearch","searchInput","searchGroups","onSearch","minMsgId","loadedCount","foundCount","searchPromise","searchTimeout","query","listsContainer","scrollable","messages","setVirtualContainer","onChange","searchMore","onScrolledBottom","trim","beginSearch","inputField","input","focus","maxId","limit","res","count","shift","searchGroup","avatarSize","meAsSaved","SearchContextMenu","attachTo","searchSuper","onGotoClick","appImManager","selection","isSelecting","selectionForwardBtn","onSelectClick","toggleByElement","onClearSelectionClick","cancelSelection","selectionDeleteBtn","attachContextMenuListener","init","MouseEvent","preventDefault","cancelBubble","toPeerId","isSelected","isMidSelected","withSelection","positionMenu","contextMenuController","AppSearchSuper","tabs","prevTabId","middleware","historyStorage","usedFromHistory","urlsToRevoke","loadMutex","nextRates","loadPromises","loaded","loadedChats","firstLoad","monthContainers","mediaTabsMap","asChatList","groupByMonth","hideEmptyTabs","showSender","onTransitionStart","onTransitionEnd","safeAssign","searchContextMenu","navScrollableContainer","navScrollable","nav","tabsMenu","mediaTab","mediaTabs","menuTab","span","ripple","unlockScroll","tabsContainer","swipeHandler","handleTabSwipe","prevId","selectTab","children","onTouchMove","lockers","lockTouchScroll","contentTab","searchGroupMedia","canLoadMediaTab","horizontalMenu","tabContent","animate","skipScroll","scrollIntoViewNew","position","startCallback","scrollStartCallback","newMediaTab","onChangeTab","fromMediaTab","offsetTop","scrollTop","scroll","scrollHeight","rect2","onScroll","onMediaClick","targetClassName","targets","containerEl","copySearchContext","slice","inputMessagesFilterPhotoVideo","inputMessagesFilterDocument","useHeavyAnimationCheck","lock","unlockAndRefresh","filterMessagesByType","filterMessagesByInputFilter","processEmptyFilter","dom","appDialogsManager","setLastMessagePromise","lastMessage","highlightWord","processPhotoVideoFilter","promises","getMediaFromMessage","wrapped","choosePhotoSize","boxWidth","boxHeight","onlyPreview","withoutPreloader","noPlayButton","photo","noBlur","images","full","filter","Boolean","processDocumentFilter","withTime","fontWeight","voiceAsMusic","autoDownloadSize","processUrlFilter","webpage","entity","display_url","sliced","offset","matchUrl","same","URL","hostname","description","previewDiv","setInnerHTML","getAbbreviation","subtitleFragment","htmlToDocumentFragment","wrapRichText","innerText","decodeURIComponent","href","firstChild","wrapPlainText","row","titleRight","subtitle","havePadding","performSearchResult","elemsToAppend","sharedMediaDiv","processCallback","results","awaited","method","monthContainer","getMonthContainerByTimestamp","toggleElementCheckbox","afterPerforming","parent","child","loadChats","renderedPeerIds","inputMessagesFilterEmpty","setResults","showMembersCount","peer","getPeer","participants_count","participants","regExp","RegExp","escapeRegExp","cleanSearchText","titleSpan","lastMessageSpan","getChatMembersString","toChatId","username","getPeerUsername","user","appUsersManager","getUser","phone","formatPhoneNumber","formatted","onLoad","arg","getContactsPeerIds","contacts","searchContacts","my_results","globalContacts","showMore","intlElement","isShort","update","getConversations","dialogs","minDate","renderRecentSearch","recent","recentSearch","isUser","getUserStatusString","toUserId","getTopPeers","peers","people","loadMembers","renderParticipants","membersList","rippleEnabled","li","findUpTag","DIALOG_LIST_ELEMENT_TAG","participant","getParticipantPeerId","isAnyChat","deleted","appChatsManager","isChannel","LOAD_COUNT","appProfileManager","getChannelParticipants","getChatFull","chatFull","loadType","justLoad","used","slicedLength","ids","notFilteredMessages","m","checkForTriggers","getSearch","nextRate","next_rate","loadFirstTime","filters","counters","canViewMembers","getSearchCounters","firstMediaTab","counter","c","membersTab","loadFirstTimePromise","toLoad","t","findAndSplice","setHours","setDate","dateTimestamp","getTime","containers","month","getFullYear","year","dateElement","haveTimestamps","getObjectKeysAndSort","positionElementByIndex","isBroadcast","hasRights","cleanScrollPositions","cleanupHTML","goFirst","revokeObjectURL","putPreloader","empty","newInputFilter","copy","setQuery","maxDate","AppSelectPeers","chatsContainer","selected","freezed","offsetIndex","loadedWhat","peerType","multiSelect","exceptSelf","tempIds","selfPresence","needSwitchList","onInput","cachedContacts","getMoreResults","f","renderResultsFunc","renderResults","peerIds","splitUp","notRendered","filterPeerTypeBy","placeholder","section","innerContainer","topContainer","selectedContainer","selectedScrollable","sectionNameLangPackKey","noShadow","checkbox","checked","debouncedInput","appendTo","getResultsPromise","onFirstRender","renderSaved","testSelfSearch","getTempId","getMoreDialogs","archived","pageCount","newOffsetIndex","chatRightsAction","filterByRights","isEnd","getMoreContacts","isGlobalSearch","searchResult","resultPeerIds","arr","getMoreChannelParticipants","channelParticipants","q","isNonContactUser","checkboxField","label","subtitleEl","isDialog","insertAdjacentElement","offsetWidth","getSelected","addInitial","values","requestAnimationFrame","forceDirection","constructDownloadPreloader","tryAgainOnFail","circle","totalLength","mids","attr","elem","findMediaTargets","anchor","anchorMid","isBubbles","justAudioSelector","selectors","prefix","mediaItems","AudioElement","HTMLElement","render","isRealVoice","isOutgoing","is_outgoing","uploadingFileName","durationStr","downloadDiv","onTypeLoad","audioEl","out","waveform","Uint8Array","valueCount","result","dataView","DataView","buffer","byteIndex","bitShift","getUint16","decodeWaveform","svg","svgContainer","availW","barHeightMax","minW","maxW","normValue","wfSize","barCount","maxValue","maxDelta","barX","sumI","bar_value","barWidth","createWaveformBars","fakeSvgContainer","waveformContainer","timeDiv","onTimeUpdate","throttledTimeUpdate","addAudioListener","readyPromise","mousemove","scrub","offsetX","targetTouches","pageX","scrubTime","wrapVoiceMessage","descriptionEl","audioAttribute","parts","titleEl","middleEllipsisEl","sizeType","subtitleDiv","launched","progressLine","lastChild","wrapAudio","audioTimeDiv","HAVE_CURRENT_DATA","onTypeDisconnect","getTimeStr","hadSearchContext","useSearch","autoDownload","shouldPlay","onDownloadInit","pauseListener","notifyAll","done","total","cancel","Error","playListener","setDownloadFunction","disconnectedCallback","isConnected","customElements","define","AvatarListLoader","loadMore","photoId","appPhotosManager","getUserPhotos","photos","loadedAllUp","AppMediaViewerAvatar","getPhoto","onAvatarUpdate","openAvatarViewer","getTarget","hadMessage","isObject","believeMe","seen","AvatarElement","addedToQueue","attachClickEvent","updateOptions","wasPeerId","newPeerId","onlyThumb","putPhoto","isBig","AvatarEdit","clearRect","asDiv","rippleSquare","disabled","ButtonMenuItem","noCheckboxClickListener","textElement","textArgs","keepOpen","menu","b","ButtonMenuToggleHandler","onOpen","onClose","openedMenu","direction","ChatBackgroundGradientRenderer","_width","_height","_tails","_scrollTails","_curve","_positions","_phases","_animatingToNextPosition","_scrollDelta","_onWheelRAF","drawOnWheel","floor","ceil","changeTail","curPos","curPosition","_phase","_tail","drawGradient","drawNextPositionAnimated","frames","_frames","drawImageData","leftLength","_incrementalCurve","hexToRgb","hex","g","getPositions","positions","getNextPositions","phase","curveMax","curve","pos","distances","nextPos","distance","tail","getGradientImageData","_hctx","createImageData","pixels","data","centerDistanceY","centerDistanceY2","centerDistanceX","swirlFactor","sqrt","theta","sinTheta","sin","cosTheta","cos","pixelX","pixelY","distanceSum","_colors","distanceX","distanceY","putImageData","_ctx","_hc","cancelAnimationFrame","colors","color","alpha","_canvas","fillStyle","fillRect","toNextPosition","tails","nextPhaseOnIdx","inc","toFixed","curves","last","scrollAnimate","_addedScrollListener","createCanvas","gradientRenderer","MEDIA_SIZE","wrapReplyDivAndCaption","mediaEl","messageMedia","isRound","mediaChildren","video_thumbs","noInfo","videoSize","ReplyContainer","isMediaSet","accumulateMapSet","reduce","acc","AppSelection","selectedMids","onMouseDown","targetLookupClassName","verifyTarget","selecting","firstTarget","processElement","checkBetween","isInDOM","seenSet","seenLength","findUpAsChild","elementsBetween","getElementsBetween","toggleByMid","canceledSelection","onMouseMove","getElementFromTarget","verifyMouseMoveTarget","removeManual","listenElement","documentListenerOptions","first","firstRect","lastRect","isHigher","lookupBetweenParentClassName","lookupBetweenElementsQuery","firstIndex","lastIndex","doNotAnimate","onCancelSelection","toggleSelection","navigationType","random","attachListeners","selectedText","getSelection","toString","createRange","verifyTouchLongPress","isElementShouldBeSelected","appendCheckbox","hasCheckbox","getCheckboxInputFromElement","updateContainer","forceSelection","cantForward","cantDelete","cantSend","storageKey","cantForwardDeleteMids","onUpdateContainer","toggleCheckboxes","wasSelecting","blurActiveElement","forwards","onToggleSelection","updateElementSelection","toggleMid","unselect","deleteSelectedMids","SearchSelection","selectionCountEl","selectionGotoBtn","selectionContainer","BASE_CLASS","btnCancel","attachClickOptions","obj","fromPeerId","sort","isPrivate","transitionElement","ChatSelection","chat","bubbles","recording","bubble","canSelectBubble","isGroupedBubbleSelected","getMidsFromGroupContainer","getBubbleGroupedItems","groupContainer","isGroupedSelected","isGroupedMidsSelected","mounted","getMountedBubble","needTranslateX","widthFrom","widthTo","center","selectionInputWrapper","selectionSendNowBtn","selectionLeft","selectionRight","translateButtonsX","right","inputContainer","toggleAttribute","skippedMids","isGrouped","groupedCheckboxInput","CheckboxField","restriction","toggleDisability","stateKey","stateValues","stateValue","setValueSilently","box","checkSvg","bg","border","withRipple","withHover","event","Event","disable","CodeInputField","autocomplete","lastLength","setLabel","onFill","confirmationPopup","callback","cancelButton","isCancel","checkboxes","countries","setCountries","country","hidden","default_name","localeCompare","CountryInputField","hidePicker","hideTimeout","selectWrapper","selectCountryByTarget","defaultName","phoneCodeEl","phoneCode","countryCode","lastCountrySelected","lastCountryCodeSelected","country_codes","_countryCode","country_code","onCountryChange","liMap","arrowDown","selectList","initSelect","emoji","iso2","liArr","noPhoneCodes","Infinity","spanEmoji","select","margin","mouseDownHandlerAttached","onKeyPress","_value","names","abbr","word","test","blur","selectCountryByIso2","countryName","DivAndCaption","fill","EditPeer","_disabled","isChanged","uploadAvatar","changedLength","requiredLength","requiredValidLength","inputFields","isValid","required","handleChange","nextBtn","withoutAvatar","avatarElem","doNotEditAvatar","avatarEdit","_upload","lockWithPromise","unlockOnSuccess","GifsTab","gifsContainer","EmoticonsDropdown","masonry","EMOTICONSSTICKERGROUP","getGifs","docs","processInvisibleDiv","ANIMATIONGROUP","AppGifsTab","nextOffset","loadedAll","onGifsClick","fileId","inputSearch","gifsDiv","onCloseAfterTimeout","newSearch","gifBotPeerId","resolveUsername","appInlineBotsManager","getInlineResults","next_offset","AppStickersTab","setsDiv","listenTo","sticker","stickerSet","access_hash","appStickersManager","getStickerSet","toggleStickerSet","changed","installed_date","removeAttribute","renderSet","header","countDiv","stickersDiv","stickerDiv","documents","withLock","renderFeatured","getFeaturedStickers","coveredSets","filterRendered","forEachReverse","covered","searchStickerSets","tabId","onSelectTabClick","searchButton","deleteBtn","checkRights","tabsEl","tabsElements","canSendStickers","canSendGifs","canSendToPeer","whichChild","savedRange","getGoodRange","unlock","refresh","emojiTab","stickersTab","gifsTab","HIDE_EMOJI_TAB","INIT_TAB_ID","lastMouseMoveEvent","mouseMoveEventAttached","isActive","onMouseOut","getElement","clearDraft","silent","emoticonsDropdown","forceClose","addLazyLoadQueueRepeat","divs","intersector","getVisible","clearVisible","getSavedRange","sel","rangeCount","activeElement","getRangeAt","menuOnClick","menuScroll","jumpedTo","stickyIntersector","stuck","which","axis","sendDocId","loadedURLs","appendEmoji","unify","kek","getEmojiEntityFromEmoji","wrapSingleEmoji","fixEmoji","getEmojiFromElement","nodeType","nodeValue","EmojiTab","closeScrollTop","onContentClick","categories","sorted","category","emojis","titleDiv","itemsDiv","unified","previousElementSibling","emojiScroll","appEmojiManager","getRecentEmojis","hasRecent","activeId","setMenuActive","recentItemsDiv","observeStickyHeaderChanges","LazyLoadQueueRepeat","parallelLimit","onVisibilityChange","_queue","spliced","findAndSpliceAll","queue","setProcessQueueTimeout","SuperStickerRenderer","regularLazyLoadQueue","animated","checkAnimationContainer","processVisible","processInvisible","renderSticker","observeAnimated","unobserveAnimated","StickersTab","categoriesMap","localCategories","setFavedLimit","appConfig","stickers_faved_limit_premium","stickers_faved_limit_default","createCategory","_title","menuTabPadding","categoriesIntersector","categoryAppendStickers","isCategoryVisible","superStickerRenderer","setCategoryItemsHeight","containerWidth","stickerSize","itemsPerRow","minHeight","renderStickerSet","menuWrapper","setTyping","intersectionOptions","root","clearCategoryItems","createLocalCategory","toggleLocalCategory","onCategoryStickers","stickers","deleteSticker","unshiftSticker","spliceExceed","favedCategory","recentCategory","clearButton","titleLangKey","descriptionLangKey","langKey","clearRecentStickers","noop","premiumCategory","apiManager","getAppConfig","getFavedStickersStickers","getRecentStickersStickers","getAllStickers","sets","getPremiumStickers","isPremium","race","rendererLazyLoadQueue","faved","resizeCategories","createStickersContextMenu","verifyRecent","notMounted","onLocalCategoryUpdate","batch","unshiftRecentSticker","saveRecentSticker","deleteRecentSticker","generateFakeIcon","isScam","LazyLoadQueueRepeat2","GifsMasonry","scrollPromise","processVisibleDiv","noPreview","gifWidth","gifHeight","willUseWidth","calcImageInBox","transitionTime","scrollableX","proxy","Proxy","apply","that","args","selectTarget","result1","canChange","forceDuration","mutateCallback","useStripe","indicator","currentIndicator","shiftLeft","scaleFactor","clientWidth","findUpAttribute","noLinebreaks","originalEvent","clipboardData","getData","usePlainText","filterEntity","curChild","nextSibling","richValue","getRichValue","entities2","parseEntities","mergeEntities","fragment","wrapDraftText","documentFragmentToHTML","execCommand","InputState","InputField","validate","maxLength","showLengthOn","canBeEdited","labelText","onInputCallbacks","String","isInputEmpty","inputMode","labelEl","showingLength","wasError","inputLength","isError","withLinebreaks","range","selectNodeContents","removeAllRanges","addRange","selectElementContents","labelOptions","fromSet","originalValue","isValidToChange","setDraftValue","setOriginalValue","setState","Valid","setError","InputSearch","prevValue","onClearClick","onClear","searchIcon","clearBtn","LazyLoadQueue","wasSeen","getItem","addElement","hasOwnProperty","LazyLoadQueueIntersector","inProcess","disconnect","loadItem","intersectorTimeout","processQueue","MediaProgressLine","useTransform","progressRAF","onLoadedData","seek","setLoadProgress","onProgress","filledLoad","setSeekMax","buf","buffered","numRanges","nearestStart","end","percents","testQueue","pendingTest","setTestQueue","testElement","getElementWidth","mapped","firstTime","textLength","font","textWidth","elementWidth","newElementWidth","widthChanged","smallerText","smallerWidth","smallerTextLength","half","half1","substr","half2","MiddleEllipsisElement","connectedCallback","PasswordMonkey","passwordInputField","needFrame","noCache","currentFrame","setSpeed","onVisibilityClickAdditional","passwordVisible","setDirection","curFrame","TrackingMonkey","playAnimation","frame","idleAnimation","PasswordInputField","onVisibilityClick","toggleVisible","stealthy","tabIndex","PeerProfileAvatars","avatar","avatars","draggable","loadCallback","intersectionObserver","loadCallbacks","addTab","gradient","info","arrowPrevious","arrowNext","checkScrollTop","SWITCH_ZONE","freeze","_e","clickX","toRight","cancelNextClick","minX","lastX","SCALE","TRANSLATE_TEMPLATE","addIndex","loadNearestToTarget","setPeer","backLimit","filterChatPhotosMessages","chat_photo","generateFakeAvatarMessage","activeTab","photo_id","setText","PeerProfile","setPeerStatus","needClear","noDelimiter","bio","subtitleLangKey","getProfileByPeerId","about","toast","link","notifications","togglePeerMute","appNotificationsManager","isPeerLocalMuted","setMoreDetails","fillUsername","userId","self","fillUserPhone","setAvatar","setPeerStatusInterval","setInterval","clearSetMoreDetailsTimeout","canBeDetailed","oldAvatars","formatUserPhone","fillNotifications","notificationsRow","fillRows","withIcons","fillProfileElements","cleaned","_setMoreDetails","peerFull","getChat","exportedInvite","exported_invite","address","setMoreDetailsTimeout","isRestricted","acknowledged","setPromise","cached","clearInterval","generateTitleIcons","verified","use2","generateVerifiedIcon","fake","scam","premium","generatePremiumIcon","weakMap","WeakMap","PeerTitle","setOptions","hasInner","fromName","limitSymbols","icons","getPeerTitle","inner","createDocumentFragment","PopupAvatar","closable","withConfirm","cropper","crop","removeHandlers","h6","btnClose","cropContainer","file","files","readBlobAsDataURL","contents","onload","originalImage","cropComponent","cropImage","event_state","cropLeft","cropTop","cropWidth","cropHeight","scaledRatio","overlayColor","CROPWIDTH","offsetHeight","CROPHEIGHT","updateCropSize","updateCropImage","startMoving","resizing","keyHandler","imgZoom","PI","bottom","newWidth","newHeight","clientHeight","fromCharCode","charCode","stopPropagation","container_width","container_height","container_left","container_top","mouse_x","clientX","scrollX","mouse_y","clientY","pageY","scrollY","saveEventState","moving","endMoving","currentTouch","complete","btnConfirm","hide","toBlob","blob","darkenCanvas","onCrop","postCanvas","ctx","PopupDeleteDialog","onSelect","peerTitleElement","getDialogType","callbackLeave","flush","leave","flushHistory","callbackDelete","descriptionArgs","isDanger","descriptionLangArgs","PopupDeleteMessages","onConfirm","revoke","deleteScheduledMessages","deleteMessages","titleArgs","isMegagroup","_hasRights","canRevoke","titleLangArgs","PopupForward","peerIdMids","overrideOnSelect","peerTypes","DEFAULT_APPEND_TO","appendPopupTo","onFullScreenChange","PopupElement","reAppend","MANAGERS","confirmShortcutIsSendShortcut","withoutOverlay","overlayClosable","isScrolledDown","btnConfirmOnEnter","buttonsEl","buttonsElements","langArgs","POPUPS","onContentUpdate","popup","popupConstructor","ctor","addCancelButton","times","time","ONE_HOUR","PopupMute","mutePeer","rows","radioField","radioForm","PopupPeer","noTitle","o","original","nextElementSibling","PopupPickUser","PopupSendNow","sendScheduledMessages","ANIMATION_GROUP","PopupStickers","stickerSetInput","onStickersClick","stickersFooter","isStickerPack","loadStickerSet","langPackKey","ProgressivePreloader","detached","isUpload","attachMethod","loadFunc","constructContainer","bold","constructDownloadIcon","downloadSvg","cancelSvg","func","startTime","onEnd","notify","elapsedTime","TRANSITION_TIME","addNotifyListener","useRafs","getTotalLength","strokeDasharray","Layouter","minWidth","spacing","ratios","countRatios","proportions","countProportions","averageRatio","accumulate","maxSizeRatio","layout","ComplexLayouter","layoutTwo","layoutThree","layoutFour","layoutTwoTopBottom","layoutTwoLeftRightEqual","layoutTwoLeftRight","layoutThreeLeftAndOther","layoutThreeTopAndOther","layoutFourTopAndOther","layoutFourLeftAndOther","geometry","sides","RectPart","minimalWidth","secondWidth","firstWidth","firstHeight","thirdHeight","secondHeight","rightWidth","leftWidth","thirdWidth","h0","w0","w2","w1","h1","h2","ratio","cropRatios","clamp","attempts","multiHeight","sum","pushAttempt","lineCounts","heights","second","third","fourth","optimalAttempt","optimalDiff","attempt","counts","lineCount","totalHeight","minLineHeight","bad1","bad2","line","optimalCounts","optimalHeights","rowCount","colCount","lineHeight","col","prepareAlbum","widthItem","heightItem","borderTopLeftRadius","borderBottomLeftRadius","borderTopRightRadius","borderBottomRightRadius","forMedia","mediaDiv","putAvatar","renderThumbPromise","thumbImage","isFullLoaded","stripped_thumb","getPreviewURLFromBytes","sequentialDom","renderPromise","myId","getPeerColorById","avatarAvailable","avatarRendered","appAvatarsManager","isAvatarCached","first_name","last_name","getPeerInitials","returnDiv","setButtonLoader","RadioField","alignRight","RadioForm","radios","form","RangeSelector","events","setFilled","filled","stepStr","decimals","_removeListeners","rectMax","offsetAxisValue","rippleClickId","attachListenerTo","handler","drawRipple","clickId","touchStartFired","clickY","isRippleUnneeded","touchEnd","Row","subtitleLangArgs","isToggle","noCheckboxSubtitle","titleRightSecondary","noWrap","titleRightEl","navigationTab","createMedia","RadioFormFromRows","SCROLL_THROTTLE","IS_ANDROID","ScrollableBase","logPrefix","onScrollMeasure","lastScrollPosition","lastScrollDirection","isHeavyAnimationInProgress","needCheckAfterAnimation","cancelMeasure","onScrolledTop","scrollPosition","scrollProperty","addScrollListener","addedScrollListener","removeScrollListener","removeHeavyAnimationListener","Scrollable","onScrollOffset","withPaddingContainer","maxScrollTop","getDistanceToEnd","setScrollTopSilently","ignoreNextScrollEvent","ScrollableX","splitCount","scrollHorizontally","deltaX","scrollWidth","scrollLeft","AppNewGroupTab","isGeoChat","setTitle","SettingSection","inputWrapper","groupNameInputField","groupLocationInputField","valueCheck","userLocationCoords","userLocationAddress","createChannel","geo_point","megagroup","chatId","inputFile","editPhoto","inviteToChannel","createChat","chatsSection","nameArgs","new","startLocating","geolocation","getCurrentPosition","lat","coords","latitude","long","longitude","uri","fetch","response","json","display_name","GeolocationPositionError","PrivacyType","getPrivacyRulesDetails","rules","types","allowPeers","users","chats","disallowPeers","rule","PrivacySection","onRadioChange","captions","captionElement","radioSection","exceptions","radioRows","skipTypes","noExceptions","generateSection","exceptionTexts","exception","_peerIds","slider","createTab","skippable","takeOut","newPeerIds","generateStr","splitPeersByType","selectedPeerIds","appPrivacyManager","getPrivacy","inputKey","setRadio","k","eventListener","chatKey","usersKey","getUserInput","setPrivacy","AppPrivacyPhoneNumberTab","getSelf","captionEl","mePath","anchorCopy","phoneSection","sCaption","AppTwoStepVerificationSetTab","captionOld","stickerContainer","inputContent","generateContentElement","btnReturn","sliceTabsUntilTab","AppSettingsTab","canFocus","isFirstInput","AppTwoStepVerificationEmailConfirmationTab","isFirst","email","codeInputField","passwordManager","confirmPasswordEmail","goNext","btnChange","btnResend","cancelPasswordEmail","AppTwoStepVerificationEmailTab","resendPasswordEmail","onOpenAfterTimeout","onContinueClick","btnContinue","btnSkip","matchEmail","toggleButtons","updateSettings","hint","currentPassword","plainPassword","newPassword","symbols","AppTwoStepVerificationHintTab","onSkipClick","saveHint","AppTwoStepVerificationReEnterPasswordTab","monkey","I","verifyInput","AppTwoStepVerificationEnterPasswordTab","isNew","has_password","textEl","getStateInterval","getState","_state","check","auth","AppTwoStepVerificationTab","removeTabFromHistory","btnChangePassword","btnDisablePassword","btnSetRecoveryEmail","has_recovery","btnSetPassword","AppPrivacyLastSeenTab","AppPrivacyProfilePhotoTab","AppPrivacyForwardMessagesTab","AppPrivacyAddToGroupsTab","AppPrivacyCallsTab","AppActiveSessionsTab","Session","app_name","app_version","ip","date_active","date_created","midtitle","device_model","system_version","platform","authorizations","session","btnTerminate","invokeApi","otherSection","onError","onTerminateClick","menuElement","AppBlockedUsersTab","btnAdd","toggleBlock","bot","blocked","getBlocked","convertKeyToInputKey","toUpperCase","AppPrivacyVoicesTab","AppPrivacyAndSecurityTab","SUBTITLE","blockedPeerIds","blockedUsersRow","passwordState","twoFactorRowOptions","email_unconfirmed_pattern","twoFactorRow","activeSessionsRow","updateActiveSessions","setBlockedCount","updateBlocked","rowsByKeys","numberVisibilityRow","lastSeenTimeRow","photoVisibilityRow","callRow","linkAccountRow","groupChatsAddRow","voicesRow","updatePrivacyRow","disallowLength","allowLength","destroyed","setGlobalPrivacySettings","archive_and_mute_new_noncontact_peers","getGlobalPrivacySettings","settings","onPremiumToggle","autoarchive_setting_available","_enabled","sensitive_enabled","sensitive_can_change","payment","appPaymentsManager","clearSavedInfo","deleteButton","appDraftsManager","clearAllDrafts","auths","averageColorFromCanvas","pixel","getImageData","pixelsLength","outPixel","Uint8ClampedArray","highlightningColor","rgba","l","ColorPicker","hue","saturation","lightness","onGrabStart","documentElement","boxDragger","onGrabEnd","sliders","hueDragger","hexInputField","rgbInputField","inputs","valid","setColor","rgbRegExp","attachBoxListeners","attachHueListeners","attachGrabListeners","boxRect","saturationHandler","hueRect","hueHandler","updateHexInput","updateRgbInput","rgb","boxX","percentY","boxY","percentHue","hueX","updatePicker","getCurrentColor","rgbaArray","hexa","hsl","hsla","maxX","maxY","posX","posY","lightnessX","lightnessY","AppBackgroundColorTab","_applyColor","updateColorPicker","colorPicker","background","theme","intensity","slug","appStateManager","pushToState","onColorChange","applyColor","themeController","gridSection","grid","backgroundColor","throttle","isColored","AppBackgroundTab","clicked","wallPapersByElement","elementsByKey","onUploadClick","accept","requestFile","endsWith","createObjectURL","mimeType","scaleMediaElement","File","wallPaper","prepareWallPaperUpload","uploadPromise","uploadWallPaper","uploadDeferred","newKey","getWallPaperKey","setBackgroundDocument","addWallPaper","onResetClick","defaultTheme","blurCheckboxField","onGridClick","wallpaper","saveToCache","_tempId","onReady","getPixelPromise","imageUrl","imageSource","averageColorFromImageSource","averageColor","getColorsFromWallPaper","toDataURL","getWallPaperKeyFromTheme","uploadButton","colorButton","resetButton","pattern","getWallPapers","wallPapers","gridContainer","background_color","second_background_color","third_background_color","fourth_background_color","hasFile","isDark","dark","noFadeIn","webkitMaskImage","AppQuickReactionTab","appReactionsManager","getQuickReaction","getAvailableReactions","quickReaction","availableReactions","reaction","inactive","availableReaction","static_icon","setDefaultReaction","RangeSettingSelector","initialValue","minValue","writeValue","nameDiv","valueDiv","valueContainer","AppGeneralSettingsTab","chatBackgroundButton","animationsCheckboxField","enterRow","ctrlEnterRow","kilometersRow","milesRow","formats","format","runFirst","getNextTimeout","_callback","run","eachTimeout","getSeconds","eachMinute","toLocaleTimeString","hour","minute","suggestCheckboxField","bigCheckboxField","reactionsRow","renderQuickReaction","loopCheckboxField","stickerSets","stickersContent","allStickers","assumeType","AppEditProfileTab","firstNameInputField","lastNameInputField","bioInputField","about_length_limit_premium","about_length_limit_default","editPeer","usernameInputField","setProfileUrl","availableText","takenText","invalidText","profileUrlContainer","profileUrlAnchor","updateProfile","uploadProfilePhoto","updateUsername","userFull","getProfile","AppNotificationsTab","NotifySection","enabledRow","typeText","previewEnabledRow","inputNotifyPeer","getNotifySettings","notifySettings","applySettings","isMuted","show_previews","mute","showPreviews","inputSettings","mute_until","updateNotifySettings","notify_settings","contactsSignUpRow","soundRow","sound","getContactSignUpNotification","setContactSignUpNotification","AppLanguageTab","invokeApiCacheable","lang_pack","languages1","languages2","rendered","webLangCodes","language","lang_code","native_name","langPack","autoDownloadPeerTypeSection","contactsCheckboxField","privateCheckboxField","groupsCheckboxField","channelsCheckboxField","AppAutoDownloadPhotoTab","AppAutoDownloadFileTab","debouncedSave","sizeMax","setByKey","MIN","MAX_RANGE","MAX","upTo","formatBytes","compareAndUpdate","AppAutoDownloadVideoTab","AUTO_DOWNLOAD_FOR_KEYS","private","channels","AppDataAndStorageTab","autoCheckboxField","autoDownloadNew","deepEqual","setSubtitles","setAutoDownloadSubtitle","photoRow","videoRow","fileRow","file_size_max","openTab","tabConstructor","onDisabledChange","gifsCheckboxField","videosCheckboxField","peerKeys","enabledKeys","isAll","logOut","edit","profile","fillPromise","changeAvatarBtn","upload","updateChangeAvatarBtn","devicesRow","languageRow","buttonsSection","lottieLoader","getAuthorizations","overwrite","getAuthorizationsPromise","AppNewChannelTab","channelNameInputField","channelDescriptionInputField","onLengthChange","broadcast","channelId","PopupCreateContact","importContact","nameInputField","telInputField","AppContactsTab","openContacts","isContact","sortedUserList","createList","renderPage","AppArchivedTab","wasFilterId","filterId","chatList","localId","AppPeopleNearbyTab","isLocationWatched","parseDistance","retryBtn","latestLocationSaved","accuracy","getLocated","updates","orderedPeers","groupsCounter","usersCounter","getPeerId","peopleSection","locatedPeers","sortedList","errorCategory","startWatching","watchPosition","isLongitudeDifferent","isLatitudeDifferent","distanceCheck","calculateDistance","stopWatching","lat1","long1","lat2","long2","asin","LEFT_COLUMN_ACTIVE_CLASSNAME","AppSidebarLeft","sidebarEl","sidebarHeader","onContactsClick","backBtn","btnArchive","dialogsStorage","getFolderDialogs","isDialogsLoaded","themeCheckboxField","filteredButtons","sessionStorage","kz_version","toolsBtn","btnMenuFooter","rel","newBtnMenu","updateBtn","reload","initSearch","archivedCount","folder","unreadPeerIds","formatNumber","checkUpdateInterval","cache","status","ok","hasUpdate","searchContainer","pickedElements","selectedPeerId","selectedMinDate","selectedMaxDate","updatePicked","setProperty","removeProperty","helper","unselectEntity","renderEntity","indexOfAndSplice","dates","dateData","pushRecentSearch","peopleContainer","hideNewBtnMenuTimeout","transition","activeClassName","onFocus","clearRecentSearchBtn","clearRecentSearch","fakeGradientDelimiter","generateDelimiter","hr","captionArgs","delimiter","appSidebarLeft","AppAddMembersTab","attachToPromise","removeLoader","isPrivacy","AppChatFoldersTab","filtersRendered","renderFolder","dialogFilter","non_contacts","broadcasts","bots","isAnyGroup","filtersStorage","getFilter","createFolderBtn","foldersSection","suggestedSection","canCreateFolder","onFiltersContainerUpdate","getDialogFilters","toggleAllChats","getSuggestedFilters","order","loadAnimationPromise","dialog_filters_limit_premium","dialog_filters_limit_default","getSuggestedDialogsFilters","suggestedFilters","includePeerIds","excludePeerIds","pinnedPeerIds","createDialogFilter","bool","AppIncludedChatsTab","getContacts","foundInFilters","dialogsByFilters","onSelectChange","confirmBtn","cmp","pinned_peers","other","otherLegacy","getInputPeerById","editFolderTab","setFilter","onAppConfig","dialog_filters_chats_limit_premium","dialog_filters_chats_limit_default","categoriesSection","exclude_muted","ico","exclude_archived","exclude_read","selectedPeers","addedInitial","_add","flag","originalFilter","AppEditFolderTab","flags","deleteFolderButton","updateDialogFilter","menuBtn","inputSection","generateList","h2Text","to","includedFlagsContainer","excludedFlagsContainer","include","include_peers","editCheckForChange","reloadMissingPromises","reloadMissingPeerIds","onCreateOpen","onEditOpen","ul","ignoreClick","hasPeer","getDialogOnly","filtered","filterAsync","renderMore","_length","exclude_peers","RIGHT_COLUMN_ACTIVE_CLASSNAME","AppSidebarRight","canHideFirst","isColumnProportionSet","toggleSidebar","setColumnProportion","createSharedMediaTab","replaceSharedMediaTab","previousTab","sharedMediaTab","historyTabIds","_selectTab","getFrom","setFrom","onCloseTab","isNavigation","willChange","animationPromise","appSidebarRight","AppEditContactTab","notificationsCheckboxField","profileNameDiv","profileSubtitleDiv","phoneRow","addContact","btnDelete","deleteContacts","AppChatTypeTab","privateRow","publicRow","privateSection","publicSection","linkRow","btnRevoke","getChatInviteLink","linkInputField","applyBtn","head","getValue","migrateChat","toggleNoForwards","onChatUpdate","noforwards","AppUserPermissionsTab","destroyListener","ChatPermissions","rights","banned_rights","editBanned","btnDeleteException","clearChannelParticipantBannedRights","kickFromChannel","exceptionText","toggleWith","defaultBannedRights","default_banned_rights","defaultRights","combineParticipantBannedRights","restrictionText","mainFlag","until_date","AppGroupPermissionsTab","chatPermissions","editChatDefaultBannedRights","addExceptionRow","openPermissions","getChannelParticipant","setSubtitle","bannedRights","cantWhat","listEl","setLength","exceptionsCount","loader","setLoader","getPromise","migrateFrom","migrateTo","AppChatReactionsTab","getActiveAvailableReactions","originalReactions","available_reactions","enabledReactions","toggleSection","toggleCheckboxField","toggleRow","reactionsSection","checkboxFields","saveReactionsDebounced","every","saveReactions","newReactions","getCachedFullChat","setChatAvailableReactions","AppEditChatTab","_init","chatUpdateListeners","addChatUpdateListener","canChangeType","canChangePermissions","chatNameInputField","descriptionInputField","chatTypeRow","setChatTypeSubtitle","setReactionsLength","availableReactionsLength","reactions","permissionsRow","setPermissionsLength","getChatTyped","editTitle","editAbout","signMessagesCheckboxField","signatures","toggleSignatures","showChatHistoryCheckboxField","togglePreHistoryHidden","hidden_prehistory","historiesStorage","AppSharedMediaTab","newCloseBtn","closeBtn","animatedCloseIcon","transitionContainer","transitionFirstItem","editBtn","transitionLastItem","secondTitle","setIsSharedMedia","isSharedMedia","onCloseBtnClick","toggleEditBtn","renderNewMessages","msgs","deleteDeletedMessages","btnAddMembers","showConfirmation","addChatUser","setLoadMutex","peerChanged","loadSidebarMedia","destroyable","SetTransition","raf","afterTimeout","SidebarSlider","closeTab","closingId","preserveTab","getTab","isTabExists","doNotAppend","SliderSuperTab","_constructor","SliderSuperTabEventable","SortedUserList","getIndex","getUserStatusForSort","onDelete","onListLengthChange","onUpdate","onSort","willChangeLength","onElementCreate","base","updateElementWith","updateListWith","createChatListOptions","doTimeout","updateList","SORT_INTERVAL","CLASS_NAME","StackedAvatars","avatarContainer","AVATAR_CLASS_NAME","hasViewer","attachStickerViewerListeners","findTarget","checkForParent","closest","mediaContainer","previousGroup","_middleware","previousTransformer","doThatSticker","lockGroups","isSwitching","effectThumb","mediaRect","boxSize","fitted","aspectFitted","transformer","stickerEmoji","stickerEmojiRaw","transformX","transformY","needFadeIn","withThumb","relativeEffect","loopEffect","firstFramePromise","prevPlayer","ready","onMousePreMove","newMediaContainer","_previousTransformer","StickyIntersector","observeHeaders","observeElements","headersObserver","targetInfo","boundingClientRect","stickyTarget","rootBoundsInfo","rootBounds","threshold","elementsObserver","addSentinel","sentinel","headerSentinel","getEvent","attachGlobalListenerTo","RESET_GLOBAL","SwipeHandler","listenerOptions","hadMove","xDown","yDown","handleMove","setCursorTo","handleStart","xUp","yUp","onSwipeResult","setCursor","TelInputField","pasted","lastValue","telEl","HTMLInputElement","pixelRatio","devicePixelRatio","letterSpacing","originalFunc","formattedPhoneNumber","leftPattern","shiftKey","toastEl","hideToast","toastNew","langPackArguments","slideNavigation","prevTabContent","slideTabs","TransitionSlider","isHeavy","animationFunction","Transition","withAnimationListener","onTransitionEndCallbacks","animationDeferred","listenerName","onEndEvent","overrideFrom","onTransitionEndCallback","_from","isUsernameValid","UsernameInputField","checkUsernameDebounced","checkUsername","checkUsernamePromise","available","VisibilityIntersector","locked","change","refreshVisible","VolumeSelector","onMuteClick","setVolume","iconIndex","ICONS","wrapPhoto","withTail","noThumb","blurAfter","isWebDoc","isWebDocument","noAutoDownload","isFit","loadThumbPromise","isGif","renderOnLoad","renderMediaWithFadeIn","canAttachPreloader","haveToDownload","onlyCache","getDownloadPromise","roundVideoCircumference","wrapVideo","isAlbumItem","canAutoplay","spanTime","spanPlay","needPlayButton","photoRes","divRound","halfSize","strokeWidth","radius","strokeDashoffset","globalVideo","onPaused","onFrame","uploadFileName","renderDeferred","loadPhotoThumbFunc","wrapAlbum","attachmentDiv","uploading","wrapDocument","audioElement","extSplitted","ext","isArray","docDiv","icoDiv","icoTextEl","hadContext","hasThumb","performance","fileName","bytesContainer","descriptionParts","bytesMaxEl","sizeDiv","_downloadDiv","addByteProgress","sizeContainer","_bytesContainer","_d","save","canOpenAfter","downloadFileName","getDownloadMediaDetails","downloadId","apiFileManager","isDownloading","wrapGroupedDocuments","albumMustBeRenderedFull","messageDiv","nameContainer","getMidsByMid","getMessage","richText","AppPollResultsTab","resultsDiv","poll","appPollsManager","getPoll","quiz","question","voters","total_voters","roundPercents","answer","answers","answerEl","answerTitle","answerPercents","getVotes","option","votesList","votes","vote","user_id","down","lineTotalLength","minIndex","minRemainder","remainder","maxRemainder","pollElement","isClosed","closed","performResults","chosenIndexes","PollElement","setMaxLength","resizePolls","hideQuizHint","onHide","prevQuizHint","prevQuizHintOnHide","prevQuizHintTimeout","isListenerSet","isQuiz","isRetracted","isPublic","isMultiple","chosingIndexes","sentVote","MAX_LENGTH","MAX_OFFSET","svgLines","setLineProgress","descKey","public_voters","multiple_choice","multipleSelect","descDiv","typeDiv","avatarsDiv","close_period","close_date","timeLeftDiv","quizTimer","circumference","period","closeTime","quizInterval","timeLeft","stroke","getResults","answerDivs","numberDivs","footerDiv","viewResults","votersCountDiv","sendVoteBtn","sendVotes","canVote","setVotersCount","clickHandler","initQuizHint","solution","solution_entities","toggleHint","setQuizHint","correctResult","correct","chosen","answerIndex","foundIndex","indexes","sendVotePromise","sendVote","timeEl","recent_voters","stackedAvatars","isVoted","hideSendVoteBtn","hideViewResultsBtn","maxPercents","getPercentValue","iterate","fullTime","votersCount","wrapPoll","wrapReply","setColorPeerId","replyContainer","wrapStickerSetThumb","downloadOptions","getStickerSetThumbDownloadOptions","videos","animationData","needUpscale","wrapStickerToRow","previousMedia","_size","_limitSymbols","support","was_online","today","getDate","dateEl","wrapJoinVoiceChatAnchor","wrapUrl","call","wrapLinkToMessage","plain","savedFrom","dir","wrapMessageActionTextNew","unsafeMessage","getNameDivHTML","formatCallDuration","post","schedule_date","daysToStart","tomorrowDate","_args","day","pinnedMessage","reply_to_mid","fetchMessageReplyTo","htmlToSpan","joined","anchorHTML","domain","isRecurringInit","recurring_init","isRecurringUsed","recurring_used","paymentsWrapCurrencyAmount","total_amount","currency","invoiceMessage","reply_to","reply_to_peer_id","waited","wrapMessageActionTextNewUnsafe","wrapMessageForReply","usingMids","withoutMediaType","hasAlbumKey","addPart","part","usingFullAlbum","grouped_id","getMidsByMessage","albumText","getAlbumText","emoticon","game","actionWrapped","restriction_reason","exec","messageWrapped","noLinks","noTextFormat","wrapPeerTitle","wrapSenderToPeer","senderTitle","fromMe","wrapSentTime","STICKER_EFFECT_MULTIPLIER","locksUrls","wrapSticker","loadStickerMiddleware","exportLoad","skipRatio","asStatic","fullThumb","noPremium","isCustomEmoji","stickerType","emojiSticker","animatedSticker","staticSticker","isAnimated","getStickerEffectThumb","willHaveLock","lockUrl","toneIndex","isThumbNeededForType","lottieCachedThumb","getLottieCachedThumb","haveThumbCached","afterRender","num","getPathFromBytes","ns","getPreviewURLFromThumb","stickerThumbConverted","webpWorkerController","saveWebPConvertedStrippedThumb","getImageFromStrippedThumb","middlewareError","makeError","sync","setLockColor","dpr","skipx","skipy","imageData","sr","sg","sb","sa","outCanvas","outContext","computeLockColor","saveLottiePreview","onFirstFrame","sendInteractionThrottled","preloadAnimatedEmojiStickerAnimation","getAnimatedEmojiSoundDocument","restart","getAnimatedEmojiSticker","animationDiv","side","withRandomOffset","msg_id","getServerMessageId","interaction","JSON","stringify","preloadSticker","playing","stickerPromise","attachStickerEffectHandler","wrapStickerAnimation","unmountAnimation","frameNo","maxFrame","vibrate","generateRandomSigned","randomOffsetX","randomOffsetY","setPosition","factor","stableOffsetX","stableOffsetY","rectX","rectY","addOffsetX","addOffsetY","wrapStickerEmoji","wrapWebPageDescription","webPage","shortDescriptionText","wrapWebPageTitle","shortTitle","site_name","EmojiVersions","Emoji","version","assign","FontFamily","FontSize","FontWeight","instances","cancelAnimationByKey","instance","getAnimationInstance","isCancelled","animateSingle","tick","createAnimationInstance","array","AudioAssetPlayer","assets","playSound","assetName","createAudio","playSoundIfDifferent","Audio","stopSound","cancelDelayedPlay","playSoundWithTimeout","heavyQueue","processingQueue","addHeavyTask","processHeavyQueue","todo","possiblePromise","process","realResult","timedChunk","requireBlurPromise","fastBlurFunc","processBlurNext","iterations","default","dataUri","JPEG_HEADER","bytesFromHex","JPEG_TAIL","isSticker","btoa","bytesToDataURL","imageW","imageH","boxW","boxH","noZoom","boxedImageW","boxedImageH","getTextWidth","measureText","mediaSize","quality","badCharsRe","trimRe","C2L","clearBadCharsAndTrim","latinize","processSearchText","clearBadChars","ignoreCase","hasTag","includeTag","charAt","originalText","ch","latinizeCh","latinizeString","fixCyrillic","copyTextToClipboard","clipboard","writeText","textArea","removeChild","fallbackCopyTextToClipboard","ContextMenuController","diffX","diffY","isOpened","openBtnMenu","months","days","ONE_DAY","getWeekNumber","UTC","getMonth","dayNum","getUTCDay","setUTCDate","getUTCDate","yearStart","getUTCFullYear","formatDateAccordingToTodayNew","weekday","formatFullSentTimeRaw","formatTime","capitalize","textTransform","formatFullSentTime","getFullDate","joiner","monthAsNumber","getHours","getMinutes","noSeconds","leadingZero","noTime","minYear","yearPattern","monthYearOrDayPattern","yearOrDayAndMonthPattern","shortDate","longDate","numberOfDaysEachMonth","fillTipDates","setFullYear","dayOfWeek","formatWeekLong","getDay","getDayOfWeek","setTime","g1","g2","createForDayMonth","createForMonthYear","selectedYear","currentYear","g3","validDateForMonth","formatterYearMax","k1","setMonth","formatterMonthYear","formatterDayMonth","_cancelContextMenuOpening","_cancelContextMenuOpeningTimeout","cancelContextMenuOpening","onCancel","onStart","onMove","isTouch","onTouchEnd","CLICK_EVENT_NAME","touchMouseDown","detachClickEvent","simulateClickEvent","ControlsHover","setHideTimeout","hideControlsTimeout","isShown","controlsLocked","toggleControls","relatedTarget","verifyFavoriteSticker","toAdd","favedStickers","some","_doc","findElement","filterButtons","attachListenerSetter","_element","initResult","createContextMenu","disablePictureInPicture","computedStyle","getProperty","simulateEvent","childNodes","node","tag","requestFullScreen","requestFullscreen","mozRequestFullScreen","webkitRequestFullscreen","msRequestFullscreen","cancelFullScreen","mozCancelFullScreen","webkitCancelFullScreen","msExitFullscreen","addFullScreenListener","addListener","eventName","getFullScreenElement","fullscreenElement","mozFullScreenElement","webkitFullscreenElement","msFullscreenElement","isFullScreen","markdownTags","entityName","underline","italic","monospace","strikethrough","mentionName","BLOCK_TAG_NAMES","getRichElementValue","lines","selNode","selOffset","follow","isBlock","alt","isTableCell","wasEntitiesLength","wasLength","field","withEntities","lookForSticky","overflowRect","overflowTop","overflowRight","overflowBottom","overflowLeft","sticky","visualViewport","windowWidth","innerWidth","windowHeight","innerHeight","handleHorizontalSwipe","cancelY","DocumentFragment","template","hasAttribute","isSendShortcutPressed","isComposing","secondaryKey","isSwipingBackSafari","TouchEvent","placeCaretAtEnd","ignoreTouchCheck","selectionStart","selectionEnd","collapse","createTextRange","textRange","moveToElementText","prevPos","backgroundImage","useCache","isImage","renderImageFromUrlPromise","DropdownHover","inited","ignoreMouseOut","displayTimeout","toElement","willBeActive","dispatchResultableEvent","attachButtonListener","onmouseout","onmouseover","setIgnoreMouseOut","ignore","FocusDirection","fastSmoothScroll","maxDistance","Static","scrollWithJs","getNormalSize","rectStartKey","rectEndKey","sizeKey","scrollSizeKey","scrollPositionKey","elementRect","elementPosition","elementSize","containerSize","scrollSize","fallbackToElementStartWhenCentering","remainingPath","absPath","startAt","shortTransition","longTransition","currentPath","distanceToEnd","FILENAME_JOINER","getFileNameByLocation","thumb_size","big","stickerset","short_name","thumb_version","volume_id","local_id","strictDecimals","_decimals","dm","fixed","pow","parseFloat","CALL_DURATION_LANG_KEYS","showLast","modulus","formatDuration","strings","prefixes","maxPrefixLength","setPrefix","originalStr","prefixCountry","patterns","searchForPattern","mostMatchedPatternMatches","mostMatchedPattern","_pattern","patternMatches","symbol","arcParameter","rx","ry","xAxisRotation","largeArcFlag","sweepFlag","tl","tr","bl","useBlur","ignoreCache","ListLoader","loadedAllDown","setLoaded","unsetCurrent","toPrevious","goUnsafe","loadPromiseDown","loadPromiseUp","processedArr","processed","ListenerSetter","listeners","addManual","onceCallback","onceFired","_listener","MediaSize","aspect","aspectCovered","makeMediaSize","ScreenSize","MediaSizes","screenSizes","mobile","medium","large","handhelds","regular","album","esgSticker","documentName","invoice","customEmoji","desktop","isMobile","handleResize","activeScreen","wasScreen","rAF","middlewarePromise","throwWhat","numberThousandSplitter","HAVE_METADATA","useCanplayOnIos","OverlayClickHandler","withOverlay","amount","skipSymbol","isNegative","currencyData","amountExp","exp","number","dec_point","thousands_sep","n","isFinite","prec","sep","dec","toFixedFix","number_format","decimal_sep","space_between","symbol_left","splitter","additionalPadding","getScrollWidthFromElement","menuWidth","menuHeight","paddingTop","paddingRight","paddingBottom","paddingLeft","verticalSide","maxTop","maxLeft","minLeft","intermediateX","intermediateY","possibleSides","platforms","getRestrictionReason","reasons","reason","savingLottiePreview","isSavingLottiePreview","saving","throttleWithRaf","fn","schedulerFn","waiting","throttleWith","ScrollableLoader","SearchListLoader","messageId","generateMessageId","filterMids","onHistoryDelete","shouldBeDeleted","onHistoryMultiappend","onMessageSent","isInner","otherSideLoader","filterMessagesByInputFilterFromStorage","goToOtherEnd","do","kind","scheduleFlush","measure","mutate","mutateElement","read","write","pushDocumentSize","_isWebDocument","replies","comments","channel_id","SortedList","_updateList","canUpdate","getAll","updateBatch","noScheduler","encodeEntities","charCodeAt","limitFrom","leadZero","sec_num","hours","minutes","seconds","ANIMATION_START_EVENT","ANIMATION_END_EVENT","isAnimating","heavyAnimationPromise","promisesInQueue","dispatchHeavyAnimationEvent","perf","_heavyAnimationPromise","onHeavyAnimationEnd","interruptHeavyAnimation","getHeavyAnimationPromise","handleAnimationStart","handleAnimationEnd","DialogsContextMenu","onArchiveClick","selectedId","editPeerFolders","folder_id","onPinClick","toggleDialogPin","config","getConfig","pinned_dialogs_count_max","onUnmuteClick","onUnreadClick","unread_count","readHistory","top_message","markDialogUnread","onContextMenu","getDeleteButtonText","isDialogUnread","pinned","ConnectionStatusComponent","hadConnect","connecting","timedOut","updating","setConnectionStatus","baseDcId","connectionStatus","setFirstConnectionTimeout","online","apiUpdatesManager","forceGetDifference","retryAt","setStatusText","currentLangPackKey","statusEl","statusPreloader","singleInstance","CHANGE_STATE_DELAY","getA","networkerFactory","forceReconnect","timerSpan","interval","forceReconnectTimeout","setStateTimeout","statusContainer","SENDING_STATUS","easeInOutSine","roundRect","defaultRadius","beginPath","moveTo","lineTo","quadraticCurveTo","closePath","DPR","SIZE","MARGIN","WIDTH","RADIUS","Shimmer","currTime","diffTime","spread","pausedTime","pauseInterval","lightSource","lightSpread","currentAnimationIndex","keepTime","cycleAnimation","currentAnimation","animateGlow","animateSlide","smartInc","lightLeft","lightRight","lightCenter","createLinearGradient","customProperties","shimmerColor","addColorStop","dict","on","fillText","DialogsPlaceholder","onThemeChange","stopAnimation","startAnimation","onResize","updateCanvasSize","shimmer","generatedValues","marginVertical","lineBorderRadius","lineMarginVertical","statusWidth","getRectFrom","onRemove","blockScrollable","overflowY","availableLength","detachTime","renderDetachAnimationFrame","globalCompositeOperation","completed","elapsedRowTime","dialogHeight","renderFrame","createPattern","patternCanvas","patternContext","drawChat","firstLineWidth","secondLineWidth","marginLeft","arc","drawCircle","drawCircleFromStart","setPromiseMiddleware","oldPromise","SortedDialogList","indexKey","getDialogIndex","addListDialog","isBatch","AppDialogsManager","Log","placeholders","sortedLists","scrollables","folders","menuScrollContainer","lastActiveElements","offsets","initedListeners","loadedDialogsAtLeastOnce","onTabChange","loadDialogsRenderPromise","loadDialogsPromise","onChatsScroll","_onListLengthChange","checkIfPlaceholderNeeded","hasContacts","removeContactsPlaceholder","updateContactsLength","dialogSize","loadContacts","verifyPeerIdForContacts","processContact","added","setListClickListener","onChatsRegularScroll","sliceTimeout","scrollTopWas","rectContainer","rectTarget","firstY","lastY","firstElement","elementFromPoint","lastElement","elementOverflow","sliceFromStart","sliceFromEnd","deleteDialog","setOffsets","onChatsScrollTop","loadDialogs","getProxiedManagers","contextMenu","bottomPart","allChatsIntlElement","isFilterIdAvailable","clearCurrent","onStateLoaded","setFilterId","addFilter","foldersScrollable","_id","filtersNavigationItem","setFilterIdAndChangeTab","changeFiltersAllChatsKey","groupCallsController","callsController","getDialogIndexKey","getDialogIndexKeyByFilterId","setOnlineStatus","hasClassName","initListeners","getDialogDom","isBot","processDialogForCallStatus","setFilterUnreadCount","setLastMessageN","setUnread","validateDialogForFilter","setFiltersUnreadCount","updateDialog","setUnreadMessagesN","drop","setDialogActive","getCachedDialogs","validateListForFilter","onFiltersLengthChange","containerToAppend","renderedFilter","typings","unsetTyping","dialogDom","callIcon","filtersArr","haveFilters","addFilters","addFiltersPromise","showFiltersPromise","getNotifyPeerTypeSettings","fillConversations","getOffsetIndex","isDialogMustBeInViewport","migratedTo","testDialogForFilter","topOffset","bottomOffset","unreadSpan","unread","unreadUnmutedCount","unreadCount","getFolderUnreadCount","generateScrollable","sortedDialogList","createChatList","wasShowing","cachedInfoPromise","currentOffsetIndex","needIndex","getConversationsResult","isTopEnd","callbacks","cccc","offsetDialog","generateEmptyPlaceholder","classNameType","subtitleArgs","placeholderContainer","needPlaceholder","emptyDialogsPlaceholderSubtitle","usersLength","placeholderType","updatePartClassName","updateContactsLengthPromise","firstDialog","getDialogFromElement","lastDialog","withContext","openInner","lastActiveListElement","setPeerFunc","sameElement","getDialogByPeerId","setLastMessage","draftMessage","draft","topMessage","lastTimeSpan","isMessageRestricted","willPrepend","videoTypes","playIcon","senderBold","setUnreadMessages","wasMuted","setStatusMessage","isPinned","hasUnreadBadge","transitionDuration","disableAnimationIfRippleFound","iconClassName","setSendingStatus","statusSpan","isUnreadBadgeMounted","unreadBadge","hasMentionsBadge","unread_mentions_count","isMentionBadgeMounted","mentionsBadge","isUnread","isMention","getDialog","originalDialog","getOutputPeer","setCallStatus","START_X","wasMounted","itemProgress","groupCallActiveIcon","addDialogNew","call_active","call_not_empty","addDialogAndSetLastMessage","getMessageSenderPeerIdOrName","addDialog","captionDiv","titleSpanContainer","peerTitlePromise","titleP","rightSpan","oldTypingElement","newTypingElement","downloads","getNewDeferred","cancelDownload","clearDownload","getNewDeferredForUpload","getUpload","getDownload","getUploadPromise","getDownloadFileNameFromOptions","downloadMedia","promiseBefore","downloadMediaURL","downloadMediaVoid","getFileNameForUpload","downloadToDisc","justAttach","pingPromise","iframe","hadProgress","getDocumentDownloadOptions","getPhotoDownloadOptions","clickEvent","createEvent","initMouseEvent","createDownloadAnchor","BubbleGroup","createAvatar","avatarLoadPromise","fwdFrom","fwdFromId","isForwardFromChannel","from_id","currentPeerId","firstTimestamp","firstItem","firstMid","lastTimestamp","lastItem","lastMid","updateClassNames","insertItem","insertInDescendSortedArray","sortGroupItemsKey","insertGroup","mount","onItemUnmount","mountItem","onItemMount","unmountItem","dateContainer","getDateContainerByTimestamp","dateGroups","_group","dateGroupsLength","unmountedLength","STICKY_OFFSET","deleteEmptyDateGroups","BubbleGroups","itemsArr","itemsMap","newGroupDiff","sortItemsKey","sortGroupsKey","removeItemFromCache","removeAndUnmountBubble","getItemByBubble","siblings","getSiblingsAtIndex","modifiedGroups","previousSibling","canItemsBeGrouped","groupUngrouped","mountUnmountGroups","toMount","toUnmount","bad","partition","getLastGroup","changeBubbleMid","insertItemToArray","changeItemBubble","changeBubbleByBubble","item1","item2","itemIndex","findGroupSiblingByItem","findGroupSiblingInItems","previousItem","siblingGroupedItem","nextItem","addItemToGroup","addItemToCache","getMessageFromId","viaBotId","createItem","SERVICE_AS_REGULAR","getDateForDateContainer","groupMid","splitSiblingsOnGrouping","prepareForGrouping","hadGroup","foundItem","splittedGroups","PopupDatePicker","initDate","onPick","noButtons","selectedDate","selectedMonth","minMonth","prevBtn","maxMonth","onDateClick","selectedEl","setTimeTitle","controlsDiv","monthTitle","monthsContainer","handleTimeInput","onOverflow","maxString","hoursInputField","minutesInputField","setMinutes","popupCenterer","timeOptions","sendDate","dateOptions","renderElement","firstDate","weekStartDate","dayIndex","clonedDate","showOverflowMonths","ReactionElement","reactionCount","_reactionCount","setCanRenderAvatars","canRenderAvatars","doNotRenderSticker","hadStickerContainer","getReaction","callbackify","center_icon","wrapPromise","wrapStickerPromise","renderCounter","displayOn","renderAvatars","recentReactions","peer_id","setIsChosen","isChosen","fireAroundAnimation","REACTION_INLINE_SIZE","REACTION_BLOCK_SIZE","around_animation","iconPlayer","aroundPlayer","REACTIONS_ELEMENTS","ReactionsElement","onConnectCallback","getReactionCount","reactionElement","isPlaceholder","changeMessage","changedResults","hasReactions","availableReactionsResult","isReactionActive","totalReactions","can_see_list","reactionElementIdx","recent_reactions","handleChangedResults","timeSpan","RepliesElement","updated","postKey","leftPart","recent_repliers","read_max_id","max_id","textSpan","iconSpan","rippleContainer","subscribeRepliesThread","updateMessage","makeEdited","edited","makeSponsored","MessageRender","chatType","editedSpan","sponsoredSpan","reactionsElement","reactionsMessage","isSponsored","sponsored","isMessage","views","postAuthor","post_author","postViewsSpan","channelViews","edit_date","edit_hide","clonedArgs","_reactionsElement","renderReplies","bubbleContainer","isFooter","repliesFooter","setReply","isReplacing","currentReplyDiv","replyToPeerId","originalMessage","originalPeerTitle","titlePeerId","originalMessageFwdFromId","needUpdate","replyMid","getElementByPoint","horizontalSide","reflowScrollableElement","SEND_WHEN_ONLINE_TIMESTAMP","INTERNAL_LINK_TYPE","PopupJoinChatInvite","chatInvite","request_needed","importChatInvite","savePhoto","peopleCount","ScrollSaver","getSaved","findElements","replaceSaved","findAndSetElements","_save","scrollHeightMinusTop","onRestore","useReflow","setScrollTop","newScrollTop","restore","_restore","previousScrollHeightMinusTop","SuperIntersectionObserver","observing","observingQueue","freezedObservingNew","toggleObservingNew","isMentionUnread","mentioned","stringResults","numberResults","replaceNonNumber","CARD_BRAND_REGEXP","visa","mastercard","amex","discover","diners","diners14","jcb","unionpay","elo","mir","CARD_BRANDS","minLength","cvcMaxLength","cvcMinLength","unknown","detectCardBrand","card","sanitizedCard","brand","detectUnifiedCardBrand","createArray","delta","buggedRegExp","getDistanceFromBuggedToNormal","char","fixBuggedNumbers","makeOptionalCharacter","consumed","makeRequiredCharacter","partial","wrapCharacterRegExpFactory","optional","_regExp","source","makeCharacter","makeMonthDigitPatternCharacter","digit","capitalCharacter","cleanedResult","formattingCharacter","str1","makeFormattingCharacter","optionalPattern","spaceCharacter","yearOptionalPattern","sixteenPattern","fifteenPattern","requiredPostcodes","generateFourPattern","cardFormattingPatterns","cardNumber","cardExpiry","cardCvc","cardCvcFromBrand","postalCodeFromCountry","optionalDigits","accumulateLengths","strs","nbspRegExp","makeValidationError","validateCardNumber","sanitized","getCardInfoByNumber","ignoreIncomplete","validateCompleteCardNumber","makeCardNumberError","validateCardExpiry","monthStr","yearStr","_year","nextMonth","isNaN","validateExpiry","createVerificationIframe","allow","contentWindow","parse","PopupPaymentVerification","eventType","eventData","path_full","InputFieldCorrected","lastKeyDown","deleting","lastTransformed","getPattern","pushRest","autocorrectComplete","character","getCharacter","meta","formatInputValueByPattern","formatMethod","transformedValue","validateNew","onBlur","justReturn","validateMethod","validateAnyIncomplete","errorKeys","handleInputFieldsOnChange","_onChange","createCountryZipFields","zip","countryInputField","postcodeInputField","SUPPORTED_NATIVE_PROVIDERS","PopupPaymentCard","paymentForm","savedCard","native_provider","cardOut","token","credentials","can_save_credentials","cardSection","nativeParams","native_params","lastBrand","lastBrandImg","brandIconTempId","cardInputField","invalid","incomplete","transformed","getPaymentBrandIconPath","setBrandIcon","cvcInputField","need_cardholder_name","expireInputField","switchFocusOrder","previousInputField","nextInputField","inputFieldsRow","billingSection","need_country","need_zip","canSave","saveCheckboxField","saveRow","payButton","PaymentButton","expiryFull","expiryMonth","expiryYear","cvc","cardholderName","nativeProvider","URLSearchParams","headers","publishable_key","expiration_month","expiration_year","security_code","public_token","PopupPaymentCardConfirmation","inputCheckPassword","getInputCheckPassword","tmpPassword","password","handled","PopupPaymentShipping","inputInvoice","savedInfo","saved_info","addressSection","address1InputField","address2InputField","cityInputField","stateInputField","receiverSection","emailInputField","shipping_address_requested","name_requested","email_requested","phone_requested","validateEmail","validatePhone","selectedCountry","shipping_address","street_line1","street_line2","city","country_iso2","post_code","requestedInfo","validateRequestedInfo","shippingAddress","ADDRESS_STREET_LINE1_INVALID","ADDRESS_STREET_LINE2_INVALID","ADDRESS_COUNTRY_INVALID","ADDRESS_CITY_INVALID","ADDRESS_STATE_INVALID","ADDRESS_POSTCODE_INVALID","REQ_INFO_NAME_INVALID","REQ_INFO_EMAIL_INVALID","REQ_INFO_PHONE_INVALID","focusField","PopupPaymentShippingMethods","shippingOption","shipping_options","prices","lastShippingId","PopupPayment","tipButtonsMap","confirmed","onConfirmed","popupPaymentVerification","mediaInvoice","isReceipt","receipt_msg_id","isTest","itemEl","detailsClassName","photoEl","linesClassName","linesEl","botName","preloaderContainer","getPaymentReceipt","getPaymentForm","savedCredentials","saved_credentials","lastRequestedInfo","providerPeerTitle","provider_id","bot_id","wrapAmount","isRecurring","recurring","peerTitle2","makeLabel","pricesClassName","makePricesElements","price","_label","wrappedAmount","pricesElements","getTipsAmount","shippingAmount","setTotal","totalAmount","totalLabel","payI18n","canTip","max_tip_amount","tip_amount","tipsClassName","getInputValue","setInputWidth","setInputValue","unsetActiveTip","tipEl","tipsLabel","haveToIgnoreEvents","onSelectionChange","ignoreNextSelectionChange","onFocusOut","tipsEl","tipClassName","tipButtons","suggested_tip_amounts","tipAmount","prevTipEl","setRowIcon","createRow","setRowTitle","setCardSubtitle","methodRow","onMethodClick","previousCardDetails","previousToken","credentials_title","providerRow","providerAvatar","shippingAddressRow","shippingNameRow","shippingEmailRow","shippingPhoneRow","shippingMethodRow","lastShippingOption","onShippingAddressClick","onShippingMethodClick","setShippingTitle","postAddress","setShippingInfo","setShippingOption","scrollSaver","lastShippingPricesElements","shipping","acceptTermsCheckboxField","recurring_terms_url","acceptTermsRow","recurringElements","lastTmpPasword","missingInfo","tmp_password","paymentResult","sendPaymentForm","form_id","_passwordState","valid_until","tsNow","IGNORE_ACTIONS","TEST_SCROLL_TIMES","TEST_SCROLL","PEER_CHANGED_ERROR","getMainMidForGrouped","ChatBubbles","unreadOut","bubblesNewByGroupedId","bubblesNew","dateMessages","scrolledDown","isScrollingTimeout","unreaded","unreadedSeen","messagesQueuePromise","messagesQueue","messagesQueueOnRenderAdditional","firstUnreadBubble","replyFollowHistory","isFirstLoad","passEntities","viewsMids","isTopPaddingSet","renderingMessages","bubblesToEject","bubblesToReplace","setPeerTempId","renderNewPromises","unreadedObserverCallback","onUnreadedInViewport","viewsObserverCallback","sendViewCountersDebounced","sponsoredMessage","random_id","viewSponsoredMessage","stickerEffectObserverCallback","onBubblesMouseMove","unhoverPrevious","hoverBubble","hoverReaction","setHoverVisible","stickerWrapper","getGroupsFirstMessage","getMiddleware","getAvailableReactionsByMessage","select_animation","CHAT_ANIMATION_GROUP","sendReaction","onBubblesClick","setInnerPeer","chatInner","onDatePick","contactDiv","callDiv","callUser","getInputInvoiceByPeerId","bubbleMid","reply_to_top_id","saved_from_msg_id","openThread","message1","getMessageWithReplies","getDiscussionMessage","via","setDraft","peerIdStr","documentDiv","groupedItem","SINGLE_MEDIA_CLASSNAME","isSingleMedia","parents","hasAspecter","albumItem","isReplyClick","replyToMid","reply_to_msg_id","ignoreHeavyAnimation","scrollDimensions","forceDown","sliceViewportDebounced","setCorrectIndexThrottled","setStickyDateManually","setPeerPromise","requestHistory","setMessageId","constructBubbles","bubbleGroups","sequential","messagesStorageKey","newItem","_items","groupBubbles","scrollingToBubble","scrollToEnd","deleteMessagesByIds","tempMessage","_bubble","groupedId","getMessagesByAlbum","reactionsElements","repliesElement","newDiv","safeRenderMessage","scrollToBubbleIfLast","deletedMids","wasMainMid","mainMid","createScrollSaver","appendReactionsElementToBubble","dateMessage","dateBubble","previousStickyDate","sliceViewport","setScroll","attachContainerListeners","highlightBubble","replyAfter","shouldReply","canSend","_target","initMessageReply","constructPeerHelpers","renderNewMessage","setUnreadCount","updateUnreadByDialog","finishPeerChange","postViewsElements","different","postViews","incrementMessageViews","createResizeObserver","resizeObserver","wasHeight","skip","scrolled","onResizeEnd","setEndRAF","ResizeObserver","contentRect","realDiff","_part","needScrollTop","destroyResizeObserver","setReactionsHoverListeners","getRenderedLength","readUnreaded","readPromise","idleController","bubblesMaxId","getHistoryMaxId","readContents","constructPinnedHelpers","constructScheduledHelpers","getScheduledMessagesStorage","onGoDownClick","getBubbleByPoint","getGroupedBubble","groupId","getMidsByAlbum","findNextMountedBubbleByMsgId","filterCallback","_mid","foundMid","loadMoreHistory","getHistoryTopPromise","getHistoryBottomPromise","getHistory1","destroyScrollable","getHistoryStorage","readMaxId","readOutboxMaxId","msgId","permanent","ignoreOnScroll","emptyPlaceholderBubble","setTopPadding","setPaddingTo","isPaddingNeeded","unsetPadding","_renderNewMessage","newMessage","replyTo","getLastBubble","performHistoryResult","scrollToBubbleEnd","scrollToBubble","isChangingHeight","messageInput","dimensions","datasetKey","createDateBubble","bubbleContent","serviceMsg","fakeBubble","bubblesToo","cleanupPlaceholders","attachedUnreadBubble","fetchNewPromise","getSponsoredMessagePromise","onAnimateLadder","resolveLadderAnimation","attachPlaceholderOnRender","samePeer","startParam","bindPrefix","onChangePeer","getPinnedMessagesMaxId","isTarget","followingUnread","savedPosition","overrideAdditionMsgId","getChatSavedPosition","getReadMaxIdIfUnread","foundSlice","findSliceOffset","isJump","isStartButtonNeeded","setStartParam","setQueueId","messageEntityBotCommand","additionMsgId","maxBubbleId","oldChatInner","oldPlaceholderBubble","haveToScrollToBubble","fromUp","scrollFromDown","scrollFromUp","willScrollOnLoad","setPeerOptions","waitPromise","setPeerCached","mountedByLastMsgId","setCorrectIndex","lastBubble","onRenderScrollSet","afterSetPromise","setFetchReactionsInterval","setFetchHistoryInterval","onScrolledAllDown","unread_mark","fetchReactions","getMessagesReactions","needFetchInterval","isFetchIntervalNeeded","getNewHistory","isBottomEnd","historyMaxId","canWrite","renderMessagesQueue","setMessagesQueuePromise","possibleError","renderQueue","renderQueuePromises","loadQueue","filterQueue","avatarPromises","updatePosition","timePromises","groupCollapsed","groupEnd","setUnreadDelimiter","restoreScroll","prepareToSaveScroll","ejectBubbles","oldBubble","local","updatePlaceholderPosition","isAvatarNeeded","additionalCallback","processResult","newBubble","originalPromise","renderMessage","albumMids","albumMessages","our","isOurMessage","contentWrapper","isInUnread","chat_id","is_single","messageMessage","customEmojiSize","bigEmojis","emojiEntities","strLength","curr","canHaveTail","isStandaloneMedia","needToSetHTML","replyMarkup","reply_markup","containerDiv","rowDiv","buttonEl","botId","same_peer","checkSwitchReturn","switchInlineQuery","column","callbackButtonClick","callbackAnswer","messageWithReplies","getMessageWithCommentReplies","withReplies","isOutMessage","canHideNameIfMedia","processingWebPage","quote","previewResizer","preview","quoteTextDiv","strong","textDiv","isSquare","isEmoji","nopremium","newNameContainer","lastContainer","contact","contactDetails","contactNameDiv","contactNumberDiv","phone_number","priceEl","needName","titleVia","isHidden","goto","generateTail","documentContainer","documentMessageDiv","viewportSlice","getViewportSlice","deleteViewportSlice","historyResult","needReflowScroll","setLoadedPromises","firstSlice","lastSlice","both","processLocalMessageRender","getHistory","ackedResult","getScheduledMessages","animateAsLadder","additionMsgIds","isAdditionRender","targetMid","sortedMids","topIds","middleIds","bottomIds","setBubbles","lastMsDelay","elementsToAnimate","transitionDelay","topRes","middleRes","bottomRes","delays","renderEmptyPlaceholder","listElements","getRestrictionReasonText","getGreetingSticker","channel_post","start_param","chat_invite","chat_invite_hash","JOIN_CHAT","invite","processInternalLink","creator","isWaitingForAnimation","noTransition","setOn","generateLocalMessageId","addOffset","generateLocalFirstMessage","service","saveMessages","extraSize","invisibleTop","invisibleBottom","foundVisible","minTop","maxBottom","ignoreScrollSaving","invisible","checkPlaceholders","toggleSponsoredMessage","renderBotPlaceholder","checkIfEmptyPlaceholderNeeded","_log","getSponsoredMessage","sponsoredMessages","messagePromise","processPromise","bot_info","botInfo","description_document","description_photo","isBackLimit","resultPromise","isFirstMessageRender","serviceStartMessageId","getThreadServiceMessageId","sup","_promise","mustBeCount","PopupPinMessage","unpin","canUnpin","canPinMessage","oneSide","unpinAllMessages","hidePinnedMessages","updatePinnedMessage","buttonText","getPinnedMessagesCount","pinButtonText","isSelectionEmpty","selectionRange","START_TO_END","preloadAnimatedEmojiSticker","PopupReportMessagesConfirm","reportMessages","STICKER_EMOJI","PopupReportMessages","preloadStickerPromise","marginTop","PopupSponsored","PopupReactedList","canViewReadParticipants","canViewMessageReadParticipants","loaders","hasAllReactions","createFakeReaction","hasReadParticipants","readUserIds","getMessageReadParticipants","chatlist","skipReadParticipants","skipReactionsList","getMessageReactionsListAndReadParticipants","combined","getReactionCached","allReactionsSticker","REACTION_CLASS_NAME","REACTIONS_CLASS_NAME","CAN_USE_TRANSFORM","ChatReactionsMenu","reactionsMap","players","onScrollProcessItem","reactionDiv","appear","widthContainer","reactionsContainer","reactionsScrollable","animationGroup","renderReaction","setVisible","canUseAnimations","scaleContainer","appearWrapper","appear_animation","selectLoadPromise","selectPlayer","REACTION_SIZE","ChatContextMenu","isSelectable","isTextSelected","isAnchorTarget","isUsernameTarget","selectedMid","isOverBubble","isTargetAGroupedItem","noForwards","viewerPeerId","canOpenReactedList","menuPadding","reactionsMenu","reactionsMenuPosition","isReactionsMenuVisible","offsetSize","nextVisiblePart","MIN_NEXT_VISIBLE_PART","minSize","onSendScheduledClick","onReplyClick","onFaveStickerClick","unfave","faveSticker","onEditClick","initMessageEditing","onCopyClick","onCopyAnchorLinkClick","onCopyLinkClick","threadMessage","onUnpinClick","onRetractVote","onStopPoll","stopPoll","setButtons","notDirect","scheduleSending","editMessage","scheduleDate","canEditMessage","getMessageFromStorage","hasTarget","isGoodType","viewsButton","isViewingReactions","participantsCount","reactedLength","i18nElem","fakeText","AVATAR_SIZE","MAX_AVATARS","PADDING_PER_AVATAR","reactionsCount","fakeElem","readParticipants","totalSize","SendMenu","sendMenuButtons","onSilentClick","onScheduleClick","sendMenu","openSide","onContextElement","setPeerId","PopupCreatePoll","onSubmitClick","send","radioLabel","isEmpty","questions","appendMoreField","correctAnswers","optionInputFields","questionInputField","sendSilent","dd","settingsCaption","anonymousCheckboxField","multipleCheckboxField","quizCheckboxField","quizSolutionField","quizElements","quizSolutionCaption","quizHr","quizSolutionContainer","quizSolutionSubtitle","getFilledAnswers","quizSolution","force","quizSolutionEntities","inputMediaPoll","getInputMediaPoll","sendOther","getMessageSendingParams","helperType","clearHelper","questionField","createPosterFromMedia","getGifDuration","arrayBuffer","currentPopup","getCurrentNewMediaPopup","PopupNewMedia","willAttachType","attachFile","willAttach","shouldCompress","itemDiv","attachMedia","attachDocument","sendFileDetails","captionLengthMax","caption_length_max","wasInputValue","messageInputField","attachFiles","appendDrops","appendGroupCheckboxField","groupCheckboxField","mediaCheckboxField","appendMediaCheckboxField","addFiles","toPush","_file","lastModified","isMedia","sendingParams","sendText","sendAlbum","replyToMsgId","startsWith","objectURL","audioDecodedByteCount","webkitAudioDecodedByteCount","noSound","onseeked","onerror","createPosterFromVideo","isPhoto","isAudio","finish","onRender","foundPhotos","foundVideos","foundFiles","appendMediaToContainer","firstType","albumContainer","HANDLE_EVENT","ACTIVE_CLASS_NAME","AXIS_Y_KEYS","AXIS_X_KEYS","attachListNavigation","waitForKey","waitForKeySet","keyNames","getCurrentTarget","setCurrentTarget","scrollTo","hadTarget","getNextTargetX","currentTarget","isNext","nextTarget","handleArrowKey","property","endProperty","currentRect","targetRect","getNextTargetY","fireSelect","canContinue","attached","resetTarget","_onKeyDown","AutocompleteHelper","onVisible","listType","attachNavigation","controller","addHelper","toggleListNavigation","fromController","skipAnimation","hideOtherHelpers","StickersHelper","onChangeScreen","checkEmoticon","getStickersByEmoticon","getMinDate","getMaxDate","PopupSchedule","canSendWhenOnline","btnSendWhenOnline","getRichValueWithCaret","startOffset","startContainer","endContainer","endOffset","possibleChildrenFocusOffset","caretPos","combineSameEntities","EmojiHelper","chatInput","onEmojiSelected","checkQuery","firstChar","getBothEmojiKeywords","searchEmojis","AutocompletePeerHelper","doNotShow","listElement","BASE","BASE_CLASS_LIST_ELEMENT","processPeerFullForCommands","botInfos","commands","command","indexObject","CommandsHelper","getReadyToSend","sendMessage","AutocompleteHelperController","helpers","preserveHelper","MentionsHelper","insertAtCaret","topMsgId","trimmed","getMentions","ReplyKeyboard","onBodyTouchStart","btnHover","checkAvailability","checkForceReply","touchListener","sendContact","getReplyMarkup","getHistoryStorageTransferable","InlineHelper","queryId","queryAndResultIds","generateQId","resultId","sendInlineResult","_checkQuery","botResults","query_id","gifsMasonry","isGallery","gallery","noCommands","separator","dcId","dataURL","switch_pm","btnSwitchToPM","switchToPM","ChatBotCommands","setUserId","modifyAckedResult","acked","modifyAckedPromise","ChatSendAs","sendAsButtons","previousAvatar","onSendAsMenuToggle","updateButtons","sendAsPeerId","changeSendAsPeerId","executeButtonsUpdate","sendAsPeerIds","saveDefaultSendAs","updateAvatar","getDefaultSendAs","getChannelFull","channelFull","default_send_as","updateManual","updatingPromise","wasSkippingAnimation","auto","getSendAs","addedListener","InputFieldAnimated","inputFake","onFakeInput","setHeight","currentHeight","POSTING_MEDIA_NOT_ALLOWED","ChatInput","lastUrl","lastTimeType","replyElements","willSendWebPage","recordCanceled","recordStartTime","lockRedo","canRedoFromHTML","undoHistory","executedHistory","canUndoFromHTML","onCancelRecordClick","recorder","opusDecodeController","onEmoticonsOpen","toggleClass","btnToggleEmoticons","onEmoticonsClose","isUserOnlineVisible","openScheduled","prepareDocumentExecute","undoRedo","needHTML","sameHTMLTimes","currentHTML","handleMarkdownShortcut","formatKeys","markupTooltip","applyMarkdown","showLinkEditor","onMessageInput","markdownEntities","parseMarkdown","urlEntities","getWebPagePromise","appWebPagesManager","getWebPage","setTopInfo","noWebPage","onHelperCancel","helperFunc","botCommands","resetCurrentFontFormatting","updateBotCommandsToggle","editMsgId","saveDraftDebounced","checkAutocomplete","updateSendBtn","onBtnSendClick","forwarding","restricted","voice_messages_forbidden","releaseMediaPlayback","setRecording","showDiscardPopup","btnCancelRecord","recordingOverlayListener","recordingNavigationItem","sourceNode","analyser","createAnalyser","connect","fftSize","frequencyData","frequencyBinCount","getByteFrequencyData","recordRippleEl","ms","recordTimeEl","needReturn","onHelperClick","forwardElements","rowsWrapperWrapper","rowsWrapper","fakeRowsWrapper","fakeSelectionWrapper","goDownBtn","controlContainer","iconBtn","cancelBtn","onHideAuthorClick","isChangingAuthor","canToggleHideAuthor","onHideCaptionClick","forwardButtons","hideSender","showCaption","hideCaption","changePeer","changeForwardRecipient","forwardBtnMenu","forwardWasDroppingAuthor","replyTitle","forwardHover","modifyArgs","newMessageWrapper","inputMessageContainer","goDownUnreadBadge","goMentionBtn","goMentionUnreadBadge","goToNextMention","btnScheduled","btnToggleReplyMarkup","replyKeyboard","botCommandsToggle","scaler","botCommandsIcon","attachMenuButtons","fileInput","attachMenu","multiple","autocompleteHelperController","stickersHelper","emojiHelper","commandsHelper","mentionsHelper","inlineHelper","btnSendContainer","btnSend","attachMessageInputField","previousQuery","saveDraft","encoderSampleRate","monitorGain","numberOfChannels","recordingGain","reuseWorker","onstop","ondataavailable","typedArray","dataBlob","Blob","sendFile","isVoiceMessage","botStartBtn","toggleBotStartBtnDisability","startBot","pinnedControlBtn","originalChat","pinnedMessageContainer","_center","neededFakeContainer","fakeWrapperTo","oldFakeWrapperTo","fakeSelectionRect","fakeRowsRect","scale","initTranslateX","getNeededFakeContainer","hasMentions","no_webpage","syncDraft","helperToo","clearInput","fromUpdate","getDraft","wrappedDraft","myEntities","apiEntities","wrapDraft","createSendAs","firstChange","sendAs","updateOffset","getPlaceholderKey","updateMessageInputPlaceholder","previousSendAs","ackedPeerFull","ackedScheduledMids","setSendAsCallback","filteredAttachMenuButtons","filterAttachMenuButtons","placeholderKey","hasBotCommands","updateBotCommands","updateMessageInput","isAnonymousSending","oldInputField","attachMessageInputListeners","fixSafariStickyInputFocusing","setStart","readAllHistory","commandsMap","saveExecuted","executed","checkType","haveThisType","isCollapsed","commonAncestorContainer","resetCurrentFormatting","setActiveMarkupButton","insertText","insertEntity","isHelper","fullValue","suffix","AUTO_COMPLETE_REG_EXP","matchIndex","newValue","hadEntities","insertLength","addEntities","caretEntity","insertCaretAtIndex","caret","originalNode","newNode","createTextNode","setStartAfter","insertNode","setCaretAt","foundHelper","checkInlineAutocomplete","inlineMatch","btnPreloader","bot_inline_placeholder","inlinePlaceholder","helperWaitingForward","canSetDraft","fireEvent","clearValue","fixSafariStickyInput","clearReply","unicode","pushRecentEmoji","forwardMessages","dropAuthor","dropCaptions","isDroppingCaptions","sendMessageWithDocument","hideCaptionCheckboxField","replyFragment","initMessagesForward","fromPeerIdsMids","fromPeerIds","smth","messagesWithCaptionsLength","peerTitles","titleKey","senderTitles","firstMessage","newReply","intl","peerTitleEl","wrapSingleMessage","_message","callerFunc","replyParent","oldReply","haveReply","CLASSNAME_BASE","PinnedContainer","floating","divAndCaption","wrapperUtils","attachOnCloseEvent","needClose","isFloating","setFloating","setUtilsWidth","BAR_HEIGHTS","ChatAudio","onPlaybackParams","fasterEl","repeatEl","toggleEl","onStop","onMediaPlay","isMusic","prevEl","nextEl","attachClick","volumeProgressLineContainer","tunnel","progressWrapper","playingDetails","PinnedMessageBorder","drawRect","getClipPath","barHeight","GAP","clipPath","getBarHeight","ONE","TWO","THREE","FOUR","MORE","getMarkHeight","markHeight","getMarkTranslateY","getTrackTranslateY","trackHeight","getTrackHeight","clipPathId","markTranslateY","trackTranslateY","mark","AnimatedSuper","getRow","animateFirst","clearRow","clearRows","currentIndex","DURATION","setNewRow","reflow","previousIndex","fromTop","ignorePrevious","previousRow","AnimatedCounter","previousNumber","getDecimal","animatedSuper","decimal","hideLeft","previousDecimalNumber","EMPTY_INDEX","setCount","previousByDecimal","decimalNumber","ChatPinnedMessage","pinnedMaxMid","pinnedMid","pinnedIndex","wasPinnedIndex","wasPinnedMediaIndex","waitForScrollBottom","loadedBottom","loadedTop","scrollDownListenerSetter","getCurrentIndexPromise","isStatic","dAC","pinnedMessageBorder","animatedSubtitle","animatedMedia","animatedCounter","btnOpen","openPinned","setPinnedMessage","_setPinnedMessage","unsetScrollDownListener","testMid","isNeededMore","getCurrentIndex","LOAD_OFFSET","correctAfter","gotRest","getPinnedMessage","backLimited","offset_id_offset","setScrollDownListener","isDown","handleScrollSideEvent","refreshPosition","handleFollowingPinnedMessage","followPinnedMessage","isLast","writeTo","writeMediaTo","ChatTopbar","verifyButtons","isMenuOpen","btnMore","deleteButtonText","menuButtons","buttonsToVerify","verifyVideoChatButton","currentGroupCall","groupCall","verifyCallButton","getCachedFullUser","phone_calls_available","video_calls_available","onJoinGroupCallClick","joinGroupCall","resize","setUtilsRAF","chatUtils","chatAudio","setPeerStatusManual","btnBack","chatInfoContainer","chatInfo","person","avatarElement","btnJoin","btnPinned","btnCall","btnGroupCall","btnMute","btnSearch","pushButtonToVerify","onBtnBackClick","isFirstChat","constructUtils","linked_chat_id","onCallClick","chatContextMenuHintWasShown","contactPeerId","constructAvatar","joinChannel","setMutedState","isTopMessage","hiddenPinnedMessages","constructDiscussionHelpers","byCurrent","setTitleCallback","setStatusCallback","setTitleManual","wasAlreadyUsed","newPinnedMessage","AppPrivateSearchTab","appSearch","btnPickDate","ChatSearch","selectedIndex","onResultsClick","selectResult","onFooterClick","onUpClick","onDownClick","foundCountEl","upBtn","downBtn","footer","dateBtn","renderedCount","ChatBackgroundPatternRenderer","canvases","INSTANCES","renderToCanvas","fillCanvas","crossOrigin","objectUrl","imageWidth","imageHeight","patternHeight","originalHeight","mask","centerY","topY","endY","bottomY","setCanvasDimensions","Chat","backgroundEl","backgroundTempId","sharedMediaTabs","setBackground","patternRenderer","gradientCanvas","previousGradientRenderer","previousPatternRenderer","previousPatternCanvas","isDarkPattern","getInstance","_gradientRenderer","setBackgroundPromise","setType","beforeDestroy","cleanupBackground","searchTab","_isAnyGroup","setAutoDownloadMedia","destroySharedMediaTab","bubblesSetPeerPromise","photoSizeMax","videoSizeMax","fileSizeMax","photo_size_max","video_size_max","getAutoDownloadSettingsByPeerId","callbacksPromise","ignoreThreadId","historyStorageTransferable","historySerialized","MarkupTooltip","waitingForMouseUp","mouseUpCounter","onMouseUpSingle","resetSelection","tools1","tools2","cancelClosening","linkBackButton","linkInput","applyLink","isLinkValid","setTooltipPosition","linkApplyButton","applyDiv","delimiter1","delimiter2","delimiter3","matchUrlProtocol","getActiveMarkupButton","nodes","getSelectedNodes","currentMarkups","activeButtons","isLinkToggle","bodyRect","selectionRect","inputRect","selectionTop","sizesRect","isFirstShow","setMouseUpEvent","handleSelection","ChatDragAndDrop","dropIcon","onDragOver","onDragLeave","onDrop","outlineWrapper","dropHeader","dropSubtitle","headerArgs","setPath","sizeX","sizeY","disableTransition","LineBlobDrawable","maxRadius","minRadius","N","radiusNext","speed","generateBlob","radDif","generateNextBlob","amplitude","speedScale","draw","paint","pinnedTop","progressToPinned","r1","progressNext","x1","x2","cx","y1","y2","bezierCurveTo","WeavingState","stateId","createGradient","shader","getGradientFromType","x0","y0","dt","TopbarWeave","handleDevicePixelRatioChanged","setSize","forceUpdate","resizeHandler","resizeCanvas","invokeDraw","handleFocus","focused","handleBlur","lbd","lbd1","lbd2","currentState","previousState","progressToState","lastUpdateTime","animateToAmplitude","animateAmplitudeDiff","amplitude2","animateAmplitudeDiff2","top1","top2","paint1","globalAlpha","setCurrentState","states","componentDidMount","matchMedia","setAmplitude","componentWillUnmount","setCanvasSize","RLottieIconItemPart","playPart","RLottieIconItem","createPart","initFrame","skipFirstFrameRendering","inverseColor","onLoadForColor","onLoadForPart","getPart","RLottieIcon","startFrame","endFrame","frameCount","SuperRLottieIcon","partState","colorState","getColor","partCallback","changedPartState","changedColorState","setPartState","setColorState","prevState","renderIfPaused","invoke","GroupCallMicrophoneIcon","GROUP_CALL_MICROPHONE_BUTTON_STATE","partName","HAND","MUTED","UNMUTED","GroupCallParticipantMutedIcon","colored","GROUP_CALL_PARTICIPANT_MUTED_STATE","colorStr","MUTED_FOR_ME","MUTED_BY_ADMIN","propertyValue","getColorByMutedState","generateEqualParts","clearMutedStateModifier","GroupCallParticipantStatusElement","element2","actionClassName","GroupCallParticipantsList","getParticipantByPeerId","onElementDestroy","getGroupCallParticipantMutedState","mutedIcon","callVideoCanvasBlur","GroupCallParticipantVideoElement","setPinned","setParticipant","groupCallParticipantMutedIcon","groupCallParticipantStatus","updateParticipant","GroupCallParticipantsVideoElement","participantsElements","groupCallId","setElementDisplay","pinnedSource","pinSource","unpinAll","setInstance","shouldDisplayElement","displayPinned","shouldDisplay","hasAnyVideo","participantElements","participantVideo","getVideoElementFromParticipantByType","_onLengthChange","GroupCallParticipantContextMenu","onOpenProfileClick","PopupGroupCall","targetPeerId","toggleParticipantMuted","editParticipant","canManageCall","can_self_unmute","muted_by_you","kickFromChat","getContainer","GroupCallParticipantsElement","groupCallParticipantsVideo","appGroupCallsManager","getGroupCallParticipants","GroupCallDescriptionElement","descriptionIntl","GroupCallTitleElement","makeButton","_className","buttonDiv","isConfirm","resizeHandlerClassName","MovableElement","fixDimensions","fixPosition","addResizeHandlers","setSwipeHandler","destroyElements","handlers","startTop","startLeft","startWidth","startHeight","resizingSide","isEnlarging","resizeDiff","maxPossible","setPositionToCenter","MovablePanel","toggleMovable","movable","movableOptions","toggleClassName","raise_hand_rating","onFullScreenClick","onToggleControls","buttonsContainer","onVideoClick","btnVideo","toggleVideoSharing","onScreenClick","btnScreen","toggleScreenSharing","toggleMuted","changeRaiseHand","onLeaveClick","hangUp","discard","toggleBigLayout","btnFullScreen","btnExitFullScreen","wasFullScreen","movablePanel","videosCount","wasBig","btnInvite","btnShowColumn","toggleRightColumn","btnFullScreen2","headerInfo","newHeader","newHeaderInfo","newHeaderTitle","btnHideColumn","videosScrollable","groupCallTitle","groupCallDescription","groupCallBodyHeaderDescription","constructButtons","groupCallParticipants","updateInstance","setHasPinned","groupCallMicrophoneIcon","_makeButton","microphoneIcon","btnLeave","setDescription","microphoneButtonState","getGroupCallMicrophoneButtonState","micState","CallDescriptionElement","connectionState","connectedAt","GroupCallMicrophoneIconMini","INIT_STATE","PopupCall","resizeVideoContainers","videoContainers","interlocutorUserId","emojisSubtitle","partyStates","partyMutedState","stateText","constructFirstButtons","constructSecondButtons","wasTryingToJoin","movableElement","controlsHover","getCallInstance","firstButtonsRow","muteI18nElement","secondButtonsRow","declineI18nElement","btnDecline","btnAccept","acceptCall","createVideoContainer","isPendingIncoming","isSharingVideo","isSharingScreen","outputState","getMediaState","oldContainers","mediaState","getVideoElement","hasFrame","hasPromise","videoState","screencastState","videoContainer","output","getEmojisFingerprint","popupWidth","MAX_WIDTH_PX","MAX_HEIGHT_PX","isVertical","MAX_SIZE","biggestSideSize","widthRatio","heightRatio","TopbarCall","onState","amplitudes","weave","clearCurrentInstance","currentDescription","instanceListenerSetter","isChangingInstance","callDescription","convertCallStateToGroupState","groupCallMicrophoneIconMini","throttledMuteClick","weaveContainer","uiNotificationsManager","notificationsShown","notificationIndex","notificationsCount","soundsPlayed","vibrateSupport","faviconEl","titleBackup","titleChanged","stopped","pushInited","updateLocalSettings","updSettings","nodesktop","novibrate","nopreview","nopush","needPush","webPushApiManager","registeredDevice","nosound","requestPermission","Notification","mozVibrate","webkitVibrate","setAppBadge","notificationsUiSupport","notifySoundEl","topMessagesDeferred","toggleToggler","peerString","soundReset","unreadUnmutedPeerIds","tokenData","unregisterDevice","registerDevice","notificationData","custom","hasChat","hasUser","buildNotification","fwdCount","peerReaction","peerTypeNotifySettings","notification","getPeerString","notificationMessage","noIncrement","notificationFromPeerId","peerPhoto","loadAvatar","resetTitle","isBlink","setFavicon","titleInterval","fontSize","textBaseline","textAlign","prevFavicon","replaceChild","testSound","permission","appRuntimeManager","onclose","getLocalSettings","nextSoundAt","prevSoundVolume","filename","token_type","tokenType","tokenValue","other_uids","app_sandbox","secret","getFilesFromEvent","onlyTypes","scanFiles","isDirectory","directoryReader","createReader","readEntries","itemFile","getAsFile","DataTransferItem","DragEvent","dataTransfer","webkitGetAsEntry","AppImManager","columnEl","offline","updateStatusInterval","cacheStorage","saveState","parseUriParams","tgaddr","postId","openUsername","userName","setSettings","chatsSelectTabDebounced","toggleChatGradientAnimation","onDocumentPaste","attachType","newMediaPopup","_types","canDrag","backgroundPromises","IS_FIREFOX","updateStatus","emojiAnimationContainer","appendEmojiAnimationContainer","createNewChat","chatsSelectTab","compareVersion","deleteFilesIterative","applyCurrentTheme","resizeInstances","saveChatPosition","choosing","setChoosingStickerTyping","typing","onInstanceDeactivated","isUpdated","receiptMessage","onSpoilerClick","spoilerTimeout","stateStorage","topbarCall","discardCurrentCall","currentCall","setAuthorized","telegramMeWebManager","addAnchorListener","uriParams","hashtag","pathnameParams","STICKER_SET","INVOICE","protocol","makeLink","VOICE_CHAT","USER_PHONE_NUMBER","PRIVATE_POST","channel","thread","comment","MESSAGE","attachKeydownListener","timeoutOperation","requests","request","isBad","activatingChat","screen","IGNORE_KEYS","getFirstMessageToEdit","getNextDialog","newEvent","KeyboardEvent","commentId","resolveChannel","checkChatInvite","saveApiChat","resolvePhone","getInputInvoiceBySlug","openUrl","wrappedUrl","noPathnameParams","noUriParams","openComment","generateThreadServiceStartMessage","phone_calls_private","ignoreGroupCall","ignoreCall","discardGroupCallConfirmation","discardCallConfirmation","isClosing","getGroupCallFull","createGroupCall","setCurrentBackground","broadcastEvent","getBackground","getFile","lastBackgroundUrl","chatBubbles","chatPositions","backgroundUrl","prevTab","prevIdx","attachDragAndDropListeners","drops","mediaDrops","isFiles","_dropsContainer","mediaDropsContainer","dropsContainer","_drops","foundMedia","onImTabChange","updateMyOnlineStatus","spliceChats","fromIndex","chatFrom","chatTo","chatIndex","existingIndex","oldChat","getTypingElement","dot","eye","getPeerTyping","getPeerTypings","langPackKeys","multi","mapa","typingElement","descriptionElement","getChatStatus","typingEl","onlines","getOnlines","getUserStatus","ignoreSelf","getPeerStatus","useWhitespace","typingContainer","DialogColorsFg","DialogColors","DialogColorsMap","pic","useBytes","bestPhotoSize","CallConnectionInstanceBase","connection","sources","createPeerConnection","RTCPeerConnection","signalingState","iceConnectionState","createDataChannel","dataChannel","createDescription","appendStreamToConference","streamManager","appendToConference","closeConnection","closeConnectionAndStream","stopStream","negotiate","negotiating","negotiateInternal","sendDataChannelData","parseSignalingData","sdp","parseMediaSectionInfo","fingerprint","ufrag","pwd","convertNumber","isSending","codec","ssrc","sourceGroups","ssrcGroups","sourceGroup","semantics","ssrcs","rtpExtensions","payloadTypesMap","getPayloadType","payloadType","clockrate","feedbackTypes","subtype","parameters","payloadTypes","CallConnectionInstance","localDescription","remoteDescription","descriptionInit","offerReceived","createAnswer","setLocalDescription","offer","createOffer","offerSent","initialSetup","sendCallSignalingData","crypto","subtle","P2PEncryptor","p2pKey","seqMap","concatSHA256","bufferConcats","convertToUint8Array","encryptPrepared","msgKeyLarge","subarray","msgKey","aesKeyIv","prepareAesKeyIv","aesProcessCtr","encryptRawPacket","seq","ArrayBuffer","setUint32","sha256a","sha256b","iv","encryptedData","dataSize","encrypt","cryptoKey","constTimeIsDifferent","msgKeyEquals","decryptRawPacket","encryptedDataSize","decryptionBuffer","getUint32","ChromeP2PSdpBuilder","fingerprints","stringBuilder","streamName","addExtmap","addPayloadTypes","addSsrc","finalize","FirefoxP2PSdpBuilder","SafariP2PSdpBuilder","isFirefox","isSafari","extmap","j","fmtp","getOwnPropertyNames","pName","ssrcGroup","P2PSdpBuilder","sdpString","sdpMLineIndex","sdpMid","foundation","component","priority","relAddress","generation","tcpType","networkId","networkCost","candidate","generateOffer","generateAnswer","CallInstance","udp_p2p","udp_reflector","min_layer","max_layer","library_versions","createdAt","decryptQueue","candidates","canCreateConferenceEntry","setMediaState","sendMediaState","mediaStates","_sendMediaState","_connectionState","connectionInstance","sortIndex","findEntry","recvEntry","startScreenSharingInternal","wasStartingScreen","wasStartingVideo","requestScreen","stopVideoSharing","startVideoSharingInternal","requestInputSource","track","inputStream","getVideoTracks","stopTrack","isSharingVideoType","audioTrack","getAudioTracks","setHangUpTimeout","clearHangUpTimeout","hangUpTimeout","setPhoneCall","phoneCall","canAccept","overrideConnectionState","g_a_hash","appCallsManager","generateDh","dh","g_b","g_a","g_b_hash","getCallInput","phonePhoneCall","savePhonePhoneCall","joinCall","encryptionKey","configuration","iceServers","connections","ipv6","port","urls","turn","stun","credential","iceTransportPolicy","p2p_allowed","getRtcConfiguration","sendIceCandidate","onTrack","encryptor","decryptor","processDecryptQueue","createDataChannelEntry","dataChannelEntry","createEntry","sendEntry","negotiated","applyDataChannelData","TextEncoder","encode","iceCandidate","parsed","p2pParseCandidate","confirmCall","key_fingerprint","computeKey","emojisFingerprint","getEmojisFingerprintPromise","codePoints","unlockStreamManager","doTheMagic","getTransceivers","transceiver","getEntryByMid","bundle","sdpDescription","generateSdp","isAnswer","setRemoteDescription","onInputStream","stream","videoTrack","onMutedChange","requestAudioSource","setMuted","discardReason","discardedByOtherParty","hasVideo","discardCall","performCodec","_codec","setDataToDescription","setData","transport","screencast","filterNotVP8","vp8PayloadType","rtxIdx","apt","applyCallSignalingData","performSsrcGroups","getEntryBySource","sendRecvEntry","findFreeSendRecvEntry","setEntrySource","tryToReleaseCandidates","generateCandidate","RTCIceCandidate","addIceCandidate","decryptedData","TextDecoder","decode","signalingData","onUpdatePhoneCallSignalingData","getStreamCached","_cache","isScreen","constraints","getScreenStream","getStream","CallInstanceBase","fixSafariAudio","isSharingAudio","hasInputTrackKind","isAudioGood","isVideoGood","getAudioConstraints","getVideoConstraints","getScreenConstraints","endpoint","tryAddTrack","streams","saveInputVideoStream","isOutput","elementEndpoint","addTrack","useStream","outputStream","srcObject","sinkId","outputDeviceId","setSinkId","getTracks","addStream","CALL_STATE","audioAsset","CALL_REQUEST_TIMEOUT","CallsController","sortedInstances","createCallInstance","admin_id","g_a_or_b","bytesCmp","callId","getCallByUserId","hasConnected","hasCurrent","startCallInternal","fullInfo","participant_id","requestCall","GROUP_CALL_AMPLITUDE_ANALYSE_COUNT_MAX","GROUP_CALL_AMPLITUDE_ANALYSE_INTERVAL_MS","GroupCallConnectionInstance","negotiateThrottled","bundlePolicy","rtcpMuxPolicy","iceCandidatePoolSize","maybeUpdateRemoteVideoConstraints","updateConstraintsInterval","invokeJoinGroupCall","localSdp","mainChannels","processedChannels","sectionInfo","payload","processMediaSection","audioChannel","videoChannel","useChannel","setEntryPeerId","performExtmap","filterServerCodecs","isNewConnection","originalOffer","iceRestart","hasMunged","skipAddingMulticast","mediaLine","mediaLineParts","localMLine","codecIds","newData","setPort","setSource","newSdp","addSsrcEntry","newChannel","mungedSdp","fixLocalOffer","entriesToDelete","shouldBeSkipped","answerDescription","deleteEntry","iceGatheringState","updateConstraints","sender","setParameters","getParameters","degradationPreference","colibriClass","defaultConstraints","onStageEndpoints","addInputVideoStream","GroupCallInstance","isSpeakingMap","pinnedSources","participantsSsrcs","hadAutoPinnedSources","dispatchPinnedThrottled","getCachedParticipants","presentation","unpinSource","changeUserMuted","source_groups","clone","createConnectionInstance","raise","raiseHand","stopScreenSharing","startScreenSharing","startScreenSharingPromise","saveApiParticipant","leaveGroupCallPresentation","videoPaused","videoStopped","startVideoSharing","startVideoSharingPromise","rejoin","isDiscarded","isUpdatingMeInCurrentCall","onParticipantUpdate","doNotDispatchParticipantUpdate","hasLeft","oldSsrcs","modifiedTypes","oldSsrc","oldSource","oldEntry","originalDirection","setEndpoint","createTransceiver","GROUP_CALL_STATE","makeSsrcsFromParticipant","makeSsrcFromParticipant","audio_source","generateSelfVideo","audioSource","GroupCallsController","setCurrentGroupCall","startConnectingSound","stopConnectingSound","joinVideo","MediaStream","createMainStreamManager","joinGroupCallInternal","handleUpdateGroupCallParticipants","updatingSdp","channelCount","constraint","mediaDevices","getSupportedConstraints","constraintSupported","skipAudio","frameRate","screenStream","getDisplayMedia","contentHint","getUserMedia","clientInfo","lookupAttributeKeys","telegramSourceGroups","sdpLines","rest","parseSourceGroups","raw","ConferenceEntry","addTransceiver","generateSsrc","LocalConferenceDescription","sessionId","maxSeenId","entriesByMid","entriesBySource","entriesByPeerId","getEntriesByPeerId","conference","SDP","mediaSections","splitStringByLimitWithRest","UniqueNumberGenerator","generate","maxTries","_try","SDPAttributeSplitted","SDPMediaLineParts","SDPLine","SDPAttributeInner","missed","exists","nestedMap","makeAttributes","innerParts","SDPAttributes","fillAttributes","attributesMap","linesArray","SDPMediaSection","isReceiving","resultShouldBeArray","SDPSessionSection","parseSdp","createSection","sessionSection","lineStr","isIncorrectSdpLine","parseSdpLine","addSimulcast","generator","originalSsrcs","ssrcs2","ssrcsStrLines","ssrc2","WEBRTC_MEDIA_PORT","fixMediaLineType","getConnectionTypeForMediaType","generateMediaFirstLine","payloadIds","connectionType","SDPBuilder","addCandidate","performCandidate","addHeader","sId","bundleMids","addTransport","skipCandidates","addSource","addMsid","isApplication","isInactive","hdrexts","hdrext","fbs","fb","addConference","AudioStreamAnalyser","streamSource","createMediaStreamSource","gain","createGain","minDecibels","maxDecibels","smoothingTimeConstant","StreamManager","getAmplitude","streamAnalyser","analyse","ANALYSER_LISTENER","AudioContext","webkitAudioContext","getSource","itemSource","removeTrack","finalizeAddingTrack","changeTimer","substring","replaceInputAudio","oldTrack","timer","transceiverInit","tracks","mediaTrackType","trackIdx","replaceTrack","StringFromLineBuilder","newLine","addJoined","toTelegramSource","fromTelegramSource","rms","onlyFirst","E","wrappingDraft","messageEntityTextUrl","messageEntityMentionName","isDraft","setBlankToAnchor","EMOJI_VERSIONS_SUPPORTED","inlineEl","newEmojiWidth","legacyEmojiWidth","isEmojiSupported","setDimensionsFromRect","CustomEmojiElement","CustomEmojiRendererElement","clearedContainers","lotties","clearRenderInterval","getOffsets","offsetsMap","clearCanvas","topFrames","isImageData","ImageData","stickerWidth","stickerHeight","checkForAnyFrame","setDimensions","renderInterval","rerere","nasty","usedLength","customEmojis","contextSite","contextExternal","lastEntity","nextEntity","endPartOffset","fullEntityText","partText","usedText","fontStyle","styleName","fontFamily","atPos","fromBot","encodeURIComponent","document_id","isSupported","masked","currentContext","electronHelpers","contextUrl","encoded","encodeSpoiler","entityText","voodoo","docIds","renderer","getCachedCustomEmojiDocuments","wrap","_loadPromises","isLottie","middlewares","playerCanvas","overrideRender","missing","cachedPromises","uncachedPromisesPromise","getCustomEmojiDocuments","loadFromPromises","uncached","QueryableWorker","worker","terminate","onmessage","queryMethodListener","queryMethodArguments","postMessage","sendQuery","transfer","queryMethod","workersLimit","playersByCacheName","workers","curWorkerNum","onPlayerLoaded","reqId","fps","clamped","onPlayerError","getAnimation","setLoop","_autoplay","loadLottieWorkers","remain","Worker","queryableWorker","loadAnimationAsAsset","loadAnimationFromURL","blobConstruct","newParams","loadAnimationWorker","waitForFirstFrame","cacheName","initPlayer","onDestroy","destroyWorkers","loadFromData","RLottieCache","framesNew","framesURLs","getCache","createCache","releaseCache","getCacheCounter","generateName","RLottiePlayer","cachingDelta","skipDelta","contexts","setMainLoop","clearPendingRAF","rafId","resetCurrentFrame","minFrame","renderFirstFrame","requestFrame","applyInversing","renderFrame2","cachedSource","renderedFirstFrame","ImageBitmap","frInterval","frThen","frameNew","onLap","mainLoopForwards","mainLoopBackwards","currentMethod","frameListener","listenerResults","enterFrame","playToFrame","bounds","setMinMax","playToFrameOnFrameCallback","setInverseColor","CACHE","pagesManager","pageId","pagesDiv","scrollableDiv","page","onShown","setPage","isAuthPage","Page","onFirstMount","onMount","installed","encodeEmoji","emojiText","toCodePoints","removeVS16s","vs16RegExp","zeroWidthJoiner","rawEmoji","unicodeSurrogates","points","getEmojiToneIndex","getCountryEmoji","emojiFromCodePoints","fromCodePoint","module","exports","defineProperty","enumerable","Symbol","toStringTag","__esModule","create","prototype","isRecordingSupported","bufferLength","encoderApplication","encoderFrameSize","encoderPath","maxFramesPerPage","mediaTrackConstraints","resampleQuality","streamPages","wavBitDepth","encodedSamplePosition","WebAssembly","clearStream","audioContext","closeAudioContext","encodeBuffers","getChannelData","encoder","buffers","initAudioContext","initAudioGraph","scriptProcessorNode","createScriptProcessor","destination","onaudioprocess","inputBuffer","monitorGainNode","setMonitorGain","recordingGainNode","setRecordingGain","initSourceNode","loadWorker","initWorker","streamPage","storePage","recordedPages","samplePosition","originalSampleRate","sampleRate","wavSampleRate","onpause","resume","onresume","setTargetAtTime","onstart","destroyWorker","Function"],"sourceRoot":""}