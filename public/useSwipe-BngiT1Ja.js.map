{"version":3,"file":"useSwipe-BngiT1Ja.js","sources":["../src/helpers/useGlobalDocumentEvent.ts","../src/helpers/useSwipe.ts"],"sourcesContent":["import {onCleanup} from 'solid-js';\n\ntype PossibleEvent = DocumentEventMap[keyof DocumentEventMap];\n\ntype EventsMapValue = {\n  callbacks: Array<(e: PossibleEvent) => void>;\n  listener: (e: PossibleEvent) => void;\n};\n\nconst eventsMap = new Map<keyof DocumentEventMap, EventsMapValue>;\n\nexport function registerGlobalDocumentEvent<Key extends keyof DocumentEventMap>(eventName: Key, callback: (e: DocumentEventMap[Key]) => void) {\n  const value: EventsMapValue = eventsMap.get(eventName) || {\n    callbacks: [],\n    listener: (e) => {\n      value.callbacks.forEach(clb => clb(e));\n    }\n  };\n\n  if(!eventsMap.has(eventName)) {\n    eventsMap.set(eventName, value);\n    document.addEventListener(eventName, value.listener);\n  }\n\n  value.callbacks.push(callback as (e: PossibleEvent) => void);\n\n  return {\n    cleanup: () => {\n      value.callbacks = value.callbacks.filter(clb => clb !== callback);\n      if(value.callbacks.length) return;\n\n      eventsMap.delete(eventName);\n      document.removeEventListener(eventName, value.listener);\n    }\n  }\n}\n\nexport default function useGlobalDocumentEvent<Key extends keyof DocumentEventMap>(eventName: Key, callback: (e: DocumentEventMap[Key]) => void) {\n  const {cleanup} = registerGlobalDocumentEvent(eventName, callback);\n\n  onCleanup(cleanup);\n};\n","import {StandardLonghandPropertiesHyphen} from 'csstype';\nimport {Accessor} from 'solid-js';\nimport useGlobalDocumentEvent from '@helpers/useGlobalDocumentEvent';\nimport {requestRAF} from '@helpers/solid/requestRAF';\nimport {useIsCleaned} from '@hooks/useIsCleaned';\n\n\nexport type SwipeDirectiveArgs = {\n  globalCursor?: Accessor<StandardLonghandPropertiesHyphen['cursor']>;\n  onStart?: (e: PointerEvent | TouchEvent) => void;\n  onMove?: (xDiff: number, yDiff: number, e: PointerEvent | TouchEvent) => void;\n  onEnd?: (xDiff: number, yDiff: number, e: PointerEvent | TouchEvent) => void;\n};\n\ndeclare module 'solid-js' {\n  namespace JSX {\n    interface Directives {\n      swipe: SwipeDirectiveArgs;\n    }\n  }\n}\n\nexport default function swipe(element: HTMLElement, args: Accessor<SwipeDirectiveArgs>) {\n  const isCleaned = useIsCleaned();\n\n  let isDragging = false;\n  let initialX: number, initialY: number;\n\n  const getDiffPointer = (e: PointerEvent) => [\n    e.clientX - initialX,\n    e.clientY - initialY\n  ] as const;\n\n  const getDiffTouch = (e: TouchEvent) => [\n    e.changedTouches[0].clientX - initialX,\n    e.changedTouches[0].clientY - initialY\n  ] as const;\n\n  function handleStart(e: PointerEvent | TouchEvent, x: number, y: number) {\n    if(isDragging) return;\n    isDragging = true;\n    initialX = x;\n    initialY = y;\n\n    const {onStart, globalCursor} = args();\n    onStart?.(e);\n\n    if(globalCursor) {\n      document.body.style.setProperty('cursor', globalCursor(), 'important');\n      element.style.setProperty('cursor', globalCursor(), 'important');\n    }\n  }\n\n  let isRAFing = false;\n  let callback: () => void;\n\n  function handleMove(e: PointerEvent | TouchEvent, diff: readonly [number, number]) {\n    if(!isDragging) return;\n\n    callback = () => {\n      const {onMove} = args();\n      onMove?.(...diff, e);\n    };\n\n    if(isRAFing) return;\n\n    isRAFing = true;\n    requestRAF(() => {\n      isRAFing = false;\n      if(!isDragging || isCleaned()) return;\n\n      callback();\n    })\n  }\n\n  function handleEnd(e: PointerEvent | TouchEvent, diff: readonly [number, number]) {\n    if(!isDragging) return;\n\n    const {onEnd, globalCursor} = args();\n    onEnd?.(...diff, e);\n    if(globalCursor) {\n      document.body.style.removeProperty('cursor');\n      element.style.removeProperty('cursor');\n    }\n\n    isDragging = false;\n    isRAFing = false;\n    initialX = initialY = undefined;\n  }\n\n  element.addEventListener('pointerdown', (e) => {\n    handleStart(e, e.clientX, e.clientY);\n  });\n\n  element.addEventListener('touchstart', (e) => {\n    handleStart(e, e.changedTouches[0].clientX, e.changedTouches[0].clientY);\n  });\n\n  useGlobalDocumentEvent('pointermove', (e) => {\n    handleMove(e, getDiffPointer(e));\n  });\n\n  useGlobalDocumentEvent('touchmove', (e) => {\n    handleMove(e, getDiffTouch(e));\n  });\n\n  useGlobalDocumentEvent('pointermove', (e) => {\n    handleMove(e, getDiffPointer(e));\n  });\n\n  useGlobalDocumentEvent('pointerup', (e) => {\n    handleEnd(e, getDiffPointer(e));\n  });\n\n  useGlobalDocumentEvent('touchend', (e) => {\n    handleEnd(e, getDiffTouch(e));\n  });\n}\n"],"names":["eventsMap","registerGlobalDocumentEvent","eventName","callback","value","e","clb","useGlobalDocumentEvent","cleanup","onCleanup","swipe","element","args","isCleaned","useIsCleaned","isDragging","initialX","initialY","getDiffPointer","getDiffTouch","handleStart","x","y","onStart","globalCursor","isRAFing","handleMove","diff","onMove","requestRAF","handleEnd","onEnd"],"mappings":"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"}