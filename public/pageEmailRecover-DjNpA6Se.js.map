{"version":3,"mappings":";qmBAsBA,IAAIA,EACAC,EACAC,EACAC,EAEJ,MAAMC,EAAU,IAAM,CACpB,WAAW,IAAM,CACfD,GAAQ,OAAO,EACfF,GAAgB,QAAQ,GACvB,GAAG,CACR,EAEMI,EAAe,IAAM,CACnBC,QAAO,IAAIC,EAAU,CACzB,UAAW,oBACX,iBAAkB,GAClB,aAAc,4BACf,EAEKC,EAAOC,EAAW,SAAW,IAAM,IACzCC,EAAa,qBAAqB,CAChC,UAAWJ,EAAK,SAChB,KAAM,GACN,SAAU,GACV,MAAOE,EACP,OAAQA,CACP,WAAS,EAAE,KAAMG,IACTR,EAAAQ,EACFD,EAAa,kBAAkBC,CAAS,EAChD,EAEmBX,MAAA,IAAIY,EAAK,aAC7BN,EAAK,SAAS,YAAYN,EAAgB,OAAO,EAEjDC,EAAiB,IAAIY,EAAqB,CACxC,OAAQ,EACR,SAAU,IAAM,CACdZ,EAAe,MAAQ,GACvBa,EAAeZ,EAAqB,EAAE,CACxC,EACA,OAASa,GAAS,CAChBC,EAAU,SAAS,gBAAgB,0BAA0BD,CAAI,EAAE,KAAME,GAAQ,CAC/EC,EAAA,WAAO,sBAAU,8CAAE,KAAMC,GAAM,CAC7BA,EAAE,QAAQ,OAAM,CACjB,EACOf,GAAA,CACT,EAAE,MAAOgB,GAAkB,CAC1BnB,EAAe,MAAQ,GACvBA,EAAe,MAAQ,GAEpBmB,EAAI,OAAS,eACCN,EAAAZ,EAAqBmB,EAAK,oBAAoB,CAAC,GAEtD,YAAI,QAASD,CAAG,EACTN,EAAAZ,EAAqBmB,EAAK,eAAe,CAAC,EAC3D,CACD,CACH,EACD,EACqBnB,EAAA,SAAS,cAAc,KAAK,EAC9BA,EAAA,UAAU,IAAI,aAAa,EAEzC,MAAAoB,EAAYC,EAAO,2DAA2D,EAC1ED,EAAA,OAAOD,EAAK,4BAA4B,CAAC,EACnDG,EAAiBF,EAAW,IAAM,CAChCG,EAAa,MAAM,EACpB,EAEDnB,EAAK,aAAa,OAAOL,EAAe,UAAWC,EAAqBoB,CAAS,CACnF,EAGMhB,EAAO,IAAIoB,EAAK,oBAAqB,GAAMrB,EAAesB,GAAmC,CAC7E3B,MAAA,IAAIY,EAAK,aAC7BZ,EAAgB,OAAO,CACrB,IAAK,+BACL,KAAM,CAAC4B,EAAiBD,EAAS,aAAa,CAAC,EAChD,CACH,EAAG,IAAM,CACPxB,GAAQ,cAAc,EACtB0B,EAAQ,IAAM,CACZ5B,GAAgB,MAAM,OAAM,CAC7B,CACH,CAAC","names":["subtitleElement","codeInputField","codeInputErrorLabel","player","cleanup","onFirstMount","page","LoginPage","size","mediaSizes","lottieLoader","animation","I18n","CodeInputFieldCompat","replaceContent","code","rootScope","res","__vitePreload","m","err","i18n","cancelBtn","Button","attachClickEvent","pagePassword","Page","sentCode","wrapEmailPattern","fastRaf"],"ignoreList":[],"sources":["../src/pages/pageEmailRecover.ts"],"sourcesContent":["/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport {AccountSentEmailCode} from '@layer';\nimport Page from '@/pages/page';\nimport CodeInputFieldCompat from '@components/codeInputField';\nimport I18n, {i18n} from '@lib/langPack';\nimport replaceContent from '@helpers/dom/replaceContent';\nimport rootScope from '@lib/rootScope';\nimport lottieLoader from '@lib/rlottie/lottieLoader';\nimport RLottiePlayer from '@lib/rlottie/rlottiePlayer';\nimport {attachClickEvent} from '@helpers/dom/clickEvent';\nimport {fastRaf} from '@helpers/schedulers';\nimport {wrapEmailPattern} from '@components/popups/emailSetup';\nimport mediaSizes from '@helpers/mediaSizes';\nimport LoginPage from '@/pages/loginPage';\nimport Button from '@components/button';\nimport pagePassword from '@/pages/pagePassword';\n\nlet subtitleElement: I18n.IntlElement;\nlet codeInputField: CodeInputFieldCompat;\nlet codeInputErrorLabel: HTMLElement;\nlet player: RLottiePlayer;\n\nconst cleanup = () => {\n  setTimeout(() => {\n    player?.remove();\n    codeInputField?.cleanup()\n  }, 300);\n};\n\nconst onFirstMount = () => {\n  const page = new LoginPage({\n    className: 'page-emailRecover',\n    withInputWrapper: true,\n    titleLangKey: 'Login.ResetPassword.Title'\n  });\n\n  const size = mediaSizes.isMobile ? 100 : 166;\n  lottieLoader.loadAnimationAsAsset({\n    container: page.imageDiv,\n    loop: false,\n    autoplay: true,\n    width: size,\n    height: size\n  }, 'Mailbox').then((animation) => {\n    player = animation;\n    return lottieLoader.waitForFirstFrame(animation);\n  })\n\n  subtitleElement ??= new I18n.IntlElement();\n  page.subtitle.appendChild(subtitleElement.element);\n\n  codeInputField = new CodeInputFieldCompat({\n    length: 6,\n    onChange: () => {\n      codeInputField.error = false;\n      replaceContent(codeInputErrorLabel, '');\n    },\n    onFill: (code) => {\n      rootScope.managers.passwordManager.confirmPasswordResetEmail(code).then((res) => {\n        import('./pageIm').then((m) => {\n          m.default.mount();\n        });\n        cleanup();\n      }).catch((err: ApiError) => {\n        codeInputField.error = true;\n        codeInputField.value = '';\n\n        if(err.type === 'CODE_INVALID') {\n          replaceContent(codeInputErrorLabel, i18n('PHONE_CODE_INVALID'));\n        } else {\n          console.log('error', err);\n          replaceContent(codeInputErrorLabel, i18n('Error.AnError'));\n        }\n      });\n    }\n  });\n  codeInputErrorLabel = document.createElement('div');\n  codeInputErrorLabel.classList.add('error-label');\n\n  const cancelBtn = Button('btn-primary btn-secondary btn-primary-transparent primary');\n  cancelBtn.append(i18n('Login.ResetPassword.Cancel'));\n  attachClickEvent(cancelBtn, () => {\n    pagePassword.mount()\n  });\n\n  page.inputWrapper.append(codeInputField.container, codeInputErrorLabel, cancelBtn);\n};\n\n\nconst page = new Page('page-emailRecover', true, onFirstMount, (sentCode: AccountSentEmailCode) => {\n  subtitleElement ??= new I18n.IntlElement();\n  subtitleElement.update({\n    key: 'Login.ResetPassword.Subtitle',\n    args: [wrapEmailPattern(sentCode.email_pattern)]\n  })\n}, () => {\n  player?.playOrRestart();\n  fastRaf(() => {\n    codeInputField?.input.focus();\n  })\n});\n\nexport default page;\n"],"file":"pageEmailRecover-DjNpA6Se.js"}