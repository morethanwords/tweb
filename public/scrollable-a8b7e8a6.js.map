{"version":3,"file":"scrollable-a8b7e8a6.js","sources":["../src/components/scrollable.ts"],"sourcesContent":["/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport IS_TOUCH_SUPPORTED from '../environment/touchSupport';\r\nimport {logger, LogTypes} from '../lib/logger';\r\nimport fastSmoothScroll, {ScrollOptions} from '../helpers/fastSmoothScroll';\r\nimport useHeavyAnimationCheck from '../hooks/useHeavyAnimationCheck';\r\nimport cancelEvent from '../helpers/dom/cancelEvent';\r\nimport {IS_OVERLAY_SCROLL_SUPPORTED} from '../environment/overlayScrollSupport';\r\nimport {IS_MOBILE_SAFARI, IS_SAFARI} from '../environment/userAgent';\r\n/*\r\nvar el = $0;\r\nvar height = 0;\r\nvar checkUp = false;\r\n\r\ndo {\r\n  height += el.scrollHeight;\r\n} while(el = (checkUp ? el.previousElementSibling : el.nextElementSibling));\r\nconsole.log(height);\r\n*/\r\n\r\n/*\r\nArray.from($0.querySelectorAll('.bubble-content')).forEach((_el) => {\r\n  //_el.style.display = '';\r\n  //return;\r\n\r\n  let el = _el.parentElement;\r\n  let height = el.scrollHeight;\r\n  let width = el.scrollWidth;\r\n  el.style.width = width + 'px';\r\n  el.style.height = height + 'px';\r\n  _el.style.display = 'none';\r\n});\r\n*/\r\n\r\n/* const scrollables: Map<HTMLElement, Scrollable> = new Map();\r\nconst scrollsIntersector = new IntersectionObserver((entries) => {\r\n  for(let entry of entries) {\r\n    const scrollable = scrollables.get(entry.target as HTMLElement);\r\n\r\n    if(entry.isIntersecting) {\r\n      scrollable.isVisible = true;\r\n    } else {\r\n      scrollable.isVisible = false;\r\n\r\n      if(!isInDOM(entry.target)) {\r\n        scrollsIntersector.unobserve(scrollable.container);\r\n        scrollables.delete(scrollable.container);\r\n      }\r\n    }\r\n  }\r\n}); */\r\n\r\nconst SCROLL_THROTTLE = /* IS_ANDROID ? 200 :  */24;\r\nconst USE_OWN_SCROLL = !IS_OVERLAY_SCROLL_SUPPORTED;\r\n\r\nlet throttleMeasurement: (callback: () => void) => number,\r\n  cancelMeasurement: (id: number) => void;\r\nif(USE_OWN_SCROLL) {\r\n  throttleMeasurement = (callback) => requestAnimationFrame(callback);\r\n  cancelMeasurement = (id) => cancelAnimationFrame(id);\r\n} else {\r\n  throttleMeasurement = (callback) => window.setTimeout(callback, SCROLL_THROTTLE);\r\n  cancelMeasurement = (id) => window.clearTimeout(id);\r\n}\r\n\r\nexport class ScrollableBase {\r\n  protected log: ReturnType<typeof logger>;\r\n\r\n  public padding: HTMLElement;\r\n  public splitUp: HTMLElement;\r\n  public onScrollMeasure: number = 0;\r\n\r\n  public lastScrollPosition: number = 0;\r\n  public lastScrollDirection: number = 0;\r\n\r\n  public onAdditionalScroll: () => void;\r\n  public onScrolledTop: () => void;\r\n  public onScrolledBottom: () => void;\r\n\r\n  public isHeavyAnimationInProgress = false;\r\n  protected needCheckAfterAnimation = false;\r\n\r\n  public checkForTriggers?: () => void;\r\n\r\n  public scrollPositionProperty: 'scrollTop' | 'scrollLeft';\r\n  public scrollSizeProperty: 'scrollHeight' | 'scrollWidth';\r\n  public clientSizeProperty: 'clientHeight' | 'clientWidth';\r\n  public offsetSizeProperty: 'offsetHeight' | 'offsetWidth';\r\n  public clientAxis: 'clientY' | 'clientX';\r\n\r\n  protected startMousePosition: number;\r\n  protected startScrollPosition: number;\r\n\r\n  protected thumb: HTMLElement;\r\n  protected thumbContainer: HTMLElement;\r\n\r\n  protected removeHeavyAnimationListener: () => void;\r\n  protected addedScrollListener: boolean;\r\n\r\n  constructor(\r\n    public el?: HTMLElement,\r\n    logPrefix = '',\r\n    public container: HTMLElement = document.createElement('div')\r\n  ) {\r\n    this.container.classList.add('scrollable');\r\n\r\n    this.log = logger('SCROLL' + (logPrefix ? '-' + logPrefix : ''), LogTypes.Error);\r\n\r\n    if(el) {\r\n      Array.from(el.children).forEach((c) => this.container.append(c));\r\n\r\n      el.append(this.container);\r\n    }\r\n\r\n    // this.onScroll();\r\n  }\r\n\r\n  public addScrollListener() {\r\n    if(this.addedScrollListener) {\r\n      return;\r\n    }\r\n\r\n    this.addedScrollListener = true;\r\n    this.container.addEventListener('scroll', this.onScroll, {passive: true, capture: true});\r\n  }\r\n\r\n  public removeScrollListener() {\r\n    if(!this.addedScrollListener) {\r\n      return;\r\n    }\r\n\r\n    this.addedScrollListener = false;\r\n    this.container.removeEventListener('scroll', this.onScroll, {capture: true});\r\n  }\r\n\r\n  public setListeners() {\r\n    if(this.removeHeavyAnimationListener) {\r\n      return;\r\n    }\r\n\r\n    window.addEventListener('resize', this.onScroll, {passive: true});\r\n    this.addScrollListener();\r\n\r\n    this.removeHeavyAnimationListener = useHeavyAnimationCheck(() => {\r\n      this.isHeavyAnimationInProgress = true;\r\n\r\n      if(this.onScrollMeasure) {\r\n        this.cancelMeasure();\r\n        this.needCheckAfterAnimation = true;\r\n      }\r\n    }, () => {\r\n      this.isHeavyAnimationInProgress = false;\r\n\r\n      if(this.needCheckAfterAnimation) {\r\n        this.onScroll();\r\n        this.needCheckAfterAnimation = false;\r\n      }\r\n    });\r\n  }\r\n\r\n  public removeListeners() {\r\n    if(!this.removeHeavyAnimationListener) {\r\n      return;\r\n    }\r\n\r\n    window.removeEventListener('resize', this.onScroll);\r\n    if(this.thumb) {\r\n      this.thumb.removeEventListener('mousedown', this.onMouseMove);\r\n      window.removeEventListener('mousemove', this.onMouseMove);\r\n      window.removeEventListener('mouseup', this.onMouseUp);\r\n    }\r\n    this.removeScrollListener();\r\n\r\n    this.removeHeavyAnimationListener();\r\n    this.removeHeavyAnimationListener = undefined;\r\n  }\r\n\r\n  public destroy() {\r\n    this.removeListeners();\r\n    this.onAdditionalScroll = undefined;\r\n    this.onScrolledTop = undefined;\r\n    this.onScrolledBottom = undefined;\r\n  }\r\n\r\n  public prepend(...elements: (string | Node)[]) {\r\n    const prependTo = this.splitUp || this.padding || this.container;\r\n    this.thumb && prependTo !== this.container && elements.unshift(this.thumbContainer);\r\n    prependTo.prepend(...elements);\r\n    this.onSizeChange();\r\n  }\r\n\r\n  public append(...elements: (string | Node)[]) {\r\n    (this.splitUp || this.padding || this.container).append(...elements);\r\n    this.onSizeChange();\r\n  }\r\n\r\n  public scrollIntoViewNew(options: Omit<ScrollOptions, 'container'>) {\r\n    // return Promise.resolve();\r\n    // this.removeListeners();\r\n    return fastSmoothScroll({\r\n      ...options,\r\n      container: this.container\r\n    });/* .finally(() => {\r\n      this.setListeners();\r\n    }); */\r\n  }\r\n\r\n  public onScroll = () => {\r\n    // if(this.debug) {\r\n    // this.log('onScroll call', this.onScrollMeasure);\r\n    // }\r\n\r\n    // return;\r\n\r\n    if(this.isHeavyAnimationInProgress) {\r\n      this.cancelMeasure();\r\n      this.needCheckAfterAnimation = true;\r\n      return;\r\n    }\r\n\r\n    // if(this.onScrollMeasure || ((this.scrollLocked || (!this.onScrolledTop && !this.onScrolledBottom)) && !this.splitUp && !this.onAdditionalScroll)) return;\r\n    if((!this.onScrolledTop && !this.onScrolledBottom) && !this.splitUp && !this.onAdditionalScroll) return;\r\n    if(this.onScrollMeasure) return;\r\n    this.onScrollMeasure = throttleMeasurement(() => {\r\n      this.onScrollMeasure = 0;\r\n\r\n      const scrollPosition = this.scrollPosition;\r\n      this.lastScrollDirection = this.lastScrollPosition === scrollPosition ? 0 : (this.lastScrollPosition < scrollPosition ? 1 : -1); // * 1 - bottom, -1 - top\r\n      this.lastScrollPosition = scrollPosition;\r\n\r\n      this.updateThumb(scrollPosition);\r\n\r\n      // lastScrollDirection check is useless here, every callback should decide on its own\r\n      if(this.onAdditionalScroll/*  && this.lastScrollDirection !== 0 */) {\r\n        this.onAdditionalScroll();\r\n      }\r\n\r\n      if(this.checkForTriggers) {\r\n        this.checkForTriggers();\r\n      }\r\n    });\r\n  };\r\n\r\n  public updateThumb(scrollPosition = this.scrollPosition) {\r\n    if(!USE_OWN_SCROLL || !this.thumb) {\r\n      return;\r\n    }\r\n\r\n    const scrollSize = this.container[this.scrollSizeProperty];\r\n    const clientSize = this.container[this.clientSizeProperty];\r\n    const divider = scrollSize / clientSize / 0.75;\r\n    const thumbSize = Math.max(20, clientSize / divider);\r\n    const value = scrollPosition / (scrollSize - clientSize) * clientSize;\r\n    // const b = (scrollPosition + clientSize) / scrollSize;\r\n    const b = scrollPosition / (scrollSize - clientSize);\r\n    const maxValue = clientSize - thumbSize;\r\n    if(clientSize < scrollSize) {\r\n      this.thumb.style.height = thumbSize + 'px';\r\n      this.thumb.style.transform = `translateY(${Math.min(maxValue, value - thumbSize * b)}px)`;\r\n    } else {\r\n      this.thumb.style.height = '0px';\r\n    }\r\n  }\r\n\r\n  public cancelMeasure() {\r\n    if(this.onScrollMeasure) {\r\n      cancelMeasurement(this.onScrollMeasure);\r\n      this.onScrollMeasure = 0;\r\n    }\r\n  }\r\n\r\n  protected onMouseMove = (e: MouseEvent) => {\r\n    cancelEvent(e);\r\n\r\n    const contentHeight = this.scrollSize;\r\n    const viewportHeight = this.clientSize;\r\n    const scrollbarSize = this.thumb.offsetHeight;\r\n    const maxScrollTop = contentHeight - viewportHeight;\r\n\r\n    const maxScrollbarOffset = viewportHeight - scrollbarSize;\r\n    const deltaY = e[this.clientAxis] - this.startMousePosition;\r\n    const scrollAmount = (deltaY / maxScrollbarOffset) * maxScrollTop;\r\n    const newScrollTop = this.startScrollPosition + scrollAmount;\r\n\r\n    this.scrollPosition = newScrollTop;\r\n  };\r\n\r\n  protected onMouseDown = (e: MouseEvent) => {\r\n    cancelEvent(e);\r\n    this.startMousePosition = e[this.clientAxis];\r\n    this.startScrollPosition = this.scrollPosition;\r\n    this.thumb.classList.add('is-focused');\r\n\r\n    window.addEventListener('mousemove', this.onMouseMove);\r\n    window.addEventListener('mouseup', this.onMouseUp, {once: true});\r\n  };\r\n\r\n  protected onMouseUp = (e: MouseEvent) => {\r\n    window.removeEventListener('mousemove', this.onMouseMove);\r\n    this.thumb.classList.remove('is-focused');\r\n  };\r\n\r\n  public onSizeChange() {\r\n    if(USE_OWN_SCROLL && this.thumb) {\r\n      this.onScroll();\r\n    }\r\n  }\r\n\r\n  public getDistanceToEnd() {\r\n    return this.scrollSize - Math.round(this.scrollPosition + this.offsetSize);\r\n  }\r\n\r\n  get isScrolledToEnd() {\r\n    return this.getDistanceToEnd() <= 1;\r\n  }\r\n\r\n  get scrollPosition() {\r\n    return this.container[this.scrollPositionProperty];\r\n  }\r\n\r\n  set scrollPosition(value: number) {\r\n    this.container[this.scrollPositionProperty] = value;\r\n  }\r\n\r\n  get scrollSize() {\r\n    return this.container[this.scrollSizeProperty];\r\n  }\r\n\r\n  get clientSize() {\r\n    return this.container[this.clientSizeProperty];\r\n  }\r\n\r\n  get offsetSize() {\r\n    return this.container[this.offsetSizeProperty];\r\n  }\r\n\r\n  get firstElementChild() {\r\n    return this.thumb ? this.thumbContainer.nextElementSibling : this.container.firstElementChild;\r\n  }\r\n\r\n  public setScrollPositionSilently(value: number) {\r\n    this.lastScrollPosition = value;\r\n    this.ignoreNextScrollEvent();\r\n\r\n    this.scrollPosition = value;\r\n  }\r\n\r\n  public ignoreNextScrollEvent() {\r\n    if(this.removeHeavyAnimationListener) {\r\n      this.removeScrollListener();\r\n      this.container.addEventListener('scroll', (e) => {\r\n        cancelEvent(e);\r\n        this.addScrollListener();\r\n      }, {capture: true, passive: false, once: true});\r\n    }\r\n  }\r\n\r\n  public replaceChildren(...args: (string | Node)[]) {\r\n    this.thumb && args.unshift(this.thumbContainer);\r\n    this.container.replaceChildren(...args);\r\n  }\r\n}\r\n\r\nexport type SliceSides = 'top' | 'bottom';\r\nexport type SliceSidesContainer = {[k in SliceSides]: boolean};\r\n\r\nexport default class Scrollable extends ScrollableBase {\r\n  public loadedAll: SliceSidesContainer = {top: true, bottom: false};\r\n\r\n  constructor(\r\n    el?: HTMLElement,\r\n    logPrefix = '',\r\n    public onScrollOffset = 300,\r\n    withPaddingContainer?: boolean\r\n  ) {\r\n    super(el, logPrefix);\r\n\r\n    // withPaddingContainer = true;\r\n    // if(withPaddingContainer) {\r\n    //   this.padding = document.createElement('div');\r\n    //   this.padding.classList.add('scrollable-padding');\r\n    //   this.padding.append(...Array.from(this.container.children));\r\n    //   this.container.append(this.padding);\r\n    // }\r\n\r\n    this.scrollPositionProperty = 'scrollTop';\r\n    this.scrollSizeProperty = 'scrollHeight';\r\n    this.clientSizeProperty = 'clientHeight';\r\n    this.offsetSizeProperty = 'offsetHeight';\r\n    this.clientAxis = 'clientY';\r\n\r\n    if(USE_OWN_SCROLL) {\r\n      this.thumbContainer = document.createElement('div');\r\n      this.thumbContainer.classList.add('scrollable-thumb-container');\r\n      this.thumb = document.createElement('div');\r\n      this.thumb.classList.add('scrollable-thumb');\r\n      this.thumbContainer.append(this.thumb);\r\n      this.container.prepend(this.thumbContainer);\r\n\r\n      this.thumb.addEventListener('mousedown', this.onMouseDown);\r\n    }\r\n\r\n    this.container.classList.add('scrollable-y');\r\n    if(IS_SAFARI && !IS_MOBILE_SAFARI) {\r\n      this.container.classList.add('no-scrollbar');\r\n    }\r\n    this.setListeners();\r\n  }\r\n\r\n  public attachBorderListeners(setClassOn = this.container) {\r\n    const cb = this.onAdditionalScroll;\r\n    this.onAdditionalScroll = () => {\r\n      cb?.();\r\n      setClassOn.classList.toggle('scrolled-top', !this.scrollPosition);\r\n      setClassOn.classList.toggle('scrolled-bottom', this.isScrolledToEnd);\r\n    };\r\n\r\n    setClassOn.classList.add('scrolled-top', 'scrolled-bottom', 'scrollable-y-bordered');\r\n  }\r\n\r\n  public setVirtualContainer(el?: HTMLElement) {\r\n    this.splitUp = el;\r\n    this.log('setVirtualContainer:', el, this);\r\n  }\r\n\r\n  public checkForTriggers = () => {\r\n    if((!this.onScrolledTop && !this.onScrolledBottom)) return;\r\n\r\n    if(this.isHeavyAnimationInProgress) {\r\n      this.onScroll();\r\n      return;\r\n    }\r\n\r\n    const {scrollSize, scrollPosition, clientSize} = this;\r\n    if(!scrollSize) { // незачем вызывать триггеры если блок пустой или не виден\r\n      return;\r\n    }\r\n\r\n    const maxScrollPosition = scrollSize - clientSize;\r\n\r\n    // this.log('checkForTriggers:', scrollTop, maxScrollTop);\r\n\r\n    if(this.onScrolledTop && scrollPosition <= this.onScrollOffset && this.lastScrollDirection <= 0/* && direction === -1 */) {\r\n      this.onScrolledTop();\r\n    }\r\n\r\n    if(this.onScrolledBottom && (maxScrollPosition - scrollPosition) <= this.onScrollOffset && this.lastScrollDirection >= 0/* && direction === 1 */) {\r\n      this.onScrolledBottom();\r\n    }\r\n  };\r\n}\r\n\r\nexport class ScrollableX extends ScrollableBase {\r\n  constructor(el: HTMLElement, logPrefix = '', public onScrollOffset = 300, public splitCount = 15, public container: HTMLElement = document.createElement('div')) {\r\n    super(el, logPrefix, container);\r\n\r\n    this.container.classList.add('scrollable-x');\r\n\r\n    if(!IS_TOUCH_SUPPORTED) {\r\n      const scrollHorizontally = (e: WheelEvent) => {\r\n        e.stopPropagation();\r\n        if(!e.deltaX && this.container.scrollWidth > this.container.clientWidth) {\r\n          this.container.scrollLeft += e.deltaY / 4;\r\n          cancelEvent(e);\r\n        }\r\n      };\r\n\r\n      this.container.addEventListener('wheel', scrollHorizontally, {passive: false});\r\n    }\r\n\r\n    this.scrollPositionProperty = 'scrollLeft';\r\n    this.scrollSizeProperty = 'scrollWidth';\r\n    this.clientSizeProperty = 'clientWidth';\r\n    this.offsetSizeProperty = 'offsetWidth';\r\n  }\r\n}\r\n"],"names":["SCROLL_THROTTLE","USE_OWN_SCROLL","IS_OVERLAY_SCROLL_SUPPORTED","throttleMeasurement","cancelMeasurement","callback","id","ScrollableBase","el","logPrefix","container","scrollPosition","cancelEvent","contentHeight","viewportHeight","scrollbarSize","maxScrollTop","maxScrollbarOffset","scrollAmount","newScrollTop","logger","LogTypes","c","useHeavyAnimationCheck","elements","prependTo","options","fastSmoothScroll","scrollSize","clientSize","divider","thumbSize","value","b","maxValue","e","args","Scrollable","onScrollOffset","withPaddingContainer","maxScrollPosition","IS_SAFARI","IS_MOBILE_SAFARI","setClassOn","cb","ScrollableX","splitCount","IS_TOUCH_SUPPORTED","scrollHorizontally"],"mappings":"gIAwDA,MAAMA,EAA2C,GAC3CC,EAAiB,CAACC,EAExB,IAAIC,EACFC,EACCH,GACqBE,EAACE,GAAa,sBAAsBA,CAAQ,EAC9CD,EAACE,GAAO,qBAAqBA,CAAE,IAEnDH,EAAuBE,GAAa,OAAO,WAAWA,EAAUL,CAAe,EAC/EI,EAAqBE,GAAO,OAAO,aAAaA,CAAE,GAG7C,MAAMC,CAAe,CAkC1B,YACSC,EACPC,EAAY,GACLC,EAAyB,SAAS,cAAc,KAAK,EAC5D,CAHO,KAAA,GAAAF,EAEA,KAAA,UAAAE,EAhCT,KAAO,gBAA0B,EAEjC,KAAO,mBAA6B,EACpC,KAAO,oBAA8B,EAMrC,KAAO,2BAA6B,GACpC,KAAU,wBAA0B,GA+HpC,KAAO,SAAW,IAAM,CAOtB,GAAG,KAAK,2BAA4B,CAClC,KAAK,cAAc,EACnB,KAAK,wBAA0B,GAC/B,OAIE,CAAC,KAAK,eAAiB,CAAC,KAAK,kBAAqB,CAAC,KAAK,SAAW,CAAC,KAAK,oBAC1E,KAAK,kBACH,KAAA,gBAAkBP,EAAoB,IAAM,CAC/C,KAAK,gBAAkB,EAEvB,MAAMQ,EAAiB,KAAK,eACvB,KAAA,oBAAsB,KAAK,qBAAuBA,EAAiB,EAAK,KAAK,mBAAqBA,EAAiB,EAAI,GAC5H,KAAK,mBAAqBA,EAE1B,KAAK,YAAYA,CAAc,EAG5B,KAAK,oBACN,KAAK,mBAAmB,EAGvB,KAAK,kBACN,KAAK,iBAAiB,CACxB,CACD,EAAA,EA+BO,KAAA,YAAe,GAAkB,CACzCC,EAAY,CAAC,EAEb,MAAMC,EAAgB,KAAK,WACrBC,EAAiB,KAAK,WACtBC,EAAgB,KAAK,MAAM,aAC3BC,EAAeH,EAAgBC,EAE/BG,EAAqBH,EAAiBC,EAEtCG,GADS,EAAE,KAAK,UAAU,EAAI,KAAK,oBACVD,EAAsBD,EAC/CG,EAAe,KAAK,oBAAsBD,EAEhD,KAAK,eAAiBC,CAAA,EAGd,KAAA,YAAe,GAAkB,CACzCP,EAAY,CAAC,EACR,KAAA,mBAAqB,EAAE,KAAK,UAAU,EAC3C,KAAK,oBAAsB,KAAK,eAC3B,KAAA,MAAM,UAAU,IAAI,YAAY,EAE9B,OAAA,iBAAiB,YAAa,KAAK,WAAW,EACrD,OAAO,iBAAiB,UAAW,KAAK,UAAW,CAAC,KAAM,GAAK,CAAA,EAGvD,KAAA,UAAa,GAAkB,CAChC,OAAA,oBAAoB,YAAa,KAAK,WAAW,EACnD,KAAA,MAAM,UAAU,OAAO,YAAY,CAAA,EAnMnC,KAAA,UAAU,UAAU,IAAI,YAAY,EAEpC,KAAA,IAAMQ,EAAO,UAAYX,EAAY,IAAMA,EAAY,IAAKY,EAAS,KAAK,EAE5Eb,IACK,MAAA,KAAKA,EAAG,QAAQ,EAAE,QAASc,GAAM,KAAK,UAAU,OAAOA,CAAC,CAAC,EAE5Dd,EAAA,OAAO,KAAK,SAAS,EAI5B,CAEO,mBAAoB,CACtB,KAAK,sBAIR,KAAK,oBAAsB,GACtB,KAAA,UAAU,iBAAiB,SAAU,KAAK,SAAU,CAAC,QAAS,GAAM,QAAS,EAAK,CAAA,EACzF,CAEO,sBAAuB,CACxB,KAAK,sBAIT,KAAK,oBAAsB,GACtB,KAAA,UAAU,oBAAoB,SAAU,KAAK,SAAU,CAAC,QAAS,GAAK,EAC7E,CAEO,cAAe,CACjB,KAAK,+BAIR,OAAO,iBAAiB,SAAU,KAAK,SAAU,CAAC,QAAS,GAAK,EAChE,KAAK,kBAAkB,EAElB,KAAA,6BAA+Be,EAAuB,IAAM,CAC/D,KAAK,2BAA6B,GAE/B,KAAK,kBACN,KAAK,cAAc,EACnB,KAAK,wBAA0B,GACjC,EACC,IAAM,CACP,KAAK,2BAA6B,GAE/B,KAAK,0BACN,KAAK,SAAS,EACd,KAAK,wBAA0B,GACjC,CACD,EACH,CAEO,iBAAkB,CACnB,KAAK,+BAIF,OAAA,oBAAoB,SAAU,KAAK,QAAQ,EAC/C,KAAK,QACN,KAAK,MAAM,oBAAoB,YAAa,KAAK,WAAW,EACrD,OAAA,oBAAoB,YAAa,KAAK,WAAW,EACjD,OAAA,oBAAoB,UAAW,KAAK,SAAS,GAEtD,KAAK,qBAAqB,EAE1B,KAAK,6BAA6B,EAClC,KAAK,6BAA+B,OACtC,CAEO,SAAU,CACf,KAAK,gBAAgB,EACrB,KAAK,mBAAqB,OAC1B,KAAK,cAAgB,OACrB,KAAK,iBAAmB,MAC1B,CAEO,WAAWC,EAA6B,CAC7C,MAAMC,EAAY,KAAK,SAAW,KAAK,SAAW,KAAK,UACvD,KAAK,OAASA,IAAc,KAAK,WAAaD,EAAS,QAAQ,KAAK,cAAc,EACxEC,EAAA,QAAQ,GAAGD,CAAQ,EAC7B,KAAK,aAAa,CACpB,CAEO,UAAUA,EAA6B,EAC3C,KAAK,SAAW,KAAK,SAAW,KAAK,WAAW,OAAO,GAAGA,CAAQ,EACnE,KAAK,aAAa,CACpB,CAEO,kBAAkBE,EAA2C,CAGlE,OAAOC,EAAiB,CACtB,GAAGD,EACH,UAAW,KAAK,SAAA,CACjB,CAGH,CAsCO,YAAYf,EAAiB,KAAK,eAAgB,CACvD,GAAG,CAACV,GAAkB,CAAC,KAAK,MAC1B,OAGF,MAAM2B,EAAa,KAAK,UAAU,KAAK,kBAAkB,EACnDC,EAAa,KAAK,UAAU,KAAK,kBAAkB,EACnDC,EAAUF,EAAaC,EAAa,IACpCE,EAAY,KAAK,IAAI,GAAIF,EAAaC,CAAO,EAC7CE,EAAQrB,GAAkBiB,EAAaC,GAAcA,EAErDI,EAAItB,GAAkBiB,EAAaC,GACnCK,EAAWL,EAAaE,EAC3BF,EAAaD,GACT,KAAA,MAAM,MAAM,OAASG,EAAY,KACjC,KAAA,MAAM,MAAM,UAAY,cAAc,KAAK,IAAIG,EAAUF,EAAQD,EAAYE,CAAC,QAE9E,KAAA,MAAM,MAAM,OAAS,KAE9B,CAEO,eAAgB,CAClB,KAAK,kBACN7B,EAAkB,KAAK,eAAe,EACtC,KAAK,gBAAkB,EAE3B,CAiCO,cAAe,CACjBH,GAAkB,KAAK,OACxB,KAAK,SAAS,CAElB,CAEO,kBAAmB,CACxB,OAAO,KAAK,WAAa,KAAK,MAAM,KAAK,eAAiB,KAAK,UAAU,CAC3E,CAEA,IAAI,iBAAkB,CACb,OAAA,KAAK,iBAAsB,GAAA,CACpC,CAEA,IAAI,gBAAiB,CACZ,OAAA,KAAK,UAAU,KAAK,sBAAsB,CACnD,CAEA,IAAI,eAAe+B,EAAe,CAC3B,KAAA,UAAU,KAAK,sBAAsB,EAAIA,CAChD,CAEA,IAAI,YAAa,CACR,OAAA,KAAK,UAAU,KAAK,kBAAkB,CAC/C,CAEA,IAAI,YAAa,CACR,OAAA,KAAK,UAAU,KAAK,kBAAkB,CAC/C,CAEA,IAAI,YAAa,CACR,OAAA,KAAK,UAAU,KAAK,kBAAkB,CAC/C,CAEA,IAAI,mBAAoB,CACtB,OAAO,KAAK,MAAQ,KAAK,eAAe,mBAAqB,KAAK,UAAU,iBAC9E,CAEO,0BAA0BA,EAAe,CAC9C,KAAK,mBAAqBA,EAC1B,KAAK,sBAAsB,EAE3B,KAAK,eAAiBA,CACxB,CAEO,uBAAwB,CAC1B,KAAK,+BACN,KAAK,qBAAqB,EAC1B,KAAK,UAAU,iBAAiB,SAAWG,GAAM,CAC/CvB,EAAYuB,CAAC,EACb,KAAK,kBAAkB,CAAA,EACtB,CAAC,QAAS,GAAM,QAAS,GAAO,KAAM,GAAK,EAElD,CAEO,mBAAmBC,EAAyB,CACjD,KAAK,OAASA,EAAK,QAAQ,KAAK,cAAc,EACzC,KAAA,UAAU,gBAAgB,GAAGA,CAAI,CACxC,CACF,CAKA,MAAqBC,UAAmB9B,CAAe,CAGrD,YACEC,EACAC,EAAY,GACL6B,EAAiB,IACxBC,EACA,CACA,MAAM/B,EAAIC,CAAS,EAHZ,KAAA,eAAA6B,EALT,KAAO,UAAiC,CAAC,IAAK,GAAM,OAAQ,IA0D5D,KAAO,iBAAmB,IAAM,CAC9B,GAAI,CAAC,KAAK,eAAiB,CAAC,KAAK,iBAAmB,OAEpD,GAAG,KAAK,2BAA4B,CAClC,KAAK,SAAS,EACd,OAGF,KAAM,CAAC,WAAAV,EAAY,eAAAjB,EAAgB,WAAAkB,CAAA,EAAc,KACjD,GAAG,CAACD,EACF,OAGF,MAAMY,EAAoBZ,EAAaC,EAIpC,KAAK,eAAiBlB,GAAkB,KAAK,gBAAkB,KAAK,qBAAuB,GAC5F,KAAK,cAAc,EAGlB,KAAK,kBAAqB6B,EAAoB7B,GAAmB,KAAK,gBAAkB,KAAK,qBAAuB,GACrH,KAAK,iBAAiB,CACxB,EA/DA,KAAK,uBAAyB,YAC9B,KAAK,mBAAqB,eAC1B,KAAK,mBAAqB,eAC1B,KAAK,mBAAqB,eAC1B,KAAK,WAAa,UAEfV,IACI,KAAA,eAAiB,SAAS,cAAc,KAAK,EAC7C,KAAA,eAAe,UAAU,IAAI,4BAA4B,EACzD,KAAA,MAAQ,SAAS,cAAc,KAAK,EACpC,KAAA,MAAM,UAAU,IAAI,kBAAkB,EACtC,KAAA,eAAe,OAAO,KAAK,KAAK,EAChC,KAAA,UAAU,QAAQ,KAAK,cAAc,EAE1C,KAAK,MAAM,iBAAiB,YAAa,KAAK,WAAW,GAGtD,KAAA,UAAU,UAAU,IAAI,cAAc,EACxCwC,GAAa,CAACC,GACV,KAAA,UAAU,UAAU,IAAI,cAAc,EAE7C,KAAK,aAAa,CACpB,CAEO,sBAAsBC,EAAa,KAAK,UAAW,CACxD,MAAMC,EAAK,KAAK,mBAChB,KAAK,mBAAqB,IAAM,CACzBA,MACLD,EAAW,UAAU,OAAO,eAAgB,CAAC,KAAK,cAAc,EAChEA,EAAW,UAAU,OAAO,kBAAmB,KAAK,eAAe,CAAA,EAGrEA,EAAW,UAAU,IAAI,eAAgB,kBAAmB,uBAAuB,CACrF,CAEO,oBAAoBnC,EAAkB,CAC3C,KAAK,QAAUA,EACV,KAAA,IAAI,uBAAwBA,EAAI,IAAI,CAC3C,CA2BF,CAEO,MAAMqC,UAAoBtC,CAAe,CAC9C,YAAYC,EAAiBC,EAAY,GAAW6B,EAAiB,IAAYQ,EAAa,GAAWpC,EAAyB,SAAS,cAAc,KAAK,EAAG,CAK/J,GAJM,MAAAF,EAAIC,EAAWC,CAAS,EADoB,KAAA,eAAA4B,EAA6B,KAAA,WAAAQ,EAAwB,KAAA,UAAApC,EAGlG,KAAA,UAAU,UAAU,IAAI,cAAc,EAExC,CAACqC,EAAoB,CAChB,MAAAC,EAAsBb,GAAkB,CAC5CA,EAAE,gBAAgB,EACf,CAACA,EAAE,QAAU,KAAK,UAAU,YAAc,KAAK,UAAU,cACrD,KAAA,UAAU,YAAcA,EAAE,OAAS,EACxCvB,EAAYuB,CAAC,EACf,EAGF,KAAK,UAAU,iBAAiB,QAASa,EAAoB,CAAC,QAAS,GAAM,EAG/E,KAAK,uBAAyB,aAC9B,KAAK,mBAAqB,cAC1B,KAAK,mBAAqB,cAC1B,KAAK,mBAAqB,aAC5B,CACF"}