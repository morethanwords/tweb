{"version":3,"file":"toast-CTXjJKhu.js","sources":["../src/helpers/fixBase64String.ts","../src/helpers/bytes/bytesCmp.ts","../src/helpers/textToSvgURL.ts","../src/environment/webAuthn.ts","../src/helpers/string/base64ToBytes.ts","../src/lib/appManagers/utils/account/getInputPasskeyResponse.ts","../src/helpers/overlayClickHandler.ts","../src/components/toast.ts"],"sourcesContent":["export default function fixBase64String(str: string, toUrl: boolean) {\n  if(toUrl) {\n    return str.replace(/\\+/g, '-').replace(/\\//g, '_').replace(/\\=+$/, '');\n  } else {\n    return str.replace(/-/g, '+').replace(/_/g, '/');\n  }\n}\n","export default function bytesCmp(bytes1: number[] | Uint8Array, bytes2: number[] | Uint8Array) {\n  const len = bytes1.length;\n  if(len !== bytes2.length) {\n    return false;\n  }\n\n  for(let i = 0; i < len; ++i) {\n    if(bytes1[i] !== bytes2[i]) {\n      return false;\n    }\n  }\n\n  return true;\n}\n","export default function textToSvgURL(text: string) {\n  const blob = new Blob([text], {type: 'image/svg+xml;charset=utf-8'});\n\n  // * because iOS Safari doesn't want to eat objectURL\n  return new Promise<string>((resolve) => {\n    const reader = new FileReader();\n    reader.onload = (e) => {\n      resolve(e.target.result as string);\n    };\n    reader.readAsDataURL(blob);\n  });\n  // return URL.createObjectURL(blob);\n}\n","const IS_WEB_AUTHN_SUPPORTED = navigator.credentials &&\n  typeof(PublicKeyCredential) !== 'undefined' &&\n  'parseCreationOptionsFromJSON' in PublicKeyCredential;\n\nexport default IS_WEB_AUTHN_SUPPORTED;\n","import {MOUNT_CLASS_TO} from '@config/debug';\nimport fixBase64String from '@helpers/fixBase64String';\n\nexport default function base64ToBytes(base64: string) {\n  const bytesStr = atob(fixBase64String(base64, false));\n  const bytes = new Uint8Array(bytesStr.length);\n  for(let i = 0, length = bytes.length; i < length; ++i) {\n    bytes[i] = bytesStr[i].charCodeAt(0);\n  }\n\n  return bytes;\n}\n\nMOUNT_CLASS_TO.base64ToBytes = base64ToBytes;\n","import base64ToBytes from '@helpers/string/base64ToBytes';\nimport {InputPasskeyCredential, InputPasskeyResponse} from '@layer';\n\nexport default function getInputPasskey(credential: PublicKeyCredential): InputPasskeyResponse {\n  const json: PublicKeyCredentialJSON = credential.toJSON();\n  const clientData = atob(json.response.clientDataJSON);\n  let ret: InputPasskeyResponse;\n  if(json.response.attestationObject) {\n    ret = {\n      _: 'inputPasskeyResponseRegister',\n      client_data: {_: 'dataJSON', data: clientData},\n      attestation_data: base64ToBytes(json.response.attestationObject)\n    };\n  } else {\n    ret = {\n      _: 'inputPasskeyResponseLogin',\n      client_data: {_: 'dataJSON', data: clientData},\n      authenticator_data: base64ToBytes(json.response.authenticatorData),\n      signature: base64ToBytes(json.response.signature),\n      user_handle: atob(json.response.userHandle)\n    };\n  }\n\n  return ret;\n}\n\nexport function getInputPasskeyCredential(credential: PublicKeyCredential): InputPasskeyCredential.inputPasskeyCredentialPublicKey {\n  const response = getInputPasskey(credential);\n  const json = credential.toJSON();\n  return {\n    _: 'inputPasskeyCredentialPublicKey',\n    id: json.id,\n    raw_id: json.rawId,\n    response\n  };\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport appNavigationController, {NavigationItem} from '@components/appNavigationController';\nimport IS_TOUCH_SUPPORTED from '@environment/touchSupport';\nimport {IS_MOBILE_SAFARI} from '@environment/userAgent';\nimport cancelEvent from '@helpers/dom/cancelEvent';\nimport {CLICK_EVENT_NAME, hasMouseMovedSinceDown} from '@helpers/dom/clickEvent';\nimport findUpAsChild from '@helpers/dom/findUpAsChild';\nimport EventListenerBase from '@helpers/eventListenerBase';\n\nexport default class OverlayClickHandler extends EventListenerBase<{\n  toggle: (open: boolean) => void\n}> {\n  protected element: HTMLElement;\n  protected overlay: HTMLElement;\n  protected listenerOptions: AddEventListenerOptions;\n\n  constructor(\n    protected navigationType?: NavigationItem['type'],\n    protected withOverlay?: boolean\n  ) {\n    super(false);\n    this.listenerOptions = withOverlay ? {} : {capture: true};\n  }\n\n  protected onClick = (e: MouseEvent | TouchEvent) => {\n    if(hasMouseMovedSinceDown(e)) {\n      return;\n    }\n\n    if(this.element) {\n      const isRoot = this.element === document.body;\n      if(!isRoot && findUpAsChild(e.target as HTMLElement, this.element)) {\n        return;\n      }\n    }\n\n    if(this.listenerOptions?.capture) {\n      cancelEvent(e);\n    }\n\n    this.close(e);\n  };\n\n  public close(e?: MouseEvent | TouchEvent) {\n    if(this.element) {\n      this.overlay?.remove();\n      this.element = undefined;\n      this.dispatchEvent('toggle', false);\n    }\n\n    if(!IS_TOUCH_SUPPORTED) {\n      // window.removeEventListener('keydown', onKeyDown, {capture: true});\n      window.removeEventListener('contextmenu', this.onClick, this.listenerOptions);\n    }\n\n    document.removeEventListener(CLICK_EVENT_NAME, this.onClick, this.listenerOptions);\n\n    if(!IS_MOBILE_SAFARI && this.navigationType) {\n      appNavigationController.removeByType(this.navigationType);\n    }\n  }\n\n  public open(element = document.body) {\n    this.close();\n\n    if(!IS_MOBILE_SAFARI && this.navigationType) {\n      appNavigationController.pushItem({\n        type: this.navigationType,\n        onPop: (canAnimate) => {\n          this.close();\n        }\n      });\n    }\n\n    this.element = element;\n\n    if(!this.overlay && this.withOverlay) {\n      this.overlay = document.createElement('div');\n      this.overlay.classList.add('btn-menu-overlay');\n\n      // ! because this event must be canceled, and can't cancel on menu click (below)\n      this.overlay.addEventListener(CLICK_EVENT_NAME, (e) => {\n        cancelEvent(e);\n        this.onClick(e);\n      });\n    }\n\n    const isRoot = this.element === document.body;\n    if(this.overlay) {\n      if(isRoot) {\n        this.element.append(this.overlay);\n      } else {\n        this.element.parentElement.insertBefore(this.overlay, this.element);\n      }\n    }\n\n    // document.body.classList.add('disable-hover');\n\n    if(!IS_TOUCH_SUPPORTED) {\n      // window.addEventListener('keydown', onKeyDown, {capture: true});\n      window.addEventListener('contextmenu', this.onClick, {...this.listenerOptions, once: true});\n    }\n\n    /* // ! because this event must be canceled, and can't cancel on menu click (below)\n    overlay.addEventListener(CLICK_EVENT_NAME, (e) => {\n      cancelEvent(e);\n      onClick(e);\n    }); */\n\n    // ! safari iOS doesn't handle window click event on overlay, idk why\n    document.addEventListener(CLICK_EVENT_NAME, this.onClick, this.listenerOptions);\n\n    this.dispatchEvent('toggle', true);\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport replaceContent from '@helpers/dom/replaceContent';\nimport OverlayClickHandler from '@helpers/overlayClickHandler';\nimport {FormatterArguments, i18n, LangPackKey} from '@lib/langPack';\n\nconst toastsContainer = document.createElement('div');\ntoastsContainer.classList.add('toasts-container');\n\nconst toastEl = document.createElement('div');\ntoastEl.classList.add('toast');\nlet timeout: number;\n\nconst x = new OverlayClickHandler('toast');\nx.addEventListener('toggle', (open) => {\n  if(!open) {\n    hideToast();\n  }\n});\n\nexport function hideToast() {\n  x.close();\n\n  toastEl.classList.remove('is-visible');\n  timeout && clearTimeout(+timeout);\n\n  timeout = window.setTimeout(() => {\n    toastEl.remove();\n    timeout = undefined;\n  }, 200);\n}\n\nexport function toast(content: string | Node, onClose?: () => void) {\n  x.close();\n\n  replaceContent(toastEl, content);\n\n  if(!toastEl.parentElement) {\n    if(!toastsContainer.parentNode) {\n      document.body.append(toastsContainer);\n    }\n\n    toastsContainer.append(toastEl);\n    void toastEl.offsetLeft; // reflow\n  }\n\n  toastEl.classList.add('is-visible');\n\n  timeout && clearTimeout(+timeout);\n  x.open(toastEl);\n\n  timeout = window.setTimeout(hideToast, 3000);\n\n  if(onClose) {\n    x.addEventListener('toggle', onClose, {once: true});\n  }\n}\n\nexport function toastNew(options: Partial<{\n  langPackKey: LangPackKey,\n  langPackArguments: FormatterArguments,\n  onClose: () => void\n}>) {\n  toast(i18n(options.langPackKey, options.langPackArguments), options.onClose);\n}\n"],"names":["fixBase64String","str","toUrl","bytesCmp","bytes1","bytes2","len","i","textToSvgURL","text","blob","resolve","reader","e","IS_WEB_AUTHN_SUPPORTED","base64ToBytes","base64","bytesStr","bytes","length","MOUNT_CLASS_TO","getInputPasskey","credential","json","clientData","ret","getInputPasskeyCredential","response","OverlayClickHandler","EventListenerBase","navigationType","withOverlay","hasMouseMovedSinceDown","findUpAsChild","cancelEvent","IS_TOUCH_SUPPORTED","CLICK_EVENT_NAME","IS_MOBILE_SAFARI","appNavigationController","element","canAnimate","isRoot","toastsContainer","toastEl","timeout","x","open","hideToast","toast","content","onClose","replaceContent","toastNew","options","i18n"],"mappings":"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"}