{"version":3,"file":"tab-Xt9bdHHA.js","sources":["../src/components/sidebarLeft/tabs/privacy/messages/config.ts","../src/components/sidebarLeft/tabs/privacy/messages/optionsSection.tsx","../src/components/sidebarLeft/tabs/privacy/messages/paidSettingsSection.tsx","../src/components/sidebarLeft/tabs/privacy/messages/useSaveSettings.ts","../src/components/sidebarLeft/tabs/privacy/messages/utils.ts","../src/components/sidebarLeft/tabs/privacy/messages/useSettings.ts","../src/components/sidebarLeft/tabs/privacy/messages/useStateStore.ts","../src/components/sidebarLeft/tabs/privacy/messages/tab.tsx"],"sourcesContent":["import {InputPrivacyKey, InputPrivacyRule} from '@layer';\n\nexport enum MessagesPrivacyOption {\n  Everybody = 1,\n  ContactsAndPremium,\n  Paid\n};\n\nexport type MessagesTabStateStore = {\n  option?: MessagesPrivacyOption;\n  stars?: number;\n  chosenPeers?: PeerId[];\n};\n\nexport const privacyRulesInputKey = 'inputPrivacyKeyNoPaidMessages' satisfies InputPrivacyKey['_'];\n\nexport const defaultPrivacyRules: InputPrivacyRule[] = [\n  // This is set by default on the server, there's an error thrown if we try to set it ourselves\n  // {\n  //   _: 'inputPrivacyValueDisallowAll'\n  // },\n  {\n    _: 'inputPrivacyValueAllowContacts'\n  }\n];\n\nexport const TRANSITION_TIME = 120;\n","import {Component} from 'solid-js';\nimport {SetStoreFunction} from 'solid-js/store';\nimport {Transition} from 'solid-transition-group';\nimport anchorCallback from '@helpers/dom/anchorCallback';\nimport {useHotReloadGuard} from '@lib/solidjs/hotReloadGuard';\nimport Section from '@components/section';\nimport StaticRadio from '@components/staticRadio';\nimport {MessagesPrivacyOption, MessagesTabStateStore, TRANSITION_TIME} from '@components/sidebarLeft/tabs/privacy/messages/config';\nimport useIsPremium from '@components/sidebarLeft/tabs/privacy/messages/useIsPremium';\n\n\nconst DEFAULT_STARS_AMOUNT = 10;\n\nconst OptionsSection: Component<{\n  store: MessagesTabStateStore;\n  setStore: SetStoreFunction<MessagesTabStateStore>;\n  isPaid: boolean;\n  onExitAnimationPromise: (promise: Promise<any>) => void;\n}> = (props) => {\n  const {PopupPremium, i18n, toastNew, hideToast, Row} = useHotReloadGuard();\n\n  const isPremium = useIsPremium();\n\n\n  const handlePremiumOptionClick = (callback: () => void) => () => {\n    if(isPremium()) return callback();\n\n    toastNew({\n      langPackKey: 'PrivacySettings.Messages.PremiumError',\n      langPackArguments: [\n        anchorCallback(() => {\n          hideToast();\n          PopupPremium.show({\n            feature: 'message_privacy'\n          });\n        })\n      ]\n    });\n  };\n\n  const caption = (\n    <Transition\n      mode=\"outin\"\n      onEnter={async(el, done) => {\n        await el.animate({opacity: [0, 1]}, {duration: TRANSITION_TIME}).finished;\n        done();\n      }}\n      onExit={async(el, done) => {\n        const promise = el.animate({opacity: [1, 0]}, {duration: TRANSITION_TIME}).finished;\n        props.onExitAnimationPromise(promise);\n        await promise;\n        done();\n      }}\n    >\n      {\n        !props.isPaid ?\n          i18n('Privacy.MessagesInfo', [anchorCallback(() => void PopupPremium.show())]) :\n          i18n('PaidMessages.ChargeForMessagesDescription')\n      }\n    </Transition>\n  );\n\n  return (\n    <Section\n      name=\"PrivacyMessagesTitle\"\n      caption={caption as any}\n    >\n      <Row\n        clickable={() => {\n          props.setStore('option', MessagesPrivacyOption.Everybody);\n        }}\n      >\n        <Row.CheckboxField>\n          <StaticRadio\n            floating\n            checked={props.store.option === MessagesPrivacyOption.Everybody}\n          />\n        </Row.CheckboxField>\n        <Row.Title>{i18n('PrivacySettingsController.Everbody')}</Row.Title>\n      </Row>\n      <Row\n        clickable={handlePremiumOptionClick(() => {\n          props.setStore('option', MessagesPrivacyOption.ContactsAndPremium);\n        })}\n      >\n        {isPremium() && (\n          <Row.CheckboxField>\n            <StaticRadio\n              floating\n              checked={props.store.option === MessagesPrivacyOption.ContactsAndPremium}\n            />\n          </Row.CheckboxField>\n        )}\n        {!isPremium() && <Row.Icon icon=\"premium_lock\" />}\n        <Row.Title>{i18n('Privacy.ContactsAndPremium')}</Row.Title>\n      </Row>\n      <Row\n        clickable={handlePremiumOptionClick(() => {\n          props.setStore(prev => ({\n            option: MessagesPrivacyOption.Paid,\n            stars: prev.stars || DEFAULT_STARS_AMOUNT\n          }));\n        })}\n      >\n        {isPremium() && (\n          <Row.CheckboxField>\n            <StaticRadio floating checked={props.isPaid} />\n          </Row.CheckboxField>\n        )}\n        {!isPremium() && <Row.Icon icon=\"premium_lock\" />}\n        <Row.Title>{i18n('PaidMessages.ChargeForMessages')}</Row.Title>\n      </Row>\n    </Section>\n  );\n};\n\nexport default OptionsSection;\n","import {Component, Show} from 'solid-js';\nimport {SetStoreFunction} from 'solid-js/store';\nimport {Transition} from 'solid-transition-group';\nimport {useHotReloadGuard} from '@lib/solidjs/hotReloadGuard';\nimport Section from '@components/section';\nimport {useSuperTab} from '@components/solidJsTabs/superTabProvider';\nimport {MessagesTabStateStore, TRANSITION_TIME} from '@components/sidebarLeft/tabs/privacy/messages/config';\nimport StarRangeInput from '@components/sidebarLeft/tabs/privacy/messages/starsRangeInput';\nimport useStarsCommissionAndWithdrawalPrice from '@components/sidebarLeft/tabs/privacy/messages/useStarsCommissionAndWithdrawalPrice';\nimport {ChosenPeersByType} from '@components/sidebarLeft/tabs/privacy/messages/useStateStore';\n\n\nconst PaidSettingsSection: Component<{\n  store: MessagesTabStateStore;\n  setStore: SetStoreFunction<MessagesTabStateStore>;\n  chosenPeersByType: ChosenPeersByType;\n  isPaid: boolean;\n  exitAnimationPromise: Promise<any>;\n}> = (props) => {\n  const [tab, {AppAddMembersTab}] = useSuperTab();\n  const {i18n, join, Row} = useHotReloadGuard();\n\n  const {commissionPercents, willReceiveDollars} = useStarsCommissionAndWithdrawalPrice(() => props.store.stars);\n\n  const onExceptionsClick = () => {\n    tab.slider.createTab(AppAddMembersTab).open({\n      type: 'privacy',\n      skippable: true,\n      title: 'PaidMessages.RemoveFee',\n      placeholder: 'PrivacyModal.Search.Placeholder',\n      takeOut: (newPeerIds) => {\n        props.setStore('chosenPeers', newPeerIds);\n      },\n      selectedPeerIds: [...props.store.chosenPeers]\n    });\n  };\n\n\n  const chosenPeersLabel = () => {\n    if(!props.store.chosenPeers.length) return i18n('PrivacySettingsController.AddUsers');\n\n    const {users, chats} = props.chosenPeersByType;\n\n    return join([\n      users.length ? i18n('Users', [users.length]) : null,\n      chats.length ? i18n('Chats', [chats.length]) : null\n    ].filter(Boolean), false);\n  };\n\n  return (\n    <Transition\n      onEnter={async(_el, done) => {\n        const el = _el as HTMLElement;\n        el.style.opacity = '0';\n        await props.exitAnimationPromise;\n        await el.animate({opacity: [0, 1]}, {duration: TRANSITION_TIME}).finished;\n        el.style.removeProperty('opacity');\n        done();\n      }}\n      onExit={async(el, done) => {\n        await el.animate({opacity: [1, 0]}, {duration: TRANSITION_TIME}).finished;\n        done();\n      }}\n    >\n      <Show when={props.isPaid}>\n        <div>\n          <Section\n            name=\"PaidMessages.SetPrice\"\n            caption=\"PaidMessages.SetPriceDescription\"\n            captionArgs={[\n              commissionPercents(),\n              willReceiveDollars()\n            ]}\n          >\n            <StarRangeInput value={props.store.stars} onChange={props.setStore.bind(null, 'stars')} />\n          </Section>\n\n          <Section name=\"PrivacyExceptions\" caption=\"PaidMessages.RemoveFeeDescription\">\n            <Row clickable={onExceptionsClick}>\n              <Row.Title>{i18n('PaidMessages.RemoveFee')}</Row.Title>\n              <Row.RightContent><span class=\"primary\">{chosenPeersLabel()}</span></Row.RightContent>\n            </Row>\n          </Section>\n        </div>\n      </Show>\n    </Transition>\n  );\n};\n\nexport default PaidSettingsSection;\n","import {Accessor} from 'solid-js';\n\nimport {GlobalPrivacySettings, InputPrivacyRule} from '@layer';\nimport {useHotReloadGuard} from '@lib/solidjs/hotReloadGuard';\nimport setBooleanFlag from '@helpers/object/setBooleanFlag';\nimport {logger} from '@lib/logger';\n\nimport {useSuperTab} from '@components/solidJsTabs/superTabProvider';\nimport type {AppPrivacyMessagesTab} from '@components/solidJsTabs';\n\nimport {MessagesTabStateStore, MessagesPrivacyOption, defaultPrivacyRules, privacyRulesInputKey} from '@components/sidebarLeft/tabs/privacy/messages/config';\nimport {ChosenPeersByType} from '@components/sidebarLeft/tabs/privacy/messages/useStateStore';\n\n\nconst log = logger('useSaveSettings');\n\ntype AppPrivacyMessagesTabType = typeof AppPrivacyMessagesTab;\n\ntype UseSaveSettingsArgs = {\n  store: MessagesTabStateStore;\n  globalPrivacy: Accessor<GlobalPrivacySettings>;\n  isPaid: Accessor<boolean>;\n  hasChanges: Accessor<boolean>;\n  chosenPeersByType: Accessor<ChosenPeersByType>;\n};\n\nconst useSaveSettings = ({store, globalPrivacy, isPaid, hasChanges, chosenPeersByType}: UseSaveSettingsArgs) => {\n  const {rootScope} = useHotReloadGuard();\n  const [tab] = useSuperTab<AppPrivacyMessagesTabType>();\n\n  const saveGlobalSettings = () => {\n    const settings = structuredClone(globalPrivacy());\n\n    settings.noncontact_peers_paid_stars = isPaid() ? store.stars : 0;\n\n    settings.pFlags ??= {};\n    setBooleanFlag(settings.pFlags, 'new_noncontact_peers_require_premium', store.option === MessagesPrivacyOption.ContactsAndPremium);\n\n\n    log('saving settings :>> ', settings);\n\n    const promise = rootScope.managers.appPrivacyManager.setGlobalPrivacySettings(settings);\n\n    tab.payload.onSaved(promise);\n\n    return promise;\n  };\n\n  const savePrivacyRules = async() => {\n    const rules: InputPrivacyRule[] = [];\n\n    const {chats, users} = chosenPeersByType();\n\n    rules.push(...defaultPrivacyRules);\n\n    if(chats.length) rules.push({\n      _: 'inputPrivacyValueAllowChatParticipants',\n      chats\n    });\n    if(users.length) rules.push({\n      _: 'inputPrivacyValueAllowUsers',\n      users: await Promise.all(users.map((id) => rootScope.managers.appUsersManager.getUserInput(id)))\n    });\n\n\n    log('saving rules :>> ', rules);\n\n    return rootScope.managers.appPrivacyManager.setPrivacy(privacyRulesInputKey, rules);\n  };\n\n\n  let isSaving = false;\n\n  const saveAllSettings = async() => {\n    if(isSaving || !hasChanges()) return;\n    isSaving = true;\n\n    try {\n      await Promise.all([\n        saveGlobalSettings(),\n        isPaid() ? savePrivacyRules() : undefined\n      ]);\n      tab.close();\n    } finally {\n      isSaving = false; // Idk let the user retry if it somewhy fails)\n    }\n  };\n\n  return saveAllSettings;\n};\n\nexport default useSaveSettings;\n","import {InputUser} from '@layer';\n\n// Note: after saving privacy rules, the cached users are objects instead of being numbers\nexport const getUserId = (user: InputUser.inputUser | string | number) => {\n  if(user instanceof Object) return user.user_id?.toPeerId(true);\n  return user.toPeerId(true);\n};\n","import {createResource} from 'solid-js';\n\nimport {useHotReloadGuard} from '@lib/solidjs/hotReloadGuard';\n\nimport {usePromiseCollector} from '@components/solidJsTabs/promiseCollector';\n\nimport {privacyRulesInputKey, MessagesPrivacyOption} from '@components/sidebarLeft/tabs/privacy/messages/config';\nimport useIsPremium from '@components/sidebarLeft/tabs/privacy/messages/useIsPremium';\nimport {getUserId} from '@components/sidebarLeft/tabs/privacy/messages/utils';\n\n\nconst useSettings = () => {\n  const {rootScope} = useHotReloadGuard();\n  const promiseCollector = usePromiseCollector();\n\n  const isPremium = useIsPremium();\n\n\n  const [privacyRules] = createResource(() => {\n    const promise = rootScope.managers.appPrivacyManager.getPrivacy(privacyRulesInputKey);\n    promiseCollector.collect(promise);\n    return promise;\n  });\n\n  const [globalPrivacy] = createResource(() => {\n    const promise = rootScope.managers.appPrivacyManager.getGlobalPrivacySettings();\n    promiseCollector.collect(promise);\n    return promise;\n  });\n\n\n  const isReady = () => privacyRules.state === 'ready' && globalPrivacy.state === 'ready';\n\n  const currentOption = () => {\n    if(!isPremium()) return MessagesPrivacyOption.Everybody;\n\n    if(globalPrivacy().noncontact_peers_paid_stars) return MessagesPrivacyOption.Paid;\n\n    if(globalPrivacy().pFlags.new_noncontact_peers_require_premium) return MessagesPrivacyOption.ContactsAndPremium;\n\n    return MessagesPrivacyOption.Everybody;\n  };\n\n  const currentAllowedUsers = () =>\n    privacyRules()\n    ?.filter((rule) => rule._ === 'privacyValueAllowUsers')\n    ?.map(rule => rule?.users).flat()\n    ?.map(user => user.toPeerId()) || [];\n\n  const currentAllowedChats = () =>\n    privacyRules()\n    ?.find((rule) => rule._ === 'privacyValueAllowChatParticipants')?.chats\n    ?.map(getUserId)\n    ?.filter((v) => v !== undefined) || [];\n\n\n  return {\n    isReady,\n\n    globalPrivacy,\n    privacyRules,\n\n    currentOption,\n    currentAllowedUsers,\n    currentAllowedChats\n  };\n};\n\nexport default useSettings;\n","import {Accessor, createComputed, createSignal, createEffect, createMemo} from 'solid-js';\nimport {createStore, reconcile} from 'solid-js/store';\n\nimport throttle from '@helpers/schedulers/throttle';\nimport deepEqual from '@helpers/object/deepEqual';\nimport {GlobalPrivacySettings} from '@layer';\n\nimport {MessagesPrivacyOption, MessagesTabStateStore} from '@components/sidebarLeft/tabs/privacy/messages/config';\n\n\ntype UseStateStoreArgs = {\n  isReady: Accessor<boolean>;\n  globalPrivacy: Accessor<GlobalPrivacySettings>;\n  currentOption: Accessor<MessagesPrivacyOption>;\n  currentAllowedUsers: Accessor<PeerId[]>;\n  currentAllowedChats: Accessor<PeerId[]>;\n};\n\nexport type ChosenPeersByType = {\n  chats: (string | number)[];\n  users: PeerId[];\n};\n\nconst useStateStore = ({\n  isReady,\n  globalPrivacy,\n  currentOption, currentAllowedChats, currentAllowedUsers\n}: UseStateStoreArgs) => {\n  let initialState: MessagesTabStateStore = {};\n  const [store, setStore] = createStore<MessagesTabStateStore>({});\n\n  createComputed(() => {\n    if(!isReady()) return;\n\n    initialState = {\n      option: currentOption(),\n      stars: Number(globalPrivacy().noncontact_peers_paid_stars) || undefined,\n      chosenPeers: [...currentAllowedUsers(), ...currentAllowedChats()]\n    };\n\n    setStore(reconcile(structuredClone(initialState)));\n  });\n\n  const isPaid = createMemo(() => store.option === MessagesPrivacyOption.Paid);\n\n  const hasChanges = createMemo(() => {\n    const ignoreKeys: (keyof MessagesTabStateStore)[] = !!!isPaid() ? ['chosenPeers', 'stars'] : [];\n\n    return !deepEqual(store, initialState, ignoreKeys);\n  });\n\n  const chosenPeersByType = (): ChosenPeersByType => ({\n    chats: store.chosenPeers.filter(peer => peer.isAnyChat()).map(peer => peer.toChatId()),\n    users: store.chosenPeers.filter(peer => peer.isUser())\n  });\n\n\n  return [\n    store,\n    setStore,\n    {hasChanges, isPaid, chosenPeersByType}\n  ] as const;\n};\n\n\nexport default useStateStore;\n","import {createEffect, createSignal, Show} from 'solid-js';\nimport {Portal} from 'solid-js/web';\nimport DEBUG from '@config/debug';\nimport useIsConfirmationNeededOnClose from '@hooks/useIsConfirmationNeededOnClose';\nimport {logger} from '@lib/logger';\nimport SaveButton from '@components/saveButton';\nimport {useSuperTab} from '@components/solidJsTabs/superTabProvider';\nimport OptionsSection from '@components/sidebarLeft/tabs/privacy/messages/optionsSection';\nimport PaidSettingsSection from '@components/sidebarLeft/tabs/privacy/messages/paidSettingsSection';\nimport useSaveSettings from '@components/sidebarLeft/tabs/privacy/messages/useSaveSettings';\nimport useSettings from '@components/sidebarLeft/tabs/privacy/messages/useSettings';\nimport useStateStore from '@components/sidebarLeft/tabs/privacy/messages/useStateStore';\n\n\nconst log = logger('MessagesPrivacyTab');\n\n\nconst MessagesTab = () => {\n  const [tab] = useSuperTab();\n\n  const {\n    isReady,\n    globalPrivacy, privacyRules,\n    currentOption, currentAllowedUsers, currentAllowedChats\n  } = useSettings();\n\n  const [store, setStore, {isPaid, hasChanges, chosenPeersByType}] = useStateStore({\n    isReady,\n    globalPrivacy,\n    currentOption, currentAllowedChats, currentAllowedUsers\n  });\n\n  const saveAllSettings = useSaveSettings({\n    store,\n    globalPrivacy,\n    isPaid,\n    hasChanges,\n    chosenPeersByType\n  });\n\n  tab.isConfirmationNeededOnClose = useIsConfirmationNeededOnClose({hasChanges, saveAllSettings, descriptionLangKey: 'UnsavedChangesDescription.Privacy'});\n\n  const [exitAnimationPromise, setExitAnimationPromise] = createSignal<Promise<any>>();\n\n  if(DEBUG) createEffect(() => {\n    log('privacyRules() :>> ', privacyRules());\n    log('globalPrivacy() :>> ', globalPrivacy());\n  });\n\n\n  return (\n    <Show when={isReady()}>\n      <Portal mount={tab.header}>\n        <SaveButton hasChanges={hasChanges()} onClick={() => void saveAllSettings()} />\n      </Portal>\n\n      <OptionsSection\n        isPaid={isPaid()}\n        store={store}\n        setStore={setStore}\n        onExitAnimationPromise={setExitAnimationPromise}\n      />\n\n      <PaidSettingsSection\n        isPaid={isPaid()}\n        store={store}\n        setStore={setStore}\n        chosenPeersByType={chosenPeersByType()}\n        exitAnimationPromise={exitAnimationPromise()}\n      />\n    </Show>\n  );\n};\n\nexport default MessagesTab;\n"],"names":["MessagesPrivacyOption","MessagesPrivacyOption2","privacyRulesInputKey","defaultPrivacyRules","TRANSITION_TIME","DEFAULT_STARS_AMOUNT","OptionsSection","props","PopupPremium","i18n","toastNew","hideToast","Row","useHotReloadGuard","isPremium","useIsPremium","handlePremiumOptionClick","callback","langPackKey","langPackArguments","anchorCallback","show","feature","caption","_$createComponent","Transition","mode","onEnter","el","done","animate","opacity","duration","finished","onExit","promise","onExitAnimationPromise","children","_$memo","isPaid","Section","name","clickable","setStore","Everybody","CheckboxField","StaticRadio","floating","checked","store","option","Title","ContactsAndPremium","Icon","icon","prev","Paid","stars","PaidSettingsSection","tab","AppAddMembersTab","useSuperTab","join","commissionPercents","willReceiveDollars","useStarsCommissionAndWithdrawalPrice","onExceptionsClick","slider","createTab","open","type","skippable","title","placeholder","takeOut","newPeerIds","selectedPeerIds","chosenPeers","chosenPeersLabel","length","users","chats","chosenPeersByType","filter","Boolean","_el","style","exitAnimationPromise","removeProperty","Show","when","_el$","_tmpl$2","_$insert","captionArgs","StarRangeInput","value","onChange","bind","RightContent","_el$2","_tmpl$","log","logger","useSaveSettings","globalPrivacy","hasChanges","rootScope","saveGlobalSettings","settings","setBooleanFlag","savePrivacyRules","rules","id","isSaving","getUserId","user","useSettings","promiseCollector","usePromiseCollector","privacyRules","createResource","rule","v","useStateStore","isReady","currentOption","currentAllowedChats","currentAllowedUsers","initialState","createStore","createComputed","reconcile","createMemo","ignoreKeys","deepEqual","peer","MessagesTab","saveAllSettings","isConfirmationNeededOnClose","useIsConfirmationNeededOnClose","descriptionLangKey","setExitAnimationPromise","createSignal","DEBUG","createEffect","Portal","mount","header","SaveButton","onClick"],"mappings":"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"}