import{q as b,L as I,y as x,cs as V,bw as D,cV as B,db as N,k as g,bz as R,$ as A,bi as w,d as F,da as O,w as W,eW as j,b5 as _,e5 as z,v as K}from"./index-om8Rlu63.js";const E=new Map;let L=0;const T=(c,e,n="")=>{n=e.country_code+n,L=Math.max(L,n.length),E.set(n,{country:c,code:e})};function U(c){c=c||"",E.size||b.countriesList.forEach(i=>{i.country_codes.forEach(a=>{a.prefixes?a.prefixes.forEach(r=>{T(i,a,r)}):T(i,a)})});let e=c.replace(/\D/g,"");const n=e.slice(0,L);let t;for(let i=n.length-1;i>=0&&(t=E.get(n.slice(0,i+1)),!t);--i);if(!t)return{formatted:e,country:void 0,code:void 0,leftPattern:""};const d=t.country,l=t.code.patterns||[],p=e.slice(t.code.country_code.length);let o="",f=0,s="";for(let i=l.length-1;i>=0;--i){o=l[i];const a=o.replace(/ /g,"");let r=0;for(let h=0,m=Math.min(p.length,a.length);h<m;++h)if(p[h]===a[h])r+=1.01;else if(a[h]==="X")++r;else{r=0;break}r>f&&(f=r,s=o)}o=s||o,o=o.replace(/\d/g,"X"),o=t.code.country_code+" "+o,o.split("").forEach((i,a)=>{i===" "&&e[a]!==" "&&e.length>a&&(e=e.slice(0,a)+" "+e.slice(a))});let u=o&&o.length>e.length?o.slice(e.length):"";return u&&(u=u.replace(/X/g,"â€’")),{formatted:e,country:d,code:t.code,leftPattern:u}}class X extends I{constructor(e={}){super({label:"Contacts.PhoneNumber.Placeholder",name:"phone",...e}),this.pasted=!1,this.lastValue="",this.container.classList.add("input-field-phone");const n=this.input;if(n instanceof HTMLInputElement)n.type="tel",n.autocomplete="rr55RandomRR55";else{n.inputMode="decimal";const t=window.devicePixelRatio;if(t>1){let l;D?l=t*-.16:B&&(l=0),n.style.setProperty("--letter-spacing",l+"px")}const d=this.setValueSilently.bind(this);this.setValueSilently=l=>{d(l),x(this.input,!0)}}n.addEventListener("input",()=>{n.classList.remove("error");const t=this.value;Math.abs(t.length-this.lastValue.length)>1&&!this.pasted&&V&&this.setValueSilently(this.lastValue+t),this.pasted=!1,this.setLabel();let l,p,o="";this.value.replace(/\++/,"+")==="+"?this.setValueSilently("+"):(l=U(this.value),p=l.formatted,l.country,o=l.leftPattern,l.code,this.setValueSilently(this.lastValue=p?"+"+p:"")),n.dataset.leftPattern=o,e.onInput&&e.onInput(l)}),n.addEventListener("paste",()=>{this.pasted=!0}),n.addEventListener("keypress",t=>{const d=t.key;if(/\D/.test(d)&&!(t.metaKey||t.ctrlKey)&&d!=="Backspace"&&!(d==="+"&&t.shiftKey))return t.preventDefault(),!1})}}let C;const M=()=>{C=b.countriesList.filter(c=>!c.pFlags?.hidden).sort((c,e)=>(c.name||c.default_name).localeCompare(e.name||e.default_name))};let v=()=>{v=void 0,M(),F.addEventListener("language_apply",()=>{M()})};const k=new Set(["FT"]);function q(c,e){return v?.(),c=c.toLowerCase(),C.filter(t=>{if(e&&k.has(t.iso2))return!1;const d=[t.name,t.default_name,t.iso2];return d.filter(Boolean).forEach(p=>{const o=p.split(" ").filter(f=>/\w/.test(f)).map(f=>f[0]).join("");o.length>1&&d.push(o)}),!!d.filter(Boolean).find(p=>p.toLowerCase().indexOf(c)!==-1)})}class J extends I{constructor(e={}){super({label:"Country",name:N(),...e}),this.options=e,this.hidePicker=()=>{this.hideTimeout===void 0&&(this.selectWrapper.classList.remove("active"),this.hideTimeout=window.setTimeout(()=>{this.selectWrapper.classList.add("hide"),this.hideTimeout=void 0},200))},this.selectCountryByTarget=s=>{const u=s.querySelector("[data-default-name]").dataset.defaultName,a=s.querySelector(".phone-code")?.innerText,r=a&&a.replace(/\D/g,"");this.value=g(u),this.lastCountrySelected=C.find(h=>h.default_name===u),this.lastCountryCodeSelected=r&&this.lastCountrySelected.country_codes.find(h=>h.country_code===r),this.options.onCountryChange?.(this.lastCountrySelected,this.lastCountryCodeSelected),this.hidePicker()},v?.(),this.liMap=new Map,this.container.classList.add("input-select");const n=this.selectWrapper=document.createElement("div");n.classList.add("select-wrapper","z-depth-3","hide");const t=document.createElement("span");t.classList.add("arrow","arrow-down"),this.container.append(t);const d=document.createElement("ul");n.appendChild(d),new R(n);let l=()=>{l=null,C.forEach(s=>{if(e.noPhoneCodes&&k.has(s.iso2))return;const u=O(s.iso2),i=[];for(let a=0,r=Math.min(s.country_codes.length,e.noPhoneCodes?1:1/0);a<r;++a){const h=s.country_codes[a],m=document.createElement("li"),S=W(u);if(j){const y=document.createElement("span");_(y,S),m.append(y)}else _(m,S);const P=g(s.default_name);if(P.dataset.defaultName=s.default_name,m.append(P),!e.noPhoneCodes){const y=document.createElement("span");y.classList.add("phone-code"),y.innerText="+"+h.country_code,m.appendChild(y)}i.push(m),d.append(m)}this.liMap.set(s.iso2,i)}),d.addEventListener("mousedown",s=>{if(s.button!==0)return;const u=z(s.target,"LI");this.selectCountryByTarget(u)}),this.container.appendChild(n)};l(),this.input.addEventListener("focus",s=>{l?l():C.forEach(u=>{const i=this.liMap.get(u.iso2);i&&i.forEach(a=>a.style.display="")}),clearTimeout(this.hideTimeout),this.hideTimeout=void 0,n.classList.remove("hide"),n.offsetWidth,n.classList.add("active"),this.select(),A({container:w(this.container,"scrollable-y"),element:this.input,position:"start",margin:4}),setTimeout(()=>{p||(document.addEventListener("mousedown",o,{capture:!0}),p=!0)},0)});let p=!1;const o=s=>{w(s.target,"input-select")||s.target!==this.input&&(this.hidePicker(),document.removeEventListener("mousedown",o,{capture:!0}),p=!1)},f=s=>{const u=s.key;if(s.ctrlKey||u==="Control")return!1;const i=new Set(q(this.value).map(a=>a.iso2));this.liMap.forEach((a,r)=>{a.forEach(h=>h.style.display=i.has(r)?"":"none")}),i.size?i.size===1&&u==="Enter"&&(K(s),this.selectCountryByTarget(this.liMap.get([...i][0])[0])):C.forEach(a=>{const r=this.liMap.get(a.iso2);r&&r.forEach(h=>h.style.display="")})};this.input.addEventListener("keyup",f),this.input.addEventListener("keydown",s=>{s.key==="Enter"&&f(s)}),t.addEventListener("mousedown",s=>{this.input.matches(":focus")?(this.hidePicker(),this.input.blur()):(s.cancelBubble=!0,s.preventDefault(),this.input.focus())})}getSelected(){return{country:this.lastCountrySelected,code:this.lastCountryCodeSelected}}selectCountryByIso2(e){this.selectCountryByTarget(this.liMap.get(e)[0])}override(e,n,t){this.setValueSilently(e?g(e.default_name):t),this.lastCountrySelected=e,this.lastCountryCodeSelected=n,this.options.onCountryChange?.(this.lastCountrySelected,this.lastCountryCodeSelected)}}export{J as C,X as T,q as a,U as f};
//# sourceMappingURL=countryInputField-BLOgxvgr.js.map
