{"version":3,"file":"channelDirectMessages-jIsWV1f0.js","sources":["../src/components/sidebarRight/tabs/channelDirectMessages.tsx"],"sourcesContent":["import {createEffect, createSignal, Show} from 'solid-js';\nimport {Portal} from 'solid-js/web';\nimport {Transition} from 'solid-transition-group';\nimport throttle from '@helpers/schedulers/throttle';\nimport useIsConfirmationNeededOnClose from '@hooks/useIsConfirmationNeededOnClose';\nimport {i18n} from '@lib/langPack';\nimport {useHotReloadGuard} from '@lib/solidjs/hotReloadGuard';\nimport SaveButton from '@components/saveButton';\nimport Section from '@components/section';\nimport StarRangeInput from '@components/sidebarLeft/tabs/privacy/messages/starsRangeInput';\nimport useStarsCommissionAndWithdrawalPrice from '@components/sidebarLeft/tabs/privacy/messages/useStarsCommissionAndWithdrawalPrice';\nimport type {AppDirectMessagesTab} from '@components/solidJsTabs';\nimport {useSuperTab} from '@components/solidJsTabs/superTabProvider';\nimport StaticSwitch from '@components/staticSwitch';\n\n\nconst ChannelDirectMessages = () => {\n  const [tab] = useSuperTab<typeof AppDirectMessagesTab>();\n  const {apiManagerProxy, rootScope, Row} = useHotReloadGuard();\n\n  const chat = tab.payload.chat;\n  if(!chat) return <></>;\n\n  const linkedChat = chat.linked_monoforum_id ? apiManagerProxy.getChat(chat.linked_monoforum_id) : undefined;\n\n  const initialEnabled = !!linkedChat;\n  const initialStars = linkedChat?._ === 'channel' ? +linkedChat.send_paid_messages_stars || 0 : 0\n\n  const [enabled, setEnabled] = createSignal(initialEnabled);\n  const [stars, setStars] = createSignal(initialStars);\n\n  const [hasChanges, setHasChanges] = createSignal(false);\n\n  const {commissionPercents, willReceiveDollars} = useStarsCommissionAndWithdrawalPrice(stars);\n\n  const throttledSetHasChanges = throttle(setHasChanges, 200);\n\n  createEffect(() => {\n    throttledSetHasChanges(initialEnabled !== enabled() || (enabled() && initialStars !== stars()));\n  });\n\n  let isSaving = false;\n\n  async function saveSettings() {\n    if(isSaving) return;\n    isSaving = true;\n\n    try {\n      await rootScope.managers.appChatsManager.updateChannelPaidMessagesPrice(\n        chat.id,\n        enabled() ? stars() : 0,\n        enabled()\n      );\n      tab.close();\n    } finally {\n      isSaving = false;\n    }\n  }\n\n  tab.isConfirmationNeededOnClose = useIsConfirmationNeededOnClose({\n    saveAllSettings: saveSettings,\n    hasChanges,\n    descriptionLangKey: 'UnsavedChangesDescription.Channel'\n  });\n\n  return <>\n    <Portal mount={tab.header}>\n      <SaveButton hasChanges={hasChanges()} onClick={() => void saveSettings()} />\n    </Portal>\n\n    <Section caption='ChannelDirectMessages.Settings.SwitchLabelCaption'>\n      <Row clickable={() => {setEnabled(!enabled())}}>\n        <Row.Title>\n          {i18n('ChannelDirectMessages.Settings.SwitchLabel')}\n        </Row.Title>\n        <Row.RightContent>\n          <StaticSwitch checked={enabled()} />\n        </Row.RightContent>\n      </Row>\n    </Section>\n\n    <Transition name='fade'>\n      <Show when={enabled()}>\n        <Section\n          name='PaidMessages.SetPrice'\n          class='overflow-hidden'\n          caption='PaidMessages.SetPriceChannelDescription'\n          captionArgs={[commissionPercents(), willReceiveDollars()]}\n        >\n          <StarRangeInput value={stars()} onChange={setStars} startFromZero />\n        </Section>\n      </Show>\n    </Transition>\n  </>;\n};\n\nexport default ChannelDirectMessages;\n"],"names":["ChannelDirectMessages","tab","useSuperTab","apiManagerProxy","rootScope","Row","useHotReloadGuard","chat","payload","linkedChat","linked_monoforum_id","getChat","undefined","initialEnabled","initialStars","_","send_paid_messages_stars","enabled","setEnabled","createSignal","stars","setStars","hasChanges","setHasChanges","commissionPercents","willReceiveDollars","useStarsCommissionAndWithdrawalPrice","throttledSetHasChanges","throttle","createEffect","isSaving","saveSettings","managers","appChatsManager","updateChannelPaidMessagesPrice","id","close","isConfirmationNeededOnClose","useIsConfirmationNeededOnClose","saveAllSettings","descriptionLangKey","_$createComponent","Portal","mount","header","children","SaveButton","onClick","Section","caption","clickable","Title","i18n","RightContent","StaticSwitch","checked","Transition","name","Show","when","captionArgs","StarRangeInput","value","onChange","startFromZero"],"mappings":"i7BAgBMA,MAAAA,GAAwBA,IAAM,CAClC,KAAM,CAACC,CAAG,EAAIC,IACR,CAACC,gBAAAA,EAAiBC,UAAAA,EAAWC,IAAAA,CAAI,EAAGC,EAAiB,EAErDC,EAAON,EAAIO,QAAQD,KACzB,GAAG,CAACA,EAAM,MAAA,GAEV,MAAME,EAAaF,EAAKG,oBAAsBP,EAAgBQ,QAAQJ,EAAKG,mBAAmB,EAAIE,OAE5FC,EAAiB,CAAC,CAACJ,EACnBK,EAAeL,GAAYM,IAAM,WAAY,CAACN,EAAWO,0BAA4B,EAErF,CAACC,EAASC,CAAU,EAAIC,EAAaN,CAAc,EACnD,CAACO,EAAOC,CAAQ,EAAIF,EAAaL,CAAY,EAE7C,CAACQ,EAAYC,CAAa,EAAIJ,EAAa,EAAK,EAEhD,CAACK,mBAAAA,EAAoBC,mBAAAA,CAAkB,EAAIC,EAAqCN,CAAK,EAErFO,EAAyBC,EAASL,EAAe,GAAG,EAE1DM,EAAa,IAAM,CACjBF,EAAuBd,IAAmBI,EAAS,GAAKA,EAAO,GAAMH,IAAiBM,EAAK,CAAG,CAChG,CAAC,EAED,IAAIU,EAAW,GAEf,eAAeC,GAAe,CAC5B,GAAGD,CAAAA,EACHA,CAAAA,EAAW,GAEX,GAAI,CACF,MAAM1B,EAAU4B,SAASC,gBAAgBC,+BACvC3B,EAAK4B,GACLlB,EAAO,EAAKG,EAAO,EAAG,EACtBH,EACF,CAAA,EACAhB,EAAImC,MAAK,CACX,QAAU,CACRN,EAAW,EACb,EACF,CAEA7B,OAAAA,EAAIoC,4BAA8BC,EAA+B,CAC/DC,gBAAiBR,EACjBT,WAAAA,EACAkB,mBAAoB,mCACtB,CAAC,EAEDC,CAAAA,EACGC,EAAM,CAAA,IAACC,OAAK,CAAA,OAAE1C,EAAI2C,MAAM,EAAA,IAAAC,UAAA,CAAA,OAAAJ,EACtBK,EAAU,CAAA,IAACxB,YAAU,CAAA,OAAEA,EAAU,CAAE,EAAEyB,QAASA,IAAM,KAAKhB,EAAa,CAAC,CAAA,CAAA,EAAAU,EAAAA,EAGzEO,EAAO,CAACC,QAAO,oDAAA,IAAAJ,UAAA,CAAA,OAAAJ,EACbpC,EAAG,CAAC6C,UAAWA,IAAM,CAAChC,EAAW,CAACD,EAAO,CAAE,CAAE,EAAA,IAAA4B,UAAA,CAAA,MAAA,CAAAJ,EAC3CpC,EAAI8C,MAAK,CAAA,IAAAN,UAAA,CAAA,OACPO,EAAK,4CAA4C,CAAC,CAAA,CAAA,EAAAX,EAEpDpC,EAAIgD,aAAY,CAAA,IAAAR,UAAA,CAAA,OAAAJ,EACda,EAAY,CAAA,IAACC,SAAO,CAAA,OAAEtC,EAAO,CAAE,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,EAAAwB,EAAAA,EAKrCe,EAAU,CAACC,KAAI,OAAA,IAAAZ,UAAA,CAAA,OAAAJ,EACbiB,EAAI,CAAA,IAACC,MAAI,CAAA,OAAE1C,EAAO,CAAE,EAAA,IAAA4B,UAAA,CAAA,OAAAJ,EAClBO,EAAO,CACNS,KAAI,wBAAA,MAAA,kBAEJR,QAAO,0CAAA,IACPW,aAAW,CAAA,MAAE,CAACpC,EAAkB,EAAIC,EAAkB,CAAE,CAAC,EAAA,IAAAoB,UAAA,CAAA,OAAAJ,EAExDoB,EAAc,CAAA,IAACC,OAAK,CAAA,OAAE1C,EAAK,CAAE,EAAE2C,SAAU1C,EAAU2C,cAAa,EAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAK3E"}