{"version":3,"file":"publishTimeField-CACwPvJg.js","sources":["../src/components/simpleFormField/index.tsx","../src/components/chat/suggestPostPopup/popupSchedulePost.ts","../src/components/chat/suggestPostPopup/publishTimeField.tsx"],"sourcesContent":["import {Accessor, createContext, createSignal, JSX, mergeProps, onMount, ParentProps, Setter, splitProps, useContext, createEffect, batch} from 'solid-js';\nimport styles from './styles.module.scss';\n\n\ntype SimpleFormFieldContextValue = {\n  input: Accessor<HTMLInputElement>;\n  setInput: Setter<HTMLInputElement>;\n  offsetElement: Accessor<HTMLElement>;\n  setOffsetElement: Setter<HTMLElement>;\n  value: Accessor<string>;\n  onChange: (value: string) => void;\n};\n\nconst Context = createContext<SimpleFormFieldContextValue>();\n\nconst SimpleFormField = (inProps: ParentProps<{\n  value?: string;\n  onChange?: (value: string) => void;\n\n  onClick?: JSX.EventHandler<HTMLDivElement, MouseEvent>;\n  isError?: boolean;\n  clickable?: boolean;\n  withEndButtonIcon?: boolean;\n} & Omit<JSX.HTMLAttributes<HTMLDivElement>, 'onChange' | 'onClick'>>) => {\n  const [props, restProps] = splitProps(inProps, ['value', 'onChange', 'isError', 'children', 'onClick', 'class', 'classList', 'clickable', 'withEndButtonIcon']);\n  const [input, setInput] = createSignal<HTMLInputElement>();\n  const [offsetElement, setOffsetElement] = createSignal<HTMLElement>();\n\n  const contextValue: SimpleFormFieldContextValue = {\n    input,\n    setInput,\n    offsetElement,\n    setOffsetElement,\n    value: () => props.value,\n    get onChange() {\n      return props.onChange;\n    }\n  };\n\n  return (\n    <Context.Provider value={contextValue}>\n      <div\n        class={styles.Container}\n        classList={{\n          [styles.error]: props.isError,\n          [styles.clickable]: props.clickable,\n          [props.class]: !!props.class,\n          [styles.withEndButtonIcon]: props.withEndButtonIcon,\n          ...props.classList\n        }}\n        onClick={(...args) => {\n          contextValue.input()?.focus();\n          props.onClick?.(...args);\n        }}\n        {...restProps}\n      >\n        <div class={styles.BorderThin} />\n        <div class={styles.BorderThick} />\n        {props.children}\n      </div>\n    </Context.Provider>\n  );\n};\n\nSimpleFormField.Input = (inProps: {\n  forceFieldValue?: boolean;\n} & Omit<JSX.InputHTMLAttributes<HTMLInputElement>, 'value' | 'onChange' | 'onInput' | 'ref'>) => {\n  const [props, restProps] = splitProps(inProps, ['class', 'classList', 'forceFieldValue']);\n\n  const context = useContext(Context);\n\n  return (\n    <input\n      ref={(el) => batch(() => {\n        context.setInput(el);\n        context.setOffsetElement(el);\n      })}\n      class={styles.Input}\n      classList={{\n        [props.class]: !!props.class,\n        ...props.classList\n      }}\n      value={context.value()}\n      onInput={(e) => {\n        context.onChange(e.currentTarget.value)\n        if(props.forceFieldValue) context.input().value = context.value();\n      }}\n      {...restProps}\n    />\n  );\n};\n\nSimpleFormField.InputStub = (props: ParentProps) => {\n  const context = useContext(Context);\n\n  return (\n    <div\n      ref={context.setOffsetElement}\n      class={styles.InputStub}\n    >\n      {props.children}\n    </div>\n  );\n};\n\nSimpleFormField.Label = (props: ParentProps<{\n  active?: boolean;\n  forceOffset?: number;\n}>) => {\n  const context = useContext(Context);\n\n  const [offset, setOffset] = createSignal(0);\n\n  onMount(() => {\n    if(props.forceOffset || !context.offsetElement()) return;\n    const parentElement = context.offsetElement().parentElement;\n    if(!parentElement) return;\n\n    const rect = parentElement.getBoundingClientRect();\n    const inputRect = context.offsetElement().getBoundingClientRect();\n    setOffset(inputRect.left - rect.left);\n  });\n\n  return (\n    <div\n      class={styles.Label}\n      classList={{\n        [styles.active]: props.active || !!context.value()\n      }}\n      style={{\n        '--offset': `${props.forceOffset || offset()}px`\n      }}\n    >\n      {props.children}\n    </div>\n  );\n};\n\nSimpleFormField.SideContent = (props: ParentProps<{\n  first?: boolean;\n  last?: boolean;\n}>) => {\n  return (\n    <div class={styles.SideContent} classList={{\n      [styles.first]: props.first,\n      [styles.last]: props.last\n    }}>\n      {props.children}\n    </div>\n  );\n};\n\nexport default SimpleFormField;\n","import {formatTime} from '../../../helpers/date';\nimport {i18n} from '../../../lib/langPack';\nimport PopupSchedule from '../../popups/schedule';\nimport styles from './styles.module.scss';\n\n\nconst MILLIS_IN_MINUTE = 60 * 1000;\n\ntype Args = {\n  minTimeDate: Date;\n} & ConstructorParameters<typeof PopupSchedule>[0];\n\nexport default class PopupSchedulePost extends PopupSchedule {\n  protected caption: HTMLElement;\n  protected minTimeDate: Date;\n\n  constructor(args: Args) {\n    const {minTimeDate, ...rest} = args;\n\n    super(rest);\n\n    this.minTimeDate = minTimeDate;\n\n    this.caption = document.createElement('div');\n    this.caption.classList.add(styles.Caption, styles.center);\n    this.caption.append(i18n('SuggestedPosts.PublishingTime.MinSendTime', [formatTime(minTimeDate)]));\n\n    this.timeDiv.after(this.caption);\n  }\n\n  public setTimeTitle() {\n    super.setTimeTitle();\n\n    if(!this.caption || !this.minTimeDate) return;\n\n    const sendDate = new Date(this.selectedDate.getTime());\n    sendDate.setHours(+this.hoursInputField.value, +this.minutesInputField.value);\n\n    const disabled = sendDate < new Date() || (sendDate.valueOf() / MILLIS_IN_MINUTE | 0) < (this.minTimeDate.valueOf() / MILLIS_IN_MINUTE | 0);\n\n    this.btnConfirm.toggleAttribute('disabled', disabled);\n\n    const isCaptionVisible = sendDate.getDate() === this.minTimeDate.getDate();\n    this.caption.classList.toggle('hide', !isCaptionVisible);\n  }\n}\n","import {formatFullSentTime} from '../../../helpers/date';\nimport {I18nTsx} from '../../../helpers/solid/i18n';\nimport {LangPackKey} from '../../../lib/langPack';\nimport {ButtonIconTsx} from '../../buttonIconTsx';\nimport {IconTsx} from '../../iconTsx';\nimport SimpleFormField from '../../simpleFormField';\nimport styles from './commonStyles.module.scss';\nimport PopupSchedulePost from './popupSchedulePost';\n\n\ntype Props = {\n  value: number;\n  onChange: (value: number | undefined) => void;\n  noTimeLangKey: LangPackKey;\n};\n\nconst PUBLISH_MIN_DELAY_MINUTES = 10;\n\nconst PublishTimeField = (props: Props) => {\n  const onContainerClick = () => {\n    const minTimeDate = new Date();\n    minTimeDate.setMinutes(minTimeDate.getMinutes() + PUBLISH_MIN_DELAY_MINUTES);\n\n    const minDate = new Date(minTimeDate);\n    minDate.setHours(0, 0, 0, 0);\n\n    new PopupSchedulePost({\n      initDate: new Date(minTimeDate),\n      minDate,\n      minTimeDate,\n      onPick: (timestamp) => {\n        console.log(timestamp);\n        props.onChange(timestamp);\n      }\n    }).show();\n  };\n\n  const onCrossClick = (event: MouseEvent) => {\n    event.stopPropagation();\n    props.onChange(undefined);\n  };\n\n  return (\n    <SimpleFormField\n      clickable\n      withEndButtonIcon={!!props.value}\n      onClick={onContainerClick}\n    >\n      <SimpleFormField.InputStub>\n        {props.value ?\n          <span>{formatFullSentTime(props.value)}</span> :\n          <I18nTsx key={props.noTimeLangKey} />\n        }\n      </SimpleFormField.InputStub>\n      <SimpleFormField.Label active>\n        <I18nTsx key='SuggestedPosts.PublishingTime.Label' />\n      </SimpleFormField.Label>\n      <SimpleFormField.SideContent last>\n        {props.value ?\n          <ButtonIconTsx icon='cross' tabIndex={-1} onClick={onCrossClick} /> :\n          <IconTsx class={styles.Icon} icon='down' />\n        }\n      </SimpleFormField.SideContent>\n    </SimpleFormField>\n  )\n};\n\nexport default PublishTimeField;\n"],"names":["Context","createContext","SimpleFormField","inProps","props","restProps","splitProps","input","setInput","createSignal","offsetElement","setOffsetElement","contextValue","value","onChange","_$createComponent","Provider","children","_el$","_tmpl$","_el$2","firstChild","_el$3","nextSibling","$$click","args","focus","onClick","_$spread","_$mergeProps","styles","Container","classList","error","isError","clickable","class","withEndButtonIcon","_$insert","_$effect","_p$","_v$","BorderThin","_v$2","BorderThick","_$className","undefined","Input","context","useContext","_el$4","_tmpl$2","$$input","e","currentTarget","forceFieldValue","_$use","el","batch","InputStub","_el$5","_tmpl$3","_ref$","Label","offset","setOffset","onMount","forceOffset","parentElement","rect","getBoundingClientRect","inputRect","left","_el$6","_v$3","_v$4","active","_v$5","_$classList","style","setProperty","removeProperty","SideContent","_el$7","_v$6","_v$7","first","last","_$delegateEvents","MILLIS_IN_MINUTE","PopupSchedulePost","PopupSchedule","minTimeDate","rest","i18n","formatTime","sendDate","disabled","isCaptionVisible","PUBLISH_MIN_DELAY_MINUTES","PublishTimeField","onContainerClick","Date","setMinutes","getMinutes","minDate","setHours","initDate","onPick","timestamp","console","log","show","onCrossClick","event","stopPropagation","_$memo","formatFullSentTime","I18nTsx","key","noTimeLangKey","ButtonIconTsx","icon","tabIndex","IconTsx","Icon"],"mappings":"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"}