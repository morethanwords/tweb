{"version":3,"file":"archiveSettingsTab-R47G-SWq.js","sources":["../src/components/sidebarLeft/tabs/archiveSettingsTab.tsx"],"sourcesContent":["import SaveButton from '@components/saveButton';\nimport Section from '@components/section';\nimport {HeightTransition} from '@components/sidebarRight/tabs/adminRecentActions/heightTransition';\nimport {usePromiseCollector} from '@components/solidJsTabs/promiseCollector';\nimport {useSuperTab} from '@components/solidJsTabs/superTabProvider';\nimport StaticSwitch from '@components/staticSwitch';\nimport deepEqual from '@helpers/object/deepEqual';\nimport setBooleanFlag from '@helpers/object/setBooleanFlag';\nimport {I18nTsx} from '@helpers/solid/i18n';\nimport {wrapAsyncClickHandler} from '@helpers/wrapAsyncClickHandler';\nimport useIsConfirmationNeededOnClose from '@hooks/useIsConfirmationNeededOnClose';\nimport {useHotReloadGuard} from '@lib/solidjs/hotReloadGuard';\nimport {createComputed, createMemo, createResource, Show} from 'solid-js';\nimport {createStore} from 'solid-js/store';\nimport {Portal} from 'solid-js/web';\nimport useIsPremium from './privacy/messages/useIsPremium';\n\n\nexport default function ArchiveSettingsTab() {\n  const [tab] = useSuperTab();\n  const {Row, rootScope} = useHotReloadGuard();\n\n  const promiseCollector = usePromiseCollector();\n\n  const [globalPrivacy] = createResource(() => {\n    const promise = rootScope.managers.appPrivacyManager.getGlobalPrivacySettings();\n    promiseCollector.collect(promise);\n    return promise;\n  });\n\n  const isPremium = useIsPremium();\n\n  const isReady = createMemo(() => globalPrivacy.state === 'ready');\n\n  const [store, setStore] = createStore({\n    keepArchivedUnmutedChats: false,\n    keepArchiveFromFolders: false,\n    archiveNonContactChats: false\n  });\n\n  type StoreState = typeof store;\n\n  let initialValues: StoreState = {\n    keepArchivedUnmutedChats: false,\n    keepArchiveFromFolders: false,\n    archiveNonContactChats: false\n  };\n\n  const hasChanges = createMemo(() => !deepEqual(store, initialValues));\n\n  createComputed(() => {\n    if(!isReady()) return;\n\n    initialValues = {\n      keepArchivedUnmutedChats: !!globalPrivacy()?.pFlags?.keep_archived_unmuted,\n      keepArchiveFromFolders: !!globalPrivacy()?.pFlags?.keep_archived_folders,\n      archiveNonContactChats: !!globalPrivacy()?.pFlags?.archive_and_mute_new_noncontact_peers\n    };\n\n    setStore(initialValues);\n  });\n\n  const saveGlobalSettings = wrapAsyncClickHandler(async() => {\n    if(!isReady()) return;\n\n    const settings = structuredClone(globalPrivacy());\n\n    settings.pFlags ??= {};\n    setBooleanFlag(settings.pFlags, 'keep_archived_unmuted', store.keepArchivedUnmutedChats);\n    setBooleanFlag(settings.pFlags, 'keep_archived_folders', store.keepArchivedUnmutedChats ? true : store.keepArchiveFromFolders);\n    setBooleanFlag(settings.pFlags, 'archive_and_mute_new_noncontact_peers', store.archiveNonContactChats);\n\n    await rootScope.managers.appPrivacyManager.setGlobalPrivacySettings(settings);\n\n    tab.close();\n  });\n\n  tab.isConfirmationNeededOnClose = useIsConfirmationNeededOnClose({hasChanges, saveAllSettings: saveGlobalSettings, descriptionLangKey: 'UnsavedChangesDescription.Archive'});\n\n  return (\n    <>\n      <Portal mount={tab.header}>\n        <SaveButton hasChanges={hasChanges()} onClick={() => void saveGlobalSettings()} />\n      </Portal>\n      <Section name='ArchiveSettings.UnmutedChats.Title' caption='ArchiveSettings.UnmutedChats.Description'>\n        <Row clickable={() => setStore('keepArchivedUnmutedChats', prev => !prev)}>\n          <Row.Title>\n            <I18nTsx key='ArchiveSettings.UnmutedChats.Action' />\n          </Row.Title>\n          <Row.RightContent>\n            <StaticSwitch checked={store.keepArchivedUnmutedChats} />\n          </Row.RightContent>\n        </Row>\n      </Section>\n      <Show when={isReady()}> {/* Prevent animation triggering when the store is initialized */}\n        <HeightTransition>\n          <Show when={!store.keepArchivedUnmutedChats}>\n            <div style={{overflow: 'hidden'}}> {/* Note: The `overflow: hidden` makes so the margin-bottom of the section is included in the scroll height */}\n              <Section name='ArchiveSettings.FolderChats.Title' caption='ArchiveSettings.FolderChats.Description'>\n                <Row clickable={() => setStore('keepArchiveFromFolders', prev => !prev)}>\n                  <Row.Title>\n                    <I18nTsx key='ArchiveSettings.FolderChats.Action' />\n                  </Row.Title>\n                  <Row.RightContent>\n                    <StaticSwitch checked={store.keepArchiveFromFolders} />\n                  </Row.RightContent>\n                </Row>\n              </Section>\n            </div>\n          </Show>\n        </HeightTransition>\n      </Show>\n      <Show when={isPremium()}>\n        <Section name='ArchiveSettings.NewChats.Title' caption='ArchiveSettings.NewChats.Description'>\n          <Row clickable={() => setStore('archiveNonContactChats', prev => !prev)}>\n            <Row.Title>\n              <I18nTsx key='ArchiveSettings.NewChats.Action' />\n            </Row.Title>\n            <Row.RightContent>\n              <StaticSwitch checked={store.archiveNonContactChats} />\n            </Row.RightContent>\n          </Row>\n        </Section>\n      </Show>\n    </>\n  );\n}\n"],"names":["ArchiveSettingsTab","tab","useSuperTab","Row","rootScope","useHotReloadGuard","promiseCollector","usePromiseCollector","globalPrivacy","createResource","promise","managers","appPrivacyManager","getGlobalPrivacySettings","collect","isPremium","useIsPremium","isReady","createMemo","state","store","setStore","createStore","keepArchivedUnmutedChats","keepArchiveFromFolders","archiveNonContactChats","initialValues","hasChanges","deepEqual","createComputed","pFlags","keep_archived_unmuted","keep_archived_folders","archive_and_mute_new_noncontact_peers","saveGlobalSettings","wrapAsyncClickHandler","settings","structuredClone","setBooleanFlag","setGlobalPrivacySettings","close","isConfirmationNeededOnClose","useIsConfirmationNeededOnClose","saveAllSettings","descriptionLangKey","_$createComponent","Portal","mount","header","children","SaveButton","onClick","Section","name","caption","clickable","prev","Title","I18nTsx","key","RightContent","StaticSwitch","checked","Show","when","HeightTransition","_el$","_tmpl$","firstChild","style","setProperty","_$insert"],"mappings":"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"}