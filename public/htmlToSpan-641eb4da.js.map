{"version":3,"file":"htmlToSpan-641eb4da.js","sources":["../src/components/passwordInputField.ts","../src/components/monkeys/password.ts","../src/helpers/dom/htmlToSpan.ts"],"sourcesContent":["/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport cancelEvent from '../helpers/dom/cancelEvent';\r\nimport Icon from './icon';\r\nimport InputField, {InputFieldOptions} from './inputField';\r\n\r\nexport class PasswordInputHelpers {\r\n  public passwordVisible = false;\r\n  public toggleVisible: HTMLElement;\r\n  public onVisibilityClickAdditional: () => void;\r\n\r\n  constructor(public container: HTMLElement, public input: HTMLInputElement) {\r\n    input.type = 'password';\r\n    input.setAttribute('required', '');\r\n    input.name = 'notsearch_password';\r\n    input.autocomplete = 'off';\r\n\r\n    // * https://stackoverflow.com/a/35949954/6758968\r\n    const stealthy = document.createElement('input');\r\n    stealthy.classList.add('stealthy');\r\n    stealthy.tabIndex = -1;\r\n    stealthy.type = 'password';\r\n    input.parentElement.prepend(stealthy);\r\n    input.parentElement.insertBefore(stealthy.cloneNode(), input.nextSibling);\r\n\r\n    /* if(IS_SAFARI && !IS_MOBILE_SAFARI) {\r\n      input.setAttribute('readonly', '');\r\n      input.addEventListener('focus', () => {\r\n        input.removeAttribute('readonly');\r\n      }, {once: true});\r\n    } */\r\n\r\n    const toggleVisible = this.toggleVisible = document.createElement('span');\r\n    toggleVisible.classList.add('toggle-visible');\r\n    toggleVisible.append(Icon('eye1'));\r\n\r\n    container.classList.add('input-field-password');\r\n    container.append(toggleVisible);\r\n\r\n    toggleVisible.addEventListener('click', this.onVisibilityClick);\r\n    toggleVisible.addEventListener('touchend', this.onVisibilityClick);\r\n  }\r\n\r\n  public onVisibilityClick = (e: Event) => {\r\n    cancelEvent(e);\r\n    this.passwordVisible = !this.passwordVisible;\r\n\r\n    this.toggleVisible.replaceChildren(Icon(this.passwordVisible ? 'eye2' : 'eye1'));\r\n    (this.input as HTMLInputElement).type = this.passwordVisible ? 'text' : 'password';\r\n    this.onVisibilityClickAdditional?.();\r\n  };\r\n}\r\n\r\nexport default class PasswordInputField extends InputField {\r\n  public helpers: PasswordInputHelpers;\r\n\r\n  constructor(options: InputFieldOptions = {}) {\r\n    super({\r\n      plainText: true,\r\n      ...options\r\n    });\r\n\r\n    this.helpers = new PasswordInputHelpers(this.container, this.input as HTMLInputElement);\r\n  }\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport lottieLoader, {LottieLoader} from '../../lib/rlottie/lottieLoader';\r\nimport RLottiePlayer from '../../lib/rlottie/rlottiePlayer';\r\nimport PasswordInputField from '../passwordInputField';\r\n\r\nexport default class PasswordMonkey {\r\n  public container: HTMLElement;\r\n  public animation: RLottiePlayer;\r\n  public needFrame = 0;\r\n  protected loadPromise: ReturnType<LottieLoader['waitForFirstFrame']>;\r\n\r\n  constructor(protected passwordInputField: PasswordInputField, protected size: number) {\r\n    this.container = document.createElement('div');\r\n    this.container.classList.add('media-sticker-wrapper');\r\n  }\r\n\r\n  public load() {\r\n    if(this.loadPromise) return this.loadPromise;\r\n    return this.loadPromise = lottieLoader.loadAnimationAsAsset({\r\n      container: this.container,\r\n      loop: false,\r\n      autoplay: false,\r\n      width: this.size,\r\n      height: this.size,\r\n      noCache: true\r\n    // }, 'assets/img/TwoFactorSetupMonkeyClose.tgs').then((_animation) => {\r\n    }, 'TwoFactorSetupMonkeyPeek').then((_animation) => {\r\n      // return;\r\n      this.animation = _animation;\r\n      this.animation.addEventListener('enterFrame', currentFrame => {\r\n        // console.log('enterFrame', currentFrame, this.needFrame);\r\n\r\n        if((this.animation.direction === 1 && currentFrame >= this.needFrame) ||\r\n          (this.animation.direction === -1 && currentFrame <= this.needFrame)) {\r\n          this.animation.setSpeed(1);\r\n          this.animation.pause();\r\n        }\r\n      });\r\n\r\n      this.passwordInputField.helpers.onVisibilityClickAdditional = () => {\r\n        if(this.passwordInputField.helpers.passwordVisible) {\r\n          this.animation.setDirection(1);\r\n          this.animation.curFrame = 0;\r\n          this.needFrame = 16;\r\n          this.animation.play();\r\n        } else {\r\n          this.animation.setDirection(-1);\r\n          this.animation.curFrame = 16;\r\n          this.needFrame = 0;\r\n          this.animation.play();\r\n        }\r\n      };\r\n\r\n      return lottieLoader.waitForFirstFrame(_animation);\r\n    });\r\n  }\r\n\r\n  public remove() {\r\n    if(this.animation) {\r\n      this.animation.remove();\r\n    }\r\n  }\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nexport default function htmlToSpan(html: string | DocumentFragment) {\r\n  const span = document.createElement('span');\r\n  if(typeof(html) === 'string') span.innerHTML = html;\r\n  else span.append(html);\r\n  return span;\r\n}\r\n"],"names":["PasswordInputHelpers","container","input","e","cancelEvent","Icon","stealthy","toggleVisible","PasswordInputField","InputField","options","PasswordMonkey","passwordInputField","size","lottieLoader","_animation","currentFrame","htmlToSpan","html","span"],"mappings":"wIAUO,MAAMA,CAAqB,CAKhC,YAAmBC,EAA+BC,EAAyB,CAAxD,KAAA,UAAAD,EAA+B,KAAA,MAAAC,EAJlD,KAAO,gBAAkB,GAoClB,KAAA,kBAAqBC,GAAa,CACvCC,EAAYD,CAAC,EACR,KAAA,gBAAkB,CAAC,KAAK,gBAE7B,KAAK,cAAc,gBAAgBE,EAAK,KAAK,gBAAkB,OAAS,MAAM,CAAC,EAC9E,KAAK,MAA2B,KAAO,KAAK,gBAAkB,OAAS,WACxE,KAAK,8BAA8B,CAAA,EArCnCH,EAAM,KAAO,WACPA,EAAA,aAAa,WAAY,EAAE,EACjCA,EAAM,KAAO,qBACbA,EAAM,aAAe,MAGf,MAAAI,EAAW,SAAS,cAAc,OAAO,EACtCA,EAAA,UAAU,IAAI,UAAU,EACjCA,EAAS,SAAW,GACpBA,EAAS,KAAO,WACVJ,EAAA,cAAc,QAAQI,CAAQ,EACpCJ,EAAM,cAAc,aAAaI,EAAS,YAAaJ,EAAM,WAAW,EASxE,MAAMK,EAAgB,KAAK,cAAgB,SAAS,cAAc,MAAM,EAC1DA,EAAA,UAAU,IAAI,gBAAgB,EAC9BA,EAAA,OAAOF,EAAK,MAAM,CAAC,EAEvBJ,EAAA,UAAU,IAAI,sBAAsB,EAC9CA,EAAU,OAAOM,CAAa,EAEhBA,EAAA,iBAAiB,QAAS,KAAK,iBAAiB,EAChDA,EAAA,iBAAiB,WAAY,KAAK,iBAAiB,CACnE,CAUF,CAEA,MAAqBC,UAA2BC,CAAW,CAGzD,YAAYC,EAA6B,GAAI,CACrC,MAAA,CACJ,UAAW,GACX,GAAGA,CAAA,CACJ,EAED,KAAK,QAAU,IAAIV,EAAqB,KAAK,UAAW,KAAK,KAAyB,CACxF,CACF,CC1DA,MAAqBW,CAAe,CAMlC,YAAsBC,EAAkDC,EAAc,CAAhE,KAAA,mBAAAD,EAAkD,KAAA,KAAAC,EAHxE,KAAO,UAAY,EAIZ,KAAA,UAAY,SAAS,cAAc,KAAK,EACxC,KAAA,UAAU,UAAU,IAAI,uBAAuB,CACtD,CAEO,MAAO,CACZ,OAAG,KAAK,YAAoB,KAAK,YAC1B,KAAK,YAAcC,EAAa,qBAAqB,CAC1D,UAAW,KAAK,UAChB,KAAM,GACN,SAAU,GACV,MAAO,KAAK,KACZ,OAAQ,KAAK,KACb,QAAS,EAER,EAAA,0BAA0B,EAAE,KAAMC,IAEnC,KAAK,UAAYA,EACZ,KAAA,UAAU,iBAAiB,aAA8BC,GAAA,EAGxD,KAAK,UAAU,YAAc,GAAKA,GAAgB,KAAK,WACxD,KAAK,UAAU,YAAc,IAAMA,GAAgB,KAAK,aACpD,KAAA,UAAU,SAAS,CAAC,EACzB,KAAK,UAAU,QACjB,CACD,EAEI,KAAA,mBAAmB,QAAQ,4BAA8B,IAAM,CAC/D,KAAK,mBAAmB,QAAQ,iBAC5B,KAAA,UAAU,aAAa,CAAC,EAC7B,KAAK,UAAU,SAAW,EAC1B,KAAK,UAAY,GACjB,KAAK,UAAU,SAEV,KAAA,UAAU,aAAa,EAAE,EAC9B,KAAK,UAAU,SAAW,GAC1B,KAAK,UAAY,EACjB,KAAK,UAAU,OACjB,EAGKF,EAAa,kBAAkBC,CAAU,EACjD,CACH,CAEO,QAAS,CACX,KAAK,WACN,KAAK,UAAU,QAEnB,CACF,CC7DA,SAAwBE,EAAWC,EAAiC,CAC5D,MAAAC,EAAO,SAAS,cAAc,MAAM,EAC1C,OAAG,OAAOD,GAAU,SAAUC,EAAK,UAAYD,EAC1CC,EAAK,OAAOD,CAAI,EACdC,CACT"}