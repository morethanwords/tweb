{"version":3,"file":"874.81e5be65ebb5526c5c8e.chunk.js","mappings":"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O,KAAO,MAAO,KAAO,MAAO,KAAO,MAAO,KAAO,KAAM,KAAO,MAAO,KAAO,MAAO,KAAO,MAAO,KAAO,MAAO,KAAO,MAAO,KAAO,MAAO,KAAO,MAAO,KAAO,MAAO,KAAO,MAAO,KAAO,MAAO,KAAO,MAAO,KAAO,MAAO,KAAO,MAAO,KAAO,MAAO,KAAO,KAAM,KAAO,KAAM,KAAO,MAAO,KAAO,MAAO,KAAO,MAAO,KAAO,MAAO,KAAO,MAAO,KAAO,MAAO,KAAO,MAAO,KAAO,MAAO,YAAY,MAAO,YAAY,MAAO,YAAY,MAAO,YAAY,MAAO,YAAY,MAAO,YAAY,MAAO,YAAY,MAAO,YAAY,MAAO,YAAY,MAAO,YAAY,MAAO,YAAY,MAAO,YAAY,MAAO,OAAO,MAAO,OAAO,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,KAAM,QAAQ,MAAO,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,MAAO,QAAQ,KAAM,QAAQ,MAAO,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,MAAO,QAAQ,MAAO,QAAQ,KAAM,QAAQ,MAAO,QAAQ,MAAO,QAAQ,KAAM,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,KAAM,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,KAAM,kBAAkB,KAAM,kBAAkB,KAAM,QAAQ,KAAM,kBAAkB,KAAM,kBAAkB,KAAM,QAAQ,KAAM,QAAQ,MAAO,QAAQ,MAAO,QAAQ,KAAM,QAAQ,MAAO,QAAQ,MAAO,kBAAkB,KAAM,kBAAkB,KAAM,QAAQ,KAAM,kBAAkB,KAAM,kBAAkB,KAAM,QAAQ,KAAM,kBAAkB,KAAM,kBAAkB,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,MAAO,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,MAAO,QAAQ,KAAM,QAAQ,KAAM,mBAAmB,MAAO,kBAAkB,MAAO,QAAQ,MAAO,kBAAkB,MAAO,4CAA4C,MAAO,4CAA4C,MAAO,4CAA4C,MAAO,QAAQ,MAAO,QAAQ,KAAM,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,kBAAkB,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,mBAAmB,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,kBAAkB,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,mBAAmB,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,mBAAmB,KAAM,mBAAmB,KAAM,mBAAmB,KAAM,mBAAmB,KAAM,mBAAmB,KAAM,mBAAmB,KAAM,mBAAmB,KAAM,mBAAmB,KAAM,8BAA8B,KAAM,mBAAmB,KAAM,8BAA8B,KAAM,8BAA8B,KAAM,mBAAmB,KAAM,8BAA8B,KAAM,yCAAyC,KAAM,8BAA8B,KAAM,yCAAyC,KAAM,yCAAyC,KAAM,8BAA8B,KAAM,yCAAyC,KAAM,8BAA8B,KAAM,yCAAyC,KAAM,yCAAyC,KAAM,mBAAmB,KAAM,mBAAmB,KAAM,mBAAmB,KAAM,mBAAmB,KAAM,mBAAmB,KAAM,mBAAmB,KAAM,mBAAmB,KAAM,mBAAmB,KAAM,mBAAmB,KAAM,mBAAmB,KAAM,mBAAmB,KAAM,mBAAmB,KAAM,mBAAmB,KAAM,kBAAkB,KAAM,kBAAkB,KAAM,kBAAkB,KAAM,6BAA6B,KAAM,wCAAwC,KAAM,QAAQ,KAAM,mBAAmB,KAAM,mBAAmB,KAAM,mBAAmB,KAAM,mBAAmB,KAAM,mBAAmB,KAAM,mBAAmB,KAAM,mBAAmB,KAAM,mBAAmB,KAAM,8BAA8B,KAAM,mBAAmB,KAAM,8BAA8B,KAAM,8BAA8B,KAAM,mBAAmB,KAAM,8BAA8B,KAAM,yCAAyC,KAAM,8BAA8B,KAAM,yCAAyC,KAAM,yCAAyC,KAAM,mBAAmB,KAAM,mBAAmB,KAAM,mBAAmB,KAAM,mBAAmB,KAAM,mBAAmB,KAAM,mBAAmB,KAAM,mBAAmB,KAAM,mBAAmB,KAAM,mBAAmB,KAAM,mBAAmB,KAAM,mBAAmB,KAAM,mBAAmB,KAAM,mBAAmB,KAAM,kBAAkB,KAAM,kBAAkB,KAAM,kBAAkB,KAAM,6BAA6B,KAAM,6BAA6B,KAAM,wCAAwC,KAAM,wCAAwC,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,kBAAkB,KAAM,kBAAkB,KAAM,QAAQ,KAAM,kBAAkB,KAAM,kBAAkB,KAAM,QAAQ,KAAM,kBAAkB,KAAM,kBAAkB,KAAM,QAAQ,KAAM,kBAAkB,KAAM,kBAAkB,KAAM,QAAQ,KAAM,QAAQ,KAAM,kBAAkB,KAAM,kBAAkB,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,kBAAkB,KAAM,kBAAkB,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,kBAAkB,KAAM,kBAAkB,KAAM,QAAQ,KAAM,kBAAkB,KAAM,kBAAkB,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,MAAO,QAAQ,KAAM,kBAAkB,KAAM,kBAAkB,KAAM,QAAQ,KAAM,kBAAkB,KAAM,kBAAkB,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,MAAO,QAAQ,MAAO,QAAQ,KAAM,QAAQ,KAAM,QAAQ,MAAO,QAAQ,MAAO,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,MAAO,QAAQ,MAAO,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,MAAO,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,KAAM,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,KAAM,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,MAAO,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,MAAO,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,kBAAkB,KAAM,kBAAkB,KAAM,QAAQ,KAAM,QAAQ,MAAO,QAAQ,KAAM,QAAQ,KAAM,QAAQ,MAAO,QAAQ,KAAM,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,MAAO,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,MAAO,QAAQ,GAAI,QAAQ,GAAI,QAAQ,GAAI,QAAQ,GAAI,QAAQ,GAAI,QAAQ,GAAI,QAAQ,GAAI,QAAQ,IAAK,QAAQ,KAAM,QAAQ,IAAK,QAAQ,IAAK,QAAQ,IAAK,QAAQ,IAAK,QAAQ,IAAK,QAAQ,IAAK,QAAQ,IAAK,QAAQ,IAAK,QAAQ,IAAK,QAAQ,IAAK,QAAQ,IAAK,QAAQ,IAAK,QAAQ,IAAK,QAAQ,IAAK,QAAQ,IAAK,QAAQ,IAAK,QAAQ,IAAK,QAAQ,IAAK,QAAQ,IAAK,QAAQ,IAAK,QAAQ,IAAK,QAAQ,IAAK,QAAQ,IAAK,QAAQ,KAAM,QAAQ,KAAM,QAAQ,IAAK,QAAQ,IAAK,QAAQ,IAAK,QAAQ,IAAK,QAAQ,IAAK,QAAQ,IAAK,QAAQ,IAAK,QAAQ,IAAK,QAAQ,IAAK,QAAQ,IAAK,QAAQ,IAAK,QAAQ,IAAK,mBAAmB,IAAK,QAAQ,IAAK,QAAQ,IAAK,QAAQ,IAAK,QAAQ,IAAK,QAAQ,IAAK,QAAQ,IAAK,QAAQ,IAAK,mBAAmB,IAAK,QAAQ,IAAK,mBAAmB,IAAK,QAAQ,IAAK,QAAQ,IAAK,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,IAAK,QAAQ,GAAI,QAAQ,IAAK,QAAQ,IAAK,kBAAkB,KAAM,kBAAkB,KAAM,QAAQ,KAAM,kBAAkB,KAAM,kBAAkB,KAAM,QAAQ,KAAM,kBAAkB,KAAM,kBAAkB,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,kBAAkB,KAAM,kBAAkB,KAAM,QAAQ,KAAM,QAAQ,KAAM,kBAAkB,KAAM,kBAAkB,KAAM,QAAQ,KAAM,kBAAkB,KAAM,kBAAkB,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,kBAAkB,KAAM,kBAAkB,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,KAAM,QAAQ,MAAO,kBAAkB,KAAM,kBAAkB,KAAM,QAAQ,KAAM,kBAAkB,KAAM,kBAAkB,KAAM,QAAQ,KAAM,kBAAkB,KAAM,kBAAkB,KAAM,QAAQ,KAAM,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,KAAM,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,KAAM,QAAQ,MAAO,QAAQ,KAAM,QAAQ,MAAO,QAAQ,MAAO,QAAQ,KAAM,QAAQ,MAAO,QAAQ,KAAM,QAAQ,KAAM,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,MAAO,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,IAAK,QAAQ,IAAK,QAAQ,IAAK,QAAQ,IAAK,QAAQ,IAAK,QAAQ,IAAK,QAAQ,KAAM,QAAQ,IAAK,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,IAAK,QAAQ,KAAM,QAAQ,IAAK,QAAQ,GAAI,QAAQ,IAAK,QAAQ,IAAK,kBAAkB,KAAM,kBAAkB,KAAM,QAAQ,KAAM,QAAQ,IAAK,QAAQ,IAAK,QAAQ,IAAK,QAAQ,IAAK,QAAQ,IAAK,QAAQ,KAAM,QAAQ,IAAK,QAAQ,IAAK,QAAQ,IAAK,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,kBAAkB,KAAM,kBAAkB,KAAM,QAAQ,KAAM,QAAQ,KAAM,kBAAkB,KAAM,kBAAkB,KAAM,QAAQ,KAAM,kBAAkB,KAAM,kBAAkB,KAAM,QAAQ,KAAM,kBAAkB,KAAM,kBAAkB,KAAM,QAAQ,KAAM,QAAQ,KAAM,kBAAkB,KAAM,kBAAkB,KAAM,QAAQ,KAAM,kBAAkB,KAAM,kBAAkB,KAAM,QAAQ,KAAM,kBAAkB,KAAM,kBAAkB,KAAM,QAAQ,KAAM,QAAQ,MAAO,QAAQ,KAAM,QAAQ,MAAO,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,IAAK,QAAQ,IAAK,QAAQ,IAAK,QAAQ,IAAK,QAAQ,IAAK,QAAQ,IAAK,QAAQ,IAAK,QAAQ,KAAM,QAAQ,IAAK,QAAQ,IAAK,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,MAAO,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,kBAAkB,KAAM,kBAAkB,KAAM,QAAQ,KAAM,kBAAkB,KAAM,kBAAkB,KAAM,QAAQ,KAAM,QAAQ,MAAO,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,kBAAkB,KAAM,kBAAkB,KAAM,QAAQ,KAAM,kBAAkB,KAAM,kBAAkB,KAAM,QAAQ,KAAM,kBAAkB,KAAM,kBAAkB,KAAM,QAAQ,KAAM,QAAQ,IAAK,mBAAmB,KAAM,mBAAmB,KAAM,mBAAmB,KAAM,mBAAmB,KAAM,mBAAmB,KAAM,mBAAmB,KAAM,mBAAmB,KAAM,mBAAmB,KAAM,mBAAmB,KAAM,mBAAmB,KAAM,mBAAmB,KAAM,mBAAmB,KAAM,mBAAmB,KAAM,mBAAmB,KAAM,mBAAmB,KAAM,8BAA8B,KAAM,mBAAmB,KAAM,mBAAmB,KAAM,mBAAmB,KAAM,mBAAmB,KAAM,mBAAmB,KAAM,mBAAmB,KAAM,mBAAmB,KAAM,kBAAkB,KAAM,kBAAkB,KAAM,kBAAkB,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,kBAAkB,KAAM,kBAAkB,KAAM,QAAQ,KAAM,QAAQ,KAAM,kBAAkB,KAAM,kBAAkB,KAAM,QAAQ,KAAM,kBAAkB,KAAM,kBAAkB,KAAM,QAAQ,KAAM,kBAAkB,KAAM,kBAAkB,KAAM,QAAQ,KAAM,kBAAkB,KAAM,kBAAkB,KAAM,QAAQ,KAAM,kBAAkB,KAAM,kBAAkB,KAAM,QAAQ,KAAM,kBAAkB,KAAM,kBAAkB,KAAM,QAAQ,KAAM,kBAAkB,KAAM,kBAAkB,KAAM,QAAQ,KAAM,kBAAkB,KAAM,kBAAkB,KAAM,QAAQ,KAAM,kBAAkB,KAAM,kBAAkB,KAAM,QAAQ,KAAM,kBAAkB,KAAM,kBAAkB,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,KAAM,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,KAAM,QAAQ,MAAO,QAAQ,KAAM,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,KAAM,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,KAAM,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,OAAO,MAAO,OAAO,MAAO,OAAO,MAAO,OAAO,KAAM,OAAO,KAAM,OAAO,MAAO,OAAO,MAAO,OAAO,MAAO,OAAO,MAAO,OAAO,MAAO,OAAO,MAAO,OAAO,MAAO,OAAO,MAAO,OAAO,KAAM,OAAO,KAAM,OAAO,KAAM,OAAO,KAAM,OAAO,MAAO,OAAO,MAAO,OAAO,MAAO,OAAO,MAAO,OAAO,MAAO,OAAO,MAAO,OAAO,MAAO,OAAO,MAAO,OAAO,MAAO,OAAO,MAAO,OAAO,MAAO,OAAO,MAAO,OAAO,MAAO,OAAO,KAAM,OAAO,MAAO,OAAO,MAAO,OAAO,MAAO,OAAO,IAAK,OAAO,MAAO,OAAO,MAAO,OAAO,MAAO,OAAO,MAAO,OAAO,MAAO,OAAO,MAAO,OAAO,MAAO,OAAO,MAAO,OAAO,MAAO,OAAO,MAAO,OAAO,MAAO,OAAO,MAAO,OAAO,MAAO,OAAO,MAAO,OAAO,MAAO,OAAO,MAAO,OAAO,MAAO,OAAO,MAAO,OAAO,MAAO,OAAO,MAAO,OAAO,MAAO,OAAO,MAAO,OAAO,KAAM,OAAO,KAAO,OAAO,MAAO,OAAO,MAAO,OAAO,MAAO,OAAO,MAAO,OAAO,MAAO,OAAO,KAAM,OAAO,KAAM,OAAO,KAAM,OAAO,MAAO,OAAO,KAAM,OAAO,MAAO,OAAO,KAAM,OAAO,KAAM,OAAO,KAAM,OAAO,MAAO,iBAAiB,KAAM,iBAAiB,KAAM,OAAO,KAAM,OAAO,KAAM,OAAO,KAAM,OAAO,KAAM,OAAO,KAAM,OAAO,KAAM,OAAO,KAAM,OAAO,MAAO,OAAO,MAAO,OAAO,MAAO,OAAO,MAAO,kBAAkB,KAAM,kBAAkB,KAAM,OAAO,MAAO,OAAO,MAAO,OAAO,MAAO,OAAO,MAAO,OAAO,MAAO,OAAO,MAAO,OAAO,MAAO,OAAO,MAAO,OAAO,KAAM,OAAO,MAAO,OAAO,MAAO,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,aAAa,EAAG,aAAa,EAAG,aAAa,EAAG,aAAa,EAAG,aAAa,EAAG,uBAAuB,EAAG,uBAAuB,EAAG,uBAAuB,EAAG,uBAAuB,EAAG,uBAAuB,EAAG,uBAAuB,EAAG,uBAAuB,EAAG,uBAAuB,EAAG,uBAAuB,EAAG,uBAAuB,EAAG,aAAa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","sources":["webpack://tweb/./src/components/animationIntersector.ts","webpack://tweb/./src/components/appMediaPlaybackController.ts","webpack://tweb/./src/components/appMediaViewer.ts","webpack://tweb/./src/lib/mediaPlayer.ts","webpack://tweb/./src/components/appMediaViewerBase.ts","webpack://tweb/./src/helpers/fillPropertyValue.ts","webpack://tweb/./src/components/appNavigationController.ts","webpack://tweb/./src/components/appSearch.ts","webpack://tweb/./src/components/appSearchSuper..ts","webpack://tweb/./src/helpers/dom/lockTouchScroll.ts","webpack://tweb/./src/components/appSelectPeers.ts","webpack://tweb/./src/components/audio.ts","webpack://tweb/./src/helpers/avatarListLoader.ts","webpack://tweb/./src/components/appMediaViewerAvatar.ts","webpack://tweb/./src/components/avatar.ts","webpack://tweb/./src/components/avatarEdit.ts","webpack://tweb/./src/components/button.ts","webpack://tweb/./src/components/buttonCorner.ts","webpack://tweb/./src/components/buttonIcon.ts","webpack://tweb/./src/components/buttonMenu.ts","webpack://tweb/./src/components/buttonMenuToggle.ts","webpack://tweb/./src/components/chat/gradientRenderer.ts","webpack://tweb/./src/components/chat/replyContainer.ts","webpack://tweb/./src/components/chat/selection.ts","webpack://tweb/./src/helpers/dom/getSelectedText.ts","webpack://tweb/./src/components/checkboxField.ts","webpack://tweb/./src/components/codeInputField.ts","webpack://tweb/./src/components/confirmationPopup.ts","webpack://tweb/./src/components/countryInputField.ts","webpack://tweb/./src/components/divAndCaption.ts","webpack://tweb/./src/components/editPeer.ts","webpack://tweb/./src/components/emoticonsDropdown/tabs/gifs.ts","webpack://tweb/./src/components/sidebarRight/tabs/gifs.ts","webpack://tweb/./src/components/sidebarRight/tabs/stickers.ts","webpack://tweb/./src/components/emoticonsDropdown/index.ts","webpack://tweb/./src/components/emoticonsDropdown/tabs/emoji.ts","webpack://tweb/./src/lib/richTextProcessor/wrapSingleEmoji.ts","webpack://tweb/./src/components/lazyLoadQueueRepeat.ts","webpack://tweb/./src/components/emoticonsDropdown/tabs/stickers.ts","webpack://tweb/./src/components/generateFakeIcon.ts","webpack://tweb/./src/components/lazyLoadQueueRepeat2.ts","webpack://tweb/./src/components/gifsMasonry.ts","webpack://tweb/./src/components/horizontalMenu.ts","webpack://tweb/./src/components/inputField.ts","webpack://tweb/./src/helpers/dom/selectElementContents.ts","webpack://tweb/./src/components/inputSearch.ts","webpack://tweb/./src/components/lazyLoadQueue.ts","webpack://tweb/./src/components/lazyLoadQueueIntersector.ts","webpack://tweb/./src/components/mediaProgressLine.ts","webpack://tweb/./src/components/middleEllipsis.ts","webpack://tweb/./src/components/monkeys/password.ts","webpack://tweb/./src/components/monkeys/tracking.ts","webpack://tweb/./src/components/passwordInputField.ts","webpack://tweb/./src/components/peerProfileAvatars.ts","webpack://tweb/./src/components/peerProfile.ts","webpack://tweb/./src/components/generateTitleIcons.ts","webpack://tweb/./src/components/generateVerifiedIcon.ts","webpack://tweb/./src/components/generatePremiumIcon.ts","webpack://tweb/./src/components/peerTitle.ts","webpack://tweb/./src/components/popups/avatar.ts","webpack://tweb/./src/lib/cropper.ts","webpack://tweb/./src/components/popups/deleteDialog.ts","webpack://tweb/./src/components/popups/deleteMessages.ts","webpack://tweb/./src/components/popups/forward.ts","webpack://tweb/./src/components/popups/index.ts","webpack://tweb/./src/components/popups/mute.ts","webpack://tweb/./src/components/popups/peer.ts","webpack://tweb/./src/components/popups/pickUser.ts","webpack://tweb/./src/components/popups/sendNow.ts","webpack://tweb/./src/components/popups/stickers.ts","webpack://tweb/./src/components/preloader.ts","webpack://tweb/./src/components/groupedLayout.ts","webpack://tweb/./src/components/prepareAlbum.ts","webpack://tweb/./src/components/putPhoto.ts","webpack://tweb/./src/components/wrappers/getPeerInitials.ts","webpack://tweb/./src/components/putPreloader.ts","webpack://tweb/./src/components/radioField.ts","webpack://tweb/./src/components/radioForm.ts","webpack://tweb/./src/components/rangeSelector.ts","webpack://tweb/./src/components/ripple.ts","webpack://tweb/./src/components/row.ts","webpack://tweb/./src/components/scrollable.ts","webpack://tweb/./src/components/sidebarLeft/tabs/newGroup.ts","webpack://tweb/./src/lib/appManagers/utils/privacy/privacyType.ts","webpack://tweb/./src/lib/appManagers/utils/privacy/getPrivacyRulesDetails.ts","webpack://tweb/./src/components/privacySection.ts","webpack://tweb/./src/components/sidebarLeft/tabs/privacy/phoneNumber.ts","webpack://tweb/./src/helpers/dom/anchorCopy.ts","webpack://tweb/./src/components/sidebarLeft/tabs/2fa/passwordSet.ts","webpack://tweb/./src/helpers/dom/canFocus.ts","webpack://tweb/./src/components/sidebarLeft/tabs/2fa/emailConfirmation.ts","webpack://tweb/./src/components/sidebarLeft/tabs/2fa/email.ts","webpack://tweb/./src/components/sidebarLeft/tabs/2fa/hint.ts","webpack://tweb/./src/components/sidebarLeft/tabs/2fa/reEnterPassword.ts","webpack://tweb/./src/components/sidebarLeft/tabs/2fa/enterPassword.ts","webpack://tweb/./src/components/sidebarLeft/tabs/2fa/index.ts","webpack://tweb/./src/components/sidebarLeft/tabs/privacy/lastSeen.ts","webpack://tweb/./src/components/sidebarLeft/tabs/privacy/profilePhoto.ts","webpack://tweb/./src/components/sidebarLeft/tabs/privacy/forwardMessages.ts","webpack://tweb/./src/components/sidebarLeft/tabs/privacy/addToGroups.ts","webpack://tweb/./src/components/sidebarLeft/tabs/privacy/calls.ts","webpack://tweb/./src/components/sidebarLeft/tabs/activeSessions.ts","webpack://tweb/./src/components/sidebarLeft/tabs/blockedUsers.ts","webpack://tweb/./src/helpers/string/convertKeyToInputKey.ts","webpack://tweb/./src/components/sidebarLeft/tabs/privacy/voices.ts","webpack://tweb/./src/components/sidebarLeft/tabs/privacyAndSecurity.ts","webpack://tweb/./src/helpers/averageColor.ts","webpack://tweb/./src/helpers/highlightningColor.ts","webpack://tweb/./src/components/colorPicker.ts","webpack://tweb/./src/components/sidebarLeft/tabs/backgroundColor.ts","webpack://tweb/./src/components/sidebarLeft/tabs/background.ts","webpack://tweb/./src/helpers/files/requestFile.ts","webpack://tweb/./src/components/sidebarLeft/tabs/quickReaction.ts","webpack://tweb/./src/components/sidebarLeft/tabs/generalSettings.ts","webpack://tweb/./src/helpers/eachMinute.ts","webpack://tweb/./src/helpers/eachTimeout.ts","webpack://tweb/./src/components/sidebarLeft/tabs/editProfile.ts","webpack://tweb/./src/components/sidebarLeft/tabs/notifications.ts","webpack://tweb/./src/components/sidebarLeft/tabs/language.ts","webpack://tweb/./src/components/sidebarLeft/tabs/autoDownload/photo.ts","webpack://tweb/./src/components/sidebarLeft/tabs/autoDownload/file.ts","webpack://tweb/./src/components/sidebarLeft/tabs/autoDownload/video.ts","webpack://tweb/./src/components/sidebarLeft/tabs/dataAndStorage.ts","webpack://tweb/./src/components/sidebarLeft/tabs/settings.ts","webpack://tweb/./src/components/sidebarLeft/tabs/newChannel.ts","webpack://tweb/./src/components/popups/createContact.ts","webpack://tweb/./src/components/sidebarLeft/tabs/contacts.ts","webpack://tweb/./src/components/sidebarLeft/tabs/archivedTab.ts","webpack://tweb/./src/components/sidebarLeft/tabs/peopleNearby.ts","webpack://tweb/./src/components/sidebarLeft/index.ts","webpack://tweb/./src/components/sidebarLeft/tabs/addMembers.ts","webpack://tweb/./src/components/sidebarLeft/tabs/chatFolders.ts","webpack://tweb/./src/components/sidebarLeft/tabs/includedChats.ts","webpack://tweb/./src/components/sidebarLeft/tabs/editFolder.ts","webpack://tweb/./src/components/sidebarRight/index.ts","webpack://tweb/./src/components/sidebarRight/tabs/editContact.ts","webpack://tweb/./src/components/sidebarRight/tabs/chatType.ts","webpack://tweb/./src/components/sidebarRight/tabs/userPermissions.ts","webpack://tweb/./src/components/sidebarRight/tabs/groupPermissions.ts","webpack://tweb/./src/lib/appManagers/utils/chats/combineParticipantBannedRights.ts","webpack://tweb/./src/components/sidebarRight/tabs/chatReactions.ts","webpack://tweb/./src/components/sidebarRight/tabs/editChat.ts","webpack://tweb/./src/components/sidebarRight/tabs/sharedMedia.ts","webpack://tweb/./src/components/singleTransition.ts","webpack://tweb/./src/components/slider.ts","webpack://tweb/./src/components/sliderTab.ts","webpack://tweb/./src/components/sortedUserList.ts","webpack://tweb/./src/components/stackedAvatars.ts","webpack://tweb/./src/components/stickerViewer.ts","webpack://tweb/./src/components/stickyIntersector.ts","webpack://tweb/./src/components/swipeHandler.ts","webpack://tweb/./src/components/telInputField.ts","webpack://tweb/./src/components/toast.ts","webpack://tweb/./src/components/transition.ts","webpack://tweb/./src/lib/richTextProcessor/isUsernameValid.ts","webpack://tweb/./src/components/usernameInputField.ts","webpack://tweb/./src/components/visibilityIntersector.ts","webpack://tweb/./src/components/volumeSelector.ts","webpack://tweb/./src/components/wrappers/photo.ts","webpack://tweb/./src/components/wrappers/video.ts","webpack://tweb/./src/components/wrappers/album.ts","webpack://tweb/./src/components/wrappers/document.ts","webpack://tweb/./src/components/wrappers/groupedDocuments.ts","webpack://tweb/./src/components/sidebarRight/tabs/pollResults.ts","webpack://tweb/./src/components/poll.ts","webpack://tweb/./src/components/wrappers/poll.ts","webpack://tweb/./src/components/wrappers/reply.ts","webpack://tweb/./src/components/wrappers/stickerSetThumb.ts","webpack://tweb/./src/components/wrappers/stickerToRow.ts","webpack://tweb/./src/components/wrappers/formatUserPhone.ts","webpack://tweb/./src/components/wrappers/getChatMembersString.ts","webpack://tweb/./src/components/wrappers/getPeerTitle.ts","webpack://tweb/./src/components/wrappers/getUserStatusString.ts","webpack://tweb/./src/components/wrappers/joinVoiceChatAnchor.ts","webpack://tweb/./src/components/wrappers/messageActionTextNewUnsafe.ts","webpack://tweb/./src/components/wrappers/messageActionTextNew.ts","webpack://tweb/./src/components/wrappers/messageForReply.ts","webpack://tweb/./src/components/wrappers/peerTitle.ts","webpack://tweb/./src/components/wrappers/senderToPeer.ts","webpack://tweb/./src/components/wrappers/sentTime.ts","webpack://tweb/./src/components/wrappers/sticker.ts","webpack://tweb/./src/helpers/bytes/getPathFromBytes.ts","webpack://tweb/./src/helpers/computeLockColor.ts","webpack://tweb/./src/components/wrappers/stickerAnimation.ts","webpack://tweb/./src/components/wrappers/stickerEmoji.ts","webpack://tweb/./src/components/wrappers/webPageDescription.ts","webpack://tweb/./src/components/wrappers/webPageTitle.ts","webpack://tweb/./src/config/currencies.ts","webpack://tweb/./src/config/emoji.ts","webpack://tweb/./src/config/font.ts","webpack://tweb/./src/helpers/animation.ts","webpack://tweb/./src/helpers/array/accumulate.ts","webpack://tweb/./src/helpers/array/filterAsync.ts","webpack://tweb/./src/helpers/array/findAndSpliceAll.ts","webpack://tweb/./src/helpers/audioAssetPlayer.ts","webpack://tweb/./src/helpers/blob/readBlobAsDataURL.ts","webpack://tweb/./src/helpers/heavyQueue.ts","webpack://tweb/./src/helpers/blur.ts","webpack://tweb/./src/helpers/bytes/getPreviewURLFromBytes.ts","webpack://tweb/./src/helpers/bytes/bytesToDataURL.ts","webpack://tweb/./src/helpers/calcImageInBox.ts","webpack://tweb/./src/helpers/canvas/getTextWidth.ts","webpack://tweb/./src/helpers/canvas/scaleMediaElement.ts","webpack://tweb/./src/helpers/cleanSearchText.ts","webpack://tweb/./src/helpers/clipboard.ts","webpack://tweb/./src/helpers/contextMenuController.ts","webpack://tweb/./src/helpers/date.ts","webpack://tweb/./src/helpers/dom/attachContextMenuListener.ts","webpack://tweb/./src/helpers/dom/attachGrabListeners.ts","webpack://tweb/./src/helpers/dom/cancelSelection.ts","webpack://tweb/./src/helpers/dom/clickEvent.ts","webpack://tweb/./src/helpers/dom/controlsHover.ts","webpack://tweb/./src/helpers/dom/createStickersContextMenu.ts","webpack://tweb/./src/helpers/dom/createContextMenu.ts","webpack://tweb/./src/helpers/dom/createVideo.ts","webpack://tweb/./src/helpers/dom/customProperties.ts","webpack://tweb/./src/helpers/dom/dispatchEvent.ts","webpack://tweb/./src/helpers/dom/documentFragmentToHTML.ts","webpack://tweb/./src/helpers/dom/findUpAsChild.ts","webpack://tweb/./src/helpers/dom/findUpAttribute.ts","webpack://tweb/./src/helpers/dom/findUpTag.ts","webpack://tweb/./src/helpers/dom/fullScreen.ts","webpack://tweb/./src/helpers/dom/getRichElementValue.ts","webpack://tweb/./src/helpers/dom/getRichValue.ts","webpack://tweb/./src/helpers/dom/getViewportSlice.ts","webpack://tweb/./src/helpers/dom/getVisibleRect.ts","webpack://tweb/./src/helpers/dom/handleHorizontalSwipe.ts","webpack://tweb/./src/helpers/dom/handleTabSwipe.ts","webpack://tweb/./src/helpers/dom/htmlToDocumentFragment.ts","webpack://tweb/./src/helpers/dom/htmlToSpan.ts","webpack://tweb/./src/helpers/dom/isInDOM.ts","webpack://tweb/./src/helpers/dom/isInputEmpty.ts","webpack://tweb/./src/helpers/dom/isSendShortcutPressed.ts","webpack://tweb/./src/helpers/dom/isSwipingBackSafari.ts","webpack://tweb/./src/helpers/dom/placeCaretAtEnd.ts","webpack://tweb/./src/helpers/dom/positionElementByIndex.ts","webpack://tweb/./src/helpers/dom/renderImageFromUrl.ts","webpack://tweb/./src/helpers/dom/renderMediaWithFadeIn.ts","webpack://tweb/./src/helpers/dom/replaceContent.ts","webpack://tweb/./src/helpers/dom/setInnerHTML.ts","webpack://tweb/./src/helpers/dom/toggleDisability.ts","webpack://tweb/./src/helpers/dom/whichChild.ts","webpack://tweb/./src/helpers/dropdownHover.ts","webpack://tweb/./src/helpers/fastSmoothScroll.ts","webpack://tweb/./src/helpers/fileName.ts","webpack://tweb/./src/helpers/filterChatPhotosMessages.ts","webpack://tweb/./src/helpers/formatBytes.ts","webpack://tweb/./src/helpers/formatCallDuration.ts","webpack://tweb/./src/helpers/formatDuration.ts","webpack://tweb/./src/helpers/formatPhoneNumber.ts","webpack://tweb/./src/helpers/generatePathData.ts","webpack://tweb/./src/helpers/getImageFromStrippedThumb.ts","webpack://tweb/./src/helpers/getPreviewURLFromThumb.ts","webpack://tweb/./src/helpers/getStrippedThumbIfNeeded.ts","webpack://tweb/./src/helpers/listLoader.ts","webpack://tweb/./src/helpers/listenerSetter.ts","webpack://tweb/./src/helpers/mediaSize.ts","webpack://tweb/./src/helpers/mediaSizes.ts","webpack://tweb/./src/helpers/middlewarePromise.ts","webpack://tweb/./src/helpers/number/clamp.ts","webpack://tweb/./src/helpers/number/formatNumber.ts","webpack://tweb/./src/helpers/number/numberThousandSplitter.ts","webpack://tweb/./src/helpers/onMediaLoad.ts","webpack://tweb/./src/helpers/overlayClickHandler.ts","webpack://tweb/./src/helpers/paymentsWrapCurrencyAmount.ts","webpack://tweb/./src/helpers/positionMenu.ts","webpack://tweb/./src/helpers/restrictions.ts","webpack://tweb/./src/helpers/saveLottiePreview.ts","webpack://tweb/./src/helpers/schedulers/throttleWithRaf.ts","webpack://tweb/./src/helpers/schedulers/throttleWith.ts","webpack://tweb/./src/helpers/scrollableLoader.ts","webpack://tweb/./src/helpers/searchListLoader.ts","webpack://tweb/./src/lib/appManagers/utils/messageId/incrementMessageId.ts","webpack://tweb/./src/helpers/sequentialDom.ts","webpack://tweb/./src/helpers/setAttachmentSize.ts","webpack://tweb/./src/helpers/sortedList.ts","webpack://tweb/./src/helpers/string/encodeEntities.ts","webpack://tweb/./src/helpers/string/escapeRegExp.ts","webpack://tweb/./src/helpers/string/limitSymbols.ts","webpack://tweb/./src/helpers/string/toHHMMSS.ts","webpack://tweb/./src/helpers/windowSize.ts","webpack://tweb/./src/hooks/useHeavyAnimationCheck.ts","webpack://tweb/./src/components/dialogsContextMenu.ts","webpack://tweb/./src/components/connectionStatus.ts","webpack://tweb/./src/components/sendingStatus.ts","webpack://tweb/./src/helpers/easing/easeInOutSine.ts","webpack://tweb/./src/helpers/canvas/roundRect.ts","webpack://tweb/./src/components/groupCallActiveIcon.ts","webpack://tweb/./src/helpers/canvas/shimmer.ts","webpack://tweb/./src/helpers/dialogsPlaceholder.ts","webpack://tweb/./src/helpers/canvas/drawCircle.ts","webpack://tweb/./src/lib/appManagers/appDialogsManager.ts","webpack://tweb/./src/lib/appManagers/appDownloadManager.ts","webpack://tweb/./src/helpers/dom/createDownloadAnchor.ts","webpack://tweb/./src/components/chat/bubbleGroups.ts","webpack://tweb/./src/helpers/array/partition.ts","webpack://tweb/./src/components/popups/datePicker.ts","webpack://tweb/./src/components/chat/reaction.ts","webpack://tweb/./src/components/chat/reactions.ts","webpack://tweb/./src/components/chat/replies.ts","webpack://tweb/./src/components/chat/messageRender.ts","webpack://tweb/./src/helpers/dom/getElementByPoint.ts","webpack://tweb/./src/helpers/dom/reflowScrollableElement.ts","webpack://tweb/./src/lib/mtproto/constants.ts","webpack://tweb/./src/lib/appManagers/internalLink.ts","webpack://tweb/./src/components/popups/joinChatInvite.ts","webpack://tweb/./src/helpers/scrollSaver.ts","webpack://tweb/./src/helpers/dom/superIntersectionObserver.ts","webpack://tweb/./src/lib/appManagers/utils/messages/isMentionUnread.ts","webpack://tweb/./src/helpers/cacheCallback.ts","webpack://tweb/./src/helpers/string/replaceNonNumber.ts","webpack://tweb/./src/helpers/cards/cardBrands.ts","webpack://tweb/./src/helpers/array/createArray.ts","webpack://tweb/./src/helpers/string/buggedNumbers.ts","webpack://tweb/./src/helpers/cards/patternCharacters.ts","webpack://tweb/./src/helpers/cards/cardFormattingPatterns.ts","webpack://tweb/./src/helpers/cards/formatValueByPattern.ts","webpack://tweb/./src/helpers/cards/validateCard.ts","webpack://tweb/./src/helpers/string/nbsp.ts","webpack://tweb/./src/components/popups/paymentVerification.ts","webpack://tweb/./src/components/popups/paymentCard.ts","webpack://tweb/./src/helpers/cards/formatInputValueByPattern.ts","webpack://tweb/./src/components/popups/paymentCardConfirmation.ts","webpack://tweb/./src/components/popups/paymentShipping.ts","webpack://tweb/./src/components/popups/paymentShippingMethods.ts","webpack://tweb/./src/components/popups/payment.ts","webpack://tweb/./src/components/chat/bubbles.ts","webpack://tweb/./src/helpers/dom/copyFromElement.ts","webpack://tweb/./src/components/popups/unpinMessage.ts","webpack://tweb/./src/helpers/dom/isSelectionEmpty.ts","webpack://tweb/./src/helpers/preloadAnimatedEmojiSticker.ts","webpack://tweb/./src/components/popups/reportMessagesConfirm.ts","webpack://tweb/./src/components/popups/reportMessages.ts","webpack://tweb/./src/components/popups/sponsored.ts","webpack://tweb/./src/components/popups/reactedList.ts","webpack://tweb/./src/components/chat/reactionsMenu.ts","webpack://tweb/./src/components/chat/contextMenu.ts","webpack://tweb/./src/components/chat/sendContextMenu.ts","webpack://tweb/./src/components/popups/createPoll.ts","webpack://tweb/./src/helpers/createPoster.ts","webpack://tweb/./src/helpers/getGifDuration.ts","webpack://tweb/./src/components/popups/newMedia.ts","webpack://tweb/./src/helpers/dom/attachListNavigation.ts","webpack://tweb/./src/components/chat/autocompleteHelper.ts","webpack://tweb/./src/components/chat/stickersHelper.ts","webpack://tweb/./src/components/popups/schedule.ts","webpack://tweb/./src/helpers/dom/getRichValueWithCaret.ts","webpack://tweb/./src/components/chat/emojiHelper.ts","webpack://tweb/./src/components/chat/autocompletePeerHelper.ts","webpack://tweb/./src/components/chat/commandsHelper.ts","webpack://tweb/./src/components/chat/autocompleteHelperController.ts","webpack://tweb/./src/components/chat/mentionsHelper.ts","webpack://tweb/./src/components/chat/replyKeyboard.ts","webpack://tweb/./src/components/chat/inlineHelper.ts","webpack://tweb/./src/components/chat/botCommands.ts","webpack://tweb/./src/helpers/modifyAckedResult.ts","webpack://tweb/./src/components/chat/sendAs.ts","webpack://tweb/./src/components/inputFieldAnimated.ts","webpack://tweb/./src/components/chat/input.ts","webpack://tweb/./src/components/wrappers/draft.ts","webpack://tweb/./src/helpers/dom/setCaretAt.ts","webpack://tweb/./src/components/chat/pinnedContainer.ts","webpack://tweb/./src/components/chat/pinnedMessageBorder.ts","webpack://tweb/./src/components/chat/audio.ts","webpack://tweb/./src/components/chat/pinnedMessage.ts","webpack://tweb/./src/helpers/dom/handleScrollSideEvent.ts","webpack://tweb/./src/components/chat/topbar.ts","webpack://tweb/./src/components/sidebarRight/tabs/search.ts","webpack://tweb/./src/components/chat/search.ts","webpack://tweb/./src/components/chat/patternRenderer.ts","webpack://tweb/./src/components/chat/chat.ts","webpack://tweb/./src/helpers/autoDownload.ts","webpack://tweb/./src/components/chat/markupTooltip.ts","webpack://tweb/./src/helpers/dom/getSelectedNodes.ts","webpack://tweb/./src/components/chat/dragAndDrop.ts","webpack://tweb/./src/helpers/dom/disableTransition.ts","webpack://tweb/./src/components/lineBlobDrawable.ts","webpack://tweb/./src/components/topbarWeave.ts","webpack://tweb/./src/lib/rlottie/rlottieIcon.ts","webpack://tweb/./src/components/superIcon.ts","webpack://tweb/./src/components/groupCall/microphoneIcon.ts","webpack://tweb/./src/components/groupCall/participantMutedIcon.ts","webpack://tweb/./src/components/groupCall/index.ts","webpack://tweb/./src/components/groupCall/participantStatus.ts","webpack://tweb/./src/components/groupCall/participantsList.ts","webpack://tweb/./src/components/call/videoCanvasBlur.ts","webpack://tweb/./src/components/groupCall/participantVideo.ts","webpack://tweb/./src/components/groupCall/participantVideos.ts","webpack://tweb/./src/components/groupCall/participants.ts","webpack://tweb/./src/components/groupCall/description.ts","webpack://tweb/./src/components/groupCall/title.ts","webpack://tweb/./src/components/call/button.ts","webpack://tweb/./src/components/movableElement.ts","webpack://tweb/./src/helpers/movablePanel.ts","webpack://tweb/./src/helpers/toggleClassName.ts","webpack://tweb/./src/components/call/description.ts","webpack://tweb/./src/components/groupCall/microphoneIconMini.ts","webpack://tweb/./src/components/call/index.ts","webpack://tweb/./src/components/topbarCall.ts","webpack://tweb/./src/lib/appManagers/uiNotificationsManager.ts","webpack://tweb/./src/helpers/files/getFilesFromEvent.ts","webpack://tweb/./src/lib/appManagers/appImManager.ts","webpack://tweb/./src/lib/appManagers/utils/messages/getMediaFromMessage.ts","webpack://tweb/./src/lib/appManagers/utils/messages/getMessageSenderPeerIdOrName.ts","webpack://tweb/./src/lib/appManagers/utils/messages/isMessageRestricted.ts","webpack://tweb/./src/lib/appManagers/utils/peers/getPeerColorById.ts","webpack://tweb/./src/lib/appManagers/utils/photos/choosePhotoSize.ts","webpack://tweb/./src/lib/calls/callConnectionInstanceBase.ts","webpack://tweb/./src/lib/calls/helpers/createPeerConnection.ts","webpack://tweb/./src/lib/calls/helpers/createDataChannel.ts","webpack://tweb/./src/lib/calls/helpers/parseSignalingData.ts","webpack://tweb/./src/lib/calls/callConnectionInstance.ts","webpack://tweb/./src/lib/crypto/subtle.ts","webpack://tweb/./src/lib/calls/p2P/p2PEncryptor.ts","webpack://tweb/./src/lib/crypto/utils/sha256.ts","webpack://tweb/./src/lib/calls/p2P/chromeP2PSdpBuilder.ts","webpack://tweb/./src/lib/calls/p2P/p2PSdpBuilder.js","webpack://tweb/./src/lib/calls/p2P/firefoxP2PSdpBuilder.js","webpack://tweb/./src/lib/calls/p2P/safariP2PSdpBuilder.js","webpack://tweb/./src/lib/calls/callInstance.ts","webpack://tweb/./src/lib/calls/p2P/getCallProtocol.ts","webpack://tweb/./src/lib/calls/p2P/getRtcConfiguration.ts","webpack://tweb/./src/lib/calls/helpers/getStreamCached.ts","webpack://tweb/./src/lib/calls/callInstanceBase.ts","webpack://tweb/./src/lib/calls/callState.ts","webpack://tweb/./src/components/call/getAudioAsset.ts","webpack://tweb/./src/lib/calls/callsController.ts","webpack://tweb/./src/lib/calls/constants.ts","webpack://tweb/./src/lib/calls/groupCallConnectionInstance.ts","webpack://tweb/./src/lib/calls/helpers/processMediaSection.ts","webpack://tweb/./src/lib/calls/helpers/filterServerCodecs.ts","webpack://tweb/./src/lib/calls/helpers/fixLocalOffer.ts","webpack://tweb/./src/lib/calls/groupCallInstance.ts","webpack://tweb/./src/lib/calls/groupCallState.ts","webpack://tweb/./src/components/groupCall/getAudioAsset.ts","webpack://tweb/./src/lib/calls/groupCallsController.ts","webpack://tweb/./src/lib/calls/helpers/createMainStreamManager.ts","webpack://tweb/./src/lib/calls/helpers/getAudioConstraints.ts","webpack://tweb/./src/environment/constraintSupport.ts","webpack://tweb/./src/lib/calls/helpers/getScreenConstraints.ts","webpack://tweb/./src/lib/calls/helpers/getScreenStream.ts","webpack://tweb/./src/lib/calls/helpers/getStream.ts","webpack://tweb/./src/lib/calls/helpers/getVideoConstraints.ts","webpack://tweb/./src/lib/calls/helpers/parseMediaSectionInfo.ts","webpack://tweb/./src/lib/calls/helpers/parseSourceGroups.ts","webpack://tweb/./src/lib/calls/helpers/stopTrack.ts","webpack://tweb/./src/lib/calls/localConferenceDescription.ts","webpack://tweb/./src/lib/calls/sdp/index.ts","webpack://tweb/./src/helpers/string/splitStringByLimitWithRest.ts","webpack://tweb/./src/helpers/uniqueNumberGenerator.ts","webpack://tweb/./src/lib/calls/sdp/attributeSplitted.ts","webpack://tweb/./src/lib/calls/sdp/mediaLineParts.ts","webpack://tweb/./src/lib/calls/sdp/line.ts","webpack://tweb/./src/lib/calls/sdp/attributeInner.ts","webpack://tweb/./src/lib/calls/sdp/attributes.ts","webpack://tweb/./src/lib/calls/sdp/mediaSection.ts","webpack://tweb/./src/lib/calls/sdp/sessionSection.ts","webpack://tweb/./src/lib/calls/sdp/utils.ts","webpack://tweb/./src/lib/calls/sdpBuilder.ts","webpack://tweb/./src/lib/calls/streamManager.ts","webpack://tweb/./src/lib/calls/stringFromLineBuilder.ts","webpack://tweb/./src/lib/calls/utils.ts","webpack://tweb/./src/lib/richTextProcessor/getAbbreviation.ts","webpack://tweb/./src/lib/richTextProcessor/getEmojiEntityFromEmoji.ts","webpack://tweb/./src/lib/richTextProcessor/matchEmail.ts","webpack://tweb/./src/lib/richTextProcessor/wrapDraftText.ts","webpack://tweb/./src/lib/richTextProcessor/wrapEmojiText.ts","webpack://tweb/./src/lib/richTextProcessor/setBlankToAnchor.ts","webpack://tweb/./src/environment/emojiVersionsSupport.ts","webpack://tweb/./src/lib/richTextProcessor/wrapRichText.ts","webpack://tweb/./src/helpers/buildURLHash.ts","webpack://tweb/./src/lib/rlottie/queryableWorker.ts","webpack://tweb/./src/environment/webAssemblySupport.ts","webpack://tweb/./src/lib/rlottie/lottieLoader.ts","webpack://tweb/./src/environment/imageBitmapSupport.ts","webpack://tweb/./src/helpers/framesCache.ts","webpack://tweb/./src/lib/rlottie/rlottiePlayer.ts","webpack://tweb/./src/pages/pagesManager.ts","webpack://tweb/./src/pages/page.ts","webpack://tweb/./src/vendor/emoji/index.ts","webpack://tweb/./public/recorder.min.js"],"sourcesContent":["/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport {CustomEmojiRendererElement} from '../lib/richTextProcessor/wrapRichText';\r\nimport rootScope from '../lib/rootScope';\r\nimport {IS_SAFARI} from '../environment/userAgent';\r\nimport {MOUNT_CLASS_TO} from '../config/debug';\r\nimport isInDOM from '../helpers/dom/isInDOM';\r\nimport RLottiePlayer from '../lib/rlottie/rlottiePlayer';\r\nimport indexOfAndSplice from '../helpers/array/indexOfAndSplice';\r\nimport forEachReverse from '../helpers/array/forEachReverse';\r\nimport idleController from '../helpers/idleController';\r\nimport appMediaPlaybackController from './appMediaPlaybackController';\r\nimport {fastRaf} from '../helpers/schedulers';\r\n\r\nexport type AnimationItemGroup = '' | 'none' | 'chat' | 'lock' |\r\n  'STICKERS-POPUP' | 'emoticons-dropdown' | 'STICKERS-SEARCH' | 'GIFS-SEARCH' |\r\n  `CHAT-MENU-REACTIONS-${number}` | 'INLINE-HELPER' | 'GENERAL-SETTINGS' | 'STICKER-VIEWER' | 'EMOJI';\r\nexport interface AnimationItem {\r\n  el: HTMLElement,\r\n  group: AnimationItemGroup,\r\n  animation: AnimationItemWrapper\r\n};\r\n\r\nexport interface AnimationItemWrapper {\r\n  remove: () => void;\r\n  paused: boolean;\r\n  pause: () => any;\r\n  play: () => any;\r\n  autoplay: boolean;\r\n  // onVisibilityChange?: (visible: boolean) => boolean;\r\n};\r\n\r\nexport class AnimationIntersector {\r\n  private observer: IntersectionObserver;\r\n  private visible: Set<AnimationItem> = new Set();\r\n\r\n  private overrideIdleGroups: Set<string>;\r\n  private byGroups: {[group in AnimationItemGroup]?: AnimationItem[]} = {};\r\n  private lockedGroups: {[group in AnimationItemGroup]?: true} = {};\r\n  private onlyOnePlayableGroup: AnimationItemGroup = '';\r\n\r\n  private intersectionLockedGroups: {[group in AnimationItemGroup]?: true} = {};\r\n  private videosLocked = false;\r\n\r\n  constructor() {\r\n    this.observer = new IntersectionObserver((entries) => {\r\n      // if(rootScope.idle.isIDLE) return;\r\n\r\n      for(const entry of entries) {\r\n        const target = entry.target;\r\n\r\n        for(const group in this.byGroups) {\r\n          if(this.intersectionLockedGroups[group as AnimationItemGroup]) {\r\n            continue;\r\n          }\r\n\r\n          const animation = this.byGroups[group as AnimationItemGroup].find((p) => p.el === target);\r\n          if(!animation) {\r\n            continue;\r\n          }\r\n\r\n          if(entry.isIntersecting) {\r\n            this.visible.add(animation);\r\n            this.checkAnimation(animation, false);\r\n\r\n            /* if(animation instanceof HTMLVideoElement && animation.dataset.src) {\r\n              animation.src = animation.dataset.src;\r\n              animation.load();\r\n            } */\r\n          } else {\r\n            this.visible.delete(animation);\r\n            this.checkAnimation(animation, true);\r\n\r\n            const _animation = animation.animation;\r\n            if(_animation instanceof RLottiePlayer/*  && animation.cachingDelta === 2 */) {\r\n              // console.warn('will clear cache', player);\r\n              _animation.clearCache();\r\n            }/*  else if(animation instanceof HTMLVideoElement && animation.src) {\r\n              animation.dataset.src = animation.src;\r\n              animation.src = '';\r\n              animation.load();\r\n            } */\r\n          }\r\n\r\n          break;\r\n        }\r\n      }\r\n    });\r\n\r\n    this.overrideIdleGroups = new Set();\r\n\r\n    appMediaPlaybackController.addEventListener('play', ({doc}) => {\r\n      if(doc.type === 'round') {\r\n        this.videosLocked = true;\r\n        this.checkAnimations();\r\n      }\r\n    });\r\n\r\n    appMediaPlaybackController.addEventListener('pause', () => {\r\n      if(this.videosLocked) {\r\n        this.videosLocked = false;\r\n        this.checkAnimations();\r\n      }\r\n    });\r\n\r\n    idleController.addEventListener('change', (idle) => {\r\n      this.checkAnimations(idle);\r\n    });\r\n  }\r\n\r\n  public setOverrideIdleGroup(group: string, override: boolean) {\r\n    if(override) this.overrideIdleGroups.add(group);\r\n    else this.overrideIdleGroups.delete(group);\r\n  }\r\n\r\n  public getAnimations(element: HTMLElement) {\r\n    const found: AnimationItem[] = [];\r\n    for(const group in this.byGroups) {\r\n      for(const player of this.byGroups[group as AnimationItemGroup]) {\r\n        if(player.el === element) {\r\n          found.push(player);\r\n        }\r\n      }\r\n    }\r\n\r\n    return found;\r\n  }\r\n\r\n  public removeAnimation(player: AnimationItem) {\r\n    const {el, animation} = player;\r\n    animation.remove();\r\n\r\n    if(animation instanceof HTMLVideoElement && IS_SAFARI) {\r\n      setTimeout(() => { // TODO:   ,       \r\n        animation.src = '';\r\n        animation.load();\r\n      }, 1e3);\r\n    }\r\n\r\n    const group = this.byGroups[player.group];\r\n    if(group) {\r\n      indexOfAndSplice(group, player);\r\n      if(!group.length) {\r\n        delete this.byGroups[player.group];\r\n      }\r\n    }\r\n\r\n    this.observer.unobserve(el);\r\n    this.visible.delete(player);\r\n  }\r\n\r\n  public addAnimation(_animation: AnimationItem['animation'], group: AnimationItemGroup = '') {\r\n    if(group === 'none') {\r\n      return;\r\n    }\r\n\r\n    let el: HTMLElement;\r\n    if(_animation instanceof RLottiePlayer) {\r\n      el = _animation.el[0];\r\n    } else if(_animation instanceof CustomEmojiRendererElement) {\r\n      el = _animation.canvas;\r\n    } else if(_animation instanceof HTMLElement) {\r\n      el = _animation;\r\n    }\r\n\r\n    const animation: AnimationItem = {\r\n      el,\r\n      animation: _animation,\r\n      group\r\n    };\r\n\r\n    if(_animation instanceof RLottiePlayer) {\r\n      if(!rootScope.settings.stickers.loop && _animation.loop) {\r\n        _animation.loop = rootScope.settings.stickers.loop;\r\n      }\r\n    }\r\n\r\n    (this.byGroups[group as AnimationItemGroup] ??= []).push(animation);\r\n    this.observer.observe(animation.el);\r\n  }\r\n\r\n  public checkAnimations(blurred?: boolean, group?: AnimationItemGroup, destroy = false) {\r\n    // if(rootScope.idle.isIDLE) return;\r\n\r\n    if(group !== undefined && !this.byGroups[group]) {\r\n      // console.warn('no animation group:', group);\r\n      return;\r\n    }\r\n\r\n    const groups = group !== undefined /* && false */ ? [group] : Object.keys(this.byGroups) as AnimationItemGroup[];\r\n\r\n    for(const group of groups) {\r\n      const animations = this.byGroups[group];\r\n\r\n      forEachReverse(animations, (animation) => {\r\n        this.checkAnimation(animation, blurred, destroy);\r\n      });\r\n    }\r\n  }\r\n\r\n  public checkAnimation(player: AnimationItem, blurred = false, destroy = false) {\r\n    const {el, animation, group} = player;\r\n    // return;\r\n    if(destroy || (!this.lockedGroups[group] && !isInDOM(el))) {\r\n      this.removeAnimation(player);\r\n      return;\r\n    }\r\n\r\n    if(blurred ||\r\n      (this.onlyOnePlayableGroup && this.onlyOnePlayableGroup !== group) ||\r\n      (animation instanceof HTMLVideoElement && this.videosLocked)\r\n    ) {\r\n      if(!animation.paused) {\r\n        // console.warn('pause animation:', animation);\r\n        animation.pause();\r\n      }\r\n    } else if(animation.paused &&\r\n      this.visible.has(player) &&\r\n      animation.autoplay &&\r\n      (!this.onlyOnePlayableGroup || this.onlyOnePlayableGroup === group) &&\r\n      (!idleController.isIdle || this.overrideIdleGroups.has(player.group))\r\n    ) {\r\n      // console.warn('play animation:', animation);\r\n      animation.play();\r\n    }\r\n  }\r\n\r\n  public getOnlyOnePlayableGroup() {\r\n    return this.onlyOnePlayableGroup;\r\n  }\r\n\r\n  public setOnlyOnePlayableGroup(group: AnimationItemGroup = '') {\r\n    this.onlyOnePlayableGroup = group;\r\n  }\r\n\r\n  public lockGroup(group: AnimationItemGroup) {\r\n    this.lockedGroups[group] = true;\r\n  }\r\n\r\n  public unlockGroup(group: AnimationItemGroup) {\r\n    delete this.lockedGroups[group];\r\n    this.checkAnimations(undefined, group);\r\n  }\r\n\r\n  public refreshGroup(group: AnimationItemGroup) {\r\n    const animations = this.byGroups[group];\r\n    if(!animations?.length) {\r\n      return;\r\n    }\r\n\r\n    animations.forEach((animation) => {\r\n      this.observer.unobserve(animation.el);\r\n    });\r\n\r\n    fastRaf(() => {\r\n      animations.forEach((animation) => {\r\n        this.observer.observe(animation.el);\r\n      });\r\n    });\r\n  }\r\n\r\n  public lockIntersectionGroup(group: AnimationItemGroup) {\r\n    this.intersectionLockedGroups[group] = true;\r\n  }\r\n\r\n  public unlockIntersectionGroup(group: AnimationItemGroup) {\r\n    delete this.intersectionLockedGroups[group];\r\n    this.refreshGroup(group);\r\n  }\r\n}\r\n\r\nconst animationIntersector = new AnimationIntersector();\r\nMOUNT_CLASS_TO && (MOUNT_CLASS_TO.animationIntersector = animationIntersector);\r\nexport default animationIntersector;\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport rootScope from '../lib/rootScope';\r\nimport {MyDocument} from '../lib/appManagers/appDocsManager';\r\nimport deferredPromise, {CancellablePromise} from '../helpers/cancellablePromise';\r\nimport {IS_APPLE, IS_SAFARI} from '../environment/userAgent';\r\nimport {MOUNT_CLASS_TO} from '../config/debug';\r\nimport simulateEvent from '../helpers/dom/dispatchEvent';\r\nimport type {SearchSuperContext} from './appSearchSuper.';\r\nimport {Document, DocumentAttribute, Message, PhotoSize} from '../layer';\r\nimport IS_TOUCH_SUPPORTED from '../environment/touchSupport';\r\nimport I18n from '../lib/langPack';\r\nimport SearchListLoader from '../helpers/searchListLoader';\r\nimport copy from '../helpers/object/copy';\r\nimport deepEqual from '../helpers/object/deepEqual';\r\nimport ListenerSetter from '../helpers/listenerSetter';\r\nimport {AppManagers} from '../lib/appManagers/managers';\r\nimport getMediaFromMessage from '../lib/appManagers/utils/messages/getMediaFromMessage';\r\nimport getPeerTitle from './wrappers/getPeerTitle';\r\nimport appDownloadManager from '../lib/appManagers/appDownloadManager';\r\nimport onMediaLoad from '../helpers/onMediaLoad';\r\nimport EventListenerBase from '../helpers/eventListenerBase';\r\n\r\n// TODO: Safari:  ,          \r\n// TODO: Safari:     \r\n// TODO: Safari:  ,         -    \r\n\r\nexport type MediaItem = {mid: number, peerId: PeerId};\r\n\r\ntype HTMLMediaElement = HTMLAudioElement | HTMLVideoElement;\r\n\r\nconst SHOULD_USE_SAFARI_FIX = (() => {\r\n  try {\r\n    return IS_SAFARI && +navigator.userAgent.match(/ Version\\/(\\d+)/)[1] < 14;\r\n  } catch(err) {\r\n    return false;\r\n  }\r\n})();\r\n\r\nconst SEEK_OFFSET = 10;\r\n\r\nexport type MediaSearchContext = SearchSuperContext & Partial<{\r\n  isScheduled: boolean,\r\n  useSearch: boolean\r\n}>;\r\n\r\ntype MediaDetails = {\r\n  peerId: PeerId,\r\n  mid: number,\r\n  docId: DocId,\r\n  doc: MyDocument,\r\n  message: Message.message,\r\n  clean?: boolean,\r\n  isScheduled?: boolean,\r\n  isSingle?: boolean\r\n};\r\n\r\nexport type PlaybackMediaType = 'voice' | 'video' | 'audio';\r\n\r\nexport class AppMediaPlaybackController extends EventListenerBase<{\r\n  play: (details: ReturnType<AppMediaPlaybackController['getPlayingDetails']>) => void,\r\n  pause: () => void,\r\n  playbackParams: (params: ReturnType<AppMediaPlaybackController['getPlaybackParams']>) => void,\r\n  stop: () => void,\r\n}> {\r\n  private container: HTMLElement;\r\n  private media: Map<PeerId, Map<number, HTMLMediaElement>> = new Map();\r\n  private scheduled: AppMediaPlaybackController['media'] = new Map();\r\n  private mediaDetails: Map<HTMLMediaElement, MediaDetails> = new Map();\r\n  private playingMedia: HTMLMediaElement;\r\n  private playingMediaType: PlaybackMediaType;\r\n\r\n  private waitingMediaForLoad: Map<PeerId, Map<number, CancellablePromise<void>>> = new Map();\r\n  private waitingScheduledMediaForLoad: AppMediaPlaybackController['waitingMediaForLoad'] = new Map();\r\n  private waitingDocumentsForLoad: {[docId: string]: Set<HTMLMediaElement>} = {};\r\n\r\n  public willBePlayedMedia: HTMLMediaElement;\r\n  private searchContext: MediaSearchContext;\r\n\r\n  private listLoader: SearchListLoader<MediaItem>;\r\n\r\n  public volume: number;\r\n  public muted: boolean;\r\n  public playbackRate: number;\r\n  public loop: boolean;\r\n  public round: boolean;\r\n  private _volume: number;\r\n  private _muted: boolean;\r\n  private _playbackRate: number;\r\n  private _loop: boolean;\r\n  private _round: boolean;\r\n  private lockedSwitchers: boolean;\r\n  private playbackRates: Record<PlaybackMediaType, number> = {\r\n    voice: 1,\r\n    video: 1,\r\n    audio: 1\r\n  };\r\n\r\n  private pip: HTMLVideoElement;\r\n  private managers: AppManagers;\r\n  private skipMediaPlayEvent: boolean;\r\n\r\n  construct(managers: AppManagers) {\r\n    this.managers = managers;\r\n    this.container = document.createElement('div');\r\n    // this.container.style.cssText = 'position: absolute; top: -10000px; left: -10000px;';\r\n    this.container.style.cssText = 'display: none;';\r\n    document.body.append(this.container);\r\n\r\n    if(navigator.mediaSession) {\r\n      const actions: {[action in MediaSessionAction]?: MediaSessionActionHandler} = {\r\n        play: this.browserPlay,\r\n        pause: this.browserPause,\r\n        stop: this.browserStop,\r\n        seekbackward: this.browserSeekBackward,\r\n        seekforward: this.browserSeekForward,\r\n        seekto: this.browserSeekTo,\r\n        previoustrack: this.browserPrevious,\r\n        nexttrack: this.browserNext\r\n      };\r\n\r\n      for(const action in actions) {\r\n        try {\r\n          navigator.mediaSession.setActionHandler(action as MediaSessionAction, actions[action as MediaSessionAction]);\r\n        } catch(err) {\r\n          console.warn('MediaSession action is not supported:', action);\r\n        }\r\n      }\r\n    }\r\n\r\n    rootScope.addEventListener('document_downloaded', (docId) => {\r\n      const set = this.waitingDocumentsForLoad[docId];\r\n      if(set) {\r\n        for(const media of set) {\r\n          this.onMediaDocumentLoad(media);\r\n        }\r\n      }\r\n    });\r\n\r\n    rootScope.addEventListener('media_play', () => {\r\n      if(this.skipMediaPlayEvent) {\r\n        this.skipMediaPlayEvent = false;\r\n        return;\r\n      }\r\n\r\n      if(!this.pause() && this.pip) {\r\n        this.pip.pause();\r\n      }\r\n    });\r\n\r\n    const properties: {[key: PropertyKey]: PropertyDescriptor} = {};\r\n    const keys = [\r\n      'volume' as const,\r\n      'muted' as const,\r\n      'playbackRate' as const,\r\n      'loop' as const,\r\n      'round' as const\r\n    ];\r\n    keys.forEach((key) => {\r\n      const _key = ('_' + key) as `_${typeof key}`;\r\n      properties[key] = {\r\n        get: () => this[_key],\r\n        set: (value: number | boolean) => {\r\n          if(this[_key] === value) {\r\n            return;\r\n          }\r\n\r\n          // @ts-ignore\r\n          this[_key] = value;\r\n          if(this.playingMedia && (key !== 'loop' || this.playingMediaType === 'audio') && key !== 'round') {\r\n            // @ts-ignore\r\n            this.playingMedia[key] = value;\r\n          }\r\n\r\n          if(key === 'playbackRate' && this.playingMediaType !== undefined) {\r\n            this.playbackRates[this.playingMediaType] = value as number;\r\n          }\r\n\r\n          this.dispatchPlaybackParams();\r\n        }\r\n      };\r\n    });\r\n    Object.defineProperties(this, properties);\r\n  }\r\n\r\n  private dispatchPlaybackParams() {\r\n    this.dispatchEvent('playbackParams', this.getPlaybackParams());\r\n  }\r\n\r\n  public getPlaybackParams() {\r\n    const {volume, muted, playbackRate, playbackRates, loop, round} = this;\r\n    return {\r\n      volume,\r\n      muted,\r\n      playbackRate,\r\n      playbackRates,\r\n      loop,\r\n      round\r\n    };\r\n  }\r\n\r\n  public setPlaybackParams(params: ReturnType<AppMediaPlaybackController['getPlaybackParams']>) {\r\n    this.playbackRates = params.playbackRates;\r\n    this._volume = params.volume;\r\n    this._muted = params.muted;\r\n    this._playbackRate = params.playbackRate;\r\n    this._loop = params.loop;\r\n    this._round = params.round;\r\n  }\r\n\r\n  public seekBackward = (details: MediaSessionActionDetails, media = this.playingMedia) => {\r\n    if(media) {\r\n      media.currentTime = Math.max(0, media.currentTime - (details.seekOffset || SEEK_OFFSET));\r\n    }\r\n  };\r\n\r\n  public seekForward = (details: MediaSessionActionDetails, media = this.playingMedia) => {\r\n    if(media) {\r\n      media.currentTime = Math.min(media.duration, media.currentTime + (details.seekOffset || SEEK_OFFSET));\r\n    }\r\n  };\r\n\r\n  public seekTo = (details: MediaSessionActionDetails, media = this.playingMedia) => {\r\n    if(media) {\r\n      media.currentTime = details.seekTime;\r\n    }\r\n  };\r\n\r\n  public addMedia(message: Message.message, autoload: boolean, clean?: boolean): HTMLMediaElement {\r\n    const {peerId, mid} = message;\r\n\r\n    const isScheduled = !!message.pFlags.is_scheduled;\r\n    const s = isScheduled ? this.scheduled : this.media;\r\n    let storage = s.get(message.peerId);\r\n    if(!storage) {\r\n      s.set(message.peerId, storage = new Map());\r\n    }\r\n\r\n    let media = storage.get(mid);\r\n    if(media) {\r\n      return media;\r\n    }\r\n\r\n    const doc = getMediaFromMessage(message) as Document.document;\r\n    storage.set(mid, media = document.createElement(doc.type === 'round' || doc.type === 'video' ? 'video' : 'audio'));\r\n    // const source = document.createElement('source');\r\n    // source.type = doc.type === 'voice' && !opusDecodeController.isPlaySupported() ? 'audio/wav' : doc.mime_type;\r\n\r\n    if(doc.type === 'round') {\r\n      media.setAttribute('playsinline', 'true');\r\n      // media.muted = true;\r\n    }\r\n\r\n    const details: MediaDetails = {\r\n      peerId,\r\n      mid,\r\n      docId: doc.id,\r\n      doc,\r\n      message,\r\n      clean,\r\n      isScheduled: message.pFlags.is_scheduled\r\n    };\r\n\r\n    this.mediaDetails.set(media, details);\r\n\r\n    // media.autoplay = true;\r\n    media.volume = 1;\r\n    // media.append(source);\r\n\r\n    this.container.append(media);\r\n\r\n    media.addEventListener('play', this.onPlay);\r\n    media.addEventListener('pause', this.onPause);\r\n    media.addEventListener('ended', this.onEnded);\r\n\r\n    if(doc.type !== 'audio' && message?.pFlags.media_unread && message.fromId !== rootScope.myId) {\r\n      media.addEventListener('timeupdate', () => {\r\n        this.managers.appMessagesManager.readMessages(peerId, [mid]);\r\n      }, {once: true});\r\n    }\r\n\r\n    /* const onError = (e: Event) => {\r\n      //console.log('appMediaPlaybackController: video onError', e);\r\n\r\n      if(this.nextMid === mid) {\r\n        this.loadSiblingsMedia(peerId, doc.type as MediaType, mid).then(() => {\r\n          if(this.nextMid && storage[this.nextMid]) {\r\n            storage[this.nextMid].play();\r\n          }\r\n        });\r\n      }\r\n    };\r\n\r\n    media.addEventListener('error', onError); */\r\n\r\n    const deferred = deferredPromise<void>();\r\n    if(autoload) {\r\n      deferred.resolve();\r\n    } else {\r\n      const w = message.pFlags.is_scheduled ? this.waitingScheduledMediaForLoad : this.waitingMediaForLoad;\r\n      let waitingStorage = w.get(peerId);\r\n      if(!waitingStorage) {\r\n        w.set(peerId, waitingStorage = new Map());\r\n      }\r\n\r\n      waitingStorage.set(mid, deferred);\r\n    }\r\n\r\n    deferred.then(async() => {\r\n      // media.autoplay = true;\r\n      // console.log('will set media url:', media, doc, doc.type, doc.url);\r\n\r\n      if(doc.supportsStreaming || (await this.managers.thumbsStorage.getCacheContext(doc)).url) {\r\n        this.onMediaDocumentLoad(media);\r\n      } else {\r\n        let set = this.waitingDocumentsForLoad[doc.id];\r\n        if(!set) {\r\n          set = this.waitingDocumentsForLoad[doc.id] = new Set();\r\n        }\r\n\r\n        set.add(media);\r\n        appDownloadManager.downloadMediaURL({media: doc});\r\n      }\r\n    }/* , onError */);\r\n\r\n    return media;\r\n  }\r\n\r\n  public getMedia(peerId: PeerId, mid: number, isScheduled?: boolean) {\r\n    const s = (isScheduled ? this.scheduled : this.media).get(peerId);\r\n    return s?.get(mid);\r\n  }\r\n\r\n  private onMediaDocumentLoad = async(media: HTMLMediaElement) => {\r\n    const details = this.mediaDetails.get(media);\r\n    const doc = await this.managers.appDocsManager.getDoc(details.docId);\r\n    if(doc.type === 'audio' && doc.supportsStreaming && SHOULD_USE_SAFARI_FIX) {\r\n      this.handleSafariStreamable(media);\r\n    }\r\n\r\n    // setTimeout(() => {\r\n    const cacheContext = await this.managers.thumbsStorage.getCacheContext(doc);\r\n    media.src = cacheContext.url;\r\n\r\n    if(this.playingMedia === media) {\r\n      media.playbackRate = this.playbackRate;\r\n\r\n      if(doc.type === 'audio') {\r\n        media.loop = this.loop;\r\n      }\r\n    }\r\n    // }, doc.supportsStreaming ? 500e3 : 0);\r\n\r\n    const set = this.waitingDocumentsForLoad[doc.id];\r\n    if(set) {\r\n      set.delete(media);\r\n\r\n      if(!set.size) {\r\n        delete this.waitingDocumentsForLoad[doc.id];\r\n      }\r\n    }\r\n  };\r\n\r\n  // safari      ,\r\n  //         SW,     \r\n  private handleSafariStreamable(media: HTMLMediaElement) {\r\n    media.addEventListener('play', () => {\r\n      /* if(media.readyState === 4) { // https://developer.mozilla.org/ru/docs/Web/API/XMLHttpRequest/readyState\r\n        return;\r\n      } */\r\n\r\n      // media.volume = 0;\r\n      const currentTime = media.currentTime;\r\n      // this.setSafariBuffering(media, true);\r\n\r\n      media.addEventListener('progress', () => {\r\n        media.currentTime = media.duration - 1;\r\n\r\n        media.addEventListener('progress', () => {\r\n          media.currentTime = currentTime;\r\n          // media.volume = 1;\r\n          // this.setSafariBuffering(media, false);\r\n\r\n          if(!media.paused) {\r\n            media.play()/* .catch(() => {}) */;\r\n          }\r\n        }, {once: true});\r\n      }, {once: true});\r\n    }/* , {once: true} */);\r\n  }\r\n\r\n  public resolveWaitingForLoadMedia(peerId: PeerId, mid: number, isScheduled?: boolean) {\r\n    const w = isScheduled ? this.waitingScheduledMediaForLoad : this.waitingMediaForLoad;\r\n    const storage = w.get(peerId);\r\n    if(!storage) {\r\n      return;\r\n    }\r\n\r\n    const promise = storage.get(mid);\r\n    if(promise) {\r\n      promise.resolve();\r\n      storage.delete(mid);\r\n\r\n      if(!storage.size) {\r\n        w.delete(peerId);\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Only for audio\r\n   */\r\n  public isSafariBuffering(media: HTMLMediaElement) {\r\n    // @ts-ignore\r\n    return !!media.safariBuffering;\r\n  }\r\n\r\n  private setSafariBuffering(media: HTMLMediaElement, value: boolean) {\r\n    // @ts-ignore\r\n    media.safariBuffering = value;\r\n  }\r\n\r\n  private async setNewMediadata(message: Message.message, playingMedia = this.playingMedia) {\r\n    if(document.pictureInPictureElement) {\r\n      return;\r\n    }\r\n\r\n    await onMediaLoad(playingMedia, undefined, false); // have to wait for load, otherwise on macOS won't set\r\n\r\n    const doc = getMediaFromMessage(message) as MyDocument;\r\n\r\n    const artwork: MediaImage[] = [];\r\n\r\n    const isVoice = doc.type === 'voice' || doc.type === 'round';\r\n    let title = '', artist = '';\r\n\r\n    if(doc.thumbs?.length) {\r\n      const size = doc.thumbs[doc.thumbs.length - 1];\r\n      if(!(size as PhotoSize.photoStrippedSize).bytes) {\r\n        const cacheContext = await this.managers.thumbsStorage.getCacheContext(doc, size.type);\r\n\r\n        if(cacheContext.url) {\r\n          artwork.push({\r\n            src: cacheContext.url,\r\n            sizes: `${(size as PhotoSize.photoSize).w}x${(size as PhotoSize.photoSize).h}`,\r\n            type: 'image/jpeg'\r\n          });\r\n        } else {\r\n          const download = appDownloadManager.downloadMediaURL({media: doc, thumb: size});\r\n          download.then(() => {\r\n            if(this.playingMedia !== playingMedia || !cacheContext.url) {\r\n              return;\r\n            }\r\n\r\n            this.setNewMediadata(message);\r\n          });\r\n        }\r\n      }\r\n    } else if(isVoice) {\r\n      const peerId = message.fromId || message.peerId;\r\n      const peerPhoto = await this.managers.appPeersManager.getPeerPhoto(peerId);\r\n      if(peerPhoto) {\r\n        // const result = this.managers.appAvatarsManager.loadAvatar(peerId, peerPhoto, 'photo_small');\r\n        // if(result.cached) {\r\n        //   const url = await result.loadPromise;\r\n        //   artwork.push({\r\n        //     src: url,\r\n        //     sizes: '160x160',\r\n        //     type: 'image/jpeg'\r\n        //   });\r\n        // } else {\r\n        //   result.loadPromise.then((url) => {\r\n        //     if(this.playingMedia !== playingMedia || !url) {\r\n        //       return;\r\n        //     }\r\n\r\n        //     this.setNewMediadata(message);\r\n        //   });\r\n        // }\r\n      }\r\n\r\n      title = await getPeerTitle(peerId, true, false);\r\n      artist = I18n.format(doc.type === 'voice' ? 'AttachAudio' : 'AttachRound', true);\r\n    }\r\n\r\n    if(!isVoice) {\r\n      const attribute = doc.attributes.find((attribute) => attribute._ === 'documentAttributeAudio') as DocumentAttribute.documentAttributeAudio;\r\n      title = attribute?.title ?? doc.file_name;\r\n      artist = attribute?.performer;\r\n    }\r\n\r\n    if(!artwork.length) {\r\n      if(IS_APPLE) {\r\n        if(IS_TOUCH_SUPPORTED) {\r\n          artwork.push({\r\n            src: `assets/img/apple-touch-icon-precomposed.png`,\r\n            sizes: '180x180',\r\n            type: 'image/png'\r\n          });\r\n        } else {\r\n          artwork.push({\r\n            src: `assets/img/apple-touch-icon.png`,\r\n            sizes: '180x180',\r\n            type: 'image/png'\r\n          });\r\n        }\r\n      } else {\r\n        [72, 96, 144, 192, 256, 384, 512].forEach((size) => {\r\n          const sizes = `${size}x${size}`;\r\n          artwork.push({\r\n            src: `assets/img/android-chrome-${sizes}.png`,\r\n            sizes,\r\n            type: 'image/png'\r\n          });\r\n        });\r\n      }\r\n    }\r\n\r\n    const metadata = new MediaMetadata({\r\n      title,\r\n      artist,\r\n      artwork\r\n    });\r\n\r\n    navigator.mediaSession.metadata = metadata;\r\n  }\r\n\r\n  public setCurrentMediadata() {\r\n    const {playingMedia} = this;\r\n    if(!playingMedia) return;\r\n    const message = this.getMessageByMedia(playingMedia);\r\n    this.setNewMediadata(message, playingMedia);\r\n  }\r\n\r\n  private getMessageByMedia(media: HTMLMediaElement): Message.message {\r\n    const details = this.mediaDetails.get(media);\r\n    return details.message;\r\n    // const {peerId, mid} = details;\r\n    // const message = details.isScheduled ?\r\n    //   this.managers.appMessagesManager.getScheduledMessageByPeer(peerId, mid) :\r\n    //   this.managers.appMessagesManager.getMessageByPeer(peerId, mid);\r\n    // return message;\r\n  }\r\n\r\n  public getPlayingDetails() {\r\n    const {playingMedia} = this;\r\n    if(!playingMedia) {\r\n      return;\r\n    }\r\n\r\n    const message = this.getMessageByMedia(playingMedia);\r\n    return {\r\n      doc: getMediaFromMessage(message) as MyDocument,\r\n      message,\r\n      media: playingMedia,\r\n      playbackParams: this.getPlaybackParams()\r\n    };\r\n  }\r\n\r\n  private onPlay = (e?: Event) => {\r\n    const media = e.target as HTMLMediaElement;\r\n    const details = this.mediaDetails.get(media);\r\n    const {peerId, mid} = details;\r\n\r\n    // console.log('appMediaPlaybackController: video playing', this.currentPeerId, this.playingMedia, media);\r\n\r\n    const pip = this.pip;\r\n    if(pip) {\r\n      pip.pause();\r\n    }\r\n\r\n    const message = this.getMessageByMedia(media);\r\n\r\n    const previousMedia = this.playingMedia;\r\n    if(previousMedia !== media) {\r\n      this.stop();\r\n      this.setMedia(media, message);\r\n\r\n      const verify = (element: MediaItem) => element.mid === mid && element.peerId === peerId;\r\n      const listLoader = this.listLoader;\r\n      const current = listLoader.getCurrent();\r\n      if(!current || !verify(current)) {\r\n        let jumpLength: number;\r\n\r\n        for(const withOtherSide of [false, true]) {\r\n          const previous = listLoader.getPrevious(withOtherSide);\r\n\r\n          let idx = previous.findIndex(verify);\r\n          if(idx !== -1) {\r\n            jumpLength = -(previous.length - idx);\r\n          } else {\r\n            const next = listLoader.getNext(withOtherSide);\r\n            idx = next.findIndex(verify);\r\n            if(idx !== -1) {\r\n              jumpLength = idx + 1;\r\n            }\r\n          }\r\n\r\n          if(jumpLength !== undefined) {\r\n            break;\r\n          }\r\n        }\r\n\r\n        if(jumpLength) {\r\n          this.go(jumpLength, false);\r\n        } else {\r\n          this.setTargets({peerId, mid});\r\n        }\r\n      }\r\n    }\r\n\r\n    // audio_pause     \r\n    setTimeout(() => {\r\n      if(this.playingMedia !== media) {\r\n        return;\r\n      }\r\n\r\n      this.dispatchEvent('play', this.getPlayingDetails());\r\n      this.pauseMediaInOtherTabs();\r\n    }, 0);\r\n  };\r\n\r\n  private onPause = (e?: Event) => {\r\n    /* const target = e.target as HTMLMediaElement;\r\n    if(!isInDOM(target)) {\r\n      this.container.append(target);\r\n      target.play();\r\n      return;\r\n    } */\r\n\r\n    // if(this.pip) {\r\n    //   this.pip.play();\r\n    // }\r\n\r\n    this.dispatchEvent('pause');\r\n  };\r\n\r\n  private onEnded = (e?: Event) => {\r\n    if(!e.isTrusted) {\r\n      return;\r\n    }\r\n\r\n    this.onPause(e);\r\n\r\n    // console.log('on media end');\r\n\r\n    const listLoader = this.listLoader;\r\n    if(this.lockedSwitchers ||\r\n      (!this.round && listLoader.current && !listLoader.next.length) ||\r\n      !listLoader.getNext(true).length ||\r\n      !this.next()) {\r\n      this.stop();\r\n      this.dispatchEvent('stop');\r\n    }\r\n  };\r\n\r\n  public pauseMediaInOtherTabs() {\r\n    this.skipMediaPlayEvent = true;\r\n    rootScope.dispatchEvent('media_play');\r\n  }\r\n\r\n  // public get pip() {\r\n  //   return document.pictureInPictureElement as HTMLVideoElement;\r\n  // }\r\n\r\n  public toggle(play?: boolean, media = this.playingMedia) {\r\n    if(!media) {\r\n      return false;\r\n    }\r\n\r\n    if(play === undefined) {\r\n      play = media.paused;\r\n    }\r\n\r\n    if(media.paused !== play) {\r\n      return false;\r\n    }\r\n\r\n    if(play) {\r\n      media.play();\r\n    } else {\r\n      media.pause();\r\n    }\r\n\r\n    return true;\r\n  }\r\n\r\n  public play = () => {\r\n    return this.toggle(true);\r\n  };\r\n\r\n  public pause = () => {\r\n    return this.toggle(false);\r\n  };\r\n\r\n  public stop = (media = this.playingMedia) => {\r\n    if(!media) {\r\n      return false;\r\n    }\r\n\r\n    if(!media.paused) {\r\n      media.pause();\r\n    }\r\n\r\n    media.currentTime = 0;\r\n    simulateEvent(media, 'ended');\r\n\r\n    if(media === this.playingMedia) {\r\n      const details = this.mediaDetails.get(media);\r\n      if(details?.clean) {\r\n        media.src = '';\r\n        const peerId = details.peerId;\r\n        const s = details.isScheduled ? this.scheduled : this.media;\r\n        const storage = s.get(peerId);\r\n        if(storage) {\r\n          storage.delete(details.mid);\r\n\r\n          if(!storage.size) {\r\n            s.delete(peerId);\r\n          }\r\n        }\r\n\r\n        media.remove();\r\n\r\n        this.mediaDetails.delete(media);\r\n      }\r\n\r\n      this.playingMedia = undefined;\r\n      this.playingMediaType = undefined;\r\n    }\r\n\r\n    return true;\r\n  };\r\n\r\n  public playItem = (item: MediaItem) => {\r\n    const {peerId, mid} = item;\r\n    const isScheduled = this.searchContext.isScheduled;\r\n    const media = this.getMedia(peerId, mid, isScheduled);\r\n\r\n    /* if(isSafari) {\r\n      media.autoplay = true;\r\n    } */\r\n\r\n    media.play();\r\n\r\n    setTimeout(() => {\r\n      this.resolveWaitingForLoadMedia(peerId, mid, isScheduled);\r\n    }, 0);\r\n  };\r\n\r\n  public go = (length: number, dispatchJump?: boolean) => {\r\n    const listLoader = this.listLoader;\r\n    if(this.lockedSwitchers || !listLoader) {\r\n      return;\r\n    }\r\n\r\n    if(this.playingMediaType === 'audio') {\r\n      return listLoader.goRound(length, dispatchJump);\r\n    } else {\r\n      return listLoader.go(length, dispatchJump);\r\n    }\r\n  };\r\n\r\n  private bindBrowserCallback(cb: (video: HTMLVideoElement, details: MediaSessionActionDetails) => void) {\r\n    const handler: MediaSessionActionHandler = (details) => {\r\n      cb(this.pip, details);\r\n    };\r\n\r\n    return handler;\r\n  }\r\n\r\n  public browserPlay = this.bindBrowserCallback((video) => this.toggle(true, video));\r\n  public browserPause = this.bindBrowserCallback((video) => this.toggle(false, video));\r\n  public browserStop = this.bindBrowserCallback((video) => this.stop(video));\r\n  public browserSeekBackward = this.bindBrowserCallback((video, details) => this.seekBackward(details, video));\r\n  public browserSeekForward = this.bindBrowserCallback((video, details) => this.seekForward(details, video));\r\n  public browserSeekTo = this.bindBrowserCallback((video, details) => this.seekTo(details, video));\r\n  public browserNext = this.bindBrowserCallback((video) => video || this.next());\r\n  public browserPrevious = this.bindBrowserCallback((video) => video ? this.seekToStart(video) : this.previous());\r\n\r\n  public next = () => {\r\n    return this.go(1);\r\n  };\r\n\r\n  public previous = () => {\r\n    if(this.seekToStart(this.playingMedia)) {\r\n      return;\r\n    }\r\n\r\n    return this.go(-1);\r\n  };\r\n\r\n  public seekToStart(media: HTMLMediaElement) {\r\n    if(media?.currentTime > 5) {\r\n      media.currentTime = 0;\r\n      this.toggle(true, media);\r\n      return true;\r\n    }\r\n\r\n    return false;\r\n  }\r\n\r\n  public willBePlayed(media: HTMLMediaElement) {\r\n    this.willBePlayedMedia = media;\r\n  }\r\n\r\n  public setSearchContext(context: MediaSearchContext) {\r\n    if(deepEqual(this.searchContext, context)) {\r\n      return false;\r\n    }\r\n\r\n    this.searchContext = copy(context); // {_: type === 'audio' ? 'inputMessagesFilterMusic' : 'inputMessagesFilterRoundVoice'}\r\n    return true;\r\n  }\r\n\r\n  public getSearchContext() {\r\n    return this.searchContext;\r\n  }\r\n\r\n  public setTargets(current: MediaItem, prev?: MediaItem[], next?: MediaItem[]) {\r\n    let listLoader = this.listLoader;\r\n    if(!listLoader) {\r\n      listLoader = this.listLoader = new SearchListLoader({\r\n        loadCount: 10,\r\n        loadWhenLeft: 5,\r\n        processItem: (message: Message.message) => {\r\n          this.addMedia(message, false);\r\n          return {peerId: message.peerId, mid: message.mid};\r\n        },\r\n        onJump: (item, older) => {\r\n          this.playItem(item);\r\n        },\r\n        onEmptied: () => {\r\n          this.dispatchEvent('stop');\r\n          this.stop();\r\n        }\r\n      });\r\n    } else {\r\n      listLoader.reset();\r\n    }\r\n\r\n    const reverse = this.searchContext.folderId !== undefined ? false : true;\r\n    if(prev) {\r\n      listLoader.setTargets(prev, next, reverse);\r\n    } else {\r\n      listLoader.reverse = reverse;\r\n    }\r\n\r\n    listLoader.setSearchContext(this.searchContext);\r\n    listLoader.current = current;\r\n\r\n    listLoader.load(true);\r\n    listLoader.load(false);\r\n  }\r\n\r\n  private getPlaybackMediaTypeFromMessage(message: Message.message) {\r\n    const doc = getMediaFromMessage(message) as MyDocument;\r\n    let mediaType: PlaybackMediaType = 'audio';\r\n    if(doc?.type) {\r\n      if(doc.type === 'voice' || doc.type === 'round') {\r\n        mediaType = 'voice';\r\n      } else if(doc.type === 'video') {\r\n        mediaType = 'video';\r\n      }\r\n    }\r\n\r\n    return mediaType;\r\n  }\r\n\r\n  public setMedia(media: HTMLMediaElement, message: Message.message) {\r\n    const mediaType = this.getPlaybackMediaTypeFromMessage(message);\r\n\r\n    this._playbackRate = this.playbackRates[mediaType];\r\n\r\n    this.playingMedia = media;\r\n    this.playingMediaType = mediaType;\r\n    this.playingMedia.volume = this.volume;\r\n    this.playingMedia.muted = this.muted;\r\n    this.playingMedia.playbackRate = this.playbackRate;\r\n\r\n    if(mediaType === 'audio') {\r\n      this.playingMedia.loop = this.loop;\r\n    }\r\n\r\n    if('mediaSession' in navigator) {\r\n      this.setNewMediadata(message);\r\n    }\r\n  }\r\n\r\n  public setSingleMedia(media?: HTMLMediaElement, message?: Message.message) {\r\n    const playingMedia = this.playingMedia;\r\n\r\n    const wasPlaying = this.pause();\r\n\r\n    let onPlay: () => void;\r\n    if(media) {\r\n      onPlay = () => {\r\n        const pip = this.pip;\r\n        if(pip) {\r\n          pip.pause();\r\n        }\r\n\r\n        this.pauseMediaInOtherTabs();\r\n      };\r\n\r\n      if(!media.paused) {\r\n        onPlay();\r\n      }\r\n\r\n      media.addEventListener('play', onPlay);\r\n    } else { // maybe it's voice recording\r\n      this.pauseMediaInOtherTabs();\r\n    }\r\n\r\n    this.willBePlayed(undefined);\r\n    if(media) this.setMedia(media, message);\r\n    else this.playingMedia = undefined;\r\n    this.toggleSwitchers(false);\r\n\r\n    return (playPaused = wasPlaying) => {\r\n      this.toggleSwitchers(true);\r\n\r\n      if(playingMedia) {\r\n        if(this.mediaDetails.get(playingMedia)) {\r\n          this.setMedia(playingMedia, this.getMessageByMedia(playingMedia));\r\n        } else {\r\n          this.next() || this.previous();\r\n        }\r\n      }\r\n\r\n      // If it's still not cleaned\r\n      if(this.playingMedia === media) {\r\n        this.playingMedia = undefined;\r\n        this.playingMediaType = undefined;\r\n      }\r\n\r\n      if(media) {\r\n        media.removeEventListener('play', onPlay);\r\n      }\r\n\r\n      // I don't remember what it was for\r\n      // if(media && this.playingMedia === media) {\r\n      //   this.stop();\r\n      // }\r\n\r\n      if(playPaused) {\r\n        this.play();\r\n      }\r\n    };\r\n  }\r\n\r\n  public toggleSwitchers(enabled: boolean) {\r\n    this.lockedSwitchers = !enabled;\r\n  }\r\n\r\n  public setPictureInPicture(video: HTMLVideoElement) {\r\n    this.pip = video;\r\n\r\n    // let wasPlaying = this.pause();\r\n\r\n    const listenerSetter = new ListenerSetter();\r\n    listenerSetter.add(video)('leavepictureinpicture', () => {\r\n      if(this.pip !== video) {\r\n        return;\r\n      }\r\n\r\n      this.pip = undefined;\r\n      // if(wasPlaying) {\r\n      //   this.play();\r\n      // }\r\n\r\n      listenerSetter.removeAll();\r\n    }, {once: true});\r\n\r\n    listenerSetter.add(video)('play', (e) => {\r\n      if(this.playingMedia !== video) {\r\n        this.pause();\r\n      }\r\n\r\n      this.pauseMediaInOtherTabs();\r\n      // if(this.pause()) {\r\n      //   listenerSetter.add(video)('pause', () => {\r\n      //     this.play();\r\n      //   }, {once: true});\r\n      // }\r\n    });\r\n  }\r\n}\r\n\r\nconst appMediaPlaybackController = new AppMediaPlaybackController();\r\nMOUNT_CLASS_TO.appMediaPlaybackController = appMediaPlaybackController;\r\nexport default appMediaPlaybackController;\r\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport MEDIA_MIME_TYPES_SUPPORTED from '../environment/mediaMimeTypesSupport';\nimport cancelEvent from '../helpers/dom/cancelEvent';\nimport {attachClickEvent, detachClickEvent} from '../helpers/dom/clickEvent';\nimport findUpClassName from '../helpers/dom/findUpClassName';\nimport findUpTag from '../helpers/dom/findUpTag';\nimport setInnerHTML from '../helpers/dom/setInnerHTML';\nimport mediaSizes from '../helpers/mediaSizes';\nimport SearchListLoader from '../helpers/searchListLoader';\nimport {Message} from '../layer';\nimport type {MyDocument} from '../lib/appManagers/appDocsManager';\nimport appDownloadManager from '../lib/appManagers/appDownloadManager';\nimport appImManager from '../lib/appManagers/appImManager';\nimport {MyMessage} from '../lib/appManagers/appMessagesManager';\nimport {MyPhoto} from '../lib/appManagers/appPhotosManager';\nimport getMediaFromMessage from '../lib/appManagers/utils/messages/getMediaFromMessage';\nimport wrapRichText from '../lib/richTextProcessor/wrapRichText';\nimport {MediaSearchContext} from './appMediaPlaybackController';\nimport AppMediaViewerBase, {MEDIA_VIEWER_CLASSNAME} from './appMediaViewerBase';\nimport {ButtonMenuItemOptions} from './buttonMenu';\nimport PopupDeleteMessages from './popups/deleteMessages';\nimport PopupForward from './popups/forward';\nimport Scrollable from './scrollable';\nimport appSidebarRight from './sidebarRight';\nimport AppSharedMediaTab from './sidebarRight/tabs/sharedMedia';\n\ntype AppMediaViewerTargetType = {\n  element: HTMLElement,\n  mid: number,\n  peerId: PeerId\n};\nexport default class AppMediaViewer extends AppMediaViewerBase<'caption', 'delete' | 'forward', AppMediaViewerTargetType> {\n  protected listLoader: SearchListLoader<AppMediaViewerTargetType>;\n  protected btnMenuForward: ButtonMenuItemOptions;\n  protected btnMenuDownload: ButtonMenuItemOptions;\n  protected btnMenuDelete: ButtonMenuItemOptions;\n\n  get searchContext() {\n    return this.listLoader.searchContext;\n  }\n\n  constructor() {\n    super(new SearchListLoader({\n      processItem: (item) => {\n        const isForDocument = this.searchContext.inputFilter._ === 'inputMessagesFilterDocument';\n        const {mid, peerId} = item;\n        const media: MyPhoto | MyDocument = getMediaFromMessage(item);\n\n        if(!media) return;\n\n        if(isForDocument && !AppMediaViewer.isMediaCompatibleForDocumentViewer(media)) {\n          return;\n        }\n\n        return {element: null as HTMLElement, mid, peerId};\n      }\n    }), ['delete', 'forward']);\n\n    this.listLoader.onEmptied = () => {\n      this.close();\n    };\n\n    /* const stub = document.createElement('div');\n    stub.classList.add(MEDIA_VIEWER_CLASSNAME + '-stub');\n    this.content.main.prepend(stub); */\n\n    this.content.caption = document.createElement('div');\n    this.content.caption.classList.add(MEDIA_VIEWER_CLASSNAME + '-caption', 'spoilers-container'/* , 'media-viewer-stub' */);\n\n    let captionTimeout: number;\n    const setCaptionTimeout = () => {\n      if(captionTimeout) {\n        clearTimeout(captionTimeout);\n      }\n\n      captionTimeout = window.setTimeout(() => {\n        captionTimeout = undefined;\n        this.content.caption.classList.remove('is-focused');\n      }, 800);\n    };\n    this.content.caption.addEventListener('touchstart', () => {\n      if(!mediaSizes.isMobile) return;\n\n      this.content.caption.classList.add('is-focused');\n\n      if(captionTimeout) {\n        clearTimeout(captionTimeout);\n        captionTimeout = undefined;\n      }\n\n      document.addEventListener('touchend', setCaptionTimeout, {once: true});\n    });\n\n    const captionScrollable = new Scrollable(this.content.caption);\n    captionScrollable.onAdditionalScroll = setCaptionTimeout;\n\n    // this.content.main.append(this.content.caption);\n    this.wholeDiv.append(this.content.caption);\n\n    attachClickEvent(this.buttons.delete, this.onDeleteClick);\n\n    const buttons: ButtonMenuItemOptions[] = [this.btnMenuForward = {\n      icon: 'forward',\n      text: 'Forward',\n      onClick: this.onForwardClick\n    }, this.btnMenuDownload = {\n      icon: 'download',\n      text: 'MediaViewer.Context.Download',\n      onClick: this.onDownloadClick\n    }, this.btnMenuDelete = {\n      icon: 'delete danger',\n      text: 'Delete',\n      onClick: this.onDeleteClick\n    }];\n\n    this.setBtnMenuToggle(buttons);\n\n    // * constructing html end\n\n    this.setListeners();\n  }\n\n  protected setListeners() {\n    super.setListeners();\n    attachClickEvent(this.buttons.forward, this.onForwardClick);\n    attachClickEvent(this.author.container, this.onAuthorClick);\n\n    const onCaptionClick = (e: MouseEvent) => {\n      const a = findUpTag(e.target, 'A');\n      const spoiler = findUpClassName(e.target, 'spoiler');\n      if(a instanceof HTMLAnchorElement && (!spoiler || this.content.caption.classList.contains('is-spoiler-visible'))) { // close viewer if it's t.me/ redirect\n        const onclick = a.getAttribute('onclick');\n        if(!onclick || onclick.includes('showMaskedAlert')) {\n          return;\n        }\n\n        cancelEvent(e);\n\n        this.close().then(() => {\n          this.content.caption.removeEventListener('click', onCaptionClick, {capture: true});\n          a.click();\n        });\n\n        return false;\n      }\n    };\n\n    this.content.caption.addEventListener('click', onCaptionClick, {capture: true});\n  }\n\n  /* public close(e?: MouseEvent) {\n    const good = !this.setMoverAnimationPromise;\n    const promise = super.close(e);\n\n    if(good) { // clear\n      this.currentMessageId = 0;\n      this.peerId = 0;\n    }\n\n    return promise;\n  } */\n\n  protected getMessageByPeer(peerId: PeerId, mid: number) {\n    return this.searchContext.isScheduled ? this.managers.appMessagesManager.getScheduledMessageByPeer(peerId, mid) : this.managers.appMessagesManager.getMessageByPeer(peerId, mid);\n  }\n\n  onPrevClick = async(target: AppMediaViewerTargetType) => {\n    this.openMedia(await this.getMessageByPeer(target.peerId, target.mid), target.element, -1);\n  };\n\n  onNextClick = async(target: AppMediaViewerTargetType) => {\n    this.openMedia(await this.getMessageByPeer(target.peerId, target.mid), target.element, 1);\n  };\n\n  onDeleteClick = () => {\n    const target = this.target;\n    new PopupDeleteMessages(target.peerId, [target.mid], 'chat', () => {\n      this.target = {element: this.content.media} as any;\n      this.close();\n    });\n  };\n\n  onForwardClick = () => {\n    const target = this.target;\n    if(target.mid) {\n      // appSidebarRight.forwardTab.open([target.mid]);\n      new PopupForward({\n        [target.peerId]: [target.mid]\n      }, () => {\n        return this.close();\n      });\n    }\n  };\n\n  onAuthorClick = async(e: MouseEvent) => {\n    const {mid, peerId} = this.target;\n    if(mid && mid !== Number.MAX_SAFE_INTEGER) {\n      const threadId = this.searchContext.threadId;\n      const message = await this.getMessageByPeer(peerId, mid);\n      this.close(e)\n      // .then(() => mediaSizes.isMobile ? appSidebarRight.sharedMediaTab.closeBtn.click() : Promise.resolve())\n      .then(async() => {\n        if(mediaSizes.isMobile) {\n          const tab = appSidebarRight.getTab(AppSharedMediaTab);\n          if(tab) {\n            tab.close();\n          }\n        }\n\n        appImManager.setInnerPeer({\n          peerId: message.peerId,\n          lastMsgId: mid,\n          type: threadId ? 'discussion' : undefined,\n          threadId\n        });\n      });\n    }\n  };\n\n  onDownloadClick = async() => {\n    const {peerId, mid} = this.target;\n    const message = await this.getMessageByPeer(peerId, mid);\n    const media = getMediaFromMessage(message);\n    if(!media) return;\n    appDownloadManager.downloadToDisc({media, queueId: appImManager.chat.bubbles.lazyLoadQueue.queueId});\n  };\n\n  private setCaption(message: MyMessage) {\n    const caption = (message as Message.message).message;\n    let html: Parameters<typeof setInnerHTML>[1] = '';\n    if(caption) {\n      html = wrapRichText(caption, {\n        entities: (message as Message.message).totalEntities\n      });\n    }\n\n    // html = 'Dandelion are a family of flowering plants that grow in many parts of the world.';\n    setInnerHTML(this.content.caption.firstElementChild, html);\n    this.content.caption.classList.toggle('hide', !caption);\n    // this.content.container.classList.toggle('with-caption', !!caption);\n  }\n\n  public setSearchContext(context: MediaSearchContext) {\n    this.listLoader.setSearchContext(context);\n\n    return this;\n  }\n\n  public async openMedia(message: MyMessage, target?: HTMLElement, fromRight = 0, reverse = false,\n    prevTargets: AppMediaViewerTargetType[] = [], nextTargets: AppMediaViewerTargetType[] = []/* , needLoadMore = true */) {\n    if(this.setMoverPromise) return this.setMoverPromise;\n\n    const mid = message.mid;\n    const fromId = (message as Message.message).fwd_from && !message.fromId ? (message as Message.message).fwd_from.from_name : message.fromId;\n    const media = getMediaFromMessage(message);\n\n    const cantForwardMessage = message._ === 'messageService' || !this.managers.appMessagesManager.canForward(message);\n    [this.buttons.forward, this.btnMenuForward.element].forEach((button) => {\n      button.classList.toggle('hide', cantForwardMessage);\n    });\n\n    this.wholeDiv.classList.toggle('no-forwards', cantForwardMessage);\n\n    const cantDownloadMessage = cantForwardMessage;\n    [this.buttons.download, this.btnMenuDownload.element].forEach((button) => {\n      button.classList.toggle('hide', cantDownloadMessage);\n    });\n\n    const canDeleteMessage = this.managers.appMessagesManager.canDeleteMessage(message);\n    [this.buttons.delete, this.btnMenuDelete.element].forEach((button) => {\n      button.classList.toggle('hide', !canDeleteMessage);\n    });\n\n    this.setCaption(message);\n    const promise = super._openMedia(media, message.date, fromId, fromRight, target, reverse, prevTargets, nextTargets, message/* , needLoadMore */);\n    this.target.mid = mid;\n    this.target.peerId = message.peerId;\n\n    return promise;\n  }\n\n  public static isMediaCompatibleForDocumentViewer(media: MyPhoto | MyDocument) {\n    return media._ === 'photo' || MEDIA_MIME_TYPES_SUPPORTED.has(media.mime_type);\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport appMediaPlaybackController from '../components/appMediaPlaybackController';\nimport {IS_APPLE_MOBILE, IS_MOBILE} from '../environment/userAgent';\nimport IS_TOUCH_SUPPORTED from '../environment/touchSupport';\nimport cancelEvent from '../helpers/dom/cancelEvent';\nimport ListenerSetter, {Listener} from '../helpers/listenerSetter';\nimport ButtonMenu from '../components/buttonMenu';\nimport {ButtonMenuToggleHandler} from '../components/buttonMenuToggle';\nimport ControlsHover from '../helpers/dom/controlsHover';\nimport {addFullScreenListener, cancelFullScreen, isFullScreen, requestFullScreen} from '../helpers/dom/fullScreen';\nimport toHHMMSS from '../helpers/string/toHHMMSS';\nimport MediaProgressLine from '../components/mediaProgressLine';\nimport VolumeSelector from '../components/volumeSelector';\nimport debounce from '../helpers/schedulers/debounce';\nimport overlayCounter from '../helpers/overlayCounter';\nimport onMediaLoad from '../helpers/onMediaLoad';\nimport {attachClickEvent} from '../helpers/dom/clickEvent';\n\nexport default class VideoPlayer extends ControlsHover {\n  private static PLAYBACK_RATES = [0.5, 1, 1.5, 2];\n  private static PLAYBACK_RATES_ICONS = ['playback_05', 'playback_1x', 'playback_15', 'playback_2x'];\n\n  protected video: HTMLVideoElement;\n  protected wrapper: HTMLDivElement;\n  protected progress: MediaProgressLine;\n  protected skin: 'default';\n\n  protected listenerSetter: ListenerSetter;\n  protected playbackRateButton: HTMLElement;\n  protected pipButton: HTMLElement;\n\n  /* protected videoParent: HTMLElement;\n  protected videoWhichChild: number; */\n\n  protected onPlaybackRackMenuToggle?: (open: boolean) => void;\n  protected onPip?: (pip: boolean) => void;\n  protected onPipClose?: () => void;\n\n  constructor({video, play = false, streamable = false, duration, onPlaybackRackMenuToggle, onPip, onPipClose}: {\n    video: HTMLVideoElement,\n    play?: boolean,\n    streamable?: boolean,\n    duration?: number,\n    onPlaybackRackMenuToggle?: VideoPlayer['onPlaybackRackMenuToggle'],\n    onPip?: VideoPlayer['onPip'],\n    onPipClose?: VideoPlayer['onPipClose']\n  }) {\n    super();\n\n    this.video = video;\n    this.wrapper = document.createElement('div');\n    this.wrapper.classList.add('ckin__player');\n\n    this.onPlaybackRackMenuToggle = onPlaybackRackMenuToggle;\n    this.onPip = onPip;\n    this.onPipClose = onPipClose;\n\n    this.listenerSetter = new ListenerSetter();\n\n    this.setup({\n      element: this.wrapper,\n      listenerSetter: this.listenerSetter,\n      canHideControls: () => {\n        return !this.video.paused && (!this.playbackRateButton || !this.playbackRateButton.classList.contains('menu-open'));\n      },\n      showOnLeaveToClassName: 'media-viewer-caption',\n      ignoreClickClassName: 'ckin__controls'\n    });\n\n    video.parentNode.insertBefore(this.wrapper, video);\n    this.wrapper.appendChild(video);\n\n    this.skin = 'default';\n\n    this.stylePlayer(duration);\n    this.setBtnMenuToggle();\n\n    if(this.skin === 'default') {\n      const controls = this.wrapper.querySelector('.default__controls.ckin__controls') as HTMLDivElement;\n      this.progress = new MediaProgressLine(video, streamable);\n      controls.prepend(this.progress.container);\n    }\n\n    if(play/*  && video.paused */) {\n      const promise = video.play();\n      promise.catch((err: Error) => {\n        if(err.name === 'NotAllowedError') {\n          video.muted = true;\n          video.autoplay = true;\n          video.play();\n        }\n      }).finally(() => { // due to autoplay, play will not call\n        this.wrapper.classList.toggle('is-playing', !this.video.paused);\n      });\n    }\n  }\n\n  private stylePlayer(initDuration: number) {\n    const {wrapper, video, skin, listenerSetter} = this;\n\n    wrapper.classList.add(skin);\n\n    const html = this.buildControls();\n    wrapper.insertAdjacentHTML('beforeend', html);\n    let timeDuration: HTMLElement;\n\n    if(skin === 'default') {\n      this.playbackRateButton = this.wrapper.querySelector('.playback-rate') as HTMLElement;\n      this.pipButton = this.wrapper.querySelector('.pip') as HTMLElement;\n\n      const toggle = wrapper.querySelectorAll('.toggle') as NodeListOf<HTMLElement>;\n      const fullScreenButton = wrapper.querySelector('.fullscreen') as HTMLElement;\n      const timeElapsed = wrapper.querySelector('#time-elapsed');\n      timeDuration = wrapper.querySelector('#time-duration') as HTMLElement;\n      timeDuration.textContent = toHHMMSS(video.duration | 0);\n\n      const volumeSelector = new VolumeSelector(listenerSetter);\n\n      const leftControls = wrapper.querySelector('.left-controls');\n      volumeSelector.btn.classList.remove('btn-icon');\n      leftControls.insertBefore(volumeSelector.btn, timeElapsed.parentElement);\n\n      Array.from(toggle).forEach((button) => {\n        attachClickEvent(button, () => {\n          this.togglePlay();\n        }, {listenerSetter: this.listenerSetter});\n      });\n\n      if(this.pipButton) {\n        attachClickEvent(this.pipButton, () => {\n          this.video.requestPictureInPicture();\n        }, {listenerSetter: this.listenerSetter});\n\n        const onPip = (pip: boolean) => {\n          this.wrapper.style.visibility = pip ? 'hidden': '';\n          if(this.onPip) {\n            this.onPip(pip);\n          }\n        };\n\n        const debounceTime = 20;\n        const debouncedPip = debounce(onPip, debounceTime, false, true);\n\n        listenerSetter.add(video)('enterpictureinpicture', () => {\n          debouncedPip(true);\n\n          listenerSetter.add(video)('leavepictureinpicture', () => {\n            const onPause = () => {\n              clearTimeout(timeout);\n              if(this.onPipClose) {\n                this.onPipClose();\n              }\n            };\n            const listener = listenerSetter.add(video)('pause', onPause, {once: true}) as any as Listener;\n            const timeout = setTimeout(() => {\n              listenerSetter.remove(listener);\n            }, debounceTime);\n          }, {once: true});\n        });\n\n        listenerSetter.add(video)('leavepictureinpicture', () => {\n          debouncedPip(false);\n        });\n      }\n\n      if(!IS_TOUCH_SUPPORTED) {\n        attachClickEvent(video, () => {\n          this.togglePlay();\n        }, {listenerSetter: this.listenerSetter});\n\n        listenerSetter.add(document)('keydown', (e: KeyboardEvent) => {\n          if(overlayCounter.overlaysActive > 1 || document.pictureInPictureElement === video) { // forward popup is active, etc\n            return;\n          }\n\n          const {key, code} = e;\n\n          let good = true;\n          if(code === 'KeyF') {\n            this.toggleFullScreen();\n          } else if(code === 'KeyM') {\n            appMediaPlaybackController.muted = !appMediaPlaybackController.muted;\n          } else if(code === 'Space') {\n            this.togglePlay();\n          } else if(e.altKey && (code === 'Equal' || code === 'Minus')) {\n            const add = code === 'Equal' ? 1 : -1;\n            const playbackRate = appMediaPlaybackController.playbackRate;\n            const idx = VideoPlayer.PLAYBACK_RATES.indexOf(playbackRate);\n            const nextIdx = idx + add;\n            if(nextIdx >= 0 && nextIdx < VideoPlayer.PLAYBACK_RATES.length) {\n              appMediaPlaybackController.playbackRate = VideoPlayer.PLAYBACK_RATES[nextIdx];\n            }\n          } else if(wrapper.classList.contains('ckin__fullscreen') && (key === 'ArrowLeft' || key === 'ArrowRight')) {\n            if(key === 'ArrowLeft') appMediaPlaybackController.seekBackward({action: 'seekbackward'});\n            else appMediaPlaybackController.seekForward({action: 'seekforward'});\n          } else {\n            good = false;\n          }\n\n          if(good) {\n            cancelEvent(e);\n            return false;\n          }\n        });\n      }\n\n      listenerSetter.add(video)('dblclick', () => {\n        if(!IS_TOUCH_SUPPORTED) {\n          this.toggleFullScreen();\n        }\n      });\n\n      attachClickEvent(fullScreenButton, () => {\n        this.toggleFullScreen();\n      }, {listenerSetter: this.listenerSetter});\n\n      addFullScreenListener(wrapper, this.onFullScreen.bind(this, fullScreenButton), listenerSetter);\n\n      listenerSetter.add(video)('timeupdate', () => {\n        timeElapsed.textContent = toHHMMSS(video.currentTime | 0);\n      });\n\n      listenerSetter.add(video)('play', () => {\n        wrapper.classList.add('played');\n\n        if(!IS_TOUCH_SUPPORTED) {\n          listenerSetter.add(video)('play', () => {\n            this.hideControls(true);\n          });\n        }\n      }, {once: true});\n\n      listenerSetter.add(video)('pause', () => {\n        this.showControls(false);\n      });\n\n      listenerSetter.add(appMediaPlaybackController)('playbackParams', () => {\n        this.setPlaybackRateIcon();\n      });\n    }\n\n    listenerSetter.add(video)('play', () => {\n      wrapper.classList.add('is-playing');\n    });\n\n    listenerSetter.add(video)('pause', () => {\n      wrapper.classList.remove('is-playing');\n    });\n\n    if(video.duration || initDuration) {\n      timeDuration.textContent = toHHMMSS(Math.round(video.duration || initDuration));\n    } else {\n      onMediaLoad(video).then(() => {\n        timeDuration.textContent = toHHMMSS(Math.round(video.duration));\n      });\n    }\n  }\n\n  protected togglePlay() {\n    this.video[this.video.paused ? 'play' : 'pause']();\n  }\n\n  private buildControls() {\n    const skin = this.skin;\n    if(skin === 'default') {\n      return `\n      <button class=\"${skin}__button--big toggle tgico\" title=\"Toggle Play\"></button>\n      <div class=\"${skin}__gradient-bottom ckin__controls\"></div>\n      <div class=\"${skin}__controls ckin__controls\">\n        <div class=\"bottom-controls\">\n          <div class=\"left-controls\">\n            <button class=\"btn-icon ${skin}__button toggle tgico\" title=\"Toggle Video\"></button>\n            <div class=\"time\">\n              <time id=\"time-elapsed\">0:00</time>\n              <span> / </span>\n              <time id=\"time-duration\">0:00</time>\n            </div>\n          </div>\n          <div class=\"right-controls\">\n            <button class=\"btn-icon ${skin}__button btn-menu-toggle playback-rate night\" title=\"Playback Rate\"></button>\n            ${!IS_MOBILE && document.pictureInPictureEnabled ? `<button class=\"btn-icon ${skin}__button pip tgico-pip\" title=\"Picture-in-Picture\"></button>` : ''}\n            <button class=\"btn-icon ${skin}__button fullscreen tgico-fullscreen\" title=\"Full Screen\"></button>\n          </div>\n        </div>\n      </div>`;\n    }\n  }\n\n  protected setBtnMenuToggle() {\n    const buttons: Parameters<typeof ButtonMenu>[0] = VideoPlayer.PLAYBACK_RATES.map((rate, idx) => {\n      return {\n        // icon: VideoPlayer.PLAYBACK_RATES_ICONS[idx],\n        regularText: rate + 'x',\n        onClick: () => {\n          appMediaPlaybackController.playbackRate = rate;\n        }\n      };\n    });\n    const btnMenu = ButtonMenu(buttons);\n    btnMenu.classList.add('top-left');\n    ButtonMenuToggleHandler(\n      this.playbackRateButton,\n      this.onPlaybackRackMenuToggle ? () => {\n        this.onPlaybackRackMenuToggle(true);\n      } : undefined,\n      undefined,\n      this.onPlaybackRackMenuToggle ? () => {\n        this.onPlaybackRackMenuToggle(false);\n      } : undefined\n    );\n    this.playbackRateButton.append(btnMenu);\n\n    this.setPlaybackRateIcon();\n  }\n\n  protected setPlaybackRateIcon() {\n    const playbackRateButton = this.playbackRateButton;\n    VideoPlayer.PLAYBACK_RATES_ICONS.forEach((className) => {\n      className = 'tgico-' + className;\n      playbackRateButton.classList.remove(className);\n    });\n\n    let idx = VideoPlayer.PLAYBACK_RATES.indexOf(appMediaPlaybackController.playbackRate);\n    if(idx === -1) idx = VideoPlayer.PLAYBACK_RATES.indexOf(1);\n\n    playbackRateButton.classList.add('tgico-' + VideoPlayer.PLAYBACK_RATES_ICONS[idx]);\n  }\n\n  protected toggleFullScreen() {\n    const player = this.wrapper;\n\n    // * https://caniuse.com/#feat=fullscreen\n    if(IS_APPLE_MOBILE) {\n      const video = this.video as any;\n      video.webkitEnterFullscreen();\n      video.enterFullscreen();\n      return;\n    }\n\n    if(!isFullScreen()) {\n      /* const videoParent = this.video.parentElement;\n      const videoWhichChild = whichChild(this.video);\n      const needVideoRemount = videoParent !== player;\n\n      if(needVideoRemount) {\n        this.videoParent = videoParent;\n        this.videoWhichChild = videoWhichChild;\n        player.prepend(this.video);\n      } */\n\n      requestFullScreen(player);\n    } else {\n      /* if(this.videoParent) {\n        const {videoWhichChild, videoParent} = this;\n        if(!videoWhichChild) {\n          videoParent.prepend(this.video);\n        } else {\n          videoParent.insertBefore(this.video, videoParent.children[videoWhichChild]);\n        }\n\n        this.videoParent = null;\n        this.videoWhichChild = -1;\n      } */\n\n      cancelFullScreen();\n    }\n  }\n\n  protected onFullScreen(fullScreenButton: HTMLElement) {\n    const isFull = isFullScreen();\n    this.wrapper.classList.toggle('ckin__fullscreen', isFull);\n    if(!isFull) {\n      fullScreenButton.classList.remove('tgico-smallscreen');\n      fullScreenButton.classList.add('tgico-fullscreen');\n      fullScreenButton.setAttribute('title', 'Full Screen');\n    } else {\n      fullScreenButton.classList.remove('tgico-fullscreen');\n      fullScreenButton.classList.add('tgico-smallscreen');\n      fullScreenButton.setAttribute('title', 'Exit Full Screen');\n    }\n  }\n\n  public cleanup() {\n    super.cleanup();\n    this.listenerSetter.removeAll();\n    this.progress.removeListeners();\n    this.onPlaybackRackMenuToggle = this.onPip = undefined;\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport deferredPromise from '../helpers/cancellablePromise';\nimport mediaSizes from '../helpers/mediaSizes';\nimport IS_TOUCH_SUPPORTED from '../environment/touchSupport';\nimport {IS_MOBILE_SAFARI, IS_SAFARI} from '../environment/userAgent';\nimport type {MyDocument} from '../lib/appManagers/appDocsManager';\nimport type {MyPhoto} from '../lib/appManagers/appPhotosManager';\nimport {logger} from '../lib/logger';\nimport VideoPlayer from '../lib/mediaPlayer';\nimport rootScope from '../lib/rootScope';\nimport animationIntersector from './animationIntersector';\nimport appMediaPlaybackController, {AppMediaPlaybackController} from './appMediaPlaybackController';\nimport AvatarElement from './avatar';\nimport ButtonIcon from './buttonIcon';\nimport {ButtonMenuItemOptions} from './buttonMenu';\nimport ButtonMenuToggle from './buttonMenuToggle';\nimport ProgressivePreloader from './preloader';\nimport SwipeHandler from './swipeHandler';\nimport {formatFullSentTime} from '../helpers/date';\nimport appNavigationController, {NavigationItem} from './appNavigationController';\nimport {Message} from '../layer';\nimport findUpClassName from '../helpers/dom/findUpClassName';\nimport renderImageFromUrl, {renderImageFromUrlPromise} from '../helpers/dom/renderImageFromUrl';\nimport getVisibleRect from '../helpers/dom/getVisibleRect';\nimport cancelEvent from '../helpers/dom/cancelEvent';\nimport fillPropertyValue from '../helpers/fillPropertyValue';\nimport generatePathData from '../helpers/generatePathData';\nimport replaceContent from '../helpers/dom/replaceContent';\nimport PeerTitle from './peerTitle';\nimport {doubleRaf, fastRaf} from '../helpers/schedulers';\nimport RangeSelector from './rangeSelector';\nimport windowSize from '../helpers/windowSize';\nimport ListLoader from '../helpers/listLoader';\nimport EventListenerBase from '../helpers/eventListenerBase';\nimport {MyMessage} from '../lib/appManagers/appMessagesManager';\nimport {NULL_PEER_ID} from '../lib/mtproto/mtproto_config';\nimport {isFullScreen} from '../helpers/dom/fullScreen';\nimport {attachClickEvent} from '../helpers/dom/clickEvent';\nimport SearchListLoader from '../helpers/searchListLoader';\nimport createVideo from '../helpers/dom/createVideo';\nimport {AppManagers} from '../lib/appManagers/managers';\nimport getStrippedThumbIfNeeded from '../helpers/getStrippedThumbIfNeeded';\nimport setAttachmentSize from '../helpers/setAttachmentSize';\nimport wrapEmojiText from '../lib/richTextProcessor/wrapEmojiText';\nimport LazyLoadQueueBase from './lazyLoadQueueBase';\nimport overlayCounter from '../helpers/overlayCounter';\nimport {ThumbCache} from '../lib/storages/thumbs';\nimport appDownloadManager from '../lib/appManagers/appDownloadManager';\nimport wrapPeerTitle from './wrappers/peerTitle';\n\nconst ZOOM_STEP = 0.5;\nconst ZOOM_INITIAL_VALUE = 1;\nconst ZOOM_MIN_VALUE = 0.5;\nconst ZOOM_MAX_VALUE = 4;\n\n// TODO:   ( SVG)  ,      \n// TODO:  \"\"      ,     (,  )\n// TODO:    ,    :    ,     , ..  -   ,   \n\nexport const MEDIA_VIEWER_CLASSNAME = 'media-viewer';\n\nexport default class AppMediaViewerBase<\n  ContentAdditionType extends string,\n  ButtonsAdditionType extends string,\n  TargetType extends {element: HTMLElement\n}> extends EventListenerBase<{\n  setMoverBefore: () => void,\n  setMoverAfter: () => void\n}> {\n  protected wholeDiv: HTMLElement;\n  protected overlaysDiv: HTMLElement;\n  protected author: {[k in 'container' | 'avatarEl' | 'nameEl' | 'date']: HTMLElement} = {} as any;\n  protected content: {[k in 'main' | 'container' | 'media' | 'mover' | ContentAdditionType]: HTMLElement} = {} as any;\n  protected buttons: {[k in 'download' | 'close' | 'prev' | 'next' | 'mobile-close' | 'zoom' | ButtonsAdditionType]: HTMLElement} = {} as any;\n  protected topbar: HTMLElement;\n  protected moversContainer: HTMLElement;\n\n  protected tempId = 0;\n  protected preloader: ProgressivePreloader = null;\n  protected preloaderStreamable: ProgressivePreloader = null;\n\n  // protected targetContainer: HTMLElement = null;\n  // protected loadMore: () => void = null;\n\n  protected log: ReturnType<typeof logger>;\n\n  protected isFirstOpen = true;\n\n  // protected needLoadMore = true;\n\n  protected pageEl = document.getElementById('page-chats') as HTMLDivElement;\n\n  protected setMoverPromise: Promise<void>;\n  protected setMoverAnimationPromise: Promise<void>;\n\n  protected lazyLoadQueue: LazyLoadQueueBase;\n\n  protected highlightSwitchersTimeout: number;\n\n  protected onDownloadClick: (e: MouseEvent) => void;\n  protected onPrevClick: (target: TargetType) => void;\n  protected onNextClick: (target: TargetType) => void;\n\n  protected videoPlayer: VideoPlayer;\n\n  protected zoomElements: {\n    container: HTMLElement,\n    btnOut: HTMLElement,\n    btnIn: HTMLElement,\n    rangeSelector: RangeSelector\n  } = {} as any;\n  // protected zoomValue = ZOOM_INITIAL_VALUE;\n  protected zoomSwipeHandler: SwipeHandler;\n  protected zoomSwipeStartX = 0;\n  protected zoomSwipeStartY = 0;\n  protected zoomSwipeX = 0;\n  protected zoomSwipeY = 0;\n\n  protected ctrlKeyDown: boolean;\n  protected releaseSingleMedia: ReturnType<AppMediaPlaybackController['setSingleMedia']>;\n  protected navigationItem: NavigationItem;\n\n  protected managers: AppManagers;\n\n  get target() {\n    return this.listLoader.current;\n  }\n\n  set target(value) {\n    this.listLoader.current = value;\n  }\n\n  constructor(\n    protected listLoader: ListLoader<TargetType, any>,\n    topButtons: Array<keyof AppMediaViewerBase<ContentAdditionType, ButtonsAdditionType, TargetType>['buttons']>\n  ) {\n    super(false);\n\n    this.managers = rootScope.managers;\n\n    this.log = logger('AMV');\n    this.preloader = new ProgressivePreloader();\n    this.preloaderStreamable = new ProgressivePreloader({\n      cancelable: false,\n      streamable: true\n    });\n    this.preloader.construct();\n    this.preloaderStreamable.construct();\n    this.lazyLoadQueue = new LazyLoadQueueBase();\n\n    this.wholeDiv = document.createElement('div');\n    this.wholeDiv.classList.add(MEDIA_VIEWER_CLASSNAME + '-whole');\n\n    this.overlaysDiv = document.createElement('div');\n    this.overlaysDiv.classList.add('overlays');\n\n    const mainDiv = document.createElement('div');\n    mainDiv.classList.add(MEDIA_VIEWER_CLASSNAME);\n\n    const topbar = this.topbar = document.createElement('div');\n    topbar.classList.add(MEDIA_VIEWER_CLASSNAME + '-topbar', MEDIA_VIEWER_CLASSNAME + '-appear');\n\n    const topbarLeft = document.createElement('div');\n    topbarLeft.classList.add(MEDIA_VIEWER_CLASSNAME + '-topbar-left');\n\n    this.buttons['mobile-close'] = ButtonIcon('close', {onlyMobile: true});\n\n    // * author\n    this.author.container = document.createElement('div');\n    this.author.container.classList.add(MEDIA_VIEWER_CLASSNAME + '-author', 'no-select');\n    const authorRight = document.createElement('div');\n\n    this.author.avatarEl = new AvatarElement();\n    this.author.avatarEl.classList.add(MEDIA_VIEWER_CLASSNAME + '-userpic', 'avatar-44');\n\n    this.author.nameEl = document.createElement('div');\n    this.author.nameEl.classList.add(MEDIA_VIEWER_CLASSNAME + '-name');\n\n    this.author.date = document.createElement('div');\n    this.author.date.classList.add(MEDIA_VIEWER_CLASSNAME + '-date');\n\n    authorRight.append(this.author.nameEl, this.author.date);\n\n    this.author.container.append(this.author.avatarEl, authorRight);\n\n    // * buttons\n    const buttonsDiv = document.createElement('div');\n    buttonsDiv.classList.add(MEDIA_VIEWER_CLASSNAME + '-buttons');\n\n    topButtons.concat(['download', 'zoom', 'close']).forEach((name) => {\n      const button = ButtonIcon(name, {noRipple: true});\n      this.buttons[name] = button;\n      buttonsDiv.append(button);\n    });\n\n    this.buttons.zoom.classList.add('zoom-in');\n\n    // * zoom\n    this.zoomElements.container = document.createElement('div');\n    this.zoomElements.container.classList.add('zoom-container');\n\n    this.zoomElements.btnOut = ButtonIcon('zoomout', {noRipple: true});\n    attachClickEvent(this.zoomElements.btnOut, () => this.changeZoom(false));\n    this.zoomElements.btnIn = ButtonIcon('zoomin', {noRipple: true});\n    attachClickEvent(this.zoomElements.btnIn, () => this.changeZoom(true));\n\n    this.zoomElements.rangeSelector = new RangeSelector({\n      step: ZOOM_STEP,\n      min: ZOOM_MIN_VALUE,\n      max: ZOOM_MAX_VALUE,\n      withTransition: true\n    }, ZOOM_INITIAL_VALUE);\n    this.zoomElements.rangeSelector.setListeners();\n    this.zoomElements.rangeSelector.setHandlers({\n      onScrub: this.setZoomValue,\n      onMouseUp: () => this.setZoomValue()\n    });\n\n    this.zoomElements.container.append(this.zoomElements.btnOut, this.zoomElements.rangeSelector.container, this.zoomElements.btnIn);\n\n    this.wholeDiv.append(this.zoomElements.container);\n\n    // * content\n    this.content.main = document.createElement('div');\n    this.content.main.classList.add(MEDIA_VIEWER_CLASSNAME + '-content');\n\n    this.content.container = document.createElement('div');\n    this.content.container.classList.add(MEDIA_VIEWER_CLASSNAME + '-container');\n\n    this.content.media = document.createElement('div');\n    this.content.media.classList.add(MEDIA_VIEWER_CLASSNAME + '-media');\n\n    this.content.container.append(this.content.media);\n\n    this.content.main.append(this.content.container);\n    mainDiv.append(this.content.main);\n    this.overlaysDiv.append(mainDiv);\n    // * overlays end\n\n    topbarLeft.append(this.buttons['mobile-close'], this.author.container);\n    topbar.append(topbarLeft, buttonsDiv);\n\n    this.buttons.prev = document.createElement('div');\n    this.buttons.prev.className = `${MEDIA_VIEWER_CLASSNAME}-switcher ${MEDIA_VIEWER_CLASSNAME}-switcher-left`;\n    this.buttons.prev.innerHTML = `<span class=\"tgico-down ${MEDIA_VIEWER_CLASSNAME}-prev-button\"></span>`;\n\n    this.buttons.next = document.createElement('div');\n    this.buttons.next.className = `${MEDIA_VIEWER_CLASSNAME}-switcher ${MEDIA_VIEWER_CLASSNAME}-switcher-right`;\n    this.buttons.next.innerHTML = `<span class=\"tgico-down ${MEDIA_VIEWER_CLASSNAME}-next-button\"></span>`;\n\n    this.moversContainer = document.createElement('div');\n    this.moversContainer.classList.add(MEDIA_VIEWER_CLASSNAME + '-movers');\n\n    this.wholeDiv.append(this.overlaysDiv, this.buttons.prev, this.buttons.next, this.topbar, this.moversContainer);\n\n    // * constructing html end\n\n    this.listLoader.onLoadedMore = () => {\n      this.buttons.prev.classList.toggle('hide', !this.listLoader.previous.length);\n      this.buttons.next.classList.toggle('hide', !this.listLoader.next.length);\n    };\n\n    this.setNewMover();\n  }\n\n  protected setListeners() {\n    attachClickEvent(this.buttons.download, this.onDownloadClick);\n    [this.buttons.close, this.buttons['mobile-close'], this.preloaderStreamable.preloader].forEach((el) => {\n      attachClickEvent(el, this.close.bind(this));\n    });\n\n    ([[-1, this.buttons.prev], [1, this.buttons.next]] as [number, HTMLElement][]).forEach(([moveLength, button]) => {\n      // attachClickEvent(button, (e) => {\n      button.addEventListener('click', (e) => {\n        cancelEvent(e);\n        if(this.setMoverPromise) return;\n\n        this.listLoader.go(moveLength);\n      });\n    });\n\n    attachClickEvent(this.buttons.zoom, () => {\n      if(this.isZooming()) this.toggleZoom(false);\n      else {\n        this.changeZoom(true);\n      }\n    });\n\n    // ! cannot use the function because it'll cancel slide event on touch devices\n    // attachClickEvent(this.wholeDiv, this.onClick);\n    this.wholeDiv.addEventListener('click', this.onClick);\n\n    this.listLoader.onJump = (item, older) => {\n      if(older) this.onNextClick(item);\n      else this.onPrevClick(item);\n    };\n\n    if(IS_TOUCH_SUPPORTED) {\n      const swipeHandler = new SwipeHandler({\n        element: this.wholeDiv,\n        onSwipe: (xDiff, yDiff) => {\n          if(isFullScreen()) {\n            return;\n          }\n          // console.log(xDiff, yDiff);\n\n          const percents = Math.abs(xDiff) / windowSize.width;\n          if(percents > .2 || xDiff > 125) {\n            // console.log('will swipe', xDiff);\n\n            if(xDiff < 0) {\n              this.buttons.prev.click();\n            } else {\n              this.buttons.next.click();\n            }\n\n            return true;\n          }\n\n          const percentsY = Math.abs(yDiff) / windowSize.height;\n          if(percentsY > .2 || yDiff > 125) {\n            this.close();\n            return true;\n          }\n\n          return false;\n        },\n        verifyTouchTarget: (evt) => {\n          // * Fix for seek input\n          if((evt.target as HTMLElement).tagName === 'INPUT' || findUpClassName(evt.target, 'media-viewer-caption')) {\n            return false;\n          }\n\n          return true;\n        }\n      });\n    }\n  }\n\n  protected toggleZoom(enable?: boolean) {\n    const isVisible = this.isZooming();\n    if(this.zoomElements.rangeSelector.mousedown || this.ctrlKeyDown) {\n      enable = true;\n    }\n\n    if(isVisible === enable) return;\n\n    if(enable === undefined) {\n      enable = !isVisible;\n    }\n\n    this.buttons.zoom.classList.toggle('zoom-in', !enable);\n    this.zoomElements.container.classList.toggle('is-visible', enable);\n    const zoomValue = enable ? this.zoomElements.rangeSelector.value : 1;\n    this.setZoomValue(zoomValue);\n    this.zoomElements.rangeSelector.setProgress(zoomValue);\n\n    if(this.videoPlayer) {\n      this.videoPlayer.lockControls(enable ? false : undefined);\n    }\n\n    if(enable) {\n      if(!this.zoomSwipeHandler) {\n        let lastDiffX: number, lastDiffY: number;\n        const multiplier = -1;\n        this.zoomSwipeHandler = new SwipeHandler({\n          element: this.moversContainer,\n          onFirstSwipe: () => {\n            lastDiffX = lastDiffY = 0;\n            this.moversContainer.classList.add('no-transition');\n          },\n          onSwipe: (xDiff, yDiff) => {\n            [xDiff, yDiff] = [xDiff * multiplier, yDiff * multiplier];\n            this.zoomSwipeX += xDiff - lastDiffX;\n            this.zoomSwipeY += yDiff - lastDiffY;\n            [lastDiffX, lastDiffY] = [xDiff, yDiff];\n\n            this.setZoomValue();\n          },\n          onReset: () => {\n            this.moversContainer.classList.remove('no-transition');\n          },\n          cursor: 'move'\n        });\n      } else {\n        this.zoomSwipeHandler.setListeners();\n      }\n\n      this.zoomElements.rangeSelector.setProgress(zoomValue);\n    } else if(!enable) {\n      this.zoomSwipeHandler.removeListeners();\n    }\n  }\n\n  protected changeZoom(add: boolean) {\n    this.zoomElements.rangeSelector.addProgress(ZOOM_STEP * (add ? 1 : -1));\n    this.setZoomValue();\n  }\n\n  protected setZoomValue = (value = this.zoomElements.rangeSelector.value) => {\n    // this.zoomValue = value;\n    if(value === ZOOM_INITIAL_VALUE) {\n      this.zoomSwipeX = 0;\n      this.zoomSwipeY = 0;\n    }\n\n    this.moversContainer.style.transform = `matrix(${value}, 0, 0, ${value}, ${this.zoomSwipeX}, ${this.zoomSwipeY})`;\n\n    this.zoomElements.btnOut.classList.toggle('inactive', value === ZOOM_MIN_VALUE);\n    this.zoomElements.btnIn.classList.toggle('inactive', value === ZOOM_MAX_VALUE);\n\n    this.toggleZoom(value !== ZOOM_INITIAL_VALUE);\n  };\n\n  protected isZooming() {\n    return this.zoomElements.container.classList.contains('is-visible');\n  }\n\n  protected setBtnMenuToggle(buttons: ButtonMenuItemOptions[]) {\n    const btnMenuToggle = ButtonMenuToggle({onlyMobile: true}, 'bottom-left', buttons);\n    this.topbar.append(btnMenuToggle);\n  }\n\n  public close(e?: MouseEvent) {\n    if(e) {\n      cancelEvent(e);\n    }\n\n    if(this.setMoverAnimationPromise) return Promise.reject();\n\n    if(this.navigationItem) {\n      appNavigationController.removeItem(this.navigationItem);\n    }\n\n    this.lazyLoadQueue.clear();\n\n    const promise = this.setMoverToTarget(this.target?.element, true).then(({onAnimationEnd}) => onAnimationEnd);\n\n    this.listLoader.reset();\n    (this.listLoader as SearchListLoader<any>).cleanup && (this.listLoader as SearchListLoader<any>).cleanup();\n    this.setMoverPromise = null;\n    this.tempId = -1;\n    if((window as any).appMediaViewer === this) {\n      (window as any).appMediaViewer = undefined;\n    }\n\n    /* if(appSidebarRight.historyTabIDs.slice(-1)[0] === AppSidebarRight.SLIDERITEMSIDS.forward) {\n      promise.then(() => {\n        appSidebarRight.forwardTab.closeBtn.click();\n      });\n    } */\n\n    this.removeGlobalListeners();\n\n    this.zoomSwipeHandler = undefined;\n\n    promise.finally(() => {\n      this.wholeDiv.remove();\n      this.toggleOverlay(false);\n    });\n\n    return promise;\n  }\n\n  protected toggleOverlay(active: boolean) {\n    overlayCounter.isOverlayActive = active;\n    animationIntersector.checkAnimations(active);\n  }\n\n  protected toggleGlobalListeners(active: boolean) {\n    if(active) this.setGlobalListeners();\n    else this.removeGlobalListeners();\n  }\n\n  protected removeGlobalListeners() {\n    if(this.zoomSwipeHandler) {\n      this.zoomSwipeHandler.removeListeners();\n    }\n\n    window.removeEventListener('keydown', this.onKeyDown);\n    window.removeEventListener('keyup', this.onKeyUp);\n    window.removeEventListener('wheel', this.onWheel, {capture: true});\n  }\n\n  protected setGlobalListeners() {\n    if(this.isZooming()) {\n      this.zoomSwipeHandler.setListeners();\n    }\n\n    window.addEventListener('keydown', this.onKeyDown);\n    window.addEventListener('keyup', this.onKeyUp);\n    if(!IS_TOUCH_SUPPORTED) window.addEventListener('wheel', this.onWheel, {passive: false, capture: true});\n  }\n\n  onClick = (e: MouseEvent) => {\n    if(this.setMoverAnimationPromise) return;\n\n    const target = e.target as HTMLElement;\n    if(target.tagName === 'A') return;\n    cancelEvent(e);\n\n    if(IS_TOUCH_SUPPORTED) {\n      if(this.highlightSwitchersTimeout) {\n        clearTimeout(this.highlightSwitchersTimeout);\n      } else {\n        this.wholeDiv.classList.add('highlight-switchers');\n      }\n\n      this.highlightSwitchersTimeout = window.setTimeout(() => {\n        this.wholeDiv.classList.remove('highlight-switchers');\n        this.highlightSwitchersTimeout = 0;\n      }, 3e3);\n\n      return;\n    }\n\n    const isZooming = this.isZooming();\n    let mover: HTMLElement = null;\n    const classNames = ['ckin__player', 'media-viewer-buttons', 'media-viewer-author', 'media-viewer-caption', 'zoom-container'];\n    if(isZooming) {\n      classNames.push('media-viewer-movers');\n    }\n\n    classNames.find((s) => {\n      try {\n        mover = findUpClassName(target, s);\n        if(mover) return true;\n      } catch(err) {return false;}\n    });\n\n    if(/* target === this.mediaViewerDiv */!mover || (!isZooming && (target.tagName === 'IMG' || target.tagName === 'image'))) {\n      this.close();\n    }\n  };\n\n  private onKeyDown = (e: KeyboardEvent) => {\n    // this.log('onKeyDown', e);\n    if(overlayCounter.overlaysActive > 1) {\n      return;\n    }\n\n    const key = e.key;\n\n    let good = true;\n    if(key === 'ArrowRight') {\n      this.buttons.next.click();\n    } else if(key === 'ArrowLeft') {\n      this.buttons.prev.click();\n    } else if(key === '-' || key === '=') {\n      if(this.ctrlKeyDown) {\n        this.changeZoom(key === '=');\n      }\n    } else {\n      good = false;\n    }\n\n    if(e.ctrlKey || e.metaKey) {\n      this.ctrlKeyDown = true;\n    }\n\n    if(good) {\n      cancelEvent(e);\n    }\n  };\n\n  private onKeyUp = (e: KeyboardEvent) => {\n    if(overlayCounter.overlaysActive > 1) {\n      return;\n    }\n\n    if(!(e.ctrlKey || e.metaKey)) {\n      this.ctrlKeyDown = false;\n\n      if(this.isZooming()) {\n        this.setZoomValue();\n      }\n    }\n  };\n\n  private onWheel = (e: WheelEvent) => {\n    if(overlayCounter.overlaysActive > 1 || (findUpClassName(e.target, 'media-viewer-caption') && !this.ctrlKeyDown)) {\n      return;\n    }\n\n    cancelEvent(e);\n\n    if(this.ctrlKeyDown) {\n      const scrollingUp = e.deltaY < 0;\n      // if(!scrollingUp && !this.isZooming()) return;\n      this.changeZoom(!!scrollingUp);\n    }\n  };\n\n  protected async setMoverToTarget(target: HTMLElement, closing = false, fromRight = 0) {\n    this.dispatchEvent('setMoverBefore');\n\n    const mover = this.content.mover;\n\n    if(!closing) {\n      mover.innerHTML = '';\n      // mover.append(this.buttons.prev, this.buttons.next);\n    }\n\n    const zoomValue = this.isZooming() && closing /* && false */ ? this.zoomElements.rangeSelector.value : ZOOM_INITIAL_VALUE;\n    /* if(!(zoomValue > 1 && closing)) */ this.removeCenterFromMover(mover);\n\n    const wasActive = fromRight !== 0;\n\n    const delay = rootScope.settings.animationsEnabled ? (wasActive ? 350 : 200) : 0;\n    // let delay = wasActive ? 350 : 10000;\n\n    /* if(wasActive) {\n      this.moveTheMover(mover);\n      mover = this.setNewMover();\n    } */\n\n    /* if(DEBUG) {\n      this.log('setMoverToTarget', target, closing, wasActive, fromRight);\n    } */\n\n    let realParent: HTMLElement;\n\n    let rect: DOMRect;\n    if(target) {\n      if(target instanceof AvatarElement || target.classList.contains('grid-item')/*  || target.classList.contains('document-ico') */) {\n        realParent = target;\n        rect = target.getBoundingClientRect();\n      } else if(target instanceof SVGImageElement || target.parentElement instanceof SVGForeignObjectElement) {\n        realParent = findUpClassName(target, 'attachment');\n        rect = realParent.getBoundingClientRect();\n      } else if(target.classList.contains('profile-avatars-avatar')) {\n        realParent = findUpClassName(target, 'profile-avatars-container');\n        rect = realParent.getBoundingClientRect();\n\n        // * if not active avatar\n        if(closing && target.getBoundingClientRect().left !== rect.left) {\n          target = realParent = rect = undefined;\n        }\n      }\n    }\n\n    if(!target) {\n      target = this.content.media;\n    }\n\n    if(!rect) {\n      realParent = target.parentElement as HTMLElement;\n      rect = target.getBoundingClientRect();\n    }\n\n    let needOpacity = false;\n    if(target !== this.content.media && !target.classList.contains('profile-avatars-avatar')) {\n      const overflowElement = findUpClassName(realParent, 'scrollable');\n      const visibleRect = getVisibleRect(realParent, overflowElement, true);\n\n      if(closing && (!visibleRect || visibleRect.overflow.vertical === 2 || visibleRect.overflow.horizontal === 2)) {\n        target = this.content.media;\n        realParent = target.parentElement as HTMLElement;\n        rect = target.getBoundingClientRect();\n      } else if(visibleRect && (visibleRect.overflow.vertical === 1 || visibleRect.overflow.horizontal === 1)) {\n        needOpacity = true;\n      }\n    }\n\n    const containerRect = this.content.media.getBoundingClientRect();\n\n    let transform = '';\n    let left: number;\n    let top: number;\n\n    if(wasActive) {\n      left = fromRight === 1 ? windowSize.width : -containerRect.width;\n      top = containerRect.top;\n    } else {\n      left = rect.left;\n      top = rect.top;\n    }\n\n    /* if(zoomValue > 1) { // 33\n      // const diffX = (rect.width * zoomValue - rect.width) / 4;\n      const diffX = (rect.width * zoomValue - rect.width) / 2;\n      const diffY = (rect.height * zoomValue - rect.height) / 4;\n      // left -= diffX;\n      // top += diffY;\n    } */\n\n    transform += `translate3d(${left}px,${top}px,0) `;\n\n    /* if(wasActive) {\n      left = fromRight === 1 ? appPhotosManager.windowW / 2 : -(containerRect.width + appPhotosManager.windowW / 2);\n      transform += `translate(${left}px,-50%) `;\n    } else {\n      left = rect.left - (appPhotosManager.windowW / 2);\n      top = rect.top - (appPhotosManager.windowH / 2);\n      transform += `translate(${left}px,${top}px) `;\n    } */\n\n    let aspecter: HTMLDivElement;\n    if(target instanceof HTMLImageElement || target instanceof HTMLVideoElement || target.tagName === 'DIV') {\n      if(mover.firstElementChild && mover.firstElementChild.classList.contains('media-viewer-aspecter')) {\n        aspecter = mover.firstElementChild as HTMLDivElement;\n\n        const player = aspecter.querySelector('.ckin__player');\n        if(player) {\n          const video = player.firstElementChild as HTMLVideoElement;\n          aspecter.append(video);\n          player.remove();\n        }\n\n        if(!aspecter.style.cssText) { //  - ,   ,       \n          mover.classList.remove('active');\n          this.setFullAspect(aspecter, containerRect, rect);\n          void mover.offsetLeft; // reflow\n          mover.classList.add('active');\n        }\n      } else {\n        aspecter = document.createElement('div');\n        aspecter.classList.add('media-viewer-aspecter'/* , 'disable-hover' */);\n        mover.prepend(aspecter);\n      }\n\n      aspecter.style.cssText = `width: ${rect.width}px; height: ${rect.height}px; transform: scale3d(${containerRect.width / rect.width}, ${containerRect.height / rect.height}, 1);`;\n    }\n\n    mover.style.width = containerRect.width + 'px';\n    mover.style.height = containerRect.height + 'px';\n\n    // const scaleX = rect.width / (containerRect.width * zoomValue);\n    // const scaleY = rect.height / (containerRect.height * zoomValue);\n    const scaleX = rect.width / containerRect.width;\n    const scaleY = rect.height / containerRect.height;\n    if(!wasActive) {\n      transform += `scale3d(${scaleX},${scaleY},1) `;\n    }\n\n    let borderRadius = window.getComputedStyle(realParent).getPropertyValue('border-radius');\n    const brSplitted = fillPropertyValue(borderRadius) as string[];\n    borderRadius = brSplitted.map((r) => (parseInt(r) / scaleX) + 'px').join(' ');\n    if(!wasActive) {\n      mover.style.borderRadius = borderRadius;\n    }\n    // let borderRadius = '0px 0px 0px 0px';\n\n    if(closing && zoomValue !== 1) {\n      // const width = this.moversContainer.scrollWidth * scaleX;\n      // const height = this.moversContainer.scrollHeight * scaleY;\n      const willBeLeft = windowSize.width / 2 - rect.width / 2;\n      const willBeTop = windowSize.height / 2 - rect.height / 2;\n      const left = rect.left - willBeLeft/*  + (width - rect.width) / 2 */;\n      const top = rect.top - willBeTop/*  + (height - rect.height) / 2 */;\n      this.moversContainer.style.transform = `matrix(${scaleX}, 0, 0, ${scaleY}, ${left}, ${top})`;\n    } else {\n      mover.style.transform = transform;\n    }\n\n    needOpacity && (mover.style.opacity = '0'/* !closing ? '0' : '' */);\n\n    /* if(wasActive) {\n      this.log('setMoverToTarget', mover.style.transform);\n    } */\n\n    let path: SVGPathElement;\n    const isOut = target.classList.contains('is-out');\n\n    const deferred = this.setMoverAnimationPromise = deferredPromise<void>();\n    const ret = {onAnimationEnd: deferred};\n\n    const timeout = setTimeout(() => {\n      if(!deferred.isFulfilled && !deferred.isRejected) {\n        deferred.resolve();\n      }\n    }, 1000);\n\n    deferred.finally(() => {\n      this.dispatchEvent('setMoverAfter');\n\n      if(this.setMoverAnimationPromise === deferred) {\n        this.setMoverAnimationPromise = null;\n      }\n\n      clearTimeout(timeout);\n    });\n\n    if(!closing) {\n      let mediaElement: HTMLImageElement | HTMLVideoElement | HTMLCanvasElement;\n      let src: string;\n\n      // if(target instanceof HTMLVideoElement) {\n      const selector = 'video, img, .canvas-thumbnail';\n      const queryFrom = target.matches(selector) ? target.parentElement : target;\n      const elements = Array.from(queryFrom.querySelectorAll(selector)) as HTMLImageElement[];\n      if(elements.length) {\n        target = elements.pop();\n        const canvas = document.createElement('canvas');\n        const context = canvas.getContext('2d');\n        if(target instanceof HTMLImageElement) {\n          canvas.width = target.naturalWidth;\n          canvas.height = target.naturalHeight;\n        } else if(target instanceof HTMLVideoElement) {\n          canvas.width = target.videoWidth;\n          canvas.height = target.videoHeight;\n        } else if(target instanceof HTMLCanvasElement) {\n          canvas.width = target.width;\n          canvas.height = target.height;\n        }\n\n        canvas.className = 'canvas-thumbnail thumbnail media-photo';\n        context.drawImage(target as HTMLImageElement | HTMLCanvasElement, 0, 0);\n        target = canvas;\n      }\n      // }\n\n      if(target.tagName === 'DIV' || target.tagName === 'AVATAR-ELEMENT') { // useContainerAsTarget\n        const images = Array.from(target.querySelectorAll('img')) as HTMLImageElement[];\n        const image = images.pop();\n        if(image) {\n          mediaElement = new Image();\n          src = image.src;\n          mover.append(mediaElement);\n        }\n        /* mediaElement = new Image();\n        src = target.style.backgroundImage.slice(5, -2); */\n      } else if(target instanceof HTMLImageElement) {\n        mediaElement = new Image();\n        src = target.src;\n      } else if(target instanceof HTMLVideoElement) {\n        mediaElement = createVideo();\n        mediaElement.src = target.src;\n      } else if(target instanceof SVGSVGElement) {\n        const clipId = target.dataset.clipId;\n        const newClipId = clipId + '-mv';\n\n        const {width, height} = containerRect;\n\n        const newSvg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');\n        newSvg.setAttributeNS(null, 'width', '' + width);\n        newSvg.setAttributeNS(null, 'height', '' + height);\n\n        //     \n        newSvg.setAttributeNS(null, 'viewBox', `0 0 ${width} ${height}`);\n        newSvg.setAttributeNS(null, 'preserveAspectRatio', 'xMidYMid meet');\n\n        newSvg.insertAdjacentHTML('beforeend', target.firstElementChild.outerHTML.replace(clipId, newClipId));\n        newSvg.insertAdjacentHTML('beforeend', target.lastElementChild.outerHTML.replace(clipId, newClipId));\n\n        //       \n        const defs = newSvg.firstElementChild;\n        const use = defs.firstElementChild.firstElementChild as SVGUseElement;\n        if(use instanceof SVGUseElement) {\n          let transform = use.getAttributeNS(null, 'transform');\n          transform = transform.replace(/translate\\((.+?), (.+?)\\) scale\\((.+?), (.+?)\\)/, (match, x, y, sX, sY) => {\n            x = +x;\n            if(x !== 2) {\n              x = width - (2 / scaleX);\n            } else {\n              x = 2 / scaleX;\n            }\n\n            y = height;\n\n            return `translate(${x}, ${y}) scale(${+sX / scaleX}, ${+sY / scaleY})`;\n          });\n          use.setAttributeNS(null, 'transform', transform);\n\n          //   RECT\n          path = defs.firstElementChild.lastElementChild as SVGPathElement;\n\n          //            \n          let d: string;\n          const br: [number, number, number, number] = borderRadius.split(' ').map((v) => parseInt(v)) as any;\n          if(isOut) d = generatePathData(0, 0, width - 9 / scaleX, height, ...br);\n          else d = generatePathData(9 / scaleX, 0, width - 9 / scaleX, height, ...br);\n          path.setAttributeNS(null, 'd', d);\n        }\n\n        const foreignObject = newSvg.lastElementChild;\n        foreignObject.setAttributeNS(null, 'width', '' + containerRect.width);\n        foreignObject.setAttributeNS(null, 'height', '' + containerRect.height);\n\n        mover.prepend(newSvg);\n      } else if(target instanceof HTMLCanvasElement) {\n        mediaElement = target;\n      }\n\n      if(aspecter) {\n        aspecter.style.borderRadius = borderRadius;\n\n        if(mediaElement) {\n          aspecter.append(mediaElement);\n        }\n      }\n\n      mediaElement = mover.querySelector('video, img');\n      if(mediaElement instanceof HTMLImageElement) {\n        mediaElement.classList.add('thumbnail');\n        if(!aspecter) {\n          mediaElement.style.width = containerRect.width + 'px';\n          mediaElement.style.height = containerRect.height + 'px';\n        }\n\n        if(src) {\n          await renderImageFromUrlPromise(mediaElement, src);\n        }\n      }/*  else if(mediaElement instanceof HTMLVideoElement && mediaElement.firstElementChild && ((mediaElement.firstElementChild as HTMLSourceElement).src || src)) {\n        await new Promise((resolve, reject) => {\n          mediaElement.addEventListener('loadeddata', resolve);\n\n          if(src) {\n            (mediaElement.firstElementChild as HTMLSourceElement).src = src;\n          }\n        });\n      } */\n\n      mover.style.display = '';\n\n      fastRaf(() => {\n        mover.classList.add(wasActive ? 'moving' : 'active');\n      });\n    } else {\n      /* if(mover.classList.contains('center')) {\n        mover.classList.remove('center');\n        void mover.offsetLeft; // reflow\n      } */\n\n      if(target instanceof SVGSVGElement) {\n        path = mover.querySelector('path');\n\n        if(path) {\n          this.sizeTailPath(path, containerRect, scaleX, delay, false, isOut, borderRadius);\n        }\n      }\n\n      if(target.classList.contains('media-viewer-media')) {\n        mover.classList.add('hiding');\n      }\n\n      this.toggleWholeActive(false);\n\n      // return ret;\n\n      setTimeout(() => {\n        mover.style.borderRadius = borderRadius;\n\n        if(mover.firstElementChild) {\n          (mover.firstElementChild as HTMLElement).style.borderRadius = borderRadius;\n        }\n      }, delay / 2);\n\n      setTimeout(() => {\n        mover.innerHTML = '';\n        mover.classList.remove('moving', 'active', 'hiding');\n        mover.style.cssText = 'display: none;';\n\n        deferred.resolve();\n      }, delay);\n\n      mover.classList.remove('opening');\n\n      return ret;\n    }\n\n    mover.classList.add('opening');\n\n    // await new Promise((resolve) => setTimeout(resolve, 0));\n    // await new Promise((resolve) => window.requestAnimationFrame(resolve));\n    // *  RAF' ,       (  )\n    await doubleRaf();\n\n    //     - \n    // throw '';\n\n    // await new Promise((resolve) => setTimeout(resolve, 5e3));\n\n    mover.style.transform = `translate3d(${containerRect.left}px,${containerRect.top}px,0) scale3d(1,1,1)`;\n    // mover.style.transform = `translate(-50%,-50%) scale(1,1)`;\n    needOpacity && (mover.style.opacity = ''/* closing ? '0' : '' */);\n\n    if(aspecter) {\n      this.setFullAspect(aspecter, containerRect, rect);\n    }\n\n    // throw '';\n\n    setTimeout(() => {\n      mover.style.borderRadius = '';\n\n      if(mover.firstElementChild) {\n        (mover.firstElementChild as HTMLElement).style.borderRadius = '';\n      }\n    }, 0/* delay / 2 */);\n\n    mover.dataset.timeout = '' + setTimeout(() => {\n      mover.classList.remove('moving', 'opening');\n\n      if(aspecter) { //  - ,   ,       \n        if(mover.querySelector('video') || true) {\n          mover.classList.remove('active');\n          aspecter.style.cssText = '';\n          void mover.offsetLeft; // reflow\n        }\n\n        // aspecter.classList.remove('disable-hover');\n      }\n\n      //       ,      \n      mover.classList.add('center', 'no-transition');\n      /* mover.style.left = mover.style.top = '50%';\n      mover.style.transform = 'translate(-50%, -50%)';\n      void mover.offsetLeft; // reflow */\n\n      //      \n      mover.classList.add('active');\n      delete mover.dataset.timeout;\n\n      deferred.resolve();\n    }, delay);\n\n    if(path) {\n      this.sizeTailPath(path, containerRect, scaleX, delay, true, isOut, borderRadius);\n    }\n\n    return ret;\n  }\n\n  protected toggleWholeActive(active: boolean) {\n    if(active) {\n      this.wholeDiv.classList.add('active');\n    } else {\n      this.wholeDiv.classList.add('backwards');\n      setTimeout(() => {\n        this.wholeDiv.classList.remove('active');\n      }, 0);\n    }\n  }\n\n  protected setFullAspect(aspecter: HTMLDivElement, containerRect: DOMRect, rect: DOMRect) {\n    /* let media = aspecter.firstElementChild;\n    let proportion: number;\n    if(media instanceof HTMLImageElement) {\n      proportion = media.naturalWidth / media.naturalHeight;\n    } else if(media instanceof HTMLVideoElement) {\n      proportion = media.videoWidth / media.videoHeight;\n    } */\n    const proportion = containerRect.width / containerRect.height;\n\n    let {width, height} = rect;\n    /* if(proportion === 1) {\n      aspecter.style.cssText = '';\n    } else { */\n    if(proportion > 0) {\n      width = height * proportion;\n    } else {\n      height = width * proportion;\n    }\n\n    // this.log('will set style aspecter:', `width: ${width}px; height: ${height}px; transform: scale(${containerRect.width / width}, ${containerRect.height / height});`);\n\n    aspecter.style.cssText = `width: ${width}px; height: ${height}px; transform: scale3d(${containerRect.width / width}, ${containerRect.height / height}, 1);`;\n    // }\n  }\n\n  protected sizeTailPath(path: SVGPathElement, rect: DOMRect, scaleX: number, delay: number, upscale: boolean, isOut: boolean, borderRadius: string) {\n    const start = Date.now();\n    const {width, height} = rect;\n    delay = delay / 2;\n\n    const br = borderRadius.split(' ').map((v) => parseInt(v));\n\n    const step = () => {\n      const diff = Date.now() - start;\n\n      let progress = delay ? diff / delay : 1;\n      if(progress > 1) progress = 1;\n      if(upscale) progress = 1 - progress;\n\n      const _br: [number, number, number, number] = br.map((v) => v * progress) as any;\n\n      let d: string;\n      if(isOut) d = generatePathData(0, 0, width - (9 / scaleX * progress), height, ..._br);\n      else d = generatePathData(9 / scaleX * progress, 0, width/* width - (9 / scaleX * progress) */, height, ..._br);\n      path.setAttributeNS(null, 'd', d);\n\n      if(diff < delay) fastRaf(step);\n    };\n\n    // window.requestAnimationFrame(step);\n    step();\n  }\n\n  protected removeCenterFromMover(mover: HTMLElement) {\n    if(mover.classList.contains('center')) {\n      // const rect = mover.getBoundingClientRect();\n      const rect = this.content.media.getBoundingClientRect();\n      mover.style.transform = `translate3d(${rect.left}px,${rect.top}px,0)`;\n      mover.classList.remove('center');\n      void mover.offsetLeft; // reflow\n      mover.classList.remove('no-transition');\n    }\n  }\n\n  protected moveTheMover(mover: HTMLElement, toLeft = true) {\n    const windowW = windowSize.width;\n\n    this.removeCenterFromMover(mover);\n\n    // mover.classList.remove('active');\n    mover.classList.add('moving');\n\n    if(mover.dataset.timeout) { //     -  ,      \n      clearTimeout(+mover.dataset.timeout);\n    }\n\n    const rect = mover.getBoundingClientRect();\n\n    const newTransform = mover.style.transform.replace(/translate3d\\((.+?),/, (match, p1) => {\n      const x = toLeft ? -rect.width : windowW;\n      // const x = toLeft ? -(rect.right + (rect.width / 2)) : windowW / 2;\n\n      return match.replace(p1, x + 'px');\n    });\n\n    // //////this.log('set newTransform:', newTransform, mover.style.transform, toLeft);\n    mover.style.transform = newTransform;\n\n    setTimeout(() => {\n      mover.remove();\n    }, 350);\n  }\n\n  protected setNewMover() {\n    const newMover = document.createElement('div');\n    newMover.classList.add('media-viewer-mover');\n    newMover.style.display = 'none';\n\n    if(this.content.mover) {\n      const oldMover = this.content.mover;\n      oldMover.parentElement.append(newMover);\n    } else {\n      this.moversContainer.append(newMover);\n    }\n\n    return this.content.mover = newMover;\n  }\n\n  protected updateMediaSource(target: HTMLElement, url: string, tagName: 'video' | 'img') {\n    // if(target instanceof SVGSVGElement) {\n    const el = target.tagName.toLowerCase() === tagName ? target : target.querySelector(tagName) as HTMLElement;\n    if(el && !findUpClassName(target, 'document')) {\n      if(findUpClassName(target, 'attachment')) {\n        // two parentElements because element can be contained in aspecter\n        const preloader = target.parentElement.parentElement.querySelector('.preloader-container') as HTMLElement;\n        if(preloader) {\n          if(tagName === 'video') {\n            if(preloader.classList.contains('manual')) {\n              preloader.click();\n              // return;\n            }\n\n            return;\n          }\n\n          preloader.remove();\n        }\n      }\n\n      renderImageFromUrl(el, url);\n\n      // ! ,       \n      if(el.classList.contains('thumbnail') && el.parentElement.classList.contains('media-container-aspecter')) {\n        el.classList.remove('thumbnail');\n      }\n    }\n    /* } else {\n\n    } */\n  }\n\n  protected setAuthorInfo(fromId: PeerId | string, timestamp: number) {\n    const isPeerId = fromId.isPeerId();\n    let wrapTitlePromise: Promise<HTMLElement> | HTMLElement;\n    if(isPeerId) {\n      wrapTitlePromise = wrapPeerTitle({\n        peerId: fromId as PeerId,\n        dialog: false,\n        onlyFirstName: false,\n        plainText: false\n      })\n    } else {\n      const title = wrapTitlePromise = document.createElement('span');\n      title.append(wrapEmojiText(fromId));\n      title.classList.add('peer-title');\n    }\n\n    const oldAvatar = this.author.avatarEl;\n    const newAvatar = this.author.avatarEl = (oldAvatar.cloneNode() as AvatarElement);\n\n    return Promise.all([\n      (this.author.avatarEl as AvatarElement).updateWithOptions({\n        peerId: fromId as PeerId || NULL_PEER_ID,\n        peerTitle: isPeerId ? undefined : '' + fromId\n      }),\n\n      wrapTitlePromise\n    ]).then(([_, title]) => {\n      if(this.author.avatarEl !== newAvatar) {\n        return;\n      }\n\n      replaceContent(this.author.date, formatFullSentTime(timestamp));\n      replaceContent(this.author.nameEl, title);\n      oldAvatar.replaceWith(this.author.avatarEl);\n    });\n  }\n\n  protected async _openMedia(\n    media: MyDocument | MyPhoto,\n    timestamp: number,\n    fromId: PeerId | string,\n    fromRight: number,\n    target?: HTMLElement,\n    reverse = false,\n    prevTargets: TargetType[] = [],\n    nextTargets: TargetType[] = [],\n    message?: MyMessage\n    /* , needLoadMore = true */\n  ) {\n    if(this.setMoverPromise) return this.setMoverPromise;\n\n    /* if(DEBUG) {\n      this.log('openMedia:', media, fromId, prevTargets, nextTargets);\n    } */\n\n    const setAuthorPromise = this.setAuthorInfo(fromId, timestamp);\n\n    const isDocument = media._ === 'document';\n    const isVideo = isDocument && media.mime_type && ((['video', 'gif'] as MyDocument['type'][]).includes(media.type) || media.mime_type.indexOf('video/') === 0);\n\n    if(this.isFirstOpen) {\n      // this.targetContainer = targetContainer;\n      // this.needLoadMore = needLoadMore;\n      this.isFirstOpen = false;\n      this.listLoader.setTargets(prevTargets, nextTargets, reverse);\n      (window as any).appMediaViewer = this;\n      // this.loadMore = loadMore;\n\n      /* if(appSidebarRight.historyTabIDs.slice(-1)[0] === AppSidebarRight.SLIDERITEMSIDS.forward) {\n        appSidebarRight.forwardTab.closeBtn.click();\n        await new Promise((resolve) => setTimeout(resolve, 200));\n      } */\n    }\n\n    if(this.listLoader.next.length < 10) {\n      setTimeout(() => {\n        this.listLoader.load(true);\n      }, 0);\n    }\n\n    // if(prevTarget && (!prevTarget.parentElement || !this.isElementVisible(this.targetContainer, prevTarget))) prevTarget = null;\n    // if(nextTarget && (!nextTarget.parentElement || !this.isElementVisible(this.targetContainer, nextTarget))) nextTarget = null;\n\n    this.buttons.prev.classList.toggle('hide', !this.listLoader.previous.length);\n    this.buttons.next.classList.toggle('hide', !this.listLoader.next.length);\n\n    const container = this.content.media;\n    const useContainerAsTarget = !target || target === container;\n    if(useContainerAsTarget) target = container;\n\n    this.target = {element: target} as any;\n    const tempId = ++this.tempId;\n\n    if(container.firstElementChild) {\n      container.innerHTML = '';\n    }\n\n    // ok set\n\n    const wasActive = fromRight !== 0;\n    if(wasActive) {\n      this.moveTheMover(this.content.mover, fromRight === 1);\n      this.setNewMover();\n    } else {\n      this.toggleOverlay(true);\n      this.setGlobalListeners();\n      await setAuthorPromise;\n\n      if(!this.wholeDiv.parentElement) {\n        this.pageEl.insertBefore(this.wholeDiv, document.getElementById('main-columns'));\n        void this.wholeDiv.offsetLeft; // reflow\n      }\n\n      this.toggleWholeActive(true);\n\n      if(!IS_MOBILE_SAFARI) {\n        this.navigationItem = {\n          type: 'media',\n          onPop: (canAnimate) => {\n            if(this.setMoverAnimationPromise) {\n              return false;\n            }\n\n            this.close();\n          }\n        };\n\n        appNavigationController.pushItem(this.navigationItem);\n      }\n    }\n\n    // //////this.log('wasActive:', wasActive);\n\n    const mover = this.content.mover;\n\n    const maxWidth = windowSize.width;\n    // const maxWidth = this.pageEl.scrollWidth;\n    // TODO: const maxHeight = mediaSizes.isMobile ? appPhotosManager.windowH : appPhotosManager.windowH - 100;\n    let padding = 0;\n    const windowH = windowSize.height;\n    if(windowH < 1000000 && !mediaSizes.isMobile) {\n      padding = 120;\n    }\n    const maxHeight = windowH - 120 - padding;\n    let thumbPromise: Promise<any> = Promise.resolve();\n    const size = setAttachmentSize(media, container, maxWidth, maxHeight, mediaSizes.isMobile ? false : true, undefined, !!(isDocument && media.w && media.h)).photoSize;\n    if(useContainerAsTarget) {\n      const cacheContext = await this.managers.thumbsStorage.getCacheContext(media, size.type);\n      let img: HTMLImageElement | HTMLCanvasElement;\n      if(cacheContext.downloaded) {\n        img = new Image();\n        img.src = cacheContext.url;\n      } else {\n        const gotThumb = getStrippedThumbIfNeeded(media, cacheContext, true);\n        if(gotThumb) {\n          thumbPromise = gotThumb.loadPromise;\n          img = gotThumb.image;\n        }\n      }\n\n      if(img) {\n        img.classList.add('thumbnail');\n        container.append(img);\n      }\n    }\n\n    // need after setAttachmentSize\n    /* if(useContainerAsTarget) {\n      target = target.querySelector('img, video') || target;\n    } */\n\n    const supportsStreaming: boolean = !!(isDocument && media.supportsStreaming);\n    const preloader = supportsStreaming ? this.preloaderStreamable : this.preloader;\n\n    const getCacheContext = () => {\n      return this.managers.thumbsStorage.getCacheContext(media, size?.type);\n    };\n\n    let setMoverPromise: Promise<void>;\n    if(isVideo) {\n      // //////this.log('will wrap video', media, size);\n\n      //    safari     event'\n      // const video = document.createElement('video');\n      const useController = message && media.type !== 'gif';\n      const video = /* useController ?\n        appMediaPlaybackController.addMedia(message, false, true) as HTMLVideoElement :\n         */createVideo({pip: useController});\n\n      const set = () => this.setMoverToTarget(target, false, fromRight).then(({onAnimationEnd}) => {\n      // return; // set and don't move\n      // if(wasActive) return;\n        // return;\n\n        const div = mover.firstElementChild && mover.firstElementChild.classList.contains('media-viewer-aspecter') ? mover.firstElementChild : mover;\n        // const video = mover.querySelector('video') || document.createElement('video');\n\n        const moverVideo = mover.querySelector('video');\n        if(moverVideo) {\n          moverVideo.remove();\n        }\n\n        // video.src = '';\n\n        video.setAttribute('playsinline', 'true');\n\n        // * fix for playing video if viewer is closed (https://contest.com/javascript-web-bonus/entry1425#issue11629)\n        video.addEventListener('timeupdate', () => {\n          if(this.tempId !== tempId) {\n            video.pause();\n          }\n        });\n\n        this.addEventListener('setMoverAfter', () => {\n          video.src = '';\n          video.load();\n        }, {once: true});\n\n        if(IS_SAFARI) {\n          // test stream\n          // video.controls = true;\n          video.autoplay = true;\n        }\n\n        if(media.type === 'gif') {\n          video.muted = true;\n          video.autoplay = true;\n          video.loop = true;\n        } else if(media.duration < 60) {\n          video.loop = true;\n        }\n\n        // if(!video.parentElement) {\n        div.append(video);\n        // }\n\n        const canPlayThrough = new Promise((resolve) => {\n          video.addEventListener('canplay', resolve, {once: true});\n        });\n\n        const createPlayer = () => {\n          if(media.type !== 'gif') {\n            video.dataset.ckin = 'default';\n            video.dataset.overlay = '1';\n\n            Promise.all([canPlayThrough, onAnimationEnd]).then(() => {\n              if(this.tempId !== tempId) {\n                return;\n              }\n\n              // const play = useController ? appMediaPlaybackController.willBePlayedMedia === video : true;\n              const play = true;\n              const player = this.videoPlayer = new VideoPlayer({\n                video,\n                play,\n                streamable: supportsStreaming,\n                onPlaybackRackMenuToggle: (open) => {\n                  this.wholeDiv.classList.toggle('hide-caption', !!open);\n                },\n                onPip: (pip) => {\n                  const otherMediaViewer = (window as any).appMediaViewer;\n                  if(!pip && otherMediaViewer && otherMediaViewer !== this) {\n                    this.releaseSingleMedia = undefined;\n                    this.close();\n                    return;\n                  }\n\n                  const mover = this.moversContainer.lastElementChild as HTMLElement;\n                  mover.classList.toggle('hiding', pip);\n                  this.toggleWholeActive(!pip);\n                  this.toggleOverlay(!pip);\n                  this.toggleGlobalListeners(!pip);\n\n                  if(this.navigationItem) {\n                    if(pip) appNavigationController.removeItem(this.navigationItem);\n                    else appNavigationController.pushItem(this.navigationItem);\n                  }\n\n                  if(useController) {\n                    if(pip) {\n                      // appMediaPlaybackController.toggleSwitchers(true);\n\n                      this.releaseSingleMedia(false);\n                      this.releaseSingleMedia = undefined;\n\n                      appMediaPlaybackController.setPictureInPicture(video);\n                    } else {\n                      this.releaseSingleMedia = appMediaPlaybackController.setSingleMedia(video, message as Message.message);\n                    }\n                  }\n                },\n                onPipClose: () => {\n                  // this.target = undefined;\n                  // this.toggleWholeActive(false);\n                  // this.toggleOverlay(false);\n                  this.close();\n                }\n              });\n              player.addEventListener('toggleControls', (show) => {\n                this.wholeDiv.classList.toggle('has-video-controls', show);\n              });\n\n              this.addEventListener('setMoverBefore', () => {\n                this.wholeDiv.classList.remove('has-video-controls');\n                this.videoPlayer.cleanup();\n                this.videoPlayer = undefined;\n              }, {once: true});\n\n              if(this.isZooming()) {\n                this.videoPlayer.lockControls(false);\n              }\n              /* div.append(video);\n              mover.append(player.wrapper); */\n            });\n          }\n        };\n\n        if(supportsStreaming) {\n          onAnimationEnd.then(() => {\n            if(video.readyState < video.HAVE_FUTURE_DATA) {\n              // console.log('ppp 1');\n              preloader.attach(mover, true);\n            }\n\n            /* canPlayThrough.then(() => {\n              preloader.detach();\n            }); */\n          });\n\n          const attachCanPlay = () => {\n            video.addEventListener('canplay', () => {\n              // console.log('ppp 2');\n              preloader.detach();\n              video.parentElement.classList.remove('is-buffering');\n            }, {once: true});\n          };\n\n          video.addEventListener('waiting', () => {\n            const loading = video.networkState === video.NETWORK_LOADING;\n            const isntEnoughData = video.readyState < video.HAVE_FUTURE_DATA;\n\n            // this.log('video waiting for progress', loading, isntEnoughData);\n            if(loading && isntEnoughData) {\n              attachCanPlay();\n\n              // console.log('ppp 3');\n              preloader.attach(mover, true);\n\n              //    ,        \n              video.parentElement.classList.add('is-buffering');\n            }\n          });\n\n          if(this.wholeDiv.classList.contains('no-forwards')) {\n            video.addEventListener('contextmenu', (e) => {\n              cancelEvent(e);\n            });\n          }\n\n          attachCanPlay();\n        }\n\n        // if(!video.src || media.url !== video.src) {\n        const load = async() => {\n          /* if(useController) {\n              appMediaPlaybackController.resolveWaitingForLoadMedia(message.peerId, message.mid, message.pFlags.is_scheduled);\n            } */\n\n          const promise: Promise<any> = supportsStreaming ? Promise.resolve() : appDownloadManager.downloadMediaURL({media});\n\n          if(!supportsStreaming) {\n            onAnimationEnd.then(async() => {\n              if(!(await getCacheContext()).url) {\n                // console.log('ppp 4');\n                preloader.attach(mover, true, promise);\n              }\n            });\n          }\n\n          Promise.all([promise, onAnimationEnd]).then(async() => {\n            if(this.tempId !== tempId) {\n              this.log.warn('media viewer changed video');\n              return;\n            }\n\n            const url = (await getCacheContext()).url;\n\n            video.addEventListener('error', () => {\n              if(video.error.code !== 4) {\n                this.log.error('Error ' + video.error.code + '; details: ' + video.error.message);\n              }\n\n              if(preloader) {\n                preloader.detach();\n              }\n            }, {once: true});\n\n            if(target instanceof SVGSVGElement/*  && (video.parentElement || !isSafari) */) { // if video exists\n              // if(!video.parentElement) {\n              div.firstElementChild.lastElementChild.append(video);\n              // }\n            } else {\n              renderImageFromUrl(video, url);\n            }\n\n            // * have to set options (especially playbackRate) after src\n            // * https://github.com/videojs/video.js/issues/2516\n            if(useController) {\n              this.releaseSingleMedia = appMediaPlaybackController.setSingleMedia(video, message as Message.message);\n\n              this.addEventListener('setMoverBefore', () => {\n                if(this.releaseSingleMedia) {\n                  this.releaseSingleMedia();\n                  this.releaseSingleMedia = undefined;\n                }\n              }, {once: true});\n            }\n\n            this.updateMediaSource(target, url, 'video');\n\n            createPlayer();\n          });\n\n          return promise;\n        };\n\n        this.lazyLoadQueue.unshift({load});\n        // } else createPlayer();\n      });\n\n      setMoverPromise = thumbPromise.then(set);\n    } else {\n      const set = () => this.setMoverToTarget(target, false, fromRight).then(({onAnimationEnd}) => {\n      // return; // set and don't move\n      // if(wasActive) return;\n        // return;\n\n        const load = async() => {\n          const cancellablePromise = isDocument ? appDownloadManager.downloadMediaURL({media}) : appDownloadManager.downloadMediaURL({media, thumb: size});\n\n          onAnimationEnd.then(async() => {\n            if(!(await getCacheContext()).url) {\n              this.preloader.attachPromise(cancellablePromise);\n              // this.preloader.attach(mover, true, cancellablePromise);\n            }\n          });\n\n          Promise.all([onAnimationEnd, cancellablePromise]).then(async() => {\n            if(this.tempId !== tempId) {\n              this.log.warn('media viewer changed photo');\n              return;\n            }\n\n            // /////this.log('indochina', blob);\n\n            const url = (await getCacheContext()).url;\n            if(target instanceof SVGSVGElement) {\n              this.updateMediaSource(target, url, 'img');\n              this.updateMediaSource(mover, url, 'img');\n\n              if(mediaSizes.isMobile) {\n                const imgs = mover.querySelectorAll('img');\n                if(imgs && imgs.length) {\n                  imgs.forEach((img) => {\n                    img.classList.remove('thumbnail'); //      \n                  });\n                }\n              }\n            } else {\n              const div = mover.firstElementChild && mover.firstElementChild.classList.contains('media-viewer-aspecter') ? mover.firstElementChild : mover;\n              const haveImage = div.firstElementChild?.tagName === 'IMG' ? div.firstElementChild as HTMLImageElement : null;\n              if(!haveImage || haveImage.src !== url)  {\n                const image = new Image();\n                image.classList.add('thumbnail');\n\n                // this.log('will renderImageFromUrl:', image, div, target);\n\n                renderImageFromUrl(image, url, () => {\n                  this.updateMediaSource(target, url, 'img');\n\n                  if(haveImage) {\n                    fastRaf(() => {\n                      haveImage.remove();\n                    });\n                  }\n\n                  div.append(image);\n                });\n              }\n            }\n\n            // this.preloader.detach();\n          }).catch((err) => {\n            this.log.error(err);\n            this.preloader.attach(mover);\n            this.preloader.setManual();\n          });\n\n          return cancellablePromise;\n        };\n\n        this.lazyLoadQueue.unshift({load});\n      });\n\n      setMoverPromise = thumbPromise.then(set);\n    }\n\n    return this.setMoverPromise = setMoverPromise.catch(() => {\n      this.setMoverAnimationPromise = null;\n    }).finally(() => {\n      this.setMoverPromise = null;\n    });\n  }\n}\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nexport default function fillPropertyValue(str: string) {\r\n  const splitted = str.split(' ');\r\n  if(splitted.length !== 4) {\r\n    if(!splitted[0]) splitted[0] = '0px';\r\n    for(let i = splitted.length; i < 4; ++i) {\r\n      splitted[i] = splitted[i % 2] || splitted[0] || '0px';\r\n    }\r\n  }\r\n\r\n  return splitted;\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport {MOUNT_CLASS_TO} from '../config/debug';\r\nimport {IS_MOBILE_SAFARI} from '../environment/userAgent';\r\nimport {logger} from '../lib/logger';\r\nimport blurActiveElement from '../helpers/dom/blurActiveElement';\r\nimport cancelEvent from '../helpers/dom/cancelEvent';\r\nimport isSwipingBackSafari from '../helpers/dom/isSwipingBackSafari';\r\nimport indexOfAndSplice from '../helpers/array/indexOfAndSplice';\r\n\r\nexport type NavigationItem = {\r\n  type: 'left' | 'right' | 'im' | 'chat' | 'popup' | 'media' | 'menu' |\r\n    'esg' | 'multiselect' | 'input-helper' | 'autocomplete-helper' | 'markup' |\r\n    'global-search' | 'voice' | 'mobile-search' | 'filters' | 'global-search-focus' |\r\n    'toast',\r\n  onPop: (canAnimate: boolean) => boolean | void,\r\n  onEscape?: () => boolean,\r\n  noHistory?: boolean,\r\n  noBlurOnPop?: boolean,\r\n};\r\n\r\nexport class AppNavigationController {\r\n  private navigations: Array<NavigationItem>;\r\n  private id: number;\r\n  private manual: boolean;\r\n  private log: ReturnType<typeof logger>;\r\n  private debug: boolean;\r\n  private currentHash: string; // have to start with # if not empty\r\n  private overriddenHash: string; // have to start with # if not empty\r\n  private isPossibleSwipe: boolean;\r\n  public onHashChange: () => void;\r\n\r\n  constructor() {\r\n    this.navigations = [];\r\n    this.id = Date.now();\r\n    this.manual = false;\r\n    this.log = logger('NC');\r\n    this.debug = true;\r\n    this.currentHash = window.location.hash;\r\n    this.overriddenHash = '';\r\n    this.isPossibleSwipe = false;\r\n\r\n    window.addEventListener('popstate', this.onPopState);\r\n    window.addEventListener('keydown', this.onKeyDown, {capture: true, passive: false});\r\n\r\n    if(IS_MOBILE_SAFARI) {\r\n      const options = {passive: true};\r\n      window.addEventListener('touchstart', this.onTouchStart, options);\r\n    }\r\n\r\n    history.scrollRestoration = 'manual';\r\n\r\n    this.pushState(); // * push init state\r\n  }\r\n\r\n  private onPopState = (e: PopStateEvent) => {\r\n    const hash = window.location.hash;\r\n    const id: number = e.state;\r\n    this.debug && this.log('popstate', e, this.isPossibleSwipe, hash);\r\n    if(hash !== this.currentHash) {\r\n      this.debug && this.log.warn(`hash changed, new=${hash}, current=${this.currentHash}, overridden=${this.overriddenHash}`);\r\n      // fix for returning to wrong hash (e.g. chat -> archive -> chat -> 3x back)\r\n      if(id === this.id && this.overriddenHash && this.overriddenHash !== hash) {\r\n        this.overrideHash(this.overriddenHash);\r\n      } else if(id/*  === this.id */ && !this.overriddenHash && hash) {\r\n        this.overrideHash();\r\n      } else {\r\n        this.currentHash = hash;\r\n        this.onHashChange && this.onHashChange();\r\n        // this.replaceState();\r\n        return;\r\n      }\r\n    }\r\n\r\n    if(id !== this.id/*  && !this.navigations.length */) {\r\n      this.pushState();\r\n\r\n      if(!this.navigations.length) {\r\n        return;\r\n      }\r\n    }\r\n\r\n    const item = this.navigations.pop();\r\n    if(!item) {\r\n      this.pushState();\r\n      return;\r\n    }\r\n\r\n    this.manual = !this.isPossibleSwipe;\r\n    this.handleItem(item);\r\n    // this.pushState(); // * prevent adding forward arrow\r\n  };\r\n\r\n  private onKeyDown = (e: KeyboardEvent) => {\r\n    const item = this.navigations[this.navigations.length - 1];\r\n    if(!item) return;\r\n    if(e.key === 'Escape' && (item.onEscape ? item.onEscape() : true)) {\r\n      cancelEvent(e);\r\n      this.back(item.type);\r\n    }\r\n  };\r\n\r\n  private onTouchStart = (e: TouchEvent) => {\r\n    if(e.touches.length > 1) return;\r\n    this.debug && this.log('touchstart');\r\n\r\n    if(isSwipingBackSafari(e)) {\r\n      this.isPossibleSwipe = true;\r\n\r\n      window.addEventListener('touchend', () => {\r\n        setTimeout(() => {\r\n          this.isPossibleSwipe = false;\r\n        }, 100);\r\n      }, {passive: true, once: true});\r\n    }\r\n\r\n    /* const detach = () => {\r\n      window.removeEventListener('touchend', onTouchEnd);\r\n      window.removeEventListener('touchmove', onTouchMove);\r\n    };\r\n\r\n    let moved = false;\r\n    const onTouchMove = (e: TouchEvent) => {\r\n      this.debug && this.log('touchmove');\r\n      if(e.touches.length > 1) {\r\n        detach();\r\n        return;\r\n      }\r\n\r\n      moved = true;\r\n    };\r\n\r\n    const onTouchEnd = (e: TouchEvent) => {\r\n      this.debug && this.log('touchend');\r\n      if(e.touches.length > 1 || !moved) {\r\n        detach();\r\n        return;\r\n      }\r\n\r\n      isPossibleSwipe = true;\r\n      doubleRaf().then(() => {\r\n        isPossibleSwipe = false;\r\n      });\r\n\r\n      detach();\r\n    };\r\n\r\n    window.addEventListener('touchend', onTouchEnd, options);\r\n    window.addEventListener('touchmove', onTouchMove, options); */\r\n  };\r\n\r\n  public overrideHash(hash: string = '') {\r\n    if(hash && hash[0] !== '#') hash = '#' + hash;\r\n    else if(hash === '#') hash = '';\r\n\r\n    this.overriddenHash = this.currentHash = hash;\r\n    this.replaceState();\r\n    this.pushState();\r\n  }\r\n\r\n  private handleItem(item: NavigationItem) {\r\n    const good = item.onPop(!this.manual ? false : undefined);\r\n    this.debug && this.log('popstate, navigation:', item, this.navigations);\r\n    if(good === false) {\r\n      this.pushItem(item);\r\n    } else if(!item.noBlurOnPop) {\r\n      blurActiveElement(); // no better place for it\r\n    }\r\n\r\n    this.manual = false;\r\n  }\r\n\r\n  public findItemByType(type: NavigationItem['type']) {\r\n    for(let i = this.navigations.length - 1; i >= 0; --i) {\r\n      const item = this.navigations[i];\r\n      if(item.type === type) {\r\n        return {item, index: i};\r\n      }\r\n    }\r\n  }\r\n\r\n  public back(type?: NavigationItem['type']) {\r\n    if(type) {\r\n      const ret = this.findItemByType(type);\r\n      if(ret) {\r\n        this.backByItem(ret.item, ret.index);\r\n        return;\r\n      }\r\n    }\r\n\r\n    history.back();\r\n  }\r\n\r\n  public backByItem(item: NavigationItem, index = this.navigations.indexOf(item)) {\r\n    this.manual = true;\r\n    // ! commented because 'popstate' event will be fired with delay\r\n    // if(index !== (this.navigations.length - 1)) {\r\n    this.navigations.splice(index, 1);\r\n    this.handleItem(item);\r\n    // }\r\n  }\r\n\r\n  private onItemAdded(item: NavigationItem) {\r\n    this.debug && this.log('onItemAdded', item, this.navigations);\r\n\r\n    if(!item.noHistory) {\r\n      this.pushState();\r\n    }\r\n  }\r\n\r\n  public pushItem(item: NavigationItem) {\r\n    this.navigations.push(item);\r\n    this.onItemAdded(item);\r\n  }\r\n\r\n  public unshiftItem(item: NavigationItem) {\r\n    this.navigations.unshift(item);\r\n    this.onItemAdded(item);\r\n  }\r\n\r\n  public spliceItems(index: number, length: number, ...items: NavigationItem[]) {\r\n    this.navigations.splice(index, length, ...items);\r\n    items.forEach((item) => {\r\n      this.onItemAdded(item);\r\n    });\r\n  }\r\n\r\n  private pushState() {\r\n    this.debug && this.log('push');\r\n    this.manual = false;\r\n    history.pushState(this.id, '');\r\n  }\r\n\r\n  public replaceState() {\r\n    this.debug && this.log.warn('replace');\r\n\r\n    const url = location.origin + location.pathname + location.search + this.overriddenHash;\r\n    history.replaceState(this.id, '', url);\r\n  }\r\n\r\n  public removeItem(item: NavigationItem) {\r\n    if(!item) {\r\n      return;\r\n    }\r\n\r\n    indexOfAndSplice(this.navigations, item);\r\n  }\r\n\r\n  public removeByType(type: NavigationItem['type'], single = false) {\r\n    for(let i = this.navigations.length - 1; i >= 0; --i) {\r\n      const item = this.navigations[i];\r\n      if(item.type === type) {\r\n        this.navigations.splice(i, 1);\r\n\r\n        if(single) {\r\n          break;\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\nconst appNavigationController = new AppNavigationController();\r\nMOUNT_CLASS_TO.appNavigationController = appNavigationController;\r\nexport default appNavigationController;\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport appDialogsManager from '../lib/appManagers/appDialogsManager';\r\nimport Scrollable from './scrollable';\r\nimport InputSearch from './inputSearch';\r\nimport replaceContent from '../helpers/dom/replaceContent';\r\nimport {i18n, LangPackKey} from '../lib/langPack';\r\nimport rootScope from '../lib/rootScope';\r\n\r\nexport class SearchGroup {\r\n  container: HTMLDivElement;\r\n  nameEl: HTMLDivElement;\r\n  list: HTMLUListElement;\r\n\r\n  constructor(\r\n    public name: LangPackKey | boolean,\r\n    public type: string,\r\n    private clearable = true,\r\n    className?: string,\r\n    clickable = true,\r\n    public autonomous = true,\r\n    public onFound?: () => void,\r\n    public noIcons?: boolean\r\n  ) {\r\n    this.list = appDialogsManager.createChatList();\r\n    this.container = document.createElement('div');\r\n    if(className) this.container.className = className;\r\n\r\n    if(name) {\r\n      this.nameEl = document.createElement('div');\r\n      this.nameEl.classList.add('search-group__name');\r\n      if(typeof(name) === 'string') {\r\n        this.nameEl.append(i18n(name));\r\n      }\r\n      this.container.append(this.nameEl);\r\n    }\r\n\r\n    this.container.classList.add('search-group', 'search-group-' + type);\r\n    this.container.append(this.list);\r\n    this.container.style.display = 'none';\r\n\r\n    if(clickable) {\r\n      appDialogsManager.setListClickListener(this.list, onFound, undefined, autonomous);\r\n    }\r\n  }\r\n\r\n  clear() {\r\n    this.container.style.display = 'none';\r\n\r\n    if(this.clearable) {\r\n      this.list.innerHTML = '';\r\n    }\r\n  }\r\n\r\n  setActive() {\r\n    this.container.style.display = '';\r\n  }\r\n\r\n  toggle() {\r\n    if(this.list.childElementCount) {\r\n      this.setActive();\r\n    } else {\r\n      this.clear();\r\n    }\r\n  }\r\n}\r\n\r\nexport type SearchGroupType = 'contacts' | 'globalContacts' | 'messages' | string;\r\n\r\nexport default class AppSearch {\r\n  private minMsgId = 0;\r\n  private loadedCount = -1;\r\n  private foundCount = -1;\r\n\r\n  private searchPromise: Promise<void> = null;\r\n  private searchTimeout: number = 0;\r\n\r\n  private query = '';\r\n\r\n  private listsContainer: HTMLDivElement = null;\r\n\r\n  private peerId: PeerId; // 0 - means global\r\n  private threadId = 0;\r\n\r\n  private scrollable: Scrollable;\r\n\r\n  constructor(\r\n    public container: HTMLElement,\r\n    public searchInput: InputSearch,\r\n    public searchGroups: {[group in SearchGroupType]: SearchGroup},\r\n    public onSearch?: (count: number) => void,\r\n    public noIcons?: boolean\r\n  ) {\r\n    this.scrollable = new Scrollable(this.container);\r\n    this.listsContainer = this.scrollable.container as HTMLDivElement;\r\n    for(const i in this.searchGroups) {\r\n      this.listsContainer.append(this.searchGroups[i as SearchGroupType].container);\r\n    }\r\n\r\n    if(this.searchGroups.messages) {\r\n      this.scrollable.setVirtualContainer(this.searchGroups.messages.list);\r\n    }\r\n\r\n    this.searchInput.onChange = (value) => {\r\n      /* if(!value.trim()) {\r\n        //this.peerId = 0;\r\n        return;\r\n      } */\r\n\r\n      this.query = value;\r\n      this.reset(false);\r\n      this.searchMore();\r\n    };\r\n\r\n    this.scrollable.onScrolledBottom = () => {\r\n      if(!this.query.trim()) return;\r\n\r\n      if(!this.searchTimeout) {\r\n        this.searchTimeout = window.setTimeout(() => {\r\n          this.searchMore();\r\n          this.searchTimeout = 0;\r\n        }, 0);\r\n      }\r\n    };\r\n  }\r\n\r\n  public reset(all = true) {\r\n    if(all) {\r\n      this.searchInput.value = '';\r\n      this.query = '';\r\n      this.peerId = undefined;\r\n      this.threadId = 0;\r\n    }\r\n\r\n    this.minMsgId = 0;\r\n    this.loadedCount = -1;\r\n    this.foundCount = -1;\r\n\r\n    for(const i in this.searchGroups) {\r\n      this.searchGroups[i as SearchGroupType].clear();\r\n    }\r\n\r\n    this.searchPromise = null;\r\n  }\r\n\r\n  public beginSearch(peerId?: PeerId, threadId = 0, query = '') {\r\n    this.peerId = peerId;\r\n    this.threadId = threadId;\r\n\r\n    if(this.query !== query) {\r\n      this.searchInput.inputField.value = query;\r\n    }\r\n\r\n    this.searchInput.input.focus();\r\n  }\r\n\r\n  public searchMore() {\r\n    if(this.searchPromise) return this.searchPromise;\r\n\r\n    const query = this.query;\r\n\r\n    if(!query.trim()) {\r\n      this.onSearch && this.onSearch(0);\r\n      return;\r\n    }\r\n\r\n    if(this.foundCount !== -1 && this.loadedCount >= this.foundCount) {\r\n      return Promise.resolve();\r\n    }\r\n\r\n    const maxId = this.minMsgId || 0;\r\n\r\n    return this.searchPromise = rootScope.managers.appMessagesManager.getSearch({\r\n      peerId: this.peerId,\r\n      query,\r\n      inputFilter: {_: 'inputMessagesFilterEmpty'},\r\n      maxId,\r\n      limit: 20,\r\n      threadId: this.threadId\r\n    }).then((res) => {\r\n      this.searchPromise = null;\r\n\r\n      if(this.searchInput.value !== query) {\r\n        return;\r\n      }\r\n\r\n      // console.log('input search result:', this.peerId, query, null, maxId, 20, res);\r\n\r\n      const {count, history} = res;\r\n\r\n      if(history.length && history[0].mid === this.minMsgId) {\r\n        history.shift();\r\n      }\r\n\r\n      const searchGroup = this.searchGroups.messages;\r\n\r\n      history.forEach((message) => {\r\n        try {\r\n          const peerId = this.peerId ? message.fromId : message.peerId;\r\n          appDialogsManager.addDialogAndSetLastMessage({\r\n            peerId,\r\n            container: this.scrollable/* searchGroup.list */,\r\n            avatarSize: 54,\r\n            meAsSaved: false,\r\n            message,\r\n            query,\r\n            noIcons: this.noIcons\r\n          });\r\n        } catch(err) {\r\n          console.error('[appSearch] render search result', err);\r\n        }\r\n      });\r\n\r\n      searchGroup.toggle();\r\n\r\n      this.minMsgId = history.length && history[history.length - 1].mid;\r\n\r\n      if(this.loadedCount === -1) {\r\n        this.loadedCount = 0;\r\n      }\r\n      this.loadedCount += history.length;\r\n\r\n      if(this.foundCount === -1) {\r\n        this.foundCount = count;\r\n\r\n        if(searchGroup.nameEl) {\r\n          replaceContent(searchGroup.nameEl, i18n(count ? 'Chat.Search.MessagesFound' : 'Chat.Search.NoMessagesFound', [count]));\r\n        }\r\n\r\n        this.onSearch && this.onSearch(this.foundCount);\r\n      }\r\n    }).catch((err) => {\r\n      console.error('search error', err);\r\n      this.searchPromise = null;\r\n    });\r\n  }\r\n}\r\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport appDialogsManager, {DIALOG_LIST_ELEMENT_TAG} from '../lib/appManagers/appDialogsManager';\nimport type {MyInputMessagesFilter, MyMessage} from '../lib/appManagers/appMessagesManager';\nimport {logger} from '../lib/logger';\nimport rootScope from '../lib/rootScope';\nimport {SearchGroup, SearchGroupType} from './appSearch';\nimport {horizontalMenu} from './horizontalMenu';\nimport LazyLoadQueue from './lazyLoadQueue';\nimport {putPreloader} from './putPreloader';\nimport ripple from './ripple';\nimport Scrollable, {ScrollableX} from './scrollable';\nimport {wrapDocument, wrapPhoto, wrapVideo} from './wrappers';\nimport useHeavyAnimationCheck, {getHeavyAnimationPromise} from '../hooks/useHeavyAnimationCheck';\nimport I18n, {LangPackKey, i18n} from '../lib/langPack';\nimport findUpClassName from '../helpers/dom/findUpClassName';\nimport {getMiddleware, Middleware} from '../helpers/middleware';\nimport {ChannelParticipant, ChatFull, ChatParticipant, ChatParticipants, Document, Message, MessageMedia, Photo, WebPage} from '../layer';\nimport SortedUserList from './sortedUserList';\nimport findUpTag from '../helpers/dom/findUpTag';\nimport appSidebarRight from './sidebarRight';\nimport mediaSizes from '../helpers/mediaSizes';\nimport appImManager from '../lib/appManagers/appImManager';\nimport positionElementByIndex from '../helpers/dom/positionElementByIndex';\nimport cleanSearchText from '../helpers/cleanSearchText';\nimport IS_TOUCH_SUPPORTED from '../environment/touchSupport';\nimport handleTabSwipe from '../helpers/dom/handleTabSwipe';\nimport windowSize from '../helpers/windowSize';\nimport {formatPhoneNumber} from '../helpers/formatPhoneNumber';\nimport ButtonMenu, {ButtonMenuItemOptions} from './buttonMenu';\nimport PopupForward from './popups/forward';\nimport PopupDeleteMessages from './popups/deleteMessages';\nimport Row from './row';\nimport htmlToDocumentFragment from '../helpers/dom/htmlToDocumentFragment';\nimport {SearchSelection} from './chat/selection';\nimport cancelEvent from '../helpers/dom/cancelEvent';\nimport {attachClickEvent, simulateClickEvent} from '../helpers/dom/clickEvent';\nimport {MyDocument} from '../lib/appManagers/appDocsManager';\nimport AppMediaViewer from './appMediaViewer';\nimport lockTouchScroll from '../helpers/dom/lockTouchScroll';\nimport copy from '../helpers/object/copy';\nimport getObjectKeysAndSort from '../helpers/object/getObjectKeysAndSort';\nimport safeAssign from '../helpers/object/safeAssign';\nimport escapeRegExp from '../helpers/string/escapeRegExp';\nimport findAndSplice from '../helpers/array/findAndSplice';\nimport {ScrollStartCallbackDimensions} from '../helpers/fastSmoothScroll';\nimport setInnerHTML from '../helpers/dom/setInnerHTML';\nimport {AppManagers} from '../lib/appManagers/managers';\nimport choosePhotoSize from '../lib/appManagers/utils/photos/choosePhotoSize';\nimport wrapWebPageDescription from './wrappers/webPageDescription';\nimport wrapWebPageTitle from './wrappers/webPageTitle';\nimport getAbbreviation from '../lib/richTextProcessor/getAbbreviation';\nimport matchUrl from '../lib/richTextProcessor/matchUrl';\nimport wrapPlainText from '../lib/richTextProcessor/wrapPlainText';\nimport wrapRichText from '../lib/richTextProcessor/wrapRichText';\nimport wrapSenderToPeer from './wrappers/senderToPeer';\nimport wrapSentTime from './wrappers/sentTime';\nimport getMediaFromMessage from '../lib/appManagers/utils/messages/getMediaFromMessage';\nimport filterMessagesByInputFilter from '../lib/appManagers/utils/messages/filterMessagesByInputFilter';\nimport getChatMembersString from './wrappers/getChatMembersString';\nimport getUserStatusString from './wrappers/getUserStatusString';\nimport getParticipantPeerId from '../lib/appManagers/utils/chats/getParticipantPeerId';\nimport {Awaited} from '../types';\nimport {attachContextMenuListener} from '../helpers/dom/attachContextMenuListener';\nimport contextMenuController from '../helpers/contextMenuController';\nimport positionMenu from '../helpers/positionMenu';\nimport apiManagerProxy from '../lib/mtproto/mtprotoworker';\nimport ListenerSetter from '../helpers/listenerSetter';\nimport SwipeHandler from './swipeHandler';\n\n// const testScroll = false;\n\nexport type SearchSuperType = MyInputMessagesFilter/*  | 'members' */;\nexport type SearchSuperContext = {\n  peerId: PeerId,\n  inputFilter: {_: MyInputMessagesFilter},\n  query?: string,\n  maxId?: number,\n  folderId?: number,\n  threadId?: number,\n  date?: number,\n  nextRate?: number,\n  minDate?: number,\n  maxDate?: number\n};\n\nexport type SearchSuperMediaType = 'members' | 'media' | 'files' | 'links' | 'music' | 'chats' | 'voice';\nexport type SearchSuperMediaTab = {\n  inputFilter: SearchSuperType,\n  name: LangPackKey,\n  type: SearchSuperMediaType,\n  contentTab?: HTMLElement,\n  menuTab?: HTMLElement,\n  scroll?: {scrollTop: number, scrollHeight: number}\n};\n\nclass SearchContextMenu {\n  private buttons: (ButtonMenuItemOptions & {verify?: () => boolean | Promise<boolean>, withSelection?: true})[];\n  private element: HTMLElement;\n  private target: HTMLElement;\n  private peerId: PeerId;\n  private mid: number;\n  private isSelected: boolean;\n  private managers: AppManagers;\n\n  constructor(\n    private attachTo: HTMLElement,\n    private searchSuper: AppSearchSuper,\n    private listenerSetter: ListenerSetter\n  ) {\n    this.managers = searchSuper.managers;\n\n    const onContextMenu = (e: MouseEvent) => {\n      if(this.init) {\n        this.init();\n        this.init = null;\n      }\n\n      let item: HTMLElement;\n      try {\n        item = findUpClassName(e.target, 'search-super-item');\n      } catch(e) {}\n\n      if(!item) return;\n\n      if(e instanceof MouseEvent) e.preventDefault();\n      if(this.element.classList.contains('active')) {\n        return false;\n      }\n      if(e instanceof MouseEvent) e.cancelBubble = true;\n\n      const r = async() => {\n        this.target = item;\n        this.peerId = item.dataset.peerId.toPeerId();\n        this.mid = +item.dataset.mid;\n        this.isSelected = searchSuper.selection.isMidSelected(this.peerId, this.mid);\n\n        await Promise.all(this.buttons.map(async(button) => {\n          let good: boolean;\n\n          if(this.isSelected && !button.withSelection) {\n            good = false;\n          } else {\n            good = button.verify ? await button.verify() : true;\n          }\n\n          button.element.classList.toggle('hide', !good);\n        }));\n\n        item.classList.add('menu-open');\n\n        positionMenu(e, this.element);\n        contextMenuController.openBtnMenu(this.element, () => {\n          item.classList.remove('menu-open');\n        });\n      };\n\n      r();\n    };\n\n    if(IS_TOUCH_SUPPORTED) {\n\n    } else {\n      attachContextMenuListener(attachTo, onContextMenu as any, listenerSetter);\n    }\n  }\n\n  private init() {\n    this.buttons = [{\n      icon: 'forward',\n      text: 'Forward',\n      onClick: this.onForwardClick,\n      verify: async() => this.managers.appMessagesManager.canForward(await this.managers.appMessagesManager.getMessageByPeer(this.peerId, this.mid))\n    }, {\n      icon: 'forward',\n      text: 'Message.Context.Selection.Forward',\n      onClick: this.onForwardClick,\n      verify: () => this.isSelected &&\n        !this.searchSuper.selection.selectionForwardBtn.classList.contains('hide'),\n      withSelection: true\n    }, {\n      icon: 'message',\n      text: 'Message.Context.Goto',\n      onClick: this.onGotoClick,\n      withSelection: true\n    }, {\n      icon: 'select',\n      text: 'Message.Context.Select',\n      onClick: this.onSelectClick\n    }, {\n      icon: 'select',\n      text: 'Message.Context.Selection.Clear',\n      onClick: this.onClearSelectionClick,\n      verify: () => this.isSelected,\n      withSelection: true\n    }, {\n      icon: 'delete danger',\n      text: 'Delete',\n      onClick: this.onDeleteClick,\n      verify: async() => this.managers.appMessagesManager.canDeleteMessage(await this.managers.appMessagesManager.getMessageByPeer(this.peerId, this.mid))\n    }, {\n      icon: 'delete danger',\n      text: 'Message.Context.Selection.Delete',\n      onClick: this.onDeleteClick,\n      verify: () => this.isSelected && !this.searchSuper.selection.selectionDeleteBtn.classList.contains('hide'),\n      withSelection: true\n    }];\n\n    this.element = ButtonMenu(this.buttons);\n    this.element.classList.add('search-contextmenu', 'contextmenu');\n    document.getElementById('page-chats').append(this.element);\n  }\n\n  private onGotoClick = () => {\n    appImManager.setInnerPeer({\n      peerId: this.peerId,\n      lastMsgId: this.mid,\n      threadId: this.searchSuper.searchContext.threadId\n    });\n  };\n\n  private onForwardClick = () => {\n    if(this.searchSuper.selection.isSelecting) {\n      simulateClickEvent(this.searchSuper.selection.selectionForwardBtn);\n    } else {\n      new PopupForward({\n        [this.peerId]: [this.mid]\n      });\n    }\n  };\n\n  private onSelectClick = () => {\n    this.searchSuper.selection.toggleByElement(this.target);\n  };\n\n  private onClearSelectionClick = () => {\n    this.searchSuper.selection.cancelSelection();\n  };\n\n  private onDeleteClick = () => {\n    if(this.searchSuper.selection.isSelecting) {\n      simulateClickEvent(this.searchSuper.selection.selectionDeleteBtn);\n    } else {\n      new PopupDeleteMessages(this.peerId, [this.mid], 'chat');\n    }\n  };\n}\n\nexport type ProcessSearchSuperResult = {\n  message: Message.message,\n  middleware: Middleware,\n  promises: Promise<any>[],\n  elemsToAppend: {element: HTMLElement, message: any}[],\n  inputFilter: MyInputMessagesFilter,\n  searchGroup?: SearchGroup\n};\n\nexport default class AppSearchSuper {\n  public tabs: {[t in SearchSuperType]: HTMLDivElement} = {} as any;\n\n  public mediaTab: SearchSuperMediaTab;\n\n  public container: HTMLElement;\n  public nav: HTMLElement;\n  public navScrollableContainer: HTMLDivElement;\n  public tabsContainer: HTMLElement;\n  public navScrollable: ScrollableX;\n  private tabsMenu: HTMLElement;\n  private prevTabId = -1;\n\n  private lazyLoadQueue = new LazyLoadQueue();\n  public middleware = getMiddleware();\n\n  public historyStorage: Partial<{[type in SearchSuperType]: {mid: number, peerId: PeerId}[]}> = {};\n  public usedFromHistory: Partial<{[type in SearchSuperType]: number}> = {};\n  public urlsToRevoke: string[] = [];\n\n  public searchContext: SearchSuperContext;\n  public loadMutex: Promise<any> = Promise.resolve();\n\n  private nextRates: Partial<{[type in SearchSuperType]: number}> = {};\n  private loadPromises: Partial<{[type in SearchSuperType]: Promise<void>}> = {};\n  private loaded: Partial<{[type in SearchSuperType]: boolean}> = {};\n  private loadedChats = false;\n  private firstLoad = true;\n\n  private log = logger('SEARCH-SUPER');\n  public selectTab: ReturnType<typeof horizontalMenu>;\n\n  private monthContainers: Partial<{\n    [type in SearchSuperType]: {\n      [timestamp: number]: {\n        container: HTMLElement,\n        items: HTMLElement\n      }\n    }\n  }> = {};\n\n  private searchGroupMedia: SearchGroup;\n\n  public mediaTabsMap: Map<SearchSuperMediaType, SearchSuperMediaTab> = new Map();\n\n  private membersList: SortedUserList;\n\n  private skipScroll: boolean;\n\n  // * arguments\n  public mediaTabs: SearchSuperMediaTab[];\n  public scrollable: Scrollable;\n  public searchGroups?: {[group in SearchGroupType]: SearchGroup};\n  public asChatList? = false;\n  public groupByMonth? = true;\n  public hideEmptyTabs? = true;\n  public onChangeTab?: (mediaTab: SearchSuperMediaTab) => void;\n  public showSender? = false;\n\n  private searchContextMenu: SearchContextMenu;\n  public selection: SearchSelection;\n\n  public scrollStartCallback: (dimensions: ScrollStartCallbackDimensions) => void;\n\n  public managers: AppManagers;\n  private loadFirstTimePromise: Promise<void>;\n\n  private listenerSetter: ListenerSetter;\n  private swipeHandler: SwipeHandler;\n\n  constructor(options: Pick<AppSearchSuper, 'mediaTabs' | 'scrollable' | 'searchGroups' | 'asChatList' | 'groupByMonth' | 'hideEmptyTabs' | 'onChangeTab' | 'showSender' | 'managers'>) {\n    safeAssign(this, options);\n\n    this.container = document.createElement('div');\n    this.container.classList.add('search-super');\n\n    this.listenerSetter = new ListenerSetter();\n    this.searchContextMenu = new SearchContextMenu(this.container, this, this.listenerSetter);\n    this.selection = new SearchSelection(this, this.managers, this.listenerSetter);\n\n    const navScrollableContainer = this.navScrollableContainer = document.createElement('div');\n    navScrollableContainer.classList.add('search-super-tabs-scrollable', 'menu-horizontal-scrollable', 'sticky');\n\n    const navScrollable = this.navScrollable = new ScrollableX(navScrollableContainer);\n    navScrollable.container.classList.add('search-super-nav-scrollable');\n\n    const nav = this.nav = document.createElement('nav');\n    nav.classList.add('search-super-tabs', 'menu-horizontal-div');\n    this.tabsMenu = nav;\n\n    navScrollable.container.append(nav);\n\n    for(const mediaTab of this.mediaTabs) {\n      const menuTab = document.createElement('div');\n      menuTab.classList.add('menu-horizontal-div-item');\n      const span = document.createElement('span');\n      const i = document.createElement('i');\n\n      span.append(i18n(mediaTab.name));\n      span.append(i);\n\n      menuTab.append(span);\n\n      ripple(menuTab);\n\n      this.tabsMenu.append(menuTab);\n\n      this.mediaTabsMap.set(mediaTab.type, mediaTab);\n\n      mediaTab.menuTab = menuTab;\n    }\n\n    this.tabsContainer = document.createElement('div');\n    this.tabsContainer.classList.add('search-super-tabs-container', 'tabs-container');\n\n    let unlockScroll: ReturnType<typeof lockTouchScroll>;\n    if(IS_TOUCH_SUPPORTED) {\n      this.swipeHandler = handleTabSwipe({\n        element: this.tabsContainer,\n        onSwipe: (xDiff, yDiff, e) => {\n          const prevId = this.selectTab.prevId();\n          const children = Array.from(this.tabsMenu.children) as HTMLElement[];\n          let idx: number;\n          if(xDiff > 0) {\n            for(let i = prevId + 1; i < children.length; ++i) {\n              if(!children[i].classList.contains('hide')) {\n                idx = i;\n                break;\n              }\n            }\n          } else {\n            for(let i = prevId - 1; i >= 0; --i) {\n              if(!children[i].classList.contains('hide')) {\n                idx = i;\n                break;\n              }\n            }\n          }\n\n          if(idx !== undefined) {\n            unlockScroll = lockTouchScroll(this.tabsContainer);\n            this.selectTab(idx);\n          }\n        }\n      });\n    }\n\n    for(const mediaTab of this.mediaTabs) {\n      const container = document.createElement('div');\n      container.classList.add('search-super-container-' + mediaTab.type, 'tabs-tab');\n\n      const content = document.createElement('div');\n      content.classList.add('search-super-content-' + mediaTab.type);\n\n      container.append(content);\n\n      this.tabsContainer.append(container);\n\n      this.tabs[mediaTab.inputFilter] = content;\n\n      mediaTab.contentTab = content;\n    }\n\n    this.container.append(navScrollableContainer, this.tabsContainer);\n\n    // * construct end\n\n    this.searchGroupMedia = new SearchGroup(false, 'messages', true);\n\n    this.scrollable.onScrolledBottom = () => {\n      if(this.mediaTab.contentTab && this.canLoadMediaTab(this.mediaTab)/* && false */) {\n        // this.log('onScrolledBottom will load media');\n        this.load(true);\n      }\n    };\n    // this.scroll.attachSentinels(undefined, 400);\n\n    this.selectTab = horizontalMenu(this.tabsMenu, this.tabsContainer, (id, tabContent, animate) => {\n      if(this.prevTabId === id && !this.skipScroll) {\n        this.scrollable.scrollIntoViewNew({\n          element: this.container,\n          position: 'start',\n          startCallback: this.scrollStartCallback\n        });\n        return;\n      }\n\n      const newMediaTab = this.mediaTabs[id];\n      if(this.onChangeTab) {\n        this.onChangeTab(newMediaTab);\n      }\n\n      const fromMediaTab = this.mediaTab;\n      this.mediaTab = newMediaTab;\n\n      if(this.prevTabId !== -1 && animate) {\n        this.onTransitionStart();\n      }\n\n      if(this.skipScroll) {\n        this.skipScroll = false;\n      } else {\n        const offsetTop = this.container.offsetTop;\n        let scrollTop = this.scrollable.scrollTop;\n        if(scrollTop < offsetTop) {\n          this.scrollable.scrollIntoViewNew({\n            element: this.container,\n            position: 'start',\n            startCallback: this.scrollStartCallback\n          });\n          scrollTop = offsetTop;\n        }\n\n        fromMediaTab.scroll = {scrollTop: scrollTop, scrollHeight: this.scrollable.scrollHeight};\n\n        if(newMediaTab.scroll === undefined) {\n          const rect = this.container.getBoundingClientRect();\n          const rect2 = this.container.parentElement.getBoundingClientRect();\n          const diff = rect.y - rect2.y;\n\n          if(scrollTop > diff) {\n            newMediaTab.scroll = {scrollTop: diff, scrollHeight: 0};\n          }\n        }\n\n        if(newMediaTab.scroll) {\n          const diff = fromMediaTab.scroll.scrollTop - newMediaTab.scroll.scrollTop;\n          // console.log('what you gonna do', this.goingHard, diff);\n\n          // this.scrollable.scrollTop = scrollTop;\n          if(diff/*  && diff < 0 */) {\n            /* if(diff > -(fromMediaTab.contentTab.scrollHeight + this.nav.scrollHeight)) {\n              fromMediaTab.contentTab.style.transform = `translateY(${diff}px)`;\n              this.scrollable.scrollTop = scrollTop - diff;\n            } else { */\n            newMediaTab.contentTab.style.transform = `translateY(${diff}px)`;\n            // }\n          }\n        }\n      }\n\n      /* if(this.prevTabId !== -1 && nav.offsetTop) {\n        this.scrollable.scrollTop -= nav.offsetTop;\n      } */\n\n      /* this.log('setVirtualContainer', id, this.sharedMediaSelected, this.sharedMediaSelected.childElementCount);\n      this.scroll.setVirtualContainer(this.sharedMediaSelected); */\n\n      if(this.prevTabId !== -1 && !newMediaTab.contentTab.childElementCount) { // quick brown fix\n        // this.contentContainer.classList.remove('loaded');\n        this.load(true);\n      }\n\n      this.prevTabId = id;\n    }, () => {\n      this.scrollable.onScroll();\n\n      // console.log('what y', this.tabSelected.style.transform);\n      if(this.mediaTab.scroll !== undefined) {\n        this.mediaTab.contentTab.style.transform = '';\n        this.scrollable.scrollTop = this.mediaTab.scroll.scrollTop;\n      }\n\n      if(unlockScroll) {\n        unlockScroll();\n        unlockScroll = undefined;\n      }\n\n      this.onTransitionEnd();\n    }, undefined, navScrollable, this.listenerSetter);\n\n    attachClickEvent(this.tabsContainer, (e) => {\n      if(this.selection.isSelecting) {\n        cancelEvent(e);\n        this.selection.toggleByElement(findUpClassName(e.target, 'search-super-item'));\n      }\n    }, {capture: true, passive: false, listenerSetter: this.listenerSetter});\n\n    const onMediaClick = async(className: string, targetClassName: string, inputFilter: MyInputMessagesFilter, e: MouseEvent) => {\n      const target = findUpClassName(e.target as HTMLDivElement, className);\n      if(!target) return;\n\n      const mid = +target.dataset.mid;\n      if(!mid) {\n        this.log.warn('no messageId by click on target:', target);\n        return;\n      }\n\n      const peerId = target.dataset.peerId.toPeerId();\n\n      const targets = (Array.from(this.tabs[inputFilter].querySelectorAll('.' + targetClassName)) as HTMLElement[]).map((el) => {\n        const containerEl = findUpClassName(el, className);\n        return {\n          element: el,\n          mid: +containerEl.dataset.mid,\n          peerId: containerEl.dataset.peerId.toPeerId()\n        };\n      });\n\n      // const ids = Object.keys(this.mediaDivsByIds).map((k) => +k).sort((a, b) => a - b);\n      const idx = targets.findIndex((item) => item.mid === mid && item.peerId === peerId);\n\n      const message = await this.managers.appMessagesManager.getMessageByPeer(peerId, mid);\n      new AppMediaViewer()\n      .setSearchContext(this.copySearchContext(inputFilter))\n      .openMedia(message, targets[idx].element, 0, false, targets.slice(0, idx), targets.slice(idx + 1));\n    };\n\n    attachClickEvent(this.tabs.inputMessagesFilterPhotoVideo, onMediaClick.bind(null, 'grid-item', 'grid-item', 'inputMessagesFilterPhotoVideo'), {listenerSetter: this.listenerSetter});\n    attachClickEvent(this.tabs.inputMessagesFilterDocument, onMediaClick.bind(null, 'document-with-thumb', 'media-container', 'inputMessagesFilterDocument'), {listenerSetter: this.listenerSetter});\n\n    /* attachClickEvent(this.tabs.inputMessagesFilterUrl, (e) => {\n      const target = e.target as HTMLElement;\n      if(target.tagName === 'A') {\n        return;\n      }\n\n      try {\n        const a = findUpClassName(target, 'row').querySelector('.anchor-url:last-child') as HTMLAnchorElement;\n        a.click();\n      } catch(err) {}\n    }); */\n\n    this.mediaTab = this.mediaTabs[0];\n\n    useHeavyAnimationCheck(() => {\n      this.lazyLoadQueue.lock();\n    }, () => {\n      this.lazyLoadQueue.unlockAndRefresh(); // ! maybe not so efficient\n    }, this.listenerSetter);\n  }\n\n  private onTransitionStart = () => {\n    this.container.classList.add('sliding');\n  };\n\n  private onTransitionEnd = () => {\n    this.container.classList.remove('sliding');\n  };\n\n  public filterMessagesByType(messages: any[], type: SearchSuperType): MyMessage[] {\n    return filterMessagesByInputFilter(type, messages, messages.length);\n  }\n\n  private processEmptyFilter({message, searchGroup}: ProcessSearchSuperResult) {\n    const loadPromises: Promise<any>[] = [];\n    const {dom} = appDialogsManager.addDialogNew({\n      peerId: message.peerId,\n      container: searchGroup.list,\n      avatarSize: 54,\n      loadPromises\n    });\n\n    const setLastMessagePromise = appDialogsManager.setLastMessageN({\n      dialog: {\n        _: 'dialog',\n        peerId: message.peerId\n      } as any,\n      lastMessage: message,\n      dom,\n      highlightWord: this.searchContext.query\n    });\n\n    loadPromises.push(setLastMessagePromise);\n    return Promise.all(loadPromises);\n  }\n\n  private async processPhotoVideoFilter({message, promises, middleware}: ProcessSearchSuperResult) {\n    const media = getMediaFromMessage(message);\n\n    const div = document.createElement('div');\n    div.classList.add('grid-item');\n    // this.log(message, photo);\n\n    let wrapped: Awaited<ReturnType<typeof wrapPhoto>>;\n    const size = choosePhotoSize(media, 200, 200);\n    if(media._ !== 'photo') {\n      wrapped = await (await wrapVideo({\n        doc: media,\n        message,\n        container: div,\n        boxWidth: 0,\n        boxHeight: 0,\n        lazyLoadQueue: this.lazyLoadQueue,\n        middleware,\n        onlyPreview: true,\n        withoutPreloader: true,\n        noPlayButton: true,\n        photoSize: size\n      })).thumb;\n    } else {\n      wrapped = await wrapPhoto({\n        photo: media,\n        message,\n        container: div,\n        boxWidth: 0,\n        boxHeight: 0,\n        lazyLoadQueue: this.lazyLoadQueue,\n        middleware,\n        withoutPreloader: true,\n        noBlur: true,\n        size\n      });\n    }\n\n    [wrapped.images.thumb, wrapped.images.full].filter(Boolean).forEach((image) => {\n      image.classList.add('grid-item-media');\n    });\n\n    promises.push(wrapped.loadPromises.thumb);\n\n    return {element: div, message};\n  }\n\n  private async processDocumentFilter({message, inputFilter}: ProcessSearchSuperResult) {\n    const document = getMediaFromMessage(message) as Document.document;\n    const showSender = this.showSender || (['voice', 'round'] as MyDocument['type'][]).includes(document.type);\n\n    const div = await wrapDocument({\n      message,\n      withTime: !showSender,\n      fontWeight: 400,\n      voiceAsMusic: true,\n      showSender,\n      searchContext: this.copySearchContext(inputFilter),\n      lazyLoadQueue: this.lazyLoadQueue,\n      autoDownloadSize: 0\n    });\n\n    if((['audio', 'voice', 'round'] as MyDocument['type'][]).includes(document.type)) {\n      div.classList.add('audio-48');\n    }\n\n    return {message, element: div};\n  }\n\n  private async processUrlFilter({message, promises, middleware}: ProcessSearchSuperResult) {\n    let webpage = (message.media as MessageMedia.messageMediaWebPage)?.webpage as WebPage.webPage;\n\n    if(!webpage) {\n      const entity = message.totalEntities ? message.totalEntities.find((e: any) => e._ === 'messageEntityUrl' || e._ === 'messageEntityTextUrl') : null;\n      let url: string, display_url: string, sliced: string;\n\n      if(!entity) {\n        // this.log.error('NO ENTITY:', message);\n        const match = matchUrl(message.message);\n        if(!match) {\n          // this.log.error('NO ENTITY AND NO MATCH:', message);\n          return;\n        }\n\n        url = match[0];\n      } else {\n        sliced = message.message.slice(entity.offset, entity.offset + entity.length);\n      }\n\n      if(entity?._ === 'messageEntityTextUrl') {\n        url = entity.url;\n        // display_url = sliced;\n      } else {\n        url = url || sliced;\n      }\n\n      display_url = url;\n\n      const same = message.message === url;\n      if(!url.match(/^(ftp|http|https):\\/\\//)) {\n        display_url = 'https://' + url;\n        url = url.includes('@') ? url : 'https://' + url;\n      }\n\n      display_url = new URL(display_url).hostname;\n\n      webpage = {\n        _: 'webPage',\n        url,\n        display_url,\n        id: '',\n        hash: 0\n      };\n\n      if(!same) {\n        webpage.description = message.message;\n      }\n    }\n\n    const previewDiv = document.createElement('div');\n    previewDiv.classList.add('preview', 'row-media');\n\n    // this.log('wrapping webpage', webpage);\n\n    if(webpage.photo) {\n      const res = wrapPhoto({\n        container: previewDiv,\n        message: null,\n        photo: webpage.photo as Photo.photo,\n        boxWidth: 0,\n        boxHeight: 0,\n        withoutPreloader: true,\n        lazyLoadQueue: this.lazyLoadQueue,\n        middleware,\n        size: choosePhotoSize(webpage.photo as Photo.photo, 60, 60, false),\n        loadPromises: promises,\n        noBlur: true\n      });\n    } else {\n      previewDiv.classList.add('empty');\n      setInnerHTML(previewDiv, getAbbreviation(webpage.title || webpage.display_url || webpage.description || webpage.url, true));\n    }\n\n    const title = wrapWebPageTitle(webpage);\n\n    const subtitleFragment = wrapWebPageDescription(webpage);\n    const aFragment = htmlToDocumentFragment(wrapRichText(webpage.url || ''));\n    const a = aFragment.firstElementChild;\n    if(a instanceof HTMLAnchorElement) {\n      try { // can have 'URIError: URI malformed'\n        a.innerText = decodeURIComponent(a.href);\n      } catch(err) {\n\n      }\n    }\n\n    if(subtitleFragment.firstChild) {\n      subtitleFragment.append('\\n');\n    }\n\n    subtitleFragment.append(a);\n\n    if(this.showSender) {\n      subtitleFragment.append('\\n', await wrapSenderToPeer(message));\n    }\n\n    if(!title.textContent) {\n      // title = new URL(webpage.url).hostname;\n      title.append(wrapPlainText(webpage.display_url.split('/', 1)[0]));\n    }\n\n    const row = new Row({\n      title,\n      titleRight: wrapSentTime(message),\n      subtitle: subtitleFragment,\n      havePadding: true,\n      clickable: true,\n      noRipple: true\n    });\n\n    /* const mediaDiv = document.createElement('div');\n    mediaDiv.classList.add('row-media'); */\n\n    row.container.append(previewDiv);\n\n    /* ripple(div);\n    div.append(previewDiv);\n    div.insertAdjacentHTML('beforeend', `\n    <div class=\"title\">${title}${titleAdditionHTML}</div>\n    <div class=\"subtitle\">${subtitle}</div>\n    <div class=\"url\">${url}</div>\n    ${sender}\n    `); */\n\n    if(row.container.innerText.trim().length) {\n      return {message, element: row.container};\n    }\n  }\n\n  public async performSearchResult(messages: any[], mediaTab: SearchSuperMediaTab, append = true) {\n    const elemsToAppend: {element: HTMLElement, message: any}[] = [];\n    const sharedMediaDiv: HTMLElement = mediaTab.contentTab;\n    const promises: Promise<any>[] = [];\n    const middleware = this.middleware.get();\n    let inputFilter = mediaTab.inputFilter;\n\n    await getHeavyAnimationPromise();\n\n    let searchGroup: SearchGroup;\n    if(inputFilter === 'inputMessagesFilterPhotoVideo' && !!this.searchContext.query.trim()) {\n      inputFilter = 'inputMessagesFilterEmpty';\n      searchGroup = this.searchGroupMedia;\n      sharedMediaDiv.append(searchGroup.container);\n    } else if(inputFilter === 'inputMessagesFilterEmpty') {\n      searchGroup = this.searchGroups.messages;\n    }\n\n    const options: ProcessSearchSuperResult = {\n      elemsToAppend,\n      inputFilter,\n      message: undefined,\n      middleware,\n      promises,\n      searchGroup\n    };\n\n    let processCallback: (options: ProcessSearchSuperResult) => any;\n\n    // https://core.telegram.org/type/MessagesFilter\n    switch(inputFilter) {\n      case 'inputMessagesFilterEmpty': {\n        processCallback = this.processEmptyFilter;\n        break;\n      }\n\n      case 'inputMessagesFilterPhotoVideo': {\n        processCallback = this.processPhotoVideoFilter;\n        break;\n      }\n\n      case 'inputMessagesFilterVoice':\n      case 'inputMessagesFilterRoundVoice':\n      case 'inputMessagesFilterMusic':\n      case 'inputMessagesFilterDocument': {\n        processCallback = this.processDocumentFilter;\n        break;\n      }\n\n      case 'inputMessagesFilterUrl': {\n        processCallback = this.processUrlFilter;\n        break;\n      }\n\n      default:\n        // this.log.warn('death is my friend', messages);\n        break;\n    }\n\n    if(processCallback) {\n      processCallback = processCallback.bind(this);\n\n      type K = {element: HTMLElement, message: Message.message | Message.messageService};\n      const results: (Promise<K> | K)[] = messages.map(async(message) => {\n        try {\n          options.message = message;\n          return await processCallback(options);\n        } catch(err) {\n          this.log.error('error rendering filter', inputFilter, options, message, err);\n        }\n      });\n\n      const awaited = (await Promise.all(results)).filter(Boolean);\n      elemsToAppend.push(...awaited.filter(Boolean));\n    }\n\n    if(searchGroup && searchGroup.list.childElementCount) {\n      searchGroup.setActive();\n    }\n\n    if(this.loadMutex) {\n      promises.push(this.loadMutex);\n    }\n\n    if(promises.length) {\n      await Promise.all(promises);\n      if(!middleware()) {\n        // this.log.warn('peer changed');\n        return;\n      }\n    }\n\n    if(elemsToAppend.length) {\n      const method = append ? 'append' : 'prepend';\n      elemsToAppend.forEach((details) => {\n        const {element, message} = details;\n        const monthContainer = this.getMonthContainerByTimestamp(this.groupByMonth ? message.date : 0, inputFilter);\n        element.classList.add('search-super-item');\n        element.dataset.mid = '' + message.mid;\n        element.dataset.peerId = '' + message.peerId;\n        monthContainer.items[method](element);\n\n        if(this.selection?.isSelecting) {\n          this.selection.toggleElementCheckbox(element, true);\n        }\n      });\n    }\n\n    // if(type !== 'inputMessagesFilterEmpty') {\n    this.afterPerforming(inputFilter === 'inputMessagesFilterEmpty' ? 1 : messages.length, sharedMediaDiv);\n    // }\n  }\n\n  private afterPerforming(length: number, contentTab: HTMLElement) {\n    if(contentTab) {\n      const parent = contentTab.parentElement;\n      Array.from(parent.children).slice(1).forEach((child) => {\n        child.remove();\n      });\n\n      // this.contentContainer.classList.add('loaded');\n\n      if(!length && !contentTab.childElementCount) {\n        const div = document.createElement('div');\n        div.innerText = 'Nothing interesting here yet...';\n        div.classList.add('position-center', 'text-center', 'content-empty', 'no-select');\n\n        parent.append(div);\n      }\n    }\n  }\n\n  private loadChats() {\n    const renderedPeerIds: Set<PeerId> = new Set();\n    const middleware = this.middleware.get();\n\n    for(const i in this.searchGroups) {\n      const group = this.searchGroups[i as SearchGroupType];\n      this.tabs.inputMessagesFilterEmpty.append(group.container);\n      group.clear();\n    }\n\n    const query = this.searchContext.query;\n    if(query) {\n      const setResults = (results: PeerId[], group: SearchGroup, showMembersCount = false) => {\n        results.map((peerId) => {\n          if(renderedPeerIds.has(peerId)) {\n            return;\n          }\n\n          renderedPeerIds.add(peerId);\n\n          const {dom} = appDialogsManager.addDialogNew({\n            peerId: peerId,\n            container: group.list,\n            avatarSize: 48,\n            autonomous: group.autonomous\n          });\n\n          return {dom, peerId};\n        }).forEach(async({dom, peerId}) => {\n          const peer = await this.managers.appPeersManager.getPeer(peerId);\n          if(showMembersCount && (peer.participants_count || peer.participants)) {\n            const regExp = new RegExp(`(${escapeRegExp(query)}|${escapeRegExp(cleanSearchText(query))})`, 'gi');\n            dom.titleSpan.innerHTML = dom.titleSpan.innerHTML.replace(regExp, '<i>$1</i>');\n            dom.lastMessageSpan.append(await getChatMembersString(peerId.toChatId()));\n          } else if(peerId === rootScope.myId) {\n            dom.lastMessageSpan.append(i18n('Presence.YourChat'));\n          } else {\n            let username = await this.managers.appPeersManager.getPeerUsername(peerId);\n            if(!username) {\n              const user = await this.managers.appUsersManager.getUser(peerId);\n              if(user && user.phone) {\n                username = '+' + formatPhoneNumber(user.phone).formatted;\n              }\n            } else {\n              username = '@' + username;\n            }\n\n            dom.lastMessageSpan.innerHTML = '<i>' + username + '</i>';\n          }\n        });\n\n        group.toggle();\n      };\n\n      const onLoad = <T>(arg: T) => {\n        if(!middleware()) {\n          return;\n        }\n\n        // this.loadedContacts = true;\n\n        return arg;\n      };\n\n      return Promise.all([\n        this.managers.appUsersManager.getContactsPeerIds(query, true)\n        .then(onLoad)\n        .then((contacts) => {\n          if(contacts) {\n            setResults(contacts, this.searchGroups.contacts, true);\n          }\n        }),\n\n        this.managers.appUsersManager.searchContacts(query, 20)\n        .then(onLoad)\n        .then((contacts) => {\n          if(contacts) {\n            setResults(contacts.my_results, this.searchGroups.contacts, true);\n            setResults(contacts.results/* .concat(contacts.results, contacts.results, contacts.results) */, this.searchGroups.globalContacts);\n\n            this.searchGroups.globalContacts.container.classList.add('is-short');\n\n            if(this.searchGroups.globalContacts.nameEl.lastElementChild !== this.searchGroups.globalContacts.nameEl.firstElementChild) {\n              this.searchGroups.globalContacts.nameEl.lastElementChild.remove();\n            }\n\n            if(this.searchGroups.globalContacts.list.childElementCount > 3) {\n              const showMore = document.createElement('div');\n              showMore.classList.add('search-group__show-more');\n              const intlElement = new I18n.IntlElement({\n                key: 'Separator.ShowMore'\n              });\n              showMore.append(intlElement.element);\n              this.searchGroups.globalContacts.nameEl.append(showMore);\n              attachClickEvent(showMore, () => {\n                const isShort = this.searchGroups.globalContacts.container.classList.toggle('is-short');\n                intlElement.key = isShort ? 'Separator.ShowMore' : 'Separator.ShowLess';\n                intlElement.update();\n              });\n            }\n          }\n        }),\n\n        this.managers.appMessagesManager.getConversations(query, 0, 20, 0)\n        .then(onLoad)\n        .then((value) => {\n          if(value) {\n            setResults(value.dialogs.map((d) => d.peerId), this.searchGroups.contacts, true);\n          }\n        })\n      ]);\n    } else if(!this.searchContext.peerId && !this.searchContext.minDate) {\n      const renderRecentSearch = (setActive = true) => {\n        return apiManagerProxy.getState().then((state) => {\n          if(!middleware()) {\n            return;\n          }\n\n          this.searchGroups.recent.list.innerHTML = '';\n\n          state.recentSearch.slice(0, 20).forEach(async(peerId) => {\n            const {dom} = appDialogsManager.addDialogNew({\n              peerId: peerId,\n              container: this.searchGroups.recent.list,\n              meAsSaved: true,\n              avatarSize: 48,\n              autonomous: true\n            });\n\n            dom.lastMessageSpan.append(await (peerId.isUser() ?\n              getUserStatusString(await this.managers.appUsersManager.getUser(peerId.toUserId())) :\n              getChatMembersString(peerId.toChatId())));\n          });\n\n          if(!state.recentSearch.length) {\n            this.searchGroups.recent.clear();\n          } else if(setActive) {\n            this.searchGroups.recent.setActive();\n          }\n        });\n      };\n\n      return Promise.all([\n        this.managers.appUsersManager.getTopPeers('correspondents').then((peers) => {\n          if(!middleware()) return;\n\n          const idx = peers.findIndex((peer) => peer.id === rootScope.myId);\n          if(idx !== -1) {\n            peers = peers.slice();\n            peers.splice(idx, 1);\n          }\n          // console.log('got top categories:', categories);\n          if(peers.length) {\n            peers.forEach((peer) => {\n              appDialogsManager.addDialogNew({\n                peerId: peer.id,\n                container: this.searchGroups.people.list,\n                onlyFirstName: true,\n                avatarSize: 54,\n                autonomous: false,\n                noIcons: this.searchGroups.people.noIcons\n              });\n            });\n          }\n\n          this.searchGroups.people.setActive();\n        }),\n\n        renderRecentSearch()\n      ]);\n    } else return Promise.resolve();\n  }\n\n  private async loadMembers(mediaTab: SearchSuperMediaTab) {\n    const id = this.searchContext.peerId.toChatId();\n    const middleware = this.middleware.get();\n    let promise: Promise<void>;\n\n    const renderParticipants = async(participants: (ChatParticipant | ChannelParticipant)[]) => {\n      if(this.loadMutex) {\n        await this.loadMutex;\n\n        if(!middleware()) {\n          return;\n        }\n      }\n\n      if(!this.membersList) {\n        this.membersList = new SortedUserList({\n          lazyLoadQueue: this.lazyLoadQueue,\n          rippleEnabled: false,\n          managers: this.managers\n        });\n        attachClickEvent(this.membersList.list, (e) => {\n          const li = findUpTag(e.target, DIALOG_LIST_ELEMENT_TAG);\n          if(!li) {\n            return;\n          }\n\n          const peerId = li.dataset.peerId.toPeerId();\n          let promise: Promise<any> = Promise.resolve();\n          if(mediaSizes.isMobile) {\n            promise = appSidebarRight.toggleSidebar(false);\n          }\n\n          promise.then(() => {\n            appImManager.setInnerPeer({peerId});\n          });\n        });\n        mediaTab.contentTab.append(this.membersList.list);\n        this.afterPerforming(1, mediaTab.contentTab);\n      }\n\n      for(const participant of participants) {\n        const peerId = getParticipantPeerId(participant);\n        if(peerId.isAnyChat()) {\n          continue;\n        }\n\n        const user = await this.managers.appUsersManager.getUser(peerId);\n        if(user.pFlags.deleted) {\n          continue;\n        }\n\n        this.membersList.add(peerId);\n      }\n    };\n\n    if(await this.managers.appChatsManager.isChannel(id)) {\n      const LOAD_COUNT = !this.membersList ? 50 : 200;\n      promise = this.managers.appProfileManager.getChannelParticipants(id, undefined, LOAD_COUNT, this.nextRates[mediaTab.inputFilter]).then((participants) => {\n        if(!middleware()) {\n          return;\n        }\n\n        const list = mediaTab.contentTab.firstElementChild as HTMLUListElement;\n        this.nextRates[mediaTab.inputFilter] = (list ? list.childElementCount : 0) + participants.participants.length;\n\n        if(participants.participants.length < LOAD_COUNT) {\n          this.loaded[mediaTab.inputFilter] = true;\n        }\n\n        return renderParticipants(participants.participants);\n      });\n    } else {\n      promise = this.managers.appProfileManager.getChatFull(id).then((chatFull) => {\n        if(!middleware()) {\n          return;\n        }\n\n        // console.log('anymore', chatFull);\n        this.loaded[mediaTab.inputFilter] = true;\n        const participants = (chatFull as ChatFull.chatFull).participants;\n        if(participants._ === 'chatParticipantsForbidden') {\n          return;\n        }\n\n        return renderParticipants(participants.participants);\n      });\n    }\n\n    return this.loadPromises[mediaTab.inputFilter] = promise.finally(() => {\n      if(!middleware()) {\n        return;\n      }\n\n      this.loadPromises[mediaTab.inputFilter] = null;\n    });\n  }\n\n  private loadType(mediaTab: SearchSuperMediaTab, justLoad: boolean, loadCount: number, middleware: () => boolean) {\n    const type = mediaTab.inputFilter;\n\n    if(this.loadPromises[type]) {\n      return this.loadPromises[type];\n    }\n\n    if(mediaTab.type === 'members') {\n      return this.loadMembers(mediaTab);\n    }\n\n    const history = this.historyStorage[type] ?? (this.historyStorage[type] = []);\n\n    if(type === 'inputMessagesFilterEmpty' && !history.length) {\n      if(!this.loadedChats) {\n        this.loadChats();\n        this.loadedChats = true;\n      }\n\n      if(!this.searchContext.query.trim() && !this.searchContext.peerId && !this.searchContext.minDate) {\n        this.loaded[type] = true;\n        return Promise.resolve();\n      }\n    }\n\n    const promise = this.loadPromises[type] = Promise.resolve().then(async() => {\n      // render from cache\n      if(history.length && this.usedFromHistory[type] < history.length && !justLoad) {\n        const messages: any[] = [];\n        let used = Math.max(0, this.usedFromHistory[type]);\n        let slicedLength = 0;\n\n        do {\n          const ids = history.slice(used, used + loadCount);\n          used += ids.length;\n          slicedLength += ids.length;\n\n          const notFilteredMessages = await Promise.all(ids.map((m) => this.managers.appMessagesManager.getMessageByPeer(m.peerId, m.mid)));\n\n          messages.push(...this.filterMessagesByType(notFilteredMessages, type));\n        } while(slicedLength < loadCount && used < history.length);\n\n        //  \n        /* if(slicedLength > loadCount) {\n          let diff = messages.length - loadCount;\n          messages = messages.slice(0, messages.length - diff);\n          used -= diff;\n        } */\n\n        this.usedFromHistory[type] = used;\n        // if(messages.length) {\n        return this.performSearchResult(messages, mediaTab).finally(() => {\n          setTimeout(() => {\n            this.scrollable.checkForTriggers();\n          }, 0);\n        });\n        // }\n      }\n\n      const maxId = history.length ? history[history.length - 1].mid : 0;\n\n      const value = await this.managers.appMessagesManager.getSearch({\n        ...this.searchContext,\n        inputFilter: {_: type},\n        maxId,\n        limit: loadCount,\n        nextRate: this.nextRates[type] ??= 0\n      });\n\n      history.push(...value.history.map((m) => ({mid: m.mid, peerId: m.peerId})));\n\n      if(!middleware()) {\n        // this.log.warn('peer changed');\n        return;\n      }\n\n      // !  ,         ( - ,        getSearch)\n      if(value.history.length < loadCount || (this.searchContext.folderId !== undefined && !value.next_rate) || value.history.length === value.count) {\n      // if((value.count || history.length === value.count) && history.length >= value.count) {\n        // this.log(logStr + 'loaded all media', value, loadCount);\n        this.loaded[type] = true;\n      }\n\n      this.nextRates[type] = value.next_rate;\n\n      if(justLoad) {\n        return;\n      }\n\n      this.usedFromHistory[type] = history.length;\n\n      if(!this.loaded[type]) {\n        promise.then(() => {\n          setTimeout(() => {\n            if(!middleware()) return;\n            // this.log('will preload more');\n            if(this.mediaTab === mediaTab) {\n              const promise = this.load(true, true);\n              if(promise) {\n                promise.then(() => {\n                  if(!middleware()) return;\n                  // this.log('preloaded more');\n                  setTimeout(() => {\n                    this.scrollable.checkForTriggers();\n                  }, 0);\n                });\n              }\n            }\n          }, 0);\n        });\n      }\n\n      // if(value.history.length) {\n      return this.performSearchResult(this.filterMessagesByType(value.history, type), mediaTab);\n      // }\n    }).catch((err) => {\n      this.log.error('load error:', err);\n    }).finally(() => {\n      this.loadPromises[type] = null;\n    });\n\n    return promise;\n  }\n\n  private canLoadMediaTab(mediaTab: SearchSuperMediaTab) {\n    const inputFilter = mediaTab.inputFilter;\n    return !this.loaded[inputFilter] || (this.historyStorage[inputFilter] && this.usedFromHistory[inputFilter] < this.historyStorage[inputFilter].length);\n  }\n\n  private async loadFirstTime() {\n    const middleware = this.middleware.get();\n    const peerId = this.searchContext.peerId;\n    if(!this.hideEmptyTabs) {\n      return;\n    }\n\n    const mediaTabs = this.mediaTabs.filter((mediaTab) => mediaTab.inputFilter !== 'inputMessagesFilterEmpty');\n    const filters = mediaTabs.map((mediaTab) => ({_: mediaTab.inputFilter}));\n\n    const [counters, canViewMembers] = await Promise.all([\n      this.managers.appMessagesManager.getSearchCounters(peerId, filters),\n      this.canViewMembers()\n    ]);\n\n    if(!middleware()) {\n      return;\n    }\n\n    if(this.loadMutex) {\n      await this.loadMutex;\n\n      if(!middleware()) {\n        return;\n      }\n    }\n\n    let firstMediaTab: SearchSuperMediaTab;\n    let count = 0;\n    mediaTabs.forEach((mediaTab) => {\n      const counter = counters.find((c) => c.filter._ === mediaTab.inputFilter);\n\n      mediaTab.menuTab.classList.toggle('hide', !counter.count);\n      mediaTab.menuTab.classList.remove('active');\n      // mediaTab.contentTab.classList.toggle('hide', !counter.count);\n\n      if(counter.count) {\n        if(firstMediaTab === undefined) {\n          firstMediaTab = mediaTab;\n        }\n\n        ++count;\n      }\n    });\n\n    const membersTab = this.mediaTabsMap.get('members');\n    membersTab.menuTab.classList.toggle('hide', !canViewMembers);\n\n    if(canViewMembers) {\n      firstMediaTab = membersTab;\n    }\n\n    this.container.classList.toggle('hide', !firstMediaTab);\n    this.container.parentElement.classList.toggle('search-empty', !firstMediaTab);\n    if(firstMediaTab) {\n      this.skipScroll = true;\n      this.selectTab(this.mediaTabs.indexOf(firstMediaTab), false);\n      // firstMediaTab.menuTab.classList.add('active');\n\n      this.navScrollableContainer.classList.toggle('hide', count <= 1);\n    }\n  }\n\n  public async load(single = false, justLoad = false) {\n    const peerId = this.searchContext.peerId;\n    this.log('load', single, peerId, this.loadPromises);\n    const middleware = this.middleware.get();\n\n    if(this.firstLoad) {\n      await (this.loadFirstTimePromise ??= this.loadFirstTime());\n      if(!middleware()) {\n        return;\n      }\n\n      this.loadFirstTimePromise = undefined;\n      this.firstLoad = false;\n    }\n\n    let toLoad = single ? [this.mediaTab] : this.mediaTabs.filter((t) => t !== this.mediaTab);\n    toLoad = toLoad.filter((mediaTab) => {\n      return this.canLoadMediaTab(mediaTab);\n    });\n\n    if(peerId.isUser()) {\n      findAndSplice(toLoad, (mediaTab) => mediaTab.type === 'members');\n    }\n\n    if(!toLoad.length) {\n      return;\n    }\n\n    const loadCount = justLoad ? 50 : Math.round((windowSize.height / 130 | 0) * 3 * 1.25); // that's good for all types\n\n    const promises: Promise<any>[] = toLoad.map((mediaTab) => {\n      return this.loadType(mediaTab, justLoad, loadCount, middleware);\n    });\n\n    return Promise.all(promises).catch((err) => {\n      this.log.error('Load error all promises:', err);\n    });\n  }\n\n  public getMonthContainerByTimestamp(timestamp: number, type: SearchSuperType) {\n    const date = new Date(timestamp * 1000);\n    date.setHours(0, 0, 0);\n    date.setDate(1);\n    const dateTimestamp = date.getTime();\n    const containers = this.monthContainers[type] ?? (this.monthContainers[type] = {});\n    if(!(dateTimestamp in containers)) {\n      const container = document.createElement('div');\n      container.className = 'search-super-month';\n\n      const name = document.createElement('div');\n      name.classList.add('search-super-month-name');\n\n      const options: Intl.DateTimeFormatOptions = {\n        month: 'long'\n      };\n\n      if(date.getFullYear() !== new Date().getFullYear()) {\n        options.year = 'numeric';\n      }\n\n      const dateElement = new I18n.IntlDateElement({\n        date,\n        options\n      }).element;\n      name.append(dateElement);\n\n      container.append(name);\n\n      const items = document.createElement('div');\n      items.classList.add('search-super-month-items');\n\n      container.append(name, items);\n\n      const haveTimestamps = getObjectKeysAndSort(containers, 'desc');\n      let i = 0;\n      for(; i < haveTimestamps.length; ++i) {\n        const t = haveTimestamps[i];\n        if(dateTimestamp > t) {\n          break;\n        }\n      }\n\n      containers[dateTimestamp] = {container, items};\n      positionElementByIndex(container, this.tabs[type], i);\n    }\n\n    return containers[dateTimestamp];\n  }\n\n  public canViewMembers() {\n    return Promise.all([\n      this.searchContext.peerId.isAnyChat(),\n      this.managers.appChatsManager.isBroadcast(this.searchContext.peerId.toChatId()),\n      this.managers.appChatsManager.hasRights(this.searchContext.peerId.toChatId(), 'view_participants')\n    ]).then(([isAnyChat, isBroadcast, hasRights]) => {\n      return isAnyChat && !isBroadcast && hasRights;\n    });\n  }\n\n  public cleanup() {\n    this.loadPromises = {};\n    this.loaded = {};\n    this.loadedChats = false;\n    this.nextRates = {};\n    this.firstLoad = true;\n    this.prevTabId = -1;\n\n    this.lazyLoadQueue.clear();\n\n    this.mediaTabs.forEach((mediaTab) => {\n      this.usedFromHistory[mediaTab.inputFilter] = -1;\n    });\n\n    if(this.selection?.isSelecting) {\n      this.selection.cancelSelection();\n    }\n\n    // * must go to first tab ( )\n    /* const membersTab = this.mediaTabsMap.get('members');\n    if(membersTab) {\n      const tab = this.canViewMembers() ? membersTab : this.mediaTabs[this.mediaTabs.indexOf(membersTab) + 1];\n      this.mediaTab = tab;\n    } */\n\n    this.middleware.clean();\n    this.loadFirstTimePromise = undefined;\n    this.cleanScrollPositions();\n    this.membersList = undefined;\n  }\n\n  public cleanScrollPositions() {\n    this.mediaTabs.forEach((mediaTab) => {\n      mediaTab.scroll = undefined;\n    });\n  }\n\n  public cleanupHTML(goFirst = false) {\n    if(this.urlsToRevoke.length) {\n      this.urlsToRevoke.forEach((url) => {\n        URL.revokeObjectURL(url);\n      });\n      this.urlsToRevoke.length = 0;\n    }\n\n    this.mediaTabs.forEach((tab) => {\n      tab.contentTab.innerHTML = '';\n\n      if(this.hideEmptyTabs) {\n        // tab.menuTab.classList.add('hide');\n        this.container.classList.add('hide');\n        this.container.parentElement.classList.add('search-empty');\n      }\n\n      if(tab.type === 'chats') {\n        return;\n      }\n\n      if(!this.historyStorage[tab.inputFilter]) {\n        const parent = tab.contentTab.parentElement;\n        // if(!testScroll) {\n        if(!parent.querySelector('.preloader')) {\n          putPreloader(parent, true);\n        }\n        // }\n\n        const empty = parent.querySelector('.content-empty');\n        if(empty) {\n          empty.remove();\n        }\n      }\n    });\n\n    /* if(goFirst) {\n      const membersTab = this.mediaTabsMap.get('members');\n      if(membersTab) {\n        let idx = this.canViewMembers() ? 0 : 1;\n        membersTab.menuTab.classList.toggle('hide', idx !== 0);\n\n        this.selectTab(idx, false);\n      } else {\n        this.selectTab(0, false);\n      }\n    } */\n\n    this.monthContainers = {};\n    this.searchGroupMedia.clear();\n    this.scrollable.scrollTop = 0;\n\n    /* if(testScroll) {\n      for(let i = 0; i < 1500; ++i) {\n        let div = document.createElement('div');\n        div.insertAdjacentHTML('beforeend', `<img class=\"media-image\" src=\"assets/img/camomile.jpg\">`);\n        div.classList.add('grid-item');\n        div.dataset.id = '' + (i / 3 | 0);\n        //div.innerText = '' + (i / 3 | 0);\n        this.tabs.inputMessagesFilterPhotoVideo.append(div);\n      }\n    } */\n  }\n\n  private copySearchContext(newInputFilter: MyInputMessagesFilter) {\n    const context = copy(this.searchContext);\n    context.inputFilter = {_: newInputFilter};\n    context.nextRate = this.nextRates[newInputFilter];\n    return context;\n  }\n\n  public setQuery({peerId, query, threadId, historyStorage, folderId, minDate, maxDate}: {\n    peerId: PeerId,\n    query?: string,\n    threadId?: number,\n    historyStorage?: AppSearchSuper['historyStorage'],\n    folderId?: number,\n    minDate?: number,\n    maxDate?: number\n  }) {\n    this.searchContext = {\n      peerId,\n      query: query || '',\n      inputFilter: {_: this.mediaTab.inputFilter},\n      threadId,\n      folderId,\n      minDate,\n      maxDate\n    };\n\n    this.historyStorage = historyStorage ?? {};\n\n    this.cleanup();\n  }\n\n  public destroy() {\n    this.listenerSetter.removeAll();\n    this.scrollable.destroy();\n    this.swipeHandler?.removeListeners();\n    this.selection?.cleanup();\n\n    this.scrollStartCallback = undefined;\n    this.onChangeTab = undefined;\n    this.selectTab = undefined;\n    this.searchContextMenu = undefined;\n    this.swipeHandler = undefined;\n    this.selection = undefined;\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport cancelEvent from './cancelEvent';\n\nexport default function lockTouchScroll(container: HTMLElement) {\n  const onTouchMove = (e: TouchEvent) => {\n    cancelEvent(e);\n  };\n\n  let lockers = 2;\n  const cb = () => {\n    if(!--lockers) {\n      container.removeEventListener('touchmove', onTouchMove, {capture: true});\n    }\n  };\n\n  container.addEventListener('touchmove', onTouchMove, {capture: true, passive: false});\n  container.addEventListener('touchend', cb, {once: true});\n\n  return cb;\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport type {ChatRights} from '../lib/appManagers/appChatsManager';\nimport type {Dialog} from '../lib/appManagers/appMessagesManager';\nimport appDialogsManager from '../lib/appManagers/appDialogsManager';\nimport rootScope from '../lib/rootScope';\nimport Scrollable from './scrollable';\nimport {FocusDirection} from '../helpers/fastSmoothScroll';\nimport CheckboxField from './checkboxField';\nimport {i18n, LangPackKey, _i18n} from '../lib/langPack';\nimport findUpAttribute from '../helpers/dom/findUpAttribute';\nimport findUpClassName from '../helpers/dom/findUpClassName';\nimport PeerTitle from './peerTitle';\nimport cancelEvent from '../helpers/dom/cancelEvent';\nimport replaceContent from '../helpers/dom/replaceContent';\nimport debounce from '../helpers/schedulers/debounce';\nimport windowSize from '../helpers/windowSize';\nimport type {IsPeerType} from '../lib/appManagers/appPeersManager';\nimport {generateDelimiter, SettingSection} from './sidebarLeft';\nimport {attachClickEvent, simulateClickEvent} from '../helpers/dom/clickEvent';\nimport filterUnique from '../helpers/array/filterUnique';\nimport indexOfAndSplice from '../helpers/array/indexOfAndSplice';\nimport safeAssign from '../helpers/object/safeAssign';\nimport findAndSplice from '../helpers/array/findAndSplice';\nimport AvatarElement from './avatar';\nimport {AppManagers} from '../lib/appManagers/managers';\nimport filterAsync from '../helpers/array/filterAsync';\nimport getParticipantPeerId from '../lib/appManagers/utils/chats/getParticipantPeerId';\nimport getChatMembersString from './wrappers/getChatMembersString';\nimport getUserStatusString from './wrappers/getUserStatusString';\nimport {Chat, User} from '../layer';\nimport canSendToUser from '../lib/appManagers/utils/users/canSendToUser';\nimport hasRights from '../lib/appManagers/utils/chats/hasRights';\nimport getDialogIndex from '../lib/appManagers/utils/dialogs/getDialogIndex';\n\ntype SelectSearchPeerType = 'contacts' | 'dialogs' | 'channelParticipants';\n\n// TODO:    addMembers, ..  peerType: 'contacts',       -  ,      \n\nexport default class AppSelectPeers {\n  public container = document.createElement('div');\n  public list = appDialogsManager.createChatList(/* {\n    handheldsSize: 66,\n    avatarSize: 48\n  } */);\n  private chatsContainer = document.createElement('div');\n  public scrollable: Scrollable;\n  private selectedScrollable: Scrollable;\n\n  private selectedContainer: HTMLElement;\n  public input: HTMLInputElement;\n\n  // public selected: {[peerId: PeerId]: HTMLElement} = {};\n  public selected = new Set<PeerId | string>();\n\n  public freezed = false;\n\n  private folderId = 0;\n  private offsetIndex = 0;\n  private promise: Promise<any>;\n\n  private query = '';\n  private cachedContacts: PeerId[];\n\n  private loadedWhat: Partial<{[k in 'dialogs' | 'archived' | 'contacts' | 'channelParticipants']: true}> = {};\n\n  private renderedPeerIds: Set<PeerId> = new Set();\n\n  private appendTo: HTMLElement;\n  private onChange: (length: number) => void;\n  private peerType: SelectSearchPeerType[] = ['dialogs'];\n  private renderResultsFunc: (peerIds: PeerId[]) => void | Promise<void>;\n  private chatRightsAction: ChatRights;\n  private multiSelect = true;\n  private rippleEnabled = true;\n  private avatarSize = 48;\n  private exceptSelf = false;\n  private filterPeerTypeBy: IsPeerType[];\n\n  private tempIds: {[k in keyof AppSelectPeers['loadedWhat']]: number} = {};\n  private peerId: PeerId;\n\n  private placeholder: LangPackKey;\n\n  private selfPresence: LangPackKey = 'Presence.YourChat';\n\n  private needSwitchList = false;\n\n  private sectionNameLangPackKey: LangPackKey;\n\n  private managers: AppManagers;\n\n  constructor(options: {\n    appendTo: AppSelectPeers['appendTo'],\n    onChange?: AppSelectPeers['onChange'],\n    peerType?: AppSelectPeers['peerType'],\n    peerId?: AppSelectPeers['peerId'],\n    onFirstRender?: () => void,\n    renderResultsFunc?: AppSelectPeers['renderResultsFunc'],\n    chatRightsAction?: AppSelectPeers['chatRightsAction'],\n    multiSelect?: AppSelectPeers['multiSelect'],\n    rippleEnabled?: AppSelectPeers['rippleEnabled'],\n    avatarSize?: AppSelectPeers['avatarSize'],\n    placeholder?: AppSelectPeers['placeholder'],\n    selfPresence?: AppSelectPeers['selfPresence'],\n    exceptSelf?: AppSelectPeers['exceptSelf'],\n    filterPeerTypeBy?: AppSelectPeers['filterPeerTypeBy'],\n    sectionNameLangPackKey?: AppSelectPeers['sectionNameLangPackKey'],\n    managers: AppSelectPeers['managers']\n  }) {\n    safeAssign(this, options);\n\n    this.container.classList.add('selector');\n\n    const f = (this.renderResultsFunc || this.renderResults).bind(this);\n    this.renderResultsFunc = async(peerIds) => {\n      if(this.needSwitchList) {\n        this.scrollable.splitUp.replaceWith(this.list);\n        this.scrollable.setVirtualContainer(this.list);\n        this.needSwitchList = false;\n      }\n\n      peerIds = peerIds.filter((peerId) => {\n        const notRendered = !this.renderedPeerIds.has(peerId);\n        if(notRendered) this.renderedPeerIds.add(peerId);\n        return notRendered;\n      });\n\n      if(this.filterPeerTypeBy) {\n        peerIds = await filterAsync(peerIds, async(peerId) => {\n          if(peerId.isPeerId()) {\n            const peer = await this.managers.appPeersManager.getPeer(peerId);\n            if(!peer.deleted) {\n              for(const method of this.filterPeerTypeBy) {\n                if(await this.managers.appPeersManager[method](peerId)) {\n                  return true;\n                }\n              }\n            }\n          }\n\n          return true;\n        });\n      }\n\n      return f(peerIds);\n    };\n\n    this.input = document.createElement('input');\n    this.input.classList.add('selector-search-input');\n    if(this.placeholder) {\n      _i18n(this.input, this.placeholder, undefined, 'placeholder');\n    } else {\n      _i18n(this.input, 'SendMessageTo', undefined, 'placeholder');\n    }\n\n    this.input.type = 'text';\n\n    if(this.multiSelect) {\n      const section = new SettingSection({});\n      section.innerContainer.classList.add('selector-search-section');\n      const topContainer = document.createElement('div');\n      topContainer.classList.add('selector-search-container');\n\n      this.selectedContainer = document.createElement('div');\n      this.selectedContainer.classList.add('selector-search');\n\n      this.selectedContainer.append(this.input);\n      topContainer.append(this.selectedContainer);\n      this.selectedScrollable = new Scrollable(topContainer);\n\n      // let delimiter = document.createElement('hr');\n\n      attachClickEvent(this.selectedContainer, (e) => {\n        if(this.freezed) return;\n        let target = e.target as HTMLElement;\n        target = findUpClassName(target, 'selector-user');\n\n        if(!target) return;\n\n        const peerId = target.dataset.key;\n        const li = this.chatsContainer.querySelector('[data-peer-id=\"' + peerId + '\"]') as HTMLElement;\n        if(!li) {\n          this.remove(peerId.toPeerId());\n        } else {\n          simulateClickEvent(li);\n        }\n      });\n\n      section.content.append(topContainer);\n      this.container.append(section.container/* , delimiter */);\n    }\n\n    this.chatsContainer.classList.add('chatlist-container');\n    // this.chatsContainer.append(this.list);\n    const section = new SettingSection({\n      name: this.sectionNameLangPackKey,\n      noShadow: true\n    });\n    section.content.append(this.list);\n    this.chatsContainer.append(section.container);\n    this.scrollable = new Scrollable(this.chatsContainer);\n    this.scrollable.setVirtualContainer(this.list);\n\n    attachClickEvent(this.chatsContainer, (e) => {\n      const target = findUpAttribute(e.target, 'data-peer-id') as HTMLElement;\n      cancelEvent(e);\n\n      if(!target) return;\n      if(this.freezed) return;\n\n      let key: PeerId | string = target.dataset.peerId;\n      key = key.isPeerId() ? key.toPeerId() : key;\n\n      if(!this.multiSelect) {\n        this.add(key);\n        return;\n      }\n\n      // target.classList.toggle('active');\n      if(this.selected.has(key)) {\n        this.remove(key);\n      } else {\n        this.add(key);\n      }\n\n      const checkbox = target.querySelector('input') as HTMLInputElement;\n      checkbox.checked = !checkbox.checked;\n    });\n\n    const debouncedInput = debounce(this.onInput, 200, false, true);\n    this.input.addEventListener('input', debouncedInput);\n\n    this.scrollable.onScrolledBottom = () => {\n      this.getMoreResults();\n    };\n\n    this.scrollable.container.prepend(generateDelimiter());\n\n    this.container.append(this.chatsContainer);\n    this.appendTo.append(this.container);\n\n    // WARNING TIMEOUT\n    setTimeout(() => {\n      const getResultsPromise = this.getMoreResults() as Promise<any>;\n      if(options.onFirstRender) {\n        getResultsPromise.then(() => {\n          options.onFirstRender();\n        });\n      }\n    }, 0);\n  }\n\n  private onInput = () => {\n    const value = this.input.value;\n    if(this.query !== value) {\n      if(this.peerType.includes('contacts') || this.peerType.includes('dialogs')) {\n        this.cachedContacts = null;\n      }\n\n      if(this.peerType.includes('dialogs')) {\n        this.folderId = 0;\n        this.offsetIndex = 0;\n      }\n\n      for(const i in this.tempIds) {\n        // @ts-ignore\n        ++this.tempIds[i];\n      }\n\n      this.list = appDialogsManager.createChatList();\n\n      this.promise = null;\n      this.loadedWhat = {};\n      this.query = value;\n      this.renderedPeerIds.clear();\n      this.needSwitchList = true;\n\n      // console.log('selectPeers input:', this.query);\n      this.getMoreResults();\n    }\n  };\n\n  private async renderSaved() {\n    if(\n      !this.exceptSelf &&\n      !this.offsetIndex &&\n      this.folderId === 0 &&\n      this.peerType.includes('dialogs') &&\n      (!this.query || await this.managers.appUsersManager.testSelfSearch(this.query))\n    ) {\n      await this.renderResultsFunc([rootScope.myId]);\n    }\n  }\n\n  private getTempId(type: keyof AppSelectPeers['tempIds']) {\n    if(this.tempIds[type] === undefined) {\n      this.tempIds[type] = 0;\n    }\n\n    return ++this.tempIds[type];\n  }\n\n  private async getMoreDialogs(): Promise<any> {\n    if(this.promise) return this.promise;\n\n    if(this.loadedWhat.dialogs && this.loadedWhat.archived) {\n      return;\n    }\n\n    //   -   ,  ,    \n    const pageCount = windowSize.height / 72 * 1.25 | 0;\n\n    const tempId = this.getTempId('dialogs');\n    const promise = this.managers.appMessagesManager.getConversations(this.query, this.offsetIndex, pageCount, this.folderId, true);\n    this.promise = promise;\n    const value = await promise;\n    if(this.tempIds.dialogs !== tempId) {\n      return;\n    }\n\n    this.promise = null;\n\n    let dialogs = value.dialogs as Dialog[];\n    if(dialogs.length) {\n      const newOffsetIndex = getDialogIndex(dialogs[dialogs.length - 1]) || 0;\n\n      dialogs = dialogs.slice();\n      findAndSplice(dialogs, d => d.peerId === rootScope.myId); // no my account\n\n      if(this.chatRightsAction) {\n        dialogs = await filterAsync(dialogs, (d) => this.filterByRights(d.peerId));\n      }\n\n      await this.renderSaved();\n\n      this.offsetIndex = newOffsetIndex;\n    }\n\n    this.renderResultsFunc(dialogs.map((dialog) => dialog.peerId));\n\n    if(value.isEnd) {\n      if(!this.loadedWhat.dialogs) {\n        await this.renderSaved();\n\n        this.loadedWhat.dialogs = true;\n        this.offsetIndex = 0;\n        this.folderId = 1;\n\n        return this.getMoreDialogs();\n      } else {\n        this.loadedWhat.archived = true;\n\n        if(!this.loadedWhat.contacts/*  && this.peerType.includes('contacts') */) {\n          return this.getMoreContacts();\n        }\n      }\n    }\n  }\n\n  private async filterByRights(peerId: PeerId) {\n    const peer: User | Chat = await this.managers.appPeersManager.getPeer(peerId);\n    if(peerId.isUser()) {\n      return this.chatRightsAction !== 'send_messages' || canSendToUser(peer as User.user);\n    } else if(hasRights(peer as Chat.chat, this.chatRightsAction)) {\n      return true;\n    }\n  }\n\n  private async getMoreContacts() {\n    if(this.promise) return this.promise;\n\n    if(this.loadedWhat.contacts) {\n      return;\n    }\n\n    const isGlobalSearch = this.peerType.includes('contacts');\n\n    if(!this.cachedContacts) {\n      /* const promises: Promise<any>[] = [appUsersManager.getContacts(this.query)];\n      if(!this.peerType.includes('dialogs')) {\n        promises.push(appMessagesManager.getConversationsAll());\n      }\n\n      this.promise = Promise.all(promises);\n      this.cachedContacts = (await this.promise)[0].slice(); */\n      const tempId = this.getTempId('contacts');\n      const promise = Promise.all([\n        isGlobalSearch ? this.managers.appUsersManager.getContactsPeerIds(this.query) : [],\n        this.query ? this.managers.appUsersManager.searchContacts(this.query) : undefined\n      ]);\n\n      this.promise = promise;\n      const [cachedContacts, searchResult] = await promise;\n      if(this.tempIds.contacts !== tempId) {\n        return;\n      }\n\n      if(searchResult) {\n        // do not add global result if only dialogs needed\n        let resultPeerIds = isGlobalSearch ? searchResult.my_results.concat(searchResult.results) : searchResult.my_results;\n\n        if(this.chatRightsAction) {\n          resultPeerIds = await filterAsync(resultPeerIds, (peerId) => this.filterByRights(peerId));\n        }\n\n        if(!this.peerType.includes('dialogs')) {\n          resultPeerIds = resultPeerIds.filter((peerId) => peerId.isUser());\n        }\n\n        this.cachedContacts = filterUnique(cachedContacts.concat(resultPeerIds));\n      } else this.cachedContacts = cachedContacts.slice();\n\n      indexOfAndSplice(this.cachedContacts, rootScope.myId); // no my account\n      this.promise = null;\n    }\n\n    // if(this.cachedContacts.length) {\n    const pageCount = windowSize.height / 72 * 1.25 | 0;\n    const arr = this.cachedContacts.splice(0, pageCount);\n    this.renderResultsFunc(arr);\n    // }\n\n    if(!this.cachedContacts.length) {\n      this.loadedWhat.contacts = true;\n\n      // need to load non-contacts\n      /* if(!this.peerType.includes('dialogs')) {\n        return this.getMoreDialogs();\n      } */\n    }\n  }\n\n  private async getMoreChannelParticipants() {\n    if(this.promise) return this.promise;\n\n    if(this.loadedWhat.channelParticipants) {\n      return;\n    }\n\n    const pageCount = 50; // same as in group permissions to use cache\n\n    const tempId = this.getTempId('channelParticipants');\n    const promise = this.managers.appProfileManager.getChannelParticipants(this.peerId.toChatId(), {_: 'channelParticipantsSearch', q: this.query}, pageCount, this.list.childElementCount);\n    const participants = await promise;\n    if(this.tempIds.channelParticipants !== tempId) {\n      return;\n    }\n\n    const peerIds = participants.participants.map((participant) => {\n      return getParticipantPeerId(participant);\n    });\n    indexOfAndSplice(peerIds, rootScope.myId);\n    this.renderResultsFunc(peerIds);\n\n    if(this.list.childElementCount >= participants.count || participants.participants.length < pageCount) {\n      this.loadedWhat.channelParticipants = true;\n    }\n  }\n\n  checkForTriggers = () => {\n    this.scrollable.checkForTriggers();\n  };\n\n  private getMoreResults() {\n    const get = () => {\n      const promises: Promise<any>[] = [];\n\n      // if(!loadedAllDialogs && (this.peerType.includes('dialogs')/*  || this.peerType.includes('contacts') */)) {\n      //   if(!loadAllDialogsPromise) {\n      //     loadAllDialogsPromise = appMessagesManager.getConversationsAll()\n      //     .then(() => {\n      //       loadedAllDialogs = true;\n      //     }).finally(() => {\n      //       loadAllDialogsPromise = null;\n      //     });\n      //   }\n\n      //   promises.push(loadAllDialogsPromise);\n      // }\n\n      if((this.peerType.includes('dialogs')/*  || this.loadedWhat.contacts */) && !this.loadedWhat.archived) { // to load non-contacts\n        promises.push(this.getMoreDialogs());\n\n        if(!this.loadedWhat.archived) {\n          return promises;\n        }\n      }\n\n      if((this.peerType.includes('contacts') || this.peerType.includes('dialogs')) && !this.loadedWhat.contacts) {\n        promises.push(this.getMoreContacts());\n      }\n\n      if(this.peerType.includes('channelParticipants') && !this.loadedWhat.channelParticipants) {\n        promises.push(this.getMoreChannelParticipants());\n      }\n\n      return promises;\n    };\n\n    const promises = get();\n    const promise = Promise.all(promises);\n    if(promises.length) {\n      promise.then(this.checkForTriggers);\n    }\n\n    return promise;\n  }\n\n  private async renderResults(peerIds: PeerId[]) {\n    // console.log('will renderResults:', peerIds);\n\n    //     \n    if(!this.peerType.includes('dialogs') && this.loadedWhat.contacts) {\n      peerIds = await filterAsync(peerIds, (peerId) => {\n        return this.managers.appUsersManager.isNonContactUser(peerId);\n      });\n    }\n\n    peerIds.forEach(async(peerId) => {\n      const {dom} = appDialogsManager.addDialogNew({\n        peerId: peerId,\n        container: this.scrollable,\n        rippleEnabled: this.rippleEnabled,\n        avatarSize: this.avatarSize\n      });\n\n      if(this.multiSelect) {\n        const selected = this.selected.has(peerId);\n        const checkboxField = new CheckboxField();\n\n        if(selected) {\n          // dom.listEl.classList.add('active');\n          checkboxField.input.checked = true;\n        }\n\n        dom.containerEl.prepend(checkboxField.label);\n      }\n\n      let subtitleEl: HTMLElement;\n      if(peerId.isAnyChat()) {\n        subtitleEl = await getChatMembersString(peerId.toChatId());\n      } else if(peerId === rootScope.myId) {\n        subtitleEl = i18n(this.selfPresence);\n      } else {\n        subtitleEl = getUserStatusString(await this.managers.appUsersManager.getUser(peerId.toUserId()));\n      }\n\n      dom.lastMessageSpan.append(subtitleEl);\n    });\n  }\n\n  public add(key: PeerId | string, title?: string | HTMLElement, scroll = true) {\n    // console.trace('add');\n    this.selected.add(key);\n\n    if(!this.multiSelect) {\n      this.onChange(this.selected.size);\n      return;\n    }\n\n    if(this.query.trim()) {\n      this.input.value = '';\n      this.onInput();\n    }\n\n    const div = document.createElement('div');\n    div.classList.add('selector-user', 'scale-in');\n\n    const avatarEl = new AvatarElement();\n    avatarEl.classList.add('selector-user-avatar', 'tgico', 'avatar-32');\n    avatarEl.isDialog = true;\n\n    div.dataset.key = '' + key;\n    if(key.isPeerId()) {\n      if(title === undefined) {\n        title = new PeerTitle({peerId: key.toPeerId(), dialog: true}).element;\n      }\n\n      avatarEl.updateWithOptions({\n        peerId: key as PeerId\n      });\n    }\n\n    if(title) {\n      if(typeof(title) === 'string') {\n        div.innerHTML = title;\n      } else {\n        replaceContent(div, title);\n        div.append(title);\n      }\n    }\n\n    div.insertAdjacentElement('afterbegin', avatarEl);\n\n    this.selectedContainer.insertBefore(div, this.input);\n    // this.selectedScrollable.scrollTop = this.selectedScrollable.scrollHeight;\n    this.onChange && this.onChange(this.selected.size);\n\n    if(scroll) {\n      this.selectedScrollable.scrollIntoViewNew({\n        element: this.input,\n        position: 'center'\n      });\n    }\n\n    return div;\n  }\n\n  public remove(key: PeerId | string) {\n    if(!this.multiSelect) return;\n    // const div = this.selected[peerId];\n    const div = this.selectedContainer.querySelector(`[data-key=\"${key}\"]`) as HTMLElement;\n    div.classList.remove('scale-in');\n    void div.offsetWidth;\n    div.classList.add('scale-out');\n\n    const onAnimationEnd = () => {\n      this.selected.delete(key);\n      div.remove();\n      this.onChange && this.onChange(this.selected.size);\n    };\n\n    if(rootScope.settings.animationsEnabled) {\n      div.addEventListener('animationend', onAnimationEnd, {once: true});\n    } else {\n      onAnimationEnd();\n    }\n  }\n\n  public getSelected() {\n    return [...this.selected];\n  }\n\n  public addInitial(values: any[]) {\n    values.forEach((value) => {\n      this.add(value, undefined, false);\n    });\n\n    window.requestAnimationFrame(() => { // ! not the best place for this raf though it works\n      this.selectedScrollable.scrollIntoViewNew({\n        element: this.input,\n        position: 'center',\n        forceDirection: FocusDirection.Static\n      });\n    });\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport type {MyDocument} from '../lib/appManagers/appDocsManager';\nimport {wrapPhoto} from './wrappers';\nimport ProgressivePreloader from './preloader';\nimport appMediaPlaybackController, {MediaItem, MediaSearchContext} from './appMediaPlaybackController';\nimport {DocumentAttribute, Message} from '../layer';\nimport mediaSizes from '../helpers/mediaSizes';\nimport {IS_SAFARI} from '../environment/userAgent';\nimport rootScope from '../lib/rootScope';\nimport cancelEvent from '../helpers/dom/cancelEvent';\nimport {attachClickEvent} from '../helpers/dom/clickEvent';\nimport LazyLoadQueue from './lazyLoadQueue';\nimport deferredPromise, {CancellablePromise} from '../helpers/cancellablePromise';\nimport ListenerSetter, {Listener} from '../helpers/listenerSetter';\nimport noop from '../helpers/noop';\nimport findUpClassName from '../helpers/dom/findUpClassName';\nimport {joinElementsWith} from '../lib/langPack';\nimport {MiddleEllipsisElement} from './middleEllipsis';\nimport {formatFullSentTime} from '../helpers/date';\nimport throttleWithRaf from '../helpers/schedulers/throttleWithRaf';\nimport {NULL_PEER_ID} from '../lib/mtproto/mtproto_config';\nimport formatBytes from '../helpers/formatBytes';\nimport {animateSingle} from '../helpers/animation';\nimport clamp from '../helpers/number/clamp';\nimport toHHMMSS from '../helpers/string/toHHMMSS';\nimport MediaProgressLine from './mediaProgressLine';\nimport setInnerHTML from '../helpers/dom/setInnerHTML';\nimport {AppManagers} from '../lib/appManagers/managers';\nimport wrapEmojiText from '../lib/richTextProcessor/wrapEmojiText';\nimport wrapSenderToPeer from './wrappers/senderToPeer';\nimport wrapSentTime from './wrappers/sentTime';\nimport getMediaFromMessage from '../lib/appManagers/utils/messages/getMediaFromMessage';\nimport appDownloadManager from '../lib/appManagers/appDownloadManager';\n\nrootScope.addEventListener('messages_media_read', ({mids, peerId}) => {\n  mids.forEach((mid) => {\n    const attr = `[data-mid=\"${mid}\"][data-peer-id=\"${peerId}\"]`;\n    (Array.from(document.querySelectorAll(`audio-element.is-unread${attr}, .media-round.is-unread${attr}`)) as AudioElement[]).forEach((elem) => {\n      elem.classList.remove('is-unread');\n    });\n  });\n});\n\n// https://github.com/LonamiWebs/Telethon/blob/4393ec0b83d511b6a20d8a20334138730f084375/telethon/utils.py#L1285\nexport function decodeWaveform(waveform: Uint8Array | number[]) {\n  if(!(waveform instanceof Uint8Array)) {\n    waveform = new Uint8Array(waveform);\n  }\n\n  const bitCount = waveform.length * 8;\n  const valueCount = bitCount / 5 | 0;\n  if(!valueCount) {\n    return new Uint8Array([]);\n  }\n\n  let result: Uint8Array;\n  try {\n    const dataView = new DataView(waveform.buffer);\n    result = new Uint8Array(valueCount);\n    for(let i = 0; i < valueCount; i++) {\n      const byteIndex = i * 5 / 8 | 0;\n      const bitShift = i * 5 % 8;\n      const value = dataView.getUint16(byteIndex, true);\n      result[i] = (value >> bitShift) & 0b00011111;\n    }\n  } catch(err) {\n    result = new Uint8Array([]);\n  }\n\n  /* var byteIndex = (valueCount - 1) / 8 | 0;\n  var bitShift = (valueCount - 1) % 8;\n  if(byteIndex === waveform.length - 1) {\n    var value = waveform[byteIndex];\n  } else {\n    var value = dataView.getUint16(byteIndex, true);\n  }\n  console.log('decoded waveform, setting last value:', value, byteIndex, bitShift);\n  result[valueCount - 1] = (value >> bitShift) & 0b00011111; */\n  return result;\n}\n\nfunction createWaveformBars(waveform: Uint8Array, duration: number) {\n  const barWidth = 2;\n  const barMargin = 2;      // mediaSizes.isMobile ? 2 : 1;\n  const barHeightMin = 4;   // mediaSizes.isMobile ? 3 : 2;\n  const barHeightMax = mediaSizes.isMobile ? 16 : 23;\n  // const availW = 150;       //mediaSizes.isMobile ? 152 : 190;\n\n  const minW = mediaSizes.isMobile ? 152 : 190;\n  const maxW = mediaSizes.isMobile ? 190 : 256;\n  const availW = clamp(duration / 60 * maxW, minW, maxW); // mediaSizes.isMobile ? 152 : 224;\n\n  const svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');\n  svg.classList.add('audio-waveform-bars');\n  svg.setAttributeNS(null, 'width', '' + availW);\n  svg.setAttributeNS(null, 'height', '' + barHeightMax);\n  svg.setAttributeNS(null, 'viewBox', `0 0 ${availW} ${barHeightMax}`);\n\n  // console.log('decoded waveform:', waveform);\n\n  const normValue = Math.max(...waveform);\n  const wfSize = waveform.length ? waveform.length : 100;\n  const barCount = Math.min((availW / (barWidth + barMargin)) | 0, wfSize);\n\n  let maxValue = 0;\n  const maxDelta = barHeightMax - barHeightMin;\n\n  let html = '';\n  for(let i = 0, barX = 0, sumI = 0; i < wfSize; ++i) {\n    const value = waveform[i] || 0;\n    if((sumI + barCount) >= wfSize) { // draw bar\n      sumI = sumI + barCount - wfSize;\n      if(sumI < (barCount + 1) / 2) {\n        if(maxValue < value) maxValue = value;\n      }\n\n      const bar_value = Math.max(((maxValue * maxDelta) + ((normValue + 1) / 2)) / (normValue + 1), barHeightMin);\n\n      const h = `\n      <rect x=\"${barX}\" y=\"${barHeightMax - bar_value}\" width=\"${barWidth}\" height=\"${bar_value}\" rx=\"1\" ry=\"1\"></rect>\n      `;\n      html += h;\n\n      barX += barWidth + barMargin;\n\n      if(sumI < (barCount + 1) / 2) {\n        maxValue = 0;\n      } else {\n        maxValue = value;\n      }\n    } else {\n      if(maxValue < value) maxValue = value;\n\n      sumI += barCount;\n    }\n  }\n\n  const container = document.createElement('div');\n  container.classList.add('audio-waveform');\n  container.append(svg);\n\n  svg.insertAdjacentHTML('beforeend', html);\n  return {svg, container, availW};\n}\n\nasync function wrapVoiceMessage(audioEl: AudioElement) {\n  audioEl.classList.add('is-voice');\n\n  const message = audioEl.message;\n  const doc = getMediaFromMessage(message) as MyDocument;\n\n  if(message.pFlags.out) {\n    audioEl.classList.add('is-out');\n  }\n\n  let waveform = (doc.attributes.find((attribute) => attribute._ === 'documentAttributeAudio') as DocumentAttribute.documentAttributeAudio).waveform || new Uint8Array([]);\n  waveform = decodeWaveform(waveform.slice(0, 63));\n\n  const {svg, container: svgContainer, availW} = createWaveformBars(waveform, doc.duration);\n\n  const fakeSvgContainer = svgContainer.cloneNode(true) as HTMLElement;\n  fakeSvgContainer.classList.add('audio-waveform-fake');\n  svgContainer.classList.add('audio-waveform-background');\n\n  const waveformContainer = document.createElement('div');\n  waveformContainer.classList.add('audio-waveform-container');\n  waveformContainer.append(svgContainer, fakeSvgContainer);\n\n  const timeDiv = document.createElement('div');\n  timeDiv.classList.add('audio-time');\n  audioEl.append(waveformContainer, timeDiv);\n\n  let progress = svg as any as HTMLElement;\n\n  const onLoad = () => {\n    let audio = audioEl.audio;\n\n    const setAnimation = () => {\n      animateSingle(() => {\n        if(!audio) return false;\n        onTimeUpdate();\n        return !audio.paused;\n      }, audioEl);\n    };\n\n    const onTimeUpdate = () => {\n      fakeSvgContainer.style.width = (audio.currentTime / audio.duration * 100) + '%';\n    };\n\n    if(!audio.paused || (audio.currentTime > 0 && audio.currentTime !== audio.duration)) {\n      onTimeUpdate();\n    }\n\n    const throttledTimeUpdate = throttleWithRaf(onTimeUpdate);\n    audioEl.addAudioListener('timeupdate', throttledTimeUpdate);\n    audioEl.addAudioListener('ended', throttledTimeUpdate);\n    audioEl.addAudioListener('play', setAnimation);\n\n    audioEl.readyPromise.then(() => {\n      let mousedown = false, mousemove = false;\n      progress.addEventListener('mouseleave', (e) => {\n        if(mousedown) {\n          audio.play();\n          mousedown = false;\n        }\n        mousemove = false;\n      })\n      progress.addEventListener('mousemove', (e) => {\n        mousemove = true;\n        if(mousedown) scrub(e);\n      });\n      progress.addEventListener('mousedown', (e) => {\n        e.preventDefault();\n        if(e.button !== 0) return;\n        if(!audio.paused) {\n          audio.pause();\n        }\n\n        scrub(e);\n        mousedown = true;\n      });\n      progress.addEventListener('mouseup', (e) => {\n        if(mousemove && mousedown) {\n          audio.play();\n          mousedown = false;\n        }\n      });\n      attachClickEvent(progress, (e) => {\n        cancelEvent(e);\n        if(!audio.paused) scrub(e);\n      });\n\n      function scrub(e: MouseEvent | TouchEvent) {\n        let offsetX: number;\n        if(e instanceof MouseEvent) {\n          offsetX = e.offsetX;\n        } else { // touch\n          const rect = (e.target as HTMLElement).getBoundingClientRect();\n          offsetX = e.targetTouches[0].pageX - rect.left;\n        }\n\n        const scrubTime = offsetX / availW /* width */ * audio.duration;\n        audio.currentTime = scrubTime;\n      }\n    }, noop);\n\n    return () => {\n      progress.remove();\n      progress = null;\n      audio = null;\n    };\n  };\n\n  return onLoad;\n}\n\nasync function wrapAudio(audioEl: AudioElement) {\n  const withTime = audioEl.withTime;\n\n  const message = audioEl.message;\n  const doc = getMediaFromMessage(message) as MyDocument;\n\n  const isVoice = doc.type === 'voice' || doc.type === 'round';\n  const descriptionEl = document.createElement('div');\n  descriptionEl.classList.add('audio-description');\n\n  const audioAttribute = doc.attributes.find((attr) => attr._ === 'documentAttributeAudio') as DocumentAttribute.documentAttributeAudio;\n\n  if(!isVoice) {\n    const parts: (Node | string)[] = [];\n    if(audioAttribute?.performer) {\n      parts.push(wrapEmojiText(audioAttribute.performer));\n    }\n\n    if(withTime) {\n      parts.push(formatFullSentTime(message.date));\n    } else if(!parts.length) {\n      parts.push(formatBytes(doc.size));\n    }\n\n    if(audioEl.showSender) {\n      parts.push(await wrapSenderToPeer(message));\n    }\n\n    descriptionEl.append(...joinElementsWith(parts, '  '));\n  }\n\n  const html = `\n  <div class=\"audio-details\">\n    <div class=\"audio-title\"></div>\n    <div class=\"audio-subtitle\"><div class=\"audio-time\"></div></div>\n  </div>`;\n  audioEl.insertAdjacentHTML('beforeend', html);\n\n  const titleEl = audioEl.querySelector('.audio-title') as HTMLElement;\n\n  const middleEllipsisEl = new MiddleEllipsisElement();\n  middleEllipsisEl.dataset.fontWeight = audioEl.dataset.fontWeight;\n  middleEllipsisEl.dataset.sizeType = audioEl.dataset.sizeType;\n  if(isVoice) {\n    middleEllipsisEl.append(await wrapSenderToPeer(message));\n  } else {\n    setInnerHTML(middleEllipsisEl, wrapEmojiText(audioAttribute?.title ?? doc.file_name));\n  }\n\n  titleEl.append(middleEllipsisEl);\n\n  if(audioEl.showSender) {\n    titleEl.append(wrapSentTime(message));\n  }\n\n  const subtitleDiv = audioEl.querySelector('.audio-subtitle') as HTMLDivElement;\n  subtitleDiv.append(descriptionEl);\n\n  const onLoad = () => {\n    let launched = false;\n\n    let progressLine = new MediaProgressLine(audioEl.audio, doc.supportsStreaming);\n\n    audioEl.addAudioListener('ended', () => {\n      audioEl.classList.remove('audio-show-progress');\n      // Reset subtitle\n      subtitleDiv.lastChild.replaceWith(descriptionEl);\n      launched = false;\n    });\n\n    const onPlay = () => {\n      if(!launched) {\n        audioEl.classList.add('audio-show-progress');\n        launched = true;\n\n        if(progressLine) {\n          subtitleDiv.lastChild.replaceWith(progressLine.container);\n        }\n      }\n    };\n\n    audioEl.addAudioListener('play', onPlay);\n\n    if(!audioEl.audio.paused || audioEl.audio.currentTime > 0) {\n      onPlay();\n    }\n\n    return () => {\n      progressLine.removeListeners();\n      progressLine.container.remove();\n      progressLine = null;\n    };\n  };\n\n  return onLoad;\n}\n\nfunction constructDownloadPreloader(tryAgainOnFail = true) {\n  const preloader = new ProgressivePreloader({cancelable: true, tryAgainOnFail});\n  preloader.construct();\n\n  if(!tryAgainOnFail) {\n    preloader.circle.setAttributeNS(null, 'r', '23');\n    preloader.totalLength = 143.58203125;\n  }\n\n  return preloader;\n}\n\nexport const findMediaTargets = (anchor: HTMLElement, anchorMid: number/* , useSearch: boolean */) => {\n  let prev: MediaItem[], next: MediaItem[];\n  // if(anchor.classList.contains('search-super-item') || !useSearch) {\n  const isBubbles = !anchor.classList.contains('search-super-item');\n  const container = findUpClassName(anchor, !isBubbles ? 'tabs-tab' : 'bubbles-inner');\n  if(container) {\n    const attr = `:not([data-is-outgoing=\"1\"])`;\n    const justAudioSelector = `.audio:not(.is-voice)${attr}`;\n    let selectors: string[];\n    if(!anchor.matches(justAudioSelector)) {\n      selectors = [`.audio.is-voice${attr}`, `.media-round${attr}`];\n    } else {\n      selectors = [justAudioSelector];\n    }\n\n    if(isBubbles) {\n      const prefix = '.bubble:not(.webpage) ';\n      selectors = selectors.map((s) => prefix + s);\n    }\n\n    const selector = selectors.join(', ');\n\n    const elements = Array.from(container.querySelectorAll(selector)) as HTMLElement[];\n    const idx = elements.indexOf(anchor);\n\n    const mediaItems: MediaItem[] = elements.map((element) => ({peerId: element.dataset.peerId.toPeerId(), mid: +element.dataset.mid}));\n\n    prev = mediaItems.slice(0, idx);\n    next = mediaItems.slice(idx + 1);\n  }\n  // }\n\n  if((next.length && next[0].mid < anchorMid) || (prev.length && prev[prev.length - 1].mid > anchorMid)) {\n    [prev, next] = [next.reverse(), prev.reverse()];\n  }\n\n  // prev = next = undefined;\n\n  return [prev, next];\n};\n\nexport default class AudioElement extends HTMLElement {\n  public audio: HTMLAudioElement;\n  public preloader: ProgressivePreloader;\n  public message: Message.message;\n  public withTime = false;\n  public voiceAsMusic = false;\n  public searchContext: MediaSearchContext;\n  public showSender = false;\n  public noAutoDownload: boolean;\n  public lazyLoadQueue: LazyLoadQueue;\n  public loadPromises: Promise<any>[];\n  public managers: AppManagers;\n\n  private listenerSetter = new ListenerSetter();\n  private onTypeDisconnect: () => void;\n  public onLoad: (autoload?: boolean) => void;\n  public readyPromise: CancellablePromise<void>;\n\n  public async render() {\n    this.classList.add('audio');\n    this.managers = rootScope.managers;\n\n    this.dataset.mid = '' + this.message.mid;\n    this.dataset.peerId = '' + this.message.peerId;\n\n    const doc = getMediaFromMessage(this.message) as MyDocument;\n    const isRealVoice = doc.type === 'voice';\n    const isVoice = !this.voiceAsMusic && isRealVoice;\n    const isOutgoing = this.message.pFlags.is_outgoing;\n    const uploadingFileName = this.message?.uploadingFileName;\n\n    const durationStr = toHHMMSS(doc.duration | 0);\n\n    this.innerHTML = `\n    <div class=\"audio-toggle audio-ico\">\n      <div class=\"audio-play-icon\">\n        <div class=\"part one\" x=\"0\" y=\"0\" fill=\"#fff\"></div>\n        <div class=\"part two\" x=\"0\" y=\"0\" fill=\"#fff\"></div>\n      </div>\n    </div>`;\n\n    const toggle = this.firstElementChild as HTMLElement;\n\n    const downloadDiv = document.createElement('div');\n    downloadDiv.classList.add('audio-download');\n\n    const isUnread = doc.type !== 'audio' && this.message && this.message.pFlags.media_unread;\n    if(isUnread) {\n      this.classList.add('is-unread');\n    }\n\n    if(uploadingFileName) {\n      this.classList.add('is-outgoing');\n      this.append(downloadDiv);\n    }\n\n    const onTypeLoad = await (isVoice ? wrapVoiceMessage(this) : wrapAudio(this));\n\n    const audioTimeDiv = this.querySelector('.audio-time') as HTMLDivElement;\n    audioTimeDiv.innerHTML = durationStr;\n\n    const onLoad = this.onLoad = (autoload: boolean) => {\n      this.onLoad = undefined;\n\n      const audio = this.audio = appMediaPlaybackController.addMedia(this.message, autoload);\n\n      const readyPromise = this.readyPromise = deferredPromise<void>();\n      if(this.audio.readyState >= this.audio.HAVE_CURRENT_DATA) readyPromise.resolve();\n      else {\n        this.addAudioListener('canplay', () => readyPromise.resolve(), {once: true});\n      }\n\n      this.onTypeDisconnect = onTypeLoad();\n\n      const getTimeStr = () => toHHMMSS(audio.currentTime | 0) + (isVoice ? (' / ' + durationStr) : '');\n\n      const onPlay = () => {\n        audioTimeDiv.innerText = getTimeStr();\n        toggle.classList.toggle('playing', !audio.paused);\n      };\n\n      if(!audio.paused || (audio.currentTime > 0 && audio.currentTime !== audio.duration)) {\n        onPlay();\n      }\n\n      const togglePlay = (e?: Event, paused = audio.paused) => {\n        e && cancelEvent(e);\n\n        if(paused) {\n          const hadSearchContext = !!this.searchContext;\n          if(appMediaPlaybackController.setSearchContext(this.searchContext || {\n            peerId: NULL_PEER_ID,\n            inputFilter: {_: 'inputMessagesFilterEmpty'},\n            useSearch: false\n          })) {\n            const [prev, next] = !hadSearchContext ? [] : findMediaTargets(this, this.message.mid/* , this.searchContext.useSearch */);\n            appMediaPlaybackController.setTargets({peerId: this.message.peerId, mid: this.message.mid}, prev, next);\n          }\n\n          audio.play().catch(() => {});\n        } else {\n          audio.pause();\n        }\n      };\n\n      attachClickEvent(toggle, (e) => togglePlay(e), {listenerSetter: this.listenerSetter});\n\n      this.addAudioListener('ended', () => {\n        toggle.classList.remove('playing');\n        audioTimeDiv.innerText = durationStr;\n      });\n\n      this.addAudioListener('timeupdate', () => {\n        if((!audio.currentTime && audio.paused) || appMediaPlaybackController.isSafariBuffering(audio)) return;\n        audioTimeDiv.innerText = getTimeStr();\n      });\n\n      this.addAudioListener('pause', () => {\n        toggle.classList.remove('playing');\n      });\n\n      this.addAudioListener('play', onPlay);\n\n      return togglePlay;\n    };\n\n    if(doc.thumbs?.length) {\n      const imgs: HTMLElement[] = [];\n      const wrapped = await wrapPhoto({\n        photo: doc,\n        message: null,\n        container: toggle,\n        boxWidth: 48,\n        boxHeight: 48,\n        loadPromises: this.loadPromises,\n        withoutPreloader: true,\n        lazyLoadQueue: this.lazyLoadQueue\n      });\n      toggle.style.width = toggle.style.height = '';\n      if(wrapped.images.thumb) imgs.push(wrapped.images.thumb);\n      if(wrapped.images.full) imgs.push(wrapped.images.full);\n\n      this.classList.add('audio-with-thumb');\n      imgs.forEach((img) => img.classList.add('audio-thumb'));\n    }\n\n    if(!isOutgoing) {\n      let preloader: ProgressivePreloader = this.preloader;\n\n      const autoDownload = doc.type !== 'audio'/*  || !this.noAutoDownload */;\n      onLoad(autoDownload);\n\n      const r = (shouldPlay: boolean) => {\n        if(this.audio.src) {\n          return;\n        }\n\n        appMediaPlaybackController.resolveWaitingForLoadMedia(this.message.peerId, this.message.mid, this.message.pFlags.is_scheduled);\n\n        const onDownloadInit = () => {\n          if(shouldPlay) {\n            appMediaPlaybackController.willBePlayed(this.audio); // prepare for loading audio\n\n            if(IS_SAFARI && !this.audio.autoplay) {\n              this.audio.autoplay = true;\n            }\n          }\n        };\n\n        onDownloadInit();\n\n        if(!preloader) {\n          if(doc.supportsStreaming) {\n            this.classList.add('corner-download');\n\n            let pauseListener: Listener;\n            const onPlay = () => {\n              const preloader = constructDownloadPreloader(false);\n              const deferred = deferredPromise<void>();\n              deferred.notifyAll({done: 75, total: 100});\n              deferred.catch(() => {\n                this.audio.pause();\n                appMediaPlaybackController.willBePlayed(undefined);\n              });\n              deferred.cancel = () => {\n                deferred.cancel = noop;\n                const err = new Error();\n                (err as any).type = 'CANCELED';\n                deferred.reject(err);\n              };\n              preloader.attach(downloadDiv, false, deferred);\n\n              pauseListener = this.addAudioListener('pause', () => {\n                deferred.cancel();\n              }, {once: true}) as any;\n\n              onDownloadInit();\n            };\n\n            /* if(!this.audio.paused) {\n              onPlay();\n            } */\n\n            const playListener: any = this.addAudioListener('play', onPlay);\n            this.readyPromise.then(() => {\n              this.listenerSetter.remove(playListener);\n              this.listenerSetter.remove(pauseListener);\n            });\n          } else {\n            preloader = constructDownloadPreloader();\n\n            if(!shouldPlay) {\n              this.readyPromise = deferredPromise();\n            }\n\n            const load = () => {\n              onDownloadInit();\n\n              const download = appDownloadManager.downloadMediaURL({media: doc});\n\n              if(!shouldPlay) {\n                download.then(() => {\n                  this.readyPromise.resolve();\n                });\n              }\n\n              preloader.attach(downloadDiv, false, download);\n              return {download};\n            };\n\n            preloader.setDownloadFunction(load);\n            load();\n          }\n        }\n\n        if(this.classList.contains('corner-download')) {\n          toggle.append(downloadDiv);\n        } else {\n          this.append(downloadDiv);\n        }\n\n        this.classList.add('downloading');\n\n        this.readyPromise.then(() => {\n          this.classList.remove('downloading');\n          downloadDiv.classList.add('downloaded');\n          setTimeout(() => {\n            downloadDiv.remove();\n          }, 200);\n\n          // setTimeout(() => {\n          // release loaded audio\n          if(appMediaPlaybackController.willBePlayedMedia === this.audio) {\n            this.audio.play();\n            appMediaPlaybackController.willBePlayed(undefined);\n          }\n          // }, 10e3);\n        });\n      };\n\n      if(!this.audio?.src) {\n        if(autoDownload) {\n          r(false);\n        } else {\n          attachClickEvent(toggle, () => {\n            r(true);\n          }, {once: true, capture: true, passive: false, listenerSetter: this.listenerSetter});\n        }\n      }\n    } else if(uploadingFileName) {\n      this.preloader = constructDownloadPreloader(false);\n      this.preloader.attachPromise(appDownloadManager.getUpload(uploadingFileName));\n      this.dataset.isOutgoing = '1';\n      this.preloader.attach(downloadDiv, false);\n      // onLoad();\n    }\n  }\n\n  get addAudioListener() {\n    return this.listenerSetter.add(this.audio);\n  }\n\n  disconnectedCallback() {\n    setTimeout(() => {\n      if(this.isConnected) {\n        return;\n      }\n\n      if(this.onTypeDisconnect) {\n        this.onTypeDisconnect();\n        this.onTypeDisconnect = null;\n      }\n\n      if(this.readyPromise) {\n        this.readyPromise.reject();\n      }\n\n      if(this.listenerSetter) {\n        this.listenerSetter.removeAll();\n        this.listenerSetter = null;\n      }\n\n      if(this.preloader) {\n        this.preloader = null;\n      }\n    }, 100);\n  }\n}\n\ncustomElements.define('audio-element', AudioElement);\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport {Photo} from '../layer';\nimport {AppManagers} from '../lib/appManagers/managers';\nimport ListLoader, {ListLoaderOptions} from './listLoader';\n\nexport default class AvatarListLoader<Item extends {photoId: Photo.photo['id']}> extends ListLoader<Item, any> {\n  private peerId: PeerId;\n  private managers: AppManagers;\n\n  constructor(options: Omit<ListLoaderOptions<Item, any>, 'loadMore'> & {peerId: PeerId, managers: AppManagers}) {\n    super({\n      ...options,\n      loadMore: (anchor, older, loadCount) => {\n        if(this.peerId.isAnyChat() || !older) return Promise.resolve({count: 0, items: []}); // !  ,    ,    .\n\n        const maxId = anchor?.photoId;\n        return this.managers.appPhotosManager.getUserPhotos(this.peerId, maxId, loadCount).then((value) => {\n          const items = value.photos.map((photoId) => {\n            return {element: null as HTMLElement, photoId} as any;\n          });\n\n          return {count: value.count, items};\n        });\n      }\n    });\n\n    this.loadedAllUp = true;\n    this.peerId = options.peerId;\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport AvatarListLoader from '../helpers/avatarListLoader';\nimport {Photo} from '../layer';\nimport appDownloadManager from '../lib/appManagers/appDownloadManager';\nimport appImManager from '../lib/appManagers/appImManager';\nimport rootScope from '../lib/rootScope';\nimport AppMediaViewerBase from './appMediaViewerBase';\n\ntype AppMediaViewerAvatarTargetType = {element: HTMLElement, photoId: Photo.photo['id']};\nexport default class AppMediaViewerAvatar extends AppMediaViewerBase<'', 'delete', AppMediaViewerAvatarTargetType> {\n  public peerId: PeerId;\n\n  constructor(peerId: PeerId) {\n    super(new AvatarListLoader({peerId, managers: rootScope.managers}), [/* 'delete' */]);\n\n    this.peerId = peerId;\n\n    this.setBtnMenuToggle([{\n      icon: 'download',\n      text: 'MediaViewer.Context.Download',\n      onClick: this.onDownloadClick\n    }/* , {\n      icon: 'delete danger btn-disabled',\n      text: 'Delete',\n      onClick: () => {}\n    } */]);\n\n    // * constructing html end\n\n    this.setListeners();\n  }\n\n  onPrevClick = (target: AppMediaViewerAvatarTargetType) => {\n    this.openMedia(target.photoId, target.element, -1);\n  };\n\n  onNextClick = (target: AppMediaViewerAvatarTargetType) => {\n    this.openMedia(target.photoId, target.element, 1);\n  };\n\n  onDownloadClick = async() => {\n    appDownloadManager.downloadToDisc({\n      media: await this.managers.appPhotosManager.getPhoto(this.target.photoId),\n      queueId: appImManager.chat.bubbles.lazyLoadQueue.queueId\n    });\n  };\n\n  public async openMedia(photoId: Photo.photo['id'], target?: HTMLElement, fromRight = 0, prevTargets?: AppMediaViewerAvatarTargetType[], nextTargets?: AppMediaViewerAvatarTargetType[]) {\n    if(this.setMoverPromise) return this.setMoverPromise;\n\n    const photo = await this.managers.appPhotosManager.getPhoto(photoId);\n    const ret = super._openMedia(photo, photo.date, this.peerId, fromRight, target, false, prevTargets, nextTargets);\n    this.target.photoId = photo.id;\n\n    return ret;\n  }\n}\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport rootScope from '../lib/rootScope';\r\nimport {Message, Photo} from '../layer';\r\nimport type LazyLoadQueue from './lazyLoadQueue';\r\nimport {attachClickEvent} from '../helpers/dom/clickEvent';\r\nimport cancelEvent from '../helpers/dom/cancelEvent';\r\nimport AppMediaViewer from './appMediaViewer';\r\nimport AppMediaViewerAvatar from './appMediaViewerAvatar';\r\nimport isObject from '../helpers/object/isObject';\r\nimport {ArgumentTypes} from '../types';\r\nimport putPhoto from './putPhoto';\r\nimport {recordPromise} from '../helpers/recordPromise';\r\n\r\nconst onAvatarUpdate = (peerId: PeerId) => {\r\n  (Array.from(document.querySelectorAll('avatar-element[data-peer-id=\"' + peerId + '\"]')) as AvatarElement[]).forEach((elem) => {\r\n    // console.log('updating avatar:', elem);\r\n    elem.update();\r\n  });\r\n};\r\n\r\nrootScope.addEventListener('avatar_update', onAvatarUpdate);\r\nrootScope.addEventListener('peer_title_edit', async(peerId) => {\r\n  if(!(await rootScope.managers.appAvatarsManager.isAvatarCached(peerId))) {\r\n    onAvatarUpdate(peerId);\r\n  }\r\n});\r\n\r\nexport async function openAvatarViewer(\r\n  target: HTMLElement,\r\n  peerId: PeerId,\r\n  middleware: () => boolean,\r\n  message?: any,\r\n  prevTargets?: {element: HTMLElement, item: Photo.photo['id'] | Message.messageService}[],\r\n  nextTargets?: typeof prevTargets\r\n) {\r\n  let photo = await rootScope.managers.appProfileManager.getFullPhoto(peerId);\r\n  if(!middleware() || !photo) {\r\n    return;\r\n  }\r\n\r\n  const getTarget = () => {\r\n    const good = Array.from(target.querySelectorAll('img')).find((img) => !img.classList.contains('emoji'));\r\n    return good ? target : null;\r\n  };\r\n\r\n  if(peerId.isAnyChat()) {\r\n    const hadMessage = !!message;\r\n    const inputFilter = 'inputMessagesFilterChatPhotos';\r\n    if(!message) {\r\n      message = await rootScope.managers.appMessagesManager.getSearch({\r\n        peerId,\r\n        inputFilter: {_: inputFilter},\r\n        maxId: 0,\r\n        limit: 1\r\n      }).then((value) => {\r\n        // console.log(lol);\r\n        // ! by descend\r\n        return value.history[0];\r\n      });\r\n\r\n      if(!middleware()) {\r\n        return;\r\n      }\r\n    }\r\n\r\n    if(message) {\r\n      // !   ,  (  )\r\n      const messagePhoto = message.action.photo;\r\n      if(messagePhoto.id !== photo.id) {\r\n        if(!hadMessage) {\r\n          message = rootScope.managers.appMessagesManager.generateFakeAvatarMessage(peerId, photo);\r\n        } else {\r\n\r\n        }\r\n      }\r\n\r\n      const f = (arr: typeof prevTargets) => arr.map((el) => ({\r\n        element: el.element,\r\n        mid: (el.item as Message.messageService).mid,\r\n        peerId: (el.item as Message.messageService).peerId\r\n      }));\r\n\r\n      new AppMediaViewer()\r\n      .setSearchContext({\r\n        peerId,\r\n        inputFilter: {_: inputFilter}\r\n      })\r\n      .openMedia(message, getTarget(), undefined, undefined, prevTargets ? f(prevTargets) : undefined, nextTargets ? f(nextTargets) : undefined);\r\n\r\n      return;\r\n    }\r\n  }\r\n\r\n  if(photo) {\r\n    if(!isObject(message) && message) {\r\n      photo = await rootScope.managers.appPhotosManager.getPhoto(message);\r\n    }\r\n\r\n    const f = (arr: typeof prevTargets) => arr.map((el) => ({\r\n      element: el.element,\r\n      photoId: el.item as string\r\n    }));\r\n\r\n    new AppMediaViewerAvatar(peerId).openMedia(\r\n      photo.id,\r\n      getTarget(),\r\n      undefined,\r\n      prevTargets ? f(prevTargets) : undefined,\r\n      nextTargets ? f(nextTargets) : undefined\r\n    );\r\n  }\r\n}\r\n\r\nconst believeMe: Map<PeerId, Set<AvatarElement>> = new Map();\r\nconst seen: Set<PeerId> = new Set();\r\n\r\nexport default class AvatarElement extends HTMLElement {\r\n  public peerId: PeerId;\r\n  public isDialog: boolean;\r\n  public peerTitle: string;\r\n  public loadPromises: Promise<any>[];\r\n  public lazyLoadQueue: LazyLoadQueue;\r\n  public isBig: boolean;\r\n  private addedToQueue = false;\r\n\r\n  disconnectedCallback() {\r\n    //         \r\n    // (   ,    /)\r\n    const set = believeMe.get(this.peerId);\r\n    if(set && set.has(this)) {\r\n      set.delete(this);\r\n      if(!set.size) {\r\n        believeMe.delete(this.peerId);\r\n      }\r\n    }\r\n\r\n    if(this.lazyLoadQueue) {\r\n      this.lazyLoadQueue.unobserve(this);\r\n    }\r\n  }\r\n\r\n  public attachClickEvent() {\r\n    let loading = false;\r\n    attachClickEvent(this, async(e) => {\r\n      cancelEvent(e);\r\n      if(loading) return;\r\n      // console.log('avatar clicked');\r\n      const peerId = this.peerId;\r\n      loading = true;\r\n      await openAvatarViewer(this, this.peerId, () => this.peerId === peerId);\r\n      loading = false;\r\n    });\r\n  }\r\n\r\n  public updateOptions(options: Partial<ArgumentTypes<AvatarElement['updateWithOptions']>[0]>) {\r\n    for(const i in options) {\r\n      // @ts-ignore\r\n      this[i] = options[i];\r\n    }\r\n  }\r\n\r\n  public updateWithOptions(options: {\r\n    peerId: PeerId,\r\n    isDialog?: boolean,\r\n    isBig?: boolean,\r\n    peerTitle?: string,\r\n    lazyLoadQueue?: LazyLoadQueue,\r\n    loadPromises?: Promise<any>[]\r\n  }) {\r\n    const wasPeerId = this.peerId;\r\n    this.updateOptions(options);\r\n    const newPeerId = this.peerId;\r\n\r\n    if(wasPeerId === newPeerId) {\r\n      return;\r\n    }\r\n\r\n    this.peerId = /* rootScope.managers.appPeersManager.getPeerMigratedTo(newPeerId) ||  */newPeerId;\r\n    this.dataset.peerId = '' + newPeerId;\r\n\r\n    if(wasPeerId) {\r\n      const set = believeMe.get(wasPeerId);\r\n      if(set) {\r\n        set.delete(this);\r\n        if(!set.size) {\r\n          believeMe.delete(wasPeerId);\r\n        }\r\n      }\r\n    }\r\n\r\n    return this.update();\r\n  }\r\n\r\n  private r(onlyThumb = false) {\r\n    const promise = putPhoto(this, this.peerId, this.isDialog, this.peerTitle, onlyThumb, this.isBig);\r\n    // recordPromise(promise, 'avatar putPhoto-' + this.peerId);\r\n\r\n    if(this.loadPromises) {\r\n      this.loadPromises.push(promise);\r\n\r\n      promise.finally(() => {\r\n        this.loadPromises = undefined;\r\n      });\r\n    }\r\n\r\n    return promise;\r\n  }\r\n\r\n  public update() {\r\n    if(this.lazyLoadQueue) {\r\n      if(!seen.has(this.peerId)) {\r\n        if(this.addedToQueue) return;\r\n        this.addedToQueue = true;\r\n\r\n        let set = believeMe.get(this.peerId);\r\n        if(!set) {\r\n          set = new Set();\r\n          believeMe.set(this.peerId, set);\r\n        }\r\n\r\n        set.add(this);\r\n\r\n        this.lazyLoadQueue.push({\r\n          div: this,\r\n          load: () => {\r\n            seen.add(this.peerId);\r\n            return this.update();\r\n          }\r\n        });\r\n\r\n        return this.r(true);\r\n      } else if(this.addedToQueue) {\r\n        this.lazyLoadQueue.unobserve(this);\r\n      }\r\n    }\r\n\r\n    seen.add(this.peerId);\r\n\r\n    const promise = this.r();\r\n\r\n    if(this.addedToQueue) {\r\n      promise.finally(() => {\r\n        this.addedToQueue = false;\r\n      });\r\n    }\r\n\r\n    const set = believeMe.get(this.peerId);\r\n    if(set) {\r\n      set.delete(this);\r\n      const arr = Array.from(set);\r\n      believeMe.delete(this.peerId);\r\n\r\n\r\n      for(let i = 0, length = arr.length; i < length; ++i) {\r\n        arr[i].update();\r\n      }\r\n    }\r\n\r\n    return promise;\r\n  }\r\n}\r\n\r\ncustomElements.define('avatar-element', AvatarElement);\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport type {CancellablePromise} from '../helpers/cancellablePromise';\r\nimport type {InputFile} from '../layer';\r\nimport {attachClickEvent} from '../helpers/dom/clickEvent';\r\nimport PopupElement from './popups';\r\nimport PopupAvatar from './popups/avatar';\r\n\r\nexport default class AvatarEdit {\r\n  public container: HTMLElement;\r\n  private canvas: HTMLCanvasElement;\r\n  private icon: HTMLSpanElement;\r\n\r\n  constructor(onChange: (uploadAvatar: () => CancellablePromise<InputFile>) => void) {\r\n    this.container = document.createElement('div');\r\n    this.container.classList.add('avatar-edit');\r\n\r\n    this.canvas = document.createElement('canvas');\r\n    this.canvas.classList.add('avatar-edit-canvas');\r\n\r\n    this.icon = document.createElement('span');\r\n    this.icon.classList.add('tgico', 'tgico-cameraadd');\r\n\r\n    this.container.append(this.canvas, this.icon);\r\n\r\n    attachClickEvent(this.container, () => {\r\n      PopupElement.createPopup(PopupAvatar).open(this.canvas, onChange);\r\n    });\r\n  }\r\n\r\n  public clear() {\r\n    const ctx = this.canvas.getContext('2d');\r\n    ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);\r\n  }\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport {i18n, LangPackKey} from '../lib/langPack';\r\nimport ripple from './ripple';\r\n\r\nexport type ButtonOptions = Partial<{\r\n  noRipple: true,\r\n  onlyMobile: true,\r\n  icon: string,\r\n  rippleSquare: true,\r\n  text: LangPackKey,\r\n  disabled: boolean,\r\n  asDiv: boolean\r\n}>;\r\n\r\nconst Button = (className: string, options: ButtonOptions = {}) => {\r\n  const button: HTMLButtonElement = document.createElement(options.asDiv ? 'div' : 'button') as any;\r\n  button.className = className + (options.icon ? ' tgico-' + options.icon : '');\r\n\r\n  if(!options.noRipple) {\r\n    if(options.rippleSquare) {\r\n      button.classList.add('rp-square');\r\n    }\r\n\r\n    ripple(button);\r\n  }\r\n\r\n  if(options.onlyMobile) {\r\n    button.classList.add('only-handhelds');\r\n  }\r\n\r\n  if(options.disabled) {\r\n    button.setAttribute('disabled', 'true');\r\n  }\r\n\r\n  if(options.text) {\r\n    button.append(i18n(options.text));\r\n  }\r\n\r\n  return button;\r\n};\r\n\r\nexport default Button;\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport Button from './button';\r\n\r\nconst ButtonCorner = (options: Partial<{className: string, icon: string, noRipple: true, onlyMobile: true, asDiv: boolean}> = {}) => {\r\n  const button = Button('btn-circle btn-corner z-depth-1' + (options.className ? ' ' + options.className : ''), options);\r\n  return button;\r\n};\r\n\r\nexport default ButtonCorner;\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport Button from './button';\r\n\r\nconst ButtonIcon = (className?: string, options: Partial<{noRipple: true, onlyMobile: true, asDiv: boolean}> = {}) => {\r\n  const button = Button('btn-icon', {\r\n    icon: className || undefined,\r\n    ...options\r\n  });\r\n\r\n  return button;\r\n};\r\n\r\nexport default ButtonIcon;\r\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport contextMenuController from '../helpers/contextMenuController';\nimport cancelEvent from '../helpers/dom/cancelEvent';\nimport {AttachClickOptions, attachClickEvent} from '../helpers/dom/clickEvent';\nimport findUpClassName from '../helpers/dom/findUpClassName';\nimport ListenerSetter from '../helpers/listenerSetter';\nimport {FormatterArguments, i18n, LangPackKey} from '../lib/langPack';\nimport CheckboxField from './checkboxField';\n\nexport type ButtonMenuItemOptions = {\n  icon?: string,\n  text?: LangPackKey,\n  textArgs?: FormatterArguments,\n  regularText?: string,\n  onClick: (e: MouseEvent | TouchEvent) => void | boolean | any,\n  element?: HTMLElement,\n  textElement?: HTMLElement,\n  options?: AttachClickOptions,\n  checkboxField?: CheckboxField,\n  noCheckboxClickListener?: boolean,\n  keepOpen?: boolean\n  /* , cancelEvent?: true */\n};\n\nconst ButtonMenuItem = (options: ButtonMenuItemOptions) => {\n  if(options.element) return options.element;\n\n  const {icon, text, onClick, checkboxField, noCheckboxClickListener} = options;\n  const el = document.createElement('div');\n  el.className = 'btn-menu-item rp-overflow' + (icon ? ' tgico-' + icon : '');\n  // ripple(el);\n\n  let textElement = options.textElement;\n  if(!textElement) {\n    textElement = options.textElement = text ? i18n(text, options.textArgs) : document.createElement('span');\n    if(options.regularText) textElement.innerHTML = options.regularText;\n  }\n\n  textElement.classList.add('btn-menu-item-text');\n  el.append(textElement);\n\n  const keepOpen = !!checkboxField || !!options.keepOpen;\n\n  // * cancel mobile keyboard close\n  onClick && attachClickEvent(el, /* CLICK_EVENT_NAME !== 'click' || keepOpen ? */ (e) => {\n    cancelEvent(e);\n\n    const menu = findUpClassName(e.target, 'btn-menu');\n    if(menu && !menu.classList.contains('active')) {\n      return;\n    }\n\n    const result = onClick(e);\n\n    if(result === false) {\n      return;\n    }\n\n    if(!keepOpen) {\n      contextMenuController.close();\n    }\n\n    if(checkboxField && !noCheckboxClickListener/*  && result !== false */) {\n      checkboxField.checked = checkboxField.input.type === 'radio' ? true : !checkboxField.checked;\n    }\n  }/*  : onClick */, options.options);\n\n  if(checkboxField) {\n    el.append(checkboxField.label);\n  }\n\n  return options.element = el;\n};\n\nconst ButtonMenu = (buttons: ButtonMenuItemOptions[], listenerSetter?: ListenerSetter) => {\n  const el = document.createElement('div');\n  el.classList.add('btn-menu');\n\n  if(listenerSetter) {\n    buttons.forEach((b) => {\n      if(b.options) {\n        b.options.listenerSetter = listenerSetter;\n      } else {\n        b.options = {listenerSetter};\n      }\n    });\n  }\n\n  const items = buttons.map(ButtonMenuItem);\n\n  el.append(...items);\n\n  return el;\n};\n\nexport default ButtonMenu;\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport contextMenuController from '../helpers/contextMenuController';\r\nimport cancelEvent from '../helpers/dom/cancelEvent';\r\nimport {AttachClickOptions, CLICK_EVENT_NAME} from '../helpers/dom/clickEvent';\r\nimport ListenerSetter from '../helpers/listenerSetter';\r\nimport ButtonIcon from './buttonIcon';\r\nimport ButtonMenu, {ButtonMenuItemOptions} from './buttonMenu';\r\n\r\nconst ButtonMenuToggle = (\r\n  options: Partial<{\r\n    noRipple: true,\r\n    onlyMobile: true,\r\n    listenerSetter: ListenerSetter,\r\n    asDiv: boolean,\r\n    container: HTMLElement\r\n  }> = {},\r\n  direction: 'bottom-left' | 'bottom-right' | 'top-left' | 'top-right',\r\n  buttons: ButtonMenuItemOptions[],\r\n  onOpen?: (e: Event) => void,\r\n  onClose?: () => void\r\n) => {\r\n  options.asDiv = true;\r\n  const button = options.container ?? ButtonIcon('more', options);\r\n  button.classList.add('btn-menu-toggle');\r\n\r\n  const btnMenu = ButtonMenu(buttons, options.listenerSetter);\r\n  btnMenu.classList.add(direction);\r\n  ButtonMenuToggleHandler(button, onOpen, options, onClose);\r\n  button.append(btnMenu);\r\n  return button;\r\n};\r\n\r\n// TODO: refactor for attachClickEvent, because if move finger after touchstart, it will start anyway\r\nconst ButtonMenuToggleHandler = (el: HTMLElement, onOpen?: (e: Event) => void | Promise<any>, options?: AttachClickOptions, onClose?: () => void) => {\r\n  const add = options?.listenerSetter ? options.listenerSetter.add(el) : el.addEventListener.bind(el);\r\n\r\n  // console.trace('ButtonMenuToggleHandler attach', el, onOpen, options);\r\n  add(CLICK_EVENT_NAME, (e: Event) => {\r\n    // console.log('ButtonMenuToggleHandler click', e);\r\n    if(!el.classList.contains('btn-menu-toggle')) return false;\r\n\r\n    // window.removeEventListener('mousemove', onMouseMove);\r\n    const openedMenu = el.querySelector('.btn-menu') as HTMLDivElement;\r\n    cancelEvent(e);\r\n\r\n    if(el.classList.contains('menu-open')) {\r\n      contextMenuController.close();\r\n    } else {\r\n      const result = onOpen && onOpen(e);\r\n      const open = () => {\r\n        contextMenuController.openBtnMenu(openedMenu, onClose);\r\n      };\r\n\r\n      if(result instanceof Promise) {\r\n        result.then(open);\r\n      } else {\r\n        open();\r\n      }\r\n    }\r\n  });\r\n};\r\n\r\nexport {ButtonMenuToggleHandler};\r\nexport default ButtonMenuToggle;\r\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko, Artem Kolnogorov and unknown creator of the script taken from http://useless.altervista.org/gradient.html\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport {animate} from '../../helpers/animation';\nimport {hexToRgb} from '../../helpers/color';\n\nconst WIDTH = 50;\nconst HEIGHT = WIDTH;\n\nexport default class ChatBackgroundGradientRenderer {\n  private readonly _width = WIDTH;\n  private readonly _height = HEIGHT;\n  private _phase: number;\n  private _tail: number;\n  private readonly _tails = 90;\n  private readonly _scrollTails = 50;\n  private _frames: ImageData[];\n  private _colors: {r: number, g: number, b: number}[];\n  /* private readonly _curve = [\n    0, 25, 50, 75, 100, 150, 200, 250, 300, 350, 400, 500, 600, 700, 800, 900,\n    1000, 1100, 1200, 1300, 1400, 1500, 1600, 1700, 1800, 1830, 1860, 1890, 1920,\n    1950, 1980, 2010, 2040, 2070, 2100, 2130, 2160, 2190, 2220, 2250, 2280, 2310,\n    2340, 2370, 2400, 2430, 2460, 2490, 2520, 2550, 2580, 2610, 2630, 2640, 2650,\n    2660, 2670, 2680, 2690, 2700\n  ]; */\n  private readonly _curve = [\n    0, 0.25, 0.50, 0.75, 1, 1.5, 2, 2.5, 3, 3.5, 4, 5, 6, 7, 8, 9, 10, 11, 12,\n    13, 14, 15, 16, 17, 18, 18.3, 18.6, 18.9, 19.2, 19.5, 19.8, 20.1, 20.4, 20.7,\n    21.0, 21.3, 21.6, 21.9, 22.2, 22.5, 22.8, 23.1, 23.4, 23.7, 24.0, 24.3, 24.6,\n    24.9, 25.2, 25.5, 25.8, 26.1, 26.3, 26.4, 26.5, 26.6, 26.7, 26.8, 26.9, 27\n  ];\n  private readonly _incrementalCurve: number[];\n  private readonly _positions = [\n    {x: 0.80, y: 0.10},\n    {x: 0.60, y: 0.20},\n    {x: 0.35, y: 0.25},\n    {x: 0.25, y: 0.60},\n    {x: 0.20, y: 0.90},\n    {x: 0.40, y: 0.80},\n    {x: 0.65, y: 0.75},\n    {x: 0.75, y: 0.40}\n  ];\n  private readonly _phases = this._positions.length;\n  private _onWheelRAF: number;\n  private _scrollDelta: number;\n\n  // private _ts = 0;\n  // private _fps = 15;\n  // private _frametime = 1000 / this._fps;\n  // private _raf: number;\n\n  private _canvas: HTMLCanvasElement;\n  private _ctx: CanvasRenderingContext2D;\n  private _hc: HTMLCanvasElement;\n  private _hctx: CanvasRenderingContext2D;\n\n  private _addedScrollListener: boolean;\n  private _animatingToNextPosition: boolean;\n\n  constructor() {\n    const diff = this._tails / this._curve[this._curve.length - 1];\n\n    for(let i = 0, length = this._curve.length; i < length; ++i) {\n      this._curve[i] = this._curve[i] * diff;\n    }\n\n    this._incrementalCurve = this._curve.map((v, i, arr) => {\n      return v - (arr[i - 1] ?? 0);\n    });\n  }\n\n  private hexToRgb(hex: string) {\n    const result = hexToRgb(hex);\n    return {r: result[0], g: result[1], b: result[2]};\n  }\n\n  private getPositions(shift: number) {\n    const positions = this._positions.slice();\n    while(shift > 0) {\n      positions.push(positions.shift());\n      --shift;\n    }\n\n    const result: typeof positions = [];\n    for(let i = 0; i < positions.length; i += 2) {\n      result.push(positions[i]);\n    }\n    return result;\n  }\n\n  private getNextPositions(phase: number, curveMax: number, curve: number[]) {\n    const pos = this.getPositions(phase);\n    if(!curve[0] && curve.length === 1) {\n      return [pos];\n    }\n\n    const nextPos = this.getPositions(++phase % this._phases);\n    const distances = nextPos.map((nextPos, idx) => {\n      return {\n        x: (nextPos.x - pos[idx].x) / curveMax,\n        y: (nextPos.y - pos[idx].y) / curveMax\n      };\n    });\n\n    const positions = curve.map((value) => {\n      return distances.map((distance, idx) => {\n        return {\n          x: pos[idx].x + distance.x * value,\n          y: pos[idx].y + distance.y * value\n        };\n      });\n    });\n\n    return positions;\n  }\n\n  private curPosition(phase: number, tail: number) {\n    const positions = this.getNextPositions(phase, this._tails, [tail]);\n    return positions[0];\n  }\n\n  private changeTail(diff: number) {\n    this._tail += diff;\n\n    while(this._tail >= this._tails) {\n      this._tail -= this._tails;\n      if(++this._phase >= this._phases) {\n        this._phase -= this._phases;\n      }\n    }\n\n    while(this._tail < 0) {\n      this._tail += this._tails;\n      if(--this._phase < 0) {\n        this._phase += this._phases;\n      }\n    }\n  }\n\n  private onWheel = (e: {deltaY: number}) => {\n    if(this._animatingToNextPosition) {\n      return;\n    }\n\n    this._scrollDelta += e.deltaY;\n    if(this._onWheelRAF === undefined) {\n      this._onWheelRAF = requestAnimationFrame(this.drawOnWheel);\n    }\n  };\n\n  private drawOnWheel = () => {\n    let diff = this._scrollDelta / this._scrollTails;\n    this._scrollDelta %= this._scrollTails;\n    diff = diff > 0 ? Math.floor(diff) : Math.ceil(diff);\n    if(diff) {\n      this.changeTail(diff);\n      const curPos = this.curPosition(this._phase, this._tail);\n      this.drawGradient(curPos);\n    }\n    this._onWheelRAF = undefined;\n  };\n\n  private drawNextPositionAnimated = () => {\n    const frames = this._frames;\n    const id = frames.shift();\n    if(id) {\n      this.drawImageData(id);\n    }\n\n    const leftLength = frames.length;\n    if(!leftLength) {\n      this._animatingToNextPosition = undefined;\n    }\n\n    return !!leftLength;\n  };\n\n  private getGradientImageData(positions: {x: number, y: number}[]) {\n    const id = this._hctx.createImageData(this._width, this._height);\n    const pixels = id.data;\n\n    let offset = 0;\n    for(let y = 0; y < this._height; ++y) {\n      const directPixelY = y / this._height;\n      const centerDistanceY = directPixelY - 0.5;\n      const centerDistanceY2 = centerDistanceY * centerDistanceY;\n\n      for(let x = 0; x < this._width; ++x) {\n        const directPixelX = x / this._width;\n\n        const centerDistanceX = directPixelX - 0.5;\n        const centerDistance = Math.sqrt(centerDistanceX * centerDistanceX + centerDistanceY2);\n\n        const swirlFactor = 0.35 * centerDistance;\n        const theta = swirlFactor * swirlFactor * 0.8 * 8.0;\n        const sinTheta = Math.sin(theta);\n        const cosTheta = Math.cos(theta);\n\n        const pixelX = Math.max(0.0, Math.min(1.0, 0.5 + centerDistanceX * cosTheta - centerDistanceY * sinTheta));\n        const pixelY = Math.max(0.0, Math.min(1.0, 0.5 + centerDistanceX * sinTheta + centerDistanceY * cosTheta));\n\n        let distanceSum = 0.0;\n\n        let r = 0.0;\n        let g = 0.0;\n        let b = 0.0;\n\n        for(let i = 0; i < this._colors.length; i++) {\n          const colorX = positions[i].x;\n          const colorY = positions[i].y;\n\n          const distanceX = pixelX - colorX;\n          const distanceY = pixelY - colorY;\n\n          let distance = Math.max(0.0, 0.9 - Math.sqrt(distanceX * distanceX + distanceY * distanceY));\n          distance = distance * distance * distance * distance;\n          distanceSum += distance;\n\n          r += distance * this._colors[i].r / 255;\n          g += distance * this._colors[i].g / 255;\n          b += distance * this._colors[i].b / 255;\n        }\n\n        pixels[offset++] = r / distanceSum * 255.0;\n        pixels[offset++] = g / distanceSum * 255.0;\n        pixels[offset++] = b / distanceSum * 255.0;\n        pixels[offset++] = 0xFF;\n      }\n    }\n    return id;\n  }\n\n  private drawImageData(id: ImageData) {\n    this._hctx.putImageData(id, 0, 0);\n    this._ctx.drawImage(this._hc, 0, 0, this._width, this._height);\n  }\n\n  private drawGradient(positions: {x: number, y: number}[]) {\n    this.drawImageData(this.getGradientImageData(positions));\n  }\n\n  // private doAnimate = () => {\n  //   const now = +Date.now();\n  //   if(!document.hasFocus() || (now - this._ts) < this._frametime) {\n  //     this._raf = requestAnimationFrame(this.doAnimate);\n  //     return;\n  //   }\n\n  //   this._ts = now;\n  //   this.changeTail(1);\n  //   const cur_pos = this.curPosition(this._phase, this._tail);\n  //   this.drawGradient(cur_pos);\n  //   this._raf = requestAnimationFrame(this.doAnimate);\n  // };\n\n  // public animate(start?: boolean) {\n  //   if(!start) {\n  //     cancelAnimationFrame(this._raf);\n  //     return;\n  //   }\n  //   this.doAnimate();\n  // }\n\n  public init(el: HTMLCanvasElement) {\n    this._frames = [];\n    this._phase = 0;\n    this._tail = 0;\n    this._scrollDelta = 0;\n    if(this._onWheelRAF !== undefined) {\n      cancelAnimationFrame(this._onWheelRAF);\n      this._onWheelRAF = undefined;\n    }\n\n    const colors = el.getAttribute('data-colors').split(',').reverse();\n    this._colors = colors.map((color) => {\n      return this.hexToRgb(color);\n    });\n\n    if(!this._hc) {\n      this._hc = document.createElement('canvas');\n      this._hc.width = this._width;\n      this._hc.height = this._height;\n      this._hctx = this._hc.getContext('2d', {alpha: false});\n    }\n\n    this._canvas = el;\n    this._ctx = this._canvas.getContext('2d', {alpha: false});\n    this.update();\n  }\n\n  public update() {\n    if(this._colors.length < 2) {\n      const color = this._colors[0];\n      this._ctx.fillStyle = `rgb(${color.r}, ${color.g}, ${color.b})`;\n      this._ctx.fillRect(0, 0, this._width, this._height);\n      return;\n    }\n\n    const pos = this.curPosition(this._phase, this._tail);\n    this.drawGradient(pos);\n  }\n\n  public toNextPosition() {\n    if(this._colors.length < 2) {\n      return;\n    }\n\n    const tail = this._tail;\n    const tails = this._tails;\n\n    let nextPhaseOnIdx: number;\n\n    const curve: number[] = [];\n    for(let i = 0, length = this._incrementalCurve.length; i < length; ++i) {\n      const inc = this._incrementalCurve[i];\n      let value = (curve[i - 1] ?? tail) + inc;\n\n      if(+value.toFixed(2) > tails && nextPhaseOnIdx === undefined) {\n        nextPhaseOnIdx = i;\n        value %= tails;\n      }\n\n      curve.push(value);\n    }\n\n    const currentPhaseCurve = curve.slice(0, nextPhaseOnIdx);\n    const nextPhaseCurve = nextPhaseOnIdx !== undefined ? curve.slice(nextPhaseOnIdx) : [];\n\n    [currentPhaseCurve, nextPhaseCurve].forEach((curve, idx, curves) => {\n      const last = curve[curve.length - 1];\n      if(last !== undefined && last > tails) {\n        curve[curve.length - 1] = +last.toFixed(2);\n      }\n\n      this._tail = last ?? 0;\n\n      if(!curve.length) {\n        return;\n      }\n\n      const positions = this.getNextPositions(this._phase, tails, curve);\n      if(idx !== (curves.length - 1)) {\n        if(++this._phase >= this._phases) {\n          this._phase -= this._phases;\n        }\n      }\n\n      const ids = positions.map((pos) => {\n        return this.getGradientImageData(pos);\n      });\n\n      this._frames.push(...ids);\n    });\n\n    this._animatingToNextPosition = true;\n    animate(this.drawNextPositionAnimated);\n  }\n\n  public scrollAnimate(start?: boolean) {\n    if(this._colors.length < 2 && start) {\n      return;\n    }\n\n    if(start && !this._addedScrollListener) {\n      document.addEventListener('wheel', this.onWheel);\n      this._addedScrollListener = true;\n    } else if(!start && this._addedScrollListener) {\n      document.removeEventListener('wheel', this.onWheel);\n      this._addedScrollListener = false;\n    }\n  }\n\n  public cleanup() {\n    this.scrollAnimate(false);\n    // this.animate(false);\n  }\n\n  public static createCanvas(colors?: string) {\n    const canvas = document.createElement('canvas');\n    canvas.width = WIDTH;\n    canvas.height = HEIGHT;\n    if(colors !== undefined) {\n      canvas.dataset.colors = colors;\n    }\n\n    return canvas;\n  }\n\n  public static create(colors?: string) {\n    const canvas = this.createCanvas(colors);\n    const gradientRenderer = new ChatBackgroundGradientRenderer();\n    gradientRenderer.init(canvas);\n\n    return {gradientRenderer, canvas};\n  }\n}\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport replaceContent from '../../helpers/dom/replaceContent';\r\nimport {Middleware} from '../../helpers/middleware';\r\nimport limitSymbols from '../../helpers/string/limitSymbols';\r\nimport {Document, MessageMedia, Photo, WebPage} from '../../layer';\r\nimport appImManager, {CHAT_ANIMATION_GROUP} from '../../lib/appManagers/appImManager';\r\nimport choosePhotoSize from '../../lib/appManagers/utils/photos/choosePhotoSize';\r\nimport wrapEmojiText from '../../lib/richTextProcessor/wrapEmojiText';\r\nimport DivAndCaption from '../divAndCaption';\r\nimport {wrapPhoto, wrapSticker, wrapVideo} from '../wrappers';\r\nimport wrapMessageForReply from '../wrappers/messageForReply';\r\n\r\nconst MEDIA_SIZE = 32;\r\n\r\nexport async function wrapReplyDivAndCaption(options: {\r\n  title: string | HTMLElement | DocumentFragment,\r\n  titleEl: HTMLElement,\r\n  subtitle: string | HTMLElement | DocumentFragment,\r\n  subtitleEl: HTMLElement,\r\n  message: any,\r\n  mediaEl: HTMLElement,\r\n  loadPromises?: Promise<any>[]\r\n}) {\r\n  let {title, titleEl, subtitle, subtitleEl, mediaEl, message, loadPromises} = options;\r\n  if(title !== undefined) {\r\n    if(typeof(title) === 'string') {\r\n      title = limitSymbols(title, 140);\r\n      title = wrapEmojiText(title);\r\n    }\r\n\r\n    replaceContent(titleEl, title);\r\n  }\r\n\r\n  if(!loadPromises) {\r\n    loadPromises = [];\r\n  }\r\n\r\n  let messageMedia: MessageMedia | WebPage.webPage = message?.media;\r\n  let setMedia = false, isRound = false;\r\n  const mediaChildren = mediaEl ? Array.from(mediaEl.children).slice() : [];\r\n  let middleware: Middleware;\r\n  if(messageMedia && mediaEl) {\r\n    subtitleEl.textContent = '';\r\n    subtitleEl.append(await wrapMessageForReply(message, undefined, undefined, undefined, undefined, true));\r\n\r\n    messageMedia = (messageMedia as MessageMedia.messageMediaWebPage).webpage as WebPage.webPage || messageMedia;\r\n    const photo = (messageMedia as MessageMedia.messageMediaPhoto).photo as Photo.photo;\r\n    const document = (messageMedia as MessageMedia.messageMediaDocument).document as Document.document;\r\n    if(photo || (document && document.thumbs?.length)/* ['video', 'sticker', 'gif', 'round', 'photo', 'audio'].indexOf(document.type) !== -1) */) {\r\n      middleware = appImManager.chat.bubbles.getMiddleware();\r\n      const lazyLoadQueue = appImManager.chat.bubbles.lazyLoadQueue;\r\n\r\n      if(document?.type === 'sticker') {\r\n        await wrapSticker({\r\n          doc: document,\r\n          div: mediaEl,\r\n          lazyLoadQueue,\r\n          group: CHAT_ANIMATION_GROUP,\r\n          // onlyThumb: document.sticker === 2,\r\n          width: MEDIA_SIZE,\r\n          height: MEDIA_SIZE,\r\n          middleware,\r\n          loadPromises\r\n        });\r\n        setMedia = true;\r\n      } else if(document?.type === 'gif' && document.video_thumbs) {\r\n        setMedia = true;\r\n        await wrapVideo({\r\n          doc: document,\r\n          container: mediaEl,\r\n          boxWidth: MEDIA_SIZE,\r\n          boxHeight: MEDIA_SIZE,\r\n          lazyLoadQueue,\r\n          noPlayButton: true,\r\n          noInfo: true,\r\n          middleware,\r\n          loadPromises,\r\n          withoutPreloader: true,\r\n          videoSize: document.video_thumbs[0],\r\n          group: CHAT_ANIMATION_GROUP\r\n        });\r\n      } else {\r\n        const m = photo || document;\r\n        isRound = document?.type === 'round';\r\n\r\n        try {\r\n          await wrapPhoto({\r\n            photo: m,\r\n            container: mediaEl,\r\n            boxWidth: MEDIA_SIZE,\r\n            boxHeight: MEDIA_SIZE,\r\n            size: choosePhotoSize(m, MEDIA_SIZE, MEDIA_SIZE),\r\n            middleware,\r\n            lazyLoadQueue,\r\n            noBlur: true,\r\n            withoutPreloader: true,\r\n            loadPromises\r\n          });\r\n          setMedia = true;\r\n        } catch(err) {\r\n\r\n        }\r\n      }\r\n    }\r\n  } else {\r\n    if(message) {\r\n      subtitleEl.textContent = '';\r\n      subtitleEl.append(await wrapMessageForReply(message));\r\n    } else {\r\n      if(typeof(subtitle) === 'string') {\r\n        subtitle = limitSymbols(subtitle, 140);\r\n        subtitle = wrapEmojiText(subtitle);\r\n      }\r\n\r\n      replaceContent(subtitleEl, subtitle || '');\r\n    }\r\n  }\r\n\r\n  Promise.all(loadPromises).then(() => {\r\n    if(middleware && !middleware()) return;\r\n    mediaChildren.forEach((child) => child.remove());\r\n\r\n    if(mediaEl) {\r\n      mediaEl.classList.toggle('is-round', isRound);\r\n    }\r\n  });\r\n\r\n  return setMedia;\r\n}\r\n\r\nexport default class ReplyContainer extends DivAndCaption<(title: string | HTMLElement | DocumentFragment, subtitle: string | HTMLElement | DocumentFragment, message?: any) => Promise<void>> {\r\n  private mediaEl: HTMLElement;\r\n\r\n  constructor(protected className: string) {\r\n    super(className, async(title, subtitle = '', message?) => {\r\n      if(!this.mediaEl) {\r\n        this.mediaEl = document.createElement('div');\r\n        this.mediaEl.classList.add(this.className + '-media');\r\n      }\r\n\r\n      const isMediaSet = await wrapReplyDivAndCaption({\r\n        title,\r\n        titleEl: this.title,\r\n        subtitle,\r\n        subtitleEl: this.subtitle,\r\n        mediaEl: this.mediaEl,\r\n        message\r\n      });\r\n\r\n      this.container.classList.toggle('is-media', isMediaSet);\r\n      if(isMediaSet) {\r\n        this.content.prepend(this.mediaEl);\r\n      } else {\r\n        this.mediaEl.remove();\r\n      }\r\n    });\r\n  }\r\n}\r\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport type {AppMessagesManager, MessagesStorageKey} from '../../lib/appManagers/appMessagesManager';\nimport type ChatBubbles from './bubbles';\nimport type ChatInput from './input';\nimport type Chat from './chat';\nimport IS_TOUCH_SUPPORTED from '../../environment/touchSupport';\nimport Button from '../button';\nimport ButtonIcon from '../buttonIcon';\nimport CheckboxField from '../checkboxField';\nimport PopupDeleteMessages from '../popups/deleteMessages';\nimport PopupForward from '../popups/forward';\nimport {toast} from '../toast';\nimport SetTransition from '../singleTransition';\nimport ListenerSetter from '../../helpers/listenerSetter';\nimport PopupSendNow from '../popups/sendNow';\nimport appNavigationController, {NavigationItem} from '../appNavigationController';\nimport {IS_MOBILE_SAFARI} from '../../environment/userAgent';\nimport I18n, {i18n, _i18n} from '../../lib/langPack';\nimport findUpClassName from '../../helpers/dom/findUpClassName';\nimport blurActiveElement from '../../helpers/dom/blurActiveElement';\nimport cancelEvent from '../../helpers/dom/cancelEvent';\nimport cancelSelection from '../../helpers/dom/cancelSelection';\nimport getSelectedText from '../../helpers/dom/getSelectedText';\nimport rootScope from '../../lib/rootScope';\nimport replaceContent from '../../helpers/dom/replaceContent';\nimport AppSearchSuper from '../appSearchSuper.';\nimport isInDOM from '../../helpers/dom/isInDOM';\nimport {randomLong} from '../../helpers/random';\nimport {attachClickEvent, AttachClickOptions} from '../../helpers/dom/clickEvent';\nimport findUpAsChild from '../../helpers/dom/findUpAsChild';\nimport EventListenerBase from '../../helpers/eventListenerBase';\nimport safeAssign from '../../helpers/object/safeAssign';\nimport {AppManagers} from '../../lib/appManagers/managers';\nimport {attachContextMenuListener} from '../../helpers/dom/attachContextMenuListener';\nimport filterUnique from '../../helpers/array/filterUnique';\nimport appImManager from '../../lib/appManagers/appImManager';\n\nconst accumulateMapSet = (map: Map<any, Set<number>>) => {\n  return [...map.values()].reduce((acc, v) => acc + v.size, 0);\n};\n\n// const MIN_CLICK_MOVE = 32; // minimum bubble height\n\nclass AppSelection extends EventListenerBase<{\n  toggle: (isSelecting: boolean) => void\n}> {\n  public selectedMids: Map<PeerId, Set<number>> = new Map();\n  public isSelecting = false;\n\n  public selectedText: string;\n\n  protected listenerSetter: ListenerSetter;\n  protected isScheduled: boolean;\n  protected listenElement: HTMLElement;\n\n  protected onToggleSelection: (forwards: boolean, animate: boolean) => void;\n  protected onUpdateContainer: (cantForward: boolean, cantDelete: boolean, cantSend: boolean) => void;\n  protected onCancelSelection: () => void;\n  protected toggleByMid: (peerId: PeerId, mid: number) => void;\n  protected toggleByElement: (bubble: HTMLElement) => void;\n\n  protected navigationType: NavigationItem['type'];\n\n  protected getElementFromTarget: (target: HTMLElement) => HTMLElement;\n  protected verifyTarget: (e: MouseEvent, target: HTMLElement) => boolean;\n  protected verifyMouseMoveTarget: (e: MouseEvent, element: HTMLElement, selecting: boolean) => boolean;\n  protected verifyTouchLongPress: () => boolean;\n  protected targetLookupClassName: string;\n  protected lookupBetweenParentClassName: string;\n  protected lookupBetweenElementsQuery: string;\n\n  protected doNotAnimate: boolean;\n  protected managers: AppManagers;\n\n  constructor(options: {\n    managers: AppManagers,\n    getElementFromTarget: AppSelection['getElementFromTarget'],\n    verifyTarget?: AppSelection['verifyTarget'],\n    verifyMouseMoveTarget?: AppSelection['verifyMouseMoveTarget'],\n    verifyTouchLongPress?: AppSelection['verifyTouchLongPress'],\n    targetLookupClassName: string,\n    lookupBetweenParentClassName: string,\n    lookupBetweenElementsQuery: string,\n    isScheduled?: AppSelection['isScheduled']\n  }) {\n    super(false);\n\n    safeAssign(this, options);\n\n    this.navigationType = 'multiselect-' + randomLong() as any;\n  }\n\n  public attachListeners(listenElement: HTMLElement, listenerSetter: ListenerSetter) {\n    if(this.listenElement) {\n      this.listenerSetter.removeAll();\n    }\n\n    this.listenElement = listenElement;\n    this.listenerSetter = listenerSetter;\n\n    if(!listenElement) {\n      return;\n    }\n\n    if(IS_TOUCH_SUPPORTED) {\n      listenerSetter.add(listenElement)('touchend', () => {\n        if(!this.isSelecting) return;\n        this.selectedText = getSelectedText();\n      });\n\n      attachContextMenuListener(listenElement, (e) => {\n        if(this.isSelecting || (this.verifyTouchLongPress && !this.verifyTouchLongPress())) return;\n\n        // * these two lines will fix instant text selection on iOS Safari\n        document.body.classList.add('no-select'); // * need no-select on body because chat-input transforms in channels\n        listenElement.addEventListener('touchend', (e) => {\n          cancelEvent(e); // ! this one will fix propagation to document loader button, etc\n          document.body.classList.remove('no-select');\n\n          // this.chat.bubbles.onBubblesClick(e);\n        }, {once: true, capture: true});\n\n        cancelSelection();\n        // cancelEvent(e as any);\n        const element = this.getElementFromTarget(e.target as HTMLElement);\n        if(element) {\n          this.toggleByElement(element);\n        }\n      }, listenerSetter);\n\n      return;\n    }\n\n    listenerSetter.add(listenElement)('mousedown', this.onMouseDown);\n  }\n\n  private onMouseDown = (e: MouseEvent) => {\n    // console.log('selection mousedown', e);\n    const element = findUpClassName(e.target, this.targetLookupClassName);\n    if(e.button !== 0) {\n      return;\n    }\n\n    if(this.verifyTarget && !this.verifyTarget(e, element)) {\n      return;\n    }\n\n    const seen: AppSelection['selectedMids'] = new Map();\n    let selecting: boolean;\n\n    /* let good = false;\n    const {x, y} = e; */\n\n    /* const bubbles = appImManager.bubbles;\n    for(const mid in bubbles) {\n      const bubble = bubbles[mid];\n      bubble.addEventListener('mouseover', () => {\n        console.log('mouseover');\n      }, {once: true});\n    } */\n\n    let firstTarget = element;\n\n    const processElement = (element: HTMLElement, checkBetween = true) => {\n      const mid = +element.dataset.mid;\n      if(!mid || !element.dataset.peerId) return;\n      const peerId = element.dataset.peerId.toPeerId();\n\n      if(!isInDOM(firstTarget)) {\n        firstTarget = element;\n      }\n\n      let seenSet = seen.get(peerId);\n      if(!seenSet) {\n        seen.set(peerId, seenSet = new Set());\n      }\n\n      if(seenSet.has(mid)) {\n        return;\n      }\n\n      const isSelected = this.isMidSelected(peerId, mid);\n      if(selecting === undefined) {\n        // bubblesContainer.classList.add('no-select');\n        selecting = !isSelected;\n      }\n\n      seenSet.add(mid);\n\n      if((selecting && !isSelected) || (!selecting && isSelected)) {\n        const seenLength = accumulateMapSet(seen);\n        if(this.toggleByElement && checkBetween) {\n          if(seenLength < 2) {\n            if(findUpAsChild(element, firstTarget)) {\n              firstTarget = element;\n            }\n          }\n\n          const elementsBetween = this.getElementsBetween(firstTarget, element);\n          // console.log(elementsBetween);\n          if(elementsBetween.length) {\n            elementsBetween.forEach((element) => {\n              processElement(element, false);\n            });\n          }\n        }\n\n        if(!this.selectedMids.size) {\n          if(seenLength === 2 && this.toggleByMid) {\n            for(const [peerId, mids] of seen) {\n              for(const mid of mids) {\n                this.toggleByMid(peerId, mid);\n              }\n            }\n          }\n        } else if(this.toggleByElement) {\n          this.toggleByElement(element);\n        }\n      }\n    };\n\n    // const foundTargets: Map<HTMLElement, true> = new Map();\n    let canceledSelection = false;\n    const onMouseMove = (e: MouseEvent) => {\n      if(!canceledSelection) {\n        cancelSelection();\n        canceledSelection = true;\n      }\n      /* if(!good) {\n        if(Math.abs(e.x - x) > MIN_CLICK_MOVE || Math.abs(e.y - y) > MIN_CLICK_MOVE) {\n          good = true;\n        } else {\n          return;\n        }\n      } */\n\n      /* if(foundTargets.has(e.target as HTMLElement)) return;\n      foundTargets.set(e.target as HTMLElement, true); */\n      const element = this.getElementFromTarget(e.target as HTMLElement);\n      if(!element) {\n        // console.error('found no bubble', e);\n        return;\n      }\n\n      if(this.verifyMouseMoveTarget && !this.verifyMouseMoveTarget(e, element, selecting)) {\n        this.listenerSetter.removeManual(this.listenElement, 'mousemove', onMouseMove);\n        this.listenerSetter.removeManual(document, 'mouseup', onMouseUp, documentListenerOptions);\n        return;\n      }\n\n      processElement(element);\n    };\n\n    const onMouseUp = (e: MouseEvent) => {\n      if(seen.size) {\n        attachClickEvent(window, cancelEvent, {capture: true, once: true, passive: false});\n      }\n\n      this.listenerSetter.removeManual(this.listenElement, 'mousemove', onMouseMove);\n      // bubblesContainer.classList.remove('no-select');\n\n      // ! CANCEL USER SELECTION !\n      cancelSelection();\n    };\n\n    const documentListenerOptions = {once: true};\n    this.listenerSetter.add(this.listenElement)('mousemove', onMouseMove);\n    this.listenerSetter.add(document)('mouseup', onMouseUp, documentListenerOptions);\n  };\n\n  private getElementsBetween = (first: HTMLElement, last: HTMLElement) => {\n    if(first === last) {\n      return [];\n    }\n\n    const firstRect = first.getBoundingClientRect();\n    const lastRect = last.getBoundingClientRect();\n    const difference = (firstRect.top - lastRect.top) || (firstRect.left - lastRect.left);\n    const isHigher = difference < 0;\n\n    const parent = findUpClassName(first, this.lookupBetweenParentClassName);\n    if(!parent) {\n      return [];\n    }\n\n    const elements = Array.from(parent.querySelectorAll(this.lookupBetweenElementsQuery)) as HTMLElement[];\n    let firstIndex = elements.indexOf(first);\n    let lastIndex = elements.indexOf(last);\n\n    if(!isHigher) {\n      [lastIndex, firstIndex] = [firstIndex, lastIndex];\n    }\n\n    const slice = elements.slice(firstIndex + 1, lastIndex);\n\n    // console.log('getElementsBetween', first, last, slice, firstIndex, lastIndex, isHigher);\n\n    return slice;\n  };\n\n  protected isElementShouldBeSelected(element: HTMLElement) {\n    return this.isMidSelected(element.dataset.peerId.toPeerId(), +element.dataset.mid);\n  }\n\n  protected appendCheckbox(element: HTMLElement, checkboxField: CheckboxField) {\n    element.prepend(checkboxField.label);\n  }\n\n  public toggleElementCheckbox(element: HTMLElement, show: boolean) {\n    const hasCheckbox = !!this.getCheckboxInputFromElement(element);\n    if(show) {\n      if(hasCheckbox) {\n        return false;\n      }\n\n      const checkboxField = new CheckboxField({\n        name: element.dataset.mid,\n        round: true\n      });\n\n      // * if it is a render of new message\n      if(this.isSelecting) { // ! avoid breaking animation on start\n        if(this.isElementShouldBeSelected(element)) {\n          checkboxField.input.checked = true;\n          element.classList.add('is-selected');\n        }\n      }\n\n      this.appendCheckbox(element, checkboxField);\n    } else if(hasCheckbox) {\n      this.getCheckboxInputFromElement(element).parentElement.remove();\n      SetTransition(element, 'is-selected', false, 200);\n    }\n\n    return true;\n  }\n\n  protected getCheckboxInputFromElement(element: HTMLElement): HTMLInputElement {\n    return element.firstElementChild?.tagName === 'LABEL' &&\n      element.firstElementChild.firstElementChild as HTMLInputElement;\n  }\n\n  protected async updateContainer(forceSelection = false) {\n    const size = this.selectedMids.size;\n    if(!size && !forceSelection) return;\n\n    let cantForward = !size,\n      cantDelete = !size;\n    const cantSend = !size;\n    for(const [peerId, mids] of this.selectedMids) {\n      const storageKey: MessagesStorageKey = `${peerId}_${this.isScheduled ? 'scheduled' : 'history'}`;\n      const r = await this.managers.appMessagesManager.cantForwardDeleteMids(storageKey, Array.from(mids));\n      cantForward = r.cantForward;\n      cantDelete = r.cantDelete;\n\n      if(cantForward && cantDelete) break;\n    }\n\n    this.onUpdateContainer && this.onUpdateContainer(cantForward, cantDelete, cantSend);\n  }\n\n  public toggleSelection(toggleCheckboxes = true, forceSelection = false) {\n    const wasSelecting = this.isSelecting;\n    const size = this.selectedMids.size;\n    this.isSelecting = !!size || forceSelection;\n\n    if(wasSelecting === this.isSelecting) return false;\n\n    this.dispatchEvent('toggle', this.isSelecting);\n\n    // const bubblesContainer = this.bubbles.bubblesContainer;\n    // bubblesContainer.classList.toggle('is-selecting', !!size);\n\n    /* if(bubblesContainer.classList.contains('is-chat-input-hidden')) {\n      const scrollable = this.appImManager.scrollable;\n      if(scrollable.isScrolledDown) {\n        scrollable.scrollTo(scrollable.scrollHeight, 'top', true, true, 200);\n      }\n    } */\n\n    if(!IS_TOUCH_SUPPORTED) {\n      this.listenElement.classList.toggle('no-select', this.isSelecting);\n\n      if(wasSelecting) {\n        // ! CANCEL USER SELECTION !\n        cancelSelection();\n      }\n    }/*  else {\n      if(!wasSelecting) {\n        bubblesContainer.classList.add('no-select');\n        setTimeout(() => {\n          cancelSelection();\n          bubblesContainer.classList.remove('no-select');\n          cancelSelection();\n        }, 100);\n      }\n    } */\n\n    blurActiveElement();\n\n    const forwards = !!size || forceSelection;\n    this.onToggleSelection && this.onToggleSelection(forwards, !this.doNotAnimate);\n\n    if(!IS_MOBILE_SAFARI) {\n      if(forwards) {\n        appNavigationController.pushItem({\n          type: this.navigationType,\n          onPop: () => {\n            this.cancelSelection();\n          }\n        });\n      } else {\n        appNavigationController.removeByType(this.navigationType);\n      }\n    }\n\n    if(forceSelection) {\n      this.updateContainer(forceSelection);\n    }\n\n    return true;\n  }\n\n  public cancelSelection = async(doNotAnimate?: boolean) => {\n    if(doNotAnimate) this.doNotAnimate = true;\n    this.onCancelSelection && await this.onCancelSelection();\n    this.selectedMids.clear();\n    this.toggleSelection();\n    cancelSelection();\n    if(doNotAnimate) this.doNotAnimate = undefined;\n  };\n\n  public cleanup() {\n    this.doNotAnimate = true;\n    this.selectedMids.clear();\n    this.toggleSelection(false);\n    this.doNotAnimate = undefined;\n  }\n\n  protected updateElementSelection(element: HTMLElement, isSelected: boolean) {\n    this.toggleElementCheckbox(element, true);\n    const input = this.getCheckboxInputFromElement(element);\n    input.checked = isSelected;\n\n    this.toggleSelection();\n    this.updateContainer();\n    SetTransition(element, 'is-selected', isSelected, 200);\n  }\n\n  public isMidSelected(peerId: PeerId, mid: number) {\n    const set = this.selectedMids.get(peerId);\n    return set?.has(mid);\n  }\n\n  public length() {\n    return accumulateMapSet(this.selectedMids);\n  }\n\n  protected toggleMid(peerId: PeerId, mid: number, unselect?: boolean) {\n    let set = this.selectedMids.get(peerId);\n    if(unselect || (unselect === undefined && set?.has(mid))) {\n      if(set) {\n        set.delete(mid);\n\n        if(!set.size) {\n          this.selectedMids.delete(peerId);\n        }\n      }\n    } else {\n      // const diff = rootScope.config.forwarded_count_max - this.length() - 1;\n      // if(diff < 0) {\n      //   toast(I18n.format('Chat.Selection.LimitToast', true));\n      //   return false;\n      //   /* const it = this.selectedMids.values();\n      //   do {\n      //     const mid = it.next().value;\n      //     const mounted = this.appImManager.getMountedBubble(mid);\n      //     if(mounted) {\n      //       this.toggleByBubble(mounted.bubble);\n      //     } else {\n      //       const mids = this.appMessagesManager.getMidsByMid(mid);\n      //       for(const mid of mids) {\n      //         this.selectedMids.delete(mid);\n      //       }\n      //     }\n      //   } while(this.selectedMids.size > MAX_SELECTION_LENGTH); */\n      // }\n\n      if(!set) {\n        set = new Set();\n        this.selectedMids.set(peerId, set);\n      }\n\n      set.add(mid);\n    }\n\n    return true;\n  }\n\n  /**\n   * ! Call this method only to handle deleted messages\n   */\n  public deleteSelectedMids(peerId: PeerId, mids: number[]) {\n    const set = this.selectedMids.get(peerId);\n    if(!set) {\n      return;\n    }\n\n    mids.forEach((mid) => {\n      set.delete(mid);\n    });\n\n    if(!set.size) {\n      this.selectedMids.delete(peerId);\n    }\n\n    this.updateContainer();\n    this.toggleSelection();\n  }\n}\n\nexport class SearchSelection extends AppSelection {\n  protected selectionContainer: HTMLElement;\n  protected selectionCountEl: HTMLElement;\n  public selectionForwardBtn: HTMLElement;\n  public selectionDeleteBtn: HTMLElement;\n  public selectionGotoBtn: HTMLElement;\n\n  private isPrivate: boolean;\n\n  constructor(private searchSuper: AppSearchSuper, managers: AppManagers, listenerSetter: ListenerSetter) {\n    super({\n      managers,\n      verifyTarget: (e, target) => !!target && this.isSelecting,\n      getElementFromTarget: (target) => findUpClassName(target, 'search-super-item'),\n      targetLookupClassName: 'search-super-item',\n      lookupBetweenParentClassName: 'tabs-tab',\n      lookupBetweenElementsQuery: '.search-super-item'\n    });\n\n    this.isPrivate = !searchSuper.showSender;\n    this.attachListeners(searchSuper.container, listenerSetter);\n  }\n\n  /* public appendCheckbox(element: HTMLElement, checkboxField: CheckboxField) {\n    checkboxField.label.classList.add('bubble-select-checkbox');\n\n    if(element.classList.contains('document') || element.tagName === 'AUDIO-ELEMENT') {\n      element.querySelector('.document, audio-element').append(checkboxField.label);\n    } else {\n      super.appendCheckbox(bubble, checkboxField);\n    }\n  } */\n\n  public toggleSelection(toggleCheckboxes = true, forceSelection = false) {\n    const ret = super.toggleSelection(toggleCheckboxes, forceSelection);\n\n    if(ret && toggleCheckboxes) {\n      const elements = Array.from(this.searchSuper.tabsContainer.querySelectorAll('.search-super-item')) as HTMLElement[];\n      elements.forEach((element) => {\n        this.toggleElementCheckbox(element, this.isSelecting);\n      });\n    }\n\n    return ret;\n  }\n\n  public toggleByElement = (element: HTMLElement) => {\n    const mid = +element.dataset.mid;\n    const peerId = element.dataset.peerId.toPeerId();\n\n    if(!this.toggleMid(peerId, mid)) {\n      return;\n    }\n\n    this.updateElementSelection(element, this.isMidSelected(peerId, mid));\n  };\n\n  public toggleByMid = (peerId: PeerId, mid: number) => {\n    const element = this.searchSuper.mediaTab.contentTab.querySelector(`.search-super-item[data-peer-id=\"${peerId}\"][data-mid=\"${mid}\"]`) as HTMLElement;\n    this.toggleByElement(element);\n  };\n\n  protected onUpdateContainer = (cantForward: boolean, cantDelete: boolean, cantSend: boolean) => {\n    const length = this.length();\n    replaceContent(this.selectionCountEl, i18n('messages', [length]));\n    this.selectionGotoBtn.classList.toggle('hide', length !== 1);\n    this.selectionForwardBtn.classList.toggle('hide', cantForward);\n    this.selectionDeleteBtn && this.selectionDeleteBtn.classList.toggle('hide', cantDelete);\n  };\n\n  protected onToggleSelection = (forwards: boolean, animate: boolean) => {\n    SetTransition(this.searchSuper.navScrollableContainer, 'is-selecting', forwards, animate ? 200 : 0, () => {\n      if(!this.isSelecting) {\n        this.selectionContainer.remove();\n        this.selectionContainer =\n          this.selectionForwardBtn =\n          this.selectionDeleteBtn =\n          null;\n        this.selectedText = undefined;\n      }\n    });\n\n    SetTransition(this.searchSuper.container, 'is-selecting', forwards, 200);\n\n    if(this.isSelecting) {\n      if(!this.selectionContainer) {\n        const BASE_CLASS = 'search-super-selection';\n        this.selectionContainer = document.createElement('div');\n        this.selectionContainer.classList.add(BASE_CLASS + '-container');\n\n        const btnCancel = ButtonIcon(`close ${BASE_CLASS}-cancel`, {noRipple: true});\n        attachClickEvent(btnCancel, () => this.cancelSelection(), {listenerSetter: this.listenerSetter, once: true});\n\n        this.selectionCountEl = document.createElement('div');\n        this.selectionCountEl.classList.add(BASE_CLASS + '-count');\n\n        this.selectionGotoBtn = ButtonIcon(`message ${BASE_CLASS}-goto`);\n\n        const attachClickOptions: AttachClickOptions = {listenerSetter: this.listenerSetter};\n        attachClickEvent(this.selectionGotoBtn, () => {\n          const peerId = [...this.selectedMids.keys()][0];\n          const mid = [...this.selectedMids.get(peerId)][0];\n          this.cancelSelection();\n\n          appImManager.setInnerPeer({peerId, lastMsgId: mid});\n        }, attachClickOptions);\n\n        this.selectionForwardBtn = ButtonIcon(`forward ${BASE_CLASS}-forward`);\n        attachClickEvent(this.selectionForwardBtn, () => {\n          const obj: {[fromPeerId: PeerId]: number[]} = {};\n          for(const [fromPeerId, mids] of this.selectedMids) {\n            obj[fromPeerId] = Array.from(mids).sort((a, b) => a - b);\n          }\n\n          new PopupForward(obj, () => {\n            this.cancelSelection();\n          });\n        }, attachClickOptions);\n\n        if(this.isPrivate) {\n          this.selectionDeleteBtn = ButtonIcon(`delete danger ${BASE_CLASS}-delete`);\n          attachClickEvent(this.selectionDeleteBtn, () => {\n            const peerId = [...this.selectedMids.keys()][0];\n            new PopupDeleteMessages(peerId, [...this.selectedMids.get(peerId)], 'chat', () => {\n              this.cancelSelection();\n            });\n          }, attachClickOptions);\n        }\n\n        this.selectionContainer.append(...[\n          btnCancel,\n          this.selectionCountEl,\n          this.selectionGotoBtn,\n          this.selectionForwardBtn,\n          this.selectionDeleteBtn\n        ].filter(Boolean));\n\n        const transitionElement = this.selectionContainer;\n        transitionElement.style.opacity = '0';\n        this.searchSuper.navScrollableContainer.append(transitionElement);\n\n        void transitionElement.offsetLeft; // reflow\n        transitionElement.style.opacity = '';\n      }\n    }\n  };\n}\n\nexport default class ChatSelection extends AppSelection {\n  protected selectionInputWrapper: HTMLElement;\n  protected selectionContainer: HTMLElement;\n  protected selectionCountEl: HTMLElement;\n  public selectionSendNowBtn: HTMLElement;\n  public selectionForwardBtn: HTMLElement;\n  public selectionDeleteBtn: HTMLElement;\n  private selectionLeft: HTMLDivElement;\n  private selectionRight: HTMLDivElement;\n\n  constructor(\n    private chat: Chat,\n    private bubbles: ChatBubbles,\n    private input: ChatInput,\n    managers: AppManagers\n  ) {\n    super({\n      managers,\n      getElementFromTarget: (target) => findUpClassName(target, 'grouped-item') || findUpClassName(target, 'bubble'),\n      verifyTarget: (e, target) => {\n        // LEFT BUTTON\n        //     ,      target  .bubble\n        const bad = !this.selectedMids.size &&\n          !(e.target as HTMLElement).classList.contains('bubble') &&\n          !(e.target as HTMLElement).classList.contains('document-selection') &&\n          target;\n\n        return !bad;\n      },\n      verifyMouseMoveTarget: (e, element, selecting) => {\n        const bad = e.target !== element &&\n          !(e.target as HTMLElement).classList.contains('document-selection') &&\n          selecting === undefined &&\n          !this.selectedMids.size;\n        return !bad;\n      },\n      verifyTouchLongPress: () => !this.chat.input.recording,\n      targetLookupClassName: 'bubble',\n      lookupBetweenParentClassName: 'bubbles-inner',\n      lookupBetweenElementsQuery: '.bubble:not(.is-multiple-documents), .grouped-item',\n      isScheduled: chat.type === 'scheduled'\n    });\n  }\n\n  public appendCheckbox(bubble: HTMLElement, checkboxField: CheckboxField) {\n    checkboxField.label.classList.add('bubble-select-checkbox');\n\n    if(bubble.classList.contains('document-container')) {\n      bubble.querySelector('.document, audio-element').append(checkboxField.label);\n    } else {\n      super.appendCheckbox(bubble, checkboxField);\n    }\n  }\n\n  public toggleSelection(toggleCheckboxes = true, forceSelection = false) {\n    const ret = super.toggleSelection(toggleCheckboxes, forceSelection);\n\n    if(ret && toggleCheckboxes) {\n      for(const mid in this.bubbles.bubbles) {\n        if(this.bubbles.skippedMids.has(+mid)) {\n          continue;\n        }\n\n        const bubble = this.bubbles.bubbles[mid];\n        this.toggleElementCheckbox(bubble, this.isSelecting);\n      }\n    }\n\n    return ret;\n  }\n\n  public toggleElementCheckbox(bubble: HTMLElement, show: boolean) {\n    if(!this.canSelectBubble(bubble)) return;\n\n    const ret = super.toggleElementCheckbox(bubble, show);\n    if(ret) {\n      const isGrouped = bubble.classList.contains('is-grouped');\n      if(isGrouped) {\n        this.bubbles.getBubbleGroupedItems(bubble).forEach((item) => this.toggleElementCheckbox(item, show));\n      }\n    }\n\n    return ret;\n  }\n\n  public toggleByElement = (bubble: HTMLElement): Promise<void> => {\n    if(!this.canSelectBubble(bubble)) return;\n\n    const mid = +bubble.dataset.mid;\n\n    const isGrouped = bubble.classList.contains('is-grouped');\n    if(isGrouped) {\n      if(!this.isGroupedBubbleSelected(bubble)) {\n        const set = this.selectedMids.get(this.chat.peerId);\n        if(set) {\n          // const mids = await this.chat.getMidsByMid(mid);\n          const mids = this.getMidsFromGroupContainer(bubble);\n          mids.forEach((mid) => set.delete(mid));\n        }\n      }\n\n      /* const promises =  */this.bubbles.getBubbleGroupedItems(bubble).map(this.toggleByElement);\n      // await Promise.all(promises);\n      return;\n    }\n\n    if(!this.toggleMid(this.chat.peerId, mid)) {\n      return;\n    }\n\n    const isGroupedItem = bubble.classList.contains('grouped-item');\n    if(isGroupedItem) {\n      const groupContainer = findUpClassName(bubble, 'bubble');\n      const isGroupedSelected = this.isGroupedBubbleSelected(groupContainer);\n      const isGroupedMidsSelected = this.isGroupedMidsSelected(groupContainer);\n\n      const willChange = isGroupedMidsSelected || isGroupedSelected;\n      if(willChange) {\n        this.updateElementSelection(groupContainer, isGroupedMidsSelected);\n      }\n    }\n\n    this.updateElementSelection(bubble, this.isMidSelected(this.chat.peerId, mid));\n  };\n\n  protected toggleByMid = async(peerId: PeerId, mid: number) => {\n    const mounted = await this.bubbles.getMountedBubble(mid);\n    if(mounted) {\n      this.toggleByElement(mounted.bubble);\n    }\n  };\n\n  public isElementShouldBeSelected(element: HTMLElement) {\n    const isGrouped = element.classList.contains('is-grouped');\n    return super.isElementShouldBeSelected(element) && (!isGrouped || this.isGroupedMidsSelected(element));\n  }\n\n  protected isGroupedBubbleSelected(bubble: HTMLElement) {\n    const groupedCheckboxInput = this.getCheckboxInputFromElement(bubble);\n    return groupedCheckboxInput?.checked;\n  }\n\n  protected getMidsFromGroupContainer(groupContainer: HTMLElement) {\n    const elements = this.chat.bubbles.getBubbleGroupedItems(groupContainer);\n    if(!elements.length) {\n      elements.push(groupContainer);\n    }\n\n    return elements.map((element) => +element.dataset.mid);\n  }\n\n  protected isGroupedMidsSelected(groupContainer: HTMLElement) {\n    const mids = this.getMidsFromGroupContainer(groupContainer);\n    const selectedMids = mids.filter((mid) => this.isMidSelected(this.chat.peerId, mid));\n    return mids.length === selectedMids.length;\n  }\n\n  protected getCheckboxInputFromElement(bubble: HTMLElement) {\n    /* let perf = performance.now();\n    let checkbox = bubble.firstElementChild.tagName === 'LABEL' && bubble.firstElementChild.firstElementChild as HTMLInputElement;\n    console.log('getCheckboxInputFromBubble firstElementChild time:', performance.now() - perf);\n\n    perf = performance.now();\n    checkbox = bubble.querySelector('label input');\n    console.log('getCheckboxInputFromBubble querySelector time:', performance.now() - perf); */\n    /* let perf = performance.now();\n    let contains = bubble.classList.contains('document-container');\n    console.log('getCheckboxInputFromBubble classList time:', performance.now() - perf);\n\n    perf = performance.now();\n    contains = bubble.className.includes('document-container');\n    console.log('getCheckboxInputFromBubble className time:', performance.now() - perf); */\n\n    return bubble.classList.contains('document-container') ?\n      bubble.querySelector('label input') as HTMLInputElement :\n      super.getCheckboxInputFromElement(bubble);\n  }\n\n  public canSelectBubble(bubble: HTMLElement) {\n    return !bubble.classList.contains('service') &&\n      !bubble.classList.contains('is-outgoing') &&\n      !bubble.classList.contains('is-error') &&\n      !bubble.classList.contains('bubble-first') &&\n      !bubble.classList.contains('avoid-selection');\n  }\n\n  protected onToggleSelection = async(forwards: boolean, animate: boolean) => {\n    const {needTranslateX, widthFrom, widthTo} = await this.chat.input.center(animate);\n\n    SetTransition(this.listenElement, 'is-selecting', forwards, animate ? 200 : 0, () => {\n      if(!this.isSelecting) {\n        this.selectionInputWrapper.remove();\n        this.selectionInputWrapper =\n          this.selectionContainer =\n          this.selectionSendNowBtn =\n          this.selectionForwardBtn =\n          this.selectionDeleteBtn =\n          this.selectionLeft =\n          this.selectionRight =\n          null;\n        this.selectedText = undefined;\n      }\n\n      /* fastRaf(() => {\n        this.bubbles.onScroll();\n      }); */\n    });\n\n    // const chatInput = this.appImManager.chatInput;\n\n    const translateButtonsX = widthFrom < widthTo ? undefined : needTranslateX * 2;\n    if(this.isSelecting) {\n      if(!this.selectionContainer) {\n        this.selectionInputWrapper = document.createElement('div');\n        this.selectionInputWrapper.classList.add('chat-input-wrapper', 'selection-wrapper');\n\n        // const background = document.createElement('div');\n        // background.classList.add('chat-input-wrapper-background');\n\n        this.selectionContainer = document.createElement('div');\n        this.selectionContainer.classList.add('selection-container');\n\n        const attachClickOptions: AttachClickOptions = {listenerSetter: this.listenerSetter};\n        const btnCancel = ButtonIcon('close', {noRipple: true});\n        attachClickEvent(btnCancel, () => this.cancelSelection(), {once: true, listenerSetter: this.listenerSetter});\n\n        this.selectionCountEl = document.createElement('div');\n        this.selectionCountEl.classList.add('selection-container-count');\n\n        if(this.chat.type === 'scheduled') {\n          this.selectionSendNowBtn = Button('btn-primary btn-transparent btn-short text-bold selection-container-send', {icon: 'send2'});\n          this.selectionSendNowBtn.append(i18n('MessageScheduleSend'));\n          attachClickEvent(this.selectionSendNowBtn, () => {\n            new PopupSendNow(this.chat.peerId, [...this.selectedMids.get(this.chat.peerId)], () => {\n              this.cancelSelection();\n            });\n          }, attachClickOptions);\n        } else {\n          this.selectionForwardBtn = Button('btn-primary btn-transparent text-bold selection-container-forward', {icon: 'forward'});\n          this.selectionForwardBtn.append(i18n('Forward'));\n          attachClickEvent(this.selectionForwardBtn, () => {\n            const obj: {[fromPeerId: PeerId]: number[]} = {};\n            for(const [fromPeerId, mids] of this.selectedMids) {\n              obj[fromPeerId] = Array.from(mids).sort((a, b) => a - b);\n            }\n\n            new PopupForward(obj, () => {\n              this.cancelSelection();\n            });\n          }, attachClickOptions);\n        }\n\n        this.selectionDeleteBtn = Button('btn-primary btn-transparent danger text-bold selection-container-delete', {icon: 'delete'});\n        this.selectionDeleteBtn.append(i18n('Delete'));\n        attachClickEvent(this.selectionDeleteBtn, () => {\n          new PopupDeleteMessages(this.chat.peerId, [...this.selectedMids.get(this.chat.peerId)], this.chat.type, () => {\n            this.cancelSelection();\n          });\n        }, attachClickOptions);\n\n        const left = this.selectionLeft = document.createElement('div');\n        left.classList.add('selection-container-left');\n        left.append(btnCancel, this.selectionCountEl);\n\n        const right = this.selectionRight = document.createElement('div');\n        right.classList.add('selection-container-right');\n        right.append(...[\n          this.selectionSendNowBtn,\n          this.selectionForwardBtn,\n          this.selectionDeleteBtn\n        ].filter(Boolean))\n\n        if(translateButtonsX !== undefined) {\n          left.style.transform = `translateX(${-translateButtonsX}px)`;\n          right.style.transform = `translateX(${translateButtonsX}px)`;\n        }\n\n        this.selectionContainer.append(left, right);\n\n        // background.style.opacity = '0';\n        this.selectionInputWrapper.style.opacity = '0';\n        this.selectionInputWrapper.append(/* background,  */this.selectionContainer);\n        this.input.inputContainer.append(this.selectionInputWrapper);\n\n        void this.selectionInputWrapper.offsetLeft; // reflow\n        // background.style.opacity = '';\n        this.selectionInputWrapper.style.opacity = '';\n        left.style.transform = '';\n        right.style.transform = '';\n      }\n    } else if(this.selectionLeft && translateButtonsX !== undefined) {\n      this.selectionLeft.style.transform = `translateX(-${translateButtonsX}px)`;\n      this.selectionRight.style.transform = `translateX(${translateButtonsX}px)`;\n    }\n  };\n\n  protected onUpdateContainer = (cantForward: boolean, cantDelete: boolean, cantSend: boolean) => {\n    replaceContent(this.selectionCountEl, i18n('messages', [this.length()]));\n    this.selectionSendNowBtn && this.selectionSendNowBtn.toggleAttribute('disabled', cantSend);\n    this.selectionForwardBtn && this.selectionForwardBtn.toggleAttribute('disabled', cantForward);\n    this.selectionDeleteBtn.toggleAttribute('disabled', cantDelete);\n  };\n\n  protected onCancelSelection = async() => {\n    return;\n    const promises: Promise<HTMLElement>[] = [];\n    for(const [peerId, mids] of this.selectedMids) {\n      for(const mid of mids) {\n        promises.push(this.bubbles.getMountedBubble(mid).then((m) => m?.bubble));\n      }\n    }\n\n    const bubbles = filterUnique((await Promise.all(promises)).filter(Boolean));\n    bubbles.forEach((bubble) => {\n      this.toggleByElement(bubble);\n    });\n  };\n}\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nexport default function getSelectedText(): string {\r\n  if(window.getSelection) {\r\n    return window.getSelection().toString();\r\n    // @ts-ignore\r\n  } else if(document.selection) {\r\n    // @ts-ignore\r\n    return document.selection.createRange().text;\r\n  }\r\n\r\n  return '';\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport type ListenerSetter from '../helpers/listenerSetter';\r\nimport ripple from './ripple';\r\nimport {LangPackKey, _i18n} from '../lib/langPack';\r\nimport getDeepProperty from '../helpers/object/getDeepProperty';\r\nimport rootScope from '../lib/rootScope';\r\nimport apiManagerProxy from '../lib/mtproto/mtprotoworker';\r\n\r\nexport type CheckboxFieldOptions = {\r\n  text?: LangPackKey,\r\n  textArgs?: any[],\r\n  name?: string,\r\n  round?: boolean,\r\n  toggle?: boolean,\r\n  stateKey?: string,\r\n  stateValues?: any[],\r\n  disabled?: boolean,\r\n  checked?: boolean,\r\n  restriction?: boolean,\r\n  withRipple?: boolean,\r\n  withHover?: boolean,\r\n  listenerSetter?: ListenerSetter\r\n};\r\nexport default class CheckboxField {\r\n  public input: HTMLInputElement;\r\n  public label: HTMLLabelElement;\r\n  public span: HTMLSpanElement;\r\n\r\n  constructor(options: CheckboxFieldOptions = {}) {\r\n    const label = this.label = document.createElement('label');\r\n    label.classList.add('checkbox-field');\r\n\r\n    if(options.restriction) {\r\n      label.classList.add('checkbox-field-restriction');\r\n    }\r\n\r\n    if(options.round) {\r\n      label.classList.add('checkbox-field-round');\r\n    }\r\n\r\n    if(options.disabled) {\r\n      this.toggleDisability(true);\r\n    }\r\n\r\n    const input = this.input = document.createElement('input');\r\n    input.classList.add('checkbox-field-input');\r\n    input.type = 'checkbox';\r\n    if(options.name) {\r\n      input.id = 'input-' + options.name;\r\n    }\r\n\r\n    if(options.checked) {\r\n      input.checked = true;\r\n    }\r\n\r\n    if(options.stateKey) {\r\n      let loaded = false;\r\n      const onChange = () => {\r\n        if(!loaded) {\r\n          return;\r\n        }\r\n\r\n        let value: any;\r\n        if(options.stateValues) {\r\n          value = options.stateValues[input.checked ? 1 : 0];\r\n        } else {\r\n          value = input.checked;\r\n        }\r\n\r\n        rootScope.managers.appStateManager.setByKey(options.stateKey, value);\r\n      };\r\n\r\n      apiManagerProxy.getState().then((state) => {\r\n        loaded = true;\r\n        const stateValue = getDeepProperty(state, options.stateKey);\r\n        let checked: boolean;\r\n        if(options.stateValues) {\r\n          checked = options.stateValues.indexOf(stateValue) === 1;\r\n        } else {\r\n          checked = stateValue;\r\n        }\r\n\r\n        this.setValueSilently(checked);\r\n      });\r\n\r\n      if(options.listenerSetter) options.listenerSetter.add(input)('change', onChange);\r\n      else input.addEventListener('change', onChange);\r\n    }\r\n\r\n    let span: HTMLSpanElement;\r\n    if(options.text) {\r\n      span = this.span = document.createElement('span');\r\n      span.classList.add('checkbox-caption');\r\n      _i18n(span, options.text, options.textArgs);\r\n    } else {\r\n      label.classList.add('checkbox-without-caption');\r\n    }\r\n\r\n    label.append(input);\r\n\r\n    if(options.toggle) {\r\n      label.classList.add('checkbox-field-toggle');\r\n\r\n      const toggle = document.createElement('div');\r\n      toggle.classList.add('checkbox-toggle');\r\n      label.append(toggle);\r\n    } else {\r\n      const box = document.createElement('div');\r\n      box.classList.add('checkbox-box');\r\n\r\n      const checkSvg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');\r\n      checkSvg.classList.add('checkbox-box-check');\r\n      checkSvg.setAttributeNS(null, 'viewBox', '0 0 24 24');\r\n      const use = document.createElementNS('http://www.w3.org/2000/svg', 'use');\r\n      use.setAttributeNS(null, 'href', '#check');\r\n      use.setAttributeNS(null, 'x', '-1');\r\n      checkSvg.append(use);\r\n\r\n      const bg = document.createElement('div');\r\n      bg.classList.add('checkbox-box-background');\r\n\r\n      const border = document.createElement('div');\r\n      border.classList.add('checkbox-box-border');\r\n\r\n      box.append(border, bg, checkSvg);\r\n\r\n      label.append(box);\r\n    }\r\n\r\n    if(span) {\r\n      label.append(span);\r\n    }\r\n\r\n    if(options.withRipple) {\r\n      label.classList.add('checkbox-ripple', 'hover-effect');\r\n      ripple(label, undefined, undefined, true);\r\n      // label.prepend(input);\r\n    } else if(options.withHover) {\r\n      label.classList.add('hover-effect');\r\n    }\r\n  }\r\n\r\n  get checked() {\r\n    return this.input.checked;\r\n  }\r\n\r\n  set checked(checked: boolean) {\r\n    /* if(this.checked === checked) {\r\n      return;\r\n    } */\r\n\r\n    this.setValueSilently(checked);\r\n\r\n    const event = new Event('change', {bubbles: true, cancelable: true});\r\n    this.input.dispatchEvent(event);\r\n  }\r\n\r\n  public setValueSilently(checked: boolean) {\r\n    this.input.checked = checked;\r\n  }\r\n\r\n  public toggleDisability(disable: boolean) {\r\n    this.label.classList.toggle('checkbox-disabled', disable);\r\n    return () => this.toggleDisability(!disable);\r\n  }\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport InputField, {InputFieldOptions} from './inputField';\r\n\r\nexport default class CodeInputField extends InputField {\r\n  constructor(options: InputFieldOptions & {\r\n    length: number,\r\n    onFill: (code: string) => void\r\n  }) {\r\n    super({\r\n      plainText: true,\r\n      ...options\r\n    });\r\n\r\n    const input = this.input as HTMLInputElement;\r\n    input.type = 'tel';\r\n    input.setAttribute('required', '');\r\n    input.autocomplete = 'off';\r\n\r\n    let lastLength = 0;\r\n    this.input.addEventListener('input', (e) => {\r\n      this.input.classList.remove('error');\r\n      this.setLabel();\r\n\r\n      const value = this.value.replace(/\\D/g, '').slice(0, options.length);\r\n      this.setValueSilently(value);\r\n\r\n      const length = this.value.length;\r\n      if(length === options.length) { // submit code\r\n        options.onFill(this.value);\r\n      } else if(length === lastLength) {\r\n        return;\r\n      }\r\n\r\n      lastLength = length;\r\n    });\r\n  }\r\n}\r\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport {addCancelButton} from './popups';\nimport PopupPeer, {PopupPeerOptions} from './popups/peer';\n\n// type PopupConfirmationOptions = Pick<PopupPeerOptions, 'titleLangKey'>;\nexport type PopupConfirmationOptions = PopupPeerOptions & {\n  button: PopupPeerOptions['buttons'][0],\n  checkbox?: PopupPeerOptions['checkboxes'][0]\n};\n\nexport default function confirmationPopup(options: PopupConfirmationOptions) {\n  return new Promise<boolean | void>((resolve, reject) => {\n    const {button, checkbox} = options;\n    button.callback = (set) => {\n      resolve(set ? !!set.size : undefined);\n    };\n\n    const buttons = addCancelButton(options.buttons || [button]);\n    const cancelButton = buttons.find((button) => button.isCancel);\n    cancelButton.callback = () => {\n      reject();\n    };\n\n    options.buttons = buttons;\n    options.checkboxes ??= checkbox && [checkbox];\n\n    new PopupPeer('popup-confirmation', options).show();\n  });\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport IS_EMOJI_SUPPORTED from '../environment/emojiSupport';\nimport cancelEvent from '../helpers/dom/cancelEvent';\nimport simulateEvent from '../helpers/dom/dispatchEvent';\nimport findUpClassName from '../helpers/dom/findUpClassName';\nimport findUpTag from '../helpers/dom/findUpTag';\nimport replaceContent from '../helpers/dom/replaceContent';\nimport setInnerHTML from '../helpers/dom/setInnerHTML';\nimport fastSmoothScroll from '../helpers/fastSmoothScroll';\nimport {randomLong} from '../helpers/random';\nimport {HelpCountry, HelpCountryCode} from '../layer';\nimport I18n, {i18n} from '../lib/langPack';\nimport wrapEmojiText from '../lib/richTextProcessor/wrapEmojiText';\nimport rootScope from '../lib/rootScope';\nimport {getCountryEmoji} from '../vendor/emoji';\nimport InputField, {InputFieldOptions} from './inputField';\nimport Scrollable from './scrollable';\n\nlet countries: HelpCountry.helpCountry[];\nconst setCountries = () => {\n  countries = I18n.countriesList\n  .filter((country) => !country.pFlags?.hidden)\n  .sort((a, b) => (a.name || a.default_name).localeCompare(b.name || b.default_name));\n};\n\nlet init = () => {\n  setCountries();\n  rootScope.addEventListener('language_change', () => {\n    setCountries();\n  });\n};\n\nexport default class CountryInputField extends InputField {\n  private lastCountrySelected: HelpCountry;\n  private lastCountryCodeSelected: HelpCountryCode;\n\n  private hideTimeout: number;\n  private selectWrapper: HTMLElement;\n\n  private liMap: Map<string, HTMLLIElement[]>;\n\n  constructor(public options: InputFieldOptions & {\n    onCountryChange?: (country: HelpCountry.helpCountry, code: HelpCountryCode.helpCountryCode) => void,\n    noPhoneCodes?: boolean\n  } = {}) {\n    super({\n      label: 'Country',\n      name: randomLong(),\n      ...options\n    });\n\n    if(init) {\n      init();\n      init = undefined;\n    }\n\n    this.liMap = new Map();\n\n    this.container.classList.add('input-select');\n\n    const selectWrapper = this.selectWrapper = document.createElement('div');\n    selectWrapper.classList.add('select-wrapper', 'z-depth-3', 'hide');\n\n    const arrowDown = document.createElement('span');\n    arrowDown.classList.add('arrow', 'arrow-down');\n    this.container.append(arrowDown);\n\n    const selectList = document.createElement('ul');\n    selectWrapper.appendChild(selectList);\n\n    const scroll = new Scrollable(selectWrapper);\n\n    let initSelect = () => {\n      initSelect = null;\n\n      countries.forEach((c) => {\n        const emoji = getCountryEmoji(c.iso2);\n\n        const liArr: Array<HTMLLIElement> = [];\n        for(let i = 0, length = Math.min(c.country_codes.length, options.noPhoneCodes ? 1 : Infinity); i < length; ++i) {\n          const countryCode = c.country_codes[i];\n          const li = document.createElement('li');\n\n          const wrapped = wrapEmojiText(emoji);\n          if(IS_EMOJI_SUPPORTED) {\n            const spanEmoji = document.createElement('span');\n            setInnerHTML(spanEmoji, wrapped);\n            li.append(spanEmoji);\n          } else {\n            setInnerHTML(li, wrapped);\n          }\n\n          const el = i18n(c.default_name as any);\n          el.dataset.defaultName = c.default_name;\n          li.append(el);\n\n          if(!options.noPhoneCodes) {\n            const span = document.createElement('span');\n            span.classList.add('phone-code');\n            span.innerText = '+' + countryCode.country_code;\n            li.appendChild(span);\n          }\n\n          liArr.push(li);\n          selectList.append(li);\n        }\n\n        this.liMap.set(c.iso2, liArr);\n      });\n\n      selectList.addEventListener('mousedown', (e) => {\n        if(e.button !== 0) { // other buttons but left shall not pass\n          return;\n        }\n\n        const target = findUpTag(e.target, 'LI')\n        this.selectCountryByTarget(target);\n        // console.log('clicked', e, countryName, phoneCode);\n      });\n\n      this.container.appendChild(selectWrapper);\n    };\n\n    initSelect();\n\n    this.input.addEventListener('focus', (e) => {\n      if(initSelect) {\n        initSelect();\n      } else {\n        countries.forEach((c) => {\n          this.liMap.get(c.iso2).forEach((li) => li.style.display = '');\n        });\n      }\n\n      clearTimeout(this.hideTimeout);\n      this.hideTimeout = undefined;\n\n      selectWrapper.classList.remove('hide');\n      void selectWrapper.offsetWidth; // reflow\n      selectWrapper.classList.add('active');\n\n      this.select();\n\n      fastSmoothScroll({\n        // container: page.pageEl.parentElement.parentElement,\n        container: findUpClassName(this.container, 'scrollable-y'),\n        element: this.input,\n        position: 'start',\n        margin: 4\n      });\n\n      setTimeout(() => {\n        if(!mouseDownHandlerAttached) {\n          document.addEventListener('mousedown', onMouseDown, {capture: true});\n          mouseDownHandlerAttached = true;\n        }\n      }, 0);\n    });\n\n    let mouseDownHandlerAttached = false;\n    const onMouseDown = (e: MouseEvent) => {\n      if(findUpClassName(e.target, 'input-select')) {\n        return;\n      }\n      if(e.target === this.input) {\n        return;\n      }\n\n      this.hidePicker();\n      document.removeEventListener('mousedown', onMouseDown, {capture: true});\n      mouseDownHandlerAttached = false;\n    };\n\n    /* false && this.input.addEventListener('blur', function(this: typeof this.input, e) {\n      hidePicker();\n\n      e.cancelBubble = true;\n    }, {capture: true}); */\n\n    const onKeyPress = (e: KeyboardEvent) => {\n      const key = e.key;\n      if(e.ctrlKey || key === 'Control') return false;\n\n      // let i = new RegExp('^' + this.value, 'i');\n      const _value = this.value.toLowerCase();\n      const matches: HelpCountry[] = [];\n      countries.forEach((c) => {\n        const names = [\n          c.name,\n          c.default_name,\n          c.iso2\n        ];\n\n        names.filter(Boolean).forEach((name) => {\n          const abbr = name.split(' ').filter((word) => /\\w/.test(word)).map((word) => word[0]).join('');\n          if(abbr.length > 1) {\n            names.push(abbr);\n          }\n        });\n\n        const good = !!names.filter(Boolean).find((str) => str.toLowerCase().indexOf(_value) !== -1)/*  === 0 */;// i.test(c.name);\n\n        this.liMap.get(c.iso2).forEach((li) => li.style.display = good ? '' : 'none');\n        if(good) matches.push(c);\n      });\n\n      //           \n      /* if(matches.length === 1 && matches[0].li.length === 1) {\n        if(matches[0].name === lastCountrySelected) return false;\n        //console.log('clicking', matches[0]);\n\n        var clickEvent = document.createEvent('MouseEvents');\n        clickEvent.initEvent('mousedown', true, true);\n        matches[0].li[0].dispatchEvent(clickEvent);\n        return false;\n      } else  */if(matches.length === 0) {\n        countries.forEach((c) => {\n          this.liMap.get(c.iso2).forEach((li) => li.style.display = '');\n        });\n      } else if(matches.length === 1 && key === 'Enter') {\n        cancelEvent(e);\n        this.selectCountryByTarget(this.liMap.get(matches[0].iso2)[0]);\n      }\n    };\n\n    this.input.addEventListener('keyup', onKeyPress);\n    this.input.addEventListener('keydown', (e) => {\n      if(e.key === 'Enter') {\n        onKeyPress(e);\n      }\n    });\n\n    arrowDown.addEventListener('mousedown', (e) => {\n      if(this.input.matches(':focus')) {\n        this.hidePicker();\n        this.input.blur();\n      } else {\n        e.cancelBubble = true;\n        e.preventDefault();\n        this.input.focus();\n      }\n    });\n  }\n\n  public getSelected() {\n    return {country: this.lastCountrySelected, code: this.lastCountryCodeSelected};\n  }\n\n  public hidePicker = () => {\n    if(this.hideTimeout !== undefined) return;\n    this.selectWrapper.classList.remove('active');\n    this.hideTimeout = window.setTimeout(() => {\n      this.selectWrapper.classList.add('hide');\n      this.hideTimeout = undefined;\n    }, 200);\n  }\n\n  public selectCountryByTarget = (target: HTMLElement) => {\n    const defaultName = target.querySelector<HTMLElement>('[data-default-name]').dataset.defaultName;\n    const phoneCodeEl = target.querySelector<HTMLElement>('.phone-code');\n    const phoneCode = phoneCodeEl?.innerText;\n    const countryCode = phoneCode && phoneCode.replace(/\\D/g, '');\n\n    replaceContent(this.input, i18n(defaultName as any));\n    simulateEvent(this.input, 'input');\n    this.lastCountrySelected = countries.find((c) => c.default_name === defaultName);\n    this.lastCountryCodeSelected = countryCode && this.lastCountrySelected.country_codes.find((_countryCode) => _countryCode.country_code === countryCode);\n\n    this.options.onCountryChange?.(this.lastCountrySelected, this.lastCountryCodeSelected);\n    this.hidePicker();\n  }\n\n  public selectCountryByIso2(iso2: string) {\n    this.selectCountryByTarget(this.liMap.get(iso2)[0]);\n  }\n\n  public override(country: HelpCountry, code: HelpCountryCode, countryName?: string) {\n    replaceContent(this.input, country ? i18n(country.default_name as any) : countryName);\n    this.lastCountrySelected = country;\n    this.lastCountryCodeSelected = code;\n    this.options.onCountryChange?.(this.lastCountrySelected, this.lastCountryCodeSelected);\n  }\n}\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nexport default class DivAndCaption<T> {\r\n  public container: HTMLElement;\r\n  public border: HTMLElement;\r\n  public content: HTMLElement;\r\n  public title: HTMLElement;\r\n  public subtitle: HTMLElement;\r\n\r\n  constructor(protected className: string, public fill?: T) {\r\n    this.container = document.createElement('div');\r\n    this.container.className = className;\r\n\r\n    this.border = document.createElement('div');\r\n    this.border.classList.add(className + '-border');\r\n\r\n    this.content = document.createElement('div');\r\n    this.content.classList.add(className + '-content');\r\n\r\n    this.title = document.createElement('div');\r\n    this.title.classList.add(className + '-title');\r\n    this.title.setAttribute('dir', 'auto');\r\n\r\n    this.subtitle = document.createElement('div');\r\n    this.subtitle.classList.add(className + '-subtitle');\r\n    this.subtitle.setAttribute('dir', 'auto');\r\n\r\n    this.content.append(this.title, this.subtitle);\r\n    this.container.append(this.border, this.content);\r\n  }\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport {InputFile} from '../layer';\r\nimport AvatarEdit from './avatarEdit';\r\nimport AvatarElement from './avatar';\r\nimport InputField from './inputField';\r\nimport ListenerSetter from '../helpers/listenerSetter';\r\nimport ButtonCorner from './buttonCorner';\r\nimport safeAssign from '../helpers/object/safeAssign';\r\n\r\nexport default class EditPeer {\r\n  public nextBtn: HTMLButtonElement;\r\n\r\n  public uploadAvatar: () => Promise<InputFile>;\r\n  public avatarEdit: AvatarEdit;\r\n  public avatarElem: AvatarElement;\r\n\r\n  private inputFields: InputField[];\r\n  private listenerSetter: ListenerSetter;\r\n\r\n  private peerId: PeerId;\r\n\r\n  private _disabled = false;\r\n  private avatarSize = 120;\r\n\r\n  constructor(options: {\r\n    peerId?: EditPeer['peerId'],\r\n    inputFields: EditPeer['inputFields'],\r\n    listenerSetter: ListenerSetter,\r\n    doNotEditAvatar?: boolean,\r\n    withoutAvatar?: boolean,\r\n    nextBtn?: HTMLButtonElement,\r\n    avatarSize?: number\r\n  }) {\r\n    safeAssign(this, options);\r\n\r\n    if(!this.nextBtn) {\r\n      this.nextBtn = ButtonCorner({icon: 'check'});\r\n    } else if(!this.nextBtn.classList.contains('btn-corner')) {\r\n      this.handleChange = () => {\r\n        this.nextBtn.toggleAttribute('disabled', !this.isChanged() || this.disabled);\r\n      };\r\n    }\r\n\r\n    if(!options.withoutAvatar) {\r\n      this.avatarElem = document.createElement('avatar-element') as AvatarElement;\r\n      this.avatarElem.classList.add('avatar-placeholder', 'avatar-' + this.avatarSize);\r\n      this.avatarElem.updateWithOptions({peerId: this.peerId});\r\n\r\n      if(!options.doNotEditAvatar) {\r\n        this.avatarEdit = new AvatarEdit((_upload) => {\r\n          this.uploadAvatar = _upload;\r\n          this.handleChange();\r\n          this.avatarElem.remove();\r\n        });\r\n\r\n        this.avatarEdit.container.append(this.avatarElem);\r\n      }\r\n    }\r\n\r\n    this.inputFields.forEach((inputField) => {\r\n      this.listenerSetter.add(inputField.input)('input', this.handleChange);\r\n    });\r\n\r\n    this.handleChange();\r\n  }\r\n\r\n  public get disabled() {\r\n    return this._disabled;\r\n  }\r\n\r\n  public set disabled(value) {\r\n    this._disabled = value;\r\n    this.inputFields.forEach((inputField) => inputField.input.toggleAttribute('disabled', value));\r\n    this.handleChange();\r\n  }\r\n\r\n  public lockWithPromise(promise: Promise<any>, unlockOnSuccess = false) {\r\n    this.disabled = true;\r\n    promise.then(() => {\r\n      if(unlockOnSuccess) {\r\n        this.disabled = false;\r\n      }\r\n    }, () => {\r\n      this.disabled = false;\r\n    });\r\n  }\r\n\r\n  public isChanged = () => {\r\n    if(this.uploadAvatar) {\r\n      return true;\r\n    }\r\n\r\n    let changedLength = 0, requiredLength = 0, requiredValidLength = 0;\r\n    this.inputFields.forEach((inputField) => {\r\n      if(inputField.isValid()) {\r\n        if(inputField.isChanged()) {\r\n          ++changedLength;\r\n        }\r\n\r\n        if(inputField.required) {\r\n          ++requiredValidLength;\r\n        }\r\n      }\r\n\r\n      if(inputField.required) {\r\n        ++requiredLength;\r\n      }\r\n    });\r\n\r\n    return requiredLength === requiredValidLength && changedLength > 0;\r\n  };\r\n\r\n  public handleChange = () => {\r\n    this.nextBtn.classList.toggle('is-visible', this.isChanged());\r\n  };\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport emoticonsDropdown, {EmoticonsDropdown, EmoticonsTab, EMOTICONSSTICKERGROUP} from '..';\r\nimport GifsMasonry from '../../gifsMasonry';\r\nimport Scrollable from '../../scrollable';\r\nimport {putPreloader} from '../../putPreloader';\r\nimport {AppManagers} from '../../../lib/appManagers/managers';\r\nimport {attachClickEvent} from '../../../helpers/dom/clickEvent';\r\n\r\nexport default class GifsTab implements EmoticonsTab {\r\n  private content: HTMLElement;\r\n\r\n  constructor(private managers: AppManagers) {\r\n\r\n  }\r\n\r\n  init() {\r\n    this.content = document.getElementById('content-gifs');\r\n    const gifsContainer = this.content.firstElementChild as HTMLDivElement;\r\n    attachClickEvent(gifsContainer, EmoticonsDropdown.onMediaClick);\r\n\r\n    const scroll = new Scrollable(this.content, 'GIFS');\r\n    const masonry = new GifsMasonry(gifsContainer, EMOTICONSSTICKERGROUP, scroll);\r\n    const preloader = putPreloader(this.content, true);\r\n\r\n    this.managers.appDocsManager.getGifs().then((docs) => {\r\n      docs.forEach((doc) => {\r\n        masonry.add(doc);\r\n      });\r\n\r\n      preloader.remove();\r\n    });\r\n\r\n    emoticonsDropdown.addLazyLoadQueueRepeat(masonry.lazyLoadQueue, masonry.processInvisibleDiv);\r\n\r\n    this.init = null;\r\n  }\r\n\r\n  onClose() {\r\n\r\n  }\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport {SliderSuperTab} from '../../slider';\r\nimport InputSearch from '../../inputSearch';\r\nimport animationIntersector, {AnimationItemGroup} from '../../animationIntersector';\r\nimport appSidebarRight from '..';\r\nimport {AppInlineBotsManager} from '../../../lib/appManagers/appInlineBotsManager';\r\nimport GifsMasonry from '../../gifsMasonry';\r\nimport appImManager from '../../../lib/appManagers/appImManager';\r\nimport type {MyDocument} from '../../../lib/appManagers/appDocsManager';\r\nimport mediaSizes from '../../../helpers/mediaSizes';\r\nimport findUpClassName from '../../../helpers/dom/findUpClassName';\r\nimport {attachClickEvent} from '../../../helpers/dom/clickEvent';\r\nimport {NULL_PEER_ID} from '../../../lib/mtproto/mtproto_config';\r\n\r\nconst ANIMATIONGROUP: AnimationItemGroup = 'GIFS-SEARCH';\r\n\r\nexport default class AppGifsTab extends SliderSuperTab {\r\n  private inputSearch: InputSearch;\r\n  private gifsDiv: HTMLDivElement;\r\n\r\n  private nextOffset = '';\r\n  private loadedAll = false;\r\n\r\n  private gifBotPeerId: PeerId;\r\n  private masonry: GifsMasonry;\r\n\r\n  private searchPromise: ReturnType<AppInlineBotsManager['getInlineResults']>;\r\n\r\n  protected init() {\r\n    this.container.id = 'search-gifs-container';\r\n\r\n    this.inputSearch = new InputSearch('SearchGifsTitle', (value) => {\r\n      this.reset();\r\n      this.search(value);\r\n    });\r\n\r\n    this.title.replaceWith(this.inputSearch.container);\r\n\r\n    this.gifsDiv = document.createElement('div');\r\n    this.gifsDiv.classList.add('gifs-masonry');\r\n    attachClickEvent(this.gifsDiv, this.onGifsClick, {listenerSetter: this.listenerSetter});\r\n\r\n    this.scrollable.append(this.gifsDiv);\r\n\r\n    this.masonry = new GifsMasonry(this.gifsDiv, ANIMATIONGROUP, this.scrollable);\r\n    // this.backBtn.parentElement.append(this.inputSearch.container);\r\n  }\r\n\r\n  private onGifsClick = async(e: MouseEvent | TouchEvent) => {\r\n    const target = findUpClassName(e.target, 'gif');\r\n    if(!target) return;\r\n\r\n    const fileId = target.dataset.docId;\r\n    if(await appImManager.chat.input.sendMessageWithDocument(fileId)) {\r\n      if(mediaSizes.isMobile) {\r\n        appSidebarRight.onCloseBtnClick();\r\n      }\r\n    } else {\r\n      console.warn('got no doc by id:', fileId);\r\n    }\r\n  };\r\n\r\n  public onClose() {\r\n    this.scrollable.onScrolledBottom = () => {};\r\n  }\r\n\r\n  public onCloseAfterTimeout() {\r\n    this.reset();\r\n    this.gifsDiv.innerHTML = '';\r\n    animationIntersector.checkAnimations(undefined, ANIMATIONGROUP);\r\n    this.inputSearch.remove();\r\n    return super.onCloseAfterTimeout();\r\n  }\r\n\r\n  private reset() {\r\n    this.searchPromise = null;\r\n    this.nextOffset = '';\r\n    this.loadedAll = false;\r\n    this.masonry.clear();\r\n  }\r\n\r\n  public open() {\r\n    const ret = super.open();\r\n    appSidebarRight.toggleSidebar(true).then(() => {\r\n      this.search('', true);\r\n\r\n      this.scrollable.onScrolledBottom = () => {\r\n        this.search(this.inputSearch.value, false);\r\n      };\r\n    });\r\n    return ret;\r\n  }\r\n\r\n  public async search(query: string, newSearch = true) {\r\n    if(this.searchPromise || this.loadedAll) return;\r\n\r\n    if(!this.gifBotPeerId) {\r\n      this.gifBotPeerId = (await this.managers.appUsersManager.resolveUsername('gif')).id.toPeerId(false);\r\n    }\r\n\r\n    try {\r\n      this.searchPromise = this.managers.appInlineBotsManager.getInlineResults(NULL_PEER_ID, this.gifBotPeerId, query, this.nextOffset);\r\n      const {results, next_offset} = await this.searchPromise;\r\n\r\n      if(this.inputSearch.value !== query) {\r\n        return;\r\n      }\r\n\r\n      this.searchPromise = null;\r\n      this.nextOffset = next_offset;\r\n      if(newSearch) {\r\n        this.gifsDiv.innerHTML = '';\r\n      }\r\n\r\n      if(results.length) {\r\n        results.forEach((result) => {\r\n          if(result._ === 'botInlineMediaResult' && result.document) {\r\n            this.masonry.add(result.document as MyDocument);\r\n          }\r\n        });\r\n      } else {\r\n        this.loadedAll = true;\r\n      }\r\n\r\n      this.scrollable.onScroll();\r\n    } catch(err) {\r\n      this.searchPromise = null;\r\n      console.error('gifs loading error:', err);\r\n      throw err;\r\n    }\r\n  }\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport {SliderSuperTab} from '../../slider';\r\nimport InputSearch from '../../inputSearch';\r\nimport LazyLoadQueue from '../../lazyLoadQueue';\r\nimport appImManager from '../../../lib/appManagers/appImManager';\r\nimport PopupStickers from '../../popups/stickers';\r\nimport animationIntersector from '../../animationIntersector';\r\nimport {wrapSticker} from '../../wrappers';\r\nimport appSidebarRight from '..';\r\nimport {StickerSet, StickerSetCovered} from '../../../layer';\r\nimport {i18n} from '../../../lib/langPack';\r\nimport findUpClassName from '../../../helpers/dom/findUpClassName';\r\nimport {attachClickEvent} from '../../../helpers/dom/clickEvent';\r\nimport forEachReverse from '../../../helpers/array/forEachReverse';\r\nimport setInnerHTML from '../../../helpers/dom/setInnerHTML';\r\nimport wrapEmojiText from '../../../lib/richTextProcessor/wrapEmojiText';\r\nimport attachStickerViewerListeners from '../../stickerViewer';\r\n\r\nexport default class AppStickersTab extends SliderSuperTab {\r\n  private inputSearch: InputSearch;\r\n  private setsDiv: HTMLDivElement;\r\n  private lazyLoadQueue: LazyLoadQueue;\r\n\r\n  protected init() {\r\n    this.container.id = 'stickers-container';\r\n    this.container.classList.add('chatlist-container');\r\n\r\n    this.lazyLoadQueue = new LazyLoadQueue();\r\n\r\n    this.inputSearch = new InputSearch('StickersTab.SearchPlaceholder', (value) => {\r\n      this.search(value);\r\n    });\r\n\r\n    this.title.replaceWith(this.inputSearch.container);\r\n\r\n    this.setsDiv = document.createElement('div');\r\n    this.setsDiv.classList.add('sticker-sets');\r\n    this.scrollable.append(this.setsDiv);\r\n\r\n    attachStickerViewerListeners({listenTo: this.setsDiv, listenerSetter: this.listenerSetter});\r\n\r\n    attachClickEvent(this.setsDiv, (e) => {\r\n      const sticker = findUpClassName(e.target, 'sticker-set-sticker');\r\n      if(sticker) {\r\n        const docId = sticker.dataset.docId;\r\n        appImManager.chat.input.sendMessageWithDocument(docId);\r\n        return;\r\n      }\r\n\r\n      const target = findUpClassName(e.target, 'sticker-set');\r\n      if(!target) return;\r\n\r\n      const id = target.dataset.stickerSet as string;\r\n      const access_hash = target.dataset.access_hash as string;\r\n\r\n      const button = findUpClassName(e.target, 'sticker-set-button') as HTMLElement;\r\n      if(button) {\r\n        e.preventDefault();\r\n        e.cancelBubble = true;\r\n\r\n        button.setAttribute('disabled', 'true');\r\n\r\n        this.managers.appStickersManager.getStickerSet({id, access_hash}).then((full) => {\r\n          this.managers.appStickersManager.toggleStickerSet(full.set).then((changed) => {\r\n            if(changed) {\r\n              button.textContent = '';\r\n              button.append(i18n(full.set.installed_date ? 'Stickers.SearchAdded' : 'Stickers.SearchAdd'));\r\n              button.classList.toggle('gray', !!full.set.installed_date);\r\n            }\r\n          }).finally(() => {\r\n            // button.style.width = set.installed_date ? '68px' : '52px';\r\n            button.removeAttribute('disabled');\r\n          });\r\n        });\r\n      } else {\r\n        this.managers.appStickersManager.getStickerSet({id, access_hash}).then((full) => {\r\n          new PopupStickers(full.set).show();\r\n        });\r\n      }\r\n    }, {listenerSetter: this.listenerSetter});\r\n  }\r\n\r\n  public onCloseAfterTimeout() {\r\n    this.setsDiv.innerHTML = '';\r\n    animationIntersector.checkAnimations(undefined, 'STICKERS-SEARCH');\r\n    return super.onCloseAfterTimeout();\r\n  }\r\n\r\n  public renderSet(set: StickerSet.stickerSet) {\r\n    // console.log('renderSet:', set);\r\n    const div = document.createElement('div');\r\n    div.classList.add('sticker-set');\r\n\r\n    const header = document.createElement('div');\r\n    header.classList.add('sticker-set-header');\r\n\r\n    const details = document.createElement('div');\r\n    details.classList.add('sticker-set-details');\r\n    details.innerHTML = `<div class=\"sticker-set-name\"></div>`;\r\n\r\n    setInnerHTML(details.firstElementChild, wrapEmojiText(set.title));\r\n\r\n    const countDiv = document.createElement('div');\r\n    countDiv.classList.add('sticker-set-count');\r\n    countDiv.append(i18n('Stickers', [set.count]));\r\n    details.append(countDiv);\r\n\r\n    const button = document.createElement('button');\r\n    button.classList.add('btn-primary', 'btn-color-primary', 'sticker-set-button');\r\n    button.append(i18n(set.installed_date ? 'Stickers.SearchAdded' : 'Stickers.SearchAdd'));\r\n    // button.style.width = set.installed_date ? '68px' : '52px';\r\n\r\n    if(set.installed_date) {\r\n      button.classList.add('gray');\r\n    }\r\n\r\n    // ripple(button);\r\n\r\n    header.append(details, button);\r\n\r\n    const stickersDiv = document.createElement('div');\r\n    stickersDiv.classList.add('sticker-set-stickers');\r\n\r\n    const count = Math.min(5, set.count);\r\n    for(let i = 0; i < count; ++i) {\r\n      const stickerDiv = document.createElement('div');\r\n      stickerDiv.classList.add('sticker-set-sticker');\r\n\r\n      stickersDiv.append(stickerDiv);\r\n    }\r\n\r\n    this.managers.appStickersManager.getStickerSet(set).then((set) => {\r\n      // console.log('renderSet got set:', set);\r\n\r\n      for(let i = 0; i < count; ++i) {\r\n        const div = stickersDiv.children[i] as HTMLDivElement;\r\n        const doc = set.documents[i];\r\n        if(doc._ === 'documentEmpty') {\r\n          continue;\r\n        }\r\n\r\n        wrapSticker({\r\n          doc,\r\n          div,\r\n          lazyLoadQueue: this.lazyLoadQueue,\r\n          group: 'STICKERS-SEARCH',\r\n          /* play: false,\r\n          loop: false, */\r\n          play: true,\r\n          loop: true,\r\n          width: 68,\r\n          height: 68,\r\n          withLock: true\r\n        });\r\n      }\r\n    });\r\n\r\n    /* const onMouseOver = () => {\r\n      const animations: AnimationItem['animation'][] = [];\r\n      for(let i = 0; i < count; ++i) {\r\n        const stickerDiv = stickersDiv.children[i] as HTMLElement;\r\n        const animationItem = animationIntersector.getAnimation(stickerDiv);\r\n        if(!animationItem) continue;\r\n\r\n        const animation = animationItem.animation;\r\n\r\n        animations.push(animation);\r\n        animation.loop = true;\r\n        animation.play();\r\n      }\r\n\r\n      div.addEventListener('mouseout', () => {\r\n        animations.forEach((animation) => {\r\n          animation.loop = false;\r\n        });\r\n\r\n        div.addEventListener('mouseover', onMouseOver, {once: true});\r\n      }, {once: true});\r\n    };\r\n\r\n    div.addEventListener('mouseover', onMouseOver, {once: true}); */\r\n\r\n    div.dataset.stickerSet = '' + set.id;\r\n    div.dataset.access_hash = '' + set.access_hash;\r\n    div.dataset.title = set.title;\r\n\r\n    div.append(header, stickersDiv);\r\n\r\n    this.setsDiv.append(div);\r\n  }\r\n\r\n  public open() {\r\n    const ret = super.open();\r\n    appSidebarRight.toggleSidebar(true).then(() => {\r\n      this.renderFeatured();\r\n    });\r\n\r\n    return ret;\r\n  }\r\n\r\n  public renderFeatured() {\r\n    return this.managers.appStickersManager.getFeaturedStickers().then((coveredSets) => {\r\n      if(this.inputSearch.value) {\r\n        return;\r\n      }\r\n\r\n      coveredSets = this.filterRendered('', coveredSets);\r\n      coveredSets.forEach((set) => {\r\n        this.renderSet(set.set);\r\n      });\r\n    });\r\n  }\r\n\r\n  private filterRendered(query: string, coveredSets: StickerSetCovered[]) {\r\n    coveredSets = coveredSets.slice();\r\n\r\n    const children = Array.from(this.setsDiv.children) as HTMLElement[];\r\n    forEachReverse(children, el => {\r\n      const id = el.dataset.stickerSet;\r\n      const index = coveredSets.findIndex((covered) => covered.set.id === id);\r\n\r\n      if(index !== -1) {\r\n        coveredSets.splice(index, 1);\r\n      } else if(!query || !el.dataset.title.toLowerCase().includes(query.toLowerCase())) {\r\n        el.remove();\r\n      }\r\n    });\r\n\r\n    animationIntersector.checkAnimations(undefined, 'STICKERS-SEARCH');\r\n\r\n    return coveredSets;\r\n  }\r\n\r\n  public search(query: string) {\r\n    if(!query) {\r\n      return this.renderFeatured();\r\n    }\r\n\r\n    return this.managers.appStickersManager.searchStickerSets(query, false).then((coveredSets) => {\r\n      if(this.inputSearch.value !== query) {\r\n        return;\r\n      }\r\n\r\n      // console.log('search result:', coveredSets);\r\n\r\n      coveredSets = this.filterRendered(query, coveredSets);\r\n      coveredSets.forEach((set) => {\r\n        this.renderSet(set.set);\r\n      });\r\n    });\r\n  }\r\n}\r\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport IS_TOUCH_SUPPORTED from '../../environment/touchSupport';\nimport appImManager from '../../lib/appManagers/appImManager';\nimport rootScope from '../../lib/rootScope';\nimport animationIntersector, {AnimationItemGroup} from '../animationIntersector';\nimport {horizontalMenu} from '../horizontalMenu';\nimport LazyLoadQueue from '../lazyLoadQueue';\nimport Scrollable, {ScrollableX} from '../scrollable';\nimport appSidebarRight from '../sidebarRight';\nimport StickyIntersector from '../stickyIntersector';\nimport EmojiTab from './tabs/emoji';\nimport GifsTab from './tabs/gifs';\nimport StickersTab from './tabs/stickers';\nimport {MOUNT_CLASS_TO} from '../../config/debug';\nimport AppGifsTab from '../sidebarRight/tabs/gifs';\nimport AppStickersTab from '../sidebarRight/tabs/stickers';\nimport findUpClassName from '../../helpers/dom/findUpClassName';\nimport findUpTag from '../../helpers/dom/findUpTag';\nimport blurActiveElement from '../../helpers/dom/blurActiveElement';\nimport whichChild from '../../helpers/dom/whichChild';\nimport cancelEvent from '../../helpers/dom/cancelEvent';\nimport DropdownHover from '../../helpers/dropdownHover';\nimport pause from '../../helpers/schedulers/pause';\nimport {IS_APPLE_MOBILE} from '../../environment/userAgent';\nimport {AppManagers} from '../../lib/appManagers/managers';\nimport type LazyLoadQueueIntersector from '../lazyLoadQueueIntersector';\nimport {simulateClickEvent} from '../../helpers/dom/clickEvent';\nimport overlayCounter from '../../helpers/overlayCounter';\n\nexport const EMOTICONSSTICKERGROUP: AnimationItemGroup = 'emoticons-dropdown';\n\nexport interface EmoticonsTab {\n  init: () => void,\n  onCloseAfterTimeout?: () => void\n}\n\nexport class EmoticonsDropdown extends DropdownHover {\n  public static lazyLoadQueue = new LazyLoadQueue();\n\n  private emojiTab: EmojiTab;\n  public stickersTab: StickersTab;\n  private gifsTab: GifsTab;\n\n  private container: HTMLElement;\n  private tabsEl: HTMLElement;\n  private tabId = -1;\n\n  private tabs: {[id: number]: EmoticonsTab};\n\n  private searchButton: HTMLElement;\n  private deleteBtn: HTMLElement;\n\n  private selectTab: ReturnType<typeof horizontalMenu>;\n\n  private savedRange: Range;\n  private managers: AppManagers;\n\n  constructor() {\n    super({\n      element: document.getElementById('emoji-dropdown') as HTMLDivElement\n    });\n\n    this.addEventListener('open', async() => {\n      if(IS_TOUCH_SUPPORTED) {\n        // appImManager.chat.input.saveScroll();\n        if(blurActiveElement()) {\n          await pause(100);\n        }\n      }\n\n      if(this.element.parentElement !== appImManager.chat.input.chatInput) {\n        appImManager.chat.input.chatInput.append(this.element);\n      }\n\n      this.savedRange = this.getGoodRange();\n\n      EmoticonsDropdown.lazyLoadQueue.lock();\n      // EmoticonsDropdown.lazyLoadQueue.unlock();\n      animationIntersector.lockIntersectionGroup(EMOTICONSSTICKERGROUP);\n    });\n\n    this.addEventListener('opened', () => {\n      animationIntersector.unlockIntersectionGroup(EMOTICONSSTICKERGROUP);\n      EmoticonsDropdown.lazyLoadQueue.unlock();\n      EmoticonsDropdown.lazyLoadQueue.refresh();\n\n      // this.container.classList.remove('disable-hover');\n    });\n\n    this.addEventListener('close', () => {\n      EmoticonsDropdown.lazyLoadQueue.lock();\n      // EmoticonsDropdown.lazyLoadQueue.lock();\n\n      //      \n      animationIntersector.lockIntersectionGroup(EMOTICONSSTICKERGROUP);\n      animationIntersector.checkAnimations(true, EMOTICONSSTICKERGROUP);\n    });\n\n    this.addEventListener('closed', () => {\n      //    visible,      \n      animationIntersector.unlockIntersectionGroup(EMOTICONSSTICKERGROUP);\n      EmoticonsDropdown.lazyLoadQueue.unlock();\n      EmoticonsDropdown.lazyLoadQueue.refresh();\n\n      // this.container.classList.remove('disable-hover');\n\n      this.savedRange = undefined;\n    });\n  }\n\n  protected init() {\n    this.managers = rootScope.managers;\n    this.emojiTab = new EmojiTab(this.managers);\n    this.stickersTab = new StickersTab(this.managers);\n    this.gifsTab = new GifsTab(this.managers);\n\n    this.tabs = {\n      0: this.emojiTab,\n      1: this.stickersTab,\n      2: this.gifsTab\n    };\n\n    this.container = this.element.querySelector('.emoji-container .tabs-container') as HTMLDivElement;\n    this.tabsEl = this.element.querySelector('.emoji-tabs') as HTMLUListElement;\n    this.selectTab = horizontalMenu(this.tabsEl, this.container, this.onSelectTabClick, () => {\n      const tab = this.tabs[this.tabId];\n      if(tab.init) {\n        tab.init();\n      }\n\n      tab.onCloseAfterTimeout && tab.onCloseAfterTimeout();\n      animationIntersector.checkAnimations(false, EMOTICONSSTICKERGROUP);\n    });\n\n    this.searchButton = this.element.querySelector('.emoji-tabs-search');\n    this.searchButton.addEventListener('click', () => {\n      if(this.tabId === 1) {\n        if(!appSidebarRight.isTabExists(AppStickersTab)) {\n          appSidebarRight.createTab(AppStickersTab).open();\n        }\n      } else {\n        if(!appSidebarRight.isTabExists(AppGifsTab)) {\n          appSidebarRight.createTab(AppGifsTab).open();\n        }\n      }\n    });\n\n    this.deleteBtn = this.element.querySelector('.emoji-tabs-delete');\n    this.deleteBtn.addEventListener('click', (e) => {\n      const input = appImManager.chat.input.messageInput;\n      if((input.lastChild as any)?.tagName) {\n        input.lastElementChild.remove();\n      } else if(input.lastChild) {\n        if(!input.lastChild.textContent.length) {\n          input.lastChild.remove();\n        } else {\n          input.lastChild.textContent = input.lastChild.textContent.slice(0, -1);\n        }\n      }\n\n      const event = new Event('input', {bubbles: true, cancelable: true});\n      appImManager.chat.input.messageInput.dispatchEvent(event);\n      // appSidebarRight.stickersTab.init();\n\n      cancelEvent(e);\n    });\n\n    const HIDE_EMOJI_TAB = IS_APPLE_MOBILE;\n\n    const INIT_TAB_ID = HIDE_EMOJI_TAB ? 1 : 0;\n\n    if(HIDE_EMOJI_TAB) {\n      (this.tabsEl.children[1] as HTMLElement).classList.add('hide');\n    }\n\n    simulateClickEvent(this.tabsEl.children[INIT_TAB_ID + 1] as HTMLElement); // set emoji tab\n    if(this.tabs[INIT_TAB_ID].init) {\n      this.tabs[INIT_TAB_ID].init(); // onTransitionEnd  , ..    \n    }\n\n    if(!IS_TOUCH_SUPPORTED) {\n      let lastMouseMoveEvent: MouseEvent, mouseMoveEventAttached = false;\n      const onMouseMove = (e: MouseEvent) => {\n        lastMouseMoveEvent = e;\n      };\n      overlayCounter.addEventListener('change', (isActive) => {\n        if(isActive) {\n          if(!mouseMoveEventAttached) {\n            document.body.addEventListener('mousemove', onMouseMove);\n            mouseMoveEventAttached = true;\n          }\n        } else if(mouseMoveEventAttached) {\n          document.body.removeEventListener('mousemove', onMouseMove);\n          if(lastMouseMoveEvent) {\n            this.onMouseOut(lastMouseMoveEvent);\n          }\n        }\n      });\n    }\n\n    appImManager.addEventListener('peer_changed', this.checkRights);\n    this.checkRights();\n\n    return super.init();\n  }\n\n  public getElement() {\n    return this.element;\n  }\n\n  private onSelectTabClick = (id: number) => {\n    if(this.tabId === id) {\n      return;\n    }\n\n    animationIntersector.checkAnimations(true, EMOTICONSSTICKERGROUP);\n\n    this.tabId = id;\n    this.searchButton.classList.toggle('hide', this.tabId === 0);\n    this.deleteBtn.classList.toggle('hide', this.tabId !== 0);\n  };\n\n  private checkRights = async() => {\n    const {peerId, threadId} = appImManager.chat;\n    const children = this.tabsEl.children;\n    const tabsElements = Array.from(children) as HTMLElement[];\n\n    const [canSendStickers, canSendGifs] = await Promise.all([\n      this.managers.appMessagesManager.canSendToPeer(peerId, threadId, 'send_stickers'),\n      this.managers.appMessagesManager.canSendToPeer(peerId, threadId, 'send_gifs')\n    ]);\n\n    tabsElements[2].toggleAttribute('disabled', !canSendStickers);\n    tabsElements[3].toggleAttribute('disabled', !canSendGifs);\n\n    const active = this.tabsEl.querySelector('.active');\n    if(active && whichChild(active) !== 1 && (!canSendStickers || !canSendGifs)) {\n      this.selectTab(0, false);\n    }\n  };\n\n  public static menuOnClick = (menu: HTMLElement, scroll: Scrollable, menuScroll?: ScrollableX, prevId = 0) => {\n    let jumpedTo = -1;\n\n    const setActive = (id: number) => {\n      if(id === prevId) {\n        return false;\n      }\n\n      menu.children[prevId].classList.remove('active');\n      menu.children[id].classList.add('active');\n      prevId = id;\n\n      return true;\n    };\n\n    const stickyIntersector = new StickyIntersector(scroll.container, (stuck, target) => {\n      // console.log('sticky scrollTOp', stuck, target, scroll.container.scrollTop);\n\n      if(Math.abs(jumpedTo - scroll.container.scrollTop) <= 1) {\n        return;\n      } else {\n        jumpedTo = -1;\n      }\n\n      const which = whichChild(target);\n      if(!stuck && which) { // * due to stickyIntersector\n        return;\n      }\n\n      setActive(which);\n\n      if(menuScroll) {\n        menuScroll.scrollIntoViewNew({\n          element: menu.children[which] as HTMLElement,\n          position: 'center',\n          axis: 'x'\n        });\n      }\n    });\n\n    menu.addEventListener('click', (e) => {\n      let target = e.target as HTMLElement;\n      target = findUpClassName(target, 'menu-horizontal-div-item');\n\n      if(!target) {\n        return;\n      }\n\n      const which = whichChild(target);\n\n      /* if(menuScroll) {\n        menuScroll.scrollIntoView(target, false, 0);\n      } */\n\n      if(!setActive(which)) {\n        return;\n      }\n\n      const element = (scroll.splitUp || scroll.container).children[which] as HTMLElement;\n      const offsetTop = element.offsetTop + 1; // * due to stickyIntersector\n\n      scroll.container.scrollTop = jumpedTo = offsetTop;\n\n      // console.log('set scrollTop:', offsetTop);\n    });\n\n    return {stickyIntersector, setActive};\n  };\n\n  public static onMediaClick = async(e: {target: EventTarget | Element}, clearDraft = false, silent?: boolean) => {\n    let target = e.target as HTMLElement;\n    target = findUpTag(target, 'DIV');\n\n    if(!target) return false;\n\n    const docId = target.dataset.docId;\n    if(!docId) return false;\n\n    return this.sendDocId(docId, clearDraft, silent);\n  };\n\n  public static async sendDocId(docId: DocId, clearDraft?: boolean, silent?: boolean) {\n    if(await appImManager.chat.input.sendMessageWithDocument(docId, undefined, clearDraft, silent)) {\n      /* dropdown.classList.remove('active');\n      toggleEl.classList.remove('active'); */\n      if(emoticonsDropdown.container) {\n        emoticonsDropdown.forceClose = true;\n        // emoticonsDropdown.container.classList.add('disable-hover');\n        emoticonsDropdown.toggle(false);\n      }\n\n      return true;\n    } else {\n      console.warn('got no doc by id:', docId);\n      return false;\n    }\n  }\n\n  public addLazyLoadQueueRepeat(lazyLoadQueue: LazyLoadQueueIntersector, processInvisibleDiv: (div: HTMLElement) => void) {\n    this.addEventListener('close', () => {\n      lazyLoadQueue.lock();\n    });\n\n    this.addEventListener('closed', () => {\n      const divs = lazyLoadQueue.intersector.getVisible();\n\n      for(const div of divs) {\n        processInvisibleDiv(div);\n      }\n\n      lazyLoadQueue.intersector.clearVisible();\n    });\n\n    this.addEventListener('opened', () => {\n      lazyLoadQueue.unlockAndRefresh();\n    });\n  }\n\n  public getSavedRange() {\n    return this.getGoodRange() || this.savedRange;\n  }\n\n  private getGoodRange() {\n    const sel = document.getSelection();\n    if(sel.rangeCount && document.activeElement === appImManager.chat.input.messageInput) {\n      return sel.getRangeAt(0);\n    }\n  }\n}\n\nconst emoticonsDropdown = new EmoticonsDropdown();\nMOUNT_CLASS_TO.emoticonsDropdown = emoticonsDropdown;\nexport default emoticonsDropdown;\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport emoticonsDropdown, {EmoticonsDropdown, EmoticonsTab} from '..';\nimport cancelEvent from '../../../helpers/dom/cancelEvent';\nimport findUpClassName from '../../../helpers/dom/findUpClassName';\nimport {fastRaf} from '../../../helpers/schedulers';\nimport pause from '../../../helpers/schedulers/pause';\nimport appImManager from '../../../lib/appManagers/appImManager';\nimport {i18n, LangPackKey} from '../../../lib/langPack';\nimport rootScope from '../../../lib/rootScope';\nimport {emojiFromCodePoints} from '../../../vendor/emoji';\nimport {putPreloader} from '../../putPreloader';\nimport Scrollable from '../../scrollable';\nimport StickyIntersector from '../../stickyIntersector';\nimport IS_EMOJI_SUPPORTED from '../../../environment/emojiSupport';\nimport IS_TOUCH_SUPPORTED from '../../../environment/touchSupport';\nimport blurActiveElement from '../../../helpers/dom/blurActiveElement';\nimport Emoji from '../../../config/emoji';\nimport {AppManagers} from '../../../lib/appManagers/managers';\nimport fixEmoji from '../../../lib/richTextProcessor/fixEmoji';\nimport wrapEmojiText from '../../../lib/richTextProcessor/wrapEmojiText';\nimport wrapSingleEmoji from '../../../lib/richTextProcessor/wrapSingleEmoji';\nimport {attachClickEvent} from '../../../helpers/dom/clickEvent';\n\nconst loadedURLs: Set<string> = new Set();\nexport function appendEmoji(emoji: string, container: HTMLElement, prepend = false, unify = false) {\n  // const emoji = details.unified;\n  // const emoji = (details.unified as string).split('-')\n  // .reduce((prev, curr) => prev + String.fromCodePoint(parseInt(curr, 16)), '');\n\n  const spanEmoji = document.createElement('span');\n  spanEmoji.classList.add('super-emoji');\n\n  let kek: DocumentFragment;\n  if(unify && !IS_EMOJI_SUPPORTED) {\n    kek = wrapSingleEmoji(emoji);\n  } else {\n    emoji = fixEmoji(emoji);\n    kek = wrapEmojiText(emoji);\n  }\n\n  /* if(!kek.includes('emoji')) {\n    console.log(emoji, kek, spanEmoji, emoji.length, new TextEncoder().encode(emoji), emojiUnicode(emoji));\n    return;\n  } */\n\n  // console.log(kek);\n\n  spanEmoji.append(kek);\n\n  if(spanEmoji.children.length > 1) {\n    const first = spanEmoji.firstElementChild;\n    spanEmoji.innerHTML = '';\n    spanEmoji.append(first);\n  }\n\n  if(spanEmoji.firstElementChild?.tagName === 'IMG') {\n    const image = spanEmoji.firstElementChild as HTMLImageElement;\n\n    const url = image.src;\n    if(!loadedURLs.has(url)) {\n      image.setAttribute('loading', 'lazy');\n      const placeholder = document.createElement('span');\n      placeholder.classList.add('emoji-placeholder');\n\n      if(rootScope.settings.animationsEnabled) {\n        image.style.opacity = '0';\n        placeholder.style.opacity = '1';\n      }\n\n      image.addEventListener('load', () => {\n        fastRaf(() => {\n          if(rootScope.settings.animationsEnabled) {\n            image.style.opacity = '';\n            placeholder.style.opacity = '';\n          }\n\n          spanEmoji.classList.remove('empty');\n\n          loadedURLs.add(url);\n        });\n      }, {once: true});\n\n      spanEmoji.append(placeholder);\n    }\n  }\n\n  // spanEmoji = spanEmoji.firstElementChild as HTMLSpanElement;\n  // spanEmoji.setAttribute('emoji', emoji);\n  if(prepend) container.prepend(spanEmoji);\n  else container.appendChild(spanEmoji);\n}\n\nexport function getEmojiFromElement(element: HTMLElement) {\n  if(!findUpClassName(element, 'super-emoji')) return '';\n\n  if(element.nodeType === 3) return element.nodeValue;\n  if(element.tagName === 'SPAN' && !element.classList.contains('emoji') && element.firstElementChild) {\n    element = element.firstElementChild as HTMLElement;\n  }\n\n  return element.getAttribute('alt') || element.innerText;\n}\n\nexport default class EmojiTab implements EmoticonsTab {\n  private content: HTMLElement;\n\n  private recentItemsDiv: HTMLElement;\n\n  private scroll: Scrollable;\n  private stickyIntersector: StickyIntersector;\n  private menu: HTMLElement;\n\n  private closeScrollTop = 0;\n  private setMenuActive: (id: number) => boolean;\n\n  constructor(private managers: AppManagers) {\n\n  }\n\n  init() {\n    this.content = document.getElementById('content-emoji') as HTMLDivElement;\n\n    const categories: LangPackKey[] = [\n      'Emoji.SmilesAndPeople',\n      'Emoji.AnimalsAndNature',\n      'Emoji.FoodAndDrink',\n      'Emoji.TravelAndPlaces',\n      'Emoji.ActivityAndSport',\n      'Emoji.Objects',\n      /* 'Emoji.Symbols',  */\n      'Emoji.Flags',\n      'Skin Tones' as any\n    ];\n    const divs: {\n      [category in LangPackKey]?: HTMLDivElement\n    } = {};\n\n    const sorted: Map<LangPackKey, string[]> = new Map([\n      [\n        'Emoji.Recent',\n        []\n      ]\n    ]);\n\n    for(const emoji in Emoji) {\n      const details = Emoji[emoji];\n      const i = '' + details;\n      const category = categories[+i[0] - 1];\n      if(!category) continue; // maybe it's skin tones\n\n      let s = sorted.get(category);\n      if(!s) {\n        s = [];\n        sorted.set(category, s);\n      }\n\n      s[+i.slice(1) || 0] = emoji;\n    }\n\n    // console.log('emoticons sorted:', sorted);\n\n    // Object.keys(sorted).forEach((c) => sorted[c].sort((a, b) => a - b));\n\n    sorted.delete(categories.pop());\n\n    // console.time('emojiParse');\n    sorted.forEach((emojis, category) => {\n      const div = document.createElement('div');\n      div.classList.add('emoji-category');\n\n      const titleDiv = document.createElement('div');\n      titleDiv.classList.add('category-title');\n      titleDiv.append(i18n(category));\n\n      const itemsDiv = document.createElement('div');\n      itemsDiv.classList.add('super-emojis');\n\n      div.append(titleDiv, itemsDiv);\n\n      emojis.forEach((unified) => {\n        /* if(emojiUnicode(emoji) === '1f481-200d-2642') {\n          console.log('append emoji', emoji, emojiUnicode(emoji));\n        } */\n\n        const emoji = emojiFromCodePoints(unified);\n        // if(emoji.includes('')) {\n        // console.log('toCodePoints', toCodePoints(emoji));\n        // emoji = emoji.replace(/(\\u200d[\\u2640\\u2642\\u2695])(?!\\ufe0f)/, '\\ufe0f$1');\n        // const zwjIndex = emoji.indexOf('\\u200d');\n        // if(zwjIndex !== -1 && !emoji.includes('\\ufe0f')) {\n        //   /* if(zwjIndex !== (emoji.length - 1)) {\n        //     emoji = emoji.replace(/(\\u200d)/g, '\\ufe0f$1');\n        //   } */\n\n        //   emoji += '\\ufe0f';\n        //   //emoji += '\\ufe0f';\n        // }\n\n        // debugger;\n        // }\n\n        appendEmoji(emoji/* .replace(/[\\ufe0f\\u2640\\u2642\\u2695]/g, '') */, itemsDiv, false/* , false */);\n\n        /* if(category === 'Smileys & Emotion') {\n          console.log('appended emoji', emoji, itemsDiv.children[itemsDiv.childElementCount - 1].innerHTML, emojiUnicode(emoji));\n        } */\n      });\n\n      divs[category] = div;\n    });\n\n    // console.timeEnd('emojiParse');\n\n    const menu = this.menu = this.content.previousElementSibling as HTMLElement;\n    const emojiScroll = this.scroll = new Scrollable(this.content, 'EMOJI');\n\n    // emojiScroll.setVirtualContainer(emojiScroll.container);\n\n    const preloader = putPreloader(this.content, true);\n\n    Promise.all([\n      pause(200),\n      this.managers.appEmojiManager.getRecentEmojis().then((recent) => {\n        const hasRecent = !!recent.length;\n        const activeId = hasRecent ? 0 : 1;\n        this.menu.children[0].classList.toggle('hide', !hasRecent);\n        this.menu.children[activeId].classList.add('active');\n        const m = EmoticonsDropdown.menuOnClick(menu, emojiScroll, undefined, activeId);\n        this.stickyIntersector = m.stickyIntersector;\n        this.setMenuActive = m.setActive;\n        return recent;\n      })\n    ]).then(([_, recent]) => {\n      preloader.remove();\n\n      this.recentItemsDiv = divs['Emoji.Recent'].querySelector('.super-emojis');\n      for(const emoji of recent) {\n        appendEmoji(emoji, this.recentItemsDiv);\n      }\n\n      this.recentItemsDiv.parentElement.classList.toggle('hide', !this.recentItemsDiv.childElementCount);\n\n      categories.unshift('Emoji.Recent');\n      categories.map((category) => {\n        const div = divs[category];\n\n        if(!div) {\n          console.error('no div by category:', category);\n        }\n\n        emojiScroll.container.append(div);\n        this.stickyIntersector.observeStickyHeaderChanges(div);\n        return div;\n      });\n    });\n\n    attachClickEvent(this.content, this.onContentClick);\n    this.init = null;\n\n    rootScope.addEventListener('emoji_recent', (emoji) => {\n      const children = Array.from(this.recentItemsDiv.children) as HTMLElement[];\n      for(let i = 0, length = children.length; i < length; ++i) {\n        const el = children[i];\n        const _emoji = fixEmoji(getEmojiFromElement(el));\n        if(emoji === _emoji) {\n          if(i === 0) {\n            return;\n          }\n\n          el.remove();\n        }\n      }\n\n      appendEmoji(emoji, this.recentItemsDiv, true);\n      this.recentItemsDiv.parentElement.classList.remove('hide');\n      this.menu.children[0].classList.remove('hide');\n\n      if(!this.closeScrollTop) {\n        this.setMenuActive(0);\n      }\n    });\n\n    emoticonsDropdown.addEventListener('close', () => {\n      this.closeScrollTop = this.scroll.scrollTop;\n    });\n  }\n\n  onContentClick = (e: MouseEvent) => {\n    cancelEvent(e);\n\n    const emoji = getEmojiFromElement(e.target as HTMLElement);\n    if(!emoji) {\n      return;\n    }\n\n    appImManager.chat.input.onEmojiSelected(emoji, false);\n    if(IS_TOUCH_SUPPORTED) {\n      blurActiveElement();\n    }\n  };\n\n  onClose() {\n\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport getEmojiEntityFromEmoji from './getEmojiEntityFromEmoji';\nimport wrapRichText from './wrapRichText';\n\nexport default function wrapSingleEmoji(emoji: string) {\n  return wrapRichText(emoji, {\n    entities: [getEmojiEntityFromEmoji(emoji)]\n  });\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport findAndSpliceAll from '../helpers/array/findAndSpliceAll';\nimport LazyLoadQueueIntersector, {LazyLoadElement} from './lazyLoadQueueIntersector';\nimport VisibilityIntersector, {OnVisibilityChange} from './visibilityIntersector';\n\nexport default class LazyLoadQueueRepeat extends LazyLoadQueueIntersector {\n  private _queue: Map<HTMLElement, LazyLoadElement> = new Map();\n\n  constructor(parallelLimit?: number, protected onVisibilityChange?: OnVisibilityChange, options?: IntersectionObserverInit) {\n    super(parallelLimit);\n\n    this.intersector = new VisibilityIntersector((item) => {\n      const {target, visible} = item;\n      const spliced = findAndSpliceAll(this.queue, (i) => i.div === target);\n      if(visible) {\n        const items = spliced.length ? spliced : [this._queue.get(target)];\n        items.forEach((item) => {\n          this.queue.unshift(item || this._queue.get(target));\n        });\n      }\n\n      this.onVisibilityChange && this.onVisibilityChange(item);\n      this.setProcessQueueTimeout();\n    }, options);\n  }\n\n  public clear() {\n    super.clear();\n    this._queue.clear();\n  }\n\n  /* public async processItem(item: LazyLoadElement) {\n    //await super.processItem(item);\n    await LazyLoadQueueBase.prototype.processItem.call(this, item);\n\n    if(this.lazyLoadMedia.length) {\n      this.processQueue();\n    }\n  } */\n\n  public observe(el: LazyLoadElement) {\n    this._queue.set(el.div, el);\n    this.intersector.observe(el.div);\n  }\n}\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport emoticonsDropdown, {EmoticonsDropdown, EMOTICONSSTICKERGROUP, EmoticonsTab} from '..';\r\nimport findUpClassName from '../../../helpers/dom/findUpClassName';\r\nimport mediaSizes from '../../../helpers/mediaSizes';\r\nimport {MessagesAllStickers, StickerSet} from '../../../layer';\r\nimport {MyDocument} from '../../../lib/appManagers/appDocsManager';\r\nimport {AppManagers} from '../../../lib/appManagers/managers';\r\nimport {i18n, LangPackKey} from '../../../lib/langPack';\r\nimport wrapEmojiText from '../../../lib/richTextProcessor/wrapEmojiText';\r\nimport rootScope from '../../../lib/rootScope';\r\nimport animationIntersector, {AnimationItemGroup} from '../../animationIntersector';\r\nimport LazyLoadQueue from '../../lazyLoadQueue';\r\nimport LazyLoadQueueRepeat from '../../lazyLoadQueueRepeat';\r\nimport {putPreloader} from '../../putPreloader';\r\nimport PopupStickers from '../../popups/stickers';\r\nimport Scrollable, {ScrollableX} from '../../scrollable';\r\nimport StickyIntersector from '../../stickyIntersector';\r\nimport {wrapSticker, wrapStickerSetThumb} from '../../wrappers';\r\nimport findAndSplice from '../../../helpers/array/findAndSplice';\r\nimport {attachClickEvent} from '../../../helpers/dom/clickEvent';\r\nimport positionElementByIndex from '../../../helpers/dom/positionElementByIndex';\r\nimport noop from '../../../helpers/noop';\r\nimport ButtonIcon from '../../buttonIcon';\r\nimport confirmationPopup from '../../confirmationPopup';\r\nimport VisibilityIntersector, {OnVisibilityChange} from '../../visibilityIntersector';\r\nimport createStickersContextMenu from '../../../helpers/dom/createStickersContextMenu';\r\nimport findUpAsChild from '../../../helpers/dom/findUpAsChild';\r\nimport forEachReverse from '../../../helpers/array/forEachReverse';\r\nimport {MTAppConfig} from '../../../lib/mtproto/appConfig';\r\nimport attachStickerViewerListeners from '../../stickerViewer';\r\nimport ListenerSetter from '../../../helpers/listenerSetter';\r\n\r\nexport class SuperStickerRenderer {\r\n  public lazyLoadQueue: LazyLoadQueueRepeat;\r\n  private animated: Set<HTMLElement> = new Set();\r\n\r\n  constructor(\r\n    private regularLazyLoadQueue: LazyLoadQueue,\r\n    private group: AnimationItemGroup,\r\n    private managers: AppManagers,\r\n    private options?: IntersectionObserverInit\r\n  ) {\r\n    this.lazyLoadQueue = new LazyLoadQueueRepeat(undefined, ({target, visible}) => {\r\n      if(!visible) {\r\n        this.processInvisible(target);\r\n      }\r\n    }, options);\r\n  }\r\n\r\n  public clear() {\r\n    this.lazyLoadQueue.clear();\r\n  }\r\n\r\n  public renderSticker(doc: MyDocument, element?: HTMLElement, loadPromises?: Promise<any>[]) {\r\n    if(!element) {\r\n      element = document.createElement('div');\r\n      element.classList.add('grid-item', 'super-sticker');\r\n      element.dataset.docId = '' + doc.id;\r\n\r\n      if(doc.animated) {\r\n        this.observeAnimated(element);\r\n      }\r\n    }\r\n\r\n    // * This will wrap only a thumb\r\n    /* !doc.animated &&  */wrapSticker({\r\n      doc,\r\n      div: element,\r\n      lazyLoadQueue: this.regularLazyLoadQueue,\r\n      group: this.group,\r\n      onlyThumb: doc.animated,\r\n      loadPromises\r\n    });\r\n\r\n    return element;\r\n  }\r\n\r\n  public observeAnimated(element: HTMLElement) {\r\n    this.animated.add(element);\r\n    this.lazyLoadQueue.observe({\r\n      div: element,\r\n      load: this.processVisible\r\n    });\r\n  }\r\n\r\n  public unobserveAnimated(element: HTMLElement) {\r\n    this.animated.delete(element);\r\n    this.lazyLoadQueue.unobserve(element);\r\n  }\r\n\r\n  private checkAnimationContainer = (element: HTMLElement, visible: boolean) => {\r\n    // console.error('checkAnimationContainer', div, visible);\r\n    const players = animationIntersector.getAnimations(element);\r\n    players.forEach((player) => {\r\n      if(!visible) {\r\n        animationIntersector.checkAnimation(player, true, true);\r\n      } else {\r\n        animationIntersector.checkAnimation(player, false);\r\n      }\r\n    });\r\n  };\r\n\r\n  private processVisible = async(element: HTMLElement) => {\r\n    const docId = element.dataset.docId;\r\n    const doc = await this.managers.appDocsManager.getDoc(docId);\r\n\r\n    const size = mediaSizes.active.esgSticker.width;\r\n\r\n    // console.log('processVisibleDiv:', div);\r\n\r\n    const promise = wrapSticker({\r\n      doc,\r\n      div: element,\r\n      width: size,\r\n      height: size,\r\n      lazyLoadQueue: null,\r\n      group: this.group,\r\n      onlyThumb: false,\r\n      play: true,\r\n      loop: true,\r\n      withLock: true\r\n    }).then(({render}) => render);\r\n\r\n    promise.then(() => {\r\n      // clearTimeout(timeout);\r\n      this.checkAnimationContainer(element, this.lazyLoadQueue.intersector.isVisible(element));\r\n    });\r\n\r\n    /* let timeout = window.setTimeout(() => {\r\n      console.error('processVisibleDiv timeout', div, doc);\r\n    }, 1e3); */\r\n\r\n    return promise;\r\n  };\r\n\r\n  public processInvisible = async(element: HTMLElement) => {\r\n    const docId = element.dataset.docId;\r\n    const doc = await this.managers.appDocsManager.getDoc(docId);\r\n\r\n    // console.log('STICKER INvisible:', /* div,  */docId);\r\n\r\n    this.checkAnimationContainer(element, false);\r\n\r\n    element.textContent = '';\r\n    this.renderSticker(doc, element as HTMLDivElement);\r\n  };\r\n}\r\n\r\ntype StickersTabCategory = {\r\n  elements: {\r\n    container: HTMLElement,\r\n    title: HTMLElement,\r\n    items: HTMLElement,\r\n    menuTab: HTMLElement,\r\n    menuTabPadding: HTMLElement\r\n  },\r\n  set: StickerSet.stickerSet,\r\n  items: {\r\n    document: MyDocument,\r\n    element: HTMLElement\r\n  }[],\r\n  mounted?: boolean,\r\n  id: string,\r\n  limit?: number\r\n};\r\n\r\nexport default class StickersTab implements EmoticonsTab {\r\n  private content: HTMLElement;\r\n\r\n  private categories: {[id: string]: StickersTabCategory};\r\n  private categoriesMap: Map<HTMLElement, StickersTabCategory>;\r\n  private categoriesIntersector: VisibilityIntersector;\r\n  private localCategories: StickersTabCategory[];\r\n\r\n  private scroll: Scrollable;\r\n  private menu: HTMLElement;\r\n  private mounted = false;\r\n  private stickyIntersector: StickyIntersector;\r\n  private superStickerRenderer: SuperStickerRenderer;\r\n\r\n  constructor(private managers: AppManagers) {\r\n    this.categories = {};\r\n    this.categoriesMap = new Map();\r\n    this.localCategories = [];\r\n  }\r\n\r\n  private setFavedLimit(appConfig: MTAppConfig) {\r\n    const limit = rootScope.premium ? appConfig.stickers_faved_limit_premium : appConfig.stickers_faved_limit_default;\r\n    const category = this.categories['faved'];\r\n    category.limit = limit;\r\n  }\r\n\r\n  private createCategory(stickerSet: StickerSet.stickerSet, _title: HTMLElement | DocumentFragment) {\r\n    const container = document.createElement('div');\r\n    container.classList.add('emoji-category', 'hide');\r\n\r\n    const items = document.createElement('div');\r\n    items.classList.add('category-items', 'super-stickers');\r\n\r\n    const title = document.createElement('div');\r\n    title.classList.add('category-title');\r\n    title.append(_title);\r\n\r\n    const menuTab = ButtonIcon(undefined, {noRipple: true});\r\n    menuTab.classList.add('menu-horizontal-div-item');\r\n\r\n    const menuTabPadding = document.createElement('div');\r\n    menuTabPadding.classList.add('menu-horizontal-div-item-padding');\r\n\r\n    menuTab.append(menuTabPadding);\r\n\r\n    const category: StickersTabCategory = {\r\n      elements: {\r\n        container,\r\n        title,\r\n        items,\r\n        menuTab,\r\n        menuTabPadding\r\n      },\r\n      set: stickerSet,\r\n      items: [],\r\n      id: '' + stickerSet.id\r\n    };\r\n\r\n    container.append(title, items);\r\n\r\n    this.categories[stickerSet.id] = category;\r\n    this.categoriesMap.set(container, category);\r\n\r\n    this.categoriesIntersector.observe(container);\r\n    this.stickyIntersector.observeStickyHeaderChanges(container);\r\n\r\n    return category;\r\n  }\r\n\r\n  private categoryAppendStickers(\r\n    category: StickersTabCategory,\r\n    promise: Promise<MyDocument[]>\r\n  ) {\r\n    const {container} = category.elements;\r\n\r\n    promise.then((documents) => {\r\n      const isVisible = this.isCategoryVisible(category);\r\n\r\n      documents.forEach((document) => {\r\n        const element = this.superStickerRenderer.renderSticker(document);\r\n        category.items.push({document, element});\r\n\r\n        if(isVisible) {\r\n          category.elements.items.append(element);\r\n        }\r\n      });\r\n\r\n      this.setCategoryItemsHeight(category);\r\n      container.classList.remove('hide');\r\n    });\r\n  }\r\n\r\n  private isCategoryVisible(category: StickersTabCategory) {\r\n    return this.categoriesIntersector.getVisible().includes(category.elements.container);\r\n  }\r\n\r\n  private setCategoryItemsHeight(category: StickersTabCategory) {\r\n    const containerWidth = this.content.getBoundingClientRect().width - 10;\r\n    const stickerSize = mediaSizes.active.esgSticker.width;\r\n\r\n    const itemsPerRow = Math.floor(containerWidth / stickerSize);\r\n    const rows = Math.ceil(category.items.length / itemsPerRow);\r\n    const height = rows * stickerSize;\r\n\r\n    category.elements.items.style.minHeight = height + 'px';\r\n  }\r\n\r\n  private async renderStickerSet(set: StickerSet.stickerSet, prepend = false) {\r\n    const category = this.createCategory(set, wrapEmojiText(set.title));\r\n    const {menuTab, menuTabPadding, container} = category.elements;\r\n\r\n    const pos = prepend ? this.localCategories.filter((category) => category.mounted).length : 0xFFFF;\r\n    positionElementByIndex(menuTab, this.menu, pos);\r\n\r\n    const promise = this.managers.appStickersManager.getStickerSet(set);\r\n    this.categoryAppendStickers(\r\n      category,\r\n      promise.then((stickerSet) => stickerSet.documents as MyDocument[])\r\n    );\r\n    // const stickerSet = await promise;\r\n\r\n    positionElementByIndex(container, this.scroll.container, pos, -1);\r\n\r\n    wrapStickerSetThumb({\r\n      set,\r\n      container: menuTabPadding,\r\n      group: EMOTICONSSTICKERGROUP,\r\n      lazyLoadQueue: EmoticonsDropdown.lazyLoadQueue,\r\n      width: 32,\r\n      height: 32,\r\n      autoplay: false\r\n    });\r\n  }\r\n\r\n  public init() {\r\n    this.content = document.getElementById('content-stickers');\r\n    const menuWrapper = this.content.previousElementSibling as HTMLDivElement;\r\n    this.menu = menuWrapper.firstElementChild as HTMLUListElement;\r\n\r\n    const menuScroll = new ScrollableX(menuWrapper);\r\n\r\n    this.scroll = new Scrollable(this.content, 'STICKERS');\r\n    this.scroll.onAdditionalScroll = () => {\r\n      setTyping();\r\n    };\r\n\r\n    /* stickersDiv.addEventListener('mouseover', (e) => {\r\n      let target = e.target as HTMLElement;\r\n\r\n      if(target.tagName === 'CANVAS') { // turn on sticker\r\n        let animation = lottieLoader.getAnimation(target.parentElement, EMOTICONSSTICKERGROUP);\r\n\r\n        if(animation) {\r\n          // @ts-ignore\r\n          if(animation.currentFrame === animation.totalFrames - 1) {\r\n            animation.goToAndPlay(0, true);\r\n          } else {\r\n            animation.play();\r\n          }\r\n        }\r\n      }\r\n    }); */\r\n\r\n    const onCategoryVisibility: OnVisibilityChange = ({target, visible, entry}) => {\r\n      const category = this.categoriesMap.get(target);\r\n      // console.log('roll the windows up', category, target, visible, entry);\r\n      if(!visible) {\r\n        category.elements.items.textContent = '';\r\n      } else {\r\n        category.elements.items.append(...category.items.map(({element}) => element));\r\n      }\r\n    };\r\n\r\n    const intersectionOptions: IntersectionObserverInit = {root: emoticonsDropdown.getElement()};\r\n    this.categoriesIntersector = new VisibilityIntersector(onCategoryVisibility, intersectionOptions);\r\n\r\n    const clearCategoryItems = (category: StickersTabCategory) => {\r\n      category.elements.items.textContent = '';\r\n      category.items.forEach(({element}) => this.superStickerRenderer.unobserveAnimated(element));\r\n      category.items.length = 0;\r\n    };\r\n\r\n    this.scroll.container.addEventListener('click', (e) => {\r\n      const target = e.target as HTMLElement;\r\n      if(findUpClassName(target, 'category-title')) {\r\n        const container = findUpClassName(target, 'emoji-category');\r\n        const category = this.categoriesMap.get(container);\r\n        if(category.set.id === 'recent') {\r\n          return;\r\n        }\r\n\r\n        new PopupStickers({id: category.set.id, access_hash: category.set.access_hash}).show();\r\n        return;\r\n      }\r\n\r\n      EmoticonsDropdown.onMediaClick(e);\r\n    });\r\n\r\n    const setTyping = (cancel = false) => {\r\n      rootScope.dispatchEvent('choosing_sticker', !cancel);\r\n    };\r\n\r\n    emoticonsDropdown.addEventListener('closed', () => {\r\n      setTyping(true);\r\n    });\r\n\r\n    emoticonsDropdown.addEventListener('opened', () => {\r\n      setTyping();\r\n    });\r\n\r\n    const {stickyIntersector, setActive} = EmoticonsDropdown.menuOnClick(this.menu, this.scroll, menuScroll);\r\n    this.stickyIntersector = stickyIntersector;\r\n\r\n    const preloader = putPreloader(this.content, true);\r\n\r\n    const createLocalCategory = (id: string, title: LangPackKey, icon?: string) => {\r\n      const category = this.createCategory({id} as any, i18n(title));\r\n      this.localCategories.push(category);\r\n      category.elements.title.classList.add('disable-hover');\r\n      icon && category.elements.menuTab.classList.add('tgico-' + icon);\r\n      category.elements.menuTabPadding.remove();\r\n      this.toggleLocalCategory(category, false);\r\n      return category;\r\n    };\r\n\r\n    const onCategoryStickers = (category: StickersTabCategory, stickers: MyDocument[]) => {\r\n      // if(category.id === 'faved' && category.limit && category.limit < stickers.length) {\r\n      //   category.limit = stickers.length;\r\n      // }\r\n\r\n      if(category.limit) {\r\n        stickers = stickers.slice(0, category.limit);\r\n      }\r\n\r\n      const ids = new Set(stickers.map((doc) => doc.id));\r\n      forEachReverse(category.items, (item) => {\r\n        if(!ids.has(item.document.id)) {\r\n          this.deleteSticker(category, item.document, true);\r\n        }\r\n      });\r\n\r\n      this.toggleLocalCategory(category, !!stickers.length);\r\n      forEachReverse(stickers, (doc, idx) => {\r\n        this.unshiftSticker(category, doc, true, idx);\r\n      });\r\n      this.spliceExceed(category);\r\n      category.elements.container.classList.remove('hide');\r\n    };\r\n\r\n    const favedCategory = createLocalCategory('faved', 'FavoriteStickers', 'saved');\r\n    favedCategory.elements.menuTab.classList.add('active');\r\n\r\n    const recentCategory = createLocalCategory('recent', 'Stickers.Recent', 'recent');\r\n    recentCategory.limit = 20;\r\n    // recentCategory.elements.menuTab.classList.add('active');\r\n\r\n    const clearButton = ButtonIcon('close', {noRipple: true});\r\n    recentCategory.elements.title.append(clearButton);\r\n    attachClickEvent(clearButton, () => {\r\n      confirmationPopup({\r\n        titleLangKey: 'ClearRecentStickersAlertTitle',\r\n        descriptionLangKey: 'ClearRecentStickersAlertMessage',\r\n        button: {\r\n          langKey: 'Clear'\r\n        }\r\n      }).then(() => {\r\n        this.managers.appStickersManager.clearRecentStickers();\r\n      }, noop);\r\n    });\r\n\r\n    const premiumCategory = createLocalCategory('premium', 'PremiumStickersShort');\r\n    const s = document.createElement('span');\r\n    s.classList.add('tgico-star', 'color-premium');\r\n    premiumCategory.elements.menuTab.append(s);\r\n\r\n    const promises = [\r\n      Promise.all([\r\n        this.managers.apiManager.getAppConfig(),\r\n        this.managers.appStickersManager.getFavedStickersStickers()\r\n      ]).then(([appConfig, stickers]) => {\r\n        this.setFavedLimit(appConfig);\r\n        onCategoryStickers(favedCategory, stickers);\r\n      }),\r\n\r\n      this.managers.appStickersManager.getRecentStickersStickers().then((stickers) => {\r\n        onCategoryStickers(recentCategory, stickers);\r\n      }),\r\n\r\n      this.managers.appStickersManager.getAllStickers().then((res) => {\r\n        for(const set of (res as MessagesAllStickers.messagesAllStickers).sets) {\r\n          this.renderStickerSet(set);\r\n        }\r\n      }),\r\n\r\n      this.managers.appStickersManager.getPremiumStickers().then((stickers) => {\r\n        const length = stickers.length;\r\n        this.toggleLocalCategory(premiumCategory, rootScope.premium && !!length);\r\n        this.categoryAppendStickers(premiumCategory, Promise.resolve(stickers));\r\n\r\n        rootScope.addEventListener('premium_toggle', (isPremium) => {\r\n          this.toggleLocalCategory(this.categories['premium'], isPremium && !!length);\r\n        });\r\n      })\r\n    ];\r\n\r\n    Promise.race(promises).finally(() => {\r\n      preloader.remove();\r\n    });\r\n\r\n    Promise.all(promises).finally(() => {\r\n      this.mounted = true;\r\n      setTyping();\r\n      setActive(0);\r\n    });\r\n\r\n    this.superStickerRenderer = new SuperStickerRenderer(EmoticonsDropdown.lazyLoadQueue, EMOTICONSSTICKERGROUP, this.managers, intersectionOptions);\r\n\r\n    const rendererLazyLoadQueue = this.superStickerRenderer.lazyLoadQueue;\r\n    emoticonsDropdown.addLazyLoadQueueRepeat(rendererLazyLoadQueue, this.superStickerRenderer.processInvisible);\r\n\r\n    // emoticonsDropdown.addEventListener('close', () => {\r\n    //   this.categoriesIntersector.lock();\r\n    // });\r\n\r\n    // emoticonsDropdown.addEventListener('closed', () => {\r\n    //   for(const [container] of this.categoriesMap) {\r\n    //     onCategoryVisibility(container, false);\r\n    //   }\r\n    // });\r\n\r\n    // emoticonsDropdown.addEventListener('opened', () => {\r\n    //   this.categoriesIntersector.unlockAndRefresh();\r\n    // });\r\n\r\n    // setInterval(() => {\r\n    //   // @ts-ignore\r\n    //   const players = Object.values(lottieLoader.players).filter((p) => p.width >= 80);\r\n\r\n    //   console.log(\r\n    //     'STICKERS RENDERED IN PANEL:',\r\n    //     players.length,\r\n    //     players.filter((p) => !p.paused).length,\r\n    //     rendererLazyLoadQueue.intersector.getVisible().length\r\n    //   );\r\n    // }, .25e3);\r\n\r\n    rootScope.addEventListener('stickers_installed', (set) => {\r\n      if(!this.categories[set.id] && this.mounted) {\r\n        this.renderStickerSet(set, true);\r\n      }\r\n    });\r\n\r\n    rootScope.addEventListener('stickers_deleted', ({id}) => {\r\n      const category = this.categories[id];\r\n      if(category && this.mounted) {\r\n        category.elements.container.remove();\r\n        category.elements.menuTab.remove();\r\n        this.categoriesIntersector.unobserve(category.elements.container);\r\n        clearCategoryItems(category);\r\n        delete this.categories[id];\r\n        this.categoriesMap.delete(category.elements.container);\r\n      }\r\n    });\r\n\r\n    rootScope.addEventListener('sticker_updated', ({type, document, faved}) => {\r\n      // if(type === 'faved') {\r\n      //   return;\r\n      // }\r\n\r\n      const category = this.categories[type === 'faved' ? 'faved' : 'recent'];\r\n      if(category) {\r\n        if(faved) {\r\n          this.unshiftSticker(category, document);\r\n        } else {\r\n          this.deleteSticker(category, document);\r\n        }\r\n      }\r\n    });\r\n\r\n    rootScope.addEventListener('stickers_updated', ({type, stickers}) => {\r\n      if(this.mounted) {\r\n        const category = this.categories[type === 'faved' ? 'faved' : 'recent'];\r\n        onCategoryStickers(category, stickers);\r\n      }\r\n    });\r\n\r\n    rootScope.addEventListener('app_config', (appConfig) => {\r\n      this.setFavedLimit(appConfig);\r\n    });\r\n\r\n    const resizeCategories = () => {\r\n      for(const [container, category] of this.categoriesMap) {\r\n        this.setCategoryItemsHeight(category);\r\n      }\r\n    };\r\n\r\n    mediaSizes.addEventListener('resize', resizeCategories);\r\n\r\n    emoticonsDropdown.addEventListener('opened', resizeCategories);\r\n\r\n    attachStickerViewerListeners({listenTo: this.content, listenerSetter: new ListenerSetter()});\r\n\r\n    createStickersContextMenu({\r\n      listenTo: this.content,\r\n      verifyRecent: (target) => !!findUpAsChild(target, this.categories['recent'].elements.items),\r\n      onOpen: () => {\r\n        emoticonsDropdown.setIgnoreMouseOut(true);\r\n      },\r\n      onClose: () => {\r\n        emoticonsDropdown.setIgnoreMouseOut(false);\r\n      }\r\n    });\r\n\r\n    this.init = null;\r\n  }\r\n\r\n  private toggleLocalCategory(category: StickersTabCategory, visible: boolean) {\r\n    if(!visible) {\r\n      category.elements.menuTab.remove();\r\n      category.elements.container.remove();\r\n    } else {\r\n      let idx = this.localCategories.indexOf(category);\r\n      const notMounted = this.localCategories.slice(0, idx).filter((category) => !category.mounted);\r\n      idx -= notMounted.length;\r\n      positionElementByIndex(category.elements.menuTab, this.menu, idx);\r\n      positionElementByIndex(category.elements.container, this.scroll.container, idx);\r\n    }\r\n\r\n    category.mounted = visible;\r\n    // category.elements.container.classList.toggle('hide', !visible);\r\n  }\r\n\r\n  private onLocalCategoryUpdate(category: StickersTabCategory) {\r\n    this.setCategoryItemsHeight(category);\r\n    this.toggleLocalCategory(category, !!category.items.length);\r\n  }\r\n\r\n  public deleteSticker(category: StickersTabCategory, doc: MyDocument, batch?: boolean) {\r\n    const item = findAndSplice(category.items, (item) => item.document.id === doc.id);\r\n    if(item) {\r\n      item.element.remove();\r\n\r\n      if(!batch) {\r\n        this.onLocalCategoryUpdate(category);\r\n      }\r\n    }\r\n  }\r\n\r\n  private spliceExceed(category: StickersTabCategory) {\r\n    const {items, limit} = category;\r\n    items.splice(limit, items.length - limit).forEach(({element}) => {\r\n      element.remove();\r\n    });\r\n\r\n    this.onLocalCategoryUpdate(category);\r\n  }\r\n\r\n  public unshiftSticker(category: StickersTabCategory, doc: MyDocument, batch?: boolean, idx?: number) {\r\n    if(idx !== undefined) {\r\n      const i = category.items[idx];\r\n      if(i && i.document.id === doc.id) {\r\n        return;\r\n      }\r\n    }\r\n\r\n    let item = findAndSplice(category.items, (item) => item.document.id === doc.id);\r\n    if(!item) {\r\n      item = {\r\n        element: this.superStickerRenderer.renderSticker(doc),\r\n        document: doc\r\n      };\r\n    }\r\n\r\n    category.items.unshift(item);\r\n    category.elements.items.prepend(item.element);\r\n\r\n    if(!batch) {\r\n      this.spliceExceed(category);\r\n    }\r\n  }\r\n\r\n  public unshiftRecentSticker(doc: MyDocument) {\r\n    this.managers.appStickersManager.saveRecentSticker(doc.id);\r\n  }\r\n\r\n  public deleteRecentSticker(doc: MyDocument) {\r\n    this.managers.appStickersManager.saveRecentSticker(doc.id, true);\r\n  }\r\n\r\n  onClose() {\r\n\r\n  }\r\n}\r\n","import {_i18n} from '../lib/langPack';\n\nexport default function generateFakeIcon(isScam?: boolean) {\n  const span = document.createElement('span');\n  span.classList.add('badge-fake');\n  _i18n(span, isScam ? 'ScamMessage' : 'FakeMessage');\n  return span;\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport findAndSpliceAll from '../helpers/array/findAndSpliceAll';\nimport LazyLoadQueueIntersector from './lazyLoadQueueIntersector';\nimport VisibilityIntersector, {OnVisibilityChange} from './visibilityIntersector';\n\nexport default class LazyLoadQueueRepeat2 extends LazyLoadQueueIntersector {\n  constructor(parallelLimit?: number, protected onVisibilityChange?: OnVisibilityChange) {\n    super(parallelLimit);\n\n    this.intersector = new VisibilityIntersector((item) => {\n      const {target, visible} = item;\n      const spliced = findAndSpliceAll(this.queue, (i) => i.div === target);\n      if(visible && spliced.length) {\n        spliced.forEach((item) => {\n          this.queue.unshift(item);\n        });\n      }\n\n      this.onVisibilityChange && this.onVisibilityChange(item);\n      this.setProcessQueueTimeout();\n    });\n  }\n\n  public observe(el: HTMLElement) {\n    this.intersector.observe(el);\n  }\n}\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport type {MyDocument} from '../lib/appManagers/appDocsManager';\r\nimport {wrapVideo} from './wrappers';\r\nimport animationIntersector, {AnimationItemGroup} from './animationIntersector';\r\nimport Scrollable from './scrollable';\r\nimport deferredPromise, {CancellablePromise} from '../helpers/cancellablePromise';\r\nimport calcImageInBox from '../helpers/calcImageInBox';\r\nimport {doubleRaf} from '../helpers/schedulers';\r\nimport {AppManagers} from '../lib/appManagers/managers';\r\nimport rootScope from '../lib/rootScope';\r\nimport LazyLoadQueueRepeat2 from './lazyLoadQueueRepeat2';\r\n\r\nconst width = 400;\r\nconst maxSingleWidth = width - 100;\r\nconst height = 100;\r\n\r\nexport default class GifsMasonry {\r\n  public lazyLoadQueue: LazyLoadQueueRepeat2;\r\n  private scrollPromise: CancellablePromise<void> = Promise.resolve();\r\n  private timeout: number = 0;\r\n  private managers: AppManagers;\r\n\r\n  constructor(\r\n    private element: HTMLElement,\r\n    private group: AnimationItemGroup,\r\n    private scrollable: Scrollable,\r\n    attach = true\r\n  ) {\r\n    this.managers = rootScope.managers;\r\n\r\n    this.lazyLoadQueue = new LazyLoadQueueRepeat2(undefined, ({target, visible}) => {\r\n      if(visible) {\r\n        this.processVisibleDiv(target);\r\n      } else {\r\n        this.processInvisibleDiv(target);\r\n      }\r\n    });\r\n\r\n    /* setInterval(() => {\r\n      // @ts-ignore\r\n      const players = animationIntersector.byGroups[group];\r\n\r\n      if(players) {\r\n        console.log(`GIFS RENDERED IN ${group}:`, players.length, players.filter((p) => !p.animation.paused).length, this.lazyLoadQueue.intersector.getVisible().length);\r\n      }\r\n    }, .25e3); */\r\n\r\n    if(attach) {\r\n      this.attach();\r\n    }\r\n  }\r\n\r\n  private onScroll = () => {\r\n    if(this.timeout) {\r\n      clearTimeout(this.timeout);\r\n    } else {\r\n      this.scrollPromise = deferredPromise<void>();\r\n      // animationIntersector.checkAnimations(true, group);\r\n    }\r\n\r\n    this.timeout = window.setTimeout(() => {\r\n      this.timeout = 0;\r\n      this.scrollPromise.resolve();\r\n      // animationIntersector.checkAnimations(false, group);\r\n    }, 150);\r\n  };\r\n\r\n  public attach() {\r\n    this.scrollable.container.addEventListener('scroll', this.onScroll);\r\n  }\r\n\r\n  public detach() {\r\n    this.clear();\r\n    this.scrollable.container.removeEventListener('scroll', this.onScroll);\r\n  }\r\n\r\n  public clear() {\r\n    this.lazyLoadQueue.clear();\r\n  }\r\n\r\n  private processVisibleDiv(div: HTMLElement) {\r\n    const video = div.querySelector('video');\r\n    if(video) {\r\n      return;\r\n    }\r\n\r\n    const load = () => {\r\n      const docId = div.dataset.docId;\r\n      const promise = Promise.all([this.managers.appDocsManager.getDoc(docId), this.scrollPromise]).then(async([doc]) => {\r\n        const res = await wrapVideo({\r\n          doc,\r\n          container: div as HTMLDivElement,\r\n          lazyLoadQueue: null,\r\n          // lazyLoadQueue: EmoticonsDropdown.lazyLoadQueue,\r\n          group: this.group,\r\n          noInfo: true,\r\n          noPreview: true\r\n        });\r\n\r\n        const promise = res.loadPromise;\r\n        promise.finally(() => {\r\n          const video = div.querySelector('video');\r\n          const thumb = div.querySelector('img, canvas');\r\n\r\n          // div.style.opacity = '';\r\n          thumb && thumb.classList.add('hide');\r\n\r\n          if(video && !video.parentElement) {\r\n            setTimeout(() => {\r\n              video.src = '';\r\n              video.load();\r\n              const animations = animationIntersector.getAnimations(video);\r\n              animations.forEach((item) => {\r\n                animationIntersector.checkAnimation(item, true, true);\r\n              });\r\n            }, 0);\r\n          }\r\n\r\n          // clearTimeout(timeout);\r\n          if(!this.lazyLoadQueue.intersector.isVisible(div)) {\r\n            this.processInvisibleDiv(div);\r\n          }\r\n        });\r\n\r\n        return promise;\r\n      });\r\n\r\n      /* let timeout = window.setTimeout(() => {\r\n        console.error('processVisibleDiv timeout', div, doc);\r\n      }, 1e3); */\r\n\r\n      return promise;\r\n    };\r\n\r\n    // return load();\r\n\r\n    this.lazyLoadQueue.push({div, load});\r\n  }\r\n\r\n  public processInvisibleDiv = (div: HTMLElement) => {\r\n    return this.scrollPromise.then(async() => {\r\n      // return;\r\n\r\n      if(this.lazyLoadQueue.intersector.isVisible(div)) {\r\n        return;\r\n      }\r\n\r\n      const video = div.querySelector('video');\r\n      const thumb = div.querySelector('img, canvas');\r\n\r\n      if(thumb) {\r\n        thumb.classList.remove('hide');\r\n\r\n        await doubleRaf();\r\n      }\r\n\r\n      if(this.lazyLoadQueue.intersector.isVisible(div)) {\r\n        return;\r\n      }\r\n\r\n      if(video) {\r\n        video.remove();\r\n        video.src = '';\r\n        video.load();\r\n        const animations = animationIntersector.getAnimations(video);\r\n        animations.forEach((item) => {\r\n          animationIntersector.checkAnimation(item, true, true);\r\n        });\r\n      }\r\n    });\r\n  };\r\n\r\n  public add(doc: MyDocument, appendTo = this.element) {\r\n    let gifWidth = doc.w;\r\n    let gifHeight = doc.h;\r\n    if(gifHeight < height) {\r\n      gifWidth = height / gifHeight * gifWidth;\r\n      gifHeight = height;\r\n    }\r\n\r\n    const willUseWidth = Math.min(maxSingleWidth, width, gifWidth);\r\n    const size = calcImageInBox(gifWidth, gifHeight, willUseWidth, height);\r\n\r\n    const div = document.createElement('div');\r\n    div.classList.add('gif'/* , 'fade-in-transition' */);\r\n    div.style.width = size.width + 'px';\r\n    // div.style.opacity = '0';\r\n    // div.style.height = h + 'px';\r\n    div.dataset.docId = '' + doc.id;\r\n\r\n    appendTo.append(div);\r\n\r\n    this.lazyLoadQueue.observe(div);\r\n\r\n    // let preloader = new ProgressivePreloader(div);\r\n\r\n    wrapVideo({\r\n      doc,\r\n      container: div as HTMLDivElement,\r\n      lazyLoadQueue: null,\r\n      noInfo: true,\r\n      onlyPreview: true\r\n    });\r\n  }\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport {TransitionSlider} from './transition';\r\nimport {ScrollableX} from './scrollable';\r\nimport rootScope from '../lib/rootScope';\r\nimport {fastRaf} from '../helpers/schedulers';\r\nimport {FocusDirection} from '../helpers/fastSmoothScroll';\r\nimport findUpAsChild from '../helpers/dom/findUpAsChild';\r\nimport whichChild from '../helpers/dom/whichChild';\r\nimport ListenerSetter from '../helpers/listenerSetter';\r\nimport {attachClickEvent} from '../helpers/dom/clickEvent';\r\n\r\nexport function horizontalMenu(\r\n  tabs: HTMLElement,\r\n  content: HTMLElement,\r\n  onClick?: (id: number, tabContent: HTMLDivElement, animate: boolean) => void | boolean | Promise<void | boolean>,\r\n  onTransitionEnd?: () => void,\r\n  transitionTime = 250,\r\n  scrollableX?: ScrollableX,\r\n  listenerSetter?: ListenerSetter\r\n) {\r\n  const selectTab = TransitionSlider(content, tabs || content.dataset.animation === 'tabs' ? 'tabs' : 'navigation', transitionTime, onTransitionEnd, undefined, listenerSetter);\r\n\r\n  if(!tabs) {\r\n    return selectTab;\r\n  }\r\n\r\n  const proxy = new Proxy(selectTab, {\r\n    apply: (target, that, args) => {\r\n      const id = +args[0];\r\n      const animate = args[1] !== undefined ? args[1] : true;\r\n\r\n      const el = (tabs.querySelector(`[data-tab=\"${id}\"]`) || tabs.children[id]) as HTMLElement;\r\n      selectTarget(el, id, animate);\r\n    }\r\n  });\r\n\r\n  const selectTarget = async(target: HTMLElement, id: number, animate = true) => {\r\n    const tabContent = content.children[id] as HTMLDivElement;\r\n\r\n    if(onClick) {\r\n      const result1 = onClick(id, tabContent, animate);\r\n      const canChange = result1 instanceof Promise ? await result1 : result1;\r\n      if(canChange !== undefined && !canChange) {\r\n        return;\r\n      }\r\n    }\r\n\r\n    if(scrollableX) {\r\n      scrollableX.scrollIntoViewNew({\r\n        element: target.parentElement.children[id] as HTMLElement,\r\n        position: 'center',\r\n        forceDirection: animate ? undefined : FocusDirection.Static,\r\n        forceDuration: transitionTime,\r\n        axis: 'x'\r\n      });\r\n    }\r\n\r\n    if(!rootScope.settings.animationsEnabled) {\r\n      animate = false;\r\n    }\r\n\r\n    const prevId = selectTab.prevId();\r\n    if(target.classList.contains('active') || id === prevId) {\r\n      return false;\r\n    }\r\n\r\n    const mutateCallback = animate ? fastRaf : (cb: () => void) => cb();\r\n\r\n    const prev = tabs.querySelector(tagName.toLowerCase() + '.active') as HTMLElement;\r\n    if(prev) {\r\n      mutateCallback(() => {\r\n        prev.classList.remove('active');\r\n      });\r\n    }\r\n\r\n    // a great stripe from Jolly Cobra\r\n    if(useStripe && prevId !== -1 && animate) {\r\n      mutateCallback(() => {\r\n        const indicator = target.querySelector('i')!;\r\n        const currentIndicator = target.parentElement.children[prevId].querySelector('i')!;\r\n\r\n        currentIndicator.classList.remove('animate');\r\n        indicator.classList.remove('animate');\r\n\r\n        // We move and resize our indicator so it repeats the position and size of the previous one.\r\n        const shiftLeft = currentIndicator.parentElement.parentElement.offsetLeft - indicator.parentElement.parentElement.offsetLeft;\r\n        const scaleFactor = currentIndicator.clientWidth / indicator.clientWidth;\r\n        indicator.style.transform = `translate3d(${shiftLeft}px, 0, 0) scale3d(${scaleFactor}, 1, 1)`;\r\n\r\n        // console.log(`translate3d(${shiftLeft}px, 0, 0) scale3d(${scaleFactor}, 1, 1)`);\r\n\r\n        fastRaf(() => {\r\n          // Now we remove the transform to let it animate to its own position and size.\r\n          indicator.classList.add('animate');\r\n          indicator.style.transform = 'none';\r\n        });\r\n      });\r\n    }\r\n\r\n    mutateCallback(() => {\r\n      target.classList.add('active');\r\n    });\r\n\r\n    selectTab(id, animate);\r\n  };\r\n\r\n  const useStripe = !tabs.classList.contains('no-stripe');\r\n\r\n  // const tagName = tabs.classList.contains('menu-horizontal-div') ? 'BUTTON' : 'LI';\r\n  const tagName = tabs.firstElementChild.tagName;\r\n  attachClickEvent(tabs, (e) => {\r\n    let target = e.target as HTMLElement;\r\n\r\n    target = findUpAsChild(target, tabs);\r\n\r\n    // console.log('tabs click:', target);\r\n\r\n    if(!target) return false;\r\n\r\n    let id: number;\r\n    if(target.dataset.tab) {\r\n      id = +target.dataset.tab;\r\n      if(id === -1) {\r\n        return false;\r\n      }\r\n    } else {\r\n      id = whichChild(target);\r\n    }\r\n\r\n    selectTarget(target, id);\r\n  }, {listenerSetter});\r\n\r\n  return proxy;\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport cancelEvent from '../helpers/dom/cancelEvent';\r\nimport simulateEvent from '../helpers/dom/dispatchEvent';\r\nimport documentFragmentToHTML from '../helpers/dom/documentFragmentToHTML';\r\nimport findUpAttribute from '../helpers/dom/findUpAttribute';\r\nimport getRichValue from '../helpers/dom/getRichValue';\r\nimport isInputEmpty from '../helpers/dom/isInputEmpty';\r\nimport selectElementContents from '../helpers/dom/selectElementContents';\r\nimport setInnerHTML from '../helpers/dom/setInnerHTML';\r\nimport {MessageEntity} from '../layer';\r\nimport {i18n, LangPackKey, _i18n} from '../lib/langPack';\r\nimport mergeEntities from '../lib/richTextProcessor/mergeEntities';\r\nimport parseEntities from '../lib/richTextProcessor/parseEntities';\r\nimport wrapDraftText from '../lib/richTextProcessor/wrapDraftText';\r\n\r\nlet init = () => {\r\n  document.addEventListener('paste', (e) => {\r\n    const input = findUpAttribute(e.target, 'contenteditable=\"true\"');\r\n    if(!input) {\r\n      return;\r\n    }\r\n\r\n    const noLinebreaks = !!input.dataset.noLinebreaks;\r\n    e.preventDefault();\r\n    let text: string, entities: MessageEntity[];\r\n\r\n    // @ts-ignore\r\n    let plainText: string = (e.originalEvent || e).clipboardData.getData('text/plain');\r\n    let usePlainText = true;\r\n\r\n    // @ts-ignore\r\n    let html: string = (e.originalEvent || e).clipboardData.getData('text/html');\r\n\r\n    const filterEntity = (e: MessageEntity) => e._ === 'messageEntityEmoji' || (e._ === 'messageEntityLinebreak' && !noLinebreaks);\r\n    if(noLinebreaks) {\r\n      const regExp = /[\\r\\n]/g;\r\n      plainText = plainText.replace(regExp, '');\r\n      html = html.replace(regExp, '');\r\n    }\r\n\r\n    if(html.trim()) {\r\n      html = html.replace(/<style([\\s\\S]*)<\\/style>/, '');\r\n      html = html.replace(/<!--([\\s\\S]*)-->/, '');\r\n\r\n      const match = html.match(/<body>([\\s\\S]*)<\\/body>/);\r\n      if(match) {\r\n        html = match[1].trim();\r\n      }\r\n\r\n      const span: HTMLElement = document.createElement('span');\r\n      span.innerHTML = html;\r\n\r\n      let curChild = span.firstChild;\r\n      while(curChild) { // * fix whitespace between elements like <p>asd</p>\\n<p>zxc</p>\r\n        const nextSibling = curChild.nextSibling;\r\n        if(curChild.nodeType === 3) {\r\n          if(!curChild.nodeValue.trim()) {\r\n            curChild.remove();\r\n          }\r\n        }\r\n\r\n        curChild = nextSibling;\r\n      }\r\n\r\n      const richValue = getRichValue(span, true);\r\n      if(richValue.value.replace(/\\s/g, '').length === plainText.replace(/\\s/g, '').length) {\r\n        text = richValue.value;\r\n        entities = richValue.entities;\r\n        usePlainText = false;\r\n\r\n        let entities2 = parseEntities(text);\r\n        entities2 = entities2.filter(filterEntity);\r\n        mergeEntities(entities, entities2);\r\n      }\r\n    }\r\n\r\n    if(usePlainText) {\r\n      text = plainText;\r\n      entities = parseEntities(text);\r\n      entities = entities.filter(filterEntity);\r\n    }\r\n\r\n    const fragment = wrapDraftText(text, {entities});\r\n    text = documentFragmentToHTML(fragment);\r\n\r\n    window.document.execCommand('insertHTML', false, text);\r\n  });\r\n\r\n  init = null;\r\n};\r\n\r\n// ! it doesn't respect symbols other than strongs\r\n/* const checkAndSetRTL = (input: HTMLElement) => {\r\n  //const isEmpty = isInputEmpty(input);\r\n  //console.log('input', isEmpty);\r\n\r\n  //const char = [...getRichValue(input)][0];\r\n  const char = (input instanceof HTMLInputElement ? input.value : input.innerText)[0];\r\n  let direction = 'ltr';\r\n  if(char && checkRTL(char)) {\r\n    direction = 'rtl';\r\n  }\r\n\r\n  //console.log('RTL', direction, char);\r\n\r\n  input.style.direction = direction;\r\n}; */\r\n\r\nexport enum InputState {\r\n  Neutral = 0,\r\n  Valid = 1,\r\n  Error = 2\r\n};\r\n\r\nexport type InputFieldOptions = {\r\n  placeholder?: LangPackKey,\r\n  label?: LangPackKey,\r\n  labelOptions?: any[],\r\n  labelText?: string | DocumentFragment,\r\n  name?: string,\r\n  maxLength?: number,\r\n  showLengthOn?: number,\r\n  plainText?: true,\r\n  required?: boolean,\r\n  canBeEdited?: boolean,\r\n  validate?: () => boolean,\r\n  inputMode?: 'tel' | 'numeric',\r\n  withLinebreaks?: boolean,\r\n  autocomplete?: string\r\n};\r\n\r\nexport default class InputField {\r\n  public container: HTMLElement;\r\n  public input: HTMLElement;\r\n  public label: HTMLLabelElement;\r\n\r\n  public originalValue: string;\r\n\r\n  public required: boolean;\r\n  public validate: () => boolean;\r\n\r\n  constructor(public options: InputFieldOptions = {}) {\r\n    this.container = document.createElement('div');\r\n    this.container.classList.add('input-field');\r\n\r\n    this.required = options.required;\r\n    this.validate = options.validate;\r\n\r\n    if(options.maxLength !== undefined && options.showLengthOn === undefined) {\r\n      options.showLengthOn = Math.min(40, Math.round(options.maxLength / 3));\r\n    }\r\n\r\n    const {placeholder, maxLength, showLengthOn, name, plainText, canBeEdited = true, autocomplete} = options;\r\n    const label = options.label || options.labelText;\r\n\r\n    const onInputCallbacks: Array<() => void> = [];\r\n    let input: HTMLElement;\r\n    if(!plainText) {\r\n      if(init) {\r\n        init();\r\n      }\r\n\r\n      this.container.innerHTML = `\r\n      <div contenteditable=\"${String(!!canBeEdited)}\" class=\"input-field-input\"></div>\r\n      `;\r\n\r\n      input = this.container.firstElementChild as HTMLElement;\r\n      // const observer = new MutationObserver(() => {\r\n      //   //checkAndSetRTL(input);\r\n\r\n      //   if(processInput) {\r\n      //     processInput();\r\n      //   }\r\n      // });\r\n\r\n      onInputCallbacks.push(() => {\r\n        // * because if delete all characters there will br left\r\n        if(isInputEmpty(input)) {\r\n          input.textContent = '';\r\n        }\r\n      });\r\n\r\n      // ! childList for paste first symbol\r\n      // observer.observe(input, {characterData: true, childList: true, subtree: true});\r\n    } else {\r\n      this.container.innerHTML = `\r\n      <input type=\"text\" ${name ? `name=\"${name}\"` : ''} autocomplete=\"${autocomplete ?? 'off'}\" ${label ? 'required=\"\"' : ''} class=\"input-field-input\">\r\n      `;\r\n\r\n      input = this.container.firstElementChild as HTMLElement;\r\n      // input.addEventListener('input', () => checkAndSetRTL(input));\r\n    }\r\n\r\n    input.setAttribute('dir', 'auto');\r\n\r\n    if(options.inputMode) {\r\n      input.inputMode = options.inputMode;\r\n    }\r\n\r\n    if(placeholder) {\r\n      _i18n(input, placeholder, undefined, 'placeholder');\r\n    }\r\n\r\n    if(label || placeholder) {\r\n      const border = document.createElement('div');\r\n      border.classList.add('input-field-border');\r\n      this.container.append(border);\r\n    }\r\n\r\n    if(label) {\r\n      this.label = document.createElement('label');\r\n      this.setLabel();\r\n      this.container.append(this.label);\r\n    }\r\n\r\n    if(maxLength) {\r\n      const labelEl = this.container.lastElementChild as HTMLLabelElement;\r\n      let showingLength = false;\r\n\r\n      const onInput = () => {\r\n        const wasError = input.classList.contains('error');\r\n        // * https://stackoverflow.com/a/54369605 #2 to count emoji as 1 symbol\r\n        const inputLength = plainText ? (input as HTMLInputElement).value.length : [...getRichValue(input, false).value].length;\r\n        const diff = maxLength - inputLength;\r\n        const isError = diff < 0;\r\n        input.classList.toggle('error', isError);\r\n\r\n        // this.onLengthChange && this.onLengthChange(inputLength, isError);\r\n\r\n        if(isError || diff <= showLengthOn) {\r\n          this.setLabel();\r\n          labelEl.append(` (${maxLength - inputLength})`);\r\n          if(!showingLength) showingLength = true;\r\n        } else if((wasError && !isError) || showingLength) {\r\n          this.setLabel();\r\n          showingLength = false;\r\n        }\r\n      };\r\n\r\n      onInputCallbacks.push(onInput);\r\n    }\r\n\r\n    const noLinebreaks = !options.withLinebreaks;\r\n    if(noLinebreaks && !plainText) {\r\n      input.dataset.noLinebreaks = '1';\r\n      input.addEventListener('keypress', (e) => {\r\n        if(e.key === 'Enter') {\r\n          e.preventDefault();\r\n          return false;\r\n        }\r\n      });\r\n    }\r\n\r\n    if(onInputCallbacks.length) {\r\n      input.addEventListener('input', () => {\r\n        onInputCallbacks.forEach((callback) => callback());\r\n      });\r\n    }\r\n\r\n    this.input = input;\r\n  }\r\n\r\n  public select() {\r\n    if(!this.value) { // * avoid selecting whole empty field on iOS devices\r\n      return;\r\n    }\r\n\r\n    if(this.options.plainText) {\r\n      (this.input as HTMLInputElement).select(); // * select text\r\n    } else {\r\n      selectElementContents(this.input);\r\n    }\r\n  }\r\n\r\n  public setLabel() {\r\n    this.label.textContent = '';\r\n    if(this.options.labelText) {\r\n      setInnerHTML(this.label, this.options.labelText);\r\n    } else {\r\n      this.label.append(i18n(this.options.label, this.options.labelOptions));\r\n    }\r\n  }\r\n\r\n  get value() {\r\n    return this.options.plainText ? (this.input as HTMLInputElement).value : getRichValue(this.input, false).value;\r\n    // return getRichValue(this.input);\r\n  }\r\n\r\n  set value(value: string) {\r\n    this.setValueSilently(value, true);\r\n\r\n    simulateEvent(this.input, 'input');\r\n  }\r\n\r\n  public setValueSilently(value: string, fromSet?: boolean) {\r\n    if(this.options.plainText) {\r\n      (this.input as HTMLInputElement).value = value;\r\n    } else {\r\n      this.input.innerHTML = value;\r\n    }\r\n  }\r\n\r\n  public isChanged() {\r\n    return this.value !== this.originalValue;\r\n  }\r\n\r\n  public isValid() {\r\n    return !this.input.classList.contains('error') &&\r\n      (!this.validate || this.validate()) &&\r\n      (!this.required || !isInputEmpty(this.input));\r\n  }\r\n\r\n  public isValidToChange() {\r\n    return this.isValid() && this.isChanged();\r\n  }\r\n\r\n  public setDraftValue(value = '', silent?: boolean) {\r\n    if(!this.options.plainText) {\r\n      value = documentFragmentToHTML(wrapDraftText(value));\r\n    }\r\n\r\n    if(silent) {\r\n      this.setValueSilently(value, false);\r\n    } else {\r\n      this.value = value;\r\n    }\r\n  }\r\n\r\n  public setOriginalValue(value: InputField['originalValue'] = '', silent?: boolean) {\r\n    this.originalValue = value;\r\n    this.setDraftValue(value, silent);\r\n  }\r\n\r\n  public setState(state: InputState, label?: LangPackKey) {\r\n    if(label) {\r\n      this.label.textContent = '';\r\n      this.label.append(i18n(label, this.options.labelOptions));\r\n    } else {\r\n      this.setLabel();\r\n    }\r\n\r\n    this.input.classList.toggle('error', !!(state & InputState.Error));\r\n    this.input.classList.toggle('valid', !!(state & InputState.Valid));\r\n  }\r\n\r\n  public setError(label?: LangPackKey) {\r\n    this.setState(InputState.Error, label);\r\n  }\r\n}\r\n","// https://stackoverflow.com/a/6150060\nexport default function selectElementContents(el: HTMLElement) {\n  const range = document.createRange();\n  range.selectNodeContents(el);\n  const sel = window.getSelection();\n  sel.removeAllRanges();\n  sel.addRange(range);\n}\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\n// import { getRichValue } from \"../helpers/dom\";\r\nimport {LangPackKey} from '../lib/langPack';\r\nimport InputField from './inputField';\r\n\r\nexport default class InputSearch {\r\n  public container: HTMLElement;\r\n  public input: HTMLElement;\r\n  public inputField: InputField;\r\n  public clearBtn: HTMLElement;\r\n\r\n  public prevValue = '';\r\n  public timeout = 0;\r\n  public onChange: (value: string) => void;\r\n  public onClear: () => void;\r\n\r\n  constructor(placeholder: LangPackKey, onChange?: (value: string) => void) {\r\n    this.inputField = new InputField({\r\n      placeholder,\r\n      plainText: true\r\n    });\r\n\r\n    this.container = this.inputField.container;\r\n    this.container.classList.remove('input-field');\r\n    this.container.classList.add('input-search');\r\n\r\n    this.onChange = onChange;\r\n\r\n    this.input = this.inputField.input;\r\n    this.input.classList.add('input-search-input');\r\n\r\n    const searchIcon = document.createElement('i');\r\n    searchIcon.classList.add('tgico', 'tgico-search');\r\n\r\n    this.clearBtn = document.createElement('i');\r\n    this.clearBtn.classList.add('tgico', 'btn-icon', 'tgico-close');\r\n\r\n    this.input.addEventListener('input', this.onInput);\r\n    this.clearBtn.addEventListener('click', this.onClearClick);\r\n\r\n    this.container.append(searchIcon, this.clearBtn);\r\n  }\r\n\r\n  onInput = () => {\r\n    if(!this.onChange) return;\r\n\r\n    const value = this.value;\r\n\r\n    // this.input.classList.toggle('is-empty', !value.trim());\r\n\r\n    if(value !== this.prevValue) {\r\n      this.prevValue = value;\r\n      clearTimeout(this.timeout);\r\n      this.timeout = window.setTimeout(() => {\r\n        this.onChange(value);\r\n      }, 200);\r\n    }\r\n  };\r\n\r\n  onClearClick = () => {\r\n    this.value = '';\r\n    this.onChange && this.onChange('');\r\n    this.onClear && this.onClear();\r\n  };\r\n\r\n  get value() {\r\n    return this.inputField.value;\r\n  }\r\n\r\n  set value(value: string) {\r\n    this.prevValue = value;\r\n    clearTimeout(this.timeout);\r\n    this.inputField.value = value;\r\n  }\r\n\r\n  public remove() {\r\n    clearTimeout(this.timeout);\r\n    this.input.removeEventListener('input', this.onInput);\r\n    this.clearBtn.removeEventListener('click', this.onClearClick);\r\n  }\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport VisibilityIntersector, {OnVisibilityChangeItem} from './visibilityIntersector';\r\nimport findAndSpliceAll from '../helpers/array/findAndSpliceAll';\r\nimport findAndSplice from '../helpers/array/findAndSplice';\r\nimport LazyLoadQueueIntersector, {LazyLoadElement} from './lazyLoadQueueIntersector';\r\n\r\nexport default class LazyLoadQueue extends LazyLoadQueueIntersector {\r\n  constructor(parallelLimit?: number) {\r\n    super(parallelLimit);\r\n\r\n    this.intersector = new VisibilityIntersector(this.onVisibilityChange);\r\n  }\r\n\r\n  private onVisibilityChange = ({target, visible}: OnVisibilityChangeItem) => {\r\n    if(visible) {\r\n      /* if(DEBUG) {\r\n        this.log('isIntersecting', target);\r\n      } */\r\n\r\n      // need for set element first if scrolled\r\n      findAndSpliceAll(this.queue, (i) => i.div === target).forEach((item) => {\r\n        item.wasSeen = true;\r\n        this.queue.unshift(item);\r\n        // this.processQueue(item);\r\n      });\r\n\r\n      this.setProcessQueueTimeout();\r\n    }\r\n  };\r\n\r\n  protected getItem() {\r\n    return findAndSplice(this.queue, item => item.wasSeen);\r\n  }\r\n\r\n  public async processItem(item: LazyLoadElement) {\r\n    await super.processItem(item);\r\n    this.intersector.unobserve(item.div);\r\n  }\r\n\r\n  protected addElement(method: 'push' | 'unshift', el: LazyLoadElement) {\r\n    const inserted = super.addElement(method, el);\r\n\r\n    if(!inserted) return false;\r\n\r\n    this.intersector.observe(el.div);\r\n    /* if(el.wasSeen) {\r\n      this.processQueue(el);\r\n    } else  */if(!el.hasOwnProperty('wasSeen')) {\r\n      el.wasSeen = false;\r\n    }\r\n\r\n    return true;\r\n  }\r\n}\r\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport findAndSpliceAll from '../helpers/array/findAndSpliceAll';\nimport LazyLoadQueueBase, {LazyLoadElementBase} from './lazyLoadQueueBase';\nimport VisibilityIntersector from './visibilityIntersector';\n\nexport type LazyLoadElement = Omit<LazyLoadElementBase, 'load'> & {\n  load: (target?: HTMLElement) => Promise<any>,\n  div: HTMLElement\n  wasSeen?: boolean,\n};\n\nexport default class LazyLoadQueueIntersector extends LazyLoadQueueBase {\n  protected queue: Array<LazyLoadElement> = [];\n  protected inProcess: Set<LazyLoadElement> = new Set();\n\n  public intersector: VisibilityIntersector;\n  protected intersectorTimeout: number;\n\n  constructor(parallelLimit?: number) {\n    super(parallelLimit);\n  }\n\n  public lock() {\n    super.lock();\n    this.intersector.lock();\n  }\n\n  public unlock() {\n    super.unlock();\n    this.intersector.unlock();\n  }\n\n  public unlockAndRefresh() {\n    super.unlock();\n    this.intersector.unlockAndRefresh();\n  }\n\n  public clear() {\n    super.clear();\n    this.intersector.disconnect();\n  }\n\n  public refresh() {\n    this.intersector.refresh();\n  }\n\n  protected loadItem(item: LazyLoadElement) {\n    return item.load(item.div);\n  }\n\n  protected addElement(method: 'push' | 'unshift', el: LazyLoadElement) {\n    const item = this.queue.find((i) => i.div === el.div && i.load === el.load);\n    if(item) {\n      return false;\n    } else {\n      for(const item of this.inProcess) {\n        if(item.div === el.div && item.load === el.load) {\n          return false;\n        }\n      }\n    }\n\n    this.queue[method](el);\n    return true;\n  }\n\n  protected setProcessQueueTimeout() {\n    if(!this.intersectorTimeout) {\n      this.intersectorTimeout = window.setTimeout(() => {\n        this.intersectorTimeout = 0;\n        this.processQueue();\n      }, 0);\n    }\n  }\n\n  public push(el: LazyLoadElement) {\n    super.push(el);\n  }\n\n  public unshift(el: LazyLoadElement) {\n    super.unshift(el);\n  }\n\n  public unobserve(el: HTMLElement) {\n    findAndSpliceAll(this.queue, (i) => i.div === el);\n\n    this.intersector.unobserve(el);\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport {GrabEvent} from '../helpers/dom/attachGrabListeners';\nimport appMediaPlaybackController from './appMediaPlaybackController';\nimport RangeSelector from './rangeSelector';\n\nexport default class MediaProgressLine extends RangeSelector {\n  protected filledLoad: HTMLDivElement;\n\n  protected progressRAF = 0;\n\n  protected media: HTMLMediaElement;\n  protected streamable: boolean;\n\n  constructor(media?: HTMLAudioElement | HTMLVideoElement, streamable?: boolean, withTransition?: boolean, useTransform?: boolean) {\n    super({\n      step: 1000 / 60 / 1000,\n      min: 0,\n      max: 1,\n      withTransition,\n      useTransform\n    }, 0);\n\n    if(media) {\n      this.setMedia(media, streamable);\n    }\n  }\n\n  public setMedia(media: HTMLMediaElement, streamable = false) {\n    if(this.media) {\n      this.removeListeners();\n    }\n\n    if(streamable && !this.filledLoad) {\n      this.filledLoad = document.createElement('div');\n      this.filledLoad.classList.add('progress-line__filled', 'progress-line__loaded');\n      this.container.prepend(this.filledLoad);\n      // this.setLoadProgress();\n    } else if(this.filledLoad) {\n      this.filledLoad.classList.toggle('hide', !streamable);\n    }\n\n    this.media = media;\n    this.streamable = streamable;\n    if(!media.paused || media.currentTime > 0) {\n      this.onPlay();\n    }\n\n    let wasPlaying = false;\n    this.setSeekMax();\n    this.setListeners();\n    this.setHandlers({\n      onMouseDown: () => {\n        wasPlaying = !this.media.paused;\n        wasPlaying && this.media.pause();\n      },\n\n      onMouseUp: (e) => {\n        // cancelEvent(e.event);\n        wasPlaying && this.media.play();\n      }\n    });\n  }\n\n  protected onLoadedData = () => {\n    this.max = this.media.duration;\n    this.seek.setAttribute('max', '' + this.max);\n  };\n\n  protected onEnded = () => {\n    this.setProgress();\n  };\n\n  protected onPlay = () => {\n    const r = () => {\n      this.setProgress();\n\n      this.progressRAF = this.media.paused ? 0 : window.requestAnimationFrame(r);\n    };\n\n    if(this.progressRAF) {\n      window.cancelAnimationFrame(this.progressRAF);\n    }\n\n    if(this.streamable) {\n      this.setLoadProgress();\n    }\n\n    this.progressRAF = window.requestAnimationFrame(r);\n  };\n\n  protected onTimeUpdate = () => {\n    if(this.media.paused) {\n      this.setProgress();\n\n      if(this.streamable) {\n        this.setLoadProgress();\n      }\n    }\n  };\n\n  protected onProgress = (e: Event) => {\n    this.setLoadProgress();\n  };\n\n  protected scrub(e: GrabEvent) {\n    const scrubTime = super.scrub(e);\n    this.media.currentTime = scrubTime;\n    return scrubTime;\n  }\n\n  protected setLoadProgress() {\n    if(appMediaPlaybackController.isSafariBuffering(this.media)) return;\n    const buf = this.media.buffered;\n    const numRanges = buf.length;\n\n    const currentTime = this.media.currentTime;\n    let nearestStart = 0, end = 0;\n    for(let i = 0; i < numRanges; ++i) {\n      const start = buf.start(i);\n      if(currentTime >= start && start >= nearestStart) {\n        nearestStart = start;\n        end = buf.end(i);\n      }\n\n      // console.log('onProgress range:', i, buf.start(i), buf.end(i), this.media);\n    }\n\n    // console.log('onProgress correct range:', nearestStart, end, this.media);\n\n    const percents = this.media.duration ? end / this.media.duration : 0;\n    this.filledLoad.style.width = (percents * 100) + '%';\n    // this.filledLoad.style.transform = 'scaleX(' + percents + ')';\n  }\n\n  protected setSeekMax() {\n    this.max = this.media.duration || 0;\n    if(this.max > 0) {\n      this.onLoadedData();\n    } else {\n      this.media.addEventListener('loadeddata', this.onLoadedData);\n    }\n  }\n\n  public setProgress() {\n    if(appMediaPlaybackController.isSafariBuffering(this.media)) return;\n    const currentTime = this.media.currentTime;\n\n    super.setProgress(currentTime);\n  }\n\n  public setListeners() {\n    super.setListeners();\n    this.media.addEventListener('ended', this.onEnded);\n    this.media.addEventListener('play', this.onPlay);\n    this.media.addEventListener('timeupdate', this.onTimeUpdate);\n    this.streamable && this.media.addEventListener('progress', this.onProgress);\n  }\n\n  public removeListeners() {\n    super.removeListeners();\n\n    if(this.media) {\n      this.media.removeEventListener('loadeddata', this.onLoadedData);\n      this.media.removeEventListener('ended', this.onEnded);\n      this.media.removeEventListener('play', this.onPlay);\n      this.media.removeEventListener('timeupdate', this.onTimeUpdate);\n      this.streamable && this.media.removeEventListener('progress', this.onProgress);\n    }\n\n    if(this.progressRAF) {\n      window.cancelAnimationFrame(this.progressRAF);\n      this.progressRAF = 0;\n    }\n  }\n}\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport {FontFamily, FontSize, FontWeight} from '../config/font';\r\nimport getTextWidth from '../helpers/canvas/getTextWidth';\r\nimport mediaSizes from '../helpers/mediaSizes';\r\nimport clamp from '../helpers/number/clamp';\r\nimport {fastRaf} from '../helpers/schedulers';\r\n\r\n// Thanks to https://stackoverflow.com/a/49349813\r\n\r\n/**\r\n * Attibute modifier to create middle ellipsis\r\n * When the attribute value is left blank the ellipsis will be in the middle\r\n * When positive the attribute value will be used as a percentage\r\n * When negative the attribute value will be used as character index counted from the end\r\n * @example\r\n *   <div data-middle-ellipsis>A Javascript solution to middle ellipsis</div>\r\n *   <div data-middle-ellipsis=\"20\">A Javascript solution to middle ellipsis</div>\r\n *   <div data-middle-ellipsis=\"-3\">A Javascript solution to middle ellipsis</div>\r\n */\r\nconst ellipsis = '';\r\nconst map: Map<HTMLElement, {\r\n  text: string,\r\n  textLength: number,\r\n  from: number,\r\n  multiplier: number,\r\n  font: string,\r\n  textWidth: number,\r\n  elementWidth: number\r\n}> = new Map();\r\n\r\nconst testQueue: Set<HTMLElement> = new Set();\r\nconst fontSize = '16px';\r\nlet pendingTest = false;\r\n\r\nfunction setTestQueue() {\r\n  if(pendingTest) {\r\n    return;\r\n  }\r\n\r\n  pendingTest = true;\r\n  fastRaf(() => {\r\n    pendingTest = false;\r\n    testQueueElements();\r\n  });\r\n}\r\n\r\nfunction testQueueElements() {\r\n  testQueue.forEach(testElement);\r\n  testQueue.clear();\r\n}\r\n\r\nwindow.addEventListener('resize', () => {\r\n  for(const [key] of map) {\r\n    testQueue.add(key);\r\n  }\r\n\r\n  setTestQueue();\r\n}, {capture: true, passive: true});\r\n\r\nfunction getElementWidth(element: HTMLElement) {\r\n  const type = element.dataset.sizeType;\r\n  if(type) {\r\n    const mediaSize = mediaSizes.active;\r\n    // @ts-ignore\r\n    const size: MediaSize = mediaSize[type];\r\n    return size.width;\r\n  }\r\n\r\n  return element.getBoundingClientRect().width;\r\n}\r\n\r\nfunction testElement(element: HTMLElement) {\r\n  // const perf = performance.now();\r\n  // do not recalculate variables a second time\r\n  let mapped = map.get(element);\r\n  const firstTime = !mapped;\r\n\r\n  let {text, textLength, from, multiplier, font, textWidth, elementWidth} = mapped || {};\r\n  // console.log('[MEE] testElement got mapped', mapped);\r\n\r\n  if(firstTime) {\r\n    text = element.textContent;\r\n    textLength = text.length;\r\n    from = /* parseFloat(element.getAttribute(attributeName)) ||  */50;\r\n    multiplier = from > 0 && from / 100;\r\n\r\n    // const perf = performance.now();\r\n    font = `${element.dataset.fontWeight || FontWeight} ${FontSize} ${FontFamily}`;\r\n    /* const computedStyle = window.getComputedStyle(elm, null);\r\n    font = `${computedStyle.getPropertyValue('font-weight')} ${computedStyle.getPropertyValue('font-size')} ${computedStyle.getPropertyValue('font-family')}`; */\r\n    // console.log('testMiddleEllipsis get computed style:', performance.now() - perf, font);\r\n\r\n    textWidth = getTextWidth(text, font);\r\n    // const perf = performance.now();\r\n    elementWidth = getElementWidth(element);\r\n    // console.log('testMiddleEllipsis get offsetWidth:', performance.now() - perf, font);\r\n    mapped = {text, textLength, from, multiplier, font, textWidth, elementWidth};\r\n    map.set(element, mapped);\r\n\r\n    // console.log('[MEE] testElement map set', element);\r\n  }\r\n\r\n  const newElementWidth = getElementWidth(element);\r\n  const widthChanged = firstTime || elementWidth !== newElementWidth;\r\n  !firstTime && widthChanged && (mapped.elementWidth = elementWidth = newElementWidth);\r\n\r\n  if(widthChanged) {\r\n    if(textWidth > elementWidth) {\r\n      element.setAttribute('title', text);\r\n      let smallerText = text;\r\n      let smallerWidth = elementWidth;\r\n      while(smallerText.length > 3) {\r\n        const smallerTextLength = smallerText.length;\r\n        const half = multiplier &&\r\n          clamp(multiplier * smallerTextLength << 0, 1, smallerTextLength - 2) ||\r\n          Math.max(smallerTextLength + from - 1, 1);\r\n        const half1 = smallerText.substr(0, half).replace(/\\s*$/, '');\r\n        const half2 = smallerText.substr(half + 1).replace(/^\\s*/, '');\r\n        smallerText = half1 + half2;\r\n        smallerWidth = getTextWidth(smallerText + ellipsis, font);\r\n        if(smallerWidth < elementWidth) {\r\n          element.textContent = half1 + ellipsis + half2;\r\n          break;\r\n        }\r\n      }\r\n\r\n      // * set new width after cutting text\r\n      mapped.elementWidth = getElementWidth(element);\r\n      // mapped.textWidth = smallerWidth;\r\n    } else {\r\n      element.removeAttribute('title');\r\n    }\r\n  }\r\n\r\n  // console.log('testMiddleEllipsis for element:', elm, performance.now() - perf);\r\n}\r\n\r\nexport class MiddleEllipsisElement extends HTMLElement {\r\n  connectedCallback() {\r\n    // console.log('[MEE]: connectedCallback before', map.has(this), testQueue.has(this), map.size, this.textContent, map);\r\n\r\n    map.set(this, null);\r\n    if(this.dataset.sizeType) {\r\n      testElement(this);\r\n    } else {\r\n      testQueue.add(this);\r\n      setTestQueue();\r\n    }\r\n    // testElement(this);\r\n\r\n    // console.log('[MEE]: connectedCallback after', map.has(this), map.size, testQueue.has(this), testQueue.size);\r\n  }\r\n\r\n  disconnectedCallback() {\r\n    const deleted = map.delete(this);\r\n    testQueue.delete(this);\r\n    // console.log('[MEE]: disconnectedCallback', deleted, map.has(this), map.size, this.textContent, map);\r\n  }\r\n}\r\n\r\ncustomElements.define('middle-ellipsis-element', MiddleEllipsisElement);\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport lottieLoader, {LottieLoader} from '../../lib/rlottie/lottieLoader';\r\nimport RLottiePlayer from '../../lib/rlottie/rlottiePlayer';\r\nimport PasswordInputField from '../passwordInputField';\r\n\r\nexport default class PasswordMonkey {\r\n  public container: HTMLElement;\r\n  public animation: RLottiePlayer;\r\n  public needFrame = 0;\r\n  protected loadPromise: ReturnType<LottieLoader['waitForFirstFrame']>;\r\n\r\n  constructor(protected passwordInputField: PasswordInputField, protected size: number) {\r\n    this.container = document.createElement('div');\r\n    this.container.classList.add('media-sticker-wrapper');\r\n  }\r\n\r\n  public load() {\r\n    if(this.loadPromise) return this.loadPromise;\r\n    return this.loadPromise = lottieLoader.loadAnimationAsAsset({\r\n      container: this.container,\r\n      loop: false,\r\n      autoplay: false,\r\n      width: this.size,\r\n      height: this.size,\r\n      noCache: true\r\n    // }, 'assets/img/TwoFactorSetupMonkeyClose.tgs').then((_animation) => {\r\n    }, 'TwoFactorSetupMonkeyPeek').then((_animation) => {\r\n      // return;\r\n      this.animation = _animation;\r\n      this.animation.addEventListener('enterFrame', currentFrame => {\r\n        // console.log('enterFrame', currentFrame, this.needFrame);\r\n\r\n        if((this.animation.direction === 1 && currentFrame >= this.needFrame) ||\r\n          (this.animation.direction === -1 && currentFrame <= this.needFrame)) {\r\n          this.animation.setSpeed(1);\r\n          this.animation.pause();\r\n        }\r\n      });\r\n\r\n      this.passwordInputField.onVisibilityClickAdditional = () => {\r\n        if(this.passwordInputField.passwordVisible) {\r\n          this.animation.setDirection(1);\r\n          this.animation.curFrame = 0;\r\n          this.needFrame = 16;\r\n          this.animation.play();\r\n        } else {\r\n          this.animation.setDirection(-1);\r\n          this.animation.curFrame = 16;\r\n          this.needFrame = 0;\r\n          this.animation.play();\r\n        }\r\n      };\r\n\r\n      return lottieLoader.waitForFirstFrame(_animation);\r\n    });\r\n  }\r\n\r\n  public remove() {\r\n    if(this.animation) {\r\n      this.animation.remove();\r\n    }\r\n  }\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport InputField from '../inputField';\r\nimport lottieLoader from '../../lib/rlottie/lottieLoader';\r\nimport RLottiePlayer from '../../lib/rlottie/rlottiePlayer';\r\n\r\nexport default class TrackingMonkey {\r\n  public container: HTMLElement;\r\n\r\n  protected max = 45;\r\n  protected needFrame = 0;\r\n\r\n  protected animation: RLottiePlayer;\r\n  protected idleAnimation: RLottiePlayer;\r\n\r\n  protected loadPromise: Promise<any>;\r\n\r\n  constructor(protected inputField: InputField, protected size: number) {\r\n    this.container = document.createElement('div');\r\n    this.container.classList.add('media-sticker-wrapper');\r\n\r\n    const input = inputField.input;\r\n\r\n    input.addEventListener('blur', () => {\r\n      this.playAnimation(0);\r\n    });\r\n\r\n    input.addEventListener('input', (e) => {\r\n      this.playAnimation(inputField.value.length);\r\n    });\r\n\r\n    /* codeInput.addEventListener('focus', () => {\r\n      playAnimation(Math.max(codeInput.value.length, 1));\r\n    }); */\r\n  }\r\n\r\n  // 1st symbol = frame 15\r\n  // end symbol = frame 165\r\n  public playAnimation(length: number) {\r\n    if(!this.animation) return;\r\n\r\n    length = Math.min(length, 30);\r\n    let frame: number;\r\n    if(length) {\r\n      frame = Math.round(Math.min(this.max, length) * (165 / this.max) + 11.33);\r\n\r\n      if(this.idleAnimation) {\r\n        this.idleAnimation.stop(true);\r\n        this.idleAnimation.canvas[0].style.display = 'none';\r\n      }\r\n\r\n      this.animation.canvas[0].style.display = '';\r\n    } else {\r\n      /* const cb = (frameNo: number) => {\r\n        if(frameNo <= 1) { */\r\n      /* idleAnimation.play();\r\n          idleAnimation.canvas.style.display = '';\r\n          animation.canvas.style.display = 'none'; */\r\n      /*     animation.removeListener('enterFrame', cb);\r\n        }\r\n      };\r\n      animation.addListener('enterFrame', cb); */\r\n\r\n      frame = 0;\r\n    }\r\n    // animation.playSegments([1, 2]);\r\n\r\n    const direction = this.needFrame > frame ? -1 : 1;\r\n    // console.log('keydown', length, frame, direction);\r\n\r\n    this.animation.setDirection(direction);\r\n    if(this.needFrame !== 0 && frame === 0) {\r\n      this.animation.setSpeed(7);\r\n    }\r\n    /* let diff = Math.abs(needFrame - frame * direction);\r\n    if((diff / 20) > 1) animation.setSpeed(diff / 20 | 0); */\r\n    this.needFrame = frame;\r\n\r\n    this.animation.play();\r\n\r\n    /* animation.goToAndStop(15, true); */\r\n    // animation.goToAndStop(length / max * );\r\n  }\r\n\r\n  public load() {\r\n    if(this.loadPromise) return this.loadPromise;\r\n    return this.loadPromise = Promise.all([\r\n      lottieLoader.loadAnimationAsAsset({\r\n        container: this.container,\r\n        loop: true,\r\n        autoplay: true,\r\n        width: this.size,\r\n        height: this.size\r\n      }, 'TwoFactorSetupMonkeyIdle').then((animation) => {\r\n        this.idleAnimation = animation;\r\n\r\n        // ! animationIntersector will stop animation instantly\r\n        if(!this.inputField.value.length) {\r\n          animation.play();\r\n        }\r\n\r\n        return lottieLoader.waitForFirstFrame(animation);\r\n      }),\r\n\r\n      lottieLoader.loadAnimationAsAsset({\r\n        container: this.container,\r\n        loop: false,\r\n        autoplay: false,\r\n        width: this.size,\r\n        height: this.size\r\n      }, 'TwoFactorSetupMonkeyTracking').then((_animation) => {\r\n        this.animation = _animation;\r\n\r\n        if(!this.inputField.value.length) {\r\n          this.animation.canvas[0].style.display = 'none';\r\n        }\r\n\r\n        this.animation.addEventListener('enterFrame', currentFrame => {\r\n          // console.log('enterFrame', currentFrame, needFrame);\r\n          // let currentFrame = Math.round(e.currentTime);\r\n\r\n          if((this.animation.direction === 1 && currentFrame >= this.needFrame) ||\r\n            (this.animation.direction === -1 && currentFrame <= this.needFrame)) {\r\n            this.animation.setSpeed(1);\r\n            this.animation.pause();\r\n          }\r\n\r\n          if(currentFrame === 0 && this.needFrame === 0) {\r\n            // animation.curFrame = 0;\r\n\r\n            if(this.idleAnimation) {\r\n              this.idleAnimation.canvas[0].style.display = '';\r\n              this.idleAnimation.play();\r\n              this.animation.canvas[0].style.display = 'none';\r\n            }\r\n          }\r\n        });\r\n        // console.log(animation.getDuration(), animation.getDuration(true));\r\n\r\n        return lottieLoader.waitForFirstFrame(_animation);\r\n      })\r\n    ]);\r\n  }\r\n\r\n  public remove() {\r\n    if(this.animation) this.animation.remove();\r\n    if(this.idleAnimation) this.idleAnimation.remove();\r\n  }\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\n// import { IS_MOBILE_SAFARI, IS_SAFARI } from \"../environment/userAgent\";\r\nimport cancelEvent from '../helpers/dom/cancelEvent';\r\nimport InputField, {InputFieldOptions} from './inputField';\r\n\r\nexport default class PasswordInputField extends InputField {\r\n  public passwordVisible = false;\r\n  public toggleVisible: HTMLElement;\r\n  public onVisibilityClickAdditional: () => void;\r\n\r\n  constructor(options: InputFieldOptions = {}) {\r\n    super({\r\n      plainText: true,\r\n      ...options\r\n    });\r\n\r\n    const input = this.input as HTMLInputElement;\r\n    input.type = 'password';\r\n    input.setAttribute('required', '');\r\n    input.name = 'notsearch_password';\r\n    input.autocomplete = 'off';\r\n\r\n    /* if(IS_SAFARI && !IS_MOBILE_SAFARI) {\r\n      input.setAttribute('readonly', '');\r\n      input.addEventListener('focus', () => {\r\n        input.removeAttribute('readonly');\r\n      }, {once: true});\r\n    } */\r\n\r\n    // * https://stackoverflow.com/a/35949954/6758968\r\n    const stealthy = document.createElement('input');\r\n    stealthy.classList.add('stealthy');\r\n    stealthy.tabIndex = -1;\r\n    stealthy.type = 'password';\r\n    input.parentElement.prepend(stealthy);\r\n    input.parentElement.insertBefore(stealthy.cloneNode(), input.nextSibling);\r\n\r\n    const toggleVisible = this.toggleVisible = document.createElement('span');\r\n    toggleVisible.classList.add('toggle-visible', 'tgico');\r\n\r\n    this.container.classList.add('input-field-password');\r\n    this.container.append(toggleVisible);\r\n\r\n    toggleVisible.addEventListener('click', this.onVisibilityClick);\r\n    toggleVisible.addEventListener('touchend', this.onVisibilityClick);\r\n  }\r\n\r\n  public onVisibilityClick = (e: Event) => {\r\n    cancelEvent(e);\r\n    this.passwordVisible = !this.passwordVisible;\r\n\r\n    this.toggleVisible.classList.toggle('eye-hidden', this.passwordVisible);\r\n    (this.input as HTMLInputElement).type = this.passwordVisible ? 'text' : 'password';\r\n    this.onVisibilityClickAdditional && this.onVisibilityClickAdditional();\r\n  };\r\n}\r\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport IS_PARALLAX_SUPPORTED from '../environment/parallaxSupport';\nimport IS_TOUCH_SUPPORTED from '../environment/touchSupport';\nimport findAndSplice from '../helpers/array/findAndSplice';\nimport cancelEvent from '../helpers/dom/cancelEvent';\nimport {attachClickEvent} from '../helpers/dom/clickEvent';\nimport filterChatPhotosMessages from '../helpers/filterChatPhotosMessages';\nimport ListenerSetter from '../helpers/listenerSetter';\nimport ListLoader from '../helpers/listLoader';\nimport {fastRaf} from '../helpers/schedulers';\nimport {Message, ChatFull, MessageAction, Photo} from '../layer';\nimport type {AppMessagesManager} from '../lib/appManagers/appMessagesManager';\nimport {AppManagers} from '../lib/appManagers/managers';\nimport choosePhotoSize from '../lib/appManagers/utils/photos/choosePhotoSize';\nimport {openAvatarViewer} from './avatar';\nimport {putAvatar} from './putPhoto';\nimport Scrollable from './scrollable';\nimport SwipeHandler from './swipeHandler';\nimport {wrapPhoto} from './wrappers';\n\nconst LOAD_NEAREST = 3;\n\nexport default class PeerProfileAvatars {\n  private static BASE_CLASS = 'profile-avatars';\n  private static SCALE = IS_PARALLAX_SUPPORTED ? 2 : 1;\n  private static TRANSLATE_TEMPLATE = IS_PARALLAX_SUPPORTED ? `translate3d({x}, 0, -1px) scale(${PeerProfileAvatars.SCALE})` : 'translate({x}, 0)';\n  public container: HTMLElement;\n  public avatars: HTMLElement;\n  public gradient: HTMLElement;\n  public info: HTMLElement;\n  public arrowPrevious: HTMLElement;\n  public arrowNext: HTMLElement;\n  private tabs: HTMLDivElement;\n  private listLoader: ListLoader<Photo.photo['id'] | Message.messageService, Photo.photo['id'] | Message.messageService>;\n  private peerId: PeerId;\n  private intersectionObserver: IntersectionObserver;\n  private loadCallbacks: Map<Element, () => void>;\n  private listenerSetter: ListenerSetter;\n  private swipeHandler: SwipeHandler;\n\n  constructor(\n    public scrollable: Scrollable,\n    private managers: AppManagers\n  ) {\n    this.container = document.createElement('div');\n    this.container.classList.add(PeerProfileAvatars.BASE_CLASS + '-container');\n\n    this.avatars = document.createElement('div');\n    this.avatars.classList.add(PeerProfileAvatars.BASE_CLASS + '-avatars');\n\n    this.gradient = document.createElement('div');\n    this.gradient.classList.add(PeerProfileAvatars.BASE_CLASS + '-gradient');\n\n    this.info = document.createElement('div');\n    this.info.classList.add(PeerProfileAvatars.BASE_CLASS + '-info');\n\n    this.tabs = document.createElement('div');\n    this.tabs.classList.add(PeerProfileAvatars.BASE_CLASS + '-tabs');\n\n    this.arrowPrevious = document.createElement('div');\n    this.arrowPrevious.classList.add(PeerProfileAvatars.BASE_CLASS + '-arrow', 'tgico-avatarprevious');\n\n    /* const previousIcon = document.createElement('i');\n    previousIcon.classList.add(PeerProfileAvatars.BASE_CLASS + '-arrow-icon', 'tgico-previous');\n    this.arrowBack.append(previousIcon); */\n\n    this.arrowNext = document.createElement('div');\n    this.arrowNext.classList.add(PeerProfileAvatars.BASE_CLASS + '-arrow', PeerProfileAvatars.BASE_CLASS + '-arrow-next', 'tgico-avatarnext');\n\n    /* const nextIcon = document.createElement('i');\n    nextIcon.classList.add(PeerProfileAvatars.BASE_CLASS + '-arrow-icon', 'tgico-next');\n    this.arrowNext.append(nextIcon); */\n\n    this.container.append(this.avatars, this.gradient, this.info, this.tabs, this.arrowPrevious, this.arrowNext);\n\n    this.loadCallbacks = new Map();\n    this.listenerSetter = new ListenerSetter();\n\n    const checkScrollTop = () => {\n      if(this.scrollable.scrollTop !== 0) {\n        this.scrollable.scrollIntoViewNew({\n          element: this.scrollable.container.firstElementChild as HTMLElement,\n          position: 'start'\n        });\n        return false;\n      }\n\n      return true;\n    };\n\n    const SWITCH_ZONE = 1 / 3;\n    let cancel = false;\n    let freeze = false;\n    attachClickEvent(this.container, async(_e) => {\n      if(freeze) {\n        cancelEvent(_e);\n        return;\n      }\n\n      if(cancel) {\n        cancel = false;\n        return;\n      }\n\n      if(!checkScrollTop()) {\n        return;\n      }\n\n      const rect = this.container.getBoundingClientRect();\n\n      // const e = (_e as TouchEvent).touches ? (_e as TouchEvent).touches[0] : _e as MouseEvent;\n      const e = _e;\n      const x = e.pageX;\n\n      const clickX = x - rect.left;\n      if((!this.listLoader.previous.length && !this.listLoader.next.length) ||\n        (clickX > (rect.width * SWITCH_ZONE) && clickX < (rect.width - rect.width * SWITCH_ZONE))) {\n        const peerId = this.peerId;\n\n        const targets: {element: HTMLElement, item: Photo.photo['id'] | Message.messageService}[] = [];\n        this.listLoader.previous.concat(this.listLoader.current, this.listLoader.next).forEach((item, idx) => {\n          targets.push({\n            element: /* null */this.avatars.children[idx] as HTMLElement,\n            item\n          });\n        });\n\n        const prevTargets = targets.slice(0, this.listLoader.previous.length);\n        const nextTargets = targets.slice(this.listLoader.previous.length + 1);\n\n        const target = this.avatars.children[this.listLoader.previous.length] as HTMLElement;\n        freeze = true;\n        openAvatarViewer(target, peerId, () => peerId === this.peerId, this.listLoader.current, prevTargets, nextTargets);\n        freeze = false;\n      } else {\n        const centerX = rect.right - (rect.width / 2);\n        const toRight = x > centerX;\n\n        // this.avatars.classList.remove('no-transition');\n        // fastRaf(() => {\n        this.avatars.classList.add('no-transition');\n        void this.avatars.offsetLeft; // reflow\n\n        let distance: number;\n        if(this.listLoader.index === 0 && !toRight) distance = this.listLoader.count - 1;\n        else if(this.listLoader.index === (this.listLoader.count - 1) && toRight) distance = -(this.listLoader.count - 1);\n        else distance = toRight ? 1 : -1;\n        this.listLoader.go(distance);\n\n        fastRaf(() => {\n          this.avatars.classList.remove('no-transition');\n        });\n        // });\n      }\n    }, {listenerSetter: this.listenerSetter});\n\n    const cancelNextClick = () => {\n      cancel = true;\n      document.body.addEventListener(IS_TOUCH_SUPPORTED ? 'touchend' : 'click', (e) => {\n        cancel = false;\n      }, {once: true});\n    };\n\n    let width = 0, x = 0, lastDiffX = 0, /* lastIndex = 0, */ minX = 0;\n    const swipeHandler = this.swipeHandler = new SwipeHandler({\n      element: this.avatars,\n      onSwipe: (xDiff, yDiff) => {\n        lastDiffX = xDiff;\n        let lastX = x + xDiff * -PeerProfileAvatars.SCALE;\n        if(lastX > 0) lastX = 0;\n        else if(lastX < minX) lastX = minX;\n\n        this.avatars.style.transform = PeerProfileAvatars.TRANSLATE_TEMPLATE.replace('{x}', lastX + 'px');\n        // console.log(xDiff, yDiff);\n        return false;\n      },\n      verifyTouchTarget: (e) => {\n        if(!checkScrollTop()) {\n          cancelNextClick();\n          cancelEvent(e);\n          return false;\n        } else if(this.container.classList.contains('is-single') || freeze) {\n          return false;\n        }\n\n        return true;\n      },\n      onFirstSwipe: () => {\n        const rect = this.avatars.getBoundingClientRect();\n        width = rect.width;\n        minX = -width * (this.tabs.childElementCount - 1);\n\n        /* lastIndex = whichChild(this.tabs.querySelector('.active'));\n        x = -width * lastIndex; */\n        x = rect.left - this.container.getBoundingClientRect().left;\n\n        this.avatars.style.transform = PeerProfileAvatars.TRANSLATE_TEMPLATE.replace('{x}', x + 'px');\n\n        this.container.classList.add('is-swiping');\n        this.avatars.classList.add('no-transition');\n        void this.avatars.offsetLeft; // reflow\n      },\n      onReset: () => {\n        const addIndex = Math.ceil(Math.abs(lastDiffX) / (width / PeerProfileAvatars.SCALE)) * (lastDiffX >= 0 ? 1 : -1);\n        cancelNextClick();\n\n        // console.log(addIndex);\n\n        this.avatars.classList.remove('no-transition');\n        fastRaf(() => {\n          this.listLoader.go(addIndex);\n          this.container.classList.remove('is-swiping');\n        });\n      }\n    });\n\n    this.intersectionObserver = new IntersectionObserver((entries) => {\n      entries.forEach((entry) => {\n        if(!entry.isIntersecting) {\n          return;\n        }\n\n        this.loadNearestToTarget(entry.target);\n      });\n    });\n\n    /* this.listenerSetter.add(rootScope)('avatar_update', (peerId) => {\n      if(this.peerId === peerId) {\n        const photo = appPeersManager.getPeerPhoto(peerId);\n        if(photo) {\n          const id = photo.photo_id;\n          const previous = this.listLoader.previous;\n          for(let i = 0; i < previous.length; ++i) {\n            if(previous[i] === id)\n          }\n          this.listLoader.previous.forEach((_id, idx, arr) => {});\n        }\n      }\n    }); */\n  }\n\n  public async setPeer(peerId: PeerId) {\n    this.peerId = peerId;\n\n    const photo = await this.managers.appPeersManager.getPeerPhoto(peerId);\n    if(!photo) {\n      return;\n    }\n\n    const listLoader: PeerProfileAvatars['listLoader'] = this.listLoader = new ListLoader({\n      loadCount: 50,\n      loadMore: (anchor, older, loadCount) => {\n        if(!older) return Promise.resolve({count: undefined, items: []});\n\n        if(peerId.isUser()) {\n          const maxId: Photo.photo['id'] = anchor as any;\n          return this.managers.appPhotosManager.getUserPhotos(peerId, maxId, loadCount).then((value) => {\n            return {\n              count: value.count,\n              items: value.photos\n            };\n          });\n        } else {\n          const promises: [Promise<ChatFull> | ChatFull, ReturnType<AppMessagesManager['getSearch']>] = [] as any;\n          if(!listLoader.current) {\n            promises.push(this.managers.appProfileManager.getChatFull(peerId.toChatId()));\n          }\n\n          promises.push(this.managers.appMessagesManager.getSearch({\n            peerId,\n            maxId: Number.MAX_SAFE_INTEGER,\n            inputFilter: {\n              _: 'inputMessagesFilterChatPhotos'\n            },\n            limit: loadCount,\n            backLimit: 0\n          }));\n\n          return Promise.all(promises).then(async(result) => {\n            const value = result.pop() as typeof result[1];\n\n            filterChatPhotosMessages(value);\n\n            if(!listLoader.current) {\n              const chatFull = result[0];\n              const message = findAndSplice(value.history, (message) => {\n                return ((message as Message.messageService).action as MessageAction.messageActionChannelEditPhoto).photo.id === chatFull.chat_photo.id;\n              }) as Message.messageService;\n\n              listLoader.current = message || await this.managers.appMessagesManager.generateFakeAvatarMessage(this.peerId, chatFull.chat_photo);\n            }\n\n            // console.log('avatars loaded:', value);\n            return {\n              count: value.count,\n              items: value.history\n            };\n          });\n        }\n      },\n      processItem: this.processItem,\n      onJump: (item, older) => {\n        const id = this.listLoader.index;\n        // const nextId = Math.max(0, id);\n        const x = 100 * PeerProfileAvatars.SCALE * id;\n        this.avatars.style.transform = PeerProfileAvatars.TRANSLATE_TEMPLATE.replace('{x}', `-${x}%`);\n\n        const activeTab = this.tabs.querySelector('.active');\n        if(activeTab) activeTab.classList.remove('active');\n\n        const tab = this.tabs.children[id] as HTMLElement;\n        tab.classList.add('active');\n\n        this.loadNearestToTarget(this.avatars.children[id]);\n      }\n    });\n\n    if(photo._ === 'userProfilePhoto') {\n      listLoader.current = photo.photo_id;\n    }\n\n    await this.processItem(listLoader.current);\n\n    // listLoader.loaded\n    listLoader.load(true);\n  }\n\n  public addTab() {\n    const tab = document.createElement('div');\n    tab.classList.add(PeerProfileAvatars.BASE_CLASS + '-tab');\n    this.tabs.append(tab);\n\n    if(this.tabs.childElementCount === 1) {\n      tab.classList.add('active');\n    }\n\n    this.container.classList.toggle('is-single', this.tabs.childElementCount <= 1);\n  }\n\n  public processItem = async(photoId: Photo.photo['id'] | Message.messageService) => {\n    const avatar = document.createElement('div');\n    avatar.classList.add(PeerProfileAvatars.BASE_CLASS + '-avatar', 'media-container', 'hide');\n\n    this.avatars.append(avatar);\n\n    let photo: Photo.photo;\n    if(photoId) {\n      photo = typeof(photoId) !== 'object' ?\n        await this.managers.appPhotosManager.getPhoto(photoId) :\n        (photoId.action as MessageAction.messageActionChannelEditPhoto).photo as Photo.photo;\n    }\n\n    const img = new Image();\n    img.classList.add('avatar-photo');\n    img.draggable = false;\n\n    const loadCallback = async() => {\n      if(photo) {\n        const res = await wrapPhoto({\n          container: avatar,\n          photo,\n          size: choosePhotoSize(photo, 420, 420, false),\n          withoutPreloader: true\n        });\n\n        [res.images.thumb, res.images.full].filter(Boolean).forEach((img) => {\n          img.classList.add('avatar-photo');\n        });\n      } else {\n        const photo = await this.managers.appPeersManager.getPeerPhoto(this.peerId);\n        await putAvatar(avatar, this.peerId, photo, 'photo_big', img);\n      }\n\n      avatar.classList.remove('hide');\n    };\n\n    if(this.avatars.childElementCount <= LOAD_NEAREST) {\n      await loadCallback();\n    } else {\n      this.intersectionObserver.observe(avatar);\n      this.loadCallbacks.set(avatar, loadCallback);\n    }\n\n    this.addTab();\n\n    return photoId;\n  };\n\n  private loadNearestToTarget(target: Element) {\n    const children = Array.from(target.parentElement.children);\n    const idx = children.indexOf(target);\n    const slice = children.slice(Math.max(0, idx - LOAD_NEAREST), Math.min(children.length, idx + LOAD_NEAREST));\n\n    slice.forEach((target) => {\n      const callback = this.loadCallbacks.get(target);\n      if(callback) {\n        callback();\n        this.loadCallbacks.delete(target);\n        this.intersectionObserver.unobserve(target);\n      }\n    });\n  }\n\n  public cleanup() {\n    this.listenerSetter.removeAll();\n    this.swipeHandler.removeListeners();\n    this.intersectionObserver?.disconnect();\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport IS_PARALLAX_SUPPORTED from '../environment/parallaxSupport';\nimport {copyTextToClipboard} from '../helpers/clipboard';\nimport replaceContent from '../helpers/dom/replaceContent';\nimport setInnerHTML from '../helpers/dom/setInnerHTML';\nimport ListenerSetter from '../helpers/listenerSetter';\nimport {fastRaf} from '../helpers/schedulers';\nimport {Chat, ChatFull, User, UserFull} from '../layer';\nimport type {Channel} from '../lib/appManagers/appChatsManager';\nimport appImManager from '../lib/appManagers/appImManager';\nimport {AppManagers} from '../lib/appManagers/managers';\nimport I18n from '../lib/langPack';\nimport wrapRichText from '../lib/richTextProcessor/wrapRichText';\nimport rootScope from '../lib/rootScope';\nimport AvatarElement from './avatar';\nimport CheckboxField from './checkboxField';\nimport PeerProfileAvatars from './peerProfileAvatars';\nimport Row from './row';\nimport Scrollable from './scrollable';\nimport {SettingSection, generateDelimiter} from './sidebarLeft';\nimport {toast} from './toast';\nimport formatUserPhone from './wrappers/formatUserPhone';\nimport wrapPeerTitle from './wrappers/peerTitle';\n\nconst setText = (text: Parameters<typeof setInnerHTML>[1], row: Row) => {\n  // fastRaf(() => {\n  setInnerHTML(row.title, text || '');\n  row.container.style.display = text ? '' : 'none';\n  // });\n};\n\nexport default class PeerProfile {\n  public element: HTMLElement;\n  private avatars: PeerProfileAvatars;\n  private avatar: AvatarElement;\n  private section: SettingSection;\n  private name: HTMLDivElement;\n  private subtitle: HTMLDivElement;\n  private bio: Row;\n  private username: Row;\n  private phone: Row;\n  private notifications: Row;\n  private location: Row;\n  private link: Row;\n\n  private cleaned: boolean;\n  private setMoreDetailsTimeout: number;\n  private setPeerStatusInterval: number;\n\n  private peerId: PeerId;\n  private threadId: number;\n\n  constructor(\n    private managers: AppManagers,\n    public scrollable: Scrollable,\n    private listenerSetter?: ListenerSetter,\n    private isDialog = true\n  ) {\n    if(!IS_PARALLAX_SUPPORTED) {\n      this.scrollable.container.classList.add('no-parallax');\n    }\n\n    if(!listenerSetter) {\n      this.listenerSetter = new ListenerSetter();\n    }\n  }\n\n  public init() {\n    this.init = null;\n\n\n    this.element = document.createElement('div');\n    this.element.classList.add('profile-content');\n\n    this.section = new SettingSection({\n      noDelimiter: true\n    });\n\n    this.avatar = new AvatarElement();\n    this.avatar.classList.add('profile-avatar', 'avatar-120');\n    this.avatar.isDialog = this.isDialog;\n    this.avatar.attachClickEvent();\n\n    this.name = document.createElement('div');\n    this.name.classList.add('profile-name');\n\n    this.subtitle = document.createElement('div');\n    this.subtitle.classList.add('profile-subtitle');\n\n    this.bio = new Row({\n      title: ' ',\n      subtitleLangKey: 'UserBio',\n      icon: 'info',\n      clickable: async(e) => {\n        if((e.target as HTMLElement).tagName === 'A') {\n          return;\n        }\n\n        const full = await this.managers.appProfileManager.getProfileByPeerId(this.peerId);\n        copyTextToClipboard(full.about);\n        toast(I18n.format('BioCopied', true));\n      },\n      listenerSetter: this.listenerSetter\n    });\n\n    this.bio.title.classList.add('pre-wrap');\n\n    this.username = new Row({\n      title: ' ',\n      subtitleLangKey: 'Username',\n      icon: 'username',\n      clickable: async() => {\n        const peer: Channel | User.user = await this.managers.appPeersManager.getPeer(this.peerId);\n        copyTextToClipboard('@' + peer.username);\n        toast(I18n.format('UsernameCopied', true));\n      },\n      listenerSetter: this.listenerSetter\n    });\n\n    this.phone = new Row({\n      title: ' ',\n      subtitleLangKey: 'Phone',\n      icon: 'phone',\n      clickable: async() => {\n        const peer: User = await this.managers.appUsersManager.getUser(this.peerId);\n        copyTextToClipboard('+' + peer.phone);\n        toast(I18n.format('PhoneCopied', true));\n      },\n      listenerSetter: this.listenerSetter\n    });\n\n    this.link = new Row({\n      title: ' ',\n      subtitleLangKey: 'SetUrlPlaceholder',\n      icon: 'link',\n      clickable: () => {\n        copyTextToClipboard(this.link.title.textContent);\n        // Promise.resolve(appProfileManager.getChatFull(this.peerId.toChatId())).then((chatFull) => {\n        // copyTextToClipboard(chatFull.exported_invite.link);\n        toast(I18n.format('LinkCopied', true));\n        // });\n      },\n      listenerSetter: this.listenerSetter\n    });\n\n    this.location = new Row({\n      title: ' ',\n      subtitleLangKey: 'ChatLocation',\n      icon: 'location'\n    });\n\n    this.section.content.append(\n      this.phone.container,\n      this.username.container,\n      this.location.container,\n      this.bio.container,\n      this.link.container\n    );\n\n    const {listenerSetter} = this;\n    if(this.isDialog) {\n      this.notifications = new Row({\n        checkboxField: new CheckboxField({toggle: true}),\n        titleLangKey: 'Notifications',\n        icon: 'unmute',\n        listenerSetter: this.listenerSetter\n      });\n\n      listenerSetter.add(this.notifications.checkboxField.input)('change', (e) => {\n        if(!e.isTrusted) {\n          return;\n        }\n\n        // let checked = this.notificationsCheckbox.checked;\n        this.managers.appMessagesManager.togglePeerMute(this.peerId);\n      });\n\n      listenerSetter.add(rootScope)('dialog_notify_settings', async(dialog) => {\n        if(this.peerId === dialog.peerId) {\n          const muted = await this.managers.appNotificationsManager.isPeerLocalMuted(this.peerId, false);\n          this.notifications.checkboxField.checked = !muted;\n        }\n      });\n\n      this.section.content.append(this.notifications.container);\n    }\n\n    this.element.append(this.section.container);\n\n    if(IS_PARALLAX_SUPPORTED) {\n      this.element.append(generateDelimiter());\n    }\n\n    listenerSetter.add(rootScope)('peer_typings', ({peerId}) => {\n      if(this.peerId === peerId) {\n        this.setPeerStatus();\n      }\n    });\n\n    listenerSetter.add(rootScope)('peer_bio_edit', (peerId) => {\n      if(peerId === this.peerId) {\n        this.setMoreDetails(true);\n      }\n    });\n\n    listenerSetter.add(rootScope)('peer_title_edit', (peerId) => {\n      if(peerId === this.peerId) {\n        this.fillUsername();\n      }\n    });\n\n    listenerSetter.add(rootScope)('user_update', (userId) => {\n      if(this.peerId === userId.toPeerId()) {\n        this.setPeerStatus();\n      }\n    });\n\n    listenerSetter.add(rootScope)('contacts_update', async(userId) => {\n      if(this.peerId === userId.toPeerId()) {\n        const user = await this.managers.appUsersManager.getUser(userId);\n        if(!user.pFlags.self || !this.isDialog) {\n          this.fillUserPhone();\n        }\n      }\n    });\n\n    listenerSetter.add(rootScope)('avatar_update', (peerId) => {\n      if(this.peerId === peerId) {\n        // const photo = appPeersManager.getPeerPhoto(peerId);\n        // if(!photo && this.avatars) {\n        this.setAvatar();\n        // }\n      }\n    });\n\n    this.setPeerStatusInterval = window.setInterval(this.setPeerStatus, 60e3);\n  }\n\n  private setPeerStatus = (needClear = false) => {\n    const peerId = this.peerId;\n    this.element.classList.toggle('is-me', peerId === rootScope.myId);\n    if(!peerId || (rootScope.myId === peerId && this.isDialog)) return;\n\n    return appImManager.setPeerStatus(\n      peerId,\n      this.subtitle,\n      needClear,\n      true,\n      () => peerId === this.peerId,\n      !this.isDialog\n    ).then((callback) => {\n      if(callback) {\n        callback();\n      }\n    });\n  };\n\n  public cleanupHTML() {\n    [\n      this.bio,\n      this.phone,\n      this.username,\n      this.location,\n      this.link\n    ].forEach((row) => {\n      row.container.style.display = 'none';\n    });\n\n    if(this.notifications) {\n      this.notifications.container.style.display = '';\n      this.notifications.checkboxField.checked = true;\n    }\n\n    this.clearSetMoreDetailsTimeout();\n  }\n\n  private canBeDetailed() {\n    return this.peerId !== rootScope.myId || !this.isDialog;\n  }\n\n  private async setAvatar() {\n    if(this.canBeDetailed()) {\n      const photo = await this.managers.appPeersManager.getPeerPhoto(this.peerId);\n\n      if(photo) {\n        const oldAvatars = this.avatars;\n        this.avatars = new PeerProfileAvatars(this.scrollable, this.managers);\n        await this.avatars.setPeer(this.peerId);\n        this.avatars.info.append(this.name, this.subtitle);\n\n        this.avatar.remove();\n\n        if(oldAvatars) oldAvatars.container.replaceWith(this.avatars.container);\n        else this.element.prepend(this.avatars.container);\n\n        if(IS_PARALLAX_SUPPORTED) {\n          this.scrollable.container.classList.add('parallax');\n        }\n\n        return;\n      }\n    }\n\n    if(IS_PARALLAX_SUPPORTED) {\n      this.scrollable.container.classList.remove('parallax');\n    }\n\n    if(this.avatars) {\n      this.avatars.container.remove();\n      this.avatars.cleanup();\n      this.avatars = undefined;\n    }\n\n    await this.avatar.updateWithOptions({peerId: this.peerId});\n\n    this.section.content.prepend(this.avatar, this.name, this.subtitle);\n  }\n\n  private async fillUsername() {\n    const {peerId} = this;\n    if(peerId.isUser() && this.canBeDetailed()) {\n      const username = await this.managers.appPeersManager.getPeerUsername(peerId);\n      return setText(username, this.username);\n    }\n  }\n\n  private async fillUserPhone() {\n    const {peerId} = this;\n    if(peerId.isUser() && this.canBeDetailed()) {\n      const user = await this.managers.appUsersManager.getUser(peerId);\n      return setText(user.phone ? formatUserPhone(user.phone) : undefined, this.phone);\n    }\n  }\n\n  private async fillNotifications() {\n    const notificationsRow = this.notifications;\n    if(!notificationsRow) {\n      return;\n    }\n\n    if(this.canBeDetailed()) {\n      const muted = await this.managers.appNotificationsManager.isPeerLocalMuted(this.peerId, false);\n      notificationsRow.checkboxField.checked = !muted;\n    } else {\n      fastRaf(() => {\n        notificationsRow.container.style.display = 'none';\n      });\n    }\n  }\n\n  private async fillRows() {\n    const peerId = this.peerId;\n\n    await Promise.all([\n      this.fillUsername(),\n      this.fillUserPhone(),\n      this.fillNotifications(),\n      this.setMoreDetails(),\n      (async() => {\n        const [element/* , icons */] = await Promise.all([\n          wrapPeerTitle({\n            peerId,\n            dialog: this.isDialog,\n            withIcons: true\n          })\n\n          // generateTitleIcons(peerId)\n        ]);\n        replaceContent(this.name, element);\n        // this.name.append(...icons);\n      })(),\n      this.setPeerStatus(true)\n    ]);\n  }\n\n  public async fillProfileElements() {\n    if(!this.cleaned) return;\n    this.cleaned = false;\n\n    this.cleanupHTML();\n    await Promise.all([\n      this.setAvatar(),\n      this.fillRows()\n    ]);\n  }\n\n  private async _setMoreDetails(peerId: PeerId, peerFull: ChatFull | UserFull) {\n    // if(peerFull.about) {\n    setText(peerFull.about ? wrapRichText(peerFull.about) : undefined, this.bio);\n    // }\n\n    if(!peerId.isUser()) {\n      const chat: Chat.channel = await this.managers.appChatsManager.getChat(peerId.toChatId());\n      if(chat.username) {\n        setText('https://t.me/' + chat.username, this.link);\n      } else {\n        const exportedInvite = (peerFull as ChatFull.channelFull).exported_invite;\n        if(exportedInvite?._ === 'chatInviteExported') {\n          setText(exportedInvite.link, this.link);\n        }\n      }\n    }\n\n    const location = (peerFull as ChatFull.channelFull).location;\n    if(location?._ == 'channelLocation') {\n      setText(location.address, this.location);\n    }\n\n    this.setMoreDetailsTimeout = window.setTimeout(() => this.setMoreDetails(true), 60e3);\n  }\n\n  private async setMoreDetails(override?: true) {\n    this.clearSetMoreDetailsTimeout();\n\n    const peerId = this.peerId;\n    const threadId = this.threadId;\n\n    if(!peerId || await this.managers.appPeersManager.isRestricted(peerId) || !this.canBeDetailed()) {\n      return;\n    }\n\n    const result = await this.managers.acknowledged.appProfileManager.getProfileByPeerId(peerId, override);\n    const setPromise = result.result.then(async(peerFull) => {\n      if(this.peerId !== peerId || this.threadId !== threadId || await this.managers.appPeersManager.isRestricted(peerId)) {\n        // this.log.warn('peer changed');\n        return;\n      }\n\n      await this._setMoreDetails(peerId, peerFull);\n    });\n\n    if(result.cached) {\n      await setPromise;\n    }\n  }\n\n  public setPeer(peerId: PeerId, threadId = 0) {\n    if(this.peerId === peerId && this.threadId === threadId) return;\n\n    if(this.init) {\n      this.init();\n    }\n\n    this.peerId = peerId;\n    this.threadId = threadId;\n\n    this.cleaned = true;\n  }\n\n  public clearSetMoreDetailsTimeout() {\n    if(this.setMoreDetailsTimeout !== undefined) {\n      clearTimeout(this.setMoreDetailsTimeout);\n      this.setMoreDetailsTimeout = undefined;\n    }\n  }\n\n  public destroy() {\n    this.clearSetMoreDetailsTimeout();\n    clearInterval(this.setPeerStatusInterval);\n    this.avatars?.cleanup();\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport {Chat, User} from '../layer';\nimport rootScope from '../lib/rootScope';\nimport generateFakeIcon from './generateFakeIcon';\nimport generatePremiumIcon from './generatePremiumIcon';\nimport generateVerifiedIcon from './generateVerifiedIcon';\n\nexport default async function generateTitleIcons(peerId: PeerId) {\n  const elements: Element[] = [];\n  const peer: Chat | User = await rootScope.managers.appPeersManager.getPeer(peerId);\n  if((peer as Chat.channel).pFlags.verified) {\n    elements.push(generateVerifiedIcon());\n  }\n\n  if((peer as Chat.channel).pFlags.fake || (peer as User.user).pFlags.scam) {\n    elements.push(generateFakeIcon((peer as User.user).pFlags.scam));\n  }\n\n  if((peer as User.user).pFlags.premium) {\n    elements.push(generatePremiumIcon());\n  }\n\n  return elements;\n}\n","export default function generateVerifiedIcon() {\n  const span = document.createElement('span');\n  span.classList.add('verified-icon', 'tgico');\n\n  const size = 26; // 24\n  const svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');\n  svg.setAttributeNS(null, 'viewBox', `0 0 ${size} ${size}`);\n  svg.setAttributeNS(null, 'width', `${size}`);\n  svg.setAttributeNS(null, 'height', `${size}`);\n  svg.classList.add('verified-icon-svg');\n\n  const use = document.createElementNS('http://www.w3.org/2000/svg', 'use');\n  use.setAttributeNS(null, 'href', '#verified-icon-background');\n  use.classList.add('verified-icon-background');\n\n  const use2 = document.createElementNS('http://www.w3.org/2000/svg', 'use');\n  use2.setAttributeNS(null, 'href', '#verified-icon-check');\n  use2.classList.add('verified-icon-check');\n\n  // svg.append(use, use2);\n  svg.append(use2, use);\n\n  span.append(svg);\n\n  return span;\n  // const span = document.createElement('span');\n  // span.classList.add('verified-icon', 'tgico-verified_filled');\n  // return span;\n}\n","export default function generatePremiumIcon() {\n  const span = document.createElement('span');\n  span.classList.add('premium-icon', 'tgico-star');\n  return span;\n}\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport rootScope from '../lib/rootScope';\r\nimport {i18n} from '../lib/langPack';\r\nimport replaceContent from '../helpers/dom/replaceContent';\r\nimport {NULL_PEER_ID} from '../lib/mtproto/mtproto_config';\r\nimport limitSymbols from '../helpers/string/limitSymbols';\r\nimport setInnerHTML from '../helpers/dom/setInnerHTML';\r\nimport {AppManagers} from '../lib/appManagers/managers';\r\nimport wrapEmojiText from '../lib/richTextProcessor/wrapEmojiText';\r\nimport getPeerTitle from './wrappers/getPeerTitle';\r\nimport generateTitleIcons from './generateTitleIcons';\r\n\r\nexport type PeerTitleOptions = {\r\n  peerId?: PeerId,\r\n  fromName?: string,\r\n  plainText?: boolean,\r\n  onlyFirstName?: boolean,\r\n  dialog?: boolean,\r\n  limitSymbols?: number,\r\n  managers?: AppManagers,\r\n  withIcons?: boolean\r\n};\r\n\r\nconst weakMap: WeakMap<HTMLElement, PeerTitle> = new WeakMap();\r\n\r\nrootScope.addEventListener('peer_title_edit', (peerId) => {\r\n  const elements = Array.from(document.querySelectorAll(`.peer-title[data-peer-id=\"${peerId}\"]`)) as HTMLElement[];\r\n  elements.forEach((element) => {\r\n    const peerTitle = weakMap.get(element);\r\n    // console.log('in the summer silence i was doing nothing', peerTitle, peerId);\r\n\r\n    if(peerTitle) {\r\n      peerTitle.update();\r\n    }\r\n  });\r\n});\r\n\r\nexport default class PeerTitle {\r\n  public element: HTMLElement;\r\n  public peerId: PeerId;\r\n  private fromName: string;\r\n  private plainText = false;\r\n  private onlyFirstName = false;\r\n  private dialog = false;\r\n  private limitSymbols: number;\r\n  private managers: AppManagers;\r\n  private hasInner: boolean;\r\n  private withIcons: boolean;\r\n\r\n  constructor(options?: PeerTitleOptions) {\r\n    this.element = document.createElement('span');\r\n    this.element.classList.add('peer-title');\r\n    this.element.setAttribute('dir', 'auto');\r\n\r\n    if(options) {\r\n      this.update(options);\r\n    }\r\n\r\n    weakMap.set(this.element, this);\r\n  }\r\n\r\n  public setOptions(options?: PeerTitleOptions) {\r\n    if(!options) {\r\n      return;\r\n    }\r\n\r\n    for(const i in options) {\r\n      // @ts-ignore\r\n      const value = options[i];\r\n\r\n      if(typeof(value) !== 'object') {\r\n        // @ts-ignore\r\n        this.element.dataset[i] = value ? '' + (typeof(value) === 'boolean' ? +value : value) : '0';\r\n      }\r\n\r\n      // @ts-ignore\r\n      this[i] = value;\r\n    }\r\n  }\r\n\r\n  public async update(options?: PeerTitleOptions) {\r\n    this.setOptions(options);\r\n\r\n    let fromName = this.fromName;\r\n    if(fromName !== undefined) {\r\n      if(this.limitSymbols !== undefined) {\r\n        fromName = limitSymbols(fromName, this.limitSymbols, this.limitSymbols);\r\n      }\r\n\r\n      setInnerHTML(this.element, wrapEmojiText(fromName));\r\n      return;\r\n    }\r\n\r\n    this.peerId ??= NULL_PEER_ID;\r\n\r\n    let hasInner: boolean;\r\n    if(this.peerId !== rootScope.myId || !this.dialog) {\r\n      const managers = this.managers ?? rootScope.managers;\r\n      const [title, icons] = await Promise.all([\r\n        getPeerTitle(this.peerId, this.plainText, this.onlyFirstName, this.limitSymbols, managers),\r\n        this.withIcons && generateTitleIcons(this.peerId)\r\n      ]);\r\n\r\n      if(icons?.length) {\r\n        const inner = document.createElement('span');\r\n        inner.classList.add('peer-title-inner');\r\n        hasInner = true;\r\n        setInnerHTML(inner, title);\r\n\r\n        const fragment = document.createDocumentFragment();\r\n        fragment.append(inner, ...icons);\r\n        setInnerHTML(this.element, fragment);\r\n      } else {\r\n        setInnerHTML(this.element, title);\r\n      }\r\n    } else {\r\n      replaceContent(this.element, i18n(this.onlyFirstName ? 'Saved' : 'SavedMessages'));\r\n    }\r\n\r\n    if(this.hasInner !== hasInner) {\r\n      this.hasInner = hasInner;\r\n      this.element.classList.toggle('with-icons', hasInner);\r\n    }\r\n  }\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport type {AppDownloadManager} from '../../lib/appManagers/appDownloadManager';\r\nimport resizeableImage from '../../lib/cropper';\r\nimport PopupElement from '.';\r\nimport {_i18n} from '../../lib/langPack';\r\nimport {attachClickEvent} from '../../helpers/dom/clickEvent';\r\nimport readBlobAsDataURL from '../../helpers/blob/readBlobAsDataURL';\r\nimport rootScope from '../../lib/rootScope';\r\nimport appDownloadManager from '../../lib/appManagers/appDownloadManager';\r\n\r\nexport default class PopupAvatar extends PopupElement {\r\n  private cropContainer: HTMLElement;\r\n  private input: HTMLInputElement;\r\n  private h6: HTMLElement;\r\n\r\n  private image = new Image();\r\n\r\n  private canvas: HTMLCanvasElement;\r\n  private blob: Blob;\r\n  private cropper = {\r\n    crop: () => {},\r\n    removeHandlers: () => {}\r\n  };\r\n\r\n  private onCrop: (upload: () => ReturnType<AppDownloadManager['upload']>) => void;\r\n\r\n  constructor() {\r\n    super('popup-avatar', {closable: true, withConfirm: true});\r\n\r\n    this.h6 = document.createElement('h6');\r\n    _i18n(this.h6, 'Popup.Avatar.Title');\r\n\r\n    this.btnClose.classList.remove('btn-icon');\r\n\r\n    this.header.append(this.h6);\r\n\r\n    this.cropContainer = document.createElement('div');\r\n    this.cropContainer.classList.add('crop');\r\n    this.cropContainer.append(this.image);\r\n\r\n    this.input = document.createElement('input');\r\n    this.input.type = 'file';\r\n    this.input.style.display = 'none';\r\n    this.listenerSetter.add(this.input)('change', (e: any) => {\r\n      const file = e.target.files[0];\r\n      if(!file) {\r\n        return;\r\n      }\r\n\r\n      readBlobAsDataURL(file).then((contents) => {\r\n        this.image = new Image();\r\n        this.cropContainer.append(this.image);\r\n        this.image.src = contents;\r\n\r\n        this.image.onload = () => {\r\n          /* let {w, h} = calcImageInBox(this.image.naturalWidth, this.image.naturalHeight, 460, 554);\r\n          cropContainer.style.width = w + 'px';\r\n          cropContainer.style.height = h + 'px'; */\r\n          this.show();\r\n\r\n          this.cropper = resizeableImage(this.image, this.canvas);\r\n          this.input.value = '';\r\n        };\r\n      });\r\n    }, false);\r\n\r\n    this.btnConfirm.className = 'btn-primary btn-color-primary btn-circle btn-crop btn-icon tgico-check z-depth-1';\r\n    attachClickEvent(this.btnConfirm, () => {\r\n      this.cropper.crop();\r\n      this.hide();\r\n\r\n      this.canvas.toBlob((blob) => {\r\n        this.blob = blob; // save blob to send after reg\r\n        this.darkenCanvas();\r\n        this.resolve();\r\n      }, 'image/jpeg', 1);\r\n    }, {listenerSetter: this.listenerSetter});\r\n\r\n    this.container.append(this.cropContainer, this.btnConfirm, this.input);\r\n\r\n    this.addEventListener('closeAfterTimeout', () => {\r\n      this.cropper.removeHandlers();\r\n      if(this.image) {\r\n        this.image.remove();\r\n      }\r\n    });\r\n  }\r\n\r\n  private resolve() {\r\n    this.onCrop(() => {\r\n      return appDownloadManager.upload(this.blob);\r\n    });\r\n  }\r\n\r\n  public open(postCanvas: HTMLCanvasElement, onCrop: PopupAvatar['onCrop']) {\r\n    this.canvas = postCanvas;\r\n    this.onCrop = onCrop;\r\n\r\n    this.input.click();\r\n  }\r\n\r\n  public darkenCanvas() {\r\n    const ctx = this.canvas.getContext('2d');\r\n    ctx.fillStyle = 'rgba(0, 0, 0, 0.3)';\r\n    ctx.fillRect(0, 0, this.canvas.width, this.canvas.height);\r\n  }\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nfunction resizeableImage(originalImage: HTMLImageElement, canvas?: HTMLCanvasElement) {\r\n  let cropComponent: HTMLDivElement,\r\n    container: HTMLDivElement,\r\n    cropImage: HTMLImageElement,\r\n    event_state: Partial<{\r\n      mouse_x: number,\r\n      mouse_y: number,\r\n      container_width: number,\r\n      container_height: number,\r\n      container_left: number,\r\n      container_top: number\r\n    }> = {},\r\n    keyZoomValue = 4.0,\r\n    MINWIDTH = 50,\r\n    MINHEIGHT = 50,\r\n    CROPWIDTH = 200,\r\n    CROPHEIGHT = 200,\r\n    cropLeft = 0,\r\n    cropTop = 0,\r\n    cropWidth = 0,\r\n    cropHeight = 0,\r\n    scaledRatio = 0;\r\n\r\n  if(originalImage.complete) init();\r\n  else originalImage.onload = init;\r\n\r\n  function removeHandlers() {\r\n    container.removeEventListener('mousedown', startMoving);\r\n    container.removeEventListener('touchstart', startMoving);\r\n    container.removeEventListener('wheel', resizing);\r\n\r\n    document.removeEventListener('mouseup', endMoving);\r\n    document.removeEventListener('touchend', endMoving);\r\n    document.removeEventListener('mousemove', moving);\r\n    document.removeEventListener('touchmove', moving);\r\n    document.removeEventListener('keypress', keyHandler);\r\n\r\n    cropComponent.remove();\r\n    container.remove();\r\n    cropImage.remove();\r\n  }\r\n\r\n  function addHandlers() {\r\n    container.addEventListener('mousedown', startMoving, false);\r\n    container.addEventListener('touchstart', startMoving, false);\r\n    container.addEventListener('wheel', resizing, false);\r\n\r\n    document.addEventListener('keypress', keyHandler, false);\r\n    // document.querySelector('.btn-crop').addEventListener('click', openCropCanvasImg);\r\n  }\r\n\r\n  function init() {\r\n    originalImage.classList.add('crop-blur');\r\n    originalImage.draggable = false;\r\n\r\n    cropImage = new Image();\r\n    cropImage.src = originalImage.src;\r\n    cropImage.draggable = false;\r\n    cropImage.classList.add('crop-overlay-image');\r\n\r\n    if(!canvas) {\r\n      canvas = document.createElement('canvas');\r\n    }\r\n\r\n    cropComponent = document.createElement('div');\r\n    cropComponent.classList.add('crop-component');\r\n\r\n    container = document.createElement('div');\r\n    container.classList.add('crop-overlay');\r\n\r\n    const overlayColor = document.createElement('div');\r\n    overlayColor.classList.add('crop-overlay-color');\r\n\r\n    cropComponent.appendChild(container);\r\n    const wrapper = originalImage.parentNode as HTMLElement;\r\n    wrapper.appendChild(cropComponent);\r\n    cropComponent.appendChild(cropImage);\r\n    cropComponent.appendChild(originalImage);\r\n    cropComponent.appendChild(overlayColor);\r\n    container.appendChild(cropImage);\r\n\r\n    cropImage.style.maxWidth = originalImage.width + 'px';\r\n\r\n    scaledRatio = originalImage.naturalWidth / originalImage.offsetWidth;\r\n\r\n    const left = originalImage.offsetWidth / 2 - CROPWIDTH / 2;\r\n    const top = originalImage.offsetHeight / 2 - CROPHEIGHT / 2;\r\n\r\n    updateCropSize(CROPWIDTH, CROPHEIGHT);\r\n    updateCropImage(left, top);\r\n    updateContainer(left, top);\r\n    addHandlers();\r\n    // crop();\r\n  }\r\n\r\n  function updateCropSize(width: number, height: number) {\r\n    cropWidth = width * scaledRatio;\r\n    cropHeight = height * scaledRatio;\r\n\r\n    container.style.width = width + 'px';\r\n    container.style.height = height + 'px';\r\n  }\r\n\r\n  function updateCropImage(left: number, top: number) {\r\n    cropTop = top * scaledRatio;\r\n    cropLeft = left * scaledRatio;\r\n\r\n    cropImage.style.top = -top + 'px';\r\n    cropImage.style.left = -left + 'px';\r\n  }\r\n\r\n  function updateContainer(left: number, top: number) {\r\n    container.style.top = top + 'px';\r\n    container.style.left = left + 'px';\r\n  }\r\n\r\n  // Save the initial event details and container state\r\n  function saveEventState(e: any) {\r\n    event_state.container_width = container.offsetWidth;\r\n    event_state.container_height = container.offsetHeight;\r\n\r\n    event_state.container_left = container.offsetLeft;\r\n    event_state.container_top = container.offsetTop;\r\n\r\n    event_state.mouse_x = (e.clientX || e.pageX || e.touches && e.touches[0].clientX) + window.scrollX;\r\n    event_state.mouse_y = (e.clientY || e.pageY || e.touches && e.touches[0].clientY) + window.scrollY;\r\n  }\r\n\r\n  function imgZoom(zoom: number) {\r\n    zoom = zoom * Math.PI * 2\r\n    let newWidth = Math.floor(container.clientWidth + zoom),\r\n      newHeight = Math.floor(container.clientHeight + zoom),\r\n      w = cropImage.clientWidth,\r\n      h = cropImage.clientHeight,\r\n      left: number,\r\n      top: number,\r\n      right: number,\r\n      bottom: number;\r\n\r\n    if(newWidth < MINWIDTH) {\r\n      return;\r\n    } else if(newWidth > w) {\r\n      return;\r\n    }\r\n\r\n    left = container.offsetLeft - (zoom / 2);\r\n    top = container.offsetTop - (zoom / 2);\r\n    right = left + newWidth;\r\n    bottom = top + newHeight;\r\n\r\n    if(left < 0) left = 0;\r\n    if(top < 0) top = 0;\r\n\r\n    if(right > w) return;\r\n    if(bottom > h) return;\r\n\r\n    updateCropSize(newWidth, newWidth);\r\n    updateCropImage(left, top);\r\n    updateContainer(left, top);\r\n    // crop();\r\n  }\r\n\r\n  function keyHandler(e: KeyboardEvent) {\r\n    e.preventDefault();\r\n\r\n    switch(String.fromCharCode(e.charCode)) {\r\n      case '+':\r\n        imgZoom(keyZoomValue);\r\n        break;\r\n      case '-':\r\n        imgZoom(-keyZoomValue);\r\n        break;\r\n    }\r\n  }\r\n\r\n  function resizing(e: any) {\r\n    e.preventDefault();\r\n    imgZoom(e.deltaY > 0 ? 1 : -1);\r\n  }\r\n\r\n  function startMoving(e: MouseEvent | TouchEvent) {\r\n    e.preventDefault();\r\n    e.stopPropagation();\r\n\r\n    saveEventState(e);\r\n\r\n    document.addEventListener('mousemove', moving);\r\n    document.addEventListener('touchmove', moving);\r\n    document.addEventListener('mouseup', endMoving);\r\n    document.addEventListener('touchend', endMoving);\r\n  }\r\n\r\n  function endMoving(e: MouseEvent | TouchEvent) {\r\n    e.preventDefault();\r\n\r\n    document.removeEventListener('mouseup', endMoving);\r\n    document.removeEventListener('touchend', endMoving);\r\n    document.removeEventListener('mousemove', moving);\r\n    document.removeEventListener('touchmove', moving);\r\n  }\r\n\r\n  function moving(e: any) {\r\n    let currentTouch = {x: 0, y: 0},\r\n      left: number,\r\n      top: number,\r\n      w: number,\r\n      h: number;\r\n\r\n    e.preventDefault();\r\n    e.stopPropagation();\r\n\r\n    currentTouch.x = e.pageX || e.touches && e.touches[0].pageX;\r\n    currentTouch.y = e.pageY || e.touches && e.touches[0].pageY;\r\n\r\n    left = currentTouch.x - (event_state.mouse_x - event_state.container_left);\r\n    top = currentTouch.y - (event_state.mouse_y - event_state.container_top);\r\n    w = container.offsetWidth;\r\n    h = container.offsetHeight;\r\n\r\n    if(left < 0) left = 0;\r\n    else if(left > cropImage.offsetWidth - w) left = cropImage.offsetWidth - w;\r\n\r\n    if(top < 0) top = 0;\r\n    else if(top > cropImage.offsetHeight - h) top = cropImage.offsetHeight - h;\r\n\r\n    updateCropImage(left, top);\r\n    updateContainer(left, top);\r\n    // crop();\r\n  }\r\n\r\n  function crop() {\r\n    canvas.width = cropWidth;\r\n    canvas.height = cropHeight;\r\n\r\n    const ctx = canvas.getContext('2d');\r\n    ctx.drawImage(originalImage,\r\n      cropLeft, cropTop,\r\n      cropWidth, cropHeight,\r\n      0, 0,\r\n      cropWidth, cropHeight\r\n    );\r\n  }\r\n\r\n  return {crop, removeHandlers};\r\n}\r\n\r\nexport default resizeableImage;\r\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport PopupElement from '.';\nimport type {PeerType} from '../../lib/appManagers/appPeersManager';\nimport {LangPackKey} from '../../lib/langPack';\nimport PeerTitle from '../peerTitle';\nimport PopupPeer, {PopupPeerButtonCallbackCheckboxes, PopupPeerOptions} from './peer';\n\nexport default class PopupDeleteDialog {\n  constructor(\n    private peerId: PeerId,\n    // actionType: 'leave' | 'delete',\n    private peerType?: PeerType,\n    private onSelect?: (promise: Promise<any>) => void\n  ) {\n    this.construct();\n  }\n\n  private async construct() {\n    let {peerId, peerType, onSelect} = this;\n    const peerTitleElement = new PeerTitle({peerId}).element;\n\n    const managers = PopupElement.MANAGERS;\n    if(peerType === undefined) {\n      peerType = await managers.appPeersManager.getDialogType(peerId);\n    }\n\n    /* const callbackFlush = (checked: PopupPeerButtonCallbackCheckboxes) => {\n      const promise = appMessagesManager.flushHistory(peerId, checkboxes ? !checked[checkboxes[0].text] : undefined);\n      onSelect && onSelect(promise);\n    }; */\n\n    const callbackLeave = (checked: PopupPeerButtonCallbackCheckboxes, flush = checkboxes && !!checked.size) => {\n      let promise = managers.appChatsManager.leave(peerId.toChatId());\n\n      if(flush) {\n        promise = promise.finally(() => {\n          return managers.appMessagesManager.flushHistory(peerId);\n        }) as any;\n      }\n\n      onSelect && onSelect(promise);\n    };\n\n    const callbackDelete = (checked: PopupPeerButtonCallbackCheckboxes) => {\n      let promise: Promise<any>;\n\n      if(peerId.isUser()) {\n        promise = managers.appMessagesManager.flushHistory(peerId, false, checkboxes ? !!checked.size : undefined);\n      } else {\n        if(checked.size) {\n          promise = managers.appChatsManager.delete(peerId.toChatId());\n        } else {\n          return callbackLeave(checked);\n        }\n      }\n\n      onSelect && onSelect(promise);\n    };\n\n    let title: LangPackKey, description: LangPackKey, descriptionArgs: any[], buttons: PopupPeerOptions['buttons'], checkboxes: PopupPeerOptions['checkboxes'];\n    switch(peerType) {\n      case 'channel': {\n        if(/* actionType === 'delete' &&  */await managers.appChatsManager.hasRights(peerId.toChatId(), 'delete_chat')) {\n          title = 'ChannelDeleteMenu';\n          description = 'AreYouSureDeleteAndExitChannel';\n          buttons = [{\n            langKey: 'ChannelDeleteMenu',\n            isDanger: true,\n            callback: callbackDelete\n          }];\n\n          checkboxes = [{\n            text: 'DeleteChannelForAll'\n          }];\n        } else {\n          title = 'LeaveChannelMenu';\n          description = 'ChannelLeaveAlertWithName';\n          descriptionArgs = [peerTitleElement];\n          buttons = [{\n            langKey: 'LeaveChannel',\n            isDanger: true,\n            callback: callbackLeave\n          }];\n        }\n\n        break;\n      }\n\n      /* case 'megagroup': {\n        title = 'Leave Group?';\n        description = `Are you sure you want to leave this group?`;\n        buttons = [{\n          text: 'LEAVE ' + peerTitleElement,\n          isDanger: true,\n          callback: callbackLeave\n        }];\n\n        break;\n      } */\n\n      case 'chat': {\n        title = 'DeleteChatUser';\n        description = 'AreYouSureDeleteThisChatWithUser';\n        descriptionArgs = [peerTitleElement];\n\n        buttons = [{\n          langKey: 'DeleteChatUser',\n          isDanger: true,\n          callback: callbackDelete\n        }];\n\n        checkboxes = [{\n          text: 'DeleteMessagesOptionAlso',\n          textArgs: [\n            new PeerTitle({peerId}).element\n          ]\n        }];\n\n        break;\n      }\n\n      case 'saved': {\n        title = 'DeleteChatUser';\n        description = 'AreYouSureDeleteThisChatSavedMessages';\n        buttons = [{\n          langKey: 'DeleteChatUser',\n          isDanger: true,\n          callback: callbackDelete\n        }];\n\n        break;\n      }\n\n      case 'megagroup':\n      case 'group': {\n        if(/* actionType === 'delete' &&  */await managers.appChatsManager.hasRights(peerId.toChatId(), 'delete_chat')) {\n          title = 'DeleteMegaMenu';\n          description = 'AreYouSureDeleteAndExit';\n          buttons = [{\n            langKey: 'DeleteMegaMenu',\n            isDanger: true,\n            callback: callbackDelete\n          }];\n\n          checkboxes = [{\n            text: 'DeleteChat.DeleteGroupForAll'\n          }];\n        } else {\n          title = 'LeaveMegaMenu';\n          description = 'AreYouSureDeleteAndExitName';\n          descriptionArgs = [peerTitleElement];\n          buttons = [{\n            langKey: 'DeleteChatUser',\n            isDanger: true,\n            callback: (checkboxes) => callbackLeave(checkboxes, true)\n          }];\n        }\n\n        break;\n      }\n    }\n\n    new PopupPeer('popup-delete-chat', {\n      peerId,\n      titleLangKey: title,\n      descriptionLangKey: description,\n      descriptionLangArgs: descriptionArgs,\n      buttons,\n      checkboxes\n    }).show();\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport rootScope from '../../lib/rootScope';\nimport PopupElement, {addCancelButton} from '.';\nimport PopupPeer, {PopupPeerButtonCallbackCheckboxes, PopupPeerOptions} from './peer';\nimport {ChatType} from '../chat/chat';\nimport {i18n, LangPackKey} from '../../lib/langPack';\nimport PeerTitle from '../peerTitle';\nimport hasRights from '../../lib/appManagers/utils/chats/hasRights';\nimport filterAsync from '../../helpers/array/filterAsync';\n\nexport default class PopupDeleteMessages {\n  constructor(private peerId: PeerId, private mids: number[], private type: ChatType, private onConfirm?: () => void) {\n    this.construct();\n  }\n\n  private async construct() {\n    let {peerId, mids, type, onConfirm} = this;\n\n    const peerTitleElement = new PeerTitle({peerId}).element;\n\n    const managers = PopupElement.MANAGERS;\n\n    mids = mids.slice();\n    const callback = (checked: PopupPeerButtonCallbackCheckboxes, revoke?: boolean) => {\n      onConfirm && onConfirm();\n      if(type === 'scheduled') {\n        managers.appMessagesManager.deleteScheduledMessages(peerId, mids);\n      } else {\n        managers.appMessagesManager.deleteMessages(peerId, mids, !!checked.size || revoke);\n      }\n    };\n\n    const buttons: PopupPeerOptions['buttons'] = [{\n      langKey: 'Delete',\n      isDanger: true,\n      callback\n    }];\n    const checkboxes: PopupPeerOptions['checkboxes'] = [];\n    let title: LangPackKey, titleArgs: any[], description: LangPackKey, descriptionArgs: any[];\n    if(mids.length === 1) {\n      title = 'DeleteSingleMessagesTitle';\n    } else {\n      title = 'DeleteMessagesTitle';\n      titleArgs = [i18n('messages', [mids.length])];\n    }\n\n    if(await managers.appPeersManager.isMegagroup(peerId)) {\n      description = mids.length === 1 ? 'AreYouSureDeleteSingleMessageMega' : 'AreYouSureDeleteFewMessagesMega';\n    } else {\n      description = mids.length === 1 ? 'AreYouSureDeleteSingleMessage' : 'AreYouSureDeleteFewMessages';\n    }\n\n    if(peerId === rootScope.myId || type === 'scheduled') {\n\n    } else {\n      if(peerId.isUser()) {\n        checkboxes.push({\n          text: 'DeleteMessagesOptionAlso',\n          textArgs: [peerTitleElement]\n        });\n      } else {\n        const chat = await managers.appChatsManager.getChat(peerId.toChatId());\n\n        const _hasRights = hasRights(chat, 'delete_messages');\n        if(chat._ === 'chat') {\n          const canRevoke = _hasRights ? mids.slice() : await filterAsync(mids, async(mid) => {\n            const message = await managers.appMessagesManager.getMessageByPeer(peerId, mid);\n            return message.fromId === rootScope.myId;\n          });\n\n          if(canRevoke.length) {\n            if(canRevoke.length === mids.length) {\n              checkboxes.push({\n                text: 'DeleteForAll'\n              });\n            } else {\n              checkboxes.push({\n                text: 'DeleteMessagesOption'\n              });\n\n              description = 'DeleteMessagesTextGroup';\n              descriptionArgs = [i18n('messages', [canRevoke.length])];\n              // description = `You can also delete the ${canRevoke.length} message${canRevoke.length > 1 ? 's' : ''} you sent from the inboxes of other group members by pressing \"${buttonText}\".`;\n            }\n          }\n        } else {\n          buttons[0].callback = (checked) => callback(checked, true);\n        }\n      }\n    }\n\n    addCancelButton(buttons);\n\n    const popup = new PopupPeer('popup-delete-chat', {\n      peerId,\n      titleLangKey: title,\n      titleLangArgs: titleArgs,\n      descriptionLangKey: description,\n      descriptionLangArgs: descriptionArgs,\n      buttons,\n      checkboxes\n    });\n\n    popup.show();\n  }\n}\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport appImManager from '../../lib/appManagers/appImManager';\r\nimport PopupPickUser from './pickUser';\r\n\r\nexport default class PopupForward extends PopupPickUser {\r\n  constructor(\r\n    peerIdMids: {[fromPeerId: PeerId]: number[]},\r\n    onSelect?: (peerId: PeerId) => Promise<void> | void,\r\n    overrideOnSelect = false\r\n  ) {\r\n    super({\r\n      peerTypes: ['dialogs', 'contacts'],\r\n      onSelect: overrideOnSelect ? onSelect : async(peerId) => {\r\n        if(onSelect) {\r\n          const res = onSelect(peerId);\r\n          if(res instanceof Promise) {\r\n            await res;\r\n          }\r\n        }\r\n\r\n        appImManager.setInnerPeer({peerId});\r\n        appImManager.chat.input.initMessagesForward(peerIdMids);\r\n      },\r\n      placeholder: 'ShareModal.Search.ForwardPlaceholder',\r\n      chatRightsAction: 'send_messages',\r\n      selfPresence: 'ChatYourSelf'\r\n    });\r\n  }\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport ripple from '../ripple';\r\nimport animationIntersector from '../animationIntersector';\r\nimport appNavigationController, {NavigationItem} from '../appNavigationController';\r\nimport {i18n, LangPackKey, _i18n} from '../../lib/langPack';\r\nimport findUpClassName from '../../helpers/dom/findUpClassName';\r\nimport blurActiveElement from '../../helpers/dom/blurActiveElement';\r\nimport ListenerSetter from '../../helpers/listenerSetter';\r\nimport {attachClickEvent, simulateClickEvent} from '../../helpers/dom/clickEvent';\r\nimport isSendShortcutPressed from '../../helpers/dom/isSendShortcutPressed';\r\nimport cancelEvent from '../../helpers/dom/cancelEvent';\r\nimport EventListenerBase, {EventListenerListeners} from '../../helpers/eventListenerBase';\r\nimport {addFullScreenListener, getFullScreenElement} from '../../helpers/dom/fullScreen';\r\nimport indexOfAndSplice from '../../helpers/array/indexOfAndSplice';\r\nimport {AppManagers} from '../../lib/appManagers/managers';\r\nimport overlayCounter from '../../helpers/overlayCounter';\r\nimport Scrollable from '../scrollable';\r\nimport {getMiddleware, MiddlewareHelper} from '../../helpers/middleware';\r\n\r\nexport type PopupButton = {\r\n  text?: string,\r\n  callback?: () => void,\r\n  langKey?: LangPackKey,\r\n  langArgs?: any[],\r\n  isDanger?: true,\r\n  isCancel?: true,\r\n  element?: HTMLButtonElement\r\n};\r\n\r\nexport type PopupOptions = Partial<{\r\n  closable: boolean,\r\n  overlayClosable: boolean,\r\n  withConfirm: LangPackKey | boolean,\r\n  body: boolean,\r\n  confirmShortcutIsSendShortcut: boolean,\r\n  withoutOverlay: boolean,\r\n  scrollable: boolean,\r\n  buttons: Array<PopupButton>,\r\n  title: boolean | LangPackKey\r\n}>;\r\n\r\nexport interface PopupElementConstructable<T extends PopupElement = any> {\r\n  new(...args: any[]): T;\r\n}\r\n\r\nconst DEFAULT_APPEND_TO = document.body;\r\nlet appendPopupTo = DEFAULT_APPEND_TO;\r\n\r\nconst onFullScreenChange = () => {\r\n  appendPopupTo = getFullScreenElement() || DEFAULT_APPEND_TO;\r\n  PopupElement.reAppend();\r\n};\r\n\r\naddFullScreenListener(DEFAULT_APPEND_TO, onFullScreenChange);\r\n\r\ntype PopupListeners = {\r\n  close: () => void,\r\n  closeAfterTimeout: () => void\r\n};\r\n\r\nexport default class PopupElement<T extends EventListenerListeners = {}> extends EventListenerBase<PopupListeners & T> {\r\n  private static POPUPS: PopupElement<any>[] = [];\r\n  public static MANAGERS: AppManagers;\r\n\r\n  protected element = document.createElement('div');\r\n  protected container = document.createElement('div');\r\n  protected header = document.createElement('div');\r\n  protected title = document.createElement('div');\r\n  protected btnClose: HTMLElement;\r\n  protected btnConfirm: HTMLButtonElement;\r\n  protected body: HTMLElement;\r\n  protected buttonsEl: HTMLElement;\r\n\r\n  protected onEscape: () => boolean = () => true;\r\n\r\n  protected navigationItem: NavigationItem;\r\n\r\n  protected listenerSetter: ListenerSetter;\r\n\r\n  protected confirmShortcutIsSendShortcut: boolean;\r\n  protected btnConfirmOnEnter: HTMLElement;\r\n\r\n  protected withoutOverlay: boolean;\r\n\r\n  protected managers: AppManagers;\r\n\r\n  protected scrollable: Scrollable;\r\n\r\n  protected buttons: Array<PopupButton>;\r\n\r\n  protected middlewareHelper: MiddlewareHelper;\r\n\r\n  constructor(className: string, options: PopupOptions = {}) {\r\n    super(false);\r\n    this.element.classList.add('popup');\r\n    this.element.className = 'popup' + (className ? ' ' + className : '');\r\n    this.container.classList.add('popup-container', 'z-depth-1');\r\n\r\n    this.header.classList.add('popup-header');\r\n\r\n    if(options.title) {\r\n      this.title.classList.add('popup-title');\r\n      if(typeof(options.title) === 'string') {\r\n        _i18n(this.title, options.title);\r\n      }\r\n\r\n      this.header.append(this.title);\r\n    }\r\n\r\n    this.middlewareHelper = getMiddleware();\r\n    this.listenerSetter = new ListenerSetter();\r\n    this.managers = PopupElement.MANAGERS;\r\n\r\n    this.confirmShortcutIsSendShortcut = options.confirmShortcutIsSendShortcut;\r\n\r\n    if(options.closable) {\r\n      this.btnClose = document.createElement('span');\r\n      this.btnClose.classList.add('btn-icon', 'popup-close', 'tgico-close');\r\n      // ripple(this.closeBtn);\r\n      this.header.prepend(this.btnClose);\r\n\r\n      attachClickEvent(this.btnClose, this.hide, {listenerSetter: this.listenerSetter, once: true});\r\n    }\r\n\r\n    this.withoutOverlay = options.withoutOverlay;\r\n    if(this.withoutOverlay) {\r\n      this.element.classList.add('no-overlay');\r\n    }\r\n\r\n    if(options.overlayClosable) {\r\n      attachClickEvent(this.element, (e: MouseEvent) => {\r\n        if(!findUpClassName(e.target, 'popup-container')) {\r\n          this.hide();\r\n        }\r\n      }, {listenerSetter: this.listenerSetter});\r\n    }\r\n\r\n    if(options.withConfirm) {\r\n      this.btnConfirm = document.createElement('button');\r\n      this.btnConfirm.classList.add('btn-primary', 'btn-color-primary');\r\n      if(options.withConfirm !== true) {\r\n        this.btnConfirm.append(i18n(options.withConfirm));\r\n      }\r\n      this.header.append(this.btnConfirm);\r\n      ripple(this.btnConfirm);\r\n    }\r\n\r\n    this.container.append(this.header);\r\n    if(options.body) {\r\n      this.body = document.createElement('div');\r\n      this.body.classList.add('popup-body');\r\n      this.container.append(this.body);\r\n    }\r\n\r\n    if(options.scrollable) {\r\n      const scrollable = this.scrollable = new Scrollable(this.body);\r\n      scrollable.onAdditionalScroll = () => {\r\n        scrollable.container.classList.toggle('scrolled-top', !scrollable.scrollTop);\r\n        scrollable.container.classList.toggle('scrolled-bottom', scrollable.isScrolledDown);\r\n      };\r\n\r\n      scrollable.container.classList.add('scrolled-top', 'scrolled-bottom', 'scrollable-y-bordered');\r\n\r\n      if(!this.body) {\r\n        this.container.insertBefore(scrollable.container, this.header.nextSibling);\r\n      }\r\n    }\r\n\r\n    let btnConfirmOnEnter = this.btnConfirm;\r\n    const buttons = this.buttons = options.buttons;\r\n    if(buttons?.length) {\r\n      const buttonsDiv = this.buttonsEl = document.createElement('div');\r\n      buttonsDiv.classList.add('popup-buttons');\r\n\r\n      const buttonsElements = buttons.map((b) => {\r\n        const button = document.createElement('button');\r\n        button.className = 'btn' + (b.isDanger ? ' danger' : ' primary');\r\n\r\n        ripple(button);\r\n\r\n        if(b.text) {\r\n          button.innerHTML =  b.text;\r\n        } else {\r\n          button.append(i18n(b.langKey, b.langArgs));\r\n        }\r\n\r\n        attachClickEvent(button, () => {\r\n          b.callback && b.callback();\r\n          this.destroy();\r\n        }, {listenerSetter: this.listenerSetter, once: true});\r\n\r\n        return b.element = button;\r\n      });\r\n\r\n      if(!btnConfirmOnEnter && buttons.length === 2) {\r\n        const button = buttons.find((button) => !button.isCancel);\r\n        if(button) {\r\n          btnConfirmOnEnter = button.element;\r\n        }\r\n      }\r\n\r\n      buttonsDiv.append(...buttonsElements);\r\n      this.container.append(buttonsDiv);\r\n    }\r\n\r\n    this.btnConfirmOnEnter = btnConfirmOnEnter;\r\n\r\n    this.element.append(this.container);\r\n\r\n    PopupElement.POPUPS.push(this);\r\n  }\r\n\r\n  protected onContentUpdate() {\r\n    if(this.scrollable) {\r\n      this.scrollable.onAdditionalScroll();\r\n    }\r\n  }\r\n\r\n  public show() {\r\n    this.navigationItem = {\r\n      type: 'popup',\r\n      onPop: () => this.destroy(),\r\n      onEscape: this.onEscape\r\n    };\r\n\r\n    appNavigationController.pushItem(this.navigationItem);\r\n\r\n    blurActiveElement(); // * hide mobile keyboard\r\n    appendPopupTo.append(this.element);\r\n    void this.element.offsetWidth; // reflow\r\n    this.element.classList.add('active');\r\n\r\n    this.onContentUpdate();\r\n\r\n    if(!this.withoutOverlay) {\r\n      overlayCounter.isOverlayActive = true;\r\n      animationIntersector.checkAnimations(true);\r\n    }\r\n\r\n    // cannot add event instantly because keydown propagation will fire it\r\n    // if(this.btnConfirmOnEnter) {\r\n    setTimeout(() => {\r\n      if(!this.element.classList.contains('active')) {\r\n        return;\r\n      }\r\n\r\n      this.listenerSetter.add(document.body)('keydown', (e) => {\r\n        if(PopupElement.POPUPS[PopupElement.POPUPS.length - 1] !== this) {\r\n          return;\r\n        }\r\n\r\n        if(this.confirmShortcutIsSendShortcut ? isSendShortcutPressed(e) : e.key === 'Enter') {\r\n          simulateClickEvent(this.btnConfirmOnEnter);\r\n          cancelEvent(e);\r\n        }\r\n      });\r\n    }, 0);\r\n    // }\r\n  }\r\n\r\n  public hide = () => {\r\n    appNavigationController.backByItem(this.navigationItem);\r\n  };\r\n\r\n  protected destroy() {\r\n    this.dispatchEvent<PopupListeners>('close');\r\n    this.element.classList.add('hiding');\r\n    this.element.classList.remove('active');\r\n    this.listenerSetter.removeAll();\r\n    this.middlewareHelper.destroy();\r\n\r\n    if(!this.withoutOverlay) {\r\n      overlayCounter.isOverlayActive = false;\r\n    }\r\n\r\n    appNavigationController.removeItem(this.navigationItem);\r\n    this.navigationItem = undefined;\r\n\r\n    indexOfAndSplice(PopupElement.POPUPS, this);\r\n\r\n    // ! calm\r\n    onFullScreenChange();\r\n\r\n    setTimeout(() => {\r\n      this.element.remove();\r\n      this.dispatchEvent<PopupListeners>('closeAfterTimeout');\r\n      this.cleanup();\r\n\r\n      if(!this.withoutOverlay) {\r\n        animationIntersector.checkAnimations(false);\r\n      }\r\n    }, 150);\r\n  }\r\n\r\n  public static reAppend() {\r\n    this.POPUPS.forEach((popup) => {\r\n      const {element, container} = popup;\r\n      const parentElement = element.parentElement;\r\n      if(parentElement && parentElement !== appendPopupTo && appendPopupTo !== container) {\r\n        appendPopupTo.append(element);\r\n      }\r\n    });\r\n  }\r\n\r\n  public static getPopups<T extends PopupElement>(popupConstructor: PopupElementConstructable<T>) {\r\n    return this.POPUPS.filter((element) => element instanceof popupConstructor) as T[];\r\n  }\r\n\r\n  public static createPopup<T extends PopupElement, A extends Array<any>>(ctor: {new(...args: A): T}, ...args: A) {\r\n    const popup = new ctor(...args);\r\n    return popup;\r\n  }\r\n}\r\n\r\nexport const addCancelButton = (buttons: PopupButton[]) => {\r\n  const button = buttons.find((b) => b.isCancel);\r\n  if(!button) {\r\n    buttons.push({\r\n      langKey: 'Cancel',\r\n      isCancel: true\r\n    });\r\n  }\r\n\r\n  return buttons;\r\n};\r\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport tsNow from '../../helpers/tsNow';\nimport {LangPackKey} from '../../lib/langPack';\nimport {MUTE_UNTIL} from '../../lib/mtproto/mtproto_config';\nimport RadioField from '../radioField';\nimport Row, {RadioFormFromRows} from '../row';\nimport PopupPeer from './peer';\n\nconst ONE_HOUR = 3600;\nconst times: {time: number, langKey: LangPackKey}[] = [{\n  time: ONE_HOUR,\n  langKey: 'ChatList.Mute.1Hour'\n}, {\n  time: ONE_HOUR * 4,\n  langKey: 'ChatList.Mute.4Hours'\n}, {\n  time: ONE_HOUR * 8,\n  langKey: 'ChatList.Mute.8Hours'\n}, {\n  time: ONE_HOUR * 24,\n  langKey: 'ChatList.Mute.1Day'\n}, {\n  time: ONE_HOUR * 24 * 3,\n  langKey: 'ChatList.Mute.3Days'\n}, {\n  time: -1,\n  langKey: 'ChatList.Mute.Forever'\n}];\n\nexport default class PopupMute extends PopupPeer {\n  constructor(peerId: PeerId) {\n    super('popup-mute', {\n      peerId,\n      titleLangKey: 'Notifications',\n      buttons: [{\n        langKey: 'ChatList.Context.Mute',\n        callback: () => {\n          this.managers.appMessagesManager.mutePeer(peerId, time === -1 ? MUTE_UNTIL : tsNow(true) + time);\n        }\n      }],\n      body: true\n    });\n\n    const name = 'mute-time';\n    const rows = times.map((time) => {\n      const row = new Row({\n        radioField: new RadioField({\n          langKey: time.langKey,\n          name,\n          value: '' + time.time\n        })\n      });\n\n      return row;\n    });\n\n    let time: number;\n    const radioForm = RadioFormFromRows(rows, (value) => {\n      time = +value;\n    });\n\n    this.body.append(radioForm);\n\n    rows[rows.length - 1].radioField.checked = true;\n\n    this.show();\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport AvatarElement from '../avatar';\nimport PopupElement, {addCancelButton, PopupButton, PopupOptions} from '.';\nimport {i18n, LangPackKey} from '../../lib/langPack';\nimport CheckboxField, {CheckboxFieldOptions} from '../checkboxField';\nimport setInnerHTML from '../../helpers/dom/setInnerHTML';\n\nexport type PopupPeerButton = Omit<PopupButton, 'callback'> & Partial<{callback: PopupPeerButtonCallback}>;\nexport type PopupPeerButtonCallbackCheckboxes = Set<LangPackKey>;\nexport type PopupPeerButtonCallback = (checkboxes?: PopupPeerButtonCallbackCheckboxes) => void;\nexport type PopupPeerCheckboxOptions = CheckboxFieldOptions & {checkboxField?: CheckboxField};\n\nexport type PopupPeerOptions = Omit<PopupOptions, 'buttons' | 'title'> & Partial<{\n  peerId: PeerId,\n  title: string | HTMLElement,\n  titleLangKey: LangPackKey,\n  titleLangArgs: any[],\n  noTitle: boolean,\n  description: string | DocumentFragment,\n  descriptionLangKey: LangPackKey,\n  descriptionLangArgs: any[],\n  buttons: Array<PopupPeerButton>,\n  checkboxes: Array<PopupPeerCheckboxOptions>\n}>;\nexport default class PopupPeer extends PopupElement {\n  protected description: HTMLParagraphElement;\n\n  constructor(private className: string, options: PopupPeerOptions = {}) {\n    super('popup-peer' + (className ? ' ' + className : ''), {\n      overlayClosable: true,\n      ...options,\n      title: true,\n      buttons: options.buttons && addCancelButton(options.buttons)\n    });\n\n    if(options.peerId) {\n      const avatarEl = new AvatarElement();\n      avatarEl.classList.add('avatar-32');\n      avatarEl.updateWithOptions({\n        isDialog: true,\n        peerId: options.peerId\n      });\n      this.header.prepend(avatarEl);\n    }\n\n    if(!options.noTitle) {\n      if(options.titleLangKey || !options.title) this.title.append(i18n(options.titleLangKey || 'AppName', options.titleLangArgs));\n      else if(options.title instanceof HTMLElement) {\n        this.title.append(options.title);\n      } else this.title.innerText = options.title || '';\n    }\n\n    const fragment = document.createDocumentFragment();\n\n    if(options.descriptionLangKey || options.description) {\n      const p = this.description = document.createElement('p');\n      p.classList.add('popup-description');\n      if(options.descriptionLangKey) p.append(i18n(options.descriptionLangKey, options.descriptionLangArgs));\n      else if(options.description) setInnerHTML(p, options.description);\n\n      fragment.append(p);\n    }\n\n    if(options.checkboxes) {\n      this.container.classList.add('have-checkbox');\n\n      options.checkboxes.forEach((o) => {\n        o.withRipple = true;\n        const checkboxField = new CheckboxField(o);\n        o.checkboxField = checkboxField;\n        fragment.append(checkboxField.label);\n      });\n\n      options.buttons.forEach((button) => {\n        if(button.callback) {\n          const original = button.callback;\n          button.callback = () => {\n            const c: Set<LangPackKey> = new Set();\n            options.checkboxes.forEach((o) => {\n              if(o.checkboxField.checked) {\n                c.add(o.text);\n              }\n            });\n            original(c);\n          };\n        }\n      });\n    }\n\n    this.container.insertBefore(fragment, this.header.nextElementSibling);\n  }\n}\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport IS_TOUCH_SUPPORTED from '../../environment/touchSupport';\r\nimport AppSelectPeers from '../appSelectPeers';\r\nimport PopupElement from '.';\r\nimport {LangPackKey, _i18n} from '../../lib/langPack';\r\n\r\nexport default class PopupPickUser extends PopupElement {\r\n  protected selector: AppSelectPeers;\r\n\r\n  constructor(options: {\r\n    peerTypes: AppSelectPeers['peerType'],\r\n    onSelect?: (peerId: PeerId) => Promise<void> | void,\r\n    placeholder: LangPackKey,\r\n    chatRightsAction?: AppSelectPeers['chatRightsAction'],\r\n    peerId?: number,\r\n    selfPresence?: LangPackKey\r\n  }) {\r\n    super('popup-forward', {closable: true, overlayClosable: true, body: true, title: true});\r\n\r\n    this.selector = new AppSelectPeers({\r\n      appendTo: this.body,\r\n      onChange: async() => {\r\n        const selected = this.selector.getSelected();\r\n        const peerId = selected[selected.length - 1].toPeerId();\r\n\r\n        if(options.onSelect) {\r\n          const res = options.onSelect(peerId);\r\n          if(res instanceof Promise) {\r\n            try {\r\n              await res;\r\n            } catch(err) {\r\n              return;\r\n            }\r\n          }\r\n        }\r\n\r\n        this.selector = null;\r\n        this.hide();\r\n      },\r\n      peerType: options.peerTypes,\r\n      onFirstRender: () => {\r\n        this.show();\r\n        this.selector.checkForTriggers(); // ! due to zero height before mounting\r\n\r\n        if(!IS_TOUCH_SUPPORTED) {\r\n          this.selector.input.focus();\r\n        }\r\n      },\r\n      chatRightsAction: options.chatRightsAction,\r\n      multiSelect: false,\r\n      rippleEnabled: false,\r\n      avatarSize: 46,\r\n      peerId: options.peerId,\r\n      placeholder: options.placeholder,\r\n      selfPresence: options.selfPresence,\r\n      managers: this.managers\r\n    });\r\n\r\n    // this.scrollable = new Scrollable(this.body);\r\n\r\n    this.title.append(this.selector.input);\r\n  }\r\n}\r\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport PopupPeer from './peer';\n\nexport default class PopupSendNow extends PopupPeer {\n  constructor(peerId: PeerId, mids: number[], onConfirm?: () => void) {\n    super('popup-delete-chat', {\n      title: `Send Message${mids.length > 1 ? 's' : ''} Now`,\n      description: mids.length > 1 ? 'Send ' + mids.length + ' messages now?' : 'Send message now?',\n      buttons: [{\n        langKey: 'Send',\n        callback: () => {\n          onConfirm && onConfirm();\n          this.managers.appMessagesManager.sendScheduledMessages(peerId, mids);\n        }\n      }]\n    });\n\n    this.show();\n  }\n}\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport PopupElement from '.';\r\nimport type {AppStickersManager} from '../../lib/appManagers/appStickersManager';\r\nimport {wrapSticker} from '../wrappers';\r\nimport LazyLoadQueue from '../lazyLoadQueue';\r\nimport {putPreloader} from '../putPreloader';\r\nimport animationIntersector, {AnimationItemGroup} from '../animationIntersector';\r\nimport appImManager from '../../lib/appManagers/appImManager';\r\nimport mediaSizes from '../../helpers/mediaSizes';\r\nimport {i18n} from '../../lib/langPack';\r\nimport Button from '../button';\r\nimport findUpClassName from '../../helpers/dom/findUpClassName';\r\nimport toggleDisability from '../../helpers/dom/toggleDisability';\r\nimport {attachClickEvent} from '../../helpers/dom/clickEvent';\r\nimport {toastNew} from '../toast';\r\nimport setInnerHTML from '../../helpers/dom/setInnerHTML';\r\nimport wrapEmojiText from '../../lib/richTextProcessor/wrapEmojiText';\r\nimport createStickersContextMenu from '../../helpers/dom/createStickersContextMenu';\r\nimport attachStickerViewerListeners from '../stickerViewer';\r\nimport wrapRichText from '../../lib/richTextProcessor/wrapRichText';\r\nimport {Document, MessageEntity, StickerSet} from '../../layer';\r\nimport Row from '../row';\r\nimport replaceContent from '../../helpers/dom/replaceContent';\r\nimport rootScope from '../../lib/rootScope';\r\n\r\nconst ANIMATION_GROUP: AnimationItemGroup = 'STICKERS-POPUP';\r\n\r\nexport default class PopupStickers extends PopupElement {\r\n  private stickersFooter: HTMLElement;\r\n  private appendTo: HTMLElement;\r\n  private updateAdded: {[setId: Long]: (added: boolean) => void};\r\n  private sets: StickerSet.stickerSet[];\r\n  private button: HTMLElement;\r\n\r\n  constructor(\r\n    private stickerSetInput: Parameters<AppStickersManager['getStickerSet']>[0] | Parameters<AppStickersManager['getStickerSet']>[0][],\r\n    private isEmojis?: boolean\r\n  ) {\r\n    super('popup-stickers', {closable: true, overlayClosable: true, body: true, scrollable: true, title: true});\r\n\r\n    this.title.append(i18n('Loading'));\r\n    this.updateAdded = {};\r\n\r\n    this.addEventListener('close', () => {\r\n      animationIntersector.setOnlyOnePlayableGroup();\r\n    });\r\n\r\n    this.appendTo = this.scrollable.container;\r\n\r\n    this.appendTo.classList.add('is-loading');\r\n    putPreloader(this.appendTo, true);\r\n\r\n    this.stickersFooter = document.createElement('div');\r\n    this.stickersFooter.classList.add('sticker-set-footer');\r\n\r\n    const btn = Button('btn-primary btn-primary-transparent disable-hover', {noRipple: true, text: 'Loading'});\r\n    this.stickersFooter.append(btn);\r\n\r\n    this.body.append(this.stickersFooter);\r\n\r\n    attachStickerViewerListeners({listenTo: this.appendTo, listenerSetter: this.listenerSetter});\r\n\r\n    const onStickerSetUpdate = (set: StickerSet.stickerSet) => {\r\n      const idx = this.sets.findIndex((_set) => _set.id === set.id);\r\n      if(idx === -1) {\r\n        return;\r\n      }\r\n\r\n      this.sets[idx] = set;\r\n      const updateAdded = this.updateAdded[set.id];\r\n      updateAdded?.(!!set.installed_date);\r\n      this.updateButton();\r\n    };\r\n\r\n    this.listenerSetter.add(rootScope)('stickers_installed', onStickerSetUpdate);\r\n    this.listenerSetter.add(rootScope)('stickers_deleted', onStickerSetUpdate);\r\n\r\n    this.loadStickerSet();\r\n  }\r\n\r\n  private createStickerSetElements(set?: StickerSet.stickerSet) {\r\n    const container = document.createElement('div');\r\n    container.classList.add('sticker-set');\r\n\r\n    let headerRow: Row, updateAdded: (added: boolean) => void;\r\n    if(set) {\r\n      headerRow = new Row({\r\n        title: wrapEmojiText(set.title),\r\n        subtitle: i18n(set.pFlags.emojis ? 'EmojiCount' : 'Stickers', [set.count]),\r\n        buttonRight: true\r\n      });\r\n\r\n      updateAdded = (added) => {\r\n        replaceContent(headerRow.buttonRight, i18n(added ? 'Stickers.SearchAdded' : 'Stickers.SearchAdd'));\r\n        headerRow.buttonRight.classList.toggle('active', added);\r\n      };\r\n\r\n      updateAdded(!!set.installed_date);\r\n\r\n      container.append(headerRow.container);\r\n    }\r\n\r\n    const itemsContainer = document.createElement('div');\r\n    itemsContainer.classList.add('sticker-set-stickers');\r\n\r\n    container.append(itemsContainer);\r\n\r\n    return {container, headerRow, updateAdded, itemsContainer};\r\n  }\r\n\r\n  private onStickersClick = async(e: MouseEvent) => {\r\n    const target = findUpClassName(e.target, 'sticker-set-sticker');\r\n    if(!target) return;\r\n\r\n    const docId = target.dataset.docId;\r\n    if(await appImManager.chat.input.sendMessageWithDocument(docId)) {\r\n      this.hide();\r\n    }\r\n  };\r\n\r\n  private async loadStickerSet() {\r\n    const middleware = this.middlewareHelper.get();\r\n    const inputs = Array.isArray(this.stickerSetInput) ? this.stickerSetInput : [this.stickerSetInput];\r\n    const setsPromises = inputs.map((input) => this.managers.appStickersManager.getStickerSet(input));\r\n    let sets = await Promise.all(setsPromises);\r\n    if(!middleware()) return;\r\n    let firstSet = sets[0];\r\n    if(sets.length === 1 && !firstSet) {\r\n      toastNew({langPackKey: this.isEmojis ? 'AddEmojiNotFound' : 'StickerSet.DontExist'});\r\n      this.hide();\r\n      return;\r\n    }\r\n\r\n    sets = sets.filter(Boolean);\r\n    firstSet = sets[0];\r\n\r\n    this.sets = sets.map((set) => set.set);\r\n\r\n    const isEmojis = this.isEmojis ??= !!firstSet.set.pFlags.emojis;\r\n\r\n    if(!isEmojis) {\r\n      attachClickEvent(this.appendTo, this.onStickersClick, {listenerSetter: this.listenerSetter});\r\n\r\n      const {destroy} = createStickersContextMenu({\r\n        listenTo: this.appendTo,\r\n        isStickerPack: true,\r\n        onSend: () => this.hide()\r\n      });\r\n\r\n      this.addEventListener('close', destroy);\r\n    }\r\n\r\n    animationIntersector.setOnlyOnePlayableGroup(ANIMATION_GROUP);\r\n\r\n    const lazyLoadQueue = new LazyLoadQueue();\r\n    const loadPromises: Promise<any>[] = [];\r\n\r\n    const containersPromises = sets.map(async(set) => {\r\n      const {container, itemsContainer, headerRow, updateAdded} = this.createStickerSetElements(sets.length > 1 ? set.set : undefined);\r\n\r\n      if(headerRow) {\r\n        attachClickEvent(headerRow.buttonRight, () => {\r\n          this.managers.appStickersManager.toggleStickerSet(set.set);\r\n        }, {listenerSetter: this.listenerSetter});\r\n      }\r\n\r\n      this.updateAdded[set.set.id] = updateAdded;\r\n\r\n      let divs: (HTMLElement | DocumentFragment)[];\r\n\r\n      const docs = set.documents.filter((doc) => doc?._ === 'document') as Document.document[];\r\n      if(isEmojis) {\r\n        let text = '';\r\n        const entities: MessageEntity[] = [];\r\n        docs.forEach((doc) => {\r\n          entities.push({\r\n            _: 'messageEntityCustomEmoji',\r\n            offset: text.length,\r\n            length: doc.stickerEmojiRaw.length,\r\n            document_id: doc.id\r\n          });\r\n\r\n          text += doc.stickerEmojiRaw;\r\n        });\r\n\r\n        const wrapped = wrapRichText(text, {\r\n          entities,\r\n          loadPromises,\r\n          animationGroup: ANIMATION_GROUP,\r\n          customEmojiSize: mediaSizes.active.esgCustomEmoji,\r\n          middleware\r\n          // lazyLoadQueue\r\n        });\r\n\r\n        divs = [wrapped];\r\n\r\n        itemsContainer.classList.add('is-emojis');\r\n      } else {\r\n        divs = await Promise.all(docs.map(async(doc) => {\r\n          const div = document.createElement('div');\r\n          div.classList.add('sticker-set-sticker');\r\n\r\n          const size = mediaSizes.active.esgSticker.width;\r\n\r\n          await wrapSticker({\r\n            doc,\r\n            div,\r\n            lazyLoadQueue,\r\n            group: ANIMATION_GROUP,\r\n            play: true,\r\n            loop: true,\r\n            width: size,\r\n            height: size,\r\n            withLock: true,\r\n            loadPromises,\r\n            middleware\r\n          });\r\n\r\n          return div;\r\n        }));\r\n      }\r\n\r\n      itemsContainer.append(...divs.filter(Boolean));\r\n\r\n      return container;\r\n    });\r\n\r\n    const containers = await Promise.all(containersPromises);\r\n    await Promise.all(loadPromises);\r\n\r\n    const button = this.button = Button('', {noRipple: true});\r\n\r\n    this.updateButton();\r\n\r\n    attachClickEvent(button, () => {\r\n      const toggle = toggleDisability([button], true);\r\n\r\n      this.managers.appStickersManager.toggleStickerSets(sets.map((set) => set.set)).then(() => {\r\n        this.hide();\r\n      }).catch(() => {\r\n        toggle();\r\n      });\r\n    }, {listenerSetter: this.listenerSetter});\r\n\r\n    if(sets.length === 1) {\r\n      setInnerHTML(this.title, wrapEmojiText(firstSet.set.title));\r\n    } else {\r\n      setInnerHTML(this.title, i18n('Emoji'));\r\n    }\r\n\r\n    this.stickersFooter.textContent = '';\r\n    this.stickersFooter.append(button);\r\n\r\n    this.appendTo.classList.remove('is-loading');\r\n    this.appendTo.textContent = '';\r\n    this.appendTo.append(...containers);\r\n\r\n    this.scrollable.onAdditionalScroll();\r\n  }\r\n\r\n  private updateButton() {\r\n    const {sets, isEmojis} = this;\r\n    let isAdd: boolean, buttonAppend: HTMLElement;\r\n    if(sets.length === 1) {\r\n      const firstSet = sets[0];\r\n      buttonAppend = i18n(isEmojis ? 'EmojiCount' : 'Stickers', [firstSet.count]);\r\n      isAdd = !firstSet.installed_date;\r\n    } else {\r\n      const installed = sets.filter((set) => set.installed_date);\r\n      let count: number;\r\n      if(sets.length === installed.length) {\r\n        isAdd = false;\r\n        count = sets.length;\r\n      } else {\r\n        isAdd = true;\r\n        count = sets.length - installed.length;\r\n      }\r\n\r\n      buttonAppend = i18n('EmojiPackCount', [count]);\r\n    }\r\n\r\n    this.button.className = isAdd ? 'btn-primary btn-color-primary' : 'btn-primary btn-primary-transparent danger';\r\n    replaceContent(this.button, i18n(isAdd ? 'AddStickersCount' : 'RemoveStickersCount', [buttonAppend]));\r\n  }\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport {CancellablePromise} from '../helpers/cancellablePromise';\r\nimport SetTransition from './singleTransition';\r\nimport {fastRaf} from '../helpers/schedulers';\r\nimport cancelEvent from '../helpers/dom/cancelEvent';\r\nimport {attachClickEvent} from '../helpers/dom/clickEvent';\r\nimport isInDOM from '../helpers/dom/isInDOM';\r\nimport safeAssign from '../helpers/object/safeAssign';\r\n\r\nconst TRANSITION_TIME = 200;\r\n\r\nexport default class ProgressivePreloader {\r\n  public preloader: HTMLDivElement;\r\n  public circle: SVGCircleElement;\r\n  private cancelSvg: SVGSVGElement;\r\n  private downloadSvg: HTMLElement;\r\n\r\n  private tempId = 0;\r\n  public detached = true;\r\n\r\n  public promise: CancellablePromise<any> = null;\r\n\r\n  public isUpload = false;\r\n  private cancelable = true;\r\n  private streamable = false;\r\n  private tryAgainOnFail = true;\r\n  private attachMethod: 'append' | 'prepend' = 'append';\r\n\r\n  public loadFunc: (e?: Event) => any;\r\n\r\n  public totalLength: number;\r\n\r\n  constructor(options?: Partial<{\r\n    isUpload: ProgressivePreloader['isUpload'],\r\n    cancelable: ProgressivePreloader['cancelable'],\r\n    streamable: ProgressivePreloader['streamable'],\r\n    tryAgainOnFail: ProgressivePreloader['tryAgainOnFail'],\r\n    attachMethod: ProgressivePreloader['attachMethod']\r\n  }>) {\r\n    if(options) {\r\n      safeAssign(this, options);\r\n    }\r\n\r\n    if(this.isUpload) {\r\n      this.tryAgainOnFail = false;\r\n    }\r\n  }\r\n\r\n  public constructContainer(options: Partial<{\r\n    color: 'transparent',\r\n    bold: boolean\r\n  }> = {}) {\r\n    if(!this.preloader) {\r\n      this.preloader = document.createElement('div');\r\n      this.preloader.classList.add('preloader-container');\r\n\r\n      if(options.color) {\r\n        this.preloader.classList.add('preloader-' + options.color);\r\n      }\r\n\r\n      if(options.bold) {\r\n        this.preloader.classList.add('preloader-bold');\r\n      }\r\n\r\n      if(this.streamable) {\r\n        this.preloader.classList.add('preloader-streamable');\r\n      }\r\n    }\r\n  }\r\n\r\n  public constructDownloadIcon() {\r\n    this.constructContainer();\r\n  }\r\n\r\n  public construct() {\r\n    this.construct = null;\r\n\r\n    this.constructContainer();\r\n\r\n    this.preloader.innerHTML = `\r\n    <div class=\"you-spin-me-round\">\r\n    <svg xmlns=\"http://www.w3.org/2000/svg\" class=\"preloader-circular\" viewBox=\"${this.streamable ? '25 25 50 50' : '27 27 54 54'}\">\r\n    <circle class=\"preloader-path-new\" cx=\"${this.streamable ? '50' : '54'}\" cy=\"${this.streamable ? '50' : '54'}\" r=\"${this.streamable ? 19 : 24}\" fill=\"none\" stroke-miterlimit=\"10\"/>\r\n    </svg>\r\n    </div>`;\r\n\r\n    if(this.streamable) {\r\n      this.totalLength = 118.61124420166016;\r\n    } else {\r\n      this.totalLength = 149.82473754882812;\r\n    }\r\n\r\n    if(this.cancelable) {\r\n      this.preloader.innerHTML += `\r\n      <svg xmlns=\"http://www.w3.org/2000/svg\" class=\"preloader-close\" viewBox=\"0 0 24 24\">\r\n        <g fill=\"none\" fill-rule=\"evenodd\">\r\n          <polygon points=\"0 0 24 0 24 24 0 24\"/>\r\n          <path fill=\"#000\" fill-rule=\"nonzero\" d=\"M5.20970461,5.38710056 L5.29289322,5.29289322 C5.65337718,4.93240926 6.22060824,4.90467972 6.61289944,5.20970461 L6.70710678,5.29289322 L12,10.585 L17.2928932,5.29289322 C17.6834175,4.90236893 18.3165825,4.90236893 18.7071068,5.29289322 C19.0976311,5.68341751 19.0976311,6.31658249 18.7071068,6.70710678 L13.415,12 L18.7071068,17.2928932 C19.0675907,17.6533772 19.0953203,18.2206082 18.7902954,18.6128994 L18.7071068,18.7071068 C18.3466228,19.0675907 17.7793918,19.0953203 17.3871006,18.7902954 L17.2928932,18.7071068 L12,13.415 L6.70710678,18.7071068 C6.31658249,19.0976311 5.68341751,19.0976311 5.29289322,18.7071068 C4.90236893,18.3165825 4.90236893,17.6834175 5.29289322,17.2928932 L10.585,12 L5.29289322,6.70710678 C4.93240926,6.34662282 4.90467972,5.77939176 5.20970461,5.38710056 L5.29289322,5.29289322 L5.20970461,5.38710056 Z\"/>\r\n        </g>\r\n      </svg>\r\n      <svg xmlns=\"http://www.w3.org/2000/svg\" class=\"preloader-download\" viewBox=\"0 0 24 24\">\r\n        <g fill=\"none\" fill-rule=\"evenodd\">\r\n          <polygon points=\"0 0 24 0 24 24 0 24\"/>\r\n          <path fill=\"#000\" fill-rule=\"nonzero\" d=\"M5,19 L19,19 C19.5522847,19 20,19.4477153 20,20 C20,20.5128358 19.6139598,20.9355072 19.1166211,20.9932723 L19,21 L5,21 C4.44771525,21 4,20.5522847 4,20 C4,19.4871642 4.38604019,19.0644928 4.88337887,19.0067277 L5,19 L19,19 L5,19 Z M11.8833789,3.00672773 L12,3 C12.5128358,3 12.9355072,3.38604019 12.9932723,3.88337887 L13,4 L13,13.585 L16.2928932,10.2928932 C16.6533772,9.93240926 17.2206082,9.90467972 17.6128994,10.2097046 L17.7071068,10.2928932 C18.0675907,10.6533772 18.0953203,11.2206082 17.7902954,11.6128994 L17.7071068,11.7071068 L12.7071068,16.7071068 C12.3466228,17.0675907 11.7793918,17.0953203 11.3871006,16.7902954 L11.2928932,16.7071068 L6.29289322,11.7071068 C5.90236893,11.3165825 5.90236893,10.6834175 6.29289322,10.2928932 C6.65337718,9.93240926 7.22060824,9.90467972 7.61289944,10.2097046 L7.70710678,10.2928932 L11,13.585 L11,4 C11,3.48716416 11.3860402,3.06449284 11.8833789,3.00672773 L12,3 L11.8833789,3.00672773 Z\"/>\r\n        </g>\r\n      </svg>`;\r\n\r\n      this.downloadSvg = this.preloader.lastElementChild as HTMLElement;\r\n      this.cancelSvg = this.downloadSvg.previousElementSibling as any;\r\n    } else {\r\n      this.preloader.classList.add('preloader-swing');\r\n    }\r\n\r\n    this.circle = this.preloader.firstElementChild.firstElementChild.firstElementChild as SVGCircleElement;\r\n\r\n    if(this.cancelable) {\r\n      attachClickEvent(this.preloader, this.onClick);\r\n    }\r\n  }\r\n\r\n  public onClick = (e?: Event) => {\r\n    if(e) {\r\n      cancelEvent(e);\r\n    }\r\n\r\n    if(this.preloader.classList.contains('manual')) {\r\n      if(this.loadFunc) {\r\n        this.loadFunc(e);\r\n      }\r\n    } else {\r\n      if(this.promise && this.promise.cancel) {\r\n        this.promise.cancel();\r\n      }\r\n    }\r\n  };\r\n\r\n  public setDownloadFunction(func: ProgressivePreloader['loadFunc']) {\r\n    this.loadFunc = func;\r\n  }\r\n\r\n  public setManual() {\r\n    this.preloader.classList.add('manual');\r\n    this.setProgress(0);\r\n  }\r\n\r\n  public attachPromise(promise: CancellablePromise<any>) {\r\n    if(this.isUpload && this.promise) return;\r\n\r\n    this.promise = promise;\r\n\r\n    const tempId = --this.tempId;\r\n    const startTime = Date.now();\r\n\r\n    const onEnd = (err: Error) => {\r\n      promise.notify = promise.notifyAll = null;\r\n\r\n      if(tempId !== this.tempId) {\r\n        return;\r\n      }\r\n\r\n      const elapsedTime = Date.now() - startTime;\r\n\r\n      // console.log('[PP]: end', this.detached, performance.now());\r\n\r\n      if(!err && this.cancelable) {\r\n        this.setProgress(100);\r\n\r\n        const delay = TRANSITION_TIME * 0.75;\r\n\r\n        if(elapsedTime < delay) {\r\n          this.detach();\r\n        } else {\r\n          setTimeout(() => { // * wait for transition complete\r\n            if(tempId === this.tempId) {\r\n              this.detach();\r\n            }\r\n          }, delay);\r\n        }\r\n      } else {\r\n        if(this.tryAgainOnFail) {\r\n          this.attach(this.preloader.parentElement);\r\n          fastRaf(() => {\r\n            this.setManual();\r\n          });\r\n        } else {\r\n          this.detach();\r\n        }\r\n      }\r\n\r\n      this.promise = promise = null;\r\n    };\r\n\r\n    promise\r\n    .then(() => onEnd(null))\r\n    .catch((err) => onEnd(err));\r\n\r\n    if(promise.addNotifyListener) {\r\n      promise.addNotifyListener((details: {done: number, total: number}) => {\r\n        /* if(details.done >= details.total) {\r\n          onEnd();\r\n        } */\r\n\r\n        if(tempId !== this.tempId) return;\r\n\r\n        // console.log('preloader download', promise, details);\r\n        const percents = details.done / details.total * 100;\r\n        this.setProgress(percents);\r\n      });\r\n    }\r\n  }\r\n\r\n  public attach(elem: Element, reset = false, promise?: CancellablePromise<any>) {\r\n    if(this.construct) {\r\n      this.construct();\r\n    }\r\n\r\n    if(this.preloader.parentElement) {\r\n      this.preloader.classList.remove('manual');\r\n    }\r\n\r\n    this.detached = false;\r\n\r\n    if(promise/*  && false */) {\r\n      this.attachPromise(promise);\r\n    }\r\n\r\n    let useRafs = 0;\r\n    if(this.detached || this.preloader.parentElement !== elem) {\r\n      useRafs = isInDOM(this.preloader) ? 1 : 2;\r\n      if(this.preloader.parentElement !== elem) {\r\n        elem[this.attachMethod](this.preloader);\r\n      }\r\n    }\r\n\r\n    SetTransition(this.preloader, 'is-visible', true, TRANSITION_TIME, undefined, useRafs);\r\n\r\n    if(this.cancelable && reset) {\r\n      this.setProgress(0);\r\n    }\r\n  }\r\n\r\n  public detach() {\r\n    if(this.detached) {\r\n      return;\r\n    }\r\n    // return;\r\n\r\n    this.detached = true;\r\n\r\n    // return;\r\n\r\n    if(this.preloader?.parentElement) {\r\n      /* setTimeout(() =>  */// fastRaf(() => {\r\n      /* if(!this.detached) return;\r\n        this.detached = true; */\r\n\r\n      // fastRaf(() => {\r\n      // console.log('[PP]: detach after rAF', this.detached, performance.now());\r\n\r\n      // if(!this.detached || !this.preloader.parentElement) {\r\n      //   return;\r\n      // }\r\n\r\n      SetTransition(this.preloader, 'is-visible', false, TRANSITION_TIME, () => {\r\n        this.preloader.remove();\r\n      }, 1);\r\n      // });\r\n      // })/* , 5e3) */;\r\n    }\r\n  }\r\n\r\n  public setProgress(percents: number) {\r\n    if(!this.totalLength && !isInDOM(this.circle)) {\r\n      return;\r\n    }\r\n\r\n    if(percents === 0) {\r\n      this.circle.style.strokeDasharray = '';\r\n      return;\r\n    }\r\n\r\n    try {\r\n      if(!this.totalLength) {\r\n        this.totalLength = this.circle.getTotalLength();\r\n      }\r\n\r\n      // console.log('setProgress', (percents / 100 * totalLength));\r\n      this.circle.style.strokeDasharray = '' + Math.max(5, percents / 100 * this.totalLength) + ', ' + this.totalLength;\r\n    } catch(err) {}\r\n  }\r\n}\r\n","/*\r\nThis file is part of Telegram Desktop,\r\nthe official desktop application for the Telegram messaging service.\r\nFor license and copyright information please follow this link:\r\nhttps://github.com/telegramdesktop/tdesktop/blob/master/LEGAL\r\n*/\r\n\r\nimport accumulate from '../helpers/array/accumulate';\r\nimport clamp from '../helpers/number/clamp';\r\n\r\ntype Size = {w: number, h: number};\r\nexport type GroupMediaLayout = {\r\n  geometry: {\r\n    x: number,\r\n    y: number,\r\n    width: number,\r\n    height: number\r\n  },\r\n  sides: number\r\n};\r\ntype Attempt = {\r\n  lineCounts: number[],\r\n  heights: number[]\r\n};\r\nexport const RectPart = {\r\n  None: 0,\r\n  Top: 1,\r\n  Right: 2,\r\n  Bottom: 4,\r\n  Left: 8\r\n};\r\n\r\n// https://github.com/telegramdesktop/tdesktop/blob/4669c07dc5335cbf4795bbbe5b0ab7c007b9aee2/Telegram/SourceFiles/ui/grouped_layout.cpp\r\nexport class Layouter {\r\n  private count: number;\r\n  private ratios: number[];\r\n  private proportions: string;\r\n  private averageRatio: number;\r\n  private maxSizeRatio: number;\r\n\r\n  constructor(private sizes: Size[], private maxWidth: number, private minWidth: number, private spacing: number, private maxHeight = maxWidth) {\r\n    this.count = sizes.length;\r\n    this.ratios = Layouter.countRatios(sizes);\r\n    this.proportions = Layouter.countProportions(this.ratios);\r\n    this.averageRatio = accumulate(this.ratios, 1) / this.count; // warn\r\n    this.maxSizeRatio = maxWidth / this.maxHeight;\r\n  }\r\n\r\n  public layout(): GroupMediaLayout[] {\r\n    if(!this.count) return [];\r\n    // else if(this.count === 1) return this.layoutOne();\r\n\r\n    if(this.count >= 5 || this.ratios.find((r) => r > 2)) {\r\n      return new ComplexLayouter(this.ratios, this.averageRatio, this.maxWidth, this.minWidth, this.spacing).layout();\r\n    }\r\n\r\n    if(this.count === 2) return this.layoutTwo();\r\n    else if(this.count === 3) return this.layoutThree();\r\n    return this.layoutFour();\r\n  }\r\n\r\n  private layoutTwo(): ReturnType<Layouter['layout']> {\r\n    if((this.proportions === 'ww') &&\r\n      (this.averageRatio > 1.4 * this.maxSizeRatio) &&\r\n      (this.ratios[1] - this.ratios[0] < 0.2)) {\r\n      return this.layoutTwoTopBottom();\r\n    } else if(this.proportions === 'ww' || this.proportions === 'qq') {\r\n      return this.layoutTwoLeftRightEqual();\r\n    }\r\n    return this.layoutTwoLeftRight();\r\n  }\r\n\r\n  private layoutThree(): ReturnType<Layouter['layout']> {\r\n    // console.log('layoutThree:', this);\r\n    if(this.proportions[0] === 'n') {\r\n      return this.layoutThreeLeftAndOther();\r\n    }\r\n    return this.layoutThreeTopAndOther();\r\n  }\r\n\r\n  private layoutFour(): ReturnType<Layouter['layout']> {\r\n    if(this.proportions[0] === 'w') {\r\n      return this.layoutFourTopAndOther();\r\n    }\r\n    return this.layoutFourLeftAndOther();\r\n  }\r\n\r\n  private layoutTwoTopBottom(): ReturnType<Layouter['layout']> {\r\n    const width = this.maxWidth;\r\n    const height = Math.round(Math.min(\r\n      width / this.ratios[0],\r\n      Math.min(\r\n        width / this.ratios[1],\r\n        (this.maxHeight - this.spacing) / 2)));\r\n\r\n    return [\r\n      {\r\n        geometry: {x: 0, y: 0, width, height},\r\n        sides: RectPart.Left | RectPart.Top | RectPart.Right\r\n      },\r\n      {\r\n        geometry: {x: 0, y: height + this.spacing, width, height},\r\n        sides: RectPart.Left | RectPart.Bottom | RectPart.Right\r\n      }\r\n    ];\r\n  }\r\n\r\n  private layoutTwoLeftRightEqual(): ReturnType<Layouter['layout']> {\r\n    const width = (this.maxWidth - this.spacing) / 2;\r\n    const height = Math.round(Math.min(\r\n      width / this.ratios[0],\r\n      Math.min(width / this.ratios[1], this.maxHeight * 1)));\r\n\r\n    return [\r\n      {\r\n        geometry: {x: 0, y: 0, width, height},\r\n        sides: RectPart.Top | RectPart.Left | RectPart.Bottom\r\n      },\r\n      {\r\n        geometry: {x: width + this.spacing, y: 0, width, height},\r\n        sides: RectPart.Top | RectPart.Right | RectPart.Bottom\r\n      }\r\n    ];\r\n  }\r\n\r\n  private layoutTwoLeftRight(): ReturnType<Layouter['layout']> {\r\n    const minimalWidth = Math.round(this.minWidth * 1.5);\r\n    const secondWidth = Math.min(\r\n      Math.round(Math.max(\r\n        0.4 * (this.maxWidth - this.spacing),\r\n        (this.maxWidth - this.spacing) / this.ratios[0] /\r\n          (1 / this.ratios[0] + 1 / this.ratios[1]))),\r\n      this.maxWidth - this.spacing - minimalWidth);\r\n    const firstWidth = this.maxWidth -\r\n      secondWidth -\r\n      this.spacing;\r\n    const height = Math.min(\r\n      this.maxHeight,\r\n      Math.round(Math.min(\r\n        firstWidth / this.ratios[0],\r\n        secondWidth / this.ratios[1])));\r\n\r\n    return [\r\n      {\r\n        geometry: {x: 0, y: 0, width: firstWidth, height},\r\n        sides: RectPart.Top | RectPart.Left | RectPart.Bottom\r\n      },\r\n      {\r\n        geometry: {x: firstWidth + this.spacing, y: 0, width: secondWidth, height},\r\n        sides: RectPart.Top | RectPart.Right | RectPart.Bottom\r\n      }\r\n    ];\r\n  }\r\n\r\n  private layoutThreeLeftAndOther(): ReturnType<Layouter['layout']> {\r\n    const firstHeight = this.maxHeight;\r\n    const thirdHeight = Math.round(Math.min(\r\n      (this.maxHeight - this.spacing) / 2.,\r\n      (this.ratios[1] * (this.maxWidth - this.spacing) /\r\n        (this.ratios[2] + this.ratios[1]))));\r\n    const secondHeight = firstHeight -\r\n      thirdHeight -\r\n      this.spacing;\r\n    const rightWidth = Math.max(\r\n      this.minWidth,\r\n      Math.round(Math.min(\r\n        (this.maxWidth - this.spacing) / 2.,\r\n        Math.min(\r\n          thirdHeight * this.ratios[2],\r\n          secondHeight * this.ratios[1]))));\r\n    const leftWidth = Math.min(\r\n      Math.round(firstHeight * this.ratios[0]),\r\n      this.maxWidth - this.spacing - rightWidth);\r\n\r\n    return [\r\n      {\r\n        geometry: {x: 0, y: 0, width: leftWidth, height: firstHeight},\r\n        sides: RectPart.Top | RectPart.Left | RectPart.Bottom\r\n      },\r\n      {\r\n        geometry: {x: leftWidth + this.spacing, y: 0, width: rightWidth, height: secondHeight},\r\n        sides: RectPart.Top | RectPart.Right\r\n      },\r\n      {\r\n        geometry: {x: leftWidth + this.spacing, y: secondHeight + this.spacing, width: rightWidth, height: thirdHeight},\r\n        sides: RectPart.Bottom | RectPart.Right\r\n      }\r\n    ];\r\n  }\r\n\r\n  private layoutThreeTopAndOther(): ReturnType<Layouter['layout']> {\r\n    const firstWidth = this.maxWidth;\r\n    const firstHeight = Math.round(Math.min(\r\n      firstWidth / this.ratios[0],\r\n      (this.maxHeight - this.spacing) * 0.66));\r\n    const secondWidth = (this.maxWidth - this.spacing) / 2;\r\n    const secondHeight = Math.min(\r\n      this.maxHeight - firstHeight - this.spacing,\r\n      Math.round(Math.min(\r\n        secondWidth / this.ratios[1],\r\n        secondWidth / this.ratios[2])));\r\n    const thirdWidth = firstWidth - secondWidth - this.spacing;\r\n\r\n    return [\r\n      {\r\n        geometry: {x: 0, y: 0, width: firstWidth, height: firstHeight},\r\n        sides: RectPart.Left | RectPart.Top | RectPart.Right\r\n      },\r\n      {\r\n        geometry: {x: 0, y: firstHeight + this.spacing, width: secondWidth, height: secondHeight},\r\n        sides: RectPart.Bottom | RectPart.Left\r\n      },\r\n      {\r\n        geometry: {x: secondWidth + this.spacing, y: firstHeight + this.spacing, width: thirdWidth, height: secondHeight},\r\n        sides: RectPart.Bottom | RectPart.Right\r\n      }\r\n    ];\r\n  }\r\n\r\n  private layoutFourTopAndOther(): ReturnType<Layouter['layout']> {\r\n    const w = this.maxWidth;\r\n    const h0 = Math.round(Math.min(\r\n      w / this.ratios[0],\r\n      (this.maxHeight - this.spacing) * 0.66));\r\n    const h = Math.round(\r\n      (this.maxWidth - 2 * this.spacing) /\r\n        (this.ratios[1] + this.ratios[2] + this.ratios[3]));\r\n    const w0 = Math.max(\r\n      this.minWidth,\r\n      Math.round(Math.min(\r\n        (this.maxWidth - 2 * this.spacing) * 0.4,\r\n        h * this.ratios[1])));\r\n    const w2 = Math.round(Math.max(\r\n      Math.max(\r\n        this.minWidth * 1.,\r\n        (this.maxWidth - 2 * this.spacing) * 0.33),\r\n      h * this.ratios[3]));\r\n    const w1 = w - w0 - w2 - 2 * this.spacing;\r\n    const h1 = Math.min(\r\n      this.maxHeight - h0 - this.spacing,\r\n      h);\r\n\r\n    return [\r\n      {\r\n        geometry: {x: 0, y: 0, width: w, height: h0},\r\n        sides: RectPart.Left | RectPart.Top | RectPart.Right\r\n      },\r\n      {\r\n        geometry: {x: 0, y: h0 + this.spacing, width: w0, height: h1},\r\n        sides: RectPart.Bottom | RectPart.Left\r\n      },\r\n      {\r\n        geometry: {x: w0 + this.spacing, y: h0 + this.spacing, width: w1, height: h1},\r\n        sides: RectPart.Bottom\r\n      },\r\n      {\r\n        geometry: {x: w0 + this.spacing + w1 + this.spacing, y: h0 + this.spacing, width: w2, height: h1},\r\n        sides: RectPart.Right | RectPart.Bottom\r\n      }\r\n    ];\r\n  }\r\n\r\n  private layoutFourLeftAndOther(): ReturnType<Layouter['layout']> {\r\n    const h = this.maxHeight;\r\n    const w0 = Math.round(Math.min(\r\n      h * this.ratios[0],\r\n      (this.maxWidth - this.spacing) * 0.6));\r\n\r\n    const w = Math.round(\r\n      (this.maxHeight - 2 * this.spacing) /\r\n        (1. / this.ratios[1] + 1. / this.ratios[2] + 1. / this.ratios[3])\r\n    );\r\n    const h0 = Math.round(w / this.ratios[1]);\r\n    const h1 = Math.round(w / this.ratios[2]);\r\n    const h2 = h - h0 - h1 - 2 * this.spacing;\r\n    const w1 = Math.max(\r\n      this.minWidth,\r\n      Math.min(this.maxWidth - w0 - this.spacing, w));\r\n\r\n    return [\r\n      {\r\n        geometry: {x: 0, y: 0, width: w0, height: h},\r\n        sides: RectPart.Top | RectPart.Left | RectPart.Bottom\r\n      },\r\n      {\r\n        geometry: {x: w0 + this.spacing, y: 0, width: w1, height: h0},\r\n        sides: RectPart.Top | RectPart.Right\r\n      },\r\n      {\r\n        geometry: {x: w0 + this.spacing, y: h0 + this.spacing, width: w1, height: h1},\r\n        sides: RectPart.Right\r\n      },\r\n      {\r\n        geometry: {x: w0 + this.spacing, y: h0 + h1 + 2 * this.spacing, width: w1, height: h2},\r\n        sides: RectPart.Bottom | RectPart.Right\r\n      }\r\n    ];\r\n  }\r\n\r\n  private static countRatios(sizes: Size[]) {\r\n    return sizes.map((size) => size.w / size.h);\r\n  }\r\n\r\n  private static countProportions(ratios: number[]) {\r\n    return ratios.map((ratio) => (ratio > 1.2) ? 'w' : (ratio < 0.8) ? 'n' : 'q').join('');\r\n  }\r\n}\r\n\r\nclass ComplexLayouter {\r\n  private ratios: number[];\r\n  private count: number;\r\n\r\n  constructor(ratios: number[], private averageRatio: number, private maxWidth: number, private minWidth: number, private spacing: number, private maxHeight = maxWidth * 4 / 3) {\r\n    this.ratios = ComplexLayouter.cropRatios(ratios, averageRatio);\r\n    this.count = ratios.length;\r\n  }\r\n\r\n  private static cropRatios(ratios: number[], averageRatio: number) {\r\n    const kMaxRatio = 2.75;\r\n    const kMinRatio = 0.6667;\r\n    return ratios.map((ratio) => {\r\n      return averageRatio > 1.1 ?\r\n        clamp(ratio, 1., kMaxRatio) :\r\n        clamp(ratio, kMinRatio, 1.);\r\n    });\r\n  }\r\n\r\n  public layout(): GroupMediaLayout[] {\r\n    const result = new Array<GroupMediaLayout>(this.count);\r\n\r\n    const attempts: Attempt[] = [];\r\n    const multiHeight = (offset: number, count: number) => {\r\n      const ratios = this.ratios.slice(offset, offset + count); // warn\r\n      const sum = accumulate(ratios, 0);\r\n      return (this.maxWidth - (count - 1) * this.spacing) / sum;\r\n    };\r\n    const pushAttempt = (lineCounts: number[]) => {\r\n      const heights: number[] = [];\r\n      let offset = 0;\r\n      for(const count of lineCounts) {\r\n        heights.push(multiHeight(offset, count));\r\n        offset += count;\r\n      }\r\n      attempts.push({lineCounts, heights}); // warn\r\n    };\r\n\r\n    for(let first = 1; first !== this.count; ++first) {\r\n      const second = this.count - first;\r\n      if(first > 3 || second > 3) {\r\n        continue;\r\n      }\r\n      pushAttempt([first, second]);\r\n    }\r\n    for(let first = 1; first !== this.count - 1; ++first) {\r\n      for(let second = 1; second !== this.count - first; ++second) {\r\n        const third = this.count - first - second;\r\n        if((first > 3) ||\r\n          (second > ((this.averageRatio < 0.85) ? 4 : 3)) ||\r\n          (third > 3)) {\r\n          continue;\r\n        }\r\n        pushAttempt([first, second, third]);\r\n      }\r\n    }\r\n    for(let first = 1; first !== this.count - 1; ++first) {\r\n      for(let second = 1; second !== this.count - first; ++second) {\r\n        for(let third = 1; third !== this.count - first - second; ++third) {\r\n          const fourth = this.count - first - second - third;\r\n          if(first > 3 || second > 3 || third > 3 || fourth > 3) {\r\n            continue;\r\n          }\r\n          pushAttempt([first, second, third, fourth]);\r\n        }\r\n      }\r\n    }\r\n\r\n    let optimalAttempt: Attempt = null;\r\n    let optimalDiff = 0;\r\n    for(const attempt of attempts) {\r\n      const {heights, lineCounts: counts} = attempt;\r\n      const lineCount = counts.length;\r\n      const totalHeight = accumulate(heights, 0) +\r\n        this.spacing * (lineCount - 1);\r\n      const minLineHeight = Math.min(...heights);\r\n      const maxLineHeight = Math.max(...heights);\r\n      const bad1 = (minLineHeight < this.minWidth) ? 1.5 : 1;\r\n      const bad2 = (() => {\r\n        for(let line = 1; line !== lineCount; ++line) {\r\n          if(counts[line - 1] > counts[line]) {\r\n            return 1.5;\r\n          }\r\n        }\r\n        return 1.;\r\n      })();\r\n      const diff = Math.abs(totalHeight - this.maxHeight) * bad1 * bad2;\r\n      if(!optimalAttempt || diff < optimalDiff) {\r\n        optimalAttempt = attempt;\r\n        optimalDiff = diff;\r\n      }\r\n    }\r\n\r\n    const optimalCounts = optimalAttempt.lineCounts;\r\n    const optimalHeights = optimalAttempt.heights;\r\n    const rowCount = optimalCounts.length;\r\n\r\n    let index = 0;\r\n    let y = 0;\r\n    for(let row = 0; row !== rowCount; ++row) {\r\n      const colCount = optimalCounts[row];\r\n      const lineHeight = optimalHeights[row];\r\n      const height = Math.round(lineHeight);\r\n\r\n      let x = 0;\r\n      for(let col = 0; col !== colCount; ++col) {\r\n        const sides = RectPart.None |\r\n          (row === 0 ? RectPart.Top : RectPart.None) |\r\n          (row === rowCount - 1 ? RectPart.Bottom : RectPart.None) |\r\n          (col === 0 ? RectPart.Left : RectPart.None) |\r\n          (col === colCount - 1 ? RectPart.Right : RectPart.None);\r\n\r\n        const ratio = this.ratios[index];\r\n        const width = (col === colCount - 1) ?\r\n          (this.maxWidth - x) :\r\n          Math.round(ratio * lineHeight);\r\n        result[index] = {\r\n          geometry: {x, y, width, height},\r\n          sides\r\n        };\r\n\r\n        x += width + this.spacing;\r\n        ++index;\r\n      }\r\n      y += height + this.spacing;\r\n    }\r\n\r\n    return result;\r\n  }\r\n}\r\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport {Layouter, RectPart} from './groupedLayout';\n\nexport default function prepareAlbum(options: {\n  container: HTMLElement,\n  items: {w: number, h: number}[],\n  maxWidth: number,\n  minWidth: number,\n  spacing: number,\n  maxHeight?: number,\n  forMedia?: true\n}) {\n  const layouter = new Layouter(options.items, options.maxWidth, options.minWidth, options.spacing, options.maxHeight);\n  const layout = layouter.layout();\n\n  const widthItem = layout.find((item) => item.sides & RectPart.Right);\n  const width = widthItem.geometry.width + widthItem.geometry.x;\n\n  const heightItem = layout.find((item) => item.sides & RectPart.Bottom);\n  const height = heightItem.geometry.height + heightItem.geometry.y;\n\n  const container = options.container;\n  container.style.width = width + 'px';\n  container.style.height = height + 'px';\n  const children = container.children;\n\n  layout.forEach(({geometry, sides}, idx) => {\n    let div: HTMLElement;\n    div = children[idx] as HTMLElement;\n    if(!div) {\n      div = document.createElement('div');\n      container.append(div);\n    }\n\n    div.classList.add('album-item', 'grouped-item');\n\n    div.style.width = (geometry.width / width * 100) + '%';\n    div.style.height = (geometry.height / height * 100) + '%';\n    div.style.top = (geometry.y / height * 100) + '%';\n    div.style.left = (geometry.x / width * 100) + '%';\n\n    if(sides & RectPart.Left && sides & RectPart.Top) {\n      div.style.borderTopLeftRadius = 'inherit';\n    }\n\n    if(sides & RectPart.Left && sides & RectPart.Bottom) {\n      div.style.borderBottomLeftRadius = 'inherit';\n    }\n\n    if(sides & RectPart.Right && sides & RectPart.Top) {\n      div.style.borderTopRightRadius = 'inherit';\n    }\n\n    if(sides & RectPart.Right && sides & RectPart.Bottom) {\n      div.style.borderBottomRightRadius = 'inherit';\n    }\n\n    if(options.forMedia) {\n      const mediaDiv = document.createElement('div');\n      mediaDiv.classList.add('album-item-media');\n\n      div.append(mediaDiv);\n    }\n\n    // @ts-ignore\n    // div.style.backgroundColor = '#' + Math.floor(Math.random() * (2 ** 24 - 1)).toString(16).padStart(6, '0');\n  });\n\n  /* if(options.forMedia) {\n    layout.forEach((_, i) => {\n      const mediaDiv = document.createElement('div');\n      mediaDiv.classList.add('album-item-media');\n\n      options.container.children[i].append(mediaDiv);\n    });\n  } */\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport getPreviewURLFromBytes from '../helpers/bytes/getPreviewURLFromBytes';\nimport {renderImageFromUrlPromise} from '../helpers/dom/renderImageFromUrl';\nimport replaceContent from '../helpers/dom/replaceContent';\nimport setInnerHTML from '../helpers/dom/setInnerHTML';\nimport {recordPromise} from '../helpers/recordPromise';\nimport sequentialDom from '../helpers/sequentialDom';\nimport {UserProfilePhoto, ChatPhoto} from '../layer';\nimport type {PeerPhotoSize} from '../lib/appManagers/appAvatarsManager';\nimport getPeerColorById from '../lib/appManagers/utils/peers/getPeerColorById';\nimport {NULL_PEER_ID, REPLIES_PEER_ID} from '../lib/mtproto/mtproto_config';\nimport getAbbreviation from '../lib/richTextProcessor/getAbbreviation';\nimport rootScope from '../lib/rootScope';\nimport getPeerInitials from './wrappers/getPeerInitials';\n\nexport async function putAvatar(\n  div: HTMLElement,\n  peerId: PeerId,\n  photo: UserProfilePhoto.userProfilePhoto | ChatPhoto.chatPhoto,\n  size: PeerPhotoSize,\n  img = new Image(),\n  onlyThumb = false\n) {\n  const r = await rootScope.managers.acknowledged.appAvatarsManager.loadAvatar(peerId, photo, size);\n  const loadPromise = r.result;\n  const cached = r.cached;\n\n  img.classList.add('avatar-photo');\n\n  let renderThumbPromise: Promise<void>;\n  let callback: () => void;\n  let thumbImage: HTMLImageElement;\n  if(cached) {\n    //   misc.ts: renderImageFromUrl\n    callback = () => {\n      replaceContent(div, img);\n      div.dataset.color = '';\n    };\n  } else {\n    const animate = rootScope.settings.animationsEnabled;\n    if(animate) {\n      img.classList.add('fade-in');\n    }\n\n    let isFullLoaded = false;\n    if(size === 'photo_big') { // let's load small photo first\n      const res = await putAvatar(div, peerId, photo, 'photo_small');\n      renderThumbPromise = res.loadPromise;\n      thumbImage = res.thumbImage;\n    } else if(photo.stripped_thumb) {\n      thumbImage = new Image();\n      div.classList.add('avatar-relative');\n      thumbImage.classList.add('avatar-photo', 'avatar-photo-thumbnail');\n      const url = getPreviewURLFromBytes(photo.stripped_thumb);\n      renderThumbPromise = renderImageFromUrlPromise(thumbImage, url).then(() => {\n        if(isFullLoaded) {\n          return;\n        }\n\n        replaceContent(div, thumbImage);\n      });\n    }\n\n    callback = () => {\n      isFullLoaded = true;\n\n      if(thumbImage) {\n        div.append(img);\n      } else {\n        replaceContent(div, img);\n      }\n\n      setTimeout(() => {\n        if(div.childElementCount) {\n          sequentialDom.mutateElement(img, () => {\n            div.dataset.color = '';\n\n            if(animate) {\n              img.classList.remove('fade-in');\n            }\n\n            if(thumbImage) {\n              thumbImage.remove();\n            }\n          });\n        }\n      }, animate ? 200 : 0);\n    };\n  }\n\n  const renderPromise = loadPromise\n  .then((url) => renderImageFromUrlPromise(img, url/* , !cached */))\n  .then(callback);\n\n  await (renderThumbPromise || renderPromise);\n\n  return {\n    cached,\n    loadPromise: renderThumbPromise || renderPromise,\n    thumbImage\n  };\n}\n\nfunction set(\n  div: HTMLElement,\n  innerHTML: Parameters<typeof setInnerHTML>[1],\n  color: string,\n  icon: string\n) {\n  setInnerHTML(div, innerHTML);\n  div.dataset.color = color;\n  div.classList.remove('tgico-saved', 'tgico-deletedaccount', 'tgico-reply_filled');\n  icon && div.classList.add(icon);\n}\n\n// peerId === peerId || title\nexport default async function putPhoto(\n  div: HTMLElement,\n  peerId: PeerId,\n  isDialog = false,\n  title = '',\n  onlyThumb = false,\n  isBig?: boolean\n) {\n  const myId = rootScope.myId;\n\n  if(peerId === myId && isDialog) {\n    set(div, '', '', 'tgico-saved');\n    return;\n  }\n\n  const managers = rootScope.managers;\n\n  if(peerId !== NULL_PEER_ID && peerId.isUser()) {\n    const user = await managers.appUsersManager.getUser(peerId);\n    if(user && user.pFlags && user.pFlags.deleted) {\n      set(div, '', getPeerColorById(peerId), 'tgico-deletedaccount');\n      return;\n    }\n  }\n\n  const size: PeerPhotoSize = isBig ? 'photo_big' : 'photo_small';\n  const photo = await managers.appPeersManager.getPeerPhoto(peerId);\n  const avatarAvailable = !!photo;\n  const avatarRendered = !!div.firstElementChild && !(div.firstElementChild as HTMLElement).classList.contains('emoji');\n  if(!avatarAvailable || !avatarRendered || !(await managers.appAvatarsManager.isAvatarCached(peerId, size))) {\n    let color = '';\n    if(peerId && (peerId !== myId || !isDialog)) {\n      color = getPeerColorById(peerId);\n    }\n\n    if(peerId === REPLIES_PEER_ID) {\n      set(div, '', color, 'tgico-reply_filled');\n      return;\n    }\n\n    const abbr = await (title ? getAbbreviation(title) : getPeerInitials(peerId, managers));\n    set(div, abbr, color, '');\n    // return Promise.resolve(true);\n  }\n\n  if(avatarAvailable/*  && false */) {\n    const promise = putAvatar(div, peerId, photo, size, undefined, onlyThumb);\n    // recordPromise(promise, 'putAvatar-' + peerId);\n    return promise;\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport {Chat, User} from '../../layer';\nimport getAbbreviation from '../../lib/richTextProcessor/getAbbreviation';\nimport rootScope from '../../lib/rootScope';\n\nexport default async function getPeerInitials(peerId: PeerId, managers = rootScope.managers) {\n  const peer: Chat | User = await managers.appPeersManager.getPeer(peerId);\n  return getAbbreviation(\n    (peer as Chat.chat).title ?? [(peer as User.user).first_name, (peer as User.user).last_name].filter(Boolean).join(' ')\n  );\n}\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport {MOUNT_CLASS_TO} from '../config/debug';\r\n\r\nexport function putPreloader(elem: Element, returnDiv = false): HTMLElement {\r\n  const html = `\r\n  <svg xmlns=\"http://www.w3.org/2000/svg\" class=\"preloader-circular\" viewBox=\"25 25 50 50\">\r\n  <circle class=\"preloader-path\" cx=\"50\" cy=\"50\" r=\"20\" fill=\"none\" stroke-miterlimit=\"10\"/>\r\n  </svg>`;\r\n\r\n  if(returnDiv) {\r\n    const div = document.createElement('div');\r\n    div.classList.add('preloader');\r\n    div.innerHTML = html;\r\n\r\n    if(elem) {\r\n      elem.appendChild(div);\r\n    }\r\n\r\n    return div;\r\n  }\r\n\r\n  elem.insertAdjacentHTML('beforeend', html);\r\n  return elem.lastElementChild as HTMLElement;\r\n}\r\n\r\nMOUNT_CLASS_TO.putPreloader = putPreloader;\r\n\r\nexport function setButtonLoader(elem: HTMLButtonElement, icon = 'check') {\r\n  elem.classList.remove('tgico-' + icon);\r\n  elem.disabled = true;\r\n  putPreloader(elem);\r\n\r\n  return () => {\r\n    elem.innerHTML = '';\r\n    elem.classList.add('tgico-' + icon);\r\n    elem.removeAttribute('disabled');\r\n  };\r\n}\r\n\r\n/* export function parseMenuButtonsTo(to: {[name: string]: HTMLElement}, elements: HTMLCollection | NodeListOf<HTMLElement>) {\r\n  Array.from(elements).forEach((el) => {\r\n    const match = el.className.match(/(?:^|\\s)menu-(.+?)(?:$|\\s)/);\r\n    if(!match) return;\r\n    to[match[1]] = el as HTMLElement;\r\n  });\r\n} */\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport getDeepProperty from '../helpers/object/getDeepProperty';\r\nimport {LangPackKey, _i18n} from '../lib/langPack';\r\nimport apiManagerProxy from '../lib/mtproto/mtprotoworker';\r\nimport rootScope from '../lib/rootScope';\r\n\r\nexport default class RadioField {\r\n  public input: HTMLInputElement;\r\n  public label: HTMLLabelElement;\r\n  public main: HTMLElement;\r\n\r\n  constructor(options: {\r\n    text?: string,\r\n    langKey?: LangPackKey,\r\n    name: string,\r\n    value?: string,\r\n    stateKey?: string,\r\n    alignRight?: boolean\r\n  }) {\r\n    const label = this.label = document.createElement('label');\r\n    label.classList.add('radio-field');\r\n\r\n    if(options.alignRight) {\r\n      label.classList.add('radio-field-right');\r\n    }\r\n\r\n    const input = this.input = document.createElement('input');\r\n    input.type = 'radio';\r\n    /* input.id =  */input.name = 'input-radio-' + options.name;\r\n\r\n    if(options.value) {\r\n      input.value = options.value;\r\n\r\n      if(options.stateKey) {\r\n        apiManagerProxy.getState().then((state) => {\r\n          input.checked = getDeepProperty(state, options.stateKey) === options.value;\r\n        });\r\n\r\n        input.addEventListener('change', () => {\r\n          rootScope.managers.appStateManager.setByKey(options.stateKey, options.value);\r\n        });\r\n      }\r\n    }\r\n\r\n    const main = this.main = document.createElement('div');\r\n    main.classList.add('radio-field-main');\r\n\r\n    if(options.text) {\r\n      main.innerHTML = options.text;\r\n      /* const caption = document.createElement('div');\r\n      caption.classList.add('radio-field-main-caption');\r\n      caption.innerHTML = text;\r\n\r\n      if(subtitle) {\r\n        label.classList.add('radio-field-with-subtitle');\r\n        caption.insertAdjacentHTML('beforeend', `<div class=\"radio-field-main-subtitle\">${subtitle}</div>`);\r\n      }\r\n\r\n      main.append(caption); */\r\n    } else if(options.langKey) {\r\n      _i18n(main, options.langKey);\r\n    }\r\n\r\n    label.append(input, main);\r\n  }\r\n\r\n  get checked() {\r\n    return this.input.checked;\r\n  }\r\n\r\n  set checked(checked: boolean) {\r\n    this.setValueSilently(checked);\r\n\r\n    const event = new Event('change', {bubbles: true, cancelable: true});\r\n    this.input.dispatchEvent(event);\r\n  }\r\n\r\n  public setValueSilently(checked: boolean) {\r\n    this.input.checked = checked;\r\n  }\r\n};\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nexport default function RadioForm(radios: {container: HTMLElement, input: HTMLInputElement}[], onChange: (value: string, event: Event) => void) {\r\n  const form = document.createElement('form');\r\n\r\n  radios.forEach((r) => {\r\n    const {container, input} = r;\r\n    form.append(container);\r\n    input.addEventListener('change', (e) => {\r\n      if(input.checked) {\r\n        onChange(input.value, e);\r\n      }\r\n    });\r\n  });\r\n\r\n  return form;\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport attachGrabListeners, {GrabEvent} from '../helpers/dom/attachGrabListeners';\r\nimport clamp from '../helpers/number/clamp';\r\nimport safeAssign from '../helpers/object/safeAssign';\r\n\r\nexport default class RangeSelector {\r\n  public container: HTMLDivElement;\r\n  protected filled: HTMLDivElement;\r\n  protected seek: HTMLInputElement;\r\n\r\n  public mousedown = false;\r\n  protected rect: DOMRect;\r\n  protected _removeListeners: () => void;\r\n\r\n  private events: Partial<{\r\n    // onMouseMove: ProgressLine['onMouseMove'],\r\n    onMouseDown: RangeSelector['onMouseDown'],\r\n    onMouseUp: RangeSelector['onMouseUp'],\r\n    onScrub: (value: number) => void\r\n  }> = {};\r\n\r\n  protected decimals: number;\r\n\r\n  protected step: number;\r\n  protected min: number;\r\n  protected max: number;\r\n  protected withTransition = false;\r\n  protected useTransform = false;\r\n  protected vertical = false;\r\n\r\n  constructor(\r\n    options: {\r\n      step: RangeSelector['step'],\r\n      min: RangeSelector['min'],\r\n      max: RangeSelector['max'],\r\n      withTransition?: RangeSelector['withTransition'],\r\n      useTransform?: RangeSelector['useTransform'],\r\n      vertical?: RangeSelector['vertical']\r\n    },\r\n    value = 0\r\n  ) {\r\n    safeAssign(this, options);\r\n\r\n    this.container = document.createElement('div');\r\n    this.container.classList.add('progress-line');\r\n\r\n    // there is no sense in using transition with transform, because it is updating every frame\r\n    if(this.useTransform) {\r\n      this.container.classList.add('use-transform');\r\n    } else if(this.withTransition) {\r\n      this.container.classList.add('with-transition');\r\n    }\r\n\r\n    this.filled = document.createElement('div');\r\n    this.filled.classList.add('progress-line__filled');\r\n\r\n    const seek = this.seek = document.createElement('input');\r\n    seek.classList.add('progress-line__seek');\r\n    // seek.setAttribute('max', '0');\r\n    seek.type = 'range';\r\n    seek.step = '' + this.step;\r\n    seek.min = '' + this.min;\r\n    seek.max = '' + this.max;\r\n    seek.value = '' + value;\r\n\r\n    if(value) {\r\n      this.setProgress(value);\r\n    }\r\n\r\n    const stepStr = '' + this.step;\r\n    const index = stepStr.indexOf('.');\r\n    this.decimals = index === -1 ? 0 : stepStr.length - index - 1;\r\n\r\n    // this.setListeners();\r\n\r\n    this.container.append(this.filled, seek);\r\n  }\r\n\r\n  get value() {\r\n    return +this.seek.value;\r\n  }\r\n\r\n  public setHandlers(events: RangeSelector['events']) {\r\n    this.events = events;\r\n  }\r\n\r\n  protected onMouseMove = (event: GrabEvent) => {\r\n    this.scrub(event);\r\n  };\r\n\r\n  protected onMouseDown = (event: GrabEvent) => {\r\n    this.rect = this.container.getBoundingClientRect();\r\n    this.mousedown = true;\r\n    this.scrub(event);\r\n    this.container.classList.add('is-focused');\r\n    this.events?.onMouseDown && this.events.onMouseDown(event);\r\n  };\r\n\r\n  protected onMouseUp = (event: GrabEvent) => {\r\n    this.mousedown = false;\r\n    this.container.classList.remove('is-focused');\r\n    this.events?.onMouseUp && this.events.onMouseUp(event);\r\n  };\r\n\r\n  public setListeners() {\r\n    this.seek.addEventListener('input', this.onInput);\r\n    this._removeListeners = attachGrabListeners(this.container, this.onMouseDown, this.onMouseMove, this.onMouseUp);\r\n  }\r\n\r\n  public onInput = () => {\r\n    const value = +this.seek.value;\r\n    this.setFilled(value);\r\n    this.events?.onScrub && this.events.onScrub(value);\r\n  };\r\n\r\n  public setProgress(value: number) {\r\n    this.seek.value = '' + value;\r\n    this.setFilled(+this.seek.value); // clamp\r\n  }\r\n\r\n  public addProgress(value: number) {\r\n    this.seek.value = '' + (+this.seek.value + value);\r\n    this.setFilled(+this.seek.value); // clamp\r\n  }\r\n\r\n  public setFilled(value: number) {\r\n    let percents = (value - this.min) / (this.max - this.min);\r\n    percents = clamp(percents, 0, 1);\r\n\r\n    // using scaleX and width even with vertical because it will be rotated\r\n    if(this.useTransform) {\r\n      this.filled.style.transform = `scaleX(${percents})`;\r\n    } else {\r\n      this.filled.style.width = (percents * 100) + '%';\r\n    }\r\n  }\r\n\r\n  protected scrub(event: GrabEvent) {\r\n    const rectMax = this.vertical ? this.rect.height : this.rect.width;\r\n    const offsetAxisValue = clamp(this.vertical ? -(event.y - this.rect.bottom) : event.x - this.rect.left, 0, rectMax);\r\n\r\n    let value = this.min + (offsetAxisValue / rectMax * (this.max - this.min));\r\n\r\n    if((value - this.min) < ((this.max - this.min) / 2)) {\r\n      value -= this.step / 10;\r\n    }\r\n\r\n    value = +value.toFixed(this.decimals);\r\n    value = clamp(value, this.min, this.max);\r\n\r\n    // this.seek.value = '' + value;\r\n    // this.onInput();\r\n\r\n    this.setProgress(value);\r\n    this.events?.onScrub && this.events.onScrub(value);\r\n\r\n    return value;\r\n  }\r\n\r\n  public removeListeners() {\r\n    if(this._removeListeners) {\r\n      this._removeListeners();\r\n      this._removeListeners = null;\r\n    }\r\n\r\n    this.seek.removeEventListener('input', this.onInput);\r\n\r\n    this.events = {};\r\n  }\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport findUpClassName from '../helpers/dom/findUpClassName';\r\nimport sequentialDom from '../helpers/sequentialDom';\r\nimport IS_TOUCH_SUPPORTED from '../environment/touchSupport';\r\nimport rootScope from '../lib/rootScope';\r\nimport findUpAsChild from '../helpers/dom/findUpAsChild';\r\n\r\nlet rippleClickId = 0;\r\nexport default function ripple(\r\n  elem: HTMLElement,\r\n  callback: (id: number) => Promise<boolean | void> = () => Promise.resolve(),\r\n  onEnd: (id: number) => void = null,\r\n  prepend = false,\r\n  attachListenerTo = elem\r\n) {\r\n  // return;\r\n  if(elem.querySelector('.c-ripple')) return;\r\n  elem.classList.add('rp');\r\n\r\n  const r = document.createElement('div');\r\n  r.classList.add('c-ripple');\r\n\r\n  const isSquare = elem.classList.contains('rp-square');\r\n  if(isSquare) {\r\n    r.classList.add('is-square');\r\n  }\r\n\r\n  elem[prepend ? 'prepend' : 'append'](r);\r\n\r\n  let handler: () => void;\r\n  // let animationEndPromise: Promise<number>;\r\n  const drawRipple = (clientX: number, clientY: number) => {\r\n    const startTime = Date.now();\r\n    const elem = document.createElement('div');\r\n\r\n    const clickId = rippleClickId++;\r\n\r\n    // console.log('ripple drawRipple');\r\n\r\n    const duration = +window.getComputedStyle(r).getPropertyValue('--ripple-duration').replace('s', '') * 1000;\r\n    // console.log('ripple duration', duration);\r\n\r\n    handler = () => {\r\n    // handler = () => animationEndPromise.then((duration) => {\r\n      // console.log('ripple animation was:', duration);\r\n\r\n      // const duration = isSquare || mediaSizes.isMobile ? 200 : 700;\r\n      // return;\r\n      const elapsedTime = Date.now() - startTime;\r\n      const cb = () => {\r\n        // console.log('ripple elapsedTime total pre-remove:', Date.now() - startTime);\r\n        sequentialDom.mutate(() => {\r\n          elem.remove();\r\n        });\r\n\r\n        if(onEnd) onEnd(clickId);\r\n      };\r\n      if(elapsedTime < duration) {\r\n        const delay = Math.max(duration - elapsedTime, duration / 2);\r\n        setTimeout(() => elem.classList.add('hiding'), Math.max(delay - duration / 2, 0));\r\n\r\n        setTimeout(cb, delay);\r\n      } else {\r\n        elem.classList.add('hiding');\r\n        setTimeout(cb, duration / 2);\r\n      }\r\n\r\n      if(!IS_TOUCH_SUPPORTED) {\r\n        window.removeEventListener('contextmenu', handler);\r\n      }\r\n\r\n      handler = null;\r\n      touchStartFired = false;\r\n    };\r\n    // });\r\n\r\n    callback && callback(clickId);\r\n\r\n    /* callback().then((bad) => {\r\n      if(bad) {\r\n        span.remove();\r\n        return;\r\n      } */\r\n\r\n    // console.log('ripple after promise', Date.now() - startTime);\r\n    // console.log('ripple tooSlow:', tooSlow);\r\n    /* if(tooSlow) {\r\n        span.remove();\r\n        return;\r\n      } */\r\n\r\n    window.requestAnimationFrame(() => {\r\n      const rect = r.getBoundingClientRect();\r\n      elem.classList.add('c-ripple__circle');\r\n\r\n      const clickX = clientX - rect.left;\r\n      const clickY = clientY - rect.top;\r\n\r\n      const radius = Math.sqrt((Math.abs(clickY - rect.height / 2) + rect.height / 2) ** 2 + (Math.abs(clickX - rect.width / 2) + rect.width / 2) ** 2);\r\n      const size = radius;\r\n\r\n      // center of circle\r\n      const x = clickX - size / 2;\r\n      const y = clickY - size / 2;\r\n\r\n      // console.log('ripple click', offsetFromCenter, size, clickX, clickY);\r\n\r\n      elem.style.width = elem.style.height = size + 'px';\r\n      elem.style.left = x + 'px';\r\n      elem.style.top = y + 'px';\r\n\r\n      //     \r\n      /* animationEndPromise = new Promise((resolve) => {\r\n          span.addEventListener('animationend', () => {\r\n            // 713 -> 700\r\n            resolve(((Date.now() - startTime) / 100 | 0) * 100);\r\n          }, {once: true});\r\n        }); */\r\n\r\n      //             \r\n      /* span.style.display = 'none';\r\n        r.append(span);\r\n        duration = +window.getComputedStyle(span).getPropertyValue('animation-duration').replace('s', '') * 1000;\r\n        span.style.display = ''; */\r\n\r\n      r.append(elem);\r\n\r\n      // r.classList.add('active');\r\n      // handler();\r\n    });\r\n    // });\r\n  };\r\n\r\n  const isRippleUnneeded = (e: Event) => e.target !== elem && (\r\n    ['BUTTON', 'A'].includes((e.target as HTMLElement).tagName) ||\r\n      findUpClassName(e.target as HTMLElement, 'c-ripple') !== r\r\n  ) && (\r\n    attachListenerTo === elem ||\r\n      !findUpAsChild(e.target as HTMLElement, attachListenerTo)\r\n  );\r\n\r\n  // TODO: rename this variable\r\n  let touchStartFired = false;\r\n  if(IS_TOUCH_SUPPORTED) {\r\n    const touchEnd = () => {\r\n      handler && handler();\r\n    };\r\n\r\n    attachListenerTo.addEventListener('touchstart', (e) => {\r\n      if(!rootScope.settings.animationsEnabled) {\r\n        return;\r\n      }\r\n\r\n      // console.log('ripple touchstart', e);\r\n      if(e.touches.length > 1 || touchStartFired || isRippleUnneeded(e)) {\r\n        return;\r\n      }\r\n\r\n      // console.log('touchstart', e);\r\n      touchStartFired = true;\r\n\r\n      const {clientX, clientY} = e.touches[0];\r\n      drawRipple(clientX, clientY);\r\n      attachListenerTo.addEventListener('touchend', touchEnd, {once: true});\r\n\r\n      window.addEventListener('touchmove', (e) => {\r\n        e.cancelBubble = true;\r\n        e.stopPropagation();\r\n        touchEnd();\r\n        attachListenerTo.removeEventListener('touchend', touchEnd);\r\n      }, {once: true});\r\n    }, {passive: true});\r\n  } else {\r\n    attachListenerTo.addEventListener('mousedown', (e) => {\r\n      if(![0, 2].includes(e.button)) { // only left and right buttons\r\n        return;\r\n      }\r\n\r\n      if(!rootScope.settings.animationsEnabled) {\r\n        return;\r\n      }\r\n      // console.log('ripple mousedown', e, e.target, findUpClassName(e.target as HTMLElement, 'c-ripple') === r);\r\n\r\n      if(attachListenerTo.dataset.ripple === '0' || isRippleUnneeded(e)) {\r\n        return;\r\n      } else if(touchStartFired) {\r\n        touchStartFired = false;\r\n        return;\r\n      }\r\n\r\n      const {clientX, clientY} = e;\r\n      drawRipple(clientX, clientY);\r\n      window.addEventListener('mouseup', handler, {once: true, passive: true});\r\n      window.addEventListener('contextmenu', handler, {once: true, passive: true});\r\n    }, {passive: true});\r\n  }\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport CheckboxField from './checkboxField';\r\nimport RadioField from './radioField';\r\nimport ripple from './ripple';\r\nimport {SliderSuperTab} from './slider';\r\nimport RadioForm from './radioForm';\r\nimport {i18n, LangPackKey} from '../lib/langPack';\r\nimport replaceContent from '../helpers/dom/replaceContent';\r\nimport setInnerHTML from '../helpers/dom/setInnerHTML';\r\nimport {attachClickEvent} from '../helpers/dom/clickEvent';\r\nimport ListenerSetter from '../helpers/listenerSetter';\r\nimport Button from './button';\r\n\r\nexport default class Row {\r\n  public container: HTMLElement;\r\n  public title: HTMLDivElement;\r\n  public titleRight: HTMLElement;\r\n  public subtitle: HTMLElement;\r\n  public media: HTMLElement;\r\n\r\n  public checkboxField: CheckboxField;\r\n  public radioField: RadioField;\r\n\r\n  public freezed = false;\r\n\r\n  public buttonRight: HTMLElement;\r\n\r\n  constructor(options: Partial<{\r\n    icon: string,\r\n    subtitle: string | HTMLElement | DocumentFragment,\r\n    subtitleLangKey: LangPackKey,\r\n    subtitleLangArgs: any[],\r\n    radioField: Row['radioField'],\r\n    checkboxField: Row['checkboxField'],\r\n    noCheckboxSubtitle: boolean,\r\n    title: string | HTMLElement | DocumentFragment,\r\n    titleLangKey: LangPackKey,\r\n    titleRight: string | HTMLElement,\r\n    titleRightSecondary: string | HTMLElement,\r\n    clickable: boolean | ((e: Event) => void),\r\n    navigationTab: SliderSuperTab,\r\n    havePadding: boolean,\r\n    noRipple: boolean,\r\n    noWrap: boolean,\r\n    listenerSetter: ListenerSetter,\r\n    buttonRight?: HTMLElement | boolean,\r\n    buttonRightLangKey: LangPackKey\r\n  }> = {}) {\r\n    this.container = document.createElement(options.radioField || options.checkboxField ? 'label' : 'div');\r\n    this.container.classList.add('row');\r\n\r\n    this.subtitle = document.createElement('div');\r\n    this.subtitle.classList.add('row-subtitle');\r\n    this.subtitle.setAttribute('dir', 'auto');\r\n    if(options.subtitle) {\r\n      if(typeof(options.subtitle) === 'string') {\r\n        setInnerHTML(this.subtitle, options.subtitle);\r\n      } else {\r\n        this.subtitle.append(options.subtitle);\r\n      }\r\n    } else if(options.subtitleLangKey) {\r\n      this.subtitle.append(i18n(options.subtitleLangKey, options.subtitleLangArgs));\r\n    }\r\n    this.container.append(this.subtitle);\r\n\r\n    let havePadding = !!options.havePadding;\r\n    if(options.radioField || options.checkboxField) {\r\n      if(options.radioField) {\r\n        this.radioField = options.radioField;\r\n        this.container.append(this.radioField.label);\r\n        havePadding = true;\r\n      }\r\n\r\n      if(options.checkboxField) {\r\n        this.checkboxField = options.checkboxField;\r\n\r\n        const isToggle = options.checkboxField.label.classList.contains('checkbox-field-toggle');\r\n        if(isToggle) {\r\n          this.container.classList.add('row-with-toggle');\r\n          options.titleRight = this.checkboxField.label;\r\n        } else {\r\n          havePadding = true;\r\n          this.container.append(this.checkboxField.label);\r\n        }\r\n\r\n        if(!options.noCheckboxSubtitle && !isToggle) {\r\n          const onChange = () => {\r\n            replaceContent(this.subtitle, i18n(this.checkboxField.input.checked ? 'Checkbox.Enabled' : 'Checkbox.Disabled'));\r\n          };\r\n\r\n          if(options.listenerSetter) options.listenerSetter.add(this.checkboxField.input)('change', onChange);\r\n          else this.checkboxField.input.addEventListener('change', onChange);\r\n        }\r\n      }\r\n\r\n      const i = options.radioField || options.checkboxField;\r\n      i.label.classList.add('disable-hover');\r\n    }\r\n\r\n    if(options.title || options.titleLangKey) {\r\n      let c: HTMLElement;\r\n      const titleRight = options.titleRight || options.titleRightSecondary;\r\n      if(titleRight) {\r\n        c = document.createElement('div');\r\n        c.classList.add('row-title-row');\r\n        this.container.append(c);\r\n      } else {\r\n        c = this.container;\r\n      }\r\n\r\n      this.title = document.createElement('div');\r\n      this.title.classList.add('row-title');\r\n      this.title.setAttribute('dir', 'auto');\r\n      if(options.noWrap) this.title.classList.add('no-wrap');\r\n      if(options.title) {\r\n        if(typeof(options.title) === 'string') {\r\n          this.title.innerHTML = options.title;\r\n        } else {\r\n          this.title.append(options.title);\r\n        }\r\n      } else {\r\n        this.title.append(i18n(options.titleLangKey));\r\n      }\r\n      c.append(this.title);\r\n\r\n      if(titleRight) {\r\n        const titleRightEl = this.titleRight = document.createElement('div');\r\n        titleRightEl.classList.add('row-title', 'row-title-right');\r\n\r\n        if(options.titleRightSecondary) {\r\n          titleRightEl.classList.add('row-title-right-secondary');\r\n        }\r\n\r\n        if(typeof(titleRight) === 'string') {\r\n          titleRightEl.innerHTML = titleRight;\r\n        } else {\r\n          titleRightEl.append(titleRight);\r\n        }\r\n\r\n        c.append(titleRightEl);\r\n      }\r\n    }\r\n\r\n    if(options.icon) {\r\n      havePadding = true;\r\n      this.title.classList.add('tgico', 'tgico-' + options.icon);\r\n      this.container.classList.add('row-with-icon');\r\n    }\r\n\r\n    if(havePadding) {\r\n      this.container.classList.add('row-with-padding');\r\n    }\r\n\r\n    if(options.navigationTab) {\r\n      options.clickable = () => options.navigationTab.open();\r\n    }\r\n\r\n    if(options.clickable || options.radioField || options.checkboxField) {\r\n      if(typeof(options.clickable) === 'function') {\r\n        attachClickEvent(this.container, (e) => {\r\n          if(this.freezed) return;\r\n          (options.clickable as any)(e);\r\n        }, {listenerSetter: options.listenerSetter});\r\n      }\r\n\r\n      this.container.classList.add('row-clickable', 'hover-effect');\r\n\r\n      if(!options.noRipple) {\r\n        ripple(this.container, undefined, undefined, true);\r\n      }\r\n\r\n      /* if(options.radioField || options.checkboxField) {\r\n        this.container.prepend(this.container.lastElementChild);\r\n      } */\r\n    }\r\n\r\n    if(options.buttonRight || options.buttonRightLangKey) {\r\n      this.buttonRight = options.buttonRight instanceof HTMLElement ?\r\n        options.buttonRight :\r\n        Button('btn-primary btn-color-primary', {text: options.buttonRightLangKey});\r\n      this.container.append(this.buttonRight);\r\n    }\r\n  }\r\n\r\n  public createMedia(size?: 'small') {\r\n    this.container.classList.add('row-with-padding');\r\n\r\n    const media = this.media = document.createElement('div');\r\n    media.classList.add('row-media');\r\n\r\n    if(size) {\r\n      media.classList.add('row-media-' + size);\r\n    }\r\n\r\n    this.container.append(media);\r\n\r\n    return media;\r\n  }\r\n}\r\n\r\nexport const RadioFormFromRows = (rows: Row[], onChange: (value: string) => void) => {\r\n  return RadioForm(rows.map((r) => ({container: r.container, input: r.radioField.input})), onChange);\r\n};\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport IS_TOUCH_SUPPORTED from '../environment/touchSupport';\r\nimport {logger, LogTypes} from '../lib/logger';\r\nimport fastSmoothScroll, {ScrollOptions} from '../helpers/fastSmoothScroll';\r\nimport useHeavyAnimationCheck from '../hooks/useHeavyAnimationCheck';\r\nimport cancelEvent from '../helpers/dom/cancelEvent';\r\nimport {IS_ANDROID} from '../environment/userAgent';\r\n/*\r\nvar el = $0;\r\nvar height = 0;\r\nvar checkUp = false;\r\n\r\ndo {\r\n  height += el.scrollHeight;\r\n} while(el = (checkUp ? el.previousElementSibling : el.nextElementSibling));\r\nconsole.log(height);\r\n*/\r\n\r\n/*\r\nArray.from($0.querySelectorAll('.bubble-content')).forEach((_el) => {\r\n  //_el.style.display = '';\r\n  //return;\r\n\r\n  let el = _el.parentElement;\r\n  let height = el.scrollHeight;\r\n  let width = el.scrollWidth;\r\n  el.style.width = width + 'px';\r\n  el.style.height = height + 'px';\r\n  _el.style.display = 'none';\r\n});\r\n*/\r\n\r\n/* const scrollables: Map<HTMLElement, Scrollable> = new Map();\r\nconst scrollsIntersector = new IntersectionObserver((entries) => {\r\n  for(let entry of entries) {\r\n    const scrollable = scrollables.get(entry.target as HTMLElement);\r\n\r\n    if(entry.isIntersecting) {\r\n      scrollable.isVisible = true;\r\n    } else {\r\n      scrollable.isVisible = false;\r\n\r\n      if(!isInDOM(entry.target)) {\r\n        scrollsIntersector.unobserve(scrollable.container);\r\n        scrollables.delete(scrollable.container);\r\n      }\r\n    }\r\n  }\r\n}); */\r\n\r\nconst SCROLL_THROTTLE = IS_ANDROID ? 200 : 24;\r\n\r\nexport class ScrollableBase {\r\n  protected log: ReturnType<typeof logger>;\r\n\r\n  public splitUp: HTMLElement;\r\n  public onScrollMeasure: number = 0;\r\n\r\n  public lastScrollPosition: number = 0;\r\n  public lastScrollDirection: number = 0;\r\n\r\n  public onAdditionalScroll: () => void;\r\n  public onScrolledTop: () => void;\r\n  public onScrolledBottom: () => void;\r\n\r\n  public isHeavyAnimationInProgress = false;\r\n  protected needCheckAfterAnimation = false;\r\n\r\n  public checkForTriggers?: () => void;\r\n\r\n  public scrollProperty: 'scrollTop' | 'scrollLeft';\r\n\r\n  protected removeHeavyAnimationListener: () => void;\r\n  protected addedScrollListener: boolean;\r\n\r\n  constructor(public el: HTMLElement, logPrefix = '', public container: HTMLElement = document.createElement('div')) {\r\n    this.container.classList.add('scrollable');\r\n\r\n    this.log = logger('SCROLL' + (logPrefix ? '-' + logPrefix : ''), LogTypes.Error);\r\n\r\n    if(el) {\r\n      Array.from(el.children).forEach((c) => this.container.append(c));\r\n\r\n      el.append(this.container);\r\n    }\r\n    // this.onScroll();\r\n  }\r\n\r\n  public addScrollListener() {\r\n    if(this.addedScrollListener) {\r\n      return;\r\n    }\r\n\r\n    this.addedScrollListener = true;\r\n    this.container.addEventListener('scroll', this.onScroll, {passive: true, capture: true});\r\n  }\r\n\r\n  public removeScrollListener() {\r\n    if(!this.addedScrollListener) {\r\n      return;\r\n    }\r\n\r\n    this.addedScrollListener = false;\r\n    this.container.removeEventListener('scroll', this.onScroll, {capture: true});\r\n  }\r\n\r\n  public setListeners() {\r\n    if(this.removeHeavyAnimationListener) {\r\n      return;\r\n    }\r\n\r\n    window.addEventListener('resize', this.onScroll, {passive: true});\r\n    this.addScrollListener();\r\n\r\n    this.removeHeavyAnimationListener = useHeavyAnimationCheck(() => {\r\n      this.isHeavyAnimationInProgress = true;\r\n\r\n      if(this.onScrollMeasure) {\r\n        this.cancelMeasure();\r\n        this.needCheckAfterAnimation = true;\r\n      }\r\n    }, () => {\r\n      this.isHeavyAnimationInProgress = false;\r\n\r\n      if(this.needCheckAfterAnimation) {\r\n        this.onScroll();\r\n        this.needCheckAfterAnimation = false;\r\n      }\r\n    });\r\n  }\r\n\r\n  public removeListeners() {\r\n    if(!this.removeHeavyAnimationListener) {\r\n      return;\r\n    }\r\n\r\n    window.removeEventListener('resize', this.onScroll);\r\n    this.removeScrollListener();\r\n\r\n    this.removeHeavyAnimationListener();\r\n    this.removeHeavyAnimationListener = undefined;\r\n  }\r\n\r\n  public destroy() {\r\n    this.removeListeners();\r\n    this.onAdditionalScroll = undefined;\r\n    this.onScrolledTop = undefined;\r\n    this.onScrolledBottom = undefined;\r\n  }\r\n\r\n  public append(element: HTMLElement) {\r\n    this.container.append(element);\r\n  }\r\n\r\n  public scrollIntoViewNew(options: Omit<ScrollOptions, 'container'>) {\r\n    // return Promise.resolve();\r\n    // this.removeListeners();\r\n    return fastSmoothScroll({\r\n      ...options,\r\n      container: this.container\r\n    });/* .finally(() => {\r\n      this.setListeners();\r\n    }); */\r\n  }\r\n\r\n  public onScroll = () => {\r\n    // if(this.debug) {\r\n    // this.log('onScroll call', this.onScrollMeasure);\r\n    // }\r\n\r\n    // return;\r\n\r\n    if(this.isHeavyAnimationInProgress) {\r\n      this.cancelMeasure();\r\n      this.needCheckAfterAnimation = true;\r\n      return;\r\n    }\r\n\r\n    // if(this.onScrollMeasure || ((this.scrollLocked || (!this.onScrolledTop && !this.onScrolledBottom)) && !this.splitUp && !this.onAdditionalScroll)) return;\r\n    if((!this.onScrolledTop && !this.onScrolledBottom) && !this.splitUp && !this.onAdditionalScroll) return;\r\n    if(this.onScrollMeasure) return;\r\n    // if(this.onScrollMeasure) window.cancelAnimationFrame(this.onScrollMeasure);\r\n    // this.onScrollMeasure = window.requestAnimationFrame(() => {\r\n    this.onScrollMeasure = window.setTimeout(() => {\r\n      this.onScrollMeasure = 0;\r\n\r\n      const scrollPosition = this.container[this.scrollProperty];\r\n      this.lastScrollDirection = this.lastScrollPosition === scrollPosition ? 0 : (this.lastScrollPosition < scrollPosition ? 1 : -1); // * 1 - bottom, -1 - top\r\n      this.lastScrollPosition = scrollPosition;\r\n\r\n      // lastScrollDirection check is useless here, every callback should decide on its own\r\n      if(this.onAdditionalScroll/*  && this.lastScrollDirection !== 0 */) {\r\n        this.onAdditionalScroll();\r\n      }\r\n\r\n      if(this.checkForTriggers) {\r\n        this.checkForTriggers();\r\n      }\r\n    // });\r\n    }, SCROLL_THROTTLE);\r\n  };\r\n\r\n  public cancelMeasure() {\r\n    if(this.onScrollMeasure) {\r\n      // window.cancelAnimationFrame(this.onScrollMeasure);\r\n      clearTimeout(this.onScrollMeasure);\r\n      this.onScrollMeasure = 0;\r\n    }\r\n  }\r\n}\r\n\r\nexport type SliceSides = 'top' | 'bottom';\r\nexport type SliceSidesContainer = {[k in SliceSides]: boolean};\r\n\r\nexport default class Scrollable extends ScrollableBase {\r\n  public padding: HTMLElement;\r\n\r\n  public loadedAll: SliceSidesContainer = {top: true, bottom: false};\r\n\r\n  constructor(el: HTMLElement, logPrefix = '', public onScrollOffset = 300, withPaddingContainer?: boolean) {\r\n    super(el, logPrefix);\r\n\r\n    /* if(withPaddingContainer) {\r\n      this.padding = document.createElement('div');\r\n      this.padding.classList.add('scrollable-padding');\r\n      Array.from(this.container.children).forEach((c) => this.padding.append(c));\r\n      this.container.append(this.padding);\r\n    } */\r\n\r\n    this.container.classList.add('scrollable-y');\r\n    this.setListeners();\r\n    this.scrollProperty = 'scrollTop';\r\n  }\r\n\r\n  public setVirtualContainer(el?: HTMLElement) {\r\n    this.splitUp = el;\r\n    this.log('setVirtualContainer:', el, this);\r\n  }\r\n\r\n  public checkForTriggers = () => {\r\n    if((!this.onScrolledTop && !this.onScrolledBottom)) return;\r\n\r\n    if(this.isHeavyAnimationInProgress) {\r\n      this.onScroll();\r\n      return;\r\n    }\r\n\r\n    const scrollHeight = this.container.scrollHeight;\r\n    if(!scrollHeight) { //         \r\n      return;\r\n    }\r\n\r\n    const clientHeight = this.container.clientHeight;\r\n    const maxScrollTop = scrollHeight - clientHeight;\r\n    const scrollTop = this.lastScrollPosition;\r\n\r\n    // this.log('checkForTriggers:', scrollTop, maxScrollTop);\r\n\r\n    if(this.onScrolledTop && scrollTop <= this.onScrollOffset && this.lastScrollDirection <= 0/* && direction === -1 */) {\r\n      this.onScrolledTop();\r\n    }\r\n\r\n    if(this.onScrolledBottom && (maxScrollTop - scrollTop) <= this.onScrollOffset && this.lastScrollDirection >= 0/* && direction === 1 */) {\r\n      this.onScrolledBottom();\r\n    }\r\n  };\r\n\r\n  public prepend(...elements: (HTMLElement | DocumentFragment)[]) {\r\n    (this.splitUp || this.padding || this.container).prepend(...elements);\r\n  }\r\n\r\n  public append(...elements: (HTMLElement | DocumentFragment)[]) {\r\n    (this.splitUp || this.padding || this.container).append(...elements);\r\n  }\r\n\r\n  public getDistanceToEnd() {\r\n    return this.scrollHeight - Math.round(this.scrollTop + this.container.offsetHeight);\r\n  }\r\n\r\n  get isScrolledDown() {\r\n    return this.getDistanceToEnd() <= 1;\r\n  }\r\n\r\n  set scrollTop(y: number) {\r\n    this.container.scrollTop = y;\r\n  }\r\n\r\n  get scrollTop() {\r\n    // this.log.trace('get scrollTop');\r\n    return this.container.scrollTop;\r\n  }\r\n\r\n  public setScrollTopSilently(value: number) {\r\n    this.lastScrollPosition = value;\r\n    this.ignoreNextScrollEvent();\r\n\r\n    this.scrollTop = value;\r\n  }\r\n\r\n  public ignoreNextScrollEvent() {\r\n    if(this.removeHeavyAnimationListener) {\r\n      this.removeScrollListener();\r\n      this.container.addEventListener('scroll', (e) => {\r\n        cancelEvent(e);\r\n        this.addScrollListener();\r\n      }, {capture: true, passive: false, once: true});\r\n    }\r\n  }\r\n\r\n  get scrollHeight() {\r\n    return this.container.scrollHeight;\r\n  }\r\n}\r\n\r\nexport class ScrollableX extends ScrollableBase {\r\n  constructor(el: HTMLElement, logPrefix = '', public onScrollOffset = 300, public splitCount = 15, public container: HTMLElement = document.createElement('div')) {\r\n    super(el, logPrefix, container);\r\n\r\n    this.container.classList.add('scrollable-x');\r\n\r\n    if(!IS_TOUCH_SUPPORTED) {\r\n      const scrollHorizontally = (e: any) => {\r\n        if(!e.deltaX && this.container.scrollWidth > this.container.clientWidth) {\r\n          this.container.scrollLeft += e.deltaY / 4;\r\n          cancelEvent(e);\r\n        }\r\n      };\r\n\r\n      this.container.addEventListener('wheel', scrollHorizontally, {passive: false});\r\n    }\r\n\r\n    this.scrollProperty = 'scrollLeft';\r\n  }\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport appSidebarLeft, {SettingSection} from '..';\r\nimport {InputFile} from '../../../layer';\r\nimport appDialogsManager from '../../../lib/appManagers/appDialogsManager';\r\nimport InputField from '../../inputField';\r\nimport {SliderSuperTab} from '../../slider';\r\nimport AvatarEdit from '../../avatarEdit';\r\nimport I18n from '../../../lib/langPack';\r\nimport ButtonCorner from '../../buttonCorner';\r\nimport getUserStatusString from '../../wrappers/getUserStatusString';\r\nimport appImManager from '../../../lib/appManagers/appImManager';\r\nimport {attachClickEvent} from '../../../helpers/dom/clickEvent';\r\n\r\ninterface OpenStreetMapInterface {\r\n  place_id?: number;\r\n  license?: string;\r\n  osm_type?: string;\r\n  osm_id?: number;\r\n  lat?: string;\r\n  lon?: string;\r\n  display_name: string;\r\n  address?: object;\r\n  boundingbox?: object;\r\n}\r\n\r\nexport default class AppNewGroupTab extends SliderSuperTab {\r\n  private avatarEdit: AvatarEdit;\r\n  private uploadAvatar: () => Promise<InputFile> = null;\r\n  private peerIds: PeerId[];\r\n  private isGeoChat: boolean = false;\r\n  private nextBtn: HTMLButtonElement;\r\n  private groupNameInputField: InputField;\r\n  private list: HTMLUListElement;\r\n  private groupLocationInputField: InputField;\r\n  private userLocationCoords: {lat: number, long: number};\r\n  private userLocationAddress: string;\r\n\r\n  protected init() {\r\n    this.container.classList.add('new-group-container');\r\n    this.setTitle('NewGroup');\r\n\r\n    this.avatarEdit = new AvatarEdit((_upload) => {\r\n      this.uploadAvatar = _upload;\r\n    });\r\n\r\n    const section = new SettingSection({});\r\n\r\n    const inputWrapper = document.createElement('div');\r\n    inputWrapper.classList.add('input-wrapper');\r\n\r\n    this.groupNameInputField = new InputField({\r\n      label: 'CreateGroup.NameHolder',\r\n      maxLength: 128\r\n    });\r\n\r\n    this.groupLocationInputField = new InputField({\r\n      label: 'ChatLocation',\r\n      name: 'location',\r\n      canBeEdited: false\r\n    });\r\n\r\n    inputWrapper.append(\r\n      this.groupNameInputField.container,\r\n      this.groupLocationInputField.container\r\n    );\r\n\r\n    this.listenerSetter.add(this.groupNameInputField.input)('input', () => {\r\n      const value = this.groupNameInputField.value;\r\n      let valueCheck = !!value.length && !this.groupNameInputField.input.classList.contains('error');\r\n      if(this.isGeoChat) valueCheck = valueCheck && !!this.userLocationCoords && !!this.userLocationAddress;\r\n      this.nextBtn.classList.toggle('is-visible', !!valueCheck);\r\n    });\r\n\r\n    this.nextBtn = ButtonCorner({icon: 'arrow_next'});\r\n\r\n    attachClickEvent(this.nextBtn, () => {\r\n      const title = this.groupNameInputField.value;\r\n\r\n      let promise: Promise<ChatId>;\r\n      if(this.isGeoChat) {\r\n        if(!this.userLocationAddress || !this.userLocationCoords) return;\r\n        promise = this.managers.appChatsManager.createChannel({\r\n          title,\r\n          about: '',\r\n          geo_point: {\r\n            _: 'inputGeoPoint',\r\n            ...this.userLocationCoords\r\n          },\r\n          address: this.userLocationAddress,\r\n          megagroup: true\r\n        }).then((chatId) => {\r\n          if(this.uploadAvatar) {\r\n            this.uploadAvatar().then((inputFile) => {\r\n              this.managers.appChatsManager.editPhoto(chatId, inputFile);\r\n            });\r\n          }\r\n\r\n          if(this.peerIds.length) {\r\n            this.managers.appChatsManager.inviteToChannel(chatId, this.peerIds);\r\n          }\r\n\r\n          return chatId;\r\n        });\r\n      } else {\r\n        this.nextBtn.disabled = true;\r\n        promise = this.managers.appChatsManager.createChat(title, this.peerIds.map((peerId) => peerId.toUserId())).then((chatId) => {\r\n          if(this.uploadAvatar) {\r\n            this.uploadAvatar().then((inputFile) => {\r\n              this.managers.appChatsManager.editPhoto(chatId, inputFile);\r\n            });\r\n          }\r\n\r\n          return chatId;\r\n        });\r\n      }\r\n\r\n      if(!promise) {\r\n        return;\r\n      }\r\n\r\n      promise.then((chatId) => {\r\n        appSidebarLeft.removeTabFromHistory(this);\r\n        appSidebarLeft.selectTab(0);\r\n\r\n        appImManager.setInnerPeer({peerId: chatId.toPeerId(true)});\r\n      });\r\n    }, {listenerSetter: this.listenerSetter});\r\n\r\n    const chatsSection = new SettingSection({\r\n      name: 'Members',\r\n      nameArgs: [this.peerIds.length]\r\n    });\r\n\r\n    const list = this.list = appDialogsManager.createChatList({\r\n      new: true\r\n    });\r\n\r\n    chatsSection.content.append(list);\r\n\r\n    section.content.append(this.avatarEdit.container, inputWrapper);\r\n\r\n    this.content.append(this.nextBtn);\r\n    this.scrollable.append(section.container, chatsSection.container);\r\n  }\r\n\r\n  public onCloseAfterTimeout() {\r\n    this.avatarEdit.clear();\r\n    this.uploadAvatar = null;\r\n    this.groupNameInputField.value = '';\r\n    this.groupLocationInputField.container.classList.add('hide');\r\n    this.nextBtn.disabled = false;\r\n  }\r\n\r\n  public open(peerIds: PeerId[], isGeoChat: boolean = false) {\r\n    this.isGeoChat = isGeoChat;\r\n    this.peerIds = peerIds;\r\n    const result = super.open();\r\n    result.then(() => {\r\n      if(isGeoChat) {\r\n        this.setTitle('NearbyCreateGroup');\r\n        this.groupLocationInputField.container.classList.remove('hide');\r\n        this.groupLocationInputField.setValueSilently(I18n.format('Loading', true));\r\n        this.startLocating();\r\n      } else {\r\n        this.groupLocationInputField.container.classList.add('hide');\r\n      }\r\n\r\n      return Promise.all(this.peerIds.map(async(userId) => {\r\n        const {dom} = appDialogsManager.addDialogNew({\r\n          peerId: userId,\r\n          container: this.list,\r\n          rippleEnabled: false,\r\n          avatarSize: 48\r\n        });\r\n\r\n        dom.lastMessageSpan.append(getUserStatusString(await this.managers.appUsersManager.getUser(userId)));\r\n      }));\r\n    });\r\n\r\n    return result;\r\n  }\r\n\r\n  private startLocating() {\r\n    navigator.geolocation.getCurrentPosition((location) => {\r\n      this.userLocationCoords = {\r\n        lat: location.coords.latitude,\r\n        long: location.coords.longitude\r\n      };\r\n\r\n      let uri = 'https://nominatim.openstreetmap.org/reverse';\r\n      uri += '?lat='+location.coords.latitude;\r\n      uri += '&lon='+location.coords.longitude;\r\n      uri += '&format=json';\r\n      uri += '&addressdetails=1';\r\n      uri += '&accept-language=en';\r\n      fetch(uri)\r\n      .then((response) => response.json())\r\n      .then((response: OpenStreetMapInterface) => {\r\n        this.userLocationAddress = response.display_name;\r\n        this.groupLocationInputField.setValueSilently(response.display_name);\r\n      });\r\n    }, (error) => {\r\n      if(error instanceof GeolocationPositionError) {\r\n        this.groupLocationInputField.setValueSilently('Location permission denied. Please retry later.');\r\n      } else {\r\n        this.groupLocationInputField.setValueSilently('An error has occurred. Please retry later.');\r\n      }\r\n    });\r\n  }\r\n}\r\n","enum PrivacyType {\n  Everybody = 2,\n  Contacts = 1,\n  Nobody = 0\n}\n\nexport default PrivacyType;\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport {PrivacyRule} from '../../../../layer';\nimport PrivacyType from './privacyType';\n\nexport default function getPrivacyRulesDetails(rules: PrivacyRule[]) {\n  const types: PrivacyType[] = [];\n\n  type peers = {users: UserId[], chats: ChatId[]};\n  const allowPeers: peers = {users: [], chats: []}, disallowPeers: peers = {users: [], chats: []};\n  rules.forEach((rule) => {\n    switch(rule._) {\n      case 'privacyValueAllowAll':\n        types.push(2);\n        break;\n      case 'privacyValueDisallowAll':\n        types.push(0);\n        break;\n      case 'privacyValueAllowContacts':\n        types.push(1);\n        break;\n      /* case 'privacyValueDisallowContacts':\n        types.push('Except My Contacts');\n        break; */\n      case 'privacyValueAllowChatParticipants':\n        allowPeers.chats.push(...rule.chats);\n        break;\n      case 'privacyValueAllowUsers':\n        allowPeers.users.push(...rule.users);\n        break;\n      case 'privacyValueDisallowChatParticipants':\n        disallowPeers.chats.push(...rule.chats);\n        break;\n      case 'privacyValueDisallowUsers':\n        disallowPeers.users.push(...rule.users);\n        break;\n    }\n  });\n\n  return {type: types[0], disallowPeers, allowPeers};\n}\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport replaceContent from '../helpers/dom/replaceContent';\r\nimport {randomLong} from '../helpers/random';\r\nimport {InputPrivacyKey, InputPrivacyRule} from '../layer';\r\nimport {AppManagers} from '../lib/appManagers/managers';\r\nimport getPrivacyRulesDetails from '../lib/appManagers/utils/privacy/getPrivacyRulesDetails';\r\nimport PrivacyType from '../lib/appManagers/utils/privacy/privacyType';\r\nimport {i18n, join, LangPackKey, _i18n} from '../lib/langPack';\r\nimport RadioField from './radioField';\r\nimport Row, {RadioFormFromRows} from './row';\r\nimport Scrollable from './scrollable';\r\nimport {SettingSection, generateSection} from './sidebarLeft';\r\nimport AppAddMembersTab from './sidebarLeft/tabs/addMembers';\r\nimport {SliderSuperTabEventable} from './sliderTab';\r\n\r\nexport type PrivacySectionStr = LangPackKey | '' | HTMLElement;\r\nexport default class PrivacySection {\r\n  public radioRows: Map<PrivacyType, Row>;\r\n  public radioSection: SettingSection;\r\n  public exceptions: Map<keyof PrivacySection['peerIds'], {\r\n    titleLangKey: LangPackKey,\r\n    key: keyof PrivacySection['peerIds'],\r\n    row: Row,\r\n    icon: string,\r\n    subtitleLangKey: LangPackKey,\r\n    clickable: true\r\n  }>;\r\n  public peerIds: {\r\n    disallow?: PeerId[],\r\n    allow?: PeerId[]\r\n  };\r\n  public type: PrivacyType;\r\n\r\n  constructor(public options: {\r\n    tab: SliderSuperTabEventable,\r\n    title: LangPackKey,\r\n    inputKey: InputPrivacyKey['_'],\r\n    captions?: [PrivacySectionStr, PrivacySectionStr, PrivacySectionStr],\r\n    appendTo?: Scrollable,\r\n    noExceptions?: boolean,\r\n    onRadioChange?: (value: number) => any,\r\n    skipTypes?: PrivacyType[],\r\n    exceptionTexts?: [LangPackKey, LangPackKey],\r\n    managers: AppManagers\r\n  }) {\r\n    if(options.captions) {\r\n      options.captions.reverse();\r\n    }\r\n\r\n    const managers = options.managers;\r\n\r\n    this.radioSection = new SettingSection({name: options.title, caption: true});\r\n\r\n    this.radioRows = new Map();\r\n\r\n    let r: Array<{type: PrivacyType, langKey: LangPackKey}> = [{\r\n      type: PrivacyType.Everybody,\r\n      langKey: 'PrivacySettingsController.Everbody'\r\n    }, {\r\n      type: PrivacyType.Contacts,\r\n      langKey: 'PrivacySettingsController.MyContacts'\r\n    }, {\r\n      type: PrivacyType.Nobody,\r\n      langKey: 'PrivacySettingsController.Nobody'\r\n    }];\r\n\r\n    if(options.skipTypes) {\r\n      r = r.filter((r) => !options.skipTypes.includes(r.type));\r\n    }\r\n\r\n    const random = randomLong();\r\n    r.forEach(({type, langKey}) => {\r\n      const row = new Row({\r\n        radioField: new RadioField({\r\n          langKey,\r\n          name: random,\r\n          value: '' + type\r\n        })\r\n      });\r\n\r\n      this.radioRows.set(type, row);\r\n    });\r\n\r\n    const form = RadioFormFromRows([...this.radioRows.values()], this.onRadioChange);\r\n\r\n    this.radioSection.content.append(form);\r\n    if(options.appendTo) {\r\n      options.appendTo.append(this.radioSection.container);\r\n    }\r\n\r\n    if(!options.noExceptions) {\r\n      const container = generateSection(options.appendTo, 'PrivacyExceptions', 'PrivacySettingsController.PeerInfo');\r\n\r\n      this.exceptions = new Map([[\r\n        'disallow',\r\n        {\r\n          titleLangKey: options.exceptionTexts[0],\r\n          key: 'disallow',\r\n          row: null,\r\n          icon: 'deleteuser',\r\n          subtitleLangKey: 'PrivacySettingsController.AddUsers',\r\n          clickable: true\r\n        }\r\n      ], [\r\n        'allow',\r\n        {\r\n          titleLangKey: options.exceptionTexts[1],\r\n          key: 'allow',\r\n          row: null,\r\n          icon: 'adduser',\r\n          subtitleLangKey: 'PrivacySettingsController.AddUsers',\r\n          clickable: true\r\n        }\r\n      ]]);\r\n\r\n      this.exceptions.forEach((exception) => {\r\n        exception.row = new Row(exception);\r\n\r\n        exception.row.container.addEventListener('click', () => {\r\n          promise.then(() => {\r\n            const _peerIds = this.peerIds[exception.key];\r\n            options.tab.slider.createTab(AppAddMembersTab).open({\r\n              type: 'privacy',\r\n              skippable: true,\r\n              title: exception.titleLangKey,\r\n              placeholder: 'PrivacyModal.Search.Placeholder',\r\n              takeOut: (newPeerIds) => {\r\n                _peerIds.length = 0;\r\n                _peerIds.push(...newPeerIds);\r\n                exception.row.subtitle.innerHTML = '';\r\n                exception.row.subtitle.append(...this.generateStr(this.splitPeersByType(newPeerIds)));\r\n              },\r\n              selectedPeerIds: _peerIds\r\n            });\r\n          });\r\n        });\r\n\r\n        container.append(exception.row.container);\r\n      });\r\n    }\r\n\r\n    /* setTimeout(() => {\r\n      this.setRadio(PrivacyType.Contacts);\r\n    }, 0); */\r\n\r\n    const promise = managers.appPrivacyManager.getPrivacy(options.inputKey).then((rules) => {\r\n      const details = getPrivacyRulesDetails(rules);\r\n      this.setRadio(details.type);\r\n\r\n      if(this.exceptions) {\r\n        this.peerIds = {};\r\n        ['allow' as const, 'disallow' as const].forEach((k) => {\r\n          const arr = [];\r\n          const from = k === 'allow' ? details.allowPeers : details.disallowPeers;\r\n          arr.push(...from.users.map((id) => id.toPeerId()));\r\n          arr.push(...from.chats.map((id) => id.toPeerId(true)));\r\n          this.peerIds[k] = arr;\r\n          const s = this.exceptions.get(k).row.subtitle;\r\n          s.innerHTML = '';\r\n          s.append(...this.generateStr(from));\r\n        });\r\n      }\r\n\r\n      options.tab.eventListener.addEventListener('destroy', async() => {\r\n        const rules: InputPrivacyRule[] = [];\r\n\r\n        switch(this.type) {\r\n          case PrivacyType.Everybody:\r\n            rules.push({_: 'inputPrivacyValueAllowAll'});\r\n            break;\r\n          case PrivacyType.Contacts:\r\n            rules.push({_: 'inputPrivacyValueAllowContacts'});\r\n            break;\r\n          case PrivacyType.Nobody:\r\n            rules.push({_: 'inputPrivacyValueDisallowAll'});\r\n            break;\r\n        }\r\n\r\n        if(this.exceptions) {\r\n          const a = ([\r\n            ['allow',     'inputPrivacyValueAllowChatParticipants',     'inputPrivacyValueAllowUsers'],\r\n            ['disallow',  'inputPrivacyValueDisallowChatParticipants',  'inputPrivacyValueDisallowUsers']\r\n          ] as Array<[\r\n            'allow' | 'disallow',\r\n            'inputPrivacyValueAllowChatParticipants' | 'inputPrivacyValueDisallowChatParticipants',\r\n            'inputPrivacyValueAllowUsers' | 'inputPrivacyValueDisallowUsers'\r\n          ]>);\r\n          for(const [k, chatKey, usersKey] of a) {\r\n            if(this.exceptions.get(k).row.container.classList.contains('hide')) {\r\n              continue;\r\n            }\r\n\r\n            const _peerIds = this.peerIds[k];\r\n            if(_peerIds) {\r\n              const splitted = this.splitPeersByType(_peerIds);\r\n              if(splitted.chats.length) {\r\n                rules.push({_: chatKey, chats: splitted.chats});\r\n              }\r\n\r\n              if(splitted.users.length) {\r\n                rules.push({\r\n                  _: usersKey,\r\n                  users: await Promise.all(splitted.users.map((id) => managers.appUsersManager.getUserInput(id)))\r\n                });\r\n              }\r\n            }\r\n          }\r\n        }\r\n\r\n        managers.appPrivacyManager.setPrivacy(options.inputKey, rules);\r\n      }, {once: true});\r\n    });\r\n  }\r\n\r\n  private onRadioChange = (value: string | PrivacySection['type']) => {\r\n    value = +value as PrivacySection['type'];\r\n    this.type = value;\r\n\r\n    const caption = this.options.captions[this.type];\r\n    const captionElement = this.radioSection.caption;\r\n    if(!caption) {\r\n      captionElement.innerHTML = '';\r\n    } else if(caption instanceof HTMLElement) {\r\n      replaceContent(captionElement, caption);\r\n    } else {\r\n      _i18n(captionElement, caption);\r\n    }\r\n    captionElement.classList.toggle('hide', !caption);\r\n\r\n    if(this.exceptions) {\r\n      this.exceptions.get('allow').row.container.classList.toggle('hide', this.type === PrivacyType.Everybody);\r\n      this.exceptions.get('disallow').row.container.classList.toggle('hide', this.type === PrivacyType.Nobody);\r\n    }\r\n\r\n    this.options.onRadioChange && this.options.onRadioChange(value);\r\n  };\r\n\r\n  public setRadio(type: PrivacySection['type']) {\r\n    const row = this.radioRows.get(type);\r\n    this.onRadioChange(type);\r\n    row.radioField.input.checked = true;\r\n  }\r\n\r\n  private splitPeersByType(peerIds: PeerId[]) {\r\n    const peers = {users: [] as UserId[], chats: [] as ChatId[]};\r\n    peerIds.forEach((peerId) => {\r\n      peers[peerId.isAnyChat() ? 'chats' : 'users'].push(peerId.isAnyChat() ? peerId.toChatId() : peerId);\r\n    });\r\n\r\n    return peers;\r\n  }\r\n\r\n  private generateStr(peers: {users: UserId[], chats: ChatId[]}) {\r\n    if(!peers.users.length && !peers.chats.length) {\r\n      return [i18n('PrivacySettingsController.AddUsers')];\r\n    }\r\n\r\n    return join([\r\n      peers.users.length ? i18n('Users', [peers.users.length]) : null,\r\n      peers.chats.length ? i18n('Chats', [peers.chats.length]) : null\r\n    ].filter(Boolean), false);\r\n  }\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport {SliderSuperTabEventable} from '../../../sliderTab';\r\nimport PrivacySection from '../../../privacySection';\r\nimport {i18n, LangPackKey} from '../../../../lib/langPack';\r\nimport anchorCopy from '../../../../helpers/dom/anchorCopy';\r\nimport PrivacyType from '../../../../lib/appManagers/utils/privacy/privacyType';\r\n\r\nexport default class AppPrivacyPhoneNumberTab extends SliderSuperTabEventable {\r\n  protected async init() {\r\n    this.header.classList.add('with-border');\r\n    this.container.classList.add('privacy-tab', 'privacy-phone-number');\r\n    this.setTitle('PrivacyPhone');\r\n\r\n    const formatted = '+' + (await this.managers.appUsersManager.getSelf()).phone;\r\n    const captionEl = document.createElement('div');\r\n    captionEl.append(\r\n      i18n('PrivacyPhoneInfo'),\r\n      document.createElement('br'),\r\n      document.createElement('br'),\r\n      i18n('PrivacyPhoneInfo4'),\r\n      document.createElement('br'),\r\n      anchorCopy({\r\n        mePath: formatted\r\n      })\r\n    );\r\n\r\n    const phoneSection = new PrivacySection({\r\n      tab: this,\r\n      title: 'PrivacyPhoneTitle',\r\n      inputKey: 'inputPrivacyKeyPhoneNumber',\r\n      captions: [captionEl, captionEl, ''],\r\n      exceptionTexts: ['PrivacySettingsController.NeverShare', 'PrivacySettingsController.AlwaysShare'],\r\n      appendTo: this.scrollable,\r\n      onRadioChange: (type) => {\r\n        s.setRadio(PrivacyType.Everybody);\r\n        s.radioSection.container.classList.toggle('hide', type !== PrivacyType.Nobody);\r\n      },\r\n      managers: this.managers\r\n    });\r\n\r\n    const sCaption: LangPackKey = 'PrivacyPhoneInfo3';\r\n    const s = new PrivacySection({\r\n      tab: this,\r\n      title: 'PrivacyPhoneTitle2',\r\n      inputKey: 'inputPrivacyKeyAddedByPhone',\r\n      captions: [sCaption, sCaption, ''],\r\n      noExceptions: true,\r\n      skipTypes: [PrivacyType.Nobody],\r\n      managers: this.managers\r\n    });\r\n\r\n    this.scrollable.container.insertBefore(s.radioSection.container, phoneSection.radioSection.container.nextSibling);\r\n  }\r\n}\r\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport {toastNew} from '../../components/toast';\nimport {copyTextToClipboard} from '../clipboard';\nimport cancelEvent from './cancelEvent';\nimport {attachClickEvent} from './clickEvent';\n\nexport default function anchorCopy(options: Partial<{\n  // href: string,\n  mePath: string\n}> = {}) {\n  const anchor = document.createElement('a');\n  anchor.classList.add('anchor-copy');\n\n  if(options.mePath) {\n    const href = 'https://t.me/' + options.mePath;\n    anchor.href = anchor.innerText = href;\n  }\n\n  attachClickEvent(anchor, (e) => {\n    cancelEvent(e);\n    copyTextToClipboard(anchor.href);\n    toastNew({langPackKey: 'LinkCopied'});\n  });\n\n  return anchor;\n}\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport {SettingSection} from '../..';\r\nimport {attachClickEvent} from '../../../../helpers/dom/clickEvent';\r\nimport Button from '../../../button';\r\nimport {SliderSuperTab} from '../../../slider';\r\nimport wrapStickerEmoji from '../../../wrappers/stickerEmoji';\r\nimport AppSettingsTab from '../settings';\r\n\r\nexport default class AppTwoStepVerificationSetTab extends SliderSuperTab {\r\n  protected init() {\r\n    this.container.classList.add('two-step-verification', 'two-step-verification-set');\r\n    this.setTitle('TwoStepVerificationPasswordSet');\r\n\r\n    const section = new SettingSection({\r\n      captionOld: 'TwoStepVerificationPasswordSetInfo',\r\n      noDelimiter: true\r\n    });\r\n\r\n    const emoji = '';\r\n    const stickerContainer = document.createElement('div');\r\n\r\n    wrapStickerEmoji({\r\n      emoji,\r\n      div: stickerContainer,\r\n      width: 160,\r\n      height: 160\r\n    });\r\n\r\n    section.content.append(stickerContainer);\r\n\r\n    const inputContent = section.generateContentElement();\r\n\r\n    const inputWrapper = document.createElement('div');\r\n    inputWrapper.classList.add('input-wrapper');\r\n\r\n    const btnReturn = Button('btn-primary btn-color-primary', {text: 'TwoStepVerificationPasswordReturnSettings'});\r\n\r\n    attachClickEvent(btnReturn, (e) => {\r\n      this.close();\r\n    });\r\n\r\n    this.slider.sliceTabsUntilTab(AppSettingsTab, this);\r\n\r\n    inputWrapper.append(btnReturn);\r\n\r\n    inputContent.append(inputWrapper);\r\n\r\n    this.scrollable.container.append(section.container);\r\n  }\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport {IS_MOBILE_SAFARI} from '../../environment/userAgent';\r\n\r\nexport function canFocus(isFirstInput: boolean) {\r\n  return !IS_MOBILE_SAFARI || !isFirstInput;\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport {SettingSection} from '../..';\r\nimport {AccountPassword} from '../../../../layer';\r\nimport Button from '../../../button';\r\nimport {SliderSuperTab} from '../../../slider';\r\nimport AppTwoStepVerificationSetTab from './passwordSet';\r\nimport CodeInputField from '../../../codeInputField';\r\nimport AppTwoStepVerificationEmailTab from './email';\r\nimport {putPreloader} from '../../../putPreloader';\r\nimport {i18n, _i18n} from '../../../../lib/langPack';\r\nimport {canFocus} from '../../../../helpers/dom/canFocus';\r\nimport {attachClickEvent} from '../../../../helpers/dom/clickEvent';\r\nimport replaceContent from '../../../../helpers/dom/replaceContent';\r\nimport toggleDisability from '../../../../helpers/dom/toggleDisability';\r\nimport wrapStickerEmoji from '../../../wrappers/stickerEmoji';\r\n\r\nexport default class AppTwoStepVerificationEmailConfirmationTab extends SliderSuperTab {\r\n  public codeInputField: CodeInputField;\r\n  public state: AccountPassword;\r\n  public email: string;\r\n  public length: number;\r\n  public isFirst = false;\r\n\r\n  protected init() {\r\n    this.container.classList.add('two-step-verification', 'two-step-verification-email-confirmation');\r\n    this.setTitle('TwoStepAuth.RecoveryTitle');\r\n\r\n    const section = new SettingSection({\r\n      captionOld: true,\r\n      noDelimiter: true\r\n    });\r\n\r\n    _i18n(section.caption, 'TwoStepAuth.ConfirmEmailCodeDesc', [this.email]);\r\n\r\n    const emoji = '';\r\n    const stickerContainer = document.createElement('div');\r\n\r\n    wrapStickerEmoji({\r\n      div: stickerContainer,\r\n      width: 160,\r\n      height: 160,\r\n      emoji\r\n    });\r\n\r\n    section.content.append(stickerContainer);\r\n\r\n    const inputContent = section.generateContentElement();\r\n\r\n    const inputWrapper = document.createElement('div');\r\n    inputWrapper.classList.add('input-wrapper');\r\n\r\n    const inputField = this.codeInputField = new CodeInputField({\r\n      name: 'recovery-email-code',\r\n      label: 'TwoStepAuth.RecoveryCode',\r\n      length: this.length,\r\n      onFill: (code) => {\r\n        freeze(true);\r\n\r\n        this.managers.passwordManager.confirmPasswordEmail('' + code)\r\n        .then((value) => {\r\n          if(!value) {\r\n\r\n          }\r\n\r\n          goNext();\r\n        })\r\n        .catch((err) => {\r\n          switch(err.type) {\r\n            case 'CODE_INVALID':\r\n              inputField.input.classList.add('error');\r\n              replaceContent(inputField.label, i18n('TwoStepAuth.RecoveryCodeInvalid'));\r\n              break;\r\n\r\n            case 'EMAIL_HASH_EXPIRED':\r\n              inputField.input.classList.add('error');\r\n              replaceContent(inputField.label, i18n('TwoStepAuth.RecoveryCodeExpired'));\r\n              break;\r\n\r\n            default:\r\n              console.error('confirm error', err);\r\n              break;\r\n          }\r\n\r\n          freeze(false);\r\n        });\r\n      }\r\n    });\r\n\r\n    const btnChange = Button('btn-primary btn-primary-transparent primary', {text: 'TwoStepAuth.EmailCodeChangeEmail'});\r\n    const btnResend = Button('btn-primary btn-secondary btn-primary-transparent primary', {text: 'ResendCode'});\r\n\r\n    const goNext = () => {\r\n      this.slider.createTab(AppTwoStepVerificationSetTab).open();\r\n    };\r\n\r\n    const freeze = (disable: boolean) => {\r\n      toggleDisability([inputField.input, btnChange, btnResend], disable);\r\n    };\r\n\r\n    attachClickEvent(btnChange, (e) => {\r\n      freeze(true);\r\n      this.managers.passwordManager.cancelPasswordEmail().then((value) => {\r\n        this.slider.sliceTabsUntilTab(AppTwoStepVerificationEmailTab, this);\r\n        this.close();\r\n      }, () => {\r\n        freeze(false);\r\n      });\r\n    });\r\n\r\n    attachClickEvent(btnResend, (e) => {\r\n      freeze(true);\r\n      const d = putPreloader(btnResend);\r\n      this.managers.passwordManager.resendPasswordEmail().then((value) => {\r\n        d.remove();\r\n        freeze(false);\r\n      });\r\n    });\r\n\r\n    inputWrapper.append(inputField.container, btnChange, btnResend);\r\n\r\n    inputContent.append(inputWrapper);\r\n\r\n    this.scrollable.container.append(section.container);\r\n  }\r\n\r\n  onOpenAfterTimeout() {\r\n    if(!canFocus(this.isFirst)) return;\r\n    this.codeInputField.input.focus();\r\n  }\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport {SettingSection} from '../..';\r\nimport {AccountPassword} from '../../../../layer';\r\nimport Button from '../../../button';\r\nimport {SliderSuperTab} from '../../../slider';\r\nimport InputField from '../../../inputField';\r\nimport {putPreloader} from '../../../putPreloader';\r\nimport AppTwoStepVerificationSetTab from './passwordSet';\r\nimport AppTwoStepVerificationEmailConfirmationTab from './emailConfirmation';\r\nimport PopupPeer from '../../../popups/peer';\r\nimport cancelEvent from '../../../../helpers/dom/cancelEvent';\r\nimport {canFocus} from '../../../../helpers/dom/canFocus';\r\nimport {attachClickEvent} from '../../../../helpers/dom/clickEvent';\r\nimport matchEmail from '../../../../lib/richTextProcessor/matchEmail';\r\nimport wrapStickerEmoji from '../../../wrappers/stickerEmoji';\r\n\r\nexport default class AppTwoStepVerificationEmailTab extends SliderSuperTab {\r\n  public inputField: InputField;\r\n  public state: AccountPassword;\r\n  public plainPassword: string;\r\n  public newPassword: string;\r\n  public hint: string;\r\n  public isFirst = false;\r\n\r\n  protected init() {\r\n    this.container.classList.add('two-step-verification', 'two-step-verification-email');\r\n    this.setTitle('RecoveryEmailTitle');\r\n\r\n    const section = new SettingSection({\r\n      captionOld: true,\r\n      noDelimiter: true\r\n    });\r\n\r\n    const emoji = '';\r\n    const stickerContainer = document.createElement('div');\r\n\r\n    wrapStickerEmoji({\r\n      div: stickerContainer,\r\n      width: 160,\r\n      height: 160,\r\n      emoji\r\n    });\r\n\r\n    section.content.append(stickerContainer);\r\n\r\n    const inputContent = section.generateContentElement();\r\n\r\n    const inputWrapper = document.createElement('div');\r\n    inputWrapper.classList.add('input-wrapper');\r\n\r\n    const inputField = this.inputField = new InputField({\r\n      name: 'recovery-email',\r\n      label: 'RecoveryEmail',\r\n      plainText: true\r\n    });\r\n\r\n    inputField.input.addEventListener('keypress', (e) => {\r\n      if(e.key === 'Enter') {\r\n        cancelEvent(e);\r\n        return onContinueClick();\r\n      }\r\n    });\r\n\r\n    inputField.input.addEventListener('input', (e) => {\r\n      inputField.input.classList.remove('error');\r\n    });\r\n\r\n    const btnContinue = Button('btn-primary btn-color-primary', {text: 'Continue'});\r\n    const btnSkip = Button('btn-primary btn-secondary btn-primary-transparent primary', {text: 'YourEmailSkip'});\r\n\r\n    const goNext = () => {\r\n      this.slider.createTab(AppTwoStepVerificationSetTab).open();\r\n    };\r\n\r\n    const onContinueClick = () => {\r\n      const email = inputField.value.trim();\r\n      const match = matchEmail(email);\r\n      if(!match || match[0].length !== email.length) {\r\n        inputField.input.classList.add('error');\r\n        return;\r\n      }\r\n\r\n      toggleButtons(true);\r\n      const d = putPreloader(btnContinue);\r\n\r\n      this.managers.passwordManager.updateSettings({\r\n        hint: this.hint,\r\n        currentPassword: this.plainPassword,\r\n        newPassword: this.newPassword,\r\n        email\r\n      }).then((value) => {\r\n        goNext();\r\n      }, (err) => {\r\n        if(err.type.includes('EMAIL_UNCONFIRMED')) {\r\n          const symbols = +err.type.match(/^EMAIL_UNCONFIRMED_(\\d+)/)[1];\r\n\r\n          const tab = this.slider.createTab(AppTwoStepVerificationEmailConfirmationTab);\r\n          tab.state = this.state;\r\n          tab.email = email;\r\n          tab.length = symbols;\r\n          tab.open();\r\n        } else {\r\n          console.log('password set error', err);\r\n        }\r\n\r\n        toggleButtons(false);\r\n        d.remove();\r\n      });\r\n    };\r\n    attachClickEvent(btnContinue, onContinueClick);\r\n\r\n    const toggleButtons = (freeze: boolean) => {\r\n      if(freeze) {\r\n        btnContinue.setAttribute('disabled', 'true');\r\n        btnSkip.setAttribute('disabled', 'true');\r\n      } else {\r\n        btnContinue.removeAttribute('disabled');\r\n        btnSkip.removeAttribute('disabled');\r\n      }\r\n    };\r\n\r\n    attachClickEvent(btnSkip, (e) => {\r\n      const popup = new PopupPeer('popup-skip-email', {\r\n        buttons: [{\r\n          langKey: 'Cancel',\r\n          isCancel: true\r\n        }, {\r\n          langKey: 'YourEmailSkip',\r\n          callback: () => {\r\n            // inputContent.classList.add('sidebar-left-section-disabled');\r\n            toggleButtons(true);\r\n            putPreloader(btnSkip);\r\n            this.managers.passwordManager.updateSettings({\r\n              hint: this.hint,\r\n              currentPassword: this.plainPassword,\r\n              newPassword: this.newPassword,\r\n              email: ''\r\n            }).then(() => {\r\n              goNext();\r\n            }, (err) => {\r\n              toggleButtons(false);\r\n            });\r\n          },\r\n          isDanger: true\r\n        }],\r\n        titleLangKey: 'YourEmailSkipWarning',\r\n        descriptionLangKey: 'YourEmailSkipWarningText'\r\n      });\r\n\r\n      popup.show();\r\n    });\r\n\r\n    inputWrapper.append(inputField.container, btnContinue, btnSkip);\r\n\r\n    inputContent.append(inputWrapper);\r\n\r\n    this.scrollable.container.append(section.container);\r\n  }\r\n\r\n  onOpenAfterTimeout() {\r\n    if(!canFocus(this.isFirst)) return;\r\n    this.inputField.input.focus();\r\n  }\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport {SettingSection} from '../..';\r\nimport {AccountPassword} from '../../../../layer';\r\nimport Button from '../../../button';\r\nimport {SliderSuperTab} from '../../../slider';\r\nimport InputField from '../../../inputField';\r\nimport AppTwoStepVerificationEmailTab from './email';\r\nimport {toast} from '../../../toast';\r\nimport I18n from '../../../../lib/langPack';\r\nimport cancelEvent from '../../../../helpers/dom/cancelEvent';\r\nimport {attachClickEvent} from '../../../../helpers/dom/clickEvent';\r\nimport wrapStickerEmoji from '../../../wrappers/stickerEmoji';\r\n\r\nexport default class AppTwoStepVerificationHintTab extends SliderSuperTab {\r\n  public inputField: InputField;\r\n  public state: AccountPassword;\r\n  public plainPassword: string;\r\n  public newPassword: string;\r\n\r\n  protected init() {\r\n    this.container.classList.add('two-step-verification', 'two-step-verification-hint');\r\n    this.setTitle('TwoStepAuth.SetupHintTitle');\r\n\r\n    const section = new SettingSection({\r\n      noDelimiter: true\r\n    });\r\n\r\n    const emoji = '';\r\n    const stickerContainer = document.createElement('div');\r\n    wrapStickerEmoji({\r\n      div: stickerContainer,\r\n      width: 160,\r\n      height: 160,\r\n      emoji\r\n    });\r\n\r\n    section.content.append(stickerContainer);\r\n\r\n    const inputWrapper = document.createElement('div');\r\n    inputWrapper.classList.add('input-wrapper');\r\n\r\n    const inputField = this.inputField = new InputField({\r\n      name: 'hint',\r\n      label: 'TwoStepAuth.SetupHintPlaceholder'\r\n    });\r\n\r\n    inputField.input.addEventListener('keypress', (e) => {\r\n      if(e.key === 'Enter') {\r\n        cancelEvent(e);\r\n        return inputField.value ? onContinueClick() : onSkipClick();\r\n      }\r\n    });\r\n\r\n    const goNext = (e?: Event, saveHint?: boolean) => {\r\n      if(e) {\r\n        cancelEvent(e);\r\n      }\r\n\r\n      const hint = saveHint ? inputField.value : undefined;\r\n      if(hint && this.newPassword === hint) {\r\n        toast(I18n.format('PasswordAsHintError', true));\r\n        return;\r\n      }\r\n\r\n      const tab = this.slider.createTab(AppTwoStepVerificationEmailTab);\r\n      tab.state = this.state;\r\n      tab.plainPassword = this.plainPassword;\r\n      tab.newPassword = this.newPassword;\r\n      tab.hint = hint;\r\n\r\n      tab.open();\r\n    };\r\n\r\n    const btnContinue = Button('btn-primary btn-color-primary', {text: 'Continue'});\r\n    const btnSkip = Button('btn-primary btn-secondary btn-primary-transparent primary', {text: 'YourEmailSkip'});\r\n\r\n    const onContinueClick = (e?: Event) => goNext(e, true);\r\n    const onSkipClick = (e?: Event) => goNext(e, false);\r\n    attachClickEvent(btnContinue, onContinueClick);\r\n    attachClickEvent(btnSkip, onSkipClick);\r\n\r\n    inputWrapper.append(inputField.container, btnContinue, btnSkip);\r\n\r\n    section.content.append(inputWrapper);\r\n\r\n    this.scrollable.container.append(section.container);\r\n  }\r\n\r\n  onOpenAfterTimeout() {\r\n    this.inputField.input.focus();\r\n  }\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport {SettingSection} from '../..';\r\nimport {AccountPassword} from '../../../../layer';\r\nimport Button from '../../../button';\r\nimport PasswordInputField from '../../../passwordInputField';\r\nimport {SliderSuperTab} from '../../../slider';\r\nimport TrackingMonkey from '../../../monkeys/tracking';\r\nimport AppTwoStepVerificationHintTab from './hint';\r\nimport {InputState} from '../../../inputField';\r\nimport cancelEvent from '../../../../helpers/dom/cancelEvent';\r\nimport {attachClickEvent} from '../../../../helpers/dom/clickEvent';\r\n\r\nexport default class AppTwoStepVerificationReEnterPasswordTab extends SliderSuperTab {\r\n  public state: AccountPassword;\r\n  public passwordInputField: PasswordInputField;\r\n  public plainPassword: string;\r\n  public newPassword: string;\r\n\r\n  protected init() {\r\n    this.container.classList.add('two-step-verification', 'two-step-verification-enter-password', 'two-step-verification-re-enter-password');\r\n    this.setTitle('PleaseReEnterPassword');\r\n\r\n    const section = new SettingSection({\r\n      noDelimiter: true\r\n    });\r\n\r\n    const inputWrapper = document.createElement('div');\r\n    inputWrapper.classList.add('input-wrapper');\r\n\r\n    const passwordInputField = this.passwordInputField = new PasswordInputField({\r\n      name: 're-enter-password',\r\n      label: 'PleaseReEnterPassword'\r\n    });\r\n\r\n    const monkey = new TrackingMonkey(passwordInputField, 157);\r\n\r\n    const btnContinue = Button('btn-primary btn-color-primary', {text: 'Continue'});\r\n\r\n    inputWrapper.append(passwordInputField.container, btnContinue);\r\n    section.content.append(monkey.container, inputWrapper);\r\n\r\n    this.scrollable.container.append(section.container);\r\n\r\n    passwordInputField.input.addEventListener('keypress', (e) => {\r\n      if(passwordInputField.input.classList.contains('error')) {\r\n        passwordInputField.setState(InputState.Neutral);\r\n      }\r\n\r\n      if(e.key === 'Enter') {\r\n        return onContinueClick();\r\n      }\r\n    });\r\n\r\n    const verifyInput = () => {\r\n      if(this.newPassword !== passwordInputField.value) {\r\n        passwordInputField.setError();\r\n        return false;\r\n      }\r\n\r\n      return true;\r\n    };\r\n\r\n    const onContinueClick = (e?: Event) => {\r\n      if(e) {\r\n        cancelEvent(e);\r\n      }\r\n\r\n      if(!verifyInput()) return;\r\n\r\n      const tab = this.slider.createTab(AppTwoStepVerificationHintTab);\r\n      tab.state = this.state;\r\n      tab.plainPassword = this.plainPassword;\r\n      tab.newPassword = this.newPassword;\r\n      tab.open();\r\n    };\r\n    attachClickEvent(btnContinue, onContinueClick);\r\n\r\n    return monkey.load();\r\n  }\r\n\r\n  onOpenAfterTimeout() {\r\n    this.passwordInputField.input.focus();\r\n  }\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport AppTwoStepVerificationTab from '.';\r\nimport {SettingSection} from '../..';\r\nimport cancelEvent from '../../../../helpers/dom/cancelEvent';\r\nimport {canFocus} from '../../../../helpers/dom/canFocus';\r\nimport {attachClickEvent} from '../../../../helpers/dom/clickEvent';\r\nimport replaceContent from '../../../../helpers/dom/replaceContent';\r\nimport setInnerHTML from '../../../../helpers/dom/setInnerHTML';\r\nimport {AccountPassword} from '../../../../layer';\r\nimport I18n, {i18n} from '../../../../lib/langPack';\r\nimport wrapEmojiText from '../../../../lib/richTextProcessor/wrapEmojiText';\r\nimport Button from '../../../button';\r\nimport {putPreloader} from '../../../putPreloader';\r\nimport PasswordMonkey from '../../../monkeys/password';\r\nimport PasswordInputField from '../../../passwordInputField';\r\nimport {SliderSuperTab} from '../../../slider';\r\nimport AppTwoStepVerificationReEnterPasswordTab from './reEnterPassword';\r\n\r\nexport default class AppTwoStepVerificationEnterPasswordTab extends SliderSuperTab {\r\n  public state: AccountPassword;\r\n  public passwordInputField: PasswordInputField;\r\n  public plainPassword: string;\r\n  public isFirst = true;\r\n\r\n  protected init() {\r\n    const isNew = !this.state.pFlags.has_password || this.plainPassword;\r\n    this.container.classList.add('two-step-verification', 'two-step-verification-enter-password');\r\n    this.setTitle(isNew ? 'PleaseEnterFirstPassword' : 'PleaseEnterCurrentPassword');\r\n\r\n    const section = new SettingSection({\r\n      noDelimiter: true\r\n    });\r\n\r\n    const inputWrapper = document.createElement('div');\r\n    inputWrapper.classList.add('input-wrapper');\r\n\r\n    const passwordInputField = this.passwordInputField = new PasswordInputField({\r\n      name: 'enter-password',\r\n      label: isNew ? 'PleaseEnterFirstPassword' : (this.state.hint ? undefined : 'LoginPassword'),\r\n      labelText: !isNew && this.state.hint ? wrapEmojiText(this.state.hint) : undefined\r\n    });\r\n\r\n    const monkey = new PasswordMonkey(passwordInputField, 157);\r\n\r\n    const btnContinue = Button('btn-primary btn-color-primary');\r\n    const textEl = new I18n.IntlElement({key: 'Continue'});\r\n\r\n    btnContinue.append(textEl.element);\r\n\r\n    inputWrapper.append(passwordInputField.container, btnContinue);\r\n    section.content.append(monkey.container, inputWrapper);\r\n\r\n    this.scrollable.container.append(section.container);\r\n\r\n    passwordInputField.input.addEventListener('keypress', (e) => {\r\n      if(passwordInputField.input.classList.contains('error')) {\r\n        passwordInputField.input.classList.remove('error');\r\n        textEl.key = 'Continue';\r\n        textEl.update();\r\n      }\r\n\r\n      if(e.key === 'Enter') {\r\n        return onContinueClick();\r\n      }\r\n    });\r\n\r\n    const verifyInput = () => {\r\n      if(!passwordInputField.value.length) {\r\n        passwordInputField.input.classList.add('error');\r\n        return false;\r\n      }\r\n\r\n      return true;\r\n    };\r\n\r\n    let onContinueClick: (e?: Event) => void;\r\n    if(!isNew) {\r\n      let getStateInterval: number;\r\n\r\n      const getState = () => {\r\n        // * just to check session relevance\r\n        if(!getStateInterval) {\r\n          getStateInterval = window.setInterval(getState, 10e3);\r\n        }\r\n\r\n        return this.managers.passwordManager.getState().then((_state) => {\r\n          this.state = _state;\r\n\r\n          if(this.state.hint) {\r\n            setInnerHTML(passwordInputField.label, wrapEmojiText(this.state.hint));\r\n          } else {\r\n            replaceContent(passwordInputField.label, i18n('LoginPassword'));\r\n          }\r\n        });\r\n      };\r\n\r\n      const submit = (e?: Event) => {\r\n        if(!verifyInput()) {\r\n          cancelEvent(e);\r\n          return;\r\n        }\r\n\r\n        btnContinue.setAttribute('disabled', 'true');\r\n        textEl.key = 'PleaseWait';\r\n        textEl.update();\r\n        const preloader = putPreloader(btnContinue);\r\n\r\n        const plainPassword = passwordInputField.value;\r\n        this.managers.passwordManager.check(passwordInputField.value, this.state).then((auth) => {\r\n          console.log(auth);\r\n\r\n          if(auth._ === 'auth.authorization') {\r\n            clearInterval(getStateInterval);\r\n            if(monkey) monkey.remove();\r\n            const tab = this.slider.createTab(AppTwoStepVerificationTab);\r\n            tab.state = this.state;\r\n            tab.plainPassword = plainPassword;\r\n            tab.open();\r\n            this.slider.removeTabFromHistory(this);\r\n          }\r\n        }, (err) => {\r\n          btnContinue.removeAttribute('disabled');\r\n          passwordInputField.input.classList.add('error');\r\n\r\n          switch(err.type) {\r\n            default:\r\n              // btnContinue.innerText = err.type;\r\n              textEl.key = 'PASSWORD_HASH_INVALID';\r\n              textEl.update();\r\n              preloader.remove();\r\n              passwordInputField.select();\r\n              break;\r\n          }\r\n\r\n          getState();\r\n        });\r\n      };\r\n\r\n      onContinueClick = submit;\r\n\r\n      getState();\r\n    } else {\r\n      onContinueClick = (e) => {\r\n        if(e) {\r\n          cancelEvent(e);\r\n        }\r\n\r\n        if(!verifyInput()) return;\r\n\r\n        const tab = this.slider.createTab(AppTwoStepVerificationReEnterPasswordTab);\r\n        tab.state = this.state;\r\n        tab.newPassword = passwordInputField.value;\r\n        tab.plainPassword = this.plainPassword;\r\n        tab.open();\r\n      };\r\n    }\r\n\r\n    attachClickEvent(btnContinue, onContinueClick);\r\n\r\n    return monkey.load();\r\n  }\r\n\r\n  onOpenAfterTimeout() {\r\n    if(!canFocus(this.isFirst)) return;\r\n    this.passwordInputField.input.focus();\r\n  }\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport {SettingSection} from '../..';\r\nimport {attachClickEvent} from '../../../../helpers/dom/clickEvent';\r\nimport {AccountPassword} from '../../../../layer';\r\nimport {_i18n} from '../../../../lib/langPack';\r\nimport Button from '../../../button';\r\nimport PopupPeer from '../../../popups/peer';\r\nimport {SliderSuperTab} from '../../../slider';\r\nimport wrapStickerEmoji from '../../../wrappers/stickerEmoji';\r\nimport AppSettingsTab from '../settings';\r\nimport AppTwoStepVerificationEmailTab from './email';\r\nimport AppTwoStepVerificationEnterPasswordTab from './enterPassword';\r\n\r\nexport default class AppTwoStepVerificationTab extends SliderSuperTab {\r\n  public state: AccountPassword;\r\n  public plainPassword: string;\r\n\r\n  protected init() {\r\n    this.container.classList.add('two-step-verification', 'two-step-verification-main');\r\n    this.setTitle('TwoStepVerificationTitle');\r\n\r\n    const section = new SettingSection({\r\n      captionOld: true,\r\n      noDelimiter: true\r\n    });\r\n\r\n    const emoji = '';\r\n    const stickerContainer = document.createElement('div');\r\n\r\n    wrapStickerEmoji({\r\n      div: stickerContainer,\r\n      width: 168,\r\n      height: 168,\r\n      emoji\r\n    });\r\n\r\n    section.content.append(stickerContainer);\r\n\r\n    const c = section.generateContentElement();\r\n    if(this.state.pFlags.has_password) {\r\n      _i18n(section.caption, 'TwoStepAuth.GenericHelp');\r\n\r\n      const btnChangePassword = Button('btn-primary btn-transparent', {icon: 'edit', text: 'TwoStepAuth.ChangePassword'});\r\n      const btnDisablePassword = Button('btn-primary btn-transparent', {icon: 'passwordoff', text: 'TwoStepAuth.RemovePassword'});\r\n      const btnSetRecoveryEmail = Button('btn-primary btn-transparent', {icon: 'email', text: this.state.pFlags.has_recovery ? 'TwoStepAuth.ChangeEmail' : 'TwoStepAuth.SetupEmail'});\r\n\r\n      attachClickEvent(btnChangePassword, () => {\r\n        const tab = this.slider.createTab(AppTwoStepVerificationEnterPasswordTab);\r\n        tab.state = this.state;\r\n        tab.plainPassword = this.plainPassword;\r\n        tab.open();\r\n      });\r\n\r\n      attachClickEvent(btnDisablePassword, () => {\r\n        const popup = new PopupPeer('popup-disable-password', {\r\n          buttons: [{\r\n            langKey: 'Disable',\r\n            callback: () => {\r\n              this.managers.passwordManager.updateSettings({currentPassword: this.plainPassword}).then(() => {\r\n                this.slider.sliceTabsUntilTab(AppSettingsTab, this);\r\n                this.close();\r\n              });\r\n            },\r\n            isDanger: true\r\n          }],\r\n          titleLangKey: 'TurnPasswordOffQuestionTitle',\r\n          descriptionLangKey: 'TurnPasswordOffQuestion'\r\n        });\r\n\r\n        popup.show();\r\n      });\r\n\r\n      attachClickEvent(btnSetRecoveryEmail, () => {\r\n        const tab = this.slider.createTab(AppTwoStepVerificationEmailTab);\r\n        tab.state = this.state;\r\n        tab.hint = this.state.hint;\r\n        tab.plainPassword = this.plainPassword;\r\n        tab.newPassword = this.plainPassword;\r\n        tab.isFirst = true;\r\n        tab.open();\r\n      });\r\n\r\n      c.append(btnChangePassword, btnDisablePassword, btnSetRecoveryEmail);\r\n    } else {\r\n      _i18n(section.caption, 'TwoStepAuth.SetPasswordHelp');\r\n\r\n      const inputWrapper = document.createElement('div');\r\n      inputWrapper.classList.add('input-wrapper');\r\n\r\n      const btnSetPassword = Button('btn-primary btn-color-primary', {text: 'TwoStepVerificationSetPassword'});\r\n\r\n      inputWrapper.append(btnSetPassword);\r\n      c.append(inputWrapper);\r\n\r\n      attachClickEvent(btnSetPassword, (e) => {\r\n        const tab = this.slider.createTab(AppTwoStepVerificationEnterPasswordTab);\r\n        tab.state = this.state;\r\n        tab.open();\r\n      });\r\n    }\r\n\r\n    this.scrollable.container.append(section.container);\r\n  }\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport {SliderSuperTabEventable} from '../../../sliderTab';\r\nimport PrivacySection from '../../../privacySection';\r\nimport {LangPackKey} from '../../../../lib/langPack';\r\n\r\nexport default class AppPrivacyLastSeenTab extends SliderSuperTabEventable {\r\n  protected init() {\r\n    this.header.classList.add('with-border');\r\n    this.container.classList.add('privacy-tab', 'privacy-last-seen');\r\n    this.setTitle('PrivacyLastSeen');\r\n\r\n    const caption: LangPackKey = 'PrivacySettingsController.LastSeenDescription';\r\n    new PrivacySection({\r\n      tab: this,\r\n      title: 'LastSeenTitle',\r\n      inputKey: 'inputPrivacyKeyStatusTimestamp',\r\n      captions: [caption, caption, caption],\r\n      exceptionTexts: ['PrivacySettingsController.NeverShare', 'PrivacySettingsController.AlwaysShare'],\r\n      appendTo: this.scrollable,\r\n      managers: this.managers\r\n    });\r\n  }\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport {SliderSuperTabEventable} from '../../../sliderTab';\r\nimport PrivacySection from '../../../privacySection';\r\nimport {LangPackKey} from '../../../../lib/langPack';\r\nimport PrivacyType from '../../../../lib/appManagers/utils/privacy/privacyType';\r\n\r\nexport default class AppPrivacyProfilePhotoTab extends SliderSuperTabEventable {\r\n  protected init() {\r\n    this.header.classList.add('with-border');\r\n    this.container.classList.add('privacy-tab', 'privacy-profile-photo');\r\n    this.setTitle('PrivacyProfilePhoto');\r\n\r\n    const caption: LangPackKey = 'PrivacySettingsController.ProfilePhoto.CustomHelp';\r\n    new PrivacySection({\r\n      tab: this,\r\n      title: 'PrivacyProfilePhotoTitle',\r\n      inputKey: 'inputPrivacyKeyProfilePhoto',\r\n      captions: [caption, caption, caption],\r\n      exceptionTexts: ['PrivacySettingsController.NeverShare', 'PrivacySettingsController.AlwaysShare'],\r\n      appendTo: this.scrollable,\r\n      skipTypes: [PrivacyType.Nobody],\r\n      managers: this.managers\r\n    });\r\n  }\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport {SliderSuperTabEventable} from '../../../sliderTab';\r\nimport PrivacySection from '../../../privacySection';\r\nimport {LangPackKey} from '../../../../lib/langPack';\r\n\r\nexport default class AppPrivacyForwardMessagesTab extends SliderSuperTabEventable {\r\n  protected init() {\r\n    this.header.classList.add('with-border');\r\n    this.container.classList.add('privacy-tab', 'privacy-forward-messages');\r\n    this.setTitle('PrivacySettings.Forwards');\r\n\r\n    const caption: LangPackKey = 'PrivacySettingsController.Forwards.CustomHelp';\r\n    new PrivacySection({\r\n      tab: this,\r\n      title: 'PrivacyForwardsTitle',\r\n      inputKey: 'inputPrivacyKeyForwards',\r\n      captions: [caption, caption, caption],\r\n      exceptionTexts: ['PrivacySettingsController.NeverAllow', 'PrivacySettingsController.AlwaysAllow'],\r\n      appendTo: this.scrollable,\r\n      managers: this.managers\r\n    });\r\n  }\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport {SliderSuperTabEventable} from '../../../sliderTab';\r\nimport PrivacySection from '../../../privacySection';\r\nimport {LangPackKey} from '../../../../lib/langPack';\r\nimport PrivacyType from '../../../../lib/appManagers/utils/privacy/privacyType';\r\n\r\nexport default class AppPrivacyAddToGroupsTab extends SliderSuperTabEventable {\r\n  protected init() {\r\n    this.header.classList.add('with-border');\r\n    this.container.classList.add('privacy-tab', 'privacy-add-to-groups');\r\n    this.setTitle('PrivacySettings.Groups');\r\n\r\n    const caption: LangPackKey = 'PrivacySettingsController.GroupDescription';\r\n    new PrivacySection({\r\n      tab: this,\r\n      title: 'WhoCanAddMe',\r\n      inputKey: 'inputPrivacyKeyChatInvite',\r\n      captions: [caption, caption, caption],\r\n      exceptionTexts: ['PrivacySettingsController.NeverAllow', 'PrivacySettingsController.AlwaysAllow'],\r\n      appendTo: this.scrollable,\r\n      skipTypes: [PrivacyType.Nobody],\r\n      managers: this.managers\r\n    });\r\n  }\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport {SliderSuperTabEventable} from '../../../sliderTab';\r\nimport PrivacySection from '../../../privacySection';\r\nimport {LangPackKey} from '../../../../lib/langPack';\r\n\r\nexport default class AppPrivacyCallsTab extends SliderSuperTabEventable {\r\n  protected init() {\r\n    this.header.classList.add('with-border');\r\n    this.container.classList.add('privacy-tab', 'privacy-calls');\r\n    this.setTitle('PrivacySettings.VoiceCalls');\r\n\r\n    const caption: LangPackKey = 'PrivacySettingsController.PhoneCallDescription';\r\n    new PrivacySection({\r\n      tab: this,\r\n      title: 'WhoCanCallMe',\r\n      inputKey: 'inputPrivacyKeyPhoneCall',\r\n      captions: [caption, caption, caption],\r\n      exceptionTexts: ['PrivacySettingsController.NeverAllow', 'PrivacySettingsController.AlwaysAllow'],\r\n      appendTo: this.scrollable,\r\n      managers: this.managers\r\n    });\r\n\r\n    {\r\n      const caption: LangPackKey = 'PrivacySettingsController.P2p.Desc';\r\n      new PrivacySection({\r\n        tab: this,\r\n        title: 'PrivacyP2PHeader',\r\n        inputKey: 'inputPrivacyKeyPhoneP2P',\r\n        captions: [caption, caption, caption],\r\n        exceptionTexts: ['PrivacySettingsController.NeverAllow', 'PrivacySettingsController.AlwaysAllow'],\r\n        appendTo: this.scrollable,\r\n        managers: this.managers\r\n      });\r\n    }\r\n  }\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport {SettingSection} from '..';\r\nimport Button from '../../button';\r\nimport Row from '../../row';\r\nimport {Authorization} from '../../../layer';\r\nimport {formatDateAccordingToTodayNew} from '../../../helpers/date';\r\nimport ButtonMenu from '../../buttonMenu';\r\nimport {toast} from '../../toast';\r\nimport I18n from '../../../lib/langPack';\r\nimport PopupPeer from '../../popups/peer';\r\nimport findUpClassName from '../../../helpers/dom/findUpClassName';\r\nimport {attachClickEvent} from '../../../helpers/dom/clickEvent';\r\nimport toggleDisability from '../../../helpers/dom/toggleDisability';\r\nimport {SliderSuperTabEventable} from '../../sliderTab';\r\nimport findAndSplice from '../../../helpers/array/findAndSplice';\r\nimport {attachContextMenuListener} from '../../../helpers/dom/attachContextMenuListener';\r\nimport positionMenu from '../../../helpers/positionMenu';\r\nimport contextMenuController from '../../../helpers/contextMenuController';\r\n\r\nexport default class AppActiveSessionsTab extends SliderSuperTabEventable {\r\n  public authorizations: Authorization.authorization[];\r\n  private menuElement: HTMLElement;\r\n\r\n  protected init() {\r\n    this.header.classList.add('with-border');\r\n    this.container.classList.add('active-sessions-container');\r\n    this.setTitle('SessionsTitle');\r\n\r\n    const Session = (auth: Authorization.authorization) => {\r\n      const row = new Row({\r\n        title: [auth.app_name, auth.app_version].join(' '),\r\n        subtitle: [auth.ip, auth.country].join(' - '),\r\n        clickable: true,\r\n        titleRight: auth.pFlags.current ? undefined : formatDateAccordingToTodayNew(new Date(Math.max(auth.date_active, auth.date_created) * 1000))\r\n      });\r\n\r\n      row.container.dataset.hash = '' + auth.hash;\r\n\r\n      const midtitle = document.createElement('div');\r\n      midtitle.classList.add('row-midtitle');\r\n      midtitle.innerHTML = [auth.device_model, auth.system_version || auth.platform].filter(Boolean).join(', ');\r\n\r\n      row.subtitle.parentElement.insertBefore(midtitle, row.subtitle);\r\n\r\n      return row;\r\n    };\r\n\r\n    const authorizations = this.authorizations.slice();\r\n\r\n    {\r\n      const section = new SettingSection({\r\n        name: 'CurrentSession',\r\n        caption: 'ClearOtherSessionsHelp'\r\n      });\r\n\r\n      const auth = findAndSplice(authorizations, auth => auth.pFlags.current);\r\n      const session = Session(auth);\r\n\r\n      section.content.append(session.container);\r\n\r\n      if(authorizations.length) {\r\n        const btnTerminate = Button('btn-primary btn-transparent danger', {icon: 'stop', text: 'TerminateAllSessions'});\r\n        attachClickEvent(btnTerminate, (e) => {\r\n          new PopupPeer('revoke-session', {\r\n            buttons: [{\r\n              langKey: 'Terminate',\r\n              isDanger: true,\r\n              callback: () => {\r\n                const toggle = toggleDisability([btnTerminate], true);\r\n                this.managers.apiManager.invokeApi('auth.resetAuthorizations').then((value) => {\r\n                  // toggleDisability([btnTerminate], false);\r\n                  btnTerminate.remove();\r\n                  otherSection.container.remove();\r\n                }, onError).finally(() => {\r\n                  toggle();\r\n                });\r\n              }\r\n            }],\r\n            titleLangKey: 'AreYouSureSessionsTitle',\r\n            descriptionLangKey: 'AreYouSureSessions'\r\n          }).show();\r\n        });\r\n\r\n        section.content.append(btnTerminate);\r\n      }\r\n\r\n      this.scrollable.append(section.container);\r\n    }\r\n\r\n    if(!authorizations.length) {\r\n      return;\r\n    }\r\n\r\n    const otherSection = new SettingSection({\r\n      name: 'OtherSessions',\r\n      caption: 'SessionsListInfo'\r\n    });\r\n\r\n    authorizations.forEach((auth) => {\r\n      otherSection.content.append(Session(auth).container);\r\n    });\r\n\r\n    this.scrollable.append(otherSection.container);\r\n\r\n    const onError = (err: any) => {\r\n      if(err.type === 'FRESH_RESET_AUTHORISATION_FORBIDDEN') {\r\n        toast(I18n.format('RecentSessions.Error.FreshReset', true));\r\n      }\r\n    };\r\n\r\n    let target: HTMLElement;\r\n    const onTerminateClick = () => {\r\n      const hash = target.dataset.hash;\r\n\r\n      new PopupPeer('revoke-session', {\r\n        buttons: [{\r\n          langKey: 'Terminate',\r\n          isDanger: true,\r\n          callback: () => {\r\n            this.managers.apiManager.invokeApi('account.resetAuthorization', {hash})\r\n            .then((value) => {\r\n              if(value) {\r\n                target.remove();\r\n              }\r\n            }, onError);\r\n          }\r\n        }],\r\n        titleLangKey: 'AreYouSureSessionTitle',\r\n        descriptionLangKey: 'TerminateSessionText'\r\n      }).show();\r\n    };\r\n\r\n    const element = this.menuElement = ButtonMenu([{\r\n      icon: 'stop',\r\n      text: 'Terminate',\r\n      onClick: onTerminateClick\r\n    }]);\r\n    element.id = 'active-sessions-contextmenu';\r\n    element.classList.add('contextmenu');\r\n\r\n    document.getElementById('page-chats').append(element);\r\n\r\n    attachContextMenuListener(this.scrollable.container, (e) => {\r\n      target = findUpClassName(e.target, 'row');\r\n      if(!target || target.dataset.hash === '0') {\r\n        return;\r\n      }\r\n\r\n      if(e instanceof MouseEvent) e.preventDefault();\r\n      // smth\r\n      if(e instanceof MouseEvent) e.cancelBubble = true;\r\n\r\n      positionMenu(e, element);\r\n      contextMenuController.openBtnMenu(element);\r\n    });\r\n\r\n    attachClickEvent(this.scrollable.container, (e) => {\r\n      target = findUpClassName(e.target, 'row');\r\n      if(!target || target.dataset.hash === '0') {\r\n        return;\r\n      }\r\n\r\n      onTerminateClick();\r\n    });\r\n  }\r\n\r\n  onCloseAfterTimeout() {\r\n    if(this.menuElement) {\r\n      this.menuElement.remove();\r\n    }\r\n\r\n    return super.onCloseAfterTimeout();\r\n  }\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport {SliderSuperTab} from '../../slider';\r\nimport {SettingSection} from '..';\r\nimport ButtonMenu from '../../buttonMenu';\r\nimport appDialogsManager, {DIALOG_LIST_ELEMENT_TAG} from '../../../lib/appManagers/appDialogsManager';\r\nimport PopupPickUser from '../../popups/pickUser';\r\nimport rootScope from '../../../lib/rootScope';\r\nimport findUpTag from '../../../helpers/dom/findUpTag';\r\nimport ButtonCorner from '../../buttonCorner';\r\nimport {attachClickEvent} from '../../../helpers/dom/clickEvent';\r\nimport formatUserPhone from '../../wrappers/formatUserPhone';\r\nimport getUserStatusString from '../../wrappers/getUserStatusString';\r\nimport {attachContextMenuListener} from '../../../helpers/dom/attachContextMenuListener';\r\nimport positionMenu from '../../../helpers/positionMenu';\r\nimport contextMenuController from '../../../helpers/contextMenuController';\r\n\r\nexport default class AppBlockedUsersTab extends SliderSuperTab {\r\n  public peerIds: PeerId[];\r\n  private menuElement: HTMLElement;\r\n\r\n  protected init() {\r\n    this.header.classList.add('with-border');\r\n    this.container.classList.add('blocked-users-container');\r\n    this.setTitle('BlockedUsers');\r\n\r\n    const section = new SettingSection({\r\n      caption: 'BlockedUsersInfo'\r\n    });\r\n\r\n    section.caption.parentElement.prepend(section.caption);\r\n\r\n    this.scrollable.append(section.container);\r\n\r\n    const btnAdd = ButtonCorner({icon: 'add', className: 'is-visible'});\r\n    this.content.append(btnAdd);\r\n\r\n    attachClickEvent(btnAdd, (e) => {\r\n      new PopupPickUser({\r\n        peerTypes: ['contacts'],\r\n        placeholder: 'BlockModal.Search.Placeholder',\r\n        onSelect: (peerId) => {\r\n          // console.log('block', peerId);\r\n          this.managers.appUsersManager.toggleBlock(peerId, true);\r\n        }\r\n      });\r\n    }, {listenerSetter: this.listenerSetter});\r\n\r\n    const list = appDialogsManager.createChatList();\r\n    this.scrollable.container.classList.add('chatlist-container');\r\n    section.content.append(list);\r\n\r\n    const add = async(peerId: PeerId, append: boolean) => {\r\n      const {dom} = appDialogsManager.addDialogNew({\r\n        peerId: peerId,\r\n        container: list,\r\n        rippleEnabled: true,\r\n        avatarSize: 48,\r\n        append\r\n      });\r\n\r\n      const user = await this.managers.appUsersManager.getUser(peerId);\r\n      if(user.pFlags.bot) {\r\n        dom.lastMessageSpan.append('@' + user.username);\r\n      } else {\r\n        if(user.phone) dom.lastMessageSpan.innerHTML = formatUserPhone(user.phone);\r\n        else dom.lastMessageSpan.append(user.username ? '@' + user.username : getUserStatusString(user));\r\n      }\r\n\r\n      // dom.titleSpan.innerHTML = 'Raaid El Syed';\r\n      // dom.lastMessageSpan.innerHTML = '+1 234 567891';\r\n    };\r\n\r\n    for(const peerId of this.peerIds) {\r\n      add(peerId, true);\r\n    }\r\n\r\n    let target: HTMLElement;\r\n    const onUnblock = () => {\r\n      const peerId = target.dataset.peerId.toPeerId();\r\n      this.managers.appUsersManager.toggleBlock(peerId, false);\r\n    };\r\n\r\n    const element = this.menuElement = ButtonMenu([{\r\n      icon: 'lockoff',\r\n      text: 'Unblock',\r\n      onClick: onUnblock,\r\n      options: {listenerSetter: this.listenerSetter}\r\n    }]);\r\n    element.id = 'blocked-users-contextmenu';\r\n    element.classList.add('contextmenu');\r\n\r\n    document.getElementById('page-chats').append(element);\r\n\r\n    attachContextMenuListener(this.scrollable.container, (e) => {\r\n      target = findUpTag(e.target, DIALOG_LIST_ELEMENT_TAG);\r\n      if(!target) {\r\n        return;\r\n      }\r\n\r\n      if(e instanceof MouseEvent) e.preventDefault();\r\n      // smth\r\n      if(e instanceof MouseEvent) e.cancelBubble = true;\r\n\r\n      positionMenu(e, element);\r\n      contextMenuController.openBtnMenu(element);\r\n    }, this.listenerSetter);\r\n\r\n    this.listenerSetter.add(rootScope)('peer_block', (update) => {\r\n      const {peerId, blocked} = update;\r\n      const li = list.querySelector(`[data-peer-id=\"${peerId}\"]`);\r\n      if(blocked) {\r\n        if(!li) {\r\n          add(peerId, false);\r\n        }\r\n      } else {\r\n        if(li) {\r\n          li.remove();\r\n        }\r\n      }\r\n    });\r\n\r\n    const LOAD_COUNT = 50;\r\n    let loading = false;\r\n    this.scrollable.onScrolledBottom = () => {\r\n      if(loading) {\r\n        return;\r\n      }\r\n\r\n      loading = true;\r\n      this.managers.appUsersManager.getBlocked(list.childElementCount, LOAD_COUNT).then((res) => {\r\n        for(const peerId of res.peerIds) {\r\n          add(peerId, true);\r\n        }\r\n\r\n        if(res.peerIds.length < LOAD_COUNT || list.childElementCount === res.count) {\r\n          this.scrollable.onScrolledBottom = null;\r\n        }\r\n\r\n        this.scrollable.checkForTriggers();\r\n      }).finally(() => {\r\n        loading = false;\r\n      });\r\n    };\r\n  }\r\n\r\n  onOpenAfterTimeout() {\r\n    this.scrollable.onScroll();\r\n  }\r\n\r\n  onCloseAfterTimeout() {\r\n    if(this.menuElement) {\r\n      this.menuElement.remove();\r\n    }\r\n\r\n    return super.onCloseAfterTimeout();\r\n  }\r\n}\r\n","export default function convertKeyToInputKey(key: string) {\n  key = key[0].toUpperCase() + key.slice(1);\n  key = 'input' + key;\n  return key;\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport {SliderSuperTabEventable} from '../../../sliderTab';\nimport PrivacySection from '../../../privacySection';\nimport {LangPackKey} from '../../../../lib/langPack';\n\nexport default class AppPrivacyVoicesTab extends SliderSuperTabEventable {\n  protected init() {\n    this.header.classList.add('with-border');\n    this.container.classList.add('privacy-tab', 'privacy-voices');\n    this.setTitle('PrivacyVoiceMessages');\n\n    const caption: LangPackKey = 'PrivacyVoiceMessagesInfo';\n    new PrivacySection({\n      tab: this,\n      title: 'PrivacyVoiceMessagesTitle',\n      inputKey: 'inputPrivacyKeyVoiceMessages',\n      captions: [caption, caption, caption],\n      exceptionTexts: ['PrivacySettingsController.NeverAllow', 'PrivacySettingsController.AlwaysAllow'],\n      appendTo: this.scrollable,\n      managers: this.managers\n    });\n  }\n}\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport {SliderSuperTabEventable} from '../../sliderTab';\r\nimport {SettingSection} from '..';\r\nimport Row from '../../row';\r\nimport {AccountPassword, Authorization, InputPrivacyKey, Updates} from '../../../layer';\r\nimport AppPrivacyPhoneNumberTab from './privacy/phoneNumber';\r\nimport AppTwoStepVerificationTab from './2fa';\r\nimport AppTwoStepVerificationEnterPasswordTab from './2fa/enterPassword';\r\nimport AppTwoStepVerificationEmailConfirmationTab from './2fa/emailConfirmation';\r\nimport AppPrivacyLastSeenTab from './privacy/lastSeen';\r\nimport AppPrivacyProfilePhotoTab from './privacy/profilePhoto';\r\nimport AppPrivacyForwardMessagesTab from './privacy/forwardMessages';\r\nimport AppPrivacyAddToGroupsTab from './privacy/addToGroups';\r\nimport AppPrivacyCallsTab from './privacy/calls';\r\nimport AppActiveSessionsTab from './activeSessions';\r\nimport AppBlockedUsersTab from './blockedUsers';\r\nimport rootScope from '../../../lib/rootScope';\r\nimport {i18n, LangPackKey, _i18n} from '../../../lib/langPack';\r\nimport replaceContent from '../../../helpers/dom/replaceContent';\r\nimport CheckboxField from '../../checkboxField';\r\nimport PopupPeer from '../../popups/peer';\r\nimport Button from '../../button';\r\nimport toggleDisability from '../../../helpers/dom/toggleDisability';\r\nimport convertKeyToInputKey from '../../../helpers/string/convertKeyToInputKey';\r\nimport getPrivacyRulesDetails from '../../../lib/appManagers/utils/privacy/getPrivacyRulesDetails';\r\nimport PrivacyType from '../../../lib/appManagers/utils/privacy/privacyType';\r\nimport confirmationPopup, {PopupConfirmationOptions} from '../../confirmationPopup';\r\nimport noop from '../../../helpers/noop';\r\nimport {toastNew} from '../../toast';\r\nimport AppPrivacyVoicesTab from './privacy/voices';\r\n\r\nexport default class AppPrivacyAndSecurityTab extends SliderSuperTabEventable {\r\n  private activeSessionsRow: Row;\r\n  private authorizations: Authorization.authorization[];\r\n\r\n  protected init() {\r\n    this.header.classList.add('with-border');\r\n    this.container.classList.add('dont-u-dare-block-me');\r\n    this.setTitle('PrivacySettings');\r\n\r\n    const SUBTITLE: LangPackKey = 'Loading';\r\n\r\n    {\r\n      const section = new SettingSection({noDelimiter: true, caption: 'SessionsInfo'});\r\n\r\n      let blockedPeerIds: PeerId[];\r\n      const blockedUsersRow = new Row({\r\n        icon: 'deleteuser',\r\n        titleLangKey: 'BlockedUsers',\r\n        subtitleLangKey: SUBTITLE,\r\n        clickable: () => {\r\n          const tab = this.slider.createTab(AppBlockedUsersTab);\r\n          tab.peerIds = blockedPeerIds;\r\n          tab.open();\r\n        },\r\n        listenerSetter: this.listenerSetter\r\n      });\r\n      blockedUsersRow.freezed = true;\r\n\r\n      let passwordState: AccountPassword;\r\n      const twoFactorRowOptions = {\r\n        icon: 'lock',\r\n        titleLangKey: 'TwoStepVerification' as LangPackKey,\r\n        subtitleLangKey: SUBTITLE,\r\n        clickable: (e: Event) => {\r\n          let tab: AppTwoStepVerificationTab | AppTwoStepVerificationEnterPasswordTab | AppTwoStepVerificationEmailConfirmationTab;\r\n          if(passwordState.pFlags.has_password) {\r\n            tab = this.slider.createTab(AppTwoStepVerificationEnterPasswordTab);\r\n          } else if(passwordState.email_unconfirmed_pattern) {\r\n            tab = this.slider.createTab(AppTwoStepVerificationEmailConfirmationTab);\r\n            tab.email = passwordState.email_unconfirmed_pattern;\r\n            tab.length = 6;\r\n            tab.isFirst = true;\r\n            this.managers.passwordManager.resendPasswordEmail();\r\n          } else {\r\n            tab = this.slider.createTab(AppTwoStepVerificationTab);\r\n          }\r\n\r\n          tab.state = passwordState;\r\n          tab.open();\r\n        },\r\n        listenerSetter: this.listenerSetter\r\n      };\r\n\r\n      const twoFactorRow = new Row(twoFactorRowOptions);\r\n      twoFactorRow.freezed = true;\r\n\r\n      const activeSessionsRow = this.activeSessionsRow = new Row({\r\n        icon: 'activesessions',\r\n        titleLangKey: 'SessionsTitle',\r\n        subtitleLangKey: SUBTITLE,\r\n        clickable: () => {\r\n          const tab = this.slider.createTab(AppActiveSessionsTab);\r\n          tab.authorizations = this.authorizations;\r\n          tab.eventListener.addEventListener('destroy', () => {\r\n            this.updateActiveSessions();\r\n          }, {once: true});\r\n          tab.open();\r\n        },\r\n        listenerSetter: this.listenerSetter\r\n      });\r\n      activeSessionsRow.freezed = true;\r\n\r\n      section.content.append(blockedUsersRow.container, twoFactorRow.container, activeSessionsRow.container);\r\n      this.scrollable.append(section.container);\r\n\r\n      const setBlockedCount = (count: number) => {\r\n        if(count) {\r\n          replaceContent(blockedUsersRow.subtitle, i18n('PrivacySettingsController.UserCount', [count]));\r\n        } else {\r\n          replaceContent(blockedUsersRow.subtitle, i18n('BlockedEmpty', [count]));\r\n        }\r\n      };\r\n\r\n      this.listenerSetter.add(rootScope)('peer_block', () => {\r\n        /* const {blocked, peerId} = update;\r\n        if(!blocked) blockedPeerIds.findAndSplice((p) => p === peerId);\r\n        else blockedPeerIds.unshift(peerId);\r\n        blockedCount += blocked ? 1 : -1;\r\n        setBlockedCount(blockedCount); */\r\n        updateBlocked();\r\n      });\r\n\r\n      const updateBlocked = () => {\r\n        this.managers.appUsersManager.getBlocked().then((res) => {\r\n          blockedUsersRow.freezed = false;\r\n          setBlockedCount(res.count);\r\n          blockedPeerIds = res.peerIds;\r\n        });\r\n      };\r\n\r\n      updateBlocked();\r\n\r\n      this.managers.passwordManager.getState().then((state) => {\r\n        passwordState = state;\r\n        replaceContent(twoFactorRow.subtitle, i18n(state.pFlags.has_password ? 'PrivacyAndSecurity.Item.On' : 'PrivacyAndSecurity.Item.Off'));\r\n        twoFactorRow.freezed = false;\r\n\r\n        // console.log('password state', state);\r\n      });\r\n\r\n      this.updateActiveSessions();\r\n    }\r\n\r\n    {\r\n      const section = new SettingSection({name: 'PrivacyTitle', caption: 'GroupsAndChannelsHelp'});\r\n\r\n      section.content.classList.add('privacy-navigation-container');\r\n\r\n      const rowsByKeys: Partial<{\r\n        [key in InputPrivacyKey['_']]: Row\r\n      }> = {};\r\n\r\n      const numberVisibilityRow = rowsByKeys['inputPrivacyKeyPhoneNumber'] = new Row({\r\n        titleLangKey: 'PrivacyPhoneTitle',\r\n        subtitleLangKey: SUBTITLE,\r\n        clickable: () => {\r\n          this.slider.createTab(AppPrivacyPhoneNumberTab).open();\r\n        },\r\n        listenerSetter: this.listenerSetter\r\n      });\r\n\r\n      const lastSeenTimeRow = rowsByKeys['inputPrivacyKeyStatusTimestamp'] = new Row({\r\n        titleLangKey: 'LastSeenTitle',\r\n        subtitleLangKey: SUBTITLE,\r\n        clickable: () => {\r\n          this.slider.createTab(AppPrivacyLastSeenTab).open();\r\n        },\r\n        listenerSetter: this.listenerSetter\r\n      });\r\n\r\n      const photoVisibilityRow = rowsByKeys['inputPrivacyKeyProfilePhoto'] = new Row({\r\n        titleLangKey: 'PrivacyProfilePhotoTitle',\r\n        subtitleLangKey: SUBTITLE,\r\n        clickable: () => {\r\n          this.slider.createTab(AppPrivacyProfilePhotoTab).open();\r\n        },\r\n        listenerSetter: this.listenerSetter\r\n      });\r\n\r\n      const callRow = rowsByKeys['inputPrivacyKeyPhoneCall'] = new Row({\r\n        titleLangKey: 'WhoCanCallMe',\r\n        subtitleLangKey: SUBTITLE,\r\n        clickable: () => {\r\n          this.slider.createTab(AppPrivacyCallsTab).open();\r\n        },\r\n        listenerSetter: this.listenerSetter\r\n      });\r\n\r\n      const linkAccountRow = rowsByKeys['inputPrivacyKeyForwards'] = new Row({\r\n        titleLangKey: 'PrivacyForwardsTitle',\r\n        subtitleLangKey: SUBTITLE,\r\n        clickable: () => {\r\n          this.slider.createTab(AppPrivacyForwardMessagesTab).open();\r\n        },\r\n        listenerSetter: this.listenerSetter\r\n      });\r\n\r\n      const groupChatsAddRow = rowsByKeys['inputPrivacyKeyChatInvite'] = new Row({\r\n        titleLangKey: 'WhoCanAddMe',\r\n        subtitleLangKey: SUBTITLE,\r\n        clickable: () => {\r\n          this.slider.createTab(AppPrivacyAddToGroupsTab).open();\r\n        },\r\n        listenerSetter: this.listenerSetter\r\n      });\r\n\r\n      const voicesRow = rowsByKeys['inputPrivacyKeyVoiceMessages'] = new Row({\r\n        titleLangKey: 'PrivacyVoiceMessagesTitle',\r\n        subtitleLangKey: SUBTITLE,\r\n        clickable: () => {\r\n          if(!rootScope.premium) {\r\n            toastNew({langPackKey: 'PrivacyVoiceMessagesPremiumOnly'});\r\n          } else {\r\n            this.slider.createTab(AppPrivacyVoicesTab).open();\r\n          }\r\n        },\r\n        listenerSetter: this.listenerSetter\r\n      });\r\n\r\n      const updatePrivacyRow = (key: InputPrivacyKey['_']) => {\r\n        const row = rowsByKeys[key];\r\n        if(!row) {\r\n          return;\r\n        }\r\n\r\n        this.managers.appPrivacyManager.getPrivacy(key).then((rules) => {\r\n          const details = getPrivacyRulesDetails(rules);\r\n          const langKey = details.type === PrivacyType.Everybody ? 'PrivacySettingsController.Everbody' : (details.type === PrivacyType.Contacts ? 'PrivacySettingsController.MyContacts' : 'PrivacySettingsController.Nobody');\r\n          const disallowLength = details.disallowPeers.users.length + details.disallowPeers.chats.length;\r\n          const allowLength = details.allowPeers.users.length + details.allowPeers.chats.length;\r\n\r\n          row.subtitle.innerHTML = '';\r\n          const s = i18n(langKey);\r\n          row.subtitle.append(s);\r\n          if(disallowLength || allowLength) {\r\n            row.subtitle.append(` (${[-disallowLength, allowLength ? '+' + allowLength : 0].filter(Boolean).join(', ')})`);\r\n          }\r\n        });\r\n      };\r\n\r\n      section.content.append(\r\n        numberVisibilityRow.container,\r\n        lastSeenTimeRow.container,\r\n        photoVisibilityRow.container,\r\n        callRow.container,\r\n        linkAccountRow.container,\r\n        groupChatsAddRow.container,\r\n        voicesRow.container\r\n      );\r\n      this.scrollable.append(section.container);\r\n\r\n      for(const key in rowsByKeys) {\r\n        updatePrivacyRow(key as keyof typeof rowsByKeys);\r\n      }\r\n\r\n      rootScope.addEventListener('privacy_update', (update) => {\r\n        updatePrivacyRow(convertKeyToInputKey(update.key._) as any);\r\n      });\r\n    }\r\n\r\n    const promises: Promise<any>[] = [];\r\n\r\n    {\r\n      const section = new SettingSection({name: 'NewChatsFromNonContacts', caption: 'ArchiveAndMuteInfo'});\r\n\r\n      const checkboxField = new CheckboxField({text: 'ArchiveAndMute'});\r\n      const row = new Row({\r\n        checkboxField,\r\n        noCheckboxSubtitle: true\r\n      });\r\n\r\n      section.content.append(row.container);\r\n\r\n      let enabled: boolean, destroyed: boolean;\r\n      this.eventListener.addEventListener('destroy', () => {\r\n        destroyed = true;\r\n        if(enabled === undefined) return;\r\n        this.managers.appPrivacyManager.setGlobalPrivacySettings({\r\n          _: 'globalPrivacySettings',\r\n          archive_and_mute_new_noncontact_peers: checkboxField.checked\r\n        });\r\n      }, {once: true});\r\n\r\n      const promise = Promise.all([\r\n        this.managers.apiManager.getAppConfig(),\r\n        this.managers.appPrivacyManager.getGlobalPrivacySettings()\r\n      ]).then(([appConfig, settings]) => {\r\n        if(destroyed) {\r\n          return;\r\n        }\r\n\r\n        const onPremiumToggle = (isPremium: boolean) => {\r\n          section.container.classList.toggle('hide', !isPremium && !appConfig.autoarchive_setting_available);\r\n        };\r\n\r\n        this.listenerSetter.add(rootScope)('premium_toggle', onPremiumToggle);\r\n        onPremiumToggle(rootScope.premium);\r\n\r\n        enabled = settings.archive_and_mute_new_noncontact_peers;\r\n\r\n        checkboxField.setValueSilently(enabled);\r\n      });\r\n\r\n      promises.push(promise);\r\n\r\n      this.scrollable.append(section.container);\r\n    }\r\n\r\n    {\r\n      const section = new SettingSection({name: 'Privacy.SensitiveContent', caption: 'PrivacyAndSecurity.SensitiveDesc'});\r\n      section.container.classList.add('hide');\r\n\r\n      const checkboxField = new CheckboxField({text: 'PrivacyAndSecurity.SensitiveText'});\r\n      const row = new Row({\r\n        checkboxField,\r\n        noCheckboxSubtitle: true\r\n      });\r\n\r\n      section.content.append(row.container);\r\n\r\n      let enabled: boolean;\r\n      this.eventListener.addEventListener('destroy', () => {\r\n        if(enabled === undefined) return;\r\n        const _enabled = row.checkboxField.checked;\r\n        const isChanged = _enabled !== enabled;\r\n        if(!isChanged) {\r\n          return;\r\n        }\r\n\r\n        this.managers.apiManager.invokeApi('account.setContentSettings', {\r\n          sensitive_enabled: _enabled\r\n        });\r\n      }, {once: true});\r\n\r\n      const promise = this.managers.apiManager.invokeApi('account.getContentSettings').then((settings) => {\r\n        if(!settings.pFlags.sensitive_can_change) {\r\n          return;\r\n        }\r\n\r\n        enabled = !!settings.pFlags.sensitive_enabled;\r\n        checkboxField.setValueSilently(enabled);\r\n        section.container.classList.remove('hide');\r\n      });\r\n\r\n      promises.push(promise);\r\n\r\n      this.scrollable.append(section.container);\r\n    }\r\n\r\n    {\r\n      const section = new SettingSection({name: 'PrivacyPayments', caption: 'PrivacyPaymentsClearInfo'});\r\n\r\n      const onClearClick = () => {\r\n        const options: PopupConfirmationOptions = {\r\n          titleLangKey: 'PrivacyPaymentsClearAlertTitle',\r\n          descriptionLangKey: 'PrivacyPaymentsClearAlertText',\r\n          button: {\r\n            langKey: 'Clear'\r\n          },\r\n          checkboxes: [{\r\n            text: 'PrivacyClearShipping',\r\n            checked: true\r\n          }, {\r\n            text: 'PrivacyClearPayment',\r\n            checked: true\r\n          }]\r\n        };\r\n\r\n        confirmationPopup(options).then(() => {\r\n          const [info, payment] = options.checkboxes.map((c) => c.checkboxField.checked);\r\n          const toggle = toggleDisability([clearButton], true);\r\n          this.managers.appPaymentsManager.clearSavedInfo(info, payment).then(() => {\r\n            if(!info && !payment) {\r\n              return;\r\n            }\r\n\r\n            toggle();\r\n            toastNew({\r\n              langPackKey: info && payment ? 'PrivacyPaymentsPaymentShippingCleared' : (info ? 'PrivacyPaymentsShippingInfoCleared' : 'PrivacyPaymentsPaymentInfoCleared')\r\n            });\r\n          });\r\n        }, noop);\r\n      };\r\n\r\n      const clearButton = Button('btn-primary btn-transparent', {icon: 'delete', text: 'PrivacyPaymentsClear'});\r\n      this.listenerSetter.add(clearButton)('click', onClearClick);\r\n      section.content.append(clearButton);\r\n\r\n      this.scrollable.append(section.container);\r\n    }\r\n\r\n    {\r\n      const section = new SettingSection({name: 'FilterChats'});\r\n\r\n      const onDeleteClick = () => {\r\n        const popup = new PopupPeer('popup-delete-drafts', {\r\n          buttons: [{\r\n            langKey: 'Delete',\r\n            callback: () => {\r\n              const toggle = toggleDisability([deleteButton], true);\r\n              this.managers.appDraftsManager.clearAllDrafts().then(() => {\r\n                toggle();\r\n              });\r\n            },\r\n            isDanger: true\r\n          }],\r\n          titleLangKey: 'AreYouSureClearDraftsTitle',\r\n          descriptionLangKey: 'AreYouSureClearDrafts'\r\n        });\r\n\r\n        popup.show();\r\n      };\r\n\r\n      const deleteButton = Button('btn-primary btn-transparent', {icon: 'delete', text: 'PrivacyDeleteCloudDrafts'});\r\n      this.listenerSetter.add(deleteButton)('click', onDeleteClick);\r\n      section.content.append(deleteButton);\r\n\r\n      /* promises.push(apiManager.invokeApi('messages.getAllDrafts').then((drafts) => {\r\n        const draftsRow = new Row({\r\n          titleLangKey: 'PrivacyDeleteCloudDrafts',\r\n          subtitleLangKey: 'Drafts',\r\n          subtitleLangArgs: [(drafts as Updates.updates).updates.length],\r\n          icon: 'delete',\r\n          clickable: onDeleteClick\r\n        });\r\n\r\n        section.content.append(draftsRow.container);\r\n      })); */\r\n\r\n      this.scrollable.append(section.container);\r\n    }\r\n\r\n    return Promise.all(promises);\r\n  }\r\n\r\n  public updateActiveSessions() {\r\n    this.managers.apiManager.invokeApi('account.getAuthorizations').then((auths) => {\r\n      this.activeSessionsRow.freezed = false;\r\n      this.authorizations = auths.authorizations;\r\n      _i18n(this.activeSessionsRow.subtitle, 'Privacy.Devices', [this.authorizations.length]);\r\n      // console.log('auths', auths);\r\n    });\r\n  }\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport renderImageFromUrl from './dom/renderImageFromUrl';\r\n\r\nexport function averageColorFromCanvas(canvas: HTMLCanvasElement) {\r\n  const context = canvas.getContext('2d');\r\n\r\n  const pixel = new Array(4).fill(0);\r\n  const pixels = context.getImageData(0, 0, canvas.width, canvas.height).data;\r\n  const pixelsLength = pixels.length / 4;\r\n  for(let i = 0; i < pixels.length; i += 4) {\r\n    // const alphaPixel = pixels[i + 3];\r\n    pixel[0] += pixels[i]/*  * (alphaPixel / 255) */;\r\n    pixel[1] += pixels[i + 1]/*  * (alphaPixel / 255) */;\r\n    pixel[2] += pixels[i + 2]/*  * (alphaPixel / 255) */;\r\n    pixel[3] += pixels[i + 3];\r\n  }\r\n\r\n  const outPixel = new Uint8ClampedArray(4);\r\n  outPixel[0] = pixel[0] / pixelsLength;\r\n  outPixel[1] = pixel[1] / pixelsLength;\r\n  outPixel[2] = pixel[2] / pixelsLength;\r\n  outPixel[3] = pixel[3] / pixelsLength;\r\n  // outPixel[3] = 255;\r\n  return outPixel;\r\n}\r\n\r\nexport function averageColorFromImageSource(imageSource: CanvasImageSource, width: number, height: number) {\r\n  const canvas = document.createElement('canvas');\r\n  const ratio = width / height;\r\n  const DIMENSIONS = 50;\r\n  if(ratio === 1) {\r\n    canvas.width = DIMENSIONS;\r\n    canvas.height = canvas.width / ratio;\r\n  } else if(ratio > 1) {\r\n    canvas.height = DIMENSIONS;\r\n    canvas.width = canvas.height / ratio;\r\n  } else {\r\n    canvas.width = canvas.height = DIMENSIONS;\r\n  }\r\n\r\n  const context = canvas.getContext('2d');\r\n  context.drawImage(imageSource, 0, 0, width, height, 0, 0, canvas.width, canvas.height);\r\n  return averageColorFromCanvas(canvas);\r\n}\r\n\r\nexport function averageColor(imageUrl: string) {\r\n  const img = document.createElement('img');\r\n  return new Promise<Uint8ClampedArray>((resolve) => {\r\n    renderImageFromUrl(img, imageUrl, () => {\r\n      resolve(averageColorFromImageSource(img, img.naturalWidth, img.naturalHeight));\r\n    });\r\n  });\r\n};\r\n","import {rgbaToHsla} from './color';\r\n\r\n// * https://github.com/TelegramMessenger/Telegram-iOS/blob/3d062fff78cc6b287c74e6171f855a3500c0156d/submodules/TelegramPresentationData/Sources/PresentationData.swift#L453\r\nexport default function highlightningColor(rgba: [number, number, number, number?]) {\r\n  let {h, s, l} = rgbaToHsla(rgba[0], rgba[1], rgba[2]);\r\n  if(s > 0) {\r\n    s = Math.min(100, s + 5 + 0.1 * (100 - s));\r\n  }\r\n  l = Math.max(0, l * .65);\r\n\r\n  const hsla = `hsla(${h}, ${s}%, ${l}%, .4)`;\r\n  return hsla;\r\n}\r\n","import {ColorHsla, ColorRgba, hexaToHsla, hslaToRgba, rgbaToHexa as rgbaToHexa, rgbaToHsla} from '../helpers/color';\r\nimport attachGrabListeners from '../helpers/dom/attachGrabListeners';\r\nimport clamp from '../helpers/number/clamp';\r\nimport InputField, {InputState} from './inputField';\r\n\r\nexport type ColorPickerColor = {\r\n  hsl: string;\r\n  rgb: string;\r\n  hex: string;\r\n  hsla: string;\r\n  rgba: string;\r\n  hexa: string;\r\n  rgbaArray: ColorRgba;\r\n};\r\n\r\nexport default class ColorPicker {\r\n  private static BASE_CLASS = 'color-picker';\r\n  public container: HTMLElement;\r\n\r\n  private boxRect: DOMRect;\r\n  // private boxDraggerRect: DOMRect;\r\n  private hueRect: DOMRect;\r\n  // private hueDraggerRect: DOMRect;\r\n\r\n  private hue = 0;\r\n  private saturation = 100;\r\n  private lightness = 50;\r\n  private alpha = 1;\r\n  private elements: {\r\n    box: SVGSVGElement,\r\n    boxDragger: SVGSVGElement,\r\n    sliders: HTMLElement,\r\n    hue: SVGSVGElement,\r\n    hueDragger: SVGSVGElement,\r\n    saturation: SVGLinearGradientElement,\r\n  } = {} as any;\r\n  private hexInputField: InputField;\r\n  private rgbInputField: InputField;\r\n  public onChange: (color: ReturnType<ColorPicker['getCurrentColor']>) => void;\r\n\r\n  constructor() {\r\n    this.container = document.createElement('div');\r\n    this.container.classList.add(ColorPicker.BASE_CLASS);\r\n\r\n    const html = `\r\n      <svg class=\"${ColorPicker.BASE_CLASS + '-box'}\" viewBox=\"0 0 380 198\">\r\n        <defs>\r\n          <linearGradient id=\"color-picker-saturation\" x1=\"0%\" y1=\"0%\" x2=\"100%\" y2=\"0%\">\r\n            <stop offset=\"0%\" stop-color=\"#fff\"></stop>\r\n            <stop offset=\"100%\" stop-color=\"hsl(0,100%,50%)\"></stop>\r\n          </linearGradient>\r\n          <linearGradient id=\"color-picker-brightness\" x1=\"0%\" y1=\"0%\" x2=\"0%\" y2=\"100%\">\r\n            <stop offset=\"0%\" stop-color=\"rgba(0,0,0,0)\"></stop>\r\n            <stop offset=\"100%\" stop-color=\"#000\"></stop>\r\n          </linearGradient>\r\n          <pattern id=\"color-picker-pattern\" width=\"100%\" height=\"100%\">\r\n            <rect x=\"0\" y=\"0\" width=\"100%\" height=\"100%\" fill=\"url(#color-picker-saturation)\"></rect>\r\n            <rect x=\"0\" y=\"0\" width=\"100%\" height=\"100%\" fill=\"url(#color-picker-brightness)\"></rect>\r\n          </pattern>\r\n        </defs>\r\n        <rect rx=\"10\" ry=\"10\" x=\"0\" y=\"0\" width=\"380\" height=\"198\" fill=\"url(#color-picker-pattern)\"></rect>\r\n        <svg class=\"${ColorPicker.BASE_CLASS + '-dragger'} ${ColorPicker.BASE_CLASS + '-box-dragger'}\" x=\"0\" y=\"0\">\r\n          <circle r=\"11\" fill=\"inherit\" stroke=\"#fff\" stroke-width=\"2\"></circle>\r\n        </svg>\r\n      </svg>\r\n      <div class=\"${ColorPicker.BASE_CLASS + '-sliders'}\">\r\n        <svg class=\"${ColorPicker.BASE_CLASS + '-color-slider'}\" viewBox=\"0 0 380 24\">\r\n          <defs>\r\n            <linearGradient id=\"hue\" x1=\"100%\" y1=\"0%\" x2=\"0%\" y2=\"0%\">\r\n              <stop offset=\"0%\" stop-color=\"#f00\"></stop>\r\n              <stop offset=\"16.666%\" stop-color=\"#f0f\"></stop>\r\n              <stop offset=\"33.333%\" stop-color=\"#00f\"></stop>\r\n              <stop offset=\"50%\" stop-color=\"#0ff\"></stop>\r\n              <stop offset=\"66.666%\" stop-color=\"#0f0\"></stop>\r\n              <stop offset=\"83.333%\" stop-color=\"#ff0\"></stop>\r\n              <stop offset=\"100%\" stop-color=\"#f00\"></stop>\r\n            </linearGradient>\r\n          </defs>\r\n          <rect rx=\"4\" ry=\"4\" x=\"0\" y=\"9\" width=\"380\" height=\"8\" fill=\"url(#hue)\"></rect>\r\n          <svg class=\"${ColorPicker.BASE_CLASS + '-dragger'} ${ColorPicker.BASE_CLASS + '-color-slider-dragger'}\" x=\"0\" y=\"13\">\r\n            <circle r=\"11\" fill=\"inherit\" stroke=\"#fff\" stroke-width=\"2\"></circle>\r\n          </svg>\r\n        </svg>\r\n      </div>\r\n    `;\r\n\r\n    this.container.innerHTML = html;\r\n\r\n    this.elements.box = this.container.firstElementChild as any;\r\n    this.elements.boxDragger = this.elements.box.lastElementChild as any;\r\n    this.elements.saturation = this.elements.box.firstElementChild.firstElementChild as any;\r\n\r\n    this.elements.sliders = this.elements.box.nextElementSibling as any;\r\n\r\n    this.elements.hue = this.elements.sliders.firstElementChild as any;\r\n    this.elements.hueDragger = this.elements.hue.lastElementChild as any;\r\n\r\n    this.hexInputField = new InputField({plainText: true, label: 'Appearance.Color.Hex'});\r\n    this.rgbInputField = new InputField({plainText: true, label: 'Appearance.Color.RGB'});\r\n\r\n    const inputs = document.createElement('div');\r\n    inputs.className = ColorPicker.BASE_CLASS + '-inputs';\r\n    inputs.append(this.hexInputField.container, this.rgbInputField.container);\r\n    this.container.append(inputs);\r\n\r\n    this.hexInputField.input.addEventListener('input', () => {\r\n      let value = this.hexInputField.value.replace(/#/g, '').slice(0, 6);\r\n\r\n      const match = value.match(/([a-fA-F\\d]+)/);\r\n      const valid = match && match[0].length === value.length && [/* 3, 4,  */6].includes(value.length);\r\n      this.hexInputField.setState(valid ? InputState.Neutral : InputState.Error);\r\n\r\n      value = '#' + value;\r\n      this.hexInputField.setValueSilently(value);\r\n\r\n      if(valid) {\r\n        this.setColor(value, false, true);\r\n      }\r\n    });\r\n\r\n    // patched https://stackoverflow.com/a/34029238/6758968\r\n    const rgbRegExp = /^(?:rgb)?\\(?([01]?\\d\\d?|2[0-4]\\d|25[0-5])(?:\\W+)([01]?\\d\\d?|2[0-4]\\d|25[0-5])\\W+(?:([01]?\\d\\d?|2[0-4]\\d|25[0-5])\\)?)$/;\r\n    this.rgbInputField.input.addEventListener('input', () => {\r\n      const match = this.rgbInputField.value.match(rgbRegExp);\r\n      this.rgbInputField.setState(match ? InputState.Neutral : InputState.Error);\r\n\r\n      if(match) {\r\n        this.setColor(rgbaToHsla(+match[1], +match[2], +match[3]), true, false);\r\n      }\r\n    });\r\n\r\n    this.attachBoxListeners();\r\n    this.attachHueListeners();\r\n  }\r\n\r\n  private onGrabStart = () => {\r\n    document.documentElement.style.cursor = this.elements.boxDragger.style.cursor = 'grabbing';\r\n  };\r\n\r\n  private onGrabEnd = () => {\r\n    document.documentElement.style.cursor = this.elements.boxDragger.style.cursor = '';\r\n  };\r\n\r\n  private attachBoxListeners() {\r\n    attachGrabListeners(this.elements.box as any, () => {\r\n      this.onGrabStart();\r\n      this.boxRect = this.elements.box.getBoundingClientRect();\r\n      // this.boxDraggerRect = this.elements.boxDragger.getBoundingClientRect();\r\n    }, (pos) => {\r\n      this.saturationHandler(pos.x, pos.y);\r\n    }, () => {\r\n      this.onGrabEnd();\r\n    });\r\n  }\r\n\r\n  private attachHueListeners() {\r\n    attachGrabListeners(this.elements.hue as any, () => {\r\n      this.onGrabStart();\r\n      this.hueRect = this.elements.hue.getBoundingClientRect();\r\n      // this.hueDraggerRect = this.elements.hueDragger.getBoundingClientRect();\r\n    }, (pos) => {\r\n      this.hueHandler(pos.x);\r\n    }, () => {\r\n      this.onGrabEnd();\r\n    });\r\n  }\r\n\r\n  public setColor(color: ColorHsla | string, updateHexInput = true, updateRgbInput = true) {\r\n    if(color === undefined) { // * set to red\r\n      color = {\r\n        h: 0,\r\n        s: 100,\r\n        l: 50,\r\n        a: 1\r\n      };\r\n    } else if(typeof(color) === 'string') {\r\n      if(color[0] === '#') {\r\n        color = hexaToHsla(color);\r\n      } else {\r\n        const rgb = color.match(/[.?\\d]+/g);\r\n        color = rgbaToHsla(+rgb[0], +rgb[1], +rgb[2], rgb[3] === undefined ? 1 : +rgb[3]);\r\n      }\r\n    }\r\n\r\n    // Set box\r\n    this.boxRect = this.elements.box.getBoundingClientRect();\r\n\r\n    const boxX = this.boxRect.width / 100 * color.s;\r\n    const percentY = 100 - (color.l / (100 - color.s / 2)) * 100;\r\n    const boxY = this.boxRect.height / 100 * percentY;\r\n\r\n    this.saturationHandler(this.boxRect.left + boxX, this.boxRect.top + boxY, false);\r\n\r\n    // Set hue\r\n    this.hueRect = this.elements.hue.getBoundingClientRect();\r\n\r\n    const percentHue = color.h / 360;\r\n    const hueX = this.hueRect.left + this.hueRect.width * percentHue;\r\n\r\n    this.hueHandler(hueX, false);\r\n\r\n    // Set values\r\n    this.hue = color.h;\r\n    this.saturation = color.s;\r\n    this.lightness = color.l;\r\n    this.alpha = color.a;\r\n\r\n    this.updatePicker(updateHexInput, updateRgbInput);\r\n  };\r\n\r\n  public getCurrentColor(): ColorPickerColor {\r\n    const rgbaArray = hslaToRgba(this.hue, this.saturation, this.lightness, this.alpha);\r\n    const hexa = rgbaToHexa(rgbaArray);\r\n    const hex = hexa.slice(0, -2);\r\n\r\n    return {\r\n      hsl: `hsl(${this.hue}, ${this.saturation}%, ${this.lightness}%)`,\r\n      rgb: `rgb(${rgbaArray[0]}, ${rgbaArray[1]}, ${rgbaArray[2]})`,\r\n      hex: hex,\r\n      hsla: `hsla(${this.hue}, ${this.saturation}%, ${this.lightness}%, ${this.alpha})`,\r\n      rgba: `rgba(${rgbaArray[0]}, ${rgbaArray[1]}, ${rgbaArray[2]}, ${rgbaArray[3]})`,\r\n      hexa: hexa,\r\n      rgbaArray: rgbaArray\r\n    };\r\n  }\r\n\r\n  public updatePicker(updateHexInput = true, updateRgbInput = true) {\r\n    const color = this.getCurrentColor();\r\n    this.elements.boxDragger.setAttributeNS(null, 'fill', color.hex);\r\n\r\n    if(updateHexInput) {\r\n      this.hexInputField.setValueSilently(color.hex);\r\n      this.hexInputField.setState(InputState.Neutral);\r\n    }\r\n\r\n    if(updateRgbInput) {\r\n      this.rgbInputField.setValueSilently(color.rgbaArray.slice(0, -1).join(', '));\r\n      this.rgbInputField.setState(InputState.Neutral);\r\n    }\r\n\r\n    if(this.onChange) {\r\n      this.onChange(color);\r\n    }\r\n  }\r\n\r\n  private hueHandler(pageX: number, update = true) {\r\n    const eventX = clamp(pageX - this.hueRect.left, 0, this.hueRect.width);\r\n\r\n    const percents = eventX / this.hueRect.width;\r\n    this.hue = Math.round(360 * percents);\r\n\r\n    const hsla = `hsla(${this.hue}, 100%, 50%, ${this.alpha})`;\r\n\r\n    this.elements.hueDragger.setAttributeNS(null, 'x', (percents * 100) + '%');\r\n    this.elements.hueDragger.setAttributeNS(null, 'fill', hsla);\r\n\r\n    this.elements.saturation.lastElementChild.setAttributeNS(null, 'stop-color', hsla);\r\n\r\n    if(update) {\r\n      this.updatePicker();\r\n    }\r\n  }\r\n\r\n  private saturationHandler(pageX: number, pageY: number, update = true) {\r\n    const maxX = this.boxRect.width;\r\n    const maxY = this.boxRect.height;\r\n\r\n    const eventX = clamp(pageX - this.boxRect.left, 0, maxX);\r\n    const eventY = clamp(pageY - this.boxRect.top, 0, maxY);\r\n\r\n    const posX = eventX / maxX * 100;\r\n    const posY = eventY / maxY * 100;\r\n\r\n    const boxDragger = this.elements.boxDragger;\r\n    boxDragger.setAttributeNS(null, 'x', posX + '%');\r\n    boxDragger.setAttributeNS(null, 'y', posY + '%');\r\n\r\n    const saturation = clamp(posX, 0, 100);\r\n\r\n    const lightnessX = 100 - saturation / 2;\r\n    const lightnessY = 100 - clamp(posY, 0, 100);\r\n\r\n    const lightness = clamp(lightnessY / 100 * lightnessX, 0, 100);\r\n\r\n    this.saturation = saturation;\r\n    this.lightness = lightness;\r\n\r\n    if(update) {\r\n      this.updatePicker();\r\n    }\r\n  };\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport {SettingSection} from '..';\r\nimport {Theme} from '../../../config/state';\r\nimport {hexaToRgba} from '../../../helpers/color';\r\nimport {attachClickEvent} from '../../../helpers/dom/clickEvent';\r\nimport findUpClassName from '../../../helpers/dom/findUpClassName';\r\nimport highlightningColor from '../../../helpers/highlightningColor';\r\nimport throttle from '../../../helpers/schedulers/throttle';\r\nimport themeController from '../../../helpers/themeController';\r\nimport appImManager from '../../../lib/appManagers/appImManager';\r\nimport rootScope from '../../../lib/rootScope';\r\nimport ColorPicker, {ColorPickerColor} from '../../colorPicker';\r\nimport {SliderSuperTab} from '../../slider';\r\n\r\nexport default class AppBackgroundColorTab extends SliderSuperTab {\r\n  private colorPicker: ColorPicker;\r\n  private grid: HTMLElement;\r\n  private applyColor: (hex: string, updateColorPicker?: boolean) => void;\r\n  private theme: Theme;\r\n\r\n  init() {\r\n    this.header.classList.add('with-border');\r\n    this.container.classList.add('background-container', 'background-color-container');\r\n    this.setTitle('SetColor');\r\n\r\n    this.theme = themeController.getTheme();\r\n\r\n    const section = new SettingSection({});\r\n    this.colorPicker = new ColorPicker();\r\n\r\n    section.content.append(this.colorPicker.container);\r\n\r\n    this.scrollable.append(section.container);\r\n\r\n    const gridSection = new SettingSection({});\r\n\r\n    const grid = this.grid = document.createElement('div');\r\n    grid.classList.add('grid');\r\n\r\n    const colors = [\r\n      '#E6EBEE',\r\n      '#B2CEE1',\r\n      '#008DD0',\r\n      '#C6E7CB',\r\n      '#C4E1A6',\r\n      '#60B16E',\r\n      '#CCD0AF',\r\n      '#A6A997',\r\n      '#7A7072',\r\n      '#FDD7AF',\r\n      '#FDB76E',\r\n      '#DD8851'\r\n    ];\r\n\r\n    colors.forEach((color) => {\r\n      const item = document.createElement('div');\r\n      item.classList.add('grid-item');\r\n      item.dataset.color = color.toLowerCase();\r\n\r\n      // * need for transform scale\r\n      const media = document.createElement('div');\r\n      media.classList.add('grid-item-media');\r\n      media.style.backgroundColor = color;\r\n\r\n      item.append(media);\r\n      grid.append(item);\r\n    });\r\n\r\n    attachClickEvent(grid, (e) => {\r\n      const target = findUpClassName(e.target, 'grid-item');\r\n      if(!target || target.classList.contains('active')) {\r\n        return;\r\n      }\r\n\r\n      const color = target.dataset.color;\r\n      if(!color) {\r\n        return;\r\n      }\r\n\r\n      this.applyColor(color);\r\n    }, {listenerSetter: this.listenerSetter});\r\n\r\n    gridSection.content.append(grid);\r\n    this.scrollable.append(gridSection.container);\r\n\r\n    this.applyColor = throttle(this._applyColor, 16, true);\r\n  }\r\n\r\n  private setActive() {\r\n    const active = this.grid.querySelector('.active');\r\n    const background = this.theme.background;\r\n    const target = background.color ? this.grid.querySelector(`.grid-item[data-color=\"${background.color}\"]`) : null;\r\n    if(active === target) {\r\n      return;\r\n    }\r\n\r\n    if(active) {\r\n      active.classList.remove('active');\r\n    }\r\n\r\n    if(target) {\r\n      target.classList.add('active');\r\n    }\r\n  }\r\n\r\n  private _applyColor = (hex: string, updateColorPicker = true) => {\r\n    if(updateColorPicker) {\r\n      this.colorPicker.setColor(hex);\r\n    } else {\r\n      const rgba = hexaToRgba(hex);\r\n      const background = this.theme.background;\r\n      const hsla = highlightningColor(rgba);\r\n\r\n      background.id = '2';\r\n      background.intensity = 0;\r\n      background.slug = '';\r\n      background.color = hex.toLowerCase();\r\n      background.highlightningColor = hsla;\r\n      this.managers.appStateManager.pushToState('settings', rootScope.settings);\r\n\r\n      appImManager.applyCurrentTheme(undefined, undefined, true);\r\n      this.setActive();\r\n    }\r\n  };\r\n\r\n  private onColorChange = (color: ColorPickerColor) => {\r\n    this.applyColor(color.hex, false);\r\n  };\r\n\r\n  onOpen() {\r\n    setTimeout(() => {\r\n      const background = this.theme.background;\r\n\r\n      const color = (background.color || '').split(',')[0];\r\n      const isColored = !!color && !background.slug;\r\n\r\n      // * set active if type is color\r\n      if(isColored) {\r\n        this.colorPicker.onChange = this.onColorChange;\r\n      }\r\n\r\n      this.colorPicker.setColor(color || '#cccccc');\r\n\r\n      if(!isColored) {\r\n        this.colorPicker.onChange = this.onColorChange;\r\n      }\r\n    }, 0);\r\n  }\r\n\r\n  onCloseAfterTimeout() {\r\n    this.colorPicker.onChange = undefined;\r\n    this.colorPicker = undefined;\r\n\r\n    return super.onCloseAfterTimeout();\r\n  }\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport {generateSection} from '..';\r\nimport {averageColor, averageColorFromCanvas} from '../../../helpers/averageColor';\r\nimport blur from '../../../helpers/blur';\r\nimport deferredPromise, {CancellablePromise} from '../../../helpers/cancellablePromise';\r\nimport {attachClickEvent} from '../../../helpers/dom/clickEvent';\r\nimport findUpClassName from '../../../helpers/dom/findUpClassName';\r\nimport highlightningColor from '../../../helpers/highlightningColor';\r\nimport copy from '../../../helpers/object/copy';\r\nimport sequentialDom from '../../../helpers/sequentialDom';\r\nimport ChatBackgroundGradientRenderer from '../../chat/gradientRenderer';\r\nimport {Document, PhotoSize, WallPaper} from '../../../layer';\r\nimport {MyDocument} from '../../../lib/appManagers/appDocsManager';\r\nimport appDownloadManager, {AppDownloadManager, DownloadBlob} from '../../../lib/appManagers/appDownloadManager';\r\nimport appImManager from '../../../lib/appManagers/appImManager';\r\nimport rootScope from '../../../lib/rootScope';\r\nimport Button from '../../button';\r\nimport CheckboxField from '../../checkboxField';\r\nimport ProgressivePreloader from '../../preloader';\r\nimport {SliderSuperTab} from '../../slider';\r\nimport {wrapPhoto} from '../../wrappers';\r\nimport AppBackgroundColorTab from './backgroundColor';\r\nimport choosePhotoSize from '../../../lib/appManagers/utils/photos/choosePhotoSize';\r\nimport {STATE_INIT, Theme} from '../../../config/state';\r\nimport themeController from '../../../helpers/themeController';\r\nimport requestFile from '../../../helpers/files/requestFile';\r\nimport {renderImageFromUrlPromise} from '../../../helpers/dom/renderImageFromUrl';\r\nimport scaleMediaElement from '../../../helpers/canvas/scaleMediaElement';\r\nimport {MediaSize} from '../../../helpers/mediaSize';\r\n\r\nexport default class AppBackgroundTab extends SliderSuperTab {\r\n  private grid: HTMLElement;\r\n  private tempId = 0;\r\n  private clicked: Set<DocId> = new Set();\r\n  private blurCheckboxField: CheckboxField;\r\n\r\n  private wallPapersByElement: Map<HTMLElement, WallPaper> = new Map();\r\n  private elementsByKey: Map<string, HTMLElement> = new Map();\r\n\r\n  private get theme() {\r\n    return themeController.getTheme();\r\n  }\r\n\r\n  init() {\r\n    this.header.classList.add('with-border');\r\n    this.container.classList.add('background-container', 'background-image-container');\r\n    this.setTitle('ChatBackground');\r\n\r\n    {\r\n      const container = generateSection(this.scrollable);\r\n\r\n      const uploadButton = Button('btn-primary btn-transparent', {icon: 'cameraadd', text: 'ChatBackground.UploadWallpaper'});\r\n      const colorButton = Button('btn-primary btn-transparent', {icon: 'colorize', text: 'SetColor'});\r\n      const resetButton = Button('btn-primary btn-transparent', {icon: 'favourites', text: 'Appearance.Reset'});\r\n\r\n      attachClickEvent(uploadButton, this.onUploadClick, {listenerSetter: this.listenerSetter});\r\n\r\n      attachClickEvent(colorButton, () => {\r\n        this.slider.createTab(AppBackgroundColorTab).open();\r\n      }, {listenerSetter: this.listenerSetter});\r\n\r\n      attachClickEvent(resetButton, this.onResetClick, {listenerSetter: this.listenerSetter});\r\n\r\n      const blurCheckboxField = this.blurCheckboxField = new CheckboxField({\r\n        text: 'ChatBackground.Blur',\r\n        name: 'blur',\r\n        checked: this.theme.background.blur,\r\n        withRipple: true\r\n      });\r\n\r\n      this.listenerSetter.add(blurCheckboxField.input)('change', async() => {\r\n        this.theme.background.blur = blurCheckboxField.input.checked;\r\n        await this.managers.appStateManager.pushToState('settings', rootScope.settings);\r\n\r\n        // * wait for animation end\r\n        setTimeout(() => {\r\n          const active = grid.querySelector('.active') as HTMLElement;\r\n          if(!active) return;\r\n\r\n          const wallpaper = this.wallPapersByElement.get(active);\r\n          if((wallpaper as WallPaper.wallPaper).pFlags.pattern || wallpaper._ === 'wallPaperNoFile') {\r\n            return;\r\n          }\r\n\r\n          this.setBackgroundDocument(wallpaper);\r\n        }, 100);\r\n      });\r\n\r\n      container.append(uploadButton, colorButton, resetButton, blurCheckboxField.label);\r\n    }\r\n\r\n    rootScope.addEventListener('background_change', this.setActive);\r\n\r\n    this.managers.appDocsManager.getWallPapers().then((wallPapers) => {\r\n      wallPapers.forEach((wallPaper) => {\r\n        this.addWallPaper(wallPaper);\r\n      });\r\n    });\r\n\r\n    const gridContainer = generateSection(this.scrollable);\r\n    const grid = this.grid = document.createElement('div');\r\n    grid.classList.add('grid');\r\n    attachClickEvent(grid, this.onGridClick, {listenerSetter: this.listenerSetter});\r\n    gridContainer.append(grid);\r\n  }\r\n\r\n  private onUploadClick = () => {\r\n    requestFile('image/x-png,image/png,image/jpeg').then(async(file) => {\r\n      if(file.name.endsWith('.png')) {\r\n        const img = document.createElement('img');\r\n        const url = URL.createObjectURL(file);\r\n        await renderImageFromUrlPromise(img, url, false);\r\n        const mimeType = 'image/jpeg';\r\n        const {blob} = await scaleMediaElement({media: img, size: new MediaSize(img.naturalWidth, img.naturalHeight), mimeType});\r\n        file = new File([blob], file.name.replace(/\\.png$/, '.jpg'), {type: mimeType});\r\n      }\r\n\r\n      const wallPaper = await this.managers.appDocsManager.prepareWallPaperUpload(file);\r\n      const uploadPromise = this.managers.appDocsManager.uploadWallPaper(wallPaper.id);\r\n      const uploadDeferred: CancellablePromise<any> = appDownloadManager.getNewDeferredForUpload(file.name, uploadPromise);\r\n\r\n      const deferred = deferredPromise<void>();\r\n      deferred.addNotifyListener = uploadDeferred.addNotifyListener;\r\n      deferred.cancel = uploadDeferred.cancel;\r\n\r\n      uploadDeferred.then((wallPaper) => {\r\n        this.clicked.delete(key);\r\n        this.elementsByKey.delete(key);\r\n        this.wallPapersByElement.set(container, wallPaper);\r\n        const newKey = this.getWallPaperKey(wallPaper);\r\n        this.elementsByKey.set(newKey, container);\r\n\r\n        this.setBackgroundDocument(wallPaper).then(deferred.resolve, deferred.reject);\r\n      }, deferred.reject);\r\n\r\n      const key = this.getWallPaperKey(wallPaper);\r\n      deferred.catch(() => {\r\n        container.remove();\r\n      });\r\n\r\n      const preloader = new ProgressivePreloader({\r\n        isUpload: true,\r\n        cancelable: true,\r\n        tryAgainOnFail: false\r\n      });\r\n\r\n      const container = this.addWallPaper(wallPaper, false);\r\n      this.clicked.add(key);\r\n\r\n      preloader.attach(container, false, deferred);\r\n    });\r\n  };\r\n\r\n  private onResetClick = () => {\r\n    const defaultTheme = STATE_INIT.settings.themes.find((t) => t.name === this.theme.name);\r\n    if(defaultTheme) {\r\n      ++this.tempId;\r\n      this.theme.background = copy(defaultTheme.background);\r\n      this.managers.appStateManager.pushToState('settings', rootScope.settings);\r\n      appImManager.applyCurrentTheme(undefined, undefined, true);\r\n      this.blurCheckboxField.setValueSilently(this.theme.background.blur);\r\n    }\r\n  };\r\n\r\n  private getColorsFromWallPaper(wallPaper: WallPaper) {\r\n    return wallPaper.settings ? [\r\n      wallPaper.settings.background_color,\r\n      wallPaper.settings.second_background_color,\r\n      wallPaper.settings.third_background_color,\r\n      wallPaper.settings.fourth_background_color\r\n    ].filter(Boolean).map((color) => '#' + color.toString(16)).join(',') : '';\r\n  }\r\n\r\n  private getWallPaperKey(wallPaper: WallPaper) {\r\n    return '' + wallPaper.id;\r\n  }\r\n\r\n  private getWallPaperKeyFromTheme(theme: Theme) {\r\n    return '' + theme.background.id;\r\n  }\r\n\r\n  private addWallPaper(wallPaper: WallPaper, append = true) {\r\n    const colors = this.getColorsFromWallPaper(wallPaper);\r\n    const hasFile = wallPaper._ === 'wallPaper';\r\n    if((hasFile && wallPaper.pFlags.pattern && !colors)/*  ||\r\n      (wallpaper.document as MyDocument).mime_type.indexOf('application/') === 0 */) {\r\n      return;\r\n    }\r\n\r\n    const isDark = !!wallPaper.pFlags.dark;\r\n\r\n    const doc = hasFile ? wallPaper.document as Document.document : undefined;\r\n\r\n    const container = document.createElement('div');\r\n    container.classList.add('grid-item');\r\n\r\n    container.dataset.id = '' + wallPaper.id;\r\n\r\n    const key = this.getWallPaperKey(wallPaper);\r\n    this.wallPapersByElement.set(container, wallPaper);\r\n    this.elementsByKey.set(key, container);\r\n\r\n    const media = document.createElement('div');\r\n    media.classList.add('grid-item-media');\r\n\r\n    let wrapped: ReturnType<typeof wrapPhoto>, size: ReturnType<typeof choosePhotoSize>;\r\n    if(hasFile) {\r\n      size = choosePhotoSize(doc, 200, 200);\r\n      wrapped = wrapPhoto({\r\n        photo: doc,\r\n        message: null,\r\n        container: media,\r\n        withoutPreloader: true,\r\n        size: size,\r\n        noFadeIn: wallPaper.pFlags.pattern\r\n      });\r\n\r\n      if(wallPaper.pFlags.pattern) {\r\n        media.classList.add('is-pattern');\r\n      }\r\n\r\n      wrapped.then(async({loadPromises, images}) => {\r\n        await loadPromises.thumb || loadPromises.full;\r\n        return images;\r\n      }).then((images) => {\r\n        if(wallPaper.pFlags.pattern) {\r\n          if(isDark) {\r\n            images.full.style.display = 'none';\r\n            if(images.thumb) {\r\n              images.thumb.style.display = 'none';\r\n            }\r\n          } else if(wallPaper.settings?.intensity) {\r\n            images.full.style.opacity = '' + Math.abs(wallPaper.settings.intensity) / 100;\r\n          }\r\n        }\r\n\r\n        sequentialDom.mutate(() => {\r\n          container.append(media);\r\n        });\r\n      });\r\n    } else {\r\n      container.append(media);\r\n    }\r\n\r\n    if(wallPaper.settings && wallPaper.settings.background_color !== undefined) {\r\n      const {canvas} = ChatBackgroundGradientRenderer.create(colors);\r\n      canvas.classList.add('background-colors-canvas');\r\n\r\n      if(isDark && hasFile) {\r\n        wrapped.then(({loadPromises}) => {\r\n          loadPromises.full.then(async() => {\r\n            const cacheContext = await this.managers.thumbsStorage.getCacheContext(doc, size.type);\r\n            canvas.style.webkitMaskImage = `url(${cacheContext.url})`;\r\n            canvas.style.opacity = '' + (wallPaper.pFlags.dark ? 100 + wallPaper.settings.intensity : wallPaper.settings.intensity) / 100;\r\n            media.append(canvas);\r\n          });\r\n        });\r\n      } else {\r\n        media.append(canvas);\r\n      }\r\n    }\r\n\r\n    if(this.getWallPaperKeyFromTheme(this.theme) === key) {\r\n      container.classList.add('active');\r\n    }\r\n\r\n    this.grid[append ? 'append' : 'prepend'](container);\r\n\r\n    return container;\r\n  }\r\n\r\n  private onGridClick = (e: MouseEvent | TouchEvent) => {\r\n    const target = findUpClassName(e.target, 'grid-item') as HTMLElement;\r\n    if(!target) return;\r\n\r\n    const wallpaper = this.wallPapersByElement.get(target);\r\n    if(wallpaper._ === 'wallPaperNoFile') {\r\n      this.setBackgroundDocument(wallpaper);\r\n      return;\r\n    }\r\n\r\n    const key = this.getWallPaperKey(wallpaper);\r\n    if(this.clicked.has(key)) return;\r\n    this.clicked.add(key);\r\n\r\n    const doc = wallpaper.document as MyDocument;\r\n    const preloader = new ProgressivePreloader({\r\n      cancelable: true,\r\n      tryAgainOnFail: false\r\n    });\r\n\r\n    const load = async() => {\r\n      const promise = this.setBackgroundDocument(wallpaper);\r\n      const cacheContext = await this.managers.thumbsStorage.getCacheContext(doc);\r\n      if(!cacheContext.url || this.theme.background.blur) {\r\n        preloader.attach(target, true, promise);\r\n      }\r\n    };\r\n\r\n    preloader.construct();\r\n\r\n    attachClickEvent(target, (e) => {\r\n      if(preloader.preloader.parentElement) {\r\n        preloader.onClick(e);\r\n        preloader.detach();\r\n      } else {\r\n        load();\r\n      }\r\n    }, {listenerSetter: this.listenerSetter});\r\n\r\n    load();\r\n\r\n    // console.log(doc);\r\n  };\r\n\r\n  private saveToCache = (slug: string, url: string) => {\r\n    fetch(url).then((response) => {\r\n      appImManager.cacheStorage.save('backgrounds/' + slug, response);\r\n    });\r\n  };\r\n\r\n  private setBackgroundDocument = (wallPaper: WallPaper) => {\r\n    const _tempId = ++this.tempId;\r\n    const middleware = () => _tempId === this.tempId;\r\n\r\n    const doc = (wallPaper as WallPaper.wallPaper).document as MyDocument;\r\n    const deferred = deferredPromise<void>();\r\n    let download: Promise<void> | ReturnType<AppDownloadManager['downloadMediaURL']>;\r\n    if(doc) {\r\n      download = appDownloadManager.downloadMediaURL({media: doc, queueId: appImManager.chat.bubbles ? appImManager.chat.bubbles.lazyLoadQueue.queueId : 0});\r\n      deferred.addNotifyListener = download.addNotifyListener;\r\n      deferred.cancel = download.cancel;\r\n    } else {\r\n      download = Promise.resolve();\r\n    }\r\n\r\n    download.then(async() => {\r\n      if(!middleware()) {\r\n        deferred.resolve();\r\n        return;\r\n      }\r\n\r\n      const background = this.theme.background;\r\n      const onReady = (url?: string) => {\r\n        // const perf = performance.now();\r\n        let getPixelPromise: Promise<Uint8ClampedArray>;\r\n        if(url && !this.theme.background.color) {\r\n          getPixelPromise = averageColor(url);\r\n        } else {\r\n          const {canvas} = ChatBackgroundGradientRenderer.create(this.getColorsFromWallPaper(wallPaper));\r\n          getPixelPromise = Promise.resolve(averageColorFromCanvas(canvas));\r\n        }\r\n\r\n        getPixelPromise.then((pixel) => {\r\n          if(!middleware()) {\r\n            deferred.resolve();\r\n            return;\r\n          }\r\n\r\n          const hsla = highlightningColor(Array.from(pixel) as any);\r\n          // const hsla = 'rgba(0, 0, 0, 0.3)';\r\n          // console.log(doc, hsla, performance.now() - perf);\r\n\r\n          const slug = (wallPaper as WallPaper.wallPaper).slug ?? '';\r\n          background.id = wallPaper.id;\r\n          background.intensity = wallPaper.settings?.intensity ?? 0;\r\n          background.color = this.getColorsFromWallPaper(wallPaper);\r\n          background.slug = slug;\r\n          background.highlightningColor = hsla;\r\n          this.managers.appStateManager.pushToState('settings', rootScope.settings);\r\n\r\n          if(slug) {\r\n            this.saveToCache(slug, url);\r\n          }\r\n\r\n          appImManager.applyCurrentTheme(slug, url, true).then(deferred.resolve);\r\n        });\r\n      };\r\n\r\n      if(!doc) {\r\n        onReady();\r\n        return;\r\n      }\r\n\r\n      const cacheContext = await this.managers.thumbsStorage.getCacheContext(doc);\r\n      if(background.blur) {\r\n        setTimeout(() => {\r\n          const {canvas, promise} = blur(cacheContext.url, 12, 4)\r\n          promise.then(() => {\r\n            if(!middleware()) {\r\n              deferred.resolve();\r\n              return;\r\n            }\r\n\r\n            onReady(canvas.toDataURL());\r\n          });\r\n        }, 200);\r\n      } else {\r\n        onReady(cacheContext.url);\r\n      }\r\n    });\r\n\r\n    return deferred;\r\n  };\r\n\r\n  private setActive = () => {\r\n    const active = this.grid.querySelector('.active');\r\n    const target = this.elementsByKey.get(this.getWallPaperKeyFromTheme(this.theme));\r\n    if(active === target) {\r\n      return;\r\n    }\r\n\r\n    if(active) {\r\n      active.classList.remove('active');\r\n    }\r\n\r\n    if(target) {\r\n      target.classList.add('active');\r\n    }\r\n  };\r\n}\r\n","export default function requestFile(accept?: string) {\n  const input = document.createElement('input');\n  input.type = 'file';\n  input.style.display = 'none';\n\n  if(accept) {\n    input.accept = accept;\n  }\n\n  document.body.append(input);\n\n  const promise = new Promise<File>((resolve, reject) => {\n    input.addEventListener('change', (e: any) => {\n      const file: File = e.target.files[0];\n      if(!file) {\n        reject('NO_FILE_SELECTED');\n        return;\n      }\n\n      resolve(file);\n    }, {once: true});\n  }).finally(() => {\n    input.remove();\n  });\n\n  input.click();\n\n  return promise;\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport {SettingSection} from '..';\nimport RadioField from '../../radioField';\nimport Row, {RadioFormFromRows} from '../../row';\nimport SliderSuperTab from '../../sliderTab';\nimport {wrapStickerToRow} from '../../wrappers';\n\nexport default class AppQuickReactionTab extends SliderSuperTab {\n  protected init() {\n    this.header.classList.add('with-border');\n    this.setTitle('DoubleTapSetting');\n    this.container.classList.add('quick-reaction-container');\n\n    return Promise.all([\n      this.managers.appReactionsManager.getQuickReaction(),\n      this.managers.appReactionsManager.getAvailableReactions()\n    ]).then(([quickReaction, availableReactions]) => {\n      availableReactions = availableReactions.filter((reaction) => !reaction.pFlags.inactive);\n\n      const section = new SettingSection();\n\n      const name = 'quick-reaction';\n      const rows = availableReactions.map((availableReaction) => {\n        const radioField = new RadioField({\n          name,\n          text: availableReaction.title,\n          value: availableReaction.reaction,\n          alignRight: true\n        });\n\n        const row = new Row({\n          radioField,\n          havePadding: true\n        });\n\n        radioField.main.classList.add('quick-reaction-title');\n\n        wrapStickerToRow({\n          row,\n          doc: availableReaction.static_icon,\n          size: 'small'\n        });\n\n        if(availableReaction.reaction === quickReaction.reaction) {\n          radioField.setValueSilently(true);\n        }\n\n        return row;\n      });\n\n      const form = RadioFormFromRows(rows, (value) => {\n        this.managers.appReactionsManager.setDefaultReaction(value);\n      });\n\n      section.content.append(form);\n      this.scrollable.append(section.container);\n    });\n  }\n}\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport {generateSection, SettingSection} from '..';\r\nimport RangeSelector from '../../rangeSelector';\r\nimport Button from '../../button';\r\nimport CheckboxField from '../../checkboxField';\r\nimport RadioField from '../../radioField';\r\nimport rootScope from '../../../lib/rootScope';\r\nimport {IS_APPLE} from '../../../environment/userAgent';\r\nimport Row from '../../row';\r\nimport AppBackgroundTab from './background';\r\nimport {LangPackKey, _i18n} from '../../../lib/langPack';\r\nimport {attachClickEvent} from '../../../helpers/dom/clickEvent';\r\nimport assumeType from '../../../helpers/assumeType';\r\nimport {MessagesAllStickers, StickerSet} from '../../../layer';\r\nimport {wrapStickerSetThumb, wrapStickerToRow} from '../../wrappers';\r\nimport LazyLoadQueue from '../../lazyLoadQueue';\r\nimport PopupStickers from '../../popups/stickers';\r\nimport eachMinute from '../../../helpers/eachMinute';\r\nimport {SliderSuperTabEventable} from '../../sliderTab';\r\nimport IS_GEOLOCATION_SUPPORTED from '../../../environment/geolocationSupport';\r\nimport AppQuickReactionTab from './quickReaction';\r\nimport wrapEmojiText from '../../../lib/richTextProcessor/wrapEmojiText';\r\nimport {State} from '../../../config/state';\r\n\r\nexport class RangeSettingSelector {\r\n  public container: HTMLDivElement;\r\n  public valueContainer: HTMLElement;\r\n  private range: RangeSelector;\r\n\r\n  public onChange: (value: number) => void;\r\n\r\n  constructor(\r\n    name: LangPackKey,\r\n    step: number,\r\n    initialValue: number,\r\n    minValue: number,\r\n    maxValue: number,\r\n    writeValue = true\r\n  ) {\r\n    const BASE_CLASS = 'range-setting-selector';\r\n    this.container = document.createElement('div');\r\n    this.container.classList.add(BASE_CLASS);\r\n\r\n    const details = document.createElement('div');\r\n    details.classList.add(BASE_CLASS + '-details');\r\n\r\n    const nameDiv = document.createElement('div');\r\n    nameDiv.classList.add(BASE_CLASS + '-name');\r\n    _i18n(nameDiv, name);\r\n\r\n    const valueDiv = this.valueContainer = document.createElement('div');\r\n    valueDiv.classList.add(BASE_CLASS + '-value');\r\n\r\n    if(writeValue) {\r\n      valueDiv.innerHTML = '' + initialValue;\r\n    }\r\n\r\n    details.append(nameDiv, valueDiv);\r\n\r\n    this.range = new RangeSelector({\r\n      step,\r\n      min: minValue,\r\n      max: maxValue\r\n    }, initialValue);\r\n    this.range.setListeners();\r\n    this.range.setHandlers({\r\n      onScrub: value => {\r\n        if(this.onChange) {\r\n          this.onChange(value);\r\n        }\r\n\r\n        if(writeValue) {\r\n          // console.log('font size scrub:', value);\r\n          valueDiv.innerText = '' + value;\r\n        }\r\n      }\r\n    });\r\n\r\n    this.container.append(details, this.range.container);\r\n  }\r\n}\r\n\r\nexport default class AppGeneralSettingsTab extends SliderSuperTabEventable {\r\n  init() {\r\n    this.header.classList.add('with-border');\r\n    this.container.classList.add('general-settings-container');\r\n    this.setTitle('General');\r\n\r\n    const section = generateSection.bind(null, this.scrollable);\r\n\r\n    {\r\n      const container = section('Settings');\r\n\r\n      const range = new RangeSettingSelector('TextSize', 1, rootScope.settings.messagesTextSize, 12, 20);\r\n      range.onChange = (value) => {\r\n        rootScope.managers.appStateManager.setByKey('settings.messagesTextSize', value);\r\n      };\r\n\r\n      const chatBackgroundButton = Button('btn-primary btn-transparent', {icon: 'image', text: 'ChatBackground'});\r\n\r\n      attachClickEvent(chatBackgroundButton, () => {\r\n        this.slider.createTab(AppBackgroundTab).open();\r\n      });\r\n\r\n      const animationsCheckboxField = new CheckboxField({\r\n        text: 'EnableAnimations',\r\n        name: 'animations',\r\n        stateKey: 'settings.animationsEnabled',\r\n        withRipple: true,\r\n        listenerSetter: this.listenerSetter\r\n      });\r\n\r\n      container.append(range.container, chatBackgroundButton, animationsCheckboxField.label);\r\n    }\r\n\r\n    {\r\n      const container = section('General.Keyboard');\r\n\r\n      const form = document.createElement('form');\r\n\r\n      const name = 'send-shortcut';\r\n      const stateKey = 'settings.sendShortcut';\r\n\r\n      const enterRow = new Row({\r\n        radioField: new RadioField({\r\n          langKey: 'General.SendShortcut.Enter',\r\n          name,\r\n          value: 'enter',\r\n          stateKey\r\n        }),\r\n        subtitleLangKey: 'General.SendShortcut.NewLine.ShiftEnter'\r\n      });\r\n\r\n      const ctrlEnterRow = new Row({\r\n        radioField: new RadioField({\r\n          name,\r\n          value: 'ctrlEnter',\r\n          stateKey\r\n        }),\r\n        subtitleLangKey: 'General.SendShortcut.NewLine.Enter'\r\n      });\r\n      _i18n(ctrlEnterRow.radioField.main, 'General.SendShortcut.CtrlEnter', [IS_APPLE ? '' : 'Ctrl']);\r\n\r\n      form.append(enterRow.container, ctrlEnterRow.container);\r\n      container.append(form);\r\n    }\r\n\r\n    if(IS_GEOLOCATION_SUPPORTED) {\r\n      const container = section('DistanceUnitsTitle');\r\n\r\n      const form = document.createElement('form');\r\n\r\n      const name = 'distance-unit';\r\n      const stateKey = 'settings.distanceUnit';\r\n\r\n      const kilometersRow = new Row({\r\n        radioField: new RadioField({\r\n          langKey: 'DistanceUnitsKilometers',\r\n          name,\r\n          value: 'kilometers',\r\n          stateKey\r\n        })\r\n      });\r\n\r\n      const milesRow = new Row({\r\n        radioField: new RadioField({\r\n          langKey: 'DistanceUnitsMiles',\r\n          name,\r\n          value: 'miles',\r\n          stateKey\r\n        })\r\n      });\r\n\r\n      form.append(kilometersRow.container, milesRow.container);\r\n      container.append(form);\r\n    }\r\n\r\n    {\r\n      const container = section('General.TimeFormat');\r\n\r\n      const form = document.createElement('form');\r\n\r\n      const name = 'time-format';\r\n      const stateKey = 'settings.timeFormat';\r\n\r\n      const formats: [State['settings']['timeFormat'], LangPackKey][] = [\r\n        ['h12', 'General.TimeFormat.h12'],\r\n        ['h23', 'General.TimeFormat.h23']\r\n      ];\r\n\r\n      const rows = formats.map(([format, langPackKey]) => {\r\n        const row = new Row({\r\n          radioField: new RadioField({\r\n            langKey: langPackKey,\r\n            name,\r\n            value: format,\r\n            stateKey\r\n          })\r\n        });\r\n\r\n        return row;\r\n      });\r\n\r\n      const cancel = eachMinute(() => {\r\n        const date = new Date();\r\n\r\n        formats.forEach(([format], idx) => {\r\n          const str = date.toLocaleTimeString('en-us-u-hc-' + format, {\r\n            hour: '2-digit',\r\n            minute: '2-digit'\r\n          });\r\n\r\n          rows[idx].subtitle.textContent = str;\r\n        });\r\n      });\r\n\r\n      this.eventListener.addEventListener('destroy', cancel);\r\n\r\n      form.append(...rows.map((row) => row.container));\r\n      container.append(form);\r\n    }\r\n\r\n    {\r\n      const container = section('Emoji');\r\n\r\n      const suggestCheckboxField = new CheckboxField({\r\n        text: 'GeneralSettings.EmojiPrediction',\r\n        name: 'suggest-emoji',\r\n        stateKey: 'settings.emoji.suggest',\r\n        withRipple: true,\r\n        listenerSetter: this.listenerSetter\r\n      });\r\n      const bigCheckboxField = new CheckboxField({\r\n        text: 'GeneralSettings.BigEmoji',\r\n        name: 'emoji-big',\r\n        stateKey: 'settings.emoji.big',\r\n        withRipple: true,\r\n        listenerSetter: this.listenerSetter\r\n      });\r\n\r\n      container.append(suggestCheckboxField.label, bigCheckboxField.label);\r\n    }\r\n\r\n    {\r\n      const section = new SettingSection({name: 'Telegram.InstalledStickerPacksController', caption: 'StickersBotInfo'});\r\n\r\n      const reactionsRow = new Row({\r\n        titleLangKey: 'DoubleTapSetting',\r\n        havePadding: true,\r\n        clickable: () => {\r\n          this.slider.createTab(AppQuickReactionTab).open();\r\n        },\r\n        listenerSetter: this.listenerSetter\r\n      });\r\n\r\n      const renderQuickReaction = () => {\r\n        Promise.resolve(this.managers.appReactionsManager.getQuickReaction()).then((reaction) => {\r\n          wrapStickerToRow({\r\n            row: reactionsRow,\r\n            doc: reaction.static_icon,\r\n            size: 'small'\r\n          });\r\n        });\r\n      };\r\n\r\n      renderQuickReaction();\r\n\r\n      this.listenerSetter.add(rootScope)('quick_reaction', renderQuickReaction);\r\n\r\n      const suggestCheckboxField = new CheckboxField({\r\n        text: 'Stickers.SuggestStickers',\r\n        name: 'suggest',\r\n        stateKey: 'settings.stickers.suggest',\r\n        withRipple: true,\r\n        listenerSetter: this.listenerSetter\r\n      });\r\n      const loopCheckboxField = new CheckboxField({\r\n        text: 'InstalledStickers.LoopAnimated',\r\n        name: 'loop',\r\n        stateKey: 'settings.stickers.loop',\r\n        withRipple: true,\r\n        listenerSetter: this.listenerSetter\r\n      });\r\n\r\n      const stickerSets: {[id: string]: Row} = {};\r\n\r\n      const stickersContent = section.generateContentElement();\r\n\r\n      const lazyLoadQueue = new LazyLoadQueue();\r\n      const renderStickerSet = (stickerSet: StickerSet.stickerSet, method: 'append' | 'prepend' = 'append') => {\r\n        const row = new Row({\r\n          title: wrapEmojiText(stickerSet.title),\r\n          subtitleLangKey: 'Stickers',\r\n          subtitleLangArgs: [stickerSet.count],\r\n          havePadding: true,\r\n          clickable: () => {\r\n            new PopupStickers({id: stickerSet.id, access_hash: stickerSet.access_hash}).show();\r\n          },\r\n          listenerSetter: this.listenerSetter\r\n        });\r\n\r\n        stickerSets[stickerSet.id] = row;\r\n\r\n        const div = document.createElement('div');\r\n        div.classList.add('row-media');\r\n\r\n        wrapStickerSetThumb({\r\n          set: stickerSet,\r\n          container: div,\r\n          group: 'GENERAL-SETTINGS',\r\n          lazyLoadQueue,\r\n          width: 48,\r\n          height: 48,\r\n          autoplay: true\r\n        });\r\n\r\n        row.container.append(div);\r\n\r\n        stickersContent[method](row.container);\r\n      };\r\n\r\n      this.managers.appStickersManager.getAllStickers().then((allStickers) => {\r\n        assumeType<MessagesAllStickers.messagesAllStickers>(allStickers);\r\n        for(const stickerSet of allStickers.sets) {\r\n          renderStickerSet(stickerSet);\r\n        }\r\n      });\r\n\r\n      this.listenerSetter.add(rootScope)('stickers_installed', (set) => {\r\n        if(!stickerSets[set.id]) {\r\n          renderStickerSet(set, 'prepend');\r\n        }\r\n      });\r\n\r\n      this.listenerSetter.add(rootScope)('stickers_deleted', (set) => {\r\n        if(stickerSets[set.id]) {\r\n          stickerSets[set.id].container.remove();\r\n          delete stickerSets[set.id];\r\n        }\r\n      });\r\n\r\n      section.content.append(reactionsRow.container, suggestCheckboxField.label, loopCheckboxField.label);\r\n      this.scrollable.append(section.container);\r\n    }\r\n  }\r\n\r\n  onOpen() {\r\n    if(this.init) {\r\n      this.init();\r\n      this.init = null;\r\n    }\r\n  }\r\n}\r\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport eachTimeout from './eachTimeout';\n\n// It's better to use timeout instead of interval, because interval can be corrupted\nexport default function eachMinute(callback: () => any, runFirst = true) {\n  return eachTimeout(callback, () => (60 - new Date().getSeconds()) * 1000, runFirst);\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport ctx from '../environment/ctx';\nimport noop from './noop';\n\n// It's better to use timeout instead of interval, because interval can be corrupted\nexport default function eachTimeout(callback: () => any, getNextTimeout: () => number, runFirst = true) {\n  const cancel = () => {\n    clearTimeout(timeout);\n  };\n\n  // replace callback to run noop and restore after\n  const _callback = callback;\n  if(!runFirst) {\n    callback = noop;\n  }\n\n  let timeout: number;\n  (function run() {\n    callback();\n    timeout = ctx.setTimeout(run, getNextTimeout());\n  })();\n\n  callback = _callback;\n\n  return cancel;\n}\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport InputField from '../../inputField';\r\nimport {SliderSuperTab} from '../../slider';\r\nimport EditPeer from '../../editPeer';\r\nimport {UsernameInputField} from '../../usernameInputField';\r\nimport {i18n, i18n_} from '../../../lib/langPack';\r\nimport {attachClickEvent} from '../../../helpers/dom/clickEvent';\r\nimport rootScope from '../../../lib/rootScope';\r\nimport {generateSection, SettingSection} from '..';\r\n\r\n// TODO:         - (    ,    ,      )\r\n\r\nexport default class AppEditProfileTab extends SliderSuperTab {\r\n  private firstNameInputField: InputField;\r\n  private lastNameInputField: InputField;\r\n  private bioInputField: InputField;\r\n  private usernameInputField: InputField;\r\n\r\n  private profileUrlContainer: HTMLDivElement;\r\n  private profileUrlAnchor: HTMLAnchorElement;\r\n\r\n  private editPeer: EditPeer;\r\n\r\n  protected async init() {\r\n    this.container.classList.add('edit-profile-container');\r\n    this.setTitle('EditAccount.Title');\r\n\r\n    const inputFields: InputField[] = [];\r\n\r\n    {\r\n      const section = generateSection(this.scrollable, undefined, 'Bio.Description');\r\n      const inputWrapper = document.createElement('div');\r\n      inputWrapper.classList.add('input-wrapper');\r\n\r\n      const appConfig = await this.managers.apiManager.getAppConfig();\r\n      this.firstNameInputField = new InputField({\r\n        label: 'EditProfile.FirstNameLabel',\r\n        name: 'first-name',\r\n        maxLength: 70\r\n      });\r\n      this.lastNameInputField = new InputField({\r\n        label: 'Login.Register.LastName.Placeholder',\r\n        name: 'last-name',\r\n        maxLength: 64\r\n      });\r\n      this.bioInputField = new InputField({\r\n        label: 'EditProfile.BioLabel',\r\n        name: 'bio',\r\n        maxLength: rootScope.premium ? appConfig.about_length_limit_premium : appConfig.about_length_limit_default\r\n      });\r\n\r\n      inputWrapper.append(this.firstNameInputField.container, this.lastNameInputField.container, this.bioInputField.container);\r\n\r\n      const caption = document.createElement('div');\r\n      caption.classList.add('caption');\r\n      i18n_({element: caption, key: 'Bio.Description'});\r\n\r\n      inputFields.push(this.firstNameInputField, this.lastNameInputField, this.bioInputField);\r\n\r\n      this.editPeer = new EditPeer({\r\n        peerId: rootScope.myId,\r\n        inputFields,\r\n        listenerSetter: this.listenerSetter\r\n      });\r\n\r\n      this.content.append(this.editPeer.nextBtn);\r\n\r\n      section.append(this.editPeer.avatarEdit.container, inputWrapper);\r\n    }\r\n\r\n    {\r\n      const section = new SettingSection({\r\n        name: 'EditAccount.Username',\r\n        caption: true\r\n      });\r\n\r\n      const inputWrapper = document.createElement('div');\r\n      inputWrapper.classList.add('input-wrapper');\r\n\r\n      this.usernameInputField = new UsernameInputField({\r\n        label: 'EditProfile.Username.Label',\r\n        name: 'username',\r\n        plainText: true,\r\n        listenerSetter: this.listenerSetter,\r\n        onChange: () => {\r\n          this.editPeer.handleChange();\r\n          this.setProfileUrl();\r\n        },\r\n        availableText: 'EditProfile.Username.Available',\r\n        takenText: 'EditProfile.Username.Taken',\r\n        invalidText: 'EditProfile.Username.Invalid'\r\n      }, this.managers);\r\n\r\n      inputWrapper.append(this.usernameInputField.container);\r\n\r\n      const caption = section.caption;\r\n      caption.append(i18n('UsernameSettings.ChangeDescription'));\r\n      caption.append(document.createElement('br'), document.createElement('br'));\r\n\r\n      const profileUrlContainer = this.profileUrlContainer = document.createElement('div');\r\n      profileUrlContainer.classList.add('profile-url-container');\r\n\r\n      const profileUrlAnchor = this.profileUrlAnchor = document.createElement('a');\r\n      profileUrlAnchor.classList.add('profile-url');\r\n      profileUrlAnchor.href = '#';\r\n      profileUrlAnchor.target = '_blank';\r\n\r\n      profileUrlContainer.append(i18n('UsernameHelpLink', [profileUrlAnchor]));\r\n\r\n      caption.append(profileUrlContainer);\r\n\r\n      inputFields.push(this.usernameInputField);\r\n      section.content.append(inputWrapper);\r\n      this.scrollable.append(section.container);\r\n    }\r\n\r\n    attachClickEvent(this.editPeer.nextBtn, () => {\r\n      this.editPeer.nextBtn.disabled = true;\r\n\r\n      const promises: Promise<any>[] = [];\r\n\r\n      promises.push(this.managers.appProfileManager.updateProfile(this.firstNameInputField.value, this.lastNameInputField.value, this.bioInputField.value).then(() => {\r\n        this.close();\r\n      }, (err) => {\r\n        console.error('updateProfile error:', err);\r\n      }));\r\n\r\n      if(this.editPeer.uploadAvatar) {\r\n        promises.push(this.editPeer.uploadAvatar().then((inputFile) => {\r\n          return this.managers.appProfileManager.uploadProfilePhoto(inputFile);\r\n        }));\r\n      }\r\n\r\n      if(this.usernameInputField.isValidToChange()) {\r\n        promises.push(this.managers.appUsersManager.updateUsername(this.usernameInputField.value));\r\n      }\r\n\r\n      Promise.race(promises).finally(() => {\r\n        this.editPeer.nextBtn.removeAttribute('disabled');\r\n      });\r\n    }, {listenerSetter: this.listenerSetter});\r\n\r\n    const user = await this.managers.appUsersManager.getSelf();\r\n\r\n    const userFull = await this.managers.appProfileManager.getProfile(user.id, true);\r\n\r\n    this.firstNameInputField.setOriginalValue(user.first_name, true);\r\n    this.lastNameInputField.setOriginalValue(user.last_name, true);\r\n    this.bioInputField.setOriginalValue(userFull.about, true);\r\n    this.usernameInputField.setOriginalValue(user.username, true);\r\n\r\n    this.setProfileUrl();\r\n    this.editPeer.handleChange();\r\n  }\r\n\r\n  private setProfileUrl() {\r\n    if(this.usernameInputField.input.classList.contains('error') || !this.usernameInputField.value.length) {\r\n      this.profileUrlContainer.style.display = 'none';\r\n    } else {\r\n      this.profileUrlContainer.style.display = '';\r\n      const url = 'https://t.me/' + this.usernameInputField.value;\r\n      this.profileUrlAnchor.innerText = url;\r\n      this.profileUrlAnchor.href = url;\r\n    }\r\n  }\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport {SettingSection} from '..';\r\nimport Row from '../../row';\r\nimport CheckboxField from '../../checkboxField';\r\nimport {InputNotifyPeer, Update} from '../../../layer';\r\nimport {SliderSuperTabEventable} from '../../sliderTab';\r\nimport rootScope from '../../../lib/rootScope';\r\nimport {LangPackKey} from '../../../lib/langPack';\r\nimport copy from '../../../helpers/object/copy';\r\nimport convertKeyToInputKey from '../../../helpers/string/convertKeyToInputKey';\r\nimport {MUTE_UNTIL} from '../../../lib/mtproto/mtproto_config';\r\nimport apiManagerProxy from '../../../lib/mtproto/mtprotoworker';\r\n\r\ntype InputNotifyKey = Exclude<InputNotifyPeer['_'], 'inputNotifyPeer'>;\r\n\r\nexport default class AppNotificationsTab extends SliderSuperTabEventable {\r\n  protected init() {\r\n    this.header.classList.add('with-border');\r\n    this.container.classList.add('notifications-container', 'with-border');\r\n    this.setTitle('Telegram.NotificationSettingsViewController');\r\n\r\n    const NotifySection = (options: {\r\n      name: LangPackKey,\r\n      typeText: LangPackKey,\r\n      inputKey: InputNotifyKey,\r\n    }) => {\r\n      const section = new SettingSection({\r\n        name: options.name\r\n      });\r\n\r\n      const enabledRow = new Row({\r\n        checkboxField: new CheckboxField({text: options.typeText, checked: true}),\r\n        subtitleLangKey: 'Loading',\r\n        listenerSetter: this.listenerSetter\r\n      });\r\n\r\n      const previewEnabledRow = new Row({\r\n        checkboxField: new CheckboxField({text: 'MessagePreview', checked: true}),\r\n        subtitleLangKey: 'Loading',\r\n        listenerSetter: this.listenerSetter\r\n      });\r\n\r\n      section.content.append(enabledRow.container, previewEnabledRow.container);\r\n\r\n      this.scrollable.append(section.container);\r\n\r\n      const inputNotifyPeer = {_: options.inputKey};\r\n      const ret = this.managers.appNotificationsManager.getNotifySettings(inputNotifyPeer);\r\n      (ret instanceof Promise ? ret : Promise.resolve(ret)).then((notifySettings) => {\r\n        const applySettings = async() => {\r\n          const muted = await this.managers.appNotificationsManager.isMuted(notifySettings);\r\n          enabledRow.checkboxField.checked = !muted;\r\n          previewEnabledRow.checkboxField.checked = notifySettings.show_previews;\r\n\r\n          return muted;\r\n        };\r\n\r\n        applySettings();\r\n\r\n        this.eventListener.addEventListener('destroy', async() => {\r\n          const mute = !enabledRow.checkboxField.checked;\r\n          const showPreviews = previewEnabledRow.checkboxField.checked;\r\n\r\n          if(mute === (await this.managers.appNotificationsManager.isMuted(notifySettings)) && showPreviews === notifySettings.show_previews) {\r\n            return;\r\n          }\r\n\r\n          const inputSettings: any = copy(notifySettings);\r\n          inputSettings._ = 'inputPeerNotifySettings';\r\n          inputSettings.mute_until = mute ? MUTE_UNTIL : 0;\r\n          inputSettings.show_previews = showPreviews;\r\n\r\n          this.managers.appNotificationsManager.updateNotifySettings(inputNotifyPeer, inputSettings);\r\n        }, {once: true});\r\n\r\n        this.listenerSetter.add(rootScope)('notify_settings', (update: Update.updateNotifySettings) => {\r\n          const inputKey = convertKeyToInputKey(update.peer._) as any;\r\n          if(options.inputKey === inputKey) {\r\n            notifySettings = update.notify_settings;\r\n            applySettings();\r\n          }\r\n        });\r\n      });\r\n    };\r\n\r\n    NotifySection({\r\n      name: 'NotificationsPrivateChats',\r\n      typeText: 'NotificationsForPrivateChats',\r\n      inputKey: 'inputNotifyUsers'\r\n    });\r\n\r\n    NotifySection({\r\n      name: 'NotificationsGroups',\r\n      typeText: 'NotificationsForGroups',\r\n      inputKey: 'inputNotifyChats'\r\n    });\r\n\r\n    NotifySection({\r\n      name: 'NotificationsChannels',\r\n      typeText: 'NotificationsForChannels',\r\n      inputKey: 'inputNotifyBroadcasts'\r\n    });\r\n\r\n    {\r\n      const section = new SettingSection({\r\n        name: 'NotificationsOther'\r\n      });\r\n\r\n      const contactsSignUpRow = new Row({\r\n        checkboxField: new CheckboxField({text: 'ContactJoined', checked: true}),\r\n        subtitleLangKey: 'Loading',\r\n        listenerSetter: this.listenerSetter\r\n      });\r\n\r\n      const soundRow = new Row({\r\n        checkboxField: new CheckboxField({text: 'Notifications.Sound', checked: true, stateKey: 'settings.notifications.sound', listenerSetter: this.listenerSetter}),\r\n        subtitleLangKey: 'Loading',\r\n        listenerSetter: this.listenerSetter\r\n      });\r\n\r\n      apiManagerProxy.getState().then((state) => {\r\n        soundRow.checkboxField.checked = state.settings.notifications.sound;\r\n      });\r\n\r\n      section.content.append(contactsSignUpRow.container, soundRow.container);\r\n\r\n      this.scrollable.append(section.container);\r\n\r\n      this.managers.appNotificationsManager.getContactSignUpNotification().then((enabled) => {\r\n        contactsSignUpRow.checkboxField.checked = enabled;\r\n\r\n        this.eventListener.addEventListener('destroy', () => {\r\n          const _enabled = contactsSignUpRow.checkboxField.checked;\r\n          if(enabled !== _enabled) {\r\n            this.managers.appNotificationsManager.setContactSignUpNotification(!_enabled);\r\n          }\r\n        }, {once: true});\r\n      });\r\n    }\r\n  }\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport {SettingSection} from '..';\r\nimport {randomLong} from '../../../helpers/random';\r\nimport I18n from '../../../lib/langPack';\r\nimport RadioField from '../../radioField';\r\nimport Row, {RadioFormFromRows} from '../../row';\r\nimport {SliderSuperTab} from '../../slider'\r\n\r\nexport default class AppLanguageTab extends SliderSuperTab {\r\n  protected async init() {\r\n    this.header.classList.add('with-border');\r\n    this.container.classList.add('language-container');\r\n    this.setTitle('Telegram.LanguageViewController');\r\n\r\n    const section = new SettingSection({});\r\n\r\n    const radioRows: Map<string, Row> = new Map();\r\n\r\n    const promise = Promise.all([\r\n      this.managers.apiManager.invokeApiCacheable('langpack.getLanguages', {\r\n        lang_pack: 'web'\r\n      }),\r\n      this.managers.apiManager.invokeApiCacheable('langpack.getLanguages', {\r\n        lang_pack: 'macos'\r\n      }),\r\n    ]).then(([languages1, languages2]) => {\r\n      const rendered: Set<string> = new Set();\r\n      const webLangCodes = languages1.map((language) => language.lang_code);\r\n\r\n      const random = randomLong();\r\n      languages1.concat(languages2).forEach((language) => {\r\n        if(rendered.has(language.lang_code)) return;\r\n        rendered.add(language.lang_code);\r\n\r\n        const row = new Row({\r\n          radioField: new RadioField({\r\n            text: language.name,\r\n            name: random,\r\n            value: language.lang_code\r\n          }),\r\n          subtitle: language.native_name\r\n        });\r\n\r\n        radioRows.set(language.lang_code, row);\r\n      });\r\n\r\n      const form = RadioFormFromRows([...radioRows.values()], (value) => {\r\n        I18n.getLangPack(value, webLangCodes.includes(value));\r\n      });\r\n\r\n      I18n.getCacheLangPack().then((langPack) => {\r\n        const row = radioRows.get(langPack.lang_code);\r\n        if(!row) {\r\n          console.error('no row', row, langPack);\r\n          return;\r\n        }\r\n\r\n        row.radioField.setValueSilently(true);\r\n      });\r\n\r\n      section.content.append(form);\r\n    });\r\n\r\n    this.scrollable.append(section.container);\r\n\r\n    return promise;\r\n  }\r\n}\r\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport type ListenerSetter from '../../../../helpers/listenerSetter';\nimport {SettingSection} from '../..';\nimport {LangPackKey} from '../../../../lib/langPack';\nimport CheckboxField from '../../../checkboxField';\nimport {SliderSuperTabEventable} from '../../../sliderTab';\n\nexport function autoDownloadPeerTypeSection(type: 'photo' | 'video' | 'file', title: LangPackKey, listenerSetter: ListenerSetter) {\n  const section = new SettingSection({name: title});\n\n  const key = 'settings.autoDownload.' + type + '.';\n  const contactsCheckboxField = new CheckboxField({\n    text: 'AutodownloadContacts',\n    name: 'contacts',\n    stateKey: key + 'contacts',\n    withRipple: true,\n    listenerSetter\n  });\n  const privateCheckboxField = new CheckboxField({\n    text: 'AutodownloadPrivateChats',\n    name: 'private',\n    stateKey: key + 'private',\n    withRipple: true,\n    listenerSetter\n  });\n  const groupsCheckboxField = new CheckboxField({\n    text: 'AutodownloadGroupChats',\n    name: 'groups',\n    stateKey: key + 'groups',\n    withRipple: true,\n    listenerSetter\n  });\n  const channelsCheckboxField = new CheckboxField({\n    text: 'AutodownloadChannels',\n    name: 'channels',\n    stateKey: key + 'channels',\n    withRipple: true,\n    listenerSetter\n  });\n\n  section.content.append(\n    contactsCheckboxField.label,\n    privateCheckboxField.label,\n    groupsCheckboxField.label,\n    channelsCheckboxField.label\n  );\n\n  return section;\n}\n\nexport default class AppAutoDownloadPhotoTab extends SliderSuperTabEventable {\n  protected init() {\n    this.header.classList.add('with-border');\n    this.setTitle('AutoDownloadPhotos');\n\n    const section = autoDownloadPeerTypeSection('photo', 'AutoDownloadPhotosTitle', this.listenerSetter);\n    this.scrollable.append(section.container);\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport formatBytes from '../../../../helpers/formatBytes';\nimport debounce from '../../../../helpers/schedulers/debounce';\nimport I18n from '../../../../lib/langPack';\nimport rootScope from '../../../../lib/rootScope';\nimport {SliderSuperTabEventable} from '../../../sliderTab';\nimport {RangeSettingSelector} from '../generalSettings';\nimport {autoDownloadPeerTypeSection} from './photo';\n\nexport default class AppAutoDownloadFileTab extends SliderSuperTabEventable {\n  protected init() {\n    this.header.classList.add('with-border');\n    this.setTitle('AutoDownloadFiles');\n\n    const debouncedSave = debounce((sizeMax: number) => {\n      this.managers.appStateManager.setByKey('settings.autoDownloadNew.file_size_max', sizeMax);\n    }, 200, false, true);\n\n    const section = autoDownloadPeerTypeSection('file', 'AutoDownloadFilesTitle', this.listenerSetter);\n\n    const MIN = 512 * 1024;\n    // const MAX = 2 * 1024 * 1024 * 1024;\n    const MAX = 20 * 1024 * 1024;\n    const MAX_RANGE = MAX - MIN;\n\n    const sizeMax = rootScope.settings.autoDownloadNew.file_size_max;\n    const value = Math.sqrt(Math.sqrt((sizeMax - MIN) / MAX_RANGE));\n    const upTo = new I18n.IntlElement({\n      key: 'AutodownloadSizeLimitUpTo',\n      args: [formatBytes(sizeMax)]\n    });\n    const range = new RangeSettingSelector('AutoDownloadMaxFileSize', 0.01, value, 0, 1, false);\n    range.onChange = (value) => {\n      const sizeMax = (value ** 4 * MAX_RANGE + MIN) | 0;\n\n      upTo.compareAndUpdate({args: [formatBytes(sizeMax)]});\n\n      debouncedSave(sizeMax);\n    };\n\n    range.valueContainer.append(upTo.element);\n\n    section.content.append(range.container);\n\n    this.scrollable.append(section.container);\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport {SliderSuperTabEventable} from '../../../sliderTab';\nimport {autoDownloadPeerTypeSection} from './photo';\n\nexport default class AppAutoDownloadVideoTab extends SliderSuperTabEventable {\n  protected init() {\n    this.header.classList.add('with-border');\n    this.setTitle('AutoDownloadVideos');\n\n    const section = autoDownloadPeerTypeSection('video', 'AutoDownloadVideosTitle', this.listenerSetter);\n    this.scrollable.append(section.container);\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport {AutoDownloadPeerTypeSettings, STATE_INIT} from '../../../config/state';\nimport {SettingSection} from '..';\nimport {attachClickEvent} from '../../../helpers/dom/clickEvent';\nimport replaceContent from '../../../helpers/dom/replaceContent';\nimport toggleDisability from '../../../helpers/dom/toggleDisability';\nimport formatBytes from '../../../helpers/formatBytes';\nimport copy from '../../../helpers/object/copy';\nimport deepEqual from '../../../helpers/object/deepEqual';\nimport {FormatterArguments, i18n, join, LangPackKey} from '../../../lib/langPack';\nimport rootScope from '../../../lib/rootScope';\nimport Button from '../../button';\nimport CheckboxField from '../../checkboxField';\nimport confirmationPopup from '../../confirmationPopup';\nimport Row from '../../row';\nimport {SliderSuperTabEventable, SliderSuperTabEventableConstructable} from '../../sliderTab';\nimport AppAutoDownloadFileTab from './autoDownload/file';\nimport AppAutoDownloadPhotoTab from './autoDownload/photo';\nimport AppAutoDownloadVideoTab from './autoDownload/video';\nimport apiManagerProxy from '../../../lib/mtproto/mtprotoworker';\n\nconst AUTO_DOWNLOAD_FOR_KEYS: {[k in keyof AutoDownloadPeerTypeSettings]: LangPackKey} = {\n  contacts: 'AutoDownloadContacts',\n  private: 'AutoDownloadPm',\n  groups: 'AutoDownloadGroups',\n  channels: 'AutoDownloadChannels'\n};\n\nexport default class AppDataAndStorageTab extends SliderSuperTabEventable {\n  protected async init() {\n    this.header.classList.add('with-border');\n    this.setTitle('DataSettings');\n\n    {\n      const section = new SettingSection({name: 'AutomaticMediaDownload', caption: 'AutoDownloadAudioInfo'});\n\n      const state = await apiManagerProxy.getState();\n\n      const autoCheckboxField = new CheckboxField({\n        text: 'AutoDownloadMedia',\n        name: 'auto',\n        checked: !state.settings.autoDownloadNew.pFlags.disabled,\n        withRipple: true\n      });\n\n      const onChange = () => {\n        toggleDisability([resetButton],\n          deepEqual(state.settings.autoDownload, STATE_INIT.settings.autoDownload) &&\n          deepEqual(state.settings.autoDownloadNew, STATE_INIT.settings.autoDownloadNew));\n      };\n\n      const setSubtitles = () => {\n        this.setAutoDownloadSubtitle(photoRow, state.settings.autoDownload.photo /* state.settings.autoDownloadNew.photo_size_max */);\n        this.setAutoDownloadSubtitle(videoRow, state.settings.autoDownload.video/* , state.settings.autoDownloadNew.video_size_max */);\n        this.setAutoDownloadSubtitle(fileRow, state.settings.autoDownload.file, state.settings.autoDownloadNew.file_size_max);\n      };\n\n      const openTab = (tabConstructor: SliderSuperTabEventableConstructable) => {\n        const tab = this.slider.createTab(tabConstructor);\n        tab.open();\n\n        this.listenerSetter.add(tab.eventListener)('destroy', () => {\n          setSubtitles();\n          onChange();\n        }, {once: true});\n      };\n\n      const photoRow = new Row({\n        titleLangKey: 'AutoDownloadPhotos',\n        subtitle: '',\n        clickable: () => {\n          openTab(AppAutoDownloadPhotoTab);\n        },\n        listenerSetter: this.listenerSetter\n      });\n\n      const videoRow = new Row({\n        titleLangKey: 'AutoDownloadVideos',\n        subtitle: '',\n        clickable: () => {\n          openTab(AppAutoDownloadVideoTab);\n        },\n        listenerSetter: this.listenerSetter\n      });\n\n      const fileRow = new Row({\n        titleLangKey: 'AutoDownloadFiles',\n        subtitle: '',\n        clickable: () => {\n          openTab(AppAutoDownloadFileTab);\n        },\n        listenerSetter: this.listenerSetter\n      });\n\n      const resetButton = Button('btn-primary btn-transparent primary', {icon: 'delete', text: 'ResetAutomaticMediaDownload'});\n      attachClickEvent(resetButton, () => {\n        confirmationPopup({\n          titleLangKey: 'ResetAutomaticMediaDownloadAlertTitle',\n          descriptionLangKey: 'ResetAutomaticMediaDownloadAlert',\n          button: {\n            langKey: 'Reset'\n          }\n        }).then(() => {\n          const settings = rootScope.settings;\n          settings.autoDownloadNew = copy(STATE_INIT.settings.autoDownloadNew);\n          settings.autoDownload = copy(STATE_INIT.settings.autoDownload);\n          state.settings = settings;\n          this.managers.appStateManager.setByKey('settings', settings);\n\n          setSubtitles();\n          autoCheckboxField.checked = !state.settings.autoDownloadNew.pFlags.disabled;\n        });\n      });\n\n      const onDisabledChange = () => {\n        const disabled = !autoCheckboxField.checked;\n\n        const settings = rootScope.settings;\n        if(disabled) {\n          settings.autoDownloadNew.pFlags.disabled = true;\n        } else {\n          delete settings.autoDownloadNew.pFlags.disabled;\n        }\n\n        [photoRow, videoRow, fileRow].forEach((row) => {\n          row.container.classList.toggle('is-disabled', disabled);\n        });\n\n        this.managers.appStateManager.setByKey('settings', settings);\n\n        onChange();\n      };\n\n      autoCheckboxField.input.addEventListener('change', onDisabledChange);\n      onDisabledChange();\n      setSubtitles();\n\n      section.content.append(\n        autoCheckboxField.label,\n        photoRow.container,\n        videoRow.container,\n        fileRow.container,\n        resetButton\n      );\n\n      this.scrollable.append(section.container);\n    }\n\n    {\n      const section = new SettingSection({name: 'AutoplayMedia'});\n\n      const gifsCheckboxField = new CheckboxField({\n        text: 'AutoplayGIF',\n        name: 'gifs',\n        stateKey: 'settings.autoPlay.gifs',\n        withRipple: true,\n        listenerSetter: this.listenerSetter\n      });\n      const videosCheckboxField = new CheckboxField({\n        text: 'AutoplayVideo',\n        name: 'videos',\n        stateKey: 'settings.autoPlay.videos',\n        withRipple: true,\n        listenerSetter: this.listenerSetter\n      });\n\n      section.content.append(gifsCheckboxField.label, videosCheckboxField.label);\n\n      this.scrollable.append(section.container);\n    }\n  }\n\n  private setAutoDownloadSubtitle(row: Row, settings: AutoDownloadPeerTypeSettings, sizeMax?: number) {\n    let key: LangPackKey;\n    const args: FormatterArguments = [];\n\n    const peerKeys = Object.keys(settings) as (keyof typeof AUTO_DOWNLOAD_FOR_KEYS)[];\n    const enabledKeys = peerKeys.map((key) => settings[key] ? AUTO_DOWNLOAD_FOR_KEYS[key] : undefined).filter(Boolean);\n    if(!enabledKeys.length || sizeMax === 0) {\n      key = 'AutoDownloadOff';\n    } else {\n      const isAll = enabledKeys.length === peerKeys.length;\n      if(sizeMax !== undefined) {\n        key = isAll ? 'AutoDownloadUpToOnAllChats' : 'AutoDownloadOnUpToFor';\n        args.push(formatBytes(sizeMax));\n      } else {\n        key = isAll ? 'AutoDownloadOnAllChats' : 'AutoDownloadOnFor';\n      }\n\n      if(!isAll) {\n        const fragment = document.createElement('span');\n        fragment.append(...join(enabledKeys.map((key) => i18n(key)), true, false));\n        args.push(fragment);\n      }\n    }\n\n    replaceContent(row.subtitle, i18n(key, args));\n  }\n}\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport {SliderSuperTab} from '../../slider';\r\nimport ButtonMenuToggle from '../../buttonMenuToggle';\r\nimport Button from '../../button';\r\nimport AppPrivacyAndSecurityTab from './privacyAndSecurity';\r\nimport AppGeneralSettingsTab from './generalSettings';\r\nimport AppEditProfileTab from './editProfile';\r\nimport AppChatFoldersTab from './chatFolders';\r\nimport AppNotificationsTab from './notifications';\r\nimport AppLanguageTab from './language';\r\nimport lottieLoader from '../../../lib/rlottie/lottieLoader';\r\nimport PopupPeer from '../../popups/peer';\r\nimport AppDataAndStorageTab from './dataAndStorage';\r\nimport ButtonIcon from '../../buttonIcon';\r\nimport PeerProfile from '../../peerProfile';\r\nimport rootScope from '../../../lib/rootScope';\r\nimport {SettingSection} from '..';\r\nimport Row from '../../row';\r\nimport AppActiveSessionsTab from './activeSessions';\r\nimport {i18n, LangPackKey} from '../../../lib/langPack';\r\nimport {SliderSuperTabConstructable} from '../../sliderTab';\r\nimport PopupAvatar from '../../popups/avatar';\r\nimport {AccountAuthorizations, Authorization} from '../../../layer';\r\nimport PopupElement from '../../popups';\r\nimport {attachClickEvent} from '../../../helpers/dom/clickEvent';\r\n// import AppMediaViewer from \"../../appMediaViewerNew\";\r\n\r\nexport default class AppSettingsTab extends SliderSuperTab {\r\n  private buttons: {\r\n    edit: HTMLButtonElement,\r\n    folders: HTMLButtonElement,\r\n    general: HTMLButtonElement,\r\n    notifications: HTMLButtonElement,\r\n    storage: HTMLButtonElement,\r\n    privacy: HTMLButtonElement,\r\n  } = {} as any;\r\n  private profile: PeerProfile;\r\n\r\n  private languageRow: Row;\r\n  private devicesRow: Row;\r\n\r\n  private authorizations: Authorization.authorization[];\r\n  private getAuthorizationsPromise: Promise<AccountAuthorizations.accountAuthorizations>;\r\n\r\n  protected async init() {\r\n    this.container.classList.add('settings-container');\r\n    this.setTitle('Settings');\r\n\r\n    const btnMenu = ButtonMenuToggle({listenerSetter: this.listenerSetter}, 'bottom-left', [{\r\n      icon: 'logout',\r\n      text: 'EditAccount.Logout',\r\n      onClick: () => {\r\n        new PopupPeer('logout', {\r\n          titleLangKey: 'LogOut',\r\n          descriptionLangKey: 'LogOut.Description',\r\n          buttons: [{\r\n            langKey: 'LogOut',\r\n            callback: () => {\r\n              this.managers.apiManager.logOut();\r\n            },\r\n            isDanger: true\r\n          }]\r\n        }).show();\r\n      }\r\n    }]);\r\n\r\n    this.buttons.edit = ButtonIcon('edit');\r\n\r\n    this.header.append(this.buttons.edit, btnMenu);\r\n\r\n    this.profile = new PeerProfile(this.managers, this.scrollable, this.listenerSetter, false);\r\n    this.profile.init();\r\n    this.profile.setPeer(rootScope.myId);\r\n    const fillPromise = this.profile.fillProfileElements();\r\n\r\n    const changeAvatarBtn = Button('btn-circle btn-corner z-depth-1 profile-change-avatar', {icon: 'cameraadd'});\r\n    attachClickEvent(changeAvatarBtn, () => {\r\n      const canvas = document.createElement('canvas');\r\n      PopupElement.createPopup(PopupAvatar).open(canvas, (upload) => {\r\n        upload().then((inputFile) => {\r\n          return this.managers.appProfileManager.uploadProfilePhoto(inputFile);\r\n        });\r\n      });\r\n    }, {listenerSetter: this.listenerSetter});\r\n    this.profile.element.lastElementChild.firstElementChild.append(changeAvatarBtn);\r\n\r\n    const updateChangeAvatarBtn = async() => {\r\n      const user = await this.managers.appUsersManager.getSelf();\r\n      changeAvatarBtn.classList.toggle('hide', user.photo?._ !== 'userProfilePhoto');\r\n    };\r\n\r\n    updateChangeAvatarBtn();\r\n    this.listenerSetter.add(rootScope)('avatar_update', (peerId) => {\r\n      if(rootScope.myId === peerId) {\r\n        updateChangeAvatarBtn();\r\n      }\r\n    });\r\n\r\n    /* const div = document.createElement('div');\r\n    //div.style.cssText = 'border-radius: 8px; overflow: hidden; width: 396px; height: 264px; flex: 0 0 auto; position: relative; margin: 10rem 0 10rem auto;';\r\n    //div.style.width = '135px';\r\n    //div.style.height = '100px';\r\n    div.style.cssText = 'border-radius: 8px; overflow: hidden; width: 396px; height: 264px; flex: 0 0 auto; position: relative; margin: 10rem auto 10rem 0;';\r\n    div.style.width = '135px';\r\n    div.style.height = '100px';\r\n\r\n    const img = document.createElement('img');\r\n    img.src = 'assets/img/pepe.jpg';\r\n    img.classList.add('media-photo');\r\n    img.style.cssText = 'max-width: 100%;max-height: 100%;';\r\n\r\n    div.append(img);\r\n\r\n    div.addEventListener('click', () => {\r\n      new AppMediaViewer().setSearchContext({peerId: 61004386, inputFilter: 'inputMessagesFilterPhotos'}).openMedia({\r\n        _: 'message',\r\n        mid: 1,\r\n        peerId: 61004386,\r\n        fromId: 61004386,\r\n        message: '',\r\n        media: {\r\n          _: 'messageMediaPhoto',\r\n          photo: {\r\n            _: 'photo',\r\n            url: img.src,\r\n            downloaded: 111,\r\n            sizes: [{\r\n              _: 'photoSize',\r\n              type: 'x',\r\n              w: 618,\r\n              h: 412\r\n            }]\r\n          }\r\n        },\r\n        date: Date.now() / 1000 | 0\r\n      }, img);\r\n    });\r\n\r\n    this.scrollable.append(div); */\r\n\r\n    const buttonsDiv = document.createElement('div');\r\n    buttonsDiv.classList.add('profile-buttons');\r\n\r\n    const b: [string, LangPackKey, SliderSuperTabConstructable][] = [\r\n      ['unmute', 'AccountSettings.Notifications', AppNotificationsTab],\r\n      ['data', 'DataSettings', AppDataAndStorageTab],\r\n      ['lock', 'AccountSettings.PrivacyAndSecurity', AppPrivacyAndSecurityTab],\r\n      ['settings', 'Telegram.GeneralSettingsViewController', AppGeneralSettingsTab],\r\n      ['folder', 'AccountSettings.Filters', AppChatFoldersTab]\r\n    ];\r\n\r\n    const rows = b.map(([icon, langPackKey, tabConstructor]) => {\r\n      return new Row({\r\n        titleLangKey: langPackKey,\r\n        icon,\r\n        clickable: () => {\r\n          this.slider.createTab(tabConstructor).open();\r\n          // new tabConstructor(this.slider, true).open();\r\n        },\r\n        listenerSetter: this.listenerSetter\r\n      });\r\n    });\r\n\r\n    rows.push(\r\n      this.devicesRow = new Row({\r\n        titleLangKey: 'Devices',\r\n        titleRightSecondary: ' ',\r\n        icon: 'activesessions',\r\n        clickable: async() => {\r\n          if(!this.authorizations) {\r\n            await this.updateActiveSessions();\r\n          }\r\n\r\n          const tab = this.slider.createTab(AppActiveSessionsTab);\r\n          tab.authorizations = this.authorizations;\r\n          tab.eventListener.addEventListener('destroy', () => {\r\n            this.authorizations = undefined;\r\n            this.updateActiveSessions(true);\r\n          }, {once: true});\r\n          tab.open();\r\n        },\r\n        listenerSetter: this.listenerSetter\r\n      }),\r\n\r\n      this.languageRow = new Row({\r\n        titleLangKey: 'AccountSettings.Language',\r\n        titleRightSecondary: i18n('LanguageName'),\r\n        icon: 'language',\r\n        clickable: () => {\r\n          this.slider.createTab(AppLanguageTab).open();\r\n        },\r\n        listenerSetter: this.listenerSetter\r\n      })\r\n    );\r\n\r\n    buttonsDiv.append(...rows.map((row) => row.container));\r\n\r\n    // const profileSection = new SettingSection({fullWidth: true, noPaddingTop: true});\r\n    // profileSection.content.append(this.profile.element);\r\n\r\n    const buttonsSection = new SettingSection();\r\n    buttonsSection.content.append(buttonsDiv);\r\n\r\n    this.scrollable.append(this.profile.element/* profileSection.container */, buttonsSection.container);\r\n\r\n    attachClickEvent(this.buttons.edit, () => {\r\n      const tab = this.slider.createTab(AppEditProfileTab);\r\n      tab.open();\r\n    }, {listenerSetter: this.listenerSetter});\r\n\r\n    lottieLoader.loadLottieWorkers();\r\n\r\n    this.updateActiveSessions();\r\n\r\n    await fillPromise;\r\n  }\r\n\r\n  private getAuthorizations(overwrite?: boolean) {\r\n    if(this.getAuthorizationsPromise && !overwrite) return this.getAuthorizationsPromise;\r\n\r\n    const promise = this.getAuthorizationsPromise = this.managers.apiManager.invokeApi('account.getAuthorizations')\r\n    .finally(() => {\r\n      if(this.getAuthorizationsPromise === promise) {\r\n        this.getAuthorizationsPromise = undefined;\r\n      }\r\n    });\r\n\r\n    return promise;\r\n  }\r\n\r\n  public updateActiveSessions(overwrite?: boolean) {\r\n    return this.getAuthorizations(overwrite).then((auths) => {\r\n      this.authorizations = auths.authorizations;\r\n      this.devicesRow.titleRight.textContent = '' + this.authorizations.length;\r\n    });\r\n  }\r\n\r\n  public onCloseAfterTimeout() {\r\n    this.profile.destroy();\r\n    return super.onCloseAfterTimeout();\r\n  }\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport appSidebarLeft, {SettingSection} from '..';\r\nimport {InputFile} from '../../../layer';\r\nimport InputField from '../../inputField';\r\nimport {SliderSuperTab} from '../../slider';\r\nimport AvatarEdit from '../../avatarEdit';\r\nimport AppAddMembersTab from './addMembers';\r\nimport {_i18n} from '../../../lib/langPack';\r\nimport ButtonCorner from '../../buttonCorner';\r\nimport appImManager from '../../../lib/appManagers/appImManager';\r\nimport {attachClickEvent} from '../../../helpers/dom/clickEvent';\r\n\r\nexport default class AppNewChannelTab extends SliderSuperTab {\r\n  private uploadAvatar: () => Promise<InputFile> = null;\r\n\r\n  private channelNameInputField: InputField;\r\n  private channelDescriptionInputField: InputField;\r\n  private nextBtn: HTMLButtonElement;\r\n  private avatarEdit: AvatarEdit;\r\n\r\n  protected init() {\r\n    this.container.classList.add('new-channel-container');\r\n    this.setTitle('NewChannel');\r\n\r\n    this.avatarEdit = new AvatarEdit((_upload) => {\r\n      this.uploadAvatar = _upload;\r\n    });\r\n\r\n    const section = new SettingSection({\r\n      caption: 'Channel.DescriptionHolderDescrpiton'\r\n    });\r\n\r\n    const inputWrapper = document.createElement('div');\r\n    inputWrapper.classList.add('input-wrapper');\r\n\r\n    this.channelNameInputField = new InputField({\r\n      label: 'EnterChannelName',\r\n      maxLength: 128\r\n    });\r\n\r\n    this.channelDescriptionInputField = new InputField({\r\n      label: 'DescriptionOptionalPlaceholder',\r\n      maxLength: 255\r\n    });\r\n\r\n    inputWrapper.append(this.channelNameInputField.container, this.channelDescriptionInputField.container);\r\n\r\n    const onLengthChange = () => {\r\n      this.nextBtn.classList.toggle('is-visible', !!this.channelNameInputField.value.length &&\r\n        !this.channelNameInputField.input.classList.contains('error') &&\r\n        !this.channelDescriptionInputField.input.classList.contains('error'));\r\n    };\r\n\r\n    this.channelNameInputField.input.addEventListener('input', onLengthChange);\r\n    this.channelDescriptionInputField.input.addEventListener('input', onLengthChange);\r\n\r\n    this.nextBtn = ButtonCorner({icon: 'arrow_next'});\r\n\r\n    attachClickEvent(this.nextBtn, () => {\r\n      const title = this.channelNameInputField.value;\r\n      const about = this.channelDescriptionInputField.value;\r\n\r\n      this.nextBtn.disabled = true;\r\n      this.managers.appChatsManager.createChannel({\r\n        title,\r\n        about,\r\n        broadcast: true\r\n      }).then((channelId) => {\r\n        if(this.uploadAvatar) {\r\n          this.uploadAvatar().then((inputFile) => {\r\n            this.managers.appChatsManager.editPhoto(channelId, inputFile);\r\n          });\r\n        }\r\n\r\n        appImManager.setInnerPeer({peerId: channelId.toPeerId(true)});\r\n\r\n        appSidebarLeft.removeTabFromHistory(this);\r\n        this.slider.createTab(AppAddMembersTab).open({\r\n          type: 'channel',\r\n          skippable: true,\r\n          title: 'GroupAddMembers',\r\n          placeholder: 'SendMessageTo',\r\n          takeOut: (peerIds) => {\r\n            return this.managers.appChatsManager.inviteToChannel(channelId, peerIds);\r\n          }\r\n        });\r\n      });\r\n    }, {listenerSetter: this.listenerSetter});\r\n\r\n    this.content.append(this.nextBtn);\r\n    section.content.append(this.avatarEdit.container, inputWrapper);\r\n    this.scrollable.append(section.container);\r\n  }\r\n\r\n  public onCloseAfterTimeout() {\r\n    this.avatarEdit.clear();\r\n    this.uploadAvatar = null;\r\n    this.channelNameInputField.value = '';\r\n    this.channelDescriptionInputField.value = '';\r\n    this.nextBtn.disabled = false;\r\n    return super.onCloseAfterTimeout();\r\n  }\r\n}\r\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport InputField from '../inputField';\nimport PopupElement from '.';\nimport {attachClickEvent} from '../../helpers/dom/clickEvent';\nimport EditPeer from '../editPeer';\nimport {_i18n} from '../../lib/langPack';\nimport TelInputField from '../telInputField';\nimport {formatPhoneNumber} from '../../helpers/formatPhoneNumber';\nimport {toastNew} from '../toast';\n\nexport default class PopupCreateContact extends PopupElement {\n  constructor() {\n    super('popup-create-contact popup-send-photo popup-new-media', {closable: true, withConfirm: 'Add', title: 'AddContactTitle'});\n    this.construct();\n  }\n\n  private async construct() {\n    attachClickEvent(this.btnConfirm, () => {\n      const promise = this.managers.appUsersManager.importContact(nameInputField.value, lastNameInputField.value, telInputField.value);\n\n      promise.then(() => {\n        this.hide();\n      }, (err) => {\n        if(err.type === 'NO_USER') {\n          toastNew({langPackKey: 'Contacts.PhoneNumber.NotRegistred'});\n          editPeer.disabled = false;\n        }\n      });\n\n      editPeer.lockWithPromise(promise);\n    }, {listenerSetter: this.listenerSetter});\n\n    const inputFields: InputField[] = [];\n    const div = document.createElement('div');\n    div.classList.add('name-fields');\n    const nameInputField = new InputField({\n      label: 'FirstName',\n      name: 'create-contact-name',\n      maxLength: 70,\n      required: true\n    });\n    const lastNameInputField = new InputField({\n      label: 'LastName',\n      name: 'create-contact-lastname',\n      maxLength: 70\n    });\n    const telInputField = new TelInputField({required: true});\n    inputFields.push(nameInputField, lastNameInputField, telInputField);\n\n    const onInput = () => {\n      const name = nameInputField.value + ' ' + lastNameInputField.value;\n      // const abbr = getAbbreviation(name);\n      editPeer.avatarElem.peerTitle = name;\n      editPeer.avatarElem.update();\n    };\n\n    this.listenerSetter.add(nameInputField.input)('input', onInput);\n    this.listenerSetter.add(lastNameInputField.input)('input', onInput);\n\n    telInputField.validate = () => {\n      return !!telInputField.value.match(/\\d/);\n    };\n\n    const user = await this.managers.appUsersManager.getSelf();\n    const formatted = formatPhoneNumber(user.phone);\n    if(formatted.code) {\n      telInputField.value = '+' + formatted.code.country_code;\n    }\n\n    const editPeer = new EditPeer({\n      inputFields,\n      listenerSetter: this.listenerSetter,\n      doNotEditAvatar: true,\n      nextBtn: this.btnConfirm,\n      avatarSize: 100\n    });\n\n    div.append(nameInputField.container, lastNameInputField.container, editPeer.avatarElem);\n    this.container.append(div, telInputField.container);\n\n    this.show();\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport {SliderSuperTab} from '../../slider';\nimport appDialogsManager from '../../../lib/appManagers/appDialogsManager';\nimport InputSearch from '../../inputSearch';\nimport {IS_MOBILE} from '../../../environment/userAgent';\nimport {canFocus} from '../../../helpers/dom/canFocus';\nimport windowSize from '../../../helpers/windowSize';\nimport ButtonCorner from '../../buttonCorner';\nimport {attachClickEvent} from '../../../helpers/dom/clickEvent';\nimport PopupCreateContact from '../../popups/createContact';\nimport SortedUserList from '../../sortedUserList';\nimport {getMiddleware} from '../../../helpers/middleware';\nimport replaceContent from '../../../helpers/dom/replaceContent';\nimport rootScope from '../../../lib/rootScope';\nimport PopupElement from '../../popups';\n\n// TODO:    ,      \n\nexport default class AppContactsTab extends SliderSuperTab {\n  private inputSearch: InputSearch;\n  private middleware: ReturnType<typeof getMiddleware>;\n  private sortedUserList: SortedUserList;\n\n  protected init() {\n    this.container.id = 'contacts-container';\n\n    // this.list = appDialogsManager.createChatList(/* {avatarSize: 48, handheldsSize: 66} */);\n\n    const btnAdd = ButtonCorner({icon: 'add', className: 'is-visible'});\n    this.content.append(btnAdd);\n\n    attachClickEvent(btnAdd, () => {\n      PopupElement.createPopup(PopupCreateContact);\n    }, {listenerSetter: this.listenerSetter});\n\n    this.inputSearch = new InputSearch('Search', (value) => {\n      this.openContacts(value);\n    });\n\n    this.listenerSetter.add(rootScope)('contacts_update', async(userId) => {\n      const isContact = await this.managers.appUsersManager.isContact(userId);\n      const peerId = userId.toPeerId();\n      if(isContact) this.sortedUserList.add(peerId);\n      else this.sortedUserList.delete(peerId);\n    });\n\n    this.title.replaceWith(this.inputSearch.container);\n\n    this.middleware = getMiddleware();\n\n    // preload contacts\n    // appUsersManager.getContacts();\n  }\n\n  protected createList() {\n    const sortedUserList = new SortedUserList({\n      managers: this.managers\n    });\n    const list = sortedUserList.list;\n    list.id = 'contacts';\n    list.classList.add('contacts-container');\n    appDialogsManager.setListClickListener(list, () => {\n      this.close();\n    }, undefined, true);\n    return sortedUserList;\n  }\n\n  protected onClose() {\n    this.middleware.clean();\n    /* // need to clear, and left 1 page for smooth slide\n    let pageCount = appPhotosManager.windowH / 72 * 1.25 | 0;\n    (Array.from(this.list.children) as HTMLElement[]).slice(pageCount).forEach((el) => el.remove()); */\n  }\n\n  protected onOpenAfterTimeout() {\n    if(IS_MOBILE || !canFocus(true)) return;\n    this.inputSearch.input.focus();\n  }\n\n  public openContacts(query?: string) {\n    if(this.init) {\n      this.init();\n      this.init = null;\n    }\n\n    this.middleware.clean();\n    const middleware = this.middleware.get();\n    this.scrollable.onScrolledBottom = null;\n    this.scrollable.container.textContent = '';\n\n    this.managers.appUsersManager.getContactsPeerIds(query, undefined, 'online').then((contacts) => {\n      if(!middleware()) {\n        return;\n      }\n\n      const sortedUserList = this.sortedUserList = this.createList();\n\n      let renderPage = () => {\n        const pageCount = windowSize.height / 72 * 1.25 | 0;\n        const arr = contacts.splice(0, pageCount); //  splice!\n\n        arr.forEach((peerId) => {\n          sortedUserList.add(peerId);\n        });\n\n        if(!contacts.length) {\n          renderPage = undefined;\n          this.scrollable.onScrolledBottom = null;\n        }\n      };\n\n      renderPage();\n      this.scrollable.onScrolledBottom = () => {\n        if(renderPage) {\n          renderPage();\n        } else {\n          this.scrollable.onScrolledBottom = null;\n        }\n      };\n\n      replaceContent(this.scrollable.container, sortedUserList.list);\n    });\n  }\n\n  public open() {\n    this.openContacts();\n    return super.open();\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport appDialogsManager from '../../../lib/appManagers/appDialogsManager';\nimport {SliderSuperTab} from '../../slider';\nimport {FOLDER_ID_ARCHIVE, REAL_FOLDER_ID} from '../../../lib/mtproto/mtproto_config';\n\nexport default class AppArchivedTab extends SliderSuperTab {\n  private static filterId: REAL_FOLDER_ID = FOLDER_ID_ARCHIVE;\n  private wasFilterId: number;\n\n  protected init() {\n    this.wasFilterId = appDialogsManager.filterId;\n\n    this.container.id = 'chats-archived-container';\n    this.setTitle('ArchivedChats');\n\n    if(!appDialogsManager.sortedLists[AppArchivedTab.filterId]) {\n      const chatList = appDialogsManager.createChatList();\n      const scrollable = appDialogsManager.generateScrollable(chatList, {\n        title: undefined,\n        id: AppArchivedTab.filterId,\n        localId: FOLDER_ID_ARCHIVE\n      });\n      scrollable.container.append(chatList);\n      appDialogsManager.setListClickListener(chatList, null, true);\n      // appDialogsManager.setListClickListener(archivedChatList, null, true); // * to test peer changing\n    }\n\n    const scrollable = appDialogsManager.scrollables[AppArchivedTab.filterId];\n    this.scrollable.container.replaceWith(scrollable.container);\n    this.scrollable = scrollable;\n\n    return appDialogsManager.setFilterIdAndChangeTab(AppArchivedTab.filterId).then(({cached, renderPromise}) => {\n      if(cached) {\n        return renderPromise;\n      }\n    });\n  }\n\n  // ,   ,         ...\n  onOpenAfterTimeout() {\n    appDialogsManager.sortedLists[this.wasFilterId].clear();\n  }\n\n  onClose() {\n    appDialogsManager.setFilterIdAndChangeTab(this.wasFilterId);\n  }\n\n  onCloseAfterTimeout() {\n    appDialogsManager.sortedLists[AppArchivedTab.filterId].clear();\n    return super.onCloseAfterTimeout();\n  }\n}\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport {SliderSuperTab} from '../../slider';\r\nimport ButtonCorner from '../../buttonCorner';\r\nimport AppNewGroupTab from './newGroup';\r\nimport {toast} from '../../toast';\r\nimport {ButtonMenuItemOptions} from '../../buttonMenu';\r\nimport {i18n, join, _i18n} from '../../../lib/langPack';\r\nimport rootScope from '../../../lib/rootScope';\r\nimport {wrapSticker} from '../../wrappers';\r\nimport SortedUserList from '../../sortedUserList';\r\nimport {PeerLocated, Update, Updates} from '../../../layer';\r\nimport {SettingChatListSection} from '..';\r\nimport appDialogsManager from '../../../lib/appManagers/appDialogsManager';\r\nimport {attachClickEvent} from '../../../helpers/dom/clickEvent';\r\nimport confirmationPopup from '../../confirmationPopup';\r\nimport getPeerId from '../../../lib/appManagers/utils/peers/getPeerId';\r\nimport type LazyLoadQueue from '../../lazyLoadQueue';\r\n\r\nexport default class AppPeopleNearbyTab extends SliderSuperTab {\r\n  private latestLocationSaved: {latitude: number, longitude: number, accuracy: number};\r\n  private isLocationWatched: boolean = false;\r\n  private errorCategory: HTMLElement;\r\n  private retryBtn: HTMLButtonElement;\r\n  private btnOptions: HTMLButtonElement;\r\n  private menuButtons: (ButtonMenuItemOptions & {verify?: () => boolean})[];\r\n\r\n  protected lazyLoadQueue: LazyLoadQueue;\r\n  protected peopleSection: SettingChatListSection;\r\n  protected chatsSection: SettingChatListSection;\r\n\r\n  protected locatedPeers: Map<PeerId, PeerLocated.peerLocated>;\r\n\r\n  // protected async init() {\r\n  //   this.container.classList.add('people-nearby-container');\r\n  //   this.setTitle('PeopleNearby');\r\n\r\n  //   this.errorCategory = document.createElement('div');\r\n  //   this.errorCategory.classList.add('text', 'hide', 'nearby-error');\r\n\r\n  //   this.retryBtn = ButtonCorner({icon: 'check'});\r\n\r\n  //   const emoji = '';\r\n  //   const doc = await this.managers.appStickersManager.getAnimatedEmojiSticker(emoji);\r\n  //   const stickerContainer = document.createElement('div');\r\n  //   stickerContainer.classList.add('sticker-container');\r\n\r\n  //   if(doc) {\r\n  //     wrapSticker({\r\n  //       doc,\r\n  //       div: stickerContainer,\r\n  //       loop: false,\r\n  //       play: true,\r\n  //       width: 86,\r\n  //       height: 86,\r\n  //       emoji,\r\n  //       needUpscale: true\r\n  //     }).then(() => {\r\n  //       // this.animation = player;\r\n  //     });\r\n  //   } else {\r\n  //     stickerContainer.classList.add('media-sticker-wrapper');\r\n  //   }\r\n\r\n  //   const caption = document.createElement('div');\r\n  //   caption.classList.add('caption');\r\n  //   _i18n(caption, 'PeopleNearbyInfo2');\r\n\r\n  //   this.locatedPeers = new Map();\r\n\r\n  //   const m = () => {\r\n  //     const sortedUserList = new SortedUserList({\r\n  //       avatarSize: 42,\r\n  //       createChatListOptions: {\r\n  //         dialogSize: 48,\r\n  //         new: true\r\n  //       },\r\n  //       autonomous: false,\r\n  //       onUpdate: (element) => {\r\n  //         const peer = this.locatedPeers.get(element.id);\r\n  //         const elements: HTMLElement[] = [\r\n  //           this.parseDistance(peer.distance)\r\n  //         ];\r\n\r\n  //         if(!element.id.isUser()) {\r\n  //           elements.push(this.managers.appProfileManager.getChatMembersString(element.id.toChatId()));\r\n  //         }\r\n\r\n  //         element.dom.lastMessageSpan.textContent = '';\r\n  //         element.dom.lastMessageSpan.append(...join(elements, false));\r\n  //       },\r\n  //       getIndex: (element) => {\r\n  //         const peer = this.locatedPeers.get(element.id);\r\n  //         return 0x7FFFFFFF - peer.distance;\r\n  //       },\r\n  //       appUsersManager: this.managers.appUsersManager\r\n  //     });\r\n\r\n  //     appDialogsManager.setListClickListener(sortedUserList.list, undefined, undefined, false);\r\n\r\n  //     return sortedUserList;\r\n  //   };\r\n\r\n  //   const peopleSection = this.peopleSection = new SettingChatListSection({\r\n  //     name: 'PeopleNearbyHeader',\r\n  //     sortedList: m()\r\n  //   });\r\n\r\n  //   const chatsSection = this.chatsSection = new SettingChatListSection({\r\n  //     name: 'ChatsNearbyHeader',\r\n  //     sortedList: m()\r\n  //   });\r\n\r\n  //   const btnMakeVisible = peopleSection.makeButton({\r\n  //     text: 'MakeMyselfVisible',\r\n  //     icon: 'location'\r\n  //   });\r\n\r\n  //   const btnMakeInvisible = peopleSection.makeButton({\r\n  //     text: 'StopShowingMe',\r\n  //     icon: 'location'\r\n  //   });\r\n\r\n  //   const btnCreateGroup = chatsSection.makeButton({\r\n  //     text: 'NearbyCreateGroup',\r\n  //     icon: 'newgroup'\r\n  //   });\r\n\r\n  //   attachClickEvent(btnMakeVisible, () => {\r\n  //     confirmationPopup({\r\n  //       titleLangKey: 'MakeMyselfVisibleTitle',\r\n  //       descriptionLangKey: 'MakeMyselfVisibleInfo',\r\n  //       button: {\r\n  //         langKey: 'OK'\r\n  //       }\r\n  //     }).then(() => {\r\n  //       this.startWatching();\r\n  //     });\r\n  //   }, {listenerSetter: this.listenerSetter});\r\n\r\n  //   attachClickEvent(btnMakeInvisible, () => {\r\n  //     this.stopWatching();\r\n  //   }, {listenerSetter: this.listenerSetter});\r\n\r\n  //   attachClickEvent(btnCreateGroup, () => {\r\n  //     this.slider.createTab(AppNewGroupTab).open([], true);\r\n  //   }, {listenerSetter: this.listenerSetter});\r\n\r\n  //   btnMakeVisible.classList.add('primary');\r\n  //   btnMakeInvisible.classList.add('danger');\r\n  //   btnCreateGroup.classList.add('primary');\r\n\r\n  //   this.content.append(this.retryBtn);\r\n  //   this.scrollable.append(\r\n  //     stickerContainer,\r\n  //     caption,\r\n  //     peopleSection.container,\r\n  //     chatsSection.container,\r\n  //     this.errorCategory\r\n  //   );\r\n  // }\r\n\r\n  private parseDistance(distance: number) {\r\n    if(rootScope.settings.distanceUnit === 'miles') {\r\n      if(distance > 1609.34) {\r\n        return i18n('MilesAway', [Math.round(distance / 1609)]);\r\n      } else {\r\n        return i18n('FootsAway', [Math.round(distance * 3.281)]);\r\n      }\r\n    } else {\r\n      if(distance >= 1000) {\r\n        return i18n('KMetersAway2', [distance / 1000]);\r\n      } else {\r\n        return i18n('MetersAway2', [distance]);\r\n      }\r\n    }\r\n  }\r\n\r\n  public open() {\r\n    const result = super.open();\r\n    result.then(() => {\r\n      this.retryBtn.classList.remove('is-visible');\r\n      navigator.geolocation.getCurrentPosition((location) => {\r\n        this.latestLocationSaved = {\r\n          latitude: location.coords.latitude,\r\n          longitude: location.coords.longitude,\r\n          accuracy: location.coords.accuracy\r\n        };\r\n\r\n        console.log(this.latestLocationSaved);\r\n\r\n        this.managers.appUsersManager.getLocated(\r\n          location.coords.latitude,\r\n          location.coords.longitude,\r\n          location.coords.accuracy\r\n        ).then((response) => {\r\n          const update = (response as Updates.updates).updates[0] as Update.updatePeerLocated;\r\n          const peers = update.peers as PeerLocated.peerLocated[];\r\n          const orderedPeers = peers.sort((a, b) => a.distance - b.distance);\r\n          const groupsCounter = peers.filter((e) => e.peer._ == 'peerChannel').length;\r\n          const usersCounter = peers.filter((e) => e.peer._ != 'peerChannel').length;\r\n          orderedPeers?.forEach((peer) => {\r\n            const peerId = getPeerId(peer.peer);\r\n            const section = peerId.isUser() ? this.peopleSection : this.chatsSection;\r\n            this.locatedPeers.set(peerId, peer);\r\n            section.sortedList.add(peerId);\r\n          });\r\n\r\n          this.errorCategory.classList.toggle('hide', !!(usersCounter || groupsCounter));\r\n          this.errorCategory.innerHTML = 'No groups or channels found around you.';\r\n        });\r\n      }, (error) => {\r\n        this.errorCategory.classList.remove('hide');\r\n        this.retryBtn.classList.add('is-visible');\r\n        this.retryBtn.addEventListener('click', this.open);\r\n        if(error instanceof GeolocationPositionError) {\r\n          this.errorCategory.innerHTML = 'Location permission denied. Click below to retry.';\r\n        } else {\r\n          this.errorCategory.innerHTML = 'An error has occurred. Please retry later clicking the button below.';\r\n        }\r\n      });\r\n    });\r\n\r\n    return result;\r\n  }\r\n\r\n  private startWatching() {\r\n    if(!this.latestLocationSaved || this.isLocationWatched) return;\r\n    this.isLocationWatched = true;\r\n\r\n    toast('Your position is now being shared. Do not close the page or it will be suspended.');\r\n\r\n    this.managers.appUsersManager.getLocated(\r\n      this.latestLocationSaved.latitude,\r\n      this.latestLocationSaved.longitude,\r\n      this.latestLocationSaved.accuracy,\r\n      true, // background parameter\r\n      0x7fffffff // self_expires parameter\r\n    );\r\n\r\n    navigator.geolocation.watchPosition((result) => {\r\n      const isLongitudeDifferent = result.coords.longitude !== this.latestLocationSaved.longitude;\r\n      const isLatitudeDifferent = result.coords.latitude !== this.latestLocationSaved.latitude;\r\n      const distanceCheck = this.calculateDistance(\r\n        result.coords.latitude, result.coords.longitude,\r\n        this.latestLocationSaved.latitude, this.latestLocationSaved.longitude\r\n      ) > 100;\r\n\r\n      if((isLatitudeDifferent || isLongitudeDifferent) && distanceCheck) {\r\n        this.managers.appUsersManager.getLocated(\r\n          result.coords.latitude,\r\n          result.coords.longitude,\r\n          result.coords.accuracy,\r\n          true, // background parameter\r\n          0x7fffffff // self_expires parameter\r\n        );\r\n        this.latestLocationSaved = {\r\n          latitude: result.coords.latitude,\r\n          longitude: result.coords.longitude,\r\n          accuracy: result.coords.accuracy\r\n        }\r\n      }\r\n    });\r\n  }\r\n\r\n  private stopWatching() {\r\n    if(!this.isLocationWatched) return;\r\n    this.isLocationWatched = false;\r\n    toast('The sharing of your position has been stopped. You will no longer be visible to other users.');\r\n    this.managers.appUsersManager.getLocated(\r\n      0, // latitude parameter\r\n      0, // longitude parameter\r\n      0, // accuracy parameter\r\n      false, // background parameter\r\n      0 // self_expires parameter\r\n    );\r\n  }\r\n\r\n  private calculateDistance(lat1: number, long1: number, lat2: number, long2: number) {\r\n    const p = 0.017453292519943295; // Math.PI/180\r\n    return (\r\n      12742 * Math.asin(\r\n        Math.sqrt(\r\n          (0.5 - Math.cos((lat2 - lat1) * p)) +\r\n          (\r\n            Math.cos(lat1 * p) * Math.cos(lat2 * p) *\r\n            (1 - Math.cos((long2 - long1) * p)/2)\r\n          )\r\n        )\r\n      )\r\n    );\r\n  }\r\n}\r\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport appImManager from '../../lib/appManagers/appImManager';\nimport rootScope from '../../lib/rootScope';\nimport {SearchGroup} from '../appSearch';\nimport '../avatar';\nimport Scrollable, {ScrollableX} from '../scrollable';\nimport InputSearch from '../inputSearch';\nimport SidebarSlider from '../slider';\nimport {TransitionSlider} from '../transition';\nimport AppNewGroupTab from './tabs/newGroup';\nimport AppSearchSuper from '../appSearchSuper.';\nimport {DateData, fillTipDates} from '../../helpers/date';\nimport {MOUNT_CLASS_TO} from '../../config/debug';\nimport AppSettingsTab from './tabs/settings';\nimport AppNewChannelTab from './tabs/newChannel';\nimport AppContactsTab from './tabs/contacts';\nimport AppArchivedTab from './tabs/archivedTab';\nimport AppAddMembersTab from './tabs/addMembers';\nimport I18n, {FormatterArguments, i18n, i18n_, LangPackKey} from '../../lib/langPack';\nimport AppPeopleNearbyTab from './tabs/peopleNearby';\nimport {ButtonMenuItemOptions} from '../buttonMenu';\nimport CheckboxField from '../checkboxField';\nimport {IS_MOBILE_SAFARI} from '../../environment/userAgent';\nimport appNavigationController, {NavigationItem} from '../appNavigationController';\nimport findUpClassName from '../../helpers/dom/findUpClassName';\nimport findUpTag from '../../helpers/dom/findUpTag';\nimport PeerTitle from '../peerTitle';\nimport App from '../../config/app';\nimport ButtonMenuToggle from '../buttonMenuToggle';\nimport replaceContent from '../../helpers/dom/replaceContent';\nimport sessionStorage from '../../lib/sessionStorage';\nimport {attachClickEvent, CLICK_EVENT_NAME, simulateClickEvent} from '../../helpers/dom/clickEvent';\nimport ButtonIcon from '../buttonIcon';\nimport confirmationPopup from '../confirmationPopup';\nimport IS_GEOLOCATION_SUPPORTED from '../../environment/geolocationSupport';\nimport type SortedUserList from '../sortedUserList';\nimport Button, {ButtonOptions} from '../button';\nimport noop from '../../helpers/noop';\nimport ripple from '../ripple';\nimport indexOfAndSplice from '../../helpers/array/indexOfAndSplice';\nimport formatNumber from '../../helpers/number/formatNumber';\nimport AvatarElement from '../avatar';\nimport {AppManagers} from '../../lib/appManagers/managers';\nimport themeController from '../../helpers/themeController';\nimport contextMenuController from '../../helpers/contextMenuController';\nimport {DIALOG_LIST_ELEMENT_TAG} from '../../lib/appManagers/appDialogsManager';\nimport apiManagerProxy from '../../lib/mtproto/mtprotoworker';\n\nexport const LEFT_COLUMN_ACTIVE_CLASSNAME = 'is-left-column-shown';\n\nexport class AppSidebarLeft extends SidebarSlider {\n  private toolsBtn: HTMLElement;\n  private backBtn: HTMLButtonElement;\n  // private searchInput = document.getElementById('global-search') as HTMLInputElement;\n  private inputSearch: InputSearch;\n\n  public archivedCount: HTMLSpanElement;\n\n  private newBtnMenu: HTMLElement;\n\n  // private log = logger('SL');\n\n  private searchGroups: {[k in 'contacts' | 'globalContacts' | 'messages' | 'people' | 'recent']: SearchGroup} = {} as any;\n  private searchSuper: AppSearchSuper;\n\n  private updateBtn: HTMLElement;\n  private hasUpdate: boolean;\n\n  constructor() {\n    super({\n      sidebarEl: document.getElementById('column-left') as HTMLDivElement,\n      navigationType: 'left'\n    });\n  }\n\n  construct(managers: AppManagers) {\n    this.managers = managers;\n    // this._selectTab(0); // make first tab as default\n\n    this.inputSearch = new InputSearch('Search');\n    const sidebarHeader = this.sidebarEl.querySelector('.item-main .sidebar-header');\n    sidebarHeader.append(this.inputSearch.container);\n\n    const onNewGroupClick = () => {\n      this.createTab(AppAddMembersTab).open({\n        type: 'chat',\n        skippable: false,\n        takeOut: (peerIds) => {\n          this.createTab(AppNewGroupTab).open(peerIds);\n        },\n        title: 'GroupAddMembers',\n        placeholder: 'SendMessageTo'\n      });\n    };\n\n    const onContactsClick = () => {\n      this.createTab(AppContactsTab).open();\n    };\n\n    // this.toolsBtn = this.sidebarEl.querySelector('.sidebar-tools-button') as HTMLButtonElement;\n    this.backBtn = this.sidebarEl.querySelector('.sidebar-back-button') as HTMLButtonElement;\n\n    const btnArchive: typeof menuButtons[0] = {\n      icon: 'archive',\n      text: 'ArchivedChats',\n      onClick: () => {\n        this.createTab(AppArchivedTab).open();\n      },\n      verify: async() => {\n        const folder = await this.managers.dialogsStorage.getFolderDialogs(1, false);\n        return !!folder.length || !(await this.managers.dialogsStorage.isDialogsLoaded(1));\n      }\n    };\n\n    const themeCheckboxField = new CheckboxField({\n      toggle: true,\n      checked: themeController.getTheme().name === 'night'\n    });\n    themeCheckboxField.input.addEventListener('change', async() => {\n      await this.managers.appStateManager.setByKey('settings.theme', themeCheckboxField.input.checked ? 'night' : 'day');\n      rootScope.dispatchEvent('theme_change');\n    });\n\n    rootScope.addEventListener('theme_change', () => {\n      themeCheckboxField.setValueSilently(themeController.getTheme().name === 'night');\n    });\n\n    const menuButtons: (ButtonMenuItemOptions & {verify?: () => boolean | Promise<boolean>})[] = [{\n      icon: 'saved',\n      text: 'SavedMessages',\n      onClick: () => {\n        setTimeout(() => { // menu doesn't close if no timeout (lol)\n          appImManager.setPeer({\n            peerId: appImManager.myId\n          });\n        }, 0);\n      }\n    }, btnArchive, {\n      icon: 'user',\n      text: 'Contacts',\n      onClick: onContactsClick\n    }, IS_GEOLOCATION_SUPPORTED ? {\n      icon: 'group',\n      text: 'PeopleNearby',\n      onClick: () => {\n        this.createTab(AppPeopleNearbyTab).open();\n      }\n    } : undefined, {\n      icon: 'settings',\n      text: 'Settings',\n      onClick: () => {\n        this.createTab(AppSettingsTab).open();\n      }\n    }, {\n      icon: 'darkmode',\n      text: 'DarkMode',\n      onClick: () => {\n\n      },\n      checkboxField: themeCheckboxField\n    }, {\n      icon: 'animations',\n      text: 'Animations',\n      onClick: () => {\n\n      },\n      checkboxField: new CheckboxField({\n        toggle: true,\n        checked: true,\n        stateKey: 'settings.animationsEnabled'\n      })\n    }, {\n      icon: 'help',\n      text: 'TelegramFeatures',\n      onClick: () => {\n        const url = I18n.format('TelegramFeaturesUrl', true);\n        appImManager.openUrl(url);\n      }\n    }, {\n      icon: 'bug',\n      text: 'ReportBug',\n      onClick: () => {\n        const a = document.createElement('a');\n        a.target = '_blank';\n        a.href = 'https://bugs.telegram.org/?tag_ids=40&sort=time';\n        document.body.append(a);\n        a.click();\n        setTimeout(() => {\n          a.remove();\n        }, 0);\n      }\n    }, {\n      icon: 'char z',\n      text: 'ChatList.Menu.SwitchTo.Z',\n      onClick: () => {\n        Promise.all([\n          sessionStorage.set({kz_version: 'Z'}),\n          sessionStorage.delete('tgme_sync')\n        ]).then(() => {\n          location.href = 'https://web.telegram.org/z/';\n        });\n      },\n      verify: () => App.isMainDomain\n    }, {\n      icon: 'char w',\n      text: 'ChatList.Menu.SwitchTo.Webogram',\n      onClick: () => {\n        sessionStorage.delete('tgme_sync').then(() => {\n          location.href = 'https://web.telegram.org/?legacy=1';\n        });\n      },\n      verify: () => App.isMainDomain\n    }];\n\n    const filteredButtons = menuButtons.filter(Boolean);\n\n    this.toolsBtn = ButtonMenuToggle({}, 'bottom-right', filteredButtons, async(e) => {\n      await Promise.all(filteredButtons.map(async(button) => {\n        if(button.verify) {\n          button.element.classList.toggle('hide', !(await button.verify()));\n        }\n      }));\n    });\n    this.toolsBtn.classList.remove('tgico-more');\n    this.toolsBtn.classList.add('sidebar-tools-button', 'is-visible');\n\n    this.backBtn.parentElement.insertBefore(this.toolsBtn, this.backBtn);\n\n    const btnMenu = this.toolsBtn.querySelector('.btn-menu') as HTMLElement;\n\n    const btnMenuFooter = document.createElement('a');\n    btnMenuFooter.href = 'https://github.com/morethanwords/tweb/blob/master/CHANGELOG.md';\n    btnMenuFooter.target = '_blank';\n    btnMenuFooter.rel = 'noopener noreferrer';\n    btnMenuFooter.classList.add('btn-menu-footer');\n    btnMenuFooter.addEventListener(CLICK_EVENT_NAME, (e) => {\n      e.stopPropagation();\n      contextMenuController.close();\n    });\n    const t = document.createElement('span');\n    t.classList.add('btn-menu-footer-text');\n    t.innerHTML = 'Telegram Web' + App.suffix + ' '/* ' alpha ' */ + App.versionFull;\n    btnMenuFooter.append(t);\n    btnMenu.classList.add('has-footer');\n    btnMenu.append(btnMenuFooter);\n\n    this.newBtnMenu = ButtonMenuToggle({}, 'top-left', [{\n      icon: 'newchannel',\n      text: 'NewChannel',\n      onClick: () => {\n        this.createTab(AppNewChannelTab).open();\n      }\n    }, {\n      icon: 'newgroup',\n      text: 'NewGroup',\n      onClick: onNewGroupClick\n    }, {\n      icon: 'newprivate',\n      text: 'NewPrivateChat',\n      onClick: onContactsClick\n    }]);\n    this.newBtnMenu.className = 'btn-circle rp btn-corner z-depth-1 btn-menu-toggle animated-button-icon';\n    this.newBtnMenu.insertAdjacentHTML('afterbegin', `\n    <span class=\"tgico tgico-newchat_filled\"></span>\n    <span class=\"tgico tgico-close\"></span>\n    `);\n    this.newBtnMenu.id = 'new-menu';\n    sidebarHeader.nextElementSibling.append(this.newBtnMenu);\n\n    this.updateBtn = document.createElement('div');\n    // this.updateBtn.classList.add('btn-update');\n    this.updateBtn.className = 'btn-circle rp btn-corner z-depth-1 btn-update is-hidden';\n    ripple(this.updateBtn);\n    this.updateBtn.append(i18n('Update'));\n    // const weave = new TopbarWeave();\n    // const weaveContainer = weave.render('btn-update-weave');\n    // this.updateBtn.prepend(weaveContainer);\n\n    attachClickEvent(this.updateBtn, () => {\n      if(this.updateBtn.classList.contains('is-hidden')) {\n        return;\n      }\n\n      location.reload();\n    });\n\n    sidebarHeader.nextElementSibling.append(this.updateBtn);\n\n    // setTimeout(() => {\n    //   weave.componentDidMount();\n    //   weave.setCurrentState(GROUP_CALL_STATE.MUTED, true);\n    //   weave.setAmplitude(0);\n    //   weave.handleBlur();\n    // }, 1e3);\n\n    this.inputSearch.input.addEventListener('focus', () => this.initSearch(), {once: true});\n\n    // parseMenuButtonsTo(this.newButtons, this.newBtnMenu.firstElementChild.children);\n\n    this.archivedCount = document.createElement('span');\n    this.archivedCount.className = 'archived-count badge badge-24 badge-gray';\n\n    btnArchive.element.append(this.archivedCount);\n\n    rootScope.addEventListener('folder_unread', (folder) => {\n      if(folder.id === 1) {\n        // const count = folder.unreadMessagesCount;\n        const count = folder.unreadPeerIds.size;\n        this.archivedCount.innerText = '' + formatNumber(count, 1);\n        this.archivedCount.classList.toggle('hide', !count);\n      }\n    });\n\n    this.managers.appUsersManager.getTopPeers('correspondents');\n\n    // Focus search input by pressing Escape\n    const navigationItem: NavigationItem = {\n      type: 'global-search-focus',\n      onPop: () => {\n        setTimeout(() => {\n          this.inputSearch.input.focus();\n        }, 0);\n\n        return false;\n      },\n      noHistory: true\n    };\n    appNavigationController.pushItem(navigationItem);\n\n    apiManagerProxy.getState().then((state) => {\n      const CHECK_UPDATE_INTERVAL = 1800e3;\n      const checkUpdateInterval = setInterval(() => {\n        fetch('version', {cache: 'no-cache'})\n        .then((res) => (res.status === 200 && res.ok && res.text()) || Promise.reject())\n        .then((text) => {\n          if(text !== App.versionFull) {\n            this.hasUpdate = true;\n            clearInterval(checkUpdateInterval);\n\n            if(!this.newBtnMenu.classList.contains('is-hidden')) {\n              this.updateBtn.classList.remove('is-hidden');\n            }\n          }\n        })\n        .catch(noop);\n      }, CHECK_UPDATE_INTERVAL);\n    });\n  }\n\n  private initSearch() {\n    const searchContainer = this.sidebarEl.querySelector('#search-container') as HTMLDivElement;\n\n    const scrollable = new Scrollable(searchContainer);\n\n    const close = () => {\n      // setTimeout(() => {\n      simulateClickEvent(this.backBtn);\n      // }, 0);\n    };\n\n    this.searchGroups = {\n      contacts: new SearchGroup('SearchAllChatsShort', 'contacts', undefined, undefined, undefined, undefined, close),\n      globalContacts: new SearchGroup('GlobalSearch', 'contacts', undefined, undefined, undefined, undefined, close),\n      messages: new SearchGroup('SearchMessages', 'messages'),\n      people: new SearchGroup(false, 'contacts', true, 'search-group-people', true, false, close, true),\n      recent: new SearchGroup('Recent', 'contacts', true, 'search-group-recent', true, true, close)\n    };\n\n    const searchSuper = this.searchSuper = new AppSearchSuper({\n      mediaTabs: [{\n        inputFilter: 'inputMessagesFilterEmpty',\n        name: 'FilterChats',\n        type: 'chats'\n      }, {\n        inputFilter: 'inputMessagesFilterPhotoVideo',\n        name: 'SharedMediaTab2',\n        type: 'media'\n      }, {\n        inputFilter: 'inputMessagesFilterUrl',\n        name: 'SharedLinksTab2',\n        type: 'links'\n      }, {\n        inputFilter: 'inputMessagesFilterDocument',\n        name: 'SharedFilesTab2',\n        type: 'files'\n      }, {\n        inputFilter: 'inputMessagesFilterMusic',\n        name: 'SharedMusicTab2',\n        type: 'music'\n      }, {\n        inputFilter: 'inputMessagesFilterRoundVoice',\n        name: 'SharedVoiceTab2',\n        type: 'voice'\n      }],\n      scrollable,\n      searchGroups: this.searchGroups,\n      asChatList: true,\n      hideEmptyTabs: false,\n      showSender: true,\n      managers: this.managers\n    });\n\n    searchContainer.prepend(searchSuper.nav.parentElement.parentElement);\n    scrollable.container.append(searchSuper.container);\n\n    const resetSearch = () => {\n      searchSuper.setQuery({\n        peerId: ''.toPeerId(),\n        folderId: 0\n      });\n      searchSuper.selectTab(0);\n      searchSuper.load(true);\n    };\n\n    resetSearch();\n\n    const pickedElements: HTMLElement[] = [];\n    let selectedPeerId: PeerId = ''.toPeerId();\n    let selectedMinDate = 0;\n    let selectedMaxDate = 0;\n    const updatePicked = () => {\n      // (this.inputSearch.input as HTMLInputElement).placeholder = pickedElements.length ? 'Search' : 'Telegram Search';\n      this.inputSearch.container.classList.toggle('is-picked-twice', pickedElements.length === 2);\n      this.inputSearch.container.classList.toggle('is-picked', !!pickedElements.length);\n\n      if(pickedElements.length) {\n        this.inputSearch.input.style.setProperty('--paddingLeft', (pickedElements[pickedElements.length - 1].getBoundingClientRect().right - this.inputSearch.input.getBoundingClientRect().left) + 'px');\n      } else {\n        this.inputSearch.input.style.removeProperty('--paddingLeft');\n      }\n    };\n\n    const helper = document.createElement('div');\n    helper.classList.add('search-helper');\n    helper.addEventListener('click', (e) => {\n      const target = findUpClassName(e.target, 'selector-user');\n      if(!target) {\n        return;\n      }\n\n      const key = target.dataset.key;\n      if(key.indexOf('date_') === 0) {\n        const [_, minDate, maxDate] = key.split('_');\n        selectedMinDate = +minDate;\n        selectedMaxDate = +maxDate;\n      } else {\n        selectedPeerId = key.toPeerId();\n      }\n\n      target.addEventListener('click', () => {\n        unselectEntity(target);\n      });\n\n      this.inputSearch.container.append(target);\n      this.inputSearch.onChange(this.inputSearch.value = '');\n      pickedElements.push(target);\n      updatePicked();\n    });\n\n    searchSuper.nav.parentElement.append(helper);\n\n    const renderEntity = (key: PeerId | string, title?: string | HTMLElement) => {\n      const div = document.createElement('div');\n      div.classList.add('selector-user'/* , 'scale-in' */);\n\n      const avatarEl = new AvatarElement();\n      avatarEl.classList.add('selector-user-avatar', 'tgico', 'avatar-30');\n      avatarEl.isDialog = true;\n\n      div.dataset.key = '' + key;\n      if(key.isPeerId()) {\n        if(title === undefined) {\n          title = new PeerTitle({peerId: key.toPeerId()}).element;\n        }\n\n        avatarEl.updateWithOptions({peerId: key as PeerId});\n      } else {\n        avatarEl.classList.add('tgico-calendarfilter');\n      }\n\n      if(title) {\n        if(typeof(title) === 'string') {\n          div.innerHTML = title;\n        } else {\n          replaceContent(div, title);\n          div.append(title);\n        }\n      }\n\n      div.insertAdjacentElement('afterbegin', avatarEl);\n\n      return div;\n    };\n\n    const unselectEntity = (target: HTMLElement) => {\n      const key = target.dataset.key;\n      if(key.indexOf('date_') === 0) {\n        selectedMinDate = selectedMaxDate = 0;\n      } else {\n        selectedPeerId = ''.toPeerId();\n      }\n\n      target.remove();\n      indexOfAndSplice(pickedElements, target);\n\n      setTimeout(() => {\n        updatePicked();\n        this.inputSearch.onChange(this.inputSearch.value);\n      }, 0);\n    };\n\n    this.inputSearch.onClear = () => {\n      pickedElements.forEach((el) => {\n        unselectEntity(el);\n      });\n    };\n\n    this.inputSearch.onChange = (value) => {\n      searchSuper.cleanupHTML();\n      searchSuper.setQuery({\n        peerId: selectedPeerId,\n        folderId: selectedPeerId ? undefined : 0,\n        query: value,\n        minDate: selectedMinDate,\n        maxDate: selectedMaxDate\n      });\n      searchSuper.load(true);\n\n      helper.innerHTML = '';\n      searchSuper.nav.classList.remove('hide');\n      if(!value) {\n      }\n\n      if(!selectedPeerId && value.trim()) {\n        const middleware = searchSuper.middleware.get();\n        Promise.all([\n          // appMessagesManager.getConversationsAll(value).then((dialogs) => dialogs.map((d) => d.peerId)),\n          this.managers.appMessagesManager.getConversations(value).then(({dialogs}) => dialogs.map((d) => d.peerId)),\n          this.managers.appUsersManager.getContactsPeerIds(value, true)\n        ]).then((results) => {\n          if(!middleware()) return;\n          const peerIds = new Set(results[0].concat(results[1]));\n\n          peerIds.forEach((peerId) => {\n            helper.append(renderEntity(peerId));\n          });\n\n          searchSuper.nav.classList.toggle('hide', !!helper.innerHTML);\n          // console.log('got peerIds by value:', value, [...peerIds]);\n        });\n      }\n\n      if(!selectedMinDate && value.trim()) {\n        const dates: DateData[] = [];\n        fillTipDates(value, dates);\n        dates.forEach((dateData) => {\n          helper.append(renderEntity('date_' + dateData.minDate + '_' + dateData.maxDate, dateData.title));\n        });\n\n        searchSuper.nav.classList.toggle('hide', !!helper.innerHTML);\n      }\n    };\n\n    searchSuper.tabs.inputMessagesFilterEmpty.addEventListener('mousedown', (e) => {\n      const target = findUpTag(e.target, DIALOG_LIST_ELEMENT_TAG) as HTMLElement;\n      if(!target) {\n        return;\n      }\n\n      const searchGroup = findUpClassName(target, 'search-group');\n      if(!searchGroup || searchGroup.classList.contains('search-group-recent') || searchGroup.classList.contains('search-group-people')) {\n        return;\n      }\n\n      const peerId = target.getAttribute('data-peer-id').toPeerId();\n      this.managers.appUsersManager.pushRecentSearch(peerId);\n    }, {capture: true});\n\n    const peopleContainer = document.createElement('div');\n    peopleContainer.classList.add('search-group-scrollable');\n    peopleContainer.append(this.searchGroups.people.list);\n    this.searchGroups.people.container.append(peopleContainer);\n    const peopleScrollable = new ScrollableX(peopleContainer);\n\n    let first = true;\n    let hideNewBtnMenuTimeout: number;\n    // const transition = Transition.bind(null, searchContainer.parentElement, 150);\n    const transition = TransitionSlider(searchContainer.parentElement, 'zoom-fade', 150, (id) => {\n      if(hideNewBtnMenuTimeout) clearTimeout(hideNewBtnMenuTimeout);\n\n      if(id === 0 && !first) {\n        searchSuper.selectTab(0, false);\n        this.inputSearch.onClearClick();\n        hideNewBtnMenuTimeout = window.setTimeout(() => {\n          hideNewBtnMenuTimeout = 0;\n          this.newBtnMenu.classList.remove('is-hidden');\n          this.hasUpdate && this.updateBtn.classList.remove('is-hidden');\n        }, 150);\n      }\n\n      first = false;\n    });\n\n    transition(0);\n\n    const activeClassName = 'is-visible';\n    const onFocus = () => {\n      this.toolsBtn.classList.remove(activeClassName);\n      this.backBtn.classList.add(activeClassName);\n      this.newBtnMenu.classList.add('is-hidden');\n      this.updateBtn.classList.add('is-hidden');\n      this.toolsBtn.parentElement.firstElementChild.classList.toggle('state-back', true);\n\n      const navigationType: NavigationItem['type'] = 'global-search';\n      if(!IS_MOBILE_SAFARI && !appNavigationController.findItemByType(navigationType)) {\n        appNavigationController.pushItem({\n          onPop: () => {\n            close();\n          },\n          type: navigationType\n        });\n      }\n\n      transition(1);\n    };\n\n    this.inputSearch.input.addEventListener('focus', onFocus);\n    onFocus();\n\n    attachClickEvent(this.backBtn, (e) => {\n      this.toolsBtn.classList.add(activeClassName);\n      this.backBtn.classList.remove(activeClassName);\n      this.toolsBtn.parentElement.firstElementChild.classList.toggle('state-back', false);\n\n      appNavigationController.removeByType('global-search');\n\n      transition(0);\n    });\n\n    const clearRecentSearchBtn = ButtonIcon('close');\n    this.searchGroups.recent.nameEl.append(clearRecentSearchBtn);\n    clearRecentSearchBtn.addEventListener('click', () => {\n      confirmationPopup({\n        descriptionLangKey: 'Search.Confirm.ClearHistory',\n        button: {\n          langKey: 'ClearButton',\n          isDanger: true\n        }\n      }).then(() => {\n        return this.managers.appUsersManager.clearRecentSearch().then(() => {\n          this.searchGroups.recent.clear();\n        });\n      });\n    });\n  }\n}\n\nexport type SettingSectionOptions = {\n  name?: LangPackKey,\n  nameArgs?: FormatterArguments,\n  caption?: LangPackKey | true,\n  captionArgs?: FormatterArguments,\n  captionOld?: SettingSectionOptions['caption'],\n  noDelimiter?: boolean,\n  fakeGradientDelimiter?: boolean,\n  noShadow?: boolean,\n  // fullWidth?: boolean,\n  // noPaddingTop?: boolean\n};\n\nconst className = 'sidebar-left-section';\nexport class SettingSection {\n  public container: HTMLElement;\n  public innerContainer: HTMLElement;\n  public content: HTMLElement;\n  public title: HTMLElement;\n  public caption: HTMLElement;\n\n  private fullWidth: boolean;\n\n  constructor(options: SettingSectionOptions = {}) {\n    const container = this.container = document.createElement('div');\n    container.classList.add(className + '-container');\n\n    const innerContainer = this.innerContainer = document.createElement('div');\n    innerContainer.classList.add(className);\n\n    if(options.noShadow) {\n      innerContainer.classList.add('no-shadow');\n    }\n\n    if(options.fakeGradientDelimiter) {\n      innerContainer.append(generateDelimiter());\n      innerContainer.classList.add('with-fake-delimiter');\n    } else if(!options.noDelimiter) {\n      const hr = document.createElement('hr');\n      innerContainer.append(hr);\n    } else {\n      innerContainer.classList.add('no-delimiter');\n    }\n\n    // if(options.fullWidth) {\n    //   this.fullWidth = true;\n    // }\n\n    // if(options.noPaddingTop) {\n    //   innerContainer.classList.add('no-padding-top');\n    // }\n\n    const content = this.content = this.generateContentElement();\n\n    if(options.name) {\n      const title = this.title = document.createElement('div');\n      title.classList.add('sidebar-left-h2', className + '-name');\n      i18n_({element: title, key: options.name, args: options.nameArgs});\n      content.append(title);\n    }\n\n    container.append(innerContainer);\n\n    const caption = options.caption ?? options.captionOld;\n    if(caption) {\n      const el = this.caption = this.generateContentElement();\n      el.classList.add(className + '-caption');\n\n      if(!options.captionOld) {\n        container.append(el);\n      }\n\n      if(caption !== true) {\n        i18n_({element: el, key: caption, args: options.captionArgs});\n      }\n    }\n  }\n\n  public generateContentElement() {\n    const content = document.createElement('div');\n    content.classList.add(className + '-content');\n\n    // if(this.fullWidth) {\n    //   content.classList.add('full-width');\n    // }\n\n    this.innerContainer.append(content);\n    return content;\n  }\n}\n\nexport const generateSection = (appendTo: Scrollable, name?: LangPackKey, caption?: LangPackKey) => {\n  const section = new SettingSection({name, caption});\n  appendTo.append(section.container);\n  return section.content;\n};\n\nexport const generateDelimiter = () => {\n  const delimiter = document.createElement('div');\n  delimiter.classList.add('gradient-delimiter');\n  return delimiter;\n};\n\nexport class SettingChatListSection extends SettingSection {\n  public sortedList: SortedUserList;\n\n  constructor(options: SettingSectionOptions & {sortedList: SortedUserList}) {\n    super(options);\n\n    this.sortedList = options.sortedList;\n\n    this.content.append(this.sortedList.list);\n  }\n\n  public makeButton(options: ButtonOptions) {\n    const button = Button('folder-category-button btn btn-primary btn-transparent', options);\n    if(this.title) this.content.insertBefore(button, this.title.nextSibling);\n    else this.content.prepend(button);\n    return button;\n  }\n}\n\nconst appSidebarLeft = new AppSidebarLeft();\nMOUNT_CLASS_TO.appSidebarLeft = appSidebarLeft;\nexport default appSidebarLeft;\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport {SliderSuperTab} from '../../slider';\r\nimport AppSelectPeers from '../../appSelectPeers';\r\nimport {setButtonLoader} from '../../putPreloader';\r\nimport {LangPackKey, _i18n} from '../../../lib/langPack';\r\nimport ButtonCorner from '../../buttonCorner';\r\n\r\nexport default class AppAddMembersTab extends SliderSuperTab {\r\n  private nextBtn: HTMLButtonElement;\r\n  private selector: AppSelectPeers;\r\n  private peerType: 'channel' | 'chat' | 'privacy';\r\n  private takeOut: (peerIds: PeerId[]) => Promise<any> | false | void;\r\n  private skippable: boolean;\r\n\r\n  protected init() {\r\n    this.container.classList.add('add-members-container');\r\n    this.nextBtn = ButtonCorner({icon: 'arrow_next'});\r\n    this.content.append(this.nextBtn);\r\n    this.scrollable.container.remove();\r\n\r\n    this.nextBtn.addEventListener('click', () => {\r\n      const peerIds = this.selector.getSelected().map((sel) => sel.toPeerId());\r\n\r\n      if(this.skippable) {\r\n        this.takeOut(peerIds);\r\n        this.close();\r\n      } else {\r\n        const promise = this.takeOut(peerIds);\r\n\r\n        if(promise instanceof Promise) {\r\n          this.attachToPromise(promise);\r\n        } else if(promise === undefined) {\r\n          this.close();\r\n        }\r\n      }\r\n    });\r\n  }\r\n\r\n  public attachToPromise(promise: Promise<any>) {\r\n    const removeLoader = setButtonLoader(this.nextBtn, 'arrow_next');\r\n\r\n    promise.then(() => {\r\n      this.close();\r\n    }, () => {\r\n      removeLoader();\r\n    });\r\n  }\r\n\r\n  public open(options: {\r\n    title: LangPackKey,\r\n    placeholder: LangPackKey,\r\n    type: AppAddMembersTab['peerType'],\r\n    takeOut?: AppAddMembersTab['takeOut'],\r\n    skippable: boolean,\r\n    selectedPeerIds?: PeerId[]\r\n  }) {\r\n    const ret = super.open();\r\n\r\n    this.setTitle(options.title);\r\n    this.peerType = options.type;\r\n    this.takeOut = options.takeOut;\r\n    this.skippable = options.skippable;\r\n\r\n    const isPrivacy = this.peerType === 'privacy';\r\n    this.selector = new AppSelectPeers({\r\n      appendTo: this.content,\r\n      onChange: this.skippable ? null : (length) => {\r\n        this.nextBtn.classList.toggle('is-visible', !!length);\r\n      },\r\n      peerType: [isPrivacy ? 'dialogs' : 'contacts'],\r\n      placeholder: options.placeholder,\r\n      exceptSelf: isPrivacy,\r\n      filterPeerTypeBy: isPrivacy ? ['isAnyGroup', 'isUser'] : undefined,\r\n      managers: this.managers\r\n    });\r\n\r\n    if(options.selectedPeerIds) {\r\n      this.selector.addInitial(options.selectedPeerIds);\r\n    }\r\n\r\n    this.nextBtn.classList.add('tgico-arrow_next');\r\n    this.nextBtn.innerHTML = '';\r\n    this.nextBtn.disabled = false;\r\n    this.nextBtn.classList.toggle('is-visible', this.skippable);\r\n\r\n    return ret;\r\n  }\r\n}\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport type {MyDialogFilter} from '../../../lib/storages/filters';\r\nimport type {DialogFilterSuggested} from '../../../layer';\r\nimport type _rootScope from '../../../lib/rootScope';\r\nimport {SliderSuperTab} from '../../slider';\r\nimport lottieLoader, {LottieLoader} from '../../../lib/rlottie/lottieLoader';\r\nimport {toast} from '../../toast';\r\nimport Button from '../../button';\r\nimport rootScope from '../../../lib/rootScope';\r\nimport AppEditFolderTab from './editFolder';\r\nimport Row from '../../row';\r\nimport {SettingSection} from '..';\r\nimport {i18n, i18n_, LangPackKey, join} from '../../../lib/langPack';\r\nimport cancelEvent from '../../../helpers/dom/cancelEvent';\r\nimport {attachClickEvent} from '../../../helpers/dom/clickEvent';\r\nimport positionElementByIndex from '../../../helpers/dom/positionElementByIndex';\r\nimport RLottiePlayer from '../../../lib/rlottie/rlottiePlayer';\r\nimport wrapEmojiText from '../../../lib/richTextProcessor/wrapEmojiText';\r\nimport {FOLDER_ID_ALL, FOLDER_ID_ARCHIVE, REAL_FOLDERS} from '../../../lib/mtproto/mtproto_config';\r\nimport replaceContent from '../../../helpers/dom/replaceContent';\r\n\r\nexport default class AppChatFoldersTab extends SliderSuperTab {\r\n  private createFolderBtn: HTMLElement;\r\n  private foldersSection: SettingSection;\r\n  private suggestedSection: SettingSection;\r\n  private stickerContainer: HTMLElement;\r\n  private animation: RLottiePlayer;\r\n\r\n  private filtersRendered: {[filterId: number]: Row} = {};\r\n  private loadAnimationPromise: ReturnType<LottieLoader['waitForFirstFrame']>;\r\n\r\n  private async renderFolder(\r\n    dialogFilter: DialogFilterSuggested | MyDialogFilter,\r\n    container?: HTMLElement,\r\n    row?: Row,\r\n    append?: boolean\r\n  ) {\r\n    let filter: MyDialogFilter;\r\n    let description = '';\r\n    const d: HTMLElement[] = [];\r\n    if(dialogFilter._ === 'dialogFilterSuggested') {\r\n      filter = dialogFilter.filter as MyDialogFilter;\r\n      description = dialogFilter.description;\r\n    } else {\r\n      filter = dialogFilter;\r\n\r\n      const enabledFilters = Object.keys(filter.pFlags).length;\r\n      /* (['include_peers', 'exclude_peers'] as ['include_peers', 'exclude_peers']).forEach((key) => {\r\n        enabledFilters += +!!filter[key].length;\r\n      }); */\r\n\r\n      if(enabledFilters === 1) {\r\n        const pFlags = filter.pFlags;\r\n        let k: LangPackKey;\r\n        if(pFlags.contacts) k = 'FilterAllContacts';\r\n        else if(pFlags.non_contacts) k = 'FilterAllNonContacts';\r\n        else if(pFlags.groups) k = 'FilterAllGroups';\r\n        else if(pFlags.broadcasts) k = 'FilterAllChannels';\r\n        else if(pFlags.bots) k = 'FilterAllBots';\r\n\r\n        if(k) {\r\n          d.push(i18n(k));\r\n        }\r\n      }\r\n\r\n      if(!d.length) {\r\n        const folder = await this.managers.dialogsStorage.getFolderDialogs(filter.id);\r\n        let chats = 0, channels = 0, groups = 0;\r\n        await Promise.all(folder.map(async(dialog) => {\r\n          if(await this.managers.appPeersManager.isAnyGroup(dialog.peerId)) groups++;\r\n          else if(await this.managers.appPeersManager.isBroadcast(dialog.peerId)) channels++;\r\n          else chats++;\r\n        }));\r\n\r\n        if(chats) d.push(i18n('Chats', [chats]));\r\n        if(channels) d.push(i18n('Channels', [channels]));\r\n        if(groups) d.push(i18n('Groups', [groups]));\r\n      }\r\n    }\r\n\r\n    if(!row) {\r\n      row = new Row({\r\n        title: filter.id === FOLDER_ID_ALL ? i18n('FilterAllChats') : wrapEmojiText(filter.title),\r\n        subtitle: description,\r\n        clickable: filter.id !== FOLDER_ID_ALL,\r\n        buttonRightLangKey: dialogFilter._ === 'dialogFilterSuggested' ? 'Add' : undefined\r\n      });\r\n\r\n      if(d.length) {\r\n        row.subtitle.append(...join(d));\r\n      }\r\n\r\n      if(dialogFilter._ === 'dialogFilter') {\r\n        const filterId = filter.id;\r\n        if(!this.filtersRendered[filter.id] && filter.id !== FOLDER_ID_ALL) {\r\n          attachClickEvent(row.container, async() => {\r\n            this.slider.createTab(AppEditFolderTab).open(await this.managers.filtersStorage.getFilter(filterId));\r\n          }, {listenerSetter: this.listenerSetter});\r\n        }\r\n\r\n        this.filtersRendered[filter.id] = row;\r\n      }\r\n    } else {\r\n      if(filter.id !== FOLDER_ID_ALL) {\r\n        replaceContent(row.title, wrapEmojiText(filter.title));\r\n      }\r\n\r\n      row.subtitle.textContent = '';\r\n      row.subtitle.append(...join(d));\r\n    }\r\n\r\n    const div = row.container;\r\n\r\n    if(append) {\r\n      const localId = (filter as MyDialogFilter).localId;\r\n      if(localId !== undefined) {\r\n        // ! header will be at 0 index\r\n        positionElementByIndex(div, div.parentElement || container, localId);\r\n      } else if(container) {\r\n        container.append(div);\r\n      }\r\n    }\r\n\r\n    return row;\r\n  }\r\n\r\n  protected async init() {\r\n    this.container.classList.add('chat-folders-container');\r\n    this.setTitle('ChatList.Filter.List.Title');\r\n\r\n    this.scrollable.container.classList.add('chat-folders');\r\n\r\n    this.stickerContainer = document.createElement('div');\r\n    this.stickerContainer.classList.add('sticker-container');\r\n\r\n    const caption = document.createElement('div');\r\n    caption.classList.add('caption');\r\n    i18n_({element: caption, key: 'ChatList.Filter.Header'});\r\n\r\n    this.createFolderBtn = Button('btn-primary btn-color-primary btn-control tgico', {\r\n      text: 'ChatList.Filter.NewTitle',\r\n      icon: 'add'\r\n    });\r\n\r\n    this.foldersSection = new SettingSection({\r\n      name: 'Filters'\r\n    });\r\n    this.foldersSection.container.style.display = 'none';\r\n\r\n    this.suggestedSection = new SettingSection({\r\n      name: 'FilterRecommended'\r\n    });\r\n    this.suggestedSection.container.style.display = 'none';\r\n\r\n    this.scrollable.append(this.stickerContainer, caption, this.createFolderBtn, this.foldersSection.container, this.suggestedSection.container);\r\n\r\n    attachClickEvent(this.createFolderBtn, async() => {\r\n      if(!(await this.canCreateFolder())) {\r\n        toast('Sorry, you can\\'t create more folders.');\r\n      } else {\r\n        this.slider.createTab(AppEditFolderTab).open();\r\n      }\r\n    }, {listenerSetter: this.listenerSetter});\r\n\r\n    const onFiltersContainerUpdate = () => {\r\n      this.foldersSection.container.style.display = Object.keys(this.filtersRendered).length ? '' : 'none';\r\n    };\r\n\r\n    this.managers.filtersStorage.getDialogFilters().then(async(filters) => {\r\n      for(const filter of filters) {\r\n        if(filter.id === FOLDER_ID_ARCHIVE) {\r\n          continue;\r\n        }\r\n\r\n        await this.renderFolder(filter, this.foldersSection.content, undefined, true);\r\n      }\r\n\r\n      this.toggleAllChats();\r\n\r\n      onFiltersContainerUpdate();\r\n    });\r\n\r\n    this.listenerSetter.add(rootScope)('filter_update', async(filter) => {\r\n      const filterRendered = this.filtersRendered[filter.id];\r\n      if(filterRendered) {\r\n        await this.renderFolder(filter, null, filterRendered);\r\n      } else if(filter.id !== FOLDER_ID_ARCHIVE) {\r\n        await this.renderFolder(filter, this.foldersSection.content, undefined, true);\r\n      }\r\n\r\n      onFiltersContainerUpdate();\r\n\r\n      this.getSuggestedFilters();\r\n    });\r\n\r\n    this.listenerSetter.add(rootScope)('filter_delete', (filter) => {\r\n      const filterRendered = this.filtersRendered[filter.id];\r\n      if(filterRendered) {\r\n        /* for(const suggested of this.suggestedFilters) {\r\n          if(deepEqual(suggested.filter, filter)) {\r\n\r\n          }\r\n        } */\r\n        this.getSuggestedFilters();\r\n\r\n        filterRendered.container.remove();\r\n        delete this.filtersRendered[filter.id];\r\n      }\r\n\r\n      onFiltersContainerUpdate();\r\n    });\r\n\r\n    this.listenerSetter.add(rootScope)('filter_order', (order) => {\r\n      order.filter((filterId) => !!this.filtersRendered[filterId]).forEach((filterId, idx) => {\r\n        const filterRendered = this.filtersRendered[filterId];\r\n        const container = filterRendered.container;\r\n        positionElementByIndex(container, container.parentElement, idx + 1); // ! + 1 due to header\r\n      });\r\n    });\r\n\r\n    this.listenerSetter.add(rootScope)('premium_toggle', () => {\r\n      this.toggleAllChats();\r\n    });\r\n\r\n    this.loadAnimationPromise = lottieLoader.loadAnimationAsAsset({\r\n      container: this.stickerContainer,\r\n      loop: false,\r\n      autoplay: false,\r\n      width: 86,\r\n      height: 86\r\n    }, 'Folders_1').then((player) => {\r\n      this.animation = player;\r\n\r\n      return lottieLoader.waitForFirstFrame(player);\r\n    });\r\n\r\n    this.getSuggestedFilters()\r\n\r\n    /* return Promise.all([\r\n      this.loadAnimationPromise\r\n    ]); */\r\n    return this.loadAnimationPromise;\r\n  }\r\n\r\n  onOpenAfterTimeout() {\r\n    this.loadAnimationPromise.then(() => {\r\n      this.animation.autoplay = true;\r\n      this.animation.play();\r\n    });\r\n  }\r\n\r\n  private toggleAllChats() {\r\n    const filterRendered = this.filtersRendered[FOLDER_ID_ALL];\r\n    filterRendered.container.classList.toggle('hide', !rootScope.premium);\r\n  }\r\n\r\n  private async canCreateFolder() {\r\n    const [appConfig, filters] = await Promise.all([\r\n      this.managers.apiManager.getAppConfig(),\r\n      this.managers.filtersStorage.getDialogFilters()\r\n    ]);\r\n\r\n    const filtersLength = filters.filter((filter) => !REAL_FOLDERS.has(filter.id)).length;\r\n    return filtersLength < (rootScope.premium ? appConfig.dialog_filters_limit_premium : appConfig.dialog_filters_limit_default);\r\n  }\r\n\r\n  private getSuggestedFilters() {\r\n    return this.managers.filtersStorage.getSuggestedDialogsFilters().then(async(suggestedFilters) => {\r\n      this.suggestedSection.container.style.display = suggestedFilters.length ? '' : 'none';\r\n      Array.from(this.suggestedSection.content.children).slice(1).forEach((el) => el.remove());\r\n\r\n      for(const filter of suggestedFilters) {\r\n        const row = await this.renderFolder(filter);\r\n        this.suggestedSection.content.append(row.container);\r\n\r\n        const button = row.buttonRight;\r\n        attachClickEvent(button, async(e) => {\r\n          cancelEvent(e);\r\n\r\n          if(!(await this.canCreateFolder())) {\r\n            toast('Sorry, you can\\'t create more folders.');\r\n            return;\r\n          }\r\n\r\n          button.setAttribute('disabled', 'true');\r\n\r\n          const f = filter.filter as MyDialogFilter;\r\n          f.includePeerIds = [];\r\n          f.excludePeerIds = [];\r\n          f.pinnedPeerIds = [];\r\n\r\n          this.managers.filtersStorage.createDialogFilter(f, true).then((bool) => {\r\n            if(bool) {\r\n              row.container.remove();\r\n            }\r\n          }).finally(() => {\r\n            button.removeAttribute('disabled');\r\n          });\r\n        }, {listenerSetter: this.listenerSetter});\r\n      }\r\n    });\r\n  }\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport {SliderSuperTab} from '../../slider';\r\nimport AppSelectPeers from '../../appSelectPeers';\r\nimport appDialogsManager from '../../../lib/appManagers/appDialogsManager';\r\nimport {MyDialogFilter as DialogFilter} from '../../../lib/storages/filters';\r\nimport ButtonIcon from '../../buttonIcon';\r\nimport CheckboxField from '../../checkboxField';\r\nimport Button from '../../button';\r\nimport AppEditFolderTab from './editFolder';\r\nimport I18n, {i18n, LangPackKey, _i18n, join} from '../../../lib/langPack';\r\nimport {SettingSection} from '..';\r\nimport {toast} from '../../toast';\r\nimport copy from '../../../helpers/object/copy';\r\nimport forEachReverse from '../../../helpers/array/forEachReverse';\r\nimport setInnerHTML from '../../../helpers/dom/setInnerHTML';\r\nimport wrapEmojiText from '../../../lib/richTextProcessor/wrapEmojiText';\r\nimport {REAL_FOLDERS} from '../../../lib/mtproto/mtproto_config';\r\nimport rootScope from '../../../lib/rootScope';\r\nimport {MTAppConfig} from '../../../lib/mtproto/appConfig';\r\nimport {attachClickEvent, simulateClickEvent} from '../../../helpers/dom/clickEvent';\r\n\r\nexport default class AppIncludedChatsTab extends SliderSuperTab {\r\n  private editFolderTab: AppEditFolderTab;\r\n  private confirmBtn: HTMLElement;\r\n\r\n  private selector: AppSelectPeers;\r\n  private type: 'included' | 'excluded';\r\n  private filter: DialogFilter;\r\n  private originalFilter: DialogFilter;\r\n\r\n  private dialogsByFilters: Map<DialogFilter, Set<PeerId>>;\r\n  private limit: number;\r\n\r\n  protected init() {\r\n    this.content.remove();\r\n    this.container.classList.add('included-chatlist-container');\r\n    this.confirmBtn = ButtonIcon('check btn-confirm blue', {noRipple: true});\r\n    this.confirmBtn.style.display = 'none';\r\n\r\n    this.header.append(this.confirmBtn);\r\n\r\n    attachClickEvent(this.confirmBtn, async() => {\r\n      const selected = this.selector.getSelected();\r\n\r\n      // this.filter.pFlags = {};\r\n\r\n      if(this.type === 'included') {\r\n        for(const key in this.filter.pFlags) {\r\n          if(key.indexOf('exclude_') === 0) {\r\n            continue;\r\n          }\r\n\r\n          // @ts-ignore\r\n          delete this.filter.pFlags[key];\r\n        }\r\n      } else {\r\n        for(const key in this.filter.pFlags) {\r\n          if(key.indexOf('exclude_') !== 0) {\r\n            continue;\r\n          }\r\n\r\n          // @ts-ignore\r\n          delete this.filter.pFlags[key];\r\n        }\r\n      }\r\n\r\n      const peerIds: PeerId[] = [];\r\n      for(const key of selected) {\r\n        if(key.isPeerId()) {\r\n          peerIds.push(key.toPeerId());\r\n        } else {\r\n          // @ts-ignore\r\n          this.filter.pFlags[key] = true;\r\n        }\r\n      }\r\n\r\n      let cmp: (peerId: PeerId) => boolean;\r\n      if(this.type === 'included') {\r\n        cmp = (peerId) => peerIds.includes(peerId);\r\n      } else {\r\n        cmp = (peerId) => !peerIds.includes(peerId);\r\n      }\r\n\r\n      forEachReverse(this.filter.pinnedPeerIds, (peerId, idx) => {\r\n        if(!cmp(peerId)) {\r\n          this.filter.pinnedPeerIds.splice(idx, 1);\r\n          this.filter.pinned_peers.splice(idx, 1);\r\n        }\r\n      });\r\n\r\n      const other = this.type === 'included' ? 'excludePeerIds' : 'includePeerIds';\r\n      const otherLegacy = this.type === 'included' ? 'exclude_peers' : 'include_peers';\r\n      forEachReverse(this.filter[other], (peerId, idx) => {\r\n        if(peerIds.includes(peerId)) {\r\n          this.filter[other].splice(idx, 1);\r\n          this.filter[otherLegacy].splice(idx, 1);\r\n        }\r\n      });\r\n\r\n      this.filter[this.type === 'included' ? 'includePeerIds' : 'excludePeerIds'] = peerIds;\r\n      this.filter[this.type === 'included' ? 'include_peers' : 'exclude_peers'] = await Promise.all(peerIds.map((peerId) => this.managers.appPeersManager.getInputPeerById(peerId)));\r\n      // this.filter.pinned_peers = this.filter.pinned_peers.filter((peerId) => this.filter.include_peers.includes(peerId));\r\n\r\n      this.editFolderTab.setFilter(this.filter, false);\r\n      this.close();\r\n    }, {listenerSetter: this.listenerSetter});\r\n\r\n    const onAppConfig = (appConfig: MTAppConfig) => {\r\n      this.limit = rootScope.premium ? appConfig.dialog_filters_chats_limit_premium : appConfig.dialog_filters_chats_limit_default;\r\n    };\r\n\r\n    this.listenerSetter.add(rootScope)('app_config', onAppConfig);\r\n\r\n    this.dialogsByFilters = new Map();\r\n    return Promise.all([\r\n      this.managers.filtersStorage.getDialogFilters().then(async(filters) => {\r\n        await Promise.all(filters.filter((filter) => !REAL_FOLDERS.has(filter.id)).map(async(filter) => {\r\n          const dialogs = await this.managers.dialogsStorage.getFolderDialogs(filter.id);\r\n          const peerIds = dialogs.map((d) => d.peerId);\r\n          this.dialogsByFilters.set(filter, new Set(peerIds));\r\n        }));\r\n      }),\r\n\r\n      this.managers.apiManager.getAppConfig().then((appConfig) => {\r\n        onAppConfig(appConfig);\r\n      })\r\n    ]);\r\n  }\r\n\r\n  checkbox(selected?: boolean) {\r\n    const checkboxField = new CheckboxField({\r\n      round: true\r\n    });\r\n    if(selected) {\r\n      checkboxField.input.checked = selected;\r\n    }\r\n\r\n    return checkboxField.label;\r\n  }\r\n\r\n  renderResults = async(peerIds: PeerId[]) => {\r\n    // const other = this.type === 'included' ? this.filter.exclude_peers : this.filter.include_peers;\r\n\r\n    await this.managers.appUsersManager.getContacts();\r\n    peerIds.forEach((peerId) => {\r\n      // if(other.includes(peerId)) return;\r\n\r\n      const {dom} = appDialogsManager.addDialogNew({\r\n        peerId: peerId,\r\n        container: this.selector.scrollable,\r\n        rippleEnabled: true,\r\n        avatarSize: 46\r\n      });\r\n\r\n      const selected = this.selector.selected.has(peerId);\r\n      dom.containerEl.append(this.checkbox(selected));\r\n      // if(selected) dom.listEl.classList.add('active');\r\n\r\n      const foundInFilters: HTMLElement[] = [];\r\n      this.dialogsByFilters.forEach((dialogs, filter) => {\r\n        if(dialogs.has(peerId)) {\r\n          const span = document.createElement('span');\r\n          setInnerHTML(span, wrapEmojiText(filter.title));\r\n          foundInFilters.push(span);\r\n        }\r\n      });\r\n\r\n      const joined = join(foundInFilters, false);\r\n      joined.forEach((el) => {\r\n        dom.lastMessageSpan.append(el);\r\n      });\r\n    });\r\n  };\r\n\r\n  onOpen() {\r\n    if(this.init) {\r\n      this.init();\r\n      this.init = null;\r\n    }\r\n\r\n    this.confirmBtn.style.display = this.type === 'excluded' ? '' : 'none';\r\n    this.setTitle(this.type === 'included' ? 'FilterAlwaysShow' : 'FilterNeverShow');\r\n\r\n    const filter = this.filter;\r\n\r\n    const categoriesSection = new SettingSection({\r\n      noDelimiter: true,\r\n      name: 'FilterChatTypes'\r\n    });\r\n\r\n    categoriesSection.container.classList.add('folder-categories');\r\n\r\n    let details: {[flag: string]: {ico: string, text: LangPackKey}};\r\n    if(this.type === 'excluded') {\r\n      details = {\r\n        exclude_muted: {ico: 'mute', text: 'ChatList.Filter.MutedChats'},\r\n        exclude_archived: {ico: 'archive', text: 'ChatList.Filter.Archive'},\r\n        exclude_read: {ico: 'readchats', text: 'ChatList.Filter.ReadChats'}\r\n      };\r\n    } else {\r\n      details = {\r\n        contacts: {ico: 'newprivate', text: 'ChatList.Filter.Contacts'},\r\n        non_contacts: {ico: 'noncontacts', text: 'ChatList.Filter.NonContacts'},\r\n        groups: {ico: 'group', text: 'ChatList.Filter.Groups'},\r\n        broadcasts: {ico: 'newchannel', text: 'ChatList.Filter.Channels'},\r\n        bots: {ico: 'bots', text: 'ChatList.Filter.Bots'}\r\n      };\r\n    }\r\n\r\n    const f = document.createDocumentFragment();\r\n    for(const key in details) {\r\n      const button = Button('btn-primary btn-transparent folder-category-button', {icon: details[key].ico, text: details[key].text});\r\n      button.dataset.peerId = key;\r\n      button.append(this.checkbox());\r\n      f.append(button);\r\n    }\r\n    categoriesSection.content.append(f);\r\n\r\n    // ///////////////\r\n\r\n    const selectedPeers = (this.type === 'included' ? filter.includePeerIds : filter.excludePeerIds).slice();\r\n\r\n    this.selector = new AppSelectPeers({\r\n      appendTo: this.container,\r\n      onChange: this.onSelectChange,\r\n      peerType: ['dialogs'],\r\n      renderResultsFunc: this.renderResults,\r\n      placeholder: 'Search',\r\n      sectionNameLangPackKey: 'FilterChats',\r\n      managers: this.managers\r\n    });\r\n    this.selector.selected = new Set(selectedPeers);\r\n\r\n    let addedInitial = false;\r\n    const _add = this.selector.add.bind(this.selector);\r\n    this.selector.add = (peerId, title, scroll) => {\r\n      if(this.selector.selected.size >= this.limit && addedInitial && !details[peerId]) {\r\n        const el: HTMLInputElement = this.selector.list.querySelector(`[data-peer-id=\"${peerId}\"] [type=\"checkbox\"]`);\r\n        if(el) {\r\n          setTimeout(() => {\r\n            el.checked = false;\r\n          }, 0);\r\n        }\r\n\r\n        const str = I18n.format(this.type === 'excluded' ? 'ChatList.Filter.Exclude.LimitReached': 'ChatList.Filter.Include.LimitReached', true);\r\n        toast(str);\r\n        return;\r\n      }\r\n\r\n      const div = _add(peerId, details[peerId] ? i18n(details[peerId].text) : undefined, scroll);\r\n      if(details[peerId]) {\r\n        div.querySelector('avatar-element').classList.add('tgico-' + details[peerId].ico);\r\n      }\r\n      return div;\r\n    };\r\n\r\n    this.selector.scrollable.container.append(categoriesSection.container, this.selector.scrollable.container.lastElementChild);\r\n\r\n    this.selector.addInitial(selectedPeers);\r\n    addedInitial = true;\r\n\r\n    for(const flag in filter.pFlags) {\r\n      // @ts-ignore\r\n      if(details.hasOwnProperty(flag) && !!filter.pFlags[flag]) {\r\n        simulateClickEvent(categoriesSection.content.querySelector(`[data-peer-id=\"${flag}\"]`) as HTMLElement);\r\n      }\r\n    }\r\n  }\r\n\r\n  onSelectChange = (length: number) => {\r\n    // const changed = !deepEqual(this.filter, this.originalFilter);\r\n    if(this.type === 'included') {\r\n      this.confirmBtn.style.display = length ? '' : 'none';\r\n    }\r\n  };\r\n\r\n  onCloseAfterTimeout() {\r\n    if(this.selector) {\r\n      this.selector.container.remove();\r\n      this.selector = null;\r\n    }\r\n\r\n    return super.onCloseAfterTimeout();\r\n  }\r\n\r\n  /**\r\n   * Do not ignore arguments!\r\n   */\r\n  public open(filter?: DialogFilter, type?: 'included' | 'excluded', editFolderTab?: AppIncludedChatsTab['editFolderTab']) {\r\n    this.originalFilter = filter;\r\n    this.filter = copy(this.originalFilter);\r\n    this.type = type;\r\n    this.editFolderTab = editFolderTab;\r\n\r\n    return super.open();\r\n  }\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport appDialogsManager from '../../../lib/appManagers/appDialogsManager';\r\nimport {MyDialogFilter as DialogFilter} from '../../../lib/storages/filters';\r\nimport lottieLoader, {LottieLoader} from '../../../lib/rlottie/lottieLoader';\r\nimport {SliderSuperTab} from '../../slider';\r\nimport {toast} from '../../toast';\r\nimport InputField from '../../inputField';\r\nimport ButtonIcon from '../../buttonIcon';\r\nimport ButtonMenuToggle from '../../buttonMenuToggle';\r\nimport {ButtonMenuItemOptions} from '../../buttonMenu';\r\nimport Button from '../../button';\r\nimport AppIncludedChatsTab from './includedChats';\r\nimport {i18n, LangPackKey} from '../../../lib/langPack';\r\nimport {SettingSection} from '..';\r\nimport PopupPeer from '../../popups/peer';\r\nimport RLottiePlayer from '../../../lib/rlottie/rlottiePlayer';\r\nimport copy from '../../../helpers/object/copy';\r\nimport deepEqual from '../../../helpers/object/deepEqual';\r\nimport documentFragmentToHTML from '../../../helpers/dom/documentFragmentToHTML';\r\nimport wrapDraftText from '../../../lib/richTextProcessor/wrapDraftText';\r\nimport filterAsync from '../../../helpers/array/filterAsync';\r\nimport {attachClickEvent} from '../../../helpers/dom/clickEvent';\r\n\r\nconst MAX_FOLDER_NAME_LENGTH = 12;\r\n\r\nexport default class AppEditFolderTab extends SliderSuperTab {\r\n  private caption: HTMLElement;\r\n  private stickerContainer: HTMLElement;\r\n\r\n  private confirmBtn: HTMLElement;\r\n  private menuBtn: HTMLElement;\r\n  private nameInputField: InputField;\r\n\r\n  private includePeerIds: SettingSection;\r\n  private excludePeerIds: SettingSection;\r\n  private flags: {[k in 'contacts' | 'non_contacts' | 'groups' | 'broadcasts' | 'bots' | 'exclude_muted' | 'exclude_archived' | 'exclude_read']: HTMLElement} = {} as any;\r\n\r\n  private animation: RLottiePlayer;\r\n  private filter: DialogFilter;\r\n  private originalFilter: DialogFilter;\r\n\r\n  private type: 'edit' | 'create';\r\n  private loadAnimationPromise: ReturnType<LottieLoader['waitForFirstFrame']>;\r\n\r\n  protected init() {\r\n    this.container.classList.add('edit-folder-container');\r\n    this.caption = document.createElement('div');\r\n    this.caption.classList.add('caption');\r\n    this.caption.append(i18n('FilterIncludeExcludeInfo'));\r\n    this.stickerContainer = document.createElement('div');\r\n    this.stickerContainer.classList.add('sticker-container');\r\n\r\n    this.confirmBtn = ButtonIcon('check btn-confirm hide blue');\r\n    const deleteFolderButton: ButtonMenuItemOptions = {\r\n      icon: 'delete danger',\r\n      text: 'FilterMenuDelete',\r\n      onClick: () => {\r\n        new PopupPeer('filter-delete', {\r\n          titleLangKey: 'ChatList.Filter.Confirm.Remove.Header',\r\n          descriptionLangKey: 'ChatList.Filter.Confirm.Remove.Text',\r\n          buttons: [{\r\n            langKey: 'Delete',\r\n            callback: () => {\r\n              deleteFolderButton.element.setAttribute('disabled', 'true');\r\n              this.managers.filtersStorage.updateDialogFilter(this.filter, true).then((bool) => {\r\n                if(bool) {\r\n                  this.close();\r\n                }\r\n              }).finally(() => {\r\n                deleteFolderButton.element.removeAttribute('disabled');\r\n              });\r\n            },\r\n            isDanger: true\r\n          }]\r\n        }).show();\r\n      }\r\n    };\r\n    this.menuBtn = ButtonMenuToggle({listenerSetter: this.listenerSetter}, 'bottom-left', [deleteFolderButton]);\r\n    this.menuBtn.classList.add('hide');\r\n\r\n    this.header.append(this.confirmBtn, this.menuBtn);\r\n\r\n    const inputSection = new SettingSection({});\r\n\r\n    const inputWrapper = document.createElement('div');\r\n    inputWrapper.classList.add('input-wrapper');\r\n\r\n    this.nameInputField = new InputField({\r\n      label: 'FilterNameHint',\r\n      maxLength: MAX_FOLDER_NAME_LENGTH\r\n    });\r\n\r\n    inputWrapper.append(this.nameInputField.container);\r\n    inputSection.content.append(inputWrapper);\r\n\r\n    const generateList = (className: string, h2Text: LangPackKey, buttons: {icon: string, name?: string, withRipple?: true, text: LangPackKey}[], to: any) => {\r\n      const section = new SettingSection({\r\n        name: h2Text,\r\n        noDelimiter: true\r\n      });\r\n\r\n      section.container.classList.add('folder-list', className);\r\n\r\n      const categories = section.generateContentElement();\r\n      categories.classList.add('folder-categories');\r\n\r\n      buttons.forEach((o) => {\r\n        const button = Button('folder-category-button btn btn-primary btn-transparent', {\r\n          icon: o.icon,\r\n          text: o.text,\r\n          noRipple: o.withRipple ? undefined : true\r\n        });\r\n\r\n        if(o.name) {\r\n          to[o.name] = button;\r\n        }\r\n\r\n        categories.append(button);\r\n      });\r\n\r\n      return section;\r\n    };\r\n\r\n    this.includePeerIds = generateList('folder-list-included', 'FilterInclude', [{\r\n      icon: 'add primary',\r\n      text: 'ChatList.Filter.Include.AddChat',\r\n      withRipple: true\r\n    }, {\r\n      text: 'ChatList.Filter.Contacts',\r\n      icon: 'newprivate',\r\n      name: 'contacts'\r\n    }, {\r\n      text: 'ChatList.Filter.NonContacts',\r\n      icon: 'noncontacts',\r\n      name: 'non_contacts'\r\n    }, {\r\n      text: 'ChatList.Filter.Groups',\r\n      icon: 'group',\r\n      name: 'groups'\r\n    }, {\r\n      text: 'ChatList.Filter.Channels',\r\n      icon: 'channel',\r\n      name: 'broadcasts'\r\n    }, {\r\n      text: 'ChatList.Filter.Bots',\r\n      icon: 'bots',\r\n      name: 'bots'\r\n    }], this.flags);\r\n\r\n    this.excludePeerIds = generateList('folder-list-excluded', 'FilterExclude', [{\r\n      icon: 'minus primary',\r\n      text: 'ChatList.Filter.Exclude.AddChat',\r\n      withRipple: true\r\n    }, {\r\n      text: 'ChatList.Filter.MutedChats',\r\n      icon: 'mute',\r\n      name: 'exclude_muted'\r\n    }, {\r\n      text: 'ChatList.Filter.Archive',\r\n      icon: 'archive',\r\n      name: 'exclude_archived'\r\n    }, {\r\n      text: 'ChatList.Filter.ReadChats',\r\n      icon: 'readchats',\r\n      name: 'exclude_read'\r\n    }], this.flags);\r\n\r\n    this.scrollable.append(this.stickerContainer, this.caption, inputSection.container, this.includePeerIds.container, this.excludePeerIds.container);\r\n\r\n    const includedFlagsContainer = this.includePeerIds.container.querySelector('.folder-categories');\r\n    const excludedFlagsContainer = this.excludePeerIds.container.querySelector('.folder-categories');\r\n\r\n    attachClickEvent(includedFlagsContainer.querySelector('.btn') as HTMLElement, () => {\r\n      this.slider.createTab(AppIncludedChatsTab).open(this.filter, 'included', this);\r\n    }, {listenerSetter: this.listenerSetter});\r\n\r\n    attachClickEvent(excludedFlagsContainer.querySelector('.btn') as HTMLElement, () => {\r\n      this.slider.createTab(AppIncludedChatsTab).open(this.filter, 'excluded', this);\r\n    }, {listenerSetter: this.listenerSetter});\r\n\r\n    attachClickEvent(this.confirmBtn, () => {\r\n      if(this.nameInputField.input.classList.contains('error')) {\r\n        return;\r\n      }\r\n\r\n      if(!this.nameInputField.value.trim()) {\r\n        this.nameInputField.input.classList.add('error');\r\n        return;\r\n      }\r\n\r\n      let include = (Array.from(includedFlagsContainer.children) as HTMLElement[]).slice(1).reduce((acc, el) => acc + +!el.style.display, 0);\r\n      include += this.filter.include_peers.length;\r\n\r\n      if(!include) {\r\n        toast('Please choose at least one chat for this folder.');\r\n        return;\r\n      }\r\n\r\n      this.confirmBtn.setAttribute('disabled', 'true');\r\n\r\n      let promise: Promise<boolean>;\r\n      if(!this.filter.id) {\r\n        promise = this.managers.filtersStorage.createDialogFilter(this.filter);\r\n      } else {\r\n        promise = this.managers.filtersStorage.updateDialogFilter(this.filter);\r\n      }\r\n\r\n      promise.then((bool) => {\r\n        if(bool) {\r\n          this.close();\r\n        }\r\n      }).catch((err) => {\r\n        if(err.type === 'DIALOG_FILTERS_TOO_MUCH') {\r\n          toast('Sorry, you can\\'t create more folders.');\r\n        } else {\r\n          console.error('updateDialogFilter error:', err);\r\n        }\r\n      }).finally(() => {\r\n        this.confirmBtn.removeAttribute('disabled');\r\n      });\r\n    }, {listenerSetter: this.listenerSetter});\r\n\r\n    this.listenerSetter.add(this.nameInputField.input)('input', () => {\r\n      this.filter.title = this.nameInputField.value;\r\n      this.editCheckForChange();\r\n    });\r\n\r\n    const reloadMissingPromises: Promise<any>[] = this.type === 'edit' ? [\r\n      this.managers.filtersStorage.reloadMissingPeerIds(this.filter.id, 'pinned_peers'),\r\n      this.managers.filtersStorage.reloadMissingPeerIds(this.filter.id, 'include_peers'),\r\n      this.managers.filtersStorage.reloadMissingPeerIds(this.filter.id, 'exclude_peers')\r\n    ] : [];\r\n\r\n    return Promise.all([\r\n      this.loadAnimationPromise = lottieLoader.loadAnimationAsAsset({\r\n        container: this.stickerContainer,\r\n        loop: false,\r\n        autoplay: false,\r\n        width: 86,\r\n        height: 86\r\n      }, 'Folders_2').then((player) => {\r\n        this.animation = player;\r\n\r\n        return lottieLoader.waitForFirstFrame(player);\r\n      }),\r\n\r\n      ...reloadMissingPromises\r\n    ]);\r\n  }\r\n\r\n  onOpenAfterTimeout() {\r\n    this.loadAnimationPromise.then(() => {\r\n      this.animation.autoplay = true;\r\n      this.animation.play();\r\n    });\r\n  }\r\n\r\n  private onCreateOpen() {\r\n    // this.caption.style.display = '';\r\n    this.setTitle('FilterNew');\r\n    this.menuBtn.classList.add('hide');\r\n    this.confirmBtn.classList.remove('hide');\r\n    this.nameInputField.value = '';\r\n\r\n    for(const flag in this.flags) {\r\n      // @ts-ignore\r\n      this.flags[flag].style.display = 'none';\r\n    }\r\n  }\r\n\r\n  private onEditOpen() {\r\n    // this.caption.style.display = 'none';\r\n    this.setTitle(this.type === 'create' ? 'FilterNew' : 'FilterHeaderEdit');\r\n\r\n    if(this.type === 'edit') {\r\n      this.menuBtn.classList.remove('hide');\r\n      this.confirmBtn.classList.add('hide');\r\n    }\r\n\r\n    const filter = this.filter;\r\n    this.nameInputField.value = documentFragmentToHTML(wrapDraftText(filter.title));\r\n\r\n    for(const flag in this.flags) {\r\n      this.flags[flag as keyof AppEditFolderTab['flags']].style.display = !!filter.pFlags[flag as keyof AppEditFolderTab['flags']] ? '' : 'none';\r\n    }\r\n\r\n    (['includePeerIds' as const, 'excludePeerIds' as const]).forEach(async(key) => {\r\n      const section = this[key];\r\n      const ul = appDialogsManager.createChatList({ignoreClick: true});\r\n\r\n      let peers = filter[key];\r\n\r\n      // filter peers where we're kicked\r\n      const hasPeer = async(peerId: PeerId) => {\r\n        return !!(await this.managers.appMessagesManager.getDialogOnly(peerId)) || (peerId.isUser() ? (await this.managers.appUsersManager.getUser(peerId.toUserId()))._ === 'user' : false);\r\n      };\r\n\r\n      const filtered = await filterAsync(peers, (peerId) => hasPeer(peerId));\r\n      peers.length = 0;\r\n      peers.push(...filtered);\r\n\r\n      peers = peers.slice();\r\n\r\n      const renderMore = async(_length: number) => {\r\n        for(let i = 0, length = Math.min(peers.length, _length); i < length; ++i) {\r\n          const peerId = peers.shift();\r\n          if(peerId.isUser() ? false : !(await this.managers.appMessagesManager.getDialogOnly(peerId))) {\r\n            continue;\r\n          }\r\n\r\n          const {dom} = appDialogsManager.addDialogNew({\r\n            peerId: peerId,\r\n            container: ul,\r\n            rippleEnabled: false,\r\n            meAsSaved: true,\r\n            avatarSize: 32\r\n          });\r\n          dom.lastMessageSpan.parentElement.remove();\r\n        }\r\n\r\n        if(peers.length) {\r\n          showMore.lastElementChild.replaceWith(i18n('FilterShowMoreChats', [peers.length]));\r\n        } else if(showMore) {\r\n          showMore.remove();\r\n        }\r\n      };\r\n\r\n      section.generateContentElement().append(ul);\r\n\r\n      let showMore: HTMLElement;\r\n      if(peers.length) {\r\n        const content = section.generateContentElement();\r\n        showMore = Button('folder-category-button btn btn-primary btn-transparent', {icon: 'down'});\r\n        showMore.classList.add('load-more', 'rp-overflow');\r\n        attachClickEvent(showMore, () => renderMore(20), {listenerSetter: this.listenerSetter});\r\n        showMore.append(i18n('FilterShowMoreChats', [peers.length]));\r\n\r\n        content.append(showMore);\r\n      }\r\n\r\n      renderMore(4);\r\n    });\r\n  }\r\n\r\n  editCheckForChange() {\r\n    if(this.type === 'edit') {\r\n      const changed = !deepEqual(this.originalFilter, this.filter);\r\n      this.confirmBtn.classList.toggle('hide', !changed);\r\n      this.menuBtn.classList.toggle('hide', changed);\r\n    }\r\n  };\r\n\r\n  setFilter(filter: DialogFilter, firstTime: boolean) {\r\n    if(this.container) {\r\n      // cleanup\r\n      Array.from(this.container.querySelectorAll('ul, .load-more')).forEach((el) => el.remove());\r\n    }\r\n\r\n    if(firstTime) {\r\n      this.originalFilter = filter;\r\n      this.filter = copy(filter);\r\n    } else {\r\n      this.filter = filter;\r\n      this.onEditOpen();\r\n      this.editCheckForChange();\r\n    }\r\n  }\r\n\r\n  public open(filter?: DialogFilter) {\r\n    if(filter === undefined) {\r\n      this.setFilter({\r\n        _: 'dialogFilter',\r\n        id: 0,\r\n        title: '',\r\n        pFlags: {},\r\n        pinned_peers: [],\r\n        include_peers: [],\r\n        exclude_peers: [],\r\n        pinnedPeerIds: [],\r\n        includePeerIds: [],\r\n        excludePeerIds: []\r\n      }, true);\r\n      this.type = 'create';\r\n    } else {\r\n      this.setFilter(filter, true);\r\n      this.type = 'edit';\r\n    }\r\n\r\n    return super.open().then(() => {\r\n      if(this.type === 'edit') {\r\n        this.setFilter(this.originalFilter, true);\r\n        this.onEditOpen();\r\n      } else {\r\n        this.onCreateOpen();\r\n      }\r\n    });\r\n  }\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport appImManager from '../../lib/appManagers/appImManager';\r\nimport SidebarSlider from '../slider';\r\nimport mediaSizes, {ScreenSize} from '../../helpers/mediaSizes';\r\nimport AppSharedMediaTab from './tabs/sharedMedia';\r\nimport {MOUNT_CLASS_TO} from '../../config/debug';\r\nimport {AppManagers} from '../../lib/appManagers/managers';\r\n\r\nexport const RIGHT_COLUMN_ACTIVE_CLASSNAME = 'is-right-column-shown';\r\n\r\nexport class AppSidebarRight extends SidebarSlider {\r\n  private isColumnProportionSet = false;\r\n  private sharedMediaTab: AppSharedMediaTab;\r\n\r\n  constructor() {\r\n    super({\r\n      sidebarEl: document.getElementById('column-right') as HTMLElement,\r\n      canHideFirst: true,\r\n      navigationType: 'right'\r\n    });\r\n  }\r\n\r\n  construct(managers: AppManagers) {\r\n    this.managers = managers;\r\n\r\n    mediaSizes.addEventListener('changeScreen', (from, to) => {\r\n      if(to === ScreenSize.medium && from !== ScreenSize.mobile) {\r\n        this.toggleSidebar(false);\r\n      }\r\n    });\r\n\r\n    mediaSizes.addEventListener('resize', () => {\r\n      this.setColumnProportion();\r\n    });\r\n  }\r\n\r\n  public createSharedMediaTab() {\r\n    const tab = this.createTab(AppSharedMediaTab, true);\r\n    tab.slider = this;\r\n    // this.tabsContainer.prepend(tab.container);\r\n    return tab;\r\n  }\r\n\r\n  public replaceSharedMediaTab(tab?: AppSharedMediaTab) {\r\n    const previousTab = this.sharedMediaTab;\r\n    if(previousTab) {\r\n      const idx = this.historyTabIds.indexOf(previousTab);\r\n\r\n      if(this._selectTab.getFrom() === previousTab.container) {\r\n        this._selectTab.setFrom(tab.container);\r\n      }\r\n\r\n      if(tab) {\r\n        if(idx !== -1) {\r\n          this.historyTabIds[idx] = tab;\r\n        }\r\n\r\n        const wasActive = previousTab.container.classList.contains('active');\r\n        if(wasActive) {\r\n          tab.container.classList.add('active');\r\n        }\r\n\r\n        previousTab.container.replaceWith(tab.container);\r\n      } else {\r\n        if(idx !== -1) {\r\n          this.historyTabIds.splice(idx, 1);\r\n        }\r\n\r\n        previousTab.container.remove();\r\n      }\r\n    } else {\r\n      this.tabsContainer.prepend(tab.container);\r\n    }\r\n\r\n    this.sharedMediaTab = tab;\r\n  }\r\n\r\n  public onCloseTab(id: number, animate: boolean, isNavigation?: boolean) {\r\n    if(!this.historyTabIds.length) {\r\n      this.toggleSidebar(false, animate);\r\n    }\r\n\r\n    super.onCloseTab(id, animate, isNavigation);\r\n  }\r\n\r\n  private setColumnProportion() {\r\n    const proportion = this.sidebarEl.scrollWidth / this.sidebarEl.previousElementSibling.scrollWidth;\r\n    document.documentElement.style.setProperty('--right-column-proportion', '' + proportion);\r\n  }\r\n\r\n  public toggleSidebar(enable?: boolean, animate?: boolean) {\r\n    const active = document.body.classList.contains(RIGHT_COLUMN_ACTIVE_CLASSNAME);\r\n    let willChange: boolean;\r\n    if(enable !== undefined) {\r\n      if(enable) {\r\n        if(!active) {\r\n          willChange = true;\r\n        }\r\n      } else if(active) {\r\n        willChange = true;\r\n      }\r\n    } else {\r\n      willChange = true;\r\n    }\r\n\r\n    if(!willChange) return Promise.resolve();\r\n\r\n    if(!active && !this.historyTabIds.length) {\r\n      this.sharedMediaTab.open();\r\n    }\r\n\r\n    if(!this.isColumnProportionSet) {\r\n      this.setColumnProportion();\r\n      this.isColumnProportionSet = true;\r\n    }\r\n\r\n    const animationPromise = appImManager.selectTab(active ? 1 : 2, animate);\r\n    document.body.classList.toggle(RIGHT_COLUMN_ACTIVE_CLASSNAME, enable);\r\n    return animationPromise;\r\n\r\n    /* return new Promise((resolve, reject) => {\r\n      const hidden: {element: HTMLDivElement, height: number}[] = [];\r\n      const observer = new IntersectionObserver((entries) => {\r\n        for(const entry of entries) {\r\n          const bubble = entry.target as HTMLDivElement;\r\n          if(!entry.isIntersecting) {\r\n            hidden.push({element: bubble, height: bubble.scrollHeight});\r\n          }\r\n        }\r\n\r\n        for(const item of hidden) {\r\n          item.element.style.minHeight = item.height + 'px';\r\n          (item.element.firstElementChild as HTMLElement).style.display = 'none';\r\n          item.element.style.width = '1px';\r\n        }\r\n\r\n        //console.log('hidden', hidden);\r\n        observer.disconnect();\r\n\r\n        set();\r\n\r\n        setTimeout(() => {\r\n          for(const item of hidden) {\r\n            item.element.style.minHeight = '';\r\n            item.element.style.width = '';\r\n            (item.element.firstElementChild as HTMLElement).style.display = '';\r\n          }\r\n\r\n          resolve();\r\n        }, 200);\r\n      });\r\n\r\n      const length = Object.keys(appImManager.bubbles).length;\r\n      if(length) {\r\n        for(const i in appImManager.bubbles) {\r\n          observer.observe(appImManager.bubbles[i]);\r\n        }\r\n      } else {\r\n        set();\r\n        setTimeout(resolve, 200);\r\n      }\r\n    }); */\r\n  }\r\n}\r\n\r\nconst appSidebarRight = new AppSidebarRight();\r\nMOUNT_CLASS_TO.appSidebarRight = appSidebarRight;\r\nexport default appSidebarRight;\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport {SliderSuperTab} from '../../slider'\r\nimport InputField from '../../inputField';\r\nimport EditPeer from '../../editPeer';\r\nimport {SettingSection} from '../../sidebarLeft';\r\nimport Row from '../../row';\r\nimport CheckboxField from '../../checkboxField';\r\nimport Button from '../../button';\r\nimport PeerTitle from '../../peerTitle';\r\nimport rootScope from '../../../lib/rootScope';\r\nimport PopupPeer from '../../popups/peer';\r\nimport {addCancelButton} from '../../popups';\r\nimport {i18n} from '../../../lib/langPack';\r\nimport {attachClickEvent} from '../../../helpers/dom/clickEvent';\r\nimport toggleDisability from '../../../helpers/dom/toggleDisability';\r\nimport getPeerId from '../../../lib/appManagers/utils/peers/getPeerId';\r\nimport formatUserPhone from '../../wrappers/formatUserPhone';\r\n\r\nexport default class AppEditContactTab extends SliderSuperTab {\r\n  private nameInputField: InputField;\r\n  private lastNameInputField: InputField;\r\n  private editPeer: EditPeer;\r\n  public peerId: PeerId;\r\n\r\n  protected async init() {\r\n    this.container.classList.add('edit-peer-container', 'edit-contact-container');\r\n    const isNew = !(await this.managers.appUsersManager.isContact(this.peerId.toUserId()));\r\n    this.setTitle(isNew ? 'AddContactTitle' : 'Edit');\r\n\r\n    {\r\n      const section = new SettingSection({noDelimiter: true});\r\n      const inputFields: InputField[] = [];\r\n\r\n      const inputWrapper = document.createElement('div');\r\n      inputWrapper.classList.add('input-wrapper');\r\n\r\n      this.nameInputField = new InputField({\r\n        label: 'FirstName',\r\n        name: 'contact-name',\r\n        maxLength: 70,\r\n        required: true\r\n      });\r\n      this.lastNameInputField = new InputField({\r\n        label: 'LastName',\r\n        name: 'contact-lastname',\r\n        maxLength: 70\r\n      });\r\n\r\n      if(this.peerId) {\r\n        const user = await this.managers.appUsersManager.getUser(this.peerId);\r\n\r\n        if(isNew) {\r\n          this.nameInputField.setDraftValue(user.first_name);\r\n          this.lastNameInputField.setDraftValue(user.last_name);\r\n        } else {\r\n          this.nameInputField.setOriginalValue(user.first_name);\r\n          this.lastNameInputField.setOriginalValue(user.last_name);\r\n        }\r\n      }\r\n\r\n      inputWrapper.append(this.nameInputField.container, this.lastNameInputField.container);\r\n      inputFields.push(this.nameInputField, this.lastNameInputField);\r\n\r\n      this.editPeer = new EditPeer({\r\n        peerId: this.peerId,\r\n        inputFields,\r\n        listenerSetter: this.listenerSetter,\r\n        doNotEditAvatar: true\r\n      });\r\n      this.content.append(this.editPeer.nextBtn);\r\n\r\n      if(this.peerId) {\r\n        const div = document.createElement('div');\r\n        div.classList.add('avatar-edit');\r\n        div.append(this.editPeer.avatarElem);\r\n\r\n        const notificationsCheckboxField = new CheckboxField({\r\n          text: 'Notifications'\r\n        });\r\n\r\n        notificationsCheckboxField.input.addEventListener('change', (e) => {\r\n          if(!e.isTrusted) {\r\n            return;\r\n          }\r\n\r\n          this.managers.appMessagesManager.togglePeerMute(this.peerId);\r\n        });\r\n\r\n        this.listenerSetter.add(rootScope)('notify_settings', async(update) => {\r\n          if(update.peer._ !== 'notifyPeer') return;\r\n          const peerId = getPeerId(update.peer.peer);\r\n          if(this.peerId === peerId) {\r\n            const enabled = !(await this.managers.appNotificationsManager.isMuted(update.notify_settings));\r\n            if(enabled !== notificationsCheckboxField.checked) {\r\n              notificationsCheckboxField.checked = enabled;\r\n            }\r\n          }\r\n        });\r\n\r\n        const profileNameDiv = document.createElement('div');\r\n        profileNameDiv.classList.add('profile-name');\r\n        profileNameDiv.append(new PeerTitle({\r\n          peerId: this.peerId\r\n        }).element);\r\n        // profileNameDiv.innerHTML = 'Karen Stanford';\r\n\r\n        const profileSubtitleDiv = document.createElement('div');\r\n        profileSubtitleDiv.classList.add('profile-subtitle');\r\n        profileSubtitleDiv.append(i18n('EditContact.OriginalName'));\r\n\r\n        section.content.append(div, profileNameDiv, profileSubtitleDiv, inputWrapper);\r\n\r\n        if(!isNew) {\r\n          const notificationsRow = new Row({\r\n            checkboxField: notificationsCheckboxField,\r\n            listenerSetter: this.listenerSetter\r\n          });\r\n\r\n          const enabled = !(await this.managers.appNotificationsManager.isPeerLocalMuted(this.peerId, false));\r\n          notificationsCheckboxField.checked = enabled;\r\n\r\n          section.content.append(notificationsRow.container);\r\n        } else {\r\n          const user = await this.managers.appUsersManager.getUser(this.peerId);\r\n\r\n          const phoneRow = new Row({\r\n            icon: 'phone',\r\n            titleLangKey: user.phone ? undefined : 'MobileHidden',\r\n            title: user.phone ? formatUserPhone(user.phone)  : undefined,\r\n            subtitleLangKey: user.phone ? 'Phone' : 'MobileHiddenExceptionInfo',\r\n            subtitleLangArgs: user.phone ? undefined : [new PeerTitle({peerId: this.peerId}).element]\r\n          });\r\n\r\n          section.content.append(phoneRow.container);\r\n        }\r\n      } else {\r\n        section.content.append(inputWrapper);\r\n      }\r\n\r\n      this.scrollable.append(section.container);\r\n\r\n      attachClickEvent(this.editPeer.nextBtn, async() => {\r\n        this.editPeer.nextBtn.disabled = true;\r\n\r\n        this.managers.appUsersManager.addContact(\r\n          this.peerId,\r\n          this.nameInputField.value,\r\n          this.lastNameInputField.value,\r\n          (await this.managers.appUsersManager.getUser(this.peerId)).phone\r\n        ).finally(() => {\r\n          this.editPeer.nextBtn.removeAttribute('disabled');\r\n          this.close();\r\n        });\r\n      }, {listenerSetter: this.listenerSetter});\r\n    }\r\n\r\n    if(!isNew) {\r\n      const section = new SettingSection({\r\n\r\n      });\r\n\r\n      const btnDelete = Button('btn-primary btn-transparent danger', {icon: 'delete', text: 'PeerInfo.DeleteContact'});\r\n\r\n      attachClickEvent(btnDelete, () => {\r\n        new PopupPeer('popup-delete-contact', {\r\n          peerId: this.peerId,\r\n          titleLangKey: 'DeleteContact',\r\n          descriptionLangKey: 'AreYouSureDeleteContact',\r\n          buttons: addCancelButton([{\r\n            langKey: 'Delete',\r\n            callback: () => {\r\n              const toggle = toggleDisability([btnDelete], true);\r\n\r\n              this.managers.appUsersManager.deleteContacts([this.peerId]).then(() => {\r\n                this.close();\r\n              }, () => {\r\n                toggle();\r\n              });\r\n            },\r\n            isDanger: true\r\n          }])\r\n        }).show();\r\n      }, {listenerSetter: this.listenerSetter});\r\n\r\n      section.content.append(btnDelete);\r\n\r\n      this.scrollable.append(section.container);\r\n    }\r\n  }\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport {copyTextToClipboard} from '../../../helpers/clipboard';\r\nimport {randomLong} from '../../../helpers/random';\r\nimport {Chat, ChatFull, ExportedChatInvite} from '../../../layer';\r\nimport Button from '../../button';\r\nimport {setButtonLoader} from '../../putPreloader';\r\nimport RadioField from '../../radioField';\r\nimport Row, {RadioFormFromRows} from '../../row';\r\nimport {SettingSection} from '../../sidebarLeft';\r\nimport {toast} from '../../toast';\r\nimport {UsernameInputField} from '../../usernameInputField';\r\nimport {SliderSuperTabEventable} from '../../sliderTab';\r\nimport I18n from '../../../lib/langPack';\r\nimport PopupPeer from '../../popups/peer';\r\nimport ButtonCorner from '../../buttonCorner';\r\nimport {attachClickEvent} from '../../../helpers/dom/clickEvent';\r\nimport toggleDisability from '../../../helpers/dom/toggleDisability';\r\nimport CheckboxField from '../../checkboxField';\r\nimport rootScope from '../../../lib/rootScope';\r\n\r\nexport default class AppChatTypeTab extends SliderSuperTabEventable {\r\n  public chatId: ChatId;\r\n  public chatFull: ChatFull;\r\n\r\n  protected async init() {\r\n    this.container.classList.add('edit-peer-container', 'group-type-container');\r\n\r\n    const isBroadcast = await this.managers.appChatsManager.isBroadcast(this.chatId);\r\n\r\n    this.setTitle(isBroadcast ? 'ChannelType' : 'GroupType');\r\n\r\n    const section = new SettingSection({\r\n      name: isBroadcast ? 'ChannelType' : 'GroupType'\r\n    });\r\n\r\n    const random = randomLong();\r\n    const privateRow = new Row({\r\n      radioField: new RadioField({\r\n        langKey: isBroadcast ? 'ChannelPrivate' : 'MegaPrivate',\r\n        name: random,\r\n        value: 'private'\r\n      }),\r\n      subtitleLangKey: isBroadcast ? 'ChannelPrivateInfo' : 'MegaPrivateInfo'\r\n    });\r\n    const publicRow = new Row({\r\n      radioField: new RadioField({\r\n        langKey: isBroadcast ? 'ChannelPublic' : 'MegaPublic',\r\n        name: random,\r\n        value: 'public'\r\n      }),\r\n      subtitleLangKey: isBroadcast ? 'ChannelPublicInfo' : 'MegaPublicInfo'\r\n    });\r\n    const form = RadioFormFromRows([privateRow, publicRow], (value) => {\r\n      const a = [privateSection, publicSection];\r\n      if(value === 'public') a.reverse();\r\n\r\n      a[0].container.classList.remove('hide');\r\n      a[1].container.classList.add('hide');\r\n\r\n      onChange();\r\n    });\r\n\r\n    const chat: Chat = await this.managers.appChatsManager.getChat(this.chatId);\r\n\r\n    section.content.append(form);\r\n\r\n    const privateSection = new SettingSection({});\r\n\r\n    // let revoked = false;\r\n    const linkRow = new Row({\r\n      title: (this.chatFull.exported_invite as ExportedChatInvite.chatInviteExported).link,\r\n      subtitleLangKey: isBroadcast ? 'ChannelPrivateLinkHelp' : 'MegaPrivateLinkHelp',\r\n      clickable: () => {\r\n        copyTextToClipboard((this.chatFull.exported_invite as ExportedChatInvite.chatInviteExported).link);\r\n        toast(I18n.format('LinkCopied', true));\r\n      },\r\n      listenerSetter: this.listenerSetter\r\n    });\r\n\r\n    const btnRevoke = Button('btn-primary btn-transparent danger', {icon: 'delete', text: 'RevokeLink'});\r\n\r\n    attachClickEvent(btnRevoke, () => {\r\n      new PopupPeer('revoke-link', {\r\n        buttons: [{\r\n          langKey: 'RevokeButton',\r\n          callback: () => {\r\n            const toggle = toggleDisability([btnRevoke], true);\r\n\r\n            this.managers.appProfileManager.getChatInviteLink(this.chatId, true).then((link) => {\r\n              toggle();\r\n              linkRow.title.innerHTML = link;\r\n              // revoked = true;\r\n              // onChange();\r\n            });\r\n          }\r\n        }],\r\n        titleLangKey: 'RevokeLink',\r\n        descriptionLangKey: 'RevokeAlert'\r\n      }).show();\r\n    }, {listenerSetter: this.listenerSetter});\r\n\r\n    privateSection.content.append(linkRow.container, btnRevoke);\r\n\r\n    const publicSection = new SettingSection({\r\n      caption: isBroadcast ? 'Channel.UsernameAboutChannel' : 'Channel.UsernameAboutGroup',\r\n      noDelimiter: true\r\n    });\r\n\r\n    const inputWrapper = document.createElement('div');\r\n    inputWrapper.classList.add('input-wrapper');\r\n\r\n    const placeholder = 't.me/';\r\n\r\n    const onChange = () => {\r\n      const changed = (privateRow.radioField.checked && (originalValue !== placeholder/*  || revoked */)) ||\r\n        (linkInputField.isValidToChange() && linkInputField.input.classList.contains('valid'));\r\n      applyBtn.classList.toggle('is-visible', changed);\r\n    };\r\n\r\n    const linkInputField = new UsernameInputField({\r\n      label: 'SetUrlPlaceholder',\r\n      name: 'group-public-link',\r\n      plainText: true,\r\n      listenerSetter: this.listenerSetter,\r\n      availableText: 'Link.Available',\r\n      invalidText: 'Link.Invalid',\r\n      takenText: 'Link.Taken',\r\n      onChange: onChange,\r\n      peerId: this.chatId.toPeerId(true),\r\n      head: placeholder\r\n    }, this.managers);\r\n\r\n    const originalValue = placeholder + ((chat as Chat.channel).username || '');\r\n\r\n    inputWrapper.append(linkInputField.container)\r\n    publicSection.content.append(inputWrapper);\r\n\r\n    const applyBtn = ButtonCorner({icon: 'check', className: 'is-visible'});\r\n    this.content.append(applyBtn);\r\n\r\n    attachClickEvent(applyBtn, () => {\r\n      /* const unsetLoader =  */setButtonLoader(applyBtn);\r\n      const username = publicRow.radioField.checked ? linkInputField.getValue() : '';\r\n      this.managers.appChatsManager.migrateChat(this.chatId).then((channelId) => {\r\n        return this.managers.appChatsManager.updateUsername(channelId, username);\r\n      }).then(() => {\r\n        // unsetLoader();\r\n        this.close();\r\n      });\r\n    }, {listenerSetter: this.listenerSetter});\r\n\r\n    (originalValue !== placeholder ? publicRow : privateRow).radioField.checked = true;\r\n    linkInputField.setOriginalValue(originalValue);\r\n\r\n    this.scrollable.append(section.container, privateSection.container, publicSection.container);\r\n\r\n    {\r\n      const section = new SettingSection({\r\n        name: 'SavingContentTitle',\r\n        caption: isBroadcast ? 'RestrictSavingContentInfoChannel' : 'RestrictSavingContentInfoGroup'\r\n      });\r\n\r\n      const checkboxField = new CheckboxField({\r\n        text: 'RestrictSavingContent',\r\n        withRipple: true\r\n      });\r\n\r\n      this.listenerSetter.add(checkboxField.input)('change', () => {\r\n        const toggle = checkboxField.toggleDisability(true);\r\n        this.managers.appChatsManager.toggleNoForwards(this.chatId, checkboxField.checked).then(() => {\r\n          toggle();\r\n        });\r\n      });\r\n\r\n      const onChatUpdate = () => {\r\n        checkboxField.setValueSilently(!!(chat as Chat.channel).pFlags.noforwards);\r\n      };\r\n\r\n      this.listenerSetter.add(rootScope)('chat_update', (chatId) => {\r\n        if(this.chatId === chatId) {\r\n          onChatUpdate();\r\n        }\r\n      });\r\n\r\n      onChatUpdate();\r\n\r\n      section.content.append(checkboxField.label);\r\n\r\n      this.scrollable.append(section.container);\r\n    }\r\n  }\r\n}\r\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport {attachClickEvent} from '../../../helpers/dom/clickEvent';\nimport toggleDisability from '../../../helpers/dom/toggleDisability';\nimport deepEqual from '../../../helpers/object/deepEqual';\nimport {ChannelParticipant} from '../../../layer';\nimport appDialogsManager from '../../../lib/appManagers/appDialogsManager';\nimport Button from '../../button';\nimport {SettingSection} from '../../sidebarLeft';\nimport {SliderSuperTabEventable} from '../../sliderTab';\nimport getUserStatusString from '../../wrappers/getUserStatusString';\nimport {ChatPermissions} from './groupPermissions';\n\nexport default class AppUserPermissionsTab extends SliderSuperTabEventable {\n  public participant: ChannelParticipant;\n  public chatId: ChatId;\n  public userId: UserId;\n\n  protected async init() {\n    this.container.classList.add('edit-peer-container', 'user-permissions-container');\n    this.setTitle('UserRestrictions');\n\n    let destroyListener: () => void;\n\n    {\n      const section = new SettingSection({\n        name: 'UserRestrictionsCanDo'\n      });\n\n      const div = document.createElement('div');\n      div.classList.add('chatlist-container');\n      section.content.insertBefore(div, section.title);\n\n      const list = appDialogsManager.createChatList({new: true});\n      div.append(list);\n\n      const {dom} = appDialogsManager.addDialogNew({\n        peerId: this.userId.toPeerId(false),\n        container: list,\n        rippleEnabled: true,\n        avatarSize: 48\n      });\n\n      dom.lastMessageSpan.append(getUserStatusString(await this.managers.appUsersManager.getUser(this.userId)));\n\n      const p = new ChatPermissions({\n        chatId: this.chatId,\n        listenerSetter: this.listenerSetter,\n        appendTo: section.content,\n        participant: this.participant._ === 'channelParticipantBanned' ? this.participant : undefined\n      }, this.managers);\n\n      destroyListener = () => {\n        // appChatsManager.editChatDefaultBannedRights(this.chatId, p.takeOut());\n        const rights = p.takeOut();\n        if(this.participant._ === 'channelParticipantBanned' && deepEqual(this.participant.banned_rights.pFlags, rights.pFlags)) {\n          return;\n        }\n\n        this.managers.appChatsManager.editBanned(this.chatId, this.participant, rights);\n      };\n\n      this.eventListener.addEventListener('destroy', destroyListener, {once: true});\n\n      this.scrollable.append(section.container);\n    }\n\n    {\n      const section = new SettingSection({});\n\n      if(this.participant._ === 'channelParticipantBanned') {\n        const btnDeleteException = Button('btn-primary btn-transparent danger', {icon: 'delete', text: 'GroupPermission.Delete'});\n\n        attachClickEvent(btnDeleteException, () => {\n          const toggle = toggleDisability([btnDeleteException], true);\n          this.managers.appChatsManager.clearChannelParticipantBannedRights(this.chatId, this.participant).then(() => {\n            this.eventListener.removeEventListener('destroy', destroyListener);\n            this.close();\n          }, () => {\n            toggle();\n          });\n        }, {listenerSetter: this.listenerSetter});\n\n        section.content.append(btnDeleteException);\n      }\n\n      const btnDelete = Button('btn-primary btn-transparent danger', {icon: 'deleteuser', text: 'UserRestrictionsBlock'});\n\n      attachClickEvent(btnDelete, () => {\n        const toggle = toggleDisability([btnDelete], true);\n        this.managers.appChatsManager.kickFromChannel(this.chatId, this.participant).then(() => {\n          this.eventListener.removeEventListener('destroy', destroyListener);\n          this.close();\n        });\n        /* new PopupPeer('popup-group-kick-user', {\n          peerId: -this.chatId,\n          title: 'Ban User?',\n          description: `Are you sure you want to ban <b>${appPeersManager.getPeerTitle(this.userId)}</b>`,\n          buttons: addCancelButton([{\n            text: 'BAN',\n            callback: () => {\n              const toggle = toggleDisability([btnDelete], true);\n\n              appChatsManager.kickFromChannel(this.chatId, this.participant).then(() => {\n                this.eventListener.removeEventListener('destroy', destroyListener);\n                this.close();\n              }, () => {\n                toggle();\n              });\n            },\n            isDanger: true\n          }])\n        }).show(); */\n      }, {listenerSetter: this.listenerSetter});\n\n      section.content.append(btnDelete);\n\n      this.scrollable.append(section.container);\n    }\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport {attachClickEvent} from '../../../helpers/dom/clickEvent';\nimport findUpTag from '../../../helpers/dom/findUpTag';\nimport replaceContent from '../../../helpers/dom/replaceContent';\nimport ListenerSetter from '../../../helpers/listenerSetter';\nimport ScrollableLoader from '../../../helpers/scrollableLoader';\nimport {ChannelParticipant, Chat, ChatBannedRights, Update} from '../../../layer';\nimport {ChatRights} from '../../../lib/appManagers/appChatsManager';\nimport appDialogsManager, {DIALOG_LIST_ELEMENT_TAG} from '../../../lib/appManagers/appDialogsManager';\nimport {AppManagers} from '../../../lib/appManagers/managers';\nimport combineParticipantBannedRights from '../../../lib/appManagers/utils/chats/combineParticipantBannedRights';\nimport hasRights from '../../../lib/appManagers/utils/chats/hasRights';\nimport getPeerId from '../../../lib/appManagers/utils/peers/getPeerId';\nimport I18n, {i18n, join, LangPackKey} from '../../../lib/langPack';\nimport rootScope from '../../../lib/rootScope';\nimport CheckboxField from '../../checkboxField';\nimport PopupPickUser from '../../popups/pickUser';\nimport Row from '../../row';\nimport {SettingSection} from '../../sidebarLeft';\nimport {SliderSuperTabEventable} from '../../sliderTab';\nimport {toast} from '../../toast';\nimport AppUserPermissionsTab from './userPermissions';\n\nexport class ChatPermissions {\n  public v: Array<{\n    flags: ChatRights[],\n    text: LangPackKey,\n    exceptionText: LangPackKey,\n    checkboxField?: CheckboxField,\n  }>;\n  private toggleWith: Partial<{[chatRight in ChatRights]: ChatRights[]}>;\n\n  constructor(private options: {\n    chatId: ChatId,\n    listenerSetter: ListenerSetter,\n    appendTo: HTMLElement,\n    participant?: ChannelParticipant.channelParticipantBanned\n  }, private managers: AppManagers) {\n    this.construct();\n  }\n\n  public async construct() {\n    this.v = [\n      {flags: ['send_messages'], text: 'UserRestrictionsSend', exceptionText: 'UserRestrictionsNoSend'},\n      {flags: ['send_media'], text: 'UserRestrictionsSendMedia', exceptionText: 'UserRestrictionsNoSendMedia'},\n      {flags: ['send_stickers', 'send_gifs'], text: 'UserRestrictionsSendStickers', exceptionText: 'UserRestrictionsNoSendStickers'},\n      {flags: ['send_polls'], text: 'UserRestrictionsSendPolls', exceptionText: 'UserRestrictionsNoSendPolls'},\n      {flags: ['embed_links'], text: 'UserRestrictionsEmbedLinks', exceptionText: 'UserRestrictionsNoEmbedLinks'},\n      {flags: ['invite_users'], text: 'UserRestrictionsInviteUsers', exceptionText: 'UserRestrictionsNoInviteUsers'},\n      {flags: ['pin_messages'], text: 'UserRestrictionsPinMessages', exceptionText: 'UserRestrictionsNoPinMessages'},\n      {flags: ['change_info'], text: 'UserRestrictionsChangeInfo', exceptionText: 'UserRestrictionsNoChangeInfo'}\n    ];\n\n    this.toggleWith = {\n      'send_messages': ['send_media', 'send_stickers', 'send_polls', 'embed_links']\n    };\n\n    const options = this.options;\n    const chat: Chat.chat | Chat.channel = await this.managers.appChatsManager.getChat(options.chatId);\n    const defaultBannedRights = chat.default_banned_rights;\n    const rights = options.participant ? combineParticipantBannedRights(chat as Chat.channel, options.participant.banned_rights) : defaultBannedRights;\n\n    const restrictionText: LangPackKey = options.participant ? 'UserRestrictionsDisabled' : 'EditCantEditPermissionsPublic';\n    for(const info of this.v) {\n      const mainFlag = info.flags[0];\n      info.checkboxField = new CheckboxField({\n        text: info.text,\n        checked: hasRights(chat, mainFlag, rights),\n        restriction: true,\n        withRipple: true\n      });\n\n      if((\n        options.participant &&\n          defaultBannedRights.pFlags[mainFlag as keyof typeof defaultBannedRights['pFlags']]\n      ) || (\n        (chat as Chat.channel).username &&\n          (\n            info.flags.includes('pin_messages') ||\n            info.flags.includes('change_info')\n          )\n      )\n      ) {\n        info.checkboxField.input.disabled = true;\n\n        /* options.listenerSetter.add(info.checkboxField.input)('change', (e) => {\n          if(!e.isTrusted) {\n            return;\n          }\n\n          cancelEvent(e);\n          toast('This option is disabled for all members in Group Permissions.');\n          info.checkboxField.checked = false;\n        }); */\n\n        attachClickEvent(info.checkboxField.label, (e) => {\n          toast(I18n.format(restrictionText, true));\n        }, {listenerSetter: options.listenerSetter});\n      }\n\n      if(this.toggleWith[mainFlag]) {\n        options.listenerSetter.add(info.checkboxField.input)('change', () => {\n          if(!info.checkboxField.checked) {\n            const other = this.v.filter((i) => this.toggleWith[mainFlag].includes(i.flags[0]));\n            other.forEach((info) => {\n              info.checkboxField.checked = false;\n            });\n          }\n        });\n      }\n\n      options.appendTo.append(info.checkboxField.label);\n    }\n  }\n\n  public takeOut() {\n    const rights: ChatBannedRights = {\n      _: 'chatBannedRights',\n      until_date: 0x7FFFFFFF,\n      pFlags: {}\n    };\n\n    for(const info of this.v) {\n      const banned = !info.checkboxField.checked;\n      if(banned) {\n        info.flags.forEach((flag) => {\n          // @ts-ignore\n          rights.pFlags[flag] = true;\n        });\n      }\n    }\n\n    return rights;\n  }\n}\n\nexport default class AppGroupPermissionsTab extends SliderSuperTabEventable {\n  public chatId: ChatId;\n\n  protected async init() {\n    this.container.classList.add('edit-peer-container', 'group-permissions-container');\n    this.setTitle('ChannelPermissions');\n\n    let chatPermissions: ChatPermissions;\n    {\n      const section = new SettingSection({\n        name: 'ChannelPermissionsHeader'\n      });\n\n      chatPermissions = new ChatPermissions({\n        chatId: this.chatId,\n        listenerSetter: this.listenerSetter,\n        appendTo: section.content\n      }, this.managers);\n\n      this.eventListener.addEventListener('destroy', () => {\n        this.managers.appChatsManager.editChatDefaultBannedRights(this.chatId, chatPermissions.takeOut());\n      }, {once: true});\n\n      this.scrollable.append(section.container);\n    }\n\n    {\n      const section = new SettingSection({\n        name: 'PrivacyExceptions'\n      });\n\n      const addExceptionRow = new Row({\n        titleLangKey: 'ChannelAddException',\n        subtitleLangKey: 'Loading',\n        icon: 'adduser',\n        clickable: () => {\n          new PopupPickUser({\n            peerTypes: ['channelParticipants'],\n            onSelect: (peerId) => {\n              setTimeout(() => {\n                openPermissions(peerId);\n              }, 0);\n            },\n            placeholder: 'ExceptionModal.Search.Placeholder',\n            peerId: -this.chatId\n          });\n        },\n        listenerSetter: this.listenerSetter\n      });\n\n      const openPermissions = async(peerId: PeerId) => {\n        let participant: AppUserPermissionsTab['participant'];\n        try {\n          participant = await this.managers.appProfileManager.getChannelParticipant(this.chatId, peerId) as any;\n        } catch(err) {\n          toast('User is no longer participant');\n          return;\n        }\n\n        const tab = this.slider.createTab(AppUserPermissionsTab);\n        tab.participant = participant;\n        tab.chatId = this.chatId;\n        tab.userId = peerId;\n        tab.open();\n      };\n\n      section.content.append(addExceptionRow.container);\n\n      /* const removedUsersRow = new Row({\n        titleLangKey: 'ChannelBlockedUsers',\n        subtitleLangKey: 'NoBlockedUsers',\n        icon: 'deleteuser',\n        clickable: true\n      });\n\n      section.content.append(removedUsersRow.container); */\n\n      const c = section.generateContentElement();\n      c.classList.add('chatlist-container');\n\n      const list = appDialogsManager.createChatList({new: true});\n      c.append(list);\n\n      attachClickEvent(list, (e) => {\n        const target = findUpTag(e.target, DIALOG_LIST_ELEMENT_TAG);\n        if(!target) return;\n\n        const peerId = target.dataset.peerId.toPeerId();\n        openPermissions(peerId);\n      }, {listenerSetter: this.listenerSetter});\n\n      const setSubtitle = async(li: Element, participant: ChannelParticipant.channelParticipantBanned) => {\n        const bannedRights = participant.banned_rights;// appChatsManager.combineParticipantBannedRights(this.chatId, participant.banned_rights);\n        const defaultBannedRights = ((await this.managers.appChatsManager.getChat(this.chatId)) as Chat.channel).default_banned_rights;\n        // const combinedRights = appChatsManager.combineParticipantBannedRights(this.chatId, bannedRights);\n\n        const cantWhat: LangPackKey[] = []/* , canWhat: LangPackKey[] = [] */;\n        chatPermissions.v.forEach((info) => {\n          const mainFlag = info.flags[0];\n          // @ts-ignore\n          if(bannedRights.pFlags[mainFlag] && !defaultBannedRights.pFlags[mainFlag]) {\n            cantWhat.push(info.exceptionText);\n          // @ts-ignore\n          }/*  else if(!combinedRights.pFlags[mainFlag]) {\n            canWhat.push(info.exceptionText);\n          } */\n        });\n\n        const el = li.querySelector('.user-last-message') as HTMLElement;\n\n        if(cantWhat.length) {\n          el.innerHTML = '';\n          el.append(...join(cantWhat.map((t) => i18n(t)), false));\n        }/*  else if(canWhat.length) {\n          str = 'Can ' + canWhat.join(canWhat.length === 2 ? ' and ' : ', ');\n        } */\n\n        el.classList.toggle('hide', !cantWhat.length);\n      };\n\n      const add = (participant: ChannelParticipant.channelParticipantBanned, append: boolean) => {\n        const {dom} = appDialogsManager.addDialogNew({\n          peerId: getPeerId(participant.peer),\n          container: list,\n          rippleEnabled: true,\n          avatarSize: 48,\n          append\n        });\n\n        setSubtitle(dom.listEl, participant);\n\n        // dom.titleSpan.innerHTML = 'Chinaza Akachi';\n        // dom.lastMessageSpan.innerHTML = 'Can Add Users and Pin Messages';\n      };\n\n      // this.listenerSetter.add(rootScope)('updateChannelParticipant', (update: Update.updateChannelParticipant) => {\n      //   const needAdd = update.new_participant?._ === 'channelParticipantBanned' && !update.new_participant.banned_rights.pFlags.view_messages;\n      //   const li = list.querySelector(`[data-peer-id=\"${update.user_id}\"]`);\n      //   if(needAdd) {\n      //     if(!li) {\n      //       add(update.new_participant as ChannelParticipant.channelParticipantBanned, false);\n      //     } else {\n      //       setSubtitle(li, update.new_participant as ChannelParticipant.channelParticipantBanned);\n      //     }\n\n      //     if(update.prev_participant?._ !== 'channelParticipantBanned') {\n      //       ++exceptionsCount;\n      //     }\n      //   } else {\n      //     if(li) {\n      //       li.remove();\n      //     }\n\n      //     if(update.prev_participant?._ === 'channelParticipantBanned') {\n      //       --exceptionsCount;\n      //     }\n      //   }\n\n      //   setLength();\n      // });\n\n      const setLength = () => {\n        replaceContent(addExceptionRow.subtitle, i18n(exceptionsCount ? 'Permissions.ExceptionsCount' : 'Permissions.NoExceptions', [exceptionsCount]));\n      };\n\n      let exceptionsCount = 0;\n      let loader: ScrollableLoader;\n      const setLoader = () => {\n        const LOAD_COUNT = 50;\n        loader = new ScrollableLoader({\n          scrollable: this.scrollable,\n          getPromise: () => {\n            return this.managers.appProfileManager.getChannelParticipants(this.chatId, {_: 'channelParticipantsBanned', q: ''}, LOAD_COUNT, list.childElementCount).then((res) => {\n              for(const participant of res.participants) {\n                add(participant as ChannelParticipant.channelParticipantBanned, true);\n              }\n\n              exceptionsCount = res.count;\n              setLength();\n\n              return res.participants.length < LOAD_COUNT || res.count === list.childElementCount;\n            });\n          }\n        });\n\n        return loader.load();\n      };\n\n      this.scrollable.append(section.container);\n\n      if(await this.managers.appChatsManager.isChannel(this.chatId)) {\n        await setLoader();\n      } else {\n        setLength();\n\n        this.listenerSetter.add(rootScope)('dialog_migrate', ({migrateFrom, migrateTo}) => {\n          if(this.chatId === migrateFrom) {\n            this.chatId = migrateTo;\n            setLoader();\n          }\n        });\n      }\n    }\n  }\n\n  onOpenAfterTimeout() {\n    this.scrollable.onScroll();\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport copy from '../../../../helpers/object/copy';\nimport {ChatBannedRights, Chat} from '../../../../layer';\n\nexport default function combineParticipantBannedRights(chat: Chat.channel, rights: ChatBannedRights) {\n  if(chat.default_banned_rights) {\n    rights = copy(rights);\n    const defaultRights = chat.default_banned_rights.pFlags;\n    for(const i in defaultRights) {\n      // @ts-ignore\n      rights.pFlags[i] = defaultRights[i];\n    }\n  }\n\n  return rights;\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport debounce from '../../../helpers/schedulers/debounce';\nimport CheckboxField from '../../checkboxField';\nimport Row from '../../row';\nimport {SettingSection} from '../../sidebarLeft';\nimport {SliderSuperTabEventable} from '../../sliderTab';\nimport {wrapStickerToRow} from '../../wrappers';\n\nexport default class AppChatReactionsTab extends SliderSuperTabEventable {\n  public chatId: ChatId;\n\n  protected async init() {\n    this.setTitle('Reactions');\n\n    const availableReactions = await this.managers.appReactionsManager.getActiveAvailableReactions();\n    const chatFull = await this.managers.appProfileManager.getChatFull(this.chatId);\n    let originalReactions = chatFull.available_reactions ?? [];\n    const enabledReactions = new Set(originalReactions);\n\n    const toggleSection = new SettingSection({\n      caption: await this.managers.appChatsManager.isBroadcast(this.chatId) ? 'EnableReactionsChannelInfo' : 'EnableReactionsGroupInfo'\n    });\n\n    const toggleCheckboxField = new CheckboxField({toggle: true, checked: !!enabledReactions.size});\n    const toggleRow = new Row({\n      checkboxField: toggleCheckboxField,\n      titleLangKey: 'EnableReactions',\n      listenerSetter: this.listenerSetter\n    });\n\n    toggleSection.content.append(toggleRow.container);\n\n    const reactionsSection = new SettingSection({\n      name: 'AvailableReactions'\n    });\n\n    const checkboxFields = availableReactions.map((availableReaction) => {\n      const checkboxField = new CheckboxField({\n        toggle: true,\n        checked: enabledReactions.has(availableReaction.reaction)\n      });\n\n      this.listenerSetter.add(checkboxField.input)('change', () => {\n        if(checkboxField.checked) {\n          enabledReactions.add(availableReaction.reaction);\n\n          if(!toggleCheckboxField.checked) {\n            toggleCheckboxField.setValueSilently(true);\n          }\n        } else {\n          enabledReactions.delete(availableReaction.reaction);\n\n          if(!enabledReactions.size && toggleCheckboxField.checked) {\n            toggleCheckboxField.setValueSilently(false);\n          }\n        }\n\n        saveReactionsDebounced();\n      });\n\n      const row = new Row({\n        checkboxField,\n        title: availableReaction.title,\n        havePadding: true,\n        listenerSetter: this.listenerSetter\n      });\n\n      wrapStickerToRow({\n        row,\n        doc: availableReaction.static_icon,\n        size: 'small'\n      });\n\n      reactionsSection.content.append(row.container);\n\n      return checkboxField;\n    });\n\n    this.listenerSetter.add(toggleRow.checkboxField.input)('change', () => {\n      if(!toggleCheckboxField.checked) {\n        checkboxFields.forEach((checkboxField) => checkboxField.checked = false);\n        saveReactionsDebounced();\n      } else if(checkboxFields.every((checkboxField) => !checkboxField.checked)) {\n        checkboxFields.forEach((checkboxField) => checkboxField.checked = true);\n        saveReactionsDebounced();\n      }\n    });\n\n    const saveReactions = async() => {\n      const newReactions = Array.from(enabledReactions);\n      if([...newReactions].sort().join() === [...originalReactions].sort().join()) {\n        return;\n      }\n\n      const chatFull = await this.managers.appProfileManager.getCachedFullChat(this.chatId);\n      if(chatFull) {\n        chatFull.available_reactions = newReactions;\n      }\n\n      this.managers.appChatsManager.setChatAvailableReactions(this.chatId, newReactions);\n      originalReactions = newReactions;\n    };\n\n    const saveReactionsDebounced = debounce(saveReactions, 3000, false, true);\n\n    this.eventListener.addEventListener('destroy', saveReactions, {once: true});\n\n    this.scrollable.append(toggleSection.container, reactionsSection.container);\n  }\n}\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport {SliderSuperTab} from '../../slider'\r\nimport InputField from '../../inputField';\r\nimport EditPeer from '../../editPeer';\r\nimport {SettingSection} from '../../sidebarLeft';\r\nimport Row from '../../row';\r\nimport Button from '../../button';\r\nimport {ChatRights} from '../../../lib/appManagers/appChatsManager';\r\nimport {Chat, ChatFull} from '../../../layer';\r\nimport AppChatTypeTab from './chatType';\r\nimport rootScope from '../../../lib/rootScope';\r\nimport AppGroupPermissionsTab from './groupPermissions';\r\nimport {i18n, LangPackKey} from '../../../lib/langPack';\r\nimport PopupDeleteDialog from '../../popups/deleteDialog';\r\nimport {attachClickEvent} from '../../../helpers/dom/clickEvent';\r\nimport toggleDisability from '../../../helpers/dom/toggleDisability';\r\nimport CheckboxField from '../../checkboxField';\r\nimport AppChatReactionsTab from './chatReactions';\r\nimport hasRights from '../../../lib/appManagers/utils/chats/hasRights';\r\n\r\nexport default class AppEditChatTab extends SliderSuperTab {\r\n  private chatNameInputField: InputField;\r\n  private descriptionInputField: InputField;\r\n  private editPeer: EditPeer;\r\n  private tempId: number;\r\n  public chatId: ChatId;\r\n\r\n  protected async _init() {\r\n    // * cleanup prev\r\n    this.listenerSetter.removeAll();\r\n    this.scrollable.container.innerHTML = '';\r\n    this.tempId ??= 0;\r\n    const tempId = ++this.tempId;\r\n\r\n    this.container.classList.add('edit-peer-container', 'edit-group-container');\r\n    this.setTitle('Edit');\r\n\r\n    let chatFull = await this.managers.appProfileManager.getChatFull(this.chatId, true);\r\n\r\n    const chat: Chat.chat | Chat.channel = await this.managers.appChatsManager.getChat(this.chatId);\r\n    const isBroadcast = await this.managers.appChatsManager.isBroadcast(this.chatId);\r\n    const isChannel = await this.managers.appChatsManager.isChannel(this.chatId);\r\n\r\n    const chatUpdateListeners: (() => void)[] = [];\r\n    const addChatUpdateListener = (callback: () => void) => {\r\n      chatUpdateListeners.push(callback);\r\n    };\r\n\r\n    this.listenerSetter.add(rootScope)('chat_update', (chatId) => {\r\n      if(this.chatId === chatId) {\r\n        chatUpdateListeners.forEach((callback) => callback());\r\n      }\r\n    });\r\n\r\n    this.listenerSetter.add(rootScope)('chat_full_update', async(chatId) => {\r\n      if(this.chatId === chatId) {\r\n        chatFull = await this.managers.appProfileManager.getCachedFullChat(chatId) || chatFull;\r\n      }\r\n    });\r\n\r\n    const peerId = this.chatId.toPeerId(true);\r\n    const canChangeType = await this.managers.appChatsManager.hasRights(this.chatId, 'change_type');\r\n    const canChangePermissions = await this.managers.appChatsManager.hasRights(this.chatId, 'change_permissions');\r\n\r\n    {\r\n      const section = new SettingSection({noDelimiter: true});\r\n      const inputFields: InputField[] = [];\r\n\r\n      const inputWrapper = document.createElement('div');\r\n      inputWrapper.classList.add('input-wrapper');\r\n\r\n      this.chatNameInputField = new InputField({\r\n        label: isBroadcast ? 'EnterChannelName' : 'CreateGroup.NameHolder',\r\n        name: 'chat-name',\r\n        maxLength: 255,\r\n        required: true\r\n      });\r\n      this.descriptionInputField = new InputField({\r\n        label: 'DescriptionPlaceholder',\r\n        name: 'chat-description',\r\n        maxLength: 255\r\n      });\r\n\r\n      this.chatNameInputField.setOriginalValue(chat.title);\r\n      this.descriptionInputField.setOriginalValue(chatFull.about);\r\n\r\n      inputWrapper.append(this.chatNameInputField.container, this.descriptionInputField.container);\r\n\r\n      inputFields.push(this.chatNameInputField, this.descriptionInputField);\r\n\r\n      this.editPeer = new EditPeer({\r\n        peerId,\r\n        inputFields,\r\n        listenerSetter: this.listenerSetter\r\n      });\r\n      this.content.append(this.editPeer.nextBtn);\r\n\r\n      section.content.append(this.editPeer.avatarEdit.container, inputWrapper);\r\n\r\n      if(canChangeType) {\r\n        const chatTypeRow = new Row({\r\n          titleLangKey: isBroadcast ? 'ChannelType' : 'GroupType',\r\n          clickable: () => {\r\n            const tab = this.slider.createTab(AppChatTypeTab);\r\n            tab.chatId = this.chatId;\r\n            tab.chatFull = chatFull;\r\n            tab.open();\r\n\r\n            this.listenerSetter.add(tab.eventListener)('destroy', setChatTypeSubtitle);\r\n          },\r\n          icon: 'lock',\r\n          listenerSetter: this.listenerSetter\r\n        });\r\n\r\n        const setChatTypeSubtitle = () => {\r\n          chatTypeRow.subtitle.textContent = '';\r\n\r\n          let key: LangPackKey;\r\n          if(isBroadcast) {\r\n            key = (chat as Chat.channel).username ? 'TypePublic' : 'TypePrivate';\r\n          } else {\r\n            key = (chat as Chat.channel).username ? 'TypePublicGroup' : 'TypePrivateGroup';\r\n          }\r\n\r\n          chatTypeRow.subtitle.append(i18n(key));\r\n        };\r\n\r\n        setChatTypeSubtitle();\r\n        section.content.append(chatTypeRow.container);\r\n      }\r\n\r\n      if(canChangeType || canChangePermissions) {\r\n        const reactionsRow = new Row({\r\n          titleLangKey: 'Reactions',\r\n          icon: 'reactions',\r\n          clickable: () => {\r\n            const tab = this.slider.createTab(AppChatReactionsTab);\r\n            tab.chatId = this.chatId;\r\n            tab.open().then(() => {\r\n              if(this.tempId !== tempId) {\r\n                return;\r\n              }\r\n\r\n              this.listenerSetter.add(tab.eventListener)('destroy', setReactionsLength);\r\n            });\r\n          },\r\n          listenerSetter: this.listenerSetter\r\n        });\r\n\r\n        const availableReactions = await this.managers.appReactionsManager.getAvailableReactions();\r\n        const availableReactionsLength = availableReactions.filter((availableReaction) => !availableReaction.pFlags.inactive).length;\r\n        const setReactionsLength = () => {\r\n          const reactions = chatFull.available_reactions ?? [];\r\n          reactionsRow.subtitle.innerHTML = reactions.length + '/' + availableReactionsLength;\r\n        };\r\n\r\n        setReactionsLength();\r\n\r\n        section.content.append(reactionsRow.container);\r\n      }\r\n\r\n      if(canChangePermissions && !isBroadcast) {\r\n        const flags = [\r\n          'send_messages',\r\n          'send_media',\r\n          'send_stickers',\r\n          'send_polls',\r\n          'embed_links',\r\n          'invite_users',\r\n          'pin_messages',\r\n          'change_info'\r\n        ] as ChatRights[];\r\n\r\n        const permissionsRow = new Row({\r\n          titleLangKey: 'ChannelPermissions',\r\n          clickable: () => {\r\n            const tab = this.slider.createTab(AppGroupPermissionsTab);\r\n            tab.chatId = this.chatId;\r\n            tab.open();\r\n          },\r\n          icon: 'permissions',\r\n          listenerSetter: this.listenerSetter\r\n        });\r\n\r\n        const setPermissionsLength = async() => {\r\n          const chat = await this.managers.appChatsManager.getChatTyped(this.chatId);\r\n          permissionsRow.subtitle.innerHTML = flags.reduce((acc, f) => acc + +hasRights(chat, f, (chat as Chat.chat).default_banned_rights), 0) + '/' + flags.length;\r\n        };\r\n\r\n        setPermissionsLength();\r\n        section.content.append(permissionsRow.container);\r\n\r\n        this.listenerSetter.add(rootScope)('chat_update', (chatId) => {\r\n          if(this.chatId === chatId) {\r\n            setPermissionsLength();\r\n          }\r\n        });\r\n      }\r\n\r\n      /* const administratorsRow = new Row({\r\n        titleLangKey: 'PeerInfo.Administrators',\r\n        subtitle: '' + ((chatFull as ChatFull.channelFull).admins_count || 1),\r\n        icon: 'admin',\r\n        clickable: true\r\n      });\r\n\r\n      section.content.append(administratorsRow.container); */\r\n\r\n      this.scrollable.append(section.container);\r\n\r\n      attachClickEvent(this.editPeer.nextBtn, () => {\r\n        this.editPeer.nextBtn.disabled = true;\r\n\r\n        const promises: Promise<any>[] = [];\r\n\r\n        const id = this.chatId;\r\n        if(this.chatNameInputField.isValidToChange()) {\r\n          promises.push(this.managers.appChatsManager.editTitle(id, this.chatNameInputField.value));\r\n        }\r\n\r\n        if(this.descriptionInputField.isValidToChange()) {\r\n          promises.push(this.managers.appChatsManager.editAbout(id, this.descriptionInputField.value));\r\n        }\r\n\r\n        if(this.editPeer.uploadAvatar) {\r\n          promises.push(this.editPeer.uploadAvatar().then((inputFile) => {\r\n            return this.managers.appChatsManager.editPhoto(id, inputFile);\r\n          }));\r\n        }\r\n\r\n        Promise.race(promises).finally(() => {\r\n          this.editPeer.nextBtn.removeAttribute('disabled');\r\n          this.close();\r\n        });\r\n      }, {listenerSetter: this.listenerSetter});\r\n\r\n\r\n      /* if(appChatsManager.hasRights(-this.peerId, 'change_info')) {\r\n        const discussionRow = new Row({\r\n          titleLangKey: 'PeerInfo.Discussion',\r\n          subtitleLangKey: 'PeerInfo.Discussion.Add',\r\n          clickable: true,\r\n          icon: 'message'\r\n        });\r\n\r\n        section.content.append(discussionRow.container);\r\n      }\r\n\r\n      const administratorsRow = new Row({\r\n        titleLangKey: 'PeerInfo.Administrators',\r\n        subtitle: '' + chatFull.admins_count,\r\n        icon: 'admin',\r\n        clickable: true\r\n      });\r\n\r\n      section.content.append(administratorsRow.container); */\r\n\r\n      if(isBroadcast && await this.managers.appChatsManager.hasRights(this.chatId, 'change_info')) {\r\n        const signMessagesCheckboxField = new CheckboxField({\r\n          text: 'PeerInfo.SignMessages',\r\n          checked: !!(chat as Chat.channel).pFlags.signatures,\r\n          withRipple: true\r\n        });\r\n\r\n        this.listenerSetter.add(signMessagesCheckboxField.input)('change', () => {\r\n          const toggle = signMessagesCheckboxField.toggleDisability(true);\r\n          this.managers.appChatsManager.toggleSignatures(this.chatId, signMessagesCheckboxField.checked).then(() => {\r\n            toggle();\r\n          });\r\n        });\r\n\r\n        addChatUpdateListener(() => {\r\n          signMessagesCheckboxField.setValueSilently(!!(chat as Chat.channel).pFlags.signatures);\r\n        });\r\n\r\n        section.content.append(signMessagesCheckboxField.label);\r\n      }\r\n    }\r\n\r\n    if(!isBroadcast) {\r\n      const section = new SettingSection({\r\n\r\n      });\r\n\r\n      /* const membersRow = new Row({\r\n        titleLangKey: isBroadcast ? 'PeerInfo.Subscribers' : 'GroupMembers',\r\n        icon: 'newgroup',\r\n        clickable: true\r\n      });\r\n\r\n      membersRow.subtitle.append(i18n('Subscribers', [numberThousandSplitter(335356)]));\r\n\r\n      section.content.append(membersRow.container); */\r\n\r\n      if(!isBroadcast && canChangeType) {\r\n        const showChatHistoryCheckboxField = new CheckboxField({\r\n          text: 'ChatHistory',\r\n          withRipple: true\r\n        });\r\n\r\n        this.listenerSetter.add(showChatHistoryCheckboxField.input)('change', () => {\r\n          const toggle = showChatHistoryCheckboxField.toggleDisability(true);\r\n          this.managers.appChatsManager.togglePreHistoryHidden(this.chatId, !showChatHistoryCheckboxField.checked).then(() => {\r\n            toggle();\r\n          });\r\n        });\r\n\r\n        // ! it won't be updated because chatFull will be old\r\n        const onChatUpdate = () => {\r\n          showChatHistoryCheckboxField.setValueSilently(isChannel && !(chatFull as ChatFull.channelFull).pFlags.hidden_prehistory);\r\n        };\r\n\r\n        onChatUpdate();\r\n        addChatUpdateListener(onChatUpdate);\r\n\r\n        section.content.append(showChatHistoryCheckboxField.label);\r\n      }\r\n\r\n      if(section.content.childElementCount) {\r\n        this.scrollable.append(section.container);\r\n      }\r\n    }\r\n\r\n    if(await this.managers.appChatsManager.hasRights(this.chatId, 'delete_chat')) {\r\n      const section = new SettingSection({});\r\n\r\n      const btnDelete = Button('btn-primary btn-transparent danger', {icon: 'delete', text: isBroadcast ? 'PeerInfo.DeleteChannel' : 'DeleteAndExitButton'});\r\n\r\n      attachClickEvent(btnDelete, () => {\r\n        new PopupDeleteDialog(peerId/* , 'delete' */, undefined, (promise) => {\r\n          const toggle = toggleDisability([btnDelete], true);\r\n          promise.then(() => {\r\n            this.close();\r\n          }, () => {\r\n            toggle();\r\n          });\r\n        });\r\n      }, {listenerSetter: this.listenerSetter});\r\n\r\n      section.content.append(btnDelete);\r\n\r\n      this.scrollable.append(section.container);\r\n    }\r\n\r\n    if(!isChannel) {\r\n      // ! this one will fire earlier than tab's closeAfterTimeout (destroy) event and listeners will be erased, so destroy won't fire\r\n      this.listenerSetter.add(rootScope)('dialog_migrate', ({migrateFrom, migrateTo}) => {\r\n        if(peerId === migrateFrom) {\r\n          this.chatId = migrateTo.toChatId();\r\n          this._init();\r\n        }\r\n      });\r\n    }\r\n  }\r\n\r\n  protected init() {\r\n    return this._init();\r\n  }\r\n}\r\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport rootScope from '../../../lib/rootScope';\nimport AppSearchSuper, {SearchSuperType} from '../../appSearchSuper.';\nimport SidebarSlider, {SliderSuperTab} from '../../slider';\nimport {TransitionSlider} from '../../transition';\nimport AppEditChatTab from './editChat';\nimport PeerTitle from '../../peerTitle';\nimport AppEditContactTab from './editContact';\nimport Button from '../../button';\nimport ButtonIcon from '../../buttonIcon';\nimport {i18n, LangPackKey} from '../../../lib/langPack';\nimport {toastNew} from '../../toast';\nimport AppAddMembersTab from '../../sidebarLeft/tabs/addMembers';\nimport PopupPickUser from '../../popups/pickUser';\nimport PopupPeer, {PopupPeerButtonCallbackCheckboxes, PopupPeerCheckboxOptions} from '../../popups/peer';\nimport ButtonCorner from '../../buttonCorner';\nimport {attachClickEvent} from '../../../helpers/dom/clickEvent';\nimport PeerProfile from '../../peerProfile';\nimport {Message} from '../../../layer';\n\nconst historiesStorage: {\n  [peerId: PeerId]: Partial<{\n    [type in SearchSuperType]: {mid: number, peerId: PeerId}[]\n  }>\n} = {};\n\n// TODO:    \nexport default class AppSharedMediaTab extends SliderSuperTab {\n  private editBtn: HTMLElement;\n\n  private peerId: PeerId;\n  private threadId = 0;\n\n  private searchSuper: AppSearchSuper;\n\n  private profile: PeerProfile;\n  private peerChanged: boolean;\n\n  constructor(slider: SidebarSlider) {\n    super(slider, false);\n  }\n\n  public init() {\n    // const perf = performance.now();\n\n    this.container.classList.add('shared-media-container', 'profile-container');\n\n    // * header\n    const newCloseBtn = Button('btn-icon sidebar-close-button', {noRipple: true});\n    this.closeBtn.replaceWith(newCloseBtn);\n    this.closeBtn = newCloseBtn;\n\n    const animatedCloseIcon = document.createElement('div');\n    animatedCloseIcon.classList.add('animated-close-icon');\n    newCloseBtn.append(animatedCloseIcon);\n\n    const transitionContainer = document.createElement('div');\n    transitionContainer.className = 'transition slide-fade';\n\n    const transitionFirstItem = document.createElement('div');\n    transitionFirstItem.classList.add('transition-item');\n\n    this.title.append(i18n('Profile'));\n    this.editBtn = ButtonIcon('edit');\n    // const moreBtn = ButtonIcon('more');\n\n    transitionFirstItem.append(this.title, this.editBtn/* , moreBtn */);\n\n    const transitionLastItem = document.createElement('div');\n    transitionLastItem.classList.add('transition-item');\n\n    const secondTitle: HTMLElement = this.title.cloneNode() as any;\n    secondTitle.append(i18n('PeerInfo.SharedMedia'));\n\n    transitionLastItem.append(secondTitle);\n\n    transitionContainer.append(transitionFirstItem, transitionLastItem);\n\n    this.header.append(transitionContainer);\n\n    // * body\n\n    this.profile = new PeerProfile(this.managers, this.scrollable, this.listenerSetter);\n    this.profile.init();\n\n    this.scrollable.append(this.profile.element);\n\n    const HEADER_HEIGHT = 56;\n    this.scrollable.onAdditionalScroll = () => {\n      const rect = this.searchSuper.nav.getBoundingClientRect();\n      if(!rect.width) return;\n\n      const top = rect.top - 1;\n      setIsSharedMedia(top <= HEADER_HEIGHT);\n    };\n\n    const setIsSharedMedia = (isSharedMedia: boolean) => {\n      animatedCloseIcon.classList.toggle('state-back', isSharedMedia);\n      this.searchSuper.container.classList.toggle('is-full-viewport', isSharedMedia);\n      transition(+isSharedMedia);\n\n      if(!isSharedMedia) {\n        this.searchSuper.cleanScrollPositions();\n      }\n    };\n\n    const transition = TransitionSlider(transitionContainer, 'slide-fade', 400, null, false);\n\n    transition(0);\n\n    attachClickEvent(this.closeBtn, (e) => {\n      if(this.closeBtn.firstElementChild.classList.contains('state-back')) {\n        this.scrollable.scrollIntoViewNew({\n          element: this.scrollable.container.firstElementChild as HTMLElement,\n          position: 'start'\n        });\n        transition(0);\n        animatedCloseIcon.classList.remove('state-back');\n      } else if(!this.scrollable.isHeavyAnimationInProgress) {\n        this.slider.onCloseBtnClick();\n      }\n    }, {listenerSetter: this.listenerSetter});\n\n    attachClickEvent(this.editBtn, (e) => {\n      let tab: AppEditChatTab | AppEditContactTab;\n      if(this.peerId.isAnyChat()) {\n        tab = this.slider.createTab(AppEditChatTab);\n      } else {\n        tab = this.slider.createTab(AppEditContactTab);\n      }\n\n      if(tab) {\n        if(tab instanceof AppEditChatTab) {\n          tab.chatId = this.peerId.toChatId();\n        } else {\n          tab.peerId = this.peerId;\n        }\n\n        tab.open();\n      }\n    }, {listenerSetter: this.listenerSetter});\n\n    this.listenerSetter.add(rootScope)('contacts_update', (userId) => {\n      if(this.peerId === userId) {\n        this.toggleEditBtn();\n      }\n    });\n\n    this.listenerSetter.add(rootScope)('chat_update', (chatId) => {\n      if(this.peerId === chatId.toPeerId(true)) {\n        this.toggleEditBtn();\n      }\n    });\n\n    this.listenerSetter.add(rootScope)('history_multiappend', (message) => {\n      this.renderNewMessages(message);\n    });\n\n    this.listenerSetter.add(rootScope)('history_delete', ({peerId, msgs}) => {\n      this.deleteDeletedMessages(peerId, Array.from(msgs));\n    });\n\n    // Calls when message successfully sent and we have an id\n    this.listenerSetter.add(rootScope)('message_sent', ({message}) => {\n      this.renderNewMessages(message);\n    });\n\n    // this.container.prepend(this.closeBtn.parentElement);\n\n    this.searchSuper = new AppSearchSuper({\n      mediaTabs: [{\n        inputFilter: 'inputMessagesFilterEmpty',\n        name: 'PeerMedia.Members',\n        type: 'members'\n      }, {\n        inputFilter: 'inputMessagesFilterPhotoVideo',\n        name: 'SharedMediaTab2',\n        type: 'media'\n      }, {\n        inputFilter: 'inputMessagesFilterDocument',\n        name: 'SharedFilesTab2',\n        type: 'files'\n      }, {\n        inputFilter: 'inputMessagesFilterUrl',\n        name: 'SharedLinksTab2',\n        type: 'links'\n      }, {\n        inputFilter: 'inputMessagesFilterMusic',\n        name: 'SharedMusicTab2',\n        type: 'music'\n      }, {\n        inputFilter: 'inputMessagesFilterRoundVoice',\n        name: 'SharedVoiceTab2',\n        type: 'voice'\n      }],\n      scrollable: this.scrollable,\n      onChangeTab: (mediaTab) => {\n        const timeout = mediaTab.type === 'members' && rootScope.settings.animationsEnabled ? 250 : 0;\n        setTimeout(() => {\n          btnAddMembers.classList.toggle('is-hidden', mediaTab.type !== 'members');\n        }, timeout);\n      },\n      managers: this.managers\n    });\n\n    this.searchSuper.scrollStartCallback = () => {\n      setIsSharedMedia(true);\n    };\n\n    this.profile.element.append(this.searchSuper.container);\n\n    const btnAddMembers = ButtonCorner({icon: 'addmember_filled'});\n    this.content.append(btnAddMembers);\n\n    attachClickEvent(btnAddMembers, async() => {\n      const peerId = this.peerId;\n      const id = this.peerId.toChatId();\n      const isChannel = await this.managers.appChatsManager.isChannel(id);\n\n      const showConfirmation = (peerIds: PeerId[], callback: (checked: PopupPeerButtonCallbackCheckboxes) => void) => {\n        let titleLangKey: LangPackKey, titleLangArgs: any[],\n          descriptionLangKey: LangPackKey, descriptionLangArgs: any[],\n          checkboxes: PopupPeerCheckboxOptions[];\n\n        if(peerIds.length > 1) {\n          titleLangKey = 'AddMembersAlertTitle';\n          titleLangArgs = [i18n('Members', [peerIds.length])];\n          descriptionLangKey = 'AddMembersAlertCountText';\n          descriptionLangArgs = peerIds.map((peerId) => {\n            const b = document.createElement('b');\n            b.append(new PeerTitle({peerId}).element);\n            return b;\n          });\n\n          if(!isChannel) {\n            checkboxes = [{\n              text: 'AddMembersForwardMessages',\n              checked: true\n            }];\n          }\n        } else {\n          titleLangKey = 'AddOneMemberAlertTitle';\n          descriptionLangKey = 'AddMembersAlertNamesText';\n          const b = document.createElement('b');\n          b.append(new PeerTitle({\n            peerId: peerIds[0]\n          }).element);\n          descriptionLangArgs = [b];\n\n          if(!isChannel) {\n            checkboxes = [{\n              text: 'AddOneMemberForwardMessages',\n              textArgs: [new PeerTitle({peerId: peerIds[0]}).element],\n              checked: true\n            }];\n          }\n        }\n\n        descriptionLangArgs.push(new PeerTitle({\n          peerId\n        }).element);\n\n        new PopupPeer('popup-add-members', {\n          peerId,\n          titleLangKey,\n          descriptionLangKey,\n          descriptionLangArgs,\n          buttons: [{\n            langKey: 'Add',\n            callback\n          }],\n          checkboxes\n        }).show();\n      };\n\n      const onError = (err: any) => {\n        if(err.type === 'USER_PRIVACY_RESTRICTED') {\n          toastNew({langPackKey: 'InviteToGroupError'});\n        }\n      };\n\n      if(isChannel) {\n        const tab = this.slider.createTab(AppAddMembersTab);\n        tab.open({\n          type: 'channel',\n          skippable: false,\n          takeOut: (peerIds) => {\n            showConfirmation(peerIds, () => {\n              const promise = this.managers.appChatsManager.inviteToChannel(id, peerIds);\n              promise.catch(onError);\n              tab.attachToPromise(promise);\n            });\n\n            return false;\n          },\n          title: 'GroupAddMembers',\n          placeholder: 'SendMessageTo'\n        });\n      } else {\n        new PopupPickUser({\n          peerTypes: ['contacts'],\n          placeholder: 'Search',\n          onSelect: (peerId) => {\n            setTimeout(() => {\n              showConfirmation([peerId], (checked) => {\n                this.managers.appChatsManager.addChatUser(id, peerId, checked.size ? undefined : 0)\n                .catch(onError);\n              });\n            }, 0);\n          }\n        });\n      }\n    }, {listenerSetter: this.listenerSetter});\n\n    // console.log('construct shared media time:', performance.now() - perf);\n  }\n\n  public async renderNewMessages(message: Message.message | Message.messageService) {\n    if(this.init) return; // * not inited yet\n\n    const {peerId} = message;\n    if(!historiesStorage[peerId]) return;\n\n    for(const mediaTab of this.searchSuper.mediaTabs) {\n      const inputFilter = mediaTab.inputFilter;\n      const history = historiesStorage[peerId][inputFilter];\n      if(!history) {\n        continue;\n      }\n\n      const filtered = this.searchSuper.filterMessagesByType([message], inputFilter).filter((message) => !history.find((m) => m.mid === message.mid && m.peerId === message.peerId));\n      if(filtered.length) {\n        history.unshift(...filtered.map((message) => ({mid: message.mid, peerId: message.peerId})));\n\n        if(this.peerId === peerId && this.searchSuper.usedFromHistory[inputFilter] !== -1) {\n          this.searchSuper.usedFromHistory[inputFilter] += filtered.length;\n          this.searchSuper.performSearchResult(filtered, mediaTab, false);\n        }\n      }\n    }\n  }\n\n  public deleteDeletedMessages(peerId: PeerId, mids: number[]) {\n    if(this.init) return; // * not inited yet\n\n    if(!historiesStorage[peerId]) return;\n\n    for(const mid of mids) {\n      for(const type of this.searchSuper.mediaTabs) {\n        const inputFilter = type.inputFilter;\n\n        const history = historiesStorage[peerId][inputFilter];\n        if(!history) continue;\n\n        const idx = history.findIndex((m) => m.mid === mid);\n        if(idx === -1) {\n          continue;\n        }\n\n        history.splice(idx, 1);\n\n        if(this.peerId === peerId) {\n          const container = this.searchSuper.tabs[inputFilter];\n          const div = container.querySelector(`[data-mid=\"${mid}\"][data-peer-id=\"${peerId}\"]`) as HTMLElement;\n          if(div) {\n            if(this.searchSuper.selection.isSelecting) {\n              this.searchSuper.selection.toggleByElement(div);\n            }\n\n            div.remove();\n          }\n\n          if(this.searchSuper.usedFromHistory[inputFilter] >= (idx + 1)) {\n            --this.searchSuper.usedFromHistory[inputFilter];\n          }\n        }\n\n        // can have element in different tabs somehow\n        // break;\n      }\n    }\n\n    this.scrollable.onScroll();\n  }\n\n  public async cleanupHTML() {\n    // const perf = performance.now();\n    this.profile.cleanupHTML();\n    this.editBtn.classList.add('hide');\n    this.searchSuper.cleanupHTML(true);\n    this.container.classList.toggle('can-add-members', await this.searchSuper.canViewMembers() && await this.managers.appChatsManager.hasRights(this.peerId.toChatId(), 'invite_users'));\n    // console.log('cleanupHTML shared media time:', performance.now() - perf);\n  }\n\n  public setLoadMutex(promise: Promise<any>) {\n    this.searchSuper.loadMutex = promise;\n  }\n\n  public setPeer(peerId: PeerId, threadId = 0) {\n    if(this.peerId === peerId && this.threadId === threadId) return false;\n\n    this.peerId = peerId;\n    this.threadId = threadId;\n    this.peerChanged = true;\n\n    if(this.init) {\n      this.init();\n      this.init = null;\n    }\n\n    this.searchSuper.setQuery({\n      peerId,\n      // threadId,\n      historyStorage: historiesStorage[peerId] ??= {}\n    });\n\n    this.profile.setPeer(peerId, threadId);\n\n    return true;\n  }\n\n  public async fillProfileElements() {\n    if(!this.peerChanged) {\n      return;\n    }\n\n    this.peerChanged = false;\n    await this.cleanupHTML();\n    await this.toggleEditBtn();\n    await this.profile.fillProfileElements();\n  }\n\n  private async toggleEditBtn() {\n    let show: boolean;\n    if(this.peerId.isUser()) {\n      show = this.peerId !== rootScope.myId && await this.managers.appUsersManager.isContact(this.peerId.toUserId());\n    } else {\n      show = await this.managers.appChatsManager.hasRights(this.peerId.toChatId(), 'change_info');\n    }\n\n    this.editBtn.classList.toggle('hide', !show);\n  }\n\n  public loadSidebarMedia(single: boolean, justLoad?: boolean) {\n    this.searchSuper.load(single, justLoad);\n  }\n\n  onOpenAfterTimeout() {\n    this.scrollable.onScroll();\n  }\n\n  public destroy() {\n    this.destroyable = true;\n    this.onCloseAfterTimeout();\n    this.profile.destroy();\n    this.searchSuper.destroy();\n  }\n}\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport rootScope from '../lib/rootScope';\r\n\r\nconst SetTransition = (\r\n  element: HTMLElement,\r\n  className: string,\r\n  forwards: boolean,\r\n  duration: number,\r\n  onTransitionEnd?: () => void,\r\n  useRafs?: number,\r\n  onTransitionStart?: () => void\r\n) => {\r\n  const {timeout, raf} = element.dataset;\r\n  if(timeout !== undefined) {\r\n    clearTimeout(+timeout);\r\n  }\r\n\r\n  // useRafs = undefined;\r\n  // duration = 0;\r\n\r\n  if(raf !== undefined) {\r\n    window.cancelAnimationFrame(+raf);\r\n    if(!useRafs) {\r\n      delete element.dataset.raf;\r\n    }\r\n  }\r\n\r\n  // if(forwards && className && element.classList.contains(className) && !element.classList.contains('animating')) {\r\n  //   return;\r\n  // }\r\n\r\n  if(useRafs && rootScope.settings.animationsEnabled && duration) {\r\n    element.dataset.raf = '' + window.requestAnimationFrame(() => {\r\n      delete element.dataset.raf;\r\n      SetTransition(element, className, forwards, duration, onTransitionEnd, useRafs - 1, onTransitionStart);\r\n    });\r\n\r\n    return;\r\n  }\r\n\r\n  if(forwards && className) {\r\n    element.classList.add(className);\r\n  }\r\n\r\n  const afterTimeout = () => {\r\n    delete element.dataset.timeout;\r\n    if(!forwards && className) {\r\n      element.classList.remove('backwards', className);\r\n    }\r\n\r\n    element.classList.remove('animating');\r\n\r\n    onTransitionEnd?.();\r\n  };\r\n\r\n  onTransitionStart?.();\r\n  if(!rootScope.settings.animationsEnabled || !duration) {\r\n    element.classList.remove('animating', 'backwards');\r\n    afterTimeout();\r\n    return;\r\n  }\r\n\r\n  element.classList.add('animating');\r\n\r\n  element.classList.toggle('backwards', !forwards);\r\n  element.dataset.timeout = '' + setTimeout(afterTimeout, duration);\r\n};\r\n\r\nexport default SetTransition;\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport {horizontalMenu} from './horizontalMenu';\r\nimport {TransitionSlider} from './transition';\r\nimport appNavigationController, {NavigationItem} from './appNavigationController';\r\nimport SliderSuperTab, {SliderSuperTabConstructable, SliderTab} from './sliderTab';\r\nimport {attachClickEvent} from '../helpers/dom/clickEvent';\r\nimport indexOfAndSplice from '../helpers/array/indexOfAndSplice';\r\nimport safeAssign from '../helpers/object/safeAssign';\r\nimport {AppManagers} from '../lib/appManagers/managers';\r\n\r\nconst TRANSITION_TIME = 250;\r\n\r\nexport type {SliderTab};\r\nexport {SliderSuperTab};\r\n\r\nexport default class SidebarSlider {\r\n  protected _selectTab: ReturnType<typeof horizontalMenu>;\r\n  public historyTabIds: (number | SliderSuperTab)[] = []; // * key is any, since right sidebar is ugly nowz\r\n  public tabsContainer: HTMLElement;\r\n  public sidebarEl: HTMLElement;\r\n  public tabs: Map<any, SliderTab>; // * key is any, since right sidebar is ugly now\r\n  private canHideFirst = false;\r\n  private navigationType: NavigationItem['type'];\r\n  protected managers: AppManagers;\r\n\r\n  constructor(options: {\r\n    sidebarEl: SidebarSlider['sidebarEl'],\r\n    tabs?: SidebarSlider['tabs'],\r\n    canHideFirst?: SidebarSlider['canHideFirst'],\r\n    navigationType: SidebarSlider['navigationType']\r\n  }) {\r\n    safeAssign(this, options);\r\n\r\n    if(!this.tabs) {\r\n      this.tabs = new Map();\r\n    }\r\n\r\n    this.tabsContainer = this.sidebarEl.querySelector('.sidebar-slider');\r\n    this._selectTab = TransitionSlider(this.tabsContainer, 'navigation', TRANSITION_TIME);\r\n    if(!this.canHideFirst) {\r\n      this._selectTab(0);\r\n    }\r\n\r\n    Array.from(this.sidebarEl.querySelectorAll('.sidebar-close-button') as any as HTMLElement[]).forEach((el) => {\r\n      attachClickEvent(el, this.onCloseBtnClick);\r\n    });\r\n  }\r\n\r\n  public onCloseBtnClick = () => {\r\n    const item = appNavigationController.findItemByType(this.navigationType);\r\n    if(item) {\r\n      appNavigationController.back(this.navigationType);\r\n    } else if(this.historyTabIds.length) {\r\n      this.closeTab(this.historyTabIds[this.historyTabIds.length - 1]);\r\n    }\r\n    // this.closeTab();\r\n  };\r\n\r\n  public closeTab = (id?: number | SliderSuperTab, animate?: boolean, isNavigation?: boolean) => {\r\n    if(id !== undefined && this.historyTabIds[this.historyTabIds.length - 1] !== id) {\r\n      return false;\r\n    }\r\n\r\n    // console.log('sidebar-close-button click:', this.historyTabIDs);\r\n    const closingId = this.historyTabIds.pop(); // pop current\r\n    this.onCloseTab(closingId, animate, isNavigation);\r\n\r\n    const tab = this.historyTabIds[this.historyTabIds.length - 1];\r\n    this._selectTab(tab !== undefined ? (tab instanceof SliderSuperTab ? tab.container : tab) : (this.canHideFirst ? -1 : 0), animate);\r\n    return true;\r\n  };\r\n\r\n  public selectTab(id: number | SliderSuperTab): boolean {\r\n    /* if(id instanceof SliderSuperTab) {\r\n      id = id.id;\r\n    } */\r\n\r\n    if(this.historyTabIds[this.historyTabIds.length - 1] === id) {\r\n      return false;\r\n    }\r\n\r\n    const tab: SliderTab = id instanceof SliderSuperTab ? id : this.tabs.get(id);\r\n    if(tab) {\r\n      if(tab.onOpen) {\r\n        tab.onOpen();\r\n      }\r\n\r\n      if(tab.onOpenAfterTimeout) {\r\n        setTimeout(() => {\r\n          tab.onOpenAfterTimeout();\r\n        }, TRANSITION_TIME);\r\n      }\r\n    }\r\n\r\n    // if(!this.canHideFirst || this.historyTabIds.length) {\r\n    appNavigationController.pushItem({\r\n      type: this.navigationType,\r\n      onPop: (canAnimate) => {\r\n        this.closeTab(undefined, canAnimate, true);\r\n        return true;\r\n      }\r\n    });\r\n    // }\r\n\r\n    this.historyTabIds.push(id);\r\n    this._selectTab(id instanceof SliderSuperTab ? id.container : id);\r\n    return true;\r\n  }\r\n\r\n  public removeTabFromHistory(id: number | SliderSuperTab) {\r\n    indexOfAndSplice(this.historyTabIds, id);\r\n    this.onCloseTab(id, undefined);\r\n  }\r\n\r\n  public sliceTabsUntilTab(tabConstructor: SliderSuperTabConstructable, preserveTab: SliderSuperTab) {\r\n    for(let i = this.historyTabIds.length - 1; i >= 0; --i) {\r\n      const tab = this.historyTabIds[i];\r\n      if(tab === preserveTab) continue;\r\n      else if(tab instanceof tabConstructor) {\r\n        break;\r\n      }\r\n\r\n      this.removeTabFromHistory(tab);\r\n      // appNavigationController.removeByType(this.navigationType, true);\r\n    }\r\n  }\r\n\r\n  public getTab<T extends SliderSuperTab>(tabConstructor: SliderSuperTabConstructable<T>) {\r\n    return this.historyTabIds.find((t) => t instanceof tabConstructor) as T;\r\n  }\r\n\r\n  public isTabExists(tabConstructor: SliderSuperTabConstructable) {\r\n    return !!this.getTab(tabConstructor);\r\n  }\r\n\r\n  protected onCloseTab(id: number | SliderSuperTab, animate: boolean, isNavigation?: boolean) {\r\n    if(!isNavigation) {\r\n      appNavigationController.removeByType(this.navigationType, true);\r\n    }\r\n\r\n    const tab: SliderTab = id instanceof SliderSuperTab ? id : this.tabs.get(id);\r\n    if(tab) {\r\n      if(tab.onClose) {\r\n        tab.onClose();\r\n      }\r\n\r\n      if(tab.onCloseAfterTimeout) {\r\n        setTimeout(() => {\r\n          tab.onCloseAfterTimeout();\r\n        }, TRANSITION_TIME + 30);\r\n      }\r\n    }\r\n  }\r\n\r\n  public addTab(tab: SliderSuperTab) {\r\n    if(!tab.container.parentElement) {\r\n      this.tabsContainer.append(tab.container);\r\n\r\n      if(tab.closeBtn) {\r\n        tab.closeBtn.addEventListener('click', this.onCloseBtnClick);\r\n      }\r\n    }\r\n  }\r\n\r\n  public createTab<T extends SliderSuperTab>(ctor: SliderSuperTabConstructable<T>, doNotAppend?: boolean) {\r\n    const tab = new ctor(doNotAppend ? undefined : this, true);\r\n    tab.managers = this.managers;\r\n    return tab;\r\n  }\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport EventListenerBase from '../helpers/eventListenerBase';\r\nimport ListenerSetter from '../helpers/listenerSetter';\r\nimport {AppManagers} from '../lib/appManagers/managers';\r\nimport {i18n, LangPackKey} from '../lib/langPack';\r\nimport ButtonIcon from './buttonIcon';\r\nimport Scrollable from './scrollable';\r\nimport SidebarSlider from './slider';\r\n\r\nexport interface SliderTab {\r\n  onOpen?: () => void,\r\n  onOpenAfterTimeout?: () => void,\r\n  onClose?: () => void,\r\n  onCloseAfterTimeout?: () => void\r\n}\r\n\r\nexport interface SliderSuperTabConstructable<T extends SliderSuperTab = any> {\r\n  new(slider: SidebarSlider, destroyable: boolean): T;\r\n}\r\n\r\nexport interface SliderSuperTabEventableConstructable {\r\n  new(slider: SidebarSlider, destroyable: boolean): SliderSuperTabEventable;\r\n}\r\n\r\nexport default class SliderSuperTab implements SliderTab {\r\n  public container: HTMLElement;\r\n\r\n  public header: HTMLElement;\r\n  public closeBtn: HTMLElement;\r\n  public title: HTMLElement;\r\n\r\n  public content: HTMLElement;\r\n  public scrollable: Scrollable;\r\n\r\n  public slider: SidebarSlider;\r\n  public destroyable: boolean;\r\n  public listenerSetter: ListenerSetter;\r\n\r\n  public managers: AppManagers;\r\n\r\n  constructor(slider: SidebarSlider, destroyable?: boolean) {\r\n    this._constructor(slider, destroyable);\r\n  }\r\n\r\n  public _constructor(slider: SidebarSlider, destroyable = true): any {\r\n    this.slider = slider;\r\n    this.destroyable = destroyable;\r\n\r\n    this.container = document.createElement('div');\r\n    this.container.classList.add('tabs-tab', 'sidebar-slider-item');\r\n\r\n    // * Header\r\n    this.header = document.createElement('div');\r\n    this.header.classList.add('sidebar-header');\r\n\r\n    this.closeBtn = ButtonIcon('left sidebar-close-button', {noRipple: true});\r\n    this.title = document.createElement('div');\r\n    this.title.classList.add('sidebar-header__title');\r\n    this.header.append(this.closeBtn, this.title);\r\n\r\n    // * Content\r\n    this.content = document.createElement('div');\r\n    this.content.classList.add('sidebar-content');\r\n\r\n    this.scrollable = new Scrollable(this.content, undefined, undefined, true);\r\n\r\n    this.container.append(this.header, this.content);\r\n\r\n    if(this.slider) {\r\n      this.slider.addTab(this);\r\n    }\r\n\r\n    this.listenerSetter = new ListenerSetter();\r\n  }\r\n\r\n  public close() {\r\n    return this.slider.closeTab(this);\r\n  }\r\n\r\n  public async open(...args: any[]) {\r\n    if(this.init) {\r\n      try {\r\n        const result = this.init();\r\n        this.init = null;\r\n\r\n        if(result instanceof Promise) {\r\n          await result;\r\n        }\r\n      } catch(err) {\r\n        console.error('open tab error', err);\r\n      }\r\n    }\r\n\r\n    this.slider.selectTab(this);\r\n  }\r\n\r\n  protected init(): Promise<any> | any {\r\n\r\n  }\r\n\r\n  public onCloseAfterTimeout() {\r\n    if(this.destroyable) { // ! WARNING,            !\r\n      this.slider.tabs.delete(this);\r\n      this.container.remove();\r\n      this.scrollable.destroy();\r\n      this.listenerSetter?.removeAll();\r\n    }\r\n  }\r\n\r\n  protected setTitle(key: LangPackKey) {\r\n    this.title.innerHTML = '';\r\n    this.title.append(i18n(key));\r\n  }\r\n}\r\n\r\nexport class SliderSuperTabEventable extends SliderSuperTab {\r\n  public eventListener: EventListenerBase<{\r\n    destroy: () => void\r\n  }>;\r\n\r\n  constructor(slider: SidebarSlider) {\r\n    super(slider);\r\n    this.eventListener = new EventListenerBase();\r\n  }\r\n\r\n  onCloseAfterTimeout() {\r\n    this.eventListener.dispatchEvent('destroy');\r\n    this.eventListener.cleanup();\r\n    return super.onCloseAfterTimeout();\r\n  }\r\n}\r\n\r\n/* // @ts-ignore\r\ninterface SliderSuperEventsTab extends SliderSuperTab, EventListenerBase<{}> {\r\n  superConstructor: (...args: any[]) => any;\r\n}\r\nclass SliderSuperEventsTab implements SliderSuperEventsTab {\r\n  constructor(slider: SidebarSlider) {\r\n    this.superConstructor([slider, true]);\r\n  }\r\n}\r\napplyMixins(SliderSuperEventsTab, [SliderSuperTab, EventListenerBase]);\r\n\r\n(window as any).lol = SliderSuperEventsTab\r\n\r\nexport {SliderSuperEventsTab}; */\r\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport appDialogsManager, {AppDialogsManager, DialogDom} from '../lib/appManagers/appDialogsManager';\nimport {getHeavyAnimationPromise} from '../hooks/useHeavyAnimationCheck';\nimport isInDOM from '../helpers/dom/isInDOM';\nimport positionElementByIndex from '../helpers/dom/positionElementByIndex';\nimport replaceContent from '../helpers/dom/replaceContent';\nimport {fastRaf} from '../helpers/schedulers';\nimport SortedList, {SortedElementBase} from '../helpers/sortedList';\nimport safeAssign from '../helpers/object/safeAssign';\nimport {AppManagers} from '../lib/appManagers/managers';\nimport getUserStatusString from './wrappers/getUserStatusString';\nimport type LazyLoadQueue from './lazyLoadQueue';\n\ninterface SortedUser extends SortedElementBase {\n  dom: DialogDom\n}\n\nexport default class SortedUserList extends SortedList<SortedUser> {\n  protected static SORT_INTERVAL = 30e3;\n  public list: HTMLUListElement;\n\n  protected lazyLoadQueue: LazyLoadQueue;\n  protected avatarSize = 48;\n  protected rippleEnabled = true;\n  protected autonomous = true;\n  protected createChatListOptions: Parameters<AppDialogsManager['createChatList']>[0];\n  protected onListLengthChange: () => void;\n  protected getIndex: (element: SortedUser) => number;\n  protected onUpdate: (element: SortedUser) => void;\n  protected managers: AppManagers;\n\n  constructor(options: Partial<{\n    lazyLoadQueue: SortedUserList['lazyLoadQueue'],\n    avatarSize: SortedUserList['avatarSize'],\n    rippleEnabled: SortedUserList['rippleEnabled'],\n    createChatListOptions: SortedUserList['createChatListOptions'],\n    autonomous: SortedUserList['autonomous'],\n    onListLengthChange: SortedUserList['onListLengthChange'],\n    getIndex: SortedUserList['getIndex'],\n    onUpdate: SortedUserList['onUpdate']\n  }> & {\n    managers: SortedUserList['managers']\n  }) {\n    super({\n      getIndex: options.getIndex || ((element) => this.managers.appUsersManager.getUserStatusForSort(element.id)),\n      onDelete: (element) => {\n        element.dom.listEl.remove();\n        this.onListLengthChange && this.onListLengthChange();\n      },\n      onUpdate: options.onUpdate || (async(element) => {\n        const status = getUserStatusString(await this.managers.appUsersManager.getUser(element.id));\n        replaceContent(element.dom.lastMessageSpan, status);\n      }),\n      onSort: (element, idx) => {\n        const willChangeLength = element.dom.listEl.parentElement !== this.list;\n        positionElementByIndex(element.dom.listEl, this.list, idx);\n\n        if(willChangeLength && this.onListLengthChange) {\n          this.onListLengthChange();\n        }\n      },\n      onElementCreate: (base) => {\n        const {dom} = appDialogsManager.addDialogNew({\n          peerId: base.id,\n          container: false,\n          avatarSize: this.avatarSize,\n          autonomous: this.autonomous,\n          meAsSaved: false,\n          rippleEnabled: this.rippleEnabled,\n          lazyLoadQueue: this.lazyLoadQueue\n        });\n\n        (base as SortedUser).dom = dom;\n        return base as SortedUser;\n      },\n      updateElementWith: fastRaf,\n      updateListWith: async(callback) => {\n        if(!isInDOM(this.list)) {\n          return callback(false);\n        }\n\n        await getHeavyAnimationPromise();\n\n        if(!isInDOM(this.list)) {\n          return callback(false);\n        }\n\n        callback(true);\n      }\n    });\n\n    safeAssign(this, options);\n\n    this.list = appDialogsManager.createChatList(this.createChatListOptions);\n\n    let timeout: number;\n    const doTimeout = () => {\n      timeout = window.setTimeout(() => {\n        this.updateList((good) => {\n          if(good) {\n            doTimeout();\n          }\n        });\n      }, SortedUserList.SORT_INTERVAL);\n    };\n\n    doTimeout();\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport AvatarElement from './avatar';\nimport type LazyLoadQueue from './lazyLoadQueue';\n\nconst CLASS_NAME = 'stacked-avatars';\nconst AVATAR_CLASS_NAME = CLASS_NAME + '-avatar';\nconst AVATAR_CONTAINER_CLASS_NAME = AVATAR_CLASS_NAME + '-container';\n\nexport default class StackedAvatars {\n  public container: HTMLElement;\n  private lazyLoadQueue: LazyLoadQueue;\n  private avatarSize: number;\n\n  constructor(options: {\n    lazyLoadQueue?: StackedAvatars['lazyLoadQueue'],\n    avatarSize: StackedAvatars['avatarSize']\n  }) {\n    this.lazyLoadQueue = options.lazyLoadQueue;\n    this.avatarSize = options.avatarSize;\n\n    this.container = document.createElement('div');\n    this.container.classList.add(CLASS_NAME);\n\n    this.container.style.setProperty('--avatar-size', options.avatarSize + 'px');\n  }\n  /**\n   * MACOS, ANDROID -  \n   * WINDOWS DESKTOP - \n   *       ,       , !\n   */\n  public render(peerIds: PeerId[], loadPromises?: Promise<any>[]) {\n    const children = this.container.children;\n    peerIds = peerIds.slice().reverse();\n    if(peerIds.length > 3) {\n      peerIds = peerIds.slice(-3);\n    }\n\n    peerIds.forEach((peerId, idx) => {\n      let avatarContainer = children[idx] as HTMLElement;\n      if(!avatarContainer) {\n        avatarContainer = document.createElement('div');\n        avatarContainer.classList.add(AVATAR_CONTAINER_CLASS_NAME);\n      }\n\n      let avatarElem = avatarContainer.firstElementChild as AvatarElement;\n      if(!avatarElem) {\n        avatarElem = new AvatarElement();\n        avatarElem.classList.add('avatar-' + this.avatarSize, AVATAR_CLASS_NAME);\n        avatarElem.updateOptions({\n          isDialog: false,\n          loadPromises\n        });\n      }\n\n      avatarElem.updateWithOptions({\n        lazyLoadQueue: this.lazyLoadQueue,\n        peerId: peerId\n      });\n\n      if(!avatarElem.parentNode) {\n        avatarContainer.append(avatarElem);\n      }\n\n      if(!avatarContainer.parentNode) {\n        this.container.append(avatarContainer);\n      }\n    });\n\n    // if were 3 and became 2\n    (Array.from(children) as HTMLElement[]).slice(peerIds.length).forEach((el) => el.remove());\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport IS_TOUCH_SUPPORTED from '../environment/touchSupport';\nimport cancelEvent from '../helpers/dom/cancelEvent';\nimport {simulateClickEvent, attachClickEvent} from '../helpers/dom/clickEvent';\nimport findUpAsChild from '../helpers/dom/findUpAsChild';\nimport findUpClassName from '../helpers/dom/findUpClassName';\nimport getVisibleRect from '../helpers/dom/getVisibleRect';\nimport ListenerSetter from '../helpers/listenerSetter';\nimport {makeMediaSize} from '../helpers/mediaSize';\nimport {getMiddleware, Middleware} from '../helpers/middleware';\nimport {doubleRaf} from '../helpers/schedulers';\nimport pause from '../helpers/schedulers/pause';\nimport windowSize from '../helpers/windowSize';\nimport {MyDocument} from '../lib/appManagers/appDocsManager';\nimport getStickerEffectThumb from '../lib/appManagers/utils/stickers/getStickerEffectThumb';\nimport wrapEmojiText from '../lib/richTextProcessor/wrapEmojiText';\nimport lottieLoader from '../lib/rlottie/lottieLoader';\nimport RLottiePlayer from '../lib/rlottie/rlottiePlayer';\nimport rootScope from '../lib/rootScope';\nimport animationIntersector, {AnimationItemGroup} from './animationIntersector';\nimport SetTransition from './singleTransition';\nimport {wrapSticker} from './wrappers';\nimport {STICKER_EFFECT_MULTIPLIER} from './wrappers/sticker';\n\nlet hasViewer = false;\nexport default function attachStickerViewerListeners({listenTo, listenerSetter, selector}: {\n  listenerSetter: ListenerSetter,\n  listenTo: HTMLElement,\n  selector?: string\n}) {\n  if(IS_TOUCH_SUPPORTED) {\n    return;\n  }\n\n  const findTarget = (e: MouseEvent, checkForParent?: boolean) => {\n    const s = selector || `.media-sticker-wrapper`;\n    const el = (e.target as HTMLElement).closest(s) as HTMLElement;\n    return el && (!checkForParent || findUpAsChild(el, listenTo)) ? el : undefined;\n  };\n\n  const managers = rootScope.managers;\n\n  listenerSetter.add(listenTo)('mousedown', (e) => {\n    if(hasViewer || e.buttons > 1 || e.button !== 0) return;\n    let mediaContainer = findTarget(e);\n    if(!mediaContainer) {\n      return;\n    }\n\n    // const img: HTMLImageElement = mediaContainer.querySelector('img.media-sticker');\n\n    const docId = mediaContainer.dataset.docId;\n    if(!docId) {\n      return;\n    }\n\n    const className = 'sticker-viewer';\n    const group: AnimationItemGroup = 'STICKER-VIEWER';\n    const openDuration = 200;\n    const switchDuration = 200;\n    const previousGroup = animationIntersector.getOnlyOnePlayableGroup();\n    const _middleware = getMiddleware();\n    let container: HTMLElement, previousTransformer: HTMLElement;\n\n    const doThatSticker = async({mediaContainer, doc, middleware, lockGroups, isSwitching}: {\n      mediaContainer: HTMLElement,\n      doc: MyDocument,\n      middleware: Middleware,\n      lockGroups?: boolean,\n      isSwitching?: boolean\n    }) => {\n      const effectThumb = getStickerEffectThumb(doc);\n      const mediaRect: DOMRect = mediaContainer.getBoundingClientRect();\n      const s = makeMediaSize(doc.w, doc.h);\n      const size = effectThumb ? 280 : 360;\n      const boxSize = makeMediaSize(size, size);\n      const fitted = mediaRect.width === mediaRect.height ? boxSize : s.aspectFitted(boxSize);\n\n      const bubble = findUpClassName(mediaContainer, 'bubble');\n      const isOut = bubble ? bubble.classList.contains('is-out') : true;\n\n      const transformer = document.createElement('div');\n      transformer.classList.add(className + '-transformer');\n\n      const stickerContainer = document.createElement('div');\n      stickerContainer.classList.add(className + '-sticker');\n      /* transformer.style.width =  */stickerContainer.style.width = fitted.width + 'px';\n      /* transformer.style.height =  */stickerContainer.style.height = fitted.height + 'px';\n\n      const stickerEmoji = document.createElement('div');\n      stickerEmoji.classList.add(className + '-emoji');\n      stickerEmoji.append(wrapEmojiText(doc.stickerEmojiRaw));\n\n      if(effectThumb) {\n        const margin = (size * STICKER_EFFECT_MULTIPLIER - size) / 3 * (isOut ? 1 : -1);\n        transformer.classList.add('has-effect');\n        // const property = `--margin-${isOut ? 'right' : 'left'}`;\n        // stickerContainer.style.setProperty(property, `${margin * 2}px`);\n        transformer.style.setProperty('--translateX', `${margin}px`);\n        stickerEmoji.style.setProperty('--translateX', `${-margin}px`);\n      }\n\n      const overflowElement = findUpClassName(mediaContainer, 'scrollable');\n      const visibleRect = getVisibleRect(mediaContainer, overflowElement, true, mediaRect);\n      if(visibleRect.overflow.vertical || visibleRect.overflow.horizontal) {\n        stickerContainer.classList.add('is-overflow');\n      }\n\n      // if(img) {\n      //   const ratio = img.naturalWidth / img.naturalHeight;\n      //   if((mediaRect.width / mediaRect.height).toFixed(1) !== ratio.toFixed(1)) {\n\n      //     mediaRect = mediaRect.toJSON();\n      //   }\n      // }\n\n      const rect = mediaContainer.getBoundingClientRect();\n      const scaleX = rect.width / fitted.width;\n      const scaleY = rect.height / fitted.height;\n      const transformX = rect.left - (windowSize.width - rect.width) / 2;\n      const transformY = rect.top - (windowSize.height - rect.height) / 2;\n      transformer.style.transform = `translate(${transformX}px, ${transformY}px) scale(${scaleX}, ${scaleY})`;\n      if(isSwitching) transformer.classList.add('is-switching');\n      transformer.append(stickerContainer, stickerEmoji);\n      container.append(transformer);\n\n      const o = await wrapSticker({\n        doc,\n        div: stickerContainer,\n        group,\n        width: fitted.width,\n        height: fitted.height,\n        play: false,\n        loop: true,\n        middleware,\n        managers,\n        needFadeIn: false,\n        isOut,\n        withThumb: false,\n        relativeEffect: true,\n        loopEffect: true\n      }).then(({render}) => render);\n      if(!middleware()) return;\n\n      if(!container.parentElement) {\n        document.body.append(container);\n      }\n\n      const player = Array.isArray(o) ? o[0] : o;\n\n      const firstFramePromise = player instanceof RLottiePlayer ?\n        new Promise<void>((resolve) => player.addEventListener('firstFrame', resolve, {once: true})) :\n        Promise.resolve();\n      await Promise.all([firstFramePromise, doubleRaf()]);\n      await pause(0); // ! need it because firstFrame will be called just from the loop\n      if(!middleware()) return;\n\n      if(lockGroups) {\n        animationIntersector.setOnlyOnePlayableGroup(group);\n        animationIntersector.checkAnimations(true);\n      }\n\n      if(player instanceof RLottiePlayer) {\n        const prevPlayer = lottieLoader.getAnimation(mediaContainer);\n        player.curFrame = prevPlayer.curFrame;\n        player.play();\n        await new Promise<void>((resolve) => {\n          let i = 0;\n          const c = () => {\n            if(++i === 2) {\n              resolve();\n              player.removeEventListener('enterFrame', c);\n            }\n          };\n\n          player.addEventListener('enterFrame', c);\n        });\n        player.pause();\n      } else if(player instanceof HTMLVideoElement) {\n        player.currentTime = (mediaContainer.querySelector('video') as HTMLVideoElement).currentTime;\n      }\n\n      return {\n        ready: () => {\n          if(player instanceof RLottiePlayer || player instanceof HTMLVideoElement) {\n            player.play();\n          }\n\n          if(effectThumb) {\n            simulateClickEvent(stickerContainer);\n          }\n        },\n        transformer\n      };\n    };\n\n    const timeout = window.setTimeout(async() => {\n      document.removeEventListener('mousemove', onMousePreMove);\n\n      container = document.createElement('div');\n      container.classList.add(className);\n      hasViewer = true;\n\n      const middleware = _middleware.get();\n      const doc = await managers.appDocsManager.getDoc(docId);\n      if(!middleware()) return;\n\n      let result: Awaited<ReturnType<typeof doThatSticker>>;\n      try {\n        result = await doThatSticker({\n          doc,\n          mediaContainer,\n          middleware,\n          lockGroups: true\n        });\n        if(!result) return;\n      } catch(err) {\n        return;\n      }\n\n      const {ready, transformer} = result;\n\n      previousTransformer = transformer;\n\n      SetTransition(container, 'is-visible', true, openDuration, () => {\n        if(!middleware()) return;\n        ready();\n      });\n\n      document.addEventListener('mousemove', onMouseMove);\n    }, 125);\n\n    const onMouseMove = async(e: MouseEvent) => {\n      const newMediaContainer = findTarget(e, true);\n      if(!newMediaContainer || mediaContainer === newMediaContainer) {\n        return;\n      }\n\n      const docId = newMediaContainer.dataset.docId;\n      if(!docId) {\n        return;\n      }\n\n      mediaContainer = newMediaContainer;\n      _middleware.clean();\n      const middleware = _middleware.get();\n\n      const doc = await managers.appDocsManager.getDoc(docId);\n      if(!middleware()) return;\n\n      let r: Awaited<ReturnType<typeof doThatSticker>>;\n      try {\n        r = await doThatSticker({\n          doc,\n          mediaContainer,\n          middleware,\n          isSwitching: true\n        });\n        if(!r) return;\n      } catch(err) {\n        return;\n      }\n\n      const {ready, transformer} = r;\n\n      const _previousTransformer = previousTransformer;\n      SetTransition(_previousTransformer, 'is-switching', true, switchDuration, () => {\n        _previousTransformer.remove();\n      });\n\n      previousTransformer = transformer;\n\n      SetTransition(transformer, 'is-switching', false, switchDuration, () => {\n        if(!middleware()) return;\n        ready();\n      });\n    };\n\n    const onMousePreMove = (e: MouseEvent) => {\n      if(!findUpAsChild(e.target as HTMLElement, mediaContainer)) {\n        document.removeEventListener('mousemove', onMousePreMove);\n        onMouseUp();\n      }\n    };\n\n    const onMouseUp = () => {\n      clearTimeout(timeout);\n      _middleware.clean();\n\n      if(container) {\n        SetTransition(container, 'is-visible', false, openDuration, () => {\n          container.remove();\n          animationIntersector.setOnlyOnePlayableGroup(previousGroup);\n          animationIntersector.checkAnimations(false);\n          hasViewer = false;\n        });\n\n        attachClickEvent(document.body, cancelEvent, {capture: true, once: true});\n      }\n\n      document.removeEventListener('mousemove', onMouseMove);\n      document.removeEventListener('mouseup', onMouseUp, {capture: true});\n    };\n\n    document.addEventListener('mousemove', onMousePreMove);\n    document.addEventListener('mouseup', onMouseUp, {once: true, capture: true});\n  });\n}\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nexport default class StickyIntersector {\r\n  private headersObserver: IntersectionObserver;\r\n  private elementsObserver: IntersectionObserver;\r\n\r\n  constructor(private container: HTMLElement, private handler: (stuck: boolean, target: HTMLElement) => void) {\r\n    this.observeHeaders();\r\n    this.observeElements();\r\n  }\r\n\r\n  /**\r\n   * Sets up an intersection observer to notify when elements with the class\r\n   * `.sticky_sentinel--top` become visible/invisible at the top of the container.\r\n   * @param {!Element} container\r\n   */\r\n  private observeHeaders() {\r\n    this.headersObserver = new IntersectionObserver((entries) => {\r\n      for(const entry of entries) {\r\n        const targetInfo = entry.boundingClientRect;\r\n        const stickyTarget = entry.target.parentElement;\r\n        const rootBoundsInfo = entry.rootBounds;\r\n\r\n        // Started sticking.\r\n        if(targetInfo.bottom < rootBoundsInfo.top) {\r\n          this.handler(true, stickyTarget);\r\n        }\r\n\r\n        // Stopped sticking.\r\n        if(targetInfo.bottom >= rootBoundsInfo.top &&\r\n            targetInfo.bottom < rootBoundsInfo.bottom) {\r\n          this.handler(false, stickyTarget);\r\n        }\r\n      }\r\n    }, {threshold: 0, root: this.container});\r\n  }\r\n\r\n  private observeElements() {\r\n    this.elementsObserver = new IntersectionObserver((entries) => {\r\n      const entry = entries\r\n      .filter((entry) => entry.boundingClientRect.top < entry.rootBounds.top)\r\n      .sort((a, b) => a.boundingClientRect.top - b.boundingClientRect.top)[0];\r\n      if(!entry) return;\r\n\r\n      const container = entry.isIntersecting ? entry.target : entry.target.nextElementSibling;\r\n      this.handler(true, container as HTMLElement);\r\n    }, {root: this.container});\r\n  }\r\n\r\n  /**\r\n   * @param {!Element} container\r\n   * @param {string} className\r\n   */\r\n  private addSentinel(container: HTMLElement, className: string) {\r\n    const sentinel = document.createElement('div');\r\n    sentinel.classList.add('sticky_sentinel', className);\r\n    return container.appendChild(sentinel);\r\n  }\r\n\r\n  /**\r\n   * Notifies when elements w/ the `sticky` class begin to stick or stop sticking.\r\n   * Note: the elements should be children of `container`.\r\n   * @param {!Element} container\r\n   */\r\n  public observeStickyHeaderChanges(element: HTMLElement) {\r\n    const headerSentinel = this.addSentinel(element, 'sticky_sentinel--top');\r\n    this.headersObserver.observe(headerSentinel);\r\n\r\n    this.elementsObserver.observe(element);\r\n  }\r\n\r\n  public disconnect() {\r\n    this.headersObserver.disconnect();\r\n    this.elementsObserver.disconnect();\r\n  }\r\n\r\n  public unobserve(element: HTMLElement, headerSentinel: HTMLElement) {\r\n    this.elementsObserver.unobserve(element);\r\n    this.headersObserver.unobserve(headerSentinel);\r\n  }\r\n}\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport cancelEvent from '../helpers/dom/cancelEvent';\r\nimport IS_TOUCH_SUPPORTED from '../environment/touchSupport';\r\nimport safeAssign from '../helpers/object/safeAssign';\r\nimport contextMenuController from '../helpers/contextMenuController';\r\n\r\nconst getEvent = (e: TouchEvent | MouseEvent) => {\r\n  return (e as TouchEvent).touches ? (e as TouchEvent).touches[0] : e as MouseEvent;\r\n};\r\n\r\nconst attachGlobalListenerTo = window;\r\n\r\nlet RESET_GLOBAL = false;\r\ncontextMenuController.addEventListener('toggle', (visible) => {\r\n  RESET_GLOBAL = visible;\r\n});\r\n\r\nexport type SwipeHandlerOptions = {\r\n  element: SwipeHandler['element'],\r\n  onSwipe: SwipeHandler['onSwipe'],\r\n  verifyTouchTarget?: SwipeHandler['verifyTouchTarget'],\r\n  onFirstSwipe?: SwipeHandler['onFirstSwipe'],\r\n  onReset?: SwipeHandler['onReset'],\r\n  cursor?: SwipeHandler['cursor'],\r\n  cancelEvent?: SwipeHandler['cancelEvent'],\r\n  listenerOptions?: SwipeHandler['listenerOptions']\r\n};\r\n\r\nexport default class SwipeHandler {\r\n  private element: HTMLElement;\r\n  private onSwipe: (xDiff: number, yDiff: number, e: TouchEvent | MouseEvent) => boolean | void;\r\n  private verifyTouchTarget: (evt: TouchEvent | MouseEvent) => boolean | Promise<boolean>;\r\n  private onFirstSwipe: () => void;\r\n  private onReset: () => void;\r\n  private cursor: 'grabbing' | 'move' | 'row-resize' | 'col-resize' | 'nesw-resize' | 'nwse-resize' | 'ne-resize' | 'se-resize' | 'sw-resize' | 'nw-resize' | 'n-resize' | 'e-resize' | 's-resize' | 'w-resize' | '' = 'grabbing';\r\n  private cancelEvent = true;\r\n  private listenerOptions: boolean | AddEventListenerOptions = false;\r\n  private setCursorTo: HTMLElement;\r\n\r\n  private hadMove = false;\r\n  private xDown: number = null;\r\n  private yDown: number = null;\r\n\r\n  constructor(options: SwipeHandlerOptions) {\r\n    safeAssign(this, options);\r\n\r\n    this.setCursorTo = this.element;\r\n\r\n    this.setListeners();\r\n  }\r\n\r\n  public setListeners() {\r\n    if(!IS_TOUCH_SUPPORTED) {\r\n      this.element.addEventListener('mousedown', this.handleStart, this.listenerOptions);\r\n      attachGlobalListenerTo.addEventListener('mouseup', this.reset);\r\n    } else {\r\n      this.element.addEventListener('touchstart', this.handleStart, this.listenerOptions);\r\n      attachGlobalListenerTo.addEventListener('touchend', this.reset);\r\n    }\r\n  }\r\n\r\n  public removeListeners() {\r\n    if(!IS_TOUCH_SUPPORTED) {\r\n      this.element.removeEventListener('mousedown', this.handleStart, this.listenerOptions);\r\n      attachGlobalListenerTo.removeEventListener('mouseup', this.reset);\r\n    } else {\r\n      this.element.removeEventListener('touchstart', this.handleStart, this.listenerOptions);\r\n      attachGlobalListenerTo.removeEventListener('touchend', this.reset);\r\n    }\r\n  }\r\n\r\n  public setCursor(cursor: SwipeHandler['cursor']) {\r\n    this.cursor = cursor;\r\n\r\n    if(!IS_TOUCH_SUPPORTED && this.hadMove) {\r\n      this.setCursorTo.style.setProperty('cursor', this.cursor, 'important');\r\n    }\r\n  }\r\n\r\n  reset = (e?: Event) => {\r\n    /* if(e) {\r\n      cancelEvent(e);\r\n    } */\r\n\r\n    if(IS_TOUCH_SUPPORTED) {\r\n      attachGlobalListenerTo.removeEventListener('touchmove', this.handleMove, {capture: true});\r\n    } else {\r\n      attachGlobalListenerTo.removeEventListener('mousemove', this.handleMove);\r\n      this.setCursorTo.style.cursor = '';\r\n    }\r\n\r\n    if(this.onReset && this.hadMove) {\r\n      this.onReset();\r\n    }\r\n\r\n    this.xDown = this.yDown = null;\r\n    this.hadMove = false;\r\n  };\r\n\r\n  handleStart = async(_e: TouchEvent | MouseEvent) => {\r\n    const e = getEvent(_e);\r\n    if(this.verifyTouchTarget && !(await this.verifyTouchTarget(_e))) {\r\n      return this.reset();\r\n    }\r\n\r\n    this.xDown = e.clientX;\r\n    this.yDown = e.clientY;\r\n\r\n    if(IS_TOUCH_SUPPORTED) {\r\n      attachGlobalListenerTo.addEventListener('touchmove', this.handleMove, {passive: false, capture: true});\r\n    } else {\r\n      attachGlobalListenerTo.addEventListener('mousemove', this.handleMove, false);\r\n    }\r\n  };\r\n\r\n  handleMove = (_e: TouchEvent | MouseEvent) => {\r\n    if(this.xDown === null || this.yDown === null || RESET_GLOBAL) {\r\n      this.reset();\r\n      return;\r\n    }\r\n\r\n    if(this.cancelEvent) {\r\n      cancelEvent(_e);\r\n    }\r\n\r\n    const e = getEvent(_e);\r\n    const xUp = e.clientX;\r\n    const yUp = e.clientY;\r\n\r\n    const xDiff = this.xDown - xUp;\r\n    const yDiff = this.yDown - yUp;\r\n\r\n    if(!this.hadMove) {\r\n      if(!xDiff && !yDiff) {\r\n        return;\r\n      }\r\n\r\n      this.hadMove = true;\r\n\r\n      if(!IS_TOUCH_SUPPORTED) {\r\n        this.setCursorTo.style.setProperty('cursor', this.cursor, 'important');\r\n      }\r\n\r\n      if(this.onFirstSwipe) {\r\n        this.onFirstSwipe();\r\n      }\r\n    }\r\n\r\n    // if(Math.abs(xDiff) > Math.abs(yDiff)) { /*most significant*/\r\n    //   if(xDiff > 0) { /* left swipe */\r\n\r\n    //   } else { /* right swipe */\r\n\r\n    //   }\r\n    // } else {\r\n    //   if(yDiff > 0) { /* up swipe */\r\n\r\n    //   } else { /* down swipe */\r\n\r\n    //   }\r\n    // }\r\n\r\n    /* reset values */\r\n    const onSwipeResult = this.onSwipe(xDiff, yDiff, _e);\r\n    if(onSwipeResult !== undefined && onSwipeResult) {\r\n      this.reset();\r\n    }\r\n  };\r\n}\r\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport placeCaretAtEnd from '../helpers/dom/placeCaretAtEnd';\nimport {formatPhoneNumber} from '../helpers/formatPhoneNumber';\nimport {IS_APPLE, IS_ANDROID, IS_APPLE_MOBILE} from '../environment/userAgent';\nimport {HelpCountry, HelpCountryCode} from '../layer';\nimport InputField, {InputFieldOptions} from './inputField';\n\nexport default class TelInputField extends InputField {\n  private pasted = false;\n  public lastValue = '';\n\n  constructor(options: InputFieldOptions & {\n    onInput?: (formatted: ReturnType<typeof formatPhoneNumber>) => void\n  } = {}) {\n    super({\n      label: 'Contacts.PhoneNumber.Placeholder',\n      // plainText: true,\n      name: 'phone',\n      ...options\n    });\n\n    this.container.classList.add('input-field-phone');\n\n    const telEl = this.input;\n    if(telEl instanceof HTMLInputElement) {\n      telEl.type = 'tel';\n      telEl.autocomplete = 'rr55RandomRR55';\n    } else {\n      telEl.inputMode = 'decimal';\n\n      const pixelRatio = window.devicePixelRatio;\n      if(pixelRatio > 1) {\n        let letterSpacing: number;\n        if(IS_APPLE) {\n          letterSpacing = pixelRatio * -.16;\n        } else if(IS_ANDROID) {\n          letterSpacing = 0;\n        }\n\n        telEl.style.setProperty('--letter-spacing', letterSpacing + 'px');\n      }\n\n      const originalFunc = this.setValueSilently.bind(this);\n      this.setValueSilently = (value) => {\n        originalFunc(value);\n        placeCaretAtEnd(this.input, true);\n      };\n    }\n\n    telEl.addEventListener('input', () => {\n      // console.log('input', this.value);\n      telEl.classList.remove('error');\n\n      const value = this.value;\n      const diff = Math.abs(value.length - this.lastValue.length);\n      if(diff > 1 && !this.pasted && IS_APPLE_MOBILE) {\n        this.setValueSilently(this.lastValue + value);\n      }\n\n      this.pasted = false;\n\n      this.setLabel();\n\n      let formattedPhoneNumber: ReturnType<typeof formatPhoneNumber>;\n      let formatted: string, country: HelpCountry, countryCode: HelpCountryCode, leftPattern = '';\n      if(this.value.replace(/\\++/, '+') === '+') {\n        this.setValueSilently('+');\n      } else {\n        formattedPhoneNumber = formatPhoneNumber(this.value);\n        formatted = formattedPhoneNumber.formatted;\n        country = formattedPhoneNumber.country;\n        leftPattern = formattedPhoneNumber.leftPattern;\n        countryCode = formattedPhoneNumber.code;\n        this.setValueSilently(this.lastValue = formatted ? '+' + formatted : '');\n      }\n\n      telEl.dataset.leftPattern = leftPattern/* .replace(/X/g, '0') */;\n\n      // console.log(formatted, country);\n\n      options.onInput && options.onInput(formattedPhoneNumber);\n    });\n\n    telEl.addEventListener('paste', () => {\n      this.pasted = true;\n      // console.log('paste', telEl.value);\n    });\n\n    /* telEl.addEventListener('change', (e) => {\n      console.log('change', telEl.value);\n    }); */\n\n    telEl.addEventListener('keypress', (e) => {\n      // console.log('keypress', this.value);\n      const key = e.key;\n      if(/\\D/.test(key) && !(e.metaKey || e.ctrlKey) && key !== 'Backspace' && !(key === '+' && e.shiftKey/*  && !this.value */)) {\n        e.preventDefault();\n        return false;\n      }\n    });\n\n    /* telEl.addEventListener('focus', function(this: typeof telEl, e) {\n      this.removeAttribute('readonly'); // fix autocomplete\n    });*/\n  }\n}\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport replaceContent from '../helpers/dom/replaceContent';\r\nimport OverlayClickHandler from '../helpers/overlayClickHandler';\r\nimport {FormatterArguments, i18n, LangPackKey} from '../lib/langPack';\r\n\r\nconst toastEl = document.createElement('div');\r\ntoastEl.classList.add('toast');\r\nlet timeout: number;\r\n\r\nconst x = new OverlayClickHandler('toast');\r\nx.addEventListener('toggle', (open) => {\r\n  if(!open) {\r\n    hideToast();\r\n  }\r\n});\r\n\r\nexport function hideToast() {\r\n  x.close();\r\n\r\n  toastEl.classList.remove('is-visible');\r\n  timeout && clearTimeout(+timeout);\r\n\r\n  timeout = window.setTimeout(() => {\r\n    toastEl.remove();\r\n    timeout = undefined;\r\n  }, 200);\r\n}\r\n\r\nexport function toast(content: string | Node, onClose?: () => void) {\r\n  x.close();\r\n\r\n  replaceContent(toastEl, content);\r\n\r\n  if(!toastEl.parentElement) {\r\n    document.body.append(toastEl);\r\n    void toastEl.offsetLeft; // reflow\r\n  }\r\n\r\n  toastEl.classList.add('is-visible');\r\n\r\n  timeout && clearTimeout(+timeout);\r\n  x.open(toastEl);\r\n\r\n  timeout = window.setTimeout(hideToast, 3000);\r\n\r\n  if(onClose) {\r\n    x.addEventListener('toggle', onClose, {once: true});\r\n  }\r\n}\r\n\r\nexport function toastNew(options: Partial<{\r\n  langPackKey: LangPackKey,\r\n  langPackArguments: FormatterArguments,\r\n  onClose: () => void\r\n}>) {\r\n  toast(i18n(options.langPackKey, options.langPackArguments), options.onClose);\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport rootScope from '../lib/rootScope';\r\nimport deferredPromise, {CancellablePromise} from '../helpers/cancellablePromise';\r\nimport {dispatchHeavyAnimationEvent} from '../hooks/useHeavyAnimationCheck';\r\nimport whichChild from '../helpers/dom/whichChild';\r\nimport cancelEvent from '../helpers/dom/cancelEvent';\r\nimport ListenerSetter from '../helpers/listenerSetter';\r\n\r\nfunction slideNavigation(tabContent: HTMLElement, prevTabContent: HTMLElement, toRight: boolean) {\r\n  const width = prevTabContent.getBoundingClientRect().width;\r\n  const elements = [tabContent, prevTabContent];\r\n  if(toRight) elements.reverse();\r\n  elements[0].style.filter = `brightness(80%)`;\r\n  elements[0].style.transform = `translate3d(${-width * .25}px, 0, 0)`;\r\n  elements[1].style.transform = `translate3d(${width}px, 0, 0)`;\r\n\r\n  tabContent.classList.add('active');\r\n  void tabContent.offsetWidth; // reflow\r\n\r\n  tabContent.style.transform = '';\r\n  tabContent.style.filter = '';\r\n\r\n  return () => {\r\n    prevTabContent.style.transform = prevTabContent.style.filter = '';\r\n  };\r\n}\r\n\r\nfunction slideTabs(tabContent: HTMLElement, prevTabContent: HTMLElement, toRight: boolean) {\r\n  // Jolly Cobra's // Workaround for scrollable content flickering during animation.\r\n  // const scrollableContainer = findUpClassName(tabContent, 'scrollable-y');\r\n  // if(scrollableContainer && scrollableContainer.style.overflowY !== 'hidden') {\r\n  //   // const scrollBarWidth = scrollableContainer.offsetWidth - scrollableContainer.clientWidth;\r\n  //   scrollableContainer.style.overflowY = 'hidden';\r\n  //   // scrollableContainer.style.paddingRight = `${scrollBarWidth}px`;\r\n  //   // this.container.classList.add('sliding');\r\n  // }\r\n\r\n  // window.requestAnimationFrame(() => {\r\n  const width = prevTabContent.getBoundingClientRect().width;\r\n  /* tabContent.style.setProperty('--width', width + 'px');\r\n    prevTabContent.style.setProperty('--width', width + 'px');\r\n\r\n    tabContent.classList.add('active'); */\r\n  // void tabContent.offsetWidth; // reflow\r\n  const elements = [tabContent, prevTabContent];\r\n  if(toRight) elements.reverse();\r\n  elements[0].style.transform = `translate3d(${-width}px, 0, 0)`;\r\n  elements[1].style.transform = `translate3d(${width}px, 0, 0)`;\r\n\r\n  tabContent.classList.add('active');\r\n  void tabContent.offsetWidth; // reflow\r\n\r\n  tabContent.style.transform = '';\r\n  // });\r\n\r\n  return () => {\r\n    prevTabContent.style.transform = '';\r\n\r\n    // if(scrollableContainer) {\r\n    //   // Jolly Cobra's // Workaround for scrollable content flickering during animation.\r\n    //   if(isSafari) { // ! safari doesn't respect sticky header, so it flicks when overflow is changing\r\n    //     scrollableContainer.style.display = 'none';\r\n    //   }\r\n\r\n    //   scrollableContainer.style.overflowY = '';\r\n\r\n    //   if(isSafari) {\r\n    //     void scrollableContainer.offsetLeft; // reflow\r\n    //     scrollableContainer.style.display = '';\r\n    //   }\r\n\r\n    //   // scrollableContainer.style.paddingRight = '0';\r\n    //   // this.container.classList.remove('sliding');\r\n    // }\r\n  };\r\n}\r\n\r\nexport const TransitionSlider = (\r\n  content: HTMLElement,\r\n  type: 'tabs' | 'navigation' | 'zoom-fade' | 'slide-fade' | 'none'/*  | 'counter' */,\r\n  transitionTime: number,\r\n  onTransitionEnd?: (id: number) => void,\r\n  isHeavy = true,\r\n  listenerSetter?: ListenerSetter\r\n) => {\r\n  let animationFunction: TransitionFunction = null;\r\n\r\n  switch(type) {\r\n    case 'tabs':\r\n      animationFunction = slideTabs;\r\n      break;\r\n    case 'navigation':\r\n      animationFunction = slideNavigation;\r\n      break;\r\n    /* default:\r\n      break; */\r\n  }\r\n\r\n  content.dataset.animation = type;\r\n\r\n  return Transition(content, animationFunction, transitionTime, onTransitionEnd, isHeavy, undefined, undefined, listenerSetter);\r\n};\r\n\r\ntype TransitionFunction = (tabContent: HTMLElement, prevTabContent: HTMLElement, toRight: boolean) => void | (() => void);\r\n\r\nconst Transition = (\r\n  content: HTMLElement,\r\n  animationFunction: TransitionFunction,\r\n  transitionTime: number,\r\n  onTransitionEnd?: (id: number) => void,\r\n  isHeavy = true,\r\n  once = false,\r\n  withAnimationListener = true,\r\n  listenerSetter?: ListenerSetter\r\n) => {\r\n  const onTransitionEndCallbacks: Map<HTMLElement, Function> = new Map();\r\n  let animationDeferred: CancellablePromise<void>;\r\n  // let animationStarted = 0;\r\n  let from: HTMLElement = null;\r\n\r\n  if(withAnimationListener) {\r\n    const listenerName = animationFunction ? 'transitionend' : 'animationend';\r\n\r\n    const onEndEvent = (e: TransitionEvent | AnimationEvent) => {\r\n      cancelEvent(e);\r\n\r\n      if((e.target as HTMLElement).parentElement !== content) {\r\n        return;\r\n      }\r\n\r\n      // console.log('Transition: transitionend', /* content, */ e, selectTab.prevId, performance.now() - animationStarted);\r\n\r\n      const callback = onTransitionEndCallbacks.get(e.target as HTMLElement);\r\n      callback?.();\r\n\r\n      if(e.target !== from) {\r\n        return;\r\n      }\r\n\r\n      if(!animationDeferred && isHeavy) return;\r\n\r\n      if(animationDeferred) {\r\n        animationDeferred.resolve();\r\n        animationDeferred = undefined;\r\n      }\r\n\r\n      if(onTransitionEnd) {\r\n        onTransitionEnd(selectTab.prevId());\r\n      }\r\n\r\n      content.classList.remove('animating', 'backwards', 'disable-hover');\r\n\r\n      if(once) {\r\n        if(listenerSetter) listenerSetter.removeManual(content, listenerName, onEndEvent);\r\n        else content.removeEventListener(listenerName, onEndEvent/* , {capture: false} */);\r\n        from = animationDeferred = undefined;\r\n        onTransitionEndCallbacks.clear();\r\n      }\r\n    };\r\n\r\n    // TODO: check for transition type (transform, etc) using by animationFunction\r\n    if(listenerSetter) listenerSetter.add(content)(listenerName, onEndEvent);\r\n    else content.addEventListener(listenerName, onEndEvent/* , {passive: true, capture: false} */);\r\n  }\r\n\r\n  function selectTab(id: number | HTMLElement, animate = true, overrideFrom?: typeof from) {\r\n    if(overrideFrom) {\r\n      from = overrideFrom;\r\n    }\r\n\r\n    if(id instanceof HTMLElement) {\r\n      id = whichChild(id);\r\n    }\r\n\r\n    const prevId = selectTab.prevId();\r\n    if(id === prevId) return false;\r\n\r\n    // console.log('selectTab id:', id);\r\n\r\n    const to = content.children[id] as HTMLElement;\r\n\r\n    if(!rootScope.settings.animationsEnabled || prevId === -1) {\r\n      animate = false;\r\n    }\r\n\r\n    if(!withAnimationListener) {\r\n      const timeout = content.dataset.timeout;\r\n      if(timeout !== undefined) {\r\n        clearTimeout(+timeout);\r\n      }\r\n\r\n      delete content.dataset.timeout;\r\n    }\r\n\r\n    if(!animate) {\r\n      if(from) from.classList.remove('active', 'to', 'from');\r\n      else if(to) { // fix instant opening back from closed slider (e.g. instant closening and opening right sidebar)\r\n        const callback = onTransitionEndCallbacks.get(to);\r\n        callback?.();\r\n      }\r\n\r\n      if(to) {\r\n        to.classList.remove('to', 'from');\r\n        to.classList.add('active');\r\n      }\r\n\r\n      content.classList.remove('animating', 'backwards', 'disable-hover');\r\n\r\n      from = to;\r\n\r\n      if(onTransitionEnd) onTransitionEnd(id);\r\n      return;\r\n    }\r\n\r\n    if(!withAnimationListener) {\r\n      content.dataset.timeout = '' + window.setTimeout(() => {\r\n        to.classList.remove('to');\r\n        from && from.classList.remove('from');\r\n        content.classList.remove('animating', 'backwards', 'disable-hover');\r\n        delete content.dataset.timeout;\r\n      }, transitionTime);\r\n    }\r\n\r\n    if(from) {\r\n      from.classList.remove('to');\r\n      from.classList.add('from');\r\n    }\r\n\r\n    content.classList.add('animating'/* , 'disable-hover' */);\r\n    const toRight = prevId < id;\r\n    content.classList.toggle('backwards', !toRight);\r\n\r\n    let onTransitionEndCallback: ReturnType<TransitionFunction>;\r\n    if(!to) {\r\n      // prevTabContent.classList.remove('active');\r\n    } else {\r\n      if(animationFunction) {\r\n        onTransitionEndCallback = animationFunction(to, from, toRight);\r\n      } else {\r\n        to.classList.add('active');\r\n      }\r\n\r\n      to.classList.remove('from');\r\n      to.classList.add('to');\r\n    }\r\n\r\n    if(to) {\r\n      onTransitionEndCallbacks.set(to, () => {\r\n        to.classList.remove('to');\r\n        onTransitionEndCallbacks.delete(to);\r\n      });\r\n    }\r\n\r\n    if(from/*  && false */) {\r\n      let timeout: number;\r\n      const _from = from;\r\n      const callback = () => {\r\n        clearTimeout(timeout);\r\n        _from.classList.remove('active', 'from');\r\n\r\n        if(onTransitionEndCallback) {\r\n          onTransitionEndCallback?.();\r\n        }\r\n\r\n        onTransitionEndCallbacks.delete(_from);\r\n      };\r\n\r\n      if(to) {\r\n        timeout = window.setTimeout(callback, transitionTime + 100); // something happened to container\r\n        onTransitionEndCallbacks.set(_from, callback);\r\n      } else {\r\n        timeout = window.setTimeout(callback, transitionTime);\r\n        onTransitionEndCallbacks.set(_from, () => {\r\n          clearTimeout(timeout);\r\n          onTransitionEndCallbacks.delete(_from);\r\n        });\r\n      }\r\n\r\n      if(isHeavy) {\r\n        if(!animationDeferred) {\r\n          animationDeferred = deferredPromise<void>();\r\n          // animationStarted = performance.now();\r\n        }\r\n\r\n        dispatchHeavyAnimationEvent(animationDeferred, transitionTime * 2);\r\n      }\r\n    }\r\n\r\n    from = to;\r\n  }\r\n\r\n  // selectTab.prevId = -1;\r\n  selectTab.prevId = () => from ? whichChild(from) : -1;\r\n  selectTab.getFrom = () => from;\r\n  selectTab.setFrom = (_from: HTMLElement) => from = _from;\r\n\r\n  return selectTab;\r\n};\r\n\r\nexport default Transition;\r\n","export default function isUsernameValid(username: string) {\n  return ((username.length >= 5 && username.length <= 32) || !username.length) && /^[a-zA-Z0-9_]*$/.test(username);\n}\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport ListenerSetter from '../helpers/listenerSetter';\r\nimport debounce from '../helpers/schedulers/debounce';\r\nimport {LangPackKey} from '../lib/langPack';\r\nimport InputField, {InputFieldOptions, InputState} from './inputField';\r\nimport isUsernameValid from '../lib/richTextProcessor/isUsernameValid';\r\nimport {AppManagers} from '../lib/appManagers/managers';\r\n\r\nexport class UsernameInputField extends InputField {\r\n  private checkUsernamePromise: Promise<any>;\r\n  private checkUsernameDebounced: (username: string) => void;\r\n  public options: InputFieldOptions & {\r\n    peerId?: PeerId,\r\n    listenerSetter: ListenerSetter,\r\n    onChange?: () => void,\r\n    invalidText: LangPackKey,\r\n    takenText: LangPackKey,\r\n    availableText: LangPackKey,\r\n    head?: string\r\n  };\r\n\r\n  constructor(\r\n    options: UsernameInputField['options'],\r\n    private managers: AppManagers\r\n  ) {\r\n    super(options);\r\n\r\n    this.checkUsernameDebounced = debounce(this.checkUsername.bind(this), 150, false, true);\r\n\r\n    options.listenerSetter.add(this.input)('input', () => {\r\n      const value = this.getValue();\r\n\r\n      // console.log('userNameInput:', value);\r\n      if(value === this.originalValue || !value.length) {\r\n        this.setState(InputState.Neutral);\r\n        this.options.onChange && this.options.onChange();\r\n        return;\r\n      } else if(!isUsernameValid(value)) { // does not check the last underscore\r\n        this.setError(this.options.invalidText);\r\n      } else {\r\n        this.setState(InputState.Neutral);\r\n      }\r\n\r\n      if(this.input.classList.contains('error')) {\r\n        this.options.onChange && this.options.onChange();\r\n        return;\r\n      }\r\n\r\n      this.checkUsernameDebounced(value);\r\n    });\r\n  }\r\n\r\n  public getValue() {\r\n    let value = this.value;\r\n    if(this.options.head) {\r\n      value = value.slice(this.options.head.length);\r\n      this.setValueSilently(this.options.head + value);\r\n    }\r\n\r\n    return value;\r\n  }\r\n\r\n  private checkUsername(username: string) {\r\n    if(this.checkUsernamePromise) return;\r\n\r\n    if(this.options.peerId) {\r\n      this.checkUsernamePromise = this.managers.appChatsManager.checkUsername(this.options.peerId.toChatId(), username);\r\n    } else {\r\n      this.checkUsernamePromise = this.managers.appUsersManager.checkUsername(username);\r\n    }\r\n\r\n    this.checkUsernamePromise.then((available) => {\r\n      if(this.getValue() !== username) return;\r\n\r\n      if(available) {\r\n        this.setState(InputState.Valid, this.options.availableText);\r\n      } else {\r\n        this.setError(this.options.takenText);\r\n      }\r\n    }, (err) => {\r\n      if(this.getValue() !== username) return;\r\n\r\n      switch(err.type) {\r\n        case 'USERNAME_INVALID': {\r\n          this.setError(this.options.invalidText);\r\n          break;\r\n        }\r\n      }\r\n    }).then(() => {\r\n      this.checkUsernamePromise = undefined;\r\n      this.options.onChange && this.options.onChange();\r\n\r\n      const value = this.getValue();\r\n      if(value !== username && this.isValidToChange() && isUsernameValid(value)) {\r\n        this.checkUsername(value);\r\n      }\r\n    });\r\n  };\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\ntype TargetType = HTMLElement;\r\nexport type OnVisibilityChangeItem = {target: TargetType, visible: boolean, entry: IntersectionObserverEntry};\r\nexport type OnVisibilityChange = (item: OnVisibilityChangeItem) => void;\r\n\r\nexport default class VisibilityIntersector {\r\n  private observer: IntersectionObserver;\r\n  private items: Map<TargetType, boolean> = new Map();\r\n  private locked = false;\r\n\r\n  constructor(onVisibilityChange: OnVisibilityChange, options?: IntersectionObserverInit) {\r\n    this.observer = new IntersectionObserver((entries) => {\r\n      if(this.locked) {\r\n        return;\r\n      }\r\n\r\n      const changed: OnVisibilityChangeItem[] = [];\r\n\r\n      entries.forEach((entry) => {\r\n        const target = entry.target as TargetType;\r\n\r\n        if(this.items.get(target) === entry.isIntersecting) {\r\n          return;\r\n        } else {\r\n          this.items.set(target, entry.isIntersecting);\r\n        }\r\n\r\n        /* if(entry.isIntersecting) {\r\n          console.log('ooo', entry);\r\n        } */\r\n\r\n        /* if(this.locked) {\r\n          return;\r\n        } */\r\n\r\n        const change: typeof changed[0] = {target, visible: entry.isIntersecting, entry};\r\n\r\n        // ! order will be incorrect so can't use it\r\n        // changed[entry.isIntersecting ? 'unshift' : 'push'](change);\r\n        changed.push(change);\r\n\r\n        // onVisibilityChange(target, entry.isIntersecting);\r\n      });\r\n\r\n      changed.forEach((item) => {\r\n        onVisibilityChange(item);\r\n      });\r\n    }, options);\r\n  }\r\n\r\n  public getVisible() {\r\n    const items: TargetType[] = [];\r\n    this.items.forEach((value, key) => {\r\n      if(value) {\r\n        items.push(key);\r\n      }\r\n    });\r\n\r\n    return items;\r\n  }\r\n\r\n  public clearVisible() {\r\n    const visible = this.getVisible();\r\n    for(const target of visible) {\r\n      this.items.set(target, false);\r\n    }\r\n  }\r\n\r\n  public isVisible(target: TargetType) {\r\n    return this.items.get(target);\r\n  }\r\n\r\n  public disconnect() {\r\n    this.observer.disconnect();\r\n    this.items.clear();\r\n  }\r\n\r\n  public refresh() {\r\n    this.observer.disconnect();\r\n\r\n    // window.requestAnimationFrame(() => {\r\n    const targets = [...this.items.keys()];\r\n    for(const target of targets) {\r\n      // this.items.set(target, false);\r\n      this.observer.observe(target);\r\n    }\r\n    // });\r\n  }\r\n\r\n  public refreshVisible() {\r\n    const visible = this.getVisible();\r\n    for(const target of visible) {\r\n      this.observer.unobserve(target);\r\n    }\r\n\r\n    for(const target of visible) {\r\n      this.observer.observe(target);\r\n    }\r\n  }\r\n\r\n  public observe(target: TargetType) {\r\n    this.items.set(target, false);\r\n    this.observer.observe(target);\r\n  }\r\n\r\n  public unobserve(target: TargetType) {\r\n    this.observer.unobserve(target);\r\n    this.items.delete(target);\r\n  }\r\n\r\n  public unlock() {\r\n    this.locked = false;\r\n  }\r\n\r\n  public unlockAndRefresh() {\r\n    this.unlock();\r\n    this.refresh();\r\n  }\r\n\r\n  public lock() {\r\n    this.locked = true;\r\n  }\r\n}\r\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport cancelEvent from '../helpers/dom/cancelEvent';\nimport {attachClickEvent} from '../helpers/dom/clickEvent';\nimport ListenerSetter from '../helpers/listenerSetter';\nimport rootScope from '../lib/rootScope';\nimport appMediaPlaybackController from './appMediaPlaybackController';\nimport RangeSelector from './rangeSelector';\n\nexport default class VolumeSelector extends RangeSelector {\n  private static ICONS = ['volume_off', 'volume_mute', 'volume_down', 'volume_up'];\n  public btn: HTMLElement;\n  protected icon: HTMLSpanElement;\n\n  constructor(protected listenerSetter: ListenerSetter, protected vertical = false) {\n    super({\n      step: 0.01,\n      min: 0,\n      max: 1,\n      vertical\n    }, 1);\n\n    this.setListeners();\n    this.setHandlers({\n      onScrub: currentTime => {\n        const value = Math.max(Math.min(currentTime, 1), 0);\n\n        // console.log('volume scrub:', currentTime, value);\n\n        appMediaPlaybackController.muted = false;\n        appMediaPlaybackController.volume = value;\n      }\n\n      /* onMouseUp: (e) => {\n        cancelEvent(e.event);\n      } */\n    });\n\n    const className = 'player-volume';\n    const btn = this.btn = document.createElement('div');\n    btn.classList.add('btn-icon', className);\n    const icon = this.icon = document.createElement('span');\n    icon.classList.add(className + '__icon');\n\n    btn.append(icon, this.container);\n\n    attachClickEvent(icon, this.onMuteClick, {listenerSetter: this.listenerSetter});\n    this.listenerSetter.add(appMediaPlaybackController)('playbackParams', this.setVolume);\n\n    this.setVolume();\n  }\n\n  private onMuteClick = (e?: Event) => {\n    e && cancelEvent(e);\n    appMediaPlaybackController.muted = !appMediaPlaybackController.muted;\n  };\n\n  public setVolume = () => {\n    // const volume = video.volume;\n    const {volume, muted} = appMediaPlaybackController;\n    let d: string;\n    let iconIndex: number;\n    if(!volume || muted) {\n      iconIndex = 0;\n    } else if(volume > .5) {\n      iconIndex = 3;\n    } else if(volume > 0 && volume < .25) {\n      iconIndex = 1;\n    } else {\n      iconIndex = 2;\n    }\n\n    VolumeSelector.ICONS.forEach((icon) => this.icon.classList.remove('tgico-' + icon));\n    this.icon.classList.add('tgico-' + VolumeSelector.ICONS[iconIndex]);\n\n    if(!this.mousedown) {\n      this.setProgress(muted ? 0 : volume);\n    }\n  };\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport renderMediaWithFadeIn from '../../helpers/dom/renderMediaWithFadeIn';\nimport mediaSizes from '../../helpers/mediaSizes';\nimport {Message, PhotoSize, VideoSize, WebDocument} from '../../layer';\nimport {MyDocument} from '../../lib/appManagers/appDocsManager';\nimport {MyPhoto} from '../../lib/appManagers/appPhotosManager';\nimport rootScope from '../../lib/rootScope';\nimport LazyLoadQueue from '../lazyLoadQueue';\nimport ProgressivePreloader from '../preloader';\nimport blur from '../../helpers/blur';\nimport {AppManagers} from '../../lib/appManagers/managers';\nimport getStrippedThumbIfNeeded from '../../helpers/getStrippedThumbIfNeeded';\nimport setAttachmentSize from '../../helpers/setAttachmentSize';\nimport choosePhotoSize from '../../lib/appManagers/utils/photos/choosePhotoSize';\nimport type {ThumbCache} from '../../lib/storages/thumbs';\nimport appDownloadManager from '../../lib/appManagers/appDownloadManager';\nimport isWebDocument from '../../lib/appManagers/utils/webDocs/isWebDocument';\nimport createVideo from '../../helpers/dom/createVideo';\nimport noop from '../../helpers/noop';\nimport {THUMB_TYPE_FULL} from '../../lib/mtproto/mtproto_config';\nimport {Middleware} from '../../helpers/middleware';\n\nexport default async function wrapPhoto({photo, message, container, boxWidth, boxHeight, withTail, isOut, lazyLoadQueue, middleware, size, withoutPreloader, loadPromises, autoDownloadSize, noBlur, noThumb, noFadeIn, blurAfter, managers = rootScope.managers}: {\n  photo: MyPhoto | MyDocument | WebDocument,\n  message?: Message.message | Message.messageService,\n  container: HTMLElement,\n  boxWidth?: number,\n  boxHeight?: number,\n  withTail?: boolean,\n  isOut?: boolean,\n  lazyLoadQueue?: LazyLoadQueue,\n  middleware?: Middleware,\n  size?: PhotoSize | VideoSize,\n  withoutPreloader?: boolean,\n  loadPromises?: Promise<any>[],\n  autoDownloadSize?: number,\n  noBlur?: boolean,\n  noThumb?: boolean,\n  noFadeIn?: boolean,\n  blurAfter?: boolean,\n  managers?: AppManagers,\n}) {\n  const ret = {\n    loadPromises: {\n      thumb: Promise.resolve() as Promise<any>,\n      full: Promise.resolve() as Promise<any>\n    },\n    images: {\n      thumb: null as HTMLImageElement | HTMLCanvasElement,\n      full: null as HTMLVideoElement | HTMLImageElement\n    },\n    preloader: null as ProgressivePreloader,\n    aspecter: null as HTMLElement\n  };\n\n  const isDocument = photo._ === 'document';\n  const isWebDoc = isWebDocument(photo);\n  if(!((photo as MyPhoto).sizes || (photo as MyDocument).thumbs) && !isWebDoc) {\n    if(boxWidth && boxHeight && !size && isDocument) {\n      setAttachmentSize(photo, container, boxWidth, boxHeight, undefined, message);\n    }\n\n    return ret;\n  }\n\n  let noAutoDownload = autoDownloadSize === 0;\n\n  if(!size) {\n    if(boxWidth === undefined) boxWidth = mediaSizes.active.regular.width;\n    if(boxHeight === undefined) boxHeight = mediaSizes.active.regular.height;\n  }\n\n  container.classList.add('media-container');\n  let aspecter = container;\n\n  let isFit = true;\n  let loadThumbPromise: Promise<any> = Promise.resolve();\n  let thumbImage: HTMLImageElement | HTMLCanvasElement;\n  // let image: HTMLImageElement;\n  let cacheContext: ThumbCache;\n  const isGif = isDocument && photo.mime_type === 'image/gif' && !size;\n  // if(withTail) {\n  //   image = wrapMediaWithTail(photo, message, container, boxWidth, boxHeight, isOut);\n  // } else {\n\n  if(boxWidth && boxHeight && !size) { // !album\n    const set = setAttachmentSize(photo, container, boxWidth, boxHeight, undefined, message, undefined, isGif ? {\n      _: 'photoSize',\n      w: photo.w,\n      h: photo.h,\n      size: photo.size,\n      type: THUMB_TYPE_FULL\n    } : undefined);\n    size = set.photoSize;\n    isFit = set.isFit;\n    cacheContext = await managers.thumbsStorage.getCacheContext(photo, size.type);\n\n    if(!isFit && !isWebDoc) {\n      aspecter = document.createElement('div');\n      aspecter.classList.add('media-container-aspecter');\n      aspecter.style.width = set.size.width + 'px';\n      aspecter.style.height = set.size.height + 'px';\n\n      const gotThumb = getStrippedThumbIfNeeded(photo, cacheContext, !noBlur, true);\n      if(gotThumb) {\n        loadThumbPromise = gotThumb.loadPromise;\n        const thumbImage = gotThumb.image; // local scope\n        thumbImage.classList.add('media-photo');\n        container.append(thumbImage);\n      } else {\n        const res = await wrapPhoto({\n          container,\n          message,\n          photo,\n          boxWidth: 0,\n          boxHeight: 0,\n          size,\n          lazyLoadQueue,\n          isOut,\n          loadPromises,\n          middleware,\n          withoutPreloader,\n          withTail,\n          autoDownloadSize,\n          noBlur,\n          noThumb: true,\n          blurAfter: true,\n          managers\n          // noFadeIn: true\n        });\n        const thumbImage = res.images.full;\n        thumbImage.classList.add('media-photo', 'thumbnail');\n        // container.append(thumbImage);\n      }\n\n      container.classList.add('media-container-fitted');\n      container.append(aspecter);\n    }\n  } else {\n    if(!size) {\n      size = choosePhotoSize(photo, boxWidth, boxHeight, true);\n    }\n\n    cacheContext = await managers.thumbsStorage.getCacheContext(photo, size?.type);\n  }\n\n  if(!noThumb && !isWebDoc) {\n    const gotThumb = getStrippedThumbIfNeeded(photo, cacheContext, !noBlur);\n    if(gotThumb) {\n      loadThumbPromise = Promise.all([loadThumbPromise, gotThumb.loadPromise]);\n      ret.loadPromises.thumb = ret.loadPromises.full = loadThumbPromise;\n      thumbImage = ret.images.thumb = gotThumb.image;\n      thumbImage.classList.add('media-photo');\n      aspecter.append(thumbImage);\n    }\n  }\n  // }\n\n  if(size?._ === 'photoSizeEmpty' && isDocument) {\n    return ret;\n  }\n\n  let media: HTMLVideoElement | HTMLImageElement;\n  if(size?._ === 'videoSize') {\n    media = ret.images.full = createVideo();\n    media.autoplay = true;\n    media.loop = true;\n    media.muted = true;\n    media.classList.add('media-photo');\n  } else {\n    media = ret.images.full = new Image();\n    media.classList.add('media-photo');\n  }\n\n  // console.log('wrapPhoto downloaded:', photo, photo.downloaded, container);\n\n  const needFadeIn = (thumbImage || !cacheContext.downloaded) && rootScope.settings.animationsEnabled && !noFadeIn;\n\n  let preloader: ProgressivePreloader;\n  const uploadingFileName = (message as Message.message)?.uploadingFileName;\n  if(!withoutPreloader) {\n    if(!cacheContext.downloaded || uploadingFileName) {\n      preloader = new ProgressivePreloader({\n        attachMethod: 'prepend',\n        isUpload: !!uploadingFileName\n      });\n    }\n\n    if(uploadingFileName) { // means upload\n      preloader.attachPromise(appDownloadManager.getUpload(uploadingFileName));\n      preloader.attach(container);\n      noAutoDownload = undefined;\n    }\n  }\n\n\n  const getDownloadPromise = () => {\n    // const promise = isGif && !size ?\n    //   managers.appDocsManager.downloadDoc(photo, /* undefined,  */lazyLoadQueue?.queueId) :\n    //   managers.appPhotosManager.preloadPhoto(photo, size, lazyLoadQueue?.queueId, noAutoDownload);\n    const haveToDownload = isGif && !size;\n    const promise = appDownloadManager.downloadMediaURL({\n      media: photo,\n      thumb: size,\n      queueId: lazyLoadQueue?.queueId,\n      onlyCache: haveToDownload ? undefined : noAutoDownload\n    });\n\n    return promise;\n  };\n\n  const renderOnLoad = (url: string) => {\n    return renderMediaWithFadeIn(container, media, url, needFadeIn, aspecter, thumbImage);\n  };\n\n  const onLoad = async(url: string) => {\n    if(middleware && !middleware()) return;\n\n    if(blurAfter) {\n      const result = blur(url, 12);\n      return result.promise.then(() => {\n        // image = result.canvas;\n        return renderOnLoad(result.canvas.toDataURL());\n      });\n    }\n\n    return renderOnLoad(url);\n  };\n\n  let loadPromise: Promise<any>;\n  const canAttachPreloader = (\n    (size as PhotoSize.photoSize).w >= 150 &&\n    (size as PhotoSize.photoSize).h >= 150\n  ) || noAutoDownload;\n  const load = async() => {\n    if(noAutoDownload && !withoutPreloader && preloader) {\n      preloader.construct();\n      preloader.setManual();\n    }\n\n    const promise = getDownloadPromise();\n    const cacheContext = await managers.thumbsStorage.getCacheContext(photo, size?.type);\n    if(\n      preloader &&\n      !cacheContext.downloaded &&\n      !withoutPreloader &&\n      canAttachPreloader\n    ) {\n      preloader.attach(container, false, promise);\n    }\n\n    noAutoDownload = undefined;\n\n    const renderPromise = promise.then(onLoad);\n    renderPromise.catch(noop);\n    return {download: promise, render: renderPromise};\n  };\n\n  if(preloader) {\n    preloader.setDownloadFunction(load);\n  }\n\n  if(cacheContext.downloaded) {\n    loadThumbPromise = loadPromise = (await load()).render;\n  } else {\n    if(!lazyLoadQueue) loadPromise = (await load()).render;\n    /* else if(noAutoDownload) {\n      preloader.construct();\n      preloader.setManual();\n      preloader.attach(container);\n    } */ else lazyLoadQueue.push({div: container, load: () => load().then(({download}) => download)});\n  }\n\n  if(loadPromises && loadThumbPromise) {\n    loadPromises.push(loadThumbPromise);\n  }\n\n  // const perf = performance.now();\n  await loadThumbPromise;\n  ret.loadPromises.thumb = loadThumbPromise;\n  ret.loadPromises.full = loadPromise || Promise.resolve();\n  ret.preloader = preloader;\n  ret.aspecter = aspecter;\n\n  // const elapsedTime = performance.now() - perf;\n  // if(elapsedTime > 4) {\n  //   console.log('wrapping photo thumb time', elapsedTime, photo, size);\n  // }\n\n  return ret;\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport {IS_SAFARI} from '../../environment/userAgent';\nimport {animateSingle} from '../../helpers/animation';\nimport {ChatAutoDownloadSettings} from '../../helpers/autoDownload';\nimport deferredPromise from '../../helpers/cancellablePromise';\nimport cancelEvent from '../../helpers/dom/cancelEvent';\nimport {attachClickEvent} from '../../helpers/dom/clickEvent';\nimport createVideo from '../../helpers/dom/createVideo';\nimport isInDOM from '../../helpers/dom/isInDOM';\nimport renderImageFromUrl from '../../helpers/dom/renderImageFromUrl';\nimport getStrippedThumbIfNeeded from '../../helpers/getStrippedThumbIfNeeded';\nimport mediaSizes, {ScreenSize} from '../../helpers/mediaSizes';\nimport {Middleware} from '../../helpers/middleware';\nimport noop from '../../helpers/noop';\nimport onMediaLoad from '../../helpers/onMediaLoad';\nimport {fastRaf} from '../../helpers/schedulers';\nimport throttle from '../../helpers/schedulers/throttle';\nimport sequentialDom from '../../helpers/sequentialDom';\nimport toHHMMSS from '../../helpers/string/toHHMMSS';\nimport {Message, PhotoSize, VideoSize} from '../../layer';\nimport {MyDocument} from '../../lib/appManagers/appDocsManager';\nimport appDownloadManager from '../../lib/appManagers/appDownloadManager';\nimport appImManager from '../../lib/appManagers/appImManager';\nimport {AppManagers} from '../../lib/appManagers/managers';\nimport {NULL_PEER_ID} from '../../lib/mtproto/mtproto_config';\nimport rootScope from '../../lib/rootScope';\nimport {ThumbCache} from '../../lib/storages/thumbs';\nimport animationIntersector, {AnimationItemGroup} from '../animationIntersector';\nimport appMediaPlaybackController, {MediaSearchContext} from '../appMediaPlaybackController';\nimport {findMediaTargets} from '../audio';\nimport LazyLoadQueue from '../lazyLoadQueue';\nimport ProgressivePreloader from '../preloader';\nimport wrapPhoto from './photo';\n\nconst MAX_VIDEO_AUTOPLAY_SIZE = 50 * 1024 * 1024; // 50 MB\n\nlet roundVideoCircumference = 0;\nmediaSizes.addEventListener('changeScreen', (from, to) => {\n  if(to === ScreenSize.mobile || from === ScreenSize.mobile) {\n    const elements = Array.from(document.querySelectorAll('.media-round .progress-ring')) as SVGSVGElement[];\n    const width = mediaSizes.active.round.width;\n    const halfSize = width / 2;\n    const radius = halfSize - 7;\n    roundVideoCircumference = 2 * Math.PI * radius;\n    elements.forEach((element) => {\n      element.setAttributeNS(null, 'width', '' + width);\n      element.setAttributeNS(null, 'height', '' + width);\n\n      const circle = element.firstElementChild as SVGCircleElement;\n      circle.setAttributeNS(null, 'cx', '' + halfSize);\n      circle.setAttributeNS(null, 'cy', '' + halfSize);\n      circle.setAttributeNS(null, 'r', '' + radius);\n\n      circle.style.strokeDasharray = roundVideoCircumference + ' ' + roundVideoCircumference;\n      circle.style.strokeDashoffset = '' + roundVideoCircumference;\n    });\n  }\n});\n\nexport default async function wrapVideo({doc, container, message, boxWidth, boxHeight, withTail, isOut, middleware, lazyLoadQueue, noInfo, group, onlyPreview, noPreview, withoutPreloader, loadPromises, noPlayButton, photoSize, videoSize, searchContext, autoDownload, managers = rootScope.managers}: {\n  doc: MyDocument,\n  container?: HTMLElement,\n  message?: Message.message,\n  boxWidth?: number,\n  boxHeight?: number,\n  withTail?: boolean,\n  isOut?: boolean,\n  middleware?: Middleware,\n  lazyLoadQueue?: LazyLoadQueue,\n  noInfo?: boolean,\n  noPlayButton?: boolean,\n  group?: AnimationItemGroup,\n  onlyPreview?: boolean,\n  noPreview?: boolean,\n  withoutPreloader?: boolean,\n  loadPromises?: Promise<any>[],\n  autoDownload?: ChatAutoDownloadSettings,\n  photoSize?: PhotoSize,\n  videoSize?: VideoSize,\n  searchContext?: MediaSearchContext,\n  managers?: AppManagers\n}) {\n  const autoDownloadSize = autoDownload?.video;\n  let noAutoDownload = autoDownloadSize === 0;\n  const isAlbumItem = !(boxWidth && boxHeight);\n  const canAutoplay = /* doc.sticker ||  */(\n    (\n      doc.type !== 'video' || (\n        doc.size <= MAX_VIDEO_AUTOPLAY_SIZE &&\n        !isAlbumItem\n      )\n    ) && (doc.type === 'gif' ? rootScope.settings.autoPlay.gifs : rootScope.settings.autoPlay.videos)\n  );\n  let spanTime: HTMLElement, spanPlay: HTMLElement;\n\n  if(!noInfo) {\n    spanTime = document.createElement('span');\n    spanTime.classList.add('video-time');\n    container.append(spanTime);\n\n    let needPlayButton = false;\n    if(doc.type !== 'gif') {\n      spanTime.innerText = toHHMMSS(doc.duration, false);\n\n      if(!noPlayButton && doc.type !== 'round') {\n        if(canAutoplay && !noAutoDownload) {\n          spanTime.classList.add('tgico', 'can-autoplay');\n        } else {\n          needPlayButton = true;\n        }\n      }\n    } else {\n      spanTime.innerText = 'GIF';\n\n      if(!canAutoplay && !noPlayButton) {\n        needPlayButton = true;\n        noAutoDownload = undefined;\n      }\n    }\n\n    if(needPlayButton) {\n      spanPlay = document.createElement('span');\n      spanPlay.classList.add('video-play', 'tgico-largeplay', 'btn-circle', 'position-center');\n      container.append(spanPlay);\n    }\n  }\n\n  const res: {\n    thumb?: typeof photoRes,\n    loadPromise: Promise<any>\n  } = {} as any;\n\n  if(doc.mime_type === 'image/gif') {\n    const photoRes = await wrapPhoto({\n      photo: doc,\n      message,\n      container,\n      boxWidth,\n      boxHeight,\n      withTail,\n      isOut,\n      lazyLoadQueue,\n      middleware,\n      withoutPreloader,\n      loadPromises,\n      autoDownloadSize,\n      size: photoSize,\n      managers\n    });\n\n    res.thumb = photoRes;\n    res.loadPromise = photoRes.loadPromises.full;\n    return res;\n  }\n\n  /* const video = doc.type === 'round' ? appMediaPlaybackController.addMedia(doc, message.mid) as HTMLVideoElement : document.createElement('video');\n  if(video.parentElement) {\n    video.remove();\n  } */\n\n  let preloader: ProgressivePreloader; // it must be here, otherwise will get error before initialization in round onPlay\n\n  const video = createVideo();\n  video.classList.add('media-video');\n  video.muted = true;\n  if(doc.type === 'round') {\n    const divRound = document.createElement('div');\n    divRound.classList.add('media-round', 'z-depth-1');\n    divRound.dataset.mid = '' + message.mid;\n    divRound.dataset.peerId = '' + message.peerId;\n    (divRound as any).message = message;\n\n    const size = mediaSizes.active.round;\n    const halfSize = size.width / 2;\n    const strokeWidth = 3.5;\n    const radius = halfSize - (strokeWidth * 2);\n    divRound.innerHTML = `<svg class=\"progress-ring\" width=\"${size.width}\" height=\"${size.width}\" style=\"transform: rotate(-90deg);\">\n      <circle class=\"progress-ring__circle\" stroke=\"white\" stroke-opacity=\"0.3\" stroke-width=\"${strokeWidth}\" cx=\"${halfSize}\" cy=\"${halfSize}\" r=\"${radius}\" fill=\"transparent\"/>\n    </svg>`;\n\n    const circle = divRound.firstElementChild.firstElementChild as SVGCircleElement;\n    if(!roundVideoCircumference) {\n      roundVideoCircumference = 2 * Math.PI * radius;\n    }\n    circle.style.strokeDasharray = roundVideoCircumference + ' ' + roundVideoCircumference;\n    circle.style.strokeDashoffset = '' + roundVideoCircumference;\n\n    spanTime.classList.add('tgico');\n\n    const isUnread = message.pFlags.media_unread;\n    if(isUnread) {\n      divRound.classList.add('is-unread');\n    }\n\n    const canvas = document.createElement('canvas');\n    canvas.width = canvas.height = doc.w/*  * window.devicePixelRatio */;\n\n    divRound.prepend(canvas, spanTime);\n    divRound.append(video);\n    container.append(divRound);\n\n    const ctx = canvas.getContext('2d');\n    /* ctx.beginPath();\n    ctx.arc(canvas.width / 2, canvas.height / 2, canvas.width / 2, 0, Math.PI * 2);\n    ctx.clip(); */\n\n    const onLoad = () => {\n      const message: Message.message = (divRound as any).message;\n      const globalVideo = appMediaPlaybackController.addMedia(message, !noAutoDownload) as HTMLVideoElement;\n      const clear = () => {\n        (appImManager.chat.setPeerPromise || Promise.resolve()).finally(() => {\n          if(isInDOM(globalVideo)) {\n            return;\n          }\n\n          globalVideo.removeEventListener('play', onPlay);\n          globalVideo.removeEventListener('timeupdate', throttledTimeUpdate);\n          globalVideo.removeEventListener('pause', onPaused);\n          globalVideo.removeEventListener('ended', onEnded);\n        });\n      };\n\n      const onFrame = () => {\n        ctx.drawImage(globalVideo, 0, 0);\n\n        const offset = roundVideoCircumference - globalVideo.currentTime / globalVideo.duration * roundVideoCircumference;\n        circle.style.strokeDashoffset = '' + offset;\n\n        return !globalVideo.paused;\n      };\n\n      const onTimeUpdate = () => {\n        if(!globalVideo.duration) {\n          return;\n        }\n\n        if(!isInDOM(globalVideo)) {\n          clear();\n          return;\n        }\n\n        if(globalVideo.paused) {\n          onFrame();\n        }\n\n        spanTime.innerText = toHHMMSS(globalVideo.duration - globalVideo.currentTime, false);\n      };\n\n      const throttledTimeUpdate = throttle(() => {\n        fastRaf(onTimeUpdate);\n      }, 1000, false);\n\n      const onPlay = () => {\n        video.classList.add('hide');\n        divRound.classList.remove('is-paused');\n        animateSingle(onFrame, canvas);\n\n        if(preloader && preloader.preloader && preloader.preloader.classList.contains('manual')) {\n          preloader.onClick();\n        }\n      };\n\n      const onPaused = () => {\n        if(!isInDOM(globalVideo)) {\n          clear();\n          return;\n        }\n\n        divRound.classList.add('is-paused');\n      };\n\n      const onEnded = () => {\n        video.classList.remove('hide');\n        divRound.classList.add('is-paused');\n\n        video.currentTime = 0;\n        spanTime.innerText = toHHMMSS(globalVideo.duration, false);\n\n        if(globalVideo.currentTime) {\n          globalVideo.currentTime = 0;\n        }\n      };\n\n      globalVideo.addEventListener('play', onPlay);\n      globalVideo.addEventListener('timeupdate', throttledTimeUpdate);\n      globalVideo.addEventListener('pause', onPaused);\n      globalVideo.addEventListener('ended', onEnded);\n\n      attachClickEvent(canvas, (e) => {\n        cancelEvent(e);\n\n        // ! \n        if(preloader && !preloader.detached) {\n          preloader.onClick();\n        }\n\n        // ! can't use it here. on Safari iOS video won't start.\n        /* if(globalVideo.readyState < 2) {\n          return;\n        } */\n\n        if(globalVideo.paused) {\n          const hadSearchContext = !!searchContext;\n          if(appMediaPlaybackController.setSearchContext(searchContext || {\n            peerId: NULL_PEER_ID,\n            inputFilter: {_: 'inputMessagesFilterEmpty'},\n            useSearch: false\n          })) {\n            const [prev, next] = !hadSearchContext ? [] : findMediaTargets(divRound, message.mid/* , searchContext.useSearch */);\n            appMediaPlaybackController.setTargets({peerId: message.peerId, mid: message.mid}, prev, next);\n          }\n\n          globalVideo.play();\n        } else {\n          globalVideo.pause();\n        }\n      });\n\n      if(globalVideo.paused) {\n        if(globalVideo.duration && globalVideo.currentTime !== globalVideo.duration && globalVideo.currentTime > 0) {\n          onFrame();\n          onTimeUpdate();\n          video.classList.add('hide');\n        } else {\n          onPaused();\n        }\n      } else {\n        onPlay();\n      }\n    };\n\n    if(message.pFlags.is_outgoing) {\n      (divRound as any).onLoad = onLoad;\n      divRound.dataset.isOutgoing = '1';\n    } else {\n      onLoad();\n    }\n  } else {\n    video.autoplay = true; //  safari\n  }\n\n  let photoRes: Awaited<ReturnType<typeof wrapPhoto>>;\n  if(message) {\n    photoRes = await wrapPhoto({\n      photo: doc,\n      message,\n      container,\n      boxWidth,\n      boxHeight,\n      withTail,\n      isOut,\n      lazyLoadQueue,\n      middleware,\n      withoutPreloader: true,\n      loadPromises,\n      autoDownloadSize: autoDownload?.photo,\n      size: photoSize,\n      managers\n    });\n\n    res.thumb = photoRes;\n\n    if((!canAutoplay && doc.type !== 'gif') || onlyPreview) {\n      res.loadPromise = photoRes.loadPromises.full;\n      return res;\n    }\n\n    if(withTail) {\n      const foreignObject = (photoRes.images.thumb || photoRes.images.full).parentElement;\n      video.width = +foreignObject.getAttributeNS(null, 'width');\n      video.height = +foreignObject.getAttributeNS(null, 'height');\n      foreignObject.append(video);\n    }\n  } else if(!noPreview) { // * gifs masonry\n    const gotThumb = getStrippedThumbIfNeeded(doc, {} as ThumbCache, true);\n    if(gotThumb) {\n      const thumbImage = gotThumb.image;\n      thumbImage.classList.add('media-poster');\n      container.append(thumbImage);\n      res.thumb = {\n        loadPromises: {\n          thumb: gotThumb.loadPromise,\n          full: Promise.resolve()\n        },\n        images: {\n          thumb: thumbImage,\n          full: null\n        },\n        preloader: null,\n        aspecter: null\n      };\n\n      loadPromises?.push(gotThumb.loadPromise);\n      res.loadPromise = gotThumb.loadPromise;\n    }\n  }\n\n  if(onlyPreview) {\n    return res;\n  }\n\n  if(!video.parentElement && container) {\n    (photoRes?.aspecter || container).append(video);\n  }\n\n  let cacheContext: ThumbCache;\n  const getCacheContext = async() => {\n    return cacheContext = await managers.thumbsStorage.getCacheContext(doc, videoSize?.type);\n  };\n\n  await getCacheContext();\n\n  const uploadFileName = message?.uploadingFileName;\n  if(uploadFileName) { // means upload\n    preloader = new ProgressivePreloader({\n      attachMethod: 'prepend',\n      isUpload: true\n    });\n    preloader.attachPromise(appDownloadManager.getUpload(uploadFileName));\n    preloader.attach(container, false);\n    noAutoDownload = undefined;\n  } else if(!cacheContext.downloaded && !doc.supportsStreaming && !withoutPreloader) {\n    preloader = new ProgressivePreloader({\n      attachMethod: 'prepend'\n    });\n  } else if(doc.supportsStreaming) {\n    preloader = new ProgressivePreloader({\n      cancelable: false,\n      attachMethod: 'prepend'\n    });\n  }\n\n  const renderDeferred = deferredPromise<void>();\n  video.addEventListener('error', (e) => {\n    if(video.error.code !== 4) {\n      console.error('Error ' + video.error.code + '; details: ' + video.error.message);\n    }\n\n    if(preloader && !uploadFileName) {\n      preloader.detach();\n    }\n\n    if(!renderDeferred.isFulfilled) {\n      renderDeferred.resolve();\n    }\n  }, {once: true});\n\n  if(doc.type === 'video') {\n    const onTimeUpdate = () => {\n      if(!video.duration) {\n        return;\n      }\n\n      spanTime.innerText = toHHMMSS(video.duration - video.currentTime, false);\n    };\n\n    const throttledTimeUpdate = throttle(() => {\n      fastRaf(onTimeUpdate);\n    }, 1e3, false);\n\n    video.addEventListener('timeupdate', throttledTimeUpdate);\n\n    if(spanPlay) {\n      video.addEventListener('timeupdate', () => {\n        sequentialDom.mutateElement(spanPlay, () => {\n          spanPlay.remove();\n        });\n      }, {once: true});\n    }\n  }\n\n  video.muted = true;\n  video.loop = true;\n  // video.play();\n  video.autoplay = true;\n\n  let loadPhotoThumbFunc = noAutoDownload && photoRes?.preloader?.loadFunc;\n  const load = async() => {\n    if(preloader && noAutoDownload && !withoutPreloader) {\n      preloader.construct();\n      preloader.setManual();\n    }\n\n    await getCacheContext();\n    let loadPromise: Promise<any> = Promise.resolve();\n    if((preloader && !uploadFileName) || withoutPreloader) {\n      if(!cacheContext.downloaded && !doc.supportsStreaming) {\n        const promise = loadPromise = appDownloadManager.downloadMediaURL({\n          media: doc,\n          queueId: lazyLoadQueue?.queueId,\n          onlyCache: noAutoDownload,\n          thumb: videoSize\n        });\n\n        if(preloader) {\n          preloader.attach(container, false, promise);\n        }\n      } else if(doc.supportsStreaming) {\n        if(noAutoDownload) {\n          loadPromise = Promise.reject();\n        } else if(!cacheContext.downloaded && preloader) { // * check for uploading video\n          preloader.attach(container, false, null);\n          video.addEventListener(IS_SAFARI ? 'timeupdate' : 'canplay', () => {\n            preloader.detach();\n          }, {once: true});\n        }\n      }\n    }\n\n    if(!noAutoDownload && loadPhotoThumbFunc) {\n      loadPhotoThumbFunc();\n      loadPhotoThumbFunc = null;\n    }\n\n    noAutoDownload = undefined;\n\n    loadPromise.then(async() => {\n      if(middleware && !middleware()) {\n        renderDeferred.resolve();\n        return;\n      }\n\n      if(doc.type === 'round') {\n        appMediaPlaybackController.resolveWaitingForLoadMedia(message.peerId, message.mid, message.pFlags.is_scheduled);\n      }\n\n      await getCacheContext();\n\n      onMediaLoad(video).then(() => {\n        if(group) {\n          animationIntersector.addAnimation(video, group);\n        }\n\n        if(preloader && !uploadFileName) {\n          preloader.detach();\n        }\n\n        renderDeferred.resolve();\n      });\n\n      renderImageFromUrl(video, cacheContext.url);\n    }, noop);\n\n    return {download: loadPromise, render: renderDeferred};\n  };\n\n  if(preloader && !uploadFileName) {\n    preloader.setDownloadFunction(load);\n  }\n\n  /* if(doc.size >= 20e6 && !doc.downloaded) {\n    let downloadDiv = document.createElement('div');\n    downloadDiv.classList.add('download');\n\n    let span = document.createElement('span');\n    span.classList.add('btn-circle', 'tgico-download');\n    downloadDiv.append(span);\n\n    downloadDiv.addEventListener('click', () => {\n      downloadDiv.remove();\n      loadVideo();\n    });\n\n    container.prepend(downloadDiv);\n\n    return;\n  } */\n\n  if(doc.type === 'gif' && !canAutoplay) {\n    attachClickEvent(container, (e) => {\n      cancelEvent(e);\n      spanPlay.remove();\n      load();\n    }, {capture: true, once: true});\n  } else {\n    res.loadPromise = !lazyLoadQueue ?\n      (await load()).render :\n      (lazyLoadQueue.push({div: container, load: () => load().then(({render}) => render)}), Promise.resolve());\n  }\n\n  if(res.thumb) {\n    await res.thumb.loadPromises.thumb;\n  }\n\n  return res;\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport {ChatAutoDownloadSettings} from '../../helpers/autoDownload';\nimport mediaSizes from '../../helpers/mediaSizes';\nimport {Middleware} from '../../helpers/middleware';\nimport {Message, PhotoSize} from '../../layer';\nimport {AppManagers} from '../../lib/appManagers/managers';\nimport getMediaFromMessage from '../../lib/appManagers/utils/messages/getMediaFromMessage';\nimport choosePhotoSize from '../../lib/appManagers/utils/photos/choosePhotoSize';\nimport rootScope from '../../lib/rootScope';\nimport Chat from '../chat/chat';\nimport LazyLoadQueue from '../lazyLoadQueue';\nimport prepareAlbum from '../prepareAlbum';\nimport wrapPhoto from './photo';\nimport wrapVideo from './video';\n\nexport default function wrapAlbum({messages, attachmentDiv, middleware, uploading, lazyLoadQueue, isOut, chat, loadPromises, autoDownload, managers = rootScope.managers}: {\n  messages: Message.message[],\n  attachmentDiv: HTMLElement,\n  middleware?: Middleware,\n  lazyLoadQueue?: LazyLoadQueue,\n  uploading?: boolean,\n  isOut: boolean,\n  chat: Chat,\n  loadPromises?: Promise<any>[],\n  autoDownload?: ChatAutoDownloadSettings,\n  managers?: AppManagers\n}) {\n  const items: {size: PhotoSize.photoSize, media: any, message: any}[] = [];\n\n  // !lowest msgID will be the FIRST in album\n  for(const message of messages) {\n    const media = getMediaFromMessage(message);\n\n    const size: any = media._ === 'photo' ? choosePhotoSize(media, 480, 480) : {w: media.w, h: media.h};\n    items.push({size, media, message});\n  }\n\n  /* // * pending\n  if(storage[0] < 0) {\n    items.reverse();\n  } */\n\n  prepareAlbum({\n    container: attachmentDiv,\n    items: items.map((i) => ({w: i.size.w, h: i.size.h})),\n    maxWidth: mediaSizes.active.album.width,\n    minWidth: 100,\n    spacing: 2,\n    forMedia: true\n  });\n\n  items.forEach((item, idx) => {\n    const {size, media, message} = item;\n\n    const div = attachmentDiv.children[idx] as HTMLElement;\n    div.dataset.mid = '' + message.mid;\n    div.dataset.peerId = '' + message.peerId;\n    const mediaDiv = div.firstElementChild as HTMLElement;\n    const isPhoto = media._ === 'photo';\n    let thumbPromise: Promise<any>;\n    if(isPhoto) {\n      thumbPromise = wrapPhoto({\n        photo: media,\n        message,\n        container: mediaDiv,\n        boxWidth: 0,\n        boxHeight: 0,\n        isOut,\n        lazyLoadQueue,\n        middleware,\n        size,\n        loadPromises,\n        autoDownloadSize: autoDownload.photo,\n        managers\n      });\n    } else {\n      thumbPromise = wrapVideo({\n        doc: message.media.document,\n        container: mediaDiv,\n        message,\n        boxWidth: 0,\n        boxHeight: 0,\n        withTail: false,\n        isOut,\n        lazyLoadQueue,\n        middleware,\n        loadPromises,\n        autoDownload,\n        managers\n      });\n    }\n\n    if(thumbPromise && loadPromises) {\n      loadPromises.push(thumbPromise);\n    }\n  });\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport MEDIA_MIME_TYPES_SUPPORTED from '../../environment/mediaMimeTypesSupport';\nimport {CancellablePromise} from '../../helpers/cancellablePromise';\nimport {clearBadCharsAndTrim} from '../../helpers/cleanSearchText';\nimport {formatFullSentTime} from '../../helpers/date';\nimport {simulateClickEvent, attachClickEvent} from '../../helpers/dom/clickEvent';\nimport replaceContent from '../../helpers/dom/replaceContent';\nimport formatBytes from '../../helpers/formatBytes';\nimport {MediaSizeType} from '../../helpers/mediaSizes';\nimport noop from '../../helpers/noop';\nimport {Message, MessageMedia, WebPage} from '../../layer';\nimport {MyDocument} from '../../lib/appManagers/appDocsManager';\nimport appDownloadManager, {Progress} from '../../lib/appManagers/appDownloadManager';\nimport appImManager from '../../lib/appManagers/appImManager';\nimport {AppManagers} from '../../lib/appManagers/managers';\nimport getDownloadMediaDetails from '../../lib/appManagers/utils/download/getDownloadMediaDetails';\nimport choosePhotoSize from '../../lib/appManagers/utils/photos/choosePhotoSize';\nimport {joinElementsWith} from '../../lib/langPack';\nimport {MAX_FILE_SAVE_SIZE} from '../../lib/mtproto/mtproto_config';\nimport wrapPlainText from '../../lib/richTextProcessor/wrapPlainText';\nimport rootScope from '../../lib/rootScope';\nimport type {ThumbCache} from '../../lib/storages/thumbs';\nimport {MediaSearchContext} from '../appMediaPlaybackController';\nimport AudioElement from '../audio';\nimport LazyLoadQueue from '../lazyLoadQueue';\nimport {MiddleEllipsisElement} from '../middleEllipsis';\nimport ProgressivePreloader from '../preloader';\nimport wrapPhoto from './photo';\nimport wrapSenderToPeer from './senderToPeer';\nimport wrapSentTime from './sentTime';\n\nrootScope.addEventListener('document_downloading', (docId) => {\n  const elements = Array.from(document.querySelectorAll(`.document[data-doc-id=\"${docId}\"]`)) as HTMLElement[];\n  elements.forEach((element) => {\n    if(element.querySelector('.preloader-container.manual')) {\n      simulateClickEvent(element);\n    }\n  });\n});\n\nexport default async function wrapDocument({message, withTime, fontWeight, voiceAsMusic, showSender, searchContext, loadPromises, autoDownloadSize, lazyLoadQueue, sizeType, managers = rootScope.managers, cacheContext}: {\n  message: Message.message,\n  withTime?: boolean,\n  fontWeight?: number,\n  voiceAsMusic?: boolean,\n  showSender?: boolean,\n  searchContext?: MediaSearchContext,\n  loadPromises?: Promise<any>[],\n  autoDownloadSize?: number,\n  lazyLoadQueue?: LazyLoadQueue,\n  sizeType?: MediaSizeType,\n  managers?: AppManagers,\n  cacheContext?: ThumbCache\n}): Promise<HTMLElement> {\n  if(!fontWeight) fontWeight = 500;\n  if(!sizeType) sizeType = '' as any;\n  const noAutoDownload = autoDownloadSize === 0;\n\n  const doc = ((message.media as MessageMedia.messageMediaDocument).document || ((message.media as MessageMedia.messageMediaWebPage).webpage as WebPage.webPage).document) as MyDocument;\n  const uploadFileName = message?.uploadingFileName;\n  if(doc.type === 'audio' || doc.type === 'voice' || doc.type === 'round') {\n    const audioElement = new AudioElement();\n    audioElement.withTime = withTime;\n    audioElement.message = message;\n    audioElement.noAutoDownload = noAutoDownload;\n    audioElement.lazyLoadQueue = lazyLoadQueue;\n    audioElement.loadPromises = loadPromises;\n\n    if(voiceAsMusic) audioElement.voiceAsMusic = voiceAsMusic;\n    if(searchContext) audioElement.searchContext = searchContext;\n    if(showSender) audioElement.showSender = showSender;\n\n    audioElement.dataset.fontWeight = '' + fontWeight;\n    audioElement.dataset.sizeType = sizeType;\n    await audioElement.render();\n    return audioElement;\n  }\n\n  const extSplitted = doc.file_name ? doc.file_name.split('.') : '';\n  let ext = '';\n  ext = extSplitted.length > 1 && Array.isArray(extSplitted) ?\n    clearBadCharsAndTrim(extSplitted.pop().split(' ', 1)[0].toLowerCase()) :\n    'file';\n\n  const docDiv = document.createElement('div');\n  docDiv.classList.add('document', `ext-${ext}`);\n  docDiv.dataset.docId = '' + doc.id;\n  (docDiv as any).doc = doc;\n\n  // return docDiv;\n\n  const icoDiv = document.createElement('div');\n  icoDiv.classList.add('document-ico');\n  let icoTextEl: HTMLElement;\n\n  const hadContext = !!cacheContext;\n  const getCacheContext = () => {\n    return hadContext ? cacheContext : managers.thumbsStorage.getCacheContext(doc);\n  };\n\n  cacheContext = await getCacheContext();\n  let hasThumb = false;\n  if((doc.thumbs?.length || (message.pFlags.is_outgoing && cacheContext.url && doc.type === 'photo'))/*  && doc.mime_type !== 'image/gif' */) {\n    docDiv.classList.add('document-with-thumb');\n    hasThumb = true;\n\n    const imgs: (HTMLImageElement | HTMLCanvasElement | HTMLVideoElement)[] = [];\n    // ! WARNING, use thumbs for check when thumb will be generated for media\n    if(message.pFlags.is_outgoing && ['photo', 'video'].includes(doc.type)) {\n      icoDiv.innerHTML = `<img src=\"${cacheContext.url}\">`;\n      imgs.push(icoDiv.firstElementChild as HTMLImageElement);\n    } else {\n      const perf = performance.now();\n      const wrapped = await wrapPhoto({\n        photo: doc,\n        message: null,\n        container: icoDiv,\n        boxWidth: 54,\n        boxHeight: 54,\n        loadPromises,\n        withoutPreloader: true,\n        lazyLoadQueue,\n        size: choosePhotoSize(doc, 54, 54, true),\n        managers\n      });\n      // console.log('was wrapping photo', performance.now() - perf);\n      icoDiv.style.width = icoDiv.style.height = '';\n      if(wrapped.images.thumb) imgs.push(wrapped.images.thumb);\n      if(wrapped.images.full) imgs.push(wrapped.images.full);\n    }\n\n    imgs.forEach((img) => img.classList.add('document-thumb'));\n  } else {\n    icoTextEl = document.createElement('span');\n    icoTextEl.classList.add('document-ico-text');\n    icoTextEl.innerText = ext;\n    icoDiv.append(icoTextEl);\n  }\n\n  // let fileName = stringMiddleOverflow(doc.file_name || 'Unknown.file', 26);\n  const fileName = doc.file_name ? wrapPlainText(doc.file_name) : 'Unknown.file';\n  const descriptionEl = document.createElement('div');\n  descriptionEl.classList.add('document-description');\n  const bytesContainer = document.createElement('span');\n  const bytesEl = formatBytes(doc.size);\n  const bytesJoiner = ' / ';\n\n  const descriptionParts: (HTMLElement | string | DocumentFragment)[] = [bytesEl];\n\n  if(withTime) {\n    descriptionParts.push(formatFullSentTime(message.date));\n  }\n\n  if(showSender) {\n    descriptionParts.push(await wrapSenderToPeer(message));\n  }\n\n  if(!withTime && !showSender) {\n    const b = document.createElement('span');\n    const bytesMaxEl = formatBytes(doc.size);\n    b.append(bytesJoiner, bytesMaxEl);\n    b.style.visibility = 'hidden';\n    descriptionParts.push(b);\n  }\n\n  docDiv.innerHTML = `\n  ${(cacheContext.downloaded && !uploadFileName) || !message.mid || !hasThumb ? '' : `<div class=\"document-download\"></div>`}\n  <div class=\"document-name\"></div>\n  <div class=\"document-size\"></div>\n  `;\n\n  const nameDiv = docDiv.querySelector('.document-name') as HTMLElement;\n  const middleEllipsisEl = new MiddleEllipsisElement();\n  middleEllipsisEl.dataset.fontWeight = '' + fontWeight;\n  middleEllipsisEl.dataset.sizeType = sizeType;\n  middleEllipsisEl.textContent = fileName;\n  // setInnerHTML(middleEllipsisEl, fileName);\n\n  // * new media popup\n  if(!message.mid) {\n    docDiv.classList.add('downloaded');\n  }\n\n  nameDiv.append(middleEllipsisEl);\n\n  if(showSender) {\n    nameDiv.append(wrapSentTime(message));\n  }\n\n  const sizeDiv = docDiv.querySelector('.document-size') as HTMLElement;\n  bytesContainer.append(...joinElementsWith(descriptionParts, '  '));\n  sizeDiv.append(bytesContainer);\n\n  docDiv.prepend(icoDiv);\n\n  if(!uploadFileName && message.pFlags.is_outgoing && !message.mid) {\n    return docDiv;\n  }\n\n  let downloadDiv: HTMLElement, preloader: ProgressivePreloader = null;\n  const onLoad = () => {\n    docDiv.classList.remove('downloading');\n\n    if(/* !hasThumb ||  */(doc.size > MAX_FILE_SAVE_SIZE && !uploadFileName)) {\n      preloader.setManual();\n      preloader.attach(downloadDiv);\n      preloader.preloader.classList.add('manual');\n      preloader.setDownloadFunction(load);\n      return;\n    }\n\n    if(doc.size <= MAX_FILE_SAVE_SIZE) {\n      docDiv.classList.add('downloaded');\n    }\n\n    if(downloadDiv) {\n      if(downloadDiv !== icoDiv) {\n        const _downloadDiv = downloadDiv;\n        setTimeout(() => {\n          _downloadDiv.remove();\n        }, 200);\n      }\n\n      downloadDiv = null;\n    }\n\n    if(preloader) {\n      preloader = null;\n    }\n  };\n\n  const addByteProgress = (promise: CancellablePromise<any>) => {\n    docDiv.classList.add('downloading');\n\n    const sizeContainer = document.createElement('span');\n    const _bytesContainer = formatBytes(doc.size);\n    sizeContainer.style.position = 'absolute';\n    sizeContainer.style.left = '0';\n    promise.then(onLoad, noop).finally(() => {\n      // sizeContainer.replaceWith(bytesContainer);\n      bytesContainer.style.visibility = '';\n      sizeContainer.remove();\n      // b && b.classList.remove('hide');\n    });\n\n    // b && b.classList.add('hide');\n\n    const format = (bytes: number) => formatBytes(bytes);\n    let d = format(0);\n    bytesContainer.style.visibility = 'hidden';\n    // bytesContainer.replaceWith(sizeContainer);\n    sizeContainer.append(d, bytesJoiner, _bytesContainer);\n    bytesContainer.parentElement.append(sizeContainer);\n    promise.addNotifyListener((progress: Progress) => {\n      const _d = format(progress.done);\n      d.replaceWith(_d);\n      d = _d;\n    });\n  };\n\n  // ! DO NOT USE ASYNC/AWAIT HERE ! SAFARI WON'T LET DOWNLOAD THE FILE BECAUSE OF ASYNC\n  const load = (e?: Event) => {\n    const save = !e || e.isTrusted;\n    const doc = (docDiv as any).doc;\n    // const doc = await managers.appDocsManager.getDoc(docDiv.dataset.docId);\n    let download: CancellablePromise<any>;\n    const queueId = appImManager.chat.bubbles ? appImManager.chat.bubbles.lazyLoadQueue.queueId : undefined;\n    if(!save) {\n      download = appDownloadManager.downloadToDisc({media: doc, queueId}, true);\n    } else if(doc.type === 'pdf') {\n      const canOpenAfter = /* managers.appDocsManager.downloading.has(doc.id) ||  */!preloader || preloader.detached;\n      download = appDownloadManager.downloadMediaURL({media: doc, queueId});\n      if(canOpenAfter) {\n        download.then(() => {\n          setTimeout(async() => { // wait for preloader animation end\n            const url = (await getCacheContext()).url;\n            window.open(url);\n          }, rootScope.settings.animationsEnabled ? 250 : 0);\n        });\n      }\n    } else if(MEDIA_MIME_TYPES_SUPPORTED.has(doc.mime_type) && doc.thumbs?.length) {\n      download = appDownloadManager.downloadMediaURL({media: doc, queueId});\n    } else {\n      download = appDownloadManager.downloadToDisc({media: doc, queueId});\n    }\n\n    download.catch(() => {\n      docDiv.classList.remove('downloading');\n    });\n\n    if(downloadDiv) {\n      preloader.attach(downloadDiv, true, download);\n      addByteProgress(download);\n    }\n  };\n\n  const {fileName: downloadFileName} = getDownloadMediaDetails({media: doc, downloadId: '1'});\n  if(await managers.apiFileManager.isDownloading(downloadFileName)) {\n    downloadDiv = docDiv.querySelector('.document-download') || icoDiv;\n    const promise = appDownloadManager.downloadToDisc({media: doc}, true);\n\n    preloader = new ProgressivePreloader();\n    preloader.attach(downloadDiv, false, promise);\n    preloader.setDownloadFunction(load);\n    addByteProgress(promise);\n  } else if(!cacheContext.downloaded || uploadFileName) {\n    downloadDiv = docDiv.querySelector('.document-download') || icoDiv;\n    preloader = new ProgressivePreloader({\n      isUpload: !!uploadFileName\n    });\n\n    if(!uploadFileName) {\n      preloader.construct();\n      preloader.setManual();\n      preloader.attach(downloadDiv);\n      preloader.setDownloadFunction(load);\n\n      if(autoDownloadSize !== undefined && autoDownloadSize >= doc.size) {\n        simulateClickEvent(preloader.preloader);\n      }\n    } else {\n      const uploadPromise = appDownloadManager.getUpload(uploadFileName);\n      preloader.attachPromise(uploadPromise);\n      preloader.attach(downloadDiv);\n      addByteProgress(uploadPromise);\n    }\n  }\n\n  attachClickEvent(docDiv, (e) => {\n    if(preloader) {\n      preloader.onClick(e);\n    } else {\n      load(e);\n    }\n  });\n\n  return docDiv;\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport setInnerHTML from '../../helpers/dom/setInnerHTML';\nimport {MediaSizeType} from '../../helpers/mediaSizes';\nimport {Message} from '../../layer';\nimport {AppManagers} from '../../lib/appManagers/managers';\nimport wrapRichText from '../../lib/richTextProcessor/wrapRichText';\nimport {MediaSearchContext} from '../appMediaPlaybackController';\nimport Chat from '../chat/chat';\nimport LazyLoadQueue from '../lazyLoadQueue';\nimport wrapDocument from './document';\n\nexport default async function wrapGroupedDocuments({albumMustBeRenderedFull, message, bubble, messageDiv, chat, loadPromises, autoDownloadSize, lazyLoadQueue, searchContext, useSearch, sizeType, managers}: {\n  albumMustBeRenderedFull: boolean,\n  message: any,\n  messageDiv: HTMLElement,\n  bubble: HTMLElement,\n  uploading?: boolean,\n  chat: Chat,\n  loadPromises?: Promise<any>[],\n  autoDownloadSize?: number,\n  lazyLoadQueue?: LazyLoadQueue,\n  searchContext?: MediaSearchContext,\n  useSearch?: boolean,\n  sizeType?: MediaSizeType,\n  managers?: AppManagers\n}) {\n  let nameContainer: HTMLElement;\n  const mids = albumMustBeRenderedFull ? await chat.getMidsByMid(message.mid) : [message.mid];\n  /* if(isPending) {\n    mids.reverse();\n  } */\n\n  const promises = mids.map(async(mid, idx) => {\n    const message = (await chat.getMessage(mid)) as Message.message;\n    const div = await wrapDocument({\n      message,\n      loadPromises,\n      autoDownloadSize,\n      lazyLoadQueue,\n      searchContext,\n      sizeType,\n      managers\n    });\n\n    const container = document.createElement('div');\n    container.classList.add('document-container');\n    container.dataset.mid = '' + mid;\n    container.dataset.peerId = '' + message.peerId;\n\n    const wrapper = document.createElement('div');\n    wrapper.classList.add('document-wrapper');\n\n    if(message.message) {\n      const messageDiv = document.createElement('div');\n      messageDiv.classList.add('document-message');\n\n      const richText = wrapRichText(message.message, {\n        entities: message.totalEntities\n      });\n\n      setInnerHTML(messageDiv, richText);\n      wrapper.append(messageDiv);\n    }\n\n    if(mids.length > 1) {\n      const selection = document.createElement('div');\n      selection.classList.add('document-selection');\n      container.append(selection);\n\n      container.classList.add('grouped-item');\n\n      if(idx === 0) {\n        nameContainer = wrapper;\n      }\n    }\n\n    wrapper.append(div);\n    container.append(wrapper);\n    return container;\n  });\n\n  const containers = await Promise.all(promises);\n  messageDiv.append(...containers);\n\n  if(mids.length > 1) {\n    bubble.classList.add('is-multiple-documents', 'is-grouped');\n  }\n\n  return nameContainer;\n}\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport {SliderSuperTab} from '../../slider';\r\nimport appSidebarRight from '..';\r\nimport {roundPercents} from '../../poll';\r\nimport appDialogsManager from '../../../lib/appManagers/appDialogsManager';\r\nimport ripple from '../../ripple';\r\nimport {i18n} from '../../../lib/langPack';\r\nimport setInnerHTML from '../../../helpers/dom/setInnerHTML';\r\nimport wrapEmojiText from '../../../lib/richTextProcessor/wrapEmojiText';\r\n\r\nexport default class AppPollResultsTab extends SliderSuperTab {\r\n  private resultsDiv: HTMLElement;\r\n\r\n  protected init() {\r\n    this.container.id = 'poll-results-container';\r\n    this.container.classList.add('chatlist-container');\r\n\r\n    this.resultsDiv = document.createElement('div');\r\n    this.resultsDiv.classList.add('poll-results');\r\n    this.scrollable.append(this.resultsDiv);\r\n  }\r\n\r\n  public async open(message: any) {\r\n    const ret = super.open();\r\n    const poll = await this.managers.appPollsManager.getPoll(message.media.poll.id);\r\n\r\n    this.setTitle(poll.poll.pFlags.quiz ? 'PollResults.Title.Quiz' : 'PollResults.Title.Poll');\r\n\r\n    const title = document.createElement('h3');\r\n    setInnerHTML(title, wrapEmojiText(poll.poll.question));\r\n\r\n    const percents = poll.results.results.map((v) => v.voters / poll.results.total_voters * 100);\r\n    roundPercents(percents);\r\n\r\n    const fragment = document.createDocumentFragment();\r\n    poll.results.results.forEach((result, idx) => {\r\n      if(!result.voters) return;\r\n\r\n      const hr = document.createElement('hr');\r\n\r\n      const answer = poll.poll.answers[idx];\r\n\r\n      // Head\r\n      const answerEl = document.createElement('div');\r\n      answerEl.classList.add('poll-results-answer');\r\n\r\n      const answerTitle = document.createElement('div');\r\n      setInnerHTML(answerTitle, wrapEmojiText(answer.text));\r\n\r\n      const answerPercents = document.createElement('div');\r\n      answerPercents.innerText = Math.round(percents[idx]) + '%';\r\n\r\n      answerEl.append(answerTitle, answerPercents);\r\n\r\n      // Humans\r\n      const list = appDialogsManager.createChatList();\r\n      list.classList.add('poll-results-voters');\r\n\r\n      appDialogsManager.setListClickListener(list, () => {\r\n        appSidebarRight.onCloseBtnClick();\r\n      }, undefined, true);\r\n\r\n      list.style.minHeight = Math.min(result.voters, 4) * 50 + 'px';\r\n\r\n      fragment.append(hr, answerEl, list);\r\n\r\n      let offset: string, limit = 4, loading = false, left = result.voters - 4;\r\n      const load = () => {\r\n        if(loading) return;\r\n        loading = true;\r\n\r\n        this.managers.appPollsManager.getVotes(message, answer.option, offset, limit).then((votesList) => {\r\n          votesList.votes.forEach((vote) => {\r\n            const {dom} = appDialogsManager.addDialogNew({\r\n              peerId: vote.user_id.toPeerId(false),\r\n              container: list,\r\n              rippleEnabled: false,\r\n              meAsSaved: false,\r\n              avatarSize: 32\r\n            });\r\n            dom.lastMessageSpan.parentElement.remove();\r\n          });\r\n\r\n          if(offset) {\r\n            left -= votesList.votes.length;\r\n            (showMore.lastElementChild as HTMLElement).replaceWith(i18n('PollResults.LoadMore', [Math.min(20, left)]));\r\n          }\r\n\r\n          offset = votesList.next_offset;\r\n          limit = 20;\r\n\r\n          if(!left || !votesList.votes.length) {\r\n            showMore.remove();\r\n          }\r\n        }).finally(() => {\r\n          loading = false;\r\n        });\r\n      };\r\n\r\n      load();\r\n\r\n      if(left <= 0) return;\r\n\r\n      const showMore = document.createElement('div');\r\n      showMore.classList.add('poll-results-more', 'show-more', 'rp-overflow');\r\n      showMore.addEventListener('click', load);\r\n      ripple(showMore);\r\n      const down = document.createElement('div');\r\n      down.classList.add('tgico-down');\r\n      showMore.append(down, i18n('PollResults.LoadMore', [Math.min(20, left)]));\r\n\r\n      fragment.append(showMore);\r\n    });\r\n\r\n    this.resultsDiv.append(title, fragment);\r\n\r\n    appSidebarRight.toggleSidebar(true).then(() => {\r\n      /* appPollsManager.getVotes(mid).then((votes) => {\r\n        console.log('gOt VotEs', votes);\r\n      }); */\r\n    });\r\n\r\n    return ret;\r\n  }\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport mediaSizes from '../helpers/mediaSizes';\r\nimport IS_TOUCH_SUPPORTED from '../environment/touchSupport';\r\nimport appImManager from '../lib/appManagers/appImManager';\r\nimport rootScope from '../lib/rootScope';\r\nimport ripple from './ripple';\r\nimport appSidebarRight from './sidebarRight';\r\nimport AppPollResultsTab from './sidebarRight/tabs/pollResults';\r\nimport {FormatterArguments, i18n, LangPackKey} from '../lib/langPack';\r\nimport {fastRaf} from '../helpers/schedulers';\r\nimport SetTransition from './singleTransition';\r\nimport findUpClassName from '../helpers/dom/findUpClassName';\r\nimport cancelEvent from '../helpers/dom/cancelEvent';\r\nimport {attachClickEvent, detachClickEvent, simulateClickEvent} from '../helpers/dom/clickEvent';\r\nimport replaceContent from '../helpers/dom/replaceContent';\r\nimport windowSize from '../helpers/windowSize';\r\nimport {Message, MessageMedia, Poll, PollResults} from '../layer';\r\nimport toHHMMSS from '../helpers/string/toHHMMSS';\r\nimport StackedAvatars from './stackedAvatars';\r\nimport setInnerHTML from '../helpers/dom/setInnerHTML';\r\nimport {AppManagers} from '../lib/appManagers/managers';\r\nimport wrapEmojiText from '../lib/richTextProcessor/wrapEmojiText';\r\nimport wrapRichText from '../lib/richTextProcessor/wrapRichText';\r\n\r\nlet lineTotalLength = 0;\r\nconst tailLength = 9;\r\nconst times = 10;\r\nconst fullTime = 340;\r\nconst oneTime = fullTime / times;\r\n\r\nexport const roundPercents = (percents: number[]) => {\r\n  // console.log('roundPercents before percents:', percents);\r\n\r\n  const sum = percents.reduce((acc, p) => acc + Math.round(p), 0);\r\n  if(sum > 100) {\r\n    const diff = sum - 100;\r\n    const length = percents.length;\r\n    for(let i = 0; i < diff; ++i) {\r\n      let minIndex = -1, minRemainder = 1;\r\n      for(let k = 0; k < length; ++k) {\r\n        const remainder = percents[k] % 1;\r\n        if(remainder >= 0.5 && remainder < minRemainder) {\r\n          minRemainder = remainder;\r\n          minIndex = k;\r\n        }\r\n      }\r\n\r\n      if(minIndex === -1) {\r\n        // throw new Error('lol chto');\r\n        return;\r\n      }\r\n\r\n      percents[minIndex] -= minRemainder;\r\n    }\r\n  } else if(sum < 100) {\r\n    const diff = 100 - sum;\r\n    const length = percents.length;\r\n    for(let i = 0; i < diff; ++i) {\r\n      let minIndex = -1, maxRemainder = 0;\r\n      for(let k = 0; k < length; ++k) {\r\n        const remainder = percents[k] % 1;\r\n        if(remainder < 0.5 && remainder > maxRemainder) {\r\n          maxRemainder = remainder;\r\n          minIndex = k;\r\n        }\r\n      }\r\n\r\n      if(minIndex === -1) {\r\n        // throw new Error('lol chto');\r\n        return;\r\n      }\r\n\r\n      percents[minIndex] += 1 - maxRemainder;\r\n    }\r\n  }\r\n\r\n  // console.log('roundPercents after percents:', percents);\r\n};\r\n\r\n/* const connectedPolls: {id: string, element: PollElement}[] = [];\r\nrootScope.on('poll_update', (e) => {\r\n  const {poll, results} = e as {poll: Poll, results: PollResults};\r\n\r\n  //console.log('poll_update', poll, results);\r\n  for(const connected of connectedPolls) {\r\n    if(connected.id === poll.id) {\r\n      const pollElement = connected.element;\r\n      pollElement.isClosed = !!poll.pFlags.closed;\r\n      pollElement.performResults(results, poll.chosenIndexes);\r\n    }\r\n  }\r\n}); */\r\n\r\nrootScope.addEventListener('poll_update', ({poll, results}) => {\r\n  const pollElements = Array.from(document.querySelectorAll(`poll-element[poll-id=\"${poll.id}\"]`)) as PollElement[];\r\n  pollElements.forEach((pollElement) => {\r\n    // console.log('poll_update', poll, results);\r\n    pollElement.isClosed = !!poll.pFlags.closed;\r\n    pollElement.performResults(results, poll.chosenIndexes);\r\n  });\r\n});\r\n\r\nmediaSizes.addEventListener('resize', () => {\r\n  PollElement.setMaxLength();\r\n  PollElement.resizePolls();\r\n});\r\n\r\nmediaSizes.addEventListener('changeScreen', () => {\r\n  PollElement.setMaxLength();\r\n});\r\n\r\nconst hideQuizHint = (element: HTMLElement, onHide: () => void, timeout: number) => {\r\n  element.classList.remove('active');\r\n\r\n  clearTimeout(timeout);\r\n  setTimeout(() => {\r\n    onHide();\r\n    element.remove();\r\n\r\n    if(prevQuizHint === element && prevQuizHintOnHide === onHide && prevQuizHintTimeout === timeout) {\r\n      prevQuizHint = prevQuizHintOnHide = null;\r\n      prevQuizHintTimeout = 0;\r\n    }\r\n  }, 200);\r\n};\r\n\r\nlet prevQuizHint: HTMLElement, prevQuizHintOnHide: () => void, prevQuizHintTimeout: number;\r\nlet isListenerSet = false;\r\nconst setQuizHint = (solution: string, solution_entities: any[], onHide: () => void) => {\r\n  if(prevQuizHint) {\r\n    hideQuizHint(prevQuizHint, prevQuizHintOnHide, prevQuizHintTimeout);\r\n  }\r\n\r\n  const element = document.createElement('div');\r\n  element.classList.add('quiz-hint');\r\n\r\n  const container = document.createElement('div');\r\n  container.classList.add('container', 'tgico');\r\n\r\n  const textEl = document.createElement('div');\r\n  textEl.classList.add('text');\r\n\r\n  container.append(textEl);\r\n  element.append(container);\r\n\r\n  setInnerHTML(textEl, wrapRichText(solution, {entities: solution_entities}));\r\n  appImManager.chat.bubbles.container.append(element);\r\n\r\n  void element.offsetLeft; // reflow\r\n  element.classList.add('active');\r\n\r\n  prevQuizHint = element;\r\n  prevQuizHintOnHide = onHide;\r\n  prevQuizHintTimeout = window.setTimeout(() => {\r\n    hideQuizHint(element, onHide, prevQuizHintTimeout);\r\n  }, IS_TOUCH_SUPPORTED ? 5000 : 7000);\r\n\r\n  if(!isListenerSet) {\r\n    isListenerSet = true;\r\n    appImManager.addEventListener('peer_changed', () => {\r\n      if(prevQuizHint) {\r\n        hideQuizHint(prevQuizHint, prevQuizHintOnHide, prevQuizHintTimeout);\r\n      }\r\n    });\r\n  }\r\n};\r\n\r\nexport default class PollElement extends HTMLElement {\r\n  public static MAX_OFFSET = -46.5;\r\n  public static MAX_LENGTH = 0;\r\n  public svgLines: SVGSVGElement[];\r\n  private numberDivs: HTMLDivElement[];\r\n  private answerDivs: HTMLDivElement[];\r\n  private descDiv: HTMLElement;\r\n  private typeDiv: HTMLElement;\r\n  private avatarsDiv: HTMLElement;\r\n  private viewResults: HTMLElement;\r\n  private votersCountDiv: HTMLDivElement;\r\n\r\n  // private maxLength: number;\r\n  // private maxLengths: number[];\r\n  private maxPercents: number[];\r\n\r\n  public isClosed = false;\r\n  private isQuiz = false;\r\n  private isRetracted = false;\r\n  private isPublic = false;\r\n  private isMultiple = false;\r\n  private chosenIndexes: number[] = [];\r\n  private percents: number[];\r\n\r\n  public message: Message.message;\r\n  public managers: AppManagers;\r\n\r\n  private quizInterval: number;\r\n  private quizTimer: SVGSVGElement;\r\n\r\n  private sendVoteBtn: HTMLElement;\r\n  private chosingIndexes: number[] = [];\r\n\r\n  private sendVotePromise: Promise<void>;\r\n  private sentVote = false;\r\n\r\n  public static setMaxLength() {\r\n    const width = windowSize.width <= 360 ? windowSize.width - 120 : mediaSizes.active.poll.width;\r\n    this.MAX_LENGTH = width + tailLength + this.MAX_OFFSET + -13.7; // 13 - position left\r\n  }\r\n\r\n  public static resizePolls() {\r\n    if(!this.MAX_LENGTH) return;\r\n    const pollElements = Array.from(document.querySelectorAll('poll-element.is-voted')) as PollElement[];\r\n    pollElements.forEach((pollElement) => {\r\n      pollElement.svgLines.forEach((svg, idx) => {\r\n        // void svg.getBoundingClientRect(); // reflow\r\n        pollElement.setLineProgress(idx, 1);\r\n      });\r\n    });\r\n  }\r\n\r\n  public async render() {\r\n    //         \r\n    // (   ,    /)\r\n\r\n    if(!lineTotalLength) {\r\n      lineTotalLength = (document.getElementById('poll-line') as any as SVGPathElement).getTotalLength();\r\n      // console.log('line total length:', lineTotalLength);\r\n      PollElement.setMaxLength();\r\n    }\r\n\r\n    // const {poll, results} = this.managers.appPollsManager.getPoll(pollId);\r\n    const {poll, results} = this.message.media as MessageMedia.messageMediaPoll;\r\n\r\n    /* const timestamp = Date.now() / 1000 | 0;\r\n    if(timestamp < this.message.date) { */\r\n    if(this.message.pFlags.is_scheduled) {\r\n      this.classList.add('disable-hover');\r\n    }\r\n\r\n    // console.log('pollElement poll:', poll, results);\r\n\r\n    let descKey: LangPackKey;\r\n    if(poll.pFlags) {\r\n      this.isPublic = !!poll.pFlags.public_voters;\r\n      this.isQuiz = !!poll.pFlags.quiz;\r\n      this.isClosed = !!poll.pFlags.closed;\r\n      this.isMultiple = !!poll.pFlags.multiple_choice;\r\n\r\n      if(this.isClosed) {\r\n        descKey = 'Chat.Poll.Type.Closed';\r\n        this.classList.add('is-closed');\r\n      } else if(this.isQuiz) {\r\n        descKey = this.isPublic ? 'Chat.Poll.Type.Quiz' : 'Chat.Poll.Type.AnonymousQuiz';\r\n      } else {\r\n        descKey = this.isPublic ? 'Chat.Poll.Type.Public' : 'Chat.Poll.Type.Anonymous';\r\n      }\r\n    }\r\n\r\n    this.classList.toggle('is-multiple', this.isMultiple);\r\n\r\n    const multipleSelect = this.isMultiple ? '<span class=\"poll-answer-selected tgico-check\"></span>' : '';\r\n    const votes = poll.answers.map((answer, idx) => {\r\n      return `\r\n        <div class=\"poll-answer\" data-index=\"${idx}\">\r\n          <div class=\"circle-hover\">\r\n            <div class=\"animation-ring\"></div>\r\n            <svg class=\"progress-ring\">\r\n              <circle class=\"progress-ring__circle\" cx=\"13\" cy=\"13\" r=\"9\"></circle>\r\n            </svg>\r\n            ${multipleSelect}\r\n          </div>\r\n          <div class=\"poll-answer-percents\"></div>\r\n          <div class=\"poll-answer-text\"></div>\r\n          <svg version=\"1.1\" class=\"poll-line\" style=\"display: none;\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" viewBox=\"0 0 485.9 35\" xml:space=\"preserve\">\r\n            <use href=\"#poll-line\"></use>\r\n          </svg>\r\n          <span class=\"poll-answer-selected tgico\"></span>\r\n        </div>\r\n      `;\r\n    }).join('');\r\n\r\n    this.innerHTML = `\r\n      <div class=\"poll-title\"></div>\r\n      <div class=\"poll-desc\">\r\n        <div class=\"poll-type\"></div>\r\n        <div class=\"poll-avatars\"></div>\r\n      </div>\r\n      ${votes}`;\r\n\r\n    setInnerHTML(this.firstElementChild, wrapEmojiText(poll.question));\r\n\r\n    Array.from(this.querySelectorAll('.poll-answer-text')).forEach((el, idx) => {\r\n      setInnerHTML(el, wrapEmojiText(poll.answers[idx].text));\r\n    });\r\n\r\n    this.descDiv = this.firstElementChild.nextElementSibling as HTMLElement;\r\n    this.typeDiv = this.descDiv.firstElementChild as HTMLElement;\r\n    this.avatarsDiv = this.descDiv.lastElementChild as HTMLElement;\r\n\r\n    if(descKey) {\r\n      this.typeDiv.append(i18n(descKey));\r\n    }\r\n\r\n    if(this.isQuiz) {\r\n      this.classList.add('is-quiz');\r\n\r\n      if(poll.close_period && poll.close_date) {\r\n        const timeLeftDiv = document.createElement('div');\r\n        timeLeftDiv.classList.add('poll-time');\r\n        this.descDiv.append(timeLeftDiv);\r\n\r\n        const svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');\r\n        // svg.setAttributeNS(null, 'viewBox', '0 0 15 15');\r\n        svg.classList.add('poll-quiz-timer');\r\n\r\n        this.quizTimer = svg;\r\n\r\n        const strokeWidth = 2;\r\n        const radius = 7;\r\n        const circumference = 2 * Math.PI * radius;\r\n\r\n        const circle = document.createElementNS('http://www.w3.org/2000/svg', 'circle');\r\n        circle.classList.add('poll-quiz-timer-circle');\r\n        circle.setAttributeNS(null, 'cx', '16');\r\n        circle.setAttributeNS(null, 'cy', '16');\r\n        circle.setAttributeNS(null, 'r', '' + radius);\r\n        circle.setAttributeNS(null, 'stroke-width', '' + strokeWidth);\r\n\r\n        svg.append(circle);\r\n        this.descDiv.append(svg);\r\n\r\n        const period = poll.close_period * 1000;\r\n        const closeTime = (poll.close_date - await rootScope.managers.timeManager.getServerTimeOffset()) * 1000;\r\n\r\n        // console.log('closeTime:', poll.close_date, serverTimeManager.serverTimeOffset, Date.now() / 1000 | 0);\r\n\r\n        // let time = Date.now();\r\n        // let percents = (closeTime - time) / period;\r\n\r\n        // timeLeftDiv.innerHTML = String((closeTime - time) / 1000 + 1 | 0).toHHMMSS();\r\n\r\n        // // @ts-ignore\r\n        // circle.style.strokeDashoffset = circumference + percents * circumference;\r\n        // circle.style.strokeDasharray = ${circumference} ${circumference};\r\n\r\n        this.quizInterval = window.setInterval(() => {\r\n          const time = Date.now();\r\n          const percents = (closeTime - time) / period;\r\n          const timeLeft = (closeTime - time) / 1000 + 1 | 0;\r\n          timeLeftDiv.innerHTML = toHHMMSS(timeLeft);\r\n\r\n          if(timeLeft <= 5) {\r\n            timeLeftDiv.style.color = '#ee545c';\r\n            circle.style.stroke = '#ee545c';\r\n          }\r\n          // timeLeftDiv.style.visibility = 'visible';\r\n\r\n          // @ts-ignore\r\n          circle.style.strokeDashoffset = circumference + percents * circumference;\r\n          circle.style.strokeDasharray = `${circumference} ${circumference}`;\r\n\r\n          if(time >= closeTime) {\r\n            clearInterval(this.quizInterval);\r\n            timeLeftDiv.innerHTML = '';\r\n            // @ts-ignore\r\n            circle.style.strokeDashoffset = circumference;\r\n            this.quizInterval = 0;\r\n\r\n            setTimeout(() => {\r\n              //      \r\n              this.managers.appPollsManager.getResults(this.message);\r\n            }, 3e3);\r\n          }\r\n        }, 1e3);\r\n      }\r\n    }\r\n\r\n    this.answerDivs = Array.from(this.querySelectorAll('.poll-answer')) as HTMLDivElement[];\r\n    this.svgLines = Array.from(this.querySelectorAll('.poll-line')) as SVGSVGElement[];\r\n    this.numberDivs = Array.from(this.querySelectorAll('.poll-answer-percents')) as HTMLDivElement[];\r\n\r\n    const footerDiv = document.createElement('div');\r\n    footerDiv.classList.add('poll-footer');\r\n\r\n    this.viewResults = document.createElement('div');\r\n    this.viewResults.className = 'poll-footer-button poll-view-results hide';\r\n    this.viewResults.append(i18n('Chat.Poll.ViewResults'));\r\n\r\n    this.votersCountDiv = document.createElement('div');\r\n    this.votersCountDiv.className = 'poll-votes-count';\r\n\r\n    footerDiv.append(this.viewResults, this.votersCountDiv);\r\n    this.append(footerDiv);\r\n\r\n    this.viewResults.addEventListener('click', (e) => {\r\n      cancelEvent(e);\r\n\r\n      if(!appSidebarRight.isTabExists(AppPollResultsTab)) {\r\n        appSidebarRight.createTab(AppPollResultsTab).open(this.message);\r\n      }\r\n    });\r\n    ripple(this.viewResults);\r\n\r\n    if(this.isMultiple) {\r\n      this.sendVoteBtn = document.createElement('div');\r\n      this.sendVoteBtn.classList.add('poll-footer-button', 'poll-send-vote');\r\n      this.sendVoteBtn.append(i18n('Chat.Poll.SubmitVote'));\r\n      ripple(this.sendVoteBtn);\r\n\r\n      if(!poll.chosenIndexes.length) {\r\n        this.votersCountDiv.classList.add('hide');\r\n      }\r\n\r\n      attachClickEvent(this.sendVoteBtn, (e) => {\r\n        cancelEvent(e);\r\n        /* const indexes = this.answerDivs.filter((el) => el.classList.contains('is-chosing')).map((el) => +el.dataset.index);\r\n        if(indexes.length) {\r\n\r\n        } */\r\n        if(this.chosingIndexes.length) {\r\n          this.sendVotes(this.chosingIndexes).then(() => {\r\n            this.chosingIndexes.length = 0;\r\n            this.answerDivs.forEach((el) => {\r\n              el.classList.remove('is-chosing');\r\n            });\r\n          });\r\n        }\r\n      });\r\n\r\n      footerDiv.append(this.sendVoteBtn);\r\n    }\r\n\r\n    // const width = this.getBoundingClientRect().width;\r\n    // const width = mediaSizes.active.poll.width;\r\n    // this.maxLength = width + tailLength + this.maxOffset + -13.7; // 13 - position left\r\n\r\n    const canVote = !(poll.chosenIndexes.length || this.isClosed);\r\n    if(!canVote || this.isPublic) {\r\n      this.performResults(results, poll.chosenIndexes, false);\r\n    }\r\n\r\n    if(canVote) {\r\n      this.setVotersCount(results);\r\n      attachClickEvent(this, this.clickHandler);\r\n    }\r\n  }\r\n\r\n  initQuizHint(results: PollResults) {\r\n    if(results.solution && results.solution_entities) {\r\n      const toggleHint = document.createElement('div');\r\n      toggleHint.classList.add('tgico-tip', 'poll-hint');\r\n      this.descDiv.append(toggleHint);\r\n\r\n      // let active = false;\r\n      attachClickEvent(toggleHint, (e) => {\r\n        cancelEvent(e);\r\n\r\n        // active = true;\r\n        toggleHint.classList.add('active');\r\n        setQuizHint(results.solution, results.solution_entities, () => {\r\n          // active = false;\r\n          toggleHint.classList.remove('active');\r\n        });\r\n      });\r\n\r\n      if(this.sentVote) {\r\n        const correctResult = results.results.find((r) => r.pFlags.correct);\r\n        if(correctResult && !correctResult.pFlags.chosen) {\r\n          simulateClickEvent(toggleHint);\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  clickHandler(e: Event) {\r\n    const target = findUpClassName(e.target, 'poll-answer') as HTMLElement;\r\n    if(!target) {\r\n      return;\r\n    }\r\n\r\n    cancelEvent(e);\r\n    const answerIndex = +target.dataset.index;\r\n    if(this.isMultiple) {\r\n      target.classList.toggle('is-chosing');\r\n\r\n      const foundIndex = this.chosingIndexes.indexOf(answerIndex);\r\n      if(foundIndex !== -1) {\r\n        this.chosingIndexes.splice(foundIndex, 1);\r\n      } else {\r\n        this.chosingIndexes.push(answerIndex);\r\n      }\r\n    } else {\r\n      this.sendVotes([answerIndex]);\r\n    }\r\n\r\n    /* target.classList.add('is-voting');\r\n    setTimeout(() => { // simulate\r\n      this.setResults([100, 0], answerIndex);\r\n      target.classList.remove('is-voting');\r\n    }, 1000); */\r\n  }\r\n\r\n  sendVotes(indexes: number[]) {\r\n    if(this.sendVotePromise) return this.sendVotePromise;\r\n\r\n    const targets = this.answerDivs.filter((_, idx) => indexes.includes(idx));\r\n    targets.forEach((target) => {\r\n      target.classList.add('is-voting');\r\n    });\r\n\r\n    this.classList.add('disable-hover');\r\n    this.sentVote = true;\r\n    return this.sendVotePromise = this.managers.appPollsManager.sendVote(this.message, indexes).then(() => {\r\n      targets.forEach((target) => {\r\n        target.classList.remove('is-voting');\r\n      });\r\n\r\n      this.classList.remove('disable-hover');\r\n    }).catch(() => {\r\n      this.sentVote = false;\r\n    }).finally(() => {\r\n      this.sendVotePromise = null;\r\n    });\r\n  }\r\n\r\n  performResults(results: PollResults, chosenIndexes: number[], animate = true) {\r\n    if(!rootScope.settings.animationsEnabled) {\r\n      animate = false;\r\n    }\r\n\r\n    if(this.isQuiz && (results.results?.length || this.isClosed)) {\r\n      this.answerDivs.forEach((el, idx) => {\r\n        el.classList.toggle('is-correct', !!results.results[idx].pFlags.correct);\r\n      });\r\n\r\n      if(this.initQuizHint) {\r\n        this.initQuizHint(results);\r\n        this.initQuizHint = null;\r\n      }\r\n\r\n      if(this.quizInterval) {\r\n        clearInterval(this.quizInterval);\r\n        this.quizInterval = 0;\r\n      }\r\n\r\n      if(this.quizTimer?.parentElement) {\r\n        this.quizTimer.remove();\r\n      }\r\n\r\n      const timeEl = this.descDiv.querySelector('.poll-time');\r\n      if(timeEl) {\r\n        timeEl.remove();\r\n      }\r\n    }\r\n\r\n    if(this.isClosed) {\r\n      this.classList.add('is-closed');\r\n      replaceContent(this.typeDiv, i18n('Chat.Poll.Type.Closed'));\r\n    }\r\n\r\n    // set chosen\r\n    if(this.chosenIndexes.length !== chosenIndexes.length || this.isClosed) { // if we voted\r\n      this.isRetracted = this.chosenIndexes.length && !chosenIndexes.length;\r\n      this.chosenIndexes = chosenIndexes.slice();\r\n\r\n      if(this.isRetracted) {\r\n        attachClickEvent(this, this.clickHandler);\r\n      } else {\r\n        detachClickEvent(this, this.clickHandler);\r\n      }\r\n    }\r\n\r\n    // is need update\r\n    if(this.chosenIndexes.length || this.isRetracted || this.isClosed) {\r\n      const percents = results.results.map((v) => results.total_voters ? v.voters / results.total_voters * 100 : 0);\r\n\r\n      this.classList.toggle('no-transition', !animate);\r\n      if(animate) {\r\n        SetTransition(this, '', !this.isRetracted, 340);\r\n      }\r\n\r\n      fastRaf(() => {\r\n        this.setResults(this.isRetracted ? this.percents : percents, this.chosenIndexes, animate);\r\n        this.percents = percents;\r\n        this.isRetracted = false;\r\n      });\r\n    }\r\n\r\n    this.setVotersCount(results);\r\n\r\n    if(this.isPublic) {\r\n      if(!this.isMultiple) {\r\n        this.viewResults.classList.toggle('hide', !results.total_voters || !this.chosenIndexes.length);\r\n        this.votersCountDiv.classList.toggle('hide', !!this.chosenIndexes.length);\r\n      }\r\n\r\n      const peerIds = (results.recent_voters || []).map((userId) => userId.toPeerId());\r\n      const stackedAvatars = new StackedAvatars({avatarSize: 16});\r\n      stackedAvatars.render(peerIds);\r\n      replaceContent(this.avatarsDiv, stackedAvatars.container);\r\n    }\r\n\r\n    if(this.isMultiple) {\r\n      const isVoted = !!this.chosenIndexes.length;\r\n\r\n      const hideSendVoteBtn = this.isClosed || isVoted;\r\n      const hideViewResultsBtn = !this.isPublic || !results.total_voters || (!isVoted && !this.isClosed);\r\n      this.sendVoteBtn.classList.toggle('hide', hideSendVoteBtn);\r\n      this.viewResults.classList.toggle('hide', hideViewResultsBtn);\r\n      this.votersCountDiv.classList.toggle('hide', !hideSendVoteBtn || !hideViewResultsBtn);\r\n    }\r\n  }\r\n\r\n  setResults(percents: number[], chosenIndexes: number[], animate: boolean) {\r\n    this.svgLines.forEach((svg) => svg.style.display = '');\r\n\r\n    this.answerDivs.forEach((el, idx) => {\r\n      el.classList.toggle('is-chosen', chosenIndexes.includes(idx));\r\n    });\r\n\r\n    const maxValue = Math.max(...percents);\r\n    // this.maxLengths = percents.map((p) => p / maxValue * this.maxLength);\r\n    this.maxPercents = percents.map((p) => p / maxValue);\r\n\r\n    // line\r\n    if(this.isRetracted) {\r\n      this.svgLines.forEach((svg, idx) => {\r\n        this.setLineProgress(idx, -1);\r\n      });\r\n    } else {\r\n      const cb = () => {\r\n        this.svgLines.forEach((svg, idx) => {\r\n          // void svg.getBoundingClientRect(); // reflow\r\n          this.setLineProgress(idx, 1);\r\n        });\r\n      };\r\n\r\n      animate ? fastRaf(cb) : cb();\r\n    }\r\n\r\n    percents = percents.slice();\r\n    roundPercents(percents);\r\n    let getPercentValue: (percents: number, index: number) => number;\r\n    const iterate = (i: number) => {\r\n      percents.forEach((percents, idx) => {\r\n        const value = getPercentValue(percents, i);\r\n        this.numberDivs[idx].innerText = value + '%';\r\n      });\r\n    };\r\n    // numbers\r\n    if(this.isRetracted) {\r\n      getPercentValue = (percents, index) => Math.round(percents / times * index);\r\n\r\n      if(animate) {\r\n        for(let i = (times - 1), k = 0; i >= 0; --i, ++k) {\r\n          setTimeout(() => {\r\n            iterate(i);\r\n          }, oneTime * k);\r\n        }\r\n      } else {\r\n        iterate(0);\r\n      }\r\n    } else {\r\n      getPercentValue = (percents, index) => Math.round(percents / times * (index + 1));\r\n\r\n      if(animate) {\r\n        for(let i = 0; i < times; ++i) {\r\n          setTimeout(() => {\r\n            iterate(i);\r\n          }, oneTime * i);\r\n        }\r\n      } else {\r\n        iterate(times - 1);\r\n      }\r\n    }\r\n\r\n    if(this.isRetracted) {\r\n      if(animate) {\r\n        this.classList.add('is-retracting');\r\n      }\r\n\r\n      this.classList.remove('is-voted');\r\n      const cb = () => {\r\n        this.svgLines.forEach((svg) => svg.style.display = 'none');\r\n      };\r\n\r\n      if(animate) {\r\n        setTimeout(() => {\r\n          this.classList.remove('is-retracting');\r\n          cb();\r\n        }, fullTime);\r\n      } else {\r\n        cb();\r\n      }\r\n    } else {\r\n      this.classList.add('is-voted');\r\n    }\r\n  }\r\n\r\n  setVotersCount(results: PollResults) {\r\n    const votersCount = results.total_voters || 0;\r\n    let key: LangPackKey;\r\n    const args: FormatterArguments = [votersCount];\r\n    if(this.isClosed) {\r\n      if(this.isQuiz) key = votersCount ? 'Chat.Quiz.TotalVotes' : 'Chat.Quiz.TotalVotesResultEmpty';\r\n      else key = votersCount ? 'Chat.Poll.TotalVotes1' : 'Chat.Poll.TotalVotesResultEmpty';\r\n    } else {\r\n      if(this.isQuiz) key = votersCount ? 'Chat.Quiz.TotalVotes' : 'Chat.Quiz.TotalVotesEmpty';\r\n      else key = votersCount ? 'Chat.Poll.TotalVotes1' : 'Chat.Poll.TotalVotesEmpty';\r\n    }\r\n\r\n    replaceContent(this.votersCountDiv, i18n(key, args));\r\n  }\r\n\r\n  setLineProgress(index: number, multiplier: number) {\r\n    const svg = this.svgLines[index];\r\n\r\n    if(multiplier === -1) {\r\n      svg.style.strokeDasharray = '';\r\n      svg.style.strokeDashoffset = '';\r\n    } else {\r\n      // svg.style.strokeDasharray = (multiplier * this.maxLengths[index]) + ', 485.9';\r\n      svg.style.strokeDasharray = (multiplier * this.maxPercents[index] * PollElement.MAX_LENGTH) + ', 485.9';\r\n      // svg.style.strokeDasharray = (multiplier * this.maxPercents[index] * 100) + '%, 485.9';\r\n      svg.style.strokeDashoffset = '' + multiplier * PollElement.MAX_OFFSET;\r\n    }\r\n  }\r\n\r\n  //         \r\n}\r\n\r\ncustomElements.define('poll-element', PollElement);\r\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport {AppManagers} from '../../lib/appManagers/managers';\nimport rootScope from '../../lib/rootScope';\nimport PollElement from '../poll';\n\nexport default function wrapPoll(message: any, managers: AppManagers = rootScope.managers) {\n  const elem = new PollElement();\n  elem.message = message;\n  elem.managers = managers;\n  elem.setAttribute('peer-id', '' + message.peerId);\n  elem.setAttribute('poll-id', message.media.poll.id);\n  elem.setAttribute('message-id', '' + message.mid);\n  elem.render();\n  return elem;\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport {hexToRgb} from '../../helpers/color';\nimport {Message} from '../../layer';\nimport getPeerColorById from '../../lib/appManagers/utils/peers/getPeerColorById';\nimport ReplyContainer from '../chat/replyContainer';\n\nexport default function wrapReply(\n  title: Parameters<ReplyContainer['fill']>[0],\n  subtitle: Parameters<ReplyContainer['fill']>[1],\n  message?: Message.message | Message.messageService,\n  setColorPeerId?: PeerId\n) {\n  const replyContainer = new ReplyContainer('reply');\n  const fillPromise = replyContainer.fill(title, subtitle, message);\n\n  if(setColorPeerId) {\n    const hex = getPeerColorById(setColorPeerId, false);\n    const [r, g, b] = hexToRgb(hex);\n    replyContainer.container.style.setProperty('--override-color', `${r}, ${g}, ${b}`);\n    replyContainer.container.classList.add('is-overriding-color');\n    // replyContainer.border.style.backgroundColor = hex;\n    // replyContainer.title.style.color = hex;\n  }\n\n  return {container: replyContainer.container, fillPromise};\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport createVideo from '../../helpers/dom/createVideo';\nimport renderImageFromUrl from '../../helpers/dom/renderImageFromUrl';\nimport {StickerSet} from '../../layer';\nimport appDownloadManager from '../../lib/appManagers/appDownloadManager';\nimport {AppManagers} from '../../lib/appManagers/managers';\nimport lottieLoader from '../../lib/rlottie/lottieLoader';\nimport rootScope from '../../lib/rootScope';\nimport animationIntersector, {AnimationItemGroup} from '../animationIntersector';\nimport LazyLoadQueue from '../lazyLoadQueue';\nimport wrapSticker from './sticker';\n\nexport default async function wrapStickerSetThumb({set, lazyLoadQueue, container, group, autoplay, width, height, managers = rootScope.managers}: {\n  set: StickerSet.stickerSet,\n  lazyLoadQueue: LazyLoadQueue,\n  container: HTMLElement,\n  group: AnimationItemGroup,\n  autoplay: boolean,\n  width: number,\n  height: number,\n  managers?: AppManagers\n}) {\n  if(set.thumbs?.length) {\n    container.classList.add('media-sticker-wrapper');\n    lazyLoadQueue.push({\n      div: container,\n      load: async() => {\n        const downloadOptions = await managers.appStickersManager.getStickerSetThumbDownloadOptions(set);\n        const promise = appDownloadManager.download(downloadOptions);\n\n        if(set.pFlags.animated && !set.pFlags.videos) {\n          return promise\n          .then((blob) => {\n            lottieLoader.loadAnimationWorker({\n              container,\n              loop: true,\n              autoplay,\n              animationData: blob,\n              width,\n              height,\n              needUpscale: true,\n              name: 'setThumb' + set.id\n            }, group);\n          });\n        } else {\n          let media: HTMLElement;\n          if(set.pFlags.videos) {\n            media = createVideo();\n            (media as HTMLVideoElement).autoplay = true;\n            (media as HTMLVideoElement).muted = true;\n            (media as HTMLVideoElement).loop = true;\n          } else {\n            media = new Image();\n          }\n\n          media.classList.add('media-sticker');\n\n          return promise.then((blob) => {\n            renderImageFromUrl(media, URL.createObjectURL(blob), () => {\n              container.append(media);\n\n              if(set.pFlags.videos) {\n                animationIntersector.addAnimation(media as HTMLVideoElement, group);\n              }\n            });\n          });\n        }\n      }\n    });\n\n    return;\n  }\n\n  const promise = managers.appStickersManager.getStickerSet(set);\n  const stickerSet = await promise;\n  if(stickerSet.documents[0]._ !== 'documentEmpty') { // as thumb will be used first sticker\n    wrapSticker({\n      doc: stickerSet.documents[0],\n      div: container,\n      group: group,\n      lazyLoadQueue,\n      managers,\n      width,\n      height\n    }); // kostil\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport {MyDocument} from '../../lib/appManagers/appDocsManager';\nimport {AppManagers} from '../../lib/appManagers/managers';\nimport Row from '../row';\nimport wrapSticker from './sticker';\n\nexport default function wrapStickerToRow({doc, row, size, managers}: {\n  doc: MyDocument,\n  row: Row,\n  size?: 'small' | 'large',\n  managers?: AppManagers\n}) {\n  const previousMedia = row.media;\n  const media = row.createMedia('small');\n\n  if(previousMedia) {\n    media.classList.add('hide');\n  }\n\n  const loadPromises: Promise<any>[] = previousMedia ? [] : undefined;\n\n  const _size = size === 'small' ? 32 : 48;\n  const result = wrapSticker({\n    div: media,\n    doc: doc,\n    width: _size,\n    height: _size,\n    loadPromises,\n    managers\n  }).then(({render}) => render);\n\n  loadPromises && Promise.all(loadPromises).then(() => {\n    media.classList.remove('hide');\n    previousMedia.remove();\n  });\n\n  return result;\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport {formatPhoneNumber} from '../../helpers/formatPhoneNumber';\n\nexport default function formatUserPhone(phone: string) {\n  return '+' + formatPhoneNumber(phone).formatted;\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport numberThousandSplitter from '../../helpers/number/numberThousandSplitter';\nimport {Chat, ChatParticipants} from '../../layer';\nimport {i18n, LangPackKey} from '../../lib/langPack';\nimport rootScope from '../../lib/rootScope';\n\nexport default async function getChatMembersString(chatId: ChatId, managers = rootScope.managers) {\n  const chat: Chat = await managers.appChatsManager.getChat(chatId);\n  if(chat._ === 'chatForbidden') {\n    return i18n('YouWereKicked');\n  }\n\n  const chatFull = await managers.appProfileManager.getCachedFullChat(chatId);\n  let count: number;\n  if(chatFull) {\n    if(chatFull._ === 'channelFull') {\n      count = chatFull.participants_count;\n    } else {\n      count = (chatFull.participants as ChatParticipants.chatParticipants).participants?.length;\n    }\n  } else {\n    count = (chat as Chat.chat).participants_count || (chat as any).participants?.participants.length;\n  }\n\n  const isBroadcast = (chat as Chat.channel).pFlags.broadcast;\n  count = count || 1;\n\n  const key: LangPackKey = isBroadcast ? 'Peer.Status.Subscribers' : 'Peer.Status.Member';\n  return i18n(key, [numberThousandSplitter(count)]);\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport limitSymbols from '../../helpers/string/limitSymbols';\nimport {Chat} from '../../layer';\nimport {AppManagers} from '../../lib/appManagers/managers';\nimport I18n from '../../lib/langPack';\nimport wrapEmojiText from '../../lib/richTextProcessor/wrapEmojiText';\nimport rootScope from '../../lib/rootScope';\n\nexport default async function getPeerTitle(peerId: PeerId, plainText: true, onlyFirstName?: boolean, _limitSymbols?: number, managers?: AppManagers): Promise<string>;\nexport default async function getPeerTitle(peerId: PeerId, plainText?: false, onlyFirstName?: boolean, _limitSymbols?: number, managers?: AppManagers): Promise<DocumentFragment>;\nexport default async function getPeerTitle(peerId: PeerId, plainText: boolean, onlyFirstName?: boolean, _limitSymbols?: number, managers?: AppManagers): Promise<DocumentFragment | string>;\nexport default async function getPeerTitle(peerId: PeerId, plainText = false, onlyFirstName = false, _limitSymbols?: number, managers: AppManagers = rootScope.managers): Promise<DocumentFragment | string> {\n  if(!peerId) {\n    peerId = rootScope.myId;\n  }\n\n  let title = '';\n  if(peerId.isUser()) {\n    const user = await managers.appUsersManager.getUser(peerId.toUserId());\n    if(user.first_name) title += user.first_name;\n    if(user.last_name && (!onlyFirstName || !title)) title += ' ' + user.last_name;\n\n    if(!title) title = user.pFlags.deleted ? I18n.format(onlyFirstName ? 'Deleted' : 'HiddenName', true) : user.username;\n    else title = title.trim();\n  } else {\n    const chat: Chat.chat = await managers.appChatsManager.getChat(peerId.toChatId());\n    title = chat.title;\n\n    if(onlyFirstName) {\n      title = title.split(' ')[0];\n    }\n  }\n\n  if(_limitSymbols !== undefined) {\n    title = limitSymbols(title, _limitSymbols, _limitSymbols);\n  }\n\n  return plainText ? title : wrapEmojiText(title);\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport {formatFullSentTimeRaw} from '../../helpers/date';\nimport {User} from '../../layer';\nimport {LangPackKey, i18n} from '../../lib/langPack';\nimport {REPLIES_PEER_ID, SERVICE_PEER_ID} from '../../lib/mtproto/mtproto_config';\n\nexport default function getUserStatusString(user: User.user): HTMLElement {\n  if(!user) {\n    return document.createElement('span');\n  }\n\n  let key: LangPackKey;\n  let args: any[];\n\n  switch(user.id) {\n    case REPLIES_PEER_ID.toUserId():\n      key = 'Peer.RepliesNotifications';\n      break;\n    case SERVICE_PEER_ID.toUserId():\n      key = 'Peer.ServiceNotifications';\n      break;\n    default: {\n      if(user.pFlags.bot) {\n        key = 'Bot';\n        break;\n      }\n\n      if(user.pFlags.support) {\n        key = 'SupportStatus';\n        break;\n      }\n\n      switch(user.status?._) {\n        case 'userStatusRecently': {\n          key = 'Lately';\n          break;\n        }\n\n        case 'userStatusLastWeek': {\n          key = 'WithinAWeek';\n          break;\n        }\n\n        case 'userStatusLastMonth': {\n          key = 'WithinAMonth';\n          break;\n        }\n\n        case 'userStatusOffline': {\n          const date = user.status.was_online;\n          const today = new Date();\n          const now = today.getTime() / 1000 | 0;\n\n          const diff = now - date;\n          if(diff < 60) {\n            key = 'Peer.Status.justNow';\n          } else if(diff < 3600) {\n            key = 'Peer.Status.minAgo';\n            const c = diff / 60 | 0;\n            args = [c];\n          } else if(diff < 86400 && today.getDate() === new Date(date * 1000).getDate()) {\n            key = 'LastSeen.HoursAgo';\n            const c = diff / 3600 | 0;\n            args = [c];\n          } else {\n            key = 'Peer.Status.LastSeenAt';\n            const {dateEl, timeEl} = formatFullSentTimeRaw(date);\n            args = [dateEl, timeEl];\n          }\n\n          break;\n        }\n\n        case 'userStatusOnline': {\n          key = 'Online';\n          break;\n        }\n\n        default: {\n          key = 'ALongTimeAgo';\n          break;\n        }\n      }\n\n      break;\n    }\n  }\n\n  return i18n(key, args);\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport {Message, MessageAction} from '../../layer';\nimport wrapUrl from '../../lib/richTextProcessor/wrapUrl';\n\nexport default function wrapJoinVoiceChatAnchor(message: Message.messageService) {\n  const action = message.action as MessageAction.messageActionInviteToGroupCall;\n  const {onclick, url} = wrapUrl(`tg://voicechat?chat_id=${message.peerId.toChatId()}&id=${action.call.id}&access_hash=${action.call.access_hash}`);\n  if(!onclick) {\n    return document.createElement('span');\n  }\n\n  const a = document.createElement('a');\n  a.href = url;\n  a.setAttribute('onclick', onclick + '(this)');\n\n  return a;\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport indexOfAndSplice from '../../helpers/array/indexOfAndSplice';\nimport {formatTime} from '../../helpers/date';\nimport htmlToSpan from '../../helpers/dom/htmlToSpan';\nimport setInnerHTML from '../../helpers/dom/setInnerHTML';\nimport formatCallDuration from '../../helpers/formatCallDuration';\nimport paymentsWrapCurrencyAmount from '../../helpers/paymentsWrapCurrencyAmount';\nimport {Message, MessageAction} from '../../layer';\nimport {MyMessage} from '../../lib/appManagers/appMessagesManager';\nimport getPeerId from '../../lib/appManagers/utils/peers/getPeerId';\nimport I18n, {FormatterArgument, FormatterArguments, i18n, join, langPack, LangPackKey, _i18n} from '../../lib/langPack';\nimport wrapEmojiText from '../../lib/richTextProcessor/wrapEmojiText';\nimport wrapPlainText from '../../lib/richTextProcessor/wrapPlainText';\nimport wrapRichText from '../../lib/richTextProcessor/wrapRichText';\nimport rootScope from '../../lib/rootScope';\nimport PeerTitle from '../peerTitle';\nimport getPeerTitle from './getPeerTitle';\nimport wrapJoinVoiceChatAnchor from './joinVoiceChatAnchor';\nimport wrapMessageForReply from './messageForReply';\n\nasync function wrapLinkToMessage(message: Message.message | Message.messageService, plain?: boolean) {\n  const a = document.createElement('i');\n  a.dataset.savedFrom = message.peerId + '_' + message.mid;\n  a.dir = 'auto';\n  a.append(await wrapMessageForReply(message, undefined, undefined, plain as any));\n  return a;\n}\n\nexport default async function wrapMessageActionTextNewUnsafe(message: MyMessage, plain?: boolean) {\n  const element: HTMLElement = plain ? undefined : document.createElement('span');\n  const action = 'action' in message && message.action;\n\n  // this.log('message action:', action);\n\n  if((action as MessageAction.messageActionCustomAction).message) {\n    const unsafeMessage = (action as MessageAction.messageActionCustomAction).message;\n    if(plain) {\n      return wrapPlainText(unsafeMessage);\n    } else {\n      setInnerHTML(element, wrapRichText(unsafeMessage, {noLinebreaks: true}));\n      return element;\n    }\n  } else {\n    let _ = action._;\n    // let suffix = '';\n    let langPackKey: LangPackKey;\n    let args: Array<FormatterArgument | Promise<FormatterArgument>>;\n\n    const managers = rootScope.managers;\n\n    const getNameDivHTML = async(peerId: PeerId, plain: boolean) => {\n      return plain ? getPeerTitle(peerId, plain) : (new PeerTitle({peerId})).element;\n    };\n\n    switch(action._) {\n      case 'messageActionPhoneCall': {\n        _ += '.' + (action as any).type;\n\n        args = [formatCallDuration(action.duration, plain)];\n        break;\n      }\n\n      case 'messageActionGroupCall': {\n        _ += '.' + (action as any).type;\n\n        args = [];\n        if(!_.endsWith('You') && !message.pFlags.post) {\n          args.push(getNameDivHTML(message.fromId, plain));\n        }\n\n        if(action.duration !== undefined) {\n          args.push(formatCallDuration(action.duration, plain));\n        } else {\n          args.push(wrapJoinVoiceChatAnchor(message as any));\n        }\n\n        break;\n      }\n\n      case 'messageActionInviteToGroupCall': {\n        const peerIds = [message.fromId, action.users[0].toPeerId()];\n        let a = 'Chat.Service.VoiceChatInvitation';\n        const myId = rootScope.myId;\n        if(peerIds[0] === myId) a += 'ByYou';\n        else if(peerIds[1] === myId) a += 'ForYou';\n        indexOfAndSplice(peerIds, myId);\n\n        langPackKey = a as LangPackKey;\n        args = peerIds.map((peerId) => getNameDivHTML(peerId, plain));\n        args.push(wrapJoinVoiceChatAnchor(message as any));\n        break;\n      }\n\n      case 'messageActionGroupCallScheduled': {\n        const today = new Date();\n        const date = new Date(action.schedule_date * 1000);\n        const daysToStart = (date.getTime() - today.getTime()) / 86400e3;\n        const tomorrowDate = new Date(today);\n        tomorrowDate.setDate(tomorrowDate.getDate() + 1);\n\n        const isBroadcast = await managers.appPeersManager.isBroadcast(message.peerId);\n        langPackKey = isBroadcast ? 'ChatList.Service.VoiceChatScheduled.Channel' : 'ChatList.Service.VoiceChatScheduled';\n        args = [];\n        const myId = rootScope.myId;\n        if(message.fromId === myId) {\n          langPackKey += 'You';\n        } else if(!isBroadcast) {\n          args.push(getNameDivHTML(message.fromId, plain));\n        }\n\n        let k: LangPackKey;\n        const _args: FormatterArguments = [];\n        if(daysToStart < 1 && date.getDate() === today.getDate()) {\n          k = 'TodayAtFormattedWithToday';\n        } else if(daysToStart < 2 && date.getDate() === tomorrowDate.getDate()) {\n          k = 'Time.TomorrowAt';\n        } else {\n          k = 'formatDateAtTime';\n          _args.push(new I18n.IntlDateElement({\n            date,\n            options: {\n              day: '2-digit',\n              month: '2-digit',\n              year: '2-digit'\n            }\n          }).element);\n        }\n\n        _args.push(formatTime(date));\n        const t = i18n(k, _args);\n        args.push(t);\n\n        break;\n      }\n\n      case 'messageActionChatCreate': {\n        const myId = rootScope.myId;\n        if(message.fromId === myId) {\n          _ += 'You';\n        } else {\n          args = [getNameDivHTML(message.fromId, plain)];\n        }\n\n        break;\n      }\n\n      case 'messageActionPinMessage': {\n        const peerId = message.peerId;\n        const pinnedMessage = await managers.appMessagesManager.getMessageByPeer(peerId, message.reply_to_mid);\n\n        args = [\n          getNameDivHTML(message.fromId, plain)\n        ];\n\n        if(!pinnedMessage/*  || true */) {\n          langPackKey = 'ActionPinnedNoText';\n\n          if(message.reply_to_mid) { // refresh original message\n            managers.appMessagesManager.fetchMessageReplyTo(message);\n          }\n        } else {\n          args.push(wrapLinkToMessage(pinnedMessage, plain));\n        }\n\n        break;\n      }\n\n      case 'messageActionChatJoinedByRequest': {\n        const isBroadcast = await managers.appPeersManager.isBroadcast(message.peerId);\n        if(message.pFlags.out) {\n          langPackKey = isBroadcast ? 'RequestToJoinChannelApproved' : 'RequestToJoinGroupApproved';\n        } else {\n          langPackKey = isBroadcast ? 'ChatService.UserJoinedChannelByRequest' : 'ChatService.UserJoinedGroupByRequest';\n          args = [getNameDivHTML(message.fromId, plain)];\n        }\n        break;\n      }\n\n      case 'messageActionContactSignUp':\n      case 'messageActionChatReturn':\n      case 'messageActionChatLeave':\n      case 'messageActionChatJoined':\n      case 'messageActionChatEditPhoto':\n      case 'messageActionChatDeletePhoto':\n      case 'messageActionChatEditVideo':\n      case 'messageActionChatJoinedByLink':\n      case 'messageActionChannelEditVideo':\n      case 'messageActionChannelDeletePhoto': {\n        args = [getNameDivHTML(message.fromId, plain)];\n        break;\n      }\n\n      case 'messageActionChannelEditTitle':\n      case 'messageActionChatEditTitle': {\n        args = [];\n        if(action._ === 'messageActionChatEditTitle') {\n          args.push(getNameDivHTML(message.fromId, plain));\n        }\n\n        args.push(plain ? action.title : htmlToSpan(wrapEmojiText(action.title)));\n        break;\n      }\n\n      case 'messageActionChatDeleteUser':\n      case 'messageActionChatAddUsers':\n      case 'messageActionChatAddUser': {\n        const users = (action as MessageAction.messageActionChatAddUser).users ||\n          [(action as MessageAction.messageActionChatDeleteUser).user_id];\n\n        args = [getNameDivHTML(message.fromId, plain)];\n\n        if(users.length > 1) {\n          const joined = join(\n            await Promise.all(users.map((userId: UserId) => getNameDivHTML(userId.toPeerId(), plain))),\n            false,\n            plain\n          );\n\n          if(plain) {\n            args.push(...joined);\n          } else {\n            const fragment = document.createElement('span');\n            fragment.append(...joined);\n            args.push(fragment);\n          }\n        } else {\n          args.push(getNameDivHTML(users[0].toPeerId(), plain));\n        }\n\n        break;\n      }\n\n      case 'messageActionBotAllowed': {\n        const anchorHTML = wrapRichText(action.domain, {\n          entities: [{\n            _: 'messageEntityUrl',\n            length: action.domain.length,\n            offset: 0\n          }]\n        });\n\n        const node = htmlToSpan(anchorHTML);\n\n        args = [node];\n        break;\n      }\n\n      case 'messageActionPaymentSent': {\n        const isRecurringInit = action.pFlags.recurring_init;\n        const isRecurringUsed = action.pFlags.recurring_used;\n        langPackKey = isRecurringUsed ? 'Chat.Service.PaymentSentRecurringUsedNoTitle' : (isRecurringInit ? 'Chat.Service.PaymentSentRecurringInitNoTitle' : 'Chat.Service.PaymentSent1NoTitle');\n        const price = paymentsWrapCurrencyAmount(action.total_amount, action.currency);\n        args = [price, getNameDivHTML(message.peerId, plain)];\n\n        if(message.reply_to_mid) {\n          const invoiceMessage = await managers.appMessagesManager.getMessageByPeer(\n            message.reply_to?.reply_to_peer_id ? getPeerId(message.reply_to.reply_to_peer_id) : message.peerId,\n            message.reply_to_mid\n          );\n\n          if(!invoiceMessage) {\n            managers.appMessagesManager.fetchMessageReplyTo(message);\n          } else {\n            langPackKey = isRecurringUsed ? 'Chat.Service.PaymentSentRecurringUsed' : (isRecurringInit ? 'Chat.Service.PaymentSentRecurringInit' : 'Chat.Service.PaymentSent1');\n            args.push(wrapLinkToMessage(invoiceMessage, plain).then((el) => {\n              el.classList.add('is-receipt-link');\n              return el;\n            }));\n          }\n        }\n\n        break;\n      }\n\n      default:\n        langPackKey = (langPack[_] || `[${action._}]`) as any;\n        break;\n    }\n\n    if(!langPackKey) {\n      langPackKey = langPack[_];\n      if(langPackKey === undefined) {\n        langPackKey = '[' + _ + ']' as any;\n      }\n    }\n\n    const waited = args && await Promise.all(args);\n\n    if(plain) {\n      return I18n.format(langPackKey, true, waited);\n    } else {\n      return _i18n(element, langPackKey, waited);\n    }\n\n    // str = !langPackKey || langPackKey[0].toUpperCase() === langPackKey[0] ? langPackKey : getNameDivHTML(message.fromId) + langPackKey + (suffix ? ' ' : '');\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport {MyMessage} from '../../lib/appManagers/appMessagesManager';\nimport wrapMessageActionTextNewUnsafe from './messageActionTextNewUnsafe';\n\nexport default async function wrapMessageActionTextNew(message: MyMessage, plain: true): Promise<string>;\nexport default async function wrapMessageActionTextNew(message: MyMessage, plain?: false): Promise<HTMLElement>;\nexport default async function wrapMessageActionTextNew(message: MyMessage, plain: boolean): Promise<HTMLElement | string>;\nexport default async function wrapMessageActionTextNew(message: MyMessage, plain?: boolean): Promise<HTMLElement | string> {\n  try {\n    return await wrapMessageActionTextNewUnsafe(message, plain);\n  } catch(err) {\n    console.error('wrapMessageActionTextNewUnsafe error:', err);\n    return plain ? '' : document.createElement('span');\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport assumeType from '../../helpers/assumeType';\nimport htmlToDocumentFragment from '../../helpers/dom/htmlToDocumentFragment';\nimport {getRestrictionReason} from '../../helpers/restrictions';\nimport escapeRegExp from '../../helpers/string/escapeRegExp';\nimport limitSymbols from '../../helpers/string/limitSymbols';\nimport {Message, DocumentAttribute} from '../../layer';\nimport {MyDocument} from '../../lib/appManagers/appDocsManager';\nimport {MyDraftMessage} from '../../lib/appManagers/appDraftsManager';\nimport {MyMessage} from '../../lib/appManagers/appMessagesManager';\nimport isMessageRestricted from '../../lib/appManagers/utils/messages/isMessageRestricted';\nimport I18n, {LangPackKey, i18n, UNSUPPORTED_LANG_PACK_KEY} from '../../lib/langPack';\nimport sortEntities from '../../lib/richTextProcessor/sortEntities';\nimport wrapEmojiText from '../../lib/richTextProcessor/wrapEmojiText';\nimport wrapPlainText from '../../lib/richTextProcessor/wrapPlainText';\nimport wrapRichText from '../../lib/richTextProcessor/wrapRichText';\nimport rootScope from '../../lib/rootScope';\nimport wrapMessageActionTextNew from './messageActionTextNew';\n\nexport default async function wrapMessageForReply(message: MyMessage | MyDraftMessage, text: string, usingMids: number[], plain: true, highlightWord?: string, withoutMediaType?: boolean): Promise<string>;\nexport default async function wrapMessageForReply(message: MyMessage | MyDraftMessage, text?: string, usingMids?: number[], plain?: false, highlightWord?: string, withoutMediaType?: boolean): Promise<DocumentFragment>;\nexport default async function wrapMessageForReply(message: MyMessage | MyDraftMessage, text: string = (message as Message.message).message, usingMids?: number[], plain?: boolean, highlightWord?: string, withoutMediaType?: boolean): Promise<DocumentFragment | string> {\n  const parts: (Node | string)[] = [];\n\n  let hasAlbumKey = false;\n  const addPart = (langKey: LangPackKey, part?: string | HTMLElement | DocumentFragment) => {\n    if(langKey) {\n      if(part === undefined && hasAlbumKey) {\n        return;\n      }\n\n      part = plain ? I18n.format(langKey, true) : i18n(langKey);\n    }\n\n    if(plain) {\n      parts.push(part);\n    } else {\n      const el = document.createElement('i');\n      if(typeof(part) === 'string') el.innerHTML = part;\n      else el.append(part);\n      parts.push(el);\n    }\n  };\n\n  const managers = rootScope.managers;\n  const appMessagesManager = managers.appMessagesManager;\n\n  const isRestricted = isMessageRestricted(message as any);\n\n  let entities = (message as Message.message).totalEntities;\n  if((message as Message.message).media && !isRestricted) {\n    assumeType<Message.message>(message);\n    let usingFullAlbum = true;\n    if(message.grouped_id) {\n      if(usingMids) {\n        const mids = await appMessagesManager.getMidsByMessage(message);\n        if(usingMids.length === mids.length) {\n          for(const mid of mids) {\n            if(!usingMids.includes(mid)) {\n              usingFullAlbum = false;\n              break;\n            }\n          }\n        } else {\n          usingFullAlbum = false;\n        }\n      }\n\n      if(usingFullAlbum) {\n        const albumText = await appMessagesManager.getAlbumText(message.grouped_id);\n        text = albumText.message;\n        entities = albumText.totalEntities;\n\n        if(!withoutMediaType) {\n          addPart('AttachAlbum');\n          hasAlbumKey = true;\n        }\n      }\n    } else {\n      usingFullAlbum = false;\n    }\n\n    if((!usingFullAlbum && !withoutMediaType) || !text) {\n      const media = message.media;\n      switch(media._) {\n        case 'messageMediaPhoto':\n          addPart('AttachPhoto');\n          break;\n        case 'messageMediaDice':\n          addPart(undefined, plain ? media.emoticon : wrapEmojiText(media.emoticon));\n          break;\n        case 'messageMediaVenue': {\n          text = media.title;\n          addPart('AttachLocation');\n          break;\n        }\n        case 'messageMediaGeo':\n          addPart('AttachLocation');\n          break;\n        case 'messageMediaGeoLive':\n          addPart('AttachLiveLocation');\n          break;\n        case 'messageMediaPoll':\n          const f = '' + ' ' + (media.poll.question || 'poll');\n          addPart(undefined, plain ? f : wrapEmojiText(f));\n          break;\n        case 'messageMediaContact':\n          addPart('AttachContact');\n          break;\n        case 'messageMediaGame': {\n          const f = '' + ' ' + media.game.title;\n          addPart(undefined, plain ? f : wrapEmojiText(f));\n          break;\n        }\n        case 'messageMediaDocument': {\n          const document = media.document as MyDocument;\n\n          if(document.type === 'video') {\n            addPart('AttachVideo');\n          } else if(document.type === 'voice') {\n            addPart('AttachAudio');\n          } else if(document.type === 'gif') {\n            addPart('AttachGif');\n          } else if(document.type === 'round') {\n            addPart('AttachRound');\n          } else if(document.type === 'sticker') {\n            const i = parts.length;\n            if(document.stickerEmojiRaw) {\n              const f = document.stickerEmojiRaw + ' ';\n              addPart(undefined, plain ? f : wrapEmojiText(f));\n            }\n\n            addPart('AttachSticker');\n\n            // will combine two parts into one\n            const p = parts.splice(i, 2);\n            if(plain) parts.push((p[0] as string) + (p[1] as string));\n            else {\n              const span = window.document.createElement('span');\n              span.append(...p);\n              parts.push(span);\n            }\n\n            text = '';\n          } else if(document.type === 'audio') {\n            const attribute = document.attributes.find((attribute) => attribute._ === 'documentAttributeAudio' && (attribute.title || attribute.performer)) as DocumentAttribute.documentAttributeAudio;\n            const f = '' + ' ' + (attribute ? [attribute.title, attribute.performer].filter(Boolean).join(' - ') : document.file_name);\n            addPart(undefined, plain ? f : wrapEmojiText(f));\n          } else {\n            addPart(undefined, plain ? document.file_name : wrapEmojiText(document.file_name));\n          }\n\n          break;\n        }\n\n        case 'messageMediaInvoice': {\n          addPart(undefined, plain ? media.title : wrapEmojiText(media.title));\n          break;\n        }\n\n        case 'messageMediaUnsupported': {\n          addPart(UNSUPPORTED_LANG_PACK_KEY);\n          break;\n        }\n\n        default:\n          // messageText += media._;\n          // /////appMessagesManager.log.warn('Got unknown media type!', message);\n          break;\n      }\n    }\n\n    const length = parts.length;\n    for(let i = 1; i < length; i += 2) {\n      parts.splice(i, 0, ', ');\n    }\n\n    if(text && length) {\n      parts.push(', ');\n    }\n  }\n\n  if((message as Message.messageService).action) {\n    const actionWrapped = await wrapMessageActionTextNew((message as Message.messageService), plain);\n    if(actionWrapped) {\n      addPart(undefined, actionWrapped);\n    }\n  }\n\n  if(isRestricted) {\n    text = getRestrictionReason((message as Message.message).restriction_reason).text;\n    entities = [];\n  }\n\n  if(text) {\n    text = limitSymbols(text, 100);\n\n    if(!entities) {\n      entities = [];\n    }\n\n    if(plain) {\n      parts.push(wrapPlainText(text, entities));\n    } else {\n      // let entities = parseEntities(text.replace(/\\n/g, ' '));\n\n      if(highlightWord) {\n        highlightWord = highlightWord.trim();\n        let found = false;\n        let match: any;\n        const regExp = new RegExp(escapeRegExp(highlightWord), 'gi');\n        entities = entities.slice(); // fix leaving highlight entity\n        while((match = regExp.exec(text)) !== null) {\n          entities.push({_: 'messageEntityHighlight', length: highlightWord.length, offset: match.index});\n          found = true;\n        }\n\n        if(found) {\n          sortEntities(entities);\n        }\n      }\n\n      const messageWrapped = wrapRichText(text, {\n        noLinebreaks: true,\n        entities,\n        noLinks: true,\n        noTextFormat: true\n      });\n\n      parts.push(htmlToDocumentFragment(messageWrapped));\n    }\n  }\n\n  if(plain) {\n    return parts.join('');\n  } else {\n    const fragment = document.createDocumentFragment();\n    fragment.append(...parts);\n    return fragment;\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport PeerTitle, {PeerTitleOptions} from '../peerTitle';\n\nexport default async function wrapPeerTitle(options: PeerTitleOptions) {\n  const peerTitle = new PeerTitle();\n  await peerTitle.update(options);\n  return peerTitle.element;\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport {MyMessage} from '../../lib/appManagers/appMessagesManager';\nimport getMessageSenderPeerIdOrName from '../../lib/appManagers/utils/messages/getMessageSenderPeerIdOrName';\nimport {i18n} from '../../lib/langPack';\nimport rootScope from '../../lib/rootScope';\nimport PeerTitle from '../peerTitle';\n\nexport default async function wrapSenderToPeer(message: MyMessage) {\n  const senderTitle: HTMLElement = document.createElement('span');\n  senderTitle.classList.add('sender-title');\n\n  const fromMe = message.fromId === rootScope.myId && message.peerId !== rootScope.myId;\n  senderTitle.append(\n    fromMe ?\n      i18n('FromYou') :\n      new PeerTitle({\n        ...getMessageSenderPeerIdOrName(message),\n        dialog: message.peerId === rootScope.myId\n      }).element\n  );\n\n  if(await rootScope.managers.appPeersManager.isAnyGroup(message.peerId) || fromMe) {\n    const peerTitle = new PeerTitle({peerId: message.peerId}).element;\n    senderTitle.append('  ', peerTitle);\n  }\n\n  return senderTitle;\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport {formatDateAccordingToTodayNew} from '../../helpers/date';\nimport {MyMessage} from '../../lib/appManagers/appMessagesManager';\n\nexport default function wrapSentTime(message: MyMessage) {\n  const el: HTMLElement = document.createElement('span');\n  el.classList.add('sent-time');\n  el.append(formatDateAccordingToTodayNew(new Date(message.date * 1000)));\n\n  return el;\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport IS_WEBP_SUPPORTED from '../../environment/webpSupport';\nimport assumeType from '../../helpers/assumeType';\nimport getPathFromBytes from '../../helpers/bytes/getPathFromBytes';\nimport deferredPromise from '../../helpers/cancellablePromise';\nimport computeLockColor from '../../helpers/computeLockColor';\nimport cancelEvent from '../../helpers/dom/cancelEvent';\nimport {attachClickEvent} from '../../helpers/dom/clickEvent';\nimport createVideo from '../../helpers/dom/createVideo';\nimport findUpClassName from '../../helpers/dom/findUpClassName';\nimport renderImageFromUrl, {renderImageFromUrlPromise} from '../../helpers/dom/renderImageFromUrl';\nimport getImageFromStrippedThumb from '../../helpers/getImageFromStrippedThumb';\nimport getPreviewURLFromThumb from '../../helpers/getPreviewURLFromThumb';\nimport makeError from '../../helpers/makeError';\nimport {makeMediaSize} from '../../helpers/mediaSize';\nimport mediaSizes from '../../helpers/mediaSizes';\nimport {Middleware} from '../../helpers/middleware';\nimport onMediaLoad from '../../helpers/onMediaLoad';\nimport {isSavingLottiePreview, saveLottiePreview} from '../../helpers/saveLottiePreview';\nimport throttle from '../../helpers/schedulers/throttle';\nimport sequentialDom from '../../helpers/sequentialDom';\nimport {PhotoSize, VideoSize} from '../../layer';\nimport {MyDocument} from '../../lib/appManagers/appDocsManager';\nimport appDownloadManager from '../../lib/appManagers/appDownloadManager';\nimport appImManager from '../../lib/appManagers/appImManager';\nimport {AppManagers} from '../../lib/appManagers/managers';\nimport getServerMessageId from '../../lib/appManagers/utils/messageId/getServerMessageId';\nimport choosePhotoSize from '../../lib/appManagers/utils/photos/choosePhotoSize';\nimport getStickerEffectThumb from '../../lib/appManagers/utils/stickers/getStickerEffectThumb';\nimport lottieLoader from '../../lib/rlottie/lottieLoader';\nimport rootScope from '../../lib/rootScope';\nimport type {ThumbCache} from '../../lib/storages/thumbs';\nimport webpWorkerController from '../../lib/webp/webpWorkerController';\nimport {Awaited, SendMessageEmojiInteractionData} from '../../types';\nimport {getEmojiToneIndex} from '../../vendor/emoji';\nimport animationIntersector, {AnimationItemGroup} from '../animationIntersector';\nimport LazyLoadQueue from '../lazyLoadQueue';\nimport PopupStickers from '../popups/stickers';\nimport {hideToast, toastNew} from '../toast';\nimport wrapStickerAnimation from './stickerAnimation';\n\n// https://github.com/telegramdesktop/tdesktop/blob/master/Telegram/SourceFiles/history/view/media/history_view_sticker.cpp#L40\nexport const STICKER_EFFECT_MULTIPLIER = 1 + 0.245 * 2;\nconst EMOJI_EFFECT_MULTIPLIER = 3;\n\nconst locksUrls: {[docId: string]: string} = {};\n\nexport default async function wrapSticker({doc, div, middleware, loadStickerMiddleware, lazyLoadQueue, exportLoad, group, play, onlyThumb, emoji, width, height, withThumb, loop, loadPromises, needFadeIn, needUpscale, skipRatio, static: asStatic, managers = rootScope.managers, fullThumb, isOut, noPremium, withLock, relativeEffect, loopEffect, isCustomEmoji}: {\n  doc: MyDocument,\n  div: HTMLElement | HTMLElement[],\n  middleware?: Middleware,\n  loadStickerMiddleware?: Middleware,\n  lazyLoadQueue?: LazyLoadQueue,\n  exportLoad?: boolean,\n  group?: AnimationItemGroup,\n  play?: boolean,\n  onlyThumb?: boolean,\n  emoji?: string,\n  width?: number,\n  height?: number,\n  withThumb?: boolean,\n  loop?: boolean,\n  loadPromises?: Promise<any>[],\n  needFadeIn?: boolean,\n  needUpscale?: boolean,\n  skipRatio?: number,\n  static?: boolean,\n  managers?: AppManagers,\n  fullThumb?: PhotoSize | VideoSize,\n  isOut?: boolean,\n  noPremium?: boolean,\n  withLock?: boolean,\n  relativeEffect?: boolean,\n  loopEffect?: boolean,\n  isCustomEmoji?: boolean\n}) {\n  div = Array.isArray(div) ? div : [div];\n\n  if(isCustomEmoji) {\n    emoji = doc.stickerEmojiRaw;\n  }\n\n  const stickerType = doc.sticker;\n  if(stickerType === 1) {\n    asStatic = true;\n  }\n\n  if(!width && !height) {\n    const sizes = mediaSizes.active;\n    const boxSize = emoji ? sizes.emojiSticker : (doc.animated ? sizes.animatedSticker : sizes.staticSticker);\n    const size = makeMediaSize(doc.w, doc.h).aspectFitted(boxSize);\n    width = size.width;\n    height = size.height;\n  }\n\n  if(stickerType === 2) {\n    // LottieLoader.loadLottie();\n    lottieLoader.loadLottieWorkers();\n  }\n\n  div.forEach((div) => {\n    div.dataset.docId = '' + doc.id;\n    if(emoji) {\n      div.dataset.stickerEmoji = emoji;\n    }\n\n    div.classList.add('media-sticker-wrapper');\n  });\n\n  /* if(stickerType === 3) {\n    const videoRes = wrapVideo({\n      doc,\n      boxWidth: width,\n      boxHeight: height,\n      container: div,\n      group,\n      lazyLoadQueue,\n      middleware,\n      withoutPreloader: true,\n      loadPromises,\n      noPlayButton: true,\n      noInfo: true\n    });\n\n    if(videoRes.thumb) {\n      if(videoRes.thumb.images.thumb) {\n        videoRes.thumb.images.thumb.classList.add('media-sticker', 'thumbnail');\n      }\n\n      if(videoRes.thumb.images.full) {\n        videoRes.thumb.images.full.classList.add('media-sticker');\n      }\n    }\n\n    return videoRes.loadPromise;\n  } */\n\n  // console.log('wrap sticker', doc, div, onlyThumb);\n\n  let cacheContext: ThumbCache;\n  const getCacheContext = async(type: string = cacheContext?.type) => {\n    return cacheContext = await managers.thumbsStorage.getCacheContext(doc, type);\n  };\n\n  const isAnimated = !asStatic && (stickerType === 2 || stickerType === 3);\n\n  const effectThumb = getStickerEffectThumb(doc);\n  if(isOut !== undefined && effectThumb && !isOut) {\n    div.forEach((div) => div.classList.add('reflect-x'));\n  }\n\n  const willHaveLock = effectThumb && withLock;\n  if(willHaveLock) {\n    const lockUrl = locksUrls[doc.id];\n    div.forEach((div) => {\n      div.classList.add('is-premium-sticker', 'tgico-premium_lock');\n      lockUrl && div.style.setProperty('--lock-url', `url(${lockUrl})`);\n    });\n  }\n\n  if(asStatic && stickerType !== 1) {\n    const thumb = choosePhotoSize(doc, width, height, false) as PhotoSize.photoSize;\n    await getCacheContext(thumb.type);\n  } else {\n    await getCacheContext(fullThumb?.type);\n  }\n\n  const toneIndex = emoji && !isCustomEmoji ? getEmojiToneIndex(emoji) : -1;\n  const downloaded = cacheContext.downloaded && !needFadeIn;\n\n  const isThumbNeededForType = isAnimated;\n  const lottieCachedThumb = stickerType === 2 || stickerType === 3 ? await managers.appDocsManager.getLottieCachedThumb(doc.id, toneIndex) : undefined;\n\n  const ret = {render: undefined as typeof loadPromise, load: undefined as typeof load};\n  let loadThumbPromise = deferredPromise<void>();\n  let haveThumbCached = false;\n  if((\n    doc.thumbs?.length ||\n      lottieCachedThumb\n  ) &&\n    !div[0].firstElementChild && (\n    !downloaded ||\n      isThumbNeededForType ||\n      onlyThumb\n  ) && withThumb !== false/*  && doc.thumbs[0]._ !== 'photoSizeEmpty' */\n  ) {\n    let thumb = lottieCachedThumb || doc.thumbs[0];\n\n    // console.log('wrap sticker', thumb, div);\n\n    const afterRender = (div: HTMLElement, thumbImage: HTMLElement) => {\n      if(!div.childElementCount) {\n        thumbImage.classList.add('media-sticker', 'thumbnail');\n\n        sequentialDom.mutateElement(div, () => {\n          div.append(thumbImage);\n          loadThumbPromise.resolve();\n        });\n      }\n    };\n\n    if('url' in thumb) {\n      haveThumbCached = true;\n      div.forEach((div) => {\n        const thumbImage = new Image();\n        renderImageFromUrl(thumbImage, (thumb as any).url, () => afterRender(div, thumbImage));\n      });\n    } else if('bytes' in thumb) {\n      if(thumb._ === 'photoPathSize') {\n        if(!thumb.bytes.length) {\n          thumb = doc.thumbs.find((t) => (t as PhotoSize.photoStrippedSize).bytes?.length) || thumb;\n        }\n\n        const d = getPathFromBytes((thumb as PhotoSize.photoStrippedSize).bytes);\n        const ns = 'http://www.w3.org/2000/svg';\n        const svg = document.createElementNS(ns, 'svg');\n        svg.classList.add('rlottie-vector', 'media-sticker', 'thumbnail');\n        svg.setAttributeNS(null, 'viewBox', `0 0 ${doc.w || 512} ${doc.h || 512}`);\n\n        // const defs = document.createElementNS(ns, 'defs');\n        // const linearGradient = document.createElementNS(ns, 'linearGradient');\n        // linearGradient.setAttributeNS(null, 'id', 'g');\n        // linearGradient.setAttributeNS(null, 'x1', '-300%');\n        // linearGradient.setAttributeNS(null, 'x2', '-200%');\n        // linearGradient.setAttributeNS(null, 'y1', '0');\n        // linearGradient.setAttributeNS(null, 'y2', '0');\n        // const stops = [\n        //   ['-10%', '.1'],\n        //   ['30%', '.07'],\n        //   ['70%', '.07'],\n        //   ['110%', '.1']\n        // ].map(([offset, stopOpacity]) => {\n        //   const stop = document.createElementNS(ns, 'stop');\n        //   stop.setAttributeNS(null, 'offset', offset);\n        //   stop.setAttributeNS(null, 'stop-opacity', stopOpacity);\n        //   return stop;\n        // });\n        // const animates = [\n        //   ['-300%', '1200%'],\n        //   ['-200%', '1300%']\n        // ].map(([from, to], idx) => {\n        //   const animate = document.createElementNS(ns, 'animate');\n        //   animate.setAttributeNS(null, 'attributeName', 'x' + (idx + 1));\n        //   animate.setAttributeNS(null, 'from', from);\n        //   animate.setAttributeNS(null, 'to', to);\n        //   animate.setAttributeNS(null, 'dur', '3s');\n        //   animate.setAttributeNS(null, 'repeatCount', 'indefinite');\n        //   return animate;\n        // });\n        // linearGradient.append(...stops, ...animates);\n        // defs.append(linearGradient);\n        // svg.append(defs);\n\n        const path = document.createElementNS(ns, 'path');\n        path.setAttributeNS(null, 'd', d);\n        if(rootScope.settings.animationsEnabled && !isCustomEmoji) path.setAttributeNS(null, 'fill', 'url(#g)');\n        svg.append(path);\n        div.forEach((div, idx) => div.append(idx > 0 ? svg.cloneNode(true) : svg));\n        haveThumbCached = true;\n        loadThumbPromise.resolve();\n      } else if(toneIndex <= 0) {\n        const r = () => {\n          (div as HTMLElement[]).forEach((div) => {\n            const thumbImage = new Image();\n            const url = getPreviewURLFromThumb(doc, thumb as PhotoSize.photoStrippedSize, true);\n            renderImageFromUrl(thumbImage, url, () => afterRender(div, thumbImage));\n          });\n        };\n\n        if((IS_WEBP_SUPPORTED || doc.pFlags.stickerThumbConverted || cacheContext.url)/*  && false */) {\n          haveThumbCached = true;\n          r();\n        } else {\n          haveThumbCached = true;\n          webpWorkerController.convert('main-' + doc.id, thumb.bytes).then((bytes) => {\n            managers.appDocsManager.saveWebPConvertedStrippedThumb(doc.id, bytes);\n            (thumb as PhotoSize.photoStrippedSize).bytes = bytes;\n            doc.pFlags.stickerThumbConverted = true;\n\n            if((middleware && !middleware()) || (div as HTMLElement[])[0].childElementCount) {\n              loadThumbPromise.resolve();\n              return;\n            }\n\n            r();\n          }).catch(() => loadThumbPromise.resolve());\n        }\n      }\n    } else if(((stickerType === 2 && toneIndex <= 0) || stickerType === 3) && (withThumb || onlyThumb)) {\n      const load = async() => {\n        if((div as HTMLElement[])[0].childElementCount || (middleware && !middleware())) {\n          loadThumbPromise.resolve();\n          return;\n        }\n\n        const r = (div: HTMLElement, thumbImage: HTMLElement, rendered?: boolean) => {\n          if(div.childElementCount || (middleware && !middleware())) {\n            loadThumbPromise.resolve();\n            return;\n          }\n\n          if(rendered) afterRender(div, thumbImage);\n          else renderImageFromUrl(thumbImage, cacheContext.url, () => afterRender(div, thumbImage));\n        };\n\n        await getCacheContext();\n        (div as HTMLElement[]).forEach((div) => {\n          if(cacheContext.url) {\n            r(div, new Image());\n          } else if('bytes' in thumb) {\n            const res = getImageFromStrippedThumb(doc, thumb as PhotoSize.photoStrippedSize, true);\n            res.loadPromise.then(() => r(div, res.image, true));\n\n            // return managers.appDocsManager.getThumbURL(doc, thumb as PhotoSize.photoStrippedSize).promise.then(r);\n          } else {\n            appDownloadManager.downloadMediaURL({\n              media: doc,\n              thumb: thumb as PhotoSize\n            }).then(async() => {\n              await getCacheContext();\n              return r(div, new Image());\n            });\n          }\n        });\n      };\n\n      if(lazyLoadQueue && onlyThumb) {\n        lazyLoadQueue.push({div: div[0], load});\n        loadThumbPromise.resolve();\n        return ret;\n      } else {\n        load();\n\n        if((thumb as any).url) {\n          haveThumbCached = true;\n        }\n      }\n    }\n  }\n\n  if(loadPromises && haveThumbCached) {\n    loadPromises.push(loadThumbPromise);\n  }\n\n  if(onlyThumb/*  || true */) { // for sticker panel\n    return ret;\n  }\n\n  const middlewareError = makeError('MIDDLEWARE');\n  const load = async() => {\n    if(middleware && !middleware()) {\n      throw middlewareError;\n    }\n\n    if(stickerType === 2 && !asStatic) {\n      return appDownloadManager.downloadMedia({media: doc, queueId: lazyLoadQueue?.queueId, thumb: fullThumb})\n      .then(async(blob) => {\n        if(middleware && !middleware()) {\n          throw middlewareError;\n        }\n\n        const animation = await lottieLoader.loadAnimationWorker({\n          container: (div as HTMLElement[])[0],\n          loop: loop && (!emoji || isCustomEmoji),\n          autoplay: play,\n          animationData: blob,\n          width,\n          height,\n          name: 'doc' + doc.id,\n          needUpscale,\n          skipRatio,\n          toneIndex,\n          sync: isCustomEmoji\n        }, group, loadStickerMiddleware ?? middleware);\n\n        // const deferred = deferredPromise<void>();\n\n        const setLockColor = willHaveLock ? () => {\n          const lockUrl = locksUrls[doc.id] ??= computeLockColor(animation.canvas[0]);\n          (div as HTMLElement[]).forEach((div) => div.style.setProperty('--lock-url', `url(${lockUrl})`));\n        } : undefined;\n\n        const onFirstFrame = (container: HTMLElement, canvas: HTMLCanvasElement) => {\n          const element = container.firstElementChild;\n          if(needFadeIn !== false) {\n            needFadeIn = (needFadeIn || !element || element.tagName === 'svg') && rootScope.settings.animationsEnabled;\n          }\n\n          const cb = () => {\n            if(element && element !== canvas && element.tagName !== 'DIV') {\n              element.remove();\n            }\n          };\n\n          if(!needFadeIn) {\n            if(element) {\n              sequentialDom.mutate(cb);\n            }\n          } else {\n            sequentialDom.mutate(() => {\n              canvas && canvas.classList.add('fade-in');\n              if(element) {\n                element.classList.add('fade-out');\n              }\n\n              (canvas || element).addEventListener('animationend', () => {\n                sequentialDom.mutate(() => {\n                  canvas && canvas.classList.remove('fade-in');\n                  cb();\n                });\n              }, {once: true});\n            });\n          }\n        };\n\n        animation.addEventListener('firstFrame', () => {\n          const canvas = animation.canvas[0];\n          if(withThumb !== false) {\n            saveLottiePreview(doc, canvas, toneIndex);\n          }\n\n          if(willHaveLock) {\n            setLockColor();\n          }\n\n          if(!isCustomEmoji) {\n            (div as HTMLElement[]).forEach((container, idx) => {\n              onFirstFrame(container, animation.canvas[idx]);\n            });\n          }\n        }, {once: true});\n\n        if(emoji) {\n          managers.appStickersManager.preloadAnimatedEmojiStickerAnimation(emoji);\n        }\n\n        return animation;\n\n        // return deferred;\n        // await new Promise((resolve) => setTimeout(resolve, 5e3));\n      });\n    } else if(asStatic || stickerType === 3) {\n      const isSingleVideo = isAnimated && false;\n      const d = isSingleVideo ? (div as HTMLElement[]).slice(0, 1) : div as HTMLElement[];\n      const media: HTMLElement[] = d.map(() => {\n        let media: HTMLElement;\n        if(asStatic) {\n          media = new Image();\n        } else {\n          const video = media = createVideo();\n          video.muted = true;\n          if(play) video.autoplay = true;\n          if(loop) video.loop = true;\n        }\n\n        media.classList.add('media-sticker');\n        return media;\n      });\n\n      const thumbImage = (div as HTMLElement[]).map((div, idx) => (div.firstElementChild as HTMLElement) !== media[idx] && div.firstElementChild) as HTMLElement[];\n      if(needFadeIn !== false) {\n        needFadeIn = (needFadeIn || !downloaded || (asStatic ? thumbImage[0] : (!thumbImage[0] || thumbImage[0].tagName === 'svg'))) && rootScope.settings.animationsEnabled;\n      }\n\n      if(needFadeIn) {\n        media.forEach((media) => media.classList.add('fade-in'));\n      }\n\n      return new Promise<HTMLVideoElement[] | HTMLImageElement[]>(async(resolve, reject) => {\n        const r = async() => {\n          if(middleware && !middleware()) {\n            reject(middlewareError);\n            return;\n          }\n\n          const mediaLength = media.length;\n          const loaded: HTMLElement[] = [];\n          const onLoad = (div: HTMLElement, media: HTMLElement, thumbImage: HTMLElement) => {\n            sequentialDom.mutateElement(div, () => {\n              if(middleware && !middleware()) {\n                reject(middlewareError);\n                return;\n              }\n\n              if(!media) {\n                if(!isSingleVideo || !isAnimated) {\n                  thumbImage?.remove();\n                }\n\n                return;\n              }\n\n              if(media as HTMLVideoElement && !isSavingLottiePreview(doc, toneIndex)) {\n                // const perf = performance.now();\n                assumeType<HTMLVideoElement>(media);\n                const canvas = document.createElement('canvas');\n                canvas.width = width * window.devicePixelRatio;\n                canvas.height = height * window.devicePixelRatio;\n                const ctx = canvas.getContext('2d');\n                ctx.drawImage(media, 0, 0, canvas.width, canvas.height);\n                saveLottiePreview(doc, canvas, toneIndex);\n                // console.log('perf', performance.now() - perf);\n              }\n\n              if(isSingleVideo) {\n                resolve(media as any);\n                return;\n              }\n\n              div.append(media);\n\n              if(needFadeIn) {\n                thumbImage && thumbImage.classList.add('fade-out');\n                media.addEventListener('animationend', () => {\n                  media.classList.remove('fade-in');\n                  thumbImage?.remove();\n                }, {once: true});\n              } else {\n                thumbImage?.remove();\n              }\n\n              if(isAnimated) {\n                animationIntersector.addAnimation(media as HTMLVideoElement, group);\n              }\n\n              if(loaded.push(media) === mediaLength) {\n                resolve(loaded as any);\n              }\n            });\n          };\n\n          await getCacheContext();\n          let lastPromise: Promise<any>;\n          (div as HTMLElement[]).forEach((div, idx) => {\n            const _media = media[idx];\n            const cb = () => onLoad(div, _media, thumbImage[idx]);\n            if(_media) lastPromise = renderImageFromUrlPromise(_media, cacheContext.url);\n            lastPromise.then(cb);\n          });\n        };\n\n        await getCacheContext();\n        if(cacheContext.url) r();\n        else {\n          let promise: Promise<any>;\n          if(stickerType !== 1 && asStatic) {\n            const thumb = choosePhotoSize(doc, width, height, false) as PhotoSize.photoSize;\n            // promise = managers.appDocsManager.getThumbURL(doc, thumb).promise\n            promise = appDownloadManager.downloadMediaURL({media: doc, thumb, queueId: lazyLoadQueue?.queueId});\n          } else {\n            promise = appDownloadManager.downloadMediaURL({media: doc, queueId: lazyLoadQueue?.queueId});\n          }\n\n          promise.then(r, reject);\n        }\n      });\n    }\n  };\n\n  if(exportLoad && (!downloaded || isAnimated)) {\n    ret.load = load;\n    return ret;\n  }\n\n  const loadPromise: Promise<Awaited<ReturnType<typeof load>> | void> = lazyLoadQueue && (!downloaded || isAnimated) ?\n    (lazyLoadQueue.push({div: div[0], load}), Promise.resolve()) :\n    load();\n\n  if(downloaded && (asStatic/*  || stickerType === 3 */)) {\n    loadThumbPromise = loadPromise as any;\n    if(loadPromises) {\n      loadPromises.push(loadThumbPromise);\n    }\n  }\n\n  if(stickerType === 2 && effectThumb && isOut !== undefined && !noPremium) {\n    attachStickerEffectHandler({\n      container: div[0],\n      doc,\n      managers,\n      middleware,\n      isOut,\n      width,\n      loadPromise,\n      relativeEffect,\n      loopEffect\n    });\n  }\n\n  ret.render = loadPromise as any;\n  return ret;\n}\n\nfunction attachStickerEffectHandler({container, doc, managers, middleware, isOut, width, loadPromise, relativeEffect, loopEffect}: {\n  container: HTMLElement,\n  doc: MyDocument,\n  managers: AppManagers,\n  middleware: Middleware,\n  isOut: boolean,\n  width: number,\n  loadPromise: Promise<any>,\n  relativeEffect?: boolean,\n  loopEffect?: boolean\n}) {\n  managers.appStickersManager.preloadSticker(doc.id, true);\n\n  let playing = false;\n  attachClickEvent(container, async(e) => {\n    cancelEvent(e);\n    if(playing) {\n      const a = document.createElement('a');\n      a.onclick = () => {\n        hideToast();\n        new PopupStickers(doc.stickerSetInput).show();\n      };\n\n      toastNew({\n        langPackKey: 'Sticker.Premium.Click.Info',\n        langPackArguments: [a]\n      });\n\n      return;\n    }\n\n    playing = true;\n\n    await loadPromise;\n    const {animationDiv, stickerPromise} = wrapStickerAnimation({\n      doc,\n      middleware,\n      side: isOut ? 'right' : 'left',\n      size: width * STICKER_EFFECT_MULTIPLIER,\n      target: container,\n      play: true,\n      fullThumb: getStickerEffectThumb(doc),\n      relativeEffect,\n      loopEffect\n    });\n\n    if(isOut !== undefined && !isOut/*  && !relativeEffect */) {\n      animationDiv.classList.add('reflect-x');\n    }\n\n    stickerPromise.then((player) => {\n      player.addEventListener('destroy', () => {\n        playing = false;\n      });\n    });\n  });\n}\n\nexport async function onEmojiStickerClick({event, container, managers, peerId, middleware}: {\n  event: Event,\n  container: HTMLElement,\n  managers: AppManagers,\n  peerId: PeerId,\n  middleware: Middleware\n}) {\n  if(!peerId.isUser()) {\n    return;\n  }\n\n  cancelEvent(event);\n\n  const bubble = findUpClassName(container, 'bubble');\n  const emoji = container.dataset.stickerEmoji;\n  const data: SendMessageEmojiInteractionData = (container as any).emojiData ??= {\n    a: [],\n    v: 1\n  };\n\n  const sendInteractionThrottled: () => void = (container as any).sendInteractionThrottled = throttle(() => {\n    const length = data.a.length;\n    if(!length) {\n      return;\n    }\n\n    const firstTime = data.a[0].t;\n\n    data.a.forEach((a) => {\n      a.t = (a.t - firstTime) / 1000;\n    });\n\n    const bubble = findUpClassName(container, 'bubble');\n    managers.appMessagesManager.setTyping(appImManager.chat.peerId, {\n      _: 'sendMessageEmojiInteraction',\n      msg_id: getServerMessageId(+bubble.dataset.mid),\n      emoticon: emoji,\n      interaction: {\n        _: 'dataJSON',\n        data: JSON.stringify(data)\n      }\n    }, true);\n\n    data.a.length = 0;\n  }, 1000, false);\n\n  const animation = lottieLoader.getAnimation(container);\n  if(animation.paused) {\n    const doc = await managers.appStickersManager.getAnimatedEmojiSoundDocument(emoji);\n    if(doc) {\n      const audio = document.createElement('audio');\n      audio.style.display = 'none';\n      container.parentElement.append(audio);\n\n      try {\n        const url = await appDownloadManager.downloadMediaURL({media: doc});\n\n        audio.src = url;\n        audio.play();\n        await onMediaLoad(audio, undefined, true);\n\n        audio.addEventListener('ended', () => {\n          audio.src = '';\n          audio.remove();\n        }, {once: true});\n      } catch(err) {\n\n      }\n    }\n\n    animation.autoplay = true;\n    animation.restart();\n  }\n\n  const doc = await managers.appStickersManager.getAnimatedEmojiSticker(emoji, true);\n  if(!doc) {\n    return;\n  }\n\n  const isOut = bubble ? bubble.classList.contains('is-out') : undefined;\n  const {animationDiv} = wrapStickerAnimation({\n    doc,\n    middleware,\n    side: isOut ? 'right' : 'left',\n    size: 360,\n    target: container,\n    play: true,\n    withRandomOffset: true\n  });\n\n  if(isOut !== undefined && !isOut) {\n    animationDiv.classList.add('reflect-x');\n  }\n\n  // using a trick here: simulated event from interlocutor's interaction won't fire ours\n  if(event.isTrusted) {\n    data.a.push({\n      i: 1,\n      t: Date.now()\n    });\n\n    sendInteractionThrottled();\n  }\n  // });\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\n/**\n  * https://core.telegram.org/api/files#vector-thumbnails\n  */\nexport default function getPathFromBytes(bytes: Uint8Array) {\n  const lookup = 'AACAAAAHAAALMAAAQASTAVAAAZaacaaaahaaalmaaaqastava.az0123456789-,';\n\n  let path = 'M';\n  for(let i = 0, length = bytes.length; i < length; ++i) {\n    const num = bytes[i];\n\n    if(num >= (128 + 64)) {\n      path += lookup[num - 128 - 64];\n    } else {\n      if(num >= 128) {\n        path += ',';\n      } else if(num >= 64) {\n        path += '-';\n      }\n      path += '' + (num & 63);\n    }\n  }\n  path += 'z';\n\n  return path;\n}\n","// https://github.com/telegramdesktop/tdesktop/blob/543bfab24a76402992421063f1e6444f347d31fe/Telegram/SourceFiles/boxes/sticker_set_box.cpp#L75\nexport default function computeLockColor(canvas: HTMLCanvasElement) {\n  const context = canvas.getContext('2d');\n  const size = 20 * (canvas.dpr ?? 1);\n  const width = size;\n  const height = size;\n  const skipx = (canvas.width - width) / 2;\n  const margin = 0/*  * (canvas.dpr ?? 1) */;\n  const skipy = canvas.height - height - margin;\n  const imageData = context.getImageData(skipx, skipy, width, height).data;\n  let sr = 0, sg = 0, sb = 0, sa = 0;\n  for(let i = 0; i < imageData.length; i += 4) {\n    sr += imageData[i];\n    sg += imageData[i + 1];\n    sb += imageData[i + 2];\n    sa += imageData[i + 3];\n  }\n\n  const outCanvas = document.createElement('canvas');\n  outCanvas.width = size;\n  outCanvas.height = size;\n  const outContext = outCanvas.getContext('2d');\n  const color = new Uint8ClampedArray([sr * 255 / sa, sg * 255 / sa, sb * 255 / sa, 255]);\n  const rgba = `rgba(${color[0]}, ${color[1]}, ${color[2]}, ${color[3]})`;\n  outContext.fillStyle = rgba;\n  outContext.fillRect(0, 0, outCanvas.width, outCanvas.height);\n  outContext.fillStyle = `rgba(112, 117, 121, 0.3)`;\n  outContext.fillRect(0, 0, outCanvas.width, outCanvas.height);\n  // document.querySelector('.popup-title').append(c);\n  return outCanvas.toDataURL('image/jpeg');\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport IS_VIBRATE_SUPPORTED from '../../environment/vibrateSupport';\nimport assumeType from '../../helpers/assumeType';\nimport isInDOM from '../../helpers/dom/isInDOM';\nimport {Middleware} from '../../helpers/middleware';\nimport throttleWithRaf from '../../helpers/schedulers/throttleWithRaf';\nimport windowSize from '../../helpers/windowSize';\nimport {PhotoSize, VideoSize} from '../../layer';\nimport {MyDocument} from '../../lib/appManagers/appDocsManager';\nimport appImManager from '../../lib/appManagers/appImManager';\nimport {AppManagers} from '../../lib/appManagers/managers';\nimport RLottiePlayer from '../../lib/rlottie/rlottiePlayer';\nimport wrapSticker from './sticker';\n\nexport default function wrapStickerAnimation({\n  size,\n  doc,\n  middleware,\n  target,\n  side,\n  skipRatio,\n  play,\n  managers,\n  fullThumb,\n  withRandomOffset,\n  relativeEffect,\n  loopEffect\n}: {\n  size: number,\n  doc: MyDocument,\n  middleware?: Middleware,\n  target: HTMLElement,\n  side: 'left' | 'center' | 'right',\n  skipRatio?: number,\n  play: boolean,\n  managers?: AppManagers,\n  fullThumb?: PhotoSize | VideoSize,\n  withRandomOffset?: boolean,\n  relativeEffect?: boolean,\n  loopEffect?: boolean\n}) {\n  const animationDiv = document.createElement('div');\n  animationDiv.classList.add('emoji-animation');\n\n  // const size = 280;\n  animationDiv.style.width = size + 'px';\n  animationDiv.style.height = size + 'px';\n\n  let animation: RLottiePlayer;\n  const unmountAnimation = () => {\n    animation?.remove();\n    animationDiv.remove();\n    appImManager.chat.bubbles.scrollable.container.removeEventListener('scroll', onScroll);\n  };\n\n  const stickerPromise = wrapSticker({\n    div: animationDiv,\n    doc,\n    middleware,\n    withThumb: false,\n    needFadeIn: false,\n    loop: !!loopEffect,\n    width: size,\n    height: size,\n    play,\n    group: 'none',\n    skipRatio,\n    managers,\n    fullThumb\n  }).then(({render}) => render).then((_animation) => {\n    assumeType<RLottiePlayer>(_animation);\n    animation = _animation;\n    animation.addEventListener('enterFrame', (frameNo) => {\n      if((!loopEffect && frameNo === animation.maxFrame) || !isInDOM(target)) {\n        unmountAnimation();\n      }\n    });\n\n    if(IS_VIBRATE_SUPPORTED) {\n      animation.addEventListener('firstFrame', () => {\n        navigator.vibrate(100);\n      }, {once: true});\n    }\n\n    return animation;\n  });\n\n  const generateRandomSigned = (max: number) => {\n    const r = Math.random() * max * 2;\n    return r > max ? -r % max : r;\n  };\n\n  const randomOffsetX = withRandomOffset ? generateRandomSigned(16) : 0;\n  const randomOffsetY = withRandomOffset ? generateRandomSigned(4) : 0;\n  const setPosition = () => {\n    if(!isInDOM(target)) {\n      unmountAnimation();\n      return;\n    }\n\n    const rect = target.getBoundingClientRect();\n\n    const factor = rect.width / 200;\n    const stableOffsetX = side === 'center' ? 0 : 16 * (side === 'right' ? 1 : -1) * factor;\n    // const stableOffsetY = side === 'center' ? 0 : -50 * factor;\n    const stableOffsetY = side === 'center' ? 0 : 0 * factor;\n\n    const rectX = side === 'right' ? rect.right : rect.left;\n    const rectY = rect.top;\n\n    const addOffsetX = (side === 'center' ? (rect.width - size) / 2 : (side === 'right' ? -size : 0)) + stableOffsetX + randomOffsetX;\n    const addOffsetY = (side === 'center' || true ? (rect.height - size) / 2 : 0) + stableOffsetY + randomOffsetY;\n    const x = rectX + addOffsetX;\n    const y = rectY + addOffsetY;\n\n    if(y <= -size || y >= windowSize.height) {\n      unmountAnimation();\n      return;\n    }\n\n    if(relativeEffect) {\n      if(side !== 'center') animationDiv.style[side] = Math.abs(stableOffsetX) * -1 + 'px';\n      else animationDiv.style.left = addOffsetX + 'px';\n      animationDiv.style.top = addOffsetY + 'px';\n    } else {\n      animationDiv.style.top = y + 'px';\n      animationDiv.style.left = x + 'px';\n    }\n  };\n\n  const onScroll = throttleWithRaf(setPosition);\n  appImManager.chat.bubbles.scrollable.container.addEventListener('scroll', onScroll);\n\n  setPosition();\n\n  if(relativeEffect) {\n    animationDiv.classList.add('is-relative');\n    target.parentElement.append(animationDiv);\n  } else {\n    appImManager.emojiAnimationContainer.append(animationDiv);\n  }\n\n  return {animationDiv, stickerPromise};\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport {AppManagers} from '../../lib/appManagers/managers';\nimport rootScope from '../../lib/rootScope';\nimport wrapSticker from './sticker'\n\nexport default async function wrapStickerEmoji({emoji, div, width, height, managers = rootScope.managers}: {\n  emoji: string,\n  div: HTMLElement,\n  managers?: AppManagers,\n  width: number,\n  height: number\n}) {\n  const doc = await managers.appStickersManager.getAnimatedEmojiSticker(emoji);\n  if(!doc) {\n    div.classList.add('media-sticker-wrapper');\n    throw new Error('no sticker');\n  }\n\n  return wrapSticker({\n    doc,\n    div,\n    emoji,\n    width,\n    height,\n    loop: false,\n    play: true\n  });\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport limitSymbols from '../../helpers/string/limitSymbols';\nimport {WebPage} from '../../layer';\nimport wrapRichText from '../../lib/richTextProcessor/wrapRichText';\n\nexport default function wrapWebPageDescription(webPage: WebPage.webPage) {\n  const shortDescriptionText = limitSymbols(webPage.description || '', 150, 180);\n  // const siteName = webPage.site_name;\n  // let contextHashtag = '';\n  // if(siteName === 'GitHub') {\n  //   const matches = apiWebPage.url.match(/(https?:\\/\\/github\\.com\\/[^\\/]+\\/[^\\/]+)/);\n  //   if(matches) {\n  //     contextHashtag = matches[0] + '/issues/{1}';\n  //   }\n  // }\n  return wrapRichText(shortDescriptionText/* , {\n    contextSite: siteName || 'external',\n    contextHashtag: contextHashtag\n  } */);\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport limitSymbols from '../../helpers/string/limitSymbols';\nimport {WebPage} from '../../layer';\nimport wrapRichText from '../../lib/richTextProcessor/wrapRichText';\n\nexport default function wrapWebPageTitle(webPage: WebPage.webPage) {\n  let shortTitle = webPage.title || webPage.author || webPage.site_name || '';\n  shortTitle = limitSymbols(shortTitle, 80, 100);\n  return wrapRichText(shortTitle, {noLinks: true, noLinebreaks: true});\n}\n","// Taken from https://core.telegram.org/bots/payments/currencies.json\nexport type Currency = {\n  code: string,\n  title: string,\n  symbol: string,\n  native: string,\n  thousands_sep: string,\n  decimal_sep: string,\n  symbol_left: boolean,\n  space_between: boolean,\n  exp: number,\n  min_amount: string | number,\n  max_amount: string | number\n};\n\nconst Currencies: {[currency: string]: Currency} = {'AED':{'code':'AED', 'title':'United Arab Emirates Dirham', 'symbol':'AED', 'native':'..', 'thousands_sep':',', 'decimal_sep':'.', 'symbol_left':true, 'space_between':true, 'exp':2, 'min_amount':'367', 'max_amount':'3672990'}, 'AFN':{'code':'AFN', 'title':'Afghan Afghani', 'symbol':'AFN', 'native':'', 'thousands_sep':',', 'decimal_sep':'.', 'symbol_left':true, 'space_between':false, 'exp':2, 'min_amount':'8893', 'max_amount':'88930176'}, 'ALL':{'code':'ALL', 'title':'Albanian Lek', 'symbol':'ALL', 'native':'Lek', 'thousands_sep':'.', 'decimal_sep':',', 'symbol_left':false, 'space_between':false, 'exp':2, 'min_amount':'11408', 'max_amount':'114088432'}, 'AMD':{'code':'AMD', 'title':'Armenian Dram', 'symbol':'AMD', 'native':'.', 'thousands_sep':',', 'decimal_sep':'.', 'symbol_left':false, 'space_between':true, 'exp':2, 'min_amount':'41129', 'max_amount':'411293180'}, 'ARS':{'code':'ARS', 'title':'Argentine Peso', 'symbol':'ARS', 'native':'$', 'thousands_sep':'.', 'decimal_sep':',', 'symbol_left':true, 'space_between':true, 'exp':2, 'min_amount':'12503', 'max_amount':'125036607'}, 'AUD':{'code':'AUD', 'title':'Australian Dollar', 'symbol':'AU$', 'native':'$', 'thousands_sep':',', 'decimal_sep':'.', 'symbol_left':true, 'space_between':false, 'exp':2, 'min_amount':'145', 'max_amount':'1451625'}, 'AZN':{'code':'AZN', 'title':'Azerbaijani Manat', 'symbol':'AZN', 'native':'.', 'thousands_sep':' ', 'decimal_sep':',', 'symbol_left':false, 'space_between':true, 'exp':2, 'min_amount':'171', 'max_amount':'1711164'}, 'BAM':{'code':'BAM', 'title':'Bosnia & Herzegovina Convertible Mark', 'symbol':'BAM', 'native':'KM', 'thousands_sep':'.', 'decimal_sep':',', 'symbol_left':false, 'space_between':true, 'exp':2, 'min_amount':'187', 'max_amount':'1873042'}, 'BDT':{'code':'BDT', 'title':'Bangladeshi Taka', 'symbol':'BDT', 'native':'', 'thousands_sep':',', 'decimal_sep':'.', 'symbol_left':true, 'space_between':true, 'exp':2, 'min_amount':'9415', 'max_amount':'94154281'}, 'BGN':{'code':'BGN', 'title':'Bulgarian Lev', 'symbol':'BGN', 'native':'.', 'thousands_sep':' ', 'decimal_sep':',', 'symbol_left':false, 'space_between':true, 'exp':2, 'min_amount':'186', 'max_amount':'1869710'}, 'BND':{'code':'BND', 'title':'Brunei Dollar', 'symbol':'BND', 'native':'$', 'thousands_sep':'.', 'decimal_sep':',', 'symbol_left':true, 'space_between':false, 'exp':2, 'min_amount':'139', 'max_amount':'1399458'}, 'BOB':{'code':'BOB', 'title':'Bolivian Boliviano', 'symbol':'BOB', 'native':'Bs', 'thousands_sep':'.', 'decimal_sep':',', 'symbol_left':true, 'space_between':true, 'exp':2, 'min_amount':'692', 'max_amount':'6926834'}, 'BRL':{'code':'BRL', 'title':'Brazilian Real', 'symbol':'R$', 'native':'R$', 'thousands_sep':'.', 'decimal_sep':',', 'symbol_left':true, 'space_between':true, 'exp':2, 'min_amount':'518', 'max_amount':'5182986'}, 'CAD':{'code':'CAD', 'title':'Canadian Dollar', 'symbol':'CA$', 'native':'$', 'thousands_sep':',', 'decimal_sep':'.', 'symbol_left':true, 'space_between':false, 'exp':2, 'min_amount':'129', 'max_amount':'1290450'}, 'CHF':{'code':'CHF', 'title':'Swiss Franc', 'symbol':'CHF', 'native':'CHF', 'thousands_sep':'\\'', 'decimal_sep':'.', 'symbol_left':false, 'space_between':true, 'exp':2, 'min_amount':'95', 'max_amount':'954630'}, 'CLP':{'code':'CLP', 'title':'Chilean Peso', 'symbol':'CLP', 'native':'$', 'thousands_sep':'.', 'decimal_sep':',', 'symbol_left':true, 'space_between':true, 'exp':0, 'min_amount':'926', 'max_amount':'9268013'}, 'CNY':{'code':'CNY', 'title':'Chinese Renminbi Yuan', 'symbol':'CN', 'native':'CN', 'thousands_sep':',', 'decimal_sep':'.', 'symbol_left':true, 'space_between':false, 'exp':2, 'min_amount':'669', 'max_amount':'6692902'}, 'COP':{'code':'COP', 'title':'Colombian Peso', 'symbol':'COP', 'native':'$', 'thousands_sep':'.', 'decimal_sep':',', 'symbol_left':true, 'space_between':true, 'exp':2, 'min_amount':'410927', 'max_amount':'4109270000'}, 'CRC':{'code':'CRC', 'title':'Costa Rican Coln', 'symbol':'CRC', 'native':'', 'thousands_sep':'.', 'decimal_sep':',', 'symbol_left':true, 'space_between':false, 'exp':2, 'min_amount':'69166', 'max_amount':'691668622'}, 'CZK':{'code':'CZK', 'title':'Czech Koruna', 'symbol':'CZK', 'native':'K', 'thousands_sep':' ', 'decimal_sep':',', 'symbol_left':false, 'space_between':true, 'exp':2, 'min_amount':'2367', 'max_amount':'23674601'}, 'DKK':{'code':'DKK', 'title':'Danish Krone', 'symbol':'DKK', 'native':'kr', 'thousands_sep':'', 'decimal_sep':',', 'symbol_left':false, 'space_between':true, 'exp':2, 'min_amount':'712', 'max_amount':'7120540'}, 'DOP':{'code':'DOP', 'title':'Dominican Peso', 'symbol':'DOP', 'native':'$', 'thousands_sep':',', 'decimal_sep':'.', 'symbol_left':true, 'space_between':false, 'exp':2, 'min_amount':'5497', 'max_amount':'54971796'}, 'DZD':{'code':'DZD', 'title':'Algerian Dinar', 'symbol':'DZD', 'native':'..', 'thousands_sep':',', 'decimal_sep':'.', 'symbol_left':true, 'space_between':true, 'exp':2, 'min_amount':'14655', 'max_amount':'146557782'}, 'EGP':{'code':'EGP', 'title':'Egyptian Pound', 'symbol':'EGP', 'native':'..', 'thousands_sep':',', 'decimal_sep':'.', 'symbol_left':true, 'space_between':true, 'exp':2, 'min_amount':'1879', 'max_amount':'18794601'}, 'EUR':{'code':'EUR', 'title':'Euro', 'symbol':'', 'native':'', 'thousands_sep':' ', 'decimal_sep':',', 'symbol_left':false, 'space_between':true, 'exp':2, 'min_amount':'95', 'max_amount':'957150'}, 'GBP':{'code':'GBP', 'title':'British Pound', 'symbol':'', 'native':'', 'thousands_sep':',', 'decimal_sep':'.', 'symbol_left':true, 'space_between':false, 'exp':2, 'min_amount':'82', 'max_amount':'822531'}, 'GEL':{'code':'GEL', 'title':'Georgian Lari', 'symbol':'GEL', 'native':'GEL', 'thousands_sep':' ', 'decimal_sep':',', 'symbol_left':false, 'space_between':true, 'exp':2, 'min_amount':'293', 'max_amount':'2939866'}, 'GTQ':{'code':'GTQ', 'title':'Guatemalan Quetzal', 'symbol':'GTQ', 'native':'Q', 'thousands_sep':',', 'decimal_sep':'.', 'symbol_left':true, 'space_between':false, 'exp':2, 'min_amount':'781', 'max_amount':'7811180'}, 'HKD':{'code':'HKD', 'title':'Hong Kong Dollar', 'symbol':'HK$', 'native':'$', 'thousands_sep':',', 'decimal_sep':'.', 'symbol_left':true, 'space_between':false, 'exp':2, 'min_amount':'784', 'max_amount':'7845675'}, 'HNL':{'code':'HNL', 'title':'Honduran Lempira', 'symbol':'HNL', 'native':'L', 'thousands_sep':',', 'decimal_sep':'.', 'symbol_left':true, 'space_between':true, 'exp':2, 'min_amount':'2476', 'max_amount':'24763692'}, 'HRK':{'code':'HRK', 'title':'Croatian Kuna', 'symbol':'HRK', 'native':'kn', 'thousands_sep':'.', 'decimal_sep':',', 'symbol_left':false, 'space_between':true, 'exp':2, 'min_amount':'721', 'max_amount':'7210988'}, 'HUF':{'code':'HUF', 'title':'Hungarian Forint', 'symbol':'HUF', 'native':'Ft', 'thousands_sep':' ', 'decimal_sep':',', 'symbol_left':false, 'space_between':true, 'exp':2, 'min_amount':'37819', 'max_amount':'378197939'}, 'IDR':{'code':'IDR', 'title':'Indonesian Rupiah', 'symbol':'IDR', 'native':'Rp', 'thousands_sep':'.', 'decimal_sep':',', 'symbol_left':true, 'space_between':false, 'exp':2, 'min_amount':'1490695', 'max_amount':'14906950000'}, 'ILS':{'code':'ILS', 'title':'Israeli New Sheqel', 'symbol':'', 'native':'', 'thousands_sep':',', 'decimal_sep':'.', 'symbol_left':true, 'space_between':true, 'exp':2, 'min_amount':'348', 'max_amount':'3480155'}, 'INR':{'code':'INR', 'title':'Indian Rupee', 'symbol':'', 'native':'', 'thousands_sep':',', 'decimal_sep':'.', 'symbol_left':true, 'space_between':false, 'exp':2, 'min_amount':'7894', 'max_amount':'78945050'}, 'ISK':{'code':'ISK', 'title':'Icelandic Krna', 'symbol':'ISK', 'native':'kr', 'thousands_sep':'.', 'decimal_sep':',', 'symbol_left':false, 'space_between':true, 'exp':0, 'min_amount':'133', 'max_amount':'1336303'}, 'JMD':{'code':'JMD', 'title':'Jamaican Dollar', 'symbol':'JMD', 'native':'$', 'thousands_sep':',', 'decimal_sep':'.', 'symbol_left':true, 'space_between':false, 'exp':2, 'min_amount':'15175', 'max_amount':'151753529'}, 'JPY':{'code':'JPY', 'title':'Japanese Yen', 'symbol':'', 'native':'', 'thousands_sep':',', 'decimal_sep':'.', 'symbol_left':true, 'space_between':false, 'exp':0, 'min_amount':'136', 'max_amount':'1362010'}, 'KES':{'code':'KES', 'title':'Kenyan Shilling', 'symbol':'KES', 'native':'Ksh', 'thousands_sep':',', 'decimal_sep':'.', 'symbol_left':true, 'space_between':false, 'exp':2, 'min_amount':'11787', 'max_amount':'117879251'}, 'KGS':{'code':'KGS', 'title':'Kyrgyzstani Som', 'symbol':'KGS', 'native':'KGS', 'thousands_sep':' ', 'decimal_sep':'-', 'symbol_left':false, 'space_between':true, 'exp':2, 'min_amount':'7950', 'max_amount':'79509472'}, 'KRW':{'code':'KRW', 'title':'South Korean Won', 'symbol':'', 'native':'', 'thousands_sep':',', 'decimal_sep':'.', 'symbol_left':true, 'space_between':false, 'exp':0, 'min_amount':'1297', 'max_amount':'12971249'}, 'KZT':{'code':'KZT', 'title':'Kazakhstani Tenge', 'symbol':'KZT', 'native':'', 'thousands_sep':' ', 'decimal_sep':'-', 'symbol_left':true, 'space_between':false, 'exp':2, 'min_amount':'47177', 'max_amount':'471777437'}, 'LBP':{'code':'LBP', 'title':'Lebanese Pound', 'symbol':'LBP', 'native':'..', 'thousands_sep':',', 'decimal_sep':'.', 'symbol_left':true, 'space_between':true, 'exp':2, 'min_amount':'152338', 'max_amount':'1523381760'}, 'LKR':{'code':'LKR', 'title':'Sri Lankan Rupee', 'symbol':'LKR', 'native':'.', 'thousands_sep':',', 'decimal_sep':'.', 'symbol_left':true, 'space_between':true, 'exp':2, 'min_amount':'36271', 'max_amount':'362713465'}, 'MAD':{'code':'MAD', 'title':'Moroccan Dirham', 'symbol':'MAD', 'native':'..', 'thousands_sep':',', 'decimal_sep':'.', 'symbol_left':true, 'space_between':true, 'exp':2, 'min_amount':'1018', 'max_amount':'10188182'}, 'MDL':{'code':'MDL', 'title':'Moldovan Leu', 'symbol':'MDL', 'native':'MDL', 'thousands_sep':',', 'decimal_sep':'.', 'symbol_left':false, 'space_between':true, 'exp':2, 'min_amount':'1928', 'max_amount':'19284237'}, 'MNT':{'code':'MNT', 'title':'Mongolian Tgrg', 'symbol':'MNT', 'native':'MNT', 'thousands_sep':' ', 'decimal_sep':',', 'symbol_left':true, 'space_between':false, 'exp':2, 'min_amount':'312408', 'max_amount':'3124087599'}, 'MUR':{'code':'MUR', 'title':'Mauritian Rupee', 'symbol':'MUR', 'native':'MUR', 'thousands_sep':',', 'decimal_sep':'.', 'symbol_left':true, 'space_between':false, 'exp':2, 'min_amount':'4614', 'max_amount':'46144273'}, 'MVR':{'code':'MVR', 'title':'Maldivian Rufiyaa', 'symbol':'MVR', 'native':'MVR', 'thousands_sep':',', 'decimal_sep':'.', 'symbol_left':false, 'space_between':true, 'exp':2, 'min_amount':'1534', 'max_amount':'15349670'}, 'MXN':{'code':'MXN', 'title':'Mexican Peso', 'symbol':'MX$', 'native':'$', 'thousands_sep':',', 'decimal_sep':'.', 'symbol_left':true, 'space_between':false, 'exp':2, 'min_amount':'2015', 'max_amount':'20158770'}, 'MYR':{'code':'MYR', 'title':'Malaysian Ringgit', 'symbol':'MYR', 'native':'RM', 'thousands_sep':',', 'decimal_sep':'.', 'symbol_left':true, 'space_between':false, 'exp':2, 'min_amount':'440', 'max_amount':'4406499'}, 'MZN':{'code':'MZN', 'title':'Mozambican Metical', 'symbol':'MZN', 'native':'MTn', 'thousands_sep':',', 'decimal_sep':'.', 'symbol_left':true, 'space_between':false, 'exp':2, 'min_amount':'6383', 'max_amount':'63830365'}, 'NGN':{'code':'NGN', 'title':'Nigerian Naira', 'symbol':'NGN', 'native':'', 'thousands_sep':',', 'decimal_sep':'.', 'symbol_left':true, 'space_between':false, 'exp':2, 'min_amount':'41513', 'max_amount':'415132815'}, 'NIO':{'code':'NIO', 'title':'Nicaraguan Crdoba', 'symbol':'NIO', 'native':'C$', 'thousands_sep':',', 'decimal_sep':'.', 'symbol_left':true, 'space_between':true, 'exp':2, 'min_amount':'3612', 'max_amount':'36125609'}, 'NOK':{'code':'NOK', 'title':'Norwegian Krone', 'symbol':'NOK', 'native':'kr', 'thousands_sep':' ', 'decimal_sep':',', 'symbol_left':true, 'space_between':true, 'exp':2, 'min_amount':'990', 'max_amount':'9902585'}, 'NPR':{'code':'NPR', 'title':'Nepalese Rupee', 'symbol':'NPR', 'native':'', 'thousands_sep':',', 'decimal_sep':'.', 'symbol_left':true, 'space_between':false, 'exp':2, 'min_amount':'12731', 'max_amount':'127318435'}, 'NZD':{'code':'NZD', 'title':'New Zealand Dollar', 'symbol':'NZ$', 'native':'$', 'thousands_sep':',', 'decimal_sep':'.', 'symbol_left':true, 'space_between':false, 'exp':2, 'min_amount':'160', 'max_amount':'1603695'}, 'PAB':{'code':'PAB', 'title':'Panamanian Balboa', 'symbol':'PAB', 'native':'B\\/.', 'thousands_sep':',', 'decimal_sep':'.', 'symbol_left':true, 'space_between':true, 'exp':2, 'min_amount':'100', 'max_amount':'1007566'}, 'PEN':{'code':'PEN', 'title':'Peruvian Nuevo Sol', 'symbol':'PEN', 'native':'S\\/.', 'thousands_sep':',', 'decimal_sep':'.', 'symbol_left':true, 'space_between':true, 'exp':2, 'min_amount':'381', 'max_amount':'3818809'}, 'PHP':{'code':'PHP', 'title':'Philippine Peso', 'symbol':'PHP', 'native':'', 'thousands_sep':',', 'decimal_sep':'.', 'symbol_left':true, 'space_between':false, 'exp':2, 'min_amount':'5499', 'max_amount':'54994501'}, 'PKR':{'code':'PKR', 'title':'Pakistani Rupee', 'symbol':'PKR', 'native':'', 'thousands_sep':',', 'decimal_sep':'.', 'symbol_left':true, 'space_between':false, 'exp':2, 'min_amount':'20651', 'max_amount':'206515440'}, 'PLN':{'code':'PLN', 'title':'Polish Zoty', 'symbol':'PLN', 'native':'z', 'thousands_sep':' ', 'decimal_sep':',', 'symbol_left':false, 'space_between':true, 'exp':2, 'min_amount':'446', 'max_amount':'4466920'}, 'PYG':{'code':'PYG', 'title':'Paraguayan Guaran', 'symbol':'PYG', 'native':'', 'thousands_sep':'.', 'decimal_sep':',', 'symbol_left':true, 'space_between':true, 'exp':0, 'min_amount':'6909', 'max_amount':'69095662'}, 'QAR':{'code':'QAR', 'title':'Qatari Riyal', 'symbol':'QAR', 'native':'..', 'thousands_sep':',', 'decimal_sep':'.', 'symbol_left':true, 'space_between':true, 'exp':2, 'min_amount':'364', 'max_amount':'3640988'}, 'RON':{'code':'RON', 'title':'Romanian Leu', 'symbol':'RON', 'native':'RON', 'thousands_sep':'.', 'decimal_sep':',', 'symbol_left':false, 'space_between':true, 'exp':2, 'min_amount':'473', 'max_amount':'4736501'}, 'RSD':{'code':'RSD', 'title':'Serbian Dinar', 'symbol':'RSD', 'native':'.', 'thousands_sep':'.', 'decimal_sep':',', 'symbol_left':false, 'space_between':true, 'exp':2, 'min_amount':'11252', 'max_amount':'112520089'}, 'RUB':{'code':'RUB', 'title':'Russian Ruble', 'symbol':'RUB', 'native':'.', 'thousands_sep':' ', 'decimal_sep':',', 'symbol_left':false, 'space_between':true, 'exp':2, 'min_amount':'5282', 'max_amount':'52825030'}, 'SAR':{'code':'SAR', 'title':'Saudi Riyal', 'symbol':'SAR', 'native':'..', 'thousands_sep':',', 'decimal_sep':'.', 'symbol_left':true, 'space_between':true, 'exp':2, 'min_amount':'375', 'max_amount':'3752099'}, 'SEK':{'code':'SEK', 'title':'Swedish Krona', 'symbol':'SEK', 'native':'kr', 'thousands_sep':'.', 'decimal_sep':',', 'symbol_left':false, 'space_between':true, 'exp':2, 'min_amount':'1022', 'max_amount':'10224070'}, 'SGD':{'code':'SGD', 'title':'Singapore Dollar', 'symbol':'SGD', 'native':'$', 'thousands_sep':',', 'decimal_sep':'.', 'symbol_left':true, 'space_between':false, 'exp':2, 'min_amount':'139', 'max_amount':'1390698'}, 'THB':{'code':'THB', 'title':'Thai Baht', 'symbol':'', 'native':'', 'thousands_sep':',', 'decimal_sep':'.', 'symbol_left':true, 'space_between':false, 'exp':2, 'min_amount':'3529', 'max_amount':'35290499'}, 'TJS':{'code':'TJS', 'title':'Tajikistani Somoni', 'symbol':'TJS', 'native':'TJS', 'thousands_sep':' ', 'decimal_sep':';', 'symbol_left':false, 'space_between':true, 'exp':2, 'min_amount':'977', 'max_amount':'9773409'}, 'TRY':{'code':'TRY', 'title':'Turkish Lira', 'symbol':'TRY', 'native':'TL', 'thousands_sep':'.', 'decimal_sep':',', 'symbol_left':false, 'space_between':true, 'exp':2, 'min_amount':'1667', 'max_amount':'16673549'}, 'TTD':{'code':'TTD', 'title':'Trinidad and Tobago Dollar', 'symbol':'TTD', 'native':'$', 'thousands_sep':',', 'decimal_sep':'.', 'symbol_left':true, 'space_between':false, 'exp':2, 'min_amount':'684', 'max_amount':'6847347'}, 'TWD':{'code':'TWD', 'title':'New Taiwan Dollar', 'symbol':'NT$', 'native':'NT$', 'thousands_sep':',', 'decimal_sep':'.', 'symbol_left':true, 'space_between':false, 'exp':2, 'min_amount':'2973', 'max_amount':'29735499'}, 'TZS':{'code':'TZS', 'title':'Tanzanian Shilling', 'symbol':'TZS', 'native':'TSh', 'thousands_sep':',', 'decimal_sep':'.', 'symbol_left':true, 'space_between':false, 'exp':2, 'min_amount':'233200', 'max_amount':'2332000087'}, 'UAH':{'code':'UAH', 'title':'Ukrainian Hryvnia', 'symbol':'UAH', 'native':'', 'thousands_sep':' ', 'decimal_sep':',', 'symbol_left':false, 'space_between':false, 'exp':2, 'min_amount':'2974', 'max_amount':'29741945'}, 'UGX':{'code':'UGX', 'title':'Ugandan Shilling', 'symbol':'UGX', 'native':'USh', 'thousands_sep':',', 'decimal_sep':'.', 'symbol_left':true, 'space_between':false, 'exp':0, 'min_amount':'3788', 'max_amount':'37883728'}, 'USD':{'code':'USD', 'title':'United States Dollar', 'symbol':'$', 'native':'$', 'thousands_sep':',', 'decimal_sep':'.', 'symbol_left':true, 'space_between':false, 'exp':2, 'min_amount':'100', 'max_amount':1000000}, 'UYU':{'code':'UYU', 'title':'Uruguayan Peso', 'symbol':'UYU', 'native':'$', 'thousands_sep':'.', 'decimal_sep':',', 'symbol_left':true, 'space_between':true, 'exp':2, 'min_amount':'3979', 'max_amount':'39794286'}, 'UZS':{'code':'UZS', 'title':'Uzbekistani Som', 'symbol':'UZS', 'native':'UZS', 'thousands_sep':' ', 'decimal_sep':',', 'symbol_left':false, 'space_between':true, 'exp':2, 'min_amount':'1094209', 'max_amount':'10942099215'}, 'VND':{'code':'VND', 'title':'Vietnamese ng', 'symbol':'', 'native':'', 'thousands_sep':'.', 'decimal_sep':',', 'symbol_left':false, 'space_between':true, 'exp':0, 'min_amount':'23270', 'max_amount':'232700000'}, 'YER':{'code':'YER', 'title':'Yemeni Rial', 'symbol':'YER', 'native':'..', 'thousands_sep':',', 'decimal_sep':'.', 'symbol_left':true, 'space_between':true, 'exp':2, 'min_amount':'25024', 'max_amount':'250249914'}, 'ZAR':{'code':'ZAR', 'title':'South African Rand', 'symbol':'ZAR', 'native':'R', 'thousands_sep':',', 'decimal_sep':'.', 'symbol_left':true, 'space_between':true, 'exp':2, 'min_amount':'1624', 'max_amount':'16246189'}};\n\nexport default Currencies;\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport type {EMOJI_VERSION} from '../environment/emojiVersionsSupport';\n\nexport const EmojiVersions: {[version in EMOJI_VERSION]: {[emoji: string]: number}} = {'14':{'1f6dd':4867, '1f6de':4916, '1f6df':4923, '1f7f0':62832, '1f979':183, '1f9cc':1557, '1fa7b':61332, '1fa7c':61330, '1faa9':51093, '1faaa':61364, '1faab':61189, '1faac':51085, '1fab7':2651, '1fab8':2631, '1fab9':2672, '1faba':2673, '1fac3':1520, '1fac4':1521, '1fac5':1505, '1fad7':3793, '1fad8':3707, '1fad9':3804, '1fae0':111, '1fae1':136, '1fae2':132, '1fae3':133, '1fae4':174, '1fae5':142, '1fae6':1385, '1fae7':61353, '1faf0':1341, '1faf1':1332, '1faf2':1333, '1faf3':1334, '1faf4':1335, '1faf5':1351, '1faf6':1360, '1faf1-1f3fb-200d-1faf2-1f3fc':0, '1faf1-1f3fb-200d-1faf2-1f3fd':0, '1faf1-1f3fb-200d-1faf2-1f3fe':0, '1faf1-1f3fb-200d-1faf2-1f3ff':0, '1faf1-1f3fc-200d-1faf2-1f3fb':0, '1faf1-1f3fc-200d-1faf2-1f3fd':0, '1faf1-1f3fc-200d-1faf2-1f3fe':0, '1faf1-1f3fc-200d-1faf2-1f3ff':0, '1faf1-1f3fd-200d-1faf2-1f3fb':0, '1faf1-1f3fd-200d-1faf2-1f3fc':0, '1faf1-1f3fd-200d-1faf2-1f3fe':0, '1faf1-1f3fd-200d-1faf2-1f3ff':0, '1faf1-1f3fe-200d-1faf2-1f3fb':0, '1faf1-1f3fe-200d-1faf2-1f3fc':0, '1faf1-1f3fe-200d-1faf2-1f3fd':0, '1faf1-1f3fe-200d-1faf2-1f3ff':0, '1faf1-1f3ff-200d-1faf2-1f3fb':0, '1faf1-1f3ff-200d-1faf2-1f3fc':0, '1faf1-1f3ff-200d-1faf2-1f3fd':0, '1faf1-1f3ff-200d-1faf2-1f3fe':0, '1fac3-1f3fb':0, '1fac3-1f3fc':0, '1fac3-1f3fd':0, '1fac3-1f3fe':0, '1fac3-1f3ff':0, '1fac4-1f3fb':0, '1fac4-1f3fc':0, '1fac4-1f3fd':0, '1fac4-1f3fe':0, '1fac4-1f3ff':0, '1fac5-1f3fb':0, '1fac5-1f3fc':0, '1fac5-1f3fd':0, '1fac5-1f3fe':0, '1fac5-1f3ff':0, '1faf0-1f3fb':0, '1faf0-1f3fc':0, '1faf0-1f3fd':0, '1faf0-1f3fe':0, '1faf0-1f3ff':0, '1faf1-1f3fb':0, '1faf1-1f3fc':0, '1faf1-1f3fd':0, '1faf1-1f3fe':0, '1faf1-1f3ff':0, '1faf2-1f3fb':0, '1faf2-1f3fc':0, '1faf2-1f3fd':0, '1faf2-1f3fe':0, '1faf2-1f3ff':0, '1faf3-1f3fb':0, '1faf3-1f3fc':0, '1faf3-1f3fd':0, '1faf3-1f3fe':0, '1faf3-1f3ff':0, '1faf4-1f3fb':0, '1faf4-1f3fc':0, '1faf4-1f3fd':0, '1faf4-1f3fe':0, '1faf4-1f3ff':0, '1faf5-1f3fb':0, '1faf5-1f3fc':0, '1faf5-1f3fd':0, '1faf5-1f3fe':0, '1faf5-1f3ff':0, '1faf6-1f3fb':0, '1faf6-1f3fc':0, '1faf6-1f3fd':0, '1faf6-1f3fe':0, '1faf6-1f3ff':0}, '':{'2049':62835, '2122':62863, '2139':62888, '2194':62764, '2195':62763, '2196':62762, '2197':62756, '2198':62758, '2199':62760, '2328':61194, '2600':4990, '2601':4998, '2602':41013, '2603':41018, '2604':41020, '2611':62851, '2614':41014, '2615':3781, '2618':2667, '2620':1106, '2622':62753, '2623':62754, '2626':62783, '2638':62780, '2639':177, '2648':62788, '2649':62789, '2650':62796, '2651':62797, '2652':62798, '2653':62799, '2660':51095, '2663':51098, '2665':51096, '2666':51097, '2668':4865, '2692':61297, '2693':4922, '2694':61300, '2696':61311, '2697':61319, '2699':61309, '2702':61284, '2705':62850, '2708':4931, '2709':61245, '2712':61259, '2714':62852, '2716':62828, '2721':62779, '2728':51029, '2733':62858, '2734':62859, '2744':41017, '2747':62860, '2753':62836, '2754':62837, '2755':62838, '2757':62839, '2763':1137, '2764':1141, '2795':62829, '2796':62830, '2797':62831, '2934':62767, '2935':62768, '3030':62840, '3297':62912, '3299':62913, '0023-20e3':62864, '002a-20e3':62865, '0030-20e3':62866, '0031-20e3':62867, '0032-20e3':62868, '0033-20e3':62869, '0034-20e3':62870, '0035-20e3':62871, '0036-20e3':62872, '0037-20e3':62873, '0038-20e3':62874, '0039-20e3':62875, '00a9':62861, '00ae':62862, '1f004':51101, '1f0cf':51100, '1f170':62882, '1f171':62884, '1f17e':62893, '1f17f':62895, '1f18e':62883, '1f191':62885, '1f192':62886, '1f193':62887, '1f194':62889, '1f195':62891, '1f196':62892, '1f197':62894, '1f198':62896, '1f199':62897, '1f19a':62898, '1f1e6-1f1e8':71594, '1f1e6-1f1e9':71595, '1f1e6-1f1ea':71596, '1f1e6-1f1eb':71597, '1f1e6-1f1ec':71598, '1f1e6-1f1ee':71599, '1f1e6-1f1f1':71600, '1f1e6-1f1f2':71601, '1f1e6-1f1f4':71602, '1f1e6-1f1f6':71603, '1f1e6-1f1f7':71604, '1f1e6-1f1f8':71605, '1f1e6-1f1f9':71606, '1f1e6-1f1fa':71607, '1f1e6-1f1fc':71608, '1f1e6-1f1fd':71609, '1f1e6-1f1ff':71610, '1f1e7-1f1e6':71611, '1f1e7-1f1e7':71612, '1f1e7-1f1e9':71613, '1f1e7-1f1ea':71614, '1f1e7-1f1eb':71615, '1f1e7-1f1ec':71616, '1f1e7-1f1ed':71617, '1f1e7-1f1ee':71618, '1f1e7-1f1ef':71619, '1f1e7-1f1f1':71620, '1f1e7-1f1f2':71621, '1f1e7-1f1f3':71622, '1f1e7-1f1f4':71623, '1f1e7-1f1f6':71624, '1f1e7-1f1f7':71625, '1f1e7-1f1f8':71626, '1f1e7-1f1f9':71627, '1f1e7-1f1fb':71628, '1f1e7-1f1fc':71629, '1f1e7-1f1fe':71630, '1f1e7-1f1ff':71631, '1f1e8-1f1e6':71632, '1f1e8-1f1e8':71633, '1f1e8-1f1e9':71634, '1f1e8-1f1eb':71635, '1f1e8-1f1ec':71636, '1f1e8-1f1ed':71637, '1f1e8-1f1ee':71638, '1f1e8-1f1f0':71639, '1f1e8-1f1f1':71640, '1f1e8-1f1f2':71641, '1f1e8-1f1f3':71642, '1f1e8-1f1f4':71643, '1f1e8-1f1f5':71644, '1f1e8-1f1f7':71645, '1f1e8-1f1fa':71646, '1f1e8-1f1fb':71647, '1f1e8-1f1fc':71648, '1f1e8-1f1fd':71649, '1f1e8-1f1fe':71650, '1f1e8-1f1ff':71651, '1f1e9-1f1ea':71652, '1f1e9-1f1ec':71653, '1f1e9-1f1ef':71654, '1f1e9-1f1f0':71655, '1f1e9-1f1f2':71656, '1f1e9-1f1f4':71657, '1f1e9-1f1ff':71658, '1f1ea-1f1e6':71659, '1f1ea-1f1e8':71660, '1f1ea-1f1ea':71661, '1f1ea-1f1ec':71662, '1f1ea-1f1ed':71663, '1f1ea-1f1f7':71664, '1f1ea-1f1f8':71665, '1f1ea-1f1f9':71666, '1f1ea-1f1fa':71667, '1f1eb-1f1ee':71668, '1f1eb-1f1ef':71669, '1f1eb-1f1f0':71670, '1f1eb-1f1f2':71671, '1f1eb-1f1f4':71672, '1f1eb-1f1f7':71673, '1f1ec-1f1e6':71674, '1f1ec-1f1e7':71675, '1f1ec-1f1e9':71676, '1f1ec-1f1ea':71677, '1f1ec-1f1eb':71678, '1f1ec-1f1ec':71679, '1f1ec-1f1ed':71680, '1f1ec-1f1ee':71681, '1f1ec-1f1f1':71682, '1f1ec-1f1f2':71683, '1f1ec-1f1f3':71684, '1f1ec-1f1f5':71685, '1f1ec-1f1f6':71686, '1f1ec-1f1f7':71687, '1f1ec-1f1f8':71688, '1f1ec-1f1f9':71689, '1f1ec-1f1fa':71690, '1f1ec-1f1fc':71691, '1f1ec-1f1fe':71692, '1f1ed-1f1f0':71693, '1f1ed-1f1f2':71694, '1f1ed-1f1f3':71695, '1f1ed-1f1f7':71696, '1f1ed-1f1f9':71697, '1f1ed-1f1fa':71698, '1f1ee-1f1e8':71699, '1f1ee-1f1e9':71700, '1f1ee-1f1ea':71701, '1f1ee-1f1f1':71702, '1f1ee-1f1f2':71703, '1f1ee-1f1f3':71704, '1f1ee-1f1f4':71705, '1f1ee-1f1f6':71706, '1f1ee-1f1f7':71707, '1f1ee-1f1f8':71708, '1f1ee-1f1f9':71709, '1f1ef-1f1ea':71710, '1f1ef-1f1f2':71711, '1f1ef-1f1f4':71712, '1f1ef-1f1f5':71713, '1f1f0-1f1ea':71714, '1f1f0-1f1ec':71715, '1f1f0-1f1ed':71716, '1f1f0-1f1ee':71717, '1f1f0-1f1f2':71718, '1f1f0-1f1f3':71719, '1f1f0-1f1f5':71720, '1f1f0-1f1f7':71721, '1f1f0-1f1fc':71722, '1f1f0-1f1fe':71723, '1f1f0-1f1ff':71724, '1f1f1-1f1e6':71725, '1f1f1-1f1e7':71726, '1f1f1-1f1e8':71727, '1f1f1-1f1ee':71728, '1f1f1-1f1f0':71729, '1f1f1-1f1f7':71730, '1f1f1-1f1f8':71731, '1f1f1-1f1f9':71732, '1f1f1-1f1fa':71733, '1f1f1-1f1fb':71734, '1f1f1-1f1fe':71735, '1f1f2-1f1e6':71736, '1f1f2-1f1e8':71737, '1f1f2-1f1e9':71738, '1f1f2-1f1ea':71739, '1f1f2-1f1eb':71740, '1f1f2-1f1ec':71741, '1f1f2-1f1ed':71742, '1f1f2-1f1f0':71743, '1f1f2-1f1f1':71744, '1f1f2-1f1f2':71745, '1f1f2-1f1f3':71746, '1f1f2-1f1f4':71747, '1f1f2-1f1f5':71748, '1f1f2-1f1f6':71749, '1f1f2-1f1f7':71750, '1f1f2-1f1f8':71751, '1f1f2-1f1f9':71752, '1f1f2-1f1fa':71753, '1f1f2-1f1fb':71754, '1f1f2-1f1fc':71755, '1f1f2-1f1fd':71756, '1f1f2-1f1fe':71757, '1f1f2-1f1ff':71758, '1f1f3-1f1e6':71759, '1f1f3-1f1e8':71760, '1f1f3-1f1ea':71761, '1f1f3-1f1eb':71762, '1f1f3-1f1ec':71763, '1f1f3-1f1ee':71764, '1f1f3-1f1f1':71765, '1f1f3-1f1f4':71766, '1f1f3-1f1f5':71767, '1f1f3-1f1f7':71768, '1f1f3-1f1fa':71769, '1f1f3-1f1ff':71770, '1f1f4-1f1f2':71771, '1f1f5-1f1e6':71772, '1f1f5-1f1ea':71773, '1f1f5-1f1eb':71774, '1f1f5-1f1ec':71775, '1f1f5-1f1ed':71776, '1f1f5-1f1f0':71777, '1f1f5-1f1f1':71778, '1f1f5-1f1f2':71779, '1f1f5-1f1f3':71780, '1f1f5-1f1f7':71781, '1f1f5-1f1f8':71782, '1f1f5-1f1f9':71783, '1f1f5-1f1fc':71784, '1f1f5-1f1fe':71785, '1f1f6-1f1e6':71786, '1f1f7-1f1ea':71787, '1f1f7-1f1f4':71788, '1f1f7-1f1f8':71789, '1f1f7-1f1fa':71790, '1f1f7-1f1fc':71791, '1f1f8-1f1e6':71792, '1f1f8-1f1e7':71793, '1f1f8-1f1e8':71794, '1f1f8-1f1e9':71795, '1f1f8-1f1ea':71796, '1f1f8-1f1ec':71797, '1f1f8-1f1ed':71798, '1f1f8-1f1ee':71799, '1f1f8-1f1ef':71800, '1f1f8-1f1f0':71801, '1f1f8-1f1f1':71802, '1f1f8-1f1f2':71803, '1f1f8-1f1f3':71804, '1f1f8-1f1f4':71805, '1f1f8-1f1f7':71806, '1f1f8-1f1f8':71807, '1f1f8-1f1f9':71808, '1f1f8-1f1fb':71809, '1f1f8-1f1fd':71810, '1f1f8-1f1fe':71811, '1f1f8-1f1ff':71812, '1f1f9-1f1e6':71813, '1f1f9-1f1e8':71814, '1f1f9-1f1e9':71815, '1f1f9-1f1eb':71816, '1f1f9-1f1ec':71817, '1f1f9-1f1ed':71818, '1f1f9-1f1ef':71819, '1f1f9-1f1f0':71820, '1f1f9-1f1f1':71821, '1f1f9-1f1f2':71822, '1f1f9-1f1f3':71823, '1f1f9-1f1f4':71824, '1f1f9-1f1f7':71825, '1f1f9-1f1f9':71826, '1f1f9-1f1fb':71827, '1f1f9-1f1fc':71828, '1f1f9-1f1ff':71829, '1f1fa-1f1e6':71830, '1f1fa-1f1ec':71831, '1f1fa-1f1f2':71832, '1f1fa-1f1f3':71833, '1f1fa-1f1f8':71834, '1f1fa-1f1fe':71835, '1f1fa-1f1ff':71836, '1f1fb-1f1e6':71837, '1f1fb-1f1e8':71838, '1f1fb-1f1ea':71839, '1f1fb-1f1ec':71840, '1f1fb-1f1ee':71841, '1f1fb-1f1f3':71842, '1f1fb-1f1fa':71843, '1f1fc-1f1eb':71844, '1f1fc-1f1f8':71845, '1f1fd-1f1f0':71846, '1f1fe-1f1ea':71847, '1f1fe-1f1f9':71848, '1f1ff-1f1e6':71849, '1f1ff-1f1f2':71850, '1f1ff-1f1fc':71851, '1f201':62899, '1f202':62900, '1f21a':62906, '1f22f':62903, '1f232':62907, '1f233':62911, '1f234':62910, '1f235':62915, '1f236':62902, '1f237':62901, '1f238':62909, '1f239':62905, '1f23a':62914, '1f250':62904, '1f251':62908, '1f300':41010, '1f301':4857, '1f302':41012, '1f303':4858, '1f304':4860, '1f305':4861, '1f306':4862, '1f307':4863, '1f308':41011, '1f309':4864, '1f30a':41023, '1f30b':4815, '1f30c':4997, '1f30d':4806, '1f30e':4807, '1f30f':4808, '1f310':4809, '1f311':4977, '1f312':4978, '1f313':4979, '1f314':4980, '1f315':4981, '1f316':4982, '1f317':4983, '1f318':4984, '1f319':4985, '1f31a':4986, '1f31b':4987, '1f31c':4988, '1f31d':4991, '1f31e':4992, '1f31f':4995, '1f320':4996, '1f321':4989, '1f324':41001, '1f325':41002, '1f326':41003, '1f327':41004, '1f328':41005, '1f329':41006, '1f32a':41007, '1f32b':41008, '1f32c':41009, '1f32d':3725, '1f32e':3727, '1f32f':3728, '1f330':3708, '1f331':2659, '1f332':2661, '1f333':2662, '1f334':2663, '1f335':2664, '1f336':3698, '1f337':2658, '1f338':2649, '1f339':2653, '1f33a':2655, '1f33b':2656, '1f33c':2657, '1f33d':3697, '1f33e':2665, '1f33f':2666, '1f340':2668, '1f341':2669, '1f342':2670, '1f343':2671, '1f344':3705, '1f345':3690, '1f346':3694, '1f347':3674, '1f348':3675, '1f349':3676, '1f34a':3677, '1f34b':3678, '1f34c':3679, '1f34d':3680, '1f34e':3682, '1f34f':3683, '1f350':3684, '1f351':3685, '1f352':3686, '1f353':3687, '1f354':3722, '1f355':3724, '1f356':3718, '1f357':3719, '1f358':3744, '1f359':3745, '1f35a':3746, '1f35b':3747, '1f35c':3748, '1f35d':3749, '1f35e':3709, '1f35f':3723, '1f360':3750, '1f361':3756, '1f362':3751, '1f363':3752, '1f364':3753, '1f365':3754, '1f366':3765, '1f367':3766, '1f368':3767, '1f369':3768, '1f36a':3769, '1f36b':3774, '1f36c':3775, '1f36d':3776, '1f36e':3777, '1f36f':3778, '1f370':3771, '1f371':3743, '1f372':3735, '1f373':3733, '1f374':3801, '1f375':3783, '1f376':3784, '1f377':3786, '1f378':3787, '1f379':3788, '1f37a':3789, '1f37b':3790, '1f37c':3779, '1f37d':3800, '1f37e':3785, '1f37f':3739, '1f380':51040, '1f381':51041, '1f382':3770, '1f383':51024, '1f384':51025, '1f385':1527, '1f386':51026, '1f387':51027, '1f388':51030, '1f389':51031, '1f38a':51032, '1f38b':51033, '1f38c':71588, '1f38d':51034, '1f38e':51035, '1f38f':51036, '1f390':51037, '1f391':51038, '1f392':61134, '1f393':61147, '1f396':51045, '1f397':51042, '1f399':61167, '1f39a':61168, '1f39b':61169, '1f39e':61203, '1f39f':51043, '1f3a0':4866, '1f3a1':4868, '1f3a2':4869, '1f3a3':51072, '1f3a4':61170, '1f3a5':61202, '1f3a6':62819, '1f3a7':61171, '1f3a8':51105, '1f3a9':61146, '1f3aa':4871, '1f3ab':51044, '1f3ac':61205, '1f3ad':51103, '1f3ae':51086, '1f3af':51078, '1f3b0':51088, '1f3b1':51081, '1f3b2':51089, '1f3b3':51060, '1f3b4':51102, '1f3b5':61165, '1f3b6':61166, '1f3b7':61173, '1f3b8':61175, '1f3b9':61176, '1f3ba':61177, '1f3bb':61178, '1f3bc':61164, '1f3bd':51074, '1f3be':51058, '1f3bf':51075, '1f3c0':51054, '1f3c1':71586, '1f3c2':1600, '1f3c3-200d-2640':1584, '1f3c3-200d-2642':1583, '1f3c3':1582, '1f3c4-200d-2640':1606, '1f3c4-200d-2642':1605, '1f3c4':1604, '1f3c5':51047, '1f3c6':51046, '1f3c7':1598, '1f3c8':51056, '1f3c9':51057, '1f3ca-200d-2640':1612, '1f3ca-200d-2642':1611, '1f3ca':1610, '1f3cb-200d-2640':1618, '1f3cb-200d-2642':1617, '1f3cb':1616, '1f3cc-200d-2640':1603, '1f3cc-200d-2642':1602, '1f3cc':1601, '1f3cd':4902, '1f3ce':4901, '1f3cf':51061, '1f3d0':51055, '1f3d1':51062, '1f3d2':51063, '1f3d3':51065, '1f3d4':4813, '1f3d5':4817, '1f3d6':4818, '1f3d7':4824, '1f3d8':4829, '1f3d9':4859, '1f3da':4830, '1f3db':4823, '1f3dc':4819, '1f3dd':4820, '1f3de':4821, '1f3df':4822, '1f3e0':4831, '1f3e1':4832, '1f3e2':4833, '1f3e3':4834, '1f3e4':4835, '1f3e5':4836, '1f3e6':4837, '1f3e7':62729, '1f3e8':4838, '1f3e9':4839, '1f3ea':4840, '1f3eb':4841, '1f3ec':4842, '1f3ed':4843, '1f3ee':61216, '1f3ef':4844, '1f3f0':4845, '1f3f3-200d-1f308':71591, '1f3f3-200d-26a7':71592, '1f3f3':71590, '1f3f4-200d-2620':71593, '1f3f4-e0067-e0062-e0065-e006e-e0067-e007f':71852, '1f3f4-e0067-e0062-e0073-e0063-e0074-e007f':71853, '1f3f4-e0067-e0062-e0077-e006c-e0073-e007f':71854, '1f3f4':71589, '1f3f5':2652, '1f3f7':61234, '1f3f8':51066, '1f3f9':61303, '1f3fa':3805, '1f3fb':9525, '1f3fc':9526, '1f3fd':9527, '1f3fe':9528, '1f3ff':9529, '1f400':2576, '1f401':2575, '1f402':2556, '1f403':2557, '1f404':2558, '1f405':2547, '1f406':2548, '1f407':2579, '1f408-200d-2b1b':2544, '1f408':2543, '1f409':2618, '1f40a':2613, '1f40b':2622, '1f40c':2632, '1f40d':2616, '1f40e':2550, '1f40f':2563, '1f410':2565, '1f411':2564, '1f412':2531, '1f413':2596, '1f414':2595, '1f415-200d-1f9ba':2537, '1f415':2535, '1f416':2560, '1f417':2561, '1f418':2570, '1f419':2629, '1f41a':2630, '1f41b':2634, '1f41c':2635, '1f41d':2636, '1f41e':2638, '1f41f':2625, '1f420':2626, '1f421':2627, '1f422':2614, '1f423':2597, '1f424':2598, '1f425':2599, '1f426':2600, '1f427':2601, '1f428':2586, '1f429':2538, '1f42a':2566, '1f42b':2567, '1f42c':2623, '1f42d':2574, '1f42e':2555, '1f42f':2546, '1f430':2578, '1f431':2542, '1f432':2617, '1f433':2621, '1f434':2549, '1f435':2530, '1f436':2534, '1f437':2559, '1f438':2612, '1f439':2577, '1f43a':2539, '1f43b-200d-2744':2585, '1f43b':2584, '1f43c':2587, '1f43d':2562, '1f43e':2593, '1f43f':2580, '1f440':1381, '1f441-200d-1f5e8':1159, '1f441':1382, '1f442':1373, '1f443':1375, '1f444':1384, '1f445':1383, '1f446':1347, '1f447':1349, '1f448':1345, '1f449':1346, '1f44a':1355, '1f44b':1327, '1f44c':1336, '1f44d':1352, '1f44e':1353, '1f44f':1358, '1f450':1361, '1f451':61144, '1f452':61145, '1f453':61110, '1f454':61115, '1f455':61116, '1f456':61117, '1f457':61122, '1f458':61123, '1f459':61128, '1f45a':61129, '1f45b':61130, '1f45c':61131, '1f45d':61132, '1f45e':61136, '1f45f':61137, '1f460':61140, '1f461':61141, '1f462':61143, '1f463':1687, '1f464':1684, '1f465':1685, '1f466':1388, '1f467':1389, '1f468-200d-1f33e':1457, '1f468-200d-1f373':1460, '1f468-200d-1f37c':1524, '1f468-200d-1f393':1448, '1f468-200d-1f3a4':1478, '1f468-200d-1f3a8':1481, '1f468-200d-1f3eb':1451, '1f468-200d-1f3ed':1466, '1f468-200d-1f466-200d-1f466':1674, '1f468-200d-1f466':1673, '1f468-200d-1f467-200d-1f466':1676, '1f468-200d-1f467-200d-1f467':1677, '1f468-200d-1f467':1675, '1f468-200d-1f468-200d-1f466':1663, '1f468-200d-1f468-200d-1f466-200d-1f466':1666, '1f468-200d-1f468-200d-1f467':1664, '1f468-200d-1f468-200d-1f467-200d-1f466':1665, '1f468-200d-1f468-200d-1f467-200d-1f467':1667, '1f468-200d-1f469-200d-1f466':1658, '1f468-200d-1f469-200d-1f466-200d-1f466':1661, '1f468-200d-1f469-200d-1f467':1659, '1f468-200d-1f469-200d-1f467-200d-1f466':1660, '1f468-200d-1f469-200d-1f467-200d-1f467':1662, '1f468-200d-1f4bb':1475, '1f468-200d-1f4bc':1469, '1f468-200d-1f527':1463, '1f468-200d-1f52c':1472, '1f468-200d-1f680':1487, '1f468-200d-1f692':1490, '1f468-200d-1f9af':1574, '1f468-200d-1f9b0':1396, '1f468-200d-1f9b1':1397, '1f468-200d-1f9b2':1399, '1f468-200d-1f9b3':1398, '1f468-200d-1f9bc':1577, '1f468-200d-1f9bd':1580, '1f468-200d-2695':1445, '1f468-200d-2696':1454, '1f468-200d-2708':1484, '1f468-200d-2764-200d-1f468':1655, '1f468-200d-2764-200d-1f48b-200d-1f468':1651, '1f468':1392, '1f469-200d-1f33e':1458, '1f469-200d-1f373':1461, '1f469-200d-1f37c':1523, '1f469-200d-1f393':1449, '1f469-200d-1f3a4':1479, '1f469-200d-1f3a8':1482, '1f469-200d-1f3eb':1452, '1f469-200d-1f3ed':1467, '1f469-200d-1f466-200d-1f466':1679, '1f469-200d-1f466':1678, '1f469-200d-1f467-200d-1f466':1681, '1f469-200d-1f467-200d-1f467':1682, '1f469-200d-1f467':1680, '1f469-200d-1f469-200d-1f466':1668, '1f469-200d-1f469-200d-1f466-200d-1f466':1671, '1f469-200d-1f469-200d-1f467':1669, '1f469-200d-1f469-200d-1f467-200d-1f466':1670, '1f469-200d-1f469-200d-1f467-200d-1f467':1672, '1f469-200d-1f4bb':1476, '1f469-200d-1f4bc':1470, '1f469-200d-1f527':1464, '1f469-200d-1f52c':1473, '1f469-200d-1f680':1488, '1f469-200d-1f692':1491, '1f469-200d-1f9af':1575, '1f469-200d-1f9b0':1401, '1f469-200d-1f9b1':1403, '1f469-200d-1f9b2':1407, '1f469-200d-1f9b3':1405, '1f469-200d-1f9bc':1578, '1f469-200d-1f9bd':1581, '1f469-200d-2695':1446, '1f469-200d-2696':1455, '1f469-200d-2708':1485, '1f469-200d-2764-200d-1f468':1654, '1f469-200d-2764-200d-1f469':1656, '1f469-200d-2764-200d-1f48b-200d-1f468':1650, '1f469-200d-2764-200d-1f48b-200d-1f469':1652, '1f469':1400, '1f46a':1657, '1f46b':1647, '1f46c':1648, '1f46d':1646, '1f46e-200d-2640':1494, '1f46e-200d-2642':1493, '1f46e':1492, '1f46f-200d-2640':1590, '1f46f-200d-2642':1589, '1f46f':1588, '1f470-200d-2640':1518, '1f470-200d-2642':1517, '1f470':1516, '1f471-200d-2640':1409, '1f471-200d-2642':1410, '1f471':1391, '1f472':1511, '1f473-200d-2640':1510, '1f473-200d-2642':1509, '1f473':1508, '1f474':1412, '1f475':1413, '1f476':1386, '1f477-200d-2640':1504, '1f477-200d-2642':1503, '1f477':1502, '1f478':1507, '1f479':1109, '1f47a':1110, '1f47b':1111, '1f47c':1526, '1f47d':1112, '1f47e':1113, '1f47f':1104, '1f480':1105, '1f481-200d-2640':1428, '1f481-200d-2642':1427, '1f481':1426, '1f482-200d-2640':1500, '1f482-200d-2642':1499, '1f482':1498, '1f483':1585, '1f484':61152, '1f485':1366, '1f486-200d-2640':1560, '1f486-200d-2642':1559, '1f486':1558, '1f487-200d-2640':1563, '1f487-200d-2642':1562, '1f487':1561, '1f488':4870, '1f489':61326, '1f48a':61328, '1f48b':1127, '1f48c':1128, '1f48d':61153, '1f48e':61154, '1f48f':1649, '1f490':2648, '1f491':1653, '1f492':4846, '1f493':1133, '1f494':1138, '1f495':1135, '1f496':1131, '1f497':1132, '1f498':1129, '1f499':1145, '1f49a':1144, '1f49b':1143, '1f49c':1146, '1f49d':1130, '1f49e':1134, '1f49f':1136, '1f4a0':62946, '1f4a1':61214, '1f4a2':1151, '1f4a3':1157, '1f4a4':1163, '1f4a5':1152, '1f4a6':1154, '1f4a7':41022, '1f4a8':1155, '1f4a9':1107, '1f4aa':1368, '1f4ab':1153, '1f4ac':1158, '1f4ad':1162, '1f4ae':2650, '1f4af':1150, '1f4b0':61235, '1f4b1':62841, '1f4b2':62842, '1f4b3':61242, '1f4b4':61237, '1f4b5':61238, '1f4b6':61239, '1f4b7':61240, '1f4b8':61241, '1f4b9':61244, '1f4ba':4936, '1f4bb':61191, '1f4bc':61265, '1f4bd':61197, '1f4be':61198, '1f4bf':61199, '1f4c0':61200, '1f4c1':61266, '1f4c2':61267, '1f4c3':61227, '1f4c4':61229, '1f4c5':61269, '1f4c6':61270, '1f4c7':61273, '1f4c8':61274, '1f4c9':61275, '1f4ca':61276, '1f4cb':61277, '1f4cc':61278, '1f4cd':61279, '1f4ce':61280, '1f4cf':61282, '1f4d0':61283, '1f4d1':61232, '1f4d2':61226, '1f4d3':61225, '1f4d4':61218, '1f4d5':61219, '1f4d6':61220, '1f4d7':61221, '1f4d8':61222, '1f4d9':61223, '1f4da':61224, '1f4db':62847, '1f4dc':61228, '1f4dd':61264, '1f4de':61185, '1f4df':61186, '1f4e0':61187, '1f4e1':61325, '1f4e2':61159, '1f4e3':61160, '1f4e4':61249, '1f4e5':61250, '1f4e6':61251, '1f4e7':61246, '1f4e8':61247, '1f4e9':61248, '1f4ea':61253, '1f4eb':61252, '1f4ec':61254, '1f4ed':61255, '1f4ee':61256, '1f4ef':61161, '1f4f0':61230, '1f4f1':61182, '1f4f2':61183, '1f4f3':62823, '1f4f4':62824, '1f4f5':62751, '1f4f6':62822, '1f4f7':61207, '1f4f8':61208, '1f4f9':61209, '1f4fa':61206, '1f4fb':61172, '1f4fc':61210, '1f4fd':61204, '1f4ff':61151, '1f500':62801, '1f501':62802, '1f502':62803, '1f503':62769, '1f504':62770, '1f505':62820, '1f506':62821, '1f507':61155, '1f508':61156, '1f509':61157, '1f50a':61158, '1f50b':61188, '1f50c':61190, '1f50d':61211, '1f50e':61212, '1f50f':61290, '1f510':61291, '1f511':61292, '1f512':61288, '1f513':61289, '1f514':61162, '1f515':61163, '1f516':61233, '1f517':61313, '1f518':62947, '1f519':62771, '1f51a':62772, '1f51b':62773, '1f51c':62774, '1f51d':62775, '1f51e':62752, '1f51f':62876, '1f520':62877, '1f521':62878, '1f522':62879, '1f523':62880, '1f524':62881, '1f525':41021, '1f526':61215, '1f527':61306, '1f528':61294, '1f529':61308, '1f52a':3803, '1f52b':61301, '1f52c':61323, '1f52d':61324, '1f52e':51082, '1f52f':62787, '1f530':62848, '1f531':62846, '1f532':62949, '1f533':62948, '1f534':62916, '1f535':62920, '1f536':62940, '1f537':62941, '1f538':62942, '1f539':62943, '1f53a':62944, '1f53b':62945, '1f53c':62811, '1f53d':62813, '1f549':62778, '1f54a':2602, '1f54b':4854, '1f54c':4850, '1f54d':4852, '1f54e':62786, '1f550':4955, '1f551':4957, '1f552':4959, '1f553':4961, '1f554':4963, '1f555':4965, '1f556':4967, '1f557':4969, '1f558':4971, '1f559':4973, '1f55a':4975, '1f55b':4953, '1f55c':4956, '1f55d':4958, '1f55e':4960, '1f55f':4962, '1f560':4964, '1f561':4966, '1f562':4968, '1f563':4970, '1f564':4972, '1f565':4974, '1f566':4976, '1f567':4954, '1f56f':61213, '1f570':4952, '1f573':1156, '1f574':1587, '1f575-200d-2640':1497, '1f575-200d-2642':1496, '1f575':1495, '1f576':61111, '1f577':2641, '1f578':2642, '1f579':51087, '1f57a':1586, '1f587':61281, '1f58a':61261, '1f58b':61260, '1f58c':61262, '1f58d':61263, '1f590':1329, '1f595':1348, '1f596':1331, '1f5a4':1148, '1f5a5':61192, '1f5a8':61193, '1f5b1':61195, '1f5b2':61196, '1f5bc':51104, '1f5c2':61268, '1f5c3':61285, '1f5c4':61286, '1f5d1':61287, '1f5d2':61271, '1f5d3':61272, '1f5dc':61310, '1f5dd':61293, '1f5de':61231, '1f5e1':61299, '1f5e3':1683, '1f5e8':1160, '1f5ef':1161, '1f5f3':61257, '1f5fa':4810, '1f5fb':4816, '1f5fc':4847, '1f5fd':4848, '1f5fe':4811, '1f5ff':61362, '1f600':11, '1f601':14, '1f602':18, '1f603':12, '1f604':13, '1f605':16, '1f606':15, '1f607':114, '1f608':1103, '1f609':112, '1f60a':113, '1f60b':124, '1f60c':150, '1f60d':116, '1f60e':170, '1f60f':144, '1f610':139, '1f611':140, '1f612':145, '1f613':195, '1f614':151, '1f615':173, '1f616':192, '1f617':119, '1f618':118, '1f619':122, '1f61a':121, '1f61b':125, '1f61c':126, '1f61d':128, '1f61e':194, '1f61f':175, '1f620':1101, '1f621':1100, '1f622':189, '1f623':193, '1f624':199, '1f625':188, '1f626':184, '1f627':185, '1f628':186, '1f629':196, '1f62a':152, '1f62b':197, '1f62c':147, '1f62d':190, '1f62e-200d-1f4a8':148, '1f62e':178, '1f62f':179, '1f630':187, '1f631':191, '1f632':180, '1f633':181, '1f634':154, '1f635-200d-1f4ab':165, '1f635':164, '1f636-200d-1f32b':143, '1f636':141, '1f637':155, '1f638':1116, '1f639':1117, '1f63a':1115, '1f63b':1118, '1f63c':1119, '1f63d':1120, '1f63e':1123, '1f63f':1122, '1f640':1121, '1f641':176, '1f642':19, '1f643':110, '1f644':146, '1f645-200d-2640':1422, '1f645-200d-2642':1421, '1f645':1420, '1f646-200d-2640':1425, '1f646-200d-2642':1424, '1f646':1423, '1f647-200d-2640':1437, '1f647-200d-2642':1436, '1f647':1435, '1f648':1124, '1f649':1125, '1f64a':1126, '1f64b-200d-2640':1431, '1f64b-200d-2642':1430, '1f64b':1429, '1f64c':1359, '1f64d-200d-2640':1416, '1f64d-200d-2642':1415, '1f64d':1414, '1f64e-200d-2640':1419, '1f64e-200d-2642':1418, '1f64e':1417, '1f64f':1364, '1f680':4942, '1f681':4937, '1f682':4872, '1f683':4873, '1f684':4874, '1f685':4875, '1f686':4876, '1f687':4877, '1f688':4878, '1f689':4879, '1f68a':4880, '1f68b':4883, '1f68c':4884, '1f68d':4885, '1f68e':4886, '1f68f':4911, '1f690':4887, '1f691':4888, '1f692':4889, '1f693':4890, '1f694':4891, '1f695':4892, '1f696':4893, '1f697':4894, '1f698':4895, '1f699':4896, '1f69a':4898, '1f69b':4899, '1f69c':4900, '1f69d':4881, '1f69e':4882, '1f69f':4938, '1f6a0':4939, '1f6a1':4940, '1f6a2':4930, '1f6a3-200d-2640':1609, '1f6a3-200d-2642':1608, '1f6a3':1607, '1f6a4':4926, '1f6a5':4918, '1f6a6':4919, '1f6a7':4921, '1f6a8':4917, '1f6a9':71587, '1f6aa':61333, '1f6ab':62745, '1f6ac':61358, '1f6ad':62747, '1f6ae':62730, '1f6af':62748, '1f6b0':62731, '1f6b1':62749, '1f6b2':4907, '1f6b3':62746, '1f6b4-200d-2640':1621, '1f6b4-200d-2642':1620, '1f6b4':1619, '1f6b5-200d-2640':1624, '1f6b5-200d-2642':1623, '1f6b5':1622, '1f6b6-200d-2640':1566, '1f6b6-200d-2642':1565, '1f6b6':1564, '1f6b7':62750, '1f6b8':62743, '1f6b9':62733, '1f6ba':62734, '1f6bb':62735, '1f6bc':62736, '1f6bd':61340, '1f6be':62737, '1f6bf':61342, '1f6c0':1643, '1f6c1':61343, '1f6c2':62738, '1f6c3':62739, '1f6c4':62740, '1f6c5':62741, '1f6cb':61338, '1f6cc':1644, '1f6cd':61133, '1f6ce':4944, '1f6cf':61337, '1f6d0':62776, '1f6d1':4920, '1f6d2':61357, '1f6d5':4851, '1f6d6':4828, '1f6d7':61334, '1f6e0':61298, '1f6e1':61304, '1f6e2':4914, '1f6e3':4912, '1f6e4':4913, '1f6e5':4929, '1f6e9':4932, '1f6eb':4933, '1f6ec':4934, '1f6f0':4941, '1f6f3':4927, '1f6f4':4908, '1f6f5':4903, '1f6f6':4925, '1f6f7':51076, '1f6f8':4943, '1f6f9':4909, '1f6fa':4906, '1f6fb':4897, '1f6fc':4910, '1f7e0':62917, '1f7e1':62918, '1f7e2':62919, '1f7e3':62921, '1f7e4':62922, '1f7e5':62925, '1f7e6':62929, '1f7e7':62926, '1f7e8':62927, '1f7e9':62928, '1f7ea':62930, '1f7eb':62931, '1f90c':1337, '1f90d':1149, '1f90e':1147, '1f90f':1338, '1f910':137, '1f911':129, '1f912':156, '1f913':171, '1f914':135, '1f915':157, '1f916':1114, '1f917':130, '1f918':1343, '1f919':1344, '1f91a':1328, '1f91b':1356, '1f91c':1357, '1f91d':1363, '1f91e':1340, '1f91f':1342, '1f920':167, '1f921':1108, '1f922':158, '1f923':17, '1f924':153, '1f925':149, '1f926-200d-2640':1440, '1f926-200d-2642':1439, '1f926':1438, '1f927':160, '1f928':138, '1f929':117, '1f92a':127, '1f92b':134, '1f92c':1102, '1f92d':131, '1f92e':159, '1f92f':166, '1f930':1519, '1f931':1522, '1f932':1362, '1f933':1367, '1f934':1506, '1f935-200d-2640':1515, '1f935-200d-2642':1514, '1f935':1513, '1f936':1528, '1f937-200d-2640':1443, '1f937-200d-2642':1442, '1f937':1441, '1f938-200d-2640':1627, '1f938-200d-2642':1626, '1f938':1625, '1f939-200d-2640':1639, '1f939-200d-2642':1638, '1f939':1637, '1f93a':1597, '1f93c-200d-2640':1630, '1f93c-200d-2642':1629, '1f93c':1628, '1f93d-200d-2640':1633, '1f93d-200d-2642':1632, '1f93d':1631, '1f93e-200d-2640':1636, '1f93e-200d-2642':1635, '1f93e':1634, '1f93f':51073, '1f940':2654, '1f941':61180, '1f942':3791, '1f943':3792, '1f944':3802, '1f945':51069, '1f947':51048, '1f948':51049, '1f949':51050, '1f94a':51067, '1f94b':51068, '1f94c':51077, '1f94d':51064, '1f94e':51053, '1f94f':51059, '1f950':3710, '1f951':3693, '1f952':3700, '1f953':3721, '1f954':3695, '1f955':3696, '1f956':3711, '1f957':3738, '1f958':3734, '1f959':3730, '1f95a':3732, '1f95b':3780, '1f95c':3706, '1f95d':3689, '1f95e':3715, '1f95f':3757, '1f960':3758, '1f961':3759, '1f962':3799, '1f963':3737, '1f964':3794, '1f965':3692, '1f966':3702, '1f967':3773, '1f968':3713, '1f969':3720, '1f96a':3726, '1f96b':3742, '1f96c':3701, '1f96d':3681, '1f96e':3755, '1f96f':3714, '1f970':115, '1f971':198, '1f972':123, '1f973':168, '1f974':163, '1f975':161, '1f976':162, '1f977':1501, '1f978':169, '1f97a':182, '1f97b':61124, '1f97c':61113, '1f97d':61112, '1f97e':61138, '1f97f':61139, '1f980':3760, '1f981':2545, '1f982':2643, '1f983':2594, '1f984':2551, '1f985':2603, '1f986':2604, '1f987':2583, '1f988':2628, '1f989':2606, '1f98a':2540, '1f98b':2633, '1f98c':2553, '1f98d':2532, '1f98e':2615, '1f98f':2572, '1f990':3762, '1f991':3763, '1f992':2569, '1f993':2552, '1f994':2582, '1f995':2619, '1f996':2620, '1f997':2639, '1f998':2591, '1f999':2568, '1f99a':2610, '1f99b':2573, '1f99c':2611, '1f99d':2541, '1f99e':3761, '1f99f':2644, '1f9a0':2647, '1f9a1':2592, '1f9a2':2605, '1f9a3':2571, '1f9a4':2607, '1f9a5':2588, '1f9a6':2589, '1f9a7':2533, '1f9a8':2590, '1f9a9':2609, '1f9aa':3764, '1f9ab':2581, '1f9ac':2554, '1f9ad':2624, '1f9ae':2536, '1f9af':61312, '1f9b4':1380, '1f9b5':1371, '1f9b6':1372, '1f9b7':1379, '1f9b8-200d-2640':1532, '1f9b8-200d-2642':1531, '1f9b8':1530, '1f9b9-200d-2640':1535, '1f9b9-200d-2642':1534, '1f9b9':1533, '1f9ba':61114, '1f9bb':1374, '1f9bc':4905, '1f9bd':4904, '1f9be':1369, '1f9bf':1370, '1f9c0':3717, '1f9c1':3772, '1f9c2':3741, '1f9c3':3796, '1f9c4':3703, '1f9c5':3704, '1f9c6':3731, '1f9c7':3716, '1f9c8':3740, '1f9c9':3797, '1f9ca':3798, '1f9cb':3795, '1f9cd-200d-2640':1569, '1f9cd-200d-2642':1568, '1f9cd':1567, '1f9ce-200d-2640':1572, '1f9ce-200d-2642':1571, '1f9ce':1570, '1f9cf-200d-2640':1434, '1f9cf-200d-2642':1433, '1f9cf':1432, '1f9d0':172, '1f9d1-200d-1f33e':1456, '1f9d1-200d-1f373':1459, '1f9d1-200d-1f37c':1525, '1f9d1-200d-1f384':1529, '1f9d1-200d-1f393':1447, '1f9d1-200d-1f3a4':1477, '1f9d1-200d-1f3a8':1480, '1f9d1-200d-1f3eb':1450, '1f9d1-200d-1f3ed':1465, '1f9d1-200d-1f4bb':1474, '1f9d1-200d-1f4bc':1468, '1f9d1-200d-1f527':1462, '1f9d1-200d-1f52c':1471, '1f9d1-200d-1f680':1486, '1f9d1-200d-1f692':1489, '1f9d1-200d-1f91d-200d-1f9d1':1645, '1f9d1-200d-1f9af':1573, '1f9d1-200d-1f9b0':1402, '1f9d1-200d-1f9b1':1404, '1f9d1-200d-1f9b2':1408, '1f9d1-200d-1f9b3':1406, '1f9d1-200d-1f9bc':1576, '1f9d1-200d-1f9bd':1579, '1f9d1-200d-2695':1444, '1f9d1-200d-2696':1453, '1f9d1-200d-2708':1483, '1f9d1':1390, '1f9d2':1387, '1f9d3':1411, '1f9d4-200d-2640':1395, '1f9d4-200d-2642':1394, '1f9d4':1393, '1f9d5':1512, '1f9d6-200d-2640':1593, '1f9d6-200d-2642':1592, '1f9d6':1591, '1f9d7-200d-2640':1596, '1f9d7-200d-2642':1595, '1f9d7':1594, '1f9d8-200d-2640':1642, '1f9d8-200d-2642':1641, '1f9d8':1640, '1f9d9-200d-2640':1538, '1f9d9-200d-2642':1537, '1f9d9':1536, '1f9da-200d-2640':1541, '1f9da-200d-2642':1540, '1f9da':1539, '1f9db-200d-2640':1544, '1f9db-200d-2642':1543, '1f9db':1542, '1f9dc-200d-2640':1547, '1f9dc-200d-2642':1546, '1f9dc':1545, '1f9dd-200d-2640':1550, '1f9dd-200d-2642':1549, '1f9dd':1548, '1f9de-200d-2640':1553, '1f9de-200d-2642':1552, '1f9de':1551, '1f9df-200d-2640':1556, '1f9df-200d-2642':1555, '1f9df':1554, '1f9e0':1376, '1f9e1':1142, '1f9e2':61148, '1f9e3':61118, '1f9e4':61119, '1f9e5':61120, '1f9e6':61121, '1f9e7':51039, '1f9e8':51028, '1f9e9':51090, '1f9ea':61320, '1f9eb':61321, '1f9ec':61322, '1f9ed':4812, '1f9ee':61201, '1f9ef':61356, '1f9f0':61316, '1f9f1':4825, '1f9f2':61317, '1f9f3':4945, '1f9f4':61346, '1f9f5':51106, '1f9f6':51108, '1f9f7':61347, '1f9f8':51091, '1f9f9':61348, '1f9fa':61349, '1f9fb':61350, '1f9fc':61352, '1f9fd':61355, '1f9fe':61243, '1f9ff':51084, '1fa70':61142, '1fa71':61125, '1fa72':61126, '1fa73':61127, '1fa74':61135, '1fa78':61327, '1fa79':61329, '1fa7a':61331, '1fa80':51079, '1fa81':51080, '1fa82':4935, '1fa83':61302, '1fa84':51083, '1fa85':51092, '1fa86':51094, '1fa90':4993, '1fa91':61339, '1fa92':61345, '1fa93':61295, '1fa94':61217, '1fa95':61179, '1fa96':61149, '1fa97':61174, '1fa98':61181, '1fa99':61236, '1fa9a':61305, '1fa9b':61307, '1fa9c':61318, '1fa9d':61315, '1fa9e':61335, '1fa9f':61336, '1faa0':61341, '1faa1':51107, '1faa2':51109, '1faa3':61351, '1faa4':61344, '1faa5':61354, '1faa6':61360, '1faa7':61363, '1faa8':4826, '1fab0':2645, '1fab1':2646, '1fab2':2637, '1fab3':2640, '1fab4':2660, '1fab5':4827, '1fab6':2608, '1fac0':1377, '1fac1':1378, '1fac2':1686, '1fad0':3688, '1fad1':3699, '1fad2':3691, '1fad3':3712, '1fad4':3729, '1fad5':3736, '1fad6':3782, '203c':62834, '21a9':62765, '21aa':62766, '231a':4948, '231b':4946, '23cf':62818, '23e9':62805, '23ea':62809, '23eb':62812, '23ec':62814, '23ed':62806, '23ee':62810, '23ef':62807, '23f0':4949, '23f1':4950, '23f2':4951, '23f3':4947, '23f8':62815, '23f9':62816, '23fa':62817, '24c2':62890, '25aa':62938, '25ab':62939, '25b6':62804, '25c0':62808, '25fb':62935, '25fc':62934, '25fd':62937, '25fe':62936, '260e':61184, '261d':1350, '262a':62784, '262e':62785, '262f':62781, '263a':120, '264a':62790, '264b':62791, '264c':62792, '264d':62793, '264e':62794, '264f':62795, '265f':51099, '267b':62844, '267e':62833, '267f':62732, '269b':62777, '269c':62845, '26a0':62742, '26a1':41016, '26a7':62827, '26aa':62924, '26ab':62923, '26b0':61359, '26b1':61361, '26bd':51051, '26be':51052, '26c4':41019, '26c5':4999, '26c8':41000, '26ce':62800, '26cf':61296, '26d1':61150, '26d3':61314, '26d4':62744, '26e9':4853, '26ea':4849, '26f0':4814, '26f1':41015, '26f2':4855, '26f3':51070, '26f4':4928, '26f5':4924, '26f7':1599, '26f8':51071, '26f9-200d-2640':1615, '26f9-200d-2642':1614, '26f9':1613, '26fa':4856, '26fd':4915, '270a':1354, '270b':1330, '270c':1339, '270d':1365, '270f':61258, '271d':62782, '274c':62853, '274e':62854, '2764-200d-1f525':1139, '2764-200d-1fa79':1140, '27a1':62757, '27b0':62855, '27bf':62856, '2b05':62761, '2b06':62755, '2b07':62759, '2b1b':62932, '2b1c':62933, '2b50':4994, '2b55':62849, '303d':62857, '1f385-1f3fb':0, '1f385-1f3fc':0, '1f385-1f3fd':0, '1f385-1f3fe':0, '1f385-1f3ff':0, '1f3c2-1f3fb':0, '1f3c2-1f3fc':0, '1f3c2-1f3fd':0, '1f3c2-1f3fe':0, '1f3c2-1f3ff':0, '1f3c3-1f3fb-200d-2640':0, '1f3c3-1f3fc-200d-2640':0, '1f3c3-1f3fd-200d-2640':0, '1f3c3-1f3fe-200d-2640':0, '1f3c3-1f3ff-200d-2640':0, '1f3c3-1f3fb-200d-2642':0, '1f3c3-1f3fc-200d-2642':0, '1f3c3-1f3fd-200d-2642':0, '1f3c3-1f3fe-200d-2642':0, '1f3c3-1f3ff-200d-2642':0, '1f3c3-1f3fb':0, '1f3c3-1f3fc':0, '1f3c3-1f3fd':0, '1f3c3-1f3fe':0, '1f3c3-1f3ff':0, '1f3c4-1f3fb-200d-2640':0, '1f3c4-1f3fc-200d-2640':0, '1f3c4-1f3fd-200d-2640':0, '1f3c4-1f3fe-200d-2640':0, '1f3c4-1f3ff-200d-2640':0, '1f3c4-1f3fb-200d-2642':0, '1f3c4-1f3fc-200d-2642':0, '1f3c4-1f3fd-200d-2642':0, '1f3c4-1f3fe-200d-2642':0, '1f3c4-1f3ff-200d-2642':0, '1f3c4-1f3fb':0, '1f3c4-1f3fc':0, '1f3c4-1f3fd':0, '1f3c4-1f3fe':0, '1f3c4-1f3ff':0, '1f3c7-1f3fb':0, '1f3c7-1f3fc':0, '1f3c7-1f3fd':0, '1f3c7-1f3fe':0, '1f3c7-1f3ff':0, '1f3ca-1f3fb-200d-2640':0, '1f3ca-1f3fc-200d-2640':0, '1f3ca-1f3fd-200d-2640':0, '1f3ca-1f3fe-200d-2640':0, '1f3ca-1f3ff-200d-2640':0, '1f3ca-1f3fb-200d-2642':0, '1f3ca-1f3fc-200d-2642':0, '1f3ca-1f3fd-200d-2642':0, '1f3ca-1f3fe-200d-2642':0, '1f3ca-1f3ff-200d-2642':0, '1f3ca-1f3fb':0, '1f3ca-1f3fc':0, '1f3ca-1f3fd':0, '1f3ca-1f3fe':0, '1f3ca-1f3ff':0, '1f3cb-1f3fb-200d-2640':0, '1f3cb-1f3fc-200d-2640':0, '1f3cb-1f3fd-200d-2640':0, '1f3cb-1f3fe-200d-2640':0, '1f3cb-1f3ff-200d-2640':0, '1f3cb-1f3fb-200d-2642':0, '1f3cb-1f3fc-200d-2642':0, '1f3cb-1f3fd-200d-2642':0, '1f3cb-1f3fe-200d-2642':0, '1f3cb-1f3ff-200d-2642':0, '1f3cb-1f3fb':0, '1f3cb-1f3fc':0, '1f3cb-1f3fd':0, '1f3cb-1f3fe':0, '1f3cb-1f3ff':0, '1f3cc-1f3fb-200d-2640':0, '1f3cc-1f3fc-200d-2640':0, '1f3cc-1f3fd-200d-2640':0, '1f3cc-1f3fe-200d-2640':0, '1f3cc-1f3ff-200d-2640':0, '1f3cc-1f3fb-200d-2642':0, '1f3cc-1f3fc-200d-2642':0, '1f3cc-1f3fd-200d-2642':0, '1f3cc-1f3fe-200d-2642':0, '1f3cc-1f3ff-200d-2642':0, '1f3cc-1f3fb':0, '1f3cc-1f3fc':0, '1f3cc-1f3fd':0, '1f3cc-1f3fe':0, '1f3cc-1f3ff':0, '1f442-1f3fb':0, '1f442-1f3fc':0, '1f442-1f3fd':0, '1f442-1f3fe':0, '1f442-1f3ff':0, '1f443-1f3fb':0, '1f443-1f3fc':0, '1f443-1f3fd':0, '1f443-1f3fe':0, '1f443-1f3ff':0, '1f446-1f3fb':0, '1f446-1f3fc':0, '1f446-1f3fd':0, '1f446-1f3fe':0, '1f446-1f3ff':0, '1f447-1f3fb':0, '1f447-1f3fc':0, '1f447-1f3fd':0, '1f447-1f3fe':0, '1f447-1f3ff':0, '1f448-1f3fb':0, '1f448-1f3fc':0, '1f448-1f3fd':0, '1f448-1f3fe':0, '1f448-1f3ff':0, '1f449-1f3fb':0, '1f449-1f3fc':0, '1f449-1f3fd':0, '1f449-1f3fe':0, '1f449-1f3ff':0, '1f44a-1f3fb':0, '1f44a-1f3fc':0, '1f44a-1f3fd':0, '1f44a-1f3fe':0, '1f44a-1f3ff':0, '1f44b-1f3fb':0, '1f44b-1f3fc':0, '1f44b-1f3fd':0, '1f44b-1f3fe':0, '1f44b-1f3ff':0, '1f44c-1f3fb':0, '1f44c-1f3fc':0, '1f44c-1f3fd':0, '1f44c-1f3fe':0, '1f44c-1f3ff':0, '1f44d-1f3fb':0, '1f44d-1f3fc':0, '1f44d-1f3fd':0, '1f44d-1f3fe':0, '1f44d-1f3ff':0, '1f44e-1f3fb':0, '1f44e-1f3fc':0, '1f44e-1f3fd':0, '1f44e-1f3fe':0, '1f44e-1f3ff':0, '1f44f-1f3fb':0, '1f44f-1f3fc':0, '1f44f-1f3fd':0, '1f44f-1f3fe':0, '1f44f-1f3ff':0, '1f450-1f3fb':0, '1f450-1f3fc':0, '1f450-1f3fd':0, '1f450-1f3fe':0, '1f450-1f3ff':0, '1f466-1f3fb':0, '1f466-1f3fc':0, '1f466-1f3fd':0, '1f466-1f3fe':0, '1f466-1f3ff':0, '1f467-1f3fb':0, '1f467-1f3fc':0, '1f467-1f3fd':0, '1f467-1f3fe':0, '1f467-1f3ff':0, '1f468-1f3fb-200d-1f33e':0, '1f468-1f3fc-200d-1f33e':0, '1f468-1f3fd-200d-1f33e':0, '1f468-1f3fe-200d-1f33e':0, '1f468-1f3ff-200d-1f33e':0, '1f468-1f3fb-200d-1f373':0, '1f468-1f3fc-200d-1f373':0, '1f468-1f3fd-200d-1f373':0, '1f468-1f3fe-200d-1f373':0, '1f468-1f3ff-200d-1f373':0, '1f468-1f3fb-200d-1f37c':0, '1f468-1f3fc-200d-1f37c':0, '1f468-1f3fd-200d-1f37c':0, '1f468-1f3fe-200d-1f37c':0, '1f468-1f3ff-200d-1f37c':0, '1f468-1f3fb-200d-1f393':0, '1f468-1f3fc-200d-1f393':0, '1f468-1f3fd-200d-1f393':0, '1f468-1f3fe-200d-1f393':0, '1f468-1f3ff-200d-1f393':0, '1f468-1f3fb-200d-1f3a4':0, '1f468-1f3fc-200d-1f3a4':0, '1f468-1f3fd-200d-1f3a4':0, '1f468-1f3fe-200d-1f3a4':0, '1f468-1f3ff-200d-1f3a4':0, '1f468-1f3fb-200d-1f3a8':0, '1f468-1f3fc-200d-1f3a8':0, '1f468-1f3fd-200d-1f3a8':0, '1f468-1f3fe-200d-1f3a8':0, '1f468-1f3ff-200d-1f3a8':0, '1f468-1f3fb-200d-1f3eb':0, '1f468-1f3fc-200d-1f3eb':0, '1f468-1f3fd-200d-1f3eb':0, '1f468-1f3fe-200d-1f3eb':0, '1f468-1f3ff-200d-1f3eb':0, '1f468-1f3fb-200d-1f3ed':0, '1f468-1f3fc-200d-1f3ed':0, '1f468-1f3fd-200d-1f3ed':0, '1f468-1f3fe-200d-1f3ed':0, '1f468-1f3ff-200d-1f3ed':0, '1f468-1f3fb-200d-1f4bb':0, '1f468-1f3fc-200d-1f4bb':0, '1f468-1f3fd-200d-1f4bb':0, '1f468-1f3fe-200d-1f4bb':0, '1f468-1f3ff-200d-1f4bb':0, '1f468-1f3fb-200d-1f4bc':0, '1f468-1f3fc-200d-1f4bc':0, '1f468-1f3fd-200d-1f4bc':0, '1f468-1f3fe-200d-1f4bc':0, '1f468-1f3ff-200d-1f4bc':0, '1f468-1f3fb-200d-1f527':0, '1f468-1f3fc-200d-1f527':0, '1f468-1f3fd-200d-1f527':0, '1f468-1f3fe-200d-1f527':0, '1f468-1f3ff-200d-1f527':0, '1f468-1f3fb-200d-1f52c':0, '1f468-1f3fc-200d-1f52c':0, '1f468-1f3fd-200d-1f52c':0, '1f468-1f3fe-200d-1f52c':0, '1f468-1f3ff-200d-1f52c':0, '1f468-1f3fb-200d-1f680':0, '1f468-1f3fc-200d-1f680':0, '1f468-1f3fd-200d-1f680':0, '1f468-1f3fe-200d-1f680':0, '1f468-1f3ff-200d-1f680':0, '1f468-1f3fb-200d-1f692':0, '1f468-1f3fc-200d-1f692':0, '1f468-1f3fd-200d-1f692':0, '1f468-1f3fe-200d-1f692':0, '1f468-1f3ff-200d-1f692':0, '1f468-1f3fb-200d-1f9af':0, '1f468-1f3fc-200d-1f9af':0, '1f468-1f3fd-200d-1f9af':0, '1f468-1f3fe-200d-1f9af':0, '1f468-1f3ff-200d-1f9af':0, '1f468-1f3fb-200d-1f9b0':0, '1f468-1f3fc-200d-1f9b0':0, '1f468-1f3fd-200d-1f9b0':0, '1f468-1f3fe-200d-1f9b0':0, '1f468-1f3ff-200d-1f9b0':0, '1f468-1f3fb-200d-1f9b1':0, '1f468-1f3fc-200d-1f9b1':0, '1f468-1f3fd-200d-1f9b1':0, '1f468-1f3fe-200d-1f9b1':0, '1f468-1f3ff-200d-1f9b1':0, '1f468-1f3fb-200d-1f9b2':0, '1f468-1f3fc-200d-1f9b2':0, '1f468-1f3fd-200d-1f9b2':0, '1f468-1f3fe-200d-1f9b2':0, '1f468-1f3ff-200d-1f9b2':0, '1f468-1f3fb-200d-1f9b3':0, '1f468-1f3fc-200d-1f9b3':0, '1f468-1f3fd-200d-1f9b3':0, '1f468-1f3fe-200d-1f9b3':0, '1f468-1f3ff-200d-1f9b3':0, '1f468-1f3fb-200d-1f9bc':0, '1f468-1f3fc-200d-1f9bc':0, '1f468-1f3fd-200d-1f9bc':0, '1f468-1f3fe-200d-1f9bc':0, '1f468-1f3ff-200d-1f9bc':0, '1f468-1f3fb-200d-1f9bd':0, '1f468-1f3fc-200d-1f9bd':0, '1f468-1f3fd-200d-1f9bd':0, '1f468-1f3fe-200d-1f9bd':0, '1f468-1f3ff-200d-1f9bd':0, '1f468-1f3fb-200d-2695':0, '1f468-1f3fc-200d-2695':0, '1f468-1f3fd-200d-2695':0, '1f468-1f3fe-200d-2695':0, '1f468-1f3ff-200d-2695':0, '1f468-1f3fb-200d-2696':0, '1f468-1f3fc-200d-2696':0, '1f468-1f3fd-200d-2696':0, '1f468-1f3fe-200d-2696':0, '1f468-1f3ff-200d-2696':0, '1f468-1f3fb-200d-2708':0, '1f468-1f3fc-200d-2708':0, '1f468-1f3fd-200d-2708':0, '1f468-1f3fe-200d-2708':0, '1f468-1f3ff-200d-2708':0, '1f468-1f3fb-200d-2764-200d-1f468-1f3fb':0, '1f468-1f3fb-200d-2764-200d-1f468-1f3fc':0, '1f468-1f3fb-200d-2764-200d-1f468-1f3fd':0, '1f468-1f3fb-200d-2764-200d-1f468-1f3fe':0, '1f468-1f3fb-200d-2764-200d-1f468-1f3ff':0, '1f468-1f3fc-200d-2764-200d-1f468-1f3fb':0, '1f468-1f3fc-200d-2764-200d-1f468-1f3fc':0, '1f468-1f3fc-200d-2764-200d-1f468-1f3fd':0, '1f468-1f3fc-200d-2764-200d-1f468-1f3fe':0, '1f468-1f3fc-200d-2764-200d-1f468-1f3ff':0, '1f468-1f3fd-200d-2764-200d-1f468-1f3fb':0, '1f468-1f3fd-200d-2764-200d-1f468-1f3fc':0, '1f468-1f3fd-200d-2764-200d-1f468-1f3fd':0, '1f468-1f3fd-200d-2764-200d-1f468-1f3fe':0, '1f468-1f3fd-200d-2764-200d-1f468-1f3ff':0, '1f468-1f3fe-200d-2764-200d-1f468-1f3fb':0, '1f468-1f3fe-200d-2764-200d-1f468-1f3fc':0, '1f468-1f3fe-200d-2764-200d-1f468-1f3fd':0, '1f468-1f3fe-200d-2764-200d-1f468-1f3fe':0, '1f468-1f3fe-200d-2764-200d-1f468-1f3ff':0, '1f468-1f3ff-200d-2764-200d-1f468-1f3fb':0, '1f468-1f3ff-200d-2764-200d-1f468-1f3fc':0, '1f468-1f3ff-200d-2764-200d-1f468-1f3fd':0, '1f468-1f3ff-200d-2764-200d-1f468-1f3fe':0, '1f468-1f3ff-200d-2764-200d-1f468-1f3ff':0, '1f468-1f3fb-200d-2764-200d-1f48b-200d-1f468-1f3fb':0, '1f468-1f3fb-200d-2764-200d-1f48b-200d-1f468-1f3fc':0, '1f468-1f3fb-200d-2764-200d-1f48b-200d-1f468-1f3fd':0, '1f468-1f3fb-200d-2764-200d-1f48b-200d-1f468-1f3fe':0, '1f468-1f3fb-200d-2764-200d-1f48b-200d-1f468-1f3ff':0, '1f468-1f3fc-200d-2764-200d-1f48b-200d-1f468-1f3fb':0, '1f468-1f3fc-200d-2764-200d-1f48b-200d-1f468-1f3fc':0, '1f468-1f3fc-200d-2764-200d-1f48b-200d-1f468-1f3fd':0, '1f468-1f3fc-200d-2764-200d-1f48b-200d-1f468-1f3fe':0, '1f468-1f3fc-200d-2764-200d-1f48b-200d-1f468-1f3ff':0, '1f468-1f3fd-200d-2764-200d-1f48b-200d-1f468-1f3fb':0, '1f468-1f3fd-200d-2764-200d-1f48b-200d-1f468-1f3fc':0, '1f468-1f3fd-200d-2764-200d-1f48b-200d-1f468-1f3fd':0, '1f468-1f3fd-200d-2764-200d-1f48b-200d-1f468-1f3fe':0, '1f468-1f3fd-200d-2764-200d-1f48b-200d-1f468-1f3ff':0, '1f468-1f3fe-200d-2764-200d-1f48b-200d-1f468-1f3fb':0, '1f468-1f3fe-200d-2764-200d-1f48b-200d-1f468-1f3fc':0, '1f468-1f3fe-200d-2764-200d-1f48b-200d-1f468-1f3fd':0, '1f468-1f3fe-200d-2764-200d-1f48b-200d-1f468-1f3fe':0, '1f468-1f3fe-200d-2764-200d-1f48b-200d-1f468-1f3ff':0, '1f468-1f3ff-200d-2764-200d-1f48b-200d-1f468-1f3fb':0, '1f468-1f3ff-200d-2764-200d-1f48b-200d-1f468-1f3fc':0, '1f468-1f3ff-200d-2764-200d-1f48b-200d-1f468-1f3fd':0, '1f468-1f3ff-200d-2764-200d-1f48b-200d-1f468-1f3fe':0, '1f468-1f3ff-200d-2764-200d-1f48b-200d-1f468-1f3ff':0, '1f468-1f3fb':0, '1f468-1f3fc':0, '1f468-1f3fd':0, '1f468-1f3fe':0, '1f468-1f3ff':0, '1f469-1f3fb-200d-1f33e':0, '1f469-1f3fc-200d-1f33e':0, '1f469-1f3fd-200d-1f33e':0, '1f469-1f3fe-200d-1f33e':0, '1f469-1f3ff-200d-1f33e':0, '1f469-1f3fb-200d-1f373':0, '1f469-1f3fc-200d-1f373':0, '1f469-1f3fd-200d-1f373':0, '1f469-1f3fe-200d-1f373':0, '1f469-1f3ff-200d-1f373':0, '1f469-1f3fb-200d-1f37c':0, '1f469-1f3fc-200d-1f37c':0, '1f469-1f3fd-200d-1f37c':0, '1f469-1f3fe-200d-1f37c':0, '1f469-1f3ff-200d-1f37c':0, '1f469-1f3fb-200d-1f393':0, '1f469-1f3fc-200d-1f393':0, '1f469-1f3fd-200d-1f393':0, '1f469-1f3fe-200d-1f393':0, '1f469-1f3ff-200d-1f393':0, '1f469-1f3fb-200d-1f3a4':0, '1f469-1f3fc-200d-1f3a4':0, '1f469-1f3fd-200d-1f3a4':0, '1f469-1f3fe-200d-1f3a4':0, '1f469-1f3ff-200d-1f3a4':0, '1f469-1f3fb-200d-1f3a8':0, '1f469-1f3fc-200d-1f3a8':0, '1f469-1f3fd-200d-1f3a8':0, '1f469-1f3fe-200d-1f3a8':0, '1f469-1f3ff-200d-1f3a8':0, '1f469-1f3fb-200d-1f3eb':0, '1f469-1f3fc-200d-1f3eb':0, '1f469-1f3fd-200d-1f3eb':0, '1f469-1f3fe-200d-1f3eb':0, '1f469-1f3ff-200d-1f3eb':0, '1f469-1f3fb-200d-1f3ed':0, '1f469-1f3fc-200d-1f3ed':0, '1f469-1f3fd-200d-1f3ed':0, '1f469-1f3fe-200d-1f3ed':0, '1f469-1f3ff-200d-1f3ed':0, '1f469-1f3fb-200d-1f4bb':0, '1f469-1f3fc-200d-1f4bb':0, '1f469-1f3fd-200d-1f4bb':0, '1f469-1f3fe-200d-1f4bb':0, '1f469-1f3ff-200d-1f4bb':0, '1f469-1f3fb-200d-1f4bc':0, '1f469-1f3fc-200d-1f4bc':0, '1f469-1f3fd-200d-1f4bc':0, '1f469-1f3fe-200d-1f4bc':0, '1f469-1f3ff-200d-1f4bc':0, '1f469-1f3fb-200d-1f527':0, '1f469-1f3fc-200d-1f527':0, '1f469-1f3fd-200d-1f527':0, '1f469-1f3fe-200d-1f527':0, '1f469-1f3ff-200d-1f527':0, '1f469-1f3fb-200d-1f52c':0, '1f469-1f3fc-200d-1f52c':0, '1f469-1f3fd-200d-1f52c':0, '1f469-1f3fe-200d-1f52c':0, '1f469-1f3ff-200d-1f52c':0, '1f469-1f3fb-200d-1f680':0, '1f469-1f3fc-200d-1f680':0, '1f469-1f3fd-200d-1f680':0, '1f469-1f3fe-200d-1f680':0, '1f469-1f3ff-200d-1f680':0, '1f469-1f3fb-200d-1f692':0, '1f469-1f3fc-200d-1f692':0, '1f469-1f3fd-200d-1f692':0, '1f469-1f3fe-200d-1f692':0, '1f469-1f3ff-200d-1f692':0, '1f469-1f3fb-200d-1f9af':0, '1f469-1f3fc-200d-1f9af':0, '1f469-1f3fd-200d-1f9af':0, '1f469-1f3fe-200d-1f9af':0, '1f469-1f3ff-200d-1f9af':0, '1f469-1f3fb-200d-1f9b0':0, '1f469-1f3fc-200d-1f9b0':0, '1f469-1f3fd-200d-1f9b0':0, '1f469-1f3fe-200d-1f9b0':0, '1f469-1f3ff-200d-1f9b0':0, '1f469-1f3fb-200d-1f9b1':0, '1f469-1f3fc-200d-1f9b1':0, '1f469-1f3fd-200d-1f9b1':0, '1f469-1f3fe-200d-1f9b1':0, '1f469-1f3ff-200d-1f9b1':0, '1f469-1f3fb-200d-1f9b2':0, '1f469-1f3fc-200d-1f9b2':0, '1f469-1f3fd-200d-1f9b2':0, '1f469-1f3fe-200d-1f9b2':0, '1f469-1f3ff-200d-1f9b2':0, '1f469-1f3fb-200d-1f9b3':0, '1f469-1f3fc-200d-1f9b3':0, '1f469-1f3fd-200d-1f9b3':0, '1f469-1f3fe-200d-1f9b3':0, '1f469-1f3ff-200d-1f9b3':0, '1f469-1f3fb-200d-1f9bc':0, '1f469-1f3fc-200d-1f9bc':0, '1f469-1f3fd-200d-1f9bc':0, '1f469-1f3fe-200d-1f9bc':0, '1f469-1f3ff-200d-1f9bc':0, '1f469-1f3fb-200d-1f9bd':0, '1f469-1f3fc-200d-1f9bd':0, '1f469-1f3fd-200d-1f9bd':0, '1f469-1f3fe-200d-1f9bd':0, '1f469-1f3ff-200d-1f9bd':0, '1f469-1f3fb-200d-2695':0, '1f469-1f3fc-200d-2695':0, '1f469-1f3fd-200d-2695':0, '1f469-1f3fe-200d-2695':0, '1f469-1f3ff-200d-2695':0, '1f469-1f3fb-200d-2696':0, '1f469-1f3fc-200d-2696':0, '1f469-1f3fd-200d-2696':0, '1f469-1f3fe-200d-2696':0, '1f469-1f3ff-200d-2696':0, '1f469-1f3fb-200d-2708':0, '1f469-1f3fc-200d-2708':0, '1f469-1f3fd-200d-2708':0, '1f469-1f3fe-200d-2708':0, '1f469-1f3ff-200d-2708':0, '1f469-1f3fb-200d-2764-200d-1f468-1f3fb':0, '1f469-1f3fb-200d-2764-200d-1f468-1f3fc':0, '1f469-1f3fb-200d-2764-200d-1f468-1f3fd':0, '1f469-1f3fb-200d-2764-200d-1f468-1f3fe':0, '1f469-1f3fb-200d-2764-200d-1f468-1f3ff':0, '1f469-1f3fc-200d-2764-200d-1f468-1f3fb':0, '1f469-1f3fc-200d-2764-200d-1f468-1f3fc':0, '1f469-1f3fc-200d-2764-200d-1f468-1f3fd':0, '1f469-1f3fc-200d-2764-200d-1f468-1f3fe':0, '1f469-1f3fc-200d-2764-200d-1f468-1f3ff':0, '1f469-1f3fd-200d-2764-200d-1f468-1f3fb':0, '1f469-1f3fd-200d-2764-200d-1f468-1f3fc':0, '1f469-1f3fd-200d-2764-200d-1f468-1f3fd':0, '1f469-1f3fd-200d-2764-200d-1f468-1f3fe':0, '1f469-1f3fd-200d-2764-200d-1f468-1f3ff':0, '1f469-1f3fe-200d-2764-200d-1f468-1f3fb':0, '1f469-1f3fe-200d-2764-200d-1f468-1f3fc':0, '1f469-1f3fe-200d-2764-200d-1f468-1f3fd':0, '1f469-1f3fe-200d-2764-200d-1f468-1f3fe':0, '1f469-1f3fe-200d-2764-200d-1f468-1f3ff':0, '1f469-1f3ff-200d-2764-200d-1f468-1f3fb':0, '1f469-1f3ff-200d-2764-200d-1f468-1f3fc':0, '1f469-1f3ff-200d-2764-200d-1f468-1f3fd':0, '1f469-1f3ff-200d-2764-200d-1f468-1f3fe':0, '1f469-1f3ff-200d-2764-200d-1f468-1f3ff':0, '1f469-1f3fb-200d-2764-200d-1f469-1f3fb':0, '1f469-1f3fb-200d-2764-200d-1f469-1f3fc':0, '1f469-1f3fb-200d-2764-200d-1f469-1f3fd':0, '1f469-1f3fb-200d-2764-200d-1f469-1f3fe':0, '1f469-1f3fb-200d-2764-200d-1f469-1f3ff':0, '1f469-1f3fc-200d-2764-200d-1f469-1f3fb':0, '1f469-1f3fc-200d-2764-200d-1f469-1f3fc':0, '1f469-1f3fc-200d-2764-200d-1f469-1f3fd':0, '1f469-1f3fc-200d-2764-200d-1f469-1f3fe':0, '1f469-1f3fc-200d-2764-200d-1f469-1f3ff':0, '1f469-1f3fd-200d-2764-200d-1f469-1f3fb':0, '1f469-1f3fd-200d-2764-200d-1f469-1f3fc':0, '1f469-1f3fd-200d-2764-200d-1f469-1f3fd':0, '1f469-1f3fd-200d-2764-200d-1f469-1f3fe':0, '1f469-1f3fd-200d-2764-200d-1f469-1f3ff':0, '1f469-1f3fe-200d-2764-200d-1f469-1f3fb':0, '1f469-1f3fe-200d-2764-200d-1f469-1f3fc':0, '1f469-1f3fe-200d-2764-200d-1f469-1f3fd':0, '1f469-1f3fe-200d-2764-200d-1f469-1f3fe':0, '1f469-1f3fe-200d-2764-200d-1f469-1f3ff':0, '1f469-1f3ff-200d-2764-200d-1f469-1f3fb':0, '1f469-1f3ff-200d-2764-200d-1f469-1f3fc':0, '1f469-1f3ff-200d-2764-200d-1f469-1f3fd':0, '1f469-1f3ff-200d-2764-200d-1f469-1f3fe':0, '1f469-1f3ff-200d-2764-200d-1f469-1f3ff':0, '1f469-1f3fb-200d-2764-200d-1f48b-200d-1f468-1f3fb':0, '1f469-1f3fb-200d-2764-200d-1f48b-200d-1f468-1f3fc':0, '1f469-1f3fb-200d-2764-200d-1f48b-200d-1f468-1f3fd':0, '1f469-1f3fb-200d-2764-200d-1f48b-200d-1f468-1f3fe':0, '1f469-1f3fb-200d-2764-200d-1f48b-200d-1f468-1f3ff':0, '1f469-1f3fc-200d-2764-200d-1f48b-200d-1f468-1f3fb':0, '1f469-1f3fc-200d-2764-200d-1f48b-200d-1f468-1f3fc':0, '1f469-1f3fc-200d-2764-200d-1f48b-200d-1f468-1f3fd':0, '1f469-1f3fc-200d-2764-200d-1f48b-200d-1f468-1f3fe':0, '1f469-1f3fc-200d-2764-200d-1f48b-200d-1f468-1f3ff':0, '1f469-1f3fd-200d-2764-200d-1f48b-200d-1f468-1f3fb':0, '1f469-1f3fd-200d-2764-200d-1f48b-200d-1f468-1f3fc':0, '1f469-1f3fd-200d-2764-200d-1f48b-200d-1f468-1f3fd':0, '1f469-1f3fd-200d-2764-200d-1f48b-200d-1f468-1f3fe':0, '1f469-1f3fd-200d-2764-200d-1f48b-200d-1f468-1f3ff':0, '1f469-1f3fe-200d-2764-200d-1f48b-200d-1f468-1f3fb':0, '1f469-1f3fe-200d-2764-200d-1f48b-200d-1f468-1f3fc':0, '1f469-1f3fe-200d-2764-200d-1f48b-200d-1f468-1f3fd':0, '1f469-1f3fe-200d-2764-200d-1f48b-200d-1f468-1f3fe':0, '1f469-1f3fe-200d-2764-200d-1f48b-200d-1f468-1f3ff':0, '1f469-1f3ff-200d-2764-200d-1f48b-200d-1f468-1f3fb':0, '1f469-1f3ff-200d-2764-200d-1f48b-200d-1f468-1f3fc':0, '1f469-1f3ff-200d-2764-200d-1f48b-200d-1f468-1f3fd':0, '1f469-1f3ff-200d-2764-200d-1f48b-200d-1f468-1f3fe':0, '1f469-1f3ff-200d-2764-200d-1f48b-200d-1f468-1f3ff':0, '1f469-1f3fb-200d-2764-200d-1f48b-200d-1f469-1f3fb':0, '1f469-1f3fb-200d-2764-200d-1f48b-200d-1f469-1f3fc':0, '1f469-1f3fb-200d-2764-200d-1f48b-200d-1f469-1f3fd':0, '1f469-1f3fb-200d-2764-200d-1f48b-200d-1f469-1f3fe':0, '1f469-1f3fb-200d-2764-200d-1f48b-200d-1f469-1f3ff':0, '1f469-1f3fc-200d-2764-200d-1f48b-200d-1f469-1f3fb':0, '1f469-1f3fc-200d-2764-200d-1f48b-200d-1f469-1f3fc':0, '1f469-1f3fc-200d-2764-200d-1f48b-200d-1f469-1f3fd':0, '1f469-1f3fc-200d-2764-200d-1f48b-200d-1f469-1f3fe':0, '1f469-1f3fc-200d-2764-200d-1f48b-200d-1f469-1f3ff':0, '1f469-1f3fd-200d-2764-200d-1f48b-200d-1f469-1f3fb':0, '1f469-1f3fd-200d-2764-200d-1f48b-200d-1f469-1f3fc':0, '1f469-1f3fd-200d-2764-200d-1f48b-200d-1f469-1f3fd':0, '1f469-1f3fd-200d-2764-200d-1f48b-200d-1f469-1f3fe':0, '1f469-1f3fd-200d-2764-200d-1f48b-200d-1f469-1f3ff':0, '1f469-1f3fe-200d-2764-200d-1f48b-200d-1f469-1f3fb':0, '1f469-1f3fe-200d-2764-200d-1f48b-200d-1f469-1f3fc':0, '1f469-1f3fe-200d-2764-200d-1f48b-200d-1f469-1f3fd':0, '1f469-1f3fe-200d-2764-200d-1f48b-200d-1f469-1f3fe':0, '1f469-1f3fe-200d-2764-200d-1f48b-200d-1f469-1f3ff':0, '1f469-1f3ff-200d-2764-200d-1f48b-200d-1f469-1f3fb':0, '1f469-1f3ff-200d-2764-200d-1f48b-200d-1f469-1f3fc':0, '1f469-1f3ff-200d-2764-200d-1f48b-200d-1f469-1f3fd':0, '1f469-1f3ff-200d-2764-200d-1f48b-200d-1f469-1f3fe':0, '1f469-1f3ff-200d-2764-200d-1f48b-200d-1f469-1f3ff':0, '1f469-1f3fb':0, '1f469-1f3fc':0, '1f469-1f3fd':0, '1f469-1f3fe':0, '1f469-1f3ff':0, '1f46b-1f3fb':0, '1f46b-1f3fc':0, '1f46b-1f3fd':0, '1f46b-1f3fe':0, '1f46b-1f3ff':0, '1f469-1f3fb-200d-1f91d-200d-1f468-1f3fc':0, '1f469-1f3fb-200d-1f91d-200d-1f468-1f3fd':0, '1f469-1f3fb-200d-1f91d-200d-1f468-1f3fe':0, '1f469-1f3fb-200d-1f91d-200d-1f468-1f3ff':0, '1f469-1f3fc-200d-1f91d-200d-1f468-1f3fb':0, '1f469-1f3fc-200d-1f91d-200d-1f468-1f3fd':0, '1f469-1f3fc-200d-1f91d-200d-1f468-1f3fe':0, '1f469-1f3fc-200d-1f91d-200d-1f468-1f3ff':0, '1f469-1f3fd-200d-1f91d-200d-1f468-1f3fb':0, '1f469-1f3fd-200d-1f91d-200d-1f468-1f3fc':0, '1f469-1f3fd-200d-1f91d-200d-1f468-1f3fe':0, '1f469-1f3fd-200d-1f91d-200d-1f468-1f3ff':0, '1f469-1f3fe-200d-1f91d-200d-1f468-1f3fb':0, '1f469-1f3fe-200d-1f91d-200d-1f468-1f3fc':0, '1f469-1f3fe-200d-1f91d-200d-1f468-1f3fd':0, '1f469-1f3fe-200d-1f91d-200d-1f468-1f3ff':0, '1f469-1f3ff-200d-1f91d-200d-1f468-1f3fb':0, '1f469-1f3ff-200d-1f91d-200d-1f468-1f3fc':0, '1f469-1f3ff-200d-1f91d-200d-1f468-1f3fd':0, '1f469-1f3ff-200d-1f91d-200d-1f468-1f3fe':0, '1f46c-1f3fb':0, '1f46c-1f3fc':0, '1f46c-1f3fd':0, '1f46c-1f3fe':0, '1f46c-1f3ff':0, '1f468-1f3fb-200d-1f91d-200d-1f468-1f3fc':0, '1f468-1f3fb-200d-1f91d-200d-1f468-1f3fd':0, '1f468-1f3fb-200d-1f91d-200d-1f468-1f3fe':0, '1f468-1f3fb-200d-1f91d-200d-1f468-1f3ff':0, '1f468-1f3fc-200d-1f91d-200d-1f468-1f3fb':0, '1f468-1f3fc-200d-1f91d-200d-1f468-1f3fd':0, '1f468-1f3fc-200d-1f91d-200d-1f468-1f3fe':0, '1f468-1f3fc-200d-1f91d-200d-1f468-1f3ff':0, '1f468-1f3fd-200d-1f91d-200d-1f468-1f3fb':0, '1f468-1f3fd-200d-1f91d-200d-1f468-1f3fc':0, '1f468-1f3fd-200d-1f91d-200d-1f468-1f3fe':0, '1f468-1f3fd-200d-1f91d-200d-1f468-1f3ff':0, '1f468-1f3fe-200d-1f91d-200d-1f468-1f3fb':0, '1f468-1f3fe-200d-1f91d-200d-1f468-1f3fc':0, '1f468-1f3fe-200d-1f91d-200d-1f468-1f3fd':0, '1f468-1f3fe-200d-1f91d-200d-1f468-1f3ff':0, '1f468-1f3ff-200d-1f91d-200d-1f468-1f3fb':0, '1f468-1f3ff-200d-1f91d-200d-1f468-1f3fc':0, '1f468-1f3ff-200d-1f91d-200d-1f468-1f3fd':0, '1f468-1f3ff-200d-1f91d-200d-1f468-1f3fe':0, '1f46d-1f3fb':0, '1f46d-1f3fc':0, '1f46d-1f3fd':0, '1f46d-1f3fe':0, '1f46d-1f3ff':0, '1f469-1f3fb-200d-1f91d-200d-1f469-1f3fc':0, '1f469-1f3fb-200d-1f91d-200d-1f469-1f3fd':0, '1f469-1f3fb-200d-1f91d-200d-1f469-1f3fe':0, '1f469-1f3fb-200d-1f91d-200d-1f469-1f3ff':0, '1f469-1f3fc-200d-1f91d-200d-1f469-1f3fb':0, '1f469-1f3fc-200d-1f91d-200d-1f469-1f3fd':0, '1f469-1f3fc-200d-1f91d-200d-1f469-1f3fe':0, '1f469-1f3fc-200d-1f91d-200d-1f469-1f3ff':0, '1f469-1f3fd-200d-1f91d-200d-1f469-1f3fb':0, '1f469-1f3fd-200d-1f91d-200d-1f469-1f3fc':0, '1f469-1f3fd-200d-1f91d-200d-1f469-1f3fe':0, '1f469-1f3fd-200d-1f91d-200d-1f469-1f3ff':0, '1f469-1f3fe-200d-1f91d-200d-1f469-1f3fb':0, '1f469-1f3fe-200d-1f91d-200d-1f469-1f3fc':0, '1f469-1f3fe-200d-1f91d-200d-1f469-1f3fd':0, '1f469-1f3fe-200d-1f91d-200d-1f469-1f3ff':0, '1f469-1f3ff-200d-1f91d-200d-1f469-1f3fb':0, '1f469-1f3ff-200d-1f91d-200d-1f469-1f3fc':0, '1f469-1f3ff-200d-1f91d-200d-1f469-1f3fd':0, '1f469-1f3ff-200d-1f91d-200d-1f469-1f3fe':0, '1f46e-1f3fb-200d-2640':0, '1f46e-1f3fc-200d-2640':0, '1f46e-1f3fd-200d-2640':0, '1f46e-1f3fe-200d-2640':0, '1f46e-1f3ff-200d-2640':0, '1f46e-1f3fb-200d-2642':0, '1f46e-1f3fc-200d-2642':0, '1f46e-1f3fd-200d-2642':0, '1f46e-1f3fe-200d-2642':0, '1f46e-1f3ff-200d-2642':0, '1f46e-1f3fb':0, '1f46e-1f3fc':0, '1f46e-1f3fd':0, '1f46e-1f3fe':0, '1f46e-1f3ff':0, '1f470-1f3fb-200d-2640':0, '1f470-1f3fc-200d-2640':0, '1f470-1f3fd-200d-2640':0, '1f470-1f3fe-200d-2640':0, '1f470-1f3ff-200d-2640':0, '1f470-1f3fb-200d-2642':0, '1f470-1f3fc-200d-2642':0, '1f470-1f3fd-200d-2642':0, '1f470-1f3fe-200d-2642':0, '1f470-1f3ff-200d-2642':0, '1f470-1f3fb':0, '1f470-1f3fc':0, '1f470-1f3fd':0, '1f470-1f3fe':0, '1f470-1f3ff':0, '1f471-1f3fb-200d-2640':0, '1f471-1f3fc-200d-2640':0, '1f471-1f3fd-200d-2640':0, '1f471-1f3fe-200d-2640':0, '1f471-1f3ff-200d-2640':0, '1f471-1f3fb-200d-2642':0, '1f471-1f3fc-200d-2642':0, '1f471-1f3fd-200d-2642':0, '1f471-1f3fe-200d-2642':0, '1f471-1f3ff-200d-2642':0, '1f471-1f3fb':0, '1f471-1f3fc':0, '1f471-1f3fd':0, '1f471-1f3fe':0, '1f471-1f3ff':0, '1f472-1f3fb':0, '1f472-1f3fc':0, '1f472-1f3fd':0, '1f472-1f3fe':0, '1f472-1f3ff':0, '1f473-1f3fb-200d-2640':0, '1f473-1f3fc-200d-2640':0, '1f473-1f3fd-200d-2640':0, '1f473-1f3fe-200d-2640':0, '1f473-1f3ff-200d-2640':0, '1f473-1f3fb-200d-2642':0, '1f473-1f3fc-200d-2642':0, '1f473-1f3fd-200d-2642':0, '1f473-1f3fe-200d-2642':0, '1f473-1f3ff-200d-2642':0, '1f473-1f3fb':0, '1f473-1f3fc':0, '1f473-1f3fd':0, '1f473-1f3fe':0, '1f473-1f3ff':0, '1f474-1f3fb':0, '1f474-1f3fc':0, '1f474-1f3fd':0, '1f474-1f3fe':0, '1f474-1f3ff':0, '1f475-1f3fb':0, '1f475-1f3fc':0, '1f475-1f3fd':0, '1f475-1f3fe':0, '1f475-1f3ff':0, '1f476-1f3fb':0, '1f476-1f3fc':0, '1f476-1f3fd':0, '1f476-1f3fe':0, '1f476-1f3ff':0, '1f477-1f3fb-200d-2640':0, '1f477-1f3fc-200d-2640':0, '1f477-1f3fd-200d-2640':0, '1f477-1f3fe-200d-2640':0, '1f477-1f3ff-200d-2640':0, '1f477-1f3fb-200d-2642':0, '1f477-1f3fc-200d-2642':0, '1f477-1f3fd-200d-2642':0, '1f477-1f3fe-200d-2642':0, '1f477-1f3ff-200d-2642':0, '1f477-1f3fb':0, '1f477-1f3fc':0, '1f477-1f3fd':0, '1f477-1f3fe':0, '1f477-1f3ff':0, '1f478-1f3fb':0, '1f478-1f3fc':0, '1f478-1f3fd':0, '1f478-1f3fe':0, '1f478-1f3ff':0, '1f47c-1f3fb':0, '1f47c-1f3fc':0, '1f47c-1f3fd':0, '1f47c-1f3fe':0, '1f47c-1f3ff':0, '1f481-1f3fb-200d-2640':0, '1f481-1f3fc-200d-2640':0, '1f481-1f3fd-200d-2640':0, '1f481-1f3fe-200d-2640':0, '1f481-1f3ff-200d-2640':0, '1f481-1f3fb-200d-2642':0, '1f481-1f3fc-200d-2642':0, '1f481-1f3fd-200d-2642':0, '1f481-1f3fe-200d-2642':0, '1f481-1f3ff-200d-2642':0, '1f481-1f3fb':0, '1f481-1f3fc':0, '1f481-1f3fd':0, '1f481-1f3fe':0, '1f481-1f3ff':0, '1f482-1f3fb-200d-2640':0, '1f482-1f3fc-200d-2640':0, '1f482-1f3fd-200d-2640':0, '1f482-1f3fe-200d-2640':0, '1f482-1f3ff-200d-2640':0, '1f482-1f3fb-200d-2642':0, '1f482-1f3fc-200d-2642':0, '1f482-1f3fd-200d-2642':0, '1f482-1f3fe-200d-2642':0, '1f482-1f3ff-200d-2642':0, '1f482-1f3fb':0, '1f482-1f3fc':0, '1f482-1f3fd':0, '1f482-1f3fe':0, '1f482-1f3ff':0, '1f483-1f3fb':0, '1f483-1f3fc':0, '1f483-1f3fd':0, '1f483-1f3fe':0, '1f483-1f3ff':0, '1f485-1f3fb':0, '1f485-1f3fc':0, '1f485-1f3fd':0, '1f485-1f3fe':0, '1f485-1f3ff':0, '1f486-1f3fb-200d-2640':0, '1f486-1f3fc-200d-2640':0, '1f486-1f3fd-200d-2640':0, '1f486-1f3fe-200d-2640':0, '1f486-1f3ff-200d-2640':0, '1f486-1f3fb-200d-2642':0, '1f486-1f3fc-200d-2642':0, '1f486-1f3fd-200d-2642':0, '1f486-1f3fe-200d-2642':0, '1f486-1f3ff-200d-2642':0, '1f486-1f3fb':0, '1f486-1f3fc':0, '1f486-1f3fd':0, '1f486-1f3fe':0, '1f486-1f3ff':0, '1f487-1f3fb-200d-2640':0, '1f487-1f3fc-200d-2640':0, '1f487-1f3fd-200d-2640':0, '1f487-1f3fe-200d-2640':0, '1f487-1f3ff-200d-2640':0, '1f487-1f3fb-200d-2642':0, '1f487-1f3fc-200d-2642':0, '1f487-1f3fd-200d-2642':0, '1f487-1f3fe-200d-2642':0, '1f487-1f3ff-200d-2642':0, '1f487-1f3fb':0, '1f487-1f3fc':0, '1f487-1f3fd':0, '1f487-1f3fe':0, '1f487-1f3ff':0, '1f48f-1f3fb':0, '1f48f-1f3fc':0, '1f48f-1f3fd':0, '1f48f-1f3fe':0, '1f48f-1f3ff':0, '1f9d1-1f3fb-200d-2764-200d-1f48b-200d-1f9d1-1f3fc':0, '1f9d1-1f3fb-200d-2764-200d-1f48b-200d-1f9d1-1f3fd':0, '1f9d1-1f3fb-200d-2764-200d-1f48b-200d-1f9d1-1f3fe':0, '1f9d1-1f3fb-200d-2764-200d-1f48b-200d-1f9d1-1f3ff':0, '1f9d1-1f3fc-200d-2764-200d-1f48b-200d-1f9d1-1f3fb':0, '1f9d1-1f3fc-200d-2764-200d-1f48b-200d-1f9d1-1f3fd':0, '1f9d1-1f3fc-200d-2764-200d-1f48b-200d-1f9d1-1f3fe':0, '1f9d1-1f3fc-200d-2764-200d-1f48b-200d-1f9d1-1f3ff':0, '1f9d1-1f3fd-200d-2764-200d-1f48b-200d-1f9d1-1f3fb':0, '1f9d1-1f3fd-200d-2764-200d-1f48b-200d-1f9d1-1f3fc':0, '1f9d1-1f3fd-200d-2764-200d-1f48b-200d-1f9d1-1f3fe':0, '1f9d1-1f3fd-200d-2764-200d-1f48b-200d-1f9d1-1f3ff':0, '1f9d1-1f3fe-200d-2764-200d-1f48b-200d-1f9d1-1f3fb':0, '1f9d1-1f3fe-200d-2764-200d-1f48b-200d-1f9d1-1f3fc':0, '1f9d1-1f3fe-200d-2764-200d-1f48b-200d-1f9d1-1f3fd':0, '1f9d1-1f3fe-200d-2764-200d-1f48b-200d-1f9d1-1f3ff':0, '1f9d1-1f3ff-200d-2764-200d-1f48b-200d-1f9d1-1f3fb':0, '1f9d1-1f3ff-200d-2764-200d-1f48b-200d-1f9d1-1f3fc':0, '1f9d1-1f3ff-200d-2764-200d-1f48b-200d-1f9d1-1f3fd':0, '1f9d1-1f3ff-200d-2764-200d-1f48b-200d-1f9d1-1f3fe':0, '1f491-1f3fb':0, '1f491-1f3fc':0, '1f491-1f3fd':0, '1f491-1f3fe':0, '1f491-1f3ff':0, '1f9d1-1f3fb-200d-2764-200d-1f9d1-1f3fc':0, '1f9d1-1f3fb-200d-2764-200d-1f9d1-1f3fd':0, '1f9d1-1f3fb-200d-2764-200d-1f9d1-1f3fe':0, '1f9d1-1f3fb-200d-2764-200d-1f9d1-1f3ff':0, '1f9d1-1f3fc-200d-2764-200d-1f9d1-1f3fb':0, '1f9d1-1f3fc-200d-2764-200d-1f9d1-1f3fd':0, '1f9d1-1f3fc-200d-2764-200d-1f9d1-1f3fe':0, '1f9d1-1f3fc-200d-2764-200d-1f9d1-1f3ff':0, '1f9d1-1f3fd-200d-2764-200d-1f9d1-1f3fb':0, '1f9d1-1f3fd-200d-2764-200d-1f9d1-1f3fc':0, '1f9d1-1f3fd-200d-2764-200d-1f9d1-1f3fe':0, '1f9d1-1f3fd-200d-2764-200d-1f9d1-1f3ff':0, '1f9d1-1f3fe-200d-2764-200d-1f9d1-1f3fb':0, '1f9d1-1f3fe-200d-2764-200d-1f9d1-1f3fc':0, '1f9d1-1f3fe-200d-2764-200d-1f9d1-1f3fd':0, '1f9d1-1f3fe-200d-2764-200d-1f9d1-1f3ff':0, '1f9d1-1f3ff-200d-2764-200d-1f9d1-1f3fb':0, '1f9d1-1f3ff-200d-2764-200d-1f9d1-1f3fc':0, '1f9d1-1f3ff-200d-2764-200d-1f9d1-1f3fd':0, '1f9d1-1f3ff-200d-2764-200d-1f9d1-1f3fe':0, '1f4aa-1f3fb':0, '1f4aa-1f3fc':0, '1f4aa-1f3fd':0, '1f4aa-1f3fe':0, '1f4aa-1f3ff':0, '1f574-1f3fb':0, '1f574-1f3fc':0, '1f574-1f3fd':0, '1f574-1f3fe':0, '1f574-1f3ff':0, '1f575-1f3fb-200d-2640':0, '1f575-1f3fc-200d-2640':0, '1f575-1f3fd-200d-2640':0, '1f575-1f3fe-200d-2640':0, '1f575-1f3ff-200d-2640':0, '1f575-1f3fb-200d-2642':0, '1f575-1f3fc-200d-2642':0, '1f575-1f3fd-200d-2642':0, '1f575-1f3fe-200d-2642':0, '1f575-1f3ff-200d-2642':0, '1f575-1f3fb':0, '1f575-1f3fc':0, '1f575-1f3fd':0, '1f575-1f3fe':0, '1f575-1f3ff':0, '1f57a-1f3fb':0, '1f57a-1f3fc':0, '1f57a-1f3fd':0, '1f57a-1f3fe':0, '1f57a-1f3ff':0, '1f590-1f3fb':0, '1f590-1f3fc':0, '1f590-1f3fd':0, '1f590-1f3fe':0, '1f590-1f3ff':0, '1f595-1f3fb':0, '1f595-1f3fc':0, '1f595-1f3fd':0, '1f595-1f3fe':0, '1f595-1f3ff':0, '1f596-1f3fb':0, '1f596-1f3fc':0, '1f596-1f3fd':0, '1f596-1f3fe':0, '1f596-1f3ff':0, '1f645-1f3fb-200d-2640':0, '1f645-1f3fc-200d-2640':0, '1f645-1f3fd-200d-2640':0, '1f645-1f3fe-200d-2640':0, '1f645-1f3ff-200d-2640':0, '1f645-1f3fb-200d-2642':0, '1f645-1f3fc-200d-2642':0, '1f645-1f3fd-200d-2642':0, '1f645-1f3fe-200d-2642':0, '1f645-1f3ff-200d-2642':0, '1f645-1f3fb':0, '1f645-1f3fc':0, '1f645-1f3fd':0, '1f645-1f3fe':0, '1f645-1f3ff':0, '1f646-1f3fb-200d-2640':0, '1f646-1f3fc-200d-2640':0, '1f646-1f3fd-200d-2640':0, '1f646-1f3fe-200d-2640':0, '1f646-1f3ff-200d-2640':0, '1f646-1f3fb-200d-2642':0, '1f646-1f3fc-200d-2642':0, '1f646-1f3fd-200d-2642':0, '1f646-1f3fe-200d-2642':0, '1f646-1f3ff-200d-2642':0, '1f646-1f3fb':0, '1f646-1f3fc':0, '1f646-1f3fd':0, '1f646-1f3fe':0, '1f646-1f3ff':0, '1f647-1f3fb-200d-2640':0, '1f647-1f3fc-200d-2640':0, '1f647-1f3fd-200d-2640':0, '1f647-1f3fe-200d-2640':0, '1f647-1f3ff-200d-2640':0, '1f647-1f3fb-200d-2642':0, '1f647-1f3fc-200d-2642':0, '1f647-1f3fd-200d-2642':0, '1f647-1f3fe-200d-2642':0, '1f647-1f3ff-200d-2642':0, '1f647-1f3fb':0, '1f647-1f3fc':0, '1f647-1f3fd':0, '1f647-1f3fe':0, '1f647-1f3ff':0, '1f64b-1f3fb-200d-2640':0, '1f64b-1f3fc-200d-2640':0, '1f64b-1f3fd-200d-2640':0, '1f64b-1f3fe-200d-2640':0, '1f64b-1f3ff-200d-2640':0, '1f64b-1f3fb-200d-2642':0, '1f64b-1f3fc-200d-2642':0, '1f64b-1f3fd-200d-2642':0, '1f64b-1f3fe-200d-2642':0, '1f64b-1f3ff-200d-2642':0, '1f64b-1f3fb':0, '1f64b-1f3fc':0, '1f64b-1f3fd':0, '1f64b-1f3fe':0, '1f64b-1f3ff':0, '1f64c-1f3fb':0, '1f64c-1f3fc':0, '1f64c-1f3fd':0, '1f64c-1f3fe':0, '1f64c-1f3ff':0, '1f64d-1f3fb-200d-2640':0, '1f64d-1f3fc-200d-2640':0, '1f64d-1f3fd-200d-2640':0, '1f64d-1f3fe-200d-2640':0, '1f64d-1f3ff-200d-2640':0, '1f64d-1f3fb-200d-2642':0, '1f64d-1f3fc-200d-2642':0, '1f64d-1f3fd-200d-2642':0, '1f64d-1f3fe-200d-2642':0, '1f64d-1f3ff-200d-2642':0, '1f64d-1f3fb':0, '1f64d-1f3fc':0, '1f64d-1f3fd':0, '1f64d-1f3fe':0, '1f64d-1f3ff':0, '1f64e-1f3fb-200d-2640':0, '1f64e-1f3fc-200d-2640':0, '1f64e-1f3fd-200d-2640':0, '1f64e-1f3fe-200d-2640':0, '1f64e-1f3ff-200d-2640':0, '1f64e-1f3fb-200d-2642':0, '1f64e-1f3fc-200d-2642':0, '1f64e-1f3fd-200d-2642':0, '1f64e-1f3fe-200d-2642':0, '1f64e-1f3ff-200d-2642':0, '1f64e-1f3fb':0, '1f64e-1f3fc':0, '1f64e-1f3fd':0, '1f64e-1f3fe':0, '1f64e-1f3ff':0, '1f64f-1f3fb':0, '1f64f-1f3fc':0, '1f64f-1f3fd':0, '1f64f-1f3fe':0, '1f64f-1f3ff':0, '1f6a3-1f3fb-200d-2640':0, '1f6a3-1f3fc-200d-2640':0, '1f6a3-1f3fd-200d-2640':0, '1f6a3-1f3fe-200d-2640':0, '1f6a3-1f3ff-200d-2640':0, '1f6a3-1f3fb-200d-2642':0, '1f6a3-1f3fc-200d-2642':0, '1f6a3-1f3fd-200d-2642':0, '1f6a3-1f3fe-200d-2642':0, '1f6a3-1f3ff-200d-2642':0, '1f6a3-1f3fb':0, '1f6a3-1f3fc':0, '1f6a3-1f3fd':0, '1f6a3-1f3fe':0, '1f6a3-1f3ff':0, '1f6b4-1f3fb-200d-2640':0, '1f6b4-1f3fc-200d-2640':0, '1f6b4-1f3fd-200d-2640':0, '1f6b4-1f3fe-200d-2640':0, '1f6b4-1f3ff-200d-2640':0, '1f6b4-1f3fb-200d-2642':0, '1f6b4-1f3fc-200d-2642':0, '1f6b4-1f3fd-200d-2642':0, '1f6b4-1f3fe-200d-2642':0, '1f6b4-1f3ff-200d-2642':0, '1f6b4-1f3fb':0, '1f6b4-1f3fc':0, '1f6b4-1f3fd':0, '1f6b4-1f3fe':0, '1f6b4-1f3ff':0, '1f6b5-1f3fb-200d-2640':0, '1f6b5-1f3fc-200d-2640':0, '1f6b5-1f3fd-200d-2640':0, '1f6b5-1f3fe-200d-2640':0, '1f6b5-1f3ff-200d-2640':0, '1f6b5-1f3fb-200d-2642':0, '1f6b5-1f3fc-200d-2642':0, '1f6b5-1f3fd-200d-2642':0, '1f6b5-1f3fe-200d-2642':0, '1f6b5-1f3ff-200d-2642':0, '1f6b5-1f3fb':0, '1f6b5-1f3fc':0, '1f6b5-1f3fd':0, '1f6b5-1f3fe':0, '1f6b5-1f3ff':0, '1f6b6-1f3fb-200d-2640':0, '1f6b6-1f3fc-200d-2640':0, '1f6b6-1f3fd-200d-2640':0, '1f6b6-1f3fe-200d-2640':0, '1f6b6-1f3ff-200d-2640':0, '1f6b6-1f3fb-200d-2642':0, '1f6b6-1f3fc-200d-2642':0, '1f6b6-1f3fd-200d-2642':0, '1f6b6-1f3fe-200d-2642':0, '1f6b6-1f3ff-200d-2642':0, '1f6b6-1f3fb':0, '1f6b6-1f3fc':0, '1f6b6-1f3fd':0, '1f6b6-1f3fe':0, '1f6b6-1f3ff':0, '1f6c0-1f3fb':0, '1f6c0-1f3fc':0, '1f6c0-1f3fd':0, '1f6c0-1f3fe':0, '1f6c0-1f3ff':0, '1f6cc-1f3fb':0, '1f6cc-1f3fc':0, '1f6cc-1f3fd':0, '1f6cc-1f3fe':0, '1f6cc-1f3ff':0, '1f90c-1f3fb':0, '1f90c-1f3fc':0, '1f90c-1f3fd':0, '1f90c-1f3fe':0, '1f90c-1f3ff':0, '1f90f-1f3fb':0, '1f90f-1f3fc':0, '1f90f-1f3fd':0, '1f90f-1f3fe':0, '1f90f-1f3ff':0, '1f918-1f3fb':0, '1f918-1f3fc':0, '1f918-1f3fd':0, '1f918-1f3fe':0, '1f918-1f3ff':0, '1f919-1f3fb':0, '1f919-1f3fc':0, '1f919-1f3fd':0, '1f919-1f3fe':0, '1f919-1f3ff':0, '1f91a-1f3fb':0, '1f91a-1f3fc':0, '1f91a-1f3fd':0, '1f91a-1f3fe':0, '1f91a-1f3ff':0, '1f91b-1f3fb':0, '1f91b-1f3fc':0, '1f91b-1f3fd':0, '1f91b-1f3fe':0, '1f91b-1f3ff':0, '1f91c-1f3fb':0, '1f91c-1f3fc':0, '1f91c-1f3fd':0, '1f91c-1f3fe':0, '1f91c-1f3ff':0, '1f91d-1f3fb':0, '1f91d-1f3fc':0, '1f91d-1f3fd':0, '1f91d-1f3fe':0, '1f91d-1f3ff':0, '1f91e-1f3fb':0, '1f91e-1f3fc':0, '1f91e-1f3fd':0, '1f91e-1f3fe':0, '1f91e-1f3ff':0, '1f91f-1f3fb':0, '1f91f-1f3fc':0, '1f91f-1f3fd':0, '1f91f-1f3fe':0, '1f91f-1f3ff':0, '1f926-1f3fb-200d-2640':0, '1f926-1f3fc-200d-2640':0, '1f926-1f3fd-200d-2640':0, '1f926-1f3fe-200d-2640':0, '1f926-1f3ff-200d-2640':0, '1f926-1f3fb-200d-2642':0, '1f926-1f3fc-200d-2642':0, '1f926-1f3fd-200d-2642':0, '1f926-1f3fe-200d-2642':0, '1f926-1f3ff-200d-2642':0, '1f926-1f3fb':0, '1f926-1f3fc':0, '1f926-1f3fd':0, '1f926-1f3fe':0, '1f926-1f3ff':0, '1f930-1f3fb':0, '1f930-1f3fc':0, '1f930-1f3fd':0, '1f930-1f3fe':0, '1f930-1f3ff':0, '1f931-1f3fb':0, '1f931-1f3fc':0, '1f931-1f3fd':0, '1f931-1f3fe':0, '1f931-1f3ff':0, '1f932-1f3fb':0, '1f932-1f3fc':0, '1f932-1f3fd':0, '1f932-1f3fe':0, '1f932-1f3ff':0, '1f933-1f3fb':0, '1f933-1f3fc':0, '1f933-1f3fd':0, '1f933-1f3fe':0, '1f933-1f3ff':0, '1f934-1f3fb':0, '1f934-1f3fc':0, '1f934-1f3fd':0, '1f934-1f3fe':0, '1f934-1f3ff':0, '1f935-1f3fb-200d-2640':0, '1f935-1f3fc-200d-2640':0, '1f935-1f3fd-200d-2640':0, '1f935-1f3fe-200d-2640':0, '1f935-1f3ff-200d-2640':0, '1f935-1f3fb-200d-2642':0, '1f935-1f3fc-200d-2642':0, '1f935-1f3fd-200d-2642':0, '1f935-1f3fe-200d-2642':0, '1f935-1f3ff-200d-2642':0, '1f935-1f3fb':0, '1f935-1f3fc':0, '1f935-1f3fd':0, '1f935-1f3fe':0, '1f935-1f3ff':0, '1f936-1f3fb':0, '1f936-1f3fc':0, '1f936-1f3fd':0, '1f936-1f3fe':0, '1f936-1f3ff':0, '1f937-1f3fb-200d-2640':0, '1f937-1f3fc-200d-2640':0, '1f937-1f3fd-200d-2640':0, '1f937-1f3fe-200d-2640':0, '1f937-1f3ff-200d-2640':0, '1f937-1f3fb-200d-2642':0, '1f937-1f3fc-200d-2642':0, '1f937-1f3fd-200d-2642':0, '1f937-1f3fe-200d-2642':0, '1f937-1f3ff-200d-2642':0, '1f937-1f3fb':0, '1f937-1f3fc':0, '1f937-1f3fd':0, '1f937-1f3fe':0, '1f937-1f3ff':0, '1f938-1f3fb-200d-2640':0, '1f938-1f3fc-200d-2640':0, '1f938-1f3fd-200d-2640':0, '1f938-1f3fe-200d-2640':0, '1f938-1f3ff-200d-2640':0, '1f938-1f3fb-200d-2642':0, '1f938-1f3fc-200d-2642':0, '1f938-1f3fd-200d-2642':0, '1f938-1f3fe-200d-2642':0, '1f938-1f3ff-200d-2642':0, '1f938-1f3fb':0, '1f938-1f3fc':0, '1f938-1f3fd':0, '1f938-1f3fe':0, '1f938-1f3ff':0, '1f939-1f3fb-200d-2640':0, '1f939-1f3fc-200d-2640':0, '1f939-1f3fd-200d-2640':0, '1f939-1f3fe-200d-2640':0, '1f939-1f3ff-200d-2640':0, '1f939-1f3fb-200d-2642':0, '1f939-1f3fc-200d-2642':0, '1f939-1f3fd-200d-2642':0, '1f939-1f3fe-200d-2642':0, '1f939-1f3ff-200d-2642':0, '1f939-1f3fb':0, '1f939-1f3fc':0, '1f939-1f3fd':0, '1f939-1f3fe':0, '1f939-1f3ff':0, '1f93d-1f3fb-200d-2640':0, '1f93d-1f3fc-200d-2640':0, '1f93d-1f3fd-200d-2640':0, '1f93d-1f3fe-200d-2640':0, '1f93d-1f3ff-200d-2640':0, '1f93d-1f3fb-200d-2642':0, '1f93d-1f3fc-200d-2642':0, '1f93d-1f3fd-200d-2642':0, '1f93d-1f3fe-200d-2642':0, '1f93d-1f3ff-200d-2642':0, '1f93d-1f3fb':0, '1f93d-1f3fc':0, '1f93d-1f3fd':0, '1f93d-1f3fe':0, '1f93d-1f3ff':0, '1f93e-1f3fb-200d-2640':0, '1f93e-1f3fc-200d-2640':0, '1f93e-1f3fd-200d-2640':0, '1f93e-1f3fe-200d-2640':0, '1f93e-1f3ff-200d-2640':0, '1f93e-1f3fb-200d-2642':0, '1f93e-1f3fc-200d-2642':0, '1f93e-1f3fd-200d-2642':0, '1f93e-1f3fe-200d-2642':0, '1f93e-1f3ff-200d-2642':0, '1f93e-1f3fb':0, '1f93e-1f3fc':0, '1f93e-1f3fd':0, '1f93e-1f3fe':0, '1f93e-1f3ff':0, '1f977-1f3fb':0, '1f977-1f3fc':0, '1f977-1f3fd':0, '1f977-1f3fe':0, '1f977-1f3ff':0, '1f9b5-1f3fb':0, '1f9b5-1f3fc':0, '1f9b5-1f3fd':0, '1f9b5-1f3fe':0, '1f9b5-1f3ff':0, '1f9b6-1f3fb':0, '1f9b6-1f3fc':0, '1f9b6-1f3fd':0, '1f9b6-1f3fe':0, '1f9b6-1f3ff':0, '1f9b8-1f3fb-200d-2640':0, '1f9b8-1f3fc-200d-2640':0, '1f9b8-1f3fd-200d-2640':0, '1f9b8-1f3fe-200d-2640':0, '1f9b8-1f3ff-200d-2640':0, '1f9b8-1f3fb-200d-2642':0, '1f9b8-1f3fc-200d-2642':0, '1f9b8-1f3fd-200d-2642':0, '1f9b8-1f3fe-200d-2642':0, '1f9b8-1f3ff-200d-2642':0, '1f9b8-1f3fb':0, '1f9b8-1f3fc':0, '1f9b8-1f3fd':0, '1f9b8-1f3fe':0, '1f9b8-1f3ff':0, '1f9b9-1f3fb-200d-2640':0, '1f9b9-1f3fc-200d-2640':0, '1f9b9-1f3fd-200d-2640':0, '1f9b9-1f3fe-200d-2640':0, '1f9b9-1f3ff-200d-2640':0, '1f9b9-1f3fb-200d-2642':0, '1f9b9-1f3fc-200d-2642':0, '1f9b9-1f3fd-200d-2642':0, '1f9b9-1f3fe-200d-2642':0, '1f9b9-1f3ff-200d-2642':0, '1f9b9-1f3fb':0, '1f9b9-1f3fc':0, '1f9b9-1f3fd':0, '1f9b9-1f3fe':0, '1f9b9-1f3ff':0, '1f9bb-1f3fb':0, '1f9bb-1f3fc':0, '1f9bb-1f3fd':0, '1f9bb-1f3fe':0, '1f9bb-1f3ff':0, '1f9cd-1f3fb-200d-2640':0, '1f9cd-1f3fc-200d-2640':0, '1f9cd-1f3fd-200d-2640':0, '1f9cd-1f3fe-200d-2640':0, '1f9cd-1f3ff-200d-2640':0, '1f9cd-1f3fb-200d-2642':0, '1f9cd-1f3fc-200d-2642':0, '1f9cd-1f3fd-200d-2642':0, '1f9cd-1f3fe-200d-2642':0, '1f9cd-1f3ff-200d-2642':0, '1f9cd-1f3fb':0, '1f9cd-1f3fc':0, '1f9cd-1f3fd':0, '1f9cd-1f3fe':0, '1f9cd-1f3ff':0, '1f9ce-1f3fb-200d-2640':0, '1f9ce-1f3fc-200d-2640':0, '1f9ce-1f3fd-200d-2640':0, '1f9ce-1f3fe-200d-2640':0, '1f9ce-1f3ff-200d-2640':0, '1f9ce-1f3fb-200d-2642':0, '1f9ce-1f3fc-200d-2642':0, '1f9ce-1f3fd-200d-2642':0, '1f9ce-1f3fe-200d-2642':0, '1f9ce-1f3ff-200d-2642':0, '1f9ce-1f3fb':0, '1f9ce-1f3fc':0, '1f9ce-1f3fd':0, '1f9ce-1f3fe':0, '1f9ce-1f3ff':0, '1f9cf-1f3fb-200d-2640':0, '1f9cf-1f3fc-200d-2640':0, '1f9cf-1f3fd-200d-2640':0, '1f9cf-1f3fe-200d-2640':0, '1f9cf-1f3ff-200d-2640':0, '1f9cf-1f3fb-200d-2642':0, '1f9cf-1f3fc-200d-2642':0, '1f9cf-1f3fd-200d-2642':0, '1f9cf-1f3fe-200d-2642':0, '1f9cf-1f3ff-200d-2642':0, '1f9cf-1f3fb':0, '1f9cf-1f3fc':0, '1f9cf-1f3fd':0, '1f9cf-1f3fe':0, '1f9cf-1f3ff':0, '1f9d1-1f3fb-200d-1f33e':0, '1f9d1-1f3fc-200d-1f33e':0, '1f9d1-1f3fd-200d-1f33e':0, '1f9d1-1f3fe-200d-1f33e':0, '1f9d1-1f3ff-200d-1f33e':0, '1f9d1-1f3fb-200d-1f373':0, '1f9d1-1f3fc-200d-1f373':0, '1f9d1-1f3fd-200d-1f373':0, '1f9d1-1f3fe-200d-1f373':0, '1f9d1-1f3ff-200d-1f373':0, '1f9d1-1f3fb-200d-1f37c':0, '1f9d1-1f3fc-200d-1f37c':0, '1f9d1-1f3fd-200d-1f37c':0, '1f9d1-1f3fe-200d-1f37c':0, '1f9d1-1f3ff-200d-1f37c':0, '1f9d1-1f3fb-200d-1f384':0, '1f9d1-1f3fc-200d-1f384':0, '1f9d1-1f3fd-200d-1f384':0, '1f9d1-1f3fe-200d-1f384':0, '1f9d1-1f3ff-200d-1f384':0, '1f9d1-1f3fb-200d-1f393':0, '1f9d1-1f3fc-200d-1f393':0, '1f9d1-1f3fd-200d-1f393':0, '1f9d1-1f3fe-200d-1f393':0, '1f9d1-1f3ff-200d-1f393':0, '1f9d1-1f3fb-200d-1f3a4':0, '1f9d1-1f3fc-200d-1f3a4':0, '1f9d1-1f3fd-200d-1f3a4':0, '1f9d1-1f3fe-200d-1f3a4':0, '1f9d1-1f3ff-200d-1f3a4':0, '1f9d1-1f3fb-200d-1f3a8':0, '1f9d1-1f3fc-200d-1f3a8':0, '1f9d1-1f3fd-200d-1f3a8':0, '1f9d1-1f3fe-200d-1f3a8':0, '1f9d1-1f3ff-200d-1f3a8':0, '1f9d1-1f3fb-200d-1f3eb':0, '1f9d1-1f3fc-200d-1f3eb':0, '1f9d1-1f3fd-200d-1f3eb':0, '1f9d1-1f3fe-200d-1f3eb':0, '1f9d1-1f3ff-200d-1f3eb':0, '1f9d1-1f3fb-200d-1f3ed':0, '1f9d1-1f3fc-200d-1f3ed':0, '1f9d1-1f3fd-200d-1f3ed':0, '1f9d1-1f3fe-200d-1f3ed':0, '1f9d1-1f3ff-200d-1f3ed':0, '1f9d1-1f3fb-200d-1f4bb':0, '1f9d1-1f3fc-200d-1f4bb':0, '1f9d1-1f3fd-200d-1f4bb':0, '1f9d1-1f3fe-200d-1f4bb':0, '1f9d1-1f3ff-200d-1f4bb':0, '1f9d1-1f3fb-200d-1f4bc':0, '1f9d1-1f3fc-200d-1f4bc':0, '1f9d1-1f3fd-200d-1f4bc':0, '1f9d1-1f3fe-200d-1f4bc':0, '1f9d1-1f3ff-200d-1f4bc':0, '1f9d1-1f3fb-200d-1f527':0, '1f9d1-1f3fc-200d-1f527':0, '1f9d1-1f3fd-200d-1f527':0, '1f9d1-1f3fe-200d-1f527':0, '1f9d1-1f3ff-200d-1f527':0, '1f9d1-1f3fb-200d-1f52c':0, '1f9d1-1f3fc-200d-1f52c':0, '1f9d1-1f3fd-200d-1f52c':0, '1f9d1-1f3fe-200d-1f52c':0, '1f9d1-1f3ff-200d-1f52c':0, '1f9d1-1f3fb-200d-1f680':0, '1f9d1-1f3fc-200d-1f680':0, '1f9d1-1f3fd-200d-1f680':0, '1f9d1-1f3fe-200d-1f680':0, '1f9d1-1f3ff-200d-1f680':0, '1f9d1-1f3fb-200d-1f692':0, '1f9d1-1f3fc-200d-1f692':0, '1f9d1-1f3fd-200d-1f692':0, '1f9d1-1f3fe-200d-1f692':0, '1f9d1-1f3ff-200d-1f692':0, '1f9d1-1f3fb-200d-1f91d-200d-1f9d1-1f3fb':0, '1f9d1-1f3fb-200d-1f91d-200d-1f9d1-1f3fc':0, '1f9d1-1f3fb-200d-1f91d-200d-1f9d1-1f3fd':0, '1f9d1-1f3fb-200d-1f91d-200d-1f9d1-1f3fe':0, '1f9d1-1f3fb-200d-1f91d-200d-1f9d1-1f3ff':0, '1f9d1-1f3fc-200d-1f91d-200d-1f9d1-1f3fb':0, '1f9d1-1f3fc-200d-1f91d-200d-1f9d1-1f3fc':0, '1f9d1-1f3fc-200d-1f91d-200d-1f9d1-1f3fd':0, '1f9d1-1f3fc-200d-1f91d-200d-1f9d1-1f3fe':0, '1f9d1-1f3fc-200d-1f91d-200d-1f9d1-1f3ff':0, '1f9d1-1f3fd-200d-1f91d-200d-1f9d1-1f3fb':0, '1f9d1-1f3fd-200d-1f91d-200d-1f9d1-1f3fc':0, '1f9d1-1f3fd-200d-1f91d-200d-1f9d1-1f3fd':0, '1f9d1-1f3fd-200d-1f91d-200d-1f9d1-1f3fe':0, '1f9d1-1f3fd-200d-1f91d-200d-1f9d1-1f3ff':0, '1f9d1-1f3fe-200d-1f91d-200d-1f9d1-1f3fb':0, '1f9d1-1f3fe-200d-1f91d-200d-1f9d1-1f3fc':0, '1f9d1-1f3fe-200d-1f91d-200d-1f9d1-1f3fd':0, '1f9d1-1f3fe-200d-1f91d-200d-1f9d1-1f3fe':0, '1f9d1-1f3fe-200d-1f91d-200d-1f9d1-1f3ff':0, '1f9d1-1f3ff-200d-1f91d-200d-1f9d1-1f3fb':0, '1f9d1-1f3ff-200d-1f91d-200d-1f9d1-1f3fc':0, '1f9d1-1f3ff-200d-1f91d-200d-1f9d1-1f3fd':0, '1f9d1-1f3ff-200d-1f91d-200d-1f9d1-1f3fe':0, '1f9d1-1f3ff-200d-1f91d-200d-1f9d1-1f3ff':0, '1f9d1-1f3fb-200d-1f9af':0, '1f9d1-1f3fc-200d-1f9af':0, '1f9d1-1f3fd-200d-1f9af':0, '1f9d1-1f3fe-200d-1f9af':0, '1f9d1-1f3ff-200d-1f9af':0, '1f9d1-1f3fb-200d-1f9b0':0, '1f9d1-1f3fc-200d-1f9b0':0, '1f9d1-1f3fd-200d-1f9b0':0, '1f9d1-1f3fe-200d-1f9b0':0, '1f9d1-1f3ff-200d-1f9b0':0, '1f9d1-1f3fb-200d-1f9b1':0, '1f9d1-1f3fc-200d-1f9b1':0, '1f9d1-1f3fd-200d-1f9b1':0, '1f9d1-1f3fe-200d-1f9b1':0, '1f9d1-1f3ff-200d-1f9b1':0, '1f9d1-1f3fb-200d-1f9b2':0, '1f9d1-1f3fc-200d-1f9b2':0, '1f9d1-1f3fd-200d-1f9b2':0, '1f9d1-1f3fe-200d-1f9b2':0, '1f9d1-1f3ff-200d-1f9b2':0, '1f9d1-1f3fb-200d-1f9b3':0, '1f9d1-1f3fc-200d-1f9b3':0, '1f9d1-1f3fd-200d-1f9b3':0, '1f9d1-1f3fe-200d-1f9b3':0, '1f9d1-1f3ff-200d-1f9b3':0, '1f9d1-1f3fb-200d-1f9bc':0, '1f9d1-1f3fc-200d-1f9bc':0, '1f9d1-1f3fd-200d-1f9bc':0, '1f9d1-1f3fe-200d-1f9bc':0, '1f9d1-1f3ff-200d-1f9bc':0, '1f9d1-1f3fb-200d-1f9bd':0, '1f9d1-1f3fc-200d-1f9bd':0, '1f9d1-1f3fd-200d-1f9bd':0, '1f9d1-1f3fe-200d-1f9bd':0, '1f9d1-1f3ff-200d-1f9bd':0, '1f9d1-1f3fb-200d-2695':0, '1f9d1-1f3fc-200d-2695':0, '1f9d1-1f3fd-200d-2695':0, '1f9d1-1f3fe-200d-2695':0, '1f9d1-1f3ff-200d-2695':0, '1f9d1-1f3fb-200d-2696':0, '1f9d1-1f3fc-200d-2696':0, '1f9d1-1f3fd-200d-2696':0, '1f9d1-1f3fe-200d-2696':0, '1f9d1-1f3ff-200d-2696':0, '1f9d1-1f3fb-200d-2708':0, '1f9d1-1f3fc-200d-2708':0, '1f9d1-1f3fd-200d-2708':0, '1f9d1-1f3fe-200d-2708':0, '1f9d1-1f3ff-200d-2708':0, '1f9d1-1f3fb':0, '1f9d1-1f3fc':0, '1f9d1-1f3fd':0, '1f9d1-1f3fe':0, '1f9d1-1f3ff':0, '1f9d2-1f3fb':0, '1f9d2-1f3fc':0, '1f9d2-1f3fd':0, '1f9d2-1f3fe':0, '1f9d2-1f3ff':0, '1f9d3-1f3fb':0, '1f9d3-1f3fc':0, '1f9d3-1f3fd':0, '1f9d3-1f3fe':0, '1f9d3-1f3ff':0, '1f9d4-1f3fb-200d-2640':0, '1f9d4-1f3fc-200d-2640':0, '1f9d4-1f3fd-200d-2640':0, '1f9d4-1f3fe-200d-2640':0, '1f9d4-1f3ff-200d-2640':0, '1f9d4-1f3fb-200d-2642':0, '1f9d4-1f3fc-200d-2642':0, '1f9d4-1f3fd-200d-2642':0, '1f9d4-1f3fe-200d-2642':0, '1f9d4-1f3ff-200d-2642':0, '1f9d4-1f3fb':0, '1f9d4-1f3fc':0, '1f9d4-1f3fd':0, '1f9d4-1f3fe':0, '1f9d4-1f3ff':0, '1f9d5-1f3fb':0, '1f9d5-1f3fc':0, '1f9d5-1f3fd':0, '1f9d5-1f3fe':0, '1f9d5-1f3ff':0, '1f9d6-1f3fb-200d-2640':0, '1f9d6-1f3fc-200d-2640':0, '1f9d6-1f3fd-200d-2640':0, '1f9d6-1f3fe-200d-2640':0, '1f9d6-1f3ff-200d-2640':0, '1f9d6-1f3fb-200d-2642':0, '1f9d6-1f3fc-200d-2642':0, '1f9d6-1f3fd-200d-2642':0, '1f9d6-1f3fe-200d-2642':0, '1f9d6-1f3ff-200d-2642':0, '1f9d6-1f3fb':0, '1f9d6-1f3fc':0, '1f9d6-1f3fd':0, '1f9d6-1f3fe':0, '1f9d6-1f3ff':0, '1f9d7-1f3fb-200d-2640':0, '1f9d7-1f3fc-200d-2640':0, '1f9d7-1f3fd-200d-2640':0, '1f9d7-1f3fe-200d-2640':0, '1f9d7-1f3ff-200d-2640':0, '1f9d7-1f3fb-200d-2642':0, '1f9d7-1f3fc-200d-2642':0, '1f9d7-1f3fd-200d-2642':0, '1f9d7-1f3fe-200d-2642':0, '1f9d7-1f3ff-200d-2642':0, '1f9d7-1f3fb':0, '1f9d7-1f3fc':0, '1f9d7-1f3fd':0, '1f9d7-1f3fe':0, '1f9d7-1f3ff':0, '1f9d8-1f3fb-200d-2640':0, '1f9d8-1f3fc-200d-2640':0, '1f9d8-1f3fd-200d-2640':0, '1f9d8-1f3fe-200d-2640':0, '1f9d8-1f3ff-200d-2640':0, '1f9d8-1f3fb-200d-2642':0, '1f9d8-1f3fc-200d-2642':0, '1f9d8-1f3fd-200d-2642':0, '1f9d8-1f3fe-200d-2642':0, '1f9d8-1f3ff-200d-2642':0, '1f9d8-1f3fb':0, '1f9d8-1f3fc':0, '1f9d8-1f3fd':0, '1f9d8-1f3fe':0, '1f9d8-1f3ff':0, '1f9d9-1f3fb-200d-2640':0, '1f9d9-1f3fc-200d-2640':0, '1f9d9-1f3fd-200d-2640':0, '1f9d9-1f3fe-200d-2640':0, '1f9d9-1f3ff-200d-2640':0, '1f9d9-1f3fb-200d-2642':0, '1f9d9-1f3fc-200d-2642':0, '1f9d9-1f3fd-200d-2642':0, '1f9d9-1f3fe-200d-2642':0, '1f9d9-1f3ff-200d-2642':0, '1f9d9-1f3fb':0, '1f9d9-1f3fc':0, '1f9d9-1f3fd':0, '1f9d9-1f3fe':0, '1f9d9-1f3ff':0, '1f9da-1f3fb-200d-2640':0, '1f9da-1f3fc-200d-2640':0, '1f9da-1f3fd-200d-2640':0, '1f9da-1f3fe-200d-2640':0, '1f9da-1f3ff-200d-2640':0, '1f9da-1f3fb-200d-2642':0, '1f9da-1f3fc-200d-2642':0, '1f9da-1f3fd-200d-2642':0, '1f9da-1f3fe-200d-2642':0, '1f9da-1f3ff-200d-2642':0, '1f9da-1f3fb':0, '1f9da-1f3fc':0, '1f9da-1f3fd':0, '1f9da-1f3fe':0, '1f9da-1f3ff':0, '1f9db-1f3fb-200d-2640':0, '1f9db-1f3fc-200d-2640':0, '1f9db-1f3fd-200d-2640':0, '1f9db-1f3fe-200d-2640':0, '1f9db-1f3ff-200d-2640':0, '1f9db-1f3fb-200d-2642':0, '1f9db-1f3fc-200d-2642':0, '1f9db-1f3fd-200d-2642':0, '1f9db-1f3fe-200d-2642':0, '1f9db-1f3ff-200d-2642':0, '1f9db-1f3fb':0, '1f9db-1f3fc':0, '1f9db-1f3fd':0, '1f9db-1f3fe':0, '1f9db-1f3ff':0, '1f9dc-1f3fb-200d-2640':0, '1f9dc-1f3fc-200d-2640':0, '1f9dc-1f3fd-200d-2640':0, '1f9dc-1f3fe-200d-2640':0, '1f9dc-1f3ff-200d-2640':0, '1f9dc-1f3fb-200d-2642':0, '1f9dc-1f3fc-200d-2642':0, '1f9dc-1f3fd-200d-2642':0, '1f9dc-1f3fe-200d-2642':0, '1f9dc-1f3ff-200d-2642':0, '1f9dc-1f3fb':0, '1f9dc-1f3fc':0, '1f9dc-1f3fd':0, '1f9dc-1f3fe':0, '1f9dc-1f3ff':0, '1f9dd-1f3fb-200d-2640':0, '1f9dd-1f3fc-200d-2640':0, '1f9dd-1f3fd-200d-2640':0, '1f9dd-1f3fe-200d-2640':0, '1f9dd-1f3ff-200d-2640':0, '1f9dd-1f3fb-200d-2642':0, '1f9dd-1f3fc-200d-2642':0, '1f9dd-1f3fd-200d-2642':0, '1f9dd-1f3fe-200d-2642':0, '1f9dd-1f3ff-200d-2642':0, '1f9dd-1f3fb':0, '1f9dd-1f3fc':0, '1f9dd-1f3fd':0, '1f9dd-1f3fe':0, '1f9dd-1f3ff':0, '261d-1f3fb':0, '261d-1f3fc':0, '261d-1f3fd':0, '261d-1f3fe':0, '261d-1f3ff':0, '26f9-1f3fb-200d-2640':0, '26f9-1f3fc-200d-2640':0, '26f9-1f3fd-200d-2640':0, '26f9-1f3fe-200d-2640':0, '26f9-1f3ff-200d-2640':0, '26f9-1f3fb-200d-2642':0, '26f9-1f3fc-200d-2642':0, '26f9-1f3fd-200d-2642':0, '26f9-1f3fe-200d-2642':0, '26f9-1f3ff-200d-2642':0, '26f9-1f3fb':0, '26f9-1f3fc':0, '26f9-1f3fd':0, '26f9-1f3fe':0, '26f9-1f3ff':0, '270a-1f3fb':0, '270a-1f3fc':0, '270a-1f3fd':0, '270a-1f3fe':0, '270a-1f3ff':0, '270b-1f3fb':0, '270b-1f3fc':0, '270b-1f3fd':0, '270b-1f3fe':0, '270b-1f3ff':0, '270c-1f3fb':0, '270c-1f3fc':0, '270c-1f3fd':0, '270c-1f3fe':0, '270c-1f3ff':0, '270d-1f3fb':0, '270d-1f3fc':0, '270d-1f3fd':0, '270d-1f3fe':0, '270d-1f3ff':0}};\n\nconst Emoji: {[emoji: string]: number} = EmojiVersions[''];\nfor(const version in EmojiVersions) {\n  if(version) {\n    Object.assign(Emoji, EmojiVersions[version as EMOJI_VERSION]);\n  }\n}\n\nexport default Emoji;\n\n/* Emoji[\"00a9-fe0f\"] = 6362;\nEmoji[\"00ae-fe0f\"] = 6363;\nEmoji[\"2122-fe0f\"] = 6364; */\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nexport const FontFamily = 'Roboto, -apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, Oxygen-Sans, Ubuntu, Cantarell, \"Helvetica Neue\", sans-serif';\nexport const FontSize = '16px';\nexport const FontWeight = '400';\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\n// * Jolly Cobra's animation.ts\r\n\r\nimport {fastRaf} from './schedulers';\r\nimport deferredPromise, {CancellablePromise} from './cancellablePromise';\r\n\r\ninterface AnimationInstance {\r\n  isCancelled: boolean;\r\n  deferred: CancellablePromise<void>\r\n}\r\n\r\ntype AnimationInstanceKey = any;\r\nconst instances: Map<AnimationInstanceKey, AnimationInstance> = new Map();\r\n\r\nexport function createAnimationInstance(key: AnimationInstanceKey) {\r\n  cancelAnimationByKey(key);\r\n\r\n  const instance: AnimationInstance = {\r\n    isCancelled: false,\r\n    deferred: deferredPromise<void>()\r\n  };\r\n\r\n  instances.set(key, instance);\r\n  instance.deferred.then(() => {\r\n    instances.delete(key);\r\n  });\r\n\r\n  return instance;\r\n}\r\n\r\nexport function getAnimationInstance(key: AnimationInstanceKey) {\r\n  return instances.get(key);\r\n}\r\n\r\nexport function cancelAnimationByKey(key: AnimationInstanceKey) {\r\n  const instance = getAnimationInstance(key);\r\n  if(instance) {\r\n    instance.isCancelled = true;\r\n    instance.deferred.resolve();\r\n  }\r\n}\r\n\r\nexport function animateSingle(tick: Function, key: AnimationInstanceKey, instance?: AnimationInstance) {\r\n  if(!instance) {\r\n    instance = createAnimationInstance(key);\r\n  }\r\n\r\n  fastRaf(() => {\r\n    if(instance.isCancelled) {\r\n      return;\r\n    }\r\n\r\n    if(tick()) {\r\n      animateSingle(tick, key, instance);\r\n    } else {\r\n      instance.deferred.resolve();\r\n    }\r\n  });\r\n\r\n  return instance.deferred;\r\n}\r\n\r\nexport function animate(tick: Function) {\r\n  fastRaf(() => {\r\n    if(tick()) {\r\n      animate(tick);\r\n    }\r\n  });\r\n}\r\n","export default function accumulate(arr: number[], initialValue: number) {\n  return arr.reduce((acc, value) => acc + value, initialValue);\n}\n","type K = boolean;\nexport default async function filterAsync<T>(arr: T[], callback: (item: T, idx: number, arr: T[]) => Promise<K> | K) {\n  const promises = arr.map(async(item, idx, arr) => {\n    if(await callback(item, idx, arr)) {\n      return item;\n    }\n  });\n\n  return (await Promise.all(promises)).filter(Boolean);\n}\n","export default function findAndSpliceAll<T>(array: Array<T>, verify: (value: T, index: number, arr: typeof array) => boolean) {\n  const out: typeof array = [];\n  let idx = -1;\n  while((idx = array.findIndex(verify)) !== -1) {\n    out.push(array.splice(idx, 1)[0]);\n  }\n\n  return out;\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nconst ASSETS_PATH = 'assets/audio/';\n\nexport default class AudioAssetPlayer<AssetName extends string> {\n  private audio: HTMLAudioElement;\n  private tempId: number;\n  private assetName: AssetName;\n\n  constructor(private assets: AssetName[]) {\n    this.tempId = 0;\n  }\n\n  public playSound(name: AssetName, loop = false) {\n    ++this.tempId;\n    this.assetName = name;\n\n    try {\n      const audio = this.createAudio();\n      audio.autoplay = true;\n      audio.src = ASSETS_PATH + name;\n      audio.loop = loop;\n      audio.play();\n    } catch(e) {\n      console.error('playSound', name, e);\n    }\n  }\n\n  public playSoundIfDifferent(name: AssetName, loop?: boolean) {\n    if(this.assetName !== name) {\n      this.playSound(name, loop);\n    }\n  }\n\n  public createAudio() {\n    let {audio} = this;\n    if(audio) {\n      return audio;\n    }\n\n    audio = this.audio = new Audio();\n    audio.play();\n    return audio;\n  }\n\n  public stopSound() {\n    if(!this.audio) {\n      return;\n    }\n\n    this.audio.pause();\n  }\n\n  public cancelDelayedPlay() {\n    ++this.tempId;\n  }\n\n  public playSoundWithTimeout(name: AssetName, loop: boolean, timeout: number) {\n    // timeout = 0;\n    const tempId = ++this.tempId;\n    setTimeout(() => {\n      if(this.tempId !== tempId) {\n        return;\n      }\n\n      this.playSound(name, loop);\n    }, timeout);\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport readBlobAs from './readBlobAs';\n\nexport default function readBlobAsDataURL(blob: Blob) {\n  return readBlobAs(blob, 'readAsDataURL');\n}\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport deferredPromise, {CancellablePromise} from './cancellablePromise';\r\nimport {getHeavyAnimationPromise} from '../hooks/useHeavyAnimationCheck';\r\nimport {fastRaf} from './schedulers';\r\nimport {ArgumentTypes} from '../types';\r\n\r\ntype HeavyQueue<T extends HeavyQueue<any>> = {\r\n  items: ArgumentTypes<T['process']>[],\r\n  process: (...args: any[]) => ReturnType<T['process']>,\r\n  context: any,\r\n  promise?: CancellablePromise<ReturnType<T['process']>[]>\r\n};\r\nconst heavyQueue: HeavyQueue<any>[] = [];\r\nlet processingQueue = false;\r\n\r\nexport default function addHeavyTask<T extends HeavyQueue<T>>(queue: T, method: 'push' | 'unshift' = 'push') {\r\n  if(!queue.items.length) {\r\n    return Promise.resolve([]) as typeof promise;\r\n  }\r\n\r\n  const promise = queue.promise = deferredPromise();\r\n  heavyQueue[method](queue);\r\n  processHeavyQueue();\r\n\r\n  return promise;\r\n}\r\n\r\nfunction processHeavyQueue() {\r\n  if(!processingQueue) {\r\n    const queue = heavyQueue.shift();\r\n    timedChunk(queue).finally(() => {\r\n      processingQueue = false;\r\n      if(heavyQueue.length) {\r\n        processHeavyQueue();\r\n      }\r\n    });\r\n  }\r\n}\r\n\r\nfunction timedChunk<T extends HeavyQueue<T>>(queue: HeavyQueue<T>) {\r\n  if(!queue.items.length) {\r\n    queue.promise.resolve([] as any);\r\n    return Promise.resolve([]);\r\n  }\r\n\r\n  const todo = queue.items.slice();\r\n  const results: ReturnType<T['process']>[] = [];\r\n\r\n  return new Promise<typeof results>((resolve, reject) => {\r\n    const f = async() => {\r\n      const start = performance.now();\r\n\r\n      do {\r\n        await getHeavyAnimationPromise();\r\n        const possiblePromise = queue.process.apply(queue.context, todo.shift());\r\n        let realResult: typeof results[0];\r\n        // @ts-ignore\r\n        if(possiblePromise instanceof Promise) {\r\n          try {\r\n            realResult = await possiblePromise;\r\n          } catch(err) {\r\n            reject(err);\r\n            return;\r\n          }\r\n        } else {\r\n          realResult = possiblePromise;\r\n        }\r\n\r\n        results.push(realResult);\r\n      } while(todo.length > 0 && (performance.now() - start) < 6);\r\n\r\n      if(todo.length > 0) {\r\n        fastRaf(f);\r\n        // setTimeout(f, 25);\r\n      } else {\r\n        resolve(results);\r\n      }\r\n    };\r\n\r\n    fastRaf(f);\r\n    // setTimeout(f, 25);\r\n  }).then(queue.promise.resolve, queue.promise.reject);\r\n}\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport type fastBlur from '../vendor/fastBlur';\r\nimport addHeavyTask from './heavyQueue';\r\nimport IS_CANVAS_FILTER_SUPPORTED from '../environment/canvasFilterSupport';\r\n\r\nconst RADIUS = 2;\r\nconst ITERATIONS = 2;\r\n\r\nlet requireBlurPromise: Promise<any>;\r\nlet fastBlurFunc: typeof fastBlur;\r\nif(!IS_CANVAS_FILTER_SUPPORTED) {\r\n  requireBlurPromise = import('../vendor/fastBlur').then((m) => {\r\n    fastBlurFunc = m.default;\r\n  });\r\n} else {\r\n  requireBlurPromise = Promise.resolve();\r\n}\r\n\r\nfunction processBlurNext(\r\n  img: HTMLImageElement,\r\n  radius: number,\r\n  iterations: number,\r\n  canvas: HTMLCanvasElement = document.createElement('canvas')\r\n) {\r\n  canvas.width = img.width;\r\n  canvas.height = img.height;\r\n\r\n  const ctx = canvas.getContext('2d', {alpha: false});\r\n  if(IS_CANVAS_FILTER_SUPPORTED) {\r\n    ctx.filter = `blur(${radius}px)`;\r\n    ctx.drawImage(img, -radius * 2, -radius * 2, canvas.width + radius * 4, canvas.height + radius * 4);\r\n  } else {\r\n    ctx.drawImage(img, 0, 0);\r\n    fastBlurFunc(ctx, 0, 0, canvas.width, canvas.height, radius, iterations);\r\n  }\r\n\r\n  return canvas;\r\n}\r\n\r\ntype CacheValue = {canvas: HTMLCanvasElement, promise: Promise<void>};\r\nconst cache: Map<string, CacheValue> = new Map();\r\nconst CACHE_SIZE = 150;\r\n\r\nexport default function blur(dataUri: string, radius: number = RADIUS, iterations: number = ITERATIONS) {\r\n  if(!dataUri) {\r\n    throw 'no dataUri for blur: ' + dataUri;\r\n  }\r\n\r\n  if(cache.size > CACHE_SIZE) {\r\n    cache.clear();\r\n  }\r\n\r\n  const canvas = document.createElement('canvas');\r\n  canvas.className = 'canvas-thumbnail';\r\n\r\n  let cached = cache.get(dataUri);\r\n  if(!cached) {\r\n    const promise: CacheValue['promise'] = new Promise((resolve) => {\r\n      // return resolve(dataUri);\r\n      requireBlurPromise.then(() => {\r\n        const img = new Image();\r\n        img.onload = () => {\r\n          // if(IS_CANVAS_FILTER_SUPPORTED) {\r\n          // resolve(processBlurNext(img, radius, iterations));\r\n          // } else {\r\n          const promise = addHeavyTask({\r\n            items: [[img, radius, iterations, canvas]],\r\n            context: null,\r\n            process: processBlurNext\r\n          }, 'unshift');\r\n\r\n          promise.then(() => {\r\n            resolve();\r\n          });\r\n          // }\r\n        };\r\n        img.src = dataUri;\r\n      });\r\n    });\r\n\r\n    cache.set(dataUri, cached = {\r\n      canvas,\r\n      promise\r\n    });\r\n  } else {\r\n    canvas.width = cached.canvas.width;\r\n    canvas.height = cached.canvas.height;\r\n    cached.promise.then(() => {\r\n      canvas.getContext('2d').drawImage(cached.canvas, 0, 0, canvas.width, canvas.height);\r\n    });\r\n  }\r\n\r\n  return {\r\n    ...cached,\r\n    canvas\r\n  };\r\n}\r\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport {IS_SAFARI} from '../../environment/userAgent';\nimport bytesFromHex from './bytesFromHex';\nimport bytesToDataURL from './bytesToDataURL';\n\nconst JPEG_HEADER = bytesFromHex('ffd8ffe000104a46494600010100000100010000ffdb004300281c1e231e19282321232d2b28303c64413c37373c7b585d4964918099968f808c8aa0b4e6c3a0aadaad8a8cc8ffcbdaeef5ffffff9bc1fffffffaffe6fdfff8ffdb0043012b2d2d3c353c76414176f8a58ca5f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8ffc00011080000000003012200021101031101ffc4001f0000010501010101010100000000000000000102030405060708090a0bffc400b5100002010303020403050504040000017d01020300041105122131410613516107227114328191a1082342b1c11552d1f02433627282090a161718191a25262728292a3435363738393a434445464748494a535455565758595a636465666768696a737475767778797a838485868788898a92939495969798999aa2a3a4a5a6a7a8a9aab2b3b4b5b6b7b8b9bac2c3c4c5c6c7c8c9cad2d3d4d5d6d7d8d9dae1e2e3e4e5e6e7e8e9eaf1f2f3f4f5f6f7f8f9faffc4001f0100030101010101010101010000000000000102030405060708090a0bffc400b51100020102040403040705040400010277000102031104052131061241510761711322328108144291a1b1c109233352f0156272d10a162434e125f11718191a262728292a35363738393a434445464748494a535455565758595a636465666768696a737475767778797a82838485868788898a92939495969798999aa2a3a4a5a6a7a8a9aab2b3b4b5b6b7b8b9bac2c3c4c5c6c7c8c9cad2d3d4d5d6d7d8d9dae2e3e4e5e6e7e8e9eaf2f3f4f5f6f7f8f9faffda000c03010002110311003f00');\nconst JPEG_TAIL = bytesFromHex('ffd9');\n\nexport default function getPreviewURLFromBytes(bytes: Uint8Array | number[], isSticker = false) {\n  let arr: Uint8Array;\n  if(!isSticker) {\n    arr = new Uint8Array(JPEG_HEADER.concat(Array.from(bytes.slice(3)), JPEG_TAIL));\n    arr[164] = bytes[1];\n    arr[166] = bytes[2];\n  } else {\n    arr = bytes instanceof Uint8Array ? bytes : new Uint8Array(bytes);\n  }\n\n  let mimeType: string;\n  if(isSticker) {\n    mimeType = IS_SAFARI ? 'image/png' : 'image/webp';\n  } else {\n    mimeType = 'image/jpeg';\n  }\n\n  return bytesToDataURL(arr, mimeType);\n}\n","export default function bytesToDataURL(bytes: Uint8Array, mimeType: string = 'image/jpeg') {\n  return `data:${mimeType};base64,${btoa(String.fromCharCode(...bytes))}`;\n}\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n *\r\n * Originally from:\r\n * https://github.com/zhukov/webogram\r\n * Copyright (C) 2014 Igor Zhukov <igor.beatle@gmail.com>\r\n * https://github.com/zhukov/webogram/blob/master/LICENSE\r\n */\r\n\r\nimport {MOUNT_CLASS_TO} from '../config/debug';\r\nimport {makeMediaSize} from './mediaSize';\r\n\r\nexport default function calcImageInBox(imageW: number, imageH: number, boxW: number, boxH: number, noZoom = true) {\r\n  if(imageW < boxW && imageH < boxH && noZoom) {\r\n    return makeMediaSize(imageW, imageH);\r\n  }\r\n\r\n  let boxedImageW = boxW;\r\n  let boxedImageH = boxH;\r\n\r\n  if((imageW / imageH) > (boxW / boxH)) {\r\n    boxedImageH = (imageH * boxW / imageW) | 0;\r\n  } else {\r\n    boxedImageW = (imageW * boxH / imageH) | 0;\r\n    if(boxedImageW > boxW) {\r\n      boxedImageH = (boxedImageH * boxW / boxedImageW) | 0;\r\n      boxedImageW = boxW;\r\n    }\r\n  }\r\n\r\n  // if (Config.Navigator.retina) {\r\n  //   imageW = Math.floor(imageW / 2)\r\n  //   imageH = Math.floor(imageH / 2)\r\n  // }\r\n\r\n  if(noZoom && boxedImageW >= imageW && boxedImageH >= imageH) {\r\n    boxedImageW = imageW;\r\n    boxedImageH = imageH;\r\n  }\r\n\r\n  return makeMediaSize(boxedImageW, boxedImageH);\r\n}\r\n\r\nMOUNT_CLASS_TO.calcImageInBox = calcImageInBox;\r\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\n// import { MOUNT_CLASS_TO } from \"../../config/debug\";\n\nlet context: CanvasRenderingContext2D;\n/**\n * Get the text width\n * @param {string} text\n * @param {string} font\n */\nexport default function getTextWidth(text: string, font: string) {\n  // const perf = performance.now();\n  if(!context) {\n    const canvas = document.createElement('canvas');\n    context = canvas.getContext('2d', {alpha: false});\n    context.font = font;\n  }\n\n  // context.font = font;\n  const metrics = context.measureText(text);\n  // console.log('getTextWidth perf:', performance.now() - perf);\n  return metrics.width;\n  // return Math.round(metrics.width);\n}\n\n// MOUNT_CLASS_TO && (MOUNT_CLASS_TO.getTextWidth = getTextWidth);\n","import type {MediaSize} from '../mediaSize';\n\nexport default function scaleMediaElement(options: {\n  media: CanvasImageSource,\n  mediaSize?: MediaSize,\n  boxSize?: MediaSize,\n  quality?: number,\n  mimeType?: 'image/jpeg' | 'image/png',\n  size?: MediaSize\n}): Promise<{blob: Blob, size: MediaSize}> {\n  return new Promise((resolve) => {\n    const canvas = document.createElement('canvas');\n    const size = options.size ?? options.mediaSize.aspectFitted(options.boxSize);\n    canvas.width = size.width * window.devicePixelRatio;\n    canvas.height = size.height * window.devicePixelRatio;\n    const ctx = canvas.getContext('2d');\n    ctx.drawImage(options.media, 0, 0, canvas.width, canvas.height);\n    canvas.toBlob((blob) => {\n      resolve({blob, size});\n    }, options.mimeType ?? 'image/jpeg', options.quality ?? 1);\n  });\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n *\n * Originally from:\n * https://github.com/zhukov/webogram\n * Copyright (C) 2014 Igor Zhukov <igor.beatle@gmail.com>\n * https://github.com/zhukov/webogram/blob/master/LICENSE\n */\n\nimport LatinizeMap from '../config/latinizeMap';\n\nexport const badCharsRe = /[`~!@#$%^&*()\\-_=+\\[\\]\\\\|{}'\";:\\/?.>,<]+/g;\nconst trimRe = /^\\s+|\\s$/g;\n\nconst C2L: {[k: string]: string} = {\n  '': 'q',\n  '': 'w',\n  '': 'e',\n  '': 'r',\n  '': 't',\n  '': 'y',\n  '': 'u',\n  '': 'i',\n  '': 'o',\n  '': 'p',\n  '': '[',\n  '': ']',\n  '': 'a',\n  '': 's',\n  '': 'd',\n  '': 'f',\n  '': 'g',\n  '': 'h',\n  '': 'j',\n  '': 'k',\n  '': 'l',\n  '': ';',\n  '': '\\'',\n  '': 'z',\n  '': 'x',\n  '': 'c',\n  '': 'v',\n  '': 'b',\n  '': 'n',\n  '': 'm',\n  '': ',',\n  '': '.',\n  '.': '/'\n};\n\nexport function clearBadCharsAndTrim(text: string) {\n  return text.replace(badCharsRe, '').replace(trimRe, '');\n}\n\nexport function fixCyrillic(text: string) {\n  return text.toLowerCase().replace(/[\\w-]/g, (ch) => {\n    const latinizeCh = C2L[ch];\n    return latinizeCh ?? ch;\n  });\n}\n\nexport function latinizeString(text: string) {\n  return text.replace(/[^A-Za-z0-9]/g, (ch) => {\n    const latinizeCh = LatinizeMap[ch];\n    return latinizeCh ?? ch;\n  });\n}\n\nexport default function cleanSearchText(text: string, latinize = true) {\n  return processSearchText(text, {\n    clearBadChars: true,\n    latinize,\n    ignoreCase: true\n  });\n}\n\nexport type ProcessSearchTextOptions = Partial<{\n  clearBadChars: boolean,\n  latinize: boolean,\n  ignoreCase: boolean,\n  includeTag: boolean\n}>;\n\nexport function processSearchText(text: string, options: ProcessSearchTextOptions = {}) {\n  const hasTag = options.includeTag && text.charAt(0) === '%';\n  const originalText = text;\n  if(options.clearBadChars) text = clearBadCharsAndTrim(text);\n  if(options.latinize) text = latinizeString(text);\n  if(options.ignoreCase) text = text.toLowerCase();\n  if(hasTag) text = '%' + text;\n  if(options.latinize) text += '\\x01' + fixCyrillic(originalText);\n  return text;\n}\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\n// https://stackoverflow.com/a/30810322\r\nfunction fallbackCopyTextToClipboard(text: string) {\r\n  var textArea = document.createElement('textarea');\r\n  textArea.value = text;\r\n\r\n  // Avoid scrolling to bottom\r\n  textArea.style.top = '0';\r\n  textArea.style.left = '0';\r\n  textArea.style.position = 'fixed';\r\n\r\n  document.body.appendChild(textArea);\r\n  textArea.focus();\r\n  textArea.select();\r\n\r\n  try {\r\n    document.execCommand('copy');\r\n    // const successful = document.execCommand('copy');\r\n    // const msg = successful ? 'successful' : 'unsuccessful';\r\n    // console.log('Fallback: Copying text command was ' + msg);\r\n  } catch(err) {\r\n    // console.error('Fallback: Oops, unable to copy', err);\r\n  }\r\n\r\n  document.body.removeChild(textArea);\r\n}\r\n\r\nexport function copyTextToClipboard(text: string) {\r\n  if(!navigator.clipboard) {\r\n    fallbackCopyTextToClipboard(text);\r\n    return;\r\n  }\r\n\r\n  navigator.clipboard.writeText(text);/* .then(function() {\r\n    console.log('Async: Copying to clipboard was successful!');\r\n  }, function(err) {\r\n    console.error('Async: Could not copy text: ', err);\r\n  }); */\r\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport IS_TOUCH_SUPPORTED from '../environment/touchSupport';\nimport mediaSizes from './mediaSizes';\nimport OverlayClickHandler from './overlayClickHandler';\n\nclass ContextMenuController extends OverlayClickHandler {\n  constructor() {\n    super('menu', true);\n\n    mediaSizes.addEventListener('resize', () => {\n      if(this.element) {\n        this.close();\n      }\n\n      /* if(openedMenu && (openedMenu.style.top || openedMenu.style.left)) {\n        const rect = openedMenu.getBoundingClientRect();\n        const {innerWidth, innerHeight} = window;\n\n        console.log(innerWidth, innerHeight, rect);\n      } */\n    });\n  }\n\n  public isOpened() {\n    return !!this.element;\n  }\n\n  private onMouseMove = (e: MouseEvent) => {\n    const rect = this.element.getBoundingClientRect();\n    const {clientX, clientY} = e;\n\n    const diffX = clientX >= rect.right ? clientX - rect.right : rect.left - clientX;\n    const diffY = clientY >= rect.bottom ? clientY - rect.bottom : rect.top - clientY;\n\n    if(diffX >= 100 || diffY >= 100) {\n      this.close();\n      // openedMenu.parentElement.click();\n    }\n    // console.log('mousemove', diffX, diffY);\n  };\n\n  public close() {\n    if(this.element) {\n      this.element.classList.remove('active');\n      this.element.parentElement.classList.remove('menu-open');\n    }\n\n    super.close();\n\n    if(!IS_TOUCH_SUPPORTED) {\n      window.removeEventListener('mousemove', this.onMouseMove);\n    }\n  }\n\n  public openBtnMenu(element: HTMLElement, onClose?: () => void) {\n    super.open(element);\n\n    this.element.classList.add('active');\n    this.element.parentElement.classList.add('menu-open');\n\n    if(onClose) {\n      this.addEventListener('toggle', onClose, {once: true});\n    }\n\n    if(!IS_TOUCH_SUPPORTED) {\n      window.addEventListener('mousemove', this.onMouseMove);\n    }\n  }\n}\n\nconst contextMenuController = new ContextMenuController();\nexport default contextMenuController;\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport {MOUNT_CLASS_TO} from '../config/debug';\r\nimport I18n, {i18n} from '../lib/langPack';\r\n\r\nexport const months = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'];\r\nexport const days = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];\r\n\r\nexport const ONE_DAY = 86400;\r\n\r\n// https://stackoverflow.com/a/6117889\r\nexport const getWeekNumber = (date: Date) => {\r\n  const d = new Date(Date.UTC(date.getFullYear(), date.getMonth(), date.getDate()));\r\n  const dayNum = d.getUTCDay() || 7;\r\n  d.setUTCDate(d.getUTCDate() + 4 - dayNum);\r\n  const yearStart = new Date(Date.UTC(d.getUTCFullYear(), 0, 1));\r\n  return Math.ceil((((d.getTime() - yearStart.getTime()) / ONE_DAY) + 1) / 7);\r\n};\r\n\r\nexport function formatDateAccordingToTodayNew(time: Date) {\r\n  const today = new Date();\r\n  const now = today.getTime() / 1000 | 0;\r\n  const timestamp = time.getTime() / 1000 | 0;\r\n\r\n  const options: Intl.DateTimeFormatOptions = {};\r\n  if((now - timestamp) < ONE_DAY && today.getDate() === time.getDate()) { // if the same day\r\n    options.hour = options.minute = '2-digit';\r\n  } else if(today.getFullYear() !== time.getFullYear()) { // different year\r\n    options.year = options.day = 'numeric';\r\n    options.month = '2-digit';\r\n  } else if((now - timestamp) < (ONE_DAY * 7) && getWeekNumber(today) === getWeekNumber(time)) { // current week\r\n    options.weekday = 'short';\r\n  } else { // same year\r\n    options.month = 'short';\r\n    options.day = 'numeric';\r\n  }\r\n\r\n  return new I18n.IntlDateElement({\r\n    date: time,\r\n    options\r\n  }).element;\r\n}\r\n\r\nexport function formatFullSentTimeRaw(timestamp: number, options: {\r\n  capitalize?: boolean\r\n} = {}) {\r\n  const date = new Date();\r\n  const time = new Date(timestamp * 1000);\r\n  const now = date.getTime() / 1000;\r\n\r\n  const timeEl = formatTime(time);\r\n\r\n  let dateEl: Node | string;\r\n  if((now - timestamp) < ONE_DAY && date.getDate() === time.getDate()) { // if the same day\r\n    dateEl = i18n(options.capitalize ? 'Date.Today' : 'Peer.Status.Today');\r\n  } else if((now - timestamp) < (ONE_DAY * 2) && (date.getDate() - 1) === time.getDate()) { // yesterday\r\n    dateEl = i18n(options.capitalize ? 'Yesterday' : 'Peer.Status.Yesterday');\r\n\r\n    if(options.capitalize) {\r\n      (dateEl as HTMLElement).style.textTransform = 'capitalize';\r\n    }\r\n  } else if(date.getFullYear() !== time.getFullYear()) { // different year\r\n    dateEl = new I18n.IntlDateElement({\r\n      date: time,\r\n      options: {\r\n        month: 'short',\r\n        day: 'numeric',\r\n        year: 'numeric'\r\n      }\r\n    }).element;\r\n    // dateStr = months[time.getMonth()].slice(0, 3) + ' ' + time.getDate() + ', ' + time.getFullYear();\r\n  } else {\r\n    dateEl = new I18n.IntlDateElement({\r\n      date: time,\r\n      options: {\r\n        month: 'short',\r\n        day: 'numeric'\r\n      }\r\n    }).element;\r\n    // dateStr = months[time.getMonth()].slice(0, 3) + ' ' + time.getDate();\r\n  }\r\n\r\n  return {dateEl, timeEl};\r\n}\r\n\r\nexport function formatFullSentTime(timestamp: number) {\r\n  const {dateEl, timeEl} = formatFullSentTimeRaw(timestamp, {\r\n    capitalize: true\r\n  });\r\n\r\n  const fragment = document.createDocumentFragment();\r\n  fragment.append(dateEl, ' ', i18n('ScheduleController.at'), ' ', timeEl);\r\n  return fragment;\r\n}\r\n\r\nexport function formatTime(date: Date) {\r\n  return new I18n.IntlDateElement({\r\n    date,\r\n    options: {\r\n      hour: '2-digit',\r\n      minute: '2-digit'\r\n    }\r\n  }).element;\r\n}\r\n\r\nMOUNT_CLASS_TO && (MOUNT_CLASS_TO.formatDateAccordingToTodayNew = formatDateAccordingToTodayNew);\r\n\r\nexport const getFullDate = (date: Date, options: Partial<{\r\n  noTime: true,\r\n  noSeconds: true,\r\n  monthAsNumber: true,\r\n  leadingZero: true\r\n}> = {}) => {\r\n  const joiner = options.monthAsNumber ? '.' : ' ';\r\n  const time = ('0' + date.getHours()).slice(-2) + ':' + ('0' + date.getMinutes()).slice(-2) + (options.noSeconds ? '' : ':' + ('0' + date.getSeconds()).slice(-2));\r\n\r\n  return (options.leadingZero ? ('0' + date.getDate()).slice(-2) : date.getDate()) +\r\n    joiner + (options.monthAsNumber ? ('0' + (date.getMonth() + 1)).slice(-2) : months[date.getMonth()]) +\r\n    joiner + date.getFullYear() +\r\n    (options.noTime ? '' : ', ' + time);\r\n};\r\n\r\n// https://github.com/DrKLO/Telegram/blob/d52b2c921abd3c1e8d6368858313ad0cb0468c07/TMessagesProj/src/main/java/org/telegram/ui/Adapters/FiltersView.java\r\nconst minYear = 2013;\r\nconst yearPattern = new RegExp('20[0-9]{1,2}');\r\nconst monthYearOrDayPattern = new RegExp('(\\\\w{3,}) ([0-9]{0,4})', 'i');\r\nconst yearOrDayAndMonthPattern = new RegExp('([0-9]{0,4}) (\\\\w{2,})', 'i');\r\nconst shortDate = new RegExp('^([0-9]{1,4})(\\\\.| |/|\\\\-)([0-9]{1,4})$', 'i');\r\nconst longDate = new RegExp('^([0-9]{1,2})(\\\\.| |/|\\\\-)([0-9]{1,2})(\\\\.| |/|\\\\-)([0-9]{1,4})$', 'i');\r\nconst numberOfDaysEachMonth = [31, 29, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31];\r\nexport type DateData = {\r\n  title: string,\r\n  minDate: number,\r\n  maxDate: number,\r\n};\r\nexport function fillTipDates(query: string, dates: DateData[]) {\r\n  const q = query.trim().toLowerCase();\r\n\r\n  if(q.length < 3) {\r\n    return;\r\n  }\r\n\r\n  if('today'.indexOf(q) === 0) {\r\n    const date = new Date();\r\n    const year = date.getFullYear();\r\n    const month = date.getMonth();\r\n    const day = date.getDate();\r\n    date.setFullYear(year, month, day);\r\n    date.setHours(0, 0, 0);\r\n\r\n    const minDate = date.getTime();\r\n    date.setFullYear(year, month, day + 1);\r\n    date.setHours(0, 0, 0);\r\n\r\n    const maxDate = date.getTime() - 1;\r\n    dates.push({\r\n      title: 'Today',\r\n      minDate,\r\n      maxDate\r\n    });\r\n    return;\r\n  }\r\n\r\n  if('yesterday'.indexOf(q) === 0) {\r\n    const date = new Date();\r\n    const year = date.getFullYear();\r\n    const month = date.getMonth();\r\n    const day = date.getDate();\r\n    date.setFullYear(year, month, day);\r\n    date.setHours(0, 0, 0);\r\n\r\n    const minDate = date.getTime() - 86400000;\r\n    date.setFullYear(year, month, day + 1);\r\n    date.setHours(0, 0, 0);\r\n\r\n    const maxDate = date.getTime() - 86400001;\r\n    dates.push({\r\n      title: 'Yesterday',\r\n      minDate,\r\n      maxDate\r\n    });\r\n    return;\r\n  }\r\n\r\n  const dayOfWeek = getDayOfWeek(q);\r\n  if(dayOfWeek >= 0) {\r\n    const date = new Date();\r\n    const now = date.getTime();\r\n    const currentDay = date.getDay();\r\n    const distance = dayOfWeek - currentDay;\r\n    date.setDate(date.getDate() + distance);\r\n    if(date.getTime() > now) {\r\n      date.setTime(date.getTime() - 604800000);\r\n    }\r\n    const year = date.getFullYear()\r\n    const month = date.getMonth();\r\n    const day = date.getDate();\r\n    date.setFullYear(year, month, day);\r\n    date.setHours(0, 0, 0);\r\n\r\n    const minDate = date.getTime();\r\n    date.setFullYear(year, month, day + 1);\r\n    date.setHours(0, 0, 0);\r\n\r\n    const maxDate = date.getTime() - 1;\r\n    dates.push({\r\n      title: formatWeekLong(minDate),\r\n      minDate,\r\n      maxDate\r\n    });\r\n    return;\r\n  }\r\n\r\n  let matches: any[];\r\n  if((matches = shortDate.exec(q)) !== null) {\r\n    const g1 = matches[1];\r\n    const g2 = matches[3];\r\n    const k = parseInt(g1);\r\n    const k1 = parseInt(g2);\r\n    if(k > 0 && k <= 31) {\r\n      if(k1 >= minYear && k <= 12) {\r\n        const selectedYear = k1;\r\n        const month = k - 1;\r\n        createForMonthYear(dates, month, selectedYear);\r\n        return;\r\n      } else if(k1 <= 12) {\r\n        const day = k - 1;\r\n        const month = k1 - 1;\r\n        createForDayMonth(dates, day, month);\r\n      }\r\n    } else if(k >= minYear && k1 <= 12) {\r\n      const selectedYear = k;\r\n      const month = k1 - 1;\r\n      createForMonthYear(dates, month, selectedYear);\r\n    }\r\n\r\n    return;\r\n  }\r\n\r\n  if((matches = longDate.exec(q)) !== null) {\r\n    const g1 = matches[1];\r\n    const g2 = matches[3];\r\n    const g3 = matches[5];\r\n    if(!matches[2] === matches[4]) {\r\n      return;\r\n    }\r\n\r\n    const day = parseInt(g1);\r\n    const month = parseInt(g2) - 1;\r\n    let year = parseInt(g3);\r\n    if(year >= 10 && year <= 99) {\r\n      year += 2000;\r\n    }\r\n\r\n    const currentYear = new Date().getFullYear();\r\n    if(validDateForMonth(day - 1, month) && year >= minYear && year <= currentYear) {\r\n      const date = new Date();\r\n      date.setFullYear(year, month, day);\r\n      date.setHours(0, 0, 0);\r\n\r\n      const minDate = date.getTime();\r\n      date.setFullYear(year, month, day + 1);\r\n      date.setHours(0, 0, 0);\r\n\r\n      const maxDate = date.getTime() - 1;\r\n      dates.push({\r\n        title: formatterYearMax(minDate),\r\n        minDate,\r\n        maxDate\r\n      });\r\n      return;\r\n    }\r\n\r\n    return;\r\n  }\r\n\r\n  if((matches = yearPattern.exec(q)) !== null) {\r\n    let selectedYear = +q;\r\n    const currentYear = new Date().getFullYear();\r\n    if(selectedYear < minYear) {\r\n      selectedYear = minYear;\r\n      for(let i = currentYear; i >= selectedYear; i--) {\r\n        const date = new Date();\r\n        date.setFullYear(i, 0, 1);\r\n        date.setHours(0, 0, 0);\r\n\r\n        const minDate = date.getTime();\r\n        date.setFullYear(i + 1, 0, 1);\r\n        date.setHours(0, 0, 0);\r\n\r\n        const maxDate = date.getTime() - 1;\r\n        dates.push({\r\n          title: '' + i,\r\n          minDate,\r\n          maxDate\r\n        });\r\n      }\r\n    } else if(selectedYear <= currentYear) {\r\n      const date = new Date();\r\n      date.setFullYear(selectedYear, 0, 1);\r\n      date.setHours(0, 0, 0);\r\n\r\n      const minDate = date.getTime();\r\n      date.setFullYear(selectedYear + 1, 0, 1);\r\n      date.setHours(0, 0, 0);\r\n\r\n      const maxDate = date.getTime() - 1;\r\n      dates.push({\r\n        title: '' + selectedYear,\r\n        minDate,\r\n        maxDate\r\n      });\r\n    }\r\n\r\n    return;\r\n  }\r\n\r\n  if((matches = monthYearOrDayPattern.exec(q)) !== null) {\r\n    const g1 = matches[1];\r\n    const g2 = matches[2];\r\n    const month = getMonth(g1);\r\n    if(month >= 0) {\r\n      const k = +g2;\r\n      if(k > 0 && k <= 31) {\r\n        const day = k - 1;\r\n        createForDayMonth(dates, day, month);\r\n        return;\r\n      } else if(k >= minYear) {\r\n        const selectedYear = k;\r\n        createForMonthYear(dates, month, selectedYear);\r\n        return;\r\n      }\r\n    }\r\n  }\r\n\r\n  if((matches = yearOrDayAndMonthPattern.exec(q)) !== null) {\r\n    const g1 = matches[1];\r\n    const g2 = matches[2];\r\n    const month = getMonth(g2);\r\n    if(month >= 0) {\r\n      const k = +g1;\r\n      if(k > 0 && k <= 31) {\r\n        const day = k - 1;\r\n        createForDayMonth(dates, day, month);\r\n        return;\r\n      } else if(k >= minYear) {\r\n        const selectedYear = k;\r\n        createForMonthYear(dates, month, selectedYear);\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\nfunction createForMonthYear(dates: DateData[], month: number, selectedYear: number) {\r\n  const currentYear = new Date().getFullYear();\r\n  const today = Date.now();\r\n  if(selectedYear >= minYear && selectedYear <= currentYear) {\r\n    const date = new Date();\r\n    date.setFullYear(selectedYear, month, 1);\r\n    date.setHours(0, 0, 0);\r\n    const minDate = date.getTime();\r\n    if(minDate > today) {\r\n      return;\r\n    }\r\n    date.setMonth(date.getMonth() + 1);\r\n    const maxDate = date.getTime() - 1;\r\n\r\n    dates.push({\r\n      title: formatterMonthYear(minDate),\r\n      minDate,\r\n      maxDate\r\n    });\r\n  }\r\n}\r\n\r\nfunction createForDayMonth(dates: DateData[], day: number, month: number) {\r\n  if(validDateForMonth(day, month)) {\r\n    const currentYear = new Date().getFullYear();\r\n    const today = Date.now();\r\n\r\n    for(let i = currentYear; i >= minYear; i--) {\r\n      if(month === 1 && day === 28 && !isLeapYear(i)) {\r\n        continue;\r\n      }\r\n\r\n      const date = new Date();\r\n      date.setFullYear(i, month, day + 1);\r\n      date.setHours(0, 0, 0);\r\n\r\n      const minDate = date.getTime();\r\n      if(minDate > today) {\r\n        continue;\r\n      }\r\n\r\n      date.setFullYear(i, month, day + 2);\r\n      date.setHours(0, 0, 0);\r\n      const maxDate = date.getTime() - 1;\r\n      if(i === currentYear) {\r\n        dates.push({\r\n          title: formatterDayMonth(minDate),\r\n          minDate,\r\n          maxDate\r\n        });\r\n      } else {\r\n        dates.push({\r\n          title: formatterYearMax(minDate),\r\n          minDate,\r\n          maxDate\r\n        });\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\nfunction formatterMonthYear(timestamp: number) {\r\n  const date = new Date(timestamp);\r\n  return months[date.getMonth()].slice(0, 3) + ' ' + date.getFullYear();\r\n}\r\n\r\nfunction formatterDayMonth(timestamp: number) {\r\n  const date = new Date(timestamp);\r\n  return months[date.getMonth()].slice(0, 3) + ' ' + date.getDate();\r\n}\r\n\r\nfunction formatterYearMax(timestamp: number) {\r\n  const date = new Date(timestamp);\r\n  return ('0' + date.getDate()).slice(-2) + '.' + ('0' + (date.getMonth() + 1)).slice(-2) + '.' + date.getFullYear();\r\n}\r\n\r\nfunction formatWeekLong(timestamp: number) {\r\n  const date = new Date(timestamp);\r\n  return days[date.getDay()];\r\n}\r\n\r\nfunction validDateForMonth(day: number, month: number) {\r\n  if(month >= 0 && month < 12) {\r\n    if(day >= 0 && day < numberOfDaysEachMonth[month]) {\r\n      return true;\r\n    }\r\n  }\r\n  return false;\r\n}\r\n\r\nfunction isLeapYear(year: number) {\r\n  return ((year % 4 === 0) && (year % 100 !== 0)) || (year % 400 === 0);\r\n}\r\n\r\nfunction getMonth(q: string) {\r\n  /* String[] months = new String[]{\r\n          LocaleController.getString(\"January\", R.string.January).toLowerCase(),\r\n          LocaleController.getString(\"February\", R.string.February).toLowerCase(),\r\n          LocaleController.getString(\"March\", R.string.March).toLowerCase(),\r\n          LocaleController.getString(\"April\", R.string.April).toLowerCase(),\r\n          LocaleController.getString(\"May\", R.string.May).toLowerCase(),\r\n          LocaleController.getString(\"June\", R.string.June).toLowerCase(),\r\n          LocaleController.getString(\"July\", R.string.July).toLowerCase(),\r\n          LocaleController.getString(\"August\", R.string.August).toLowerCase(),\r\n          LocaleController.getString(\"September\", R.string.September).toLowerCase(),\r\n          LocaleController.getString(\"October\", R.string.October).toLowerCase(),\r\n          LocaleController.getString(\"November\", R.string.November).toLowerCase(),\r\n          LocaleController.getString(\"December\", R.string.December).toLowerCase()\r\n  }; */\r\n\r\n  /* String[] monthsEng = new String[12];\r\n  Calendar c = Calendar.getInstance();\r\n  for (int i = 1; i <= 12; i++) {\r\n      c.set(0, 0, 0, 0, 0, 0);\r\n      c.set(Calendar.MONTH, i);\r\n      monthsEng[i - 1] = c.getDisplayName(Calendar.MONTH, Calendar.LONG, Locale.ENGLISH).toLowerCase();\r\n  } */\r\n\r\n  q = q.toLowerCase();\r\n  for(let i = 0; i < 12; i++) {\r\n    const month = months[i].toLowerCase();\r\n    if(month.indexOf(q) === 0) {\r\n      return i;\r\n    }\r\n  }\r\n  return -1;\r\n}\r\n\r\nfunction getDayOfWeek(q: string) {\r\n  const c = new Date();\r\n  if(q.length <= 3) {\r\n    return -1;\r\n  }\r\n\r\n  for(let i = 0; i < 7; i++) {\r\n    c.setDate(c.getDate() + 1);\r\n\r\n    if(formatWeekLong(c.getTime()).toLowerCase().indexOf(q) === 0) {\r\n      return c.getDay();\r\n    }\r\n  }\r\n  return -1;\r\n}\r\n\r\nMOUNT_CLASS_TO.fillTipDates = fillTipDates;\r\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport IS_TOUCH_SUPPORTED from '../../environment/touchSupport';\nimport {IS_APPLE} from '../../environment/userAgent';\nimport contextMenuController from '../contextMenuController';\nimport ListenerSetter from '../listenerSetter';\nimport cancelEvent from './cancelEvent';\n\nlet _cancelContextMenuOpening = false, _cancelContextMenuOpeningTimeout = 0;\nexport function cancelContextMenuOpening() {\n  if(_cancelContextMenuOpeningTimeout) {\n    clearTimeout(_cancelContextMenuOpeningTimeout);\n  }\n\n  _cancelContextMenuOpeningTimeout = window.setTimeout(() => {\n    _cancelContextMenuOpeningTimeout = 0;\n    _cancelContextMenuOpening = false;\n  }, .4e3);\n\n  _cancelContextMenuOpening = true;\n}\n\nexport function attachContextMenuListener(element: HTMLElement, callback: (e: Touch | MouseEvent) => void, listenerSetter?: ListenerSetter) {\n  const add = listenerSetter ? listenerSetter.add(element) : element.addEventListener.bind(element);\n  const remove = listenerSetter ? listenerSetter.removeManual.bind(listenerSetter, element) : element.removeEventListener.bind(element);\n\n  if(IS_APPLE && IS_TOUCH_SUPPORTED) {\n    let timeout: number;\n\n    const options: EventListenerOptions = {capture: true};\n\n    const onCancel = () => {\n      clearTimeout(timeout);\n      // @ts-ignore\n      remove('touchmove', onCancel, options);\n      // @ts-ignore\n      remove('touchend', onCancel, options);\n      // @ts-ignore\n      remove('touchcancel', onCancel, options);\n    };\n\n    add('touchstart', (e: TouchEvent) => {\n      if(e.touches.length > 1) {\n        onCancel();\n        return;\n      }\n\n      add('touchmove', onCancel, options);\n      add('touchend', onCancel, options);\n      add('touchcancel', onCancel, options);\n\n      timeout = window.setTimeout(() => {\n        if(_cancelContextMenuOpening) {\n          onCancel();\n          return;\n        }\n\n        callback(e.touches[0]);\n        onCancel();\n\n        if(contextMenuController.isOpened()) {\n          element.addEventListener('touchend', cancelEvent, {once: true}); // * fix instant closing\n        }\n      }, .4e3);\n    });\n\n    /* if(!isSafari) {\n      add('contextmenu', (e: any) => {\n        cancelEvent(e);\n      }, {passive: false, capture: true});\n    } */\n  } else {\n    add('contextmenu', IS_TOUCH_SUPPORTED ? (e: any) => {\n      callback(e);\n\n      if(contextMenuController.isOpened()) {\n        element.addEventListener('touchend', cancelEvent, {once: true}); // * fix instant closing\n      }\n    } : callback);\n  }\n}\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nexport type GrabEvent = {x: number, y: number, isTouch?: boolean, event: TouchEvent | MouseEvent};\r\n\r\nexport default function attachGrabListeners(element: HTMLElement,\r\n  onStart: (position: GrabEvent) => void,\r\n  onMove: (position: GrabEvent) => void,\r\n  onEnd?: (position: GrabEvent) => void) {\r\n  // * Mouse\r\n  const onMouseMove = (event: MouseEvent) => {\r\n    onMove({x: event.pageX, y: event.pageY, event});\r\n  };\r\n\r\n  const onMouseUp = (event: MouseEvent) => {\r\n    document.removeEventListener('mousemove', onMouseMove);\r\n    element.addEventListener('mousedown', onMouseDown, {once: true});\r\n    onEnd && onEnd({x: event.pageX, y: event.pageY, event});\r\n  };\r\n\r\n  const onMouseDown = (event: MouseEvent) => {\r\n    if(event.button !== 0) {\r\n      element.addEventListener('mousedown', onMouseDown, {once: true});\r\n      return;\r\n    }\r\n\r\n    onStart({x: event.pageX, y: event.pageY, event});\r\n    onMouseMove(event);\r\n\r\n    document.addEventListener('mousemove', onMouseMove);\r\n    document.addEventListener('mouseup', onMouseUp, {once: true});\r\n  };\r\n\r\n  element.addEventListener('mousedown', onMouseDown, {once: true});\r\n\r\n  // * Touch\r\n  const onTouchMove = (event: TouchEvent) => {\r\n    event.preventDefault();\r\n    onMove({x: event.touches[0].clientX, y: event.touches[0].clientY, isTouch: true, event});\r\n  };\r\n\r\n  const onTouchEnd = (event: TouchEvent) => {\r\n    document.removeEventListener('touchmove', onTouchMove);\r\n    element.addEventListener('touchstart', onTouchStart, {passive: false, once: true});\r\n    onEnd && onEnd({x: event.touches[0].clientX, y: event.touches[0].clientY, isTouch: true, event});\r\n  };\r\n\r\n  const onTouchStart = (event: TouchEvent) => {\r\n    onStart({x: event.touches[0].clientX, y: event.touches[0].clientY, isTouch: true, event});\r\n    onTouchMove(event);\r\n\r\n    document.addEventListener('touchmove', onTouchMove, {passive: false});\r\n    document.addEventListener('touchend', onTouchEnd, {passive: false, once: true});\r\n  };\r\n\r\n  element.addEventListener('touchstart', onTouchStart, {passive: false, once: true});\r\n\r\n  return () => {\r\n    element.removeEventListener('mousedown', onMouseDown);\r\n    document.removeEventListener('mousemove', onMouseMove);\r\n    document.removeEventListener('mouseup', onMouseUp);\r\n\r\n    element.removeEventListener('touchstart', onTouchStart);\r\n    document.removeEventListener('touchmove', onTouchMove);\r\n    document.removeEventListener('touchend', onTouchEnd);\r\n  };\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nexport default function cancelSelection() {\r\n  if(window.getSelection) {\r\n    if(window.getSelection().empty) {  // Chrome\r\n      window.getSelection().empty();\r\n    } else if(window.getSelection().removeAllRanges) {  // Firefox\r\n      window.getSelection().removeAllRanges();\r\n    }\r\n    // @ts-ignore\r\n  } else if(document.selection) {  // IE?\r\n    // @ts-ignore\r\n    document.selection.empty();\r\n  }\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport type ListenerSetter from '../listenerSetter';\r\nimport IS_TOUCH_SUPPORTED from '../../environment/touchSupport';\r\nimport simulateEvent from './dispatchEvent';\r\n\r\nexport const CLICK_EVENT_NAME: 'mousedown' /* | 'touchend' */ | 'click' = (IS_TOUCH_SUPPORTED ? 'mousedown' : 'click') as any;\r\nexport type AttachClickOptions = AddEventListenerOptions & Partial<{listenerSetter: ListenerSetter, touchMouseDown: true}>;\r\nexport function attachClickEvent(elem: HTMLElement | Window, callback: (e: /* TouchEvent |  */MouseEvent) => void, options: AttachClickOptions = {}) {\r\n  const add = options.listenerSetter ? options.listenerSetter.add(elem) : elem.addEventListener.bind(elem);\r\n  // const remove = options.listenerSetter ? options.listenerSetter.removeManual.bind(options.listenerSetter, elem) : elem.removeEventListener.bind(elem);\r\n\r\n  options.touchMouseDown = true;\r\n  /* if(options.touchMouseDown && CLICK_EVENT_NAME === 'touchend') {\r\n    add('mousedown', callback, options);\r\n  } else if(CLICK_EVENT_NAME === 'touchend') {\r\n    const o = {...options, once: true};\r\n\r\n    const onTouchStart = (e: TouchEvent) => {\r\n      const onTouchMove = (e: TouchEvent) => {\r\n        remove('touchmove', onTouchMove, o);\r\n        remove('touchend', onTouchEnd, o);\r\n      };\r\n\r\n      const onTouchEnd = (e: TouchEvent) => {\r\n        remove('touchmove', onTouchMove, o);\r\n        callback(e);\r\n        if(options.once) {\r\n          remove('touchstart', onTouchStart);\r\n        }\r\n      };\r\n\r\n      add('touchend', onTouchEnd, o);\r\n      add('touchmove', onTouchMove, o);\r\n    };\r\n\r\n    add('touchstart', onTouchStart);\r\n  } else {\r\n    add(CLICK_EVENT_NAME, callback, options);\r\n  } */\r\n  add(CLICK_EVENT_NAME, callback, options);\r\n}\r\n\r\nexport function detachClickEvent(elem: HTMLElement | Window, callback: (e: /* TouchEvent |  */MouseEvent) => void, options?: AddEventListenerOptions) {\r\n  // if(CLICK_EVENT_NAME === 'touchend') {\r\n  //   elem.removeEventListener('touchstart', callback, options);\r\n  // } else {\r\n  elem.removeEventListener(CLICK_EVENT_NAME, callback as any, options);\r\n  // }\r\n}\r\n\r\nexport function simulateClickEvent(elem: HTMLElement) {\r\n  simulateEvent(elem, CLICK_EVENT_NAME);\r\n}\r\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport IS_TOUCH_SUPPORTED from '../../environment/touchSupport';\nimport EventListenerBase from '../eventListenerBase';\nimport ListenerSetter from '../listenerSetter';\nimport safeAssign from '../object/safeAssign';\nimport findUpClassName from './findUpClassName';\n\nexport default class ControlsHover extends EventListenerBase<{\n  toggleControls: (show: boolean) => void\n}> {\n  protected hideControlsTimeout: number;\n  protected controlsLocked: boolean;\n\n  protected canHideControls: () => boolean;\n  protected element: HTMLElement;\n  protected listenerSetter: ListenerSetter;\n  protected showOnLeaveToClassName: string;\n  protected ignoreClickClassName: string;\n\n  constructor() {\n    super(false);\n    this.hideControlsTimeout = 0;\n  }\n\n  public setup(options: {\n    element: HTMLElement,\n    listenerSetter: ListenerSetter,\n    canHideControls?: () => boolean,\n    showOnLeaveToClassName?: string,\n    ignoreClickClassName?: string\n  }) {\n    safeAssign(this, options);\n\n    const {listenerSetter, element} = this;\n\n    if(IS_TOUCH_SUPPORTED) {\n      listenerSetter.add(element)('click', (e) => {\n        if(this.ignoreClickClassName && findUpClassName(e.target, this.ignoreClickClassName)) {\n          return;\n        }\n\n        this.toggleControls();\n      });\n\n      /* listenerSetter.add(player)('touchstart', () => {\n        showControls(false);\n      });\n\n      listenerSetter.add(player)('touchend', () => {\n        if(player.classList.contains('is-playing')) {\n          showControls();\n        }\n      }); */\n    } else {\n      listenerSetter.add(element)('mousemove', () => {\n        this.showControls();\n      });\n\n      listenerSetter.add(element)('mouseenter', () => {\n        this.showControls(false);\n      });\n\n      listenerSetter.add(element)('mouseleave', (e) => {\n        if(e.relatedTarget && this.showOnLeaveToClassName && findUpClassName(e.relatedTarget, this.showOnLeaveToClassName)) {\n          this.showControls(false);\n          return;\n        }\n\n        this.hideControls();\n      });\n    }\n  }\n\n  public hideControls = (setHideTimeout = false) => {\n    if(setHideTimeout) {\n      if(!this.hideControlsTimeout) {\n        this.hideControlsTimeout = window.setTimeout(this.hideControls, 3e3);\n      }\n\n      return;\n    }\n\n    clearTimeout(this.hideControlsTimeout);\n    this.hideControlsTimeout = 0;\n\n    const isShown = this.element.classList.contains('show-controls');\n    if(this.controlsLocked !== false) {\n      if((this.canHideControls ? !this.canHideControls() : false) || !isShown || this.controlsLocked) {\n        return;\n      }\n    } else if(!isShown) {\n      return;\n    }\n\n    this.dispatchEvent('toggleControls', false);\n    this.element.classList.remove('show-controls');\n  };\n\n  public showControls = (setHideTimeout = true) => {\n    if(this.hideControlsTimeout) {\n      clearTimeout(this.hideControlsTimeout);\n      this.hideControlsTimeout = 0;\n    } else if(!this.element.classList.contains('show-controls') && this.controlsLocked !== false) {\n      this.dispatchEvent('toggleControls', true);\n      this.element.classList.add('show-controls');\n    }\n\n    if(!setHideTimeout || this.controlsLocked) {\n      return;\n    }\n\n    this.hideControlsTimeout = window.setTimeout(this.hideControls, 3e3);\n  };\n\n  public toggleControls = (show?: boolean) => {\n    const isShown = this.element.classList.contains('show-controls');\n\n    if(show === undefined) {\n      if(isShown) this.hideControls();\n      else this.showControls();\n    } else if(show === isShown) return;\n    else if(show === false) this.hideControls();\n    else this.showControls();\n  };\n\n  public lockControls(visible: boolean) {\n    this.controlsLocked = visible;\n\n    this.element.classList.toggle('disable-hover', visible === false);\n    this.toggleControls(visible);\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport type {MyDocument} from '../../lib/appManagers/appDocsManager';\nimport PopupStickers from '../../components/popups/stickers';\nimport appImManager from '../../lib/appManagers/appImManager';\nimport rootScope from '../../lib/rootScope';\nimport createContextMenu from './createContextMenu';\nimport findUpClassName from './findUpClassName';\nimport emoticonsDropdown, {EmoticonsDropdown} from '../../components/emoticonsDropdown';\n\nexport default function createStickersContextMenu(options: {\n  listenTo: HTMLElement,\n  isStickerPack?: boolean,\n  verifyRecent?: (target: HTMLElement) => boolean,\n  appendTo?: HTMLElement,\n  onOpen?: () => any,\n  onClose?: () => any,\n  onSend?: () => any\n}) {\n  const {listenTo, isStickerPack, verifyRecent, appendTo, onOpen, onClose, onSend} = options;\n  let target: HTMLElement, doc: MyDocument;\n  const verifyFavoriteSticker = async(toAdd: boolean) => {\n    const favedStickers = await rootScope.managers.acknowledged.appStickersManager.getFavedStickersStickers();\n    if(!favedStickers.cached) {\n      return false;\n    }\n\n    const found = (await favedStickers.result).some((_doc) => _doc.id === doc.id);\n    return toAdd ? !found : found;\n  };\n\n  return createContextMenu({\n    listenTo: listenTo,\n    appendTo,\n    findElement: (e) => target = findUpClassName(e.target, 'media-sticker-wrapper'),\n    onOpen: async() => {\n      doc = await rootScope.managers.appDocsManager.getDoc(target.dataset.docId);\n      return onOpen?.();\n    },\n    onClose,\n    buttons: [{\n      icon: 'stickers',\n      text: 'Context.ViewStickerSet',\n      onClick: () => new PopupStickers(doc.stickerSetInput).show(),\n      verify: () => !isStickerPack\n    }, {\n      icon: 'favourites',\n      text: 'AddToFavorites',\n      onClick: () => rootScope.managers.appStickersManager.faveSticker(doc.id, false),\n      verify: () => verifyFavoriteSticker(true)\n    }, {\n      icon: 'favourites',\n      text: 'DeleteFromFavorites',\n      onClick: () => rootScope.managers.appStickersManager.faveSticker(doc.id, true),\n      verify: () => verifyFavoriteSticker(false)\n    }, {\n      icon: 'delete',\n      text: 'DeleteFromRecent',\n      onClick: () => emoticonsDropdown.stickersTab.deleteRecentSticker(doc),\n      verify: () => verifyRecent?.(target) ?? false\n    }, {\n      icon: 'mute',\n      text: 'Chat.Send.WithoutSound',\n      onClick: () => {\n        onSend?.();\n        return EmoticonsDropdown.sendDocId(doc.id, false, true);\n      },\n      verify: () => !!(appImManager.chat.peerId && appImManager.chat.peerId !== rootScope.myId)\n    }, {\n      icon: 'schedule',\n      text: 'Chat.Send.ScheduledMessage',\n      onClick: () => appImManager.chat.input.scheduleSending(() => appImManager.chat.input.sendMessageWithDocument(doc)),\n      verify: () => !!appImManager.chat.peerId\n    }]\n  });\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport ButtonMenu, {ButtonMenuItemOptions} from '../../components/buttonMenu';\nimport filterAsync from '../array/filterAsync';\nimport contextMenuController from '../contextMenuController';\nimport ListenerSetter from '../listenerSetter';\nimport {getMiddleware} from '../middleware';\nimport positionMenu from '../positionMenu';\nimport {attachContextMenuListener} from './attachContextMenuListener';\n\nexport default function createContextMenu<T extends ButtonMenuItemOptions & {verify?: () => boolean | Promise<boolean>}>({\n  buttons,\n  findElement,\n  listenTo,\n  appendTo,\n  filterButtons,\n  onOpen,\n  onClose\n}: {\n  buttons: T[],\n  findElement: (e: MouseEvent) => HTMLElement,\n  listenTo: HTMLElement,\n  appendTo?: HTMLElement,\n  filterButtons?: (buttons: T[]) => Promise<T[]>,\n  onOpen?: (target: HTMLElement) => any,\n  onClose?: () => any\n}) {\n  appendTo ??= document.body;\n\n  const attachListenerSetter = new ListenerSetter();\n  const listenerSetter = new ListenerSetter();\n  const middleware = getMiddleware();\n  let element: HTMLElement;\n\n  attachContextMenuListener(listenTo, (e) => {\n    const target = findElement(e as any);\n    if(!target) {\n      return;\n    }\n\n    let _element = element;\n    if(e instanceof MouseEvent || e.hasOwnProperty('preventDefault')) (e as any).preventDefault();\n    if(_element && _element.classList.contains('active')) {\n      return false;\n    }\n    if(e instanceof MouseEvent || e.hasOwnProperty('cancelBubble')) (e as any).cancelBubble = true;\n\n    const r = async() => {\n      await onOpen?.(target);\n\n      const initResult = await init();\n      if(!initResult) {\n        return;\n      }\n\n      _element = initResult.element;\n      const {cleanup, destroy} = initResult;\n\n      positionMenu(e, _element);\n      contextMenuController.openBtnMenu(_element, () => {\n        onClose?.();\n        cleanup();\n\n        setTimeout(() => {\n          destroy();\n        }, 300);\n      });\n    };\n\n    r();\n  }, attachListenerSetter);\n\n  const cleanup = () => {\n    listenerSetter.removeAll();\n    middleware.clean();\n  };\n\n  const destroy = () => {\n    cleanup();\n    attachListenerSetter.removeAll();\n  };\n\n  const init = async() => {\n    cleanup();\n\n    buttons.forEach((button) => button.element = undefined);\n    const f = filterButtons || ((buttons: T[]) => filterAsync(buttons, (button) => button?.verify?.() ?? true));\n\n    const filteredButtons = await f(buttons);\n    if(!filteredButtons.length) {\n      return;\n    }\n\n    const _element = element = ButtonMenu(filteredButtons, listenerSetter);\n    _element.classList.add('contextmenu');\n\n    appendTo.append(_element);\n\n    return {\n      element: _element,\n      cleanup,\n      destroy: () => {\n        _element.remove();\n      }\n    };\n  };\n\n  return {element, destroy};\n}\n","export default function createVideo(options: {\n  pip?: boolean\n} = {}) {\n  const video = document.createElement('video');\n  if(!options.pip) video.disablePictureInPicture = true;\n  video.setAttribute('playsinline', 'true');\n  return video;\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport rootScope from '../../lib/rootScope';\n\nexport type CustomProperty = string;\n\nexport class CustomProperties {\n  private cache: {[k in CustomProperty]?: string};\n  private computedStyle: CSSStyleDeclaration;\n\n  constructor() {\n    this.cache = {};\n\n    rootScope.addEventListener('theme_change', () => {\n      this.computedStyle = undefined;\n      const cache = this.cache;\n      this.cache = {};\n\n      for(const i in cache) {\n        this.getProperty(i);\n      }\n    });\n  }\n\n  public getProperty(name: CustomProperty) {\n    let value = this.cache[name];\n    if(value) {\n      return value;\n    }\n\n    if(!this.computedStyle) {\n      this.computedStyle = window.getComputedStyle(document.documentElement);\n    }\n\n    value = this.computedStyle.getPropertyValue('--' + name).trim();\n    return this.cache[name] = value;\n  }\n}\n\nconst customProperties = new CustomProperties();\nexport default customProperties;\n","export default function simulateEvent(elem: EventTarget, name: string) {\n  const event = new Event(name, {bubbles: true, cancelable: true});\n  elem.dispatchEvent(event);\n}\n","import encodeEntities from '../string/encodeEntities';\n\nexport default function documentFragmentToHTML(fragment: DocumentFragment) {\n  return Array.from(fragment.childNodes).map((node) => {\n    return node.nodeType === 3 ? encodeEntities(node.textContent) : (node as Element).outerHTML;\n  }).join('');\n}\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nexport default function findUpAsChild(el: HTMLElement, parent: HTMLElement): HTMLElement {\r\n  if(el.parentElement === parent) return el;\r\n\r\n  while(el.parentElement) {\r\n    el = el.parentElement;\r\n    if(el.parentElement === parent) {\r\n      return el;\r\n    }\r\n  }\r\n\r\n  return null;\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nexport default function findUpAttribute(el: any, attribute: string): HTMLElement {\r\n  return el.closest(`[${attribute}]`);\r\n  /* if(el.getAttribute(attribute) !== null) return el; // 03.02.2020\r\n\r\n  while(el.parentElement) {\r\n    el = el.parentElement;\r\n    if(el.getAttribute(attribute) !== null)\r\n      return el;\r\n  }\r\n  return null; */\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nexport default function findUpTag(el: any, tag: string): HTMLElement {\r\n  return el.closest(tag);\r\n  /* if(el.tagName === tag) return el; // 03.02.2020\r\n\r\n  while(el.parentElement) {\r\n    el = el.parentElement;\r\n    if(el.tagName === tag)\r\n      return el;\r\n  }\r\n  return null; */\r\n}\r\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport type ListenerSetter from '../listenerSetter';\n\nexport function requestFullScreen(element: HTMLElement) {\n  if(element.requestFullscreen) {\n    element.requestFullscreen();\n    // @ts-ignore\n  } else if(element.mozRequestFullScreen) {\n    // @ts-ignore\n    element.mozRequestFullScreen(); // Firefox\n    // @ts-ignore\n  } else if(element.webkitRequestFullscreen) {\n    // @ts-ignore\n    element.webkitRequestFullscreen(); // Chrome and Safari\n    // @ts-ignore\n  } else if(element.msRequestFullscreen) {\n    // @ts-ignore\n    element.msRequestFullscreen();\n  }\n}\n\nexport function cancelFullScreen() {\n  // @ts-ignore\n  if(document.cancelFullScreen) {\n    // @ts-ignore\n    document.cancelFullScreen();\n    // @ts-ignore\n  } else if(document.mozCancelFullScreen) {\n    // @ts-ignore\n    document.mozCancelFullScreen();\n    // @ts-ignore\n  } else if(document.webkitCancelFullScreen) {\n    // @ts-ignore\n    document.webkitCancelFullScreen();\n    // @ts-ignore\n  } else if(document.msExitFullscreen) {\n    // @ts-ignore\n    document.msExitFullscreen();\n  }\n}\n\nexport function addFullScreenListener(element: HTMLElement, callback: (e: Event) => any, listenerSetter?: ListenerSetter) {\n  const addListener = listenerSetter ? listenerSetter.add(element) : element.addEventListener.bind(element);\n  'webkitfullscreenchange mozfullscreenchange fullscreenchange MSFullscreenChange'.split(' ').forEach((eventName) => {\n    addListener(eventName, callback, false);\n  });\n}\n\nexport function getFullScreenElement(): HTMLElement {\n  // @ts-ignore\n  return document.fullscreenElement || document.mozFullScreenElement || document.webkitFullscreenElement || document.msFullscreenElement;\n}\n\nexport function isFullScreen() {\n  return !!getFullScreenElement();\n}\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n *\r\n * Originally from:\r\n * https://github.com/zhukov/webogram\r\n * Copyright (C) 2014 Igor Zhukov <igor.beatle@gmail.com>\r\n * https://github.com/zhukov/webogram/blob/master/LICENSE\r\n */\r\n\r\nimport {MessageEntity} from '../../layer';\r\n\r\nexport type MarkdownType = 'bold' | 'italic' | 'underline' | 'strikethrough' | 'monospace' | 'link' | 'mentionName' | 'spoiler';\r\nexport type MarkdownTag = {\r\n  match: string,\r\n  entityName: Extract<MessageEntity['_'], 'messageEntityBold' | 'messageEntityUnderline' | 'messageEntityItalic' | 'messageEntityCode' | 'messageEntityStrike' | 'messageEntityTextUrl' | 'messageEntityMentionName' | 'messageEntitySpoiler'>;\r\n};\r\n\r\n// https://core.telegram.org/bots/api#html-style\r\nexport const markdownTags: {[type in MarkdownType]: MarkdownTag} = {\r\n  bold: {\r\n    match: '[style*=\"bold\"], [style*=\"font-weight: 700\"], [style*=\"font-weight: 600\"], [style*=\"font-weight:700\"], [style*=\"font-weight:600\"], b, strong',\r\n    entityName: 'messageEntityBold'\r\n  },\r\n  underline: {\r\n    match: '[style*=\"underline\"], u, ins',\r\n    entityName: 'messageEntityUnderline'\r\n  },\r\n  italic: {\r\n    match: '[style*=\"italic\"], i, em',\r\n    entityName: 'messageEntityItalic'\r\n  },\r\n  monospace: {\r\n    match: '[style*=\"monospace\"], [face*=\"monospace\"], pre',\r\n    entityName: 'messageEntityCode'\r\n  },\r\n  strikethrough: {\r\n    match: '[style*=\"line-through\"], strike, del, s',\r\n    entityName: 'messageEntityStrike'\r\n  },\r\n  link: {\r\n    match: 'A:not(.follow)',\r\n    entityName: 'messageEntityTextUrl'\r\n  },\r\n  mentionName: {\r\n    match: 'A.follow',\r\n    entityName: 'messageEntityMentionName'\r\n  },\r\n  spoiler: {\r\n    match: '[style*=\"spoiler\"]',\r\n    entityName: 'messageEntitySpoiler'\r\n  }\r\n};\r\n\r\nconst tabulationMatch = '[style*=\"table-cell\"], th, td';\r\n\r\n/* export function getDepth(child: Node, container?: Node) {\r\n  let depth = 0;\r\n\r\n  do {\r\n    if(child === container) {\r\n      return depth;\r\n    }\r\n\r\n    ++depth;\r\n  } while((child = child.parentNode) !== null);\r\n\r\n  return depth;\r\n} */\r\n\r\nconst BLOCK_TAG_NAMES = new Set([\r\n  'DIV',\r\n  'P',\r\n  'BR',\r\n  'LI',\r\n  'SECTION',\r\n  'H6',\r\n  'H5',\r\n  'H4',\r\n  'H3',\r\n  'H2',\r\n  'H1',\r\n  'TR'\r\n]);\r\n\r\nexport default function getRichElementValue(node: HTMLElement, lines: string[], line: string[], selNode?: Node, selOffset?: number, entities?: MessageEntity[], offset = {offset: 0}) {\r\n  if(node.nodeType === 3) { // TEXT\r\n    const nodeValue = node.nodeValue;\r\n\r\n    /* const tabulation = node.parentElement?.closest(tabulationMatch + ', [contenteditable]');\r\n    if(tabulation?.getAttribute('contenteditable') === null) {\r\n      nodeValue += ' ';\r\n      // line.push('\\t');\r\n      // ++offset.offset;\r\n    } */\r\n\r\n    if(selNode === node) {\r\n      line.push(nodeValue.substr(0, selOffset) + '\\x01' + nodeValue.substr(selOffset));\r\n    } else {\r\n      line.push(nodeValue);\r\n    }\r\n\r\n    if(entities && nodeValue.length) {\r\n      if(node.parentNode) {\r\n        const parentElement = node.parentElement;\r\n\r\n        // let closestTag: MarkdownTag, closestElementByTag: Element, closestDepth = Infinity;\r\n        for(const type in markdownTags) {\r\n          const tag = markdownTags[type as MarkdownType];\r\n          const closest = parentElement.closest(tag.match + ', [contenteditable]');\r\n          if(closest?.getAttribute('contenteditable') !== null) {\r\n            /* const depth = getDepth(closest, parentElement.closest('[contenteditable]'));\r\n            if(closestDepth > depth) {\r\n              closestDepth = depth;\r\n              closestTag = tag;\r\n              closestElementByTag = closest;\r\n            } */\r\n            continue;\r\n          }\r\n\r\n          if(tag.entityName === 'messageEntityTextUrl') {\r\n            entities.push({\r\n              _: tag.entityName,\r\n              url: (closest as HTMLAnchorElement).href,\r\n              offset: offset.offset,\r\n              length: nodeValue.length\r\n            });\r\n          } else if(tag.entityName === 'messageEntityMentionName') {\r\n            entities.push({\r\n              _: tag.entityName,\r\n              offset: offset.offset,\r\n              length: nodeValue.length,\r\n              user_id: (closest as HTMLElement).dataset.follow.toUserId()\r\n            });\r\n          } else {\r\n            entities.push({\r\n              _: tag.entityName,\r\n              offset: offset.offset,\r\n              length: nodeValue.length\r\n            });\r\n          }\r\n        }\r\n      }\r\n    }\r\n\r\n    offset.offset += nodeValue.length;\r\n    return;\r\n  }\r\n\r\n  if(node.nodeType !== 1) { // NON-ELEMENT\r\n    return;\r\n  }\r\n\r\n  const isSelected = selNode === node;\r\n  const isBlock = BLOCK_TAG_NAMES.has(node.tagName);\r\n  if(isBlock && line.length) {\r\n    lines.push(line.join(''));\r\n    line.splice(0, line.length);\r\n    ++offset.offset;\r\n  } else if(node instanceof HTMLImageElement) {\r\n    const alt = node.alt;\r\n    if(alt) {\r\n      line.push(alt);\r\n      offset.offset += alt.length;\r\n    }\r\n  }\r\n\r\n  if(isSelected && !selOffset) {\r\n    line.push('\\x01');\r\n  }\r\n\r\n  const isTableCell = node.matches(tabulationMatch);\r\n  const wasEntitiesLength = entities?.length;\r\n\r\n  let curChild = node.firstChild as HTMLElement;\r\n  while(curChild) {\r\n    getRichElementValue(curChild, lines, line, selNode, selOffset, entities, offset);\r\n    curChild = curChild.nextSibling as any;\r\n  }\r\n\r\n  if(isSelected && selOffset) {\r\n    line.push('\\x01');\r\n  }\r\n\r\n  if(isTableCell && node.nextSibling) {\r\n    line.push(' ');\r\n    ++offset.offset;\r\n\r\n    // * combine entities such as url after adding space\r\n    if(wasEntitiesLength !== undefined) {\r\n      for(let i = wasEntitiesLength, length = entities.length; i < length; ++i) {\r\n        ++entities[i].length;\r\n      }\r\n    }\r\n  }\r\n\r\n  const wasLength = line.length;\r\n  if(isBlock && wasLength) {\r\n    lines.push(line.join(''));\r\n    line.splice(0, wasLength);\r\n    ++offset.offset;\r\n  }\r\n\r\n  if(wasLength && node.tagName === 'P' && node.nextSibling) {\r\n    lines.push('');\r\n    ++offset.offset;\r\n  }\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n *\r\n * Originally from:\r\n * https://github.com/zhukov/webogram\r\n * Copyright (C) 2014 Igor Zhukov <igor.beatle@gmail.com>\r\n * https://github.com/zhukov/webogram/blob/master/LICENSE\r\n */\r\n\r\nimport {MOUNT_CLASS_TO} from '../../config/debug';\r\nimport {MessageEntity} from '../../layer';\r\nimport combineSameEntities from '../../lib/richTextProcessor/combineSameEntities';\r\nimport sortEntities from '../../lib/richTextProcessor/sortEntities';\r\nimport getRichElementValue from './getRichElementValue';\r\n\r\nexport default function getRichValue(field: HTMLElement, withEntities = true) {\r\n  const lines: string[] = [];\r\n  const line: string[] = [];\r\n\r\n  const entities: MessageEntity[] = withEntities ? [] : undefined;\r\n  getRichElementValue(field, lines, line, undefined, undefined, entities);\r\n  if(line.length) {\r\n    lines.push(line.join(''));\r\n  }\r\n\r\n  let value = lines.join('\\n');\r\n  value = value.replace(/\\u00A0/g, ' ');\r\n\r\n  if(entities?.length) {\r\n    // ! cannot do that here because have the same check before the sending in RichTextProcessor.parseMarkdown\r\n    /* const entity = entities[entities.length - 1];\r\n    const length = value.length;\r\n    const trimmedLength = value.trimRight().length;\r\n    if(length !== trimmedLength) {\r\n      entity.length -= length - trimmedLength;\r\n    } */\r\n\r\n    combineSameEntities(entities);\r\n    sortEntities(entities);\r\n  }\r\n\r\n  // console.log('getRichValue:', value, entities);\r\n\r\n  return {value, entities};\r\n}\r\n\r\nMOUNT_CLASS_TO.getRichValue = getRichValue;\r\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport getVisibleRect from './getVisibleRect';\n\nexport type ViewportSlicePart = {element: HTMLElement, rect: DOMRect, visibleRect: ReturnType<typeof getVisibleRect>}[];\n\nexport default function getViewportSlice({overflowElement, overflowRect, selector, extraSize, elements}: {\n  overflowElement: HTMLElement,\n  overflowRect?: DOMRectMinified,\n  extraSize?: number,\n  selector?: string,\n  elements?: HTMLElement[]\n}) {\n  // const perf = performance.now();\n  overflowRect ??= overflowElement.getBoundingClientRect();\n  elements ??= Array.from(overflowElement.querySelectorAll<HTMLElement>(selector));\n\n  if(extraSize) {\n    overflowRect = {\n      top: overflowRect.top - extraSize,\n      right: overflowRect.right + extraSize,\n      bottom: overflowRect.bottom + extraSize,\n      left: overflowRect.left - extraSize\n    };\n  }\n\n  const invisibleTop: ViewportSlicePart = [],\n    visible: typeof invisibleTop = [],\n    invisibleBottom: typeof invisibleTop = [];\n  let foundVisible = false;\n  for(const element of elements) {\n    const rect = element.getBoundingClientRect();\n    const visibleRect = getVisibleRect(element, overflowElement, false, rect, overflowRect);\n\n    const isVisible = !!visibleRect;\n    let array: typeof invisibleTop;\n    if(isVisible) {\n      foundVisible = true;\n      array = visible;\n    } else if(foundVisible) {\n      array = invisibleBottom;\n    } else {\n      array = invisibleTop;\n    }\n\n    array.push({\n      element,\n      rect,\n      visibleRect\n    });\n  }\n\n  // if(extraSize && visible.length) {\n  //   const maxTop = visible[0].rect.top;\n  //   const minTop = maxTop - extraSize;\n  //   const minBottom = visible[visible.length - 1].rect.bottom;\n  //   const maxBottom = minBottom + extraSize;\n\n  //   for(let length = invisibleTop.length, i = length - 1; i >= 0; --i) {\n  //     const element = invisibleTop[i];\n  //     if(element.rect.top >= minTop) {\n  //       invisibleTop.splice(i, 1);\n  //       visible.unshift(element);\n  //     }\n  //   }\n\n  //   for(let i = 0, length = invisibleBottom.length; i < length; ++i) {\n  //     const element = invisibleBottom[i];\n  //     if(element.rect.bottom <= maxBottom) {\n  //       invisibleBottom.splice(i--, 1);\n  //       --length;\n  //       visible.push(element);\n  //     }\n  //   }\n  // }\n\n  // console.log('getViewportSlice time:', performance.now() - perf);\n\n  return {invisibleTop, visible, invisibleBottom};\n}\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport windowSize from '../windowSize';\r\n\r\nexport default function getVisibleRect(\r\n  element: HTMLElement,\r\n  overflowElement: HTMLElement,\r\n  lookForSticky?: boolean,\r\n  rect: DOMRectMinified = element.getBoundingClientRect(),\r\n  overflowRect: DOMRectMinified = overflowElement.getBoundingClientRect()\r\n) {\r\n  let {top: overflowTop, right: overflowRight, bottom: overflowBottom, left: overflowLeft} = overflowRect;\r\n\r\n  // * respect sticky headers\r\n  if(lookForSticky) {\r\n    const sticky = overflowElement.querySelector('.sticky');\r\n    if(sticky) {\r\n      const stickyRect = sticky.getBoundingClientRect();\r\n      overflowTop = stickyRect.bottom;\r\n    }\r\n  }\r\n\r\n  if(rect.top >= overflowBottom ||\r\n    rect.bottom <= overflowTop ||\r\n    rect.right <= overflowLeft ||\r\n    rect.left >= overflowRight) {\r\n    return null;\r\n  }\r\n\r\n  const overflow = {\r\n    top: false,\r\n    right: false,\r\n    bottom: false,\r\n    left: false,\r\n    vertical: 0 as 0 | 1 | 2,\r\n    horizontal: 0 as 0 | 1 | 2\r\n  };\r\n\r\n  const windowWidth = windowSize.width;\r\n  const windowHeight = windowSize.height;\r\n\r\n  return {\r\n    rect: {\r\n      top: rect.top < overflowTop && overflowTop !== 0 ? (overflow.top = true, ++overflow.vertical, overflowTop) : rect.top,\r\n      right: rect.right > overflowRight && overflowRight !== windowWidth ? (overflow.right = true, ++overflow.horizontal, overflowRight) : rect.right,\r\n      bottom: rect.bottom > overflowBottom && overflowBottom !== windowHeight ? (overflow.bottom = true, ++overflow.vertical, overflowBottom) : rect.bottom,\r\n      left: rect.left < overflowLeft && overflowLeft !== 0 ? (overflow.left = true, ++overflow.horizontal, overflowLeft) : rect.left\r\n    },\r\n    overflow\r\n  };\r\n}\r\n\r\n(window as any).getVisibleRect = getVisibleRect;\r\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport SwipeHandler, {SwipeHandlerOptions} from '../../components/swipeHandler';\nimport cancelEvent from './cancelEvent';\nimport findUpClassName from './findUpClassName';\nimport isSwipingBackSafari from './isSwipingBackSafari';\n\nexport type SwipeHandlerHorizontalOptions = SwipeHandlerOptions & {\n  // xThreshold?: number\n};\n\nexport default function handleHorizontalSwipe(options: SwipeHandlerHorizontalOptions) {\n  let cancelY = false;\n  return new SwipeHandler({\n    ...options,\n    verifyTouchTarget: (e) => {\n      return !findUpClassName(e.target, 'progress-line') &&\n        !isSwipingBackSafari(e) &&\n        (options.verifyTouchTarget ? options.verifyTouchTarget(e) : true);\n    },\n    onSwipe: (xDiff, yDiff, e) => {\n      if(!cancelY && Math.abs(yDiff) > 20) {\n        return true;\n      }\n\n      if(Math.abs(xDiff) > Math.abs(yDiff)) {\n        cancelEvent(e);\n        cancelY = true;\n      } else if(!cancelY && Math.abs(yDiff) > Math.abs(xDiff)/*  || Math.abs(yDiff) > 20 */) {\n        return true;\n      }\n\n      /* if(!cancelY && options.xThreshold !== undefined && xDiff >= options.xThreshold) {\n        cancelY = true;\n      } */\n\n      return options.onSwipe(xDiff, yDiff, e);\n    },\n    onReset: () => {\n      cancelY = false;\n      options.onReset && options.onReset();\n    },\n    cancelEvent: false // cannot use cancelEvent on Safari iOS because scroll will be canceled too\n  });\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport {cancelContextMenuOpening} from './attachContextMenuListener';\nimport handleHorizontalSwipe, {SwipeHandlerHorizontalOptions} from './handleHorizontalSwipe';\n\nexport default function handleTabSwipe(options: SwipeHandlerHorizontalOptions) {\n  return handleHorizontalSwipe({\n    ...options,\n    onSwipe: (xDiff, yDiff, e) => {\n      if(Math.abs(xDiff) > 50) {\n        options.onSwipe(xDiff, yDiff, e);\n        cancelContextMenuOpening();\n\n        return true;\n      }\n    }\n  });\n}\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nexport default function htmlToDocumentFragment(html: string | DocumentFragment) {\r\n  if(html instanceof DocumentFragment) return html;\r\n  const template = document.createElement('template');\r\n  html = html.trim(); // Never return a text node of whitespace as the result\r\n  template.innerHTML = html;\r\n  return template.content;\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nexport default function htmlToSpan(html: string | DocumentFragment) {\r\n  const span = document.createElement('span');\r\n  if(typeof(html) === 'string') span.innerHTML = html;\r\n  else span.append(html);\r\n  return span;\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n *\r\n * Originally from:\r\n * https://github.com/zhukov/webogram\r\n * Copyright (C) 2014 Igor Zhukov <igor.beatle@gmail.com>\r\n * https://github.com/zhukov/webogram/blob/master/LICENSE\r\n */\r\n\r\n/* export function isInDOM(element: Element, parentNode?: HTMLElement): boolean {\r\n  if(!element) {\r\n    return false;\r\n  }\r\n\r\n  parentNode = parentNode || document.body;\r\n  if(element === parentNode) {\r\n    return true;\r\n  }\r\n  return isInDOM(element.parentNode as HTMLElement, parentNode);\r\n} */\r\nexport default function isInDOM(element: Element): boolean {\r\n  return element?.isConnected;\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport getRichValue from './getRichValue';\r\n\r\nexport default function isInputEmpty(element: HTMLElement) {\r\n  if(element.hasAttribute('contenteditable') || element.tagName !== 'INPUT') {\r\n    /* const value = element.innerText;\r\n\r\n    return !value.trim() && !serializeNodes(Array.from(element.childNodes)).trim(); */\r\n    return !getRichValue(element, false).value.trim();\r\n  } else {\r\n    return !(element as HTMLInputElement).value.trim();\r\n  }\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport rootScope from '../../lib/rootScope';\r\nimport {IS_MOBILE, IS_APPLE} from '../../environment/userAgent';\r\n\r\nexport default function isSendShortcutPressed(e: KeyboardEvent) {\r\n  if(e.key === 'Enter' && !IS_MOBILE && !e.isComposing) {\r\n    /* if(e.ctrlKey || e.metaKey) {\r\n      this.messageInput.innerHTML += '<br>';\r\n      placeCaretAtEnd(this.message)\r\n      return;\r\n    } */\r\n\r\n    if(rootScope.settings.sendShortcut === 'enter') {\r\n      if(e.shiftKey || e.ctrlKey || e.metaKey) {\r\n        return;\r\n      }\r\n\r\n      return true;\r\n    } else {\r\n      const secondaryKey = IS_APPLE ? e.metaKey : e.ctrlKey;\r\n      if(e.shiftKey || (IS_APPLE ? e.ctrlKey : e.metaKey)) {\r\n        return;\r\n      }\r\n\r\n      if(secondaryKey) {\r\n        return true;\r\n      }\r\n    }\r\n  }\r\n\r\n  return false;\r\n}\r\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport {IS_MOBILE_SAFARI} from '../../environment/userAgent';\n\nexport default function isSwipingBackSafari(e: TouchEvent | MouseEvent) {\n  return IS_MOBILE_SAFARI && e instanceof TouchEvent && e.touches[0].clientX < 30;\n}\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n *\r\n * Originally from:\r\n * https://github.com/zhukov/webogram\r\n * Copyright (C) 2014 Igor Zhukov <igor.beatle@gmail.com>\r\n * https://github.com/zhukov/webogram/blob/master/LICENSE\r\n */\r\n\r\nimport IS_TOUCH_SUPPORTED from '../../environment/touchSupport';\r\n\r\nexport default function placeCaretAtEnd(el: HTMLElement, ignoreTouchCheck = false) {\r\n  if(IS_TOUCH_SUPPORTED && (!ignoreTouchCheck || document.activeElement !== el)) {\r\n    return;\r\n  }\r\n\r\n  el.focus();\r\n  if(el instanceof HTMLInputElement) {\r\n    const length = el.value.length;\r\n    el.selectionStart = length;\r\n    el.selectionEnd = length;\r\n  } else if(typeof window.getSelection !== 'undefined' && typeof document.createRange !== 'undefined') {\r\n    var range = document.createRange();\r\n    range.selectNodeContents(el);\r\n    range.collapse(false);\r\n    var sel = window.getSelection();\r\n    sel.removeAllRanges();\r\n    sel.addRange(range);\r\n    // @ts-ignore\r\n  } else if(typeof document.body.createTextRange !== 'undefined') {\r\n    // @ts-ignore\r\n    var textRange = document.body.createTextRange();\r\n    textRange.moveToElementText(el);\r\n    textRange.collapse(false);\r\n    textRange.select();\r\n  }\r\n}\r\n\r\n(window as any).placeCaretAtEnd = placeCaretAtEnd;\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport whichChild from './whichChild';\r\n\r\nexport default function positionElementByIndex(element: HTMLElement, container: HTMLElement, pos: number, prevPos?: number) {\r\n  if(prevPos === undefined) {\r\n    prevPos = element.parentElement === container ? whichChild(element) : -1;\r\n  }\r\n\r\n  if(prevPos === pos) {\r\n    return false;\r\n  } else if(prevPos !== -1 && prevPos < pos) { // was higher\r\n    pos += 1;\r\n  }\r\n\r\n  if(!pos) {\r\n    container.prepend(element);\r\n  } else if(container.childElementCount > pos) {\r\n    container.insertBefore(element, container.children[pos]);\r\n  } else {\r\n    container.append(element);\r\n  }\r\n\r\n  return true;\r\n}\r\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport onMediaLoad from '../onMediaLoad';\n\n// import { getHeavyAnimationPromise } from \"../../hooks/useHeavyAnimationCheck\";\n\nexport const loadedURLs: {[url: string]: boolean} = {};\nconst set = (elem: HTMLElement | HTMLImageElement | SVGImageElement | HTMLVideoElement, url: string) => {\n  if(elem instanceof HTMLImageElement || elem instanceof HTMLVideoElement) elem.src = url;\n  else if(elem instanceof SVGImageElement) elem.setAttributeNS(null, 'href', url);\n  else elem.style.backgroundImage = 'url(' + url + ')';\n};\n\n//    ,      ,    blob',      'load'  .\nexport default function renderImageFromUrl(\n  elem: HTMLElement | HTMLImageElement | SVGImageElement | HTMLVideoElement,\n  url: string,\n  callback?: () => void,\n  useCache = true\n) {\n  if(!url) {\n    console.error('renderImageFromUrl: no url?', elem, url);\n    callback?.();\n    return;\n  }\n\n  const isVideo = elem instanceof HTMLVideoElement;\n  if(((loadedURLs[url]/*  && false */) && useCache) || isVideo) {\n    if(elem) {\n      set(elem, url);\n    }\n\n    if(callback) {\n      if(isVideo) {\n        onMediaLoad(elem).then(callback);\n      } else {\n        callback?.();\n      }\n      // callback && getHeavyAnimationPromise().then(() => callback());\n    }\n  } else {\n    const isImage = elem instanceof HTMLImageElement;\n    const loader = isImage ? elem as HTMLImageElement : new Image();\n    // const loader = new Image();\n    loader.src = url;\n    // let perf = performance.now();\n\n    const onLoad = () => {\n      if(!isImage && elem) {\n        set(elem, url);\n      }\n\n      loadedURLs[url] = true;\n      // console.log('onload:', url, performance.now() - perf);\n      // TODO:      ,       \n      // callback && getHeavyAnimationPromise().then(() => callback());\n      callback?.();\n\n      loader.removeEventListener('error', onError);\n    };\n\n    const onError = (err: ErrorEvent) => {\n      console.error('Render image from url failed:', err, url, loader);\n      loader.removeEventListener('load', onLoad);\n      callback?.();\n    };\n\n    loader.addEventListener('load', onLoad, {once: true});\n    loader.addEventListener('error', onError, {once: true});\n  }\n}\n\nexport function renderImageFromUrlPromise(elem: Parameters<typeof renderImageFromUrl>[0], url: string, useCache?: boolean) {\n  return new Promise<void>((resolve) => {\n    renderImageFromUrl(elem, url, resolve, useCache);\n  });\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport sequentialDom from '../sequentialDom';\nimport {renderImageFromUrlPromise} from './renderImageFromUrl';\n\nexport default function renderMediaWithFadeIn(\n  container: HTMLElement,\n  media: Parameters<typeof renderImageFromUrlPromise>[0],\n  url: string,\n  needFadeIn: boolean,\n  aspecter = container,\n  thumbImage?: HTMLElement\n) {\n  if(needFadeIn) {\n    media.classList.add('fade-in');\n  }\n\n  const promise = renderImageFromUrlPromise(media, url).then(() => {\n    return sequentialDom.mutateElement(container, () => {\n      aspecter.append(media);\n\n      if(needFadeIn) {\n        media.addEventListener('animationend', () => {\n          sequentialDom.mutate(() => {\n            media.classList.remove('fade-in');\n            thumbImage?.remove();\n          });\n        }, {once: true});\n      } else {\n        thumbImage?.remove();\n      }\n    });\n  });\n\n  // recordPromise(promise, 'renderImageWithFadeIn');\n\n  return promise;\n}\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nexport default function replaceContent(elem: HTMLElement, node: string | Node) {\r\n  if(typeof(node) === 'string') {\r\n    elem.innerHTML = node;\r\n    return;\r\n  }\r\n\r\n  // * children.length doesn't count text nodes\r\n  const firstChild = elem.firstChild;\r\n  if(firstChild) {\r\n    if(elem.lastChild === firstChild) {\r\n      firstChild.replaceWith(node);\r\n    } else {\r\n      elem.textContent = '';\r\n      elem.append(node);\r\n    }\r\n  } else {\r\n    elem.append(node);\r\n  }\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nexport default function setInnerHTML(elem: Element, html: string | DocumentFragment | Element) {\r\n  elem.setAttribute('dir', 'auto');\r\n  if(typeof(html) === 'string') {\r\n    if(!html) elem.textContent = '';\r\n    else elem.innerHTML = html;\r\n  } else {\r\n    elem.textContent = '';\r\n    elem.append(html);\r\n  }\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nexport default function toggleDisability(elements: HTMLElement[], disable: boolean): () => void {\r\n  if(disable) {\r\n    elements.forEach((el) => el.setAttribute('disabled', 'true'));\r\n  } else {\r\n    elements.forEach((el) => el.removeAttribute('disabled'));\r\n  }\r\n\r\n  return () => toggleDisability(elements, !disable);\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nexport default function whichChild(elem: Node) {\r\n  if(!elem.parentNode) {\r\n    return -1;\r\n  }\r\n\r\n  let i = 0;\r\n  // @ts-ignore\r\n  while((elem = elem.previousElementSibling) !== null) ++i;\r\n  return i;\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport {attachClickEvent} from './dom/clickEvent';\r\nimport findUpAsChild from './dom/findUpAsChild';\r\nimport EventListenerBase from './eventListenerBase';\r\nimport ListenerSetter from './listenerSetter';\r\nimport IS_TOUCH_SUPPORTED from '../environment/touchSupport';\r\nimport safeAssign from './object/safeAssign';\r\n\r\nconst KEEP_OPEN = false;\r\nconst TOGGLE_TIMEOUT = 200;\r\nconst ANIMATION_DURATION = 200;\r\n\r\nexport default class DropdownHover extends EventListenerBase<{\r\n  open: () => Promise<any> | void,\r\n  opened: () => any,\r\n  close: () => any,\r\n  closed: () => any\r\n}> {\r\n  protected element: HTMLElement;\r\n  protected displayTimeout: number;\r\n  protected forceClose = false;\r\n  protected inited = false;\r\n  protected ignoreMouseOut = false;\r\n\r\n  constructor(options: {\r\n    element: DropdownHover['element']\r\n  }) {\r\n    super(false);\r\n    safeAssign(this, options);\r\n  }\r\n\r\n  public attachButtonListener(button: HTMLElement, listenerSetter: ListenerSetter) {\r\n    let firstTime = true;\r\n    if(IS_TOUCH_SUPPORTED) {\r\n      attachClickEvent(button, () => {\r\n        if(firstTime) {\r\n          firstTime = false;\r\n          this.toggle(true);\r\n        } else {\r\n          this.toggle();\r\n        }\r\n      }, {listenerSetter});\r\n    } else {\r\n      listenerSetter.add(button)('mouseover', (e) => {\r\n        // console.log('onmouseover button');\r\n        if(firstTime) {\r\n          listenerSetter.add(button)('mouseout', (e) => {\r\n            clearTimeout(this.displayTimeout);\r\n            this.onMouseOut(e);\r\n          });\r\n          firstTime = false;\r\n        }\r\n\r\n        clearTimeout(this.displayTimeout);\r\n        this.displayTimeout = window.setTimeout(() => {\r\n          this.toggle(true);\r\n        }, TOGGLE_TIMEOUT);\r\n      });\r\n    }\r\n  }\r\n\r\n  protected onMouseOut = (e: MouseEvent) => {\r\n    if(KEEP_OPEN || !this.isActive()) return;\r\n    clearTimeout(this.displayTimeout);\r\n\r\n    if(this.ignoreMouseOut) {\r\n      return;\r\n    }\r\n\r\n    const toElement = (e as any).toElement as HTMLElement;\r\n    if(toElement && findUpAsChild(toElement, this.element)) {\r\n      return;\r\n    }\r\n\r\n    this.displayTimeout = window.setTimeout(() => {\r\n      this.toggle(false);\r\n    }, TOGGLE_TIMEOUT);\r\n  };\r\n\r\n  protected init() {\r\n    if(!IS_TOUCH_SUPPORTED) {\r\n      this.element.onmouseout = this.onMouseOut;\r\n      this.element.onmouseover = (e) => {\r\n        if(this.forceClose) {\r\n          return;\r\n        }\r\n\r\n        // console.log('onmouseover element');\r\n        clearTimeout(this.displayTimeout);\r\n      };\r\n    }\r\n  }\r\n\r\n  public toggle = async(enable?: boolean) => {\r\n    // if(!this.element) return;\r\n    const willBeActive = (!!this.element.style.display && enable === undefined) || enable;\r\n    if(this.init) {\r\n      if(willBeActive) {\r\n        this.init();\r\n        this.init = null;\r\n      } else {\r\n        return;\r\n      }\r\n    }\r\n\r\n    if(willBeActive === this.isActive()) {\r\n      return;\r\n    }\r\n\r\n    if((this.element.style.display && enable === undefined) || enable) {\r\n      const res = this.dispatchResultableEvent('open');\r\n      await Promise.all(res);\r\n\r\n      this.element.style.display = '';\r\n      void this.element.offsetLeft; // reflow\r\n      this.element.classList.add('active');\r\n\r\n      clearTimeout(this.displayTimeout);\r\n      this.displayTimeout = window.setTimeout(() => {\r\n        this.forceClose = false;\r\n        this.dispatchEvent('opened');\r\n      }, IS_TOUCH_SUPPORTED ? 0 : ANIMATION_DURATION);\r\n\r\n      // ! can't use together with resizeObserver\r\n      /* if(isTouchSupported) {\r\n        const height = this.element.scrollHeight + appImManager.chat.input.inputContainer.scrollHeight - 10;\r\n        console.log('[ESG]: toggle: enable height', height);\r\n        appImManager.chat.bubbles.scrollable.scrollTop += height;\r\n      } */\r\n\r\n      /* if(touchSupport) {\r\n        this.restoreScroll();\r\n      } */\r\n    } else {\r\n      this.dispatchEvent('close');\r\n\r\n      this.element.classList.remove('active');\r\n\r\n      clearTimeout(this.displayTimeout);\r\n      this.displayTimeout = window.setTimeout(() => {\r\n        this.element.style.display = 'none';\r\n        this.forceClose = false;\r\n        this.dispatchEvent('closed');\r\n      }, IS_TOUCH_SUPPORTED ? 0 : ANIMATION_DURATION);\r\n\r\n      /* if(isTouchSupported) {\r\n        const scrollHeight = this.container.scrollHeight;\r\n        if(scrollHeight) {\r\n          const height = this.container.scrollHeight + appImManager.chat.input.inputContainer.scrollHeight - 10;\r\n          appImManager.chat.bubbles.scrollable.scrollTop -= height;\r\n        }\r\n      } */\r\n\r\n      /* if(touchSupport) {\r\n        this.restoreScroll();\r\n      } */\r\n    }\r\n\r\n    // animationIntersector.checkAnimations(false, EMOTICONSSTICKERGROUP);\r\n  };\r\n\r\n  public isActive() {\r\n    return this.element.classList.contains('active');\r\n  }\r\n\r\n  public setIgnoreMouseOut(ignore: boolean) {\r\n    this.ignoreMouseOut = ignore;\r\n  }\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\n// * Jolly Cobra's fastSmoothScroll slightly patched\r\n\r\nimport {dispatchHeavyAnimationEvent} from '../hooks/useHeavyAnimationCheck';\r\nimport {fastRaf, fastRafPromise} from './schedulers';\r\nimport {animateSingle, cancelAnimationByKey} from './animation';\r\nimport rootScope from '../lib/rootScope';\r\nimport isInDOM from './dom/isInDOM';\r\n\r\nconst MIN_JS_DURATION = 250;\r\nconst MAX_JS_DURATION = 600;\r\nconst LONG_TRANSITION_MAX_DISTANCE = 1500;\r\nconst SHORT_TRANSITION_MAX_DISTANCE = 500;\r\n\r\nexport enum FocusDirection {\r\n  Up,\r\n  Down,\r\n  Static,\r\n};\r\n\r\nexport type ScrollGetNormalSizeCallback = (options: {rect: DOMRect}) => number;\r\nexport type ScrollStartCallbackDimensions = {\r\n  scrollSize: number,\r\n  scrollPosition: number,\r\n  distanceToEnd: number,\r\n  path: number,\r\n  duration: number,\r\n  containerRect: DOMRect,\r\n  elementRect: DOMRect,\r\n};\r\n\r\nexport type ScrollOptions = {\r\n  container: HTMLElement,\r\n  element: HTMLElement,\r\n  position: ScrollLogicalPosition,\r\n  margin?: number,\r\n  maxDistance?: number,\r\n  forceDirection?: FocusDirection,\r\n  forceDuration?: number,\r\n  axis?: 'x' | 'y',\r\n  getNormalSize?: ScrollGetNormalSizeCallback,\r\n  fallbackToElementStartWhenCentering?: HTMLElement,\r\n  startCallback?: (dimensions: ScrollStartCallbackDimensions) => void\r\n};\r\n\r\nexport default function fastSmoothScroll(options: ScrollOptions) {\r\n  if(options.margin === undefined) {\r\n    options.margin = 0;\r\n  }\r\n\r\n  if(options.maxDistance === undefined) {\r\n    options.maxDistance = LONG_TRANSITION_MAX_DISTANCE;\r\n  }\r\n\r\n  if(options.axis === undefined) {\r\n    options.axis = 'y';\r\n  }\r\n  // return;\r\n\r\n  if(!rootScope.settings.animationsEnabled) {\r\n    options.forceDirection = FocusDirection.Static;\r\n  }\r\n\r\n  if(options.forceDirection === FocusDirection.Static) {\r\n    options.forceDuration = 0;\r\n    return scrollWithJs(options);\r\n    /* return Promise.resolve();\r\n\r\n    element.scrollIntoView({ block: position });\r\n\r\n    cancelAnimationByKey(container);\r\n    return Promise.resolve(); */\r\n  }\r\n\r\n  const promise = fastRafPromise().then(() => scrollWithJs(options));\r\n\r\n  return options.axis === 'y' ? dispatchHeavyAnimationEvent(promise) : promise;\r\n}\r\n\r\nfunction scrollWithJs(options: ScrollOptions): Promise<void> {\r\n  const {element, container, getNormalSize, axis, margin, position, forceDirection, maxDistance, forceDuration} = options;\r\n  if(!isInDOM(element)) {\r\n    cancelAnimationByKey(container);\r\n    return Promise.resolve();\r\n  }\r\n\r\n  const rectStartKey = axis === 'y' ? 'top' : 'left';\r\n  const rectEndKey = axis === 'y' ? 'bottom' : 'right';\r\n  const sizeKey = axis === 'y' ? 'height' : 'width';\r\n  const scrollSizeKey = axis === 'y' ? 'scrollHeight' : 'scrollWidth';\r\n  const scrollPositionKey = axis === 'y' ? 'scrollTop' : 'scrollLeft';\r\n\r\n  // const { offsetTop: elementTop, offsetHeight: elementHeight } = element;\r\n  const elementRect = element.getBoundingClientRect();\r\n  const containerRect = container.getBoundingClientRect ? container.getBoundingClientRect() : document.body.getBoundingClientRect();\r\n\r\n  // const transformable = container.firstElementChild as HTMLElement;\r\n\r\n  const elementPosition = elementRect[rectStartKey] - containerRect[rectStartKey];\r\n  const elementSize = element[scrollSizeKey]; // margin is exclusive in DOMRect\r\n\r\n  const containerSize = getNormalSize ? getNormalSize({rect: containerRect}) : containerRect[sizeKey];\r\n\r\n  let scrollPosition = container[scrollPositionKey];\r\n  const scrollSize = container[scrollSizeKey];\r\n  /* const elementPosition = element.offsetTop;\r\n  const elementSize = element.offsetHeight;\r\n\r\n  const scrollPosition = container[scrollPositionKey];\r\n  const scrollSize = container[scrollSizeKey];\r\n  const containerSize = container.offsetHeight; */\r\n\r\n  let path!: number;\r\n\r\n  switch(position) {\r\n    case 'start':\r\n      path = elementPosition - margin;\r\n      break;\r\n    case 'end':\r\n      path = elementRect[rectEndKey] /* + (elementSize - elementRect[sizeKey]) */ - containerRect[rectEndKey] + margin;\r\n      break;\r\n    // 'nearest' is not supported yet\r\n    case 'nearest':\r\n    case 'center':\r\n      if(elementSize < containerSize) {\r\n        path = (elementPosition + elementSize / 2) - (containerSize / 2);\r\n      } else {\r\n        if(options.fallbackToElementStartWhenCentering && options.fallbackToElementStartWhenCentering !== element) {\r\n          options.element = options.fallbackToElementStartWhenCentering;\r\n          options.position = 'start';\r\n          return scrollWithJs(options);\r\n        }\r\n\r\n        path = elementPosition - margin;\r\n      }\r\n\r\n      break;\r\n  }\r\n  /* switch (position) {\r\n    case 'start':\r\n      path = (elementPosition - margin) - scrollPosition;\r\n      break;\r\n    case 'end':\r\n      path = (elementPosition + elementSize + margin) - (scrollPosition + containerSize);\r\n      break;\r\n    // 'nearest' is not supported yet\r\n    case 'nearest':\r\n    case 'center':\r\n      path = elementSize < containerSize\r\n        ? (elementPosition + elementSize / 2) - (scrollPosition + containerSize / 2)\r\n        : (elementPosition - margin) - scrollPosition;\r\n      break;\r\n  } */\r\n\r\n  if(Math.abs(path - (margin || 0)) < 1) {\r\n    cancelAnimationByKey(container);\r\n    return Promise.resolve();\r\n  }\r\n\r\n  if(axis === 'y') {\r\n    if(forceDirection === undefined) {\r\n      if(path > maxDistance) {\r\n        scrollPosition = container.scrollTop += path - maxDistance;\r\n        path = maxDistance;\r\n      } else if(path < -maxDistance) {\r\n        scrollPosition = container.scrollTop += path + maxDistance;\r\n        path = -maxDistance;\r\n      }\r\n    }/*  else if(forceDirection === FocusDirection.Up) { // * not tested yet\r\n      container.scrollTop = offsetTop + container.scrollTop + maxDistance;\r\n    } else if(forceDirection === FocusDirection.Down) { // * not tested yet\r\n      container.scrollTop = Math.max(0, offsetTop + container.scrollTop - maxDistance);\r\n    } */\r\n  }\r\n\r\n  // console.log('scrollWithJs: will scroll path:', path, element);\r\n\r\n  /* let existsTransform = 0;\r\n  const currentTransform = transformable.style.transform;\r\n  if(currentTransform) {\r\n    existsTransform = parseInt(currentTransform.match(/\\((.+?), (.+?), .+\\)/)[2]);\r\n    //path += existsTransform;\r\n  } */\r\n\r\n  if(path < 0) {\r\n    const remainingPath = -scrollPosition;\r\n    path = Math.max(path, remainingPath);\r\n  } else if(path > 0) {\r\n    const remainingPath = scrollSize - (scrollPosition + containerSize);\r\n    path = Math.min(path, remainingPath);\r\n  }\r\n\r\n  const target = container[scrollPositionKey] + path;\r\n  const absPath = Math.abs(path);\r\n  const duration = forceDuration ?? (\r\n    MIN_JS_DURATION + (absPath / LONG_TRANSITION_MAX_DISTANCE) * (MAX_JS_DURATION - MIN_JS_DURATION)\r\n  );\r\n  const startAt = Date.now();\r\n\r\n  /* transformable.classList.add('no-transition');\r\n\r\n  const tickTransform = () => {\r\n    const t = duration ? Math.min((Date.now() - startAt) / duration, 1) : 1;\r\n    const currentPath = path * transition(t);\r\n\r\n    transformable.style.transform = `translate3d(0, ${-currentPath}px, 0)`;\r\n    container.dataset.translate = '' + -currentPath;\r\n\r\n    const willContinue = t < 1;\r\n    if(!willContinue) {\r\n      fastRaf(() => {\r\n        delete container.dataset.transform;\r\n        container.dataset.transform = '';\r\n        transformable.style.transform = '';\r\n        void transformable.offsetLeft; // reflow\r\n        transformable.classList.remove('no-transition');\r\n        void transformable.offsetLeft; // reflow\r\n        container[scrollPositionKey] = Math.round(target);\r\n      });\r\n    }\r\n\r\n    return willContinue;\r\n  };\r\n\r\n  return animateSingle(tickTransform, container); */\r\n\r\n  /* return new Promise((resolve) => {\r\n    fastRaf(() => {\r\n      transformable.style.transform = '';\r\n      transformable.style.transition = '';\r\n\r\n      setTimeout(resolve, duration);\r\n    });\r\n  });\r\n\r\n  const transformableHeight = transformable.scrollHeight;\r\n  //transformable.style.minHeight = `${transformableHeight}px`;\r\n  */\r\n\r\n  const transition = absPath < SHORT_TRANSITION_MAX_DISTANCE ? shortTransition : longTransition;\r\n  const tick = () => {\r\n    const t = duration ? Math.min((Date.now() - startAt) / duration, 1) : 1;\r\n\r\n    const currentPath = path * (1 - transition(t));\r\n    container[scrollPositionKey] = Math.round(target - currentPath);\r\n\r\n    return t < 1;\r\n  };\r\n\r\n  if(!duration || !path) {\r\n    cancelAnimationByKey(container);\r\n    tick();\r\n    return Promise.resolve();\r\n  }\r\n\r\n  /* return new Promise((resolve) => {\r\n    setTimeout(resolve, duration);\r\n  }).then(() => {\r\n    transformable.classList.add('no-transition');\r\n    void transformable.offsetLeft; // reflow\r\n    transformable.style.transform = '';\r\n    transformable.style.transition = '';\r\n    void transformable.offsetLeft; // reflow\r\n    transformable.classList.remove('no-transition');\r\n    void transformable.offsetLeft; // reflow\r\n    fastRaf(() => {\r\n\r\n      container[scrollPositionKey] = Math.round(target);\r\n      //transformable.style.minHeight = ``;\r\n    });\r\n\r\n  }); */\r\n\r\n  if(options.startCallback) {\r\n    const distanceToEnd = scrollSize - Math.round(target + container[axis === 'y' ? 'offsetHeight' : 'offsetWidth']);\r\n    options.startCallback({\r\n      scrollSize,\r\n      scrollPosition,\r\n      distanceToEnd,\r\n      path,\r\n      duration,\r\n      containerRect,\r\n      elementRect\r\n    });\r\n  }\r\n\r\n  return animateSingle(tick, container);\r\n}\r\n\r\nfunction longTransition(t: number) {\r\n  return 1 - ((1 - t) ** 5);\r\n}\r\n\r\nfunction shortTransition(t: number) {\r\n  return 1 - ((1 - t) ** 3.5);\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport type {InputFileLocation, InputStickerSet, InputWebFileLocation} from '../layer';\r\nimport type {DownloadOptions} from '../lib/mtproto/apiFileManager';\r\n\r\nconst FILENAME_JOINER = '_';\r\n\r\nexport function getFileNameByLocation(location: InputFileLocation | InputWebFileLocation, options?: Partial<{\r\n  fileName: string,\r\n  downloadId: string\r\n}>) {\r\n  const fileName = '';// (options?.fileName || '').split('.');\r\n  const ext = fileName[fileName.length - 1] || '';\r\n\r\n  let str: string;\r\n  switch(location._) {\r\n    case 'inputPhotoFileLocation': {\r\n      str = ['photo', fileName[0], location.id, location.thumb_size].filter(Boolean).join(FILENAME_JOINER);\r\n      break;\r\n    }\r\n\r\n    case 'inputDocumentFileLocation': {\r\n      str = ['document', fileName[0], location.id, location.thumb_size].filter(Boolean).join(FILENAME_JOINER);\r\n      break;\r\n    }\r\n\r\n    case 'inputPeerPhotoFileLocation':\r\n      str = ['peerPhoto', location.photo_id, location.pFlags.big ? 'big' : 'small'].join(FILENAME_JOINER);\r\n      break;\r\n\r\n    case 'inputStickerSetThumb': {\r\n      const id = (location.stickerset as InputStickerSet.inputStickerSetID).id ||\r\n        (location.stickerset as InputStickerSet.inputStickerSetShortName).short_name ||\r\n        (location.stickerset as InputStickerSet.inputStickerSetDice).emoticon ||\r\n        location.stickerset._;\r\n      str = ['stickerSetThumb', id, location.thumb_version].join(FILENAME_JOINER);\r\n      break;\r\n    }\r\n\r\n    case 'inputFileLocation': {\r\n      str = location.volume_id + '_' + location.local_id;\r\n      break;\r\n    }\r\n\r\n    case 'inputWebFileLocation': {\r\n      str = ['webFile', location.url].join(FILENAME_JOINER);\r\n      break;\r\n    }\r\n\r\n    default: {\r\n      console.error('Unrecognized location:', location);\r\n      str = '';\r\n      break;\r\n    }\r\n  }\r\n\r\n  return str + (options?.downloadId ? '_download' : '') + (ext ? '.' + ext : ext);\r\n}\r\n\r\nexport type FileURLType = 'photo' | 'thumb' | 'document' | 'stream' | 'download';\r\nexport function getFileURL(type: FileURLType, options: DownloadOptions) {\r\n  // console.log('getFileURL', location);\r\n  // const perf = performance.now();\r\n  const encoded = encodeURIComponent(JSON.stringify(options));\r\n  // console.log('getFileURL encode:', performance.now() - perf, encoded);\r\n\r\n  return /* '/' +  */type + '/' + encoded;\r\n}\r\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport type {Message, MessageAction} from '../layer';\nimport type {MyMessage} from '../lib/appManagers/appMessagesManager';\nimport forEachReverse from './array/forEachReverse';\n\nexport default function filterChatPhotosMessages(value: {\n  count: number;\n  next_rate: number;\n  offset_id_offset: number;\n  history: MyMessage[];\n}) {\n  forEachReverse(value.history, (message, idx, arr) => {\n    if(!((message as Message.messageService).action as MessageAction.messageActionChatEditPhoto).photo) {\n      arr.splice(idx, 1);\n      if(value.count !== undefined) {\n        --value.count;\n      }\n    }\n  });\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport {i18n, LangPackKey} from '../lib/langPack';\n\nexport default function formatBytes(bytes: number, decimals: number | 'auto' = 'auto') {\n  if(bytes === 0) return i18n('FileSize.B', [0]);\n\n  const strictDecimals = decimals === 'auto';\n\n  const k = 1024;\n  const i = Math.floor(Math.log(bytes) / Math.log(k));\n  const _decimals = decimals === 'auto' ? Math.max(0, i - 1) : decimals;\n\n  const dm = Math.max(0, _decimals);\n  const sizes: LangPackKey[] = ['FileSize.B', 'FileSize.KB', 'FileSize.MB', 'FileSize.GB'];\n\n  const fixed = (bytes / Math.pow(k, i)).toFixed(dm);\n  return i18n(sizes[i], [strictDecimals ? fixed : parseFloat(fixed)]);\n}\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport I18n, {i18n, join, LangPackKey} from '../lib/langPack';\r\nimport formatDuration, {DurationType} from './formatDuration';\r\n\r\nconst CALL_DURATION_LANG_KEYS: {[type in DurationType]: LangPackKey} = {\r\n  s: 'Seconds',\r\n  m: 'Minutes',\r\n  h: 'Hours',\r\n  d: 'Days',\r\n  w: 'Weeks'\r\n};\r\nexport default function formatCallDuration(duration: number, plain?: boolean) {\r\n  const a = formatDuration(duration, 2);\r\n  if(plain) {\r\n    const strings = a.map((d) => I18n.format(CALL_DURATION_LANG_KEYS[d.type], true, [d.duration]));\r\n    return join(strings, false, plain);\r\n  }\r\n\r\n  const elements = a.map((d) => i18n(CALL_DURATION_LANG_KEYS[d.type], [d.duration]));\r\n\r\n  const fragment = document.createElement('span');\r\n  fragment.append(...join(elements, false));\r\n\r\n  return fragment;\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nexport type DurationType = 's' | 'm' | 'h' | 'd' | 'w';\r\nexport default function formatDuration(duration: number, showLast = 2) {\r\n  if(!duration) {\r\n    duration = 1;\r\n  }\r\n\r\n  const d: {duration: number, type: DurationType}[] = [];\r\n  const p = [\r\n    {m: 1, t: 's'},\r\n    {m: 60, t: 'm'},\r\n    {m: 60, t: 'h'},\r\n    {m: 24, t: 'd'},\r\n    {m: 7, t: 'w'}\r\n  ] as Array<{m?: number, t: DurationType}>\r\n  const s = 1;\r\n  let t = s;\r\n  p.forEach((o, idx) => {\r\n    t *= o.m;\r\n\r\n    if(duration < t) {\r\n      return;\r\n    }\r\n\r\n    const modulus = p[idx === (p.length - 1) ? idx : idx + 1].m;\r\n    d.push({\r\n      duration: (duration / t % modulus | 0),\r\n      type: o.t\r\n    });\r\n  });\r\n\r\n  const out = d.slice(-showLast).reverse();\r\n  for(let i = out.length - 1; i >= 0; --i) {\r\n    if(out[i].duration === 0) {\r\n      out.splice(i, 1);\r\n    }\r\n  }\r\n\r\n  return out;\r\n}\r\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport {HelpCountry, HelpCountryCode} from '../layer';\nimport I18n from '../lib/langPack';\n\nlet sortedCountries: HelpCountry[];\ntype PrefixCountry = {country: HelpCountry, code: HelpCountryCode};\nconst prefixes: Map<string, PrefixCountry> = new Map();\nlet maxPrefixLength = 0;\nconst setPrefix = (country: HelpCountry, code: HelpCountryCode, prefix: string = '') => {\n  prefix = code.country_code + prefix;\n  /* if(prefixes.has(prefix)) {\n    console.error('asdasdasd', prefixes.get(prefix), country, code);\n  } */\n  maxPrefixLength = Math.max(maxPrefixLength, prefix.length);\n  prefixes.set(prefix, {country, code});\n};\n\nexport function formatPhoneNumber(originalStr: string): {\n  formatted: string,\n  country: HelpCountry,\n  code: HelpCountryCode,\n  leftPattern: string\n} {\n  originalStr = originalStr || '';\n\n  if(!prefixes.size) {\n    I18n.countriesList.forEach((country) => {\n      country.country_codes.forEach((code) => {\n        if(code.prefixes) {\n          code.prefixes.forEach((prefix) => {\n            setPrefix(country, code, prefix);\n          });\n        } else {\n          setPrefix(country, code);\n        }\n      });\n    });\n  }\n\n  // return {formatted: originalStr, country: undefined as any, leftPattern: ''};\n  let str = originalStr.replace(/\\D/g, '');\n  const phoneCode = str.slice(0, maxPrefixLength);\n\n  // //console.log('str', str, phoneCode);\n  // if(!sortedCountries) {\n  //   sortedCountries = I18n.countriesList.slice().sort((a, b) => b.country_codes[0].country_code.length - a.country_codes[0].country_code.length);\n  // }\n\n  // let country = sortedCountries.find((c) => {\n  //   return c.country_codes.find((c) => phoneCode.indexOf(c.replace(/\\D/g, '')) === 0);\n  // });\n\n  let prefixCountry: PrefixCountry;\n  for(let i = phoneCode.length - 1; i >= 0; --i) { // lookup for country by prefix\n    prefixCountry = prefixes.get(phoneCode.slice(0, i + 1));\n    if(prefixCountry) {\n      break;\n    }\n  }\n\n  if(!prefixCountry) {\n    return {\n      formatted: str,\n      country: undefined,\n      code: undefined,\n      leftPattern: ''\n    };\n  }\n\n  // country = /* PhoneCodesMain[country.phoneCode] ||  */country;\n  const country = prefixCountry.country;\n\n  const patterns = prefixCountry.code.patterns || [];\n  const searchForPattern = str.slice(prefixCountry.code.country_code.length); // splice country code\n  let pattern = '', mostMatchedPatternMatches = 0, mostMatchedPattern = '';\n  for(let i = patterns.length - 1; i >= 0; --i) {\n    pattern = patterns[i];\n\n    const _pattern = pattern.replace(/ /g, '');\n    let patternMatches = 0;\n    for(let k = 0, length = Math.min(searchForPattern.length, _pattern.length); k < length; ++k) {\n      if(searchForPattern[k] === _pattern[k] || _pattern[k] === 'X') {\n        ++patternMatches;\n      } else {\n        patternMatches = 0;\n        break;\n      }\n    }\n\n    if(patternMatches > mostMatchedPatternMatches) {\n      mostMatchedPatternMatches = patternMatches;\n      mostMatchedPattern = pattern;\n    }\n  }\n\n  pattern = mostMatchedPattern || pattern;\n  pattern = pattern.replace(/\\d/g, 'X');\n\n  pattern = prefixCountry.code.country_code + ' ' + pattern;\n  // let pattern = country.pattern || country.phoneCode;\n  pattern.split('').forEach((symbol, idx) => {\n    if(symbol === ' ' && str[idx] !== ' ' && str.length > idx) {\n      str = str.slice(0, idx) + ' ' + str.slice(idx);\n    }\n  });\n\n  /* if(country.pattern) {\n    str = str.slice(0, country.pattern.length);\n  } */\n\n  let leftPattern = pattern && pattern.length > str.length ? pattern.slice(str.length) : '';\n  if(leftPattern) {\n    /* const length = str.length;\n    leftPattern = leftPattern.split('').map((_, idx) => (length + idx).toString().slice(-1)).join(''); */\n    leftPattern = leftPattern.replace(/X/g, '');\n    // leftPattern = leftPattern.replace(/X/g, '0');\n  }\n\n  return {formatted: str, country, code: prefixCountry.code, leftPattern};\n}\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\n// generate a path's arc data parameter\r\n\r\nimport {MOUNT_CLASS_TO} from '../config/debug';\r\n\r\n// http://www.w3.org/TR/SVG/paths.html#PathDataEllipticalArcCommands\r\nfunction arcParameter(rx: number, ry: number, xAxisRotation: number, largeArcFlag: number, sweepFlag: number, x: number, y: number) {\r\n  return [rx, ',', ry, ' ',\r\n    xAxisRotation, ' ',\r\n    largeArcFlag, ',',\r\n    sweepFlag, ' ',\r\n    x, ',', y].join('');\r\n}\r\n\r\nexport default function generatePathData(x: number, y: number, width: number, height: number, tl: number, tr: number, br: number, bl: number) {\r\n  const data: string[] = [];\r\n\r\n  // start point in top-middle of the rectangle\r\n  data.push('M' + (x + width / 2) + ',' + y);\r\n\r\n  // next we go to the right\r\n  data.push('H' + (x + width - tr));\r\n\r\n  if(tr > 0) {\r\n    // now we draw the arc in the top-right corner\r\n    data.push('A' + arcParameter(tr, tr, 0, 0, 1, (x + width), (y + tr)));\r\n  }\r\n\r\n  // next we go down\r\n  data.push('V' + (y + height - br));\r\n\r\n  if(br > 0) {\r\n    // now we draw the arc in the lower-right corner\r\n    data.push('A' + arcParameter(br, br, 0, 0, 1, (x + width - br), (y + height)));\r\n  }\r\n\r\n  // now we go to the left\r\n  data.push('H' + (x + bl));\r\n\r\n  if(bl > 0) {\r\n    // now we draw the arc in the lower-left corner\r\n    data.push('A' + arcParameter(bl, bl, 0, 0, 1, (x + 0), (y + height - bl)));\r\n  }\r\n\r\n  // next we go up\r\n  data.push('V' + (y + tl));\r\n\r\n  if(tl > 0) {\r\n    // now we draw the arc in the top-left corner\r\n    data.push('A' + arcParameter(tl, tl, 0, 0, 1, (x + tl), (y + 0)));\r\n  }\r\n\r\n  // and we close the path\r\n  data.push('Z');\r\n\r\n  return data.join(' ');\r\n}\r\n\r\nMOUNT_CLASS_TO.generatePathData = generatePathData;\r\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport {PhotoSize} from '../layer';\nimport {MyDocument} from '../lib/appManagers/appDocsManager';\nimport {MyPhoto} from '../lib/appManagers/appPhotosManager';\nimport {renderImageFromUrlPromise} from './dom/renderImageFromUrl';\nimport getPreviewURLFromThumb from './getPreviewURLFromThumb';\nimport blur from './blur';\n\nexport default function getImageFromStrippedThumb(photo: MyPhoto | MyDocument, thumb: PhotoSize.photoCachedSize | PhotoSize.photoStrippedSize, useBlur: boolean) {\n  const url = getPreviewURLFromThumb(photo, thumb, false);\n\n  let element: HTMLImageElement | HTMLCanvasElement, loadPromise: Promise<void>;\n  if(!useBlur) {\n    element = new Image();\n    loadPromise = renderImageFromUrlPromise(element, url);\n  } else {\n    const result = blur(url);\n    element = result.canvas;\n    loadPromise = result.promise;\n  }\n\n  element.classList.add('thumbnail');\n\n  return {image: element, loadPromise};\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport type {MyDocument} from '../lib/appManagers/appDocsManager';\nimport type {MyPhoto} from '../lib/appManagers/appPhotosManager';\nimport {PhotoSize} from '../layer';\n// import appDownloadManager from \"../lib/appManagers/appDownloadManager\";\nimport getPreviewURLFromBytes from './bytes/getPreviewURLFromBytes';\n\nexport default function getPreviewURLFromThumb(photo: MyPhoto | MyDocument, thumb: PhotoSize.photoCachedSize | PhotoSize.photoStrippedSize, isSticker = false) {\n  // const cacheContext = appDownloadManager.getCacheContext(photo, thumb.type);\n  // return cacheContext.url || (cacheContext.url = getPreviewURLFromBytes(thumb.bytes, isSticker));\n  return getPreviewURLFromBytes(thumb.bytes, isSticker);\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport type {MyDocument} from '../lib/appManagers/appDocsManager';\nimport type {MyPhoto} from '../lib/appManagers/appPhotosManager';\nimport {THUMB_TYPE_FULL} from '../lib/mtproto/mtproto_config';\nimport type {ThumbCache} from '../lib/storages/thumbs';\nimport getImageFromStrippedThumb from './getImageFromStrippedThumb';\n\nexport default function getStrippedThumbIfNeeded(photo: MyPhoto | MyDocument, cacheContext: ThumbCache, useBlur: boolean, ignoreCache = false) {\n  const isVideo = (['video', 'gif'] as MyDocument['type'][]).includes((photo as MyDocument).type);\n  if(!cacheContext.downloaded || isVideo || ignoreCache) {\n    if(\n      photo._ === 'document' &&\n      cacheContext.downloaded &&\n      !ignoreCache &&\n      (!isVideo || cacheContext.type !== THUMB_TYPE_FULL)\n    ) {\n      return null;\n    }\n\n    const sizes = (photo as MyPhoto).sizes || (photo as MyDocument).thumbs;\n    const thumb = sizes?.length ? sizes.find((size) => size._ === 'photoStrippedSize') : null;\n    if(thumb && ('bytes' in thumb)) {\n      return getImageFromStrippedThumb(photo, thumb as any, useBlur);\n    }\n  }\n\n  return null;\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport forEachReverse from './array/forEachReverse';\nimport safeAssign from './object/safeAssign';\n\nexport type ListLoaderOptions<T extends {}, P extends {}> = {\n  loadMore: ListLoader<T, P>['loadMore'],\n  loadCount?: ListLoader<T, P>['loadCount'],\n  loadWhenLeft?: ListLoader<T, P>['loadWhenLeft'],\n  processItem?: ListLoader<T, P>['processItem'],\n  onJump?: ListLoader<T, P>['onJump'],\n  onLoadedMore?: ListLoader<T, P>['onLoadedMore']\n};\n\nexport type ListLoaderResult<T extends {}> = {count: number, items: any[]};\nexport default class ListLoader<T extends {}, P extends {}> {\n  public current: T;\n  public previous: T[] = [];\n  public next: T[] = [];\n  public count: number;\n  public reverse = false; // reverse means next = higher msgid\n\n  protected loadMore: (anchor: T, older: boolean, loadCount: number) => Promise<ListLoaderResult<T>>;\n  protected processItem: (item: P) => T | Promise<T>;\n  protected loadCount = 50;\n  protected loadWhenLeft = 20;\n\n  public onJump: (item: T, older: boolean) => void;\n  public onLoadedMore: () => void;\n\n  protected loadedAllUp = false;\n  protected loadedAllDown = false;\n  protected loadPromiseUp: Promise<void>;\n  protected loadPromiseDown: Promise<void>;\n\n  constructor(options: ListLoaderOptions<T, P>) {\n    safeAssign(this, options);\n  }\n\n  public setTargets(previous: T[], next: T[], reverse: boolean) {\n    this.previous = previous;\n    this.next = next;\n    this.reverse = reverse;\n  }\n\n  public get index() {\n    return this.count !== undefined ? this.previous.length : -1;\n  }\n\n  /* public filter(callback: (item: T, idx: number, arr: T[]) => boolean) {\n    const filter = (item: T, idx: number, arr: T[]) => {\n      if(!callback(item, idx, arr)) {\n        arr.splice(idx, 1);\n      }\n    };\n\n    forEachReverse(this.previous, filter);\n    forEachReverse(this.next, filter);\n  } */\n\n  public reset(loadedAll = false) {\n    this.current = undefined;\n    this.previous = [];\n    this.next = [];\n    this.setLoaded(true, loadedAll);\n    this.setLoaded(false, loadedAll);\n  }\n\n  public go(length: number, dispatchJump = true) {\n    let items: T[], item: T;\n    if(length > 0) {\n      items = this.next.splice(0, length);\n      item = items.pop();\n      if(!item) {\n        return;\n      }\n\n      if(this.current !== undefined) items.unshift(this.current);\n      this.previous.push(...items);\n    } else {\n      items = this.previous.splice(Math.max(0, this.previous.length + length), -length);\n      item = items.shift();\n      if(!item) {\n        return;\n      }\n\n      if(this.current !== undefined) items.push(this.current);\n      this.next.unshift(...items);\n    }\n\n    if(this.next.length < this.loadWhenLeft) {\n      this.load(!this.reverse);\n    }\n\n    if(this.previous.length < this.loadWhenLeft) {\n      this.load(this.reverse);\n    }\n\n    this.current = item;\n    dispatchJump && this.onJump && this.onJump(item, length > 0);\n    return this.current;\n  }\n\n  protected unsetCurrent(toPrevious: boolean) {\n    if(toPrevious) this.previous.push(this.current);\n    else this.next.unshift(this.current);\n\n    this.current = undefined;\n  }\n\n  public goUnsafe(length: number, dispatchJump?: boolean) {\n    const leftLength = length > 0 ? Math.max(0, length - this.next.length) : Math.min(0, length + this.previous.length);\n    const item = this.go(length, leftLength ? false : dispatchJump);\n\n    /* if(length > 0 ? this.loadedAllUp : this.loadedAllDown) {\n      this.unsetCurrent(length > 0);\n    } */\n\n    return {\n      item: !leftLength ? item : undefined,\n      leftLength\n    };\n  }\n\n  protected setLoaded(down: boolean, value: boolean) {\n    const isChanged = (down ? this.loadedAllDown : this.loadedAllUp) !== value;\n    if(!isChanged) {\n      return false;\n    }\n\n    if(down) this.loadedAllDown = value;\n    else this.loadedAllUp = value;\n\n    if(!value) {\n      if(down) this.loadPromiseDown = null;\n      else this.loadPromiseUp = null;\n    }\n\n    return true;\n  }\n\n  //      reverse  loadMediaPromise\n  public load(older: boolean) {\n    if(older ? this.loadedAllDown : this.loadedAllUp) return Promise.resolve();\n\n    let promise = older ? this.loadPromiseDown : this.loadPromiseUp;\n    if(promise) return promise;\n\n    let anchor: T;\n    if(older) {\n      anchor = this.reverse ? this.previous[0] : this.next[this.next.length - 1];\n    } else {\n      anchor = this.reverse ? this.next[this.next.length - 1] : this.previous[0];\n    }\n\n    anchor ??= this.current;\n    promise = this.loadMore(anchor, older, this.loadCount).then(async(result) => {\n      if((older ? this.loadPromiseDown : this.loadPromiseUp) !== promise) {\n        return;\n      }\n\n      if(result.items.length < this.loadCount) {\n        this.setLoaded(older, true);\n      }\n\n      if(this.count === undefined) {\n        this.count = result.count || result.items.length;\n      }\n\n      const processedArr: (Promise<any> | any)[] = [];\n      const method = older ? result.items.forEach.bind(result.items) : forEachReverse.bind(null, result.items);\n      method((item: any) => {\n        const processed = this.processItem ? this.processItem(item) : item;\n\n        if(!processed) return;\n        processedArr.push(processed);\n      });\n\n      const results = await Promise.all(processedArr);\n      if(older) {\n        if(this.reverse) this.previous.unshift(...results);\n        else this.next.push(...results);\n      } else {\n        if(this.reverse) this.next.push(...results);\n        else this.previous.unshift(...results);\n      }\n\n      this.onLoadedMore && this.onLoadedMore();\n    }, () => {}).then(() => {\n      if(older) this.loadPromiseDown = null;\n      else this.loadPromiseUp = null;\n    });\n\n    if(older) this.loadPromiseDown = promise;\n    else this.loadPromiseUp = promise;\n\n    return promise;\n  }\n}\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport type EventListenerBase from './eventListenerBase';\r\n\r\nexport type Listener = {\r\n  element: ListenerElement,\r\n  event: ListenerEvent,\r\n  callback: ListenerCallback,\r\n  options?: ListenerOptions,\r\n\r\n  onceFired?: true, // will be set only when options.once is set\r\n  onceCallback?: () => void,\r\n};\r\n\r\nexport type ListenerElement = Window | Document | HTMLElement | Element | EventListenerBase<any>;\r\nexport type ListenerEvent = string;\r\nexport type ListenerCallback = Function;\r\nexport type ListenerOptions = AddEventListenerOptions;\r\n\r\n/* const originalAddEventListener = HTMLElement.prototype.addEventListener;\r\nHTMLElement.prototype.addEventListener = function(this, name: string, callback: EventListenerOrEventListenerObject, options: AddEventListenerOptions) {\r\n  console.log('nu zdarova', name);\r\n  originalAddEventListener.call(this, name, callback, options);\r\n\r\n  if(options?.ls) {\r\n    return options.ls.addFromElement(this, name, callback as any, options);\r\n  }\r\n}; */\r\n\r\nexport default class ListenerSetter {\r\n  private listeners: Set<Listener> = new Set();\r\n\r\n  public add<T extends ListenerElement>(element: T): T['addEventListener'] {\r\n    return ((event: string, callback: Function, options: ListenerOptions) => {\r\n      const listener: Listener = {element, event, callback, options};\r\n      this.addManual(listener);\r\n      return listener;\r\n    }) as any;\r\n  }\r\n\r\n  /* public addFromElement<T extends ListenerElement>(element: T, event: ListenerEvent, callback: ListenerCallback, options: ListenerOptions) {\r\n    const listener: Listener = {element, event, callback, options};\r\n    this.addManual(listener);\r\n    return listener;\r\n  } */\r\n\r\n  public addManual(listener: Listener) {\r\n    // @ts-ignore\r\n    listener.element.addEventListener(listener.event, listener.callback, listener.options);\r\n\r\n    if(listener.options?.once) { // remove listener when its called\r\n      listener.onceCallback = () => {\r\n        this.remove(listener);\r\n        listener.onceFired = true;\r\n      };\r\n\r\n      // @ts-ignore\r\n      listener.element.addEventListener(listener.event, listener.onceCallback, listener.options);\r\n    }\r\n\r\n    this.listeners.add(listener);\r\n  }\r\n\r\n  public remove(listener: Listener) {\r\n    if(!listener.onceFired) {\r\n      // @ts-ignore\r\n      listener.element.removeEventListener(listener.event, listener.callback, listener.options);\r\n\r\n      if(listener.onceCallback) {\r\n        // @ts-ignore\r\n        listener.element.removeEventListener(listener.event, listener.onceCallback, listener.options);\r\n      }\r\n    }\r\n\r\n    this.listeners.delete(listener);\r\n  }\r\n\r\n  public removeManual<T extends ListenerElement>(\r\n    element: T,\r\n    event: ListenerEvent,\r\n    callback: ListenerCallback,\r\n    options?: ListenerOptions\r\n  ) {\r\n    let listener: Listener;\r\n    for(const _listener of this.listeners) {\r\n      if(_listener.element === element &&\r\n        _listener.event === event &&\r\n        _listener.callback === callback &&\r\n        _listener.options === options) {\r\n        listener = _listener;\r\n        break;\r\n      }\r\n    }\r\n\r\n    if(listener) {\r\n      this.remove(listener);\r\n    }\r\n  }\r\n\r\n  public removeAll() {\r\n    this.listeners.forEach((listener) => {\r\n      this.remove(listener);\r\n    });\r\n  }\r\n}\r\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport calcImageInBox from './calcImageInBox';\n\nexport class MediaSize {\n  constructor(public width = 0, public height = width) {\n\n  }\n\n  public aspect(boxSize: MediaSize, fitted: boolean) {\n    return calcImageInBox(this.width, this.height, boxSize.width, boxSize.height, fitted);\n  }\n\n  public aspectFitted(boxSize: MediaSize) {\n    return this.aspect(boxSize, true);\n  }\n\n  public aspectCovered(boxSize: MediaSize) {\n    return this.aspect(boxSize, false);\n  }\n}\n\nexport function makeMediaSize(width?: number, height?: number): MediaSize {\n  return new MediaSize(width, height);\n}\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport {MOUNT_CLASS_TO} from '../config/debug';\r\nimport EventListenerBase from './eventListenerBase';\r\nimport {makeMediaSize, MediaSize} from './mediaSize';\r\n\r\ntype MediaTypeSizes = {\r\n  regular: MediaSize,\r\n  webpage: MediaSize,\r\n  album: MediaSize,\r\n  esgSticker: MediaSize,\r\n  animatedSticker: MediaSize,\r\n  staticSticker: MediaSize,\r\n  emojiSticker: MediaSize,\r\n  poll: MediaSize,\r\n  round: MediaSize,\r\n  documentName: MediaSize,\r\n  invoice: MediaSize,\r\n  customEmoji: MediaSize,\r\n  esgCustomEmoji: MediaSize\r\n};\r\n\r\nexport type MediaSizeType = keyof MediaTypeSizes;\r\n\r\nexport enum ScreenSize {\r\n  mobile,\r\n  medium,\r\n  large\r\n}\r\n\r\nconst MOBILE_SIZE = 600;\r\nconst MEDIUM_SIZE = 1275;\r\nconst LARGE_SIZE = 1680;\r\n\r\nclass MediaSizes extends EventListenerBase<{\r\n  changeScreen: (from: ScreenSize, to: ScreenSize) => void,\r\n  resize: () => void\r\n}> {\r\n  private screenSizes: {key: ScreenSize, value: number}[] = [\r\n    {key: ScreenSize.mobile, value: MOBILE_SIZE},\r\n    {key: ScreenSize.medium, value: MEDIUM_SIZE},\r\n    {key: ScreenSize.large, value: LARGE_SIZE}\r\n  ];\r\n\r\n  private sizes: {[k in 'desktop' | 'handhelds']: MediaTypeSizes} = {\r\n    handhelds: {\r\n      regular: makeMediaSize(270, 270),\r\n      webpage: makeMediaSize(270, 200),\r\n      album: makeMediaSize(270, 0),\r\n      esgSticker: makeMediaSize(68, 68),\r\n      animatedSticker: makeMediaSize(180, 180),\r\n      staticSticker: makeMediaSize(180, 180),\r\n      emojiSticker: makeMediaSize(112, 112),\r\n      poll: makeMediaSize(240, 0),\r\n      round: makeMediaSize(200, 200),\r\n      documentName: makeMediaSize(200, 0),\r\n      invoice: makeMediaSize(240, 240),\r\n      customEmoji: makeMediaSize(18, 18),\r\n      esgCustomEmoji: makeMediaSize(32, 32)\r\n    },\r\n    desktop: {\r\n      regular: makeMediaSize(420, 340),\r\n      webpage: makeMediaSize(420, 340),\r\n      album: makeMediaSize(420, 0),\r\n      esgSticker: makeMediaSize(80, 80),\r\n      animatedSticker: makeMediaSize(200, 200),\r\n      staticSticker: makeMediaSize(200, 200),\r\n      emojiSticker: makeMediaSize(112, 112),\r\n      poll: makeMediaSize(330, 0),\r\n      round: makeMediaSize(280, 280),\r\n      documentName: makeMediaSize(240, 0),\r\n      invoice: makeMediaSize(320, 260),\r\n      customEmoji: makeMediaSize(18, 18),\r\n      esgCustomEmoji: makeMediaSize(32, 32)\r\n    }\r\n  };\r\n\r\n  public isMobile = false;\r\n  public active: MediaTypeSizes;\r\n  public activeScreen: ScreenSize;\r\n  private rAF: number;\r\n\r\n  constructor() {\r\n    super();\r\n\r\n    window.addEventListener('resize', () => {\r\n      if(this.rAF) window.cancelAnimationFrame(this.rAF);\r\n      this.rAF = window.requestAnimationFrame(() => {\r\n        this.handleResize();\r\n        this.rAF = 0;\r\n      });\r\n    });\r\n    this.handleResize();\r\n  }\r\n\r\n  private handleResize = () => {\r\n    const innerWidth = window.innerWidth;\r\n    // this.isMobile = innerWidth <= 720;\r\n\r\n    let activeScreen = this.screenSizes[0].key;\r\n    for(let i = this.screenSizes.length - 1; i >= 0; --i) {\r\n      if(this.screenSizes[i].value < innerWidth) {\r\n        activeScreen = (this.screenSizes[i + 1] || this.screenSizes[i]).key;\r\n        break;\r\n      }\r\n    }\r\n\r\n    const wasScreen = this.activeScreen;\r\n    this.activeScreen = activeScreen;\r\n    this.isMobile = this.activeScreen === ScreenSize.mobile;\r\n    this.active = this.isMobile ? this.sizes.handhelds : this.sizes.desktop;\r\n\r\n    // console.time('esg');\r\n    // const computedStyle = window.getComputedStyle(document.documentElement);\r\n    // this.active.esgSticker.width = parseFloat(computedStyle.getPropertyValue('--esg-sticker-size'));\r\n    // console.timeEnd('esg');\r\n\r\n    if(wasScreen !== activeScreen) {\r\n      // console.log('changeScreen', this.activeScreen, activeScreen);\r\n\r\n      if(wasScreen !== undefined) {\r\n        this.dispatchEvent('changeScreen', wasScreen, activeScreen);\r\n      }\r\n    }\r\n\r\n    if(wasScreen !== undefined) {\r\n      this.dispatchEvent('resize');\r\n    }\r\n\r\n    /* if(this.isMobile) {\r\n      for(let i in this.active) {\r\n        // @ts-ignore\r\n        let size = this.active[i];\r\n        size.width = innerWidth\r\n      }\r\n    } */\r\n  };\r\n}\r\n\r\nconst mediaSizes = new MediaSizes();\r\nMOUNT_CLASS_TO.mediaSizes = mediaSizes;\r\nexport default mediaSizes;\r\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nexport default function middlewarePromise(middleware: () => boolean, throwWhat: any = '') {\n  return <T>(promise: T): T => {\n    if(!(promise instanceof Promise)) {\n      if(promise instanceof Error) {\n        throw promise;\n      } else {\n        return promise;\n      }\n    }\n\n    return (promise as any as Promise<any>).then((result) => {\n      if(!middleware()) {\n        throw throwWhat;\n      }\n\n      return result;\n    }) as any;\n  };\n}\n","export default function clamp(v: number, min: number, max: number): number {\n  return v < min ? min : ((v > max) ? max : v);\n}\n","export default function formatNumber(bytes: number, decimals = 2) {\n  if(bytes === 0) return '0';\n\n  const k = 1000;\n  const dm = decimals < 0 ? 0 : decimals;\n  const sizes = ['', 'K', 'M', 'B', 'T'];\n\n  const i = Math.floor(Math.log(bytes) / Math.log(k));\n\n  return parseFloat((bytes / Math.pow(k, i)).toFixed(dm)) + sizes[i];\n}\n","export default function numberThousandSplitter(x: number, joiner = ' ') {\n  const parts = x.toString().split('.');\n  parts[0] = parts[0].replace(/\\B(?=(\\d{3})+(?!\\d))/g, joiner);\n  return parts.join('.');\n}\n","import {IS_APPLE_MOBILE} from '../environment/userAgent';\n\nexport default function onMediaLoad(media: HTMLMediaElement, readyState = media.HAVE_METADATA, useCanplayOnIos?: boolean) {\n  return new Promise<void>((resolve) => {\n    if(media.readyState >= readyState) {\n      resolve();\n      return;\n    }\n\n    media.addEventListener(IS_APPLE_MOBILE && !useCanplayOnIos ? 'loadeddata' : 'canplay', () => resolve(), {once: true});\n  });\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport appNavigationController, {NavigationItem} from '../components/appNavigationController';\nimport IS_TOUCH_SUPPORTED from '../environment/touchSupport';\nimport {IS_MOBILE_SAFARI} from '../environment/userAgent';\nimport cancelEvent from './dom/cancelEvent';\nimport {CLICK_EVENT_NAME} from './dom/clickEvent';\nimport findUpAsChild from './dom/findUpAsChild';\nimport EventListenerBase from './eventListenerBase';\n\nexport default class OverlayClickHandler extends EventListenerBase<{\n  toggle: (open: boolean) => void\n}> {\n  protected element: HTMLElement;\n  protected overlay: HTMLElement;\n  protected listenerOptions: AddEventListenerOptions;\n\n  constructor(\n    protected navigationType: NavigationItem['type'],\n    protected withOverlay?: boolean\n  ) {\n    super(false);\n    this.listenerOptions = withOverlay ? {} : {capture: true};\n  }\n\n  protected onClick = (e: MouseEvent | TouchEvent) => {\n    if(this.element && findUpAsChild(e.target as HTMLElement, this.element)) {\n      return;\n    }\n\n    if(this.listenerOptions?.capture) {\n      cancelEvent(e);\n    }\n\n    this.close();\n  };\n\n  public close() {\n    if(this.element) {\n      this.overlay?.remove();\n      this.element = undefined;\n      this.dispatchEvent('toggle', false);\n    }\n\n    if(!IS_TOUCH_SUPPORTED) {\n      // window.removeEventListener('keydown', onKeyDown, {capture: true});\n      window.removeEventListener('contextmenu', this.onClick, this.listenerOptions);\n    }\n\n    document.removeEventListener(CLICK_EVENT_NAME, this.onClick, this.listenerOptions);\n\n    if(!IS_MOBILE_SAFARI) {\n      appNavigationController.removeByType(this.navigationType);\n    }\n  }\n\n  public open(element: HTMLElement) {\n    this.close();\n\n    if(!IS_MOBILE_SAFARI) {\n      appNavigationController.pushItem({\n        type: this.navigationType,\n        onPop: (canAnimate) => {\n          this.close();\n        }\n      });\n    }\n\n    this.element = element;\n\n    if(!this.overlay && this.withOverlay) {\n      this.overlay = document.createElement('div');\n      this.overlay.classList.add('btn-menu-overlay');\n\n      // ! because this event must be canceled, and can't cancel on menu click (below)\n      this.overlay.addEventListener(CLICK_EVENT_NAME, (e) => {\n        cancelEvent(e);\n        this.onClick(e);\n      });\n    }\n\n    this.overlay && this.element.parentElement.insertBefore(this.overlay, this.element);\n\n    // document.body.classList.add('disable-hover');\n\n    if(!IS_TOUCH_SUPPORTED) {\n      // window.addEventListener('keydown', onKeyDown, {capture: true});\n      window.addEventListener('contextmenu', this.onClick, {...this.listenerOptions, once: true});\n    }\n\n    /* // ! because this event must be canceled, and can't cancel on menu click (below)\n    overlay.addEventListener(CLICK_EVENT_NAME, (e) => {\n      cancelEvent(e);\n      onClick(e);\n    }); */\n\n    // ! safari iOS doesn't handle window click event on overlay, idk why\n    document.addEventListener(CLICK_EVENT_NAME, this.onClick, this.listenerOptions);\n\n    this.dispatchEvent('toggle', true);\n  }\n}\n","import Currencies from '../config/currencies';\n\n// https://stackoverflow.com/a/34141813\nfunction number_format(number: any, decimals: any, dec_point: any, thousands_sep: any): string {\n  // Strip all characters but numerical ones.\n  number = (number + '').replace(/[^0-9+\\-Ee.]/g, '');\n  var n = !isFinite(+number) ? 0 : +number,\n    prec = !isFinite(+decimals) ? 0 : Math.abs(decimals),\n    sep = (typeof thousands_sep === 'undefined') ? ',' : thousands_sep,\n    dec = (typeof dec_point === 'undefined') ? '.' : dec_point,\n    s: any = '',\n    toFixedFix = function(n: number, prec: number) {\n      var k = Math.pow(10, prec);\n      return '' + Math.round(n * k) / k;\n    };\n  // Fix for IE parseFloat(0.55).toFixed(0) = 0;\n  s = (prec ? toFixedFix(n, prec) : '' + Math.round(n)).split('.');\n  if(s[0].length > 3) {\n    s[0] = s[0].replace(/\\B(?=(?:\\d{3})+(?!\\d))/g, sep);\n  }\n  if((s[1] || '').length < prec) {\n    s[1] = s[1] || '';\n    s[1] += new Array(prec - s[1].length + 1).join('0');\n  }\n  return s.join(dec);\n}\n\nexport default function paymentsWrapCurrencyAmount(amount: number | string, currency: string, skipSymbol?: boolean) {\n  amount = +amount;\n\n  const isNegative = amount < 0;\n\n  const currencyData = Currencies[currency];\n  if(!currencyData) {\n    throw new Error('CURRENCY_WRAP_INVALID');\n  }\n\n  const amountExp = amount / Math.pow(10, currencyData.exp);\n\n  let decimals = currencyData.exp;\n  if(currency == 'IRR' && Math.floor(amountExp) == amountExp) {\n    decimals = 0; //      = 0     UI\n  }\n\n  let formatted = number_format(amountExp, decimals, currencyData.decimal_sep, currencyData.thousands_sep);\n  if(skipSymbol) {\n    return formatted;\n  }\n\n  let symbol = currencyData.symbol;\n  if(isNegative && !currencyData.space_between && currencyData.symbol_left) {\n    symbol = '-' + symbol;\n    formatted = formatted.replace('-', '');\n  }\n\n  let out: string;\n  const splitter = currencyData.space_between ? ' ' : '';\n  if(currencyData.symbol_left) {\n    out = symbol + splitter + formatted;\n  } else {\n    out = formatted + splitter + symbol;\n  }\n  return out;\n}\n\n(window as any).p = paymentsWrapCurrencyAmount;\n\n// function paymentsGetCurrencyExp($currency: string) {\n//   if($currency == 'CLF') {\n//     return 4;\n//   }\n//   if(['BHD','IQD','JOD','KWD','LYD','OMR','TND'].includes($currency)) {\n//     return 3;\n//   }\n//   if(['BIF','BYR','CLP','CVE','DJF','GNF','ISK','JPY','KMF','KRW','MGA', 'PYG','RWF','UGX','UYI','VND','VUV','XAF','XOF','XPF'].includes($currency)) {\n//     return 0;\n//   }\n//   if($currency == 'MRO') {\n//     return 1;\n//   }\n//   return 2;\n// }\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport mediaSizes from './mediaSizes';\n\nexport type MenuPositionPadding = {\n  top?: number,\n  right?: number,\n  bottom?: number,\n  left?: number\n};\n\nconst PADDING_TOP = 8;\nconst PADDING_BOTTOM = PADDING_TOP;\nconst PADDING_LEFT = 8;\nconst PADDING_RIGHT = PADDING_LEFT;\nexport default function positionMenu({pageX, pageY}: MouseEvent | Touch, elem: HTMLElement, side?: 'left' | 'right' | 'center', additionalPadding?: MenuPositionPadding) {\n  // let {clientX, clientY} = e;\n\n  // * side mean the OPEN side\n\n  const getScrollWidthFromElement = (Array.from(elem.children) as HTMLElement[]).find((element) => element.classList.contains('btn-menu-item') && !element.classList.contains('hide')) || elem;\n\n  const {scrollWidth: menuWidth} = getScrollWidthFromElement;\n  const {scrollHeight: menuHeight} = elem;\n  // let {innerWidth: windowWidth, innerHeight: windowHeight} = window;\n  const rect = document.body.getBoundingClientRect();\n  const windowWidth = rect.width;\n  const windowHeight = rect.height;\n\n  let paddingTop = PADDING_TOP, paddingRight = PADDING_RIGHT, paddingBottom = PADDING_BOTTOM, paddingLeft = PADDING_LEFT;\n  if(additionalPadding) {\n    if(additionalPadding.top) paddingTop += additionalPadding.top;\n    if(additionalPadding.right) paddingRight += additionalPadding.right;\n    if(additionalPadding.bottom) paddingBottom += additionalPadding.bottom;\n    if(additionalPadding.left) paddingLeft += additionalPadding.left;\n  }\n\n  side = mediaSizes.isMobile ? 'right' : 'left';\n  let verticalSide: 'top' /* | 'bottom' */ | 'center' = 'top';\n\n  const maxTop = windowHeight - menuHeight - paddingBottom;\n  const maxLeft = windowWidth - menuWidth - paddingRight;\n  const minTop = paddingTop;\n  const minLeft = paddingLeft;\n\n  const getSides = () => {\n    return {\n      x: {\n        left: pageX,\n        right: Math.min(maxLeft, pageX - menuWidth)\n      },\n      intermediateX: side === 'right' ? minLeft : maxLeft,\n      // intermediateX: clientX < windowWidth / 2 ? PADDING_LEFT : windowWidth - menuWidth - PADDING_LEFT,\n      y: {\n        top: pageY,\n        bottom: pageY - menuHeight\n      },\n      // intermediateY: verticalSide === 'top' ? paddingTop : windowHeight - menuHeight - paddingTop,\n      // intermediateY: pageY < (windowHeight / 2) ? paddingTop : windowHeight - menuHeight - paddingBottom,\n      intermediateY: maxTop\n    };\n  };\n\n  const sides = getSides();\n\n  const possibleSides = {\n    x: {\n      left: (sides.x.left + menuWidth + paddingRight) <= windowWidth,\n      right: sides.x.right >= paddingLeft\n    },\n    y: {\n      top: (sides.y.top + menuHeight + paddingBottom) <= windowHeight,\n      bottom: (sides.y.bottom - paddingBottom) >= paddingBottom\n    }\n  };\n\n  /* if(side === undefined) {\n    if((clientX + menuWidth + PADDING_LEFT) > windowWidth) {\n      side = 'right';\n    }\n  } */\n\n  {\n    /* const x = sides.x;\n\n    const s = Object.keys(x) as (keyof typeof possibleSides.x)[];\n    if(side) {\n      s.findAndSplice((s) => s === side);\n      s.unshift(side);\n    }\n\n    const possibleSide = s.find((s) => possibleSides.x[s]); */\n    // let left: number;\n    /* if(possibleSide) {\n      left = x[possibleSide];\n      side = possibleSide;\n    } else {\n      left = sides.intermediateX;\n      side = undefined;\n    } */\n    const left = possibleSides.x[side] ? sides.x[side] : (side = 'center', sides.intermediateX);\n\n    elem.style.left = left + 'px';\n  }\n\n  /* if((clientY + menuHeight + PADDING_TOP) > windowHeight) {\n    elem.style.top = clamp(clientY - menuHeight, PADDING_TOP, windowHeight - menuHeight - PADDING_TOP) + 'px';\n    // elem.style.top = (innerHeight - scrollHeight - PADDING_TOP) + 'px';\n    verticalSide = 'bottom';\n  } else {\n    elem.style.top = Math.max(PADDING_TOP, clientY) + 'px';\n    verticalSide = 'top';\n  } */\n\n  {\n    const top = possibleSides.y[verticalSide] ? sides.y[verticalSide] : (verticalSide = 'center', sides.intermediateY);\n\n    elem.style.top = top + 'px';\n  }\n\n  elem.className = elem.className.replace(/(top|center|bottom)-(left|center|right)/g, '');\n  elem.classList.add(\n    // (verticalSide === 'center' ? verticalSide : (verticalSide === 'bottom' ? 'top' : 'bottom')) +\n    (verticalSide === 'center' ? verticalSide : 'bottom') +\n    '-' +\n    (side === 'center' ? side : (side === 'left' ? 'right' : 'left')));\n\n  return {\n    width: menuWidth,\n    height: menuHeight\n  };\n}\n","import {RestrictionReason} from '../layer';\n\nconst platforms = new Set([\n  'all',\n  'web',\n  'webk'\n]);\n\nconst ignore = new Set();\n\nexport function getRestrictionReason(reasons: RestrictionReason[]) {\n  // return reasons[0];\n  return reasons.find((reason) => platforms.has(reason.platform) && !ignore.has(reason.reason));\n}\n\nexport function isRestricted(reasons: RestrictionReason[]) {\n  return !!getRestrictionReason(reasons);\n}\n\nexport function ignoreRestrictionReasons(reasons: string[]) {\n  ignore.clear();\n  reasons.forEach((reason) => {\n    ignore.add(reason);\n  });\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport type {MyDocument} from '../lib/appManagers/appDocsManager';\nimport rootScope from '../lib/rootScope';\n\nconst savingLottiePreview: {[docId: DocId]: {width: number, height: number}} = {};\n\nexport function isSavingLottiePreview(doc: MyDocument, toneIndex: number) {\n  const key = doc.id + '-' + toneIndex;\n  return !!savingLottiePreview[key];\n}\n\nexport async function saveLottiePreview(doc: MyDocument, canvas: HTMLCanvasElement, toneIndex: number) {\n  const key = doc.id + '-' + toneIndex;\n  const {width, height} = canvas;\n  let saving = savingLottiePreview[key];\n  if(saving && saving.width >= width && saving.height >= height) {\n    return;\n  }\n\n  saving = savingLottiePreview[key] = {\n    width,\n    height\n  };\n\n  const thumb = await rootScope.managers.appDocsManager.getLottieCachedThumb(doc.id, toneIndex);\n  if(savingLottiePreview[key] !== saving) {\n    return;\n  }\n\n  if(thumb && thumb.w >= width && thumb.h >= height) {\n    return;\n  }\n\n  const promise = new Promise<Blob>((resolve) => {\n    canvas.toBlob((blob) => resolve(blob));\n  });\n\n  const blob = await promise;\n  if(savingLottiePreview[key] !== saving) {\n    return;\n  }\n\n  // console.log('got lottie preview', doc, blob, URL.createObjectURL(blob));\n\n  rootScope.managers.appDocsManager.saveLottiePreview(doc.id, blob, width, height, toneIndex);\n\n  delete savingLottiePreview[key];\n\n  /* const reader = new FileReader();\n  reader.onloadend = (e) => {\n    const uint8 = new Uint8Array(e.target.result as ArrayBuffer);\n    const thumb: PhotoSize.photoStrippedSize = {\n      _: 'photoStrippedSize',\n      bytes: uint8,\n      type: 'i'\n    };\n\n    doc.stickerSavedThumbWidth = canvas.width;\n    doc.stickerSavedThumbHeight = canvas.width;\n\n    defineNotNumerableProperties(thumb, ['url']);\n    thumb.url = URL.createObjectURL(blob);\n    doc.thumbs.findAndSplice((t) => t._ === thumb._);\n    doc.thumbs.unshift(thumb);\n\n    if(!webpWorkerController.isWebpSupported()) {\n      doc.pFlags.stickerThumbConverted = true;\n    }\n\n    delete this.savingLottiePreview[doc.id];\n  };\n  reader.readAsArrayBuffer(blob); */\n}\n","// * Jolly Cobra's schedulers\n\nimport {AnyToVoidFunction} from '../../types';\nimport {fastRaf} from '../schedulers';\nimport throttleWith from './throttleWith';\n\nexport default function throttleWithRaf<F extends AnyToVoidFunction>(fn: F) {\n  return throttleWith(fastRaf, fn);\n}\n","// * Jolly Cobra's schedulers\n\nimport {AnyToVoidFunction} from '../../types';\n\nexport default function throttleWith<F extends AnyToVoidFunction>(schedulerFn: AnyToVoidFunction, fn: F) {\n  let waiting = false;\n  let args: Parameters<F>;\n\n  return (..._args: Parameters<F>) => {\n    args = _args;\n\n    if(!waiting) {\n      waiting = true;\n\n      schedulerFn(() => {\n        waiting = false;\n        // @ts-ignore\n        fn(...args);\n      });\n    }\n  };\n}\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport Scrollable from '../components/scrollable';\r\nimport safeAssign from './object/safeAssign';\r\n\r\nexport default class ScrollableLoader {\r\n  public loading = false;\r\n  private scrollable: Scrollable;\r\n  private getPromise: () => Promise<boolean>;\r\n  private promise: Promise<any>;\r\n  private loaded = false;\r\n\r\n  constructor(options: {\r\n    scrollable: ScrollableLoader['scrollable'],\r\n    getPromise: ScrollableLoader['getPromise']\r\n  }) {\r\n    safeAssign(this, options);\r\n\r\n    options.scrollable.onScrolledBottom = () => {\r\n      this.load();\r\n    };\r\n  }\r\n\r\n  public load() {\r\n    if(this.loaded) {\r\n      return Promise.resolve();\r\n    }\r\n\r\n    if(this.loading) {\r\n      return this.promise;\r\n    }\r\n\r\n    this.loading = true;\r\n    this.promise = this.getPromise().then((done) => {\r\n      this.loading = false;\r\n      this.promise = undefined;\r\n\r\n      if(done) {\r\n        this.loaded = true;\r\n        this.scrollable.onScrolledBottom = null;\r\n      } else {\r\n        this.scrollable.checkForTriggers();\r\n      }\r\n    }, () => {\r\n      this.promise = undefined;\r\n      this.loading = false;\r\n    });\r\n  }\r\n}\r\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport type {MediaSearchContext} from '../components/appMediaPlaybackController';\nimport type {SearchSuperContext} from '../components/appSearchSuper.';\nimport type {Message} from '../layer';\nimport type {MessagesStorageKey, MyMessage} from '../lib/appManagers/appMessagesManager';\nimport {AppManagers} from '../lib/appManagers/managers';\nimport incrementMessageId from '../lib/appManagers/utils/messageId/incrementMessageId';\nimport rootScope from '../lib/rootScope';\nimport forEachReverse from './array/forEachReverse';\nimport filterChatPhotosMessages from './filterChatPhotosMessages';\nimport ListLoader, {ListLoaderOptions} from './listLoader';\n\nexport default class SearchListLoader<Item extends {mid: number, peerId: PeerId}> extends ListLoader<Item, Message.message> {\n  public searchContext: MediaSearchContext;\n  public onEmptied: () => void;\n\n  private otherSideLoader: SearchListLoader<Item>;\n  private managers: AppManagers;\n\n  constructor(options: Omit<ListLoaderOptions<Item, Message.message>, 'loadMore'> & {\n    onEmptied?: () => void,\n    isInner?: boolean,\n    managers?: AppManagers\n  } = {}) {\n    super({\n      ...options,\n      loadMore: (anchor, older, loadCount) => {\n        const backLimit = older ? 0 : loadCount;\n        let maxId = anchor?.mid;\n\n        if(maxId === undefined) maxId = this.searchContext.maxId;\n        if(!older) maxId = incrementMessageId(maxId, 1);\n\n        return this.managers.appMessagesManager.getSearch({\n          ...this.searchContext,\n          peerId: this.searchContext.peerId || anchor?.peerId,\n          maxId,\n          limit: backLimit ? 0 : loadCount,\n          backLimit\n        }).then((value) => {\n          /* if(DEBUG) {\n            this.log('loaded more media by maxId:', maxId, value, older, this.reverse);\n          } */\n\n          if(this.searchContext.inputFilter._ === 'inputMessagesFilterChatPhotos') {\n            filterChatPhotosMessages(value);\n          }\n\n          if(value.next_rate) {\n            this.searchContext.nextRate = value.next_rate;\n          }\n\n          return {count: value.count, items: value.history};\n        });\n      },\n      processItem: async(message) => {\n        const filtered = await this.filterMids([message.mid]);\n        if(!filtered.length) {\n          return;\n        }\n\n        return options.processItem(message);\n      }\n    });\n\n    this.managers ??= rootScope.managers;\n    rootScope.addEventListener('history_delete', this.onHistoryDelete);\n    rootScope.addEventListener('history_multiappend', this.onHistoryMultiappend);\n    rootScope.addEventListener('message_sent', this.onMessageSent);\n\n    if(!options.isInner) {\n      this.otherSideLoader = new SearchListLoader({\n        ...options,\n        isInner: true\n      });\n\n      // this.otherSideLoader.onLoadedMore = () => {\n\n      // };\n    }\n  }\n\n  protected async filterMids(mids: number[]) {\n    const storageKey: MessagesStorageKey = `${this.searchContext.peerId}_${this.searchContext.isScheduled ? 'scheduled' : 'history'}`;\n    const filtered = (await this.managers.appMessagesManager.filterMessagesByInputFilterFromStorage(this.searchContext.inputFilter._, mids, storageKey, mids.length)) as Message.message[];\n    return filtered;\n  }\n\n  protected onHistoryDelete = ({peerId, msgs}: {peerId: PeerId, msgs: Set<number>}) => {\n    const shouldBeDeleted = (item: Item) => item.peerId === peerId && msgs.has(item.mid);\n    const filter = (item: Item, idx: number, arr: Item[]) => {\n      if(shouldBeDeleted(item)) {\n        arr.splice(idx, 1);\n      }\n    };\n\n    forEachReverse(this.previous, filter);\n    forEachReverse(this.next, filter);\n\n    if(this.current && shouldBeDeleted(this.current)) {\n      this.current = undefined;\n      /* if(this.go(1)) {\n        this.previous.splice(this.previous.length - 1, 1);\n      } else if(this.go(-1)) {\n        this.next.splice(0, 1);\n      } else  */if(this.onEmptied) {\n        this.onEmptied();\n      }\n    }\n  };\n\n  protected onHistoryMultiappend = async(message: Message.message | Message.messageService) => {\n    if(this.searchContext.folderId !== undefined) {\n      return;\n    }\n\n    // because it's reversed\n    if(!this.loadedAllUp || this.loadPromiseUp) {\n      return;\n    }\n\n    if(message.peerId !== this.searchContext.peerId) {\n      return;\n    }\n\n    const filtered = await this.filterMids([message.mid]);\n    const targets = (await Promise.all(filtered.map((message) => this.processItem(message)))).filter(Boolean);\n    if(targets.length) {\n      /* const {previous, current, next} = this;\n      const targets = previous.concat(current, next);\n      const currentIdx = targets.length;\n      const mid = targets[0].mid;\n      let i = 0, length = targets.length;\n      for(; i < length; ++i) {\n        const target = targets[i];\n        if(!target || mid < target.mid) {\n          break;\n        }\n      }\n\n      if(i < currentIdx) previous.push(...targets);\n      else next. */\n\n      if(!this.current) {\n        this.previous.push(...targets);\n      } else {\n        this.next.push(...targets);\n      }\n    }\n  };\n\n  protected onMessageSent = ({message}: {message: MyMessage}) => {\n    this.onHistoryMultiappend(message);\n  };\n\n  public setSearchContext(context: SearchSuperContext) {\n    this.searchContext = context;\n\n    if(this.searchContext.folderId !== undefined) {\n      this.loadedAllUp = true;\n\n      if(this.searchContext.nextRate === undefined) {\n        this.loadedAllDown = true;\n      }\n    }\n\n    if(this.searchContext.inputFilter._ === 'inputMessagesFilterChatPhotos') {\n      this.loadedAllUp = true;\n    }\n\n    if(this.searchContext.useSearch === false) {\n      this.loadedAllDown = this.loadedAllUp = true;\n    }\n\n    if(this.otherSideLoader) {\n      this.otherSideLoader.setSearchContext(context);\n    }\n  }\n\n  public reset() {\n    super.reset();\n    this.searchContext = undefined;\n\n    if(this.otherSideLoader) {\n      this.otherSideLoader.reset();\n    }\n  }\n\n  public getPrevious(withOtherSide?: boolean) {\n    let previous = this.previous;\n\n    if(this.otherSideLoader && withOtherSide) {\n      previous = previous.concat(this.otherSideLoader.previous);\n    }\n\n    return previous;\n  }\n\n  public getNext(withOtherSide?: boolean) {\n    let next = this.next;\n\n    if(this.otherSideLoader && withOtherSide) {\n      next = next.concat(this.otherSideLoader.next);\n    }\n\n    return next;\n  }\n\n  public getCurrent() {\n    return this.current || this.otherSideLoader?.current;\n  }\n\n  private goToOtherEnd(length: number) {\n    if(length > 0) return this.go(-this.previous.length);\n    else return this.go(this.next.length);\n  }\n\n  public goRound(length: number, dispatchJump?: boolean) {\n    let ret: ReturnType<SearchListLoader<Item>['goUnsafe']>;\n\n    if(this.otherSideLoader?.current) {\n      ret = this.otherSideLoader.goUnsafe(length, dispatchJump);\n      if(ret.item) {\n        return ret.item;\n      }\n\n      length = ret.leftLength;\n      if(!(length > 0 ? this.otherSideLoader.next : this.otherSideLoader.previous).length) {\n        const loaded = length > 0 ? this.otherSideLoader.loadedAllUp : this.otherSideLoader.loadedAllDown;\n        if(!loaded) { // do not reset anything until it's loaded\n          return;\n        }\n\n        // if other side is loaded too will start from its begin\n        if((length > 0 && (this.otherSideLoader.searchContext.maxId === 1 || this.otherSideLoader.loadedAllDown)) ||\n          (length < 0 && (this.otherSideLoader.searchContext.maxId === 0 || this.otherSideLoader.loadedAllUp))) {\n          return this.otherSideLoader.goToOtherEnd(length);\n        }\n\n        this.otherSideLoader.unsetCurrent(length > 0);\n      }\n    }\n\n    ret = this.goUnsafe(length, dispatchJump);\n    if(!ret.item) {\n      if(this.loadedAllUp && this.loadedAllDown) { // just use the same loader if the list is too short\n        return this.goToOtherEnd(length);\n      } else if(this.otherSideLoader) {\n        length = ret.leftLength;\n        ret = this.otherSideLoader.goUnsafe(length, dispatchJump);\n\n        if(ret.item) {\n          this.unsetCurrent(length > 0);\n        }\n      }\n    }\n\n    return ret?.item;\n  }\n\n  // public setTargets(previous: Item[], next: Item[], reverse: boolean) {\n  //   super.setTargets(previous, next, reverse);\n  // }\n\n  protected setLoaded(down: boolean, value: boolean) {\n    const changed = super.setLoaded(down, value);\n\n    if(changed &&\n      this.otherSideLoader &&\n      value &&\n      this.searchContext?.useSearch !== false/*  &&\n      (this.reverse ? this.loadedAllUp : this.loadedAllDown) */) {\n      const reverse = this.loadedAllUp;\n      this.otherSideLoader.setSearchContext({\n        ...this.searchContext,\n        maxId: reverse ? 1 : 0\n      });\n\n      // these 'reverse' are different, not a mistake here.\n      this.otherSideLoader.reverse = this.reverse;\n      this.otherSideLoader.setLoaded(reverse, true);\n      this.otherSideLoader.load(!reverse);\n    }\n\n    return changed;\n  }\n\n  public cleanup() {\n    this.reset();\n    rootScope.removeEventListener('history_delete', this.onHistoryDelete);\n    rootScope.removeEventListener('history_multiappend', this.onHistoryMultiappend);\n    rootScope.removeEventListener('message_sent', this.onMessageSent);\n    this.onEmptied = undefined;\n\n    if(this.otherSideLoader) {\n      this.otherSideLoader.cleanup();\n      this.otherSideLoader = undefined;\n    }\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport generateMessageId from './generateMessageId';\nimport getServerMessageId from './getServerMessageId';\n\nexport default function incrementMessageId(messageId: number, increment: number) {\n  return generateMessageId(getServerMessageId(messageId) + increment);\n}\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport {fastRaf} from './schedulers';\r\nimport deferredPromise, {CancellablePromise} from './cancellablePromise';\r\nimport {MOUNT_CLASS_TO} from '../config/debug';\r\nimport isInDOM from './dom/isInDOM';\r\n\r\nclass SequentialDom {\r\n  private promises: Partial<{\r\n    read: CancellablePromise<void>,\r\n    write: CancellablePromise<void>\r\n  }> = {};\r\n  private raf = fastRaf.bind(null);\r\n  private scheduled = false;\r\n\r\n  private do(kind: keyof SequentialDom['promises'], callback?: VoidFunction) {\r\n    let promise = this.promises[kind];\r\n    if(!promise) {\r\n      this.scheduleFlush();\r\n      promise = this.promises[kind] = deferredPromise<void>();\r\n    }\r\n\r\n    if(callback !== undefined) {\r\n      promise.then(() => callback());\r\n    }\r\n\r\n    return promise;\r\n  }\r\n\r\n  public measure(callback?: VoidFunction) {\r\n    return this.do('read', callback);\r\n  }\r\n\r\n  public mutate(callback?: VoidFunction) {\r\n    return this.do('write', callback);\r\n  }\r\n\r\n  /**\r\n   * Will fire instantly if element is not connected\r\n   * @param element\r\n   * @param callback\r\n   */\r\n  public mutateElement(element: HTMLElement, callback?: VoidFunction) {\r\n    const isConnected = isInDOM(element);\r\n    const promise = isConnected ? this.mutate() : Promise.resolve();\r\n\r\n    if(callback !== undefined) {\r\n      if(!isConnected) {\r\n        callback();\r\n      } else {\r\n        promise.then(() => callback());\r\n      }\r\n    }\r\n\r\n    return promise;\r\n  }\r\n\r\n  private scheduleFlush() {\r\n    if(!this.scheduled) {\r\n      this.scheduled = true;\r\n\r\n      this.raf(() => {\r\n        this.promises.read && this.promises.read.resolve();\r\n        this.promises.write && this.promises.write.resolve();\r\n\r\n        this.scheduled = false;\r\n        this.promises = {};\r\n      });\r\n    }\r\n  }\r\n}\r\n\r\nconst sequentialDom = new SequentialDom();\r\nMOUNT_CLASS_TO && (MOUNT_CLASS_TO.sequentialDom = sequentialDom);\r\nexport default sequentialDom;\r\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport {PhotoSize, WebDocument} from '../layer';\nimport {REPLIES_HIDDEN_CHANNEL_ID} from '../lib/mtproto/mtproto_config';\nimport {MyDocument} from '../lib/appManagers/appDocsManager';\nimport {MyPhoto} from '../lib/appManagers/appPhotosManager';\nimport choosePhotoSize from '../lib/appManagers/utils/photos/choosePhotoSize';\nimport {MediaSize, makeMediaSize} from './mediaSize';\nimport isWebDocument from '../lib/appManagers/utils/webDocs/isWebDocument';\n\nexport default function setAttachmentSize(\n  photo: MyPhoto | MyDocument | WebDocument,\n  element: HTMLElement | SVGForeignObjectElement,\n  boxWidth: number,\n  boxHeight: number,\n  noZoom = true,\n  message?: any,\n  pushDocumentSize?: boolean,\n  photoSize?: ReturnType<typeof choosePhotoSize>\n) {\n  const _isWebDocument = isWebDocument(photo);\n  // if(_isWebDocument && pushDocumentSize === undefined) {\n  //   pushDocumentSize = true;\n  // }\n\n  if(!photoSize) {\n    photoSize = choosePhotoSize(photo, boxWidth, boxHeight, undefined, pushDocumentSize);\n  }\n  // console.log('setAttachmentSize', photo, photo.sizes[0].bytes, div);\n\n  let size: MediaSize;\n  const isDocument = photo._ === 'document';\n  if(isDocument || _isWebDocument) {\n    size = makeMediaSize(photo.w || (photoSize as PhotoSize.photoSize).w || 512, photo.h || (photoSize as PhotoSize.photoSize).h || 512);\n  } else {\n    size = makeMediaSize((photoSize as PhotoSize.photoSize).w || 100, (photoSize as PhotoSize.photoSize).h || 100);\n  }\n\n  let boxSize = makeMediaSize(boxWidth, boxHeight);\n\n  boxSize = size = size.aspect(boxSize, noZoom);\n\n  let isFit = true;\n\n  if(!isDocument || ['video', 'gif'].includes(photo.type) || _isWebDocument) {\n    if(boxSize.width < 200 && boxSize.height < 200) { // make at least one side this big\n      boxSize = size = size.aspectCovered(makeMediaSize(200, 200));\n    }\n\n    if(message &&\n      (message.message ||\n        message.reply_to_mid ||\n        message.media.webpage ||\n        (message.replies && message.replies.pFlags.comments && message.replies.channel_id.toChatId() !== REPLIES_HIDDEN_CHANNEL_ID)\n      )\n    ) { // make sure that bubble block is human-readable\n      if(boxSize.width < 320) {\n        boxSize = makeMediaSize(320, boxSize.height);\n        isFit = false;\n      }\n    }\n\n    if(isFit && boxSize.width < 120 && message) { // if image is too narrow\n      boxSize = makeMediaSize(120, boxSize.height);\n      isFit = false;\n    }\n  }\n\n  // if(element instanceof SVGForeignObjectElement) {\n  //   element.setAttributeNS(null, 'width', '' + w);\n  //   element.setAttributeNS(null, 'height', '' + h);\n\n  //   //console.log('set dimensions to svg element:', element, w, h);\n  // } else {\n  element.style.width = boxSize.width + 'px';\n  element.style.height = boxSize.height + 'px';\n  // }\n\n  return {photoSize, size, isFit};\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport insertInDescendSortedArray from './array/insertInDescendSortedArray';\nimport {getMiddleware} from './middleware';\nimport safeAssign from './object/safeAssign';\n\nexport type SortedElementId = PeerId;\nexport type SortedElementBase = {\n  id: SortedElementId,\n  index: number\n};\n\nexport default class SortedList<SortedElement extends SortedElementBase> {\n  protected elements: Map<SortedElementId, SortedElement>;\n  protected sorted: Array<SortedElement>;\n\n  protected getIndex: (element: SortedElement) => PromiseLike<number> | number;\n  protected onDelete: (element: SortedElement) => void;\n  protected onUpdate: (element: SortedElement) => void;\n  protected onSort: (element: SortedElement, idx: number) => void;\n  protected onElementCreate: (base: SortedElementBase, batch: boolean) => SortedElement;\n\n  protected updateElementWith = (callback: () => void) => callback();\n  protected updateListWith = (callback: (canUpdate: boolean | undefined) => void) => callback(true);\n\n  protected middleware = getMiddleware();\n\n  constructor(options: {\n    getIndex: SortedList<SortedElement>['getIndex'],\n    onDelete?: SortedList<SortedElement>['onDelete'],\n    onUpdate?: SortedList<SortedElement>['onUpdate'],\n    onSort?: SortedList<SortedElement>['onSort'],\n    onElementCreate: SortedList<SortedElement>['onElementCreate'],\n\n    updateElementWith?: SortedList<SortedElement>['updateElementWith'],\n    updateListWith?: SortedList<SortedElement>['updateListWith']\n  }) {\n    safeAssign(this, options);\n\n    this.elements = new Map();\n    this.sorted = [];\n  }\n\n  public clear() {\n    this.middleware.clean();\n    this.elements.clear();\n    this.sorted.length = 0;\n  }\n\n  protected _updateList() {\n    this.elements.forEach((element) => {\n      this.update(element.id, true);\n    });\n\n    if(this.onSort) {\n      this.sorted.forEach((element, idx) => {\n        this.onSort(element, idx);\n      });\n    }\n  }\n\n  public updateList(callback: (updated: boolean) => void) {\n    const middleware = this.middleware.get();\n    this.updateListWith((canUpdate) => {\n      if(!middleware() || (canUpdate !== undefined && !canUpdate)) {\n        return callback(false);\n      }\n\n      this._updateList();\n\n      callback(true);\n    });\n  }\n\n  public has(id: SortedElementId) {\n    return this.elements.has(id);\n  }\n\n  public get(id: SortedElementId) {\n    return this.elements.get(id);\n  }\n\n  public getAll() {\n    return this.elements;\n  }\n\n  public add(\n    id: SortedElementId,\n    batch = false,\n    updateElementWith?: SortedList<SortedElement>['updateElementWith'],\n    updateBatch = batch\n  ) {\n    let element = this.get(id);\n    if(element) {\n      return element;\n    }\n\n    const base: SortedElementBase = {\n      id,\n      index: 0\n    };\n\n    element = this.onElementCreate(base, batch);\n    this.elements.set(id, element);\n    this.update(id, updateBatch, element, updateElementWith);\n\n    return element;\n  }\n\n  public delete(id: SortedElementId, noScheduler?: boolean) {\n    const element = this.elements.get(id);\n    if(!element) {\n      return false;\n    }\n\n    this.elements.delete(id);\n\n    const idx = this.sorted.indexOf(element);\n    if(idx !== -1) {\n      this.sorted.splice(idx, 1);\n    }\n\n    if(this.onDelete) {\n      if(noScheduler) {\n        this.onDelete(element);\n      } else {\n        const middleware = this.middleware.get();\n        this.updateElementWith(() => {\n          if(!middleware()) {\n            return;\n          }\n\n          this.onDelete(element);\n        });\n      }\n    }\n\n    return true;\n  }\n\n  public async update(\n    id: SortedElementId,\n    batch = false,\n    element = this.get(id),\n    updateElementWith?: SortedList<SortedElement>['updateElementWith']\n  ) {\n    if(!element) {\n      return;\n    }\n\n    element.index = await this.getIndex(element);\n    this.onUpdate && this.onUpdate(element);\n\n    const idx = insertInDescendSortedArray(this.sorted, element, 'index');\n    if(!batch && this.onSort) {\n      const middleware = this.middleware.get();\n      (updateElementWith || this.updateElementWith)(() => {\n        if(!middleware()) {\n          return;\n        }\n\n        // *             .    \n        this.onSort(element, idx);\n        /* if(this.get(id) === element) {\n          this.onSort(element, this.sorted.indexOf(element));\n        } */\n      });\n    }\n  }\n}\n","export default function encodeEntities(value: string) {\n  return value.replace(/&/g, '&amp;').replace(/[\\uD800-\\uDBFF][\\uDC00-\\uDFFF]/g, (value) => {\n    const hi = value.charCodeAt(0);\n    const low = value.charCodeAt(1);\n    return '&#' + (((hi - 0xD800) * 0x400) + (low - 0xDC00) + 0x10000) + ';';\n  }).replace(/([^\\#-~| |!])/g, (value) => { // non-alphanumeric\n    return '&#' + value.charCodeAt(0) + ';';\n  }).replace(/</g, '&lt;').replace(/>/g, '&gt;');\n}\n","// credits to https://github.com/sindresorhus/escape-string-regexp/blob/master/index.js\nexport default function escapeRegExp(str: string) {\n  return str\n  .replace(/[|\\\\{}()[\\]^$+*?.]/g, '\\\\$&')\n  .replace(/-/g, '\\\\x2d');\n}\n","export default function limitSymbols(str: string, length: number, limitFrom = length + 10) {\n  str = str.trim();\n  if(str.length > limitFrom) {\n    str = str.slice(0, length)/* .replace(/\\s*$/, '') */ + '...';\n  }\n\n  return str;\n}\n","export default function toHHMMSS(str: string | number, leadZero = false) {\n  const sec_num = parseInt(str + '', 10);\n  const hours = Math.floor(sec_num / 3600);\n  let minutes: any = Math.floor((sec_num - (hours * 3600)) / 60);\n  let seconds: any = sec_num - (hours * 3600) - (minutes * 60);\n\n  if(hours) leadZero = true;\n  if(minutes < 10) minutes = leadZero ? '0' + minutes : minutes;\n  if(seconds < 10) seconds = '0' + seconds;\n  return (hours ? /* ('0' + hours).slice(-2) */hours + ':' : '') + minutes + ':' + seconds;\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport {IS_WORKER} from './context';\n\nexport class WindowSize {\n  public width: number;\n  public height: number;\n\n  constructor() {\n    if(IS_WORKER) {\n      return;\n    }\n\n    // @ts-ignore\n    const w: any = 'visualViewport' in window ? window.visualViewport : window;\n    const set = () => {\n      this.width = w.width || w.innerWidth;\n      this.height = w.height || w.innerHeight;\n    };\n    w.addEventListener('resize', set);\n    set();\n  }\n}\n\nconst windowSize = new WindowSize();\nexport default windowSize;\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\n// * Jolly Cobra's useHeavyAnimationCheck.ts, patched\r\n\r\nimport {AnyToVoidFunction} from '../types';\r\nimport ListenerSetter from '../helpers/listenerSetter';\r\nimport deferredPromise, {CancellablePromise} from '../helpers/cancellablePromise';\r\nimport DEBUG from '../config/debug';\r\nimport pause from '../helpers/schedulers/pause';\r\nimport EventListenerBase from '../helpers/eventListenerBase';\r\n\r\nconst eventListener = new EventListenerBase<{\r\n  start: () => void,\r\n  end: () => void\r\n}>();\r\nconst ANIMATION_START_EVENT = 'start';\r\nconst ANIMATION_END_EVENT = 'end';\r\n\r\nlet isAnimating = false;\r\nlet heavyAnimationPromise: CancellablePromise<void> = deferredPromise<void>();\r\nlet promisesInQueue = 0;\r\n\r\nheavyAnimationPromise.resolve();\r\n\r\nconst log = console.log.bind(console.log, '[HEAVY-ANIMATION]:');\r\n\r\nexport function dispatchHeavyAnimationEvent(promise: Promise<any>, timeout?: number) {\r\n  if(!isAnimating) {\r\n    heavyAnimationPromise = deferredPromise<void>();\r\n    eventListener.dispatchEvent(ANIMATION_START_EVENT);\r\n    isAnimating = true;\r\n    DEBUG && log('start');\r\n  }\r\n\r\n  ++promisesInQueue;\r\n  DEBUG && log('attach promise, length:', promisesInQueue, timeout);\r\n\r\n  const promises = [\r\n    timeout !== undefined ? pause(timeout) : undefined,\r\n    promise.finally(() => {})\r\n  ].filter(Boolean);\r\n\r\n  const perf = performance.now();\r\n  const _heavyAnimationPromise = heavyAnimationPromise;\r\n  Promise.race(promises).then(() => {\r\n    if(heavyAnimationPromise !== _heavyAnimationPromise || heavyAnimationPromise.isFulfilled) { // interrupted\r\n      return;\r\n    }\r\n\r\n    --promisesInQueue;\r\n    DEBUG && log('promise end, length:', promisesInQueue, performance.now() - perf);\r\n    if(promisesInQueue <= 0) {\r\n      onHeavyAnimationEnd();\r\n    }\r\n  });\r\n\r\n  return heavyAnimationPromise;\r\n}\r\n\r\nfunction onHeavyAnimationEnd() {\r\n  if(heavyAnimationPromise.isFulfilled) {\r\n    return;\r\n  }\r\n\r\n  isAnimating = false;\r\n  promisesInQueue = 0;\r\n  eventListener.dispatchEvent(ANIMATION_END_EVENT);\r\n  heavyAnimationPromise.resolve();\r\n\r\n  DEBUG && log('end');\r\n}\r\n\r\nexport function interruptHeavyAnimation() {\r\n  onHeavyAnimationEnd();\r\n}\r\n\r\nexport function getHeavyAnimationPromise() {\r\n  return heavyAnimationPromise;\r\n}\r\n\r\nexport default function(\r\n  handleAnimationStart: AnyToVoidFunction,\r\n  handleAnimationEnd: AnyToVoidFunction,\r\n  listenerSetter?: ListenerSetter\r\n) {\r\n  // useEffect(() => {\r\n  if(isAnimating) {\r\n    handleAnimationStart();\r\n  }\r\n\r\n  const add = listenerSetter ? listenerSetter.add(eventListener) : eventListener.addEventListener.bind(eventListener);\r\n  const remove = listenerSetter ? listenerSetter.removeManual.bind(listenerSetter, eventListener) : eventListener.removeEventListener.bind(eventListener);\r\n  add(ANIMATION_START_EVENT, handleAnimationStart);\r\n  add(ANIMATION_END_EVENT, handleAnimationEnd);\r\n\r\n  return () => {\r\n    remove(ANIMATION_END_EVENT, handleAnimationEnd);\r\n    remove(ANIMATION_START_EVENT, handleAnimationStart);\r\n  };\r\n  // }, [handleAnimationEnd, handleAnimationStart]);\r\n}\r\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport appDialogsManager, {DIALOG_LIST_ELEMENT_TAG} from '../lib/appManagers/appDialogsManager';\nimport type {Dialog} from '../lib/appManagers/appMessagesManager';\nimport rootScope from '../lib/rootScope';\nimport ButtonMenu, {ButtonMenuItemOptions} from './buttonMenu';\nimport PopupDeleteDialog from './popups/deleteDialog';\nimport {i18n} from '../lib/langPack';\nimport findUpTag from '../helpers/dom/findUpTag';\nimport PopupPeer from './popups/peer';\nimport AppChatFoldersTab from './sidebarLeft/tabs/chatFolders';\nimport appSidebarLeft from './sidebarLeft';\nimport {toastNew} from './toast';\nimport PopupMute from './popups/mute';\nimport {AppManagers} from '../lib/appManagers/managers';\nimport positionMenu from '../helpers/positionMenu';\nimport contextMenuController from '../helpers/contextMenuController';\n\nexport default class DialogsContextMenu {\n  private element: HTMLElement;\n  private buttons: (ButtonMenuItemOptions & {verify: () => boolean | Promise<boolean>})[];\n\n  private selectedId: PeerId;\n  private filterId: number;\n  private dialog: Dialog;\n\n  constructor(private managers: AppManagers) {\n\n  }\n\n  private init() {\n    this.buttons = [{\n      icon: 'unread',\n      text: 'MarkAsUnread',\n      onClick: this.onUnreadClick,\n      verify: async() => !(await this.managers.appMessagesManager.isDialogUnread(this.dialog))\n    }, {\n      icon: 'readchats',\n      text: 'MarkAsRead',\n      onClick: this.onUnreadClick,\n      verify: () => this.managers.appMessagesManager.isDialogUnread(this.dialog)\n    }, {\n      icon: 'pin',\n      text: 'ChatList.Context.Pin',\n      onClick: this.onPinClick,\n      verify: async() => {\n        const isPinned = this.filterId > 1 ?\n          (await this.managers.appMessagesManager.getFilter(this.filterId)).pinnedPeerIds.includes(this.dialog.peerId) :\n          !!this.dialog.pFlags?.pinned;\n        return !isPinned;\n      }\n    }, {\n      icon: 'unpin',\n      text: 'ChatList.Context.Unpin',\n      onClick: this.onPinClick,\n      verify: async() => {\n        const isPinned = this.filterId > 1 ?\n          (await this.managers.appMessagesManager.getFilter(this.filterId)).pinnedPeerIds.includes(this.dialog.peerId) :\n          !!this.dialog.pFlags?.pinned;\n        return isPinned;\n      }\n    }, {\n      icon: 'mute',\n      text: 'ChatList.Context.Mute',\n      onClick: this.onMuteClick,\n      verify: async() => {\n        return this.selectedId !== rootScope.myId && !(await this.managers.appNotificationsManager.isPeerLocalMuted(this.dialog.peerId));\n      }\n    }, {\n      icon: 'unmute',\n      text: 'ChatList.Context.Unmute',\n      onClick: this.onUnmuteClick,\n      verify: async() => {\n        return this.selectedId !== rootScope.myId && (await this.managers.appNotificationsManager.isPeerLocalMuted(this.dialog.peerId));\n      }\n    }, {\n      icon: 'archive',\n      text: 'Archive',\n      onClick: this.onArchiveClick,\n      verify: () => this.filterId === 0 && this.selectedId !== rootScope.myId\n    }, {\n      icon: 'unarchive',\n      text: 'Unarchive',\n      onClick: this.onArchiveClick,\n      verify: () => this.filterId === 1 && this.selectedId !== rootScope.myId\n    }, {\n      icon: 'delete danger',\n      text: 'Delete',\n      onClick: this.onDeleteClick,\n      verify: () => true\n    }];\n\n    this.element = ButtonMenu(this.buttons);\n    this.element.id = 'dialogs-contextmenu';\n    this.element.classList.add('contextmenu');\n    document.getElementById('page-chats').append(this.element);\n  }\n\n  private onArchiveClick = async() => {\n    const dialog = await this.managers.appMessagesManager.getDialogOnly(this.selectedId);\n    if(dialog) {\n      this.managers.appMessagesManager.editPeerFolders([dialog.peerId], +!dialog.folder_id);\n    }\n  };\n\n  private onPinClick = () => {\n    this.managers.appMessagesManager.toggleDialogPin(this.selectedId, this.filterId).catch(async(err: ApiError) => {\n      if(err.type === 'PINNED_DIALOGS_TOO_MUCH') {\n        if(this.filterId >= 1) {\n          toastNew({langPackKey: 'PinFolderLimitReached'});\n        } else {\n          const config = await this.managers.apiManager.getConfig();\n          new PopupPeer('pinned-dialogs-too-much', {\n            buttons: [{\n              langKey: 'OK',\n              isCancel: true\n            }, {\n              langKey: 'FiltersSetupPinAlert',\n              callback: () => {\n                appSidebarLeft.createTab(AppChatFoldersTab).open();\n              }\n            }],\n            descriptionLangKey: 'PinToTopLimitReached2',\n            descriptionLangArgs: [i18n('Chats', [config.pinned_dialogs_count_max])]\n          }).show();\n        }\n      }\n    });\n  };\n\n  private onUnmuteClick = () => {\n    this.managers.appMessagesManager.togglePeerMute(this.selectedId, false);\n  };\n\n  private onMuteClick = () => {\n    new PopupMute(this.selectedId);\n  };\n\n  private onUnreadClick = async() => {\n    const selectedId = this.selectedId;\n    const dialog = await this.managers.appMessagesManager.getDialogOnly(selectedId);\n    if(!dialog) return;\n\n    if(dialog.unread_count) {\n      this.managers.appMessagesManager.readHistory(selectedId, dialog.top_message);\n      this.managers.appMessagesManager.markDialogUnread(selectedId, true);\n    } else {\n      this.managers.appMessagesManager.markDialogUnread(selectedId);\n    }\n  };\n\n  private onDeleteClick = () => {\n    new PopupDeleteDialog(this.selectedId/* , 'delete' */);\n  };\n\n  onContextMenu = (e: MouseEvent | Touch) => {\n    if(this.init) {\n      this.init();\n      this.init = null;\n    }\n\n    let li: HTMLElement = null;\n\n    try {\n      li = findUpTag(e.target, DIALOG_LIST_ELEMENT_TAG);\n    } catch(e) {}\n\n    if(!li) return;\n\n    if(e instanceof MouseEvent) e.preventDefault();\n    if(this.element.classList.contains('active')) {\n      return false;\n    }\n    if(e instanceof MouseEvent) e.cancelBubble = true;\n\n    const r = async() => {\n      this.filterId = appDialogsManager.filterId;\n      this.selectedId = li.dataset.peerId.toPeerId();\n      this.dialog = await this.managers.appMessagesManager.getDialogOnly(this.selectedId);\n\n      await Promise.all(this.buttons.map(async(button) => {\n        const good = await button.verify();\n\n        button.element.classList.toggle('hide', !good);\n      }));\n\n      // delete button\n      this.buttons[this.buttons.length - 1].element.lastChild.replaceWith(i18n(await this.managers.appPeersManager.getDeleteButtonText(this.selectedId)));\n\n      li.classList.add('menu-open');\n      positionMenu(e, this.element);\n      contextMenuController.openBtnMenu(this.element, () => {\n        li.classList.remove('menu-open');\n        this.selectedId = this.dialog = this.filterId = undefined;\n      });\n    };\n\n    r();\n  };\n}\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport App from '../config/app';\r\nimport DEBUG from '../config/debug';\r\nimport replaceContent from '../helpers/dom/replaceContent';\r\nimport {LangPackKey, i18n} from '../lib/langPack';\r\nimport {logger} from '../lib/logger';\r\nimport rootScope from '../lib/rootScope';\r\nimport Button from './button';\r\nimport ProgressivePreloader from './preloader';\r\nimport SetTransition from './singleTransition';\r\nimport sessionStorage from '../lib/sessionStorage';\r\nimport {ConnectionStatus} from '../lib/mtproto/connectionStatus';\r\nimport cancelEvent from '../helpers/dom/cancelEvent';\r\nimport {attachClickEvent} from '../helpers/dom/clickEvent';\r\nimport {AppManagers} from '../lib/appManagers/managers';\r\nimport singleInstance from '../lib/mtproto/singleInstance';\r\n\r\nexport default class ConnectionStatusComponent {\r\n  public static CHANGE_STATE_DELAY = 1000;\r\n\r\n  private statusContainer: HTMLElement;\r\n  private statusEl: HTMLElement;\r\n  private statusPreloader: ProgressivePreloader;\r\n\r\n  private currentLangPackKey: LangPackKey;\r\n\r\n  private hadConnect = false;\r\n  private retryAt: number;\r\n  private connecting = false;\r\n  private timedOut = false;\r\n  private updating = false;\r\n\r\n  private log: ReturnType<typeof logger>;\r\n\r\n  private setFirstConnectionTimeout: number;\r\n  private setStateTimeout: number;\r\n\r\n  constructor(private managers: AppManagers, chatsContainer: HTMLElement) {\r\n    this.log = logger('CS', undefined, undefined);\r\n\r\n    this.statusContainer = document.createElement('div');\r\n    this.statusContainer.classList.add('connection-status'/* , 'hide' */);\r\n\r\n    this.statusEl = Button('btn-primary bg-warning connection-status-button', {noRipple: true});\r\n    this.statusPreloader = new ProgressivePreloader({cancelable: false});\r\n    this.statusPreloader.constructContainer({color: 'transparent', bold: true});\r\n    this.statusContainer.append(this.statusEl);\r\n\r\n    chatsContainer.prepend(this.statusContainer);\r\n\r\n    rootScope.addEventListener('connection_status_change', (status) => {\r\n      // console.log(status);\r\n\r\n      this.setConnectionStatus();\r\n    });\r\n\r\n    rootScope.addEventListener('state_synchronizing', (channelId) => {\r\n      if(!channelId) {\r\n        this.updating = true;\r\n        DEBUG && this.log('updating', this.updating);\r\n        this.setState();\r\n      }\r\n    });\r\n\r\n    rootScope.addEventListener('state_synchronized', (channelId) => {\r\n      DEBUG && this.log('state_synchronized', channelId);\r\n      if(!channelId) {\r\n        this.updating = false;\r\n        DEBUG && this.log('updating', this.updating);\r\n        this.setState();\r\n      }\r\n    });\r\n\r\n    this.setFirstConnectionTimeout = window.setTimeout(this.setConnectionStatus, ConnectionStatusComponent.CHANGE_STATE_DELAY + 1e3);\r\n\r\n    /* let bool = true;\r\n    document.addEventListener('dblclick', () => {\r\n      const dcId = 2;\r\n      rootScope.dispatchEvent('connection_status_change', {\r\n        dcId: dcId,\r\n        isFileDownload: false,\r\n        isFileNetworker: false,\r\n        isFileUpload: false,\r\n        name: \"NET-\" + dcId,\r\n        status: bool ? (bool = false, ConnectionStatus.Closed) : (bool = true, ConnectionStatus.Connected),\r\n        _: \"networkerStatus\"\r\n      });\r\n    }); */\r\n  }\r\n\r\n  private setConnectionStatus = () => {\r\n    Promise.all([\r\n      sessionStorage.get('dc'),\r\n      rootScope.managers.rootScope.getConnectionStatus()\r\n    ]).then(([baseDcId, connectionStatus]) => {\r\n      if(!baseDcId) {\r\n        baseDcId = App.baseDcId;\r\n      }\r\n\r\n      if(this.setFirstConnectionTimeout) {\r\n        clearTimeout(this.setFirstConnectionTimeout);\r\n        this.setFirstConnectionTimeout = 0;\r\n      }\r\n\r\n      const status = connectionStatus['NET-' + baseDcId];\r\n      const online = status && status.status === ConnectionStatus.Connected;\r\n\r\n      if(this.connecting && online) {\r\n        this.managers.apiUpdatesManager.forceGetDifference();\r\n      }\r\n\r\n      if(online && !this.hadConnect) {\r\n        this.hadConnect = true;\r\n      }\r\n\r\n      this.timedOut = status && status.status === ConnectionStatus.TimedOut;\r\n      this.connecting = !online;\r\n      this.retryAt = status && status.retryAt;\r\n      DEBUG && this.log('connecting', this.connecting);\r\n      this.setState();\r\n    });\r\n  };\r\n\r\n  private setStatusText = (langPackKey: LangPackKey, args?: any[]) => {\r\n    if(this.currentLangPackKey === langPackKey) return;\r\n    this.currentLangPackKey = langPackKey;\r\n    replaceContent(this.statusEl, i18n(langPackKey, args));\r\n    this.statusPreloader.attach(this.statusEl);\r\n  };\r\n\r\n  private getA(langPackKey: LangPackKey, callback: () => void) {\r\n    const a = document.createElement('a');\r\n    a.classList.add('force-reconnect');\r\n    a.append(i18n(langPackKey));\r\n    attachClickEvent(a, (e) => {\r\n      cancelEvent(e);\r\n      callback();\r\n    });\r\n\r\n    return a;\r\n  }\r\n\r\n  private setState = () => {\r\n    if(singleInstance.deactivatedReason) {\r\n      return;\r\n    }\r\n\r\n    const timeout = ConnectionStatusComponent.CHANGE_STATE_DELAY;\r\n    if(this.connecting) {\r\n      if(this.timedOut) {\r\n        const a = this.getA('ConnectionStatus.ForceReconnect', () => this.managers.networkerFactory.forceReconnect());\r\n        this.setStatusText('ConnectionStatus.TimedOut', [a]);\r\n      } else if(this.hadConnect) {\r\n        if(this.retryAt !== undefined) {\r\n          const timerSpan = document.createElement('span');\r\n          const retryAt = this.retryAt;\r\n          const setTime = () => {\r\n            const now = Date.now();\r\n            timerSpan.innerText = '' + Math.round((retryAt - now) / 1000);\r\n            if(now > retryAt) {\r\n              clearInterval(interval);\r\n            }\r\n          };\r\n          const interval = setInterval(setTime, 1e3);\r\n          setTime();\r\n\r\n          const a = this.getA('ConnectionStatus.Reconnect', () => this.managers.networkerFactory.forceReconnectTimeout());\r\n          this.setStatusText('ConnectionStatus.ReconnectIn', [timerSpan, a]);\r\n        } else {\r\n          this.setStatusText('ConnectionStatus.Reconnecting');\r\n        }\r\n      } else {\r\n        this.setStatusText('ConnectionStatus.Waiting');\r\n      }\r\n    } else if(this.updating) {\r\n      this.setStatusText('Updating');\r\n    }\r\n\r\n    DEBUG && this.log('setState', this.connecting || this.updating);\r\n    window.requestAnimationFrame(() => {\r\n      if(this.setStateTimeout) clearTimeout(this.setStateTimeout);\r\n\r\n      const cb = () => {\r\n        SetTransition(this.statusContainer, 'is-shown', this.connecting || this.updating, 200);\r\n        this.setStateTimeout = 0;\r\n        DEBUG && this.log('setState: isShown:', this.connecting || this.updating);\r\n      };\r\n\r\n      this.setStateTimeout = window.setTimeout(cb, timeout);\r\n      // cb();\r\n      /* if(timeout) this.setStateTimeout = window.setTimeout(cb, timeout);\r\n      else cb(); */\r\n    });\r\n  };\r\n}\r\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport {Message} from '../layer';\n/* import findUpClassName from \"../helpers/dom/findUpClassName\";\nimport rootScope from \"../lib/rootScope\";\nimport Transition from \"./transition\"; */\n\nexport enum SENDING_STATUS {\n  Error = -1,\n  Pending,\n  Sent,\n  Read\n}\n\nexport function getSendingStatus(message: Message.message | Message.messageService) {\n  return message.pFlags.is_outgoing ?\n    SENDING_STATUS.Pending : (\n      message.pFlags.unread ?\n      SENDING_STATUS.Sent :\n      SENDING_STATUS.Read\n    );\n}\n\nexport function setSendingStatus(\n  container: HTMLElement,\n  message?: Message.message | Message.messageService,\n  disableAnimationIfRippleFound?: boolean\n) {\n  let className: 'check' | 'checks' | 'sending' | 'sendingerror';\n  if(message?.pFlags.out) {\n    if(message.error) {\n      className = 'sendingerror';\n    } else if(message.pFlags.is_outgoing) {\n      className = 'sending';\n    } else if(message.pFlags.unread) {\n      className = 'check';\n    } else {\n      className = 'checks';\n    }\n  }\n\n  if(!className) {\n    container.textContent = '';\n    return;\n  }\n\n  const iconClassName = 'tgico-' + className;\n  const lastElement = container.lastElementChild as HTMLElement;\n  if(lastElement && lastElement.classList.contains(iconClassName)) {\n    return;\n  }\n\n  const element = document.createElement('i');\n  element.classList.add('sending-status-icon', /* 'transition-item', */ iconClassName);\n  container.append(element);\n\n  if(lastElement) {\n    lastElement.remove();\n  }\n\n  /* if(!lastElement) {\n    element.classList.add('active');\n    return;\n  }\n\n  const select = Transition(container, undefined, 350, () => {\n    lastElement.remove();\n  }, false, true, false);\n\n  let animate = rootScope.settings.animationsEnabled && className !== 'sending' && !lastElement.classList.contains('tgico-sending');\n  if(disableAnimationIfRippleFound && animate) {\n    const parent = findUpClassName(container, 'rp');\n    if(parent.querySelector('.c-ripple__circle') || parent.matches(':hover')) {\n      animate = false;\n    }\n  }\n\n  select(element, animate, lastElement); */\n\n  /* SetTransition(lastElement, 'is-visible', false, 350, () => {\n    // lastElement.remove();\n  }, 2);\n  SetTransition(element, 'is-visible', true, 350, undefined, 2); */\n}\n","// https://spicyyoghurt.com/tools/easing-functions\nexport default function easeInOutSine(t: number, b: number, c: number, d: number) {\n  return t >= d ? b + c : -c / 2 * (Math.cos(Math.PI * t / d) - 1) + b;\n}\n","export default function roundRect(\n  ctx: CanvasRenderingContext2D,\n  x: number,\n  y: number,\n  width: number,\n  height: number,\n  radius: {[k in 'tl' | 'tr' | 'br' | 'bl']?: number} | number,\n  fill?: boolean,\n  stroke?: boolean\n) {\n  const dpr = ctx.canvas.dpr;\n  if(dpr) {\n    x *= dpr;\n    y *= dpr;\n    width *= dpr;\n    height *= dpr;\n  }\n\n  if(typeof(radius) === 'number') {\n    if(dpr) radius *= dpr;\n    radius = {tl: radius, tr: radius, br: radius, bl: radius};\n  } else {\n    const defaultRadius = {tl: 0, tr: 0, br: 0, bl: 0};\n    for(const side in defaultRadius) {\n      // @ts-ignore\n      radius[side] = radius[side] ? (dpr ? radius[side] * dpr : radius[side]) : defaultRadius[side];\n    }\n  }\n\n  ctx.beginPath();\n  ctx.moveTo(x + radius.tl, y);\n  ctx.lineTo(x + width - radius.tr, y);\n  ctx.quadraticCurveTo(x + width, y, x + width, y + radius.tr);\n  ctx.lineTo(x + width, y + height - radius.br);\n  ctx.quadraticCurveTo(x + width, y + height, x + width - radius.br, y + height);\n  ctx.lineTo(x + radius.bl, y + height);\n  ctx.quadraticCurveTo(x, y + height, x, y + height - radius.bl);\n  ctx.lineTo(x, y + radius.tl);\n  ctx.quadraticCurveTo(x, y, x + radius.tl, y);\n  ctx.closePath();\n\n  if(fill) {\n    ctx.fill();\n  }\n\n  if(stroke) {\n    ctx.stroke();\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport {animate} from '../helpers/animation';\nimport customProperties from '../helpers/dom/customProperties';\nimport easeInOutSine from '../helpers/easing/easeInOutSine';\nimport mediaSizes from '../helpers/mediaSizes';\nimport roundRect from '../helpers/canvas/roundRect';\n\nconst DPR = window.devicePixelRatio;\nconst SIZE = 20 * DPR;\nconst MARGIN = 2.5 * DPR;\nconst WIDTH = 2 * DPR;\nconst RADIUS = 1 * DPR;\nconst LENGTH = 3;\n\nconst MIN_HEIGHT = 4;\nconst MAX_HEIGHT = 12;\nconst DURATION = 1000;\n\nexport default function groupCallActiveIcon(isActive = false) {\n  const canvas = document.createElement('canvas');\n  canvas.width = canvas.height = SIZE;\n  const context = canvas.getContext('2d');\n\n  const TOTAL_WIDTH = LENGTH * WIDTH + (LENGTH - 1) * MARGIN;\n  const START_X = (SIZE - TOTAL_WIDTH) / 2;\n\n  const startTime = Date.now();\n  let wasMounted = false;\n  // let hadRound = false;\n  const renderFrame = () => {\n    if(!canvas.isConnected) {\n      if(wasMounted) {\n        return false;\n      }\n    } else if(!wasMounted) {\n      wasMounted = canvas.isConnected;\n    }\n\n    const time = Date.now();\n    // if(((time - startTime) / DURATION) >= 1) {\n    //   hadRound = true;\n    // }\n\n    const progress = easeInOutSine((time - startTime) % DURATION, 0, 1, DURATION);\n\n    context.clearRect(0, 0, SIZE, SIZE);\n    context.fillStyle = isActive && !mediaSizes.isMobile ? customProperties.getProperty('primary-color') : '#fff';\n\n    for(let i = 0; i < LENGTH; ++i) {\n      const x = START_X + (i * WIDTH) + (i * MARGIN);\n\n      let itemProgress: number;\n      if(progress >= .5) {\n        itemProgress = i % 2 ? 2 - progress * 2 : (progress - .5) * 2;\n      } else {\n        itemProgress = i % 2 ? progress * 2 : 1 - progress * 2;\n      }\n\n      let height = MIN_HEIGHT + (itemProgress * (MAX_HEIGHT - MIN_HEIGHT));\n      /* if(!hadRound && i === 1) {\n        console.log('call status animation', itemProgress, height, progress, progress >= .5);\n      } */\n\n      height *= DPR;\n      const y = (SIZE - height) / 2;\n\n      roundRect(context, x, y, WIDTH, height, RADIUS, true);\n    }\n\n    return true;\n  };\n\n  return {\n    canvas,\n    startAnimation: () => {\n      animate(renderFrame);\n      renderFrame();\n    },\n    setActive: (active: boolean) => {\n      isActive = active;\n      renderFrame();\n    }\n  };\n}\n","import customProperties from '../dom/customProperties';\nimport clamp from '../number/clamp';\n\nexport default class Shimmer {\n  private canvas: HTMLCanvasElement;\n  private ctx: CanvasRenderingContext2D;\n  private font = '30pt Helvetica';\n  private currTime = Date.now();\n  private diffTime = 0;\n  private spread = 0;\n  private paused = false;\n  private pausedTime = 0;\n  private pauseInterval = 850;\n  private lightSource = 0;\n  private inc = 0.032;\n  private lightSpread = 0.55;\n  private animations = ['slide', 'slide', 'slide', 'slide'];\n  private currentAnimationIndex = 0;\n  private text: string;\n  private fillStyle: CanvasRenderingContext2D['fillStyle'];\n\n  private keepTime() {\n    this.diffTime = Date.now() - this.currTime;\n    this.currTime = Date.now();\n  }\n\n  private cycleAnimation() {\n    ++this.currentAnimationIndex;\n    if(this.currentAnimationIndex >= this.animations.length) {\n      this.currentAnimationIndex = 0;\n    }\n  }\n\n  private animate() {\n    const currentAnimation = this.animations[this.currentAnimationIndex];\n    if(currentAnimation === 'glow') {\n      return this.animateGlow(); // return glow style\n    } else if(currentAnimation === 'slide') {\n      return this.animateSlide(); // return slide gradient\n    } else {\n      console.log('unknown animation type: ' + String(currentAnimation));\n    }\n  }\n\n  private animateGlow() {\n    var glowEnd = 255,\n      rgbStart = 68,\n      r = rgbStart,\n      g = r,\n      b = r,\n      increment = 10,\n      interval = 800;\n\n    return () => {\n      var smartInc = increment * (this.diffTime / (1000 / 60));\n      if(this.paused) {\n        if((Date.now() - this.pausedTime) > interval) {\n          r = rgbStart;\n          this.cycleAnimation()\n          this.paused = false;\n        }\n      } else {\n        r = parseInt('' + (r + smartInc));\n        if(r >= glowEnd) {\n          this.paused = true;\n          this.pausedTime = Date.now()\n        }\n      }\n      return 'rgb('+ r + ',' + r + ',' + r + ')';\n    };\n  }\n\n  private animateSlide(): CanvasGradient {\n    var gradient = this.ctx.createLinearGradient(0, 0, this.canvas.width, 0),\n      smartInc = this.inc * (this.diffTime / (1000 / 60)),\n      lightLeft,\n      lightRight,\n      lightCenter;\n    if(this.paused) {\n      if((Date.now() - this.pausedTime) > this.pauseInterval) {\n        this.lightSource = -0.6;\n        this.cycleAnimation()\n        this.paused = false;\n        return this.animateSlide();\n      }\n    } else {\n      this.lightSource += smartInc;\n      if(this.lightSource > (1 + this.lightSpread)) {\n        this.paused = true;\n        this.pausedTime = Date.now();\n      }\n    }\n    // lighting positions:\n    lightCenter = clamp(this.lightSource, 0, 1);\n    lightLeft = clamp(this.lightSource - this.lightSpread, 0, 1);\n    lightRight = clamp(this.lightSource + this.lightSpread, 0, 1);\n\n    const backgroundColor = customProperties.getProperty('background-color-true');\n    const shimmerColor = customProperties.getProperty('surface-color');\n    gradient.addColorStop(lightLeft, backgroundColor);\n    gradient.addColorStop(lightCenter, shimmerColor);\n    gradient.addColorStop(lightRight, backgroundColor);\n\n    return gradient;\n  }\n\n  public settings(dict: Partial<{\n    canvas: Shimmer['canvas'],\n    fillStyle: Shimmer['fillStyle'],\n    font: Shimmer['font'],\n    lightSpread: Shimmer['lightSpread'],\n    inc: Shimmer['inc'],\n    animations: Shimmer['animations'],\n    text: Shimmer['text']\n  }> = {}) {\n    this.canvas = dict.canvas ?? document.createElement('canvas');\n    this.ctx = this.canvas.getContext('2d');\n    this.font = dict.font ?? this.font;\n    this.lightSpread = dict.lightSpread ?? this.lightSpread;\n    this.inc = dict.inc ?? this.inc;\n    this.animations = dict.animations ?? this.animations;\n    this.text = dict.text ?? this.text;\n    this.fillStyle = dict.fillStyle;\n\n    this.canvas.classList.add('shimmer-canvas');\n  }\n\n  public on() {\n    const {width, height} = this.canvas;\n    // record the time we ran:\n    this.keepTime();\n    // clear and fill the canvas:\n    this.ctx.clearRect(0, 0, width, height);\n\n    if(this.font) {\n      this.ctx.font = this.font;\n    }\n\n    this.ctx.fillStyle = this.animate() as any;\n    this.ctx.fillRect(0, 0, width, height);\n\n    if(this.fillStyle) {\n      this.ctx.fillStyle = this.fillStyle;\n      this.ctx.fillRect(0, 0, width, height);\n    }\n\n    if(this.text) {\n      this.ctx.fillText(this.text, 50, 50);\n    }\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport Scrollable from '../components/scrollable';\nimport rootScope from '../lib/rootScope';\nimport {animate} from './animation';\nimport {drawCircleFromStart} from './canvas/drawCircle';\nimport roundRect from './canvas/roundRect';\nimport Shimmer from './canvas/shimmer';\nimport customProperties from './dom/customProperties';\nimport easeInOutSine from './easing/easeInOutSine';\nimport mediaSizes from './mediaSizes';\n\nexport default class DialogsPlaceholder {\n  private canvas: HTMLCanvasElement;\n  private ctx: CanvasRenderingContext2D;\n  private shimmer: Shimmer;\n  private tempId: number;\n  private detachTime: number;\n\n  private length: number;\n  private dialogHeight: number;\n  private availableLength: number;\n\n  private avatarSize: number;\n  private marginVertical: number;\n  private lineHeight: number;\n  private lineBorderRadius: number;\n  private lineMarginVertical: number;\n  private statusWidth: number;\n  private generatedValues: {\n    firstLineWidth: number,\n    secondLineWidth: number,\n    statusWidth: number\n  }[];\n\n  private getRectFrom: Element;\n  private onRemove: () => void;\n  private blockScrollable: Scrollable;\n\n  constructor() {\n    this.shimmer = new Shimmer();\n    this.tempId = 0;\n    this.canvas = document.createElement('canvas');\n    this.canvas.classList.add('dialogs-placeholder-canvas');\n    this.ctx = this.canvas.getContext('2d');\n\n    this.generatedValues = [];\n    this.avatarSize = 54;\n    this.marginVertical = 9;\n    this.lineHeight = 10;\n    this.lineBorderRadius = 6;\n    this.lineMarginVertical = 8;\n    this.statusWidth = 24;\n  }\n\n  public attach({container, rect, getRectFrom, onRemove, blockScrollable}: {\n    container: HTMLElement,\n    rect?: {width: number, height: number},\n    getRectFrom?: HTMLElement,\n    onRemove?: DialogsPlaceholder['onRemove'],\n    blockScrollable?: DialogsPlaceholder['blockScrollable']\n  }) {\n    const {canvas} = this;\n\n    this.onRemove = onRemove;\n    this.getRectFrom = getRectFrom || container;\n    if(this.blockScrollable = blockScrollable) {\n      blockScrollable.container.style.overflowY = 'hidden';\n    }\n\n    this.updateCanvasSize(rect);\n    this.startAnimation();\n    container.append(canvas);\n  }\n\n  public detach(availableLength: number) {\n    if(this.detachTime) {\n      return;\n    }\n\n    this.availableLength = availableLength;\n    this.detachTime = Date.now();\n\n    if(!rootScope.settings.animationsEnabled) {\n      this.remove();\n    }\n  }\n\n  public remove() {\n    this.stopAnimation();\n\n    if(this.canvas.parentElement) {\n      this.canvas.remove();\n\n      if(this.onRemove) {\n        this.onRemove();\n        this.onRemove = undefined;\n      }\n\n      if(this.blockScrollable) {\n        this.blockScrollable.container.style.overflowY = '';\n        this.blockScrollable = undefined;\n      }\n    }\n  }\n\n  private updateCanvasSize(rect: {width: number, height: number} = this.getRectFrom.getBoundingClientRect()) {\n    const {canvas} = this;\n    const dpr = canvas.dpr = window.devicePixelRatio;\n    canvas.width = rect.width * dpr;\n    canvas.height = rect.height * dpr;\n    canvas.style.width = rect.width + 'px';\n    canvas.style.height = rect.height + 'px';\n  }\n\n  private renderDetachAnimationFrame() {\n    const {\n      canvas,\n      ctx,\n      detachTime,\n      length,\n      availableLength\n    } = this;\n\n    if(!detachTime) {\n      return;\n    } else if(!rootScope.settings.animationsEnabled) {\n      this.remove();\n      return;\n    }\n\n    const {width} = canvas;\n\n    ctx.globalCompositeOperation = 'destination-out';\n\n    // ctx.fillStyle = 'rgba(0, 0, 0, 0)';\n    // ctx.fillRect(0, 0, width, height);\n\n    // const DURATION = 500;\n    // const DELAY = DURATION;\n    const DURATION = 150;\n    const DELAY = 15;\n    const elapsedTime = Date.now() - detachTime;\n    let completed = true;\n    for(let i = 0; i < length; ++i) {\n      const delay = availableLength < length && i >= availableLength ? DELAY * (availableLength - 1) : DELAY * i;\n      const elapsedRowTime = elapsedTime - delay;\n      if(elapsedRowTime <= 0) {\n        completed = false;\n        continue;\n      }\n\n      const progress = easeInOutSine(elapsedRowTime, 0, 1, DURATION);\n\n      ctx.beginPath();\n      ctx.rect(0, this.dialogHeight * i, width, this.dialogHeight);\n      ctx.fillStyle = `rgba(0, 0, 0, ${progress})`;\n      ctx.fill();\n\n      if(progress < 1) {\n        completed = false;\n      }\n    }\n\n    // const totalRadius = Math.sqrt(width ** 2 + height ** 2);\n    // const gradient = ctx.createRadialGradient(\n    //   0, 0, 0,\n    //   0, 0, totalRadius);\n    // gradient.addColorStop(0, 'rgba(0, 0, 0, 1)');\n    // gradient.addColorStop(progress, 'rgba(0, 0, 0, 0)');\n    // gradient.addColorStop(1, 'rgba(0, 0, 0, 0)');\n\n    // const gradient = ctx.createLinearGradient(0, 0, 0, height);\n    // gradient.addColorStop(0, 'rgba(0, 0, 0, 1)');\n    // gradient.addColorStop(progress, 'rgba(0, 0, 0, 0)');\n    // gradient.addColorStop(1, 'rgba(0, 0, 0, 0)');\n\n    // ctx.fillStyle = gradient;\n    // ctx.fillRect(0, 0, width, height);\n\n    ctx.globalCompositeOperation = 'source-over';\n\n    if(completed) {\n      this.remove();\n    }\n  }\n\n  private renderFrame() {\n    this.shimmer.on();\n    this.renderDetachAnimationFrame();\n  }\n\n  private startAnimation() {\n    const {canvas, shimmer} = this;\n    const tempId = ++this.tempId;\n    const pattern = this.createPattern();\n\n    shimmer.settings({\n      canvas,\n      fillStyle: pattern\n    });\n\n    const middleware = () => {\n      return this.tempId === tempId;\n    };\n\n    this.renderFrame();\n    animate(() => {\n      if(!middleware()) {\n        return false;\n      }\n\n      // ! should've removed the loop if animations are disabled\n      if(rootScope.settings.animationsEnabled) {\n        this.renderFrame();\n      }\n\n      // ! tempId can be changed during renderFrame\n      return middleware();\n    });\n\n    rootScope.addEventListener('theme_change', this.onThemeChange);\n    mediaSizes.addEventListener('resize', this.onResize);\n  }\n\n  private stopAnimation() {\n    ++this.tempId;\n    rootScope.removeEventListener('theme_change', this.onThemeChange);\n    mediaSizes.removeEventListener('resize', this.onResize);\n  }\n\n  private onThemeChange = () => {\n    this.stopAnimation();\n    this.startAnimation();\n  };\n\n  private onResize = () => {\n    const {canvas} = this;\n    const {width, height, dpr} = canvas;\n    this.updateCanvasSize();\n    if(canvas.width === width && canvas.height === height && canvas.dpr === dpr) {\n      return;\n    }\n\n    this.stopAnimation();\n    this.startAnimation();\n  };\n\n  private createPattern() {\n    const {canvas, ctx} = this;\n\n    const patternCanvas = document.createElement('canvas');\n    const patternContext = patternCanvas.getContext('2d');\n    const dpr = canvas.dpr;\n    patternCanvas.dpr = dpr;\n    patternCanvas.width = canvas.width;\n    patternCanvas.height = canvas.height;\n\n    patternContext.fillStyle = customProperties.getProperty('surface-color');\n    patternContext.fillRect(0, 0, patternCanvas.width, patternCanvas.height);\n\n    patternContext.fillStyle = '#000';\n    patternContext.globalCompositeOperation = 'destination-out';\n\n    const dialogHeight = this.dialogHeight = (this.avatarSize + this.marginVertical * 2) * dpr;\n    const length = this.length = Math.ceil(canvas.height / dialogHeight);\n    for(let i = 0; i < length; ++i) {\n      this.drawChat(patternContext, i, i * dialogHeight);\n    }\n\n    return ctx.createPattern(patternCanvas, 'no-repeat');\n  }\n\n  private drawChat(ctx: CanvasRenderingContext2D, i: number, y: number) {\n    let generatedValues = this.generatedValues[i];\n    if(!generatedValues) {\n      generatedValues = this.generatedValues[i] = {\n        firstLineWidth: 40 + Math.random() * 100, // 120\n        secondLineWidth: 120 + Math.random() * 130, // 240\n        statusWidth: 24 + Math.random() * 16\n      };\n    }\n\n    const {\n      firstLineWidth,\n      secondLineWidth,\n      statusWidth\n    } = generatedValues;\n\n    const {canvas} = ctx;\n    const {dpr} = canvas;\n    y /= dpr;\n\n    const {\n      avatarSize,\n      marginVertical,\n      lineHeight,\n      lineBorderRadius,\n      lineMarginVertical\n    } = this;\n\n    let marginLeft = 17;\n    drawCircleFromStart(ctx, marginLeft, y + marginVertical, avatarSize / 2, true);\n\n    marginLeft += avatarSize + 10;\n    roundRect(ctx, marginLeft, y + marginVertical + lineMarginVertical, firstLineWidth, lineHeight, lineBorderRadius, true);\n    roundRect(ctx, marginLeft, y + marginVertical + avatarSize - lineHeight - lineMarginVertical, secondLineWidth, lineHeight, lineBorderRadius, true);\n\n    roundRect(ctx, canvas.width / dpr - 24 - statusWidth, y + marginVertical + lineMarginVertical, statusWidth, lineHeight, lineBorderRadius, true);\n  }\n}\n","export default function drawCircle(ctx: CanvasRenderingContext2D, x: number, y: number, radius: number, fill?: boolean, stroke?: boolean) {\n  const dpr = ctx.canvas.dpr;\n  if(dpr) {\n    x *= dpr;\n    y *= dpr;\n    radius *= dpr;\n  }\n\n  ctx.beginPath();\n  ctx.arc(x, y, radius, 0, 2 * Math.PI, false);\n  ctx.closePath();\n\n  if(fill) {\n    ctx.fill();\n  }\n\n  if(stroke) {\n    ctx.stroke();\n  }\n}\n\nexport function drawCircleFromStart(ctx: CanvasRenderingContext2D, x: number, y: number, radius: number, fill?: boolean, stroke?: boolean) {\n  return drawCircle(ctx, x + radius, y + radius, radius, fill, stroke);\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport type {MyDialogFilter as DialogFilter, MyDialogFilter} from '../storages/filters';\nimport type LazyLoadQueue from '../../components/lazyLoadQueue';\nimport type {Dialog, MyMessage} from './appMessagesManager';\nimport type {MyPhoto} from './appPhotosManager';\nimport type {MyDocument} from './appDocsManager';\nimport type {State} from '../../config/state';\nimport AvatarElement from '../../components/avatar';\nimport DialogsContextMenu from '../../components/dialogsContextMenu';\nimport {horizontalMenu} from '../../components/horizontalMenu';\nimport ripple from '../../components/ripple';\nimport Scrollable, {ScrollableX, SliceSides} from '../../components/scrollable';\nimport {formatDateAccordingToTodayNew} from '../../helpers/date';\nimport {IS_MOBILE_SAFARI, IS_SAFARI} from '../../environment/userAgent';\nimport {logger, LogTypes} from '../logger';\nimport rootScope from '../rootScope';\nimport appImManager from './appImManager';\nimport Button from '../../components/button';\nimport SetTransition from '../../components/singleTransition';\nimport {MyDraftMessage} from './appDraftsManager';\nimport DEBUG, {MOUNT_CLASS_TO} from '../../config/debug';\nimport PeerTitle from '../../components/peerTitle';\nimport I18n, {FormatterArguments, i18n, LangPackKey, _i18n} from '../langPack';\nimport findUpTag from '../../helpers/dom/findUpTag';\nimport lottieLoader from '../rlottie/lottieLoader';\nimport {wrapPhoto} from '../../components/wrappers';\nimport AppEditFolderTab from '../../components/sidebarLeft/tabs/editFolder';\nimport appSidebarLeft, {SettingSection} from '../../components/sidebarLeft';\nimport {attachClickEvent} from '../../helpers/dom/clickEvent';\nimport positionElementByIndex from '../../helpers/dom/positionElementByIndex';\nimport replaceContent from '../../helpers/dom/replaceContent';\nimport ConnectionStatusComponent from '../../components/connectionStatus';\nimport {renderImageFromUrlPromise} from '../../helpers/dom/renderImageFromUrl';\nimport {fastRafConventional, fastRafPromise} from '../../helpers/schedulers';\nimport SortedUserList from '../../components/sortedUserList';\nimport IS_TOUCH_SUPPORTED from '../../environment/touchSupport';\nimport handleTabSwipe from '../../helpers/dom/handleTabSwipe';\nimport windowSize from '../../helpers/windowSize';\nimport isInDOM from '../../helpers/dom/isInDOM';\nimport {setSendingStatus} from '../../components/sendingStatus';\nimport SortedList, {SortedElementBase} from '../../helpers/sortedList';\nimport debounce from '../../helpers/schedulers/debounce';\nimport {FOLDER_ID_ALL, FOLDER_ID_ARCHIVE, NULL_PEER_ID, REAL_FOLDERS, REAL_FOLDER_ID} from '../mtproto/mtproto_config';\nimport groupCallActiveIcon from '../../components/groupCallActiveIcon';\nimport {Chat, Message, NotifyPeer} from '../../layer';\nimport IS_GROUP_CALL_SUPPORTED from '../../environment/groupCallSupport';\nimport mediaSizes from '../../helpers/mediaSizes';\nimport appNavigationController, {NavigationItem} from '../../components/appNavigationController';\nimport assumeType from '../../helpers/assumeType';\nimport appMediaPlaybackController from '../../components/appMediaPlaybackController';\nimport setInnerHTML from '../../helpers/dom/setInnerHTML';\nimport {AppManagers} from './managers';\nimport appSidebarRight from '../../components/sidebarRight';\nimport PopupElement from '../../components/popups';\nimport choosePhotoSize from './utils/photos/choosePhotoSize';\nimport wrapEmojiText from '../richTextProcessor/wrapEmojiText';\nimport wrapMessageForReply from '../../components/wrappers/messageForReply';\nimport isMessageRestricted from './utils/messages/isMessageRestricted';\nimport getMediaFromMessage from './utils/messages/getMediaFromMessage';\nimport getMessageSenderPeerIdOrName from './utils/messages/getMessageSenderPeerIdOrName';\nimport wrapStickerEmoji from '../../components/wrappers/stickerEmoji';\nimport getDialogIndexKey from './utils/dialogs/getDialogIndexKey';\nimport getProxiedManagers from './getProxiedManagers';\nimport getDialogIndex from './utils/dialogs/getDialogIndex';\nimport {attachContextMenuListener} from '../../helpers/dom/attachContextMenuListener';\nimport deferredPromise, {CancellablePromise} from '../../helpers/cancellablePromise';\nimport wrapPeerTitle from '../../components/wrappers/peerTitle';\nimport middlewarePromise from '../../helpers/middlewarePromise';\nimport appDownloadManager from './appDownloadManager';\nimport groupCallsController from '../calls/groupCallsController';\nimport callsController from '../calls/callsController';\nimport cancelEvent from '../../helpers/dom/cancelEvent';\nimport noop from '../../helpers/noop';\nimport DialogsPlaceholder from '../../helpers/dialogsPlaceholder';\nimport pause from '../../helpers/schedulers/pause';\nimport apiManagerProxy from '../mtproto/mtprotoworker';\nimport filterAsync from '../../helpers/array/filterAsync';\nimport forEachReverse from '../../helpers/array/forEachReverse';\nimport indexOfAndSplice from '../../helpers/array/indexOfAndSplice';\nimport whichChild from '../../helpers/dom/whichChild';\n\nexport const DIALOG_LIST_ELEMENT_TAG = 'A';\n\nexport type DialogDom = {\n  avatarEl: AvatarElement,\n  captionDiv: HTMLDivElement,\n  titleSpan: HTMLSpanElement,\n  titleSpanContainer: HTMLSpanElement,\n  statusSpan: HTMLSpanElement,\n  lastTimeSpan: HTMLSpanElement,\n  unreadBadge: HTMLElement,\n  callIcon?: ReturnType<typeof groupCallActiveIcon>,\n  mentionsBadge?: HTMLElement,\n  lastMessageSpan: HTMLSpanElement,\n  containerEl: HTMLElement,\n  listEl: HTMLElement,\n  subtitleEl: HTMLElement,\n\n  setLastMessagePromise?: CancellablePromise<void>,\n  setUnreadMessagePromise?: CancellablePromise<void>\n};\n\ninterface SortedDialog extends SortedElementBase {\n  dom: DialogDom,\n  loadPromises?: Promise<any>[]\n}\n\nfunction setPromiseMiddleware<T extends {[smth in K as K]?: CancellablePromise<void>}, K extends keyof T>(obj: T, key: K) {\n  const oldPromise: CancellablePromise<void> = obj[key] as any;\n  if(oldPromise) {\n    oldPromise.reject();\n  }\n\n  // @ts-ignore\n  const deferred = obj[key] = deferredPromise<void>();\n  deferred.catch(() => {}).finally(() => {\n    if((obj[key] as any) === deferred) {\n      delete obj[key];\n    }\n  });\n\n  const middleware = middlewarePromise(() => (obj[key] as any) === deferred);\n  return {deferred, middleware};\n}\n\nclass SortedDialogList extends SortedList<SortedDialog> {\n  constructor(\n    public managers: AppManagers,\n    public list: HTMLUListElement,\n    public indexKey: ReturnType<typeof getDialogIndexKey>,\n    public onListLengthChange?: () => void\n  ) {\n    super({\n      getIndex: (element) => managers.dialogsStorage.getDialogIndex(element.id, this.indexKey),\n      onDelete: (element) => {\n        element.dom.listEl.remove();\n        this.onListLengthChange && this.onListLengthChange();\n      },\n      onSort: (element, idx) => {\n        const willChangeLength = element.dom.listEl.parentElement !== this.list;\n        positionElementByIndex(element.dom.listEl, this.list, idx);\n\n        if(willChangeLength) {\n          this.onListLengthChange && this.onListLengthChange();\n        }\n      },\n      onElementCreate: (base, batch) => {\n        const loadPromises: Promise<any>[] = batch ? [] : undefined;\n\n        const {dom} = appDialogsManager.addListDialog({peerId: base.id, loadPromises, isBatch: batch});\n        (base as SortedDialog).dom = dom;\n\n        if(loadPromises?.length) {\n          (base as SortedDialog).loadPromises = loadPromises;\n          Promise.all(loadPromises).finally(() => {\n            delete (base as SortedDialog).loadPromises;\n          });\n        }\n\n        return base as SortedDialog;\n      },\n      updateElementWith: fastRafConventional\n    });\n  }\n\n  public clear() {\n    this.list.textContent = '';\n    super.clear();\n  }\n}\n\n// const testScroll = false;\n// let testTopSlice = 1;\n\nexport class AppDialogsManager {\n  private chatsContainer = document.getElementById('chatlist-container') as HTMLDivElement;\n\n  private loadDialogsPromise: Promise<{cached: boolean, renderPromise: AppDialogsManager['loadDialogsRenderPromise']}>;\n  private loadDialogsRenderPromise: Promise<void>;\n\n  private scroll: Scrollable = null;\n\n  private log = logger('DIALOGS', LogTypes.Log | LogTypes.Error | LogTypes.Warn | LogTypes.Debug);\n\n  private contextMenu: DialogsContextMenu;\n\n  private sortedList: SortedDialogList;\n  public placeholders: {[filterId: number]: DialogsPlaceholder} = {};\n  public sortedLists: {[filterId: number]: SortedDialogList} = {};\n  public scrollables: {[filterId: number]: Scrollable} = {};\n  public filterId: number;\n  private folders: {[k in 'menu' | 'container' | 'menuScrollContainer']: HTMLElement} = {\n    menu: document.getElementById('folders-tabs'),\n    menuScrollContainer: null,\n    container: document.getElementById('folders-container')\n  };\n  private filtersRendered: {\n    [filterId: string]: {\n      menu: HTMLElement,\n      container: HTMLElement,\n      unread: HTMLElement,\n      title: HTMLElement\n    }\n  } = {};\n  private showFiltersPromise: Promise<void>;\n\n  private sliceTimeout: number;\n\n  private lastActiveElements: Set<HTMLElement> = new Set();\n\n  private offsets: {top: number, bottom: number} = {top: 0, bottom: 0};\n\n  private loadContacts: () => void;\n  private processContact: (peerId: PeerId) => void;\n\n  private indexKey: ReturnType<typeof getDialogIndexKey>;\n\n  private initedListeners = false;\n\n  private onListLengthChange: () => Promise<void>;\n  private loadedDialogsAtLeastOnce = false;\n  private allChatsIntlElement: I18n.IntlElement;\n\n  private emptyDialogsPlaceholderSubtitle: I18n.IntlElement;\n  private updateContactsLengthPromise: Promise<number>;\n\n  private filtersNavigationItem: NavigationItem;\n\n  private managers: AppManagers;\n  private selectTab: ReturnType<typeof horizontalMenu>;\n\n  public start() {\n    const managers = this.managers = getProxiedManagers();\n\n    this.contextMenu = new DialogsContextMenu(managers);\n\n    this.folders.menuScrollContainer = this.folders.menu.parentElement;\n\n    this.onListLengthChange = debounce(this._onListLengthChange, 100, false, true);\n\n    const bottomPart = document.createElement('div');\n    bottomPart.classList.add('connection-status-bottom');\n    bottomPart.append(this.folders.container);\n\n    /* if(isTouchSupported && isSafari) {\n      let allowUp: boolean, allowDown: boolean, slideBeginY: number;\n      const container = this.scroll.container;\n      container.addEventListener('touchstart', (event) => {\n        allowUp = container.scrollTop > 0;\n        allowDown = (container.scrollTop < container.scrollHeight - container.clientHeight);\n        // @ts-ignore\n        slideBeginY = event.pageY;\n      });\n\n      container.addEventListener('touchmove', (event: any) => {\n        var up = (event.pageY > slideBeginY);\n        var down = (event.pageY < slideBeginY);\n        slideBeginY = event.pageY;\n        if((up && allowUp) || (down && allowDown)) {\n          event.stopPropagation();\n        } else if(up || down) {\n          event.preventDefault();\n        }\n      });\n    } */\n\n    if(IS_TOUCH_SUPPORTED) {\n      handleTabSwipe({\n        element: this.folders.container,\n        onSwipe: (xDiff) => {\n          const prevId = selectTab.prevId();\n          selectTab(xDiff > 0 ? prevId + 1 : prevId - 1);\n        }\n      });\n    }\n\n    this.allChatsIntlElement = new I18n.IntlElement({\n      key: 'FilterAllChatsShort'\n    });\n\n    /* if(testScroll) {\n      let i = 0;\n      let add = () => {\n        let li = document.createElement('li');\n        li.dataset.id = '' + i;\n        li.id = '' + i;\n        li.innerHTML = `<div class=\"rp\"><avatar-element style=\"background-color: rgb(166, 149, 231); font-size: 0px;\"><img src=\"assets/img/pepe.jpg\"></avatar-element><div class=\"user-caption\"><p><span class=\"user-title\">${i}</span><span><span class=\"message-status\"></span><span class=\"message-time\">18:33</span></span></p><p><span class=\"user-last-message\"><b>-_-_-_-: </b>qweasd</span><span></span></p></div></div>`;\n        i++;\n        this.scroll.append(li);\n      };\n      for(let i = 0; i < 500; ++i) {\n        add();\n      }\n      (window as any).addElement = add;\n    } */\n\n    rootScope.addEventListener('premium_toggle', async(isPremium) => {\n      if(isPremium) {\n        return;\n      }\n\n      const isFolderAvailable = await this.managers.filtersStorage.isFilterIdAvailable(this.filterId);\n      if(!isFolderAvailable) {\n        selectTab(whichChild(this.filtersRendered[FOLDER_ID_ALL].menu), false);\n      }\n    });\n\n    rootScope.addEventListener('state_cleared', () => {\n      const clearCurrent = REAL_FOLDERS.has(this.filterId);\n      // setTimeout(() =>\n      apiManagerProxy.getState().then(async(state) => {\n        this.loadedDialogsAtLeastOnce = false;\n\n        /* const clearPromises: Promise<any>[] = [];\n        for(const name in this.managers.appStateManager.storagesResults) {\n          const results = this.managers.appStateManager.storagesResults[name as keyof AppStateManager['storages']];\n          const storage = this.managers.appStateManager.storages[name as keyof AppStateManager['storages']];\n          results.length = 0;\n          clearPromises.push(storage.clear());\n        } */\n\n        if(clearCurrent) {\n          this.sortedList.clear();\n          this.onTabChange();\n        }\n\n        this.onStateLoaded(state);\n      })// , 5000);\n    });\n\n    this.setFilterId(FOLDER_ID_ALL, FOLDER_ID_ALL);\n    this.addFilter({\n      id: FOLDER_ID_ALL,\n      title: '',\n      localId: FOLDER_ID_ALL\n    });\n\n    const foldersScrollable = new ScrollableX(this.folders.menuScrollContainer);\n    bottomPart.prepend(this.folders.menuScrollContainer);\n    const selectTab = this.selectTab = horizontalMenu(this.folders.menu, this.folders.container, async(id, tabContent) => {\n      /* if(id !== 0) {\n        id += 1;\n      } */\n\n      const _id = id;\n      id = +tabContent.dataset.filterId || FOLDER_ID_ALL;\n\n      const isFilterAvailable = REAL_FOLDERS.has(id) || await this.managers.filtersStorage.isFilterIdAvailable(id);\n      if(!isFilterAvailable) {\n        return false;\n      }\n\n      const wasFilterId = this.filterId;\n      if(!IS_MOBILE_SAFARI) {\n        if(_id) {\n          if(!this.filtersNavigationItem) {\n            this.filtersNavigationItem = {\n              type: 'filters',\n              onPop: () => {\n                selectTab(0);\n                this.filtersNavigationItem = undefined;\n              }\n            };\n\n            appNavigationController.spliceItems(1, 0, this.filtersNavigationItem);\n          }\n        } else if(this.filtersNavigationItem) {\n          appNavigationController.removeItem(this.filtersNavigationItem);\n          this.filtersNavigationItem = undefined;\n        }\n      }\n\n      if(wasFilterId === id) return;\n\n      this.sortedLists[id].clear();\n      const promise = this.setFilterIdAndChangeTab(id).then(({cached, renderPromise}) => {\n        if(cached) {\n          return renderPromise;\n        }\n      });\n\n      if(wasFilterId !== -1) {\n        return promise;\n      }\n    }, () => {\n      for(const folderId in this.sortedLists) {\n        if(+folderId !== this.filterId) {\n          this.sortedLists[folderId].clear();\n          const placeholder = this.placeholders[folderId];\n          if(placeholder) {\n            placeholder.remove();\n          }\n        }\n      }\n    }, undefined, foldersScrollable);\n\n    apiManagerProxy.getState().then((state) => {\n      // * it should've had a better place :(\n      appMediaPlaybackController.setPlaybackParams(state.playbackParams);\n      appMediaPlaybackController.addEventListener('playbackParams', (params) => {\n        this.managers.appStateManager.pushToState('playbackParams', params);\n      });\n\n      return this.onStateLoaded(state);\n    })/* .then(() => {\n      const isLoadedMain = this.managers.appMessagesManager.dialogsStorage.isDialogsLoaded(0);\n      const isLoadedArchive = this.managers.appMessagesManager.dialogsStorage.isDialogsLoaded(1);\n      const wasLoaded = isLoadedMain || isLoadedArchive;\n      const a: Promise<any> = isLoadedMain ? Promise.resolve() : this.managers.appMessagesManager.getConversationsAll('', 0);\n      const b: Promise<any> = isLoadedArchive ? Promise.resolve() : this.managers.appMessagesManager.getConversationsAll('', 1);\n      a.finally(() => {\n        b.then(() => {\n          if(wasLoaded) {\n            (apiUpdatesManager.updatesState.syncLoading || Promise.resolve()).then(() => {\n              this.managers.appMessagesManager.refreshConversations();\n            });\n          }\n        });\n      });\n    }) */;\n\n    mediaSizes.addEventListener('resize', () => {\n      this.changeFiltersAllChatsKey();\n    });\n\n    new ConnectionStatusComponent(this.managers, this.chatsContainer);\n    this.chatsContainer.append(bottomPart);\n\n    setTimeout(() => {\n      lottieLoader.loadLottieWorkers();\n    }, 200);\n\n    PopupElement.MANAGERS = rootScope.managers = managers;\n    appDownloadManager.construct(managers);\n    appSidebarLeft.construct(managers);\n    appSidebarRight.construct(managers);\n    groupCallsController.construct(managers);\n    callsController.construct(managers);\n    appImManager.construct(managers);\n\n    // start\n\n    this.sortedList = this.sortedLists[this.filterId];\n    this.scroll = this.scrollables[this.filterId];\n\n    // selectTab(0, false);\n  }\n\n  public get chatList() {\n    return this.sortedList.list;\n  }\n\n  public setFilterId(filterId: number, localId: MyDialogFilter['localId']) {\n    this.filterId = filterId;\n    this.indexKey = getDialogIndexKey(REAL_FOLDERS.has(filterId) ? filterId as REAL_FOLDER_ID : localId);\n  }\n\n  public async setFilterIdAndChangeTab(filterId: number) {\n    this.filterId = filterId;\n    this.indexKey = await this.managers.dialogsStorage.getDialogIndexKeyByFilterId(filterId);\n    return this.onTabChange();\n  }\n\n  private setOnlineStatus(element: HTMLElement, online: boolean) {\n    const className = 'is-online';\n    const hasClassName = element.classList.contains(className);\n    !hasClassName && online && element.classList.add(className);\n    SetTransition(element, 'is-visible', online, 250, online ? undefined : () => {\n      element.classList.remove(className);\n    }, online && !hasClassName ? 2 : 0);\n  }\n\n  private initListeners() {\n    rootScope.addEventListener('user_update', async(userId) => {\n      // console.log('updating user:', user, dialog);\n\n      const peerId = userId.toPeerId();\n      const dom = this.getDialogDom(peerId);\n      if(dom && peerId !== rootScope.myId && !(await this.managers.appUsersManager.isBot(userId))) {\n        const user = await this.managers.appUsersManager.getUser(userId);\n        const online = user.status?._ === 'userStatusOnline';\n        this.setOnlineStatus(dom.avatarEl, online);\n      }\n    });\n\n    rootScope.addEventListener('chat_update', async(chatId) => {\n      const peerId = chatId.toPeerId(true);\n      const dialog = await this.managers.appMessagesManager.getDialogOnly(peerId);\n      if(dialog) {\n        this.processDialogForCallStatus(dialog);\n      }\n    });\n\n    rootScope.addEventListener('folder_unread', (folder) => {\n      this.setFilterUnreadCount(folder.id);\n    });\n\n    rootScope.addEventListener('contacts_update', (userId) => {\n      this.processContact && this.processContact(userId.toPeerId());\n    });\n\n    rootScope.addEventListener('dialog_flush', ({dialog}) => {\n      if(!dialog) {\n        return;\n      }\n\n      this.setLastMessageN({\n        dialog,\n        setUnread: true\n      });\n      this.validateDialogForFilter(dialog);\n      this.setFiltersUnreadCount();\n    });\n\n    rootScope.addEventListener('dialogs_multiupdate', (dialogs) => {\n      for(const [peerId, dialog] of dialogs) {\n        this.updateDialog(dialog);\n\n        if(this.processContact) {\n          this.processContact(peerId.toPeerId());\n        }\n\n        this.validateDialogForFilter(dialog);\n      }\n    });\n\n    rootScope.addEventListener('dialog_drop', ({peerId}) => {\n      this.deleteDialog(peerId);\n\n      if(this.processContact) {\n        this.processContact(peerId);\n      }\n    });\n\n    rootScope.addEventListener('dialog_unread', ({dialog}) => {\n      if(!dialog) {\n        return;\n      }\n\n      this.setUnreadMessagesN({dialog});\n      this.validateDialogForFilter(dialog);\n    });\n\n    rootScope.addEventListener('dialog_notify_settings', (dialog) => {\n      this.validateDialogForFilter(dialog);\n      this.setUnreadMessagesN({dialog}); //    ,    is-muted\n    });\n\n    rootScope.addEventListener('dialog_draft', ({dialog, drop, peerId}) => {\n      if(drop) {\n        this.sortedList.delete(peerId);\n      } else {\n        this.updateDialog(dialog);\n      }\n\n      if(this.processContact) {\n        this.processContact(peerId);\n      }\n    });\n\n    appImManager.addEventListener('peer_changed', (peerId) => {\n      // const perf = performance.now();\n      for(const element of this.lastActiveElements) {\n        if(element.dataset.peerId.toPeerId() !== peerId) {\n          this.setDialogActive(element, false);\n        }\n      }\n\n      const elements = Array.from(document.querySelectorAll(`[data-autonomous=\"0\"] .chatlist-chat[data-peer-id=\"${peerId}\"]`)) as HTMLElement[];\n      elements.forEach((element) => {\n        this.setDialogActive(element, true);\n      });\n      // this.log('peer_changed total time:', performance.now() - perf);\n    });\n\n    rootScope.addEventListener('filter_update', async(filter) => {\n      if(REAL_FOLDERS.has(filter.id)) {\n        return;\n      }\n\n      if(!this.filtersRendered[filter.id]) {\n        this.addFilter(filter);\n        return;\n      } else if(filter.id === this.filterId) { //     ,    dialogs_multiupdate\n        const dialogs = await this.managers.dialogsStorage.getCachedDialogs(true);\n        await this.validateListForFilter();\n        for(let i = 0, length = dialogs.length; i < length; ++i) {\n          const dialog = dialogs[i];\n          this.updateDialog(dialog);\n        }\n      }\n\n      const elements = this.filtersRendered[filter.id];\n      setInnerHTML(elements.title, wrapEmojiText(filter.title));\n    });\n\n    rootScope.addEventListener('filter_delete', (filter) => {\n      const elements = this.filtersRendered[filter.id];\n      if(!elements) return;\n\n      // set tab\n      // (this.folders.menu.firstElementChild.children[Math.max(0, filter.id - 2)] as HTMLElement).click();\n      elements.container.remove();\n      elements.menu.remove();\n\n      delete this.sortedLists[filter.id];\n      delete this.scrollables[filter.id];\n      delete this.filtersRendered[filter.id];\n\n      this.onFiltersLengthChange();\n\n      if(this.filterId === filter.id) {\n        this.selectTab(0, false);\n      }\n    });\n\n    rootScope.addEventListener('filter_order', async(order) => {\n      order = order.slice();\n      indexOfAndSplice(order, FOLDER_ID_ARCHIVE);\n\n      const containerToAppend = this.folders.menu as HTMLElement;\n      const r = await Promise.all(order.map(async(filterId) => {\n        return {\n          indexKey: await this.managers.dialogsStorage.getDialogIndexKeyByFilterId(filterId),\n          filter: await this.managers.filtersStorage.getFilter(filterId)\n        };\n      }));\n\n      order.forEach((filterId, idx) => {\n        const {indexKey, filter} = r[idx];\n        const renderedFilter = this.filtersRendered[filterId];\n\n        const sortedList = this.sortedLists[filterId];\n        sortedList.indexKey = indexKey;\n\n        positionElementByIndex(renderedFilter.menu, containerToAppend, filter.localId);\n        positionElementByIndex(renderedFilter.container, this.folders.container, filter.localId);\n      });\n\n      this.indexKey = await this.managers.dialogsStorage.getDialogIndexKeyByFilterId(this.filterId);\n\n      /* if(this.filterId) {\n        const tabIndex = order.indexOf(this.filterId) + 1;\n        selectTab.prevId = tabIndex;\n      } */\n    });\n\n    rootScope.addEventListener('peer_typings', async({peerId, typings}) => {\n      const dialog = await this.managers.appMessagesManager.getDialogOnly(peerId);\n      if(!dialog) return;\n\n      if(typings.length) {\n        this.setTyping(dialog);\n      } else {\n        this.unsetTyping(dialog);\n      }\n    });\n  }\n\n  private setDialogActive(listEl: HTMLElement, active: boolean) {\n    // @ts-ignore\n    const dom = listEl.dialogDom as DialogDom;\n    listEl.classList.toggle('active', active);\n    if(active) {\n      this.lastActiveElements.add(listEl);\n    } else {\n      this.lastActiveElements.delete(listEl);\n    }\n\n    if(dom?.callIcon) {\n      dom.callIcon.setActive(active);\n    }\n  }\n\n  private async onStateLoaded(state: State) {\n    const filtersArr = state.filtersArr;\n    const haveFilters = filtersArr.length > REAL_FOLDERS.size;\n    // const filter = filtersArr.find((filter) => filter.id !== FOLDER_ID_ARCHIVE);\n\n    const addFilters = (filters: MyDialogFilter[]) => {\n      for(const filter of filters) {\n        this.addFilter(filter);\n      }\n    };\n\n    let addFiltersPromise: Promise<any>;\n    if(haveFilters) {\n      addFilters(filtersArr);\n    } else {\n      addFiltersPromise = this.managers.filtersStorage.getDialogFilters().then(addFilters);\n    }\n\n    const loadDialogsPromise = this.onChatsScroll();\n    await loadDialogsPromise;\n    this.loadDialogsRenderPromise = undefined;\n\n    addFiltersPromise && await addFiltersPromise;\n    // this.folders.menu.children[0].classList.add('active');\n\n    this.filterId = -1;\n    this.selectTab(0, false);\n\n    if(!this.initedListeners) {\n      this.initListeners();\n      this.initedListeners = true;\n    }\n\n    haveFilters && this.showFiltersPromise && await this.showFiltersPromise;\n\n    this.managers.appNotificationsManager.getNotifyPeerTypeSettings();\n\n    await (await loadDialogsPromise).renderPromise.catch(noop);\n    this.managers.appMessagesManager.fillConversations();\n  }\n\n  /* private getOffset(side: 'top' | 'bottom'): {index: number, pos: number} {\n    if(!this.scroll.loadedAll[side]) {\n      const element = (side === 'top' ? this.chatList.firstElementChild : this.chatList.lastElementChild) as HTMLElement;\n      if(element) {\n        const peerId = element.dataset.peerId;\n        const dialog = this.managers.appMessagesManager.getDialogByPeerId(peerId);\n        return {index: dialog[0].index, pos: dialog[1]};\n      }\n    }\n\n    return {index: 0, pos: -1};\n  } */\n  private getOffsetIndex(side: 'top' | 'bottom') {\n    return {index: this.scroll.loadedAll[side] ? 0 : this.offsets[side]};\n  }\n\n  private isDialogMustBeInViewport(dialog: Dialog) {\n    if(dialog.migratedTo !== undefined || !this.testDialogForFilter(dialog)) return false;\n    // return true;\n    const topOffset = this.getOffsetIndex('top');\n    const bottomOffset = this.getOffsetIndex('bottom');\n\n    if(!topOffset.index && !bottomOffset.index) {\n      return true;\n    }\n\n    const index = getDialogIndex(dialog, this.indexKey);\n    return (!topOffset.index || index <= topOffset.index) && (!bottomOffset.index || index >= bottomOffset.index);\n  }\n\n  private deleteDialog(peerId: PeerId) {\n    this.sortedList.delete(peerId);\n  }\n\n  private updateDialog(dialog: Dialog) {\n    if(this.isDialogMustBeInViewport(dialog)) {\n      if(!this.sortedList.has(dialog.peerId)) {\n        this.sortedList.add(dialog.peerId);\n        return;\n      }\n    } else {\n      this.deleteDialog(dialog.peerId);\n      return;\n    }\n\n    const dom = this.getDialogDom(dialog.peerId);\n    if(dom) {\n      this.setLastMessageN({\n        dialog,\n        dom,\n        setUnread: true\n      });\n      this.sortedList.update(dialog.peerId);\n    }\n  }\n\n  public onTabChange = () => {\n    this.scroll = this.scrollables[this.filterId];\n    this.scroll.loadedAll.top = true;\n    this.scroll.loadedAll.bottom = false;\n    this.offsets.top = this.offsets.bottom = 0;\n    this.loadDialogsRenderPromise = undefined;\n    this.loadDialogsPromise = undefined;\n    this.sortedList = this.sortedLists[this.filterId];\n    return this.onChatsScroll();\n  };\n\n  private async setFilterUnreadCount(filterId: number) {\n    if(filterId === FOLDER_ID_ALL) {\n      return;\n    }\n\n    const unreadSpan = this.filtersRendered[filterId]?.unread;\n    if(!unreadSpan) {\n      return;\n    }\n\n    const {unreadUnmutedCount, unreadCount} = await this.managers.dialogsStorage.getFolderUnreadCount(filterId);\n    unreadSpan.classList.toggle('badge-gray', !unreadUnmutedCount);\n    unreadSpan.innerText = unreadCount ? '' + unreadCount : '';\n  }\n\n  private setFiltersUnreadCount() {\n    for(const filterId in this.filtersRendered) {\n      this.setFilterUnreadCount(+filterId);\n    }\n  }\n\n  /**\n   *     ,    (!)\n   */\n  private async validateListForFilter() {\n    this.sortedList.getAll().forEach(async(element) => {\n      const dialog = await this.managers.appMessagesManager.getDialogOnly(element.id);\n      if(!this.testDialogForFilter(dialog)) {\n        this.deleteDialog(element.id);\n      }\n    });\n  }\n\n  /**\n   *     ,    (!)\n   */\n  private validateDialogForFilter(dialog: Dialog) {\n    if(!this.getDialogDom(dialog.peerId)) {\n      return;\n    }\n\n    if(!this.testDialogForFilter(dialog)) {\n      this.deleteDialog(dialog.peerId);\n    }\n  }\n\n  public testDialogForFilter(dialog: Dialog) {\n    if(\n      !dialog ||\n      (!REAL_FOLDERS.has(this.filterId) ? getDialogIndex(dialog, this.indexKey) === undefined : this.filterId !== dialog.folder_id)\n      // (filter && !(await this.managers.filtersStorage.testDialogForFilter(dialog, filter)))\n    ) {\n      return false;\n    }\n\n    return true;\n  }\n\n  public generateScrollable(list: HTMLUListElement, filter: Parameters<AppDialogsManager['addFilter']>[0]) {\n    const filterId = filter.id;\n    const scrollable = new Scrollable(null, 'CL', 500);\n    scrollable.container.addEventListener('scroll', this.onChatsRegularScroll);\n    scrollable.container.dataset.filterId = '' + filterId;\n    scrollable.onScrolledTop = this.onChatsScrollTop;\n    scrollable.onScrolledBottom = this.onChatsScroll;\n    scrollable.setVirtualContainer(list);\n\n    const sortedDialogList = new SortedDialogList(\n      this.managers,\n      list,\n      getDialogIndexKey(filter.localId),\n      this.onListLengthChange\n    );\n\n    this.scrollables[filterId] = scrollable;\n    this.sortedLists[filterId] = sortedDialogList;\n\n    // list.classList.add('hide');\n    // scrollable.container.style.backgroundColor = '#' + (Math.random() * (16 ** 6 - 1) | 0).toString(16);\n\n    return scrollable;\n  }\n\n  private addFilter(filter: Pick<DialogFilter, 'title' | 'id' | 'localId'>) {\n    if(filter.id === FOLDER_ID_ARCHIVE) {\n      return;\n    }\n\n    const containerToAppend = this.folders.menu as HTMLElement;\n    const renderedFilter = this.filtersRendered[filter.id];\n    if(renderedFilter) {\n      positionElementByIndex(renderedFilter.menu, containerToAppend, filter.localId);\n      positionElementByIndex(renderedFilter.container, this.folders.container, filter.localId);\n      return;\n    }\n\n    const menuTab = document.createElement('div');\n    menuTab.classList.add('menu-horizontal-div-item');\n    const span = document.createElement('span');\n    const titleSpan = document.createElement('span');\n    titleSpan.classList.add('text-super');\n    if(filter.id === FOLDER_ID_ALL) titleSpan.append(this.allChatsIntlElement.element);\n    else setInnerHTML(titleSpan, wrapEmojiText(filter.title));\n    const unreadSpan = document.createElement('div');\n    unreadSpan.classList.add('badge', 'badge-20', 'badge-primary');\n    const i = document.createElement('i');\n    span.append(titleSpan, unreadSpan, i);\n    ripple(menuTab);\n    menuTab.append(span);\n\n    menuTab.dataset.filterId = '' + filter.id;\n\n    positionElementByIndex(menuTab, containerToAppend, filter.localId);\n    // containerToAppend.append(li);\n\n    const ul = this.createChatList();\n    const scrollable = this.generateScrollable(ul, filter);\n\n    scrollable.container.classList.add('tabs-tab', 'chatlist-parts');\n\n    /* const parts = document.createElement('div');\n    parts.classList.add('chatlist-parts'); */\n\n    const top = document.createElement('div');\n    top.classList.add('chatlist-top');\n\n    const bottom = document.createElement('div');\n    bottom.classList.add('chatlist-bottom');\n\n    top.append(ul);\n    scrollable.container.append(top, bottom);\n    /* parts.append(top, bottom);\n    scrollable.container.append(parts); */\n\n    const div = scrollable.container;\n    // this.folders.container.append(div);\n    positionElementByIndex(scrollable.container, this.folders.container, filter.localId);\n\n    this.setListClickListener(ul, null, true);\n\n    this.filtersRendered[filter.id] = {\n      menu: menuTab,\n      container: div,\n      unread: unreadSpan,\n      title: titleSpan\n    };\n\n    this.onFiltersLengthChange();\n  }\n\n  private changeFiltersAllChatsKey() {\n    const scrollable = this.folders.menuScrollContainer.firstElementChild;\n    const key: LangPackKey = scrollable.scrollWidth > scrollable.clientWidth ? 'FilterAllChatsShort' : 'FilterAllChats';\n    this.allChatsIntlElement.compareAndUpdate({key});\n  }\n\n  private onFiltersLengthChange() {\n    if(!this.showFiltersPromise) {\n      this.showFiltersPromise = new Promise<void>((resolve) => {\n        window.setTimeout(() => {\n          const length = Object.keys(this.filtersRendered).length;\n          const show = length > 1;\n          const wasShowing = !this.folders.menuScrollContainer.classList.contains('hide');\n\n          if(show !== wasShowing) {\n            this.folders.menuScrollContainer.classList.toggle('hide', !show);\n            if(show && !wasShowing) {\n              this.setFiltersUnreadCount();\n            }\n\n            this.chatsContainer.classList.toggle('has-filters', show);\n          }\n\n          this.changeFiltersAllChatsKey();\n\n          this.showFiltersPromise = undefined;\n          resolve();\n        }, 0);\n      });\n    }\n\n    return this.showFiltersPromise;\n  }\n\n  private loadDialogs(side: SliceSides) {\n    /* if(testScroll) {\n      return;\n    } */\n\n    this.log.warn('load', side);\n\n    if(this.loadDialogsPromise || this.loadDialogsRenderPromise/*  || 1 === 1 */) return this.loadDialogsPromise;\n    else if(this.scroll.loadedAll[side]) {\n      return Promise.resolve({\n        cached: true,\n        renderPromise: Promise.resolve()\n      });\n    }\n\n    const cachedInfoPromise = deferredPromise<boolean>();\n    const renderPromise = new Promise<void>(async(resolve, reject) => {\n      const {chatList, filterId, indexKey} = this;\n\n      // return;\n\n      // let loadCount = 30/*this.chatsLoadCount */;\n      let loadCount = windowSize.height / 72 * 1.25 | 0;\n      let offsetIndex = 0;\n\n      const {index: currentOffsetIndex} = this.getOffsetIndex(side);\n      if(currentOffsetIndex) {\n        if(side === 'top') {\n          const storage = await this.managers.dialogsStorage.getFolderDialogs(filterId, true);\n          const index = storage.findIndex((dialog) => getDialogIndex(dialog, indexKey) <= currentOffsetIndex);\n          const needIndex = Math.max(0, index - loadCount);\n          loadCount = index - needIndex;\n          offsetIndex = getDialogIndex(storage[needIndex], indexKey) + 1;\n        } else {\n          offsetIndex = currentOffsetIndex;\n        }\n      }\n\n      // let offset = storage[storage.length - 1]?.index || 0;\n\n      let placeholder = this.placeholders[filterId];\n      try {\n        const getConversationsResult = this.managers.acknowledged.appMessagesManager.getConversations('', offsetIndex, loadCount, filterId, true);\n        if(\n          !chatList.childElementCount &&\n          !placeholder &&\n          (\n            !this.loadedDialogsAtLeastOnce ||\n            !(await getConversationsResult).cached\n          )\n        ) {\n          placeholder = this.placeholders[filterId] = new DialogsPlaceholder();\n          const getRectFrom = filterId === FOLDER_ID_ARCHIVE ? this.chatsContainer : this.folders.container;\n          placeholder.attach({\n            container: chatList.parentElement,\n            getRectFrom,\n            onRemove: () => {\n              delete this.placeholders[filterId];\n            },\n            blockScrollable: this.scroll\n          });\n\n          cachedInfoPromise.resolve(false);\n        }\n\n        const a = await getConversationsResult;\n        const result = await a.result;\n        if(this.loadDialogsRenderPromise !== renderPromise) {\n          reject();\n          cachedInfoPromise.reject();\n          return;\n        }\n\n        cachedInfoPromise.resolve(a.cached);\n\n        // console.timeEnd('getDialogs time');\n\n        // * loaded all\n        // if(!result.dialogs.length || chatList.childElementCount === result.count) {\n        // !result.dialogs.length  ,      getConversations   .\n        // if(chatList.childElementCount === result.count) {\n        if(side === 'bottom') {\n          if(result.isEnd) {\n            this.scroll.loadedAll[side] = true;\n          }\n        } else if(result.isTopEnd) {\n          this.scroll.loadedAll[side] = true;\n        }\n\n        this.loadedDialogsAtLeastOnce = true;\n\n        if(result.dialogs.length) {\n          const dialogs = side === 'top' ? result.dialogs.slice().reverse() : result.dialogs;\n\n          const loadPromises: Promise<any>[] = [];\n\n          const callbacks: (() => void)[] = [];\n          const cccc = (callback: () => void) => {\n            callbacks.push(callback);\n          };\n\n          dialogs.forEach((dialog) => {\n            // :(\n            // const isBuggedDialog = !this.managers.appMessagesManager.getDialogOnly(dialog.peerId);\n            // if(isBuggedDialog) {\n            //   return;\n            // }\n\n            const element = this.sortedList.add(dialog.peerId, true, /* undefined, false,  */cccc, false);\n            if(element.loadPromises) {\n              loadPromises.push(...element.loadPromises);\n            }\n          });\n\n          loadPromises.push(fastRafPromise()); // it is needed here\n          await Promise.all(loadPromises).finally();\n          if(this.loadDialogsRenderPromise !== renderPromise) {\n            reject();\n            cachedInfoPromise.reject();\n            return;\n          }\n\n          callbacks.forEach((callback) => callback());\n        } else {\n          this.onListLengthChange();\n        }\n\n        const offsetDialog = result.dialogs[side === 'top' ? 0 : result.dialogs.length - 1];\n        if(offsetDialog) {\n          this.offsets[side] = getDialogIndex(offsetDialog, indexKey);\n        }\n\n        this.log.debug('getDialogs ' + loadCount + ' dialogs by offset:', offsetIndex, result, chatList.childElementCount);\n\n        setTimeout(() => {\n          this.scroll.onScroll();\n        }, 0);\n      } catch(err) {\n        this.log.error(err);\n      }\n\n      if(placeholder) {\n        // await pause(500);\n        placeholder.detach(chatList.childElementCount);\n      }\n\n      resolve();\n    }).finally(() => {\n      if(this.loadDialogsRenderPromise === renderPromise) {\n        this.loadDialogsRenderPromise = undefined;\n        this.loadDialogsPromise = undefined;\n      }\n    });\n\n    this.loadDialogsRenderPromise = renderPromise;\n    return this.loadDialogsPromise = cachedInfoPromise.then((cached) => ({\n      cached,\n      renderPromise\n    }));\n  }\n\n  private generateEmptyPlaceholder(options: {\n    title: LangPackKey,\n    subtitle?: LangPackKey,\n    subtitleArgs?: FormatterArguments,\n    classNameType: string\n  }) {\n    const BASE_CLASS = 'empty-placeholder';\n    const container = document.createElement('div');\n    container.classList.add(BASE_CLASS, BASE_CLASS + '-' + options.classNameType);\n\n    const header = document.createElement('div');\n    header.classList.add(BASE_CLASS + '-header');\n    _i18n(header, options.title);\n\n    const subtitle = document.createElement('div');\n    subtitle.classList.add(BASE_CLASS + '-subtitle');\n    if(options.subtitle) {\n      _i18n(subtitle, options.subtitle, options.subtitleArgs);\n    }\n\n    container.append(header, subtitle);\n\n    return {container, header, subtitle};\n  }\n\n  private checkIfPlaceholderNeeded() {\n    if(this.filterId === FOLDER_ID_ARCHIVE) {\n      return;\n    }\n\n    const chatList = this.chatList;\n    const part = chatList.parentElement as HTMLElement;\n    let placeholderContainer = (Array.from(part.children) as HTMLElement[]).find((el) => el.matches('.empty-placeholder'));\n    const needPlaceholder = this.scroll.loadedAll.bottom && !chatList.childElementCount/*  || true */;\n    // chatList.style.display = 'none';\n\n    if(needPlaceholder && placeholderContainer) {\n      return;\n    } else if(!needPlaceholder) {\n      if(placeholderContainer) {\n        part.classList.remove('with-placeholder');\n        placeholderContainer.remove();\n      }\n\n      return;\n    }\n\n    let placeholder: ReturnType<AppDialogsManager['generateEmptyPlaceholder']>, type: 'dialogs' | 'folder';\n    if(!this.filterId) {\n      placeholder = this.generateEmptyPlaceholder({\n        title: 'ChatList.Main.EmptyPlaceholder.Title',\n        classNameType: type = 'dialogs'\n      });\n\n      placeholderContainer = placeholder.container;\n\n      const img = document.createElement('img');\n      img.classList.add('empty-placeholder-dialogs-icon');\n\n      this.emptyDialogsPlaceholderSubtitle = new I18n.IntlElement({\n        element: placeholder.subtitle\n      });\n\n      Promise.all([\n        this.updateContactsLength(false),\n        renderImageFromUrlPromise(img, 'assets/img/EmptyChats.svg'),\n        fastRafPromise()\n      ]).then(([usersLength]) => {\n        placeholderContainer.classList.add('visible');\n        part.classList.toggle('has-contacts', !!usersLength);\n      });\n\n      placeholderContainer.prepend(img);\n    } else {\n      placeholder = this.generateEmptyPlaceholder({\n        title: 'FilterNoChatsToDisplay',\n        subtitle: 'FilterNoChatsToDisplayInfo',\n        classNameType: type = 'folder'\n      });\n\n      placeholderContainer = placeholder.container;\n\n      const div = document.createElement('div');\n      const emoji = '';\n      const size = 128;\n      wrapStickerEmoji({\n        div,\n        emoji: emoji,\n        width: size,\n        height: size\n      });\n\n      placeholderContainer.prepend(div);\n\n      const button = Button('btn-primary btn-color-primary btn-control tgico', {\n        text: 'FilterHeaderEdit',\n        icon: 'settings'\n      });\n\n      attachClickEvent(button, async() => {\n        appSidebarLeft.createTab(AppEditFolderTab).open(await this.managers.filtersStorage.getFilter(this.filterId));\n      });\n\n      placeholderContainer.append(button);\n    }\n\n    part.append(placeholderContainer);\n    part.classList.add('with-placeholder');\n    part.dataset.placeholderType = type;\n  }\n\n  private updateContactsLength(updatePartClassName: boolean) {\n    if(this.updateContactsLengthPromise) return this.updateContactsLengthPromise;\n    return this.updateContactsLengthPromise = this.managers.appUsersManager.getContacts().then((users) => {\n      const subtitle = this.emptyDialogsPlaceholderSubtitle;\n      if(subtitle) {\n        let key: LangPackKey, args: FormatterArguments;\n\n        if(users.length/*  && false */) {\n          key = 'ChatList.Main.EmptyPlaceholder.Subtitle';\n          args = [i18n('Contacts.Count', [users.length])];\n        } else {\n          key = 'ChatList.Main.EmptyPlaceholder.SubtitleNoContacts';\n          args = [];\n        }\n\n        subtitle.compareAndUpdate({\n          key,\n          args\n        });\n      }\n\n      if(updatePartClassName) {\n        const chatList = this.chatList;\n        const part = chatList.parentElement as HTMLElement;\n        part.classList.toggle('has-contacts', !!users.length);\n      }\n\n      this.updateContactsLengthPromise = undefined;\n\n      return users.length;\n    });\n  }\n\n  private removeContactsPlaceholder() {\n    const chatList = this.chatList;\n    const parts = chatList.parentElement.parentElement;\n    const bottom = chatList.parentElement.nextElementSibling as HTMLElement;\n    parts.classList.remove('with-contacts');\n    bottom.innerHTML = '';\n    this.loadContacts = undefined;\n    this.processContact = undefined;\n  }\n\n  private _onListLengthChange = () => {\n    if(!this.loadedDialogsAtLeastOnce) {\n      return;\n    }\n\n    this.checkIfPlaceholderNeeded();\n\n    if(this.filterId !== FOLDER_ID_ALL) return;\n\n    const chatList = this.chatList;\n    const count = chatList.childElementCount;\n\n    const parts = chatList.parentElement.parentElement;\n    const bottom = chatList.parentElement.nextElementSibling as HTMLElement;\n    const hasContacts = !!bottom.childElementCount;\n    if(count >= 10) {\n      if(hasContacts) {\n        this.removeContactsPlaceholder();\n      }\n\n      return;\n    } else if(hasContacts) return;\n\n    parts.classList.add('with-contacts');\n\n    const section = new SettingSection({\n      name: 'Contacts',\n      noDelimiter: true,\n      fakeGradientDelimiter: true\n    });\n\n    section.container.classList.add('hide');\n\n    this.managers.appUsersManager.getContactsPeerIds(undefined, undefined, 'online').then((contacts) => {\n      let ready = false;\n      const onListLengthChange = () => {\n        if(ready) {\n          section.container.classList.toggle('hide', !sortedUserList.list.childElementCount);\n        }\n\n        this.updateContactsLength(true);\n      };\n\n      const sortedUserList = new SortedUserList({\n        avatarSize: 42,\n        createChatListOptions: {\n          dialogSize: 48,\n          new: true\n        },\n        autonomous: false,\n        onListLengthChange,\n        managers: this.managers\n      });\n\n      this.loadContacts = () => {\n        const pageCount = windowSize.height / 60 | 0;\n        const promise = filterAsync(contacts.splice(0, pageCount), this.verifyPeerIdForContacts);\n\n        promise.then((arr) => {\n          arr.forEach((peerId) => {\n            sortedUserList.add(peerId);\n          });\n        });\n\n        if(!contacts.length) {\n          this.loadContacts = undefined;\n        }\n      };\n\n      this.loadContacts();\n\n      this.processContact = async(peerId) => {\n        if(peerId.isAnyChat()) {\n          return;\n        }\n\n        const good = await this.verifyPeerIdForContacts(peerId);\n        const added = sortedUserList.has(peerId);\n        if(!added && good) sortedUserList.add(peerId);\n        else if(added && !good) sortedUserList.delete(peerId);\n      };\n\n      const list = sortedUserList.list;\n      list.classList.add('chatlist-new');\n      this.setListClickListener(list);\n      section.content.append(list);\n\n      ready = true;\n      onListLengthChange();\n    });\n\n    bottom.append(section.container);\n  };\n\n  private verifyPeerIdForContacts = async(peerId: PeerId) => {\n    return await this.managers.appPeersManager.isContact(peerId) && !(await this.managers.appMessagesManager.getDialogOnly(peerId));\n  };\n\n  public onChatsRegularScroll = () => {\n    // return;\n\n    if(this.sliceTimeout) clearTimeout(this.sliceTimeout);\n    this.sliceTimeout = window.setTimeout(() => {\n      this.sliceTimeout = undefined;\n\n      if(!this.chatList.childElementCount || this.processContact) {\n        return;\n      }\n\n      /* const observer = new IntersectionObserver((entries) => {\n        const\n      });\n\n      Array.from(this.chatList.children).forEach((el) => {\n        observer.observe(el);\n      }); */\n\n      fastRafConventional(() => {\n        const perf = performance.now();\n\n        const scrollTopWas = this.scroll.scrollTop;\n\n        const firstElementChild = this.chatList.firstElementChild;\n        const rectContainer = this.scroll.container.getBoundingClientRect();\n        const rectTarget = firstElementChild.getBoundingClientRect();\n        const children = Array.from(this.scroll.splitUp.children) as HTMLElement[];\n\n        // const padding = 8;\n        // const offsetTop = this.folders.container.offsetTop;\n        let offsetTop = this.scroll.splitUp.offsetTop;\n        if(offsetTop && scrollTopWas < offsetTop) offsetTop -= scrollTopWas;\n        // const offsetTop = scrollTopWas < padding ? padding - scrollTopWas : 0;\n        const firstY = rectContainer.y + offsetTop;\n        const lastY = rectContainer.y/*  - 8 */; // 8px - .chatlist padding-bottom\n\n        const firstElement = findUpTag(document.elementFromPoint(Math.ceil(rectTarget.x), Math.ceil(firstY + 1)), firstElementChild.tagName) as HTMLElement;\n        const lastElement = findUpTag(document.elementFromPoint(Math.ceil(rectTarget.x), Math.floor(lastY + rectContainer.height - 1)), firstElementChild.tagName) as HTMLElement;\n\n        // alert('got element:' + rect.y);\n\n        if(!firstElement || !lastElement) {\n          return;\n        }\n\n        // alert('got element:' + !!firstElement);\n\n        const firstElementRect = firstElement.getBoundingClientRect();\n        const elementOverflow = firstElementRect.y - firstY;\n\n        const sliced: HTMLElement[] = [];\n        const firstIndex = children.indexOf(firstElement);\n        const lastIndex = children.indexOf(lastElement);\n\n        const saveLength = 10;\n\n        const sliceFromStart = IS_SAFARI ? [] : children.slice(0, Math.max(0, firstIndex - saveLength));\n        const sliceFromEnd = children.slice(lastIndex + saveLength);\n\n        /* if(sliceFromStart.length !== sliceFromEnd.length) {\n        console.log('not equal', sliceFromStart.length, sliceFromEnd.length);\n      }\n\n      if(sliceFromStart.length > sliceFromEnd.length) {\n        const diff = sliceFromStart.length - sliceFromEnd.length;\n        sliceFromStart.splice(0, diff);\n      } else if(sliceFromEnd.length > sliceFromStart.length) {\n        const diff = sliceFromEnd.length - sliceFromStart.length;\n        sliceFromEnd.splice(sliceFromEnd.length - diff, diff);\n      } */\n\n        if(sliceFromStart.length) {\n          this.scroll.loadedAll.top = false;\n        }\n\n        if(sliceFromEnd.length) {\n          this.scroll.loadedAll.bottom = false;\n        }\n\n        sliced.push(...sliceFromStart);\n        sliced.push(...sliceFromEnd);\n\n        sliced.forEach((el) => {\n          const peerId = el.dataset.peerId.toPeerId();\n          this.deleteDialog(peerId);\n        });\n\n        this.setOffsets();\n\n        // this.log('[slicer] elements', firstElement, lastElement, rect, sliced, sliceFromStart.length, sliceFromEnd.length);\n\n        // this.log('[slicer] reset scrollTop', this.scroll.scrollTop, firstElement.offsetTop, firstElementRect.y, rect.y, elementOverflow);\n\n        // alert('left length:' + children.length);\n\n        this.scroll.scrollTop = firstElement.offsetTop - elementOverflow;\n\n        this.log('slice time', performance.now() - perf);\n        /* const firstElementRect = firstElement.getBoundingClientRect();\n      const scrollTop =  */\n\n      // this.scroll.scrollIntoView(firstElement, false);\n      });\n    }, 200);\n  };\n\n  private async setOffsets() {\n    const chatList = this.chatList;\n    const firstDialog = await this.getDialogFromElement(chatList.firstElementChild as HTMLElement);\n    const lastDialog = await this.getDialogFromElement(chatList.lastElementChild as HTMLElement);\n\n    const indexKey = this.indexKey;\n    this.offsets.top = getDialogIndex(firstDialog, indexKey);\n    this.offsets.bottom = getDialogIndex(lastDialog, indexKey);\n  }\n\n  private getDialogFromElement(element: HTMLElement) {\n    return this.managers.appMessagesManager.getDialogOnly(element.dataset.peerId.toPeerId());\n  }\n\n  public onChatsScrollTop = () => {\n    return this.onChatsScroll('top');\n  };\n\n  public onChatsScroll = (side: SliceSides = 'bottom') => {\n    if(this.scroll.loadedAll[side]) {\n      if(this.loadContacts) {\n        this.loadContacts();\n      }\n    }\n\n    this.log('onChatsScroll', side);\n    return this.loadDialogs(side);\n  };\n\n  public setListClickListener(list: HTMLUListElement, onFound?: () => void, withContext = false, autonomous = false, openInner = false) {\n    let lastActiveListElement: HTMLElement;\n\n    const setPeerFunc = (openInner ? appImManager.setInnerPeer : appImManager.setPeer).bind(appImManager);\n\n    list.dataset.autonomous = '' + +autonomous;\n    list.addEventListener('mousedown', (e) => {\n      if(e.button !== 0) return;\n\n      this.log('dialogs click list');\n      const target = e.target as HTMLElement;\n      const elem = findUpTag(target, DIALOG_LIST_ELEMENT_TAG);\n\n      if(!elem) {\n        return;\n      }\n\n      const peerId = elem.dataset.peerId.toPeerId();\n\n      if(e.ctrlKey || e.metaKey) {\n        window.open((elem as HTMLAnchorElement).href || ('#' + peerId), '_blank');\n        cancelEvent(e);\n        return;\n      }\n\n      if(autonomous) {\n        const sameElement = lastActiveListElement === elem;\n        if(lastActiveListElement && !sameElement) {\n          lastActiveListElement.classList.remove('active');\n        }\n\n        if(elem) {\n          elem.classList.add('active');\n          lastActiveListElement = elem;\n          this.lastActiveElements.add(elem);\n        }\n      }\n\n      if(elem) {\n        if(onFound) onFound();\n\n        const lastMsgId = +elem.dataset.mid || undefined;\n\n        setPeerFunc({\n          peerId, lastMsgId\n        });\n      } else {\n        setPeerFunc();\n      }\n    }, {capture: true});\n\n    // cancel link click\n    // ! do not change it to attachClickEvent\n    list.addEventListener('click', (e) => {\n      if(e.button === 0) {\n        cancelEvent(e);\n      }\n    }, {capture: true});\n\n    if(DEBUG) {\n      list.addEventListener('dblclick', (e) => {\n        const li = findUpTag(e.target, DIALOG_LIST_ELEMENT_TAG);\n        if(li) {\n          const peerId = li.dataset.peerId.toPeerId();\n          this.log('debug dialog:', this.managers.appMessagesManager.getDialogByPeerId(peerId));\n        }\n      });\n    }\n\n    if(withContext) {\n      attachContextMenuListener(list, this.contextMenu.onContextMenu);\n    }\n  }\n\n  public createChatList(options: {\n    // avatarSize?: number,\n    // handheldsSize?: number,\n    // size?: number,\n    new?: boolean,\n    dialogSize?: number,\n    ignoreClick?: boolean\n  } = {}) {\n    const list = document.createElement('ul');\n    list.classList.add('chatlist'/* ,\n      'chatlist-avatar-' + (options.avatarSize || 54) *//* , 'chatlist-' + (options.size || 72) */);\n\n    if(options.new) {\n      list.classList.add('chatlist-new');\n    }\n\n    if(options.dialogSize) {\n      list.classList.add('chatlist-' + options.dialogSize);\n    }\n\n    // if(options.ignoreClick) {\n    //   list.classList.add('disable-hover');\n    // }\n\n    /* if(options.handheldsSize) {\n      list.classList.add('chatlist-handhelds-' + options.handheldsSize);\n    } */\n\n    return list;\n  }\n\n  public setLastMessageN(options: {\n    dialog: Dialog,\n    lastMessage?: Message.message | Message.messageService,\n    dom?: DialogDom,\n    highlightWord?: string,\n    isBatch?: boolean,\n    setUnread?: boolean\n  }) {\n    const promise = this.setLastMessage(options.dialog, options.lastMessage, options.dom, options.highlightWord, options.isBatch, options.setUnread);\n    return promise.catch(noop);\n  }\n\n  private async setLastMessage(\n    dialog: Dialog,\n    lastMessage: Message.message | Message.messageService,\n    dom: DialogDom,\n    highlightWord?: string,\n    isBatch = false,\n    setUnread = false\n  ) {\n    if(!dom) {\n      dom = this.getDialogDom(dialog.peerId);\n\n      if(!dom) {\n        return;\n      }\n    }\n\n    const {deferred: promise, middleware} = setPromiseMiddleware(dom, 'setLastMessagePromise');\n\n    let draftMessage: MyDraftMessage;\n    if(!lastMessage) {\n      if(dialog.draft?._ === 'draftMessage') {\n        draftMessage = dialog.draft;\n      }\n\n      lastMessage = dialog.topMessage;\n      if(!lastMessage || lastMessage.mid !== dialog.top_message) {\n        const promise = this.managers.appMessagesManager.getMessageByPeer(dialog.peerId, dialog.top_message);\n        lastMessage = await middleware(promise);\n      }\n    }\n\n    if(setUnread) {\n      this.setUnreadMessagesN({dialog, dom, isBatch, setLastMessagePromise: promise});\n    }\n\n    if(!lastMessage/*  || (lastMessage._ === 'messageService' && !lastMessage.rReply) */) {\n      dom.lastMessageSpan.textContent = '';\n      dom.lastTimeSpan.textContent = '';\n      delete dom.listEl.dataset.mid;\n\n      promise.resolve();\n      return;\n    }\n\n    const peerId = dialog.peerId;\n    const isRestricted = lastMessage && isMessageRestricted(lastMessage as Message.message);\n\n    /* if(!dom.lastMessageSpan.classList.contains('user-typing')) */ {\n      let mediaContainer: HTMLElement;\n      const willPrepend: (Promise<any> | HTMLElement)[] = [];\n      if(lastMessage && !draftMessage && !isRestricted) {\n        const media: MyDocument | MyPhoto = getMediaFromMessage(lastMessage);\n        const videoTypes: Set<MyDocument['type']> = new Set(['video', 'gif', 'round']);\n        if(media && (media._ === 'photo' || videoTypes.has(media.type))) {\n          const size = choosePhotoSize(media, 20, 20);\n\n          if(size._ !== 'photoSizeEmpty') {\n            mediaContainer = document.createElement('div');\n            mediaContainer.classList.add('dialog-subtitle-media');\n\n            if((media as MyDocument).type === 'round') {\n              mediaContainer.classList.add('is-round');\n            }\n\n            willPrepend.push(wrapPhoto({\n              photo: media,\n              message: lastMessage,\n              container: mediaContainer,\n              withoutPreloader: true,\n              size\n            }).then(() => mediaContainer));\n\n            if(videoTypes.has((media as MyDocument).type)) {\n              const playIcon = document.createElement('span');\n              playIcon.classList.add('tgico-play');\n\n              mediaContainer.append(playIcon);\n            }\n          }\n        }\n      }\n\n      /* if(lastMessage.from_id === auth.id) { // You:  */\n      if(draftMessage) {\n        const bold = document.createElement('b');\n        bold.classList.add('danger');\n        bold.append(i18n('Draft'), ': ');\n        willPrepend.unshift(bold);\n      } else if(peerId.isAnyChat() && peerId !== lastMessage.fromId && !(lastMessage as Message.messageService).action) {\n        const senderBold = document.createElement('b');\n\n        if(lastMessage.fromId === rootScope.myId) {\n          senderBold.append(i18n('FromYou'));\n          willPrepend.unshift(senderBold);\n        } else {\n          // str = sender.first_name || sender.last_name || sender.username;\n          const p = middleware(wrapPeerTitle({\n            peerId: lastMessage.fromId,\n            onlyFirstName: true\n          })).then((element) => {\n            senderBold.prepend(element);\n            return senderBold;\n          }, noop);\n\n          willPrepend.unshift(p);\n        }\n\n        senderBold.append(': ');\n        // console.log(sender, senderBold.innerText);\n      }\n\n      const withoutMediaType = !!mediaContainer && !!(lastMessage as Message.message)?.message;\n\n      let fragment: DocumentFragment;\n      if(highlightWord && (lastMessage as Message.message).message) {\n        fragment = await middleware(wrapMessageForReply(lastMessage, undefined, undefined, false, highlightWord, withoutMediaType));\n      } else if(draftMessage) {\n        fragment = await middleware(wrapMessageForReply(draftMessage));\n      } else if(lastMessage) {\n        fragment = await middleware(wrapMessageForReply(lastMessage, undefined, undefined, false, undefined, withoutMediaType));\n      } else { // rare case\n        fragment = document.createDocumentFragment();\n      }\n\n      if(willPrepend.length) {\n        const elements = await middleware(Promise.all(willPrepend));\n        fragment.prepend(...elements);\n      }\n\n      replaceContent(dom.lastMessageSpan, fragment);\n    }\n\n    if(lastMessage || draftMessage/*  && lastMessage._ !== 'draftMessage' */) {\n      const date = draftMessage ? Math.max(draftMessage.date, lastMessage.date || 0) : lastMessage.date;\n      replaceContent(dom.lastTimeSpan, formatDateAccordingToTodayNew(new Date(date * 1000)));\n    } else dom.lastTimeSpan.textContent = '';\n\n    if(setUnread !== null && !setUnread) { // means search\n      dom.listEl.dataset.mid = '' + lastMessage.mid;\n    }\n\n    promise.resolve();\n  }\n\n  private setUnreadMessagesN(options: {\n    dialog: Dialog,\n    dom?: DialogDom,\n    isBatch?: boolean,\n    setLastMessagePromise?: Promise<void>\n  }) {\n    return this.setUnreadMessages(options.dialog, options.dom, options.isBatch, options.setLastMessagePromise).catch(() => {});\n  }\n\n  private async setUnreadMessages(\n    dialog: Dialog,\n    dom = this.getDialogDom(dialog.peerId),\n    isBatch = false,\n    setLastMessagePromise?: Promise<void>\n  ) {\n    if(!dom) {\n      // this.log.error('setUnreadMessages no dom!', dialog);\n      return;\n    }\n\n    const {deferred, middleware} = setPromiseMiddleware(dom, 'setUnreadMessagePromise');\n\n    const isMuted = await middleware(this.managers.appNotificationsManager.isPeerLocalMuted(dialog.peerId, true));\n    const wasMuted = dom.listEl.classList.contains('is-muted');\n\n    let setStatusMessage: MyMessage;\n    if(dialog.draft?._ !== 'draftMessage') {\n      const lastMessage: MyMessage = await middleware(this.managers.appMessagesManager.getMessageByPeer(dialog.peerId, dialog.top_message));\n      if(lastMessage && lastMessage.pFlags.out && lastMessage.peerId !== rootScope.myId) {\n        setStatusMessage = lastMessage;\n      }\n    }\n\n    const filter = await middleware(this.managers.filtersStorage.getFilter(this.filterId));\n    let isPinned: boolean;\n    if(filter) {\n      isPinned = filter.pinnedPeerIds.indexOf(dialog.peerId) !== -1;\n    } else {\n      isPinned = !!dialog.pFlags.pinned;\n    }\n\n    const isDialogUnread = await middleware(this.managers.appMessagesManager.isDialogUnread(dialog));\n    const hasUnreadBadge = isPinned || isDialogUnread;\n    // dom.messageEl.classList.toggle('has-badge', hasBadge);\n\n    // * have to await all promises before modifying something\n\n    if(setLastMessagePromise) {\n      try {\n        await middleware(setLastMessagePromise);\n      } catch(err) {\n        // return;\n      }\n    }\n\n    const transitionDuration = isBatch ? 0 : 200;\n\n    if(isMuted !== wasMuted) {\n      SetTransition(dom.listEl, 'is-muted', isMuted, transitionDuration);\n    }\n\n    setSendingStatus(dom.statusSpan, setStatusMessage, true);\n\n    const isUnreadBadgeMounted = isInDOM(dom.unreadBadge);\n    if(hasUnreadBadge && !isUnreadBadgeMounted) {\n      dom.subtitleEl.append(dom.unreadBadge);\n    }\n\n    const hasMentionsBadge = dialog.unread_mentions_count && (dialog.unread_mentions_count > 1 || dialog.unread_count > 1);\n    const isMentionBadgeMounted = dom.mentionsBadge && isInDOM(dom.mentionsBadge);\n    if(hasMentionsBadge) {\n      if(!dom.mentionsBadge) {\n        dom.mentionsBadge = document.createElement('div');\n        dom.mentionsBadge.className = 'dialog-subtitle-badge badge badge-24 mention mention-badge';\n        dom.mentionsBadge.innerText = '@';\n        dom.subtitleEl.insertBefore(dom.mentionsBadge, dom.lastMessageSpan.nextSibling);\n      }\n    }\n\n    SetTransition(dom.unreadBadge, 'is-visible', hasUnreadBadge, transitionDuration, hasUnreadBadge ? undefined : () => {\n      dom.unreadBadge.remove();\n    }, !isUnreadBadgeMounted ? 2 : 0);\n\n    if(dom.mentionsBadge) {\n      SetTransition(dom.mentionsBadge, 'is-visible', hasMentionsBadge, transitionDuration, hasMentionsBadge ? undefined : () => {\n        dom.mentionsBadge.remove();\n        delete dom.mentionsBadge;\n      }, !isMentionBadgeMounted ? 2 : 0);\n    }\n\n    if(!hasUnreadBadge) {\n      deferred.resolve();\n      return;\n    }\n\n    if(isPinned) {\n      dom.unreadBadge.classList.add('tgico-chatspinned', 'tgico');\n    } else {\n      dom.unreadBadge.classList.remove('tgico-chatspinned', 'tgico');\n    }\n\n    let isUnread = true, isMention = false;\n    if(dialog.unread_mentions_count && dialog.unread_count === 1) {\n      dom.unreadBadge.innerText = '@';\n      isMention = true;\n      // dom.unreadBadge.classList.add('tgico-mention', 'tgico');\n    } else if(isDialogUnread) {\n      // dom.unreadMessagesSpan.innerText = '' + (dialog.unread_count ? formatNumber(dialog.unread_count, 1) : ' ');\n      dom.unreadBadge.innerText = '' + (dialog.unread_count || ' ');\n    } else {\n      dom.unreadBadge.innerText = '';\n      isUnread = false;\n    }\n\n    dom.unreadBadge.classList.toggle('unread', isUnread);\n    dom.unreadBadge.classList.toggle('mention', isMention);\n    deferred.resolve();\n  }\n\n  private getDialogDom(peerId: PeerId) {\n    // return this.doms[peerId];\n    const element = this.sortedList.get(peerId);\n    return element?.dom;\n  }\n\n  private async getDialog(dialog: Dialog | PeerId) {\n    if(typeof(dialog) !== 'object') {\n      const originalDialog = await this.managers.appMessagesManager.getDialogOnly(dialog);\n      if(!originalDialog) {\n        const peerId = dialog || NULL_PEER_ID;\n        return {\n          peerId,\n          peer: await this.managers.appPeersManager.getOutputPeer(peerId),\n          pFlags: {}\n        } as any as Dialog;\n      }\n\n      return originalDialog;\n    }\n\n    return dialog as Dialog;\n  }\n\n  private setCallStatus(dom: DialogDom, visible: boolean) {\n    let {callIcon, listEl} = dom;\n    if(!callIcon && visible) {\n      const {canvas, startAnimation} = dom.callIcon = callIcon = groupCallActiveIcon(listEl.classList.contains('active'));\n      canvas.classList.add('dialog-group-call-icon');\n      listEl.append(canvas);\n      startAnimation();\n    }\n\n    if(!callIcon) {\n      return;\n    }\n\n    SetTransition(dom.callIcon.canvas, 'is-visible', visible, 200, visible ? undefined : () => {\n      dom.callIcon.canvas.remove();\n      dom.callIcon = undefined;\n    }, visible ? 2 : 0);\n  }\n\n  public addListDialog(options: Parameters<AppDialogsManager['addDialogNew']>[0] & {isBatch?: boolean}) {\n    options.autonomous = false;\n\n    const ret = this.addDialogNew(options);\n\n    if(ret) {\n      const promise = this.getDialog(options.peerId).then((dialog) => {\n        const {peerId} = dialog;\n        const promises: Promise<any>[] = [];\n        if(!peerId.isUser()) {\n          promises.push(this.processDialogForCallStatus(dialog, ret.dom));\n        }\n\n        if(peerId !== rootScope.myId && peerId.isUser()) {\n          promises.push(this.managers.appUsersManager.getUser(peerId).then((user) => {\n            if(user.status?._ === 'userStatusOnline') {\n              this.setOnlineStatus(ret.dom.avatarEl, true);\n            }\n          }));\n        }\n\n        promises.push(this.setLastMessageN({\n          dialog,\n          dom: ret.dom,\n          isBatch: options.isBatch,\n          setUnread: true\n        }));\n\n        return Promise.all(promises);\n      });\n\n      if(options.loadPromises) {\n        options.loadPromises.push(promise);\n      }\n    }\n\n    return ret;\n  }\n\n  private async processDialogForCallStatus(dialog: Dialog, dom?: DialogDom) {\n    if(!IS_GROUP_CALL_SUPPORTED) {\n      return;\n    }\n\n    if(!dom) dom = this.getDialogDom(dialog.peerId);\n    if(!dom) return;\n\n    const chat: Chat.chat | Chat.channel = await this.managers.appChatsManager.getChat(dialog.peerId.toChatId());\n    this.setCallStatus(dom, !!(chat.pFlags.call_active && chat.pFlags.call_not_empty));\n  }\n\n  /**\n   * use for rendering search result\n   */\n  public addDialogAndSetLastMessage(options: Omit<Parameters<AppDialogsManager['addDialogNew']>[0], 'dialog'> & {\n    message: MyMessage,\n    peerId: PeerId,\n    query?: string\n  }) {\n    const {peerId, message, query} = options;\n    const ret = this.addDialogNew({\n      ...options,\n      ...getMessageSenderPeerIdOrName(message),\n      peerId\n    });\n\n    this.setLastMessage({_: 'dialog', peerId} as any, message, ret.dom, query);\n\n    if(message.peerId !== peerId) {\n      ret.dom.listEl.dataset.peerId = '' + message.peerId;\n    }\n\n    return ret;\n  }\n\n  public addDialogNew(options: {\n    peerId: Parameters<AppDialogsManager['addDialog']>[0],\n    container?: Parameters<AppDialogsManager['addDialog']>[1],\n    rippleEnabled?: boolean,\n    onlyFirstName?: boolean,\n    meAsSaved?: boolean,\n    append?: boolean,\n    avatarSize?: number,\n    autonomous?: boolean,\n    lazyLoadQueue?: LazyLoadQueue,\n    loadPromises?: Promise<any>[],\n    fromName?: string,\n    noIcons?: boolean\n  }) {\n    return this.addDialog(options.peerId, options.container, options.rippleEnabled, options.onlyFirstName, options.meAsSaved, options.append, options.avatarSize, options.autonomous, options.lazyLoadQueue, options.loadPromises, options.fromName, options.noIcons);\n  }\n\n  public addDialog(\n    peerId: PeerId,\n    container?: HTMLElement | Scrollable | DocumentFragment | false,\n    rippleEnabled = true,\n    onlyFirstName = false,\n    meAsSaved = true,\n    append = true,\n    avatarSize = 54,\n    autonomous = !!container,\n    lazyLoadQueue?: LazyLoadQueue,\n    loadPromises?: Promise<any>[],\n    fromName?: string,\n    noIcons?: boolean\n  ) {\n    // const dialog = await this.getDialog(_dialog);\n    const avatarEl = new AvatarElement();\n    avatarEl.classList.add('dialog-avatar', 'avatar-' + avatarSize);\n    avatarEl.updateWithOptions({\n      loadPromises,\n      lazyLoadQueue,\n      isDialog: !!meAsSaved,\n      peerId,\n      peerTitle: fromName\n    });\n\n    const captionDiv = document.createElement('div');\n    captionDiv.classList.add('user-caption');\n\n    const titleSpanContainer = document.createElement('span');\n    titleSpanContainer.classList.add('user-title');\n\n    const peerTitle = new PeerTitle();\n    const peerTitlePromise = peerTitle.update({\n      peerId,\n      fromName,\n      dialog: meAsSaved,\n      onlyFirstName,\n      plainText: false,\n      withIcons: !noIcons\n    });\n\n    if(loadPromises) {\n      loadPromises.push(peerTitlePromise);\n    }\n\n    titleSpanContainer.append(peerTitle.element);\n    // p.classList.add('')\n\n    //        (  -   )\n    // if(!container) {\n\n    // for muted icon\n    titleSpanContainer.classList.add('tgico'); // *       !container,  \n\n    // const titleIconsPromise = generateTitleIcons(peerId).then((elements) => {\n    //   titleSpanContainer.append(...elements);\n    // });\n\n    // if(loadPromises) {\n    //   loadPromises.push(titleIconsPromise);\n    // }\n    // }\n\n    const span = document.createElement('span');\n    span.classList.add('user-last-message');\n    span.setAttribute('dir', 'auto');\n\n    // captionDiv.append(titleSpan);\n    // captionDiv.append(span);\n\n    const li = document.createElement(DIALOG_LIST_ELEMENT_TAG);\n    li.classList.add('chatlist-chat');\n    if(!autonomous) (li as HTMLAnchorElement).href = '#' + peerId;\n    if(rippleEnabled) {\n      ripple(li);\n    }\n\n    li.append(avatarEl, captionDiv);\n    li.dataset.peerId = '' + peerId;\n\n    const statusSpan = document.createElement('span');\n    statusSpan.classList.add('message-status', 'sending-status'/* , 'transition', 'reveal' */);\n\n    const lastTimeSpan = document.createElement('span');\n    lastTimeSpan.classList.add('message-time');\n\n    const unreadBadge = document.createElement('div');\n    unreadBadge.className = 'dialog-subtitle-badge badge badge-24';\n\n    const titleP = document.createElement('p');\n    titleP.classList.add('dialog-title');\n\n    const rightSpan = document.createElement('span');\n    rightSpan.classList.add('dialog-title-details');\n    rightSpan.append(statusSpan, lastTimeSpan);\n    titleP.append(titleSpanContainer, rightSpan);\n\n    const subtitleEl = document.createElement('p');\n    subtitleEl.classList.add('dialog-subtitle');\n    subtitleEl.append(span);\n\n    captionDiv.append(titleP, subtitleEl);\n\n    const dom: DialogDom = {\n      avatarEl,\n      captionDiv,\n      titleSpan: peerTitle.element,\n      titleSpanContainer,\n      statusSpan,\n      lastTimeSpan,\n      unreadBadge,\n      lastMessageSpan: span,\n      containerEl: li,\n      listEl: li,\n      subtitleEl\n    };\n\n    /* let good = false;\n    for(const folderId in this.chatLists) {\n      if(this.chatLists[folderId] === container) {\n        good = true;\n      }\n    } */\n    if(container) {\n      const method = append ? 'append' : 'prepend';\n      container[method](li);\n    }\n\n    if(!autonomous) {\n      // @ts-ignore\n      li.dialogDom = dom;\n\n      if(appImManager.chat?.peerId === peerId) {\n        this.setDialogActive(li, true);\n      }\n    }\n\n    return {dom};\n  }\n\n  public async setTyping(dialog: Dialog) {\n    const dom = this.getDialogDom(dialog.peerId);\n    if(!dom) {\n      return;\n    }\n\n    const oldTypingElement = dom.lastMessageSpan.querySelector('.peer-typing-container') as HTMLElement;\n    const newTypingElement = await appImManager.getPeerTyping(dialog.peerId, oldTypingElement);\n    if(!oldTypingElement && newTypingElement) {\n      replaceContent(dom.lastMessageSpan, newTypingElement);\n      dom.lastMessageSpan.classList.add('user-typing');\n    }\n  }\n\n  public unsetTyping(dialog: Dialog) {\n    const dom = this.getDialogDom(dialog.peerId);\n    if(!dom) {\n      return;\n    }\n\n    dom.lastMessageSpan.classList.remove('user-typing');\n    this.setLastMessageN({\n      dialog,\n      lastMessage: null,\n      dom,\n      setUnread: null\n    });\n  }\n}\n\nconst appDialogsManager = new AppDialogsManager();\nMOUNT_CLASS_TO.appDialogsManager = appDialogsManager;\nexport default appDialogsManager;\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport type {DownloadMediaOptions, DownloadOptions} from '../mtproto/apiFileManager';\r\nimport type {AppMessagesManager} from './appMessagesManager';\r\nimport type {MyDocument} from './appDocsManager';\r\nimport deferredPromise, {CancellablePromise} from '../../helpers/cancellablePromise';\r\nimport {InputFile, Photo, PhotoSize} from '../../layer';\r\nimport getFileNameForUpload from '../../helpers/getFileNameForUpload';\r\nimport {AppManagers} from './managers';\r\nimport rootScope from '../rootScope';\r\nimport {MOUNT_CLASS_TO} from '../../config/debug';\r\nimport noop from '../../helpers/noop';\r\nimport getDownloadMediaDetails from './utils/download/getDownloadMediaDetails';\r\nimport getDownloadFileNameFromOptions from './utils/download/getDownloadFileNameFromOptions';\r\nimport indexOfAndSplice from '../../helpers/array/indexOfAndSplice';\r\nimport makeError from '../../helpers/makeError';\r\nimport createDownloadAnchor from '../../helpers/dom/createDownloadAnchor';\r\nimport {getFileNameByLocation} from '../../helpers/fileName';\r\nimport getDocumentDownloadOptions from './utils/docs/getDocumentDownloadOptions';\r\nimport getPhotoDownloadOptions from './utils/photos/getPhotoDownloadOptions';\r\nimport apiManagerProxy from '../mtproto/mtprotoworker';\r\n\r\nexport type ResponseMethodBlob = 'blob';\r\nexport type ResponseMethodJson = 'json';\r\nexport type ResponseMethod = ResponseMethodBlob | ResponseMethodJson;\r\n\r\n/* export type DownloadBlob = {promise: Promise<Blob>, controller: AbortController};\r\nexport type DownloadJson = {promise: Promise<any>, controller: AbortController}; */\r\nexport type DownloadBlob = CancellablePromise<Blob>;\r\nexport type DownloadUrl = CancellablePromise<string>;\r\nexport type DownloadJson = CancellablePromise<any>;\r\n// export type Download = DownloadBlob/*  | DownloadJson */;\r\nexport type Download = DownloadBlob | DownloadUrl/*  | DownloadJson */;\r\n\r\nexport type Progress = {done: number, fileName: string, total: number, offset: number};\r\nexport type ProgressCallback = (details: Progress) => void;\r\n\r\ntype DownloadType = 'url' | 'blob' | 'void' | 'disc';\r\n\r\nexport class AppDownloadManager {\r\n  private downloads: {[fileName: string]: {main: Download} & {[type in DownloadType]?: Download}} = {};\r\n  // private downloadsToDisc: {[fileName: string]: Download} = {};\r\n  private progress: {[fileName: string]: Progress} = {};\r\n  // private progressCallbacks: {[fileName: string]: Array<ProgressCallback>} = {};\r\n  private managers: AppManagers;\r\n\r\n  public construct(managers: AppManagers) {\r\n    this.managers = managers;\r\n    rootScope.addEventListener('download_progress', (details) => {\r\n      // const callbacks = this.progressCallbacks[details.fileName];\r\n      // if(callbacks) {\r\n      //   callbacks.forEach((callback) => callback(details));\r\n      // }\r\n\r\n      const download = this.downloads[details.fileName];\r\n      if(download?.main?.notifyAll) {\r\n        this.progress[details.fileName] = details;\r\n        download.main.notifyAll(details);\r\n      }\r\n    });\r\n  }\r\n\r\n  private getNewDeferred<T>(fileName: string, type?: DownloadType) {\r\n    const deferred = deferredPromise<T>();\r\n\r\n    let download = this.downloads[fileName];\r\n    if(!download) {\r\n      download = this.downloads[fileName] = {\r\n        main: deferred as any\r\n      };\r\n\r\n      deferred.cancel = () => {\r\n        const error = makeError('DOWNLOAD_CANCELED');\r\n\r\n        this.managers.apiFileManager.cancelDownload(fileName);\r\n\r\n        deferred.reject(error);\r\n        deferred.cancel = noop;\r\n      };\r\n\r\n      deferred.catch(() => {\r\n        this.clearDownload(fileName, type);\r\n      }).finally(() => {\r\n        delete this.progress[fileName];\r\n        // delete this.progressCallbacks[fileName];\r\n      });\r\n    } else {\r\n      const main = download.main;\r\n      (['cancel', 'addNotifyListener', 'notify', 'notifyAll'] as (keyof CancellablePromise<void>)[]).forEach((key) => {\r\n        if(!main[key]) {\r\n          return;\r\n        }\r\n\r\n        // @ts-ignore\r\n        deferred[key] = main[key].bind(main);\r\n      });\r\n    }\r\n\r\n    const haveToClear = type === 'disc';\r\n    if(haveToClear) {\r\n      deferred.catch(noop).finally(() => {\r\n        this.clearDownload(fileName, type);\r\n      });\r\n    }\r\n\r\n    return download[type] = deferred as any;\r\n  }\r\n\r\n  public getNewDeferredForUpload<T extends Promise<any>>(fileName: string, promise: T) {\r\n    const deferred = this.getNewDeferred<InputFile>(fileName);\r\n    promise.then(deferred.resolve, deferred.reject);\r\n\r\n    deferred.finally(() => {\r\n      this.clearDownload(fileName);\r\n    });\r\n\r\n    return deferred as CancellablePromise<Awaited<T>>;\r\n  }\r\n\r\n  private clearDownload(fileName: string, type?: DownloadType) {\r\n    const downloads = this.downloads[fileName];\r\n    if(!downloads) {\r\n      return;\r\n    }\r\n\r\n    delete downloads[type];\r\n\r\n    const length = Object.keys(downloads).length;\r\n    if(!length || (downloads.main && length === 1)) {\r\n      delete this.downloads[fileName];\r\n    }\r\n  }\r\n\r\n  public getUpload(fileName: string): ReturnType<AppMessagesManager['sendFile']>['promise'] {\r\n    let deferred: CancellablePromise<any> = this.getDownload(fileName);\r\n    if(deferred) {\r\n      return deferred;\r\n    }\r\n\r\n    deferred = this.getNewDeferred(fileName);\r\n    this.managers.appMessagesManager.getUploadPromise(fileName).then(deferred.resolve, deferred.reject);\r\n    return deferred;\r\n  }\r\n\r\n  /* public fakeDownload(fileName: string, value: Blob | string) {\r\n    const deferred = this.getNewDeferred<Blob>(fileName);\r\n    if(typeof(value) === 'string') {\r\n      fetch(value)\r\n      .then((response) => response.blob())\r\n      .then((blob) => deferred.resolve(blob));\r\n    } else {\r\n      deferred.resolve(value);\r\n    }\r\n\r\n    return deferred;\r\n  } */\r\n\r\n  private d(fileName: string, getPromise: () => Promise<any>, type?: DownloadType) {\r\n    let deferred = this.getDownload(fileName, type);\r\n    if(deferred) return deferred;\r\n\r\n    deferred = this.getNewDeferred<Blob>(fileName, type);\r\n    getPromise().then(deferred.resolve, deferred.reject);\r\n    return deferred;\r\n  }\r\n\r\n  public download(options: DownloadOptions): DownloadBlob {\r\n    const fileName = getDownloadFileNameFromOptions(options);\r\n    return this.d(fileName, () => this.managers.apiFileManager.download(options), 'blob') as any;\r\n  }\r\n\r\n  public downloadMedia(options: DownloadMediaOptions, type: DownloadType = 'blob', promiseBefore?: Promise<any>): DownloadBlob {\r\n    const {downloadOptions, fileName} = getDownloadMediaDetails(options);\r\n\r\n    return this.d(fileName, () => {\r\n      let cb: any;\r\n      if(type === 'url') {\r\n        cb = this.managers.apiFileManager.downloadMediaURL;\r\n      } else if(type === 'void'/*  || type === 'disc' */) {\r\n        cb = this.managers.apiFileManager.downloadMediaVoid;\r\n      } else /* if(type === 'blob') */ {\r\n        cb = this.managers.apiFileManager.downloadMedia;\r\n      }\r\n\r\n      if(promiseBefore) {\r\n        return promiseBefore.then(() => cb(options));\r\n      }\r\n\r\n      return cb(options);\r\n    }, type) as any;\r\n  }\r\n\r\n  public downloadMediaURL(options: DownloadMediaOptions): DownloadUrl {\r\n    return this.downloadMedia(options, 'url') as any;\r\n  }\r\n\r\n  public downloadMediaVoid(options: DownloadMediaOptions): DownloadBlob {\r\n    return this.downloadMedia(options, 'void');\r\n  }\r\n\r\n  public upload(file: File | Blob, fileName?: string, promise?: Promise<any>) {\r\n    if(!fileName) {\r\n      fileName = getFileNameForUpload(file);\r\n    }\r\n\r\n    if(!promise) {\r\n      promise = this.managers.apiFileManager.upload({file, fileName});\r\n    }\r\n\r\n    const deferred = this.getNewDeferredForUpload(fileName, promise);\r\n    return deferred as any as CancellablePromise<InputFile>;\r\n  }\r\n\r\n  public getDownload(fileName: string, type?: DownloadType) {\r\n    const d = this.downloads[fileName];\r\n    return d && d[type];\r\n  }\r\n\r\n  // public addProgressCallback(fileName: string, callback: ProgressCallback) {\r\n  //   const progress = this.progress[fileName];\r\n  //   (this.progressCallbacks[fileName] ?? (this.progressCallbacks[fileName] = [])).push(callback);\r\n\r\n  //   if(progress) {\r\n  //     callback(progress);\r\n  //   }\r\n  // }\r\n\r\n  public downloadToDisc(options: DownloadMediaOptions, justAttach?: boolean) {\r\n    const media = options.media;\r\n    const isDocument = media._ === 'document';\r\n    if(!isDocument && !options.thumb) {\r\n      options.thumb = (media as Photo.photo).sizes.slice().pop() as PhotoSize.photoSize;\r\n    }\r\n\r\n    // const {fileName: cacheFileName} = getDownloadMediaDetails(options);\r\n    // if(justAttach) {\r\n    //   const promise = this.downloadsToDisc[cacheFileName];\r\n    //   if(promise) {\r\n    //     return promise;\r\n    //   }\r\n    // }\r\n\r\n    // const {downloadOptions, fileName} = getDownloadMediaDetails(options);\r\n    // if(downloadOptions.size && downloadOptions.size > MAX_FILE_SAVE_SIZE) {\r\n    const id = '' + (Math.random() * 0x7FFFFFFF | 0);\r\n    // const id = 'test';\r\n    const url = `download/${id}`;\r\n    options.downloadId = id;\r\n\r\n    const pingPromise = apiManagerProxy.pingServiceWorkerWithIframe();\r\n\r\n    const promise = this.downloadMedia(options, 'disc', pingPromise);\r\n    // this.downloadsToDisc[cacheFileName] = promise;\r\n\r\n    if(justAttach) {\r\n      return promise;\r\n    }\r\n\r\n    const iframe = document.createElement('iframe');\r\n    iframe.hidden = true;\r\n\r\n    pingPromise.then(() => {\r\n      iframe.src = url;\r\n      document.body.append(iframe);\r\n    });\r\n\r\n    // createDownloadAnchor(url, 'asd.txt');\r\n\r\n    // const events = [\r\n    //   'emptied',\r\n    //   'abort',\r\n    //   'suspend',\r\n    //   'reset',\r\n    //   'error',\r\n    //   'ended',\r\n    //   'load'\r\n    // ].forEach((event) => {\r\n    //   iframe.addEventListener(event, () => alert(event));\r\n    //   iframe.contentWindow.addEventListener(event, () => alert(event));\r\n    // });\r\n\r\n    let element: HTMLElement, hadProgress = false;\r\n    const onProgress = () => {\r\n      if(hadProgress) {\r\n        return;\r\n      }\r\n\r\n      hadProgress = true;\r\n      element = iframe;\r\n\r\n      indexOfAndSplice(promise.listeners, onProgress);\r\n    };\r\n\r\n    promise.addNotifyListener(onProgress);\r\n    promise.then((blob) => {\r\n      if(!blob) {\r\n        return;\r\n      }\r\n\r\n      const url = URL.createObjectURL(blob);\r\n      const downloadOptions = isDocument ?\r\n        getDocumentDownloadOptions(media) :\r\n        getPhotoDownloadOptions(media as any, options.thumb as PhotoSize.photoSize);\r\n      const fileName = (options.media as MyDocument).file_name || getFileNameByLocation(downloadOptions.location);\r\n      createDownloadAnchor(url, downloadOptions.fileName || fileName, () => {\r\n        URL.revokeObjectURL(url);\r\n      });\r\n    }).catch(noop).finally(() => {\r\n      if(!hadProgress) {\r\n        onProgress();\r\n      }\r\n\r\n      setTimeout(() => {\r\n        element?.remove();\r\n      }, 1000);\r\n\r\n      // if(this.downloadsToDisc[cacheFileName] === promise) {\r\n      //   delete this.downloadsToDisc[cacheFileName];\r\n      // }\r\n    });\r\n\r\n    return promise;\r\n  }\r\n}\r\n\r\nconst appDownloadManager = new AppDownloadManager();\r\nMOUNT_CLASS_TO && (MOUNT_CLASS_TO.appDownloadManager = appDownloadManager);\r\nexport default appDownloadManager;\r\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nexport default function createDownloadAnchor(url: string, fileName: string, onRemove?: () => void) {\n  const a = document.createElement('a');\n  a.href = url;\n  a.download = fileName;\n  a.target = '_blank';\n\n  a.style.position = 'absolute';\n  a.style.top = '1px';\n  a.style.left = '1px';\n\n  document.body.append(a);\n\n  try {\n    const clickEvent = document.createEvent('MouseEvents');\n    clickEvent.initMouseEvent('click', true, false, window, 0, 0, 0, 0, 0, false, false, false, false, 0, null);\n    a.dispatchEvent(clickEvent);\n  } catch(e) {\n    console.error('Download click error', e);\n    try {\n      a.click();\n    } catch(e) {\n      window.open(url as string, '_blank');\n    }\n  }\n\n  setTimeout(() => {\n    a.remove();\n    onRemove && onRemove();\n  }, 100);\n}\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport rootScope from '../../lib/rootScope';\r\n// import { generatePathData } from \"../../helpers/dom\";\r\nimport {MyMessage} from '../../lib/appManagers/appMessagesManager';\r\nimport type Chat from './chat';\r\nimport indexOfAndSplice from '../../helpers/array/indexOfAndSplice';\r\nimport insertInDescendSortedArray from '../../helpers/array/insertInDescendSortedArray';\r\nimport positionElementByIndex from '../../helpers/dom/positionElementByIndex';\r\nimport AvatarElement from '../avatar';\r\nimport {Message} from '../../layer';\r\nimport {NULL_PEER_ID, REPLIES_PEER_ID} from '../../lib/mtproto/mtproto_config';\r\nimport {SERVICE_AS_REGULAR, STICKY_OFFSET} from './bubbles';\r\nimport forEachReverse from '../../helpers/array/forEachReverse';\r\nimport partition from '../../helpers/array/partition';\r\n\r\ntype GroupItem = {\r\n  bubble: HTMLElement,\r\n  fromId: PeerId,\r\n  mid: number,\r\n  groupMid?: number,\r\n  timestamp: number,\r\n  dateTimestamp: number,\r\n  mounted: boolean,\r\n  single: boolean,\r\n  group?: BubbleGroup,\r\n  message: Message.message | Message.messageService // use it only to set avatar\r\n};\r\n\r\nclass BubbleGroup {\r\n  container: HTMLElement;\r\n  chat: Chat;\r\n  groups: BubbleGroups;\r\n  items: GroupItem[]; // descend sorted\r\n  avatarContainer: HTMLElement;\r\n  avatarLoadPromise: ReturnType<AvatarElement['updateWithOptions']>;\r\n  avatar: AvatarElement;\r\n  mounted: boolean;\r\n  dateTimestamp: number;\r\n  offset: number;\r\n\r\n  constructor(chat: Chat, groups: BubbleGroups, dateTimestamp: number) {\r\n    this.container = document.createElement('div');\r\n    this.container.classList.add('bubbles-group');\r\n    this.chat = chat;\r\n    this.groups = groups;\r\n    this.items = [];\r\n    this.dateTimestamp = dateTimestamp;\r\n    this.offset = 0;\r\n  }\r\n\r\n  createAvatar(message: Message.message | Message.messageService) {\r\n    if(this.avatarLoadPromise) {\r\n      return this.avatarLoadPromise;\r\n    } else if(message._ === 'messageService') {\r\n      return;\r\n    }\r\n\r\n    this.avatarContainer = document.createElement('div');\r\n    this.avatarContainer.classList.add('bubbles-group-avatar-container');\r\n    ++this.offset;\r\n\r\n    const fwdFrom = message.fwd_from;\r\n    const fwdFromId = message.fwdFromId;\r\n    const isForwardFromChannel = message.from_id && message.from_id._ === 'peerChannel' && message.fromId === fwdFromId;\r\n    const currentPeerId = this.chat.peerId;\r\n    const avatar = this.avatar = new AvatarElement();\r\n    this.avatar.classList.add('bubbles-group-avatar', 'user-avatar', 'avatar-40'/* , 'can-zoom-fade' */);\r\n    const peerId = ((fwdFrom && (currentPeerId === rootScope.myId || currentPeerId === REPLIES_PEER_ID)) || isForwardFromChannel ? fwdFromId : message.fromId) || NULL_PEER_ID;\r\n    const avatarLoadPromise = this.avatar.updateWithOptions({\r\n      lazyLoadQueue: this.chat.bubbles.lazyLoadQueue,\r\n      peerId,\r\n      peerTitle: !fwdFromId && fwdFrom && fwdFrom.from_name ? /* ' FF ' */fwdFrom.from_name : undefined\r\n    });\r\n\r\n    this.avatarLoadPromise = Promise.all([\r\n      avatarLoadPromise,\r\n      peerId && peerId.isUser() ? this.chat.managers.appUsersManager.getUser(peerId.toUserId()) : undefined\r\n    ]).then(([result, user]) => {\r\n      if(user?.pFlags?.premium) {\r\n        avatar.classList.add('is-premium', 'tgico-star');\r\n      }\r\n\r\n      return result;\r\n    });\r\n\r\n    this.avatarContainer.append(this.avatar);\r\n    this.container.append(this.avatarContainer);\r\n\r\n    return this.avatarLoadPromise;\r\n  }\r\n\r\n  get firstTimestamp() {\r\n    return this.firstItem.timestamp;\r\n  }\r\n\r\n  get firstMid() {\r\n    return this.firstItem.mid;\r\n  }\r\n\r\n  get firstItem() {\r\n    return this.items[this.items.length - 1];\r\n  }\r\n\r\n  get lastTimestamp() {\r\n    return this.lastItem.timestamp;\r\n  }\r\n\r\n  get lastMid() {\r\n    return this.lastItem.mid;\r\n  }\r\n\r\n  get lastItem() {\r\n    return this.items[0];\r\n  }\r\n\r\n  updateClassNames() {\r\n    const items = this.items;\r\n    const length = items.length;\r\n    if(!length) {\r\n      return;\r\n    }\r\n\r\n    // const elements = Array.from(this.container.children);\r\n    // if(this.offset) elements.splice(0, this.offset);\r\n\r\n    // const length = elements.length;\r\n    // if(!length) {\r\n    //   return;\r\n    // }\r\n\r\n    const first = items[length - 1].bubble;\r\n\r\n    if(items.length === 1) {\r\n      first.classList.add('is-group-first', 'is-group-last');\r\n      // this.setClipIfNeeded(first);\r\n      return;\r\n    } else {\r\n      first.classList.remove('is-group-last');\r\n      first.classList.add('is-group-first');\r\n      // this.setClipIfNeeded(first, true);\r\n    }\r\n\r\n    for(let i = 1, _length = length - 1; i < _length; ++i) {\r\n      const bubble = items[i].bubble;\r\n      bubble.classList.remove('is-group-last', 'is-group-first');\r\n      // this.setClipIfNeeded(bubble, true);\r\n    }\r\n\r\n    const last = items[0].bubble;\r\n    last.classList.remove('is-group-first');\r\n    last.classList.add('is-group-last');\r\n    // this.setClipIfNeeded(last);\r\n  }\r\n\r\n  insertItem(item: GroupItem) {\r\n    const {items} = this;\r\n    insertInDescendSortedArray(items, item, this.groups.sortGroupItemsKey);\r\n\r\n    item.group = this;\r\n    if(items.length === 1) {\r\n      this.groups.insertGroup(this);\r\n    }\r\n  }\r\n\r\n  removeItem(item: GroupItem) {\r\n    indexOfAndSplice(this.items, item);\r\n\r\n    if(!this.items.length) {\r\n      indexOfAndSplice(this.groups.groups, this);\r\n    }\r\n\r\n    item.group = undefined;\r\n  }\r\n\r\n  mount(updateClassNames?: boolean) {\r\n    if(!this.groups.groups.includes(this) || !this.items.length) { // group can be already removed\r\n      debugger;\r\n\r\n      if(this.mounted) {\r\n        this.onItemUnmount();\r\n      }\r\n\r\n      return;\r\n    }\r\n\r\n    const {offset, items} = this;\r\n    const {length} = items;\r\n    forEachReverse(items, (item, idx) => {\r\n      this.mountItem(item, length - 1 - idx, offset);\r\n    });\r\n\r\n    if(updateClassNames) {\r\n      this.updateClassNames();\r\n    }\r\n\r\n    this.onItemMount();\r\n  }\r\n\r\n  mountItem(item: GroupItem, idx = this.items.indexOf(item), offset = this.offset) {\r\n    if(item.mounted) {\r\n      return;\r\n    }\r\n\r\n    positionElementByIndex(item.bubble, this.container, offset + idx);\r\n    item.mounted = true;\r\n  }\r\n\r\n  unmountItem(item: GroupItem) {\r\n    if(!item.mounted) {\r\n      return;\r\n    }\r\n\r\n    item.bubble.remove();\r\n    item.mounted = false;\r\n    this.onItemUnmount();\r\n  }\r\n\r\n  onItemMount() {\r\n    if(this.mounted) {\r\n      return;\r\n    }\r\n\r\n    const dateContainer = this.chat.bubbles.getDateContainerByTimestamp(this.dateTimestamp / 1000);\r\n    // const idx = this.groups.indexOf(group);\r\n    const dateGroups = this.groups.groups.filter((_group) => _group.dateTimestamp === this.dateTimestamp);\r\n    const dateGroupsLength = dateGroups.length;\r\n    const idx = dateGroups.indexOf(this);\r\n    const unmountedLength = dateGroups.slice(idx + 1).reduce((acc, v) => acc + (v.mounted ? 0 : 1), 0);\r\n    positionElementByIndex(this.container, dateContainer.container, STICKY_OFFSET + dateGroupsLength - 1 - idx - unmountedLength);\r\n    this.mounted = true;\r\n  }\r\n\r\n  onItemUnmount() {\r\n    if(!this.mounted) {\r\n      return;\r\n    }\r\n\r\n    if(!this.items.length) {\r\n      this.container.remove();\r\n      this.chat.bubbles.deleteEmptyDateGroups();\r\n      this.mounted = false;\r\n    } else {\r\n      this.updateClassNames();\r\n    }\r\n  }\r\n}\r\n\r\n// class BubbleGroupItem implements GroupItem {\r\n//   bubble: HTMLElement;\r\n//   fromId: PeerId;\r\n//   mid: number;\r\n//   timestamp: number;\r\n//   dateTimestamp: number;\r\n//   mounted: boolean;\r\n//   single: boolean;\r\n//   group: BubbleGroup;\r\n\r\n//   constructor(details: GroupItem) {\r\n//     Object.assign(this, details);\r\n//   }\r\n// }\r\n\r\nexport default class BubbleGroups {\r\n  public itemsArr: Array<GroupItem> = []; // descend sorted\r\n  private itemsMap: Map<HTMLElement, GroupItem> = new Map();\r\n  public groups: Array<BubbleGroup> = []; // descend sorted\r\n  private newGroupDiff = 121; // * 121 in scheduled messages\r\n  private sortItemsKey: Extract<keyof GroupItem, 'timestamp' | 'mid'>;\r\n  private sortGroupsKey: Extract<keyof BubbleGroup, 'lastMid' | 'lastTimestamp'>;\r\n  public sortGroupItemsKey: Extract<keyof GroupItem, 'groupMid' | 'timestamp'>;\r\n\r\n  constructor(private chat: Chat) {\r\n    this.sortItemsKey = chat.type === 'scheduled' ? 'timestamp' : 'mid';\r\n    this.sortGroupsKey = chat.type === 'scheduled' ? 'lastTimestamp' : 'lastMid';\r\n    this.sortGroupItemsKey = /* chat.type === 'scheduled' ? 'timestamp' :  */'groupMid';\r\n  }\r\n\r\n  removeItem(item: GroupItem) {\r\n    item.group.removeItem(item);\r\n    this.removeItemFromCache(item);\r\n  }\r\n\r\n  removeAndUnmountBubble(bubble: HTMLElement) {\r\n    const item = this.getItemByBubble(bubble);\r\n    if(!item) {\r\n      return;\r\n    }\r\n\r\n    const items = this.itemsArr;\r\n    const index = items.indexOf(item);\r\n    const siblings = this.getSiblingsAtIndex(index, items);\r\n\r\n    const group = item.group;\r\n    this.removeItem(item);\r\n    group.unmountItem(item);\r\n\r\n    const modifiedGroups: Set<BubbleGroup> = new Set();\r\n    modifiedGroups.add(group);\r\n\r\n    const [previousSibling, nextSibling] = siblings;\r\n    if(\r\n      previousSibling &&\r\n      nextSibling &&\r\n      this.canItemsBeGrouped(previousSibling, nextSibling) &&\r\n      previousSibling.group !== nextSibling.group\r\n    ) {\r\n      const group = nextSibling.group;\r\n      this.f(nextSibling.group.items);\r\n      group.onItemUnmount();\r\n      modifiedGroups.add(previousSibling.group);\r\n      this.groupUngrouped();\r\n    }\r\n\r\n    this.mountUnmountGroups(Array.from(modifiedGroups));\r\n  }\r\n\r\n  mountUnmountGroups(groups: BubbleGroup[]) {\r\n    // groups.sort((a, b) => (b.lastItem?.mid ?? 0) - (a.lastItem?.mid ?? 0));\r\n\r\n    const [toMount, toUnmount] = partition(groups, (group) => !!group.items.length);\r\n    toUnmount.forEach((group) => {\r\n      group.onItemUnmount();\r\n    })\r\n\r\n    toMount.forEach((group) => {\r\n      group.mount(true);\r\n    });\r\n\r\n    // toMount.forEach((group) => {\r\n    //   group.updateClassNames();\r\n    // });\r\n  }\r\n\r\n  f(items: GroupItem[], index: number = 0, length = items.length) {\r\n    for(; index < length; ++index) {\r\n      const item = items[index];\r\n      item.mounted = false;\r\n      item.group.removeItem(item);\r\n      --length;\r\n      --index;\r\n    }\r\n  }\r\n\r\n  getItemByBubble(bubble: HTMLElement) {\r\n    return this.itemsMap.get(bubble);\r\n  }\r\n\r\n  getLastGroup() {\r\n    return this.groups[0];\r\n  }\r\n\r\n  changeBubbleMid(bubble: HTMLElement, mid: number) {\r\n    const item = this.getItemByBubble(bubble);\r\n    if(!item) {\r\n      return;\r\n    }\r\n\r\n    item.mid = mid;\r\n\r\n    // indexOfAndSplice(item.group.items, item);\r\n    // // const canChangeGroupMid = !item.group.items.length || item.group.items.every((item) => item.groupMid === item.mid);\r\n    // // if(canChangeGroupMid) item.groupMid = mid;\r\n    // item.group.insertItem(item);\r\n\r\n    indexOfAndSplice(this.itemsArr, item);\r\n    this.insertItemToArray(item, this.itemsArr);\r\n  }\r\n\r\n  changeItemBubble(item: GroupItem, bubble: HTMLElement) {\r\n    this.itemsMap.delete(item.bubble);\r\n    item.bubble = bubble;\r\n    this.itemsMap.set(bubble, item);\r\n  }\r\n\r\n  changeBubbleByBubble(from: HTMLElement, to: HTMLElement) {\r\n    const item = this.getItemByBubble(from);\r\n    if(!item) {\r\n      return;\r\n    }\r\n\r\n    this.changeItemBubble(item, to);\r\n  }\r\n\r\n  canItemsBeGrouped(item1: GroupItem, item2: GroupItem) {\r\n    return item2.fromId === item1.fromId &&\r\n      Math.abs(item2.timestamp - item1.timestamp) <= this.newGroupDiff &&\r\n      item1.dateTimestamp === item2.dateTimestamp &&\r\n      !item1.single &&\r\n      !item2.single;\r\n  }\r\n\r\n  getSiblingsAtIndex(itemIndex: number, items: GroupItem[]) {\r\n    return [items[itemIndex - 1], items[itemIndex + 1]] as const;\r\n  }\r\n\r\n  // findGroupSiblingInSiblings(item: GroupItem, siblings: ReturnType<BubbleGroups['getSiblingsAtIndex']>) {\r\n  //   return siblings.find((sibling) => sibling && this.canItemsBeGrouped(item, sibling));\r\n  // }\r\n\r\n  findGroupSiblingByItem(item: GroupItem, items: GroupItem[]) {\r\n    items = items.slice();\r\n    const idx = this.insertItemToArray(item, items);\r\n    // return this.findGroupSiblingInSiblings(item, this.getSiblingsAtIndex(idx, items));\r\n    return this.findGroupSiblingInItems(item, items, idx);\r\n  }\r\n\r\n  findGroupSiblingInItems(item: GroupItem, items: GroupItem[], index = items.indexOf(item), length = items.length) {\r\n    const previousItem = items[index - 1];\r\n    let siblingGroupedItem: GroupItem;\r\n    if(previousItem?.group && this.canItemsBeGrouped(item, previousItem)) {\r\n      siblingGroupedItem = previousItem;\r\n    } else {\r\n      for(let k = index + 1; k < length; ++k) {\r\n        const nextItem = items[k];\r\n        if(this.canItemsBeGrouped(item, nextItem)) {\r\n          if(nextItem.group) {\r\n            siblingGroupedItem = nextItem;\r\n          }\r\n        } else {\r\n          break;\r\n        }\r\n      }\r\n    }\r\n\r\n    return siblingGroupedItem;\r\n  }\r\n\r\n  addItemToGroup(item: GroupItem, group: BubbleGroup) {\r\n    group.insertItem(item);\r\n    this.addItemToCache(item);\r\n  }\r\n\r\n  insertItemToArray(item: GroupItem, array: GroupItem[]) {\r\n    return insertInDescendSortedArray(array, item, this.sortItemsKey);\r\n  }\r\n\r\n  insertGroup(group: BubbleGroup) {\r\n    return insertInDescendSortedArray(this.groups, group, this.sortGroupsKey);\r\n  }\r\n\r\n  addItemToCache(item: GroupItem) {\r\n    this.insertItemToArray(item, this.itemsArr);\r\n    this.itemsMap.set(item.bubble, item);\r\n  }\r\n\r\n  removeItemFromCache(item: GroupItem) {\r\n    indexOfAndSplice(this.itemsArr, item);\r\n    this.itemsMap.delete(item.bubble);\r\n  }\r\n\r\n  getMessageFromId(message: MyMessage) {\r\n    let fromId = message.viaBotId || message.fromId;\r\n\r\n    // fix for saved messages forward to self\r\n    if(fromId === rootScope.myId && message.peerId === rootScope.myId && (message as Message.message).fwdFromId === fromId) {\r\n      fromId = fromId.toPeerId(true);\r\n    }\r\n\r\n    return fromId;\r\n  }\r\n\r\n  createItem(bubble: HTMLElement, message: MyMessage) {\r\n    const single = !(message._ === 'message' || (message.action && SERVICE_AS_REGULAR.has(message.action._)));\r\n    const {mid, date: timestamp} = message;\r\n    const {dateTimestamp} = this.chat.bubbles.getDateForDateContainer(timestamp);\r\n    const item: GroupItem = {\r\n      mid,\r\n      groupMid: this.chat.type === 'scheduled' ? +`${(timestamp * 1000 - dateTimestamp) / 1000}.${mid}` : mid,\r\n      fromId: this.getMessageFromId(message),\r\n      bubble,\r\n      // timestamp: this.chat.type === 'scheduled' ? +`${(timestamp * 1000 - dateTimestamp) / 1000}.${mid}` : timestamp,\r\n      timestamp,\r\n      dateTimestamp,\r\n      mounted: false,\r\n      single,\r\n      message\r\n    };\r\n\r\n    return item;\r\n  }\r\n\r\n  splitSiblingsOnGrouping(siblings: ReturnType<BubbleGroups['getSiblingsAtIndex']>) {\r\n    const [previousSibling, nextSibling] = siblings;\r\n    const previousGroup = previousSibling?.group;\r\n    const nextGroup = nextSibling?.group;\r\n\r\n    if(!previousGroup) {\r\n      return;\r\n    }\r\n\r\n    // will refresh group\r\n    // if(previousGroup === nextGroup) {\r\n    const items = previousGroup.items;\r\n    const index = items.indexOf(previousSibling) + 1;\r\n    const length = items.length;\r\n    if(index === length) {\r\n      return;\r\n    }\r\n\r\n    const modifiedGroups: BubbleGroup[] = [previousGroup];\r\n    // if(previousGroup !== nextGroup && nextGroup) {\r\n    //   modifiedGroups.push(nextGroup);\r\n    // }\r\n\r\n    this.f(items, index, length);\r\n    return modifiedGroups;\r\n    // }\r\n  }\r\n\r\n  prepareForGrouping(bubble: HTMLElement, message: MyMessage) {\r\n    const foundItem = this.getItemByBubble(bubble);\r\n    if(foundItem) { // should happen only on edit\r\n      // debugger;\r\n      return;\r\n    }\r\n\r\n    const item = this.createItem(bubble, message);\r\n    this.addItemToCache(item);\r\n  }\r\n\r\n  groupUngrouped() {\r\n    const items = this.itemsArr;\r\n    const length = items.length;\r\n    const modifiedGroups: Set<BubbleGroup> = new Set();\r\n    // for(let i = length - 1; i >= 0; --i) {\r\n    for(let i = 0; i < length; ++i) {\r\n      const item = items[i];\r\n      if(item.group) {\r\n        continue;\r\n      }\r\n\r\n      let hadGroup = true;\r\n      const siblings = this.getSiblingsAtIndex(i, items);\r\n      const siblingGroupedItem = this.findGroupSiblingInItems(item, items, i, length);\r\n\r\n      // const foundItem = this.findGroupSiblingInSiblings(item, siblings);\r\n      const foundItem = siblingGroupedItem;\r\n      const group = foundItem?.group ?? (hadGroup = false, new BubbleGroup(this.chat, this, item.dateTimestamp));\r\n\r\n      modifiedGroups.add(group);\r\n      group.insertItem(item);\r\n\r\n      if(!hadGroup) {\r\n        const splittedGroups = this.splitSiblingsOnGrouping(siblings);\r\n        if(splittedGroups) {\r\n          splittedGroups.forEach((group) => modifiedGroups.add(group));\r\n        }\r\n      }\r\n    }\r\n\r\n    return modifiedGroups;\r\n  }\r\n\r\n  // addBubble(bubble: HTMLElement, message: MyMessage, unmountIfFound?: boolean) {\r\n  //   const oldItem = this.getItemByBubble(bubble);\r\n  //   if(unmountIfFound) { // updating position\r\n  //     this.removeAndUnmountBubble(bubble);\r\n  //   } else if(oldItem) { // editing\r\n  //     const group = oldItem.group;\r\n  //     this.changeItemBubble(oldItem, bubble);\r\n  //     oldItem.mounted = false;\r\n\r\n  //     return {item: oldItem, group};\r\n  //   }\r\n\r\n  //   const item = this.createItem(bubble, message);\r\n\r\n  //   const foundItem = this.findSameGroupItem(item, this.itemsArr);\r\n\r\n  //   const group = foundItem?.group ?? new BubbleGroup(this.chat, this, item.dateTimestamp);\r\n  //   this.addItemToGroup(item, group);\r\n\r\n  //   return {item, group};\r\n  // }\r\n\r\n  /* setClipIfNeeded(bubble: HTMLDivElement, remove = false) {\r\n    //console.log('setClipIfNeeded', bubble, remove);\r\n    const className = bubble.className;\r\n    if(className.includes('is-message-empty') && (className.includes('photo') || className.includes('video'))) {\r\n      let container = bubble.querySelector('.bubble__media-container') as SVGSVGElement;\r\n      //console.log('setClipIfNeeded', bubble, remove, container);\r\n      if(!container) return;\r\n\r\n      try {\r\n        Array.from(container.children).forEach((object) => {\r\n          if(object instanceof SVGDefsElement) return;\r\n\r\n          if(remove) {\r\n            object.removeAttributeNS(null, 'clip-path');\r\n          } else {\r\n            let clipId = container.dataset.clipId;\r\n            let path = container.firstElementChild.firstElementChild.lastElementChild as SVGPathElement;\r\n            let width = +object.getAttributeNS(null, 'width');\r\n            let height = +object.getAttributeNS(null, 'height');\r\n            let isOut = className.includes('is-out');\r\n            let isReply = className.includes('is-reply');\r\n            let d = '';\r\n\r\n            //console.log('setClipIfNeeded', object, width, height, isOut);\r\n\r\n            let tr: number, tl: number;\r\n            if(className.includes('forwarded') || isReply) {\r\n              tr = tl = 0;\r\n            } else if(isOut) {\r\n              tr = className.includes('is-group-first') ? 12 : 6;\r\n              tl = 12;\r\n            } else {\r\n              tr = 12;\r\n              tl = className.includes('is-group-first') ? 12 : 6;\r\n            }\r\n\r\n            if(isOut) {\r\n              d = generatePathData(0, 0, width - 9, height, tl, tr, 0, 12);\r\n            } else {\r\n              d = generatePathData(9, 0, width - 9, height, tl, tr, 12, 0);\r\n            }\r\n\r\n            path.setAttributeNS(null, 'd', d);\r\n            object.setAttributeNS(null, 'clip-path', 'url(#' + clipId + ')');\r\n          }\r\n        });\r\n      } catch(err) {}\r\n    }\r\n  } */\r\n\r\n  // updateGroupByMessageId(mid: number) {\r\n  //   const item = this.itemsArr.find((g) => g.mid === mid);\r\n  //   if(item) {\r\n  //     item.group.updateGroup();\r\n  //   }\r\n  // }\r\n\r\n  cleanup() {\r\n    this.itemsArr = [];\r\n    this.groups = [];\r\n    this.itemsMap.clear();\r\n  }\r\n\r\n  // findIncorrentPositions() {\r\n  //   var bubbles = Array.from(this.chat.bubbles.chatInner.querySelectorAll('.bubbles-group .bubble')).reverse();\r\n  //   var items = this.itemsArr;\r\n  //   for(var i = 0, length = items.length; i < length; ++i) {\r\n  //     const item = items[i];\r\n  //     const foundBubble = bubbles[i];\r\n  //     if(item.bubble !== foundBubble) {\r\n  //       console.log('incorrect position', i, item, foundBubble);\r\n  //       // debugger;\r\n  //       // break;\r\n  //     }\r\n  //   }\r\n  // }\r\n}\r\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nexport default function partition<T>(arr: T[], callback: (item: T, idx: number, arr: T[]) => boolean) {\n  const good: T[] = [], bad: T[] = [];\n  for(let i = 0, length = arr.length; i < length; ++i) {\n    const item = arr[i];\n    (callback(item, i, arr) ? good : bad).push(item);\n  }\n\n  return [good, bad];\n}\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport PopupElement, {PopupOptions} from '.';\r\nimport {attachClickEvent} from '../../helpers/dom/clickEvent';\r\nimport mediaSizes from '../../helpers/mediaSizes';\r\nimport I18n, {FormatterArguments, i18n, LangPackKey} from '../../lib/langPack';\r\nimport InputField from '../inputField';\r\n\r\nexport default class PopupDatePicker extends PopupElement {\r\n  protected controlsDiv: HTMLElement;\r\n  protected monthTitle: HTMLElement;\r\n  protected prevBtn: HTMLElement;\r\n  protected nextBtn: HTMLElement;\r\n\r\n  protected monthsContainer: HTMLElement;\r\n  protected month: HTMLElement;\r\n\r\n  protected minMonth: Date;\r\n  protected maxMonth: Date;\r\n  protected minDate: Date;\r\n  protected maxDate: Date;\r\n  protected selectedDate: Date;\r\n  protected selectedMonth: Date;\r\n  protected selectedEl: HTMLElement;\r\n\r\n  protected timeDiv: HTMLDivElement;\r\n  protected hoursInputField: InputField;\r\n  protected minutesInputField: InputField;\r\n\r\n  constructor(initDate: Date, public onPick: (timestamp: number) => void, protected options: Partial<{\r\n    noButtons: true,\r\n    noTitle: true,\r\n    minDate: Date,\r\n    maxDate: Date\r\n    withTime: true,\r\n    showOverflowMonths: true\r\n  }> & PopupOptions = {}) {\r\n    super('popup-date-picker', {\r\n      body: true,\r\n      overlayClosable: true,\r\n      buttons: options.noButtons ? [] : [{\r\n        langKey: 'JumpToDate',\r\n        callback: () => {\r\n          if(this.onPick) {\r\n            this.onPick(this.selectedDate.getTime() / 1000 | 0);\r\n          }\r\n        }\r\n      }, {\r\n        langKey: 'Cancel',\r\n        isCancel: true\r\n      }],\r\n      title: true,\r\n      ...options\r\n    });\r\n\r\n    this.minDate = options.minDate || new Date('2013-08-01T00:00:00');\r\n\r\n    if(initDate < this.minDate) {\r\n      initDate.setFullYear(this.minDate.getFullYear(), this.minDate.getMonth(), this.minDate.getDate());\r\n    }\r\n\r\n    // Controls\r\n    this.controlsDiv = document.createElement('div');\r\n    this.controlsDiv.classList.add('date-picker-controls');\r\n\r\n    this.prevBtn = document.createElement('button');\r\n    this.prevBtn.classList.add('btn-icon', 'tgico-down', 'date-picker-prev');\r\n    attachClickEvent(this.prevBtn, this.onPrevClick, {listenerSetter: this.listenerSetter});\r\n\r\n    this.nextBtn = document.createElement('button');\r\n    this.nextBtn.classList.add('btn-icon', 'tgico-down', 'date-picker-next');\r\n    attachClickEvent(this.nextBtn, this.onNextClick, {listenerSetter: this.listenerSetter});\r\n\r\n    this.monthTitle = document.createElement('div');\r\n    this.monthTitle.classList.add('date-picker-month-title');\r\n\r\n    this.controlsDiv.append(this.prevBtn, this.monthTitle, this.nextBtn);\r\n\r\n    // Month\r\n    this.monthsContainer = document.createElement('div');\r\n    this.monthsContainer.classList.add('date-picker-months');\r\n    attachClickEvent(this.monthsContainer, this.onDateClick, {listenerSetter: this.listenerSetter});\r\n\r\n    this.body.append(this.controlsDiv, this.monthsContainer);\r\n\r\n    // Time inputs\r\n    if(options.withTime) {\r\n      this.timeDiv = document.createElement('div');\r\n      this.timeDiv.classList.add('date-picker-time');\r\n\r\n      const delimiter = document.createElement('div');\r\n      delimiter.classList.add('date-picker-time-delimiter');\r\n      delimiter.append(':');\r\n\r\n      const handleTimeInput = (max: number, inputField: InputField, onInput: (length: number) => void, onOverflow?: (number: number) => void) => {\r\n        const maxString = '' + max;\r\n        this.listenerSetter.add(inputField.input)('input', (e) => {\r\n          let value = inputField.value.replace(/\\D/g, '');\r\n          if(value.length > 2) {\r\n            value = value.slice(0, 2);\r\n          } else {\r\n            if((value.length === 1 && +value[0] > +maxString[0]) || (value.length === 2 && +value > max)) {\r\n              if(value.length === 2 && onOverflow) {\r\n                onOverflow(+value[1]);\r\n              }\r\n\r\n              value = '0' + value[0];\r\n            }\r\n          }\r\n\r\n          inputField.setValueSilently(value);\r\n          onInput(value.length);\r\n        });\r\n      };\r\n\r\n      this.hoursInputField = new InputField({plainText: true});\r\n      this.minutesInputField = new InputField({plainText: true});\r\n\r\n      handleTimeInput(23, this.hoursInputField, (length) => {\r\n        if(length === 2) {\r\n          this.minutesInputField.input.focus();\r\n        }\r\n\r\n        this.setTimeTitle();\r\n      }, (number) => {\r\n        this.minutesInputField.value = (number + this.minutesInputField.value).slice(0, 2);\r\n      });\r\n      handleTimeInput(59, this.minutesInputField, (length) => {\r\n        if(!length) {\r\n          this.hoursInputField.input.focus();\r\n        }\r\n\r\n        this.setTimeTitle();\r\n      });\r\n\r\n      this.selectedDate = initDate;\r\n\r\n      initDate.setMinutes(initDate.getMinutes() + 10);\r\n\r\n      this.hoursInputField.setValueSilently(('0' + initDate.getHours()).slice(-2));\r\n      this.minutesInputField.setValueSilently(('0' + initDate.getMinutes()).slice(-2));\r\n\r\n      initDate.setHours(0, 0, 0, 0);\r\n\r\n      this.timeDiv.append(this.hoursInputField.container, delimiter, this.minutesInputField.container);\r\n\r\n      attachClickEvent(this.btnConfirm, () => {\r\n        if(this.onPick) {\r\n          this.selectedDate.setHours(+this.hoursInputField.value || 0, +this.minutesInputField.value || 0, 0, 0);\r\n          this.onPick(this.selectedDate.getTime() / 1000 | 0);\r\n        }\r\n\r\n        this.hide();\r\n      }, {listenerSetter: this.listenerSetter});\r\n\r\n      this.body.append(this.timeDiv);\r\n\r\n      this.prevBtn.classList.add('primary');\r\n      this.nextBtn.classList.add('primary');\r\n    }\r\n\r\n    const popupCenterer = document.createElement('div');\r\n    popupCenterer.classList.add('popup-centerer');\r\n    popupCenterer.append(this.container);\r\n    this.element.append(popupCenterer);\r\n\r\n    // const passed = (initDate.getTime() - (initDate.getTimezoneOffset() * 60000)) % 86400000;\r\n    // this.selectedDate = this.maxDate = new Date(initDate.getTime() - passed);\r\n    initDate.setHours(0, 0, 0, 0);\r\n    this.selectedDate = initDate;\r\n\r\n    this.maxDate = options.maxDate || new Date();\r\n    this.maxDate.setHours(0, 0, 0, 0);\r\n\r\n    this.selectedMonth = new Date(this.selectedDate);\r\n    this.selectedMonth.setDate(1);\r\n\r\n    this.maxMonth = new Date(this.maxDate);\r\n    this.maxMonth.setDate(1);\r\n\r\n    this.minMonth = new Date(this.minDate);\r\n    this.minMonth.setHours(0, 0, 0, 0);\r\n    this.minMonth.setDate(1);\r\n\r\n    if(this.selectedMonth.getTime() === this.minMonth.getTime()) {\r\n      this.prevBtn.setAttribute('disabled', 'true');\r\n    }\r\n\r\n    if(this.selectedMonth.getTime() === this.maxMonth.getTime()) {\r\n      this.nextBtn.setAttribute('disabled', 'true');\r\n    }\r\n\r\n    if(options.noTitle) {\r\n      this.setTitle = () => {};\r\n    }\r\n\r\n    this.setTimeTitle();\r\n    this.setTitle();\r\n    this.setMonth();\r\n  }\r\n\r\n  onPrevClick = (e: MouseEvent) => {\r\n    this.selectedMonth.setMonth(this.selectedMonth.getMonth() - 1);\r\n    this.setMonth();\r\n\r\n    if(this.selectedMonth.getTime() === this.minMonth.getTime()) {\r\n      this.prevBtn.setAttribute('disabled', 'true');\r\n    }\r\n\r\n    this.nextBtn.removeAttribute('disabled');\r\n  };\r\n\r\n  onNextClick = (e: MouseEvent) => {\r\n    this.selectedMonth.setMonth(this.selectedMonth.getMonth() + 1);\r\n    this.setMonth();\r\n\r\n    if(this.selectedMonth.getTime() === this.maxMonth.getTime()) {\r\n      this.nextBtn.setAttribute('disabled', 'true');\r\n    }\r\n\r\n    this.prevBtn.removeAttribute('disabled');\r\n  };\r\n\r\n  onDateClick = (e: MouseEvent) => {\r\n    // cancelEvent(e);\r\n    const target = e.target as HTMLElement;\r\n\r\n    if(!target.dataset.timestamp) return;\r\n\r\n    if(this.selectedEl) {\r\n      if(this.selectedEl === target) return;\r\n      this.selectedEl.classList.remove('active');\r\n    }\r\n\r\n    this.selectedEl = target;\r\n\r\n    target.classList.add('active');\r\n    const timestamp = +target.dataset.timestamp;\r\n\r\n    this.selectedDate = new Date(timestamp);\r\n\r\n    this.setTitle();\r\n    this.setTimeTitle();\r\n  };\r\n\r\n  public setTimeTitle() {\r\n    if(this.btnConfirm && this.selectedDate) {\r\n      let key: LangPackKey;\r\n      const args: FormatterArguments = [];\r\n      const date = new Date();\r\n      date.setHours(0, 0, 0, 0);\r\n\r\n      const timeOptions: Intl.DateTimeFormatOptions = {\r\n        minute: '2-digit',\r\n        hour: '2-digit'\r\n      };\r\n\r\n      const sendDate = new Date(this.selectedDate.getTime());\r\n      sendDate.setHours(+this.hoursInputField.value, +this.minutesInputField.value);\r\n\r\n      if(this.selectedDate.getTime() === date.getTime()) {\r\n        key = 'Schedule.SendToday';\r\n      }/*  else if(this.selectedDate.getTime() === (date.getTime() + 86400e3)) {\r\n        dayStr = 'Tomorrow';\r\n      } */ else {\r\n        key = 'Schedule.SendDate';\r\n\r\n        const dateOptions: Intl.DateTimeFormatOptions = {\r\n          month: 'short',\r\n          day: 'numeric'\r\n        };\r\n\r\n        if(sendDate.getFullYear() !== date.getFullYear()) {\r\n          dateOptions.year = 'numeric';\r\n        }\r\n\r\n        args.push(new I18n.IntlDateElement({\r\n          date: sendDate,\r\n          options: dateOptions\r\n        }).element);\r\n      }\r\n\r\n      args.push(new I18n.IntlDateElement({\r\n        date: sendDate,\r\n        options: timeOptions\r\n      }).element);\r\n\r\n      this.btnConfirm.firstChild.replaceWith(i18n(key, args));\r\n    }\r\n  }\r\n\r\n  public setTitle() {\r\n    // const splitted = this.selectedDate.toString().split(' ', 3);\r\n    // this.title.innerText = splitted[0] + ', ' + splitted[1] + ' ' + splitted[2];\r\n    this.title.textContent = '';\r\n    this.title.append(new I18n.IntlDateElement({\r\n      date: this.selectedDate,\r\n      options: {\r\n        day: 'numeric',\r\n        month: 'long',\r\n        weekday: 'short'\r\n      }\r\n    }).element);\r\n  }\r\n\r\n  private renderElement(disabled: boolean, innerText: string | HTMLElement = '') {\r\n    const el = document.createElement('button');\r\n    el.classList.add('btn-icon', 'date-picker-month-date');\r\n\r\n    if(disabled) {\r\n      el.setAttribute('disabled', 'true');\r\n    }\r\n\r\n    if(innerText) {\r\n      el.append(innerText);\r\n    }\r\n\r\n    return el;\r\n  }\r\n\r\n  public setMonth() {\r\n    const firstDate = new Date(this.selectedMonth);\r\n\r\n    const options: Intl.DateTimeFormatOptions = {\r\n      year: 'numeric',\r\n      month: this.timeDiv && mediaSizes.isMobile ? 'short' : 'long'\r\n    };\r\n\r\n    this.monthTitle.textContent = '';\r\n    this.monthTitle.append(new I18n.IntlDateElement({date: firstDate, options}).element);\r\n    // this.monthTitle.innerText = (this.timeDiv && mediaSizes.isMobile ? monthName.slice(0, 3) : monthName) + ' ' + this.selectedMonth.getFullYear();\r\n\r\n    if(this.month) {\r\n      this.month.remove();\r\n    }\r\n\r\n    this.month = document.createElement('div');\r\n    this.month.classList.add('date-picker-month');\r\n\r\n    const weekStartDate = new Date();\r\n    const day = weekStartDate.getDay();\r\n    if(day !== 1) {\r\n      weekStartDate.setHours(-24 * (day - 1));\r\n    }\r\n\r\n    for(let i = 0; i < 7; ++i) {\r\n      const el = this.renderElement(true, new I18n.IntlDateElement({date: weekStartDate, options: {weekday: 'narrow'}}).element);\r\n      el.classList.remove('date-picker-month-date');\r\n      el.classList.add('date-picker-month-day');\r\n      this.month.append(el);\r\n      weekStartDate.setDate(weekStartDate.getDate() + 1);\r\n    }\r\n\r\n    // 0 - sunday\r\n    let dayIndex = firstDate.getDay() - 1;\r\n    if(dayIndex === -1) dayIndex = 7 - 1;\r\n\r\n    const clonedDate = new Date(firstDate.getTime());\r\n    clonedDate.setDate(clonedDate.getDate() - dayIndex - 1);\r\n\r\n    // Padding first week\r\n    for(let i = 0; i < dayIndex; ++i) {\r\n      if(this.options.showOverflowMonths) {\r\n        clonedDate.setDate(clonedDate.getDate() + 1);\r\n        this.month.append(this.renderElement(true, '' + clonedDate.getDate()));\r\n      } else {\r\n        this.month.append(this.renderElement(true));\r\n      }\r\n    }\r\n\r\n    do {\r\n      const date = firstDate.getDate();\r\n      const el = this.renderElement(firstDate > this.maxDate || firstDate < this.minDate, '' + date);\r\n      el.dataset.timestamp = '' + firstDate.getTime();\r\n\r\n      if(firstDate.getTime() === this.selectedDate.getTime()) {\r\n        this.selectedEl = el;\r\n        el.classList.add('active');\r\n      }\r\n\r\n      this.month.append(el);\r\n\r\n      firstDate.setDate(date + 1);\r\n    } while(firstDate.getDate() !== 1);\r\n\r\n    const remainder = this.month.childElementCount % 7;\r\n    if(this.options.showOverflowMonths && remainder) {\r\n      for(let i = remainder; i < 7; ++i) {\r\n        this.month.append(this.renderElement(true, '' + firstDate.getDate()));\r\n        firstDate.setDate(firstDate.getDate() + 1);\r\n      }\r\n    }\r\n\r\n    const lines = Math.ceil(this.month.childElementCount / 7);\r\n    this.container.dataset.lines = '' + lines;\r\n\r\n    this.monthsContainer.append(this.month);\r\n  }\r\n}\r\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport callbackify from '../../helpers/callbackify';\nimport formatNumber from '../../helpers/number/formatNumber';\nimport {fastRaf} from '../../helpers/schedulers';\nimport {MessagePeerReaction, ReactionCount} from '../../layer';\nimport {AppManagers} from '../../lib/appManagers/managers';\nimport getPeerId from '../../lib/appManagers/utils/peers/getPeerId';\nimport RLottiePlayer from '../../lib/rlottie/rlottiePlayer';\nimport rootScope from '../../lib/rootScope';\nimport SetTransition from '../singleTransition';\nimport StackedAvatars from '../stackedAvatars';\nimport {wrapSticker, wrapStickerAnimation} from '../wrappers';\nimport {Awaited} from '../../types';\n\nconst CLASS_NAME = 'reaction';\nconst TAG_NAME = CLASS_NAME + '-element';\nconst REACTION_INLINE_SIZE = 14;\nconst REACTION_BLOCK_SIZE = 22;\n\nexport const REACTION_DISPLAY_INLINE_COUNTER_AT = 2;\nexport const REACTION_DISPLAY_BLOCK_COUNTER_AT = 4;\n\nexport type ReactionLayoutType = 'block' | 'inline';\n\nexport default class ReactionElement extends HTMLElement {\n  private type: ReactionLayoutType;\n  private counter: HTMLElement;\n  private stickerContainer: HTMLElement;\n  private stackedAvatars: StackedAvatars;\n  private canRenderAvatars: boolean;\n  private _reactionCount: ReactionCount;\n  private wrapStickerPromise: Awaited<ReturnType<typeof wrapSticker>>['render'];\n  private managers: AppManagers;\n\n  constructor() {\n    super();\n    this.classList.add(CLASS_NAME);\n    this.managers = rootScope.managers;\n  }\n\n  public get reactionCount() {\n    return this._reactionCount;\n  }\n\n  public set reactionCount(reactionCount: ReactionCount) {\n    this._reactionCount = reactionCount;\n  }\n\n  public get count() {\n    return this.reactionCount.count;\n  }\n\n  public init(type: ReactionLayoutType) {\n    this.type = type;\n    this.classList.add(CLASS_NAME + '-' + type);\n  }\n\n  public setCanRenderAvatars(canRenderAvatars: boolean) {\n    this.canRenderAvatars = canRenderAvatars;\n  }\n\n  public render(doNotRenderSticker?: boolean) {\n    const hadStickerContainer = !!this.stickerContainer;\n    if(!hadStickerContainer) {\n      this.stickerContainer = document.createElement('div');\n      this.stickerContainer.classList.add(CLASS_NAME + '-sticker');\n      this.append(this.stickerContainer);\n    }\n\n    const reactionCount = this.reactionCount;\n    if(!doNotRenderSticker && !hadStickerContainer) {\n      const availableReaction = this.managers.appReactionsManager.getReaction(reactionCount.reaction);\n      callbackify(availableReaction, (availableReaction) => {\n        if(!availableReaction.center_icon) {\n          this.stickerContainer.classList.add('is-static');\n        }\n\n        if(availableReaction.pFlags.inactive) {\n          this.classList.add('is-inactive');\n        }\n\n        const size = this.type === 'inline' ? REACTION_INLINE_SIZE : REACTION_BLOCK_SIZE;\n        const wrapPromise = this.wrapStickerPromise = wrapSticker({\n          div: this.stickerContainer,\n          doc: availableReaction.center_icon ?? availableReaction.static_icon,\n          width: size,\n          height: size,\n          static: true,\n          managers: this.managers\n        }).then(({render}) => render).finally(() => {\n          if(this.wrapStickerPromise === wrapPromise) {\n            this.wrapStickerPromise = undefined;\n          }\n        });\n      });\n    }\n  }\n\n  public renderCounter() {\n    const reactionCount = this.reactionCount;\n    const displayOn = this.type === 'inline' ? REACTION_DISPLAY_INLINE_COUNTER_AT : REACTION_DISPLAY_BLOCK_COUNTER_AT;\n    if(reactionCount.count >= displayOn || (this.type === 'block' && !this.canRenderAvatars)) {\n      if(!this.counter) {\n        this.counter = document.createElement(this.type === 'inline' ? 'i' : 'span');\n        this.counter.classList.add(CLASS_NAME + '-counter');\n      }\n\n      const formatted = formatNumber(reactionCount.count);\n      if(this.counter.textContent !== formatted) {\n        this.counter.textContent = formatted;\n      }\n\n      if(!this.counter.parentElement) {\n        this.append(this.counter);\n      }\n    } else if(this.counter?.parentElement) {\n      this.counter.remove();\n      this.counter = undefined;\n    }\n  }\n\n  public renderAvatars(recentReactions: MessagePeerReaction[]) {\n    if(this.type === 'inline') {\n      return;\n    }\n\n    if(this.reactionCount.count >= REACTION_DISPLAY_BLOCK_COUNTER_AT || !this.canRenderAvatars) {\n      if(this.stackedAvatars) {\n        this.stackedAvatars.container.remove();\n        this.stackedAvatars = undefined;\n      }\n\n      return;\n    }\n\n    if(!this.stackedAvatars) {\n      this.stackedAvatars = new StackedAvatars({\n        avatarSize: 24\n      });\n\n      this.append(this.stackedAvatars.container);\n    }\n\n    this.stackedAvatars.render(recentReactions.map((reaction) => getPeerId(reaction.peer_id)));\n  }\n\n  public setIsChosen(isChosen = !!this.reactionCount.pFlags.chosen) {\n    if(this.type === 'inline') return;\n    const wasChosen = this.classList.contains('is-chosen') && !this.classList.contains('backwards');\n    if(wasChosen !== isChosen) {\n      SetTransition(this, 'is-chosen', isChosen, this.isConnected ? 300 : 0);\n    }\n  }\n\n  public fireAroundAnimation() {\n    callbackify(this.managers.appReactionsManager.getReaction(this.reactionCount.reaction), (availableReaction) => {\n      const size = this.type === 'inline' ? REACTION_INLINE_SIZE + 14 : REACTION_BLOCK_SIZE + 18;\n      const div = document.createElement('div');\n      div.classList.add(CLASS_NAME + '-sticker-activate');\n\n      Promise.all([\n        wrapSticker({\n          div: div,\n          doc: availableReaction.center_icon,\n          width: size,\n          height: size,\n          withThumb: false,\n          needUpscale: true,\n          play: false,\n          skipRatio: 1,\n          group: 'none',\n          needFadeIn: false,\n          managers: this.managers\n        }).then(({render}) => render as Promise<RLottiePlayer>),\n\n        wrapStickerAnimation({\n          doc: availableReaction.around_animation,\n          size: 80,\n          target: this.stickerContainer,\n          side: 'center',\n          skipRatio: 1,\n          play: false,\n          managers: this.managers\n        }).stickerPromise\n      ]).then(([iconPlayer, aroundPlayer]) => {\n        const remove = () => {\n          // if(!isInDOM(div)) return;\n          fastRaf(() => {\n            // if(!isInDOM(div)) return;\n            iconPlayer.remove();\n            div.remove();\n            this.stickerContainer.classList.remove('has-animation');\n          });\n        };\n\n        iconPlayer.addEventListener('enterFrame', (frameNo) => {\n          if(frameNo === iconPlayer.maxFrame) {\n            if(this.wrapStickerPromise) { // wait for fade in animation\n              this.wrapStickerPromise.then(() => {\n                setTimeout(remove, 1e3);\n              });\n            } else {\n              remove();\n            }\n          }\n        });\n\n        iconPlayer.addEventListener('firstFrame', () => {\n          this.stickerContainer.append(div);\n          this.stickerContainer.classList.add('has-animation');\n          iconPlayer.play();\n          aroundPlayer.play();\n        }, {once: true});\n      });\n    });\n  }\n}\n\ncustomElements.define(TAG_NAME, ReactionElement);\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport forEachReverse from '../../helpers/array/forEachReverse';\nimport positionElementByIndex from '../../helpers/dom/positionElementByIndex';\nimport {Message, ReactionCount} from '../../layer';\nimport appImManager from '../../lib/appManagers/appImManager';\nimport {AppManagers} from '../../lib/appManagers/managers';\nimport rootScope from '../../lib/rootScope';\nimport ReactionElement, {ReactionLayoutType, REACTION_DISPLAY_BLOCK_COUNTER_AT} from './reaction';\n\nconst CLASS_NAME = 'reactions';\nconst TAG_NAME = CLASS_NAME + '-element';\n\nconst REACTIONS_ELEMENTS: Map<string, Set<ReactionsElement>> = new Map();\nexport {REACTIONS_ELEMENTS};\n\nexport default class ReactionsElement extends HTMLElement {\n  private message: Message.message;\n  private key: string;\n  private isPlaceholder: boolean;\n  private type: ReactionLayoutType;\n  private sorted: ReactionElement[];\n  private onConnectCallback: () => void;\n  private managers: AppManagers;\n\n  constructor() {\n    super();\n    this.classList.add(CLASS_NAME);\n    this.sorted = [];\n    this.managers = rootScope.managers;\n  }\n\n  connectedCallback() {\n    let set = REACTIONS_ELEMENTS.get(this.key);\n    if(!set) {\n      REACTIONS_ELEMENTS.set(this.key, set = new Set());\n    }\n\n    set.add(this);\n\n    if(this.onConnectCallback && this.isConnected) {\n      this.onConnectCallback();\n      this.onConnectCallback = undefined;\n    }\n  }\n\n  disconnectedCallback() {\n    const set = REACTIONS_ELEMENTS.get(this.key);\n    set.delete(this);\n    if(!set.size) {\n      REACTIONS_ELEMENTS.delete(this.key);\n    }\n  }\n\n  public getReactionCount(reactionElement: ReactionElement) {\n    return this.sorted[this.sorted.indexOf(reactionElement)].reactionCount;\n  }\n\n  public getMessage() {\n    return this.message;\n  }\n\n  public init(message: Message.message, type: ReactionLayoutType, isPlaceholder?: boolean) {\n    if(this.key !== undefined) {\n      this.disconnectedCallback();\n    }\n\n    this.message = message;\n    this.key = this.message.peerId + '_' + this.message.mid;\n    this.isPlaceholder = isPlaceholder;\n\n    if(this.type !== type) {\n      this.type = type;\n      this.classList.add(CLASS_NAME + '-' + type);\n    }\n\n    this.connectedCallback();\n  }\n\n  public changeMessage(message: Message.message) {\n    return this.init(message, this.type, this.isPlaceholder);\n  }\n\n  public update(message: Message.message, changedResults?: ReactionCount[]) {\n    this.message = message;\n    this.render(changedResults);\n  }\n\n  public render(changedResults?: ReactionCount[]) {\n    const reactions = this.message.reactions;\n    const hasReactions = !!(reactions && reactions.results.length);\n    this.classList.toggle('has-no-reactions', !hasReactions);\n    if(!hasReactions && !this.sorted.length) return;\n\n    const availableReactionsResult = this.managers.appReactionsManager.getAvailableReactions();\n    // callbackify(availableReactionsResult, () => {\n    const counts = hasReactions ? (\n        availableReactionsResult instanceof Promise ?\n          reactions.results :\n          reactions.results.filter((reactionCount) => {\n            return this.managers.appReactionsManager.isReactionActive(reactionCount.reaction);\n          })\n      ) : [];\n\n    forEachReverse(this.sorted, (reactionElement, idx, arr) => {\n      const reaction = reactionElement.reactionCount.reaction;\n      const found = counts.some((reactionCount) => reactionCount.reaction === reaction);\n      if(!found) {\n        arr.splice(idx, 1);\n        reactionElement.remove();\n      }\n    });\n\n    const totalReactions = counts.reduce((acc, c) => acc + c.count, 0);\n    const canRenderAvatars = reactions && !!reactions.pFlags.can_see_list && totalReactions < REACTION_DISPLAY_BLOCK_COUNTER_AT;\n    this.sorted = counts.map((reactionCount, idx) => {\n      const reactionElementIdx = this.sorted.findIndex((reactionElement) => reactionElement.reactionCount.reaction === reactionCount.reaction);\n      let reactionElement = reactionElementIdx !== -1 && this.sorted[reactionElementIdx];\n      if(!reactionElement) {\n        reactionElement = new ReactionElement();\n        reactionElement.init(this.type);\n      }\n\n      positionElementByIndex(reactionElement, this, idx);\n\n      const recentReactions = reactions.recent_reactions ? reactions.recent_reactions.filter((reaction) => reaction.reaction === reactionCount.reaction) : [];\n      reactionElement.reactionCount = {...reactionCount};\n      reactionElement.setCanRenderAvatars(canRenderAvatars);\n      reactionElement.render(this.isPlaceholder);\n      reactionElement.renderCounter();\n      reactionElement.renderAvatars(recentReactions);\n      reactionElement.setIsChosen();\n\n      return reactionElement;\n    });\n\n    // this.sorted.forEach((reactionElement, idx) => {\n    //   /* if(this.type === 'block' && this.childElementCount !== this.sorted.length) { // because of appended time\n    //     idx += 1;\n    //   } */\n\n    //   positionElementByIndex(reactionElement, this, idx);\n    // });\n\n    if(!this.isPlaceholder && changedResults?.length) {\n      if(this.isConnected) {\n        this.handleChangedResults(changedResults);\n      } else {\n        this.onConnectCallback = () => {\n          this.handleChangedResults(changedResults);\n        };\n      }\n    }\n    // });\n\n    // !       ,     \n    if(!this.sorted.length && this.type === 'block') {\n      const parentElement = this.parentElement;\n      this.remove();\n\n      if(parentElement.classList.contains('document-message') && !parentElement.childNodes.length) {\n        parentElement.remove();\n        return;\n      }\n\n      const timeSpan = this.querySelector('.time');\n      if(timeSpan) {\n        parentElement.append(timeSpan);\n      }\n    }\n  }\n\n  private handleChangedResults(changedResults: ReactionCount[]) {\n    // ! temp\n    if(this.message.peerId !== appImManager.chat.peerId) return;\n\n    changedResults.forEach((reactionCount) => {\n      const reactionElement = this.sorted.find((reactionElement) => reactionElement.reactionCount.reaction === reactionCount.reaction);\n      if(reactionElement) {\n        reactionElement.fireAroundAnimation();\n      }\n    });\n  }\n}\n\ncustomElements.define(TAG_NAME, ReactionsElement);\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport {Message} from '../../layer';\r\nimport rootScope from '../../lib/rootScope';\r\nimport ripple from '../ripple';\r\nimport I18n from '../../lib/langPack';\r\nimport replaceContent from '../../helpers/dom/replaceContent';\r\nimport StackedAvatars from '../stackedAvatars';\r\nimport formatNumber from '../../helpers/number/formatNumber';\r\nimport {AppManagers} from '../../lib/appManagers/managers';\r\nimport getPeerId from '../../lib/appManagers/utils/peers/getPeerId';\r\nimport type LazyLoadQueue from '../lazyLoadQueue';\r\n\r\nconst TAG_NAME = 'replies-element';\r\n\r\nrootScope.addEventListener('replies_updated', (message) => {\r\n  (Array.from(document.querySelectorAll(TAG_NAME + `[data-post-key=\"${message.peerId}_${message.mid}\"]`)) as RepliesElement[]).forEach((element) => {\r\n    element.message = message;\r\n    element.render();\r\n  });\r\n});\r\n\r\nexport default class RepliesElement extends HTMLElement {\r\n  public message: Message.message;\r\n  public type: 'footer' | 'beside';\r\n  public loadPromises: Promise<any>[];\r\n  public lazyLoadQueue: LazyLoadQueue;\r\n  public stackedAvatars: StackedAvatars;\r\n  public text: I18n.IntlElement;\r\n  public managers: AppManagers;\r\n\r\n  private updated = false;\r\n\r\n  constructor() {\r\n    super();\r\n    this.managers = rootScope.managers;\r\n  }\r\n\r\n  public init() {\r\n    this.render();\r\n    this.dataset.postKey = this.message.peerId + '_' + this.message.mid;\r\n    this.classList.add('replies', 'replies-' + this.type);\r\n  }\r\n\r\n  public render() {\r\n    const replies = this.message.replies;\r\n\r\n    /* if(this.firstChild) {\r\n      this.innerHTML = '';\r\n    } */\r\n\r\n    if(this.type === 'footer') {\r\n      let leftPart: HTMLElement;\r\n      if(this.firstElementChild) {\r\n        leftPart = this.firstElementChild as HTMLElement;\r\n      }\r\n\r\n      if(replies?.recent_repliers) {\r\n        if(leftPart && !leftPart.classList.contains('replies-footer-avatars')) {\r\n          this.innerHTML = '';\r\n          leftPart = null;\r\n        }\r\n\r\n        if(!this.stackedAvatars) {\r\n          this.stackedAvatars = new StackedAvatars({\r\n            lazyLoadQueue: this.lazyLoadQueue,\r\n            avatarSize: 30\r\n          });\r\n\r\n          this.stackedAvatars.container.classList.add('replies-footer-avatars');\r\n        }\r\n\r\n        leftPart = this.stackedAvatars.container;\r\n\r\n        this.stackedAvatars.render(replies.recent_repliers.map((peer) => getPeerId(peer)), this.loadPromises);\r\n      } else {\r\n        if(leftPart && !leftPart.classList.contains('tgico-comments')) {\r\n          leftPart.remove();\r\n          leftPart = null;\r\n        }\r\n\r\n        if(!leftPart) {\r\n          leftPart = document.createElement('span');\r\n          leftPart.classList.add('tgico-comments');\r\n        }\r\n      }\r\n\r\n      if(!leftPart.parentElement) {\r\n        this.prepend(leftPart);\r\n      }\r\n\r\n      if(!this.text) {\r\n        this.text = new I18n.IntlElement();\r\n      }\r\n\r\n      const text = this.text;\r\n      if(replies) {\r\n        if(replies.replies) {\r\n          text.compareAndUpdate({key: 'Comments', args: [replies.replies]});\r\n        } else {\r\n          text.compareAndUpdate({key: 'LeaveAComment'});\r\n        }\r\n      } else {\r\n        text.compareAndUpdate({key: 'ViewInChat'});\r\n      }\r\n\r\n      if(replies) {\r\n        // const historyStorage = appMessagesManager.getHistoryStorage(replies.channel_id.toPeerId(true));\r\n        let isUnread = false;\r\n        if(replies.replies) {\r\n          if(replies.read_max_id !== undefined && replies.max_id !== undefined) {\r\n            isUnread = replies.read_max_id < replies.max_id;\r\n          }/*  else {\r\n            isUnread = !historyStorage.readMaxId || historyStorage.readMaxId < (replies.max_id || 0);\r\n          } */\r\n        }\r\n        this.classList.toggle('is-unread', isUnread);\r\n      }\r\n\r\n      let textSpan = this.children[1] as HTMLElement;\r\n      if(!textSpan) {\r\n        textSpan = document.createElement('span');\r\n        textSpan.classList.add('replies-footer-text');\r\n\r\n        const iconSpan = document.createElement('span');\r\n        iconSpan.classList.add('tgico-next');\r\n\r\n        const rippleContainer = document.createElement('div');\r\n        ripple(rippleContainer);\r\n\r\n        this.append(textSpan, iconSpan, rippleContainer);\r\n      }\r\n\r\n      replaceContent(textSpan, text.element);\r\n    } else {\r\n      this.classList.add('bubble-beside-button');\r\n      this.innerHTML = `<span class=\"tgico-commentssticker\"></span><span class=\"replies-beside-text\">${replies?.replies ? formatNumber(replies.replies, 0) : ''}</span>`;\r\n    }\r\n\r\n    if(replies && !this.updated && !this.message.pFlags.is_outgoing) {\r\n      this.managers.appMessagesManager.subscribeRepliesThread(this.message.peerId, this.message.mid);\r\n      this.managers.appMessagesManager.updateMessage(this.message.peerId, this.message.mid, 'replies_updated');\r\n      this.updated = true;\r\n    }\r\n\r\n    if(this.loadPromises) {\r\n      this.loadPromises = undefined;\r\n    }\r\n  }\r\n}\r\n\r\ncustomElements.define(TAG_NAME, RepliesElement);\r\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport {formatTime, getFullDate} from '../../helpers/date';\nimport setInnerHTML from '../../helpers/dom/setInnerHTML';\nimport formatNumber from '../../helpers/number/formatNumber';\nimport {Message} from '../../layer';\nimport getPeerId from '../../lib/appManagers/utils/peers/getPeerId';\nimport {i18n, _i18n} from '../../lib/langPack';\nimport wrapEmojiText from '../../lib/richTextProcessor/wrapEmojiText';\nimport rootScope from '../../lib/rootScope';\nimport type LazyLoadQueue from '../lazyLoadQueue';\nimport PeerTitle from '../peerTitle';\nimport {wrapReply} from '../wrappers';\nimport Chat, {ChatType} from './chat';\nimport ReactionsElement from './reactions';\nimport RepliesElement from './replies';\n\nconst NBSP = '&nbsp;';\n\nconst makeEdited = () => {\n  const edited = document.createElement('i');\n  edited.classList.add('edited');\n  _i18n(edited, 'EditedMessage');\n  return edited;\n};\n\nconst makeSponsored = () => i18n('SponsoredMessage');\n\nexport namespace MessageRender {\n  /* export const setText = () => {\n\n  }; */\n\n  export const setTime = (options: {\n    chatType: ChatType,\n    message: Message.message | Message.messageService,\n    reactionsMessage?: Message.message\n  }) => {\n    const {chatType, message} = options;\n    const date = new Date(message.date * 1000);\n    const args: (HTMLElement | string)[] = [];\n\n    let editedSpan: HTMLElement, sponsoredSpan: HTMLElement, reactionsElement: ReactionsElement, reactionsMessage: Message.message;\n\n    const isSponsored = !!(message as Message.message).pFlags.sponsored;\n    const isMessage = !('action' in message) && !isSponsored;\n    let hasReactions: boolean;\n\n    const time: HTMLElement = isSponsored ? undefined : formatTime(date);\n    if(isMessage) {\n      if(message.views) {\n        const postAuthor = message.post_author || message.fwd_from?.post_author;\n\n        const postViewsSpan = document.createElement('span');\n        postViewsSpan.classList.add('post-views');\n        postViewsSpan.innerHTML = formatNumber(message.views, 1);\n\n        const channelViews = document.createElement('i');\n        channelViews.classList.add('tgico-channelviews', 'time-icon');\n\n        args.push(postViewsSpan, channelViews);\n        if(postAuthor) {\n          const span = document.createElement('span');\n          setInnerHTML(span, wrapEmojiText(postAuthor));\n          span.insertAdjacentHTML('beforeend', ',' + NBSP)\n          args.push(span);\n        }\n      }\n\n      if(message.edit_date && chatType !== 'scheduled' && !message.pFlags.edit_hide) {\n        args.unshift(editedSpan = makeEdited());\n      }\n\n      if(chatType !== 'pinned' && message.pFlags.pinned) {\n        const i = document.createElement('i');\n        i.classList.add('tgico-pinnedchat', 'time-icon');\n        args.unshift(i);\n      }\n\n      if(message.peer_id._ === 'peerUser'/*  && message.reactions?.results?.length */) {\n        hasReactions = true;\n\n        reactionsMessage = options.reactionsMessage;\n        reactionsElement = new ReactionsElement();\n        reactionsElement.init(reactionsMessage, 'inline', true);\n        reactionsElement.render();\n        args.unshift(reactionsElement);\n      }\n    } else if(isSponsored) {\n      args.push(sponsoredSpan = makeSponsored());\n    }\n\n    if(time) {\n      args.push(time);\n    }\n\n    let title = isSponsored ? undefined : getFullDate(date);\n    if(isMessage) {\n      title += (message.edit_date && !message.pFlags.edit_hide ? `\\nEdited: ${getFullDate(new Date(message.edit_date * 1000))}` : '') +\n        (message.fwd_from ? `\\nOriginal: ${getFullDate(new Date(message.fwd_from.date * 1000))}` : '');\n    }\n\n    const timeSpan = document.createElement('span');\n    timeSpan.classList.add('time', 'tgico');\n    // if(title) timeSpan.title = title;\n    timeSpan.append(...args);\n\n    const inner = document.createElement('div');\n    inner.classList.add('inner', 'tgico');\n    if(title) inner.title = title;\n\n    let clonedArgs = args;\n    if(editedSpan) {\n      clonedArgs[clonedArgs.indexOf(editedSpan)] = makeEdited();\n    }\n    if(sponsoredSpan) {\n      clonedArgs[clonedArgs.indexOf(sponsoredSpan)] = makeSponsored();\n    }\n    if(reactionsElement) {\n      const _reactionsElement = clonedArgs[clonedArgs.indexOf(reactionsElement)] = new ReactionsElement();\n      _reactionsElement.init(reactionsMessage, 'inline');\n      _reactionsElement.render();\n    }\n    clonedArgs = clonedArgs.map((a) => a instanceof HTMLElement && !a.classList.contains('i18n') && !a.classList.contains('reactions') ? a.cloneNode(true) as HTMLElement : a);\n    if(time) {\n      clonedArgs[clonedArgs.length - 1] = formatTime(date); // clone time\n    }\n    inner.append(...clonedArgs);\n\n    timeSpan.append(inner);\n\n    return timeSpan;\n  };\n\n  export const renderReplies = ({bubble, bubbleContainer, message, messageDiv, loadPromises, lazyLoadQueue}: {\n    bubble: HTMLElement,\n    bubbleContainer: HTMLElement,\n    message: Message.message,\n    messageDiv: HTMLElement,\n    loadPromises?: Promise<any>[],\n    lazyLoadQueue?: LazyLoadQueue\n  }) => {\n    const isFooter = !bubble.classList.contains('sticker') && !bubble.classList.contains('emoji-big') && !bubble.classList.contains('round');\n    const repliesFooter = new RepliesElement();\n    repliesFooter.message = message;\n    repliesFooter.type = isFooter ? 'footer' : 'beside';\n    repliesFooter.loadPromises = loadPromises;\n    repliesFooter.lazyLoadQueue = lazyLoadQueue;\n    repliesFooter.init();\n    bubbleContainer.prepend(repliesFooter);\n    return isFooter;\n  };\n\n  export const setReply = async({chat, bubble, bubbleContainer, message}: {\n    chat: Chat,\n    bubble: HTMLElement,\n    bubbleContainer?: HTMLElement,\n    message: Message.message\n  }) => {\n    const isReplacing = !bubbleContainer;\n    if(isReplacing) {\n      bubbleContainer = bubble.querySelector('.bubble-content');\n    }\n\n    const currentReplyDiv = isReplacing ? bubbleContainer.querySelector('.reply') : null;\n    if(!message.reply_to_mid) {\n      if(currentReplyDiv) {\n        currentReplyDiv.remove();\n      }\n\n      bubble.classList.remove('is-reply');\n      return;\n    }\n\n\n    const replyToPeerId = message.reply_to.reply_to_peer_id ? getPeerId(message.reply_to.reply_to_peer_id) : chat.peerId;\n\n    const originalMessage = await rootScope.managers.appMessagesManager.getMessageByPeer(replyToPeerId, message.reply_to_mid);\n    let originalPeerTitle: string | HTMLElement;\n\n    // ///////this.log('message to render reply', originalMessage, originalPeerTitle, bubble, message);\n\n    let titlePeerId: PeerId;\n    // need to download separately\n    if(!originalMessage) {\n      // ////////this.log('message to render reply empty, need download', message, message.reply_to_mid);\n      rootScope.managers.appMessagesManager.fetchMessageReplyTo(message);\n      chat.bubbles.needUpdate.push({replyToPeerId, replyMid: message.reply_to_mid, mid: message.mid});\n\n      originalPeerTitle = i18n('Loading');\n    } else {\n      const originalMessageFwdFromId = (originalMessage as Message.message).fwdFromId;\n      titlePeerId = message.fwdFromId && message.fwdFromId === originalMessageFwdFromId ? message.fwdFromId : originalMessage.fromId || originalMessageFwdFromId;\n      originalPeerTitle = new PeerTitle({\n        peerId: titlePeerId,\n        dialog: false,\n        onlyFirstName: false,\n        plainText: false\n      }).element;\n    }\n\n    const {container, fillPromise} = wrapReply(originalPeerTitle, undefined, originalMessage, chat.isAnyGroup ? titlePeerId : undefined);\n    await fillPromise;\n    if(currentReplyDiv) {\n      currentReplyDiv.replaceWith(container);\n    } else {\n      bubbleContainer.append(container);\n    }\n    // bubbleContainer.insertBefore(, nameContainer);\n    bubble.classList.add('is-reply');\n  };\n}\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport {MOUNT_CLASS_TO} from '../../config/debug';\r\n\r\nexport function getElementByPoint(container: HTMLElement, verticalSide: 'top' | 'bottom', horizontalSide: 'center' | 'left'): HTMLElement {\r\n  // return null;\r\n  const rect = container.getBoundingClientRect();\r\n  const x = horizontalSide === 'center' ? Math.ceil(rect.left + ((rect.right - rect.left) / 2) + 1) : Math.ceil(rect.left + 1);\r\n  const y = verticalSide === 'bottom' ? Math.floor(rect.top + rect.height - 1) : Math.ceil(rect.top + 1);\r\n  return document.elementFromPoint(x, y) as any;\r\n};\r\n\r\nMOUNT_CLASS_TO.getElementByPoint = getElementByPoint;\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nexport default function reflowScrollableElement(element: HTMLElement) {\r\n  element.style.display = 'none';\r\n  void element.offsetLeft; // reflow\r\n  element.style.display = '';\r\n}\r\n","export const SEND_WHEN_ONLINE_TIMESTAMP = 0x7FFFFFFE;\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nexport enum INTERNAL_LINK_TYPE {\n  MESSAGE,\n  PRIVATE_POST,\n  STICKER_SET,\n  JOIN_CHAT,\n  VOICE_CHAT,\n  USER_PHONE_NUMBER,\n  INVOICE,\n  EMOJI_SET\n};\n\nexport type InternalLink = InternalLink.InternalLinkMessage | InternalLink.InternalLinkPrivatePost | InternalLink.InternalLinkStickerSet | InternalLink.InternalLinkJoinChat | InternalLink.InternalLinkVoiceChat | InternalLink.InternalLinkUserPhoneNumber | InternalLink.InternalLinkInvoice | InternalLink.InternalLinkEmojiSet;\n\nexport namespace InternalLink {\n  export interface InternalLinkMessage {\n    _: INTERNAL_LINK_TYPE.MESSAGE,\n    domain: string,\n    post?: string,\n    comment?: string,\n    start?: string\n  }\n\n  export interface InternalLinkPrivatePost {\n    _: INTERNAL_LINK_TYPE.PRIVATE_POST,\n    channel: string,\n    post: string,\n    thread?: string,\n    comment?: string\n  }\n\n  export interface InternalLinkStickerSet {\n    _: INTERNAL_LINK_TYPE.STICKER_SET,\n    set: string\n  }\n\n  export interface InternalLinkJoinChat {\n    _: INTERNAL_LINK_TYPE.JOIN_CHAT,\n    invite: string\n  }\n\n  /**\n   * LOCAL LINK\n   */\n  export interface InternalLinkVoiceChat {\n    _: INTERNAL_LINK_TYPE.VOICE_CHAT,\n    id: string,\n    access_hash: string,\n    chat_id: string\n  }\n\n  export interface InternalLinkUserPhoneNumber {\n    _: INTERNAL_LINK_TYPE.USER_PHONE_NUMBER,\n    phone: string\n  }\n\n  export interface InternalLinkInvoice {\n    _: INTERNAL_LINK_TYPE.INVOICE,\n    slug: string\n  }\n\n  export interface InternalLinkEmojiSet {\n    _: INTERNAL_LINK_TYPE.EMOJI_SET,\n    set: string\n  }\n}\n\nexport type InternalLinkTypeMap = {\n  [INTERNAL_LINK_TYPE.MESSAGE]: InternalLink.InternalLinkMessage,\n  [INTERNAL_LINK_TYPE.PRIVATE_POST]: InternalLink.InternalLinkPrivatePost,\n  [INTERNAL_LINK_TYPE.STICKER_SET]: InternalLink.InternalLinkStickerSet,\n  [INTERNAL_LINK_TYPE.JOIN_CHAT]: InternalLink.InternalLinkJoinChat,\n  [INTERNAL_LINK_TYPE.VOICE_CHAT]: InternalLink.InternalLinkVoiceChat,\n  [INTERNAL_LINK_TYPE.USER_PHONE_NUMBER]: InternalLink.InternalLinkUserPhoneNumber,\n  [INTERNAL_LINK_TYPE.INVOICE]: InternalLink.InternalLinkInvoice,\n  [INTERNAL_LINK_TYPE.EMOJI_SET]: InternalLink.InternalLinkEmojiSet\n};\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport PopupElement, {addCancelButton} from '.';\r\nimport setInnerHTML from '../../helpers/dom/setInnerHTML';\r\nimport numberThousandSplitter from '../../helpers/number/numberThousandSplitter';\r\nimport {ChatInvite} from '../../layer';\r\nimport appImManager from '../../lib/appManagers/appImManager';\r\nimport {i18n, _i18n} from '../../lib/langPack';\r\nimport {NULL_PEER_ID} from '../../lib/mtproto/mtproto_config';\r\nimport wrapEmojiText from '../../lib/richTextProcessor/wrapEmojiText';\r\nimport AvatarElement from '../avatar';\r\nimport putPhoto from '../putPhoto';\r\nimport {toastNew} from '../toast';\r\nimport {wrapPhoto} from '../wrappers';\r\n\r\n// const FAKE_CHAT_ID = Number.MAX_SAFE_INTEGER - 0x1000;\r\n\r\nexport default class PopupJoinChatInvite extends PopupElement {\r\n  constructor(\r\n    private hash: string,\r\n    private chatInvite: ChatInvite.chatInvite\r\n  ) {\r\n    super('popup-join-chat-invite', {\r\n      closable: true,\r\n      overlayClosable: true,\r\n      body: true,\r\n      buttons: addCancelButton([{\r\n        langKey: chatInvite.pFlags.request_needed ? 'RequestJoin.Button' : (chatInvite.pFlags.broadcast ? 'JoinByPeekChannelTitle' : 'JoinByPeekGroupTitle'),\r\n        callback: () => {\r\n          this.managers.appChatsManager.importChatInvite(hash)\r\n          .then((chatId) => {\r\n            const peerId = chatId.toPeerId(true);\r\n            appImManager.setInnerPeer({peerId});\r\n          }, (error) => {\r\n            if(error.type === 'INVITE_REQUEST_SENT') {\r\n              toastNew({langPackKey: 'RequestToJoinSent'});\r\n            }\r\n          });\r\n        }\r\n      }])\r\n    });\r\n\r\n    this.construct();\r\n  }\r\n\r\n  private async construct() {\r\n    this.header.remove();\r\n    /* const fakeChat: Chat.channel | Chat.chat = {\r\n      _: chatInvite.pFlags.channel ? 'channel' : 'chat',\r\n      id: FAKE_CHAT_ID,\r\n      title: chatInvite.title,\r\n      photo: chatInvite.photo as any,\r\n      date: Date.now() / 1000 | 0,\r\n      version: 0,\r\n      participants_count: chatInvite.participants_count,\r\n      pFlags: chatInvite.pFlags as any\r\n    };\r\n\r\n    appChatsManager.saveApiChat(fakeChat); */\r\n\r\n    const {chatInvite, managers, hash} = this;\r\n\r\n    const avatarElem = new AvatarElement();\r\n    avatarElem.classList.add('avatar-100');\r\n    avatarElem.isDialog = false;\r\n    if(chatInvite.photo._ === 'photo') {\r\n      chatInvite.photo = await managers.appPhotosManager.savePhoto(chatInvite.photo);\r\n      wrapPhoto({\r\n        container: avatarElem,\r\n        message: null,\r\n        photo: chatInvite.photo,\r\n        boxHeight: 100,\r\n        boxWidth: 100,\r\n        withoutPreloader: true\r\n      });\r\n      avatarElem.style.width = avatarElem.style.height = '';\r\n    } else {\r\n      putPhoto(avatarElem, NULL_PEER_ID, false, chatInvite.title);\r\n    }\r\n\r\n    const title = document.createElement('div');\r\n    title.classList.add('chat-title');\r\n    setInnerHTML(title, wrapEmojiText(chatInvite.title));\r\n    // avatarElem.setAttribute('peer', '' + -fakeChat.id);\r\n\r\n    const isBroadcast = chatInvite.pFlags.broadcast;\r\n    const peopleCount = i18n(isBroadcast ? 'Subscribers' : 'Members', [numberThousandSplitter(chatInvite.participants_count)]);\r\n    peopleCount.classList.add('chat-participants-count');\r\n\r\n    this.body.append(avatarElem, title, peopleCount);\r\n\r\n    if(chatInvite.pFlags.request_needed) {\r\n      const caption = document.createElement('div');\r\n      _i18n(caption, isBroadcast ? 'RequestToJoinChannelDescription' : 'RequestToJoinGroupDescription');\r\n      caption.classList.add('chat-participants-count', 'request-caption');\r\n\r\n      this.body.append(caption);\r\n    }\r\n\r\n    this.show();\r\n  }\r\n}\r\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport Scrollable from '../components/scrollable';\nimport {MOUNT_CLASS_TO} from '../config/debug';\nimport {IS_SAFARI} from '../environment/userAgent';\nimport getVisibleRect from './dom/getVisibleRect';\nimport reflowScrollableElement from './dom/reflowScrollableElement';\n\nexport default class ScrollSaver {\n  private scrollHeight: number;\n  private scrollHeightMinusTop: number;\n  private scrollTop: number;\n  private clientHeight: number;\n  private elements: {element: HTMLElement, rect: DOMRect}[];\n\n  /**\n   *\n   * @param scrollable to reset scroll position and direction\n   * @param reverse true means top\n   */\n  constructor(\n    private scrollable: Scrollable,\n    private query: string,\n    private reverse: boolean\n  ) {\n\n  }\n\n  private get container() {\n    return this.scrollable.container;\n  }\n\n  public getSaved() {\n    return {\n      scrollHeight: this.scrollHeight,\n      scrollTop: this.scrollTop,\n      clientHeight: this.clientHeight\n    };\n  }\n\n  public findElements() {\n    if(!this.query) return [];\n\n    const {container} = this;\n    const containerRect = container.getBoundingClientRect();\n    const bubbles = Array.from(container.querySelectorAll(this.query)) as HTMLElement[];\n    const elements: ScrollSaver['elements'] = [];\n    for(const bubble of bubbles) {\n      const elementRect = bubble.getBoundingClientRect();\n      const visibleRect = getVisibleRect(bubble, container, undefined, elementRect, containerRect);\n      if(visibleRect) {\n        elements.push({element: bubble, rect: elementRect});\n        // break; // find first\n      } else if(elements.length) { // find last\n        break;\n      }\n    }\n\n    if(!elements.length) {\n      const bubble = bubbles[0];\n      if(bubble) {\n        elements.push({element: bubble, rect: bubble.getBoundingClientRect()});\n      }\n    }\n\n    return elements;\n  }\n\n  public replaceSaved(from: HTMLElement, to: HTMLElement) {\n    if(!this.elements) {\n      return;\n    }\n\n    const idx = this.elements.findIndex(({element}) => from === element);\n    if(idx !== -1) {\n      this.elements[idx].element = to;\n    }\n  }\n\n  public findAndSetElements() {\n    this.elements = this.findElements();\n  }\n\n  public save() {\n    this.findAndSetElements();\n    // console.warn('scroll save', this.elements);\n    this._save();\n  }\n\n  public _save() {\n    const {scrollTop, scrollHeight, clientHeight} = this.container;\n\n    // previousScrollHeight = scrollHeight;\n    // previousScrollHeight = scrollHeight + padding;\n    this.scrollHeight = scrollHeight;\n    this.scrollTop = scrollTop;\n    this.clientHeight = clientHeight;\n    this.scrollHeightMinusTop = this.reverse ? scrollHeight - scrollTop : scrollTop;\n\n    // this.chatInner.style.paddingTop = padding + 'px';\n    /* if(reverse) {\n      previousScrollHeightMinusTop = this.scrollable.scrollHeight - scrollTop;\n    } else {\n      previousScrollHeightMinusTop = scrollTop;\n    } */\n  }\n\n  private onRestore(useReflow?: boolean) {\n    if(IS_SAFARI && useReflow/*  && !isAppleMobile */) { // * fix blinking and jumping\n      reflowScrollableElement(this.container);\n    }\n  }\n\n  private setScrollTop(newScrollTop: number, useReflow?: boolean) {\n    // touchSupport for safari iOS\n    // isTouchSupported && isApple && (container.container.style.overflow = 'hidden');\n    this.scrollable.setScrollTopSilently(this.scrollTop = newScrollTop);\n    // container.scrollTop = scrollHeight;\n    // isTouchSupported && isApple && (container.container.style.overflow = '');\n\n    this.onRestore(useReflow);\n  }\n\n  public restore(useReflow?: boolean) {\n    const {scrollTop, scrollHeight} = this.scrollable;\n    this.scrollHeight = scrollHeight;\n\n    if(!this.elements.length) { // maybe all messages have been deleted\n      this._restore(useReflow);\n      return;\n    }\n\n    let anchor: ScrollSaver['elements'][0];\n    // for(let i = this.elements.length - 1; i >= 0; --i) {\n    //   const _anchor = this.elements[i];\n    //   if(_anchor.element.parentElement) {\n    //     anchor = _anchor;\n    //     break;\n    //   }\n    // }\n    anchor = this.elements[this.elements.length - 1];\n\n    if(!anchor?.element?.parentElement) { // try to find new anchor\n      this.findAndSetElements();\n      anchor = this.elements[this.elements.length - 1];\n\n      if(!anchor) { // fallback to old method if smth is really strange\n        this._restore(useReflow);\n        return;\n      }\n    }\n\n    const {element, rect} = anchor;\n    const newRect = element.getBoundingClientRect();\n    const diff = newRect.bottom - rect.bottom;\n    this.setScrollTop(scrollTop + diff, useReflow);\n    // if(diff) debugger;\n    // console.warn('scroll restore', rect, diff, newRect);\n  }\n\n  public _restore(useReflow?: boolean) {\n    const {scrollHeightMinusTop: previousScrollHeightMinusTop, scrollable} = this;\n    // if(previousScrollHeightMinusTop === undefined) {\n    //   throw new Error('scroll was not saved');\n    // }\n\n    // const scrollHeight = container.scrollHeight;\n    const scrollHeight = this.scrollHeight;\n    // if(scrollHeight === this.scrollHeight) {\n    //   return;\n    // }\n\n    // this.scrollHeight = scrollHeight;\n\n    /* const scrollHeight = container.scrollHeight;\n    const addedHeight = scrollHeight - previousScrollHeight;\n\n    this.chatInner.style.paddingTop = (10000 - addedHeight) + 'px'; */\n    /* const scrollHeight = scrollHeight;\n    const addedHeight = scrollHeight - previousScrollHeight;\n\n    this.chatInner.style.paddingTop = (padding - addedHeight) + 'px';\n\n    //const newScrollTop = reverse ? scrollHeight - previousScrollHeightMinusTop : previousScrollHeightMinusTop;\n    const newScrollTop = reverse ? scrollHeight - addedHeight - previousScrollHeightMinusTop : previousScrollHeightMinusTop;\n    this.log('performHistoryResult: will set scrollTop',\n    previousScrollHeightMinusTop, scrollHeight,\n    newScrollTop, container.container.clientHeight); */\n    // const newScrollTop = reverse ? scrollHeight - previousScrollHeightMinusTop : previousScrollHeightMinusTop;\n    const newScrollTop = this.reverse ? scrollHeight - previousScrollHeightMinusTop : previousScrollHeightMinusTop;\n\n    /* if(DEBUG) {\n      this.log('performHistoryResult: will set up scrollTop:', newScrollTop, this.isHeavyAnimationInProgress);\n    } */\n\n    this.setScrollTop(newScrollTop, useReflow);\n\n    /* if(DEBUG) {\n      this.log('performHistoryResult: have set up scrollTop:', newScrollTop, container.scrollTop, container.scrollHeight, this.isHeavyAnimationInProgress);\n    } */\n  }\n}\n\nMOUNT_CLASS_TO && (MOUNT_CLASS_TO.ScrollSaver = ScrollSaver);\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nexport type IntersectionTarget = Element;\nexport type IntersectionCallback = (entry: IntersectionObserverEntry) => void;\n\nexport default class SuperIntersectionObserver {\n  private observing: Map<IntersectionTarget, Set<IntersectionCallback>>;\n  private observingQueue: SuperIntersectionObserver['observing'];\n  private observer: IntersectionObserver;\n  private freezedObservingNew: boolean;\n\n  constructor(init?: IntersectionObserverInit) {\n    this.observing = new Map();\n    this.observingQueue = new Map();\n    this.freezedObservingNew = false;\n\n    this.observer = new IntersectionObserver((entries) => {\n      const observing = this.observing;\n      for(let i = 0, length = entries.length; i < length; ++i) {\n        const entry = entries[i];\n        const callbacks = observing.get(entry.target);\n        if(!callbacks) {\n          debugger;\n        }\n\n        for(const callback of callbacks) {\n          try {\n            callback(entry);\n          } catch(err) {\n            console.error('intersection process callback error:', err);\n          }\n        }\n      }\n    }, init);\n  }\n\n  public disconnect() {\n    this.observing.clear();\n    this.observingQueue.clear();\n    this.observer.disconnect();\n  }\n\n  public toggleObservingNew(value: boolean) {\n    if(this.freezedObservingNew === value) {\n      return;\n    }\n\n    this.freezedObservingNew = value;\n\n    const queue = this.observingQueue;\n    if(!value && queue.size) {\n      for(const [target, callbacks] of queue) {\n        for(const callback of callbacks) {\n          this.observe(target, callback);\n        }\n      }\n\n      queue.clear();\n    }\n  }\n\n  public has(target: IntersectionTarget, callback: IntersectionCallback, observing = this.observing) {\n    const callbacks = observing.get(target);\n    return !!(callbacks && callbacks.has(callback));\n  }\n\n  public observe(target: IntersectionTarget, callback: IntersectionCallback) {\n    if(this.freezedObservingNew && this.has(target, callback)) {\n      return;\n    }\n\n    const observing = this.freezedObservingNew ? this.observingQueue : this.observing;\n    let callbacks = observing.get(target);\n    if(callbacks && callbacks.has(callback)) {\n      return;\n    }\n\n    if(!callbacks) {\n      callbacks = new Set();\n      observing.set(target, callbacks);\n\n      if(observing === this.observing) {\n        this.observer.observe(target);\n      }\n    }\n\n    callbacks.add(callback);\n  }\n\n  public unobserve(target: IntersectionTarget, callback: IntersectionCallback) {\n    const observing = this.freezedObservingNew && !this.has(target, callback) ? this.observingQueue : this.observing;\n    const callbacks = observing.get(target);\n    if(!callbacks) {\n      return;\n    }\n\n    callbacks.delete(callback);\n    if(!callbacks.size) {\n      observing.delete(target);\n      this.observer.unobserve(target);\n    }\n  }\n}\n","import type {MyDocument} from '../../appDocsManager';\nimport type {MyMessage} from '../../appMessagesManager';\nimport {Message, MessageMedia} from '../../../../layer';\n\nexport default function isMentionUnread(message: MyMessage) {\n  if(!message) {\n    return false;\n  }\n\n  const doc = ((message as Message.message).media as MessageMedia.messageMediaDocument)?.document as MyDocument;\n  return !!(\n    message.pFlags.media_unread &&\n    message.pFlags.mentioned &&\n    (\n      !doc ||\n      !(['voice', 'round'] as MyDocument['type'][]).includes(doc.type)\n    )\n  );\n}\n","function cacheCallback<A, T>(callback: (str: A) => T) {\n  const stringResults: any = {}, numberResults: any = {};\n  return (value: A): T => {\n    const key = '_' + value;\n    return (typeof(value) === 'string' ? stringResults : numberResults)[key] ??= callback(value);\n  };\n}\n\nexport default cacheCallback;\n","export default function replaceNonNumber(str: string) {\n  return str.replace(/\\D/g, '');\n}\n","import cacheCallback from '../cacheCallback';\nimport replaceNonNumber from '../string/replaceNonNumber';\n\nconst CARD_BRAND_REGEXP: {[brand: string]: RegExp} = {\n  visa: /^4/,\n  mastercard: /^(51|52|53|54|55|222|23|24|25|26|27)/,\n  amex: /^(34|37)/,\n  discover: /^(60|64|65)/,\n  diners: /^(30|38|39)/,\n  diners14: /^(36)/,\n  jcb: /^(35)/,\n  unionpay: /^(62[0-6,8-9]|627[0-6,8-9]|6277[0-7,9]|62778[1-9]|81)/,\n  elo: /^(5067|509|636368|627780)/,\n  mir: /^(220[0-4])/\n};\n\n// * taken from Stripe\nexport const CARD_BRANDS: {[b: string]: {\n  minLength: number,\n  maxLength: number,\n  cvcMaxLength: number,\n  cvcMinLength: number | null\n}} = {\n  visa: {\n    minLength: 16,\n    maxLength: 16,\n    cvcMaxLength: 3,\n    cvcMinLength: null\n  },\n  mastercard: {\n    minLength: 16,\n    maxLength: 16,\n    cvcMaxLength: 3,\n    cvcMinLength: null\n  },\n  amex: {\n    minLength: 15,\n    maxLength: 15,\n    cvcMaxLength: 4,\n    cvcMinLength: 3\n  },\n  unionpay: {\n    minLength: 13,\n    maxLength: 19,\n    cvcMaxLength: 3,\n    cvcMinLength: null\n  },\n  diners: {\n    minLength: 16,\n    maxLength: 16,\n    cvcMaxLength: 3,\n    cvcMinLength: null\n  },\n  diners14: {\n    minLength: 14,\n    maxLength: 14,\n    cvcMaxLength: 3,\n    cvcMinLength: null\n  },\n  discover: {\n    minLength: 16,\n    maxLength: 16,\n    cvcMaxLength: 3,\n    cvcMinLength: null\n  },\n  jcb: {\n    minLength: 16,\n    maxLength: 16,\n    cvcMaxLength: 3,\n    cvcMinLength: null\n  },\n  elo: {\n    minLength: 16,\n    maxLength: 16,\n    cvcMaxLength: 3,\n    cvcMinLength: null\n  },\n  mir: {\n    minLength: 16,\n    maxLength: 16,\n    cvcMaxLength: 3,\n    cvcMinLength: null\n  },\n  unknown: {\n    minLength: 16,\n    maxLength: 16,\n    cvcMaxLength: 4,\n    cvcMinLength: 3\n  }\n};\n\nexport const detectCardBrand = cacheCallback((card: string = '') => {\n  const keys = Object.keys(CARD_BRAND_REGEXP);\n  const sanitizedCard = replaceNonNumber(card);\n  let brand: string;\n  let last = 0;\n  keys.forEach((key) => {\n    const regExp = CARD_BRAND_REGEXP[key];\n    const match = sanitizedCard.match(regExp);\n    if(match) {\n      const result = match[0];\n      if(result && result.length > last) {\n        brand = key;\n        last = result.length;\n      }\n    }\n  });\n\n  return brand || 'unknown';\n});\n\nexport function cardBrandToUnifiedBrand(brand: string) {\n  return brand === 'diners14' ? 'diners' : brand;\n}\n\nexport function detectUnifiedCardBrand(card = '') {\n  const brand = detectCardBrand(card);\n  return cardBrandToUnifiedBrand(brand);\n}\n","export default function createArray<T1>(length: number, fill?: T1, map?: any): T1[] {\n  const arr = new Array<T1>(length);\n  arr.fill(fill);\n  return map ? arr.map(map) : arr;\n}\n","const delta = ''.charCodeAt(0) - '0'.charCodeAt(0);\nconst buggedRegExp = /[-]/g;\n\n// function hasBuggedNumbers(str: string) {\n//   return !!str.match(a);\n// }\n\nfunction getDistanceFromBuggedToNormal(char: string) {\n  return String.fromCharCode(char.charCodeAt(0) - delta);\n}\n\nexport function fixBuggedNumbers(str: string) {\n  return str.replace(buggedRegExp, getDistanceFromBuggedToNormal);\n}\n","import {fixBuggedNumbers} from '../string/buggedNumbers';\nimport replaceNonNumber from '../string/replaceNonNumber';\n\nexport type PatternCharacter = {\n  type: 'optional',\n  result: string,\n  consumed: number\n} | {\n  type: 'required',\n  result: string,\n  consumed: number,\n  partial?: boolean\n} | {\n  type: 'formatting',\n  result: string,\n  consumed: number\n};\n\nexport type PatternFunction = (str: string) => ((str: string) => PatternCharacter)[];\n\nfunction makeOptionalCharacter(result: string, consumed: number): PatternCharacter {\n  return {type: 'optional', result, consumed};\n}\n\nfunction makeRequiredCharacter(result: string, consumed: number, partial?: boolean): PatternCharacter {\n  return {type: 'required', result, consumed, partial};\n}\n\nfunction makeFormattingCharacter(result: string, consumed: number): PatternCharacter {\n  return {type: 'formatting', result, consumed};\n}\n\nfunction wrapCharacterRegExpFactory(regExp: RegExp, optional?: boolean) {\n  return (str: string) => {\n    const _regExp = new RegExp('^'.concat(regExp.source.replace(/^\\^/, '')));\n    const match = str.match(_regExp);\n    const makeCharacter = optional ? makeOptionalCharacter : makeRequiredCharacter;\n    if(match) {\n      const result = match[0];\n      return makeCharacter(result, match.index + result.length);\n    }\n\n    return makeCharacter('', str.length);\n  };\n}\n\nfunction makeCapitalPatternCharacter(str: string) {\n  const char = wrapCharacterRegExpFactory(/\\w/)(str);\n  return char.result ? makeRequiredCharacter(char.result.toUpperCase(), char.consumed) : char;\n}\n\nconst makeMonthDigitPatternCharacter = wrapCharacterRegExpFactory(/1[0-2]|0?[1-9]|0/);\n\nfunction digit(str: string) {\n  return wrapCharacterRegExpFactory(/[0-9]/)(fixBuggedNumbers(str));\n}\n\nconst patternCharacters = {\n  digit,\n  capitalCharacter: makeCapitalPatternCharacter,\n  month: (str: string) => {\n    const char = makeMonthDigitPatternCharacter(fixBuggedNumbers(str));\n    const cleanedResult = replaceNonNumber(char.result);\n    const isPartial = ['0', '1'].includes(char.result) && str.length === 1;\n    if(isPartial || (char.result === '0' && str.length >= 2)) {\n      return makeRequiredCharacter(char.result, str.length, true);\n    }\n\n    return makeRequiredCharacter(cleanedResult.length === 1 ? '0' + cleanedResult : cleanedResult, char.consumed);\n  },\n  formattingCharacter: (str: string) => {\n    return (str1: string) => {\n      const consumed = str === str1[0] ? 1 : 0;\n      return makeFormattingCharacter(str, consumed);\n    }\n  },\n  optionalPattern: (regExp: RegExp) => {\n    return (str: string) => {\n      const char = wrapCharacterRegExpFactory(regExp, true)(str);\n      return char.result ? char : makeOptionalCharacter('', 0);\n    };\n  }\n};\n\nexport default patternCharacters;\n","import {IS_ANDROID} from '../../environment/userAgent';\nimport createArray from '../array/createArray';\nimport cacheCallback from '../cacheCallback';\nimport replaceNonNumber from '../string/replaceNonNumber';\nimport {CARD_BRANDS, detectCardBrand} from './cardBrands';\nimport patternCharacters from './patternCharacters';\n\nconst digit = patternCharacters.digit;\nconst capitalCharacter = patternCharacters.capitalCharacter;\nconst spaceCharacter = patternCharacters.formattingCharacter(' ');\nconst yearOptionalPattern = patternCharacters.optionalPattern(/\\d\\d/);\nconst sixteenPattern = [digit, digit, digit, digit, spaceCharacter, digit, digit, digit, digit, digit, digit, spaceCharacter, digit, digit, digit, digit, digit];\nconst fifteenPattern = [digit, digit, digit, digit, spaceCharacter, digit, digit, digit, digit, digit, digit, spaceCharacter, digit, digit, digit, digit];\n\nconst requiredPostcodes = new Set(['DZ', 'AR', 'AM', 'AU', 'AT', 'AZ', 'PT', 'BD', 'BY', 'BE', 'BA', 'BR', 'BN', 'BG', 'CA', 'IC', 'CN', 'CO', 'HR', 'CY', 'CZ', 'DK', 'EC', 'GB', 'EE', 'FO', 'FI', 'FR', 'GE', 'DE', 'GR', 'GL', 'GU', 'GG', 'NL', 'HU', 'IN', 'ID', 'IL', 'IT', 'JP', 'JE', 'KZ', 'KR', 'FM', 'KG', 'LV', 'LI', 'LT', 'LU', 'MK', 'MG', 'PT', 'MY', 'MH', 'MQ', 'YT', 'MX', 'MN', 'ME', 'NL', 'NZ', 'GB', 'NO', 'PK', 'PH', 'PL', 'FM', 'PT', 'PR', 'RE', 'RU', 'SA', 'SF', 'RS', 'SG', 'SK', 'SI', 'ZA', 'ES', 'LK', 'SX', 'VI', 'VI', 'SE', 'CH', 'TW', 'TJ', 'TH', 'TU', 'TN', 'TR', 'TM', 'VI', 'UA', 'GB', 'US', 'UY', 'UZ', 'VA', 'VN', 'GB', 'FM']);\n\nconst generateFourPattern = cacheCallback((length: number) => {\n  const out: Array<typeof digit | typeof spaceCharacter> = [];\n\n  for(let i = 0, k = 0; i < length;) {\n    if(k === 4) {\n      out.push(spaceCharacter);\n      k = 0;\n    } else {\n      out.push(digit);\n      ++i;\n      ++k;\n    }\n  }\n\n  return out;\n});\n\nfunction generateCardNumberPattern(card: string) {\n  const brand = detectCardBrand(card);\n  if(brand === 'amex') return sixteenPattern;\n  if(brand === 'diners14') return fifteenPattern;\n  const {minLength, maxLength} = CARD_BRANDS[brand];\n  const s = replaceNonNumber(card).length;\n  const d = Math.min(Math.max(minLength, s), maxLength);\n  return generateFourPattern(d);\n}\n\nconst cardFormattingPatterns = {\n  cardNumber: generateCardNumberPattern,\n  cardExpiry: () => [patternCharacters.month, patternCharacters.formattingCharacter('/'), digit, digit, yearOptionalPattern],\n  cardCvc: (card?: string) => cardFormattingPatterns.cardCvcFromBrand(detectCardBrand(card)),\n  cardCvcFromBrand: cacheCallback((brand: string) => {\n    const info = CARD_BRANDS[brand];\n    const {cvcMinLength, cvcMaxLength} = info;\n    const pattern = createArray(cvcMinLength || cvcMaxLength, digit);\n    if(cvcMinLength && cvcMinLength < cvcMaxLength) {\n      const i = cvcMaxLength - cvcMinLength;\n      const h = patternCharacters.optionalPattern(/\\d/);\n      if(i) {\n        pattern.push(...createArray(i, h));\n      }\n    }\n\n    return pattern;\n  }),\n  postalCodeFromCountry: cacheCallback((iso2: string) => {\n    switch(iso2) {\n      case 'US':\n        return createArray(5, digit);\n      case 'CA':\n        return IS_ANDROID ? null : [capitalCharacter, capitalCharacter, capitalCharacter, spaceCharacter, capitalCharacter, capitalCharacter, capitalCharacter];\n      default:\n        const optionalDigits = createArray(10, patternCharacters.optionalPattern(/\\d/));\n        if(requiredPostcodes.has(iso2)) {\n          optionalDigits[0] = digit;\n        }\n        return optionalDigits;\n    }\n  })\n};\n\nexport default cardFormattingPatterns;\n","import accumulate from '../array/accumulate';\nimport {PatternFunction} from './patternCharacters';\n\nfunction accumulateLengths(strs: string[]) {\n  return accumulate(strs.map((str) => str.length), 0);\n}\n\nfunction formatValueByPattern(\n  getPattern: PatternFunction,\n  value: string,\n  options: Partial<{\n    selectionStart: number,\n    selectionEnd: number\n  }> = {},\n  pushRest?: boolean\n) {\n  const pattern = getPattern(value);\n\n  if(!pattern) {\n    return {\n      value: value,\n      selection: null as typeof options,\n      autocorrectComplete: !!value\n    };\n  }\n\n  const length = pattern.length;\n  const c: string[] = [];\n  const s: string[] = [];\n\n  let l = 0;\n  let i = 0;\n  let f = options.selectionStart === 0 ? 0 : null;\n  let d = options.selectionEnd === 0 ? 0 : null;\n  const p = () => {\n    if(f === null && (i + 1) >= options.selectionStart) f = accumulateLengths(c) + (pushRest ? s.length : 0);\n    if(d === null && (i + 1) >= options.selectionEnd) d = accumulateLengths(c) + (pushRest ? s.length : 0);\n  };\n  const m = (e: number) => {\n    if(e > 0) {\n      p();\n      i += e;\n    }\n  };\n\n  for(; l < length;) {\n    const getCharacter = pattern[l];\n    const character = getCharacter(value.slice(i));\n    const {type, result, consumed} = character;\n    if(type === 'required') {\n      if(result) {\n        c.push(...s, result);\n        s.length = 0;\n        ++l;\n\n        if(character.partial) {\n          m(value.length - i);\n          break;\n        }\n\n        m(consumed);\n      } else {\n        if(!consumed) {\n          break;\n        }\n\n        m(1);\n      }\n    } else if(type === 'optional') {\n      if(result) {\n        c.push(...s, result);\n        s.length = 0;\n        m(consumed);\n      }\n\n      ++l;\n    } else if(type === 'formatting') {\n      if(!pushRest && i >= value.length) {\n        break;\n      }\n\n      s.push(result);\n      ++l;\n      m(consumed);\n    }\n  }\n\n  if(pushRest) {\n    c.push(...s);\n  }\n\n  return {\n    value: c.join(''),\n    selection: {\n      selectionStart: f === null || value.length && options.selectionStart === value.length ? accumulateLengths(c) : f,\n      selectionEnd: d === null || value.length && options.selectionEnd === value.length ? accumulateLengths(c) : d\n    },\n    autocorrectComplete: l === length\n  };\n}\n\nexport default formatValueByPattern;\n","import {CARD_BRANDS, detectCardBrand} from './cardBrands';\nimport formatInputValueByPattern from './formatInputValueByPattern';\nimport NBSP from '../string/nbsp';\nimport replaceNonNumber from '../string/replaceNonNumber';\n\nexport type PatternValidationOptions = Partial<{\n  ignoreIncomplete: boolean\n}>;\n\nconst nbspRegExp = new RegExp(NBSP, 'g');\n\nfunction makeValidationError(code?: string) {\n  return code ? {\n    type: 'invalid',\n    code\n  } : null;\n}\n\n// Luhn algorithm\nfunction validateCompleteCardNumber(card: string) {\n  const t = '0'.charCodeAt(0);\n  const n = card.length % 2;\n  let a = 0;\n  for(let i = card.length - 1; i >= 0; --i) {\n    const c = n === (i % 2);\n    let o = card.charCodeAt(i) - t;\n    if(c) o *= 2;\n    if(o > 9) o -= 9;\n    a += o;\n  }\n  return !(a % 10);\n}\n\nfunction validateExpiry(year: number, month: number, options?: PatternValidationOptions) {\n  const date = new Date(Date.now());\n  const _year = year < 100 ? date.getFullYear() % 100 : date.getFullYear();\n  const nextMonth = date.getMonth() + 1;\n\n  if(isNaN(year) || isNaN(month)) {\n    return options?.ignoreIncomplete ? null : 'incomplete';\n  }\n\n  if((year - _year) < 0) {\n    return 'invalid_expiry_year_past';\n  }\n\n  if((year - _year) > 50) {\n    return 'invalid_expiry_year';\n  }\n\n  return !(year - _year) && month < nextMonth ? 'invalid_expiry_month_past' : null;\n}\n\nfunction getCardInfoByNumber(card: string) {\n  const sanitized = replaceNonNumber(card);\n  const brand = detectCardBrand(card);\n  return {\n    sanitized,\n    brand,\n    minLength: CARD_BRANDS[brand].minLength\n  };\n}\n\nfunction makeCardNumberError(str: string, length: number, ignoreIncomplete: boolean) {\n  if(str.length >= length) {\n    return validateCompleteCardNumber(str) || detectCardBrand(str) === 'mir' ? null : makeValidationError('invalid');\n  }\n\n  return ignoreIncomplete ? null : makeValidationError('incomplete');\n}\n\nexport function validateCardNumber(str: string, options: PatternValidationOptions = {}) {\n  const {sanitized, minLength} = getCardInfoByNumber(str);\n  return makeCardNumberError(sanitized, minLength, options.ignoreIncomplete);\n}\n\nexport function validateCardExpiry(str: string, options: PatternValidationOptions = {}) {\n  const sanitized = str.replace(nbspRegExp, '').split(/ ?\\/ ?/);\n  const [monthStr, yearStr = ''] = sanitized;\n  const [month, year] = [monthStr, yearStr].map((str) => +str);\n  const s = yearStr.length === 2 ? year % 100 : year;\n  return yearStr.length < 2 || yearStr.length === 3 ? (options.ignoreIncomplete ? null : makeValidationError('incomplete')) : makeValidationError(validateExpiry(s, month, options));\n}\n\nexport function validateAnyIncomplete(formatted: ReturnType<typeof formatInputValueByPattern>, str: string, options: PatternValidationOptions = {}) {\n  return formatted.meta.autocorrectComplete || options.ignoreIncomplete ? null : makeValidationError('incomplete');\n}\n","const NBSP = '';\nexport default NBSP;\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport PopupElement from '.';\nimport appImManager from '../../lib/appManagers/appImManager';\nimport {TelegramWebviewEventCallback} from '../../types';\n\nconst weakMap: WeakMap<Window, TelegramWebviewEventCallback> = new WeakMap();\nwindow.addEventListener('message', (e) => {\n  const callback = weakMap.get(e.source as Window);\n  if(!callback) {\n    return;\n  }\n\n  callback(JSON.parse(e.data));\n});\n\nexport function createVerificationIframe(url: string, callback: TelegramWebviewEventCallback) {\n  const iframe = document.createElement('iframe');\n  // iframe.title = 'Complete Payment';\n  iframe.allow = 'payment';\n  // iframe.setAttribute('sandbox', 'allow-forms allow-scripts allow-same-origin allow-top-navigation allow-modals');\n  iframe.setAttribute('sandbox', 'allow-forms allow-scripts allow-same-origin allow-modals');\n  iframe.classList.add('payment-verification');\n  iframe.src = url;\n\n  iframe.addEventListener('load', () => {\n    weakMap.set(iframe.contentWindow, callback);\n  }, {once: true});\n\n  return iframe;\n}\n\nexport default class PopupPaymentVerification extends PopupElement<{\n  finish: () => void\n}> {\n  constructor(private url: string) {\n    super('popup-payment popup-payment-verification', {\n      closable: true,\n      overlayClosable: true,\n      body: true,\n      title: 'Checkout.WebConfirmation.Title'\n    });\n\n    this.d();\n  }\n\n  private d() {\n    const iframe = createVerificationIframe(this.url, (event) => {\n      if(event.eventType !== 'web_app_open_tg_link') {\n        return;\n      }\n\n      this.dispatchEvent('finish');\n      this.hide();\n      appImManager.openUrl('https://t.me' + event.eventData.path_full);\n    });\n\n    this.body.append(iframe);\n    this.show();\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport PopupElement from '.';\nimport cardFormattingPatterns from '../../helpers/cards/cardFormattingPatterns';\nimport {detectUnifiedCardBrand} from '../../helpers/cards/cardBrands';\nimport formatInputValueByPattern from '../../helpers/cards/formatInputValueByPattern';\nimport {validateAnyIncomplete, validateCardExpiry, validateCardNumber} from '../../helpers/cards/validateCard';\nimport placeCaretAtEnd from '../../helpers/dom/placeCaretAtEnd';\nimport {renderImageFromUrlPromise} from '../../helpers/dom/renderImageFromUrl';\nimport noop from '../../helpers/noop';\nimport {PaymentsPaymentForm} from '../../layer';\nimport {LangPackKey, _i18n} from '../../lib/langPack';\nimport {TelegramWebviewEvent} from '../../types';\nimport CheckboxField from '../checkboxField';\nimport confirmationPopup from '../confirmationPopup';\nimport CountryInputField from '../countryInputField';\nimport InputField, {InputFieldOptions, InputState} from '../inputField';\nimport Row from '../row';\nimport {SettingSection} from '../sidebarLeft';\nimport {getPaymentBrandIconPath, PaymentButton, PaymentsCredentialsToken} from './payment';\nimport {createVerificationIframe} from './paymentVerification';\n\nexport type PaymentCardDetails = {\n  cardNumber: string;\n  cardholderName: string;\n  expiryFull: string;\n  expiryMonth: string;\n  expiryYear: string;\n  cvc: string;\n  country: string;\n  zip: string;\n  save?: boolean;\n};\n\nexport type PaymentCardDetailsShort = {\n  title: string,\n  save?: boolean;\n  icon?: string;\n};\n\nexport type PaymentCardDetailsResult = PaymentCardDetails | PaymentCardDetailsShort;\n\nexport class InputFieldCorrected extends InputField {\n  private lastKeyDown: string;\n  private lastTransformed: ReturnType<typeof formatInputValueByPattern>;\n\n  constructor(public options: InputFieldOptions & {\n    formatMethod: typeof cardFormattingPatterns['cardNumber'],\n    validateMethod?: typeof validateCardNumber,\n    errorKeys?: {[code: string]: LangPackKey},\n    optional?: boolean,\n    onChange?: (transformed: InputFieldCorrected['lastTransformed']) => void,\n    onKeyDown?: (e: KeyboardEvent) => void\n  }) {\n    super(options);\n\n    // const handleIncomplete = (t?: any) => {\n    //   if(\n    //     (!lastTransformed.value && t) ||\n    //     lastTransformed.meta.autocorrectComplete ||\n    //     lastTransformed.meta.error ||\n    //     optional\n    //   ) {\n    //     return;\n    //   }\n\n\n    // };\n\n    this.input.addEventListener('keydown', this.onKeyDown);\n    this.input.addEventListener('input', this.onInput);\n    this.input.addEventListener('blur', this.onBlur);\n  }\n\n  private onKeyDown = (e: KeyboardEvent) => {\n    this.lastKeyDown = e.key;\n    this.options.onKeyDown?.(e);\n  };\n\n  private onInput = () => {\n    const value = this.value;\n    const deleting = this.lastKeyDown === 'Backspace' && (((this.lastTransformed && this.lastTransformed.value.length) || 0) - value.length) === 1;\n    const result = this.lastTransformed = formatInputValueByPattern({\n      value: value,\n      getPattern: this.options.formatMethod,\n      deleting,\n      input: this.input\n    });\n\n    const transformedValue = result.value;\n    if(transformedValue !== value) {\n      this.setValueSilently(transformedValue);\n\n      if(result.selection) {\n        (this.input as HTMLInputElement).selectionStart = result.selection.selectionStart;\n        (this.input as HTMLInputElement).selectionEnd = result.selection.selectionEnd;\n      }\n    }\n\n    this.validateNew(transformedValue, {ignoreIncomplete: true/* !result.meta.autocorrectComplete */});\n\n    this.options.onChange?.(result);\n  };\n\n  private onBlur = () => {\n    const value = this.lastTransformed?.value;\n    if(value) {\n      this.validateNew(value);\n    }\n  };\n\n  public update() {\n    this.onInput();\n  }\n\n  public validate = () => {\n    return this.validateNew();\n  };\n\n  public validateNew(\n    value = this.lastTransformed?.value ?? '',\n    t: any = {},\n    justReturn?: boolean\n  ) {\n    let result: ReturnType<InputFieldCorrected['options']['validateMethod']>;\n    if(this.options.validateMethod) {\n      result = this.options.validateMethod?.(value, t);\n    } else {\n      result = validateAnyIncomplete(this.lastTransformed, value, t);\n    }\n\n    if(result?.code) {\n      const langPackKey: LangPackKey = this.options.errorKeys?.[result.code];\n      !justReturn && this.setState(InputState.Error, langPackKey);\n      return false;\n    }\n\n    !justReturn && this.setState(InputState.Neutral);\n    return true;\n  }\n}\n\nexport function handleInputFieldsOnChange(inputFields: (CountryInputField | InputField | InputFieldCorrected)[], _onChange: (valid: boolean) => void) {\n  const onChange = () => {\n    const valid = inputFields.every((inputField) => {\n      return 'validateNew' in inputField ? inputField.validateNew(undefined, undefined, true) : inputField.isValid();\n    });\n\n    _onChange(valid);\n  };\n\n  inputFields.forEach((inputField) => {\n    if(inputField instanceof InputFieldCorrected) {\n      const original = inputField.options.onChange;\n      inputField.options.onChange = (...args: any[]) => {\n        // @ts-ignore\n        original?.(...args);\n        onChange();\n      };\n\n      if('update' in inputField) {\n        inputField.update();\n      }\n    } else {\n      inputField.input.addEventListener('input', onChange);\n    }\n  });\n\n  return {validate: onChange};\n}\n\nexport function createCountryZipFields(country?: boolean, zip?: boolean) {\n  let countryInputField: CountryInputField, postcodeInputField: InputFieldCorrected;\n  if(country || zip) {\n    if(country) countryInputField = new CountryInputField({\n      noPhoneCodes: true,\n      onCountryChange: () => {\n        postcodeInputField?.update();\n      },\n      required: true,\n      autocomplete: 'country'\n    });\n    if(zip) postcodeInputField = new InputFieldCorrected({\n      label: 'PaymentShippingZipPlaceholder',\n      plainText: true,\n      inputMode: 'numeric',\n      autocomplete: 'postal-code',\n      formatMethod: (/* ...args */) => {\n        const {country} = countryInputField.getSelected();\n        const iso2 = country?.iso2;\n        return cardFormattingPatterns.postalCodeFromCountry(iso2 && iso2.toUpperCase());\n      }\n    });\n  }\n\n  return {countryInputField, postcodeInputField};\n}\n\nexport type PaymentsNativeProvider = 'stripe' | 'smartglocal';\nexport type PaymentsNativeParams = {\n  need_country?: boolean,\n  need_zip?: boolean,\n  need_cardholder_name?: boolean,\n  publishable_key?: string, // stripe\n  public_token?: string, // smartglocal\n  gpay_params: string,\n};\nconst SUPPORTED_NATIVE_PROVIDERS: Set<PaymentsNativeProvider> = new Set(['stripe', 'smartglocal']);\n\nexport default class PopupPaymentCard extends PopupElement<{\n  finish: (obj: {token: any, card: PaymentCardDetailsResult}) => void\n}> {\n  constructor(private paymentForm: PaymentsPaymentForm, private savedCard?: PaymentCardDetails) {\n    super('popup-payment popup-payment-card', {\n      closable: true,\n      overlayClosable: true,\n      body: true,\n      scrollable: SUPPORTED_NATIVE_PROVIDERS.has(paymentForm.native_provider as PaymentsNativeProvider),\n      title: 'PaymentCardInfo'\n    });\n\n    if(SUPPORTED_NATIVE_PROVIDERS.has(paymentForm.native_provider as PaymentsNativeProvider)) {\n      this.d();\n    } else {\n      const iframe = createVerificationIframe(paymentForm.url, (event) => {\n        if(event.eventType !== 'payment_form_submit') {\n          return;\n        }\n\n        const data = event.eventData;\n\n        const cardOut = {title: data.title, save: false} as any as PaymentCardDetails;\n        this.dispatchEvent('finish', {\n          token: data.credentials,\n          card: cardOut\n        });\n\n        this.hide();\n\n        if(paymentForm.pFlags.can_save_credentials) {\n          confirmationPopup({\n            titleLangKey: 'PaymentCardSavePaymentInformation',\n            descriptionLangKey: 'PaymentCardSavePaymentInformationInfoLine1',\n            button: {\n              langKey: 'Save'\n            }\n          }).then(() => {\n            cardOut.save = true;\n          }, noop);\n        }\n      });\n\n      // putPreloader(this.body, true);\n      this.body.append(iframe);\n      this.show();\n    }\n  }\n\n  private d() {\n    const savedCard = this.savedCard;\n    const cardSection = new SettingSection({name: 'PaymentInfo.Card.Title', noDelimiter: true, noShadow: true});\n\n    const nativeParams: PaymentsNativeParams = JSON.parse(this.paymentForm.native_params.data);\n\n    let lastBrand: string, brandIconTempId = 0, lastBrandImg: HTMLImageElement;\n    const setBrandIcon = (brand: string) => {\n      if(lastBrand === brand) {\n        return;\n      }\n\n      const tempId = ++brandIconTempId;\n      lastBrand = brand;\n\n      const path = getPaymentBrandIconPath(brand);\n      if(!path) {\n        if(lastBrandImg) {\n          lastBrandImg.remove();\n          lastBrandImg = undefined;\n        }\n\n        return;\n      }\n\n      const img = new Image();\n      img.classList.add('input-field-icon');\n      renderImageFromUrlPromise(img, path, false).then(() => {\n        if(brandIconTempId !== tempId) {\n          return;\n        }\n\n        if(lastBrandImg) {\n          lastBrandImg.replaceWith(img);\n        } else {\n          cardInputField.container.append(img);\n        }\n\n        lastBrandImg = img;\n      });\n    };\n    const cardInputField = new InputFieldCorrected({\n      label: 'PaymentCardNumber',\n      plainText: true,\n      inputMode: 'numeric',\n      autocomplete: 'cc-number',\n      formatMethod: cardFormattingPatterns.cardNumber,\n      validateMethod: validateCardNumber,\n      errorKeys: {\n        invalid: 'PaymentCard.Error.Invalid',\n        incomplete: 'PaymentCard.Error.Incomplete'\n      },\n      onChange: (transformed) => {\n        setBrandIcon(detectUnifiedCardBrand(transformed.value));\n        cvcInputField.update(); // format cvc\n      }\n    });\n\n    let nameInputField: InputField;\n    if(nativeParams.need_cardholder_name) nameInputField = new InputField({\n      label: 'Checkout.NewCard.CardholderNamePlaceholder',\n      maxLength: 255,\n      required: true,\n      autocomplete: 'cc-name'\n    });\n\n    const expireInputField = new InputFieldCorrected({\n      label: 'SecureId.Identity.Placeholder.ExpiryDate',\n      plainText: true,\n      inputMode: 'numeric',\n      autocomplete: 'cc-exp',\n      formatMethod: cardFormattingPatterns.cardExpiry,\n      validateMethod: validateCardExpiry\n    });\n\n    const cvcInputField = new InputFieldCorrected({\n      labelText: 'CVC',\n      plainText: true,\n      inputMode: 'numeric',\n      autocomplete: 'cc-csc',\n      formatMethod: () => cardFormattingPatterns.cardCvc(cardInputField.value)\n      // validateMethod: (...args) => _5AH3.a.cardCvc(cardInputField.value)(...args)\n    });\n\n    const switchFocusOrder: (InputFieldCorrected | InputField)[] = [\n      cardInputField,\n      expireInputField,\n      cvcInputField,\n      nameInputField\n    ].filter(Boolean);\n    switchFocusOrder.forEach((inputField) => {\n      const onKeyDown = (e: KeyboardEvent) => {\n        if(!inputField.value && e.key === 'Backspace') {\n          const previousInputField = switchFocusOrder[switchFocusOrder.indexOf(inputField) - 1];\n          if(previousInputField) {\n            // previousInputField.value = previousInputField.value.slice(0, -1);\n            placeCaretAtEnd(previousInputField.input, true);\n          }\n        }\n      };\n\n      if(inputField instanceof InputFieldCorrected) {\n        inputField.options.onKeyDown = onKeyDown;\n\n        const original = inputField.options.onChange;\n        inputField.options.onChange = (transformed) => {\n          original?.(transformed);\n\n          if(document.activeElement === inputField.input && transformed.meta.autocorrectComplete) {\n            for(let i = switchFocusOrder.indexOf(inputField), length = switchFocusOrder.length; i < length; ++i) {\n              const nextInputField = switchFocusOrder[i];\n              if(\n                nextInputField instanceof InputFieldCorrected ?\n                !nextInputField.validateNew(undefined, undefined, true) :\n                !nextInputField.value\n              ) {\n                placeCaretAtEnd(nextInputField.input, true);\n                break;\n              }\n            }\n          }\n        };\n      } else {\n        inputField.input.addEventListener('keydown', onKeyDown);\n      }\n    });\n\n    const inputFieldsRow = document.createElement('div');\n    inputFieldsRow.classList.add('input-fields-row');\n    inputFieldsRow.append(expireInputField.container, cvcInputField.container);\n\n    cardSection.content.append(...[\n      cardInputField.container,\n      inputFieldsRow,\n      nameInputField?.container\n    ].filter(Boolean));\n\n    let billingSection: SettingSection;\n    // let saveCheckboxField: CheckboxField;\n    const {countryInputField, postcodeInputField} = createCountryZipFields(nativeParams.need_country, nativeParams.need_zip);\n    if(nativeParams.need_country || nativeParams.need_zip) {\n      billingSection = new SettingSection({name: 'PaymentInfo.Billing.Title', noDelimiter: true, noShadow: true});\n\n      // const inputFieldsRow2 = inputFieldsRow.cloneNode() as HTMLElement;\n      // inputFieldsRow2.append(countryInputField.container, postcodeInputField.container);\n      // billingSection.content.append(inputFieldsRow2);\n      billingSection.content.append(...[countryInputField, postcodeInputField].filter(Boolean).map((i) => i.container));\n    }\n\n    const canSave = !!this.paymentForm.pFlags.can_save_credentials;\n    const saveCheckboxField = new CheckboxField({\n      text: 'PaymentCardSavePaymentInformation',\n      checked: !!canSave\n    });\n    const saveRow = new Row({\n      checkboxField: saveCheckboxField,\n      subtitleLangKey: canSave ? 'PaymentCardSavePaymentInformationInfoLine1' : 'Checkout.2FA.Text',\n      noCheckboxSubtitle: true\n    });\n\n    if(!canSave) {\n      saveRow.container.classList.add('is-disabled');\n    }\n\n    (billingSection || cardSection).content.append(saveRow.container);\n\n    this.scrollable.append(...[cardSection, billingSection].filter(Boolean).map((s) => s.container));\n\n    const payButton = PaymentButton({\n      key: 'PaymentInfo.Done',\n      onClick: async() => {\n        const data: PaymentCardDetails = {\n          cardNumber: cardInputField.value,\n          expiryFull: expireInputField.value,\n          expiryMonth: expireInputField.value.split('/')[0],\n          expiryYear: expireInputField.value.split('/')[1],\n          cvc: cvcInputField.value,\n\n          cardholderName: nameInputField?.value,\n          country: countryInputField?.value,\n          zip: postcodeInputField?.value,\n\n          save: saveCheckboxField?.checked\n        };\n\n        const nativeProvider: PaymentsNativeProvider = this.paymentForm.native_provider as any;\n        let out: PaymentsCredentialsToken;\n        if(nativeProvider === 'stripe') {\n          const url = new URL('https://api.stripe.com/v1/tokens');\n          url.search = new URLSearchParams({\n            'card[number]': data.cardNumber,\n            'card[exp_month]': data.expiryMonth,\n            'card[exp_year]': data.expiryYear,\n            'card[cvc]': data.cvc,\n            'card[address_zip]': data.zip,\n            'card[address_country]': data.country,\n            'card[name]': data.cardholderName\n          }).toString();\n\n          const response = await fetch(url.toString(), {\n            method: 'POST',\n            credentials: 'same-origin',\n            headers: {\n              'Content-Type': 'application/x-www-form-urlencoded',\n              'Authorization': `Bearer ${nativeParams.publishable_key}`\n            }\n          });\n\n          out = await response.json();\n        } else if(nativeProvider === 'smartglocal') {\n          const params = {\n            card: {\n              number: data.cardNumber.replace(/[^\\d]+/g, ''),\n              expiration_month: data.expiryMonth,\n              expiration_year: data.expiryYear,\n              security_code: data.cvc.replace(/[^\\d]+/g, '')\n            }\n          };\n\n          const url = /* DEBUG_PAYMENT_SMART_GLOCAL */false ?\n            'https://tgb-playground.smart-glocal.com/cds/v1/tokenize/card' :\n            'https://tgb.smart-glocal.com/cds/v1/tokenize/card';\n\n          const response = await fetch(url, {\n            method: 'POST',\n            headers: {\n              'Accept': 'application/json',\n              'Content-Type': 'application/json',\n              'X-PUBLIC-TOKEN': nativeParams.public_token\n            },\n            body: JSON.stringify(params)\n          });\n\n          const json: { // smartglocal\n            data: {\n              info: {\n                card_network: string,\n                card_type: string,\n                masked_card_number: string\n              },\n              token: string\n            },\n            status: 'ok'\n          } = await response.json();\n\n          out = {type: 'card', token: json.data.token}\n        }\n\n        this.dispatchEvent('finish', {token: out, card: data});\n        this.hide();\n      }\n    });\n\n    const inputFields = ([\n      cardInputField,\n      nameInputField,\n      expireInputField,\n      cvcInputField,\n      countryInputField,\n      postcodeInputField\n    ] as const).filter(Boolean);\n    handleInputFieldsOnChange(inputFields, (valid) => {\n      payButton.disabled = !valid;\n      // payButton.classList.toggle('btn-disabled', !valid);\n    });\n\n    if(savedCard) {\n      cardInputField.value = savedCard.cardNumber;\n      expireInputField.value = savedCard.expiryFull;\n      cvcInputField.value = savedCard.cvc;\n      nameInputField && (nameInputField.value = savedCard.cardholderName);\n      countryInputField && (countryInputField.value = savedCard.country);\n      postcodeInputField && (postcodeInputField.value = savedCard.zip);\n    }\n\n    this.body.append(this.btnConfirmOnEnter = payButton);\n\n    this.show();\n\n    if(!cardInputField.validateNew(undefined, undefined, true)) {\n      placeCaretAtEnd(cardInputField.input);\n    }\n  }\n}\n","import formatValueByPattern from './formatValueByPattern';\n\nexport default function formatInputValueByPattern(options: {\n  value: string,\n  getPattern: Parameters<typeof formatValueByPattern>[0],\n  deleting?: boolean,\n  input?: HTMLElement\n}) {\n  const {value: originalValue, getPattern, deleting, input} = options;\n  const pushRest = !deleting && !!originalValue.length;\n  const result = formatValueByPattern(getPattern, originalValue, {\n    selectionStart: input ? (input as HTMLInputElement).selectionStart : 0,\n    selectionEnd: input ? (input as HTMLInputElement).selectionEnd : 0\n  }, pushRest)\n  const {value, selection} = result;\n\n  return {\n    value,\n    meta: {\n      autocorrectComplete: result.autocorrectComplete,\n      empty: !value\n    },\n    selection\n  };\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport PopupElement from '.';\nimport placeCaretAtEnd from '../../helpers/dom/placeCaretAtEnd';\nimport {AccountPassword, AccountTmpPassword} from '../../layer';\nimport {InputState} from '../inputField';\nimport PasswordInputField from '../passwordInputField';\nimport {SettingSection} from '../sidebarLeft';\nimport {PaymentButton} from './payment';\n\nexport default class PopupPaymentCardConfirmation extends PopupElement<{\n  finish: (tmpPassword: AccountTmpPassword) => void\n}> {\n  constructor(card: string, passwordState: AccountPassword) {\n    super('popup-payment popup-payment-card-confirmation', {\n      closable: true,\n      overlayClosable: true,\n      body: true,\n      scrollable: true,\n      title: 'Checkout.PasswordEntry.Title'\n    });\n\n    const section = new SettingSection({noDelimiter: true, noShadow: true, caption: 'Checkout.PasswordEntry.Text', captionArgs: [card]});\n    const passwordInputField = new PasswordInputField({labelText: passwordState.hint});\n    section.content.append(passwordInputField.container);\n    this.scrollable.append(section.container);\n\n    const onInput = () => {\n      payButton.disabled = !passwordInputField.value;\n      passwordInputField.setState(InputState.Neutral);\n    };\n\n    passwordInputField.input.addEventListener('input', onInput);\n\n    const payButton = PaymentButton({\n      key: 'Checkout.PasswordEntry.Pay',\n      onClick: async() => {\n        try {\n          const inputCheckPassword = await this.managers.passwordManager.getInputCheckPassword(passwordInputField.value, passwordState);\n          const tmpPassword = await this.managers.apiManager.invokeApi('account.getTmpPassword', {\n            password: inputCheckPassword,\n            period: 60\n          });\n\n          this.dispatchEvent('finish', tmpPassword);\n          this.hide();\n        } catch(err) {\n          if((err as ApiError).type === 'PASSWORD_HASH_INVALID') {\n            (err as ApiError).handled = true;\n            passwordInputField.setError('PASSWORD_HASH_INVALID');\n          }\n\n          throw err;\n        }\n      }\n    });\n    this.body.append(this.btnConfirmOnEnter = payButton);\n\n    onInput();\n\n    this.show();\n\n    placeCaretAtEnd(passwordInputField.input);\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport PopupElement from '.';\nimport placeCaretAtEnd from '../../helpers/dom/placeCaretAtEnd';\nimport {InputInvoice, PaymentRequestedInfo, PaymentsPaymentForm, PaymentsValidatedRequestedInfo} from '../../layer';\nimport matchEmail from '../../lib/richTextProcessor/matchEmail';\nimport CheckboxField from '../checkboxField';\nimport CountryInputField from '../countryInputField';\nimport InputField from '../inputField';\nimport Row from '../row';\nimport {SettingSection} from '../sidebarLeft';\nimport TelInputField from '../telInputField';\nimport {PaymentButton} from './payment';\nimport {createCountryZipFields, handleInputFieldsOnChange, InputFieldCorrected} from './paymentCard';\n\nexport type PaymentShippingAddress = PaymentRequestedInfo;\n\ntype ShippingFocusField = 'name' | 'email' | 'phone';\n\nexport default class PopupPaymentShipping extends PopupElement<{\n  finish: (o: {shippingAddress: PaymentShippingAddress, requestedInfo: PaymentsValidatedRequestedInfo}) => void\n}> {\n  constructor(\n    private paymentForm: PaymentsPaymentForm,\n    private inputInvoice: InputInvoice,\n    private focus?: ShippingFocusField\n  ) {\n    super('popup-payment popup-payment-shipping', {\n      closable: true,\n      overlayClosable: true,\n      body: true,\n      scrollable: true,\n      title: 'PaymentShippingInfo'\n    });\n\n    this.d();\n  }\n\n  private d() {\n    const paymentForm = this.paymentForm;\n    const invoice = paymentForm.invoice;\n    const savedInfo = this.paymentForm.saved_info;\n\n    let addressSection: SettingSection,\n      address1InputField: InputField,\n      address2InputField: InputField,\n      cityInputField: InputField,\n      stateInputField: InputField,\n      countryInputField: CountryInputField,\n      postcodeInputField: InputFieldCorrected;\n    if(invoice.pFlags.shipping_address_requested) {\n      addressSection = new SettingSection({name: 'PaymentShippingAddress', noDelimiter: true, noShadow: true});\n      address1InputField = new InputField({label: 'PaymentShippingAddress1Placeholder', maxLength: 64, required: true});\n      address2InputField = new InputField({label: 'PaymentShippingAddress2Placeholder', maxLength: 64});\n      cityInputField = new InputField({label: 'PaymentShippingCityPlaceholder', maxLength: 64, required: true});\n      stateInputField = new InputField({label: 'PaymentShippingStatePlaceholder', maxLength: 64});\n      const res = createCountryZipFields(true, true);\n      countryInputField = res.countryInputField;\n      postcodeInputField = res.postcodeInputField;\n\n      addressSection.content.append(...[\n        address1InputField,\n        address2InputField,\n        cityInputField,\n        stateInputField,\n        countryInputField,\n        postcodeInputField\n      ].filter(Boolean).map((inputField) => inputField.container));\n    }\n\n    let receiverSection: SettingSection;\n    let nameInputField: InputField, emailInputField: InputField, telInputField: TelInputField;\n    if([invoice.pFlags.name_requested, invoice.pFlags.email_requested, invoice.pFlags.phone_requested].includes(true)) {\n      receiverSection = new SettingSection({name: 'PaymentShippingReceiver', noDelimiter: true, noShadow: true});\n\n      const validateEmail = () => {\n        const value = emailInputField.value;\n        const match = matchEmail(value);\n        if(!match || match[0].length !== value.length) {\n          return false;\n        }\n\n        return true;\n      };\n\n      const validatePhone = () => {\n        return !!telInputField.value.match(/\\d/);\n      };\n\n      if(invoice.pFlags.name_requested) nameInputField = new InputField({label: 'PaymentShippingName', maxLength: 256, required: true});\n      if(invoice.pFlags.email_requested) emailInputField = new InputField({label: 'PaymentShippingEmailPlaceholder', maxLength: 64, required: true, validate: validateEmail});\n      if(invoice.pFlags.phone_requested) telInputField = new TelInputField({required: true, validate: validatePhone});\n\n      receiverSection.content.append(...[\n        nameInputField,\n        emailInputField,\n        telInputField\n      ].filter(Boolean).map((inputField) => inputField.container));\n    }\n\n    const saveCheckboxField = new CheckboxField({\n      text: 'PaymentShippingSave',\n      checked: true\n    });\n    const saveRow = new Row({\n      checkboxField: saveCheckboxField,\n      subtitleLangKey: 'PaymentShippingSaveInfo',\n      noCheckboxSubtitle: true\n    });\n\n    (receiverSection || addressSection).content.append(saveRow.container);\n\n    this.scrollable.append(...[addressSection, receiverSection].filter(Boolean).map((section) => section.container));\n\n    const payButton = PaymentButton({\n      key: 'PaymentInfo.Done',\n      onClick: async() => {\n        const selectedCountry = countryInputField && countryInputField.getSelected().country;\n        const data: PaymentShippingAddress = {\n          _: 'paymentRequestedInfo',\n          shipping_address: selectedCountry && {\n            _: 'postAddress',\n            street_line1: address1InputField.value,\n            street_line2: address2InputField.value,\n            city: cityInputField.value,\n            state: stateInputField.value,\n            // country: countryInputField.value,\n            country_iso2: selectedCountry?.iso2,\n            post_code: postcodeInputField.value\n          },\n          name: nameInputField?.value,\n          email: emailInputField?.value,\n          phone: telInputField?.value\n        };\n\n        try {\n          const requestedInfo = await this.managers.appPaymentsManager.validateRequestedInfo(this.inputInvoice, data, saveCheckboxField?.checked);\n\n          this.dispatchEvent('finish', {\n            shippingAddress: data,\n            requestedInfo\n          });\n\n          this.hide();\n        } catch(err: any) {\n          const errorMap: {[err: string]: InputField} = {\n            ADDRESS_STREET_LINE1_INVALID: address1InputField,\n            ADDRESS_STREET_LINE2_INVALID: address2InputField,\n            ADDRESS_COUNTRY_INVALID: countryInputField,\n            ADDRESS_CITY_INVALID: cityInputField,\n            ADDRESS_STATE_INVALID: stateInputField,\n            ADDRESS_POSTCODE_INVALID: postcodeInputField,\n\n            REQ_INFO_NAME_INVALID: nameInputField,\n            REQ_INFO_EMAIL_INVALID: emailInputField,\n            REQ_INFO_PHONE_INVALID: telInputField\n          };\n\n          const inputField = errorMap[(err as ApiError).type];\n          if(inputField) {\n            inputField.setError();\n            (err as any).handled = true;\n          }\n\n          throw err;\n        }\n      }\n    });\n    this.body.append(this.btnConfirmOnEnter = payButton);\n\n    if(savedInfo) {\n      const shippingAddress = savedInfo.shipping_address;\n      if(shippingAddress) {\n        address1InputField.value = shippingAddress.street_line1;\n        address2InputField.value = shippingAddress.street_line2;\n        cityInputField.value = shippingAddress.city;\n        stateInputField.value = shippingAddress.state;\n        countryInputField.selectCountryByIso2(shippingAddress.country_iso2);\n        postcodeInputField.value = shippingAddress.post_code;\n      }\n\n      savedInfo.name && nameInputField && (nameInputField.value = savedInfo.name);\n      savedInfo.email && emailInputField && (emailInputField.value = savedInfo.email);\n      savedInfo.phone && telInputField && (telInputField.value = savedInfo.phone);\n    }\n\n    const {validate} = handleInputFieldsOnChange([\n      address1InputField,\n      address2InputField,\n      cityInputField,\n      stateInputField,\n      countryInputField,\n      postcodeInputField,\n      nameInputField,\n      emailInputField,\n      telInputField\n    ].filter(Boolean), (valid) => {\n      payButton.disabled = !valid;\n    });\n\n    validate();\n\n    this.show();\n\n    let focusField: InputField;\n    if(this.focus) {\n      const focusMap: {[field in ShippingFocusField]?: InputField} = {\n        name: nameInputField,\n        email: emailInputField,\n        phone: telInputField\n      };\n\n      focusField = focusMap[this.focus];\n    } else {\n      focusField = address1InputField;\n    }\n\n    if(focusField) {\n      placeCaretAtEnd(focusField.input);\n    }\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport PopupElement from '.';\nimport accumulate from '../../helpers/array/accumulate';\nimport {attachClickEvent} from '../../helpers/dom/clickEvent';\nimport paymentsWrapCurrencyAmount from '../../helpers/paymentsWrapCurrencyAmount';\nimport {PaymentsPaymentForm, PaymentsValidatedRequestedInfo, ShippingOption} from '../../layer';\nimport Button from '../button';\nimport RadioField from '../radioField';\nimport Row, {RadioFormFromRows} from '../row';\nimport {SettingSection} from '../sidebarLeft';\nimport {PaymentButton} from './payment';\n\nexport default class PopupPaymentShippingMethods extends PopupElement<{\n  finish: (shippingOption: ShippingOption) => void\n}> {\n  constructor(\n    private paymentForm: PaymentsPaymentForm,\n    private requestedInfo: PaymentsValidatedRequestedInfo,\n    private shippingOption: ShippingOption\n  ) {\n    super('popup-payment popup-payment-shipping-methods', {\n      closable: true,\n      overlayClosable: true,\n      body: true,\n      scrollable: true,\n      title: 'PaymentShippingMethod'\n    });\n\n    this.d();\n  }\n\n  private d() {\n    const section = new SettingSection({name: 'PaymentCheckoutShippingMethod', noDelimiter: true, noShadow: true});\n\n    const rows = this.requestedInfo.shipping_options.map((shippingOption) => {\n      return new Row({\n        radioField: new RadioField({\n          text: shippingOption.title,\n          name: 'shipping-method',\n          value: shippingOption.id\n        }),\n        subtitle: paymentsWrapCurrencyAmount(\n          accumulate(shippingOption.prices.map(({amount}) => +amount), 0),\n          this.paymentForm.invoice.currency\n        )\n      });\n    });\n\n    let lastShippingId: string;\n    const form = RadioFormFromRows(rows, (value) => {\n      lastShippingId = value;\n    });\n\n    if(this.shippingOption) {\n      rows.find((row) => row.radioField.input.value === this.shippingOption.id).radioField.checked = true;\n    } else {\n      rows[0].radioField.checked = true;\n    }\n\n    section.content.append(form);\n\n    this.scrollable.append(section.container);\n\n    const payButton = PaymentButton({\n      key: 'PaymentInfo.Done',\n      onClick: () => {\n        this.dispatchEvent('finish', this.requestedInfo.shipping_options.find((option) => option.id === lastShippingId));\n        this.hide();\n      }\n    });\n    this.body.append(this.btnConfirmOnEnter = payButton);\n\n    this.show();\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport PopupElement from '.';\nimport Currencies from '../../config/currencies';\nimport {FontFamily, FontSize} from '../../config/font';\nimport accumulate from '../../helpers/array/accumulate';\nimport getTextWidth from '../../helpers/canvas/getTextWidth';\nimport {detectUnifiedCardBrand} from '../../helpers/cards/cardBrands';\nimport {attachClickEvent, simulateClickEvent} from '../../helpers/dom/clickEvent';\nimport findUpAsChild from '../../helpers/dom/findUpAsChild';\nimport findUpClassName from '../../helpers/dom/findUpClassName';\nimport placeCaretAtEnd from '../../helpers/dom/placeCaretAtEnd';\nimport {renderImageFromUrlPromise} from '../../helpers/dom/renderImageFromUrl';\nimport replaceContent from '../../helpers/dom/replaceContent';\nimport setInnerHTML from '../../helpers/dom/setInnerHTML';\nimport toggleDisability from '../../helpers/dom/toggleDisability';\nimport {formatPhoneNumber} from '../../helpers/formatPhoneNumber';\nimport paymentsWrapCurrencyAmount from '../../helpers/paymentsWrapCurrencyAmount';\nimport ScrollSaver from '../../helpers/scrollSaver';\nimport tsNow from '../../helpers/tsNow';\nimport {AccountTmpPassword, InputInvoice, InputPaymentCredentials, LabeledPrice, Message, MessageMedia, PaymentRequestedInfo, PaymentSavedCredentials, PaymentsPaymentForm, PaymentsPaymentReceipt, PaymentsValidatedRequestedInfo, PostAddress, ShippingOption} from '../../layer';\nimport I18n, {i18n, LangPackKey, _i18n} from '../../lib/langPack';\nimport wrapEmojiText from '../../lib/richTextProcessor/wrapEmojiText';\nimport wrapRichText from '../../lib/richTextProcessor/wrapRichText';\nimport rootScope from '../../lib/rootScope';\nimport AvatarElement from '../avatar';\nimport Button from '../button';\nimport CheckboxField from '../checkboxField';\nimport PeerTitle from '../peerTitle';\nimport {putPreloader} from '../putPreloader';\nimport Row from '../row';\nimport {toastNew} from '../toast';\nimport {wrapPhoto} from '../wrappers';\nimport wrapPeerTitle from '../wrappers/peerTitle';\nimport PopupPaymentCard, {PaymentCardDetails, PaymentCardDetailsResult} from './paymentCard';\nimport PopupPaymentCardConfirmation from './paymentCardConfirmation';\nimport PopupPaymentShipping, {PaymentShippingAddress} from './paymentShipping';\nimport PopupPaymentShippingMethods from './paymentShippingMethods';\nimport PopupPaymentVerification from './paymentVerification';\n\nconst iconPath = 'assets/img/';\nconst icons = [\n  'amex',\n  'card',\n  'diners',\n  'discover',\n  'jcb',\n  'mastercard',\n  'visa',\n  'unionpay',\n  'mir',\n  'logo'\n];\n\nexport function getPaymentBrandIconPath(brand: string) {\n  if(!icons.includes(brand)) {\n    return;\n  }\n\n  return `${iconPath}${brand}.svg`;\n}\n\nexport function PaymentButton(options: {\n  onClick: () => Promise<any> | void,\n  key?: LangPackKey,\n  textEl?: I18n.IntlElement\n}) {\n  const textEl = options.textEl ?? new I18n.IntlElement({key: options.key ?? 'PaymentInfo.Done'});\n  const key = textEl.key;\n  const payButton = Button('btn-primary btn-color-primary payment-item-pay');\n  payButton.append(textEl.element);\n  attachClickEvent(payButton, async() => {\n    const result = options.onClick();\n    if(!(result instanceof Promise)) {\n      return;\n    }\n\n    const d = putPreloader(payButton);\n    const toggle = toggleDisability([payButton], true);\n    textEl.compareAndUpdate({key: 'PleaseWait'});\n    try {\n      await result;\n    } catch(err) {\n      if(!(err as any).handled) {\n        console.error('payment button error', err);\n      }\n\n      toggle();\n      textEl.compareAndUpdate({key});\n      d.remove();\n    }\n  });\n  return payButton;\n}\n\nexport type PaymentsCredentialsToken = {type: 'card', token?: string, id?: string};\n\nexport default class PopupPayment extends PopupElement {\n  private tipButtonsMap: Map<number, HTMLElement>;\n\n  constructor(\n    private message: Message.message,\n    private inputInvoice: InputInvoice,\n    private paymentForm?: PaymentsPaymentForm | PaymentsPaymentReceipt\n  ) {\n    super('popup-payment', {\n      closable: true,\n      overlayClosable: true,\n      body: true,\n      scrollable: true,\n      title: true\n    });\n\n    this.tipButtonsMap = new Map();\n    this.d();\n  }\n\n  private async d() {\n    this.element.classList.add('is-loading');\n    this.show();\n\n    let confirmed = false;\n    const onConfirmed = () => {\n      if(confirmed) {\n        return;\n      }\n\n      confirmed = true;\n      if(popupPaymentVerification) {\n        popupPaymentVerification.hide();\n      }\n\n      this.hide();\n    };\n\n    let {paymentForm, message} = this;\n\n    if(message) {\n      this.listenerSetter.add(rootScope)('payment_sent', ({peerId, mid}) => {\n        if(message.peerId === peerId && message.mid === mid) {\n          onConfirmed();\n        }\n      });\n    }\n\n    const mediaInvoice = message?.media as MessageMedia.messageMediaInvoice;\n    const isReceipt = mediaInvoice ? !!mediaInvoice.receipt_msg_id : paymentForm._ === 'payments.paymentReceipt';\n    const isTest = mediaInvoice ? mediaInvoice.pFlags.test : paymentForm.invoice.pFlags.test;\n\n    const photo = mediaInvoice ? mediaInvoice.photo : paymentForm.photo;\n    const title = mediaInvoice ? mediaInvoice.title : paymentForm.title;\n    const description = mediaInvoice ? mediaInvoice.description : paymentForm.description;\n\n    _i18n(this.title, isReceipt ? 'PaymentReceipt' : 'PaymentCheckout');\n    if(isTest) {\n      this.title.append(' (Test)');\n    }\n\n    const className = 'payment-item';\n\n    const itemEl = document.createElement('div');\n    itemEl.classList.add(className);\n\n    const detailsClassName = className + '-details';\n    const details = document.createElement('div');\n    details.classList.add(detailsClassName);\n\n    let photoEl: HTMLElement;\n    if(photo) {\n      photoEl = document.createElement('div');\n      photoEl.classList.add(detailsClassName + '-photo', 'media-container-contain');\n      wrapPhoto({\n        photo: photo,\n        container: photoEl,\n        boxWidth: 100,\n        boxHeight: 100,\n        size: {_: 'photoSizeEmpty', type: ''}\n      });\n      details.append(photoEl);\n    }\n\n    const linesClassName = detailsClassName + '-lines';\n    const linesEl = document.createElement('div');\n    linesEl.classList.add(linesClassName);\n\n    const titleEl = document.createElement('div');\n    titleEl.classList.add(linesClassName + '-title');\n\n    const descriptionEl = document.createElement('div');\n    descriptionEl.classList.add(linesClassName + '-description');\n\n    const botName = document.createElement('div');\n    botName.classList.add(linesClassName + '-bot-name');\n\n    linesEl.append(titleEl, descriptionEl, botName);\n\n    setInnerHTML(titleEl, wrapEmojiText(title));\n    setInnerHTML(descriptionEl, wrapEmojiText(description));\n\n    const peerTitle = new PeerTitle();\n    botName.append(peerTitle.element);\n\n    details.append(linesEl);\n    itemEl.append(details);\n    this.scrollable.append(itemEl);\n\n    const preloaderContainer = document.createElement('div');\n    preloaderContainer.classList.add(className + '-preloader-container');\n    const preloader = putPreloader(preloaderContainer, true);\n    this.scrollable.container.append(preloaderContainer);\n\n    const inputInvoice = this.inputInvoice;\n    if(!paymentForm) {\n      if(isReceipt) paymentForm = await this.managers.appPaymentsManager.getPaymentReceipt(message.peerId, mediaInvoice.receipt_msg_id);\n      else paymentForm = await this.managers.appPaymentsManager.getPaymentForm(inputInvoice);\n      this.paymentForm = paymentForm;\n    }\n\n    let savedInfo = (paymentForm as PaymentsPaymentForm).saved_info || (paymentForm as PaymentsPaymentReceipt).info;\n    const savedCredentials = (paymentForm as PaymentsPaymentForm).saved_credentials?.[0];\n    let [lastRequestedInfo, passwordState, providerPeerTitle] = await Promise.all([\n      !isReceipt && savedInfo && this.managers.appPaymentsManager.validateRequestedInfo(inputInvoice, savedInfo),\n      savedCredentials && this.managers.passwordManager.getState(),\n      wrapPeerTitle({peerId: paymentForm.provider_id.toPeerId()})\n    ]);\n\n    console.log(paymentForm, lastRequestedInfo);\n\n    await peerTitle.update({peerId: paymentForm.bot_id.toPeerId()});\n    preloaderContainer.remove();\n    this.element.classList.remove('is-loading');\n\n    const wrapAmount = (amount: string | number, skipSymbol?: boolean) => {\n      return paymentsWrapCurrencyAmount(amount, currency, skipSymbol);\n    };\n\n    const {invoice} = paymentForm;\n    const currency = invoice.currency;\n\n    const isRecurring = invoice.pFlags.recurring && !isReceipt;\n\n    await peerTitle.update({peerId: paymentForm.bot_id.toPeerId()});\n    const peerTitle2 = isRecurring ? await wrapPeerTitle({peerId: paymentForm.bot_id.toPeerId()}) : undefined;\n    preloaderContainer.remove();\n    this.element.classList.remove('is-loading');\n\n    const makeLabel = () => {\n      const labelEl = document.createElement('div');\n      labelEl.classList.add(pricesClassName + '-price');\n\n      const left = document.createElement('span');\n      const right = document.createElement('span');\n      labelEl.append(left, right);\n      return {label: labelEl, left, right};\n    };\n\n    const pricesClassName = className + '-prices';\n    const prices = document.createElement('div');\n    prices.classList.add(pricesClassName);\n    const makePricesElements = (prices: LabeledPrice[]) => {\n      return prices.map((price) => {\n        const {amount, label} = price;\n\n        const _label = makeLabel();\n        _label.left.textContent = label;\n\n        const wrappedAmount = wrapAmount(amount);\n        _label.right.textContent = wrappedAmount;\n\n        return _label.label;\n      });\n    };\n\n    const pricesElements = makePricesElements(invoice.prices);\n\n    let getTipsAmount = (): number => 0;\n    let shippingAmount = 0;\n\n    const getTotalTotal = () => totalAmount + getTipsAmount() + shippingAmount;\n    const setTotal = () => {\n      const wrapped = wrapAmount(getTotalTotal());\n      totalLabel.right.textContent = wrapped;\n      payI18n.compareAndUpdate({\n        key: 'PaymentCheckoutPay',\n        args: [wrapped]\n      });\n    };\n\n    const payI18n = new I18n.IntlElement();\n\n    const totalLabel = makeLabel();\n    totalLabel.label.classList.add('is-total');\n    _i18n(totalLabel.left, 'PaymentTransactionTotal');\n    const totalAmount = accumulate(invoice.prices.map(({amount}) => +amount), 0);\n\n    const canTip = (invoice.max_tip_amount !== undefined && !isReceipt) || !!(paymentForm as PaymentsPaymentReceipt).tip_amount;\n    if(canTip) {\n      const tipsClassName = className + '-tips';\n\n      const currencyData = Currencies[currency];\n\n      getTipsAmount = () => +getInputValue().replace(/\\D/g, '');\n\n      const getInputValue = () => {\n        // return input.textContent;\n        return input.value;\n      };\n\n      const setInputWidth = () => {\n        const width = getTextWidth(getInputValue(), `500 ${FontSize} ${FontFamily}`);\n        input.style.width = width + 'px';\n      };\n\n      const setInputValue = (amount: string | number) => {\n        amount = Math.min(+amount, +invoice.max_tip_amount);\n        const wrapped = wrapAmount(amount, true);\n\n        input.value = wrapped;\n        // input.textContent = wrapped;\n        if(document.activeElement === input) {\n          placeCaretAtEnd(input);\n        }\n\n        unsetActiveTip && unsetActiveTip();\n        const tipEl = this.tipButtonsMap.get(amount);\n        if(tipEl) {\n          tipEl.classList.add('active');\n        }\n\n        setInputWidth();\n        setTotal();\n      };\n\n      const tipsLabel = makeLabel();\n      _i18n(tipsLabel.left, isReceipt ? 'PaymentTip' : 'PaymentTipOptional');\n      const input = document.createElement('input');\n      input.type = 'tel';\n      // const input: HTMLElement = document.createElement('div');\n      // input.contentEditable = 'true';\n      input.classList.add('input-clear', tipsClassName + '-input');\n      tipsLabel.right.append(input);\n\n      if(!isReceipt) {\n        tipsLabel.label.style.cursor = 'text';\n      } else {\n        tipsLabel.label.classList.add('disable-hover');\n      }\n\n      tipsLabel.label.addEventListener('mousedown', (e) => {\n        if(!findUpAsChild(e.target as HTMLElement, input)) {\n          placeCaretAtEnd(input);\n        }\n      });\n\n      const haveToIgnoreEvents = input instanceof HTMLInputElement ? 1 : 2;\n      const onSelectionChange = () => {\n        if(ignoreNextSelectionChange) {\n          --ignoreNextSelectionChange;\n          return;\n        }\n\n        // setTimeout(() => {\n        ignoreNextSelectionChange = haveToIgnoreEvents;\n        placeCaretAtEnd(input);\n        // }, 0);\n      };\n\n      const onFocus = () => {\n        // cancelEvent(e);\n        setTimeout(() => {\n          ignoreNextSelectionChange = haveToIgnoreEvents;\n          placeCaretAtEnd(input);\n          document.addEventListener('selectionchange', onSelectionChange);\n        }, 0);\n      };\n\n      const onFocusOut = () => {\n        input.addEventListener('focus', onFocus, {once: true});\n        document.removeEventListener('selectionchange', onSelectionChange);\n      };\n\n      let ignoreNextSelectionChange: number;\n      input.addEventListener('focusout', onFocusOut);\n      onFocusOut();\n\n      input.addEventListener('input', () => {\n        setInputValue(getTipsAmount());\n      });\n\n      const s = [currencyData.symbol, currencyData.space_between ? ' ' : ''];\n      if(!currencyData.symbol_left) s.reverse();\n      tipsLabel.right[currencyData.symbol_left ? 'prepend' : 'append'](s.join(''));\n\n      pricesElements.push(tipsLabel.label);\n\n      //\n      let unsetActiveTip: () => void;\n      if(!isReceipt) {\n        const tipsEl = document.createElement('div');\n        tipsEl.classList.add(tipsClassName);\n\n        const tipClassName = tipsClassName + '-tip';\n        const tipButtons = invoice.suggested_tip_amounts.map((tipAmount) => {\n          const button = Button(tipClassName, {noRipple: true});\n          button.textContent = wrapAmount(tipAmount);\n\n          this.tipButtonsMap.set(+tipAmount, button);\n          return button;\n        });\n\n        unsetActiveTip = () => {\n          const prevTipEl = tipsEl.querySelector('.active');\n          if(prevTipEl) {\n            prevTipEl.classList.remove('active');\n          }\n        };\n\n        attachClickEvent(tipsEl, (e) => {\n          const tipEl = findUpClassName(e.target, tipClassName);\n          if(!tipEl) {\n            return;\n          }\n\n          let tipAmount = 0;\n          if(tipEl.classList.contains('active')) {\n            tipEl.classList.remove('active');\n          } else {\n            unsetActiveTip();\n            tipEl.classList.add('active');\n\n            for(const [amount, el] of this.tipButtonsMap) {\n              if(el === tipEl) {\n                tipAmount = amount;\n                break;\n              }\n            }\n          }\n\n          setInputValue(tipAmount);\n        });\n\n        setInputValue(0);\n\n        tipsEl.append(...tipButtons);\n        pricesElements.push(tipsEl);\n      } else {\n        setInputValue((paymentForm as PaymentsPaymentReceipt).tip_amount);\n      }\n    } else {\n      setTotal();\n    }\n\n    pricesElements.push(totalLabel.label);\n\n    prices.append(...pricesElements);\n    itemEl.append(prices);\n\n    // /\n\n    const setRowIcon = async(row: Row, icon?: string) => {\n      const img = document.createElement('img');\n      img.classList.add('media-photo');\n      await renderImageFromUrlPromise(img, getPaymentBrandIconPath(icon));\n      let container = row.media;\n      if(!container) {\n        container = row.createMedia('small');\n        container.classList.add('media-container-cover');\n        container.append(img);\n      } else {\n        replaceContent(container, img);\n      }\n    };\n\n    const createRow = (options: ConstructorParameters<typeof Row>[0]) => {\n      if(options.titleLangKey) {\n        options.subtitleLangKey = options.titleLangKey;\n      }\n\n      options.noWrap = true;\n      const row = new Row(options);\n      row.container.classList.add(className + '-row');\n\n      if(options.titleLangKey) {\n        row.subtitle.classList.add('hide');\n      }\n\n      return row;\n    };\n\n    const setRowTitle = (row: Row, textContent: string) => {\n      row.title.textContent = textContent;\n      if(!textContent) {\n        const e = I18n.weakMap.get(row.subtitle.firstElementChild as HTMLElement) as I18n.IntlElement;\n        row.title.append(i18n(e.key));\n      }\n\n      row.subtitle.classList.toggle('hide', !textContent);\n    };\n\n    const setCardSubtitle = (card: PaymentCardDetailsResult) => {\n      let brand: string;\n      let str: string;\n      let icon: string;\n      if('title' in card) {\n        brand = card.title.split(' ').shift();\n        str = card.title;\n        icon = card.icon;\n      } else {\n        brand = detectUnifiedCardBrand(card.cardNumber);\n        str = brand + ' *' + card.cardNumber.split(' ').pop();\n      }\n\n      methodRow.title.classList.remove('tgico', 'tgico-card_outline');\n      setRowIcon(methodRow, icon || brand.toLowerCase());\n      setRowTitle(methodRow, str);\n    };\n\n    const onMethodClick = () => {\n      new PopupPaymentCard(paymentForm as PaymentsPaymentForm, previousCardDetails as PaymentCardDetails).addEventListener('finish', ({token, card}) => {\n        previousToken = token, previousCardDetails = card;\n\n        setCardSubtitle(card);\n      });\n    };\n\n    let previousCardDetails: PaymentCardDetailsResult, previousToken: PaymentsCredentialsToken;\n    const methodRow = createRow({\n      titleLangKey: 'PaymentCheckoutMethod',\n      clickable: isReceipt ? undefined : onMethodClick,\n      icon: 'card_outline'\n    });\n\n    methodRow.container.classList.add(className + '-method-row');\n\n    if(savedCredentials) {\n      setCardSubtitle(savedCredentials);\n    } else if((paymentForm as PaymentsPaymentReceipt).credentials_title) {\n      setCardSubtitle({title: (paymentForm as PaymentsPaymentReceipt).credentials_title});\n    }\n\n    const providerRow = createRow({\n      title: providerPeerTitle,\n      subtitleLangKey: 'PaymentCheckoutProvider'\n    });\n\n    const providerAvatar = new AvatarElement();\n    providerAvatar.classList.add('avatar-32');\n    providerRow.createMedia('small').append(providerAvatar);\n    /* await */ providerAvatar.updateWithOptions({peerId: paymentForm.provider_id.toPeerId()});\n\n    let shippingAddressRow: Row, shippingNameRow: Row, shippingEmailRow: Row, shippingPhoneRow: Row, shippingMethodRow: Row;\n    let lastShippingOption: ShippingOption, onShippingAddressClick: (focus?: ConstructorParameters<typeof PopupPaymentShipping>[2]) => void, onShippingMethodClick: () => void;\n    const setShippingTitle = invoice.pFlags.shipping_address_requested ? (shippingAddress?: PaymentShippingAddress) => {\n      if(!shippingAddress) {\n        shippingMethodRow.subtitle.classList.add('hide');\n        replaceContent(shippingMethodRow.title, i18n('PaymentShippingAddress'));\n        return;\n      }\n\n      const postAddress = shippingAddress.shipping_address;\n      setRowTitle(shippingAddressRow, [postAddress.city, postAddress.street_line1, postAddress.street_line2].filter(Boolean).join(', '));\n\n      shippingMethodRow.container.classList.toggle('hide', !lastRequestedInfo && !isReceipt);\n    } : undefined;\n\n    const setShippingInfo = (info: PaymentRequestedInfo) => {\n      setShippingTitle && setShippingTitle(info);\n      shippingNameRow && setRowTitle(shippingNameRow, info.name);\n      shippingEmailRow && setRowTitle(shippingEmailRow, info.email);\n      shippingPhoneRow && setRowTitle(shippingPhoneRow, info.phone && ('+' + formatPhoneNumber(info.phone).formatted));\n    };\n\n    if(!isReceipt) {\n      onShippingAddressClick = (focus) => {\n        new PopupPaymentShipping(paymentForm as PaymentsPaymentForm, inputInvoice, focus).addEventListener('finish', ({shippingAddress, requestedInfo}) => {\n          lastRequestedInfo = requestedInfo;\n          savedInfo = (paymentForm as PaymentsPaymentForm).saved_info = shippingAddress;\n          setShippingInfo(shippingAddress);\n        });\n      };\n    }\n\n    if(invoice.pFlags.shipping_address_requested) {\n      const setShippingOption = (shippingOption?: ShippingOption) => {\n        const scrollSaver = new ScrollSaver(this.scrollable, undefined, true);\n        scrollSaver.save();\n        if(lastShippingPricesElements) {\n          lastShippingPricesElements.forEach((node) => node.remove());\n        }\n\n        if(!shippingOption) {\n          shippingAmount = 0;\n\n          setTotal();\n          scrollSaver.restore();\n          this.onContentUpdate();\n          return;\n        }\n\n        lastShippingOption = shippingOption;\n        setRowTitle(shippingMethodRow, shippingOption.title);\n\n        shippingAmount = accumulate(shippingOption.prices.map(({amount}) => +amount), 0);\n        lastShippingPricesElements = makePricesElements(shippingOption.prices);\n        let l = totalLabel.label;\n        if(canTip) {\n          l = l.previousElementSibling as any;\n          if(!isReceipt) {\n            l = l.previousElementSibling as any;\n          }\n        }\n\n        lastShippingPricesElements.forEach((element) => l.parentElement.insertBefore(element, l));\n\n        setTotal();\n        scrollSaver.restore();\n        this.onContentUpdate();\n      };\n\n      shippingAddressRow = createRow({\n        icon: 'location',\n        titleLangKey: 'PaymentShippingAddress',\n        clickable: !isReceipt && onShippingAddressClick.bind(null, undefined)\n      });\n\n      let lastShippingPricesElements: HTMLElement[];\n      shippingMethodRow = createRow({\n        icon: 'shipping',\n        titleLangKey: 'PaymentCheckoutShippingMethod',\n        clickable: !isReceipt && (onShippingMethodClick = () => {\n          new PopupPaymentShippingMethods(paymentForm as PaymentsPaymentForm, lastRequestedInfo, lastShippingOption).addEventListener('finish', (shippingOption) => {\n            setShippingOption(shippingOption);\n          });\n        })\n      });\n\n      shippingMethodRow.container.classList.add('hide');\n\n      const shippingOption = (paymentForm as PaymentsPaymentReceipt).shipping;\n      if(shippingOption) {\n        setShippingOption(shippingOption);\n      }\n    }\n\n    if(invoice.pFlags.name_requested) {\n      shippingNameRow = createRow({\n        icon: 'newprivate',\n        titleLangKey: 'PaymentCheckoutName',\n        clickable: !isReceipt && onShippingAddressClick.bind(null, 'name')\n      });\n    }\n\n    if(invoice.pFlags.email_requested) {\n      shippingEmailRow = createRow({\n        icon: 'mention',\n        titleLangKey: 'PaymentShippingEmailPlaceholder',\n        clickable: !isReceipt && onShippingAddressClick.bind(null, 'email')\n      });\n    }\n\n    if(invoice.pFlags.phone_requested) {\n      shippingPhoneRow = createRow({\n        icon: 'phone',\n        titleLangKey: 'PaymentCheckoutPhoneNumber',\n        clickable: !isReceipt && onShippingAddressClick.bind(null, 'phone')\n      });\n    }\n\n    if(savedInfo) {\n      setShippingInfo(savedInfo);\n    }\n\n    const rows = [\n      methodRow,\n      providerRow,\n      shippingAddressRow,\n      shippingMethodRow,\n      shippingNameRow,\n      shippingEmailRow,\n      shippingPhoneRow\n    ].filter(Boolean);\n\n    const acceptTermsCheckboxField = isRecurring && new CheckboxField({\n      text: 'Payments.Recurrent.Accept',\n      textArgs: [wrapRichText(invoice.recurring_terms_url), peerTitle2]\n    });\n\n    const acceptTermsRow = isRecurring && createRow({\n      checkboxField: acceptTermsCheckboxField,\n      noCheckboxSubtitle: true\n    });\n\n    const recurringElements = isRecurring ? [document.createElement('hr'), acceptTermsRow.container] : [];\n\n    this.scrollable.append(...[\n      document.createElement('hr'),\n      ...rows.map((row) => row.container),\n      ...recurringElements\n    ].filter(Boolean));\n\n    // /\n    let popupPaymentVerification: PopupPaymentVerification, lastTmpPasword: AccountTmpPassword;\n    const onClick = () => {\n      const missingInfo = invoice.pFlags.name_requested && !savedInfo?.name ? 'name' : (invoice.pFlags.email_requested && !savedInfo?.email ? 'email' : (invoice.pFlags.phone_requested && !savedInfo?.phone ? 'phone' : undefined));\n      if(invoice.pFlags.shipping_address_requested) {\n        if(!lastRequestedInfo) {\n          onShippingAddressClick();\n          return;\n        } else if(!lastShippingOption) {\n          onShippingMethodClick();\n          return;\n        }\n      } else if(missingInfo) {\n        onShippingAddressClick(missingInfo);\n        return;\n      }\n\n      if(!previousCardDetails && !lastTmpPasword) {\n        if(!savedCredentials) {\n          onMethodClick();\n          return;\n        }\n\n        Promise.resolve(passwordState ?? this.managers.passwordManager.getState()).then((_passwordState) => {\n          new PopupPaymentCardConfirmation(savedCredentials.title, _passwordState).addEventListener('finish', (tmpPassword) => {\n            passwordState = undefined;\n            lastTmpPasword = tmpPassword;\n            simulateClickEvent(payButton);\n\n            // * reserve 5 seconds\n            const diff = tmpPassword.valid_until - tsNow(true) - 5;\n            setTimeout(() => {\n              if(lastTmpPasword === tmpPassword) {\n                lastTmpPasword = undefined;\n              }\n            }, diff * 1000);\n          });\n        });\n\n        return;\n      }\n\n      return Promise.resolve().then(async() => {\n        const credentials: InputPaymentCredentials = lastTmpPasword ? {\n          _: 'inputPaymentCredentialsSaved',\n          id: savedCredentials.id,\n          tmp_password: lastTmpPasword.tmp_password\n        } : {\n          _: 'inputPaymentCredentials',\n          data: {\n            _: 'dataJSON',\n            data: JSON.stringify(previousToken.token ? previousToken : {type: previousToken.type, id: previousToken.id})\n          },\n          pFlags: {\n            save: previousCardDetails.save || undefined\n          }\n        };\n\n        try {\n          const paymentResult = await this.managers.appPaymentsManager.sendPaymentForm(\n            inputInvoice,\n            (paymentForm as PaymentsPaymentForm).form_id,\n            lastRequestedInfo?.id,\n            lastShippingOption?.id,\n            credentials,\n            getTipsAmount()\n          );\n\n          if(paymentResult._ === 'payments.paymentResult') {\n            onConfirmed();\n          } else {\n            popupPaymentVerification = new PopupPaymentVerification(paymentResult.url);\n            popupPaymentVerification.addEventListener('finish', () => {\n              popupPaymentVerification = undefined;\n\n              onConfirmed();\n            });\n            await new Promise<void>((resolve, reject) => {\n              popupPaymentVerification.addEventListener('close', () => {\n                popupPaymentVerification = undefined;\n                if(confirmed) {\n                  resolve();\n                } else {\n                  const err = new Error('payment not finished');\n                  (err as ApiError).handled = true;\n                  reject(err);\n                }\n              });\n            });\n          }\n        } catch(err) {\n          if((err as ApiError).type === 'BOT_PRECHECKOUT_TIMEOUT') {\n            toastNew({langPackKey: 'Error.AnError'});\n            (err as ApiError).handled = true;\n          } else if((err as ApiError).type === 'TMP_PASSWORD_INVALID') {\n            passwordState = lastTmpPasword = undefined;\n            simulateClickEvent(payButton);\n            (err as ApiError).handled = true;\n          }\n\n          throw err;\n        }\n      });\n    };\n\n    const onChange = () => {\n      payButton.disabled = !!(acceptTermsCheckboxField && !acceptTermsCheckboxField.checked);\n    };\n\n    let payButton: HTMLButtonElement;\n    if(isReceipt) {\n      payButton = PaymentButton({\n        onClick: () => this.hide(),\n        key: 'Done'\n      });\n    } else {\n      payButton = PaymentButton({\n        onClick: onClick,\n        textEl: payI18n\n      });\n    }\n\n    onChange();\n    if(acceptTermsCheckboxField) {\n      acceptTermsCheckboxField.input.addEventListener('change', onChange);\n    }\n\n    this.body.append(this.btnConfirmOnEnter = payButton);\n\n    this.onContentUpdate();\n  }\n}\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport type {AppImManager, ChatSavedPosition} from '../../lib/appManagers/appImManager';\r\nimport type {HistoryResult, MyMessage} from '../../lib/appManagers/appMessagesManager';\r\nimport type {MyDocument} from '../../lib/appManagers/appDocsManager';\r\nimport type Chat from './chat';\r\nimport {CHAT_ANIMATION_GROUP} from '../../lib/appManagers/appImManager';\r\nimport IS_TOUCH_SUPPORTED from '../../environment/touchSupport';\r\nimport {logger} from '../../lib/logger';\r\nimport rootScope from '../../lib/rootScope';\r\nimport BubbleGroups from './bubbleGroups';\r\nimport PopupDatePicker from '../popups/datePicker';\r\nimport PopupForward from '../popups/forward';\r\nimport PopupStickers from '../popups/stickers';\r\nimport ProgressivePreloader from '../preloader';\r\nimport Scrollable, {SliceSides} from '../scrollable';\r\nimport StickyIntersector from '../stickyIntersector';\r\nimport animationIntersector from '../animationIntersector';\r\nimport mediaSizes from '../../helpers/mediaSizes';\r\nimport {IS_ANDROID, IS_APPLE, IS_MOBILE, IS_SAFARI} from '../../environment/userAgent';\r\nimport I18n, {FormatterArguments, i18n, langPack, LangPackKey, UNSUPPORTED_LANG_PACK_KEY, _i18n} from '../../lib/langPack';\r\nimport AvatarElement from '../avatar';\r\nimport ripple from '../ripple';\r\nimport {wrapAlbum, wrapPhoto, wrapVideo, wrapDocument, wrapSticker, wrapPoll, wrapGroupedDocuments, wrapStickerAnimation} from '../wrappers';\r\nimport {MessageRender} from './messageRender';\r\nimport LazyLoadQueue from '../lazyLoadQueue';\r\nimport ListenerSetter from '../../helpers/listenerSetter';\r\nimport PollElement from '../poll';\r\nimport AudioElement from '../audio';\r\nimport {ChatInvite, Document, Message, MessageEntity,  MessageMedia,  MessageReplyHeader, Photo, PhotoSize, ReactionCount, ReplyMarkup, SponsoredMessage, Update, User, WebPage} from '../../layer';\r\nimport {BOT_START_PARAM, NULL_PEER_ID, REPLIES_PEER_ID} from '../../lib/mtproto/mtproto_config';\r\nimport {FocusDirection, ScrollStartCallbackDimensions} from '../../helpers/fastSmoothScroll';\r\nimport useHeavyAnimationCheck, {getHeavyAnimationPromise, dispatchHeavyAnimationEvent, interruptHeavyAnimation} from '../../hooks/useHeavyAnimationCheck';\r\nimport {fastRaf, fastRafPromise} from '../../helpers/schedulers';\r\nimport deferredPromise from '../../helpers/cancellablePromise';\r\nimport RepliesElement from './replies';\r\nimport DEBUG from '../../config/debug';\r\nimport {SliceEnd} from '../../helpers/slicedArray';\r\nimport PeerTitle from '../peerTitle';\r\nimport findUpClassName from '../../helpers/dom/findUpClassName';\r\nimport findUpTag from '../../helpers/dom/findUpTag';\r\nimport {toast, toastNew} from '../toast';\r\nimport {getElementByPoint} from '../../helpers/dom/getElementByPoint';\r\nimport {getMiddleware, Middleware} from '../../helpers/middleware';\r\nimport cancelEvent from '../../helpers/dom/cancelEvent';\r\nimport {attachClickEvent, simulateClickEvent} from '../../helpers/dom/clickEvent';\r\nimport htmlToDocumentFragment from '../../helpers/dom/htmlToDocumentFragment';\r\nimport reflowScrollableElement from '../../helpers/dom/reflowScrollableElement';\r\nimport replaceContent from '../../helpers/dom/replaceContent';\r\nimport setInnerHTML from '../../helpers/dom/setInnerHTML';\r\nimport whichChild from '../../helpers/dom/whichChild';\r\nimport {cancelAnimationByKey} from '../../helpers/animation';\r\nimport assumeType from '../../helpers/assumeType';\r\nimport debounce, {DebounceReturnType} from '../../helpers/schedulers/debounce';\r\nimport {SEND_WHEN_ONLINE_TIMESTAMP} from '../../lib/mtproto/constants';\r\nimport windowSize from '../../helpers/windowSize';\r\nimport {formatPhoneNumber} from '../../helpers/formatPhoneNumber';\r\nimport AppMediaViewer from '../appMediaViewer';\r\nimport SetTransition from '../singleTransition';\r\nimport handleHorizontalSwipe from '../../helpers/dom/handleHorizontalSwipe';\r\nimport findUpAttribute from '../../helpers/dom/findUpAttribute';\r\nimport findUpAsChild from '../../helpers/dom/findUpAsChild';\r\nimport formatCallDuration from '../../helpers/formatCallDuration';\r\nimport IS_CALL_SUPPORTED from '../../environment/callSupport';\r\nimport Button from '../button';\r\nimport {CallType} from '../../lib/calls/types';\r\nimport getVisibleRect from '../../helpers/dom/getVisibleRect';\r\nimport PopupJoinChatInvite from '../popups/joinChatInvite';\r\nimport {InternalLink, INTERNAL_LINK_TYPE} from '../../lib/appManagers/internalLink';\r\nimport ReactionsElement, {REACTIONS_ELEMENTS} from './reactions';\r\nimport type ReactionElement from './reaction';\r\nimport RLottiePlayer from '../../lib/rlottie/rlottiePlayer';\r\nimport pause from '../../helpers/schedulers/pause';\r\nimport ScrollSaver from '../../helpers/scrollSaver';\r\nimport getObjectKeysAndSort from '../../helpers/object/getObjectKeysAndSort';\r\nimport forEachReverse from '../../helpers/array/forEachReverse';\r\nimport formatNumber from '../../helpers/number/formatNumber';\r\nimport getViewportSlice from '../../helpers/dom/getViewportSlice';\r\nimport SuperIntersectionObserver from '../../helpers/dom/superIntersectionObserver';\r\nimport generateFakeIcon from '../generateFakeIcon';\r\nimport copyFromElement from '../../helpers/dom/copyFromElement';\r\nimport PopupElement from '../popups';\r\nimport setAttachmentSize from '../../helpers/setAttachmentSize';\r\nimport wrapWebPageDescription from '../wrappers/webPageDescription';\r\nimport wrapWebPageTitle from '../wrappers/webPageTitle';\r\nimport wrapEmojiText from '../../lib/richTextProcessor/wrapEmojiText';\r\nimport wrapRichText from '../../lib/richTextProcessor/wrapRichText';\r\nimport wrapMessageActionTextNew from '../wrappers/messageActionTextNew';\r\nimport isMentionUnread from '../../lib/appManagers/utils/messages/isMentionUnread';\r\nimport getMediaFromMessage from '../../lib/appManagers/utils/messages/getMediaFromMessage';\r\nimport getPeerColorById from '../../lib/appManagers/utils/peers/getPeerColorById';\r\nimport getPeerId from '../../lib/appManagers/utils/peers/getPeerId';\r\nimport getServerMessageId from '../../lib/appManagers/utils/messageId/getServerMessageId';\r\nimport generateMessageId from '../../lib/appManagers/utils/messageId/generateMessageId';\r\nimport {AppManagers} from '../../lib/appManagers/managers';\r\nimport {Awaited, SendMessageEmojiInteractionData} from '../../types';\r\nimport idleController from '../../helpers/idleController';\r\nimport overlayCounter from '../../helpers/overlayCounter';\r\nimport {cancelContextMenuOpening} from '../../helpers/dom/attachContextMenuListener';\r\nimport contextMenuController from '../../helpers/contextMenuController';\r\nimport {AckedResult} from '../../lib/mtproto/superMessagePort';\r\nimport middlewarePromise from '../../helpers/middlewarePromise';\r\nimport {EmoticonsDropdown} from '../emoticonsDropdown';\r\nimport indexOfAndSplice from '../../helpers/array/indexOfAndSplice';\r\nimport noop from '../../helpers/noop';\r\nimport getAlbumText from '../../lib/appManagers/utils/messages/getAlbumText';\r\nimport paymentsWrapCurrencyAmount from '../../helpers/paymentsWrapCurrencyAmount';\r\nimport PopupPayment from '../popups/payment';\r\nimport isInDOM from '../../helpers/dom/isInDOM';\r\nimport getStickerEffectThumb from '../../lib/appManagers/utils/stickers/getStickerEffectThumb';\r\nimport attachStickerViewerListeners from '../stickerViewer';\r\nimport {makeMediaSize, MediaSize} from '../../helpers/mediaSize';\r\nimport lottieLoader from '../../lib/rlottie/lottieLoader';\r\nimport appDownloadManager from '../../lib/appManagers/appDownloadManager';\r\nimport onMediaLoad from '../../helpers/onMediaLoad';\r\nimport throttle from '../../helpers/schedulers/throttle';\r\nimport {onEmojiStickerClick} from '../wrappers/sticker';\r\n\r\nconst USE_MEDIA_TAILS = false;\r\nconst IGNORE_ACTIONS: Set<Message.messageService['action']['_']> = new Set([\r\n  'messageActionHistoryClear',\r\n  'messageActionChatCreate'/* ,\r\n  'messageActionChannelMigrateFrom' */\r\n]);\r\n\r\nexport const SERVICE_AS_REGULAR: Set<Message.messageService['action']['_']> = new Set();\r\n\r\nif(IS_CALL_SUPPORTED) {\r\n  SERVICE_AS_REGULAR.add('messageActionPhoneCall');\r\n}\r\n\r\nconst TEST_SCROLL_TIMES: number = undefined;\r\nlet TEST_SCROLL = TEST_SCROLL_TIMES;\r\n\r\nlet queueId = 0;\r\n\r\ntype GenerateLocalMessageType<IsService> = IsService extends true ? Message.messageService : Message.message;\r\n\r\nconst SPONSORED_MESSAGE_ID_OFFSET = 1;\r\nexport const STICKY_OFFSET = 3;\r\nconst SCROLLED_DOWN_THRESHOLD = 300;\r\nconst PEER_CHANGED_ERROR = new Error('peer changed');\r\n\r\nconst DO_NOT_SLICE_VIEWPORT = false;\r\nconst DO_NOT_SLICE_VIEWPORT_ON_RENDER = false;\r\nconst DO_NOT_UPDATE_MESSAGE_VIEWS = false;\r\nconst DO_NOT_UPDATE_MESSAGE_REACTIONS = false;\r\nconst DO_NOT_UPDATE_MESSAGE_REPLY = false;\r\n\r\ntype Bubble = {\r\n  bubble: HTMLElement,\r\n  mids: Set<number>,\r\n  groupedId?: string\r\n};\r\n\r\ntype MyHistoryResult = HistoryResult | {history: number[]};\r\n\r\nfunction getMainMidForGrouped(mids: number[]) {\r\n  return Math.max(...mids);\r\n}\r\n\r\nexport default class ChatBubbles {\r\n  public container: HTMLDivElement;\r\n  public chatInner: HTMLDivElement;\r\n  public scrollable: Scrollable;\r\n\r\n  private getHistoryTopPromise: Promise<boolean>;\r\n  private getHistoryBottomPromise: Promise<boolean>;\r\n\r\n  // public messagesCount: number = -1;\r\n\r\n  private unreadOut = new Set<number>();\r\n  public needUpdate: {replyToPeerId: PeerId, replyMid: number, mid: number}[] = []; // if need wrapSingleMessage\r\n\r\n  public bubbles: {[mid: string]: HTMLElement} = {};\r\n  public skippedMids: Set<number> = new Set();\r\n  public bubblesNewByGroupedId: {[groupId: string]: Bubble} = {};\r\n  public bubblesNew: {[mid: string]: Bubble} = {};\r\n  private dateMessages: {[timestamp: number]: {\r\n    div: HTMLElement,\r\n    firstTimestamp: number,\r\n    container: HTMLElement,\r\n    timeout?: number\r\n  }} = {};\r\n\r\n  private scrolledDown = true;\r\n  private isScrollingTimeout = 0;\r\n\r\n  private stickyIntersector: StickyIntersector;\r\n\r\n  private unreaded: Map<HTMLElement, number> = new Map();\r\n  private unreadedSeen: Set<number> = new Set();\r\n  private readPromise: Promise<void>;\r\n\r\n  private bubbleGroups: BubbleGroups;\r\n\r\n  private preloader: ProgressivePreloader = null;\r\n\r\n  public messagesQueuePromise: Promise<void> = null;\r\n  private messagesQueue: ReturnType<ChatBubbles['safeRenderMessage']>[] = [];\r\n  // private messagesQueueOnRender: () => void = null;\r\n  private messagesQueueOnRenderAdditional: () => void = null;\r\n\r\n  private firstUnreadBubble: HTMLElement = null;\r\n  private attachedUnreadBubble: boolean;\r\n\r\n  public lazyLoadQueue: LazyLoadQueue;\r\n\r\n  private middlewareHelper = getMiddleware();\r\n\r\n  private log: ReturnType<typeof logger>;\r\n\r\n  public listenerSetter: ListenerSetter;\r\n\r\n  private replyFollowHistory: number[] = [];\r\n\r\n  private isHeavyAnimationInProgress = false;\r\n  private scrollingToBubble: HTMLElement;\r\n\r\n  private isFirstLoad = true;\r\n  private needReflowScroll: boolean;\r\n\r\n  private fetchNewPromise: Promise<void>;\r\n\r\n  private passEntities: Partial<{\r\n    [_ in MessageEntity['_']]: boolean\r\n  }> = {};\r\n\r\n  private onAnimateLadder: () => Promise<any> | void;\r\n  // private ladderDeferred: CancellablePromise<void>;\r\n  private resolveLadderAnimation: () => Promise<any>;\r\n  private emptyPlaceholderBubble: HTMLElement;\r\n\r\n  private viewsMids: Set<number> = new Set();\r\n  private sendViewCountersDebounced: () => Promise<void>;\r\n\r\n  private isTopPaddingSet = false;\r\n\r\n  private getSponsoredMessagePromise: Promise<void>;\r\n\r\n  private previousStickyDate: HTMLElement;\r\n  private sponsoredMessage: SponsoredMessage.sponsoredMessage;\r\n\r\n  private hoverBubble: HTMLElement;\r\n  private hoverReaction: HTMLElement;\r\n  private sliceViewportDebounced: DebounceReturnType<ChatBubbles['sliceViewport']>;\r\n  private resizeObserver: ResizeObserver;\r\n  private willScrollOnLoad: boolean;\r\n  private observer: SuperIntersectionObserver;\r\n\r\n  private renderingMessages: Set<number> = new Set();\r\n  private setPeerCached: boolean;\r\n  private attachPlaceholderOnRender: () => void;\r\n\r\n  private bubblesToEject: Set<HTMLElement> = new Set();\r\n  private bubblesToReplace: Map<HTMLElement, HTMLElement> = new Map(); // TO -> FROM\r\n  private updatePlaceholderPosition: () => void;\r\n  private setPeerOptions: {lastMsgId: number; topMessage: number;};\r\n\r\n  private setPeerTempId: number = 0;\r\n\r\n  private renderNewPromises: Set<Promise<any>> = new Set();\r\n\r\n  // private reactions: Map<number, ReactionsElement>;\r\n\r\n  constructor(\r\n    private chat: Chat,\r\n    private managers: AppManagers\r\n  ) {\r\n    this.log = this.chat.log;\r\n    // this.chat.log.error('Bubbles construction');\r\n\r\n    this.listenerSetter = new ListenerSetter();\r\n\r\n    this.constructBubbles();\r\n\r\n    // * constructor end\r\n\r\n    this.bubbleGroups = new BubbleGroups(this.chat);\r\n    this.preloader = new ProgressivePreloader({\r\n      cancelable: false\r\n    });\r\n    this.lazyLoadQueue = new LazyLoadQueue();\r\n    this.lazyLoadQueue.queueId = ++queueId;\r\n\r\n    // this.reactions = new Map();\r\n\r\n    // * events\r\n\r\n    // will call when sent for update pos\r\n    this.listenerSetter.add(rootScope)('history_update', async({storageKey, sequential, message}) => {\r\n      if(this.chat.messagesStorageKey !== storageKey || this.chat.type === 'scheduled') {\r\n        return;\r\n      }\r\n\r\n      const {mid} = message;\r\n      const log = false ? this.log.bindPrefix('history_update-' + mid) : undefined;\r\n      log && log('start');\r\n\r\n      const bubble = this.bubbles[mid];\r\n      if(!bubble) return;\r\n\r\n      if(this.renderNewPromises.size) {\r\n        log && log.error('will await new messages render');\r\n        await Promise.all(Array.from(this.renderNewPromises));\r\n      }\r\n\r\n      if(this.messagesQueuePromise) {\r\n        log && log.error('messages render in process');\r\n        await this.messagesQueuePromise;\r\n      }\r\n\r\n      if(this.bubbles[mid] !== bubble) return;\r\n\r\n      // await getHeavyAnimationPromise();\r\n\r\n      const item = this.bubbleGroups.getItemByBubble(bubble);\r\n      if(!item) { // probably a group item\r\n        log && log.error('no item by bubble', bubble);\r\n        return;\r\n      } else if(item.mid === mid) {\r\n        log && log.warn('wow what', item, mid);\r\n        return;\r\n      }\r\n\r\n      if(sequential) {\r\n        const group = item.group;\r\n        const newItem = this.bubbleGroups.createItem(bubble, message);\r\n        // newItem.mid = item.mid;\r\n        const _items = this.bubbleGroups.itemsArr.slice();\r\n        indexOfAndSplice(_items, item);\r\n        const foundItem = this.bubbleGroups.findGroupSiblingByItem(newItem, _items);\r\n        if(\r\n          group === foundItem?.group ||\r\n          (group === this.bubbleGroups.getLastGroup() && group.items.length === 1 && newItem.dateTimestamp === item.dateTimestamp) ||\r\n          (this.peerId === rootScope.myId && sequential && newItem.dateTimestamp === item.dateTimestamp)\r\n        ) {\r\n          log && log('item has correct position', item);\r\n          this.bubbleGroups.changeBubbleMid(bubble, mid);\r\n          return;\r\n        }\r\n      }\r\n\r\n      // return;\r\n\r\n      // await fastRafPromise();\r\n      // if(this.bubbles[mid] !== bubble) return;\r\n\r\n      // const groupIndex = this.bubbleGroups.groups.indexOf(group);\r\n      this.bubbleGroups.removeAndUnmountBubble(bubble);\r\n      // if(!group.items.length) { // group has collapsed, next message can have higher mid so have to reposition them too\r\n      //   log && log('group has collapsed', item);\r\n\r\n      //   const siblingGroups = this.bubbleGroups.groups.slice(0, groupIndex + 1);\r\n      //   for(let length = siblingGroups.length, i = length - 2; i >= 0; --i) {\r\n      //     const siblingGroup = siblingGroups[i];\r\n      //     const siblingItems = siblingGroup.items;\r\n      //     const nextGroup = siblingGroups[i + 1];\r\n      //     const nextItems = nextGroup.items;\r\n\r\n      //     let _break = false, moved = false;\r\n      //     for(let j = siblingItems.length - 1; j >= 0; --j) {\r\n      //       const siblingItem = siblingItems[j];\r\n      //       const foundItem = this.bubbleGroups.findGroupSiblingByItem(siblingItem, nextItems);\r\n      //       if(!foundItem) {\r\n      //         _break = true;\r\n      //         break;\r\n      //       }\r\n\r\n      //       log('will move item', siblingItem, nextGroup);\r\n      //       this.bubbleGroups.removeAndUnmountBubble(siblingItem.bubble);\r\n      //       this.bubbleGroups.addItemToGroup(siblingItem, nextGroup);\r\n      //       moved = true;\r\n      //     }\r\n\r\n      //     if(moved) {\r\n      //       nextGroup.mount();\r\n      //     }\r\n\r\n      //     if(_break) {\r\n      //       break;\r\n      //     }\r\n      //   }\r\n      // }\r\n\r\n      const {groups} = this.groupBubbles([{bubble, message}]);\r\n      this.bubbleGroups.mountUnmountGroups(groups);\r\n\r\n      if(this.scrollingToBubble) {\r\n        this.scrollToEnd();\r\n      }\r\n\r\n      log && log('end');\r\n\r\n      // this.bubbleGroups.findIncorrentPositions();\r\n    });\r\n\r\n    this.listenerSetter.add(rootScope)('dialog_flush', ({peerId}) => {\r\n      if(this.peerId === peerId) {\r\n        this.deleteMessagesByIds(Object.keys(this.bubbles).map((m) => +m));\r\n      }\r\n    });\r\n\r\n    // Calls when message successfully sent and we have an id\r\n    this.listenerSetter.add(rootScope)('message_sent', async(e) => {\r\n      const {storageKey, tempId, tempMessage, mid, message} = e;\r\n\r\n      // ! can't use peerId to validate here, because id can be the same in 'scheduled' and 'chat' types\r\n      if(this.chat.messagesStorageKey !== storageKey) {\r\n        return;\r\n      }\r\n\r\n      const bubbles = this.bubbles;\r\n      const _bubble = bubbles[tempId];\r\n      if(_bubble) {\r\n        const bubble = bubbles[tempId];\r\n        bubbles[mid] = bubble;\r\n        bubble.dataset.mid = '' + mid;\r\n        delete bubbles[tempId];\r\n\r\n        fastRaf(() => {\r\n          const mid = +bubble.dataset.mid;\r\n          if(bubbles[mid] === bubble && bubble.classList.contains('is-outgoing')) {\r\n            bubble.classList.remove('is-sending', 'is-outgoing');\r\n            bubble.classList.add((this.peerId === rootScope.myId && this.chat.type !== 'scheduled') || !this.unreadOut.has(mid) ? 'is-read' : 'is-sent');\r\n          }\r\n        });\r\n      }\r\n\r\n      if(this.unreadOut.has(tempId)) {\r\n        this.unreadOut.delete(tempId);\r\n        this.unreadOut.add(mid);\r\n      }\r\n\r\n      // * check timing of scheduled message\r\n      if(this.chat.type === 'scheduled') {\r\n        const timestamp = Date.now() / 1000 | 0;\r\n        const maxTimestamp = tempMessage.date - 10;\r\n        if(timestamp >= maxTimestamp) {\r\n          this.deleteMessagesByIds([mid]);\r\n        }\r\n      }\r\n\r\n      if(!_bubble) {\r\n        return;\r\n      }\r\n\r\n      let messages: (Message.message | Message.messageService)[], tempIds: number[];\r\n      const groupedId = (message as Message.message).grouped_id;\r\n      if(groupedId) {\r\n        messages = await this.managers.appMessagesManager.getMessagesByAlbum(groupedId);\r\n        const mids = messages.map(({mid}) => mid);\r\n        if(!mids.length || getMainMidForGrouped(mids) !== mid || bubbles[mid] !== _bubble) {\r\n          return;\r\n        }\r\n\r\n        if(bubbles[mid] !== _bubble) {\r\n          return;\r\n        }\r\n\r\n        tempIds = (Array.from(_bubble.querySelectorAll('.grouped-item')) as HTMLElement[]).map((el) => +el.dataset.mid);\r\n      } else {\r\n        messages = [message];\r\n        tempIds = [tempId];\r\n      }\r\n\r\n      const reactionsElements = Array.from(_bubble.querySelectorAll('reactions-element')) as ReactionsElement[];\r\n      if(reactionsElements.length) {\r\n        reactionsElements.forEach((reactionsElement) => {\r\n          reactionsElement.changeMessage(message as Message.message);\r\n        });\r\n      }\r\n\r\n      (messages as Message.message[]).forEach((message, idx) => {\r\n        if(!message) {\r\n          return;\r\n        }\r\n\r\n        const tempId = tempIds[idx];\r\n        const mid = message.mid;\r\n        const bubble: HTMLElement = _bubble.querySelector(`.document-container[data-mid=\"${mid}\"]`) || _bubble;\r\n\r\n        if(message._ !== 'message') {\r\n          return;\r\n        }\r\n\r\n        if(message.replies) {\r\n          const repliesElement = _bubble.querySelector('replies-element') as RepliesElement;\r\n          if(repliesElement) {\r\n            repliesElement.message = message;\r\n            repliesElement.init();\r\n          }\r\n        }\r\n\r\n        const media = message.media ?? {} as MessageMedia.messageMediaEmpty;\r\n        const doc = (media as MessageMedia.messageMediaDocument).document as Document.document;\r\n        const poll = (media as MessageMedia.messageMediaPoll).poll;\r\n        const webPage = (media as MessageMedia.messageMediaWebPage).webpage as WebPage.webPage;\r\n        if(doc) {\r\n          const div = bubble.querySelector(`.document-container[data-mid=\"${tempId}\"] .document`);\r\n          if(div) {\r\n            const container = findUpClassName(div, 'document-container');\r\n\r\n            if(!tempMessage.media?.document?.thumbs?.length && doc.thumbs?.length) {\r\n              getHeavyAnimationPromise().then(async() => {\r\n                const timeSpan = div.querySelector('.time');\r\n                const newDiv = await wrapDocument({message});\r\n                div.replaceWith(newDiv);\r\n\r\n                if(timeSpan) {\r\n                  newDiv.querySelector('.document').append(timeSpan);\r\n                }\r\n              });\r\n            }\r\n\r\n            if(container) {\r\n              container.dataset.mid = '' + mid;\r\n            }\r\n          }\r\n\r\n          const element = bubble.querySelector(`audio-element[data-mid=\"${tempId}\"], .document[data-doc-id=\"${tempId}\"], .media-round[data-mid=\"${tempId}\"]`) as HTMLElement;\r\n          if(element) {\r\n            if(element instanceof AudioElement || element.classList.contains('media-round')) {\r\n              element.dataset.mid = '' + message.mid;\r\n              delete element.dataset.isOutgoing;\r\n              (element as any).message = message;\r\n              (element as any).onLoad(true);\r\n            } else {\r\n              element.dataset.docId = '' + doc.id;\r\n              (element as any).doc = doc;\r\n            }\r\n          }\r\n        } else if(poll) {\r\n          const pollElement = bubble.querySelector('poll-element') as PollElement;\r\n          if(pollElement) {\r\n            pollElement.message = message;\r\n            pollElement.setAttribute('poll-id', '' + poll.id);\r\n            pollElement.setAttribute('message-id', '' + mid);\r\n          }\r\n        } else if(webPage && !bubble.querySelector('.web')) {\r\n          getHeavyAnimationPromise().then(() => {\r\n            this.safeRenderMessage(message, true, bubble);\r\n            this.scrollToBubbleIfLast(bubble);\r\n          });\r\n        }\r\n\r\n        // set new mids to album items for mediaViewer\r\n        if(groupedId) {\r\n          const item = (bubble.querySelector(`.grouped-item[data-mid=\"${tempId}\"]`) as HTMLElement) || bubble; // * it can be .document-container\r\n          if(item) {\r\n            item.dataset.mid = '' + mid;\r\n          }\r\n        }\r\n      });\r\n    });\r\n\r\n    this.listenerSetter.add(rootScope)('message_edit', async({storageKey, message}) => {\r\n      if(storageKey !== this.chat.messagesStorageKey) return;\r\n\r\n      const bubble = this.bubbles[message.mid];\r\n      if(!bubble) return;\r\n\r\n      await getHeavyAnimationPromise();\r\n      if(this.bubbles[message.mid] !== bubble) return;\r\n\r\n      this.safeRenderMessage(message, true, bubble);\r\n    });\r\n\r\n    this.listenerSetter.add(rootScope)('message_error', async({storageKey, tempId}) => {\r\n      if(storageKey !== this.chat.messagesStorageKey) return;\r\n\r\n      const bubble = this.bubbles[tempId];\r\n      if(!bubble) return;\r\n\r\n      await getHeavyAnimationPromise();\r\n      if(this.bubbles[tempId] !== bubble) return;\r\n\r\n      bubble.classList.remove('is-outgoing');\r\n      bubble.classList.add('is-error');\r\n    });\r\n\r\n    this.listenerSetter.add(rootScope)('album_edit', ({peerId, messages, deletedMids}) => {\r\n      if(peerId !== this.peerId) return;\r\n\r\n      const mids = messages.map(({mid}) => mid);\r\n      const oldMids = mids.concat(Array.from(deletedMids));\r\n      const wasMainMid = getMainMidForGrouped(oldMids);\r\n      const bubble = this.bubbles[wasMainMid];\r\n      if(!bubble) {\r\n        return;\r\n      }\r\n\r\n      const mainMid = getMainMidForGrouped(mids);\r\n      const message = messages.find((message) => message.mid === mainMid);\r\n      this.safeRenderMessage(message, true, bubble);\r\n    });\r\n\r\n    this.listenerSetter.add(rootScope)('peer_title_edit', async(peerId) => {\r\n      if(peerId.isUser()) {\r\n        const middleware = this.getMiddleware();\r\n        const user = await this.managers.appUsersManager.getUser(peerId.toUserId());\r\n        if(!middleware()) return;\r\n\r\n        const isPremium = user?.pFlags?.premium;\r\n        const groups = this.bubbleGroups.groups.filter((group) => group.avatar?.peerId === peerId);\r\n        groups.forEach((group) => {\r\n          group.avatar.classList.toggle('is-premium', isPremium);\r\n          group.avatar.classList.toggle('tgico-star', isPremium);\r\n        });\r\n      }\r\n    });\r\n\r\n    if(this.chat.type !== 'scheduled' && !DO_NOT_UPDATE_MESSAGE_REACTIONS/*  && false */) {\r\n      this.listenerSetter.add(rootScope)('messages_reactions', async(arr) => {\r\n        let scrollSaver: ScrollSaver;\r\n\r\n        const a = arr.map(async({message, changedResults}) => {\r\n          if(this.peerId !== message.peerId) {\r\n            return;\r\n          }\r\n\r\n          const result = await this.getMountedBubble(message.mid, message);\r\n          if(!result) {\r\n            return;\r\n          }\r\n\r\n          return {bubble: result.bubble, message, changedResults};\r\n        });\r\n\r\n        let top: number;\r\n        (await Promise.all(a)).filter(Boolean).forEach(({bubble, message, changedResults}) => {\r\n          if(!scrollSaver) {\r\n            scrollSaver = this.createScrollSaver(false);\r\n            scrollSaver.save();\r\n          }\r\n\r\n          const key = message.peerId + '_' + message.mid;\r\n          const set = REACTIONS_ELEMENTS.get(key);\r\n          if(set) {\r\n            for(const element of set) {\r\n              element.update(message, changedResults);\r\n            }\r\n          } else if(!message.reactions || !message.reactions.results.length) {\r\n            return;\r\n          } else {\r\n            this.appendReactionsElementToBubble(bubble, message, message, changedResults);\r\n          }\r\n        });\r\n\r\n        if(scrollSaver) {\r\n          scrollSaver.restore();\r\n        }\r\n      });\r\n    }\r\n\r\n    !DO_NOT_UPDATE_MESSAGE_REPLY && this.listenerSetter.add(rootScope)('messages_downloaded', async({peerId, mids}) => {\r\n      const middleware = this.getMiddleware();\r\n      await getHeavyAnimationPromise();\r\n      if(!middleware()) return;\r\n\r\n      (mids as number[]).forEach((mid) => {\r\n        const needUpdate = this.needUpdate;\r\n        const filtered: typeof needUpdate[0][] = [];\r\n        forEachReverse(this.needUpdate, (obj, idx) => {\r\n          if(obj.replyMid === mid && obj.replyToPeerId === peerId) {\r\n            this.needUpdate.splice(idx, 1)[0];\r\n            filtered.push(obj);\r\n          }\r\n        });\r\n\r\n        filtered.forEach(async({mid, replyMid, replyToPeerId}) => {\r\n          const bubble = this.bubbles[mid];\r\n          if(!bubble) return;\r\n\r\n          const message = (await this.chat.getMessage(mid)) as Message.message;\r\n\r\n          MessageRender.setReply({\r\n            chat: this.chat,\r\n            bubble,\r\n            message\r\n          });\r\n        });\r\n      });\r\n    });\r\n\r\n    attachStickerViewerListeners({listenTo: this.scrollable.container, listenerSetter: this.listenerSetter, selector: '.attachment.media-sticker-wrapper'});\r\n    attachClickEvent(this.scrollable.container, this.onBubblesClick, {listenerSetter: this.listenerSetter});\r\n    // this.listenerSetter.add(this.bubblesContainer)('click', this.onBubblesClick/* , {capture: true, passive: false} */);\r\n\r\n    this.listenerSetter.add(this.scrollable.container)('mousedown', (e) => {\r\n      if(e.button !== 0) return;\r\n\r\n      const code: HTMLElement = findUpTag(e.target, 'CODE');\r\n      if(code) {\r\n        cancelEvent(e);\r\n        copyFromElement(code);\r\n        toastNew({langPackKey: 'TextCopied'});\r\n        return;\r\n      }\r\n    });\r\n\r\n    /* if(false)  */this.stickyIntersector = new StickyIntersector(this.scrollable.container, (stuck, target) => {\r\n      for(const timestamp in this.dateMessages) {\r\n        const dateMessage = this.dateMessages[timestamp];\r\n        if(dateMessage.container === target) {\r\n          const dateBubble = dateMessage.div;\r\n\r\n          // dateMessage.container.classList.add('has-sticky-dates');\r\n\r\n          // SetTransition(dateBubble, 'kek', stuck, this.previousStickyDate ? 300 : 0);\r\n          // if(this.previousStickyDate) {\r\n          // dateBubble.classList.add('kek');\r\n          // }\r\n\r\n          dateBubble.classList.toggle('is-sticky', stuck);\r\n          if(stuck) {\r\n            this.previousStickyDate = dateBubble;\r\n          }\r\n\r\n          break;\r\n        }\r\n      }\r\n\r\n      if(this.previousStickyDate) {\r\n        // fastRaf(() => {\r\n        // this.bubblesContainer.classList.add('has-sticky-dates');\r\n        // });\r\n      }\r\n    });\r\n\r\n    if(!IS_SAFARI) {\r\n      this.sliceViewportDebounced = debounce(this.sliceViewport.bind(this), 3000, false, true);\r\n    }\r\n\r\n    let middleware: ReturnType<ChatBubbles['getMiddleware']>;\r\n    useHeavyAnimationCheck(() => {\r\n      this.isHeavyAnimationInProgress = true;\r\n      this.lazyLoadQueue.lock();\r\n      middleware = this.getMiddleware();\r\n\r\n      // if(this.sliceViewportDebounced) {\r\n      //   this.sliceViewportDebounced.clearTimeout();\r\n      // }\r\n    }, () => {\r\n      this.isHeavyAnimationInProgress = false;\r\n\r\n      if(middleware && middleware()) {\r\n        this.lazyLoadQueue.unlock();\r\n        this.lazyLoadQueue.refresh();\r\n\r\n        // if(this.sliceViewportDebounced) {\r\n        //   this.sliceViewportDebounced();\r\n        // }\r\n      }\r\n\r\n      middleware = null;\r\n    }, this.listenerSetter);\r\n  }\r\n\r\n  private constructBubbles() {\r\n    const container = this.container = document.createElement('div');\r\n    container.classList.add('bubbles', 'scrolled-down');\r\n\r\n    const chatInner = this.chatInner = document.createElement('div');\r\n    chatInner.classList.add('bubbles-inner');\r\n\r\n    this.setScroll();\r\n\r\n    container.append(this.scrollable.container);\r\n  }\r\n\r\n  public attachContainerListeners() {\r\n    const container = this.container;\r\n\r\n    this.chat.contextMenu.attachTo(container);\r\n    this.chat.selection.attachListeners(container, new ListenerSetter());\r\n\r\n    if(DEBUG) {\r\n      this.listenerSetter.add(container)('dblclick', async(e) => {\r\n        const bubble = findUpClassName(e.target, 'grouped-item') || findUpClassName(e.target, 'bubble');\r\n        if(bubble) {\r\n          const mid = +bubble.dataset.mid\r\n          this.log('debug message:', await this.chat.getMessage(mid));\r\n          this.highlightBubble(bubble);\r\n        }\r\n      });\r\n    }\r\n\r\n    if(this.chat.type !== 'pinned' && this.chat.type !== 'scheduled') {\r\n      if(!IS_MOBILE) {\r\n        this.listenerSetter.add(container)('dblclick', async(e) => {\r\n          if(this.chat.selection.isSelecting ||\r\n            !(await this.chat.canSend())) {\r\n            return;\r\n          }\r\n\r\n          const target = e.target as HTMLElement;\r\n          const bubble = target.classList.contains('bubble') ?\r\n            target :\r\n            (target.classList.contains('document-selection') ? target.parentElement : null);\r\n          if(bubble && !bubble.classList.contains('bubble-first')) {\r\n            const mid = +bubble.dataset.mid;\r\n            const message = await this.chat.getMessage(mid);\r\n            if(message.pFlags.is_outgoing) {\r\n              return;\r\n            }\r\n\r\n            this.chat.input.initMessageReply(mid);\r\n          }\r\n        });\r\n      } else if(IS_TOUCH_SUPPORTED) {\r\n        const className = 'is-gesturing-reply';\r\n        const MAX = 64;\r\n        const replyAfter = MAX * .75;\r\n        let shouldReply = false;\r\n        let target: HTMLElement;\r\n        let icon: HTMLElement;\r\n        handleHorizontalSwipe({\r\n          element: container,\r\n          verifyTouchTarget: async(e) => {\r\n            if(this.chat.selection.isSelecting || !(await this.chat.canSend())) {\r\n              return false;\r\n            }\r\n\r\n            // cancelEvent(e);\r\n            target = findUpClassName(e.target, 'bubble');\r\n            if(target) {\r\n              SetTransition(target, className, true, 250);\r\n              void target.offsetLeft; // reflow\r\n\r\n              if(!icon) {\r\n                icon = document.createElement('span');\r\n                icon.classList.add('tgico-reply_filled', 'bubble-gesture-reply-icon');\r\n              } else {\r\n                icon.classList.remove('is-visible');\r\n                icon.style.opacity = '';\r\n              }\r\n\r\n              target/* .querySelector('.bubble-content') */.append(icon);\r\n            }\r\n\r\n            return !!target;\r\n          },\r\n          onSwipe: (xDiff, yDiff) => {\r\n            shouldReply = xDiff >= replyAfter;\r\n\r\n            if(shouldReply && !icon.classList.contains('is-visible')) {\r\n              icon.classList.add('is-visible');\r\n            }\r\n            icon.style.opacity = '' + Math.min(1, xDiff / replyAfter);\r\n\r\n            const x = -Math.max(0, Math.min(MAX, xDiff));\r\n            target.style.transform = `translateX(${x}px)`;\r\n            cancelContextMenuOpening();\r\n          },\r\n          onReset: () => {\r\n            const _target = target;\r\n            SetTransition(_target, className, false, 250, () => {\r\n              if(icon.parentElement === _target) {\r\n                icon.classList.remove('is-visible');\r\n                icon.remove();\r\n              }\r\n            });\r\n\r\n            fastRaf(() => {\r\n              _target.style.transform = ``;\r\n\r\n              if(shouldReply) {\r\n                const {mid} = _target.dataset;\r\n                this.chat.input.initMessageReply(+mid);\r\n                shouldReply = false;\r\n              }\r\n            });\r\n          },\r\n          listenerOptions: {capture: true}\r\n        });\r\n      }\r\n    }\r\n  }\r\n\r\n  public constructPeerHelpers() {\r\n    // will call when message is sent (only 1)\r\n    this.listenerSetter.add(rootScope)('history_append', async({storageKey, message}) => {\r\n      if(storageKey !== this.chat.messagesStorageKey) return;\r\n\r\n      if(!this.scrollable.loadedAll.bottom) {\r\n        this.chat.setMessageId();\r\n      } else {\r\n        this.renderNewMessage(message, true);\r\n      }\r\n\r\n      if(rootScope.settings.animationsEnabled) {\r\n        const gradientRenderer = this.chat.gradientRenderer;\r\n        if(gradientRenderer) {\r\n          gradientRenderer.toNextPosition();\r\n        }\r\n      }\r\n    });\r\n\r\n    this.listenerSetter.add(rootScope)('history_multiappend', (message) => {\r\n      if(this.peerId !== message.peerId) return;\r\n      this.renderNewMessage(message);\r\n    });\r\n\r\n    this.listenerSetter.add(rootScope)('history_delete', ({peerId, msgs}) => {\r\n      if(peerId === this.peerId) {\r\n        this.deleteMessagesByIds(Array.from(msgs));\r\n      }\r\n    });\r\n\r\n    this.listenerSetter.add(rootScope)('dialog_unread', ({peerId}) => {\r\n      if(peerId === this.peerId) {\r\n        this.chat.input.setUnreadCount();\r\n\r\n        getHeavyAnimationPromise().then(() => {\r\n          this.updateUnreadByDialog();\r\n        });\r\n      }\r\n    });\r\n\r\n    this.listenerSetter.add(rootScope)('dialogs_multiupdate', (dialogs) => {\r\n      if(dialogs.has(this.peerId)) {\r\n        this.chat.input.setUnreadCount();\r\n      }\r\n    });\r\n\r\n    this.listenerSetter.add(rootScope)('dialog_notify_settings', (dialog) => {\r\n      if(this.peerId === dialog.peerId) {\r\n        this.chat.input.setUnreadCount();\r\n      }\r\n    });\r\n\r\n    this.listenerSetter.add(rootScope)('chat_update', async(chatId) => {\r\n      if(this.peerId === chatId.toPeerId(true)) {\r\n        const hadRights = this.chatInner.classList.contains('has-rights');\r\n        const hasRights = await this.chat.canSend();\r\n\r\n        if(hadRights !== hasRights) {\r\n          const callbacks = await Promise.all([\r\n            this.finishPeerChange(),\r\n            this.chat.input.finishPeerChange()\r\n          ]);\r\n\r\n          callbacks.forEach((callback) => callback());\r\n        }\r\n      }\r\n    });\r\n\r\n    this.listenerSetter.add(rootScope)('settings_updated', async({key}) => {\r\n      if(key === 'settings.emoji.big') {\r\n        const middleware = this.getMiddleware();\r\n        const mids = getObjectKeysAndSort(this.bubbles, 'desc');\r\n        const m = mids.map(async(mid) => {\r\n          const bubble = this.bubbles[mid];\r\n          if(bubble.classList.contains('can-have-big-emoji')) {\r\n            return {bubble, message: await this.chat.getMessage(mid)};\r\n          }\r\n        });\r\n\r\n        const awaited = await Promise.all(m);\r\n        if(!middleware()) {\r\n          return;\r\n        }\r\n\r\n        awaited.filter(Boolean).forEach(({bubble, message}) => {\r\n          if(this.bubbles[message.mid] !== bubble) {\r\n            return;\r\n          }\r\n\r\n          this.safeRenderMessage(message, true, bubble);\r\n        });\r\n      }\r\n    });\r\n\r\n    !DO_NOT_UPDATE_MESSAGE_VIEWS && this.listenerSetter.add(rootScope)('messages_views', (arr) => {\r\n      fastRaf(() => {\r\n        let scrollSaver: ScrollSaver;\r\n        for(const {peerId, views, mid} of arr) {\r\n          if(this.peerId !== peerId) continue;\r\n\r\n          const bubble = this.bubbles[mid];\r\n          if(!bubble) continue;\r\n\r\n          const postViewsElements = Array.from(bubble.querySelectorAll('.post-views')) as HTMLElement[];\r\n          if(!postViewsElements.length) continue;\r\n\r\n          const str = formatNumber(views, 1);\r\n          let different = false;\r\n          postViewsElements.forEach((postViews) => {\r\n            if(different || postViews.textContent !== str) {\r\n              if(!scrollSaver) {\r\n                scrollSaver = this.createScrollSaver(true);\r\n                scrollSaver.save();\r\n              }\r\n\r\n              different = true;\r\n              postViews.textContent = str;\r\n            }\r\n          });\r\n        }\r\n\r\n        if(scrollSaver) {\r\n          scrollSaver.restore();\r\n        }\r\n      });\r\n    });\r\n\r\n    this.observer = new SuperIntersectionObserver({root: this.scrollable.container});\r\n\r\n    this.listenerSetter.add(this.chat.appImManager)('chat_changing', ({to}) => {\r\n      const freeze = to !== this.chat;\r\n\r\n      const cb = () => {\r\n        this.observer.toggleObservingNew(freeze);\r\n      };\r\n\r\n      if(!freeze) {\r\n        setTimeout(() => {\r\n          cb();\r\n        }, 400);\r\n      } else {\r\n        cb();\r\n      }\r\n    });\r\n\r\n    this.sendViewCountersDebounced = debounce(() => {\r\n      const mids = [...this.viewsMids];\r\n      this.viewsMids.clear();\r\n\r\n      this.managers.appMessagesManager.incrementMessageViews(this.peerId, mids);\r\n    }, 1000, false, true);\r\n  }\r\n\r\n  private get peerId() {\r\n    return this.chat.peerId;\r\n  }\r\n\r\n  private createScrollSaver(reverse = true) {\r\n    const scrollSaver = new ScrollSaver(this.scrollable, '.bubble:not(.is-date)', reverse);\r\n    return scrollSaver;\r\n  }\r\n\r\n  private unreadedObserverCallback = (entry: IntersectionObserverEntry) => {\r\n    if(entry.isIntersecting) {\r\n      const target = entry.target as HTMLElement;\r\n      const mid = this.unreaded.get(target as HTMLElement);\r\n      this.onUnreadedInViewport(target, mid);\r\n    }\r\n  };\r\n\r\n  private viewsObserverCallback = (entry: IntersectionObserverEntry) => {\r\n    if(entry.isIntersecting) {\r\n      const mid = +(entry.target as HTMLElement).dataset.mid;\r\n      this.observer.unobserve(entry.target, this.viewsObserverCallback);\r\n\r\n      if(mid) {\r\n        this.viewsMids.add(mid);\r\n        this.sendViewCountersDebounced();\r\n      } else {\r\n        const {sponsoredMessage} = this;\r\n        if(sponsoredMessage && sponsoredMessage.random_id) {\r\n          delete sponsoredMessage.random_id;\r\n          this.managers.appChatsManager.viewSponsoredMessage(this.peerId.toChatId(), sponsoredMessage.random_id);\r\n        }\r\n      }\r\n    }\r\n  };\r\n\r\n  private stickerEffectObserverCallback = (entry: IntersectionObserverEntry) => {\r\n    if(entry.isIntersecting) {\r\n      this.observer.unobserve(entry.target, this.stickerEffectObserverCallback);\r\n\r\n      const attachmentDiv: HTMLElement = entry.target.querySelector('.attachment');\r\n      getHeavyAnimationPromise().then(() => {\r\n        if(isInDOM(attachmentDiv)) {\r\n          simulateClickEvent(attachmentDiv);\r\n        }\r\n      });\r\n    }\r\n  };\r\n\r\n  private createResizeObserver() {\r\n    if(!('ResizeObserver' in window) || this.resizeObserver) {\r\n      return;\r\n    }\r\n\r\n    const container = this.scrollable.container;\r\n    let wasHeight = 0/* container.offsetHeight */;\r\n    let resizing = false;\r\n    let skip = false;\r\n    let scrolled = 0;\r\n    let part = 0;\r\n    let rAF = 0;\r\n    // let skipNext = true;\r\n\r\n    const onResizeEnd = () => {\r\n      const height = container.offsetHeight;\r\n      const isScrolledDown = this.scrollable.isScrolledDown;\r\n      if(height !== wasHeight && (!skip || !isScrolledDown)) { // * fix opening keyboard while ESG is active, offsetHeight will change right between 'start' and this first frame\r\n        part += wasHeight - height;\r\n      }\r\n\r\n      /* if(DEBUG) {\r\n        this.log('resize end', scrolled, part, this.scrollable.scrollTop, height, wasHeight, this.scrollable.isScrolledDown);\r\n      } */\r\n\r\n      if(part) {\r\n        this.scrollable.setScrollTopSilently(this.scrollable.scrollTop + Math.round(part));\r\n      }\r\n\r\n      wasHeight = height;\r\n      scrolled = 0;\r\n      rAF = 0;\r\n      part = 0;\r\n      resizing = false;\r\n      skip = false;\r\n    };\r\n\r\n    const setEndRAF = (single: boolean) => {\r\n      if(rAF) window.cancelAnimationFrame(rAF);\r\n      rAF = window.requestAnimationFrame(single ? onResizeEnd : () => {\r\n        rAF = window.requestAnimationFrame(onResizeEnd);\r\n        // this.log('resize after RAF', part);\r\n      });\r\n    };\r\n\r\n    const processEntries: ResizeObserverCallback = (entries) => {\r\n      /* if(skipNext) {\r\n        skipNext = false;\r\n        return;\r\n      } */\r\n\r\n      if(skip) {\r\n        setEndRAF(false);\r\n        return;\r\n      }\r\n\r\n      const entry = entries[0];\r\n      const height = entry.contentRect.height;/* Math.ceil(entry.contentRect.height); */\r\n\r\n      if(!wasHeight) {\r\n        wasHeight = height;\r\n        return;\r\n      }\r\n\r\n      const realDiff = wasHeight - height;\r\n      let diff = realDiff + part;\r\n      const _part = diff % 1;\r\n      diff -= _part;\r\n\r\n      if(!resizing) {\r\n        resizing = true;\r\n\r\n        /* if(DEBUG) {\r\n          this.log('resize start', realDiff, this.scrollable.scrollTop, this.scrollable.container.offsetHeight, this.scrollable.isScrolledDown);\r\n        } */\r\n\r\n        if(realDiff < 0 && this.scrollable.isScrolledDown) {\r\n          // if(isSafari) { // * fix opening keyboard while ESG is active\r\n          part = -realDiff;\r\n          // }\r\n\r\n          skip = true;\r\n          setEndRAF(false);\r\n          return;\r\n        }\r\n      }\r\n\r\n      scrolled += diff;\r\n\r\n      /* if(DEBUG) {\r\n        this.log('resize', wasHeight - height, diff, this.scrollable.container.offsetHeight, this.scrollable.isScrolledDown, height, wasHeight);\r\n      } */\r\n\r\n      if(diff) {\r\n        const needScrollTop = this.scrollable.scrollTop + diff;\r\n        this.scrollable.setScrollTopSilently(needScrollTop);\r\n      }\r\n\r\n      setEndRAF(false);\r\n\r\n      part = _part;\r\n      wasHeight = height;\r\n    };\r\n\r\n    const resizeObserver = this.resizeObserver = new ResizeObserver(processEntries);\r\n    resizeObserver.observe(container);\r\n  }\r\n\r\n  private destroyResizeObserver() {\r\n    const resizeObserver = this.resizeObserver;\r\n    if(!resizeObserver) {\r\n      return;\r\n    }\r\n\r\n    resizeObserver.disconnect();\r\n    this.resizeObserver = undefined;\r\n  }\r\n\r\n  private onBubblesMouseMove = async(e: MouseEvent) => {\r\n    const content = findUpClassName(e.target, 'bubble-content');\r\n    if(content && !this.chat.selection.isSelecting) {\r\n      const bubble = findUpClassName(content, 'bubble');\r\n      if(!this.chat.selection.canSelectBubble(bubble)) {\r\n        this.unhoverPrevious();\r\n        return;\r\n      }\r\n\r\n      let {hoverBubble, hoverReaction} = this;\r\n      if(bubble === hoverBubble) {\r\n        return;\r\n      }\r\n\r\n      this.unhoverPrevious();\r\n\r\n      hoverBubble = this.hoverBubble = bubble;\r\n      hoverReaction = this.hoverReaction;\r\n      // hoverReaction = contentWrapper.querySelector('.bubble-hover-reaction');\r\n      if(!hoverReaction) {\r\n        hoverReaction = this.hoverReaction = document.createElement('div');\r\n        hoverReaction.classList.add('bubble-hover-reaction');\r\n\r\n        const stickerWrapper = document.createElement('div');\r\n        stickerWrapper.classList.add('bubble-hover-reaction-sticker');\r\n        hoverReaction.append(stickerWrapper);\r\n\r\n        content.append(hoverReaction);\r\n\r\n        let message = (await this.chat.getMessage(+bubble.dataset.mid)) as Message.message;\r\n        message = await this.managers.appMessagesManager.getGroupsFirstMessage(message);\r\n\r\n        const middleware = this.getMiddleware(() => this.hoverReaction === hoverReaction);\r\n        Promise.all([\r\n          this.managers.appReactionsManager.getAvailableReactionsByMessage(message),\r\n          pause(400)\r\n        ]).then(([availableReactions]) => {\r\n          const availableReaction = availableReactions[0];\r\n          if(!availableReaction) {\r\n            hoverReaction.remove();\r\n            return;\r\n          }\r\n\r\n          wrapSticker({\r\n            div: stickerWrapper,\r\n            doc: availableReaction.select_animation,\r\n            width: 18,\r\n            height: 18,\r\n            needUpscale: true,\r\n            middleware,\r\n            group: CHAT_ANIMATION_GROUP,\r\n            withThumb: false,\r\n            needFadeIn: false\r\n          }).then(({render}) => render).then((player) => {\r\n            assumeType<RLottiePlayer>(player);\r\n\r\n            player.addEventListener('firstFrame', () => {\r\n              if(!middleware()) {\r\n                // debugger;\r\n                return;\r\n              }\r\n\r\n              hoverReaction.dataset.loaded = '1';\r\n              this.setHoverVisible(hoverReaction, true);\r\n            }, {once: true});\r\n\r\n            attachClickEvent(hoverReaction, (e) => {\r\n              cancelEvent(e); // cancel triggering selection\r\n\r\n              this.managers.appReactionsManager.sendReaction(message, availableReaction.reaction);\r\n              this.unhoverPrevious();\r\n            }, {listenerSetter: this.listenerSetter});\r\n          }, noop);\r\n        });\r\n      } else if(hoverReaction.dataset.loaded) {\r\n        this.setHoverVisible(hoverReaction, true);\r\n      }\r\n    } else {\r\n      this.unhoverPrevious();\r\n    }\r\n  };\r\n\r\n  public setReactionsHoverListeners() {\r\n    this.listenerSetter.add(contextMenuController)('toggle', this.unhoverPrevious);\r\n    this.listenerSetter.add(overlayCounter)('change', this.unhoverPrevious);\r\n    this.listenerSetter.add(this.chat.selection)('toggle', this.unhoverPrevious);\r\n    this.listenerSetter.add(this.container)('mousemove', this.onBubblesMouseMove);\r\n  }\r\n\r\n  private setHoverVisible(hoverReaction: HTMLElement, visible: boolean) {\r\n    SetTransition(hoverReaction, 'is-visible', visible, 200, visible ? undefined : () => {\r\n      hoverReaction.remove();\r\n    }, 2);\r\n  }\r\n\r\n  private unhoverPrevious = () => {\r\n    const {hoverBubble, hoverReaction} = this;\r\n    if(hoverBubble) {\r\n      this.setHoverVisible(hoverReaction, false);\r\n      this.hoverBubble = undefined;\r\n      this.hoverReaction = undefined;\r\n    }\r\n  };\r\n\r\n  public setStickyDateManually() {\r\n    return;\r\n\r\n    const timestamps = Object.keys(this.dateMessages).map((k) => +k).sort((a, b) => b - a);\r\n    let lastVisible: HTMLElement;\r\n\r\n    // if(this.chatInner.classList.contains('is-scrolling')) {\r\n    const {scrollTop} = this.scrollable.container;\r\n    const isOverflown = scrollTop > 0;\r\n    if(isOverflown) {\r\n      for(const timestamp of timestamps) {\r\n        const dateMessage = this.dateMessages[timestamp];\r\n        const visibleRect = getVisibleRect(dateMessage.container, this.scrollable.container);\r\n        if(visibleRect && visibleRect.overflow.top) {\r\n          lastVisible = dateMessage.div;\r\n        } else if(lastVisible) {\r\n          break;\r\n        }\r\n      }\r\n    }\r\n    // }\r\n\r\n    if(lastVisible === this.previousStickyDate) {\r\n      return;\r\n    }\r\n\r\n    if(lastVisible) {\r\n      const needReflow = /* !!this.chat.setPeerPromise ||  */!this.previousStickyDate;\r\n      if(needReflow) {\r\n        lastVisible.classList.add('no-transition');\r\n      }\r\n\r\n      lastVisible.classList.add('is-sticky');\r\n\r\n      if(needReflow) {\r\n        void lastVisible.offsetLeft; // reflow\r\n        lastVisible.classList.remove('no-transition');\r\n      }\r\n    }\r\n\r\n    if(this.previousStickyDate && this.previousStickyDate !== lastVisible) {\r\n      this.previousStickyDate.classList.remove('is-sticky');\r\n    }\r\n\r\n    this.previousStickyDate = lastVisible;\r\n  }\r\n\r\n  public getRenderedLength() {\r\n    return Object.keys(this.bubbles).length - this.skippedMids.size;\r\n  }\r\n\r\n  private onUnreadedInViewport(target: HTMLElement, mid: number) {\r\n    this.unreadedSeen.add(mid);\r\n    this.observer.unobserve(target, this.unreadedObserverCallback);\r\n    this.unreaded.delete(target);\r\n    this.readUnreaded();\r\n  }\r\n\r\n  private readUnreaded() {\r\n    if(this.readPromise) return;\r\n\r\n    const middleware = this.getMiddleware();\r\n    this.readPromise = idleController.getFocusPromise().then(async() => {\r\n      if(!middleware()) return;\r\n      let maxId = Math.max(...Array.from(this.unreadedSeen));\r\n\r\n      // ? if message with maxId is not rendered ?\r\n      if(this.scrollable.loadedAll.bottom) {\r\n        const bubblesMaxId = Math.max(...Object.keys(this.bubbles).map((i) => +i));\r\n        if(maxId >= bubblesMaxId) {\r\n          maxId = Math.max((await this.chat.getHistoryMaxId()) || 0, maxId);\r\n        }\r\n      }\r\n\r\n      this.unreaded.forEach((mid, target) => {\r\n        if(mid <= maxId) {\r\n          this.onUnreadedInViewport(target, mid);\r\n        }\r\n      });\r\n\r\n      const readContents: number[] = [];\r\n      for(const mid of this.unreadedSeen) {\r\n        const message: MyMessage = await this.chat.getMessage(mid);\r\n        if(isMentionUnread(message)) {\r\n          readContents.push(mid);\r\n        }\r\n      }\r\n\r\n      this.managers.appMessagesManager.readMessages(this.peerId, readContents);\r\n\r\n      this.unreadedSeen.clear();\r\n\r\n      if(DEBUG) {\r\n        this.log('will readHistory by maxId:', maxId);\r\n      }\r\n\r\n      // return;\r\n\r\n      return this.managers.appMessagesManager.readHistory(this.peerId, maxId, this.chat.threadId).catch((err: any) => {\r\n        this.log.error('readHistory err:', err);\r\n        this.managers.appMessagesManager.readHistory(this.peerId, maxId, this.chat.threadId);\r\n      }).finally(() => {\r\n        if(!middleware()) return;\r\n        this.readPromise = undefined;\r\n\r\n        if(this.unreadedSeen.size) {\r\n          this.readUnreaded();\r\n        }\r\n      });\r\n    });\r\n  }\r\n\r\n  public constructPinnedHelpers() {\r\n    this.listenerSetter.add(rootScope)('peer_pinned_messages', (e) => {\r\n      const {peerId, mids, pinned} = e;\r\n      if(peerId !== this.peerId) return;\r\n\r\n      if(mids) {\r\n        if(!pinned) {\r\n          this.deleteMessagesByIds(mids);\r\n        }\r\n      }\r\n    });\r\n  }\r\n\r\n  public constructScheduledHelpers() {\r\n    const onUpdate = async() => {\r\n      this.chat.topbar.setTitle((await this.managers.appMessagesManager.getScheduledMessagesStorage(this.peerId)).size);\r\n    };\r\n\r\n    this.listenerSetter.add(rootScope)('scheduled_new', (message) => {\r\n      if(message.peerId !== this.peerId) return;\r\n\r\n      this.renderNewMessage(message);\r\n      onUpdate();\r\n    });\r\n\r\n    this.listenerSetter.add(rootScope)('scheduled_delete', ({peerId, mids}) => {\r\n      if(peerId !== this.peerId) return;\r\n\r\n      this.deleteMessagesByIds(mids);\r\n      onUpdate();\r\n    });\r\n  }\r\n\r\n  public onBubblesClick = async(e: Event) => {\r\n    let target = e.target as HTMLElement;\r\n    let bubble: HTMLElement = null;\r\n    try {\r\n      bubble = findUpClassName(target, 'bubble');\r\n    } catch(err) {}\r\n\r\n    if(!bubble && !this.chat.selection.isSelecting) {\r\n      const avatar = findUpClassName(target, 'user-avatar');\r\n      if(!avatar) {\r\n        return;\r\n      }\r\n\r\n      const peerId = avatar.dataset.peerId.toPeerId();\r\n      if(peerId !== NULL_PEER_ID) {\r\n        this.chat.appImManager.setInnerPeer({peerId});\r\n      } else {\r\n        toast(I18n.format('HidAccount', true));\r\n      }\r\n      return;\r\n    }\r\n\r\n    if(bubble.classList.contains('is-date') && findUpClassName(target, 'bubble-content')) {\r\n      if(bubble.classList.contains('is-sticky') && !this.chatInner.classList.contains('is-scrolling')) {\r\n        return;\r\n      }\r\n\r\n      for(const timestamp in this.dateMessages) {\r\n        const d = this.dateMessages[timestamp];\r\n        if(d.div === bubble) {\r\n          PopupElement.createPopup(PopupDatePicker, new Date(+timestamp), this.onDatePick).show();\r\n          break;\r\n        }\r\n      }\r\n\r\n      return;\r\n    }\r\n\r\n    if(!IS_TOUCH_SUPPORTED && findUpClassName(target, 'time')) {\r\n      this.chat.selection.toggleByElement(bubble);\r\n      return;\r\n    }\r\n\r\n    // ! Trusted - due to audio autoclick\r\n    if(this.chat.selection.isSelecting && e.isTrusted) {\r\n      if(bubble.classList.contains('service') && bubble.dataset.mid === undefined) {\r\n        return;\r\n      }\r\n\r\n      cancelEvent(e);\r\n      // console.log('bubble click', e);\r\n\r\n      if(IS_TOUCH_SUPPORTED && this.chat.selection.selectedText) {\r\n        this.chat.selection.selectedText = undefined;\r\n        return;\r\n      }\r\n\r\n      // this.chatSelection.toggleByBubble(bubble);\r\n      this.chat.selection.toggleByElement(findUpClassName(target, 'grouped-item') || bubble);\r\n      return;\r\n    }\r\n\r\n    const contactDiv: HTMLElement = findUpClassName(target, 'contact');\r\n    if(contactDiv) {\r\n      this.chat.appImManager.setInnerPeer({\r\n        peerId: contactDiv.dataset.peerId.toPeerId()\r\n      });\r\n      return;\r\n    }\r\n\r\n    const callDiv: HTMLElement = findUpClassName(target, 'bubble-call');\r\n    if(callDiv) {\r\n      this.chat.appImManager.callUser(this.peerId.toUserId(), callDiv.dataset.type as any);\r\n      return;\r\n    }\r\n\r\n    const buyButton: HTMLElement = findUpClassName(target, 'is-buy');\r\n    if(buyButton) {\r\n      cancelEvent(e);\r\n\r\n      const message = await this.chat.getMessage(+bubble.dataset.mid);\r\n      if(!message) {\r\n        return;\r\n      }\r\n\r\n      new PopupPayment(\r\n        message as Message.message,\r\n        await this.managers.appPaymentsManager.getInputInvoiceByPeerId(message.peerId, message.mid)\r\n      );\r\n      return;\r\n    }\r\n\r\n    const reactionElement = findUpTag(target, 'REACTION-ELEMENT') as ReactionElement;\r\n    if(reactionElement) {\r\n      cancelEvent(e);\r\n      if(reactionElement.classList.contains('is-inactive')) {\r\n        return;\r\n      }\r\n\r\n      const reactionsElement = reactionElement.parentElement as ReactionsElement;\r\n      const reactionCount = reactionsElement.getReactionCount(reactionElement);\r\n\r\n      const message = reactionsElement.getMessage();\r\n      this.managers.appReactionsManager.sendReaction(message, reactionCount.reaction);\r\n\r\n      return;\r\n    }\r\n\r\n    const stickerEmojiEl = findUpAttribute(target, 'data-sticker-emoji');\r\n    if(stickerEmojiEl) {\r\n      onEmojiStickerClick({\r\n        event: e,\r\n        container: stickerEmojiEl,\r\n        managers: this.managers,\r\n        middleware: this.getMiddleware(),\r\n        peerId: this.peerId\r\n      });\r\n\r\n      return;\r\n    }\r\n\r\n    const commentsDiv: HTMLElement = findUpClassName(target, 'replies');\r\n    if(commentsDiv) {\r\n      const bubbleMid = +bubble.dataset.mid;\r\n      if(this.peerId === REPLIES_PEER_ID) {\r\n        const message = await this.chat.getMessage(bubbleMid) as Message.message;\r\n        const peerId = getPeerId(message.reply_to.reply_to_peer_id);\r\n        const threadId = message.reply_to.reply_to_top_id;\r\n        const lastMsgId = message.fwd_from.saved_from_msg_id;\r\n        this.chat.appImManager.openThread(peerId, lastMsgId, threadId);\r\n      } else {\r\n        const message1 = await this.chat.getMessage(bubbleMid);\r\n        const message = await this.managers.appMessagesManager.getMessageWithReplies(message1 as Message.message);\r\n        const replies = message.replies;\r\n        if(replies) {\r\n          this.managers.appMessagesManager.getDiscussionMessage(this.peerId, message.mid).then((message) => {\r\n            this.chat.appImManager.setInnerPeer({\r\n              peerId: replies.channel_id.toPeerId(true),\r\n              type: 'discussion',\r\n              threadId: (message as MyMessage).mid\r\n            });\r\n          });\r\n        }\r\n      }\r\n\r\n      return;\r\n    }\r\n\r\n    const via = findUpClassName(target, 'is-via');\r\n    if(via) {\r\n      const el = via.querySelector('.peer-title') as HTMLElement;\r\n      if(target === el || findUpAsChild(target, el)) {\r\n        const message = el.innerText + ' ';\r\n        this.managers.appDraftsManager.setDraft(this.peerId, this.chat.threadId, message);\r\n        cancelEvent(e);\r\n\r\n        return;\r\n      }\r\n    }\r\n\r\n    const nameDiv = findUpClassName(target, 'peer-title') || findUpTag(target, 'AVATAR-ELEMENT') || findUpAttribute(target, 'data-saved-from');\r\n    if(nameDiv && nameDiv !== bubble) {\r\n      target = nameDiv || target;\r\n      const peerIdStr = target.dataset.peerId || target.getAttribute('peer') || (target as AvatarElement).peerId;\r\n      const savedFrom = target.dataset.savedFrom;\r\n      if(typeof(peerIdStr) === 'string' || savedFrom) {\r\n        if(savedFrom) {\r\n          const [peerId, mid] = savedFrom.split('_');\r\n          if(target.classList.contains('is-receipt-link')) {\r\n            const message = await this.managers.appMessagesManager.getMessageByPeer(peerId.toPeerId(), +mid);\r\n            if(message) {\r\n              const inputInvoice = await this.managers.appPaymentsManager.getInputInvoiceByPeerId(this.peerId, +bubble.dataset.mid);\r\n              new PopupPayment(message as Message.message, inputInvoice);\r\n            }\r\n          } else {\r\n            this.chat.appImManager.setInnerPeer({\r\n              peerId: peerId.toPeerId(),\r\n              lastMsgId: +mid\r\n            });\r\n          }\r\n        } else {\r\n          const peerId = peerIdStr.toPeerId();\r\n          if(peerId !== NULL_PEER_ID) {\r\n            this.chat.appImManager.setInnerPeer({peerId});\r\n          } else {\r\n            toast(I18n.format('HidAccount', true));\r\n          }\r\n        }\r\n      }\r\n\r\n      return;\r\n    }\r\n\r\n    // this.log('chatInner click:', target);\r\n    // const isVideoComponentElement = target.tagName === 'SPAN' && findUpClassName(target, 'media-container');\r\n    /* if(isVideoComponentElement) {\r\n      const video = target.parentElement.querySelector('video') as HTMLElement;\r\n      if(video) {\r\n        video.click(); // hot-fix for time and play button\r\n        return;\r\n      }\r\n    } */\r\n\r\n    if(bubble.classList.contains('sticker') && target.parentElement.classList.contains('attachment')) {\r\n      const messageId = +bubble.dataset.mid;\r\n      const message = await this.chat.getMessage(messageId);\r\n\r\n      const doc = ((message as Message.message).media as MessageMedia.messageMediaDocument)?.document as Document.document;\r\n\r\n      if(doc?.stickerSetInput) {\r\n        new PopupStickers(doc.stickerSetInput).show();\r\n      }\r\n\r\n      return;\r\n    }\r\n\r\n    const documentDiv = findUpClassName(target, 'document-with-thumb');\r\n    if((target.tagName === 'IMG' && !target.classList.contains('emoji') && !target.classList.contains('document-thumb')) ||\r\n      target.classList.contains('album-item') ||\r\n      // || isVideoComponentElement\r\n      (target.tagName === 'VIDEO' && !bubble.classList.contains('round')) ||\r\n      (documentDiv && !documentDiv.querySelector('.preloader-container')) ||\r\n      target.classList.contains('canvas-thumbnail')) {\r\n      const groupedItem = findUpClassName(target, 'album-item') || findUpClassName(target, 'document-container');\r\n      const preloader = (groupedItem || bubble).querySelector<HTMLElement>('.preloader-container');\r\n      if(preloader) {\r\n        simulateClickEvent(preloader);\r\n        cancelEvent(e);\r\n        return;\r\n      }\r\n\r\n      cancelEvent(e);\r\n      const messageId = +(groupedItem || bubble).dataset.mid;\r\n      const message = await this.chat.getMessage(messageId);\r\n      if(!message) {\r\n        this.log.warn('no message by messageId:', messageId);\r\n        return;\r\n      }\r\n\r\n      const SINGLE_MEDIA_CLASSNAME = 'webpage';\r\n      const isSingleMedia = bubble.classList.contains(SINGLE_MEDIA_CLASSNAME);\r\n\r\n      const f = documentDiv ? (media: any) => {\r\n        return AppMediaViewer.isMediaCompatibleForDocumentViewer(media);\r\n      } : (media: any) => {\r\n        return media._ === 'photo' || ['video', 'gif'].includes(media.type);\r\n      };\r\n\r\n      const targets: {element: HTMLElement, mid: number, peerId: PeerId}[] = [];\r\n      const ids = isSingleMedia ? [messageId] : (await Promise.all(Object.keys(this.bubbles).map((k) => +k).map(async(mid) => {\r\n        /* if(isSingleMedia && !this.bubbles[id].classList.contains(SINGLE_MEDIA_CLASSNAME)) {\r\n          return false;\r\n        }  */\r\n        // if(!this.scrollable.visibleElements.find((e) => e.element === this.bubbles[id])) return false;\r\n\r\n        const message = await this.chat.getMessage(mid);\r\n        const media = getMediaFromMessage(message);\r\n\r\n        return media && f(media) && mid;\r\n      }))).filter(Boolean).sort((a, b) => a - b);\r\n\r\n      ids.forEach((id) => {\r\n        let selector: string;\r\n        if(documentDiv) {\r\n          selector = '.document-container';\r\n        } else {\r\n          const withTail = this.bubbles[id].classList.contains('with-media-tail');\r\n          selector = '.album-item video, .album-item img, .preview video, .preview img, ';\r\n          if(withTail) {\r\n            selector += '.bubble__media-container';\r\n          } else {\r\n            selector += '.attachment video, .attachment img';\r\n          }\r\n        }\r\n\r\n        const elements = Array.from(this.bubbles[id].querySelectorAll(selector)) as HTMLElement[];\r\n        const parents: Set<HTMLElement> = new Set();\r\n        if(documentDiv) {\r\n          elements.forEach((element) => {\r\n            targets.push({\r\n              element: element.querySelector('.document-ico'),\r\n              mid: +element.dataset.mid,\r\n              peerId: this.peerId\r\n            });\r\n          });\r\n        } else {\r\n          const hasAspecter = !!this.bubbles[id].querySelector('.media-container-aspecter');\r\n          elements.forEach((element) => {\r\n            if(hasAspecter && !findUpClassName(element, 'media-container-aspecter')) return;\r\n            const albumItem = findUpClassName(element, 'album-item');\r\n            const parent = albumItem || element.parentElement;\r\n            if(parents.has(parent)) return;\r\n            parents.add(parent);\r\n            targets.push({\r\n              element,\r\n              mid: albumItem ? +albumItem.dataset.mid : id,\r\n              peerId: this.peerId\r\n            });\r\n          });\r\n        }\r\n      });\r\n\r\n      targets.sort((a, b) => a.mid - b.mid);\r\n\r\n      const idx = targets.findIndex((t) => t.mid === messageId);\r\n\r\n      if(DEBUG) {\r\n        this.log('open mediaViewer single with ids:', ids, idx, targets);\r\n      }\r\n\r\n      if(!targets[idx]) {\r\n        this.log('no target for media viewer!', target);\r\n        return;\r\n      }\r\n\r\n      new AppMediaViewer()\r\n      .setSearchContext({\r\n        threadId: this.chat.threadId,\r\n        peerId: this.peerId,\r\n        inputFilter: {_: documentDiv ? 'inputMessagesFilterDocument' : 'inputMessagesFilterPhotoVideo'},\r\n        useSearch: this.chat.type !== 'scheduled' && !isSingleMedia,\r\n        isScheduled: this.chat.type === 'scheduled'\r\n      })\r\n      .openMedia(message, targets[idx].element, 0, true, targets.slice(0, idx), targets.slice(idx + 1));\r\n\r\n      // appMediaViewer.openMedia(message, target as HTMLImageElement);\r\n      return;\r\n    }\r\n\r\n    if(['IMG', 'DIV', 'SPAN'/* , 'A' */].indexOf(target.tagName) === -1) target = findUpTag(target, 'DIV');\r\n\r\n    if(['DIV', 'SPAN'].indexOf(target.tagName) !== -1/*  || target.tagName === 'A' */) {\r\n      if(target.classList.contains('goto-original')) {\r\n        const savedFrom = bubble.dataset.savedFrom;\r\n        const [peerId, mid] = savedFrom.split('_');\r\n        // //this.log('savedFrom', peerId, msgID);\r\n        this.chat.appImManager.setInnerPeer({\r\n          peerId: peerId.toPeerId(),\r\n          lastMsgId: +mid\r\n        });\r\n        return;\r\n      } else if(target.classList.contains('forward')) {\r\n        const mid = +bubble.dataset.mid;\r\n        const message = await this.managers.appMessagesManager.getMessageByPeer(this.peerId, mid);\r\n        new PopupForward({\r\n          [this.peerId]: await this.managers.appMessagesManager.getMidsByMessage(message)\r\n        });\r\n        // appSidebarRight.forwardTab.open([mid]);\r\n        return;\r\n      }\r\n\r\n      let isReplyClick = false;\r\n\r\n      try {\r\n        isReplyClick = !!findUpClassName(e.target, 'reply');\r\n      } catch(err) {}\r\n\r\n      if(isReplyClick && bubble.classList.contains('is-reply')/*  || bubble.classList.contains('forwarded') */) {\r\n        const bubbleMid = +bubble.dataset.mid;\r\n        this.replyFollowHistory.push(bubbleMid);\r\n\r\n        const message = (await this.chat.getMessage(bubbleMid)) as Message.message;\r\n\r\n        const replyToPeerId = message.reply_to.reply_to_peer_id ? getPeerId(message.reply_to.reply_to_peer_id) : this.peerId;\r\n        const replyToMid = message.reply_to.reply_to_msg_id;\r\n\r\n        this.chat.appImManager.setInnerPeer({\r\n          peerId: replyToPeerId,\r\n          lastMsgId: replyToMid,\r\n          type: this.chat.type,\r\n          threadId: this.chat.threadId\r\n        });\r\n\r\n        /* if(this.chat.type === 'discussion') {\r\n          this.chat.appImManager.setMessageId(, originalMessageId);\r\n        } else {\r\n          this.chat.appImManager.setInnerPeer(this.peerId, originalMessageId);\r\n        } */\r\n        // this.chat.setMessageId(, originalMessageId);\r\n      }\r\n    }\r\n\r\n    // console.log('chatInner click', e);\r\n  };\r\n\r\n  public async onGoDownClick() {\r\n    if(!this.replyFollowHistory.length) {\r\n      // this.onScroll(true, undefined, true);\r\n      this.chat.setMessageId(/* , dialog.top_message */);\r\n      // const dialog = this.appMessagesManager.getDialogByPeerId(this.peerId)[0];\r\n\r\n      // if(dialog) {\r\n      //   this.chat.setPeer(this.peerId/* , dialog.top_message */);\r\n      // } else {\r\n      //   this.log('will scroll down 3');\r\n      //   this.scroll.scrollTop = this.scroll.scrollHeight;\r\n      // }\r\n\r\n      return;\r\n    }\r\n\r\n    const middleware = this.getMiddleware();\r\n    const slice = this.replyFollowHistory.slice();\r\n    const messages = await Promise.all(slice.map((mid) => this.chat.getMessage(mid)));\r\n    if(!middleware()) return;\r\n\r\n    slice.forEach((mid, idx) => {\r\n      const message = messages[idx];\r\n\r\n      const bubble = this.bubbles[mid];\r\n      let bad = true;\r\n      if(bubble) {\r\n        const rect = bubble.getBoundingClientRect();\r\n        bad = (windowSize.height / 2) > rect.top;\r\n      } else if(message) {\r\n        bad = false;\r\n      }\r\n\r\n      if(bad) {\r\n        this.replyFollowHistory.splice(this.replyFollowHistory.indexOf(mid), 1);\r\n      }\r\n    });\r\n\r\n    this.replyFollowHistory.sort((a, b) => b - a);\r\n\r\n    const mid = this.replyFollowHistory.pop();\r\n    this.chat.setMessageId(mid);\r\n  }\r\n\r\n  public getBubbleByPoint(verticalSide: 'top' | 'bottom') {\r\n    let element = getElementByPoint(this.scrollable.container, verticalSide, 'center');\r\n    /* if(element) {\r\n      if(element.classList.contains('bubbles-date-group')) {\r\n        const children = Array.from(element.children) as HTMLElement[];\r\n        if(verticalSide === 'top') {\r\n          element = children[this.stickyIntersector ? 2 : 1];\r\n        } else {\r\n          element = children[children.length - 1];\r\n        }\r\n      } else {\r\n        element = findUpClassName(element, 'bubble');\r\n        if(element && element.classList.contains('is-date')) {\r\n          element = element.nextElementSibling as HTMLElement;\r\n        }\r\n      }\r\n    } */\r\n    if(element) element = findUpClassName(element, 'bubble');\r\n\r\n    return element;\r\n  }\r\n\r\n  public async getGroupedBubble(groupId: string) {\r\n    const mids = await this.managers.appMessagesManager.getMidsByAlbum(groupId);\r\n    for(const mid of mids) {\r\n      if(this.bubbles[mid] && !this.skippedMids.has(mid)) {\r\n        // const maxId = Math.max(...mids); // * because in scheduled album can be rendered by lowest mid during sending\r\n        return {\r\n          bubble: this.bubbles[mid],\r\n          mid: mid\r\n          // message: await this.chat.getMessage(maxId) as Message.message\r\n        };\r\n      }\r\n    }\r\n  }\r\n\r\n  public getBubbleGroupedItems(bubble: HTMLElement) {\r\n    return Array.from(bubble.querySelectorAll('.grouped-item')) as HTMLElement[];\r\n  }\r\n\r\n  public async getMountedBubble(mid: number, message?: Message.message | Message.messageService) {\r\n    if(message === undefined) {\r\n      message = await this.chat.getMessage(mid);\r\n    }\r\n\r\n    if(!message) {\r\n      return;\r\n    }\r\n\r\n    const groupedId = (message as Message.message).grouped_id;\r\n    if(groupedId) {\r\n      const a = await this.getGroupedBubble(groupedId);\r\n      if(a) {\r\n        a.bubble = a.bubble.querySelector(`.document-container[data-mid=\"${mid}\"]`) || a.bubble;\r\n        return a;\r\n      }\r\n    }\r\n\r\n    const bubble = this.bubbles[mid];\r\n    if(!bubble) return;\r\n\r\n    return {bubble, mid};\r\n  }\r\n\r\n  private findNextMountedBubbleByMsgId(mid: number, prev?: boolean) {\r\n    const mids = getObjectKeysAndSort(this.bubbles, prev ? 'desc' : 'asc');\r\n\r\n    let filterCallback: (_mid: number) => boolean;\r\n    if(prev) filterCallback = (_mid) => _mid < mid;\r\n    else filterCallback = (_mid) => mid < _mid;\r\n\r\n    const foundMid = mids.find((_mid) => {\r\n      if(!filterCallback(_mid)) return false;\r\n      return !!this.bubbles[_mid]?.parentElement;\r\n    });\r\n\r\n    return this.bubbles[foundMid];\r\n  }\r\n\r\n  public loadMoreHistory(top: boolean, justLoad = false) {\r\n    // this.log('loadMoreHistory', top);\r\n    if(\r\n      !this.peerId ||\r\n      /* TEST_SCROLL || */\r\n      this.chat.setPeerPromise ||\r\n      this.isHeavyAnimationInProgress ||\r\n      (top && (this.getHistoryTopPromise || this.scrollable.loadedAll.top)) ||\r\n      (!top && (this.getHistoryBottomPromise || this.scrollable.loadedAll.bottom))\r\n    ) {\r\n      return;\r\n    }\r\n\r\n    // warning,         (     )\r\n    // some messages can have negative id (such as sponsored message)\r\n    const history = Object.keys(this.bubbles)\r\n    .map((id) => +id)\r\n    .filter((id) => id > 0 && !this.skippedMids.has(id))\r\n    .sort((a, b) => a - b);\r\n\r\n    if(!history.length) {\r\n      history.push(0);\r\n    }\r\n\r\n    if(top) {\r\n      if(DEBUG) {\r\n        this.log('Will load more (up) history by id:', history[0], 'maxId:', history[history.length - 1], justLoad/* , history */);\r\n      }\r\n\r\n      this.getHistory1(history[0], true, undefined, undefined, justLoad);\r\n    } else {\r\n      // let dialog = this.appMessagesManager.getDialogByPeerId(this.peerId)[0];\r\n      // const historyMaxId = await this.chat.getHistoryMaxId();\r\n\r\n      // // if scroll down after search\r\n      // if(history.indexOf(historyMaxId) !== -1) {\r\n      //   this.setLoaded('bottom', true);\r\n      //   return;\r\n      // }\r\n\r\n      if(DEBUG) {\r\n        this.log('Will load more (down) history by id:', history[history.length - 1], justLoad/* , history */);\r\n      }\r\n\r\n      this.getHistory1(history[history.length - 1], false, true, undefined, justLoad);\r\n    }\r\n  }\r\n\r\n  public onScroll = (ignoreHeavyAnimation?: boolean, scrollDimensions?: ScrollStartCallbackDimensions, forceDown?: boolean) => {\r\n    // return;\r\n\r\n    if(this.isHeavyAnimationInProgress) {\r\n      if(this.sliceViewportDebounced) {\r\n        this.sliceViewportDebounced.clearTimeout();\r\n      }\r\n\r\n      // *   ,         ,          \r\n      if(this.scrolledDown && !ignoreHeavyAnimation) {\r\n        return;\r\n      }\r\n    } else {\r\n      if(this.chat.topbar.pinnedMessage) {\r\n        this.chat.topbar.pinnedMessage.setCorrectIndexThrottled(this.scrollable.lastScrollDirection);\r\n      }\r\n\r\n      if(this.sliceViewportDebounced) {\r\n        this.sliceViewportDebounced();\r\n      }\r\n\r\n      this.setStickyDateManually();\r\n    }\r\n\r\n    // lottieLoader.checkAnimations(false, 'chat');\r\n\r\n    if(scrollDimensions && scrollDimensions.distanceToEnd < SCROLLED_DOWN_THRESHOLD && this.scrolledDown) {\r\n      return;\r\n    }\r\n\r\n    const distanceToEnd = forceDown ? 0 : scrollDimensions?.distanceToEnd ?? this.scrollable.getDistanceToEnd();\r\n    if(/* !IS_TOUCH_SUPPORTED &&  */(this.scrollable.lastScrollDirection !== 0 && distanceToEnd > 0) || scrollDimensions || forceDown) {\r\n    // if(/* !IS_TOUCH_SUPPORTED &&  */(this.scrollable.lastScrollDirection !== 0 || scrollDimensions) && distanceToEnd > 0) {\r\n      if(this.isScrollingTimeout) {\r\n        clearTimeout(this.isScrollingTimeout);\r\n      } else if(!this.chatInner.classList.contains('is-scrolling')) {\r\n        this.chatInner.classList.add('is-scrolling');\r\n      }\r\n\r\n      this.isScrollingTimeout = window.setTimeout(() => {\r\n        this.chatInner.classList.remove('is-scrolling');\r\n        this.isScrollingTimeout = 0;\r\n      }, 1350 + (scrollDimensions?.duration ?? 0));\r\n    }\r\n\r\n    if(distanceToEnd < SCROLLED_DOWN_THRESHOLD && (forceDown || this.scrollable.loadedAll.bottom || this.chat.setPeerPromise || !this.peerId)) {\r\n      this.container.classList.add('scrolled-down');\r\n      this.scrolledDown = true;\r\n    } else if(this.container.classList.contains('scrolled-down')) {\r\n      this.container.classList.remove('scrolled-down');\r\n      this.scrolledDown = false;\r\n    }\r\n  };\r\n\r\n  public setScroll() {\r\n    if(this.scrollable) {\r\n      this.destroyScrollable();\r\n    }\r\n\r\n    this.scrollable = new Scrollable(null, 'IM', /* 10300 */300);\r\n    this.setLoaded('top', false, false);\r\n    this.setLoaded('bottom', false, false);\r\n\r\n    this.scrollable.container.append(this.chatInner);\r\n\r\n    /* const getScrollOffset = () => {\r\n      //return Math.round(Math.max(300, appPhotosManager.windowH / 1.5));\r\n      return 300;\r\n    };\r\n\r\n    window.addEventListener('resize', () => {\r\n      this.scrollable.onScrollOffset = getScrollOffset();\r\n    });\r\n\r\n    this.scrollable = new Scrollable(this.bubblesContainer, 'y', 'IM', this.chatInner, getScrollOffset()); */\r\n\r\n    this.scrollable.onAdditionalScroll = this.onScroll;\r\n    this.scrollable.onScrolledTop = () => this.loadMoreHistory(true);\r\n    this.scrollable.onScrolledBottom = () => this.loadMoreHistory(false);\r\n    // this.scrollable.attachSentinels(undefined, 300);\r\n\r\n    if(IS_TOUCH_SUPPORTED && false) {\r\n      this.scrollable.container.addEventListener('touchmove', () => {\r\n        if(this.isScrollingTimeout) {\r\n          clearTimeout(this.isScrollingTimeout);\r\n        } else if(!this.chatInner.classList.contains('is-scrolling')) {\r\n          this.chatInner.classList.add('is-scrolling');\r\n        }\r\n      }, {passive: true});\r\n\r\n      this.scrollable.container.addEventListener('touchend', () => {\r\n        if(!this.chatInner.classList.contains('is-scrolling')) {\r\n          return;\r\n        }\r\n\r\n        if(this.isScrollingTimeout) {\r\n          clearTimeout(this.isScrollingTimeout);\r\n        }\r\n\r\n        this.isScrollingTimeout = window.setTimeout(() => {\r\n          this.chatInner.classList.remove('is-scrolling');\r\n          this.isScrollingTimeout = 0;\r\n        }, 1350);\r\n      }, {passive: true});\r\n    }\r\n  }\r\n\r\n  public async updateUnreadByDialog() {\r\n    const historyStorage = await this.chat.getHistoryStorage();\r\n    const maxId = this.peerId === rootScope.myId ? historyStorage.readMaxId : historyStorage.readOutboxMaxId;\r\n\r\n    // /////this.log('updateUnreadByDialog', maxId, dialog, this.unreadOut);\r\n\r\n    for(const msgId of this.unreadOut) {\r\n      if(msgId > 0 && msgId <= maxId) {\r\n        const bubble = this.bubbles[msgId];\r\n        if(bubble) {\r\n          this.unreadOut.delete(msgId);\r\n\r\n          if(bubble.classList.contains('is-outgoing') || bubble.classList.contains('is-error')) {\r\n            continue;\r\n          }\r\n\r\n          bubble.classList.remove('is-sent', 'is-sending', 'is-outgoing'); // is-sending can be when there are bulk of updates (e.g. sending command to Stickers bot)\r\n          bubble.classList.add('is-read');\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  public deleteMessagesByIds(mids: number[], permanent = true, ignoreOnScroll?: boolean) {\r\n    let deleted = false;\r\n    mids.forEach((mid) => {\r\n      const bubble = this.bubbles[mid];\r\n      if(!bubble) return;\r\n\r\n      bubble.middlewareHelper.destroy();\r\n\r\n      deleted = true;\r\n      /* const mounted = this.getMountedBubble(mid);\r\n      if(!mounted) return; */\r\n\r\n      delete this.bubbles[mid];\r\n      this.skippedMids.delete(mid);\r\n\r\n      if(this.firstUnreadBubble === bubble) {\r\n        this.firstUnreadBubble = null;\r\n      }\r\n\r\n      this.bubbleGroups.removeAndUnmountBubble(bubble);\r\n      if(this.observer) {\r\n        this.observer.unobserve(bubble, this.unreadedObserverCallback);\r\n        this.unreaded.delete(bubble);\r\n\r\n        this.observer.unobserve(bubble, this.viewsObserverCallback);\r\n        this.viewsMids.delete(mid);\r\n\r\n        this.observer.unobserve(bubble, this.stickerEffectObserverCallback);\r\n      }\r\n\r\n      if(this.emptyPlaceholderBubble === bubble) {\r\n        this.emptyPlaceholderBubble = undefined;\r\n      }\r\n\r\n      // this.reactions.delete(mid);\r\n    });\r\n\r\n    if(!deleted) {\r\n      return;\r\n    }\r\n\r\n    this.scrollable.ignoreNextScrollEvent();\r\n    if(permanent && this.chat.selection.isSelecting) {\r\n      this.chat.selection.deleteSelectedMids(this.peerId, mids);\r\n    }\r\n\r\n    animationIntersector.checkAnimations(false, CHAT_ANIMATION_GROUP);\r\n    this.deleteEmptyDateGroups();\r\n\r\n    if(!ignoreOnScroll) {\r\n      this.scrollable.onScroll();\r\n      // this.onScroll();\r\n    }\r\n  }\r\n\r\n  private setTopPadding(middleware = this.getMiddleware()) {\r\n    let isPaddingNeeded = false;\r\n    let setPaddingTo: HTMLElement;\r\n    if(!this.isTopPaddingSet && this.chat.type !== 'scheduled') {\r\n      const {clientHeight, scrollHeight} = this.scrollable.container;\r\n      isPaddingNeeded = clientHeight === scrollHeight;\r\n      /* const firstEl = this.chatInner.firstElementChild as HTMLElement;\r\n      if(this.chatInner.firstElementChild) {\r\n        const visibleRect = getVisibleRect(firstEl, this.scrollable.container);\r\n        isPaddingNeeded = !visibleRect.overflow.top && (visibleRect.rect.top - firstEl.offsetTop) !== this.scrollable.container.getBoundingClientRect().top;\r\n      } else {\r\n        isPaddingNeeded = true;\r\n      } */\r\n\r\n      if(isPaddingNeeded) {\r\n        /* const add = clientHeight - scrollHeight;\r\n        this.chatInner.style.paddingTop = add + 'px';\r\n        this.scrollable.scrollTop += add; */\r\n        setPaddingTo = this.chatInner;\r\n        setPaddingTo.style.paddingTop = clientHeight + 'px';\r\n        this.scrollable.setScrollTopSilently(scrollHeight);\r\n        this.isTopPaddingSet = true;\r\n      }\r\n    }\r\n\r\n    return {\r\n      isPaddingNeeded,\r\n      unsetPadding: isPaddingNeeded ? () => {\r\n        if(middleware() && isPaddingNeeded) {\r\n          setPaddingTo.style.paddingTop = '';\r\n          this.isTopPaddingSet = false;\r\n        }\r\n      } : undefined\r\n    };\r\n  }\r\n\r\n  private renderNewMessage(message: MyMessage, scrolledDown?: boolean) {\r\n    const promise = this._renderNewMessage(message, scrolledDown);\r\n    this.renderNewPromises.add(promise);\r\n    promise.catch(noop).finally(() => {\r\n      this.renderNewPromises.delete(promise);\r\n    });\r\n    return promise;\r\n  }\r\n\r\n  private async _renderNewMessage(message: MyMessage, scrolledDown?: boolean) {\r\n    if(!this.scrollable.loadedAll.bottom) { // seems search active or sliced\r\n      // this.log('renderNewMessagesByIds: seems search is active, skipping render:', mids);\r\n      const setPeerPromise = this.chat.setPeerPromise;\r\n      if(setPeerPromise) {\r\n        const middleware = this.getMiddleware();\r\n        setPeerPromise.then(async() => {\r\n          if(!middleware()) return;\r\n          const newMessage = await this.chat.getMessage(message.mid);\r\n          if(!middleware()) return;\r\n          this.renderNewMessage(newMessage);\r\n        });\r\n      }\r\n\r\n      return;\r\n    }\r\n\r\n    if(this.chat.threadId) {\r\n      const replyTo = message?.reply_to as MessageReplyHeader;\r\n      if(!(replyTo && (replyTo.reply_to_top_id || replyTo.reply_to_msg_id) === this.chat.threadId)) {\r\n        return;\r\n      }\r\n    }\r\n\r\n    if(this.bubbles[message.mid]) {\r\n      return;\r\n    }\r\n    // ! should scroll even without new messages\r\n    /* if(!mids.length) {\r\n      return;\r\n    } */\r\n\r\n    if(!scrolledDown) {\r\n      scrolledDown = this.scrolledDown && (\r\n        !this.scrollingToBubble ||\r\n        this.scrollingToBubble === this.getLastBubble() ||\r\n        this.scrollingToBubble === this.chatInner\r\n      );\r\n    }\r\n\r\n    const middleware = this.getMiddleware();\r\n    const {isPaddingNeeded, unsetPadding} = this.setTopPadding(middleware);\r\n\r\n    const promise = this.performHistoryResult({history: [message]}, false);\r\n    if(scrolledDown) {\r\n      promise.then(() => {\r\n        if(!middleware()) return;\r\n        // this.log('renderNewMessagesByIDs: messagesQueuePromise after', this.scrollable.isScrolledDown);\r\n        // this.scrollable.scrollTo(this.scrollable.scrollHeight, 'top', true, true, 5000);\r\n        // const bubble = this.bubbles[Math.max(...mids)];\r\n\r\n        let bubble: HTMLElement;\r\n        if(this.chat.type === 'scheduled') {\r\n          bubble = this.bubbles[message.mid];\r\n        }\r\n\r\n        const promise = bubble ? this.scrollToBubbleEnd(bubble) : this.scrollToEnd();\r\n        if(isPaddingNeeded) {\r\n          // it will be called only once even if was set multiple times (that won't happen)\r\n          promise.then(unsetPadding);\r\n        }\r\n\r\n        // this.scrollable.scrollIntoViewNew(this.chatInner, 'end');\r\n\r\n        /* setTimeout(() => {\r\n          this.log('messagesQueuePromise afterafter:', this.chatInner.childElementCount, this.scrollable.scrollHeight);\r\n        }, 10); */\r\n      });\r\n    }\r\n\r\n    return promise;\r\n  }\r\n\r\n  public getLastBubble() {\r\n    const group = this.bubbleGroups.getLastGroup();\r\n    return group?.lastItem?.bubble;\r\n  }\r\n\r\n  public scrollToBubble(\r\n    element: HTMLElement,\r\n    position: ScrollLogicalPosition,\r\n    forceDirection?: FocusDirection,\r\n    forceDuration?: number\r\n  ) {\r\n    const bubble = findUpClassName(element, 'bubble');\r\n\r\n    if(!element.parentElement) {\r\n      this.log.error('element is not connected', bubble);\r\n    }\r\n\r\n    let fallbackToElementStartWhenCentering: HTMLElement;\r\n    // * if it's a start, then scroll to start of the group\r\n    if(bubble && position !== 'end') {\r\n      const item = this.bubbleGroups.getItemByBubble(bubble);\r\n      if(item.group.firstItem === item && whichChild(item.group.container) === (this.stickyIntersector ? STICKY_OFFSET : 1)) {\r\n        const dateGroup = item.group.container.parentElement;\r\n        // if(whichChild(dateGroup) === 0) {\r\n        fallbackToElementStartWhenCentering = dateGroup;\r\n        // position = 'start';\r\n        // element = dateGroup;\r\n        // }\r\n      }\r\n    }\r\n\r\n    // const isLastBubble = this.getLastBubble() === bubble;\r\n    /* if(isLastBubble) {\r\n      element = this.getLastDateGroup();\r\n    } */\r\n\r\n    const margin = 4; // * 4 = .25rem\r\n    /* if(isLastBubble && this.chat.type === 'chat' && this.bubblesContainer.classList.contains('is-chat-input-hidden')) {\r\n      margin = 20;\r\n    } */\r\n\r\n    const isChangingHeight = (this.chat.input.messageInput && this.chat.input.messageInput.classList.contains('is-changing-height')) || this.chat.container.classList.contains('is-toggling-helper');\r\n    const promise = this.scrollable.scrollIntoViewNew({\r\n      element,\r\n      position,\r\n      margin,\r\n      forceDirection,\r\n      forceDuration,\r\n      axis: 'y',\r\n      getNormalSize: isChangingHeight ? ({rect}) => {\r\n        // return rect.height;\r\n\r\n        let height = windowSize.height;\r\n        // height -= this.chat.topbar.container.getBoundingClientRect().height;\r\n        height -= this.container.offsetTop;\r\n        height -= mediaSizes.isMobile || windowSize.height < 570 ? 58 : 78;\r\n        return height;\r\n\r\n        /* const rowsWrapperHeight = this.chat.input.rowsWrapper.getBoundingClientRect().height;\r\n        const diff = rowsWrapperHeight - 54;\r\n        return rect.height + diff; */\r\n      } : undefined,\r\n      fallbackToElementStartWhenCentering,\r\n      startCallback: (dimensions) => {\r\n        // this.onScroll(true, this.scrolledDown && dimensions.distanceToEnd <= SCROLLED_DOWN_THRESHOLD ? undefined : dimensions);\r\n        this.onScroll(true, dimensions);\r\n      }\r\n    });\r\n\r\n    // fix flickering date when opening unread chat and focusing message\r\n    if(forceDirection === FocusDirection.Static) {\r\n      this.scrollable.lastScrollPosition = this.scrollable.scrollTop;\r\n    }\r\n\r\n    return promise;\r\n  }\r\n\r\n  public scrollToEnd() {\r\n    return this.scrollToBubbleEnd(this.chatInner);\r\n  }\r\n\r\n  public async scrollToBubbleEnd(bubble: HTMLElement) {\r\n    /* if(DEBUG) {\r\n      this.log('scrollToNewLastBubble: will scroll into view:', bubble);\r\n    } */\r\n\r\n    if(bubble) {\r\n      this.scrollingToBubble = bubble;\r\n      const middleware = this.getMiddleware();\r\n      await this.scrollToBubble(bubble, 'end', undefined, undefined);\r\n      if(!middleware()) return;\r\n      this.scrollingToBubble = undefined;\r\n    }\r\n  }\r\n\r\n  // ! can't get it by chatInner.lastElementChild because placeholder can be the last...\r\n  // private getLastDateGroup() {\r\n  //   let lastTime = 0, lastElem: HTMLElement;\r\n  //   for(const i in this.dateMessages) {\r\n  //     const dateMessage = this.dateMessages[i];\r\n  //     if(dateMessage.firstTimestamp > lastTime) {\r\n  //       lastElem = dateMessage.container;\r\n  //       lastTime = dateMessage.firstTimestamp;\r\n  //     }\r\n  //   }\r\n\r\n  //   return lastElem;\r\n  // }\r\n\r\n  public async scrollToBubbleIfLast(bubble: HTMLElement) {\r\n    if(this.getLastBubble() === bubble) {\r\n      // return this.scrollToBubbleEnd(bubble);\r\n      return this.scrollToEnd();\r\n    }\r\n  }\r\n\r\n  public highlightBubble(element: HTMLElement) {\r\n    const datasetKey = 'highlightTimeout';\r\n    if(element.dataset[datasetKey]) {\r\n      clearTimeout(+element.dataset[datasetKey]);\r\n      element.classList.remove('is-highlighted');\r\n      void element.offsetWidth; // reflow\r\n    }\r\n\r\n    element.classList.add('is-highlighted');\r\n    element.dataset[datasetKey] = '' + setTimeout(() => {\r\n      element.classList.remove('is-highlighted');\r\n      delete element.dataset[datasetKey];\r\n    }, 2000);\r\n  }\r\n\r\n  private createDateBubble(timestamp: number, date: Date = new Date(timestamp * 1000)) {\r\n    let dateElement: HTMLElement;\r\n\r\n    const today = new Date();\r\n    today.setHours(0, 0, 0, 0);\r\n\r\n    const isScheduled = this.chat.type === 'scheduled';\r\n\r\n    if(today.getTime() === date.getTime()) {\r\n      dateElement = i18n(isScheduled ? 'Chat.Date.ScheduledForToday' : 'Date.Today');\r\n    } else if(isScheduled && timestamp === SEND_WHEN_ONLINE_TIMESTAMP) {\r\n      dateElement = i18n('MessageScheduledUntilOnline');\r\n    } else {\r\n      const options: Intl.DateTimeFormatOptions = {\r\n        day: 'numeric',\r\n        month: 'long'\r\n      };\r\n\r\n      if(date.getFullYear() !== today.getFullYear()) {\r\n        options.year = 'numeric';\r\n      }\r\n\r\n      dateElement = new I18n.IntlDateElement({\r\n        date,\r\n        options\r\n      }).element;\r\n\r\n      if(isScheduled) {\r\n        dateElement = i18n('Chat.Date.ScheduledFor', [dateElement]);\r\n      }\r\n    }\r\n\r\n    const bubble = document.createElement('div');\r\n    bubble.className = 'bubble service is-date';\r\n    const bubbleContent = document.createElement('div');\r\n    bubbleContent.classList.add('bubble-content');\r\n    const serviceMsg = document.createElement('div');\r\n    serviceMsg.classList.add('service-msg');\r\n\r\n    serviceMsg.append(dateElement);\r\n\r\n    bubbleContent.append(serviceMsg);\r\n    bubble.append(bubbleContent);\r\n\r\n    return bubble;\r\n  }\r\n\r\n  public getDateForDateContainer(timestamp: number) {\r\n    const date = new Date(timestamp * 1000);\r\n    date.setHours(0, 0, 0);\r\n    return {date, dateTimestamp: date.getTime()};\r\n  }\r\n\r\n  public getDateContainerByTimestamp(timestamp: number) {\r\n    const {date, dateTimestamp} = this.getDateForDateContainer(timestamp);\r\n    if(!this.dateMessages[dateTimestamp]) {\r\n      const bubble = this.createDateBubble(timestamp, date);\r\n      // bubble.classList.add('is-sticky');\r\n      const fakeBubble = this.createDateBubble(timestamp, date);\r\n      fakeBubble.classList.add('is-fake');\r\n\r\n      const container = document.createElement('section');\r\n      container.className = 'bubbles-date-group';\r\n      container.append(bubble, fakeBubble);\r\n\r\n      this.dateMessages[dateTimestamp] = {\r\n        div: bubble,\r\n        container,\r\n        firstTimestamp: date.getTime()\r\n      };\r\n\r\n      const haveTimestamps = getObjectKeysAndSort(this.dateMessages, 'asc');\r\n      const length = haveTimestamps.length;\r\n      let i = 0, insertBefore: HTMLElement; // there can be 'first bubble' (e.g. bot description) so can't insert by index\r\n      for(; i < haveTimestamps.length; ++i) {\r\n        const t = haveTimestamps[i];\r\n        insertBefore = this.dateMessages[t].container;\r\n        if(dateTimestamp < t) {\r\n          break;\r\n        }\r\n      }\r\n\r\n      if(i === length && insertBefore) {\r\n        insertBefore = insertBefore.nextElementSibling as HTMLElement;\r\n      }\r\n\r\n      if(!insertBefore) {\r\n        this.chatInner.append(container);\r\n      } else {\r\n        this.chatInner.insertBefore(container, insertBefore);\r\n      }\r\n\r\n      if(this.stickyIntersector) {\r\n        this.stickyIntersector.observeStickyHeaderChanges(container);\r\n      }\r\n\r\n      if(this.chatInner.parentElement) {\r\n        this.container.classList.add('has-groups');\r\n      }\r\n    }\r\n\r\n    return this.dateMessages[dateTimestamp];\r\n  }\r\n\r\n  private destroyScrollable() {\r\n    this.scrollable.destroy();\r\n  }\r\n\r\n  public destroy() {\r\n    // this.chat.log.error('Bubbles destroying');\r\n\r\n    this.destroyScrollable();\r\n\r\n    this.listenerSetter.removeAll();\r\n\r\n    this.lazyLoadQueue.clear();\r\n    this.observer && this.observer.disconnect();\r\n    this.stickyIntersector && this.stickyIntersector.disconnect();\r\n\r\n    delete this.lazyLoadQueue;\r\n    this.observer && delete this.observer;\r\n    this.stickyIntersector && delete this.stickyIntersector;\r\n  }\r\n\r\n  public cleanup(bubblesToo = false) {\r\n    this.bubbles = {}; // clean it before so sponsored message won't be deleted faster on peer changing\r\n    // //console.time('appImManager cleanup');\r\n    this.setLoaded('top', false, false);\r\n    this.setLoaded('bottom', false, false);\r\n\r\n    // cancel scroll\r\n    cancelAnimationByKey(this.scrollable.container);\r\n\r\n    // do not wait ending of previous scale animation\r\n    interruptHeavyAnimation();\r\n\r\n    if(TEST_SCROLL !== undefined) {\r\n      TEST_SCROLL = TEST_SCROLL_TIMES;\r\n    }\r\n\r\n    this.skippedMids.clear();\r\n    this.dateMessages = {};\r\n    this.bubbleGroups.cleanup();\r\n    this.unreadOut.clear();\r\n    this.needUpdate.length = 0;\r\n    this.lazyLoadQueue.clear();\r\n    this.renderNewPromises.clear();\r\n\r\n    // clear messages\r\n    if(bubblesToo) {\r\n      this.scrollable.container.textContent = '';\r\n      this.chatInner.textContent = '';\r\n      this.cleanupPlaceholders();\r\n    }\r\n\r\n    this.firstUnreadBubble = null;\r\n    this.attachedUnreadBubble = false;\r\n\r\n    this.messagesQueue.length = 0;\r\n    this.messagesQueuePromise = null;\r\n\r\n    this.getHistoryTopPromise = this.getHistoryBottomPromise = undefined;\r\n    this.fetchNewPromise = undefined;\r\n    this.getSponsoredMessagePromise = undefined;\r\n\r\n    if(this.stickyIntersector) {\r\n      this.stickyIntersector.disconnect();\r\n    }\r\n\r\n    if(this.observer) {\r\n      this.observer.disconnect();\r\n\r\n      this.unreaded.clear();\r\n      this.unreadedSeen.clear();\r\n      this.readPromise = undefined;\r\n\r\n      this.viewsMids.clear();\r\n    }\r\n\r\n    this.middlewareHelper.clean();\r\n\r\n    this.onAnimateLadder = undefined;\r\n    this.resolveLadderAnimation = undefined;\r\n    this.attachPlaceholderOnRender = undefined;\r\n    this.emptyPlaceholderBubble = undefined;\r\n    this.sponsoredMessage = undefined;\r\n    this.previousStickyDate = undefined;\r\n\r\n    this.scrollingToBubble = undefined;\r\n    // //console.timeEnd('appImManager cleanup');\r\n\r\n    this.isTopPaddingSet = false;\r\n\r\n    this.renderingMessages.clear();\r\n    this.bubblesToEject.clear();\r\n    this.bubblesToReplace.clear();\r\n\r\n    // this.reactions.clear();\r\n\r\n    if(this.isScrollingTimeout) {\r\n      clearTimeout(this.isScrollingTimeout);\r\n      this.isScrollingTimeout = 0;\r\n    }\r\n\r\n    this.container.classList.remove('has-sticky-dates');\r\n    this.scrollable.cancelMeasure();\r\n  }\r\n\r\n  private cleanupPlaceholders(bubble = this.emptyPlaceholderBubble) {\r\n    if(bubble) {\r\n      bubble.remove();\r\n\r\n      if(this.emptyPlaceholderBubble === bubble) {\r\n        this.emptyPlaceholderBubble = undefined;\r\n      }\r\n    }\r\n  }\r\n\r\n  public async setPeer(samePeer: boolean, peerId: PeerId, lastMsgId?: number, startParam?: string): Promise<{cached?: boolean, promise: Chat['setPeerPromise']}> {\r\n    const tempId = ++this.setPeerTempId;\r\n\r\n    if(!peerId) {\r\n      this.cleanup(true);\r\n      this.preloader.detach();\r\n      return null;\r\n    }\r\n\r\n    const perf = performance.now();\r\n    const log = this.log.bindPrefix('setPeer');\r\n    log.warn('start');\r\n\r\n    const middleware = () => {\r\n      return this.setPeerTempId === tempId;\r\n    };\r\n\r\n    const m = middlewarePromise(middleware, PEER_CHANGED_ERROR);\r\n\r\n    if(!samePeer) {\r\n      await m(this.chat.onChangePeer(m));\r\n    }\r\n\r\n    /* if(samePeer && this.chat.setPeerPromise) {\r\n      return {cached: true, promise: this.chat.setPeerPromise};\r\n    } */\r\n\r\n    const chatType = this.chat.type;\r\n\r\n    if(chatType === 'scheduled' || this.chat.isRestricted) {\r\n      lastMsgId = 0;\r\n    }\r\n\r\n    const historyStorage = await m(this.chat.getHistoryStorage());\r\n    const topMessage = chatType === 'pinned' ? await m(this.managers.appMessagesManager.getPinnedMessagesMaxId(peerId)) : historyStorage.maxId ?? 0;\r\n    const isTarget = lastMsgId !== undefined;\r\n\r\n    // * this one will fix topMessage for null message in history (e.g. channel comments with only 1 comment and it is a topMessage)\r\n    /* if(chatType !== 'pinned' && topMessage && !historyStorage.history.slice.includes(topMessage)) {\r\n      topMessage = 0;\r\n    } */\r\n\r\n    let followingUnread: boolean;\r\n    let readMaxId = 0, savedPosition: ReturnType<AppImManager['getChatSavedPosition']>, overrideAdditionMsgId: number;\r\n    if(!isTarget) {\r\n      if(!samePeer) {\r\n        savedPosition = this.chat.appImManager.getChatSavedPosition(this.chat);\r\n      }\r\n\r\n      if(savedPosition) {\r\n\r\n      } else if(topMessage) {\r\n        readMaxId = await m(this.managers.appMessagesManager.getReadMaxIdIfUnread(peerId, this.chat.threadId));\r\n        const dialog = await m(this.managers.appMessagesManager.getDialogOnly(peerId));\r\n        if(/* dialog.unread_count */readMaxId && !samePeer && (!dialog || dialog.unread_count !== 1)) {\r\n          const foundSlice = historyStorage.history.findSliceOffset(readMaxId);\r\n          if(foundSlice && foundSlice.slice.isEnd(SliceEnd.Bottom)) {\r\n            overrideAdditionMsgId = foundSlice.slice[foundSlice.offset - 25] || foundSlice.slice[0] || readMaxId;\r\n          }\r\n\r\n          followingUnread = !isTarget;\r\n          lastMsgId = readMaxId;\r\n        } else {\r\n          lastMsgId = topMessage;\r\n          // lastMsgID = topMessage;\r\n        }\r\n      }\r\n    }\r\n\r\n    const isJump = lastMsgId !== topMessage/*  && overrideAdditionMsgId === undefined */;\r\n\r\n    if(startParam === undefined && await m(this.chat.isStartButtonNeeded())) {\r\n      startParam = BOT_START_PARAM;\r\n    }\r\n\r\n    if(samePeer) {\r\n      const mounted = await m(this.getMountedBubble(lastMsgId));\r\n      if(mounted) {\r\n        if(isTarget) {\r\n          this.scrollToBubble(mounted.bubble, 'center');\r\n          this.highlightBubble(mounted.bubble);\r\n          this.chat.dispatchEvent('setPeer', lastMsgId, false);\r\n        } else if(topMessage && !isJump) {\r\n          // log('will scroll down', this.scroll.scrollTop, this.scroll.scrollHeight);\r\n          // scrollable.setScrollTopSilently(scrollable.scrollHeight);\r\n          this.scrollToEnd();\r\n          this.chat.dispatchEvent('setPeer', lastMsgId, true);\r\n        }\r\n\r\n        if(startParam !== undefined) {\r\n          this.chat.input.setStartParam(startParam);\r\n        }\r\n\r\n        return null;\r\n      }\r\n    } else {\r\n      if(this.peerId) { // * set new queue id if new peer (setting not from 0)\r\n        this.lazyLoadQueue.queueId = ++queueId;\r\n        this.managers.apiFileManager.setQueueId(this.chat.bubbles.lazyLoadQueue.queueId);\r\n      }\r\n\r\n      this.replyFollowHistory.length = 0;\r\n\r\n      this.passEntities = {\r\n        messageEntityBotCommand: await m(this.managers.appPeersManager.isAnyGroup(peerId)) || this.chat.isBot\r\n      };\r\n    }\r\n\r\n    if(DEBUG) {\r\n      log('setPeer peerId:', peerId, historyStorage, lastMsgId, topMessage);\r\n    }\r\n\r\n    // add last message, bc in getHistory will load < max_id\r\n    const additionMsgId = overrideAdditionMsgId ?? (isJump || chatType === 'scheduled' || this.chat.isRestricted ? 0 : topMessage);\r\n\r\n    let maxBubbleId = 0;\r\n    if(samePeer) {\r\n      const el = this.getBubbleByPoint('bottom'); // ! this may not work if being called when chat is hidden\r\n      // this.chat.log('[PM]: setCorrectIndex: get last element perf:', performance.now() - perf, el);\r\n      if(el) {\r\n        maxBubbleId = +el.dataset.mid;\r\n      }\r\n\r\n      if(maxBubbleId <= 0) {\r\n        maxBubbleId = Math.max(...Object.keys(this.bubbles).map((mid) => +mid));\r\n      }\r\n    } else {\r\n      this.isFirstLoad = true;\r\n      this.destroyResizeObserver();\r\n    }\r\n\r\n    const oldChatInner = this.chatInner;\r\n    const oldPlaceholderBubble = this.emptyPlaceholderBubble;\r\n    this.cleanup();\r\n    const chatInner = this.chatInner = document.createElement('div');\r\n    if(samePeer) {\r\n      chatInner.className = oldChatInner.className;\r\n      chatInner.classList.remove('disable-hover', 'is-scrolling');\r\n    } else {\r\n      chatInner.classList.add('bubbles-inner');\r\n    }\r\n\r\n    this.lazyLoadQueue.lock();\r\n\r\n    // const haveToScrollToBubble = (topMessage && (isJump || samePeer)) || isTarget;\r\n    const haveToScrollToBubble = samePeer || (topMessage && isJump) || isTarget;\r\n    const fromUp = maxBubbleId > 0 && (!lastMsgId || maxBubbleId < lastMsgId || lastMsgId < 0);\r\n    const scrollFromDown = !fromUp && samePeer;\r\n    const scrollFromUp = !scrollFromDown && fromUp/*  && (samePeer || forwardingUnread) */;\r\n    this.willScrollOnLoad = scrollFromDown || scrollFromUp;\r\n\r\n    this.setPeerOptions = {\r\n      lastMsgId,\r\n      topMessage\r\n    };\r\n\r\n    let result: Awaited<ReturnType<ChatBubbles['getHistory']>>;\r\n    if(!savedPosition) {\r\n      result = await m(this.getHistory1(lastMsgId, true, isJump, additionMsgId));\r\n    } else {\r\n      result = {\r\n        promise: getHeavyAnimationPromise().then(() => {\r\n          return this.performHistoryResult({history: savedPosition.mids}, true);\r\n        }) as any,\r\n        cached: true,\r\n        waitPromise: Promise.resolve()\r\n      };\r\n    }\r\n\r\n    this.setPeerCached = result.cached;\r\n\r\n    log.warn('got history');// warning\r\n\r\n    const {promise, cached} = result;\r\n\r\n    if(!cached && !samePeer) {\r\n      await m(this.chat.finishPeerChange(isTarget, isJump, lastMsgId, startParam));\r\n      this.scrollable.container.textContent = '';\r\n      // oldContainer.textContent = '';\r\n      // oldChatInner.remove();\r\n      this.preloader.attach(this.container);\r\n    }\r\n\r\n    /* this.ladderDeferred && this.ladderDeferred.resolve();\r\n    this.ladderDeferred = deferredPromise<void>(); */\r\n\r\n    animationIntersector.lockGroup(CHAT_ANIMATION_GROUP);\r\n    const setPeerPromise = m(promise).then(async() => {\r\n      log.warn('promise fulfilled');\r\n\r\n      const mountedByLastMsgId = haveToScrollToBubble ? await m(lastMsgId ? this.getMountedBubble(lastMsgId) : {bubble: this.getLastBubble()}) : undefined;\r\n      if(cached && !samePeer) {\r\n        log.warn('finishing peer change');\r\n        await m(this.chat.finishPeerChange(isTarget, isJump, lastMsgId, startParam)); // * \r\n        log.warn('finished peer change');\r\n      }\r\n\r\n      this.preloader.detach();\r\n\r\n      if(this.resolveLadderAnimation) {\r\n        this.resolveLadderAnimation();\r\n        this.resolveLadderAnimation = undefined;\r\n      }\r\n\r\n      this.setPeerCached = undefined;\r\n\r\n      // this.ladderDeferred.resolve();\r\n\r\n      const scrollable = this.scrollable;\r\n      scrollable.lastScrollDirection = 0;\r\n      scrollable.lastScrollPosition = 0;\r\n      replaceContent(scrollable.container, chatInner);\r\n      // this.chat.topbar.container.nextElementSibling.replaceWith(container);\r\n\r\n      if(oldPlaceholderBubble) {\r\n        this.cleanupPlaceholders(oldPlaceholderBubble);\r\n      }\r\n\r\n      if(this.attachPlaceholderOnRender) {\r\n        this.attachPlaceholderOnRender();\r\n      }\r\n\r\n      if(!isTarget && this.chat.type === 'chat' && this.chat.topbar.pinnedMessage) {\r\n        this.chat.topbar.pinnedMessage.setCorrectIndex(0);\r\n      }\r\n\r\n      this.container.classList.toggle('has-groups', !!Object.keys(this.dateMessages).length);\r\n\r\n      log.warn('mounted chat', this.chatInner === chatInner, this.chatInner.parentElement, performance.now() - perf);\r\n\r\n      animationIntersector.unlockGroup(CHAT_ANIMATION_GROUP);\r\n      animationIntersector.checkAnimations(false, CHAT_ANIMATION_GROUP/* , true */);\r\n\r\n      // fastRaf(() => {\r\n      this.lazyLoadQueue.unlock();\r\n      // });\r\n\r\n      // if(dialog && lastMsgID && lastMsgID !== topMessage && (this.bubbles[lastMsgID] || this.firstUnreadBubble)) {\r\n      if(savedPosition) {\r\n        scrollable.setScrollTopSilently(savedPosition.top);\r\n        /* const mountedByLastMsgId = this.getMountedBubble(lastMsgId);\r\n        let bubble: HTMLElement = mountedByLastMsgId?.bubble;\r\n        if(!bubble?.parentElement) {\r\n          bubble = this.findNextMountedBubbleByMsgId(lastMsgId);\r\n        }\r\n\r\n        if(bubble) {\r\n          const top = bubble.getBoundingClientRect().top;\r\n          const distance = savedPosition.top - top;\r\n          scrollable.scrollTop += distance;\r\n        } */\r\n      } else if(haveToScrollToBubble) {\r\n        let unsetPadding: () => void;\r\n        if(scrollFromDown) {\r\n          scrollable.setScrollTopSilently(99999);\r\n        } else if(scrollFromUp) {\r\n          const set = this.setTopPadding();\r\n          if(set.isPaddingNeeded) {\r\n            unsetPadding = set.unsetPadding;\r\n          }\r\n\r\n          scrollable.setScrollTopSilently(0);\r\n        }\r\n\r\n        // const mountedByLastMsgId = lastMsgId ? this.getMountedBubble(lastMsgId) : {bubble: this.getLastBubble()};\r\n        let bubble: HTMLElement = (followingUnread && this.firstUnreadBubble) || mountedByLastMsgId?.bubble;\r\n        if(!bubble?.parentElement) {\r\n          bubble = this.findNextMountedBubbleByMsgId(lastMsgId, false) || this.findNextMountedBubbleByMsgId(lastMsgId, true);\r\n        }\r\n\r\n        let promise: Promise<void>;\r\n        // ! sometimes there can be no bubble\r\n        if(bubble) {\r\n          const lastBubble = this.getLastBubble();\r\n          const position: ScrollLogicalPosition = followingUnread ? 'start' : (!isJump && !isTarget && lastBubble === bubble ? 'end' : 'center');\r\n\r\n          if(position === 'end' && lastBubble === bubble && samePeer) {\r\n            promise = this.scrollToEnd();\r\n          } else {\r\n            promise = this.scrollToBubble(bubble, position, !samePeer ? FocusDirection.Static : undefined);\r\n          }\r\n\r\n          if(!followingUnread && isTarget) {\r\n            this.highlightBubble(bubble);\r\n          }\r\n        }\r\n\r\n        if(unsetPadding) {\r\n          (promise || Promise.resolve()).then(() => {\r\n            unsetPadding();\r\n          });\r\n        }\r\n      } else {\r\n        scrollable.setScrollTopSilently(99999);\r\n      }\r\n\r\n      // if(!cached) {\r\n      this.onRenderScrollSet();\r\n      // }\r\n\r\n      this.onScroll();\r\n\r\n      const afterSetPromise = Promise.all([setPeerPromise, getHeavyAnimationPromise()]);\r\n      afterSetPromise.then(() => { // check whether list isn't full\r\n        scrollable.checkForTriggers();\r\n\r\n        // if(cached) {\r\n        // this.onRenderScrollSet();\r\n        // }\r\n      });\r\n\r\n      this.chat.dispatchEvent('setPeer', lastMsgId, !isJump);\r\n\r\n      Promise.all([\r\n        this.setFetchReactionsInterval(afterSetPromise),\r\n        this.setFetchHistoryInterval({\r\n          afterSetPromise,\r\n          lastMsgId,\r\n          samePeer,\r\n          savedPosition,\r\n          topMessage\r\n        })\r\n      ]).then(() => {\r\n        log('scrolledAllDown:', scrollable.loadedAll.bottom);\r\n        // if(!this.unreaded.length && dialog) { // lol\r\n        if(scrollable.loadedAll.bottom && topMessage && !this.unreaded.size) { // lol\r\n          this.onScrolledAllDown();\r\n        }\r\n      });\r\n\r\n      if(chatType === 'chat') {\r\n        const dialog = await m(this.managers.appMessagesManager.getDialogOnly(peerId));\r\n        if(dialog?.pFlags.unread_mark) {\r\n          this.managers.appMessagesManager.markDialogUnread(peerId, true);\r\n        }\r\n      }\r\n\r\n      // this.chatInner.classList.remove('disable-hover', 'is-scrolling'); // warning, performance!\r\n    }).catch((err) => {\r\n      log.error('getHistory promise error:', err);\r\n      if(!middleware()) {\r\n        this.preloader.detach();\r\n      }\r\n\r\n      throw err;\r\n    });\r\n\r\n    return {cached, promise: setPeerPromise};\r\n  }\r\n\r\n  private async setFetchReactionsInterval(afterSetPromise: Promise<any>) {\r\n    const middleware = this.getMiddleware();\r\n    const needReactionsInterval = this.chat.isChannel;\r\n    if(needReactionsInterval) {\r\n      const fetchReactions = async() => {\r\n        if(!middleware()) return;\r\n\r\n        const mids: number[] = [];\r\n        for(const mid in this.bubbles) {\r\n          let message = await this.chat.getMessage(+mid);\r\n          if(message?._ !== 'message') {\r\n            continue;\r\n          }\r\n\r\n          message = await this.managers.appMessagesManager.getGroupsFirstMessage(message);\r\n          mids.push(message.mid);\r\n        }\r\n\r\n        const promise = mids.length ? this.managers.appReactionsManager.getMessagesReactions(this.peerId, mids) : Promise.resolve();\r\n        promise.then(() => {\r\n          setTimeout(fetchReactions, 10e3);\r\n        });\r\n      };\r\n\r\n      Promise.all([afterSetPromise, getHeavyAnimationPromise(), pause(500)]).then(() => {\r\n        fetchReactions();\r\n      });\r\n    }\r\n  }\r\n\r\n  private async setFetchHistoryInterval({\r\n    lastMsgId,\r\n    topMessage,\r\n    afterSetPromise,\r\n    savedPosition,\r\n    samePeer\r\n  }: {\r\n    lastMsgId: number,\r\n    topMessage: number,\r\n    afterSetPromise: Promise<any>,\r\n    savedPosition: ChatSavedPosition,\r\n    samePeer: boolean\r\n  }) {\r\n    const middleware = this.getMiddleware();\r\n    const peerId = this.peerId;\r\n\r\n    const needFetchInterval = await this.managers.appMessagesManager.isFetchIntervalNeeded(peerId);\r\n    const needFetchNew = savedPosition || needFetchInterval;\r\n    if(!needFetchNew) {\r\n      return;\r\n    }\r\n\r\n    await afterSetPromise;\r\n    if(!middleware()) {\r\n      return;\r\n    }\r\n\r\n    this.setLoaded('bottom', false);\r\n    this.scrollable.checkForTriggers();\r\n\r\n    if(!needFetchInterval) {\r\n      return;\r\n    }\r\n\r\n    const f = () => {\r\n      this.fetchNewPromise = new Promise<void>(async(resolve) => {\r\n        if(!middleware() || !(await this.managers.appMessagesManager.isFetchIntervalNeeded(peerId))) {\r\n          resolve();\r\n          return;\r\n        }\r\n\r\n        this.managers.appMessagesManager.getNewHistory(peerId, this.chat.threadId).then((result) => {\r\n          if(!middleware() || !result) {\r\n            resolve();\r\n            return;\r\n          }\r\n\r\n          const {isBottomEnd} = result;\r\n          if(this.scrollable.loadedAll.bottom && this.scrollable.loadedAll.bottom !== isBottomEnd) {\r\n            this.setLoaded('bottom', isBottomEnd);\r\n            this.onScroll();\r\n          }\r\n\r\n          setTimeout(f, 30e3);\r\n          resolve();\r\n        });\r\n      }).finally(() => {\r\n        this.fetchNewPromise = undefined;\r\n      });\r\n    };\r\n\r\n    if(samePeer) {\r\n      setTimeout(f, 30e3);\r\n    } else {\r\n      f();\r\n    }\r\n  }\r\n\r\n  public async onScrolledAllDown() {\r\n    if(this.chat.type === 'chat' || this.chat.type === 'discussion') {\r\n      const historyMaxId = await this.chat.getHistoryMaxId();\r\n      this.managers.appMessagesManager.readHistory(this.peerId, historyMaxId, this.chat.threadId, true);\r\n    }\r\n  }\r\n\r\n  public async finishPeerChange() {\r\n    const [isChannel, canWrite, isAnyGroup] = await Promise.all([\r\n      this.chat.isChannel,\r\n      this.chat.canSend(),\r\n      this.chat.isAnyGroup\r\n    ]);\r\n\r\n    return () => {\r\n      this.chatInner.classList.toggle('has-rights', canWrite);\r\n      this.container.classList.toggle('is-chat-input-hidden', !canWrite);\r\n\r\n      this.chatInner.classList.toggle('is-chat', isAnyGroup);\r\n      this.chatInner.classList.toggle('is-channel', isChannel);\r\n\r\n      this.createResizeObserver();\r\n    };\r\n  }\r\n\r\n  public renderMessagesQueue(options: ChatBubbles['messagesQueue'][0]) {\r\n    this.messagesQueue.push(options);\r\n    return this.setMessagesQueuePromise();\r\n  }\r\n\r\n  public setMessagesQueuePromise() {\r\n    if(!this.messagesQueue.length) return Promise.resolve();\r\n\r\n    if(this.messagesQueuePromise) {\r\n      return this.messagesQueuePromise;\r\n    }\r\n\r\n    const middleware = this.getMiddleware();\r\n    const log = this.log.bindPrefix('queue');\r\n    const possibleError = PEER_CHANGED_ERROR;\r\n    const m = middlewarePromise(middleware, possibleError);\r\n\r\n    const processQueue = async(): Promise<void> => {\r\n      log('start');\r\n\r\n      // if(!this.chat.setPeerPromise) {\r\n      //   await pause(10000000);\r\n      // }\r\n\r\n      const renderQueue = this.messagesQueue.slice();\r\n      this.messagesQueue.length = 0;\r\n\r\n      const renderQueuePromises = renderQueue.map((promise) => {\r\n        const perf = performance.now();\r\n        promise.then((details) => {\r\n          log('render message time', performance.now() - perf, details);\r\n        });\r\n\r\n        return promise;\r\n      });\r\n\r\n      let loadQueue = await m(Promise.all(renderQueuePromises));\r\n      const filterQueue = (queue: typeof loadQueue) => {\r\n        return queue.filter((details) => {\r\n          // message can be deleted during rendering\r\n          return details && this.bubbles[details.bubble.dataset.mid] === details.bubble;\r\n        });\r\n      };\r\n\r\n      loadQueue = filterQueue(loadQueue);\r\n\r\n      log('messages rendered');\r\n\r\n      const reverse = loadQueue[0]?.reverse;\r\n\r\n      const {groups, avatarPromises} = this.groupBubbles(loadQueue.filter((details) => details.updatePosition));\r\n\r\n      // if(groups.length > 2 && loadQueue.length === 1) {\r\n      //   debugger;\r\n      // }\r\n\r\n      const promises = loadQueue.reduce((acc, details) => {\r\n        const perf = performance.now();\r\n\r\n        const promises = details.promises.slice();\r\n        const timePromises = promises.map(async(promise) => (await promise, performance.now() - perf));\r\n        Promise.all(timePromises).then((times) => {\r\n          log.groupCollapsed('media message time', performance.now() - perf, details, times);\r\n          times.forEach((time, idx) => {\r\n            log('media message time', time, idx, promises[idx]);\r\n          });\r\n          log.groupEnd();\r\n        });\r\n\r\n        // if(details.updatePosition) {\r\n        //   if(res) {\r\n        //     groups.add(res.group);\r\n        //     if(details.needAvatar) {\r\n        //       details.promises.push(res.group.createAvatar(details.message));\r\n        //     }\r\n        //   }\r\n        // }\r\n\r\n        acc.push(...details.promises);\r\n        return acc;\r\n      }, [] as Promise<any>[]);\r\n\r\n      promises.push(...avatarPromises);\r\n      // promises.push(pause(200));\r\n\r\n      // *    ,     reply  - ,    \r\n      // *     -     ,       \r\n      // promises.push(getHeavyAnimationPromise());\r\n\r\n      log('media promises to call', promises, loadQueue, this.isHeavyAnimationInProgress);\r\n      await m(Promise.all([...promises, this.setUnreadDelimiter()])); //    \r\n      await m(fastRafPromise()); // have to be the last\r\n      log('media promises end');\r\n\r\n      loadQueue = filterQueue(loadQueue);\r\n\r\n      const {restoreScroll, scrollSaver} = this.prepareToSaveScroll(reverse);\r\n      // if(this.messagesQueueOnRender) {\r\n      // this.messagesQueueOnRender();\r\n      // }\r\n\r\n      if(this.messagesQueueOnRenderAdditional) {\r\n        this.messagesQueueOnRenderAdditional();\r\n      }\r\n\r\n      this.ejectBubbles();\r\n      for(const [bubble, oldBubble] of this.bubblesToReplace) {\r\n        if(scrollSaver) {\r\n          scrollSaver.replaceSaved(oldBubble, bubble);\r\n        }\r\n\r\n        if(!loadQueue.find((details) => details.bubble === bubble)) {\r\n          continue;\r\n        }\r\n\r\n        const item = this.bubbleGroups.getItemByBubble(bubble);\r\n        item.mounted = false;\r\n        if(!groups.includes(item.group)) {\r\n          groups.push(item.group);\r\n        }\r\n\r\n        this.bubblesToReplace.delete(bubble);\r\n      }\r\n\r\n      if(this.chat.selection.isSelecting) {\r\n        loadQueue.forEach(({bubble}) => {\r\n          this.chat.selection.toggleElementCheckbox(bubble, true);\r\n        });\r\n      }\r\n\r\n      loadQueue.forEach(({message, bubble, updatePosition}) => {\r\n        if(message.pFlags.local && updatePosition) {\r\n          this.chatInner[(message as Message.message).pFlags.sponsored ? 'append' : 'prepend'](bubble);\r\n          return;\r\n        }\r\n      });\r\n\r\n      this.bubbleGroups.mountUnmountGroups(groups);\r\n      // this.bubbleGroups.findIncorrentPositions();\r\n\r\n      if(this.updatePlaceholderPosition) {\r\n        this.updatePlaceholderPosition();\r\n      }\r\n\r\n      if(restoreScroll) {\r\n        restoreScroll();\r\n      }\r\n\r\n      // this.setStickyDateManually();\r\n\r\n      if(this.messagesQueue.length) {\r\n        log('have new messages to render');\r\n        return processQueue();\r\n      } else {\r\n        log('end');\r\n      }\r\n    };\r\n\r\n    log('setting pause');\r\n    const promise = this.messagesQueuePromise = m(pause(0)).then(processQueue).finally(() => {\r\n      if(this.messagesQueuePromise === promise) {\r\n        this.messagesQueuePromise = null;\r\n      }\r\n    });\r\n\r\n    return promise;\r\n  }\r\n\r\n  private ejectBubbles() {\r\n    for(const bubble of this.bubblesToEject) {\r\n      bubble.remove();\r\n      // this.bubbleGroups.removeAndUnmountBubble(bubble);\r\n    }\r\n\r\n    this.bubblesToEject.clear();\r\n  }\r\n\r\n  public groupBubbles(items: Array<{\r\n    // Awaited<ReturnType<ChatBubbles['safeRenderMessage']>> &\r\n    bubble: HTMLElement,\r\n    message: Message.message | Message.messageService\r\n  }/*  & {\r\n    unmountIfFound?: boolean\r\n  } */>) {\r\n    let modifiedGroups: typeof groups;\r\n\r\n    if(this.chat.type === 'scheduled') {\r\n      modifiedGroups = new Set();\r\n      items.forEach(({bubble, message}) => {\r\n        const item = this.bubbleGroups.getItemByBubble(bubble);\r\n        const group = item?.group;\r\n        if(group && item.message.date !== message.date) {\r\n          this.bubbleGroups.removeItem(item);\r\n          modifiedGroups.add(group);\r\n        }\r\n      });\r\n    }\r\n\r\n    items.forEach(({bubble, message}) => {\r\n      this.bubbleGroups.prepareForGrouping(bubble, message);\r\n    });\r\n\r\n    const groups = this.bubbleGroups.groupUngrouped();\r\n\r\n    const avatarPromises = Array.from(groups).map((group) => {\r\n      if(group.avatar) return;\r\n      const firstItem = group.firstItem;\r\n      if(firstItem && this.chat.isAvatarNeeded(firstItem.message)) {\r\n        return group.createAvatar(firstItem.message);\r\n      }\r\n    }).filter(Boolean);\r\n\r\n    if(modifiedGroups) {\r\n      for(const group of modifiedGroups) {\r\n        groups.add(group);\r\n      }\r\n    }\r\n\r\n    return {\r\n      groups: [...groups],\r\n      avatarPromises\r\n    };\r\n  }\r\n\r\n  public getMiddleware(additionalCallback?: () => boolean) {\r\n    return this.middlewareHelper.get(additionalCallback);\r\n  }\r\n\r\n  private async safeRenderMessage(\r\n    message: Message.message | Message.messageService,\r\n    reverse?: boolean,\r\n    bubble?: HTMLElement,\r\n    updatePosition = true,\r\n    processResult?: (result: ReturnType<ChatBubbles['renderMessage']>, bubble: HTMLElement) => typeof result\r\n  ) {\r\n    if(!message || this.renderingMessages.has(message.mid) || (this.bubbles[message.mid] && !bubble)) {\r\n      return;\r\n    }\r\n\r\n    const middlewareHelper = this.getMiddleware().create();\r\n    const middleware = middlewareHelper.get();\r\n\r\n    let result: Awaited<ReturnType<ChatBubbles['renderMessage']>> & {updatePosition: typeof updatePosition};\r\n    try {\r\n      this.renderingMessages.add(message.mid);\r\n\r\n      // const groupedId = (message as Message.message).grouped_id;\r\n      const newBubble = document.createElement('div');\r\n      newBubble.middlewareHelper = middlewareHelper;\r\n      newBubble.dataset.mid = '' + message.mid;\r\n      newBubble.dataset.peerId = '' + message.peerId;\r\n      newBubble.dataset.timestamp = '' + message.date;\r\n\r\n      // const bubbleNew: Bubble = this.bubblesNew[message.mid] ??= {\r\n      //   bubble: newBubble,\r\n      //   mids: new Set(),\r\n      //   groupedId\r\n      // };\r\n\r\n      // bubbleNew.mids.add(message.mid);\r\n\r\n      if(bubble) {\r\n        bubble.middlewareHelper.destroy();\r\n        this.skippedMids.delete(message.mid);\r\n\r\n        this.bubblesToEject.add(bubble);\r\n        this.bubblesToReplace.delete(bubble);\r\n        this.bubblesToReplace.set(newBubble, bubble);\r\n        this.bubbleGroups.changeBubbleByBubble(bubble, newBubble);\r\n      }\r\n\r\n      bubble = this.bubbles[message.mid] = newBubble;\r\n      let originalPromise = this.renderMessage(message, reverse, bubble, middleware);\r\n      if(processResult) {\r\n        originalPromise = processResult(originalPromise, bubble);\r\n      }\r\n\r\n      const promise = originalPromise.then((r) => ((r && middleware() ? {...r, updatePosition} : undefined) as typeof result));\r\n\r\n      this.renderMessagesQueue(promise.catch(() => undefined));\r\n\r\n      result = await promise;\r\n      if(!middleware()) {\r\n        return;\r\n      }\r\n\r\n      if(!result) {\r\n        this.skippedMids.add(+message.mid);\r\n      }\r\n    } catch(err) {\r\n      this.log.error('renderMessage error:', err);\r\n    }\r\n\r\n    if(!middleware()) {\r\n      return;\r\n    }\r\n\r\n    this.renderingMessages.delete(message.mid);\r\n    return result;\r\n  }\r\n\r\n  // reverse means top\r\n  private async renderMessage(\r\n    message: Message.message | Message.messageService,\r\n    reverse = false,\r\n    bubble: HTMLElement,\r\n    middleware: Middleware\r\n  ) {\r\n    // if(DEBUG) {\r\n    //   this.log('message to render:', message);\r\n    // }\r\n\r\n    // if(!bubble && this.bubbles[message.mid]) {\r\n    //   return;\r\n    // }\r\n\r\n    // await pause(1000);\r\n\r\n    const isMessage = message._ === 'message';\r\n    const groupedId = isMessage && message.grouped_id;\r\n    let albumMids: number[], reactionsMessage: Message.message;\r\n    const albumMessages = groupedId ? await this.managers.appMessagesManager.getMessagesByAlbum(groupedId) : undefined;\r\n\r\n    const albumMustBeRenderedFull = this.chat.type !== 'pinned';\r\n\r\n    if(groupedId && albumMustBeRenderedFull) { // will render only last album's message\r\n      albumMids = albumMessages.map((message) => message.mid);\r\n      const mainMid = getMainMidForGrouped(albumMids);\r\n      if(message.mid !== mainMid) {\r\n        return;\r\n      }\r\n    }\r\n\r\n    if(isMessage) {\r\n      reactionsMessage = groupedId ? albumMessages[0] : message;\r\n    }\r\n\r\n    // * can't use 'message.pFlags.out' here because this check will be used to define side of message (left-right)\r\n    const our = this.chat.isOurMessage(message);\r\n\r\n    const messageDiv = document.createElement('div');\r\n    messageDiv.classList.add('message', 'spoilers-container');\r\n\r\n    const contentWrapper = document.createElement('div');\r\n    contentWrapper.classList.add('bubble-content-wrapper');\r\n\r\n    const bubbleContainer = document.createElement('div');\r\n    bubbleContainer.classList.add('bubble-content');\r\n\r\n    bubble.classList.add('bubble');\r\n    contentWrapper.append(bubbleContainer);\r\n    bubble.append(contentWrapper);\r\n\r\n    const isInUnread = !our && !message.pFlags.out && (message.pFlags.unread ||\r\n      isMentionUnread(message)/*  ||\r\n      (this.historyStorage.readMaxId !== undefined && this.historyStorage.readMaxId < message.mid) */);\r\n    if(isInUnread && this.observer) {\r\n      // this.log('not our message', message, message.pFlags.unread);\r\n      this.observer.observe(bubble, this.unreadedObserverCallback);\r\n      this.unreaded.set(bubble, message.mid);\r\n    }\r\n\r\n    const loadPromises: Promise<any>[] = [];\r\n    const ret = {\r\n      bubble,\r\n      promises: loadPromises,\r\n      message,\r\n      reverse\r\n    };\r\n\r\n    if(message._ === 'messageService' && (!message.action || !SERVICE_AS_REGULAR.has(message.action._))) {\r\n      const action = message.action;\r\n      if(action) {\r\n        const _ = action._;\r\n        if(IGNORE_ACTIONS.has(_) || (langPack.hasOwnProperty(_) && !langPack[_])) {\r\n          return;\r\n        }\r\n      }\r\n\r\n      bubble.className = 'bubble service';\r\n\r\n      bubbleContainer.innerHTML = '';\r\n      const s = document.createElement('div');\r\n      s.classList.add('service-msg');\r\n      if(action) {\r\n        let promise: Promise<any>;\r\n        if(action._ === 'messageActionChannelMigrateFrom') {\r\n          const peerTitle = new PeerTitle();\r\n          promise = peerTitle.update({peerId: action.chat_id.toPeerId(true)});\r\n          s.append(i18n('ChatMigration.From', [peerTitle.element]));\r\n        } else if(action._ === 'messageActionChatMigrateTo') {\r\n          const peerTitle = new PeerTitle();\r\n          promise = peerTitle.update({peerId: action.channel_id.toPeerId(true)});\r\n          s.append(i18n('ChatMigration.To', [peerTitle.element]));\r\n        } else {\r\n          s.append(await wrapMessageActionTextNew(message));\r\n        }\r\n      }\r\n      bubbleContainer.append(s);\r\n\r\n      if(message.pFlags.is_single) { // * Ignore 'Discussion started'\r\n        bubble.classList.add('is-group-last');\r\n      }\r\n\r\n      return ret;\r\n    }\r\n\r\n    let messageMedia: MessageMedia = isMessage && message.media;\r\n\r\n    let messageMessage: string, totalEntities: MessageEntity[];\r\n    if(isMessage) {\r\n      if((messageMedia as MessageMedia.messageMediaDocument)?.document &&\r\n        !['video', 'gif'].includes(((messageMedia as MessageMedia.messageMediaDocument).document as MyDocument).type)) {\r\n        // * just filter these cases for documents caption\r\n      } else if(groupedId && albumMustBeRenderedFull) {\r\n        const t = getAlbumText(albumMessages);\r\n        messageMessage = t.message;\r\n        // totalEntities = t.entities;\r\n        totalEntities = t.totalEntities;\r\n      } else if(((messageMedia as MessageMedia.messageMediaDocument)?.document as MyDocument)?.type !== 'sticker') {\r\n        messageMessage = message.message;\r\n        // totalEntities = message.entities;\r\n        totalEntities = message.totalEntities;\r\n      }\r\n    } else {\r\n      if(message.action._ === 'messageActionPhoneCall') {\r\n        messageMedia = {\r\n          _: 'messageMediaCall',\r\n          action: message.action\r\n        };\r\n      }\r\n    }\r\n\r\n    let bigEmojis = 0, customEmojiSize: MediaSize;\r\n    if(totalEntities && !messageMedia) {\r\n      const emojiEntities = totalEntities.filter((e) => e._ === 'messageEntityEmoji'/*  || e._ === 'messageEntityCustomEmoji' */);\r\n      const strLength = messageMessage.replace(/\\s/g, '').length;\r\n      const emojiStrLength = emojiEntities.reduce((acc, curr) => acc + curr.length, 0);\r\n\r\n      if(emojiStrLength === strLength /* && emojiEntities.length <= 3 *//*  && totalEntities.length === emojiEntities.length */) {\r\n        bigEmojis = Math.min(4, emojiEntities.length);\r\n\r\n        customEmojiSize = mediaSizes.active.customEmoji;\r\n        const sizes: {[size: number]: number} = {\r\n          1: 96,\r\n          2: 64,\r\n          3: 52,\r\n          4: 36\r\n        };\r\n\r\n        const size = sizes[bigEmojis];\r\n        if(size) {\r\n          customEmojiSize = makeMediaSize(size, size);\r\n          bubble.style.setProperty('--emoji-size', size + 'px');\r\n        }\r\n      }\r\n    }\r\n\r\n    const richText = wrapRichText(messageMessage, {\r\n      entities: totalEntities,\r\n      passEntities: this.passEntities,\r\n      loadPromises,\r\n      lazyLoadQueue: this.lazyLoadQueue,\r\n      customEmojiSize,\r\n      middleware\r\n    });\r\n\r\n    let canHaveTail = true;\r\n    let isStandaloneMedia = false;\r\n    let needToSetHTML = true;\r\n    if(bigEmojis) {\r\n      if(rootScope.settings.emoji.big) {\r\n        const sticker = bigEmojis === 1 &&\r\n          !totalEntities.find((entity) => entity._ === 'messageEntityCustomEmoji') &&\r\n          await this.managers.appStickersManager.getAnimatedEmojiSticker(messageMessage);\r\n        if(bigEmojis === 1 && !messageMedia && sticker) {\r\n          messageMedia = {\r\n            _: 'messageMediaDocument',\r\n            document: sticker\r\n          };\r\n        } else {\r\n          const attachmentDiv = document.createElement('div');\r\n          attachmentDiv.classList.add('attachment', 'spoilers-container');\r\n\r\n          setInnerHTML(attachmentDiv, richText);\r\n\r\n          bubbleContainer.append(attachmentDiv);\r\n        }\r\n\r\n        bubble.classList.add('is-message-empty', 'emoji-big');\r\n        isStandaloneMedia = true;\r\n        canHaveTail = false;\r\n        needToSetHTML = false;\r\n      }\r\n\r\n      bubble.classList.add('can-have-big-emoji');\r\n    }\r\n\r\n    if(needToSetHTML) {\r\n      setInnerHTML(messageDiv, richText);\r\n    }\r\n\r\n    const timeSpan = MessageRender.setTime({\r\n      chatType: this.chat.type,\r\n      message,\r\n      reactionsMessage\r\n    });\r\n    messageDiv.append(timeSpan);\r\n    bubbleContainer.prepend(messageDiv);\r\n    // bubble.prepend(timeSpan, messageDiv); // that's bad\r\n\r\n    if(isMessage && message.views) {\r\n      bubble.classList.add('channel-post');\r\n\r\n      if(!message.fwd_from?.saved_from_msg_id && this.chat.type !== 'pinned') {\r\n        const forward = document.createElement('div');\r\n        forward.classList.add('bubble-beside-button', 'forward', 'tgico-forward_filled');\r\n        bubbleContainer.prepend(forward);\r\n        bubble.classList.add('with-beside-button');\r\n      }\r\n\r\n      if(!message.pFlags.is_outgoing && this.observer) {\r\n        this.observer.observe(bubble, this.viewsObserverCallback);\r\n      }\r\n    }\r\n\r\n    const replyMarkup = isMessage && message.reply_markup;\r\n    if(replyMarkup && replyMarkup._ === 'replyInlineMarkup' && replyMarkup.rows && replyMarkup.rows.length) {\r\n      const rows = replyMarkup.rows;\r\n\r\n      const containerDiv = document.createElement('div');\r\n      containerDiv.classList.add('reply-markup');\r\n      rows.forEach((row) => {\r\n        const buttons = row.buttons;\r\n        if(!buttons || !buttons.length) return;\r\n\r\n        const rowDiv = document.createElement('div');\r\n        rowDiv.classList.add('reply-markup-row');\r\n\r\n        buttons.forEach((button) => {\r\n          let text: DocumentFragment | HTMLElement | string = wrapRichText(button.text, {noLinks: true, noLinebreaks: true});\r\n\r\n          let buttonEl: HTMLButtonElement | HTMLAnchorElement;\r\n\r\n          switch(button._) {\r\n            case 'keyboardButtonUrl': {\r\n              const r = wrapRichText(' ', {\r\n                entities: [{\r\n                  _: 'messageEntityTextUrl',\r\n                  length: 1,\r\n                  offset: 0,\r\n                  url: button.url\r\n                }]\r\n              });\r\n\r\n              buttonEl = htmlToDocumentFragment(r).firstElementChild as HTMLAnchorElement;\r\n              buttonEl.classList.add('is-link');\r\n\r\n              break;\r\n            }\r\n\r\n            case 'keyboardButtonSwitchInline': {\r\n              buttonEl = document.createElement('button');\r\n              buttonEl.classList.add('is-switch-inline');\r\n              attachClickEvent(buttonEl, (e) => {\r\n                cancelEvent(e);\r\n\r\n                const botId = message.viaBotId || message.fromId;\r\n                let promise: Promise<PeerId>;\r\n                if(button.pFlags.same_peer) promise = Promise.resolve(this.peerId);\r\n                else promise = this.managers.appInlineBotsManager.checkSwitchReturn(botId).then((peerId) => {\r\n                  if(peerId) {\r\n                    return peerId;\r\n                  }\r\n\r\n                  return new Promise<PeerId>((resolve, reject) => {\r\n                    const popup = new PopupForward({\r\n                      [this.peerId]: []\r\n                    }, (peerId) => {\r\n                      resolve(peerId);\r\n                    }, true);\r\n\r\n                    popup.addEventListener('close', () => {\r\n                      reject();\r\n                    });\r\n                  });\r\n                });\r\n\r\n                promise.then((peerId) => {\r\n                  const threadId = this.peerId === peerId ? this.chat.threadId : undefined;\r\n                  this.chat.appImManager.setInnerPeer({peerId});\r\n                  this.managers.appInlineBotsManager.switchInlineQuery(peerId, threadId, botId, button.query);\r\n                });\r\n              });\r\n              break;\r\n            }\r\n\r\n            case 'keyboardButtonBuy': {\r\n              buttonEl = document.createElement('button');\r\n              buttonEl.classList.add('is-buy');\r\n\r\n              if(messageMedia?._ === 'messageMediaInvoice') {\r\n                if(messageMedia.receipt_msg_id) {\r\n                  text = i18n('Message.ReplyActionButtonShowReceipt');\r\n                }\r\n              }\r\n\r\n              break;\r\n            }\r\n\r\n            default: {\r\n              buttonEl = document.createElement('button');\r\n              break;\r\n            }\r\n          }\r\n\r\n          buttonEl.classList.add('reply-markup-button', 'rp', 'tgico');\r\n          if(typeof(text) === 'string') {\r\n            buttonEl.insertAdjacentHTML('beforeend', text);\r\n          } else {\r\n            buttonEl.append(text);\r\n          }\r\n\r\n          ripple(buttonEl);\r\n\r\n          rowDiv.append(buttonEl);\r\n        });\r\n\r\n        containerDiv.append(rowDiv);\r\n      });\r\n\r\n      attachClickEvent(containerDiv, (e) => {\r\n        let target = e.target as HTMLElement;\r\n\r\n        if(!target.classList.contains('reply-markup-button')) target = findUpClassName(target, 'reply-markup-button');\r\n        if(\r\n          !target ||\r\n          target.classList.contains('is-link') ||\r\n          target.classList.contains('is-switch-inline') ||\r\n          target.classList.contains('is-buy')\r\n        ) return;\r\n\r\n        cancelEvent(e);\r\n\r\n        const column = whichChild(target);\r\n        const row = rows[whichChild(target.parentElement)];\r\n\r\n        if(!row.buttons || !row.buttons[column]) {\r\n          this.log.warn('no such button', row, column, message);\r\n          return;\r\n        }\r\n\r\n        const button = row.buttons[column];\r\n        this.managers.appInlineBotsManager.callbackButtonClick(this.peerId, message.mid, button).then((callbackAnswer) => {\r\n          if(typeof callbackAnswer.message === 'string' && callbackAnswer.message.length) {\r\n            toast(wrapRichText(callbackAnswer.message, {noLinks: true, noLinebreaks: true}));\r\n          }\r\n\r\n          // console.log('callbackButtonClick callbackAnswer:', callbackAnswer);\r\n        });\r\n      });\r\n\r\n      canHaveTail = false;\r\n      bubble.classList.add('with-reply-markup');\r\n      contentWrapper.append(containerDiv);\r\n    }\r\n\r\n    const isOutgoing = message.pFlags.is_outgoing/*  && this.peerId !== rootScope.myId */;\r\n    if(our) {\r\n      if(message.pFlags.unread || isOutgoing) this.unreadOut.add(message.mid);\r\n      let status = '';\r\n      if(message.error) status = 'is-error';\r\n      else if(isOutgoing) status = 'is-sending';\r\n      else status = message.pFlags.unread || (message as Message.message).pFlags.is_scheduled ? 'is-sent' : 'is-read';\r\n      bubble.classList.add(status);\r\n    }\r\n\r\n    if(isOutgoing && !message.error) {\r\n      bubble.classList.add('is-outgoing');\r\n    }\r\n\r\n    const messageWithReplies = isMessage && await this.managers.appMessagesManager.getMessageWithCommentReplies(message);\r\n    const withReplies = !!messageWithReplies && message.mid > 0;\r\n\r\n    if(withReplies) {\r\n      bubble.classList.add('with-replies');\r\n    }\r\n\r\n    const fwdFrom = isMessage && message.fwd_from;\r\n    const fwdFromId = isMessage && message.fwdFromId;\r\n\r\n    const isOut = this.chat.isOutMessage(message);\r\n    let nameContainer: HTMLElement = bubbleContainer;\r\n\r\n    const canHideNameIfMedia = !message.viaBotId && (message.fromId === rootScope.myId || !message.pFlags.out);\r\n\r\n    // media\r\n    if(messageMedia/*  && messageMedia._ === 'messageMediaPhoto' */) {\r\n      let attachmentDiv = document.createElement('div');\r\n      attachmentDiv.classList.add('attachment');\r\n\r\n      if(!messageMessage) {\r\n        bubble.classList.add('is-message-empty');\r\n      }\r\n\r\n      let processingWebPage = false;\r\n\r\n      /* if(isMessage)  */switch(messageMedia._) {\r\n        case 'messageMediaPhoto': {\r\n          const photo = messageMedia.photo;\r\n          // //////this.log('messageMediaPhoto', photo);\r\n\r\n          if(!messageMessage) {\r\n            canHaveTail = false;\r\n          }\r\n\r\n          if(canHideNameIfMedia) {\r\n            bubble.classList.add('hide-name');\r\n          }\r\n\r\n          bubble.classList.add('photo');\r\n\r\n          if(albumMustBeRenderedFull && groupedId && albumMids.length !== 1) {\r\n            bubble.classList.add('is-album', 'is-grouped');\r\n            wrapAlbum({\r\n              messages: albumMessages,\r\n              attachmentDiv,\r\n              middleware: this.getMiddleware(),\r\n              isOut: our,\r\n              lazyLoadQueue: this.lazyLoadQueue,\r\n              chat: this.chat,\r\n              loadPromises,\r\n              autoDownload: this.chat.autoDownload\r\n            });\r\n\r\n            break;\r\n          }\r\n\r\n          const withTail = !IS_ANDROID && canHaveTail && !withReplies && USE_MEDIA_TAILS;\r\n          if(withTail) bubble.classList.add('with-media-tail');\r\n          wrapPhoto({\r\n            photo: photo as Photo.photo,\r\n            message,\r\n            container: attachmentDiv,\r\n            withTail,\r\n            isOut,\r\n            lazyLoadQueue: this.lazyLoadQueue,\r\n            middleware: this.getMiddleware(),\r\n            loadPromises,\r\n            autoDownloadSize: this.chat.autoDownload.photo\r\n          });\r\n\r\n          break;\r\n        }\r\n\r\n        case 'messageMediaWebPage': {\r\n          processingWebPage = true;\r\n\r\n          const webPage: WebPage = messageMedia.webpage;\r\n          // //////this.log('messageMediaWebPage', webpage);\r\n          if(webPage._ !== 'webPage') {\r\n            break;\r\n          }\r\n\r\n          bubble.classList.add('webpage');\r\n\r\n          const box = document.createElement('div');\r\n          box.classList.add('web');\r\n\r\n          const quote = document.createElement('div');\r\n          quote.classList.add('quote');\r\n\r\n          let previewResizer: HTMLDivElement, preview: HTMLDivElement;\r\n          const photo: Photo.photo = webPage.photo as any;\r\n          if(photo || webPage.document) {\r\n            previewResizer = document.createElement('div');\r\n            previewResizer.classList.add('preview-resizer');\r\n            preview = document.createElement('div');\r\n            preview.classList.add('preview');\r\n            previewResizer.append(preview);\r\n          }\r\n\r\n          const quoteTextDiv = document.createElement('div');\r\n          quoteTextDiv.classList.add('quote-text');\r\n\r\n          const doc = webPage.document as MyDocument;\r\n          if(doc) {\r\n            if(doc.type === 'gif' || doc.type === 'video' || doc.type === 'round') {\r\n              // if(doc.size <= 20e6) {\r\n              const mediaSize = doc.type === 'round' ? mediaSizes.active.round : mediaSizes.active.webpage;\r\n              if(doc.type === 'round') {\r\n                bubble.classList.add('round');\r\n                preview.classList.add('is-round');\r\n              } else {\r\n                bubble.classList.add('video');\r\n              }\r\n              wrapVideo({\r\n                doc,\r\n                container: preview,\r\n                message: message as Message.message,\r\n                boxWidth: mediaSize.width,\r\n                boxHeight: mediaSize.height,\r\n                lazyLoadQueue: this.lazyLoadQueue,\r\n                middleware: this.getMiddleware(),\r\n                isOut,\r\n                group: CHAT_ANIMATION_GROUP,\r\n                loadPromises,\r\n                autoDownload: this.chat.autoDownload,\r\n                noInfo: message.mid < 0\r\n              });\r\n              // }\r\n            } else {\r\n              const docDiv = await wrapDocument({\r\n                message: message as Message.message,\r\n                autoDownloadSize: this.chat.autoDownload.file,\r\n                lazyLoadQueue: this.lazyLoadQueue,\r\n                loadPromises,\r\n                sizeType: 'documentName',\r\n                searchContext: {\r\n                  useSearch: false,\r\n                  peerId: this.peerId,\r\n                  inputFilter: {\r\n                    _: 'inputMessagesFilterEmpty'\r\n                  }\r\n                }\r\n              });\r\n              preview.append(docDiv);\r\n              preview.classList.add('preview-with-document');\r\n              quoteTextDiv.classList.add('has-document');\r\n              // messageDiv.classList.add((webpage.type || 'document') + '-message');\r\n              // doc = null;\r\n            }\r\n          }\r\n\r\n          if(previewResizer) {\r\n            quoteTextDiv.append(previewResizer);\r\n          }\r\n\r\n          let t: HTMLElement;\r\n          if(webPage.site_name) {\r\n            const html = wrapRichText(webPage.url);\r\n            const a: HTMLAnchorElement = htmlToDocumentFragment(html).firstElementChild as any;\r\n            a.classList.add('webpage-name');\r\n            const strong = document.createElement('strong');\r\n            setInnerHTML(strong, wrapEmojiText(webPage.site_name));\r\n            a.textContent = '';\r\n            a.append(strong);\r\n            quoteTextDiv.append(a);\r\n            t = a;\r\n          }\r\n\r\n          const title = wrapWebPageTitle(webPage);\r\n          if(title.textContent) {\r\n            const titleDiv = document.createElement('div');\r\n            titleDiv.classList.add('title');\r\n            const strong = document.createElement('strong');\r\n            setInnerHTML(strong, title);\r\n            titleDiv.append(strong);\r\n            quoteTextDiv.append(titleDiv);\r\n            t = titleDiv;\r\n          }\r\n\r\n          const description = wrapWebPageDescription(webPage);\r\n          if(description.textContent) {\r\n            const textDiv = document.createElement('div');\r\n            textDiv.classList.add('text');\r\n            setInnerHTML(textDiv, description);\r\n            quoteTextDiv.append(textDiv);\r\n            t = textDiv;\r\n          }\r\n\r\n          /* if(t) {\r\n            t.append(timeSpan);\r\n          } else {\r\n            box.classList.add('no-text');\r\n          } */\r\n\r\n          quote.append(quoteTextDiv);\r\n\r\n          if(photo && !doc) {\r\n            bubble.classList.add('photo');\r\n\r\n            const size: PhotoSize.photoSize = photo.sizes[photo.sizes.length - 1] as any;\r\n            let isSquare = false;\r\n            if(size.w === size.h && t) {\r\n              bubble.classList.add('is-square-photo');\r\n              isSquare = true;\r\n              setAttachmentSize(photo, preview, 48, 48, false);\r\n\r\n              /* if(t) {\r\n                t.append(timeSpan);\r\n              } */\r\n            } else if(size.h > size.w) {\r\n              bubble.classList.add('is-vertical-photo');\r\n            }\r\n\r\n            wrapPhoto({\r\n              photo,\r\n              message,\r\n              container: preview,\r\n              boxWidth: isSquare ? 0 : mediaSizes.active.webpage.width,\r\n              boxHeight: isSquare ? 0 : mediaSizes.active.webpage.height,\r\n              isOut,\r\n              lazyLoadQueue: this.lazyLoadQueue,\r\n              middleware: this.getMiddleware(),\r\n              loadPromises,\r\n              withoutPreloader: isSquare,\r\n              autoDownloadSize: this.chat.autoDownload.photo\r\n            });\r\n          }\r\n\r\n          box.append(quote);\r\n\r\n          // bubble.prepend(box);\r\n          // if(timeSpan.parentElement === messageDiv) {\r\n          messageDiv.insertBefore(box, timeSpan);\r\n          // } else {\r\n          //   messageDiv.append(box);\r\n          // }\r\n\r\n          // this.log('night running', bubble.scrollHeight);\r\n\r\n          break;\r\n        }\r\n\r\n        case 'messageMediaDocument': {\r\n          const doc = messageMedia.document as MyDocument;\r\n\r\n          // this.log('messageMediaDocument', doc, bubble);\r\n\r\n          if(doc.sticker/*  && doc.size <= 1e6 */) {\r\n            bubble.classList.add('sticker');\r\n            canHaveTail = false;\r\n            isStandaloneMedia = true;\r\n\r\n            if(doc.animated) {\r\n              bubble.classList.add('sticker-animated');\r\n            }\r\n\r\n            const sizes = mediaSizes.active;\r\n            const isEmoji = bubble.classList.contains('emoji-big');\r\n            const boxSize = isEmoji ? sizes.emojiSticker : (doc.animated ? sizes.animatedSticker : sizes.staticSticker);\r\n            setAttachmentSize(doc, attachmentDiv, boxSize.width, boxSize.height);\r\n            // let preloader = new ProgressivePreloader(attachmentDiv, false);\r\n            bubbleContainer.style.minWidth = attachmentDiv.style.width;\r\n            bubbleContainer.style.minHeight = attachmentDiv.style.height;\r\n            // appPhotosManager.setAttachmentSize(doc, bubble);\r\n            wrapSticker({\r\n              doc,\r\n              div: attachmentDiv,\r\n              middleware,\r\n              lazyLoadQueue: this.lazyLoadQueue,\r\n              group: CHAT_ANIMATION_GROUP,\r\n              // play: !!message.pending || !multipleRender,\r\n              play: true,\r\n              loop: true,\r\n              emoji: isEmoji ? messageMessage : undefined,\r\n              withThumb: true,\r\n              loadPromises,\r\n              isOut,\r\n              noPremium: messageMedia?.pFlags?.nopremium\r\n            });\r\n\r\n            if(getStickerEffectThumb(doc) && (isInUnread || isOutgoing)/*  || true */) {\r\n              this.observer.observe(bubble, this.stickerEffectObserverCallback);\r\n            }\r\n          } else if(doc.type === 'video' || doc.type === 'gif' || doc.type === 'round'/*  && doc.size <= 20e6 */) {\r\n            // this.log('never get free 2', doc);\r\n\r\n            const isRound = doc.type === 'round';\r\n            if(isRound) {\r\n              isStandaloneMedia = true;\r\n            }\r\n\r\n            if(isRound || !messageMessage) {\r\n              canHaveTail = false;\r\n            }\r\n\r\n            if(canHideNameIfMedia) {\r\n              bubble.classList.add('hide-name');\r\n            }\r\n\r\n            bubble.classList.add(isRound ? 'round' : 'video');\r\n            if(albumMustBeRenderedFull && groupedId && albumMids.length !== 1) {\r\n              bubble.classList.add('is-album', 'is-grouped');\r\n\r\n              wrapAlbum({\r\n                messages: albumMessages,\r\n                attachmentDiv,\r\n                middleware,\r\n                isOut: our,\r\n                lazyLoadQueue: this.lazyLoadQueue,\r\n                chat: this.chat,\r\n                loadPromises,\r\n                autoDownload: this.chat.autoDownload\r\n              });\r\n            } else {\r\n              const withTail = !IS_ANDROID && !IS_APPLE && !isRound && canHaveTail && !withReplies && USE_MEDIA_TAILS;\r\n              if(withTail) bubble.classList.add('with-media-tail');\r\n              wrapVideo({\r\n                doc,\r\n                container: attachmentDiv,\r\n                message: message as Message.message,\r\n                boxWidth: mediaSizes.active.regular.width,\r\n                boxHeight: mediaSizes.active.regular.height,\r\n                withTail,\r\n                isOut,\r\n                lazyLoadQueue: this.lazyLoadQueue,\r\n                middleware,\r\n                group: CHAT_ANIMATION_GROUP,\r\n                loadPromises,\r\n                autoDownload: this.chat.autoDownload,\r\n                searchContext: isRound ? {\r\n                  peerId: this.peerId,\r\n                  inputFilter: {_: 'inputMessagesFilterRoundVoice'},\r\n                  threadId: this.chat.threadId,\r\n                  useSearch: !(message as Message.message).pFlags.is_scheduled,\r\n                  isScheduled: (message as Message.message).pFlags.is_scheduled\r\n                } : undefined,\r\n                noInfo: message.mid < 0\r\n              });\r\n            }\r\n          } else {\r\n            const newNameContainer = await wrapGroupedDocuments({\r\n              albumMustBeRenderedFull,\r\n              message,\r\n              bubble,\r\n              messageDiv,\r\n              chat: this.chat,\r\n              loadPromises,\r\n              autoDownloadSize: this.chat.autoDownload.file,\r\n              lazyLoadQueue: this.lazyLoadQueue,\r\n              searchContext: doc.type === 'voice' || doc.type === 'audio' ? {\r\n                peerId: this.peerId,\r\n                inputFilter: {_: doc.type === 'voice' ? 'inputMessagesFilterRoundVoice' : 'inputMessagesFilterMusic'},\r\n                threadId: this.chat.threadId,\r\n                useSearch: !(message as Message.message).pFlags.is_scheduled,\r\n                isScheduled: (message as Message.message).pFlags.is_scheduled\r\n              } : undefined,\r\n              sizeType: 'documentName'\r\n            });\r\n\r\n            if(newNameContainer) {\r\n              nameContainer = newNameContainer;\r\n            }\r\n\r\n            const lastContainer = messageDiv.lastElementChild.querySelector('.document-message, .document, .audio');\r\n            // lastContainer && lastContainer.append(timeSpan.cloneNode(true));\r\n            lastContainer && lastContainer.append(timeSpan);\r\n\r\n            bubble.classList.remove('is-message-empty');\r\n            messageDiv.classList.add((!(['photo', 'pdf'] as MyDocument['type'][]).includes(doc.type) ? doc.type || 'document' : 'document') + '-message');\r\n            processingWebPage = true;\r\n          }\r\n\r\n          break;\r\n        }\r\n\r\n        case 'messageMediaCall': {\r\n          const action = messageMedia.action;\r\n          const div = document.createElement('div');\r\n          div.classList.add('bubble-call', action.pFlags.video ? 'tgico-videocamera' : 'tgico-phone');\r\n\r\n          const type: CallType = action.pFlags.video ? 'video' : 'voice';\r\n          div.dataset.type = type;\r\n\r\n          const title = document.createElement('div');\r\n          title.classList.add('bubble-call-title');\r\n\r\n          _i18n(title, isOut ?\r\n            (action.pFlags.video ? 'CallMessageVideoOutgoing' : 'CallMessageOutgoing') :\r\n            (action.pFlags.video ? 'CallMessageVideoIncoming' : 'CallMessageIncoming'));\r\n\r\n          const subtitle = document.createElement('div');\r\n          subtitle.classList.add('bubble-call-subtitle');\r\n\r\n          if(action.duration !== undefined) {\r\n            subtitle.append(formatCallDuration(action.duration));\r\n          } else {\r\n            let langPackKey: LangPackKey;\r\n            switch(action.reason._) {\r\n              case 'phoneCallDiscardReasonBusy':\r\n                langPackKey = 'Call.StatusBusy';\r\n                break;\r\n              case 'phoneCallDiscardReasonMissed':\r\n                langPackKey = 'Chat.Service.Call.Missed';\r\n                break;\r\n              // case 'phoneCallDiscardReasonHangup':\r\n              default:\r\n                langPackKey = 'Chat.Service.Call.Cancelled';\r\n                break;\r\n            }\r\n\r\n            subtitle.classList.add('is-reason');\r\n            _i18n(subtitle, langPackKey);\r\n          }\r\n\r\n          subtitle.classList.add('tgico', 'arrow-' + (action.duration !== undefined ? 'green' : 'red'));\r\n\r\n          div.append(title, subtitle);\r\n\r\n          processingWebPage = true;\r\n\r\n          bubble.classList.remove('is-message-empty');\r\n          messageDiv.classList.add('call-message');\r\n          messageDiv.append(div);\r\n\r\n          break;\r\n        }\r\n\r\n        case 'messageMediaContact': {\r\n          // this.log('wrapping contact', message);\r\n\r\n          const contact = messageMedia;\r\n          const contactDiv = document.createElement('div');\r\n          contactDiv.classList.add('contact');\r\n          contactDiv.dataset.peerId = '' + contact.user_id;\r\n\r\n          processingWebPage = true;\r\n\r\n          const contactDetails = document.createElement('div');\r\n          contactDetails.className = 'contact-details';\r\n          const contactNameDiv = document.createElement('div');\r\n          contactNameDiv.className = 'contact-name';\r\n          contactNameDiv.append(\r\n            wrapEmojiText([\r\n              contact.first_name,\r\n              contact.last_name\r\n            ].filter(Boolean).join(' '))\r\n          );\r\n\r\n          const contactNumberDiv = document.createElement('div');\r\n          contactNumberDiv.className = 'contact-number';\r\n          contactNumberDiv.textContent = contact.phone_number ? '+' + formatPhoneNumber(contact.phone_number).formatted : 'Unknown phone number';\r\n\r\n          contactDiv.append(contactDetails);\r\n          contactDetails.append(contactNameDiv, contactNumberDiv);\r\n\r\n          const avatarElem = new AvatarElement();\r\n          avatarElem.updateWithOptions({\r\n            lazyLoadQueue: this.lazyLoadQueue,\r\n            peerId: contact.user_id.toPeerId()\r\n          });\r\n          avatarElem.classList.add('contact-avatar', 'avatar-54');\r\n\r\n          contactDiv.prepend(avatarElem);\r\n\r\n          bubble.classList.remove('is-message-empty');\r\n          messageDiv.classList.add('contact-message');\r\n          messageDiv.append(contactDiv);\r\n\r\n          break;\r\n        }\r\n\r\n        case 'messageMediaPoll': {\r\n          bubble.classList.remove('is-message-empty');\r\n\r\n          const pollElement = wrapPoll(message);\r\n          messageDiv.prepend(pollElement);\r\n          messageDiv.classList.add('poll-message');\r\n\r\n          break;\r\n        }\r\n\r\n        case 'messageMediaInvoice': {\r\n          const isTest = messageMedia.pFlags.test;\r\n          const photo = messageMedia.photo;\r\n\r\n          const priceEl = document.createElement(photo ? 'span' : 'div');\r\n          const f = document.createDocumentFragment();\r\n          const l = i18n(messageMedia.receipt_msg_id ? 'PaymentReceipt' : (isTest ? 'PaymentTestInvoice' : 'PaymentInvoice'));\r\n          l.classList.add('text-uppercase');\r\n          const joiner = ' ';\r\n          const p = document.createElement('span');\r\n          p.classList.add('text-bold');\r\n          p.textContent = paymentsWrapCurrencyAmount(messageMedia.total_amount, messageMedia.currency) + joiner;\r\n          f.append(p, l);\r\n          if(isTest && messageMedia.receipt_msg_id) {\r\n            const a = document.createElement('span');\r\n            a.classList.add('text-uppercase', 'pre-wrap');\r\n            a.append(joiner + '(Test)');\r\n            f.append(a);\r\n          }\r\n          setInnerHTML(priceEl, f);\r\n\r\n          if(photo) {\r\n            const mediaSize = mediaSizes.active.invoice;\r\n            wrapPhoto({\r\n              photo,\r\n              container: attachmentDiv,\r\n              withTail: false,\r\n              isOut,\r\n              lazyLoadQueue: this.lazyLoadQueue,\r\n              middleware,\r\n              loadPromises,\r\n              boxWidth: mediaSize.width,\r\n              boxHeight: mediaSize.height\r\n            });\r\n\r\n            bubble.classList.add('photo');\r\n\r\n            priceEl.classList.add('video-time');\r\n            attachmentDiv.append(priceEl);\r\n          } else {\r\n            attachmentDiv = undefined;\r\n          }\r\n\r\n          const titleDiv = document.createElement('div');\r\n          titleDiv.classList.add('bubble-primary-color');\r\n          setInnerHTML(titleDiv, wrapEmojiText(messageMedia.title));\r\n\r\n          const richText = wrapEmojiText(messageMedia.description);\r\n          messageDiv.prepend(...[titleDiv, !photo && priceEl, richText].filter(Boolean));\r\n\r\n          bubble.classList.remove('is-message-empty');\r\n          bubble.classList.add('is-invoice');\r\n\r\n          break;\r\n        }\r\n\r\n        default:\r\n          attachmentDiv = undefined;\r\n          bubble.classList.remove('is-message-empty');\r\n          messageDiv.append(i18n(UNSUPPORTED_LANG_PACK_KEY), timeSpan);\r\n          this.log.warn('unrecognized media type:', messageMedia._, message);\r\n          break;\r\n      }\r\n\r\n      if(!processingWebPage && attachmentDiv) {\r\n        bubbleContainer.append(attachmentDiv);\r\n      }\r\n\r\n      /* if(bubble.classList.contains('is-message-empty') && (bubble.classList.contains('photo') || bubble.classList.contains('video'))) {\r\n        bubble.classList.add('no-tail');\r\n\r\n        if(!bubble.classList.contains('with-media-tail')) {\r\n          bubble.classList.add('use-border-radius');\r\n        }\r\n      } */\r\n    }\r\n\r\n    if(isStandaloneMedia) {\r\n      bubble.classList.add('just-media');\r\n    }\r\n\r\n    let savedFrom = '';\r\n\r\n    // const needName = ((peerId.isAnyChat() && (peerId !== message.fromId || our)) && message.fromId !== rootScope.myId) || message.viaBotId;\r\n    const needName = (message.fromId !== rootScope.myId && this.chat.isAnyGroup) || message.viaBotId || (message as Message.message).pFlags.sponsored;\r\n    if(needName || fwdFrom || message.reply_to_mid) { // chat\r\n      let title: HTMLElement | DocumentFragment;\r\n      let titleVia: typeof title;\r\n\r\n      const isForwardFromChannel = message.from_id && message.from_id._ === 'peerChannel' && message.fromId === fwdFromId;\r\n\r\n      const isHidden = fwdFrom && !fwdFrom.from_id;\r\n      if(message.viaBotId) {\r\n        titleVia = document.createElement('span');\r\n        titleVia.innerText = '@' + (await this.managers.appUsersManager.getUser(message.viaBotId)).username;\r\n        titleVia.classList.add('peer-title');\r\n        bubble.classList.add('must-have-name');\r\n      }\r\n\r\n      if(isHidden) {\r\n        // /////this.log('message to render hidden', message);\r\n        title = document.createElement('span');\r\n        setInnerHTML(title, wrapEmojiText(fwdFrom.from_name));\r\n        title.classList.add('peer-title');\r\n        // title = fwdFrom.from_name;\r\n        bubble.classList.add('hidden-profile');\r\n      } else {\r\n        title = new PeerTitle({peerId: fwdFromId || message.fromId}).element;\r\n      }\r\n\r\n      if(message.reply_to_mid && message.reply_to_mid !== this.chat.threadId && isMessage) {\r\n        await MessageRender.setReply({\r\n          chat: this.chat,\r\n          bubble,\r\n          bubbleContainer,\r\n          message\r\n        });\r\n      }\r\n\r\n      // this.log(title);\r\n\r\n      let nameDiv: HTMLElement;\r\n      if((fwdFromId || fwdFrom)) {\r\n        if(this.peerId !== rootScope.myId && !isForwardFromChannel) {\r\n          bubble.classList.add('forwarded');\r\n        }\r\n\r\n        if(message.savedFrom) {\r\n          savedFrom = message.savedFrom;\r\n          title.dataset.savedFrom = savedFrom;\r\n        }\r\n\r\n        nameDiv = document.createElement('div');\r\n        title.dataset.peerId = '' + fwdFromId;\r\n\r\n        if((this.peerId === rootScope.myId || this.peerId === REPLIES_PEER_ID || isForwardFromChannel) && !isStandaloneMedia) {\r\n          nameDiv.style.color = getPeerColorById(fwdFromId, false);\r\n          nameDiv.append(title);\r\n        } else {\r\n          /* const fromTitle = message.fromId === this.myID || appPeersManager.isBroadcast(fwdFromId || message.fromId) ? '' : `<div class=\"name\" data-peer-id=\"${message.fromId}\" style=\"color: ${appPeersManager.getPeerColorByID(message.fromId, false)};\">${appPeersManager.getPeerTitle(message.fromId)}</div>`;\r\n          nameDiv.innerHTML = fromTitle + 'Forwarded from ' + title; */\r\n          const args: FormatterArguments = [title];\r\n          if(isStandaloneMedia) {\r\n            args.unshift(document.createElement('br'));\r\n          }\r\n          nameDiv.append(i18n('ForwardedFrom', [args]));\r\n        }\r\n      } else if(!message.viaBotId) {\r\n        if(!isStandaloneMedia && needName) {\r\n          nameDiv = document.createElement('div');\r\n          nameDiv.append(title);\r\n\r\n          const peer = await this.managers.appPeersManager.getPeer(message.fromId);\r\n          const pFlags = (peer as User.user)?.pFlags;\r\n          if(pFlags && (pFlags.scam || pFlags.fake)) {\r\n            nameDiv.append(generateFakeIcon(pFlags.scam));\r\n          }\r\n\r\n          if(!our) {\r\n            nameDiv.style.color = getPeerColorById(message.fromId, false);\r\n          }\r\n\r\n          nameDiv.dataset.peerId = '' + message.fromId;\r\n        } else /* if(!message.reply_to_mid) */ {\r\n          bubble.classList.add('hide-name');\r\n        }\r\n      }\r\n\r\n      if(message.viaBotId) {\r\n        if(!nameDiv) {\r\n          nameDiv = document.createElement('div');\r\n        } else {\r\n          nameDiv.append(' ');\r\n        }\r\n\r\n        const span = document.createElement('span');\r\n        span.append(i18n('ViaBot'), ' ', titleVia);\r\n        span.classList.add('is-via');\r\n\r\n        nameDiv.append(span);\r\n      }\r\n\r\n      if(nameDiv) {\r\n        nameDiv.classList.add('name');\r\n        nameContainer.append(nameDiv);\r\n      }\r\n    } else {\r\n      bubble.classList.add('hide-name');\r\n    }\r\n\r\n    if(this.chat.type === 'pinned') {\r\n      savedFrom = `${this.chat.peerId}_${message.mid}`;\r\n    }\r\n\r\n    const isThreadStarter = messageWithReplies && messageWithReplies.mid === this.chat.threadId;\r\n    if(isThreadStarter) {\r\n      bubble.classList.add('is-thread-starter', 'is-group-last');\r\n    }\r\n\r\n    if(savedFrom && (this.chat.type === 'pinned' || fwdFrom.saved_from_msg_id) && this.peerId !== REPLIES_PEER_ID) {\r\n      const goto = document.createElement('div');\r\n      goto.classList.add('bubble-beside-button', 'goto-original', 'tgico-arrow_next');\r\n      bubbleContainer.append(goto);\r\n      bubble.dataset.savedFrom = savedFrom;\r\n      bubble.classList.add('with-beside-button');\r\n    }\r\n\r\n    bubble.classList.add(isOut ? 'is-out' : 'is-in');\r\n\r\n    if(withReplies) {\r\n      const isFooter = MessageRender.renderReplies({\r\n        bubble,\r\n        bubbleContainer,\r\n        message: messageWithReplies,\r\n        messageDiv,\r\n        loadPromises,\r\n        lazyLoadQueue: this.lazyLoadQueue\r\n      });\r\n\r\n      if(isFooter) {\r\n        canHaveTail = true;\r\n      }\r\n    }\r\n\r\n    if(isMessage) {\r\n      this.appendReactionsElementToBubble(bubble, message, reactionsMessage);\r\n    }\r\n\r\n    /* if(isMessage) {\r\n      const reactionHover = document.createElement('div');\r\n      reactionHover.classList.add('bubble-reaction-hover');\r\n      contentWrapper.append(reactionHover);\r\n    } */\r\n\r\n    if(canHaveTail) {\r\n      bubble.classList.add('can-have-tail');\r\n\r\n      bubbleContainer.append(generateTail());\r\n    }\r\n\r\n    return ret;\r\n  }\r\n\r\n  private appendReactionsElementToBubble(bubble: HTMLElement, message: Message.message, reactionsMessage: Message.message, changedResults?: ReactionCount[]) {\r\n    if(this.peerId.isUser()/*  || true */) {\r\n      return;\r\n    }\r\n\r\n    if(!reactionsMessage?.reactions || !reactionsMessage.reactions.results.length) {\r\n      return;\r\n    }\r\n\r\n    // message = this.appMessagesManager.getMessageWithReactions(message);\r\n\r\n    const reactionsElement = new ReactionsElement();\r\n    reactionsElement.init(reactionsMessage, 'block');\r\n    reactionsElement.render(changedResults);\r\n\r\n    if(bubble.classList.contains('is-message-empty')) {\r\n      bubble.querySelector('.bubble-content-wrapper').append(reactionsElement);\r\n    } else {\r\n      const messageDiv = bubble.querySelector('.message');\r\n      if(bubble.classList.contains('is-multiple-documents')) {\r\n        const documentContainer = messageDiv.lastElementChild as HTMLElement;\r\n        let documentMessageDiv = documentContainer.querySelector('.document-message');\r\n\r\n        let timeSpan: HTMLElement = documentMessageDiv && documentMessageDiv.querySelector('.time');\r\n        if(!timeSpan) {\r\n          timeSpan = MessageRender.setTime({\r\n            chatType: this.chat.type,\r\n            message,\r\n            reactionsMessage\r\n          });\r\n        }\r\n\r\n        reactionsElement.append(timeSpan);\r\n\r\n        if(!documentMessageDiv) {\r\n          documentMessageDiv = document.createElement('div');\r\n          documentMessageDiv.classList.add('document-message');\r\n          documentContainer.querySelector('.document-wrapper').prepend(documentMessageDiv);\r\n        }\r\n\r\n        documentMessageDiv.append(reactionsElement);\r\n      } else {\r\n        const timeSpan = Array.from(bubble.querySelectorAll('.time')).pop();\r\n        reactionsElement.append(timeSpan);\r\n\r\n        messageDiv.append(reactionsElement);\r\n      }\r\n    }\r\n  }\r\n\r\n  private prepareToSaveScroll(reverse?: boolean) {\r\n    const isMounted = !!this.chatInner.parentElement;\r\n    if(!isMounted) {\r\n      return {};\r\n    }\r\n\r\n    const log = this.log.bindPrefix('prepareToSaveScroll');\r\n    log('save');\r\n    const scrollSaver = this.createScrollSaver(reverse);\r\n    scrollSaver.save(); // * let's save scroll position by point before the slicing, not after\r\n\r\n    if(this.getRenderedLength() && !this.chat.setPeerPromise) {\r\n      const viewportSlice = this.getViewportSlice();\r\n      this.deleteViewportSlice(viewportSlice, true);\r\n    }\r\n\r\n    // scrollSaver.save(); // ! slicing will corrupt scroll position\r\n    // const saved = scrollSaver.getSaved();\r\n    // const hadScroll = saved.scrollHeight !== saved.clientHeight;\r\n\r\n    return {\r\n      restoreScroll: () => {\r\n        log('restore');\r\n        // scrollSaver.restore(_history.length === 1 && !reverse ? false : true);\r\n        scrollSaver.restore(reverse);\r\n        this.onRenderScrollSet(scrollSaver.getSaved());\r\n      },\r\n      scrollSaver\r\n    };\r\n  }\r\n\r\n  public async performHistoryResult(historyResult: HistoryResult | {history: (Message.message | Message.messageService | number)[]}, reverse: boolean) {\r\n    const log = false ? this.log.bindPrefix('perform-' + (Math.random() * 1000 | 0)) : undefined;\r\n    log && log('start', this.chatInner.parentElement);\r\n\r\n    let history = historyResult.history;\r\n    history = history.slice(); // need\r\n\r\n    if(this.needReflowScroll) {\r\n      reflowScrollableElement(this.scrollable.container);\r\n      this.needReflowScroll = false;\r\n    }\r\n\r\n    const cb = (message: Message.message | Message.messageService) => {\r\n      if(!message) {\r\n        return;\r\n      } else if(message.pFlags.local) {\r\n        return this.processLocalMessageRender(message);\r\n      } else {\r\n        return this.safeRenderMessage(message, reverse);\r\n      }\r\n    };\r\n\r\n    const messages = await Promise.all(history.map((mid) => {\r\n      return typeof(mid) === 'number' ? this.chat.getMessage(mid) : mid;\r\n    }));\r\n\r\n    const setLoadedPromises: Promise<any>[] = [];\r\n    if(!this.scrollable.loadedAll['bottom'] || !this.scrollable.loadedAll['top']) {\r\n      let isEnd = (historyResult as HistoryResult).isEnd;\r\n      if(!isEnd) {\r\n        const historyStorage = await this.chat.getHistoryStorage();\r\n        const firstSlice = historyStorage.history.first;\r\n        const lastSlice = historyStorage.history.last;\r\n        isEnd = {top: false, bottom: false, both: false};\r\n        if(firstSlice.isEnd(SliceEnd.Bottom) && (!firstSlice.length || history.includes(firstSlice[0]))) {\r\n          isEnd.bottom = true;\r\n        }\r\n\r\n        if(lastSlice.isEnd(SliceEnd.Top) && (!lastSlice.length || history.includes(lastSlice[lastSlice.length - 1]))) {\r\n          isEnd.top = true;\r\n        }\r\n      }\r\n\r\n      if(!isEnd.bottom && this.setPeerOptions) {\r\n        const {lastMsgId, topMessage} = this.setPeerOptions;\r\n        this.setPeerOptions = undefined;\r\n        if(!lastMsgId || this.bubbles[topMessage] || lastMsgId === topMessage) {\r\n          isEnd.bottom = true;\r\n        }\r\n      }\r\n\r\n      if(isEnd.top) setLoadedPromises.push(this.setLoaded('top', true));\r\n      if(isEnd.bottom) setLoadedPromises.push(this.setLoaded('bottom', true));\r\n    }\r\n\r\n    await Promise.all(setLoadedPromises);\r\n\r\n    // ! it is important to insert bubbles to group reversed way\r\n    // const length = history.length, promises: Promise<any>[] = [];\r\n    // if(reverse) for(let i = 0; i < length; ++i) promises.push(cb(messages[i]));\r\n    // else for(let i = length - 1; i >= 0; --i) promises.push(cb(messages[i]));\r\n    const promises = messages.map(cb);\r\n\r\n    // cannot combine them into one promise\r\n    await Promise.all(promises);\r\n    await this.messagesQueuePromise;\r\n\r\n    if(this.scrollable.loadedAll.top && this.messagesQueueOnRenderAdditional) {\r\n      this.messagesQueueOnRenderAdditional();\r\n\r\n      if(this.messagesQueueOnRenderAdditional) {\r\n        this.messagesQueueOnRenderAdditional();\r\n      }\r\n    }\r\n\r\n    log && log('performHistoryResult end');\r\n  }\r\n\r\n  private onRenderScrollSet(state?: {scrollHeight: number, clientHeight: number}) {\r\n    const className = 'has-sticky-dates';\r\n    if(!this.container.classList.contains(className)) {\r\n      const isLoading = !this.preloader.detached;\r\n\r\n      if(isLoading ||\r\n        (\r\n          state ??= {\r\n            scrollHeight: this.scrollable.scrollHeight,\r\n            clientHeight: this.scrollable.container.clientHeight\r\n          },\r\n          state.scrollHeight !== state.clientHeight\r\n        )\r\n      ) {\r\n        /* for(const timestamp in this.dateMessages) {\r\n          const dateMessage = this.dateMessages[timestamp];\r\n          dateMessage.div.classList.add('is-sticky');\r\n        } */\r\n\r\n        const middleware = this.getMiddleware();\r\n        const callback = () => {\r\n          if(!middleware()) return;\r\n          this.container.classList.add(className);\r\n        };\r\n\r\n        if(this.willScrollOnLoad) {\r\n          callback();\r\n        } else {\r\n          setTimeout(callback, 600);\r\n        }\r\n\r\n        return;\r\n      }\r\n    }\r\n\r\n    this.willScrollOnLoad = undefined;\r\n  }\r\n\r\n  public onDatePick = (timestamp: number) => {\r\n    const peerId = this.peerId;\r\n    this.managers.appMessagesManager.requestHistory(peerId, 0, 2, -1, timestamp, this.chat.threadId).then((history) => {\r\n      if(!history?.messages?.length) {\r\n        this.log.error('no history!');\r\n        return;\r\n      } else if(this.peerId !== peerId) {\r\n        return;\r\n      }\r\n\r\n      this.chat.setMessageId((history.messages[0] as MyMessage).mid);\r\n      // console.log('got history date:', history);\r\n    });\r\n  };\r\n\r\n  public requestHistory(maxId: number, loadCount: number, backLimit: number) {\r\n    // const middleware = this.getMiddleware();\r\n    if(this.chat.type === 'chat' || this.chat.type === 'discussion') {\r\n      return this.managers.acknowledged.appMessagesManager.getHistory(this.peerId, maxId, loadCount, backLimit, this.chat.threadId);\r\n    } else if(this.chat.type === 'pinned') {\r\n      return this.managers.acknowledged.appMessagesManager.getSearch({\r\n        peerId: this.peerId,\r\n        inputFilter: {_: 'inputMessagesFilterPinned'},\r\n        maxId,\r\n        limit: loadCount,\r\n        backLimit\r\n      }).then((ackedResult) => {\r\n        return {\r\n          cached: ackedResult.cached,\r\n          result: Promise.resolve(ackedResult.result).then((value) => {\r\n            return {history: value.history.map((m) => m.mid)};\r\n          })\r\n        };\r\n      });\r\n    } else if(this.chat.type === 'scheduled') {\r\n      return this.managers.acknowledged.appMessagesManager.getScheduledMessages(this.peerId).then((ackedResult) => {\r\n        // this.setLoaded('top', true);\r\n        // this.setLoaded('bottom', true);\r\n        return {\r\n          cached: ackedResult.cached,\r\n          result: Promise.resolve(ackedResult.result).then((mids) => ({history: mids.slice().reverse()}))\r\n        };\r\n      });\r\n    }\r\n  }\r\n\r\n  private async animateAsLadder(additionMsgId: number, additionMsgIds: number[], isAdditionRender: boolean, backLimit: number, maxId: number) {\r\n    /* const middleware = this.getMiddleware();\r\n    await this.ladderDeferred; */\r\n\r\n    const log = this.log.bindPrefix('ladder');\r\n    if(this.chat.setPeerPromise && !this.resolveLadderAnimation) {\r\n      log.warn('will be delayed');\r\n      // @ts-ignore\r\n      this.resolveLadderAnimation = this.animateAsLadder.bind(this, additionMsgId, additionMsgIds, isAdditionRender, backLimit, maxId);\r\n      return;\r\n    }\r\n\r\n    /* if(!middleware()) {\r\n      return;\r\n    } */\r\n\r\n    if(!Object.keys(this.bubbles).length) {\r\n      log.warn('no bubbles');\r\n      return;\r\n    }\r\n\r\n    let sortedMids = getObjectKeysAndSort(this.bubbles, 'desc');\r\n\r\n    if(isAdditionRender && additionMsgIds.length) {\r\n      sortedMids = sortedMids.filter((mid) => !additionMsgIds.includes(mid));\r\n    }\r\n\r\n    let targetMid: number;\r\n    if(backLimit) {\r\n      targetMid = maxId || Math.max(...sortedMids); // * on discussion enter\r\n    } else {\r\n      if(additionMsgId) {\r\n        targetMid = additionMsgId;\r\n      } else { // * if maxId === 0\r\n        targetMid = Math.max(...sortedMids);\r\n      }\r\n    }\r\n\r\n    const topIds = sortedMids.slice(sortedMids.findIndex((mid) => targetMid > mid));\r\n    const middleIds = isAdditionRender ? [] : [targetMid];\r\n    const bottomIds = isAdditionRender ? [] : sortedMids.slice(0, sortedMids.findIndex((mid) => targetMid >= mid)).reverse();\r\n\r\n    if(DEBUG) {\r\n      log('targeting mid:', targetMid, maxId, additionMsgId,\r\n        topIds.map((m) => getServerMessageId(m)),\r\n        bottomIds.map((m) => getServerMessageId(m)));\r\n    }\r\n\r\n    const setBubbles: HTMLElement[] = [];\r\n\r\n    this.chatInner.classList.add('zoom-fading');\r\n    const delay = isAdditionRender ? 10 : 40;\r\n    const offsetIndex = isAdditionRender ? 0 : 1;\r\n    const animateAsLadder = (mids: number[], offsetIndex = 0) => {\r\n      const animationPromise = deferredPromise<void>();\r\n      let lastMsDelay = 0;\r\n      mids.forEach((mid, idx) => {\r\n        const bubble = this.bubbles[mid];\r\n        if(!bubble || this.skippedMids.has(mid)) {\r\n          log.warn('no bubble by mid:', mid);\r\n          return;\r\n        }\r\n\r\n        lastMsDelay = ((idx + offsetIndex) || 0.1) * delay;\r\n        // lastMsDelay = (idx + offsetIndex) * delay;\r\n        // lastMsDelay = (idx || 0.1) * 1000;\r\n\r\n        const contentWrapper = bubble.lastElementChild as HTMLElement;\r\n        const elementsToAnimate: HTMLElement[] = [contentWrapper];\r\n        const item = this.bubbleGroups.getItemByBubble(bubble);\r\n        if(item && item.group.avatar && item.group.lastItem === item) {\r\n          elementsToAnimate.push(item.group.avatar);\r\n        }\r\n\r\n        elementsToAnimate.forEach((element) => {\r\n          element.classList.add('zoom-fade', 'can-zoom-fade');\r\n          element.style.transitionDelay = lastMsDelay + 'ms';\r\n        });\r\n\r\n        if(idx === (mids.length - 1)) {\r\n          const onTransitionEnd = (e: TransitionEvent) => {\r\n            if(e.target !== contentWrapper) {\r\n              return;\r\n            }\r\n\r\n            animationPromise.resolve();\r\n            contentWrapper.removeEventListener('transitionend', onTransitionEnd);\r\n          };\r\n\r\n          contentWrapper.addEventListener('transitionend', onTransitionEnd);\r\n        }\r\n\r\n        setBubbles.push(...elementsToAnimate);\r\n      });\r\n\r\n      if(!mids.length) {\r\n        animationPromise.resolve();\r\n      }\r\n\r\n      return {lastMsDelay, animationPromise};\r\n    };\r\n\r\n    const topRes = animateAsLadder(topIds, offsetIndex);\r\n    const middleRes = animateAsLadder(middleIds);\r\n    const bottomRes = animateAsLadder(bottomIds, offsetIndex);\r\n    const promises = [topRes.animationPromise, middleRes.animationPromise, bottomRes.animationPromise];\r\n    const delays: number[] = [topRes.lastMsDelay, middleRes.lastMsDelay, bottomRes.lastMsDelay];\r\n\r\n    if(this.onAnimateLadder) {\r\n      await this.onAnimateLadder();\r\n    }\r\n\r\n    fastRaf(() => {\r\n      this.setStickyDateManually(); // ! maybe it's not efficient\r\n\r\n      setBubbles.forEach((element) => {\r\n        element.classList.remove('zoom-fade');\r\n      });\r\n    });\r\n\r\n    let promise: Promise<any>;\r\n    if(topIds.length || middleIds.length || bottomIds.length) {\r\n      promise = Promise.all(promises);\r\n\r\n      dispatchHeavyAnimationEvent(promise, Math.max(...delays) + 200) // * 200 - transition time\r\n      .then(() => {\r\n        fastRaf(() => {\r\n          setBubbles.forEach((element) => {\r\n            element.style.transitionDelay = '';\r\n            element.classList.remove('can-zoom-fade');\r\n          });\r\n\r\n          this.chatInner.classList.remove('zoom-fading');\r\n        });\r\n\r\n        // !  , -  - zoom-fade        ,\r\n        // ! ..   ,  ,     translateZ    scrollable\r\n        // if(!IS_SAFARI) {\r\n        //   this.needReflowScroll = true;\r\n        // }\r\n      });\r\n    }\r\n\r\n    return promise;\r\n  }\r\n\r\n  private async renderEmptyPlaceholder(\r\n    type: 'group' | 'saved' | 'noMessages' | 'noScheduledMessages' | 'greeting' | 'restricted',\r\n    bubble: HTMLElement,\r\n    message: any,\r\n    elements: (Node | string)[]\r\n  ) {\r\n    const BASE_CLASS = 'empty-bubble-placeholder';\r\n    bubble.classList.add(BASE_CLASS, BASE_CLASS + '-' + type);\r\n\r\n    let title: HTMLElement;\r\n    if(type === 'group') title = i18n('GroupEmptyTitle1');\r\n    else if(type === 'saved') title = i18n('ChatYourSelfTitle');\r\n    else if(type === 'noMessages' || type === 'greeting') title = i18n('NoMessages');\r\n    else if(type === 'noScheduledMessages') title = i18n('NoScheduledMessages');\r\n    else if(type === 'restricted') {\r\n      title = document.createElement('span');\r\n      title.innerText = await this.managers.appPeersManager.getRestrictionReasonText(this.peerId);\r\n    }\r\n    title.classList.add('center', BASE_CLASS + '-title');\r\n\r\n    elements.push(title);\r\n\r\n    let listElements: HTMLElement[];\r\n    if(type === 'group') {\r\n      elements.push(i18n('GroupEmptyTitle2'));\r\n      listElements = [\r\n        i18n('GroupDescription1'),\r\n        i18n('GroupDescription2'),\r\n        i18n('GroupDescription3'),\r\n        i18n('GroupDescription4')\r\n      ];\r\n    } else if(type === 'saved') {\r\n      listElements = [\r\n        i18n('ChatYourSelfDescription1'),\r\n        i18n('ChatYourSelfDescription2'),\r\n        i18n('ChatYourSelfDescription3'),\r\n        i18n('ChatYourSelfDescription4')\r\n      ];\r\n    } else if(type === 'greeting') {\r\n      const subtitle = i18n('NoMessagesGreetingsDescription');\r\n      subtitle.classList.add('center', BASE_CLASS + '-subtitle');\r\n\r\n      // findAndSplice(this.messagesQueue, q => q.bubble === bubble);\r\n\r\n      const stickerDiv = document.createElement('div');\r\n      stickerDiv.classList.add(BASE_CLASS + '-sticker');\r\n\r\n      const middleware = this.getMiddleware();\r\n\r\n      await this.managers.appStickersManager.getGreetingSticker().then(async(doc) => {\r\n        if(!middleware()) return;\r\n\r\n        const loadPromises: Promise<any>[] = [];\r\n        await wrapSticker({\r\n          doc,\r\n          // doc: appDocsManager.getDoc(\"5431607541660389336\"), // cubigator mockup\r\n          div: stickerDiv,\r\n          middleware,\r\n          lazyLoadQueue: this.lazyLoadQueue,\r\n          group: CHAT_ANIMATION_GROUP,\r\n          // play: !!message.pending || !multipleRender,\r\n          play: true,\r\n          loop: true,\r\n          withThumb: true,\r\n          loadPromises\r\n        });\r\n\r\n        attachClickEvent(stickerDiv, (e) => {\r\n          cancelEvent(e);\r\n          EmoticonsDropdown.onMediaClick({target: e.target});\r\n        });\r\n\r\n        return Promise.all(loadPromises);\r\n      });\r\n\r\n      // this.renderMessagesQueue({\r\n      //   message,\r\n      //   bubble,\r\n      //   reverse: false,\r\n      //   promises: [loadPromise]\r\n      // });\r\n\r\n      elements.push(subtitle, stickerDiv);\r\n    }\r\n\r\n    if(listElements) {\r\n      elements.push(\r\n        ...listElements.map((elem) => {\r\n          const span = document.createElement('span');\r\n          span.classList.add(BASE_CLASS + '-list-item');\r\n          span.append(elem);\r\n          return span;\r\n        })\r\n      );\r\n\r\n      if(type === 'group') {\r\n        listElements.forEach((elem) => {\r\n          const i = document.createElement('span');\r\n          i.classList.add('tgico-check');\r\n          elem.prepend(i);\r\n        });\r\n      } else if(type === 'saved') {\r\n        listElements.forEach((elem) => {\r\n          const i = document.createElement('span');\r\n          i.classList.add(BASE_CLASS + '-list-bullet');\r\n          i.innerText = '';\r\n          elem.prepend(i);\r\n        });\r\n      }\r\n    }\r\n\r\n    if(elements.length > 1) {\r\n      bubble.classList.add('has-description');\r\n    }\r\n\r\n    elements.forEach((element: any) => element.classList.add(BASE_CLASS + '-line'));\r\n  }\r\n\r\n  private async processLocalMessageRender(message: Message.message | Message.messageService, animate?: boolean) {\r\n    const isSponsored = !!(message as Message.message).pFlags.sponsored;\r\n    const middleware = this.getMiddleware();\r\n    const m = middlewarePromise(middleware);\r\n    return this.safeRenderMessage(message, isSponsored ? false : true, undefined, isSponsored, async(result) => {\r\n      const {bubble} = await m(result);\r\n      if(!bubble) {\r\n        return result;\r\n      }\r\n\r\n      bubble.classList.add('is-group-last', 'is-group-first');\r\n\r\n      const updatePosition = () => {\r\n        if(this.updatePlaceholderPosition === updatePosition) {\r\n          this.updatePlaceholderPosition = undefined;\r\n        }\r\n\r\n        appendTo[method](bubble);\r\n      };\r\n\r\n      if(!isSponsored) {\r\n        bubble.classList.add('bubble-first');\r\n        bubble.classList.remove('can-have-tail', 'is-in');\r\n      }\r\n\r\n      const elements: (Node | string)[] = [];\r\n      const isBot = this.chat.isBot;\r\n      let renderPromise: Promise<any>, appendTo = this.container, method: 'append' | 'prepend' = 'append';\r\n      if(this.chat.isRestricted) {\r\n        renderPromise = this.renderEmptyPlaceholder('restricted', bubble, message, elements);\r\n      } else if(isSponsored) {\r\n        let text: LangPackKey, mid: number, startParam: string, callback: () => void;\r\n\r\n        bubble.classList.add('avoid-selection');\r\n\r\n        const sponsoredMessage = this.sponsoredMessage = (message as Message.message).sponsoredMessage;\r\n        const peerId = getPeerId(sponsoredMessage.from_id);\r\n        // const peer = this.appPeersManager.getPeer(peerId);\r\n        if(sponsoredMessage.channel_post) {\r\n          text = 'OpenChannelPost';\r\n          mid = generateMessageId(sponsoredMessage.channel_post);\r\n        } else if(sponsoredMessage.start_param || isBot) {\r\n          text = 'Chat.Message.ViewBot';\r\n          startParam = sponsoredMessage.start_param;\r\n        } else {\r\n          text = await this.managers.appPeersManager.isAnyGroup(peerId) ? 'Chat.Message.ViewGroup' : 'Chat.Message.ViewChannel';\r\n        }\r\n\r\n        if(sponsoredMessage.chat_invite) {\r\n          callback = () => {\r\n            new PopupJoinChatInvite(sponsoredMessage.chat_invite_hash, sponsoredMessage.chat_invite as ChatInvite.chatInvite);\r\n          };\r\n        } else if(sponsoredMessage.chat_invite_hash) {\r\n          callback = () => {\r\n            const link: InternalLink = {\r\n              _: INTERNAL_LINK_TYPE.JOIN_CHAT,\r\n              invite: sponsoredMessage.chat_invite_hash\r\n            };\r\n\r\n            this.chat.appImManager.processInternalLink(link);\r\n          };\r\n        } else {\r\n          callback = () => {\r\n            this.chat.appImManager.setInnerPeer({\r\n              peerId,\r\n              lastMsgId: mid,\r\n              startParam\r\n            });\r\n          };\r\n        }\r\n\r\n        const button = Button('btn-primary btn-primary-transparent bubble-view-button', {\r\n          text\r\n        });\r\n\r\n        this.observer.observe(button, this.viewsObserverCallback);\r\n\r\n        if(callback) {\r\n          attachClickEvent(button, callback);\r\n        }\r\n\r\n        bubble.querySelector('.bubble-content').prepend(button);\r\n\r\n        return result;\r\n      } else if(isBot && message._ === 'message') {\r\n        const b = document.createElement('b');\r\n        b.append(i18n('BotInfoTitle'));\r\n        elements.push(b, '\\n\\n');\r\n        appendTo = this.chatInner;\r\n        method = 'prepend';\r\n      } else if(await m(this.managers.appPeersManager.isAnyGroup(this.peerId)) && (await m(this.managers.appPeersManager.getPeer(this.peerId))).pFlags.creator) {\r\n        renderPromise = this.renderEmptyPlaceholder('group', bubble, message, elements);\r\n      } else if(this.chat.type === 'scheduled') {\r\n        renderPromise = this.renderEmptyPlaceholder('noScheduledMessages', bubble, message, elements);\r\n      } else if(rootScope.myId === this.peerId) {\r\n        renderPromise = this.renderEmptyPlaceholder('saved', bubble, message, elements);\r\n      } else if(this.peerId.isUser() && !isBot && await m(this.chat.canSend()) && this.chat.type === 'chat') {\r\n        renderPromise = this.renderEmptyPlaceholder('greeting', bubble, message, elements);\r\n      } else {\r\n        renderPromise = this.renderEmptyPlaceholder('noMessages', bubble, message, elements);\r\n      }\r\n\r\n      if(renderPromise) {\r\n        await renderPromise;\r\n      }\r\n\r\n      if(elements.length) {\r\n        const messageDiv = bubble.querySelector('.message, .service-msg');\r\n        messageDiv.prepend(...elements);\r\n      }\r\n\r\n      const isWaitingForAnimation = !!this.messagesQueueOnRenderAdditional;\r\n      const noTransition = this.setPeerCached && !isWaitingForAnimation;\r\n      if(noTransition) {\r\n        const setOn = bubble.firstElementChild;\r\n        setOn.classList.add('no-transition');\r\n\r\n        if(this.chat.setPeerPromise) {\r\n          this.chat.setPeerPromise.catch(noop).finally(() => {\r\n            setOn.classList.remove('no-transition');\r\n          });\r\n        }\r\n      }\r\n\r\n      if(animate === undefined && !noTransition) {\r\n        animate = true;\r\n      }\r\n\r\n      if(isWaitingForAnimation || animate) {\r\n        this.updatePlaceholderPosition = updatePosition;\r\n\r\n        this.onAnimateLadder = () => {\r\n          // appendTo[method](bubble);\r\n          this.onAnimateLadder = undefined;\r\n\r\n          // need raf here because animation won't fire if this message is single\r\n          if(!this.messagesQueuePromise) {\r\n            return fastRafPromise();\r\n          }\r\n        };\r\n      } else if(this.chat.setPeerPromise) {\r\n        this.attachPlaceholderOnRender = () => {\r\n          this.attachPlaceholderOnRender = undefined;\r\n          updatePosition();\r\n          // appendTo[method](bubble);\r\n        };\r\n      } else {\r\n        this.updatePlaceholderPosition = updatePosition;\r\n        // appendTo[method](bubble);\r\n      }\r\n\r\n      if(!isWaitingForAnimation && animate) {\r\n        await m(getHeavyAnimationPromise());\r\n        const additionMsgIds = getObjectKeysAndSort(this.bubbles);\r\n        indexOfAndSplice(additionMsgIds, message.mid);\r\n        this.animateAsLadder(message.mid, additionMsgIds, false, 0, 0);\r\n      }\r\n\r\n      // if(!isSponsored) {\r\n      this.emptyPlaceholderBubble = bubble;\r\n      // }\r\n\r\n      return result;\r\n    });\r\n  }\r\n\r\n  private generateLocalMessageId(addOffset = 0) {\r\n    // const INCREMENT = 0x10;\r\n    const offset = (this.chat.type === 'scheduled' ? -1 : 0) + addOffset;\r\n    // offset = generateMessageId(offset);\r\n    // id: -Math.abs(+this.peerId * INCREMENT + offset),\r\n    const id = -Math.abs(offset);\r\n    const mid = -Math.abs(generateMessageId(id));\r\n    return {id, mid};\r\n  }\r\n\r\n  private async generateLocalFirstMessage<T extends boolean>(service?: T, fill?: (message: GenerateLocalMessageType<T>) => void, addOffset = 0): Promise<GenerateLocalMessageType<T>> {\r\n    const {id, mid} = this.generateLocalMessageId(addOffset);\r\n    let message: Omit<Message.message | Message.messageService, 'message'> & {message?: string} = {\r\n      _: service ? 'messageService' : 'message',\r\n      date: 0,\r\n      id,\r\n      mid,\r\n      peer_id: await this.managers.appPeersManager.getOutputPeer(this.peerId),\r\n      pFlags: {\r\n        local: true\r\n      }\r\n    };\r\n\r\n    if(!service) {\r\n      message.message = '';\r\n    }/*  else {\r\n      (message as Message.messageService).action = {} as any;\r\n    } */\r\n\r\n    assumeType<GenerateLocalMessageType<T>>(message);\r\n\r\n    fill && fill(message);\r\n\r\n    const savedMessages = await this.managers.appMessagesManager.saveMessages([message], {storage: new Map() as any});\r\n    message = savedMessages[0];\r\n    message.mid = mid;\r\n    return message as any;\r\n  }\r\n\r\n  public getViewportSlice() {\r\n    // this.log.trace('viewport slice');\r\n    return getViewportSlice({\r\n      overflowElement: this.scrollable.container,\r\n      selector: '.bubbles-date-group .bubble:not(.is-date)',\r\n      extraSize: Math.max(700, windowSize.height) * 2\r\n    });\r\n  }\r\n\r\n  public deleteViewportSlice(slice: ReturnType<ChatBubbles['getViewportSlice']>, ignoreScrollSaving?: boolean) {\r\n    if(DO_NOT_SLICE_VIEWPORT_ON_RENDER) {\r\n      return;\r\n    }\r\n\r\n    const {invisibleTop, invisibleBottom} = slice;\r\n    const invisible = invisibleTop.concat(invisibleBottom);\r\n    if(!invisible.length) {\r\n      return;\r\n    }\r\n\r\n    if(invisibleTop.length) {\r\n      this.setLoaded('top', false);\r\n      this.getHistoryTopPromise = undefined;\r\n    }\r\n\r\n    if(invisibleBottom.length) {\r\n      this.setLoaded('bottom', false);\r\n      this.getHistoryBottomPromise = undefined;\r\n    }\r\n\r\n    const mids = invisible.map(({element}) => +element.dataset.mid);\r\n\r\n    let scrollSaver: ScrollSaver;\r\n    if(/* !!invisibleTop.length !== !!invisibleBottom.length &&  */!ignoreScrollSaving) {\r\n      scrollSaver = this.createScrollSaver(!!invisibleTop.length);\r\n      scrollSaver.save();\r\n    }\r\n\r\n    this.deleteMessagesByIds(mids, false, true);\r\n\r\n    if(scrollSaver) {\r\n      scrollSaver.restore();\r\n    } else if(invisibleTop.length) {\r\n      this.scrollable.lastScrollPosition = this.scrollable.scrollTop;\r\n    }\r\n  }\r\n\r\n  public sliceViewport(ignoreHeavyAnimation?: boolean) {\r\n    // Safari cannot reset the scroll.\r\n    if(IS_SAFARI || (this.isHeavyAnimationInProgress && !ignoreHeavyAnimation) || DO_NOT_SLICE_VIEWPORT) {\r\n      return;\r\n    }\r\n\r\n    // const scrollSaver = new ScrollSaver(this.scrollable, true);\r\n    // scrollSaver.save();\r\n    const slice = this.getViewportSlice();\r\n    // if(IS_SAFARI) slice.invisibleTop = [];\r\n    this.deleteViewportSlice(slice);\r\n    // scrollSaver.restore();\r\n  }\r\n\r\n  private async setLoaded(side: SliceSides, value: boolean, checkPlaceholders = true) {\r\n    const willChange = this.scrollable.loadedAll[side] !== value;\r\n    if(!willChange) {\r\n      return;\r\n    }\r\n\r\n    const log = this.log.bindPrefix('setLoaded');\r\n    log('change', side, value);\r\n\r\n    this.scrollable.loadedAll[side] = value;\r\n    this.scrollable.onScroll(); // ! WARNING\r\n    // return;\r\n\r\n    if(!checkPlaceholders) {\r\n      return;\r\n    }\r\n\r\n    if(!this.chat.isRestricted) {\r\n      if(side === 'bottom' && this.chat.isBroadcast/*  && false */) {\r\n        this.toggleSponsoredMessage(value);\r\n      }\r\n\r\n      if(side === 'top' && value && this.chat.isBot) {\r\n        return this.renderBotPlaceholder();\r\n      }\r\n    }\r\n\r\n    return this.checkIfEmptyPlaceholderNeeded();\r\n  }\r\n\r\n  private async toggleSponsoredMessage(value: boolean) {\r\n    const _log = this.log.bindPrefix('sponsored');\r\n    _log('checking');\r\n    const {mid} = this.generateLocalMessageId(SPONSORED_MESSAGE_ID_OFFSET);\r\n    if(value) {\r\n      const middleware = this.getMiddleware(() => {\r\n        return this.scrollable.loadedAll.bottom && !this.bubbles[mid] && this.getSponsoredMessagePromise === promise;\r\n      });\r\n\r\n      const promise = this.getSponsoredMessagePromise = this.managers.appChatsManager.getSponsoredMessage(this.peerId.toChatId())\r\n      .then(async(sponsoredMessages) => {\r\n        const sponsoredMessage = sponsoredMessages.messages[0];\r\n        if(!sponsoredMessage) {\r\n          _log('no message');\r\n          return;\r\n        }\r\n\r\n        const messagePromise = this.generateLocalFirstMessage(false, (message) => {\r\n          message.message = sponsoredMessage.message;\r\n          message.from_id = sponsoredMessage.from_id;\r\n          message.entities = sponsoredMessage.entities;\r\n          message.pFlags.sponsored = true;\r\n          message.sponsoredMessage = sponsoredMessage;\r\n        }, SPONSORED_MESSAGE_ID_OFFSET);\r\n\r\n        return Promise.all([\r\n          messagePromise,\r\n          this.getHistoryTopPromise, // wait for top load and execute rendering after or with it\r\n          this.messagesQueuePromise\r\n        ]).then(([message]) => {\r\n          if(!middleware()) return;\r\n          // this.processLocalMessageRender(message);\r\n          _log('rendering', message);\r\n          const promise = this.performHistoryResult({history: [message]}, false);\r\n        });\r\n      }).finally(() => {\r\n        this.getSponsoredMessagePromise = undefined;\r\n      });\r\n    } else {\r\n      _log('clearing rendered', mid);\r\n      this.deleteMessagesByIds([mid]);\r\n      this.getSponsoredMessagePromise = undefined;\r\n    }\r\n  }\r\n\r\n  private async renderBotPlaceholder() {\r\n    const _log = this.log.bindPrefix('bot placeholder');\r\n\r\n    const middleware = this.getMiddleware();\r\n    const result = await this.managers.acknowledged.appProfileManager.getProfile(this.peerId.toUserId());\r\n    _log('getting profile, cached:', result.cached);\r\n    const processPromise = result.result.then(async(userFull) => {\r\n      if(!middleware()) {\r\n        return;\r\n      }\r\n\r\n      if(!userFull.bot_info?.description) {\r\n        _log.warn('no description');\r\n        return this.checkIfEmptyPlaceholderNeeded();\r\n      }\r\n\r\n      const message = await this.generateLocalFirstMessage(false, (message) => {\r\n        const botInfo = userFull.bot_info;\r\n        message.message = botInfo.description;\r\n        if(botInfo.description_document) message.media = {_: 'messageMediaDocument', document: botInfo.description_document};\r\n        if(botInfo.description_photo) message.media = {_: 'messageMediaPhoto', photo: botInfo.description_photo};\r\n      });\r\n\r\n      if(!middleware()) {\r\n        return;\r\n      }\r\n\r\n      _log('rendering');\r\n      const renderPromise = this.processLocalMessageRender(message, !result.cached).then(() => {\r\n        _log('done');\r\n      });\r\n\r\n      return {renderPromise};\r\n    });\r\n\r\n    if(!result.cached) {\r\n      return;\r\n    }\r\n\r\n    return processPromise;\r\n  }\r\n\r\n  public async checkIfEmptyPlaceholderNeeded() {\r\n    if(this.scrollable.loadedAll.top &&\r\n      this.scrollable.loadedAll.bottom &&\r\n      this.emptyPlaceholderBubble === undefined &&\r\n      (\r\n        this.chat.isRestricted ||\r\n        !(await this.chat.getHistoryStorage()).count ||\r\n        (\r\n          !Object.keys(this.bubbles).length ||\r\n          // ! WARNING ! ! ! ! ! ! REPLACE LINE ABOVE WITH THESE\r\n          Object.keys(this.bubbles).length &&\r\n          !this.getRenderedLength()\r\n        ) ||\r\n        (this.chat.type === 'scheduled' && !Object.keys(this.bubbles).length)\r\n      )\r\n    ) {\r\n      this.log('inject empty peer placeholder');\r\n\r\n      const message = await this.generateLocalFirstMessage(true);\r\n      return {renderPromise: this.processLocalMessageRender(message)};\r\n    }\r\n  }\r\n\r\n  public getHistory1(maxId?: number, reverse?: boolean, isBackLimit?: boolean, additionMsgId?: number, justLoad?: boolean) {\r\n    const middleware = this.getMiddleware(justLoad ? undefined : () => {\r\n      return (reverse ? this.getHistoryTopPromise : this.getHistoryBottomPromise) === waitPromise;\r\n    });\r\n\r\n    const result = this.getHistory(maxId, reverse, isBackLimit, additionMsgId, justLoad, middleware);\r\n    const waitPromise = result.then((res) => res && (res.waitPromise || res.promise));\r\n\r\n    (reverse ? this.getHistoryTopPromise = waitPromise : this.getHistoryBottomPromise = waitPromise);\r\n    waitPromise.then(() => {\r\n      if(!middleware()) {\r\n        return;\r\n      }\r\n\r\n      (reverse ? this.getHistoryTopPromise = undefined : this.getHistoryBottomPromise = undefined);\r\n\r\n      if(!justLoad) {\r\n        // preload more\r\n        // if(!isFirstMessageRender) {\r\n        if(this.chat.type === 'chat'/*  || this.chat.type === 'discussion' */) {\r\n          /* const storage = this.appMessagesManager.getHistoryStorage(peerId, this.chat.threadId);\r\n            const isMaxIdInHistory = storage.history.indexOf(maxId) !== -1;\r\n            if(isMaxIdInHistory || true) { // * otherwise it is a search or jump */\r\n          setTimeout(() => {\r\n            if(reverse) {\r\n              this.loadMoreHistory(true, true);\r\n            } else {\r\n              this.loadMoreHistory(false, true);\r\n            }\r\n          }, 0);\r\n          // }\r\n        }\r\n        // }\r\n\r\n        // this.scrollable.onScroll();\r\n      }\r\n    });\r\n\r\n    return result;\r\n  }\r\n\r\n  /**\r\n   * Load and render history\r\n   * @param maxId max message id\r\n   * @param reverse 'true' means up\r\n   * @param isBackLimit is search\r\n   * @param additionMsgId for the last message\r\n   * @param justLoad do not render\r\n   */\r\n  public async getHistory(\r\n    maxId = 0,\r\n    reverse = false,\r\n    isBackLimit = false,\r\n    additionMsgId = 0,\r\n    justLoad = false,\r\n    middleware?: () => boolean\r\n  ): Promise<{cached: boolean, promise: Promise<void>, waitPromise: Promise<any>}> {\r\n    const peerId = this.peerId;\r\n\r\n    const isBroadcast = this.chat.isBroadcast;\r\n    // console.time('appImManager call getHistory');\r\n    const pageCount = Math.min(30, windowSize.height / 40/*  * 1.25 */ | 0);\r\n    // const loadCount = Object.keys(this.bubbles).length > 0 ? 50 : pageCount;\r\n    const realLoadCount = isBroadcast ? 20 : (Object.keys(this.bubbles).length > 0 ? Math.max(35, pageCount) : pageCount);\r\n    // const realLoadCount = pageCount;//const realLoadCount = 50;\r\n    let loadCount = realLoadCount;\r\n\r\n    /* if(TEST_SCROLL) {\r\n      //loadCount = 1;\r\n      if(Object.keys(this.bubbles).length > 0)\r\n      return {cached: false, promise: Promise.resolve(true)};\r\n    } */\r\n    if(TEST_SCROLL !== undefined) {\r\n      if(TEST_SCROLL) {\r\n        if(Object.keys(this.bubbles).length > 0) {\r\n          --TEST_SCROLL;\r\n        }\r\n      } else {\r\n        return {cached: false, promise: Promise.resolve(), waitPromise: Promise.resolve()};\r\n      }\r\n    }\r\n\r\n    // //console.time('render history total');\r\n\r\n    let backLimit = 0;\r\n    if(isBackLimit) {\r\n      backLimit = loadCount;\r\n\r\n      if(!reverse) { // if not jump\r\n        loadCount = 0;\r\n        // maxId = this.appMessagesManager.incrementMessageId(maxId, 1);\r\n      }\r\n    }\r\n\r\n    let additionMsgIds: number[];\r\n    if(additionMsgId && !isBackLimit) {\r\n      if(this.chat.type === 'pinned') {\r\n        additionMsgIds = [additionMsgId];\r\n      } else {\r\n        const historyStorage = await this.chat.getHistoryStorage();\r\n        const slice = historyStorage.history.slice;\r\n        if(slice.length < loadCount && !slice.isEnd(SliceEnd.Both)) {\r\n          additionMsgIds = slice.slice();\r\n\r\n          // * filter last album, because we don't know is it the last item\r\n          for(let i = additionMsgIds.length - 1; i >= 0; --i) {\r\n            const message = await this.chat.getMessage(additionMsgIds[i]);\r\n            if((message as Message.message)?.grouped_id) additionMsgIds.splice(i, 1);\r\n            else break;\r\n          }\r\n\r\n          maxId = additionMsgIds[additionMsgIds.length - 1] || maxId;\r\n        }\r\n      }\r\n    }\r\n\r\n    /* const result = additionMsgID ?\r\n      {history: [additionMsgID]} :\r\n      appMessagesManager.getHistory(this.peerId, maxId, loadCount, backLimit); */\r\n    let result: AckedResult<MyHistoryResult> = await this.requestHistory(maxId, loadCount, backLimit) as any;\r\n    let resultPromise: typeof result['result'];\r\n\r\n    // const isFirstMessageRender = !!additionMsgID && result.cached && !appMessagesManager.getMessage(additionMsgID).grouped_id;\r\n    const isAdditionRender = additionMsgIds?.length && !result.cached;\r\n    const isFirstMessageRender = (this.isFirstLoad && backLimit && !result.cached) || isAdditionRender;\r\n    if(isAdditionRender) {\r\n      resultPromise = result.result;\r\n\r\n      result = {\r\n        cached: true,\r\n        result: Promise.resolve({history: additionMsgIds})\r\n      };\r\n\r\n      // additionMsgID = 0;\r\n    }\r\n\r\n    this.isFirstLoad = false;\r\n\r\n    const processResult = async(historyResult: Awaited<typeof result['result']>) => {\r\n      if((historyResult as HistoryResult).isEnd?.top) {\r\n        if(this.chat.type === 'discussion') { // * inject discussion start\r\n          const serviceStartMessageId = await this.managers.appMessagesManager.getThreadServiceMessageId(this.peerId, this.chat.threadId);\r\n          if(serviceStartMessageId) historyResult.history.push(serviceStartMessageId);\r\n          const mids = await this.chat.getMidsByMid(this.chat.threadId);\r\n          historyResult.history.push(...mids.reverse());\r\n        }\r\n\r\n        // synchronize bot placeholder appearance\r\n        await this.managers.appProfileManager.getProfileByPeerId(peerId);\r\n\r\n        // await this.setLoaded('top', true);\r\n      }\r\n    };\r\n\r\n    const sup = (historyResult: Awaited<typeof result['result']>) => {\r\n      return getHeavyAnimationPromise().then(() => {\r\n        return processResult(historyResult);\r\n      }).then(() => {\r\n        if(!isAdditionRender && additionMsgId) {\r\n          historyResult.history.unshift(additionMsgId);\r\n        }\r\n\r\n        return this.performHistoryResult(historyResult, reverse);\r\n      });\r\n    };\r\n\r\n    const processPromise = (_promise: typeof result['result']) => {\r\n      const promise = Promise.resolve(_promise).then((result) => {\r\n        if(middleware && !middleware()) {\r\n          throw PEER_CHANGED_ERROR;\r\n        }\r\n\r\n        if(justLoad) {\r\n          //   -  \r\n          this.scrollable.onScroll();\r\n          // fastRaf(() => {\r\n          //   this.scrollable.checkForTriggers();\r\n          // });\r\n          return;\r\n        }\r\n\r\n        return sup(result);\r\n      }, (err) => {\r\n        this.log.error('getHistory error:', err);\r\n        throw err;\r\n      });\r\n\r\n      return promise;\r\n    };\r\n\r\n    let promise: Promise<void>, cached: boolean;\r\n    if(!result.cached) {\r\n      cached = false;\r\n      promise = processPromise(result.result);\r\n    } else if(justLoad) {\r\n      //   -  \r\n      this.scrollable.onScroll();\r\n      return null;\r\n    } else {\r\n      cached = true;\r\n      promise = sup(await result.result);\r\n    }\r\n\r\n    const waitPromise = isAdditionRender ? processPromise(resultPromise) : promise;\r\n\r\n    if(isFirstMessageRender && rootScope.settings.animationsEnabled/*  && false */) {\r\n      let times = isAdditionRender ? 2 : 1;\r\n      this.messagesQueueOnRenderAdditional = () => {\r\n        this.log('messagesQueueOnRenderAdditional');\r\n\r\n        if(--times) return;\r\n\r\n        this.messagesQueueOnRenderAdditional = undefined;\r\n\r\n        const promise = this.animateAsLadder(additionMsgId, additionMsgIds, isAdditionRender, backLimit, maxId);\r\n        promise.then(() => {\r\n          setTimeout(() => { // preload messages\r\n            this.loadMoreHistory(reverse, true);\r\n          }, 0);\r\n        });\r\n      };\r\n    } else {\r\n      this.messagesQueueOnRenderAdditional = undefined;\r\n    }\r\n\r\n    if(justLoad) {\r\n      return null;\r\n    }\r\n\r\n    return {cached, promise, waitPromise};\r\n  }\r\n\r\n  public async setUnreadDelimiter() {\r\n    if(!(this.chat.type === 'chat' || this.chat.type === 'discussion')) {\r\n      return;\r\n    }\r\n\r\n    if(this.attachedUnreadBubble) {\r\n      return;\r\n    }\r\n\r\n    const historyMaxId = await this.chat.getHistoryMaxId();\r\n    let readMaxId = await this.managers.appMessagesManager.getReadMaxIdIfUnread(this.peerId, this.chat.threadId);\r\n    if(!readMaxId) return;\r\n\r\n    readMaxId = Object.keys(this.bubbles)\r\n    .filter((mid) => !this.bubbles[mid].classList.contains('is-out'))\r\n    .map((i) => +i)\r\n    .sort((a, b) => a - b)\r\n    .find((i) => i > readMaxId);\r\n\r\n    if(readMaxId && this.bubbles[readMaxId]) {\r\n      const bubble = this.bubbles[readMaxId];\r\n      if(this.firstUnreadBubble && this.firstUnreadBubble !== bubble) {\r\n        this.firstUnreadBubble.classList.remove('is-first-unread');\r\n        this.firstUnreadBubble = null;\r\n      }\r\n\r\n      if(readMaxId !== historyMaxId) {\r\n        bubble.classList.add('is-first-unread');\r\n      }\r\n\r\n      this.firstUnreadBubble = bubble;\r\n      this.attachedUnreadBubble = true;\r\n    }\r\n  }\r\n\r\n  public deleteEmptyDateGroups() {\r\n    const mustBeCount = this.stickyIntersector ? STICKY_OFFSET : 1;\r\n    let deleted = false;\r\n    for(const i in this.dateMessages) {\r\n      const dateMessage = this.dateMessages[i];\r\n\r\n      if(dateMessage.container.childElementCount === mustBeCount) { // only date div + sentinel div\r\n        dateMessage.container.remove();\r\n        if(this.stickyIntersector) {\r\n          this.stickyIntersector.unobserve(dateMessage.container, dateMessage.div);\r\n        }\r\n        delete this.dateMessages[i];\r\n        deleted = true;\r\n\r\n        // * no sense in it\r\n        /* if(dateMessage.div === this.previousStickyDate) {\r\n          this.previousStickyDate = undefined;\r\n        } */\r\n      }\r\n    }\r\n\r\n    if(!deleted) {\r\n      return;\r\n    }\r\n\r\n    if(!Object.keys(this.dateMessages).length) {\r\n      this.container.classList.remove('has-groups');\r\n    }\r\n\r\n    this.checkIfEmptyPlaceholderNeeded();\r\n    this.setStickyDateManually();\r\n  }\r\n}\r\n\r\nexport function generateTail() {\r\n  const svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');\r\n  svg.setAttributeNS(null, 'viewBox', '0 0 11 20');\r\n  svg.setAttributeNS(null, 'width', '11');\r\n  svg.setAttributeNS(null, 'height', '20');\r\n  svg.classList.add('bubble-tail');\r\n\r\n  const use = document.createElementNS('http://www.w3.org/2000/svg', 'use');\r\n  use.setAttributeNS(null, 'href', '#message-tail-filled');\r\n\r\n  svg.append(use);\r\n\r\n  return svg;\r\n}\r\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport {copyTextToClipboard} from '../clipboard';\n// import SelectionSaver from \"../selectionSaver\";\n// import selectElementContents from \"./selectElementContents\";\n\nexport default function copyFromElement(element: HTMLElement) {\n  copyTextToClipboard(element.textContent);\n  // const saver = new SelectionSaver();\n  // saver.save();\n  // selectElementContents(element);\n  // document.execCommand('copy');\n  // saver.restore();\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport PopupElement, {addCancelButton} from '.';\nimport PopupPeer, {PopupPeerButtonCallbackCheckboxes, PopupPeerOptions} from './peer';\nimport rootScope from '../../lib/rootScope';\nimport {FormatterArguments, LangPackKey} from '../../lib/langPack';\nimport PeerTitle from '../peerTitle';\n\nexport default class PopupPinMessage {\n  constructor(private peerId: PeerId, private mid: number, private unpin?: true, private onConfirm?: () => void) {\n    this.construct();\n  }\n\n  private async construct() {\n    const {peerId, mid, unpin, onConfirm} = this;\n    let title: LangPackKey, description: LangPackKey, descriptionArgs: FormatterArguments;\n    const buttons: PopupPeerOptions['buttons'] = [], checkboxes: PopupPeerOptions['checkboxes'] = [];\n\n    const managers = PopupElement.MANAGERS;\n\n    const canUnpin = await managers.appPeersManager.canPinMessage(peerId);\n\n    const callback = (checked: PopupPeerButtonCallbackCheckboxes, oneSide?: boolean, silent?: boolean) => {\n      setTimeout(() => { // * ,   document.elementFromPoint  popup-peer    \n        let promise: Promise<any>;\n        if(unpin && !mid) {\n          if(canUnpin) {\n            promise = managers.appMessagesManager.unpinAllMessages(peerId);\n          } else {\n            promise = managers.appMessagesManager.hidePinnedMessages(peerId);\n          }\n        } else {\n          promise = managers.appMessagesManager.updatePinnedMessage(peerId, mid, unpin, silent, oneSide);\n        }\n\n        if(onConfirm) {\n          promise.then(onConfirm);\n        }\n      }, 300);\n    };\n\n    if(unpin) {\n      let buttonText: LangPackKey = 'UnpinMessage';\n      if(!mid) {\n        if(canUnpin) {\n          title = 'Popup.Unpin.AllTitle';\n          description = 'Chat.UnpinAllMessagesConfirmation';\n          descriptionArgs = ['' + ((await managers.appMessagesManager.getPinnedMessagesCount(peerId)) || 1)];\n        } else {\n          title = 'Popup.Unpin.HideTitle';\n          description = 'Popup.Unpin.HideDescription';\n          buttonText = 'Popup.Unpin.Hide';\n        }\n      } else {\n        title = 'UnpinMessageAlertTitle';\n        description = 'Chat.Confirm.Unpin';\n      }\n\n      buttons.push({\n        langKey: buttonText,\n        isDanger: true,\n        callback\n      });\n    } else {\n      title = 'PinMessageAlertTitle';\n      const pinButtonText: LangPackKey = 'PinMessage';\n\n      if(peerId.isAnyChat()) {\n        buttons.push({\n          langKey: pinButtonText,\n          callback: (checked) => callback(checked, false, !checked.size)\n        });\n\n        if(await managers.appChatsManager.isBroadcast(peerId.toChatId())) {\n          description = 'PinMessageAlertChannel';\n        } else {\n          description = 'PinMessageAlert';\n\n          checkboxes.push({\n            text: 'PinNotify',\n            checked: true\n          });\n        }\n      } else {\n        description = 'PinMessageAlertChat';\n\n        if(peerId === rootScope.myId) {\n          buttons.push({\n            langKey: pinButtonText,\n            callback\n          });\n        } else {\n          buttons.push({\n            langKey: pinButtonText,\n            callback: (checked) => callback(checked, !checked.size)\n          });\n\n          checkboxes.push({\n            text: 'PinAlsoFor',\n            textArgs: [new PeerTitle({peerId}).element],\n            checked: true\n          });\n        }\n      }\n    }\n\n    addCancelButton(buttons);\n\n    const popup = new PopupPeer('popup-delete-chat', {\n      peerId,\n      titleLangKey: title,\n      descriptionLangKey: description,\n      descriptionLangArgs: descriptionArgs,\n      buttons,\n      checkboxes\n    });\n\n    popup.show();\n  }\n}\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nexport default function isSelectionEmpty(selection = window.getSelection()) {\r\n  if(!selection || !selection.rangeCount) {\r\n    return true;\r\n  }\r\n\r\n  const selectionRange = selection.getRangeAt(0);\r\n  if(!selectionRange.toString() || !selectionRange.START_TO_END) {\r\n    return true;\r\n  }\r\n\r\n  return false;\r\n}\r\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport appDownloadManager from '../lib/appManagers/appDownloadManager';\nimport lottieLoader from '../lib/rlottie/lottieLoader';\nimport rootScope from '../lib/rootScope';\nimport {getEmojiToneIndex} from '../vendor/emoji';\nimport mediaSizes from './mediaSizes';\nimport {saveLottiePreview} from './saveLottiePreview';\n\nexport default function preloadAnimatedEmojiSticker(emoji: string, width?: number, height?: number) {\n  return rootScope.managers.appStickersManager.preloadAnimatedEmojiSticker(emoji).then(({doc}) => {\n    if(!doc) {\n      return;\n    }\n\n    return appDownloadManager.downloadMedia({media: doc})\n    .then(async(blob) => {\n      const mediaSize = mediaSizes.active.emojiSticker;\n      const toneIndex = getEmojiToneIndex(emoji);\n      const animation = await lottieLoader.loadAnimationWorker({\n        container: undefined,\n        animationData: blob,\n        width: width ?? mediaSize.width,\n        height: height ?? mediaSize.height,\n        name: 'doc' + doc.id,\n        autoplay: false,\n        loop: false,\n        toneIndex\n      }, 'none');\n\n      animation.addEventListener('firstFrame', () => {\n        saveLottiePreview(doc, animation.canvas[0], toneIndex);\n        animation.remove();\n      }, {once: true});\n    });\n  });\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport {ReportReason} from '../../layer';\nimport InputField from '../inputField';\nimport {toastNew} from '../toast';\nimport wrapStickerEmoji from '../wrappers/stickerEmoji';\nimport PopupPeer from './peer';\n\nexport default class PopupReportMessagesConfirm extends PopupPeer {\n  public static STICKER_EMOJI = '';\n  constructor(peerId: PeerId, mids: number[], reason: ReportReason['_'], onConfirm?: () => void) {\n    super('popup-report-messages-confirm', {\n      noTitle: true,\n      descriptionLangKey: 'ReportInfo',\n      buttons: [{\n        langKey: 'ReportChat',\n        callback: () => {\n          if(!inputField.isValid()) {\n            return;\n          }\n\n          onConfirm && onConfirm();\n          this.managers.appMessagesManager.reportMessages(peerId, mids, reason, inputField.value).then((bool) => {\n            if(!bool) return;\n\n            toastNew({\n              langPackKey: 'ReportSentInfo'\n            });\n          });\n        }\n      }],\n      body: true\n    });\n\n    const div = document.createElement('div');\n    const size = 100;\n    wrapStickerEmoji({\n      div,\n      emoji: PopupReportMessagesConfirm.STICKER_EMOJI,\n      width: size,\n      height: size\n    }).then(({render}) => render).finally(() => {\n      this.show();\n    });\n\n    this.header.append(div);\n\n    const inputField = new InputField({\n      label: 'ReportHint',\n      maxLength: 512,\n      placeholder: 'ReportChatDescription'\n    });\n\n    inputField.input.addEventListener('input', () => {\n      this.buttons[0].element.toggleAttribute('disabled', !inputField.isValid());\n    });\n\n    this.body.append(inputField.container);\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport {attachClickEvent} from '../../helpers/dom/clickEvent';\nimport findUpClassName from '../../helpers/dom/findUpClassName';\nimport whichChild from '../../helpers/dom/whichChild';\nimport preloadAnimatedEmojiSticker from '../../helpers/preloadAnimatedEmojiSticker';\nimport {ReportReason} from '../../layer';\nimport {LangPackKey} from '../../lib/langPack';\nimport Button from '../button';\nimport PopupPeer from './peer';\nimport PopupReportMessagesConfirm from './reportMessagesConfirm';\n\nexport default class PopupReportMessages extends PopupPeer {\n  constructor(peerId: PeerId, mids: number[], onConfirm?: () => void) {\n    super('popup-report-messages', {titleLangKey: 'ChatTitle.ReportMessages', buttons: [], body: true});\n\n    mids = mids.slice();\n\n    const buttons: [LangPackKey, ReportReason['_']][] = [\n      ['ReportChatSpam', 'inputReportReasonSpam'],\n      ['ReportChatViolence', 'inputReportReasonViolence'],\n      ['ReportChatChild', 'inputReportReasonChildAbuse'],\n      ['ReportChatPornography', 'inputReportReasonPornography'],\n      ['ReportChatOther', 'inputReportReasonOther'],\n      ['ReportChatPersonalDetails', 'inputReportReasonPersonalDetails'],\n      ['ReportChatIllegalDrugs', 'inputReportReasonIllegalDrugs']\n    ];\n\n    const className = 'btn-primary btn-transparent';\n    buttons.forEach((b) => {\n      const button = Button(className, {/* icon: 'edit',  */text: b[0]});\n      this.body.append(button);\n    });\n\n    const preloadStickerPromise = preloadAnimatedEmojiSticker(PopupReportMessagesConfirm.STICKER_EMOJI);\n\n    attachClickEvent(this.body, (e) => {\n      const target = findUpClassName(e.target, 'btn-primary');\n      const reason = buttons[whichChild(target)][1];\n\n      preloadStickerPromise.then(() => {\n        this.hide();\n\n        new PopupReportMessagesConfirm(peerId, mids, reason, onConfirm);\n      });\n    }, {listenerSetter: this.listenerSetter});\n\n    this.body.style.margin = '0 -1rem';\n    this.buttonsEl.style.marginTop = '.5rem';\n\n    this.show();\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport I18n, {i18n} from '../../lib/langPack';\nimport PopupPeer from './peer';\n\nexport default class PopupSponsored extends PopupPeer {\n  constructor() {\n    super('popup-sponsored', {\n      titleLangKey: 'Chat.Message.Sponsored.What',\n      descriptionLangKey: 'Chat.Message.Ad.Text',\n      descriptionLangArgs: [i18n('Chat.Message.Sponsored.Link')],\n      buttons: [{\n        langKey: 'OK',\n        isCancel: true\n      }, {\n        langKey: 'Chat.Message.Ad.ReadMore',\n        callback: () => {\n          window.open(I18n.format('Chat.Message.Sponsored.Link', true));\n        },\n        isCancel: true\n      }],\n      scrollable: true\n    });\n\n    this.scrollable.append(this.description);\n\n    this.show();\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport PopupElement from '.';\nimport {Message} from '../../layer';\nimport {SettingSection} from '../sidebarLeft';\nimport ReactionsElement from '../chat/reactions';\nimport {horizontalMenu} from '../horizontalMenu';\nimport Scrollable from '../scrollable';\nimport ScrollableLoader from '../../helpers/scrollableLoader';\nimport appDialogsManager from '../../lib/appManagers/appDialogsManager';\nimport replaceContent from '../../helpers/dom/replaceContent';\nimport {wrapSticker} from '../wrappers';\nimport ReactionElement from '../chat/reaction';\nimport getUserStatusString from '../wrappers/getUserStatusString';\n\nexport default class PopupReactedList extends PopupElement {\n  constructor(\n    private message: Message.message\n  ) {\n    super('popup-reacted-list', {closable: true, overlayClosable: true, body: true});\n\n    this.init();\n  }\n\n  private async init() {\n    const message = await this.managers.appMessagesManager.getGroupsFirstMessage(this.message);\n\n    const canViewReadParticipants = await this.managers.appMessagesManager.canViewMessageReadParticipants(message);\n\n    // this.body.append(generateDelimiter());\n\n    const reactionsElement = new ReactionsElement();\n    const newMessage: Message.message = {\n      ...message,\n      mid: 0,\n      id: 0,\n      reactions: {\n        _: 'messageReactions',\n        results: [],\n\n        ...message.reactions,\n\n        pFlags: {},\n        recent_reactions: []\n      }\n    };\n\n    newMessage.reactions.results = newMessage.reactions.results.map((reactionCount) => {\n      return {\n        ...reactionCount,\n        pFlags: {}\n      };\n    });\n\n    reactionsElement.init(newMessage, 'block');\n    reactionsElement.render();\n    reactionsElement.classList.add('no-stripe');\n    reactionsElement.classList.remove('has-no-reactions');\n\n    reactionsElement.append(this.btnClose);\n\n    this.header.append(reactionsElement);\n\n    const tabsContainer = document.createElement('div');\n    tabsContainer.classList.add('tabs-container');\n    tabsContainer.dataset.animation = 'tabs';\n\n    const loaders: Map<HTMLElement, ScrollableLoader> = new Map();\n\n    let hasAllReactions = false;\n    if(newMessage.reactions.results.length) {\n      const reaction = this.createFakeReaction('reactions', newMessage.reactions.results.reduce((acc, r) => acc + r.count, 0));\n\n      reactionsElement.prepend(reaction);\n      newMessage.reactions.results.unshift(reaction.reactionCount);\n      hasAllReactions = true;\n    }\n\n    let hasReadParticipants = false;\n    if(canViewReadParticipants) {\n      try {\n        const readUserIds = await this.managers.appMessagesManager.getMessageReadParticipants(message.peerId, message.mid);\n        if(!readUserIds.length) {\n          throw '';\n        }\n\n        const reaction = this.createFakeReaction('checks', readUserIds.length);\n\n        reactionsElement.prepend(reaction);\n        newMessage.reactions.results.unshift(reaction.reactionCount);\n        hasReadParticipants = true;\n      } catch(err) {\n\n      }\n    }\n\n    newMessage.reactions.results.forEach((reactionCount) => {\n      const scrollable = new Scrollable(undefined);\n      scrollable.container.classList.add('tabs-tab');\n\n      const section = new SettingSection({\n        noShadow: true,\n        noDelimiter: true\n      });\n\n      const chatlist = appDialogsManager.createChatList({\n        dialogSize: 72\n      });\n\n      appDialogsManager.setListClickListener(chatlist, () => {\n        this.hide();\n      }, undefined, false, true);\n\n      section.content.append(chatlist);\n      scrollable.container.append(section.container);\n\n      const skipReadParticipants = reactionCount.reaction !== 'checks';\n      const skipReactionsList = reactionCount.reaction === 'checks';\n      if(['checks', 'reactions'].includes(reactionCount.reaction)) {\n        reactionCount.reaction = undefined;\n      }\n\n      let nextOffset: string;\n      const loader = new ScrollableLoader({\n        scrollable,\n        getPromise: async() => {\n          const result = await this.managers.appMessagesManager.getMessageReactionsListAndReadParticipants(message, undefined, reactionCount.reaction, nextOffset, skipReadParticipants, skipReactionsList);\n          nextOffset = result.nextOffset;\n\n          await Promise.all(result.combined.map(async({peerId, reaction}) => {\n            const {dom} = appDialogsManager.addDialogNew({\n              peerId: peerId,\n              autonomous: true,\n              container: chatlist,\n              avatarSize: 54,\n              rippleEnabled: false,\n              meAsSaved: false\n            });\n\n            if(reaction) {\n              const stickerContainer = document.createElement('div');\n              stickerContainer.classList.add('reacted-list-reaction-icon');\n              const availableReaction = await this.managers.appReactionsManager.getReactionCached(reaction);\n\n              wrapSticker({\n                doc: availableReaction.static_icon,\n                div: stickerContainer,\n                width: 24,\n                height: 24\n              });\n\n              dom.listEl.append(stickerContainer);\n            }\n\n            replaceContent(dom.lastMessageSpan, getUserStatusString(await this.managers.appUsersManager.getUser(peerId.toUserId())));\n          }));\n\n          return !nextOffset;\n        }\n      });\n\n      loaders.set(scrollable.container, loader);\n\n      tabsContainer.append(scrollable.container);\n    });\n\n    this.body.append(tabsContainer);\n\n    const selectTab = horizontalMenu(reactionsElement, tabsContainer, (id, tabContent) => {\n      if(id === (reactionsElement.childElementCount - 1)) {\n        return false;\n      }\n\n      const reaction = reactionsElement.children[id] as ReactionElement;\n      const prevId = selectTab.prevId();\n      if(prevId !== -1) {\n        (reactionsElement.children[prevId] as ReactionElement).setIsChosen(false);\n      }\n\n      reaction.setIsChosen(true);\n\n      const loader = loaders.get(tabContent);\n      loader.load();\n    }, undefined, undefined, undefined, this.listenerSetter);\n\n    // selectTab(hasAllReactions && hasReadParticipants ? 1 : 0, false);\n    selectTab(0, false);\n\n    this.show();\n  }\n\n  private createFakeReaction(icon: string, count: number) {\n    const reaction = new ReactionElement();\n    reaction.init('block');\n    reaction.reactionCount = {\n      _: 'reactionCount',\n      count: count,\n      reaction: icon\n    };\n    reaction.setCanRenderAvatars(false);\n    reaction.renderCounter();\n\n    const allReactionsSticker = document.createElement('div');\n    allReactionsSticker.classList.add('reaction-counter', 'reaction-sticker-icon', 'tgico-' + icon);\n    reaction.prepend(allReactionsSticker);\n\n    return reaction;\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport IS_TOUCH_SUPPORTED from '../../environment/touchSupport';\nimport {IS_MOBILE, IS_SAFARI} from '../../environment/userAgent';\nimport assumeType from '../../helpers/assumeType';\nimport callbackify from '../../helpers/callbackify';\nimport {attachClickEvent} from '../../helpers/dom/clickEvent';\nimport findUpClassName from '../../helpers/dom/findUpClassName';\nimport getVisibleRect from '../../helpers/dom/getVisibleRect';\nimport {getMiddleware} from '../../helpers/middleware';\nimport noop from '../../helpers/noop';\nimport {fastRaf} from '../../helpers/schedulers';\nimport {Message, AvailableReaction} from '../../layer';\nimport {AppManagers} from '../../lib/appManagers/managers';\nimport lottieLoader from '../../lib/rlottie/lottieLoader';\nimport RLottiePlayer from '../../lib/rlottie/rlottiePlayer';\nimport rootScope from '../../lib/rootScope';\nimport animationIntersector, {AnimationItemGroup} from '../animationIntersector';\nimport Scrollable, {ScrollableBase, ScrollableX} from '../scrollable';\nimport {wrapSticker} from '../wrappers';\n\nconst REACTIONS_CLASS_NAME = 'btn-menu-reactions';\nconst REACTION_CLASS_NAME = REACTIONS_CLASS_NAME + '-reaction';\n\nconst REACTION_SIZE = 26;\nconst PADDING = 4;\nexport const REACTION_CONTAINER_SIZE = REACTION_SIZE + PADDING * 2;\n\nconst CAN_USE_TRANSFORM = !IS_SAFARI;\n\ntype ChatReactionsMenuPlayers = {\n  select?: RLottiePlayer,\n  appear?: RLottiePlayer,\n  selectWrapper: HTMLElement,\n  appearWrapper: HTMLElement,\n  reaction: string\n};\nexport class ChatReactionsMenu {\n  public widthContainer: HTMLElement;\n  public container: HTMLElement;\n  private reactionsMap: Map<HTMLElement, ChatReactionsMenuPlayers>;\n  public scrollable: ScrollableBase;\n  private animationGroup: AnimationItemGroup;\n  private middleware: ReturnType<typeof getMiddleware>;\n  private message: Message.message;\n\n  constructor(\n    private managers: AppManagers,\n    private type: 'horizontal' | 'vertical',\n    middleware: ChatReactionsMenu['middleware']\n  ) {\n    const widthContainer = this.widthContainer = document.createElement('div');\n    widthContainer.classList.add(REACTIONS_CLASS_NAME + '-container');\n    widthContainer.classList.add(REACTIONS_CLASS_NAME + '-container-' + type);\n\n    const reactionsContainer = this.container = document.createElement('div');\n    reactionsContainer.classList.add(REACTIONS_CLASS_NAME);\n\n    const reactionsScrollable = this.scrollable = type === 'vertical' ? new Scrollable(undefined) : new ScrollableX(undefined);\n    reactionsContainer.append(reactionsScrollable.container);\n    reactionsScrollable.onAdditionalScroll = this.onScroll;\n    reactionsScrollable.setListeners();\n\n    reactionsScrollable.container.classList.add('no-scrollbar');\n\n    // ['big'].forEach((type) => {\n    //   const bubble = document.createElement('div');\n    //   bubble.classList.add(REACTIONS_CLASS_NAME + '-bubble', REACTIONS_CLASS_NAME + '-bubble-' + type);\n    //   reactionsContainer.append(bubble);\n    // });\n\n    this.reactionsMap = new Map();\n    this.animationGroup = `CHAT-MENU-REACTIONS-${Date.now()}`;\n    animationIntersector.setOverrideIdleGroup(this.animationGroup, true);\n\n    if(!IS_TOUCH_SUPPORTED) {\n      reactionsContainer.addEventListener('mousemove', this.onMouseMove);\n    }\n\n    attachClickEvent(reactionsContainer, (e) => {\n      const reactionDiv = findUpClassName(e.target, REACTION_CLASS_NAME);\n      if(!reactionDiv) return;\n\n      const players = this.reactionsMap.get(reactionDiv);\n      if(!players) return;\n\n      this.managers.appReactionsManager.sendReaction(this.message, players.reaction);\n    });\n\n    widthContainer.append(reactionsContainer);\n\n    this.middleware = middleware ?? getMiddleware();\n  }\n\n  public init(message: Message.message) {\n    this.message = message;\n\n    const middleware = this.middleware.get();\n    // const result = Promise.resolve(this.appReactionsManager.getAvailableReactionsForPeer(message.peerId)).then((res) => pause(1000).then(() => res));\n    const result = this.managers.appReactionsManager.getAvailableReactionsByMessage(message);\n    callbackify(result, (reactions) => {\n      if(!middleware() || !reactions.length) return;\n      reactions.forEach((reaction) => {\n        if(reaction.pFlags.premium && !rootScope.premium) return;\n        this.renderReaction(reaction);\n      });\n\n      const setVisible = () => {\n        this.container.classList.add('is-visible');\n      };\n\n      if(result instanceof Promise) {\n        fastRaf(setVisible);\n      } else {\n        setVisible();\n      }\n    });\n  }\n\n  public cleanup() {\n    this.middleware.clean();\n    this.scrollable.removeListeners();\n    this.reactionsMap.clear();\n    animationIntersector.setOverrideIdleGroup(this.animationGroup, false);\n    animationIntersector.checkAnimations(true, this.animationGroup, true);\n  }\n\n  private onScroll = () => {\n    this.reactionsMap.forEach((players, div) => {\n      this.onScrollProcessItem(div, players);\n    });\n  };\n\n  private canUseAnimations() {\n    return rootScope.settings.animationsEnabled && !IS_MOBILE;\n  }\n\n  private renderReaction(reaction: AvailableReaction) {\n    const reactionDiv = document.createElement('div');\n    reactionDiv.classList.add(REACTION_CLASS_NAME);\n\n    const scaleContainer = document.createElement('div');\n    scaleContainer.classList.add(REACTION_CLASS_NAME + '-scale');\n\n    const appearWrapper = document.createElement('div');\n    let selectWrapper: HTMLElement;;\n    appearWrapper.classList.add(REACTION_CLASS_NAME + '-appear');\n\n    if(this.canUseAnimations()) {\n      selectWrapper = document.createElement('div');\n      selectWrapper.classList.add(REACTION_CLASS_NAME + '-select', 'hide');\n    }\n\n    const players: ChatReactionsMenuPlayers = {\n      selectWrapper,\n      appearWrapper,\n      reaction: reaction.reaction\n    };\n    this.reactionsMap.set(reactionDiv, players);\n\n    const middleware = this.middleware.get();\n\n    const hoverScale = IS_TOUCH_SUPPORTED ? 1 : 1.25;\n    const size = REACTION_SIZE * hoverScale;\n\n    const options = {\n      width: size,\n      height: size,\n      skipRatio: 1,\n      needFadeIn: false,\n      withThumb: false,\n      group: this.animationGroup,\n      middleware\n    };\n\n    if(!this.canUseAnimations()) {\n      delete options.needFadeIn;\n      delete options.withThumb;\n\n      wrapSticker({\n        doc: reaction.static_icon,\n        div: appearWrapper,\n        ...options\n      });\n    } else {\n      let isFirst = true;\n      wrapSticker({\n        doc: reaction.appear_animation,\n        div: appearWrapper,\n        play: true,\n        ...options\n      }).then(({render}) => render).then((player) => {\n        assumeType<RLottiePlayer>(player);\n\n        players.appear = player;\n\n        player.addEventListener('enterFrame', (frameNo) => {\n          if(player.maxFrame === frameNo) {\n            selectLoadPromise.then((selectPlayer) => {\n              assumeType<RLottiePlayer>(selectPlayer);\n              appearWrapper.classList.add('hide');\n              selectWrapper.classList.remove('hide');\n\n              if(isFirst) {\n                players.select = selectPlayer;\n                isFirst = false;\n              }\n            }, noop);\n          }\n        });\n      }, noop);\n\n      const selectLoadPromise = wrapSticker({\n        doc: reaction.select_animation,\n        div: selectWrapper,\n        ...options\n      }).then(({render}) => render).then((player) => {\n        assumeType<RLottiePlayer>(player);\n\n        return lottieLoader.waitForFirstFrame(player);\n      }).catch(noop);\n    }\n\n    scaleContainer.append(appearWrapper);\n    selectWrapper && scaleContainer.append(selectWrapper);\n    reactionDiv.append(scaleContainer);\n    this.scrollable.append(reactionDiv);\n  }\n\n  private onScrollProcessItem(div: HTMLElement, players: ChatReactionsMenuPlayers) {\n    // return;\n\n    const scaleContainer = div.firstElementChild as HTMLElement;\n    const visibleRect = getVisibleRect(div, this.scrollable.container);\n    let transform: string;\n    if(!visibleRect) {\n      if(!players.appearWrapper.classList.contains('hide') || !players.appear) {\n        return;\n      }\n\n      if(players.select) {\n        players.select.stop();\n      }\n\n      players.appear.stop();\n      players.appear.autoplay = true;\n      players.appearWrapper.classList.remove('hide');\n      players.selectWrapper.classList.add('hide');\n\n      transform = '';\n    } else if(visibleRect.overflow.left || visibleRect.overflow.right) {\n      const diff = Math.abs(visibleRect.rect.left - visibleRect.rect.right);\n      const scale = Math.min(diff ** 2 / REACTION_CONTAINER_SIZE ** 2, 1);\n\n      transform = 'scale(' + scale + ')';\n    } else {\n      transform = '';\n    }\n\n    if(CAN_USE_TRANSFORM) {\n      scaleContainer.style.transform = transform;\n    }\n  }\n\n  private onMouseMove = (e: MouseEvent) => {\n    const reactionDiv = findUpClassName(e.target, REACTION_CLASS_NAME);\n    if(!reactionDiv) {\n      return;\n    }\n\n    const players = this.reactionsMap.get(reactionDiv);\n    if(!players) {\n      return;\n    }\n\n    // do not play select animation when appearing\n    if(!players.appear?.paused) {\n      return;\n    }\n\n    const player = players.select;\n    if(!player) {\n      return;\n    }\n\n    if(player.paused) {\n      player.autoplay = true;\n      player.restart();\n    }\n  };\n}\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport type {MyDocument} from '../../lib/appManagers/appDocsManager';\r\nimport type Chat from './chat';\r\nimport IS_TOUCH_SUPPORTED from '../../environment/touchSupport';\r\nimport ButtonMenu, {ButtonMenuItemOptions} from '../buttonMenu';\r\nimport PopupDeleteMessages from '../popups/deleteMessages';\r\nimport PopupForward from '../popups/forward';\r\nimport PopupPinMessage from '../popups/unpinMessage';\r\nimport {copyTextToClipboard} from '../../helpers/clipboard';\r\nimport PopupSendNow from '../popups/sendNow';\r\nimport {toast} from '../toast';\r\nimport I18n, {i18n, LangPackKey} from '../../lib/langPack';\r\nimport findUpClassName from '../../helpers/dom/findUpClassName';\r\nimport cancelEvent from '../../helpers/dom/cancelEvent';\r\nimport {attachClickEvent, simulateClickEvent} from '../../helpers/dom/clickEvent';\r\nimport isSelectionEmpty from '../../helpers/dom/isSelectionEmpty';\r\nimport {Message, Poll, Chat as MTChat, MessageMedia, AvailableReaction, MessageEntity, InputStickerSet, StickerSet, Document} from '../../layer';\r\nimport PopupReportMessages from '../popups/reportMessages';\r\nimport assumeType from '../../helpers/assumeType';\r\nimport PopupSponsored from '../popups/sponsored';\r\nimport ListenerSetter from '../../helpers/listenerSetter';\r\nimport {getMiddleware} from '../../helpers/middleware';\r\nimport PeerTitle from '../peerTitle';\r\nimport StackedAvatars from '../stackedAvatars';\r\nimport {IS_APPLE} from '../../environment/userAgent';\r\nimport PopupReactedList from '../popups/reactedList';\r\nimport {ChatReactionsMenu, REACTION_CONTAINER_SIZE} from './reactionsMenu';\r\nimport getPeerId from '../../lib/appManagers/utils/peers/getPeerId';\r\nimport getServerMessageId from '../../lib/appManagers/utils/messageId/getServerMessageId';\r\nimport {AppManagers} from '../../lib/appManagers/managers';\r\nimport positionMenu, {MenuPositionPadding} from '../../helpers/positionMenu';\r\nimport contextMenuController from '../../helpers/contextMenuController';\r\nimport {attachContextMenuListener} from '../../helpers/dom/attachContextMenuListener';\r\nimport filterAsync from '../../helpers/array/filterAsync';\r\nimport appDownloadManager from '../../lib/appManagers/appDownloadManager';\r\nimport {SERVICE_PEER_ID} from '../../lib/mtproto/mtproto_config';\r\nimport {MessagesStorageKey} from '../../lib/appManagers/appMessagesManager';\r\nimport filterUnique from '../../helpers/array/filterUnique';\r\nimport replaceContent from '../../helpers/dom/replaceContent';\r\nimport wrapEmojiText from '../../lib/richTextProcessor/wrapEmojiText';\r\nimport deferredPromise, {CancellablePromise} from '../../helpers/cancellablePromise';\r\nimport PopupStickers from '../popups/stickers';\r\n\r\nexport default class ChatContextMenu {\r\n  private buttons: (ButtonMenuItemOptions & {verify: () => boolean | Promise<boolean>, notDirect?: () => boolean, withSelection?: true, isSponsored?: true, localName?: 'views' | 'emojis'})[];\r\n  private element: HTMLElement;\r\n\r\n  private isSelectable: boolean;\r\n  private isSelected: boolean;\r\n  private target: HTMLElement;\r\n  private isTargetAGroupedItem: boolean;\r\n  private isTextSelected: boolean;\r\n  private isAnchorTarget: boolean;\r\n  private isUsernameTarget: boolean;\r\n  private isSponsored: boolean;\r\n  private isOverBubble: boolean;\r\n  private peerId: PeerId;\r\n  private mid: number;\r\n  private message: Message.message | Message.messageService;\r\n  private noForwards: boolean;\r\n\r\n  private reactionsMenu: ChatReactionsMenu;\r\n  private listenerSetter: ListenerSetter;\r\n  private attachListenerSetter: ListenerSetter;\r\n\r\n  private viewerPeerId: PeerId;\r\n  private middleware: ReturnType<typeof getMiddleware>;\r\n  private canOpenReactedList: boolean;\r\n\r\n  private emojiInputsPromise: CancellablePromise<InputStickerSet.inputStickerSetID[]>;\r\n\r\n  constructor(\r\n    private chat: Chat,\r\n    private managers: AppManagers\r\n  ) {\r\n    this.listenerSetter = new ListenerSetter();\r\n    this.attachListenerSetter = new ListenerSetter();\r\n    this.middleware = getMiddleware();\r\n  }\r\n\r\n  public attachTo(element: HTMLElement) {\r\n    this.attachListenerSetter.removeAll();\r\n\r\n    if(IS_TOUCH_SUPPORTED/*  && false */) {\r\n      attachClickEvent(element, (e) => {\r\n        if(this.chat.selection.isSelecting) {\r\n          return;\r\n        }\r\n\r\n        this.chat.log('touchend', e);\r\n\r\n        const badSelectors = [\r\n          '.name',\r\n          '.peer-title',\r\n          '.reply',\r\n          '.document',\r\n          'audio-element',\r\n          'avatar-element',\r\n          'a',\r\n          '.bubble-beside-button',\r\n          'replies-element',\r\n          '[data-saved-from]:not(.bubble)',\r\n          'poll-element',\r\n          '.attachment',\r\n          '.reply-markup-button'\r\n        ];\r\n        const good = !(e.target as HTMLElement).closest(badSelectors.join(', '));\r\n        if(good) {\r\n          cancelEvent(e);\r\n          // onContextMenu((e as TouchEvent).changedTouches[0]);\r\n          // onContextMenu((e as TouchEvent).changedTouches ? (e as TouchEvent).changedTouches[0] : e as MouseEvent);\r\n          this.onContextMenu(e);\r\n        }\r\n      }, {listenerSetter: this.attachListenerSetter});\r\n    } else attachContextMenuListener(element, this.onContextMenu, this.attachListenerSetter);\r\n  }\r\n\r\n  private onContextMenu = (e: MouseEvent | Touch | TouchEvent) => {\r\n    let bubble: HTMLElement, contentWrapper: HTMLElement;\r\n\r\n    try {\r\n      contentWrapper = findUpClassName(e.target, 'bubble-content-wrapper');\r\n      bubble = contentWrapper ? contentWrapper.parentElement : findUpClassName(e.target, 'bubble');\r\n    } catch(e) {}\r\n\r\n    // ! context menu click by date bubble (there is no pointer-events)\r\n    if(!bubble || bubble.classList.contains('bubble-first')) return;\r\n\r\n    let element = this.element;\r\n    if(e instanceof MouseEvent || e.hasOwnProperty('preventDefault')) (e as any).preventDefault();\r\n    if(element && element.classList.contains('active')) {\r\n      return false;\r\n    }\r\n    if(e instanceof MouseEvent || e.hasOwnProperty('cancelBubble')) (e as any).cancelBubble = true;\r\n\r\n    let mid = +bubble.dataset.mid;\r\n    if(!mid) return;\r\n\r\n    const r = async() => {\r\n      const isSponsored = this.isSponsored = mid < 0;\r\n      this.isSelectable = this.chat.selection.canSelectBubble(bubble);\r\n      this.peerId = this.chat.peerId;\r\n      // this.msgID = msgID;\r\n      this.target = e.target as HTMLElement;\r\n      this.isTextSelected = !isSelectionEmpty();\r\n      this.isAnchorTarget = this.target.tagName === 'A' && (\r\n        (this.target as HTMLAnchorElement).target === '_blank' ||\r\n        this.target.classList.contains('anchor-url')\r\n      );\r\n      this.isUsernameTarget = this.target.tagName === 'A' && this.target.classList.contains('mention');\r\n\r\n      // *         ,     ,    \r\n      if(this.chat.selection.isSelecting && !contentWrapper) {\r\n        if(isSponsored) {\r\n          return;\r\n        }\r\n\r\n        const mids = await this.chat.getMidsByMid(mid);\r\n        if(mids.length > 1) {\r\n          const selectedMid = this.chat.selection.isMidSelected(this.peerId, mid) ?\r\n            mid :\r\n            mids.find((mid) => this.chat.selection.isMidSelected(this.peerId, mid));\r\n          if(selectedMid) {\r\n            mid = selectedMid;\r\n          }\r\n        }\r\n      }\r\n\r\n      this.isOverBubble = !!contentWrapper;\r\n\r\n      const groupedItem = findUpClassName(this.target, 'grouped-item');\r\n      this.isTargetAGroupedItem = !!groupedItem;\r\n      if(groupedItem) {\r\n        this.mid = +groupedItem.dataset.mid;\r\n      } else {\r\n        this.mid = mid;\r\n      }\r\n\r\n      this.isSelected = this.chat.selection.isMidSelected(this.peerId, this.mid);\r\n      this.message = await this.chat.getMessage(this.mid);\r\n      this.noForwards = !isSponsored && !(await this.managers.appMessagesManager.canForward(this.message));\r\n      this.viewerPeerId = undefined;\r\n      this.canOpenReactedList = undefined;\r\n\r\n      const initResult = await this.init();\r\n      if(!initResult) {\r\n        return;\r\n      }\r\n\r\n      element = initResult.element;\r\n      const {cleanup, destroy, menuPadding, reactionsMenu, reactionsMenuPosition} = initResult;\r\n      let isReactionsMenuVisible = false;\r\n      if(reactionsMenu) {\r\n        const className = 'is-visible';\r\n        isReactionsMenuVisible = reactionsMenu.container.classList.contains(className);\r\n        if(isReactionsMenuVisible) reactionsMenu.container.classList.remove(className);\r\n\r\n        if(reactionsMenuPosition === 'horizontal') {\r\n          const offsetSize = element[/* reactionsMenuPosition === 'vertical' ? 'offsetHeight' :  */'offsetWidth'];\r\n          // if(reactionsMenu.scrollable.container.scrollWidth > offsetWidth) {\r\n          const INNER_CONTAINER_PADDING = 8;\r\n          const visibleLength = (offsetSize - INNER_CONTAINER_PADDING) / REACTION_CONTAINER_SIZE;\r\n          const nextVisiblePart = visibleLength % 1;\r\n          const MIN_NEXT_VISIBLE_PART = 0.65;\r\n          if(nextVisiblePart < MIN_NEXT_VISIBLE_PART) {\r\n            const minSize = (offsetSize + (MIN_NEXT_VISIBLE_PART - nextVisiblePart) * REACTION_CONTAINER_SIZE) | 0;\r\n            element.style[/* reactionsMenuPosition === 'vertical' ? 'minHeight' :  */'minWidth'] = minSize + 'px';\r\n          }\r\n          // }\r\n        }\r\n      }\r\n\r\n      const side: 'left' | 'right' = bubble.classList.contains('is-in') ? 'left' : 'right';\r\n      // bubble.parentElement.append(element);\r\n      // appImManager.log('contextmenu', e, bubble, side);\r\n      positionMenu((e as TouchEvent).touches ? (e as TouchEvent).touches[0] : e as MouseEvent, element, side, menuPadding);\r\n\r\n      if(reactionsMenu) {\r\n        reactionsMenu.widthContainer.style.top = element.style.top;\r\n        reactionsMenu.widthContainer.style.left = element.style.left;\r\n        reactionsMenu.widthContainer.style.setProperty('--menu-width', element[reactionsMenuPosition === 'vertical' ? 'offsetHeight' : 'offsetWidth'] + 'px');\r\n        element.parentElement.append(reactionsMenu.widthContainer);\r\n        if(isReactionsMenuVisible) void reactionsMenu.container.offsetLeft; // reflow\r\n      }\r\n\r\n      contextMenuController.openBtnMenu(element, () => {\r\n        if(reactionsMenu) {\r\n          reactionsMenu.container.classList.remove('is-visible');\r\n        }\r\n\r\n        this.mid = 0;\r\n        this.peerId = undefined;\r\n        this.target = null;\r\n        this.viewerPeerId = undefined;\r\n        this.canOpenReactedList = undefined;\r\n        cleanup();\r\n\r\n        setTimeout(() => {\r\n          destroy();\r\n        }, 300);\r\n      });\r\n\r\n      if(isReactionsMenuVisible) {\r\n        reactionsMenu.container.classList.add('is-visible');\r\n      }\r\n    };\r\n\r\n    r();\r\n  };\r\n\r\n  public cleanup() {\r\n    this.listenerSetter.removeAll();\r\n    this.reactionsMenu && this.reactionsMenu.cleanup();\r\n    this.middleware.clean();\r\n  }\r\n\r\n  public destroy() {\r\n    this.cleanup();\r\n    this.attachListenerSetter.removeAll();\r\n  }\r\n\r\n  private async filterButtons(buttons: ChatContextMenu['buttons']) {\r\n    if(this.isSponsored) {\r\n      return buttons.filter((button) => {\r\n        return button.isSponsored;\r\n      });\r\n    } else {\r\n      return filterAsync(buttons, async(button) => {\r\n        let good: boolean;\r\n\r\n        // if((appImManager.chatSelection.isSelecting && !button.withSelection) || (button.withSelection && !appImManager.chatSelection.isSelecting)) {\r\n        if(this.chat.selection.isSelecting && !button.withSelection) {\r\n          good = false;\r\n        } else {\r\n          good = this.isOverBubble || IS_TOUCH_SUPPORTED || true ?\r\n            await button.verify() :\r\n            button.notDirect && await button.verify() && button.notDirect();\r\n        }\r\n\r\n        return !!good;\r\n      });\r\n    }\r\n  }\r\n\r\n  private setButtons() {\r\n    const verifyFavoriteSticker = async(toAdd: boolean) => {\r\n      const doc = ((this.message as Message.message).media as MessageMedia.messageMediaDocument)?.document;\r\n      if(!(doc as MyDocument)?.sticker) {\r\n        return false;\r\n      }\r\n\r\n      const favedStickers = await this.managers.acknowledged.appStickersManager.getFavedStickersStickers();\r\n      if(!favedStickers.cached) {\r\n        return false;\r\n      }\r\n\r\n      const found = (await favedStickers.result).some((_doc) => _doc.id === doc.id);\r\n      return toAdd ? !found : found;\r\n    };\r\n\r\n    this.buttons = [{\r\n      icon: 'send2',\r\n      text: 'MessageScheduleSend',\r\n      onClick: this.onSendScheduledClick,\r\n      verify: () => this.chat.type === 'scheduled' && !this.message.pFlags.is_outgoing\r\n    }, {\r\n      icon: 'send2',\r\n      text: 'Message.Context.Selection.SendNow',\r\n      onClick: this.onSendScheduledClick,\r\n      verify: () => this.chat.type === 'scheduled' && this.isSelected && !this.chat.selection.selectionSendNowBtn.hasAttribute('disabled'),\r\n      notDirect: () => true,\r\n      withSelection: true\r\n    }, {\r\n      icon: 'schedule',\r\n      text: 'MessageScheduleEditTime',\r\n      onClick: () => {\r\n        this.chat.input.scheduleSending(() => {\r\n          assumeType<Message.message>(this.message);\r\n          this.managers.appMessagesManager.editMessage(this.message, this.message.message, {\r\n            scheduleDate: this.chat.input.scheduleDate,\r\n            entities: this.message.entities\r\n          });\r\n\r\n          this.chat.input.onMessageSent(false, false);\r\n        }, new Date(this.message.date * 1000));\r\n      },\r\n      verify: () => this.chat.type === 'scheduled'\r\n    }, {\r\n      icon: 'reply',\r\n      text: 'Reply',\r\n      onClick: this.onReplyClick,\r\n      verify: async() => await this.chat.canSend() &&\r\n        !this.message.pFlags.is_outgoing &&\r\n        !!this.chat.input.messageInput &&\r\n        this.chat.type !== 'scheduled'/* ,\r\n      cancelEvent: true */\r\n    }, {\r\n      icon: 'favourites',\r\n      text: 'AddToFavorites',\r\n      onClick: this.onFaveStickerClick.bind(this, false),\r\n      verify: () => verifyFavoriteSticker(true)\r\n    }, {\r\n      icon: 'favourites',\r\n      text: 'DeleteFromFavorites',\r\n      onClick: this.onFaveStickerClick.bind(this, true),\r\n      verify: () => verifyFavoriteSticker(false)\r\n    }, {\r\n      icon: 'edit',\r\n      text: 'Edit',\r\n      onClick: this.onEditClick,\r\n      verify: async() => (await this.managers.appMessagesManager.canEditMessage(this.message, 'text')) && !!this.chat.input.messageInput\r\n    }, {\r\n      icon: 'copy',\r\n      text: 'Copy',\r\n      onClick: this.onCopyClick,\r\n      verify: () => !this.noForwards && !!(this.message as Message.message).message && !this.isTextSelected && (!this.isAnchorTarget || (this.message as Message.message).message !== this.target.innerText)\r\n    }, {\r\n      icon: 'copy',\r\n      text: 'Chat.CopySelectedText',\r\n      onClick: this.onCopyClick,\r\n      verify: () => !this.noForwards && !!(this.message as Message.message).message && this.isTextSelected\r\n    }, {\r\n      icon: 'copy',\r\n      text: 'Message.Context.Selection.Copy',\r\n      onClick: this.onCopyClick,\r\n      verify: async() => {\r\n        if(!this.isSelected || this.noForwards) {\r\n          return false;\r\n        }\r\n\r\n        for(const [peerId, mids] of this.chat.selection.selectedMids) {\r\n          const storageKey: MessagesStorageKey = `${peerId}_${this.chat.type === 'scheduled' ? 'scheduled' : 'history'}`;\r\n          for(const mid of mids) {\r\n            const message = (await this.managers.appMessagesManager.getMessageFromStorage(storageKey, mid)) as Message.message;\r\n            if(!!message.message) {\r\n              return true;\r\n            }\r\n          }\r\n        }\r\n\r\n        return false;\r\n      },\r\n      notDirect: () => true,\r\n      withSelection: true\r\n    }, {\r\n      icon: 'copy',\r\n      text: 'CopyLink',\r\n      onClick: this.onCopyAnchorLinkClick,\r\n      verify: () => this.isAnchorTarget,\r\n      withSelection: true\r\n    }, {\r\n      icon: 'copy',\r\n      text: 'Text.Context.Copy.Username',\r\n      onClick: () => {\r\n        copyTextToClipboard(this.target.innerHTML);\r\n      },\r\n      verify: () => this.isUsernameTarget,\r\n      withSelection: true\r\n    }, {\r\n      icon: 'copy',\r\n      text: 'Text.Context.Copy.Hashtag',\r\n      onClick: () => {\r\n        copyTextToClipboard(this.target.innerHTML);\r\n      },\r\n      verify: () => this.target.classList.contains('anchor-hashtag'),\r\n      withSelection: true\r\n    }, {\r\n      icon: 'link',\r\n      text: 'MessageContext.CopyMessageLink1',\r\n      onClick: this.onCopyLinkClick,\r\n      verify: async() => await this.managers.appPeersManager.isChannel(this.peerId) && !this.message.pFlags.is_outgoing\r\n    }, {\r\n      icon: 'pin',\r\n      text: 'Message.Context.Pin',\r\n      onClick: this.onPinClick,\r\n      verify: async() => !this.message.pFlags.is_outgoing &&\r\n        this.message._ !== 'messageService' &&\r\n        !this.message.pFlags.pinned &&\r\n        await this.managers.appPeersManager.canPinMessage(this.peerId) &&\r\n        this.chat.type !== 'scheduled'\r\n    }, {\r\n      icon: 'unpin',\r\n      text: 'Message.Context.Unpin',\r\n      onClick: this.onUnpinClick,\r\n      verify: async() => (this.message as Message.message).pFlags.pinned && await this.managers.appPeersManager.canPinMessage(this.peerId)\r\n    }, {\r\n      icon: 'download',\r\n      text: 'MediaViewer.Context.Download',\r\n      onClick: () => {\r\n        appDownloadManager.downloadToDisc({media: (this.message as any).media.document});\r\n      },\r\n      verify: () => {\r\n        if(this.message.pFlags.is_outgoing) {\r\n          return false;\r\n        }\r\n\r\n        const doc: MyDocument = ((this.message as Message.message).media as MessageMedia.messageMediaDocument)?.document as any;\r\n        if(!doc) return false;\r\n\r\n        let hasTarget = !!IS_TOUCH_SUPPORTED;\r\n        const isGoodType = !doc.type || !(['gif', 'video'/* , 'sticker' */] as MyDocument['type'][]).includes(doc.type);\r\n        if(isGoodType) hasTarget ||= !!findUpClassName(this.target, 'document') || !!findUpClassName(this.target, 'audio') || !!findUpClassName(this.target, 'media-sticker-wrapper');\r\n        return isGoodType && hasTarget;\r\n      }\r\n    }, {\r\n      icon: 'checkretract',\r\n      text: 'Chat.Poll.Unvote',\r\n      onClick: this.onRetractVote,\r\n      verify: () => {\r\n        const poll = (this.message as any).media?.poll as Poll;\r\n        return poll && poll.chosenIndexes.length && !poll.pFlags.closed && !poll.pFlags.quiz;\r\n      }/* ,\r\n      cancelEvent: true */\r\n    }, {\r\n      icon: 'stop',\r\n      text: 'Chat.Poll.Stop',\r\n      onClick: this.onStopPoll,\r\n      verify: async() => {\r\n        const poll = (this.message as any).media?.poll;\r\n        return await this.managers.appMessagesManager.canEditMessage(this.message, 'poll') && poll && !poll.pFlags.closed && !this.message.pFlags.is_outgoing;\r\n      }/* ,\r\n      cancelEvent: true */\r\n    }, {\r\n      icon: 'forward',\r\n      text: 'Forward',\r\n      onClick: this.onForwardClick, // let forward the message if it's outgoing but not ours (like a changelog)\r\n      verify: () => !this.noForwards && this.chat.type !== 'scheduled' && (!this.message.pFlags.is_outgoing || this.message.fromId === SERVICE_PEER_ID) && this.message._ !== 'messageService'\r\n    }, {\r\n      icon: 'forward',\r\n      text: 'Message.Context.Selection.Forward',\r\n      onClick: this.onForwardClick,\r\n      verify: () => this.chat.selection.selectionForwardBtn &&\r\n        this.isSelected &&\r\n        !this.chat.selection.selectionForwardBtn.hasAttribute('disabled'),\r\n      notDirect: () => true,\r\n      withSelection: true\r\n    }, {\r\n      icon: 'flag',\r\n      text: 'ReportChat',\r\n      onClick: () => {\r\n        new PopupReportMessages(this.peerId, [this.mid]);\r\n      },\r\n      verify: async() => !this.message.pFlags.out && this.message._ === 'message' && !this.message.pFlags.is_outgoing && await this.managers.appPeersManager.isChannel(this.peerId),\r\n      notDirect: () => true,\r\n      withSelection: true\r\n    }, {\r\n      icon: 'select',\r\n      text: 'Message.Context.Select',\r\n      onClick: this.onSelectClick,\r\n      verify: () => !(this.message as Message.messageService).action && !this.isSelected && this.isSelectable,\r\n      notDirect: () => true,\r\n      withSelection: true\r\n    }, {\r\n      icon: 'select',\r\n      text: 'Message.Context.Selection.Clear',\r\n      onClick: this.onClearSelectionClick,\r\n      verify: () => this.isSelected,\r\n      notDirect: () => true,\r\n      withSelection: true\r\n    }, {\r\n      onClick: () => {\r\n        if(this.viewerPeerId) {\r\n          this.chat.appImManager.setInnerPeer({\r\n            peerId: this.viewerPeerId\r\n          });\r\n        } else if(this.canOpenReactedList) {\r\n          new PopupReactedList(this.message as Message.message);\r\n        } else {\r\n          return false;\r\n        }\r\n      },\r\n      verify: async() => !this.peerId.isUser() && (!!(this.message as Message.message).reactions?.recent_reactions?.length || await this.managers.appMessagesManager.canViewMessageReadParticipants(this.message)),\r\n      notDirect: () => true,\r\n      localName: 'views'\r\n    }, {\r\n      icon: 'delete danger',\r\n      text: 'Delete',\r\n      onClick: this.onDeleteClick,\r\n      verify: async() => this.managers.appMessagesManager.canDeleteMessage(this.message)\r\n    }, {\r\n      icon: 'delete danger',\r\n      text: 'Message.Context.Selection.Delete',\r\n      onClick: this.onDeleteClick,\r\n      verify: () => this.isSelected && !this.chat.selection.selectionDeleteBtn.hasAttribute('disabled'),\r\n      notDirect: () => true,\r\n      withSelection: true\r\n    }, {\r\n      icon: 'info',\r\n      text: 'Chat.Message.Sponsored.What',\r\n      onClick: () => {\r\n        new PopupSponsored();\r\n      },\r\n      verify: () => false,\r\n      isSponsored: true\r\n    }, {\r\n      // icon: 'smile',\r\n      text: 'Loading',\r\n      onClick: () => {\r\n        this.emojiInputsPromise.then((inputs) => {\r\n          new PopupStickers(inputs, true).show();\r\n        });\r\n      },\r\n      verify: () => {\r\n        const entities = (this.message as Message.message).entities;\r\n        return entities?.some((entity) => entity._ === 'messageEntityCustomEmoji');\r\n      },\r\n      notDirect: () => true,\r\n      localName: 'emojis'\r\n    }];\r\n  }\r\n\r\n  private async init() {\r\n    this.cleanup();\r\n    this.setButtons();\r\n\r\n    const filteredButtons = await this.filterButtons(this.buttons);\r\n    if(!filteredButtons.length) {\r\n      return;\r\n    }\r\n\r\n    const element = this.element = ButtonMenu(filteredButtons, this.listenerSetter);\r\n    element.id = 'bubble-contextmenu';\r\n    element.classList.add('contextmenu');\r\n\r\n    const viewsButton = filteredButtons.find((button) => button.localName === 'views');\r\n    if(viewsButton) {\r\n      const reactions = (this.message as Message.message).reactions;\r\n      const recentReactions = reactions?.recent_reactions;\r\n      const isViewingReactions = !!recentReactions?.length;\r\n      const participantsCount = await this.managers.appMessagesManager.canViewMessageReadParticipants(this.message) ?\r\n        ((await this.managers.appPeersManager.getPeer(this.peerId)) as MTChat.chat).participants_count :\r\n        undefined;\r\n      const reactedLength = reactions ? reactions.results.reduce((acc, r) => acc + r.count, 0) : undefined;\r\n\r\n      viewsButton.element.classList.add('tgico-' + (isViewingReactions ? 'reactions' : 'checks'));\r\n      const i18nElem = new I18n.IntlElement({\r\n        key: isViewingReactions ? (\r\n          participantsCount === undefined ? 'Chat.Context.ReactedFast' : 'Chat.Context.Reacted'\r\n        ) : 'NobodyViewed',\r\n        args: isViewingReactions ? (\r\n          participantsCount === undefined ? [reactedLength] : [participantsCount, participantsCount]\r\n        ) : undefined,\r\n        element: viewsButton.textElement\r\n      });\r\n\r\n      let fakeText: HTMLElement;\r\n      if(isViewingReactions) {\r\n        if(participantsCount === undefined) {\r\n          fakeText = i18n('Chat.Context.ReactedFast', [reactedLength]);\r\n        } else {\r\n          fakeText = i18n(\r\n            recentReactions.length === participantsCount ? 'Chat.Context.ReactedFast' : 'Chat.Context.Reacted',\r\n            [recentReactions.length, participantsCount]\r\n          );\r\n        }\r\n      } else {\r\n        fakeText = i18n('Loading');\r\n      }\r\n\r\n      fakeText.classList.add('btn-menu-item-text-fake');\r\n      viewsButton.element.append(fakeText);\r\n\r\n      const AVATAR_SIZE = 22;\r\n      const MAX_AVATARS = 3;\r\n      const PADDING_PER_AVATAR = 1.125;\r\n      i18nElem.element.style.visibility = 'hidden';\r\n      i18nElem.element.style.paddingRight = isViewingReactions ? PADDING_PER_AVATAR * Math.min(MAX_AVATARS, recentReactions.length) + 'rem' : '1rem';\r\n      const middleware = this.middleware.get();\r\n      this.managers.appMessagesManager.getMessageReactionsListAndReadParticipants(this.message as Message.message).then((result) => {\r\n        if(!middleware()) {\r\n          return;\r\n        }\r\n\r\n        if(fakeText) {\r\n          fakeText.remove();\r\n        }\r\n\r\n        const reactions = result.combined;\r\n        const reactedLength = participantsCount === undefined ?\r\n          result.reactionsCount :\r\n          (\r\n            isViewingReactions ?\r\n              reactions.filter((reaction) => reaction.reaction).length :\r\n              reactions.length\r\n          );\r\n\r\n        let fakeElem: HTMLElement;\r\n        if(reactions.length === 1) {\r\n          fakeElem = new PeerTitle({\r\n            peerId: reactions[0].peerId,\r\n            onlyFirstName: true,\r\n            dialog: false\r\n          }).element;\r\n\r\n          if(!isViewingReactions || result.readParticipants.length <= 1) {\r\n            this.viewerPeerId = reactions[0].peerId;\r\n          }\r\n        } else if(isViewingReactions) {\r\n          const isFull = reactedLength === reactions.length || participantsCount === undefined;\r\n          fakeElem = i18n(\r\n            isFull ? 'Chat.Context.ReactedFast' : 'Chat.Context.Reacted',\r\n            isFull ? [reactedLength] : [reactedLength, reactions.length]\r\n          );\r\n        } else {\r\n          if(!reactions.length) {\r\n            i18nElem.element.style.visibility = '';\r\n          } else {\r\n            fakeElem = i18n('MessageSeen', [reactions.length]);\r\n          }\r\n        }\r\n\r\n        if(fakeElem) {\r\n          fakeElem.style.paddingRight = PADDING_PER_AVATAR * Math.min(MAX_AVATARS, reactedLength) + 'rem';\r\n          fakeElem.classList.add('btn-menu-item-text-fake');\r\n          viewsButton.element.append(fakeElem);\r\n        }\r\n\r\n        if(reactions.length) {\r\n          const avatars = new StackedAvatars({avatarSize: AVATAR_SIZE});\r\n          avatars.render(recentReactions ? recentReactions.map((r) => getPeerId(r.peer_id)) : reactions.map((reaction) => reaction.peerId));\r\n          viewsButton.element.append(avatars.container);\r\n\r\n          // if(reactions.length > 1) {\r\n          // if(isViewingReactions) {\r\n          this.canOpenReactedList = true;\r\n          // }\r\n        }\r\n      });\r\n    }\r\n\r\n    let menuPadding: MenuPositionPadding;\r\n    let reactionsMenu: ChatReactionsMenu;\r\n    let reactionsMenuPosition: 'horizontal' | 'vertical';\r\n    if(this.message._ === 'message' && !this.chat.selection.isSelecting && !this.message.pFlags.is_outgoing && !this.message.pFlags.is_scheduled) {\r\n      reactionsMenuPosition = (IS_APPLE || IS_TOUCH_SUPPORTED)/*  && false */ ? 'horizontal' : 'vertical';\r\n      reactionsMenu = this.reactionsMenu = new ChatReactionsMenu(this.managers, reactionsMenuPosition, this.middleware);\r\n      reactionsMenu.init(await this.managers.appMessagesManager.getGroupsFirstMessage(this.message));\r\n      // element.prepend(reactionsMenu.widthContainer);\r\n\r\n      const size = 36;\r\n      const margin = 8;\r\n      const totalSize = size + margin;\r\n      const paddingLeft = 0, paddingRight = 0;\r\n      if(reactionsMenuPosition === 'vertical') {\r\n        menuPadding = {\r\n          top: paddingLeft,\r\n          // bottom: 36, // positionMenu will detect it itself somehow\r\n          left: totalSize\r\n        };\r\n      } else {\r\n        menuPadding = {\r\n          top: totalSize,\r\n          right: paddingRight,\r\n          left: paddingLeft\r\n        };\r\n      }\r\n    }\r\n\r\n    const emojisButton = filteredButtons.find((button) => button.localName === 'emojis');\r\n    if(emojisButton) {\r\n      emojisButton.element.classList.add('is-multiline');\r\n      emojisButton.element.parentElement.insertBefore(document.createElement('hr'), emojisButton.element);\r\n\r\n      const setPadding = () => {\r\n        menuPadding ??= {};\r\n        menuPadding.bottom = 24;\r\n      };\r\n\r\n      const entities = (this.message as Message.message).entities.filter((entity) => entity._ === 'messageEntityCustomEmoji') as MessageEntity.messageEntityCustomEmoji[];\r\n      const docIds = filterUnique(entities.map((entity) => entity.document_id));\r\n      const inputsPromise = this.emojiInputsPromise = deferredPromise();\r\n      await this.managers.appEmojiManager.getCachedCustomEmojiDocuments(docIds).then(async(docs) => {\r\n        const p = async(docs: Document.document[]) => {\r\n          const s: Map<StickerSet['id'], InputStickerSet.inputStickerSetID> = new Map();\r\n          docs.forEach((doc) => {\r\n            if(!doc || s.has(doc.stickerSetInput.id)) {\r\n              return;\r\n            }\r\n\r\n            s.set(doc.stickerSetInput.id, doc.stickerSetInput);\r\n          });\r\n\r\n          const inputs = [...s.values()];\r\n          inputsPromise.resolve(inputs);\r\n          if(s.size === 1) {\r\n            const result = await this.managers.acknowledged.appStickersManager.getStickerSet(inputs[0]);\r\n            const promise = result.result.then((set) => {\r\n              const el = i18n('MessageContainsEmojiPack', [wrapEmojiText(set.set.title)]);\r\n              replaceContent(emojisButton.textElement, el);\r\n            });\r\n\r\n            return result.cached ? promise : (setPadding(), undefined);\r\n          }\r\n\r\n          replaceContent(emojisButton.textElement, i18n('MessageContainsEmojiPacks', [s.size]));\r\n        };\r\n\r\n        if(docs.some((doc) => !doc)) {\r\n          setPadding();\r\n          this.managers.appEmojiManager.getCustomEmojiDocuments(docIds).then(p);\r\n        } else {\r\n          return p(docs);\r\n        }\r\n      });\r\n      // emojisButton.element.append(i18n('Loading'));\r\n    }\r\n\r\n    this.chat.container.append(element);\r\n\r\n    return {\r\n      element,\r\n      cleanup: () => {\r\n        this.cleanup();\r\n        reactionsMenu && reactionsMenu.cleanup();\r\n      },\r\n      destroy: () => {\r\n        element.remove();\r\n        reactionsMenu && reactionsMenu.widthContainer.remove();\r\n      },\r\n      menuPadding,\r\n      reactionsMenu,\r\n      reactionsMenuPosition\r\n    };\r\n  }\r\n\r\n  private onSendScheduledClick = async() => {\r\n    if(this.chat.selection.isSelecting) {\r\n      simulateClickEvent(this.chat.selection.selectionSendNowBtn);\r\n    } else {\r\n      new PopupSendNow(this.peerId, await this.chat.getMidsByMid(this.mid));\r\n    }\r\n  };\r\n\r\n  private onReplyClick = () => {\r\n    this.chat.input.initMessageReply(this.mid);\r\n  };\r\n\r\n  private onFaveStickerClick = (unfave?: boolean) => {\r\n    const docId = ((this.message as Message.message).media as MessageMedia.messageMediaDocument).document.id;\r\n    this.managers.appStickersManager.faveSticker(docId, unfave);\r\n  };\r\n\r\n  private onEditClick = () => {\r\n    this.chat.input.initMessageEditing(this.mid);\r\n  };\r\n\r\n  private onCopyClick = async() => {\r\n    if(isSelectionEmpty()) {\r\n      const mids = this.chat.selection.isSelecting ?\r\n        [...this.chat.selection.selectedMids.get(this.peerId)].sort((a, b) => a - b) :\r\n        [this.mid];\r\n\r\n      const parts: string[] = await Promise.all(mids.map(async(mid) => {\r\n        const message = (await this.chat.getMessage(mid)) as Message.message;\r\n        return message?.message ? message.message + '\\n' : '';\r\n      }));\r\n\r\n      const str = parts.join('');\r\n\r\n      copyTextToClipboard(str);\r\n    } else {\r\n      document.execCommand('copy');\r\n      // cancelSelection();\r\n    }\r\n  };\r\n\r\n  private onCopyAnchorLinkClick = () => {\r\n    copyTextToClipboard((this.target as HTMLAnchorElement).href);\r\n  };\r\n\r\n  private onCopyLinkClick = async() => {\r\n    let threadMessage: Message.message;\r\n    const {peerId, mid} = this;\r\n    const threadId = this.chat.threadId;\r\n    if(this.chat.type === 'discussion') {\r\n      threadMessage = (await this.managers.appMessagesManager.getMessageByPeer(peerId, threadId)) as Message.message;\r\n    }\r\n\r\n    const username = await this.managers.appPeersManager.getPeerUsername(threadMessage ? threadMessage.fromId : peerId);\r\n    const msgId = getServerMessageId(mid);\r\n    let url = 'https://t.me/';\r\n    let key: LangPackKey;\r\n    if(username) {\r\n      url += username + '/' + (threadMessage ? getServerMessageId(threadMessage.fwd_from.channel_post) : msgId);\r\n      if(threadMessage) url += '?comment=' + msgId;\r\n      key = 'LinkCopied';\r\n    } else {\r\n      url += 'c/' + peerId.toChatId() + '/' + msgId;\r\n      if(threadMessage) url += '?thread=' + getServerMessageId(threadMessage.mid);\r\n      key = 'LinkCopiedPrivateInfo';\r\n    }\r\n\r\n    toast(I18n.format(key, true));\r\n\r\n    copyTextToClipboard(url);\r\n  };\r\n\r\n  private onPinClick = () => {\r\n    new PopupPinMessage(this.peerId, this.mid);\r\n  };\r\n\r\n  private onUnpinClick = () => {\r\n    new PopupPinMessage(this.peerId, this.mid, true);\r\n  };\r\n\r\n  private onRetractVote = () => {\r\n    this.managers.appPollsManager.sendVote(this.message, []);\r\n  };\r\n\r\n  private onStopPoll = () => {\r\n    this.managers.appPollsManager.stopPoll(this.message);\r\n  };\r\n\r\n  private onForwardClick = async() => {\r\n    if(this.chat.selection.isSelecting) {\r\n      simulateClickEvent(this.chat.selection.selectionForwardBtn);\r\n    } else {\r\n      const peerId = this.peerId;\r\n      const mids = this.isTargetAGroupedItem ? [this.mid] : await this.chat.getMidsByMid(this.mid);\r\n      new PopupForward({\r\n        [peerId]: mids\r\n      });\r\n    }\r\n  };\r\n\r\n  private onSelectClick = () => {\r\n    this.chat.selection.toggleByElement(findUpClassName(this.target, 'grouped-item') || findUpClassName(this.target, 'bubble'));\r\n  };\r\n\r\n  private onClearSelectionClick = () => {\r\n    this.chat.selection.cancelSelection();\r\n  };\r\n\r\n  private onDeleteClick = async() => {\r\n    if(this.chat.selection.isSelecting) {\r\n      simulateClickEvent(this.chat.selection.selectionDeleteBtn);\r\n    } else {\r\n      new PopupDeleteMessages(this.peerId, this.isTargetAGroupedItem ? [this.mid] : await this.chat.getMidsByMid(this.mid), this.chat.type);\r\n    }\r\n  };\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport contextMenuController from '../../helpers/contextMenuController';\r\nimport {attachContextMenuListener} from '../../helpers/dom/attachContextMenuListener';\r\nimport cancelEvent from '../../helpers/dom/cancelEvent';\r\nimport ListenerSetter from '../../helpers/listenerSetter';\r\nimport rootScope from '../../lib/rootScope';\r\nimport ButtonMenu, {ButtonMenuItemOptions} from '../buttonMenu';\r\n\r\nexport default class SendMenu {\r\n  public sendMenu: HTMLDivElement;\r\n  private sendMenuButtons: (ButtonMenuItemOptions & {verify: () => boolean})[];\r\n  private type: 'schedule' | 'reminder';\r\n\r\n  constructor(options: {\r\n    onSilentClick: () => void,\r\n    onScheduleClick: () => void,\r\n    listenerSetter?: ListenerSetter,\r\n    openSide: string,\r\n    onContextElement: HTMLElement,\r\n    onOpen?: () => boolean\r\n  }) {\r\n    this.sendMenuButtons = [{\r\n      icon: 'mute',\r\n      text: 'Chat.Send.WithoutSound',\r\n      onClick: options.onSilentClick,\r\n      verify: () => this.type === 'schedule'\r\n    }, {\r\n      icon: 'schedule',\r\n      text: 'Chat.Send.ScheduledMessage',\r\n      onClick: options.onScheduleClick,\r\n      verify: () => this.type === 'schedule'\r\n    }, {\r\n      icon: 'schedule',\r\n      text: 'Chat.Send.SetReminder',\r\n      onClick: options.onScheduleClick,\r\n      verify: () => this.type === 'reminder'\r\n    }];\r\n\r\n    this.sendMenu = ButtonMenu(this.sendMenuButtons, options.listenerSetter);\r\n    this.sendMenu.classList.add('menu-send', options.openSide);\r\n\r\n    attachContextMenuListener(options.onContextElement, (e: any) => {\r\n      if(options.onOpen && !options.onOpen()) {\r\n        return;\r\n      }\r\n\r\n      this.sendMenuButtons.forEach((button) => {\r\n        button.element.classList.toggle('hide', !button.verify());\r\n      });\r\n\r\n      cancelEvent(e);\r\n      contextMenuController.openBtnMenu(this.sendMenu);\r\n    }, options.listenerSetter);\r\n  }\r\n\r\n  public setPeerId(peerId: PeerId) {\r\n    this.type = peerId === rootScope.myId ? 'reminder' : 'schedule';\r\n  }\r\n};\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport type Chat from '../chat/chat';\r\nimport PopupElement from '.';\r\nimport CheckboxField from '../checkboxField';\r\nimport InputField from '../inputField';\r\nimport RadioField from '../radioField';\r\nimport Scrollable from '../scrollable';\r\nimport SendContextMenu from '../chat/sendContextMenu';\r\nimport I18n, {_i18n} from '../../lib/langPack';\r\nimport findUpTag from '../../helpers/dom/findUpTag';\r\nimport cancelEvent from '../../helpers/dom/cancelEvent';\r\nimport getRichValue from '../../helpers/dom/getRichValue';\r\nimport isInputEmpty from '../../helpers/dom/isInputEmpty';\r\nimport whichChild from '../../helpers/dom/whichChild';\r\nimport {attachClickEvent} from '../../helpers/dom/clickEvent';\r\nimport {Poll} from '../../layer';\r\n\r\nconst MAX_LENGTH_QUESTION = 255;\r\nconst MAX_LENGTH_OPTION = 100;\r\nconst MAX_LENGTH_SOLUTION = 200;\r\n\r\nexport default class PopupCreatePoll extends PopupElement {\r\n  private questionInputField: InputField;\r\n  private questions: HTMLElement;\r\n  protected scrollable: Scrollable;\r\n  private tempId = 0;\r\n\r\n  private anonymousCheckboxField: CheckboxField;\r\n  private multipleCheckboxField: PopupCreatePoll['anonymousCheckboxField'];\r\n  private quizCheckboxField: PopupCreatePoll['anonymousCheckboxField'];\r\n\r\n  private correctAnswers: Uint8Array[];\r\n  private quizSolutionField: InputField;\r\n  private optionInputFields: InputField[];\r\n\r\n  constructor(private chat: Chat) {\r\n    super('popup-create-poll popup-new-media', {closable: true, withConfirm: 'Create', body: true, title: 'NewPoll'});\r\n    this.construct();\r\n  }\r\n\r\n  private async construct() {\r\n    this.questionInputField = new InputField({\r\n      placeholder: 'AskAQuestion',\r\n      label: 'AskAQuestion',\r\n      name: 'question',\r\n      maxLength: MAX_LENGTH_QUESTION\r\n    });\r\n\r\n    this.listenerSetter.add(this.questionInputField.input)('input', () => {\r\n      this.handleChange();\r\n    });\r\n\r\n    this.optionInputFields = [];\r\n\r\n    if(this.chat.type !== 'scheduled') {\r\n      const sendMenu = new SendContextMenu({\r\n        onSilentClick: () => {\r\n          this.chat.input.sendSilent = true;\r\n          this.send();\r\n        },\r\n        onScheduleClick: () => {\r\n          this.chat.input.scheduleSending(() => {\r\n            this.send();\r\n          });\r\n        },\r\n        openSide: 'bottom-left',\r\n        onContextElement: this.btnConfirm\r\n      });\r\n\r\n      sendMenu.setPeerId(this.chat.peerId);\r\n\r\n      this.header.append(sendMenu.sendMenu);\r\n    }\r\n\r\n    this.header.append(this.questionInputField.container);\r\n\r\n    const hr = document.createElement('hr');\r\n    const d = document.createElement('div');\r\n    d.classList.add('caption');\r\n    _i18n(d, 'PollOptions');\r\n\r\n    this.questions = document.createElement('form');\r\n    this.questions.classList.add('poll-create-questions');\r\n\r\n    const dd = document.createElement('div');\r\n    dd.classList.add('poll-create-settings');\r\n\r\n    const settingsCaption = document.createElement('div');\r\n    settingsCaption.classList.add('caption');\r\n    _i18n(settingsCaption, 'Settings');\r\n\r\n    if(!(await this.chat.managers.appPeersManager.isBroadcast(this.chat.peerId))) {\r\n      this.anonymousCheckboxField = new CheckboxField({\r\n        text: 'NewPoll.Anonymous',\r\n        name: 'anonymous'\r\n      });\r\n      this.anonymousCheckboxField.input.checked = true;\r\n      dd.append(this.anonymousCheckboxField.label);\r\n    }\r\n\r\n    this.multipleCheckboxField = new CheckboxField({\r\n      text: 'NewPoll.MultipleChoice',\r\n      name: 'multiple'\r\n    });\r\n    this.quizCheckboxField = new CheckboxField({\r\n      text: 'NewPoll.Quiz',\r\n      name: 'quiz'\r\n    });\r\n\r\n    this.listenerSetter.add(this.multipleCheckboxField.input)('change', () => {\r\n      const checked = this.multipleCheckboxField.input.checked;\r\n      this.quizCheckboxField.input.toggleAttribute('disabled', checked);\r\n    });\r\n\r\n    this.listenerSetter.add(this.quizCheckboxField.input)('change', () => {\r\n      const checked = this.quizCheckboxField.input.checked;\r\n\r\n      (Array.from(this.questions.children) as HTMLElement[]).map((el) => {\r\n        el.classList.toggle('radio-field', checked);\r\n      });\r\n\r\n      if(!checked) {\r\n        this.correctAnswers = undefined;\r\n        this.quizSolutionField.setValueSilently('');\r\n      }\r\n\r\n      quizElements.forEach((el) => el.classList.toggle('hide', !checked));\r\n\r\n      this.multipleCheckboxField.input.toggleAttribute('disabled', checked);\r\n      this.handleChange();\r\n    });\r\n\r\n    dd.append(this.multipleCheckboxField.label, this.quizCheckboxField.label);\r\n\r\n    const quizElements: HTMLElement[] = [];\r\n\r\n    const quizSolutionCaption = document.createElement('div');\r\n    quizSolutionCaption.classList.add('caption');\r\n    _i18n(quizSolutionCaption, 'AccDescrQuizExplanation');\r\n\r\n    const quizHr = document.createElement('hr');\r\n\r\n    const quizSolutionContainer = document.createElement('div');\r\n    quizSolutionContainer.classList.add('poll-create-questions');\r\n\r\n    this.quizSolutionField = new InputField({\r\n      placeholder: 'NewPoll.Explanation.Placeholder',\r\n      label: 'NewPoll.Explanation.Placeholder',\r\n      name: 'solution',\r\n      maxLength: MAX_LENGTH_SOLUTION\r\n    });\r\n\r\n    this.listenerSetter.add(this.questionInputField.input)('input', () => {\r\n      this.handleChange();\r\n    });\r\n\r\n    const quizSolutionSubtitle = document.createElement('div');\r\n    quizSolutionSubtitle.classList.add('subtitle');\r\n    _i18n(quizSolutionSubtitle, 'AddAnExplanationInfo');\r\n\r\n    quizSolutionContainer.append(this.quizSolutionField.container, quizSolutionSubtitle);\r\n\r\n    quizElements.push(quizHr, quizSolutionCaption, quizSolutionContainer);\r\n    quizElements.forEach((el) => el.classList.add('hide'));\r\n\r\n    this.body.parentElement.insertBefore(hr, this.body);\r\n    this.body.append(d, this.questions, document.createElement('hr'), settingsCaption, dd, ...quizElements);\r\n\r\n    attachClickEvent(this.btnConfirm, this.onSubmitClick, {listenerSetter: this.listenerSetter});\r\n\r\n    this.scrollable = new Scrollable(this.body);\r\n    this.appendMoreField();\r\n\r\n    this.onEscape = () => {\r\n      return !this.getFilledAnswers().length;\r\n    };\r\n\r\n    this.handleChange();\r\n  }\r\n\r\n  private getFilledAnswers() {\r\n    const answers = Array.from(this.questions.children).map((el, idx) => {\r\n      const input = el.querySelector('.input-field-input') as HTMLElement;\r\n      return input instanceof HTMLInputElement ? input.value : getRichValue(input, false).value;\r\n    }).filter((v) => !!v.trim());\r\n\r\n    return answers;\r\n  }\r\n\r\n  private onSubmitClick = () => {\r\n    this.send();\r\n  };\r\n\r\n  private validate() {\r\n    const question = this.questionInputField.value;\r\n    if(!question) {\r\n      return false;\r\n    }\r\n\r\n    if(question.length > MAX_LENGTH_QUESTION) {\r\n      return false;\r\n    }\r\n\r\n    if(this.quizCheckboxField.input.checked && !this.correctAnswers?.length) {\r\n      return false;\r\n    }\r\n\r\n    const answers = this.getFilledAnswers();\r\n    if(answers.length < 2) {\r\n      return false;\r\n    }\r\n\r\n    const tooLongOption = answers.find((a) => a.length > MAX_LENGTH_OPTION);\r\n    if(tooLongOption) {\r\n      return false;\r\n    }\r\n\r\n    const {value: quizSolution} = getRichValue(this.quizSolutionField.input, false);\r\n    if(quizSolution.length > MAX_LENGTH_SOLUTION) {\r\n      return false;\r\n    }\r\n\r\n    return true;\r\n  }\r\n\r\n  private handleChange() {\r\n    const valid = this.validate();\r\n    this.btnConfirm.toggleAttribute('disabled', !valid);\r\n  }\r\n\r\n  public async send(force = false) {\r\n    const question = this.questionInputField.value;\r\n\r\n    const answers = this.getFilledAnswers();\r\n\r\n    const {value: quizSolution, entities: quizSolutionEntities} = getRichValue(this.quizSolutionField.input);\r\n\r\n    if(this.chat.type === 'scheduled' && !force) {\r\n      this.chat.input.scheduleSending(() => {\r\n        this.send(true);\r\n      });\r\n\r\n      return;\r\n    }\r\n\r\n    this.hide();\r\n\r\n    // const randomID = [nextRandomInt(0xFFFFFFFF), nextRandomInt(0xFFFFFFFF)];\r\n    // const randomIDS = bigint(randomID[0]).shiftLeft(32).add(bigint(randomID[1])).toString();\r\n\r\n    const pFlags: Poll['pFlags'] = {};\r\n\r\n    if(this.anonymousCheckboxField && !this.anonymousCheckboxField.input.checked) {\r\n      pFlags.public_voters = true;\r\n    }\r\n\r\n    if(this.multipleCheckboxField.input.checked) {\r\n      pFlags.multiple_choice = true;\r\n    }\r\n\r\n    if(this.quizCheckboxField.input.checked) {\r\n      pFlags.quiz = true;\r\n    }\r\n\r\n    const poll: Poll = {\r\n      _: 'poll',\r\n      pFlags,\r\n      question,\r\n      answers: answers.map((value, idx) => {\r\n        return {\r\n          _: 'pollAnswer',\r\n          text: value,\r\n          option: new Uint8Array([idx])\r\n        };\r\n      }),\r\n      id: undefined\r\n    };\r\n    // poll.id = randomIDS;\r\n\r\n    const inputMediaPoll = await this.chat.managers.appPollsManager.getInputMediaPoll(poll, this.correctAnswers, quizSolution, quizSolutionEntities);\r\n\r\n    // console.log('Will try to create poll:', inputMediaPoll);\r\n\r\n    this.chat.managers.appMessagesManager.sendOther(this.chat.peerId, inputMediaPoll, {\r\n      ...this.chat.getMessageSendingParams()\r\n    });\r\n\r\n    if(this.chat.input.helperType === 'reply') {\r\n      this.chat.input.clearHelper();\r\n    }\r\n\r\n    this.chat.input.onMessageSent(false, false);\r\n  }\r\n\r\n  onInput = (e: Event) => {\r\n    const target = e.target as HTMLInputElement;\r\n\r\n    const radioLabel = findUpTag(target, 'LABEL');\r\n    const isEmpty = isInputEmpty(target);\r\n    if(!isEmpty) {\r\n      target.parentElement.classList.add('is-filled');\r\n      radioLabel.classList.remove('hidden-widget');\r\n      radioLabel.firstElementChild.removeAttribute('disabled');\r\n    }\r\n\r\n    const isLast = !radioLabel.nextElementSibling;\r\n    if(isLast && !isEmpty && this.questions.childElementCount < 10) {\r\n      this.appendMoreField();\r\n    }\r\n\r\n    this.handleChange();\r\n  };\r\n\r\n  onDeleteClick = (e: MouseEvent) => {\r\n    const target = e.target as HTMLSpanElement;\r\n    const label = findUpTag(target, 'LABEL');\r\n    const idx = whichChild(label);\r\n\r\n    if(this.correctAnswers && this.correctAnswers[0][0] === idx) {\r\n      this.correctAnswers = undefined;\r\n    }\r\n\r\n    label.remove();\r\n    this.optionInputFields.splice(idx, 1);\r\n\r\n    this.optionInputFields.forEach((inputField, idx) => {\r\n      inputField.options.labelOptions.length = 0;\r\n      inputField.options.labelOptions.push(idx + 1);\r\n      const i18nElement = I18n.weakMap.get(inputField.label.firstElementChild as HTMLElement);\r\n      i18nElement.update();\r\n    });\r\n\r\n    this.handleChange();\r\n  };\r\n\r\n  private appendMoreField() {\r\n    const tempId = this.tempId++;\r\n    const idx = this.questions.childElementCount + 1;\r\n    const questionField = new InputField({\r\n      placeholder: 'NewPoll.OptionsAddOption',\r\n      label: 'NewPoll.OptionLabel',\r\n      labelOptions: [idx],\r\n      name: 'question-' + tempId,\r\n      maxLength: MAX_LENGTH_OPTION\r\n    });\r\n    this.listenerSetter.add(questionField.input)('input', this.onInput);\r\n\r\n    const radioField = new RadioField({\r\n      text: '',\r\n      name: 'question'\r\n    });\r\n    radioField.main.append(questionField.container);\r\n    attachClickEvent(questionField.input, cancelEvent, {listenerSetter: this.listenerSetter});\r\n    radioField.label.classList.add('hidden-widget');\r\n    radioField.input.disabled = true;\r\n    if(!this.quizCheckboxField.input.checked) {\r\n      radioField.label.classList.remove('radio-field');\r\n    }\r\n    this.listenerSetter.add(radioField.input)('change', () => {\r\n      const checked = radioField.input.checked;\r\n      if(checked) {\r\n        const idx = whichChild(radioField.label);\r\n        this.correctAnswers = [new Uint8Array([idx])];\r\n        this.handleChange();\r\n      }\r\n    });\r\n\r\n    const deleteBtn = document.createElement('span');\r\n    deleteBtn.classList.add('btn-icon', 'tgico-close');\r\n    questionField.container.append(deleteBtn);\r\n\r\n    attachClickEvent(deleteBtn, this.onDeleteClick, {listenerSetter: this.listenerSetter, once: true});\r\n\r\n    this.questions.append(radioField.label);\r\n\r\n    this.scrollable.scrollIntoViewNew({\r\n      element: this.questions.lastElementChild as HTMLElement,\r\n      position: 'center'\r\n    });\r\n    // this.scrollable.scrollTo(this.scrollable.scrollHeight, 'top', true, true);\r\n\r\n    this.optionInputFields.push(questionField);\r\n  }\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport pause from './schedulers/pause';\r\nimport {makeMediaSize} from './mediaSize';\r\nimport scaleMediaElement from './canvas/scaleMediaElement';\r\nimport preloadVideo from './preloadVideo';\r\n\r\nexport function createPosterFromMedia(media: HTMLVideoElement | HTMLImageElement) {\r\n  let width: number, height: number;\r\n  if(media instanceof HTMLVideoElement) {\r\n    width = media.videoWidth;\r\n    height = media.videoHeight;\r\n  } else {\r\n    width = media.naturalWidth;\r\n    height = media.naturalHeight;\r\n  }\r\n\r\n  return scaleMediaElement({\r\n    media,\r\n    mediaSize: makeMediaSize(width, height),\r\n    boxSize: makeMediaSize(320, 240),\r\n    quality: .9\r\n  });\r\n}\r\n\r\nexport function createPosterFromVideo(video: HTMLVideoElement): ReturnType<typeof scaleMediaElement> {\r\n  return new Promise((resolve, reject) => {\r\n    video.onseeked = () => {\r\n      video.onseeked = () => {\r\n        createPosterFromMedia(video).then(resolve);\r\n\r\n        video.onseeked = undefined;\r\n      };\r\n\r\n      video.currentTime = 0;\r\n    };\r\n\r\n    video.onerror = reject;\r\n    video.currentTime = Math.min(video.duration, 1);\r\n  });\r\n}\r\n\r\nexport async function createPosterForVideo(url: string) {\r\n  const video = await preloadVideo(url);\r\n\r\n  return Promise.race([\r\n    pause(2000) as Promise<undefined>,\r\n    createPosterFromVideo(video)\r\n  ]);\r\n}\r\n\r\n\r\n","/**\n * @returns duration in ms\n */\nexport default function getGifDuration(image: HTMLImageElement) {\n  const src = image.src;\n\n  return fetch(src)\n  .then((response) => response.arrayBuffer())\n  .then((arrayBuffer) => {\n    const d = new Uint8Array(arrayBuffer);\n    // Thanks to http://justinsomnia.org/2006/10/gif-animation-duration-calculation/\n    // And http://www.w3.org/Graphics/GIF/spec-gif89a.txt\n    let duration = 0;\n    for(let i = 0, length = d.length; i < length; ++i) {\n      // Find a Graphic Control Extension hex(21F904__ ____ __00)\n      if(d[i] == 0x21 &&\n       d[i + 1] == 0xF9 &&\n       d[i + 2] == 0x04 &&\n       d[i + 7] == 0x00) {\n        // Swap 5th and 6th bytes to get the delay per frame\n        const delay = (d[i + 5] << 8) | (d[i + 4] & 0xFF);\n\n        // Should be aware browsers have a minimum frame delay\n        // e.g. 6ms for IE, 2ms modern browsers (50fps)\n        duration += delay < 2 ? 10 : delay;\n      }\n    }\n\n    return duration / 1000;\n  });\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport type Chat from '../chat/chat';\nimport InputField from '../inputField';\nimport PopupElement from '.';\nimport Scrollable from '../scrollable';\nimport {toast} from '../toast';\nimport {wrapDocument} from '../wrappers';\nimport CheckboxField from '../checkboxField';\nimport SendContextMenu from '../chat/sendContextMenu';\nimport {createPosterFromMedia, createPosterFromVideo} from '../../helpers/createPoster';\nimport {MyDocument} from '../../lib/appManagers/appDocsManager';\nimport I18n, {FormatterArguments, i18n, LangPackKey} from '../../lib/langPack';\nimport calcImageInBox from '../../helpers/calcImageInBox';\nimport placeCaretAtEnd from '../../helpers/dom/placeCaretAtEnd';\nimport {attachClickEvent} from '../../helpers/dom/clickEvent';\nimport MEDIA_MIME_TYPES_SUPPORTED from '../../environment/mediaMimeTypesSupport';\nimport getGifDuration from '../../helpers/getGifDuration';\nimport replaceContent from '../../helpers/dom/replaceContent';\nimport createVideo from '../../helpers/dom/createVideo';\nimport prepareAlbum from '../prepareAlbum';\nimport {MediaSize} from '../../helpers/mediaSize';\nimport {ThumbCache} from '../../lib/storages/thumbs';\nimport onMediaLoad from '../../helpers/onMediaLoad';\nimport apiManagerProxy from '../../lib/mtproto/mtprotoworker';\nimport {THUMB_TYPE_FULL} from '../../lib/mtproto/mtproto_config';\n\ntype SendFileParams = Partial<{\n  file: File,\n  objectURL: string,\n  thumb: {\n    blob: Blob,\n    url: string,\n    size: MediaSize\n  },\n  width: number,\n  height: number,\n  duration: number,\n  noSound: boolean,\n  itemDiv: HTMLElement\n}>;\n\nlet currentPopup: PopupNewMedia;\n\nexport function getCurrentNewMediaPopup() {\n  return currentPopup;\n}\n\nexport default class PopupNewMedia extends PopupElement {\n  private input: HTMLElement;\n  private mediaContainer: HTMLElement;\n  private groupCheckboxField: CheckboxField;\n  private mediaCheckboxField: CheckboxField;\n  private wasInputValue: string;\n\n  private willAttach: Partial<{\n    type: 'media' | 'document',\n    isMedia: true,\n    group: boolean,\n    sendFileDetails: SendFileParams[]\n  }>;\n  private inputField: InputField;\n  private captionLengthMax: number;\n\n  constructor(private chat: Chat, private files: File[], willAttachType: PopupNewMedia['willAttach']['type']) {\n    super('popup-send-photo popup-new-media', {closable: true, withConfirm: 'Modal.Send', confirmShortcutIsSendShortcut: true, body: true, title: true});\n    this.construct(willAttachType);\n  }\n\n  private async construct(willAttachType: PopupNewMedia['willAttach']['type']) {\n    this.willAttach = {\n      type: willAttachType,\n      sendFileDetails: [],\n      group: false\n    };\n\n    const config = await this.managers.apiManager.getConfig();\n    this.captionLengthMax = config.caption_length_max;\n\n    attachClickEvent(this.btnConfirm, () => this.send(), {listenerSetter: this.listenerSetter});\n\n    if(this.chat.type !== 'scheduled') {\n      const sendMenu = new SendContextMenu({\n        onSilentClick: () => {\n          this.chat.input.sendSilent = true;\n          this.send();\n        },\n        onScheduleClick: () => {\n          this.chat.input.scheduleSending(() => {\n            this.send();\n          });\n        },\n        openSide: 'bottom-left',\n        onContextElement: this.btnConfirm,\n        listenerSetter: this.listenerSetter\n      });\n\n      sendMenu.setPeerId(this.chat.peerId);\n\n      this.header.append(sendMenu.sendMenu);\n    }\n\n    this.mediaContainer = document.createElement('div');\n    this.mediaContainer.classList.add('popup-photo');\n    const scrollable = new Scrollable(null);\n    scrollable.container.append(this.mediaContainer);\n\n    this.inputField = new InputField({\n      placeholder: 'PreviewSender.CaptionPlaceholder',\n      label: 'Caption',\n      name: 'photo-caption',\n      maxLength: this.captionLengthMax,\n      withLinebreaks: true\n    });\n    this.input = this.inputField.input;\n\n    this.inputField.value = this.wasInputValue = this.chat.input.messageInputField.input.innerHTML;\n    this.chat.input.messageInputField.value = '';\n\n    this.body.append(scrollable.container);\n    this.container.append(this.inputField.container);\n\n    this.attachFiles();\n\n    this.addEventListener('close', () => {\n      this.files = [];\n      currentPopup = undefined;\n    });\n\n    currentPopup = this;\n  }\n\n  public appendDrops(element: HTMLElement) {\n    this.body.append(element);\n  }\n\n  get type() {\n    return this.willAttach.type;\n  }\n\n  set type(type: PopupNewMedia['willAttach']['type']) {\n    this.willAttach.type = type;\n  }\n\n  private appendGroupCheckboxField() {\n    const good = this.files.length > 1;\n    if(good && !this.groupCheckboxField) {\n      this.groupCheckboxField = new CheckboxField({\n        text: 'PreviewSender.GroupItems',\n        name: 'group-items'\n      });\n      this.container.append(...[this.groupCheckboxField.label, this.mediaCheckboxField?.label, this.inputField.container].filter(Boolean));\n\n      this.willAttach.group = true;\n      this.groupCheckboxField.setValueSilently(this.willAttach.group);\n\n      this.listenerSetter.add(this.groupCheckboxField.input)('change', () => {\n        const checked = this.groupCheckboxField.checked;\n\n        this.willAttach.group = checked;\n\n        this.attachFiles();\n      });\n    } else if(this.groupCheckboxField) {\n      this.groupCheckboxField.label.classList.toggle('hide', !good);\n    }\n  }\n\n  private appendMediaCheckboxField() {\n    const good = !!this.files.find((file) => MEDIA_MIME_TYPES_SUPPORTED.has(file.type));\n    if(good && !this.mediaCheckboxField) {\n      this.mediaCheckboxField = new CheckboxField({\n        text: 'PreviewSender.CompressFile',\n        name: 'compress-items'\n      });\n      this.container.append(...[this.groupCheckboxField?.label, this.mediaCheckboxField.label, this.inputField.container].filter(Boolean));\n\n      this.mediaCheckboxField.setValueSilently(this.willAttach.type === 'media');\n\n      this.listenerSetter.add(this.mediaCheckboxField.input)('change', () => {\n        const checked = this.mediaCheckboxField.checked;\n\n        this.willAttach.type = checked ? 'media' : 'document';\n\n        this.attachFiles();\n      });\n    } else if(this.mediaCheckboxField) {\n      this.mediaCheckboxField.label.classList.toggle('hide', !good);\n    }\n  }\n\n  public addFiles(files: File[]) {\n    const toPush = files.filter((file) => {\n      const found = this.files.find((_file) => {\n        return _file.lastModified === file.lastModified && _file.name === file.name && _file.size === file.size;\n      });\n\n      return !found;\n    });\n\n    if(toPush.length) {\n      this.files.push(...toPush);\n      this.attachFiles();\n    }\n  }\n\n  private onKeyDown = (e: KeyboardEvent) => {\n    const target = e.target as HTMLElement;\n    if(target !== this.input) {\n      if(target.tagName === 'INPUT' || target.hasAttribute('contenteditable')) {\n        return;\n      }\n\n      this.input.focus();\n      placeCaretAtEnd(this.input);\n    }\n  };\n\n  private send(force = false) {\n    if(this.chat.type === 'scheduled' && !force) {\n      this.chat.input.scheduleSending(() => {\n        this.send(true);\n      });\n\n      return;\n    }\n\n    let caption = this.inputField.value;\n    if(caption.length > this.captionLengthMax) {\n      toast(I18n.format('Error.PreviewSender.CaptionTooLong', true));\n      return;\n    }\n\n    this.hide();\n    const willAttach = this.willAttach;\n    willAttach.isMedia = willAttach.type === 'media' ? true : undefined;\n    const {sendFileDetails, isMedia} = willAttach;\n\n    // console.log('will send files with options:', willAttach);\n\n    const {peerId, input} = this.chat;\n\n    sendFileDetails.forEach((d) => {\n      d.itemDiv = undefined;\n    });\n\n    const {length} = sendFileDetails;\n    const sendingParams = this.chat.getMessageSendingParams();\n    this.iterate((sendFileDetails) => {\n      if(caption && sendFileDetails.length !== length) {\n        this.managers.appMessagesManager.sendText(peerId, caption, {\n          ...sendingParams,\n          clearDraft: true\n        });\n\n        caption = undefined;\n      }\n\n      const w = {\n        ...willAttach,\n        sendFileDetails\n      };\n\n      this.managers.appMessagesManager.sendAlbum(peerId, w.sendFileDetails.map((d) => d.file), Object.assign({\n        ...sendingParams,\n        caption,\n        isMedia: isMedia,\n        clearDraft: true as true\n      }, w));\n\n      caption = undefined;\n    });\n\n    input.replyToMsgId = this.chat.threadId;\n    input.onMessageSent();\n  }\n\n  private async attachMedia(params: SendFileParams, itemDiv: HTMLElement) {\n    itemDiv.classList.add('popup-item-media');\n\n    const file = params.file;\n    const isVideo = file.type.startsWith('video/');\n\n    let promise: Promise<void>;\n    if(isVideo) {\n      const video = createVideo();\n      const source = document.createElement('source');\n      source.src = params.objectURL = await apiManagerProxy.invoke('createObjectURL', file);\n      video.autoplay = true;\n      video.controls = false;\n      video.muted = true;\n\n      video.addEventListener('timeupdate', () => {\n        video.pause();\n      }, {once: true});\n\n      promise = onMediaLoad(video).then(async() => {\n        params.width = video.videoWidth;\n        params.height = video.videoHeight;\n        params.duration = Math.floor(video.duration);\n\n        const audioDecodedByteCount = (video as any).webkitAudioDecodedByteCount;\n        if(audioDecodedByteCount !== undefined) {\n          params.noSound = !audioDecodedByteCount;\n        }\n\n        itemDiv.append(video);\n        const thumb = await createPosterFromVideo(video);\n        params.thumb = {\n          url: await apiManagerProxy.invoke('createObjectURL', thumb.blob),\n          ...thumb\n        };\n      });\n\n      video.append(source);\n    } else {\n      const img = new Image();\n      promise = new Promise<void>((resolve) => {\n        img.onload = () => {\n          params.width = img.naturalWidth;\n          params.height = img.naturalHeight;\n\n          itemDiv.append(img);\n\n          if(file.type === 'image/gif') {\n            params.noSound = true;\n\n            Promise.all([\n              getGifDuration(img).then((duration) => {\n                params.duration = Math.ceil(duration);\n              }),\n\n              createPosterFromMedia(img).then(async(thumb) => {\n                params.thumb = {\n                  url: await apiManagerProxy.invoke('createObjectURL', thumb.blob),\n                  ...thumb\n                };\n              })\n            ]).then(() => {\n              resolve();\n            });\n          } else {\n            resolve();\n          }\n        };\n      });\n\n      img.src = params.objectURL = await apiManagerProxy.invoke('createObjectURL', file);\n    }\n\n    return promise;\n  }\n\n  private async attachDocument(params: SendFileParams, itemDiv: HTMLElement): ReturnType<PopupNewMedia['attachMedia']> {\n    itemDiv.classList.add('popup-item-document');\n    const file = params.file;\n\n    const isPhoto = file.type.startsWith('image/');\n    const isAudio = file.type.startsWith('audio/');\n    if(isPhoto || isAudio || file.size < 20e6) {\n      params.objectURL = await apiManagerProxy.invoke('createObjectURL', file);\n    }\n\n    const doc = {\n      _: 'document',\n      file: file,\n      file_name: file.name || '',\n      size: file.size,\n      type: isPhoto ? 'photo' : 'doc'\n    } as MyDocument;\n\n    let cacheContext: ThumbCache;\n    if(params.objectURL) {\n      cacheContext = {\n        url: params.objectURL,\n        downloaded: file.size,\n        type: THUMB_TYPE_FULL\n      };\n    }\n\n    const docDiv = await wrapDocument({\n      message: {\n        _: 'message',\n        pFlags: {\n          is_outgoing: true\n        },\n        mid: 0,\n        peerId: 0,\n        media: {\n          _: 'messageMediaDocument',\n          document: doc\n        }\n      } as any,\n      cacheContext\n    });\n\n    const promise = new Promise<void>((resolve) => {\n      const finish = () => {\n        itemDiv.append(docDiv);\n        resolve();\n      };\n\n      if(isPhoto) {\n        const img = new Image();\n        img.src = params.objectURL;\n        img.onload = () => {\n          params.width = img.naturalWidth;\n          params.height = img.naturalHeight;\n\n          finish();\n        };\n\n        img.onerror = finish;\n      } else {\n        finish();\n      }\n    });\n\n    return promise;\n  }\n\n  private attachFile = (file: File) => {\n    const willAttach = this.willAttach;\n    const shouldCompress = this.shouldCompress(file.type);\n\n    const params: SendFileParams = {};\n    params.file = file;\n\n    const itemDiv = document.createElement('div');\n    itemDiv.classList.add('popup-item');\n\n    params.itemDiv = itemDiv;\n\n    const promise = shouldCompress ? this.attachMedia(params, itemDiv) : this.attachDocument(params, itemDiv);\n    willAttach.sendFileDetails.push(params);\n    return promise;\n  };\n\n  private shouldCompress(mimeType: string) {\n    return this.willAttach.type === 'media' && MEDIA_MIME_TYPES_SUPPORTED.has(mimeType);\n  }\n\n  private onRender() {\n    // show now\n    if(!this.element.classList.contains('active')) {\n      this.listenerSetter.add(document.body)('keydown', this.onKeyDown);\n      this.addEventListener('close', () => {\n        if(this.wasInputValue) {\n          this.chat.input.messageInputField.value = this.wasInputValue;\n        }\n      });\n      this.show();\n    }\n  }\n\n  private setTitle() {\n    const {willAttach, title, files} = this;\n    let key: LangPackKey;\n    const args: FormatterArguments = [];\n    if(willAttach.type === 'document') {\n      key = 'PreviewSender.SendFile';\n      args.push(files.length);\n    } else {\n      let foundPhotos = 0, foundVideos = 0, foundFiles = 0;\n      files.forEach((file) => {\n        if(file.type.startsWith('image/')) ++foundPhotos;\n        else if(file.type.startsWith('video/')) ++foundVideos;\n        else ++foundFiles;\n      });\n\n      if([foundPhotos, foundVideos, foundFiles].filter((n) => n > 0).length > 1) {\n        key = 'PreviewSender.SendFile';\n        args.push(files.length);\n      } else\n\n      /* const sum = foundPhotos + foundVideos;\n      if(sum > 1 && willAttach.group) {\n        key = 'PreviewSender.SendAlbum';\n        const albumsLength = Math.ceil(sum / 10);\n        args.push(albumsLength);\n      } else  */if(foundPhotos) {\n        key = 'PreviewSender.SendPhoto';\n        args.push(foundPhotos);\n      } else if(foundVideos) {\n        key = 'PreviewSender.SendVideo';\n        args.push(foundVideos);\n      }\n    }\n\n    replaceContent(title, i18n(key, args));\n  }\n\n  private appendMediaToContainer(div: HTMLElement, params: SendFileParams) {\n    if(this.shouldCompress(params.file.type)) {\n      const size = calcImageInBox(params.width, params.height, 380, 320);\n      div.style.width = size.width + 'px';\n      div.style.height = size.height + 'px';\n    }\n\n    this.mediaContainer.append(div);\n  }\n\n  private iterate(cb: (sendFileDetails: SendFileParams[]) => void) {\n    const {sendFileDetails} = this.willAttach;\n    if(!this.willAttach.group) {\n      sendFileDetails.forEach((p) => cb([p]));\n      return;\n    }\n\n    const length = sendFileDetails.length;\n    for(let i = 0; i < length;) {\n      const firstType = sendFileDetails[i].file.type;\n      let k = 0;\n      for(; k < 10 && i < length; ++i, ++k) {\n        const type = sendFileDetails[i].file.type;\n        if(this.shouldCompress(firstType) !== this.shouldCompress(type)) {\n          break;\n        }\n      }\n\n      cb(sendFileDetails.slice(i - k, i));\n    }\n  }\n\n  private attachFiles() {\n    const {files, willAttach, mediaContainer} = this;\n    willAttach.sendFileDetails.length = 0;\n\n    this.appendGroupCheckboxField();\n    this.appendMediaCheckboxField();\n\n    Promise.all(files.map(this.attachFile)).then(() => {\n      mediaContainer.innerHTML = '';\n\n      if(!files.length) {\n        return;\n      }\n\n      this.setTitle();\n\n      this.iterate((sendFileDetails) => {\n        if(this.shouldCompress(sendFileDetails[0].file.type) && sendFileDetails.length > 1) {\n          const albumContainer = document.createElement('div');\n          albumContainer.classList.add('popup-item-album', 'popup-item');\n          albumContainer.append(...sendFileDetails.map((s) => s.itemDiv));\n\n          prepareAlbum({\n            container: albumContainer,\n            items: sendFileDetails.map((o) => ({w: o.width, h: o.height})),\n            maxWidth: 380,\n            minWidth: 100,\n            spacing: 4\n          });\n\n          mediaContainer.append(albumContainer);\n        } else {\n          sendFileDetails.forEach((params) => {\n            this.appendMediaToContainer(params.itemDiv, params);\n          });\n        }\n      });\n    }).then(() => {\n      this.onRender();\n    });\n  }\n}\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport fastSmoothScroll from '../fastSmoothScroll';\r\nimport cancelEvent from './cancelEvent';\r\nimport {attachClickEvent, detachClickEvent} from './clickEvent';\r\nimport findUpAsChild from './findUpAsChild';\r\nimport findUpClassName from './findUpClassName';\r\n\r\ntype ArrowKey = 'ArrowUp' | 'ArrowDown' | 'ArrowLeft' | 'ArrowRight';\r\nconst HANDLE_EVENT = 'keydown';\r\nconst ACTIVE_CLASS_NAME = 'active';\r\n\r\nconst AXIS_Y_KEYS: ArrowKey[] = ['ArrowUp', 'ArrowDown'];\r\nconst AXIS_X_KEYS: ArrowKey[] = ['ArrowLeft', 'ArrowRight'];\r\n\r\nexport type ListNavigationOptions = {\r\n  list: HTMLElement,\r\n  type: 'xy' | 'x' | 'y',\r\n  onSelect: (target: Element) => void | boolean | Promise<boolean>,\r\n  once: boolean,\r\n  waitForKey?: string[]\r\n};\r\n\r\nexport default function attachListNavigation({list, type, onSelect, once, waitForKey}: ListNavigationOptions) {\r\n  let waitForKeySet = waitForKey?.length ? new Set(waitForKey) : undefined;\r\n  const keyNames = new Set(type === 'xy' ? AXIS_Y_KEYS.concat(AXIS_X_KEYS) : (type === 'x' ? AXIS_X_KEYS : AXIS_Y_KEYS));\r\n\r\n  let target: Element;\r\n  const getCurrentTarget = () => {\r\n    return target || list.querySelector('.' + ACTIVE_CLASS_NAME) || list.firstElementChild;\r\n  };\r\n\r\n  const setCurrentTarget = (_target: Element, scrollTo: boolean) => {\r\n    if(target === _target) {\r\n      return;\r\n    }\r\n\r\n    let hadTarget = false;\r\n    if(target) {\r\n      hadTarget = true;\r\n      target.classList.remove(ACTIVE_CLASS_NAME);\r\n    }\r\n\r\n    target = _target;\r\n    if(!target) return;\r\n    target.classList.add(ACTIVE_CLASS_NAME);\r\n\r\n    if(hadTarget && scrollable && scrollTo) {\r\n      fastSmoothScroll({\r\n        container: scrollable,\r\n        element: target as HTMLElement,\r\n        position: 'center',\r\n        forceDuration: 100,\r\n        axis: type === 'x' ? 'x' : 'y'\r\n      });\r\n    }\r\n  };\r\n\r\n  const getNextTargetX = (currentTarget: Element, isNext: boolean) => {\r\n    let nextTarget: Element;\r\n    if(isNext) nextTarget = currentTarget.nextElementSibling || list.firstElementChild;\r\n    else nextTarget = currentTarget.previousElementSibling || list.lastElementChild;\r\n\r\n    return nextTarget;\r\n  };\r\n\r\n  const getNextTargetY = (currentTarget: Element, isNext: boolean) => {\r\n    const property = isNext ? 'nextElementSibling' : 'previousElementSibling';\r\n    const endProperty = isNext ? 'firstElementChild' : 'lastElementChild';\r\n    const currentRect = currentTarget.getBoundingClientRect();\r\n\r\n    let nextTarget = currentTarget[property] || list[endProperty];\r\n    while(nextTarget !== currentTarget) {\r\n      const targetRect = nextTarget.getBoundingClientRect();\r\n      if(targetRect.x === currentRect.x && targetRect.y !== currentRect.y) {\r\n        break;\r\n      }\r\n\r\n      nextTarget = nextTarget[property] || list[endProperty];\r\n    }\r\n\r\n    return nextTarget;\r\n  };\r\n\r\n  let handleArrowKey: (currentTarget: Element, key: ArrowKey) => Element;\r\n  if(type === 'xy') { // flex-direction: row; flex-wrap: wrap;\r\n    handleArrowKey = (currentTarget, key) => {\r\n      if(key === 'ArrowUp' || key === 'ArrowDown') return getNextTargetY(currentTarget, key === 'ArrowDown');\r\n      else return getNextTargetX(currentTarget, key === 'ArrowRight');\r\n    };\r\n  } else { // flex-direction: row | column;\r\n    handleArrowKey = (currentTarget, key) => getNextTargetX(currentTarget, key === 'ArrowRight' || key === 'ArrowDown');\r\n  }\r\n\r\n  let onKeyDown = (e: KeyboardEvent) => {\r\n    const key = e.key;\r\n    if(!keyNames.has(key as any)) {\r\n      if(key === 'Enter' || (type !== 'xy' && key === 'Tab')) {\r\n        cancelEvent(e);\r\n        fireSelect(getCurrentTarget());\r\n      }\r\n\r\n      return;\r\n    }\r\n\r\n    cancelEvent(e);\r\n\r\n    if(list.childElementCount > 1) {\r\n      let currentTarget = getCurrentTarget();\r\n      currentTarget = handleArrowKey(currentTarget, key as any);\r\n      setCurrentTarget(currentTarget, true);\r\n    }\r\n  };\r\n\r\n  const scrollable = findUpClassName(list, 'scrollable');\r\n  list.classList.add('navigable-list');\r\n\r\n  const onMouseMove = (e: MouseEvent) => {\r\n    const target = findUpAsChild(e.target as HTMLElement, list) as HTMLElement;\r\n    if(!target) {\r\n      return;\r\n    }\r\n\r\n    setCurrentTarget(target, false);\r\n  };\r\n\r\n  const onClick = (e: Event) => {\r\n    cancelEvent(e); // cancel keyboard closening\r\n\r\n    const target = findUpAsChild(e.target as HTMLElement, list) as HTMLElement;\r\n    if(!target) {\r\n      return;\r\n    }\r\n\r\n    setCurrentTarget(target, false);\r\n    fireSelect(getCurrentTarget());\r\n  };\r\n\r\n  const fireSelect = async(target: Element) => {\r\n    const canContinue = await onSelect(target);\r\n    if(canContinue !== undefined ? !canContinue : once) {\r\n      detach();\r\n    }\r\n  };\r\n\r\n  let attached = false;\r\n  const attach = () => {\r\n    if(attached) return;\r\n    attached = true;\r\n    // const input = document.activeElement as HTMLElement;\r\n    // input.addEventListener(HANDLE_EVENT, onKeyDown, {capture: true, passive: false});\r\n    document.addEventListener(HANDLE_EVENT, onKeyDown, {capture: true, passive: false});\r\n    list.addEventListener('mousemove', onMouseMove, {passive: true});\r\n    attachClickEvent(list, onClick);\r\n  };\r\n\r\n  const detach = () => {\r\n    if(!attached) return;\r\n    attached = false;\r\n    // input.removeEventListener(HANDLE_EVENT, onKeyDown, {capture: true});\r\n    document.removeEventListener(HANDLE_EVENT, onKeyDown, {capture: true});\r\n    list.removeEventListener('mousemove', onMouseMove);\r\n    detachClickEvent(list, onClick);\r\n  };\r\n\r\n  const resetTarget = () => {\r\n    if(waitForKeySet) return;\r\n    setCurrentTarget(list.firstElementChild, false);\r\n  };\r\n\r\n  if(waitForKeySet) {\r\n    const _onKeyDown = onKeyDown;\r\n    onKeyDown = (e) => {\r\n      if(waitForKeySet.has(e.key)) {\r\n        cancelEvent(e);\r\n\r\n        document.removeEventListener(HANDLE_EVENT, onKeyDown, {capture: true});\r\n        onKeyDown = _onKeyDown;\r\n        document.addEventListener(HANDLE_EVENT, onKeyDown, {capture: true, passive: false});\r\n\r\n        waitForKeySet = undefined;\r\n        resetTarget();\r\n      }\r\n    };\r\n  } else {\r\n    resetTarget();\r\n  }\r\n\r\n  attach();\r\n\r\n  return {\r\n    attach,\r\n    detach,\r\n    resetTarget\r\n  };\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport attachListNavigation, {ListNavigationOptions} from '../../helpers/dom/attachListNavigation';\r\nimport EventListenerBase from '../../helpers/eventListenerBase';\r\nimport {IS_MOBILE} from '../../environment/userAgent';\r\nimport rootScope from '../../lib/rootScope';\r\nimport appNavigationController, {NavigationItem} from '../appNavigationController';\r\nimport SetTransition from '../singleTransition';\r\nimport AutocompleteHelperController from './autocompleteHelperController';\r\nimport safeAssign from '../../helpers/object/safeAssign';\r\n\r\nexport default class AutocompleteHelper extends EventListenerBase<{\r\n  hidden: () => void,\r\n  visible: () => void,\r\n  hiding: () => void\r\n}> {\r\n  protected hidden = true;\r\n  protected container: HTMLElement;\r\n  protected list: HTMLElement;\r\n  protected resetTarget: () => void;\r\n  protected attach: () => void;\r\n  protected detach: () => void;\r\n  protected init?(): void;\r\n\r\n  protected controller: AutocompleteHelperController;\r\n  protected listType: 'xy' | 'x' | 'y';\r\n  protected onSelect: ListNavigationOptions['onSelect'];\r\n  protected waitForKey?: string[];\r\n\r\n  protected navigationItem: NavigationItem;\r\n\r\n  constructor(options: {\r\n    appendTo: HTMLElement,\r\n    controller?: AutocompleteHelper['controller'],\r\n    listType: AutocompleteHelper['listType'],\r\n    onSelect: AutocompleteHelper['onSelect'],\r\n    waitForKey?: AutocompleteHelper['waitForKey']\r\n  }) {\r\n    super(false);\r\n\r\n    safeAssign(this, options);\r\n\r\n    this.container = document.createElement('div');\r\n    this.container.classList.add('autocomplete-helper', 'z-depth-1');\r\n\r\n    options.appendTo.append(this.container);\r\n\r\n    this.attachNavigation();\r\n\r\n    this.controller && this.controller.addHelper(this);\r\n  }\r\n\r\n  public toggleListNavigation(enabled: boolean) {\r\n    if(enabled) {\r\n      this.attach && this.attach();\r\n    } else {\r\n      this.detach && this.detach();\r\n    }\r\n  }\r\n\r\n  protected onVisible = () => {\r\n    if(this.detach) { // it can be so because 'visible' calls before animation's end\r\n      this.detach();\r\n    }\r\n\r\n    const list = this.list;\r\n    const {attach, detach, resetTarget} = attachListNavigation({\r\n      list,\r\n      type: this.listType,\r\n      onSelect: this.onSelect,\r\n      once: true,\r\n      waitForKey: this.waitForKey\r\n    });\r\n\r\n    this.attach = attach;\r\n    this.detach = detach;\r\n    this.resetTarget = resetTarget;\r\n    if(!IS_MOBILE && !this.navigationItem) {\r\n      this.navigationItem = {\r\n        type: 'autocomplete-helper',\r\n        onPop: () => {\r\n          this.navigationItem = undefined;\r\n          this.toggle(true);\r\n        },\r\n        noBlurOnPop: true\r\n      };\r\n\r\n      appNavigationController.pushItem(this.navigationItem);\r\n    }\r\n\r\n    this.addEventListener('hidden', () => {\r\n      this.resetTarget = undefined;\r\n      this.attach = undefined;\r\n      this.detach = undefined;\r\n\r\n      list.innerHTML = '';\r\n      detach();\r\n\r\n      if(this.navigationItem) {\r\n        appNavigationController.removeItem(this.navigationItem);\r\n        this.navigationItem = undefined;\r\n      }\r\n    }, {once: true});\r\n  };\r\n\r\n  protected attachNavigation() {\r\n    this.addEventListener('visible', this.onVisible);\r\n  }\r\n\r\n  public toggle(hide?: boolean, fromController = false, skipAnimation?: boolean) {\r\n    if(this.init) {\r\n      return;\r\n    }\r\n\r\n    if(hide === undefined) {\r\n      hide = this.container.classList.contains('is-visible') && !this.container.classList.contains('backwards');\r\n    }\r\n\r\n    if(this.hidden === hide) {\r\n      if(!hide) {\r\n        this.dispatchEvent('visible'); // reset target and listener\r\n      }\r\n\r\n      return;\r\n    }\r\n\r\n    this.hidden = hide;\r\n\r\n    if(!hide) {\r\n      this.controller && this.controller.hideOtherHelpers(this);\r\n      this.dispatchEvent('visible'); // fire it before so target will be set\r\n    } else {\r\n      if(this.navigationItem) {\r\n        appNavigationController.removeItem(this.navigationItem);\r\n        this.navigationItem = undefined;\r\n      }\r\n\r\n      if(!fromController && this.controller) {\r\n        this.controller.hideOtherHelpers();\r\n      }\r\n\r\n      if(this.detach) { // force detach here\r\n        this.detach();\r\n      }\r\n    }\r\n\r\n    const useRafs = this.controller || hide ? 0 : 2;\r\n\r\n    if(hide) {\r\n      this.dispatchEvent('hiding');\r\n    }\r\n\r\n    SetTransition(\r\n      this.container,\r\n      'is-visible',\r\n      !hide,\r\n      rootScope.settings.animationsEnabled && !skipAnimation ? 300 : 0,\r\n      () => {\r\n        this.hidden && this.dispatchEvent('hidden');\r\n      },\r\n      useRafs\r\n    );\r\n  }\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport ListenerSetter from '../../helpers/listenerSetter';\r\nimport mediaSizes from '../../helpers/mediaSizes';\r\nimport preloadAnimatedEmojiSticker from '../../helpers/preloadAnimatedEmojiSticker';\r\nimport {MyDocument} from '../../lib/appManagers/appDocsManager';\r\nimport {CHAT_ANIMATION_GROUP} from '../../lib/appManagers/appImManager';\r\nimport {AppManagers} from '../../lib/appManagers/managers';\r\nimport rootScope from '../../lib/rootScope';\r\nimport {EmoticonsDropdown} from '../emoticonsDropdown';\r\nimport {SuperStickerRenderer} from '../emoticonsDropdown/tabs/stickers';\r\nimport LazyLoadQueue from '../lazyLoadQueue';\r\nimport Scrollable from '../scrollable';\r\nimport attachStickerViewerListeners from '../stickerViewer';\r\nimport AutocompleteHelper from './autocompleteHelper';\r\nimport AutocompleteHelperController from './autocompleteHelperController';\r\n\r\nexport default class StickersHelper extends AutocompleteHelper {\r\n  private scrollable: Scrollable;\r\n  private superStickerRenderer: SuperStickerRenderer;\r\n  private lazyLoadQueue: LazyLoadQueue;\r\n  private onChangeScreen: () => void;\r\n  private listenerSetter: ListenerSetter;\r\n\r\n  constructor(\r\n    appendTo: HTMLElement,\r\n    controller: AutocompleteHelperController,\r\n    private managers: AppManagers\r\n  ) {\r\n    super({\r\n      appendTo,\r\n      controller,\r\n      listType: 'xy',\r\n      onSelect: async(target) => {\r\n        return !(await EmoticonsDropdown.onMediaClick({target}, true));\r\n      },\r\n      waitForKey: ['ArrowUp', 'ArrowDown']\r\n    });\r\n\r\n    this.container.classList.add('stickers-helper');\r\n\r\n    this.addEventListener('visible', () => {\r\n      setTimeout(() => { // it is not rendered yet\r\n        this.scrollable.container.scrollTop = 0;\r\n      }, 0);\r\n\r\n      rootScope.dispatchEvent('choosing_sticker', true);\r\n    });\r\n\r\n    this.addEventListener('hidden', () => {\r\n      if(this.onChangeScreen) {\r\n        mediaSizes.removeEventListener('changeScreen', this.onChangeScreen);\r\n        this.onChangeScreen = undefined;\r\n\r\n        this.listenerSetter.removeAll();\r\n        this.listenerSetter = undefined;\r\n      }\r\n\r\n      rootScope.dispatchEvent('choosing_sticker', false);\r\n    });\r\n  }\r\n\r\n  public checkEmoticon(emoticon: string) {\r\n    const middleware = this.controller.getMiddleware();\r\n\r\n    if(this.lazyLoadQueue) {\r\n      this.lazyLoadQueue.clear();\r\n    }\r\n\r\n    preloadAnimatedEmojiSticker(emoticon);\r\n    this.managers.appStickersManager.getStickersByEmoticon(emoticon)\r\n    .then((stickers) => {\r\n      if(!middleware()) {\r\n        return;\r\n      }\r\n\r\n      if(this.init) {\r\n        this.init();\r\n        this.init = null;\r\n      }\r\n\r\n      const container = this.list.cloneNode() as HTMLElement;\r\n\r\n      let ready: Promise<void>;\r\n\r\n      this.lazyLoadQueue.clear();\r\n      if(stickers.length) {\r\n        ready = new Promise<void>((resolve) => {\r\n          const promises: Promise<any>[] = [];\r\n          stickers.forEach((sticker) => {\r\n            container.append(this.superStickerRenderer.renderSticker(sticker as MyDocument, undefined, promises));\r\n          });\r\n\r\n          (Promise.all(promises) as Promise<any>).finally(resolve);\r\n        });\r\n      } else {\r\n        ready = Promise.resolve();\r\n      }\r\n\r\n      ready.then(() => {\r\n        this.list.replaceWith(container);\r\n        this.list = container;\r\n\r\n        if(!this.onChangeScreen) {\r\n          this.onChangeScreen = () => {\r\n            const width = (this.list.childElementCount * mediaSizes.active.esgSticker.width) + (this.list.childElementCount - 1 * 1);\r\n            this.list.style.width = width + 'px';\r\n          };\r\n          mediaSizes.addEventListener('changeScreen', this.onChangeScreen);\r\n\r\n          this.listenerSetter = new ListenerSetter();\r\n          attachStickerViewerListeners({listenTo: this.container, listenerSetter: this.listenerSetter});\r\n        }\r\n\r\n        this.onChangeScreen();\r\n\r\n        this.toggle(!stickers.length);\r\n        this.scrollable.scrollTop = 0;\r\n      });\r\n    });\r\n  }\r\n\r\n  protected init() {\r\n    this.list = document.createElement('div');\r\n    this.list.classList.add('stickers-helper-stickers', 'super-stickers');\r\n\r\n    this.container.append(this.list);\r\n\r\n    this.scrollable = new Scrollable(this.container);\r\n    this.lazyLoadQueue = new LazyLoadQueue();\r\n    this.superStickerRenderer = new SuperStickerRenderer(this.lazyLoadQueue, CHAT_ANIMATION_GROUP, this.managers);\r\n  }\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport {attachClickEvent} from '../../helpers/dom/clickEvent';\r\nimport {SEND_WHEN_ONLINE_TIMESTAMP} from '../../lib/mtproto/constants';\r\nimport Button from '../button';\r\nimport PopupDatePicker from './datePicker';\r\n\r\nconst getMinDate = () => {\r\n  const date = new Date();\r\n  // date.setDate(date.getDate() - 1);\r\n  date.setHours(0, 0, 0, 0);\r\n  return date;\r\n};\r\n\r\nconst getMaxDate = () => {\r\n  const date = new Date();\r\n  date.setFullYear(date.getFullYear() + 1);\r\n  date.setDate(date.getDate() - 1);\r\n  return date;\r\n};\r\n\r\nconst checkDate = (date: Date) => {\r\n  return date.getTime() > getMaxDate().getTime() ? new Date() : date;\r\n};\r\n\r\nexport default class PopupSchedule extends PopupDatePicker {\r\n  constructor(initDate: Date, onPick: (timestamp: number) => void, canSendWhenOnline: boolean) {\r\n    super(checkDate(initDate), onPick, {\r\n      noButtons: true,\r\n      noTitle: true,\r\n      closable: true,\r\n      withConfirm: true,\r\n      minDate: getMinDate(),\r\n      maxDate: getMaxDate(),\r\n      withTime: true,\r\n      showOverflowMonths: true,\r\n      confirmShortcutIsSendShortcut: true,\r\n      title: true\r\n    });\r\n\r\n    this.element.classList.add('popup-schedule');\r\n    this.header.append(this.controlsDiv);\r\n    this.title.replaceWith(this.monthTitle);\r\n    this.body.append(this.btnConfirm);\r\n\r\n    if(canSendWhenOnline) {\r\n      const btnSendWhenOnline = Button('btn-primary btn-secondary btn-primary-transparent primary', {text: 'Schedule.SendWhenOnline'});\r\n      this.body.append(btnSendWhenOnline);\r\n\r\n      attachClickEvent(btnSendWhenOnline, () => {\r\n        onPick(SEND_WHEN_ONLINE_TIMESTAMP);\r\n        this.hide();\r\n      });\r\n    }\r\n  }\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n *\r\n * Originally from:\r\n * https://github.com/zhukov/webogram\r\n * Copyright (C) 2014 Igor Zhukov <igor.beatle@gmail.com>\r\n * https://github.com/zhukov/webogram/blob/master/LICENSE\r\n */\r\n\r\nimport {MessageEntity} from '../../layer';\r\nimport combineSameEntities from '../../lib/richTextProcessor/combineSameEntities';\r\nimport getRichElementValue from './getRichElementValue';\r\n\r\nexport default function getRichValueWithCaret(field: HTMLElement, withEntities = true) {\r\n  const lines: string[] = [];\r\n  const line: string[] = [];\r\n\r\n  const sel = window.getSelection();\r\n  let selNode: Node;\r\n  let selOffset: number;\r\n  if(sel && sel.rangeCount) {\r\n    const range = sel.getRangeAt(0);\r\n    const startOffset = range.startOffset;\r\n    if(\r\n      range.startContainer &&\r\n      range.startContainer == range.endContainer &&\r\n      startOffset == range.endOffset\r\n    ) {\r\n      // * if focused on img, or caret has been set via placeCaretAtEnd\r\n      const possibleChildrenFocusOffset = startOffset - 1;\r\n      const childNodes = field.childNodes;\r\n      if(range.startContainer === field && childNodes[possibleChildrenFocusOffset]) {\r\n        selNode = childNodes[possibleChildrenFocusOffset];\r\n        selOffset = 0;\r\n\r\n        for(let i = 0; i < range.endOffset; ++i) {\r\n          const node = childNodes[i];\r\n          const value = node.nodeValue || (node as HTMLImageElement).alt;\r\n\r\n          if(value) {\r\n            selOffset += value.length;\r\n          }\r\n        }\r\n      } else {\r\n        selNode = range.startContainer;\r\n        selOffset = startOffset;\r\n      }\r\n    }\r\n  }\r\n\r\n  const entities: MessageEntity[] = withEntities ? [] : undefined;\r\n  getRichElementValue(field, lines, line, selNode, selOffset, entities);\r\n\r\n  if(line.length) {\r\n    lines.push(line.join(''));\r\n  }\r\n\r\n  let value = lines.join('\\n');\r\n  const caretPos = value.indexOf('\\x01');\r\n  if(caretPos != -1) {\r\n    value = value.substr(0, caretPos) + value.substr(caretPos + 1);\r\n  }\r\n  value = value.replace(/\\u00A0/g, ' ');\r\n\r\n  if(entities) {\r\n    combineSameEntities(entities);\r\n  }\r\n\r\n  return {value, entities, caretPos};\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport type ChatInput from './input';\r\nimport {appendEmoji, getEmojiFromElement} from '../emoticonsDropdown/tabs/emoji';\r\nimport {ScrollableX} from '../scrollable';\r\nimport AutocompleteHelper from './autocompleteHelper';\r\nimport AutocompleteHelperController from './autocompleteHelperController';\r\nimport {AppManagers} from '../../lib/appManagers/managers';\r\n\r\nexport default class EmojiHelper extends AutocompleteHelper {\r\n  private scrollable: ScrollableX;\r\n\r\n  constructor(\r\n    appendTo: HTMLElement,\r\n    controller: AutocompleteHelperController,\r\n    chatInput: ChatInput,\r\n    private managers: AppManagers\r\n  ) {\r\n    super({\r\n      appendTo,\r\n      controller,\r\n      listType: 'x',\r\n      onSelect: (target) => {\r\n        chatInput.onEmojiSelected(getEmojiFromElement(target as any), true);\r\n      }\r\n    });\r\n\r\n    this.container.classList.add('emoji-helper');\r\n  }\r\n\r\n  protected init() {\r\n    this.list = document.createElement('div');\r\n    this.list.classList.add('emoji-helper-emojis', 'super-emojis');\r\n\r\n    this.container.append(this.list);\r\n\r\n    this.scrollable = new ScrollableX(this.container);\r\n\r\n    this.addEventListener('visible', () => {\r\n      setTimeout(() => { // it is not rendered yet\r\n        this.scrollable.container.scrollLeft = 0;\r\n      }, 0);\r\n    });\r\n  }\r\n\r\n  public render(emojis: string[], waitForKey: boolean) {\r\n    if(this.init) {\r\n      if(!emojis.length) {\r\n        return;\r\n      }\r\n\r\n      this.init();\r\n      this.init = null;\r\n    }\r\n\r\n    emojis = emojis.slice(0, 80);\r\n\r\n    if(emojis.length) {\r\n      this.list.innerHTML = '';\r\n      emojis.forEach((emoji) => {\r\n        appendEmoji(emoji, this.list, false, true);\r\n      });\r\n    }\r\n\r\n    this.waitForKey = waitForKey ? ['ArrowUp', 'ArrowDown'] : undefined;\r\n    this.toggle(!emojis.length);\r\n\r\n    /* window.requestAnimationFrame(() => {\r\n      this.container.style.width = (3 * 2) + (emojis.length * 44) + 'px';\r\n    }); */\r\n  }\r\n\r\n  public checkQuery(query: string, firstChar: string) {\r\n    const middleware = this.controller.getMiddleware();\r\n    this.managers.appEmojiManager.getBothEmojiKeywords().then(async() => {\r\n      if(!middleware()) {\r\n        return;\r\n      }\r\n\r\n      const q = query.replace(/^:/, '');\r\n      const emojis = await this.managers.appEmojiManager.searchEmojis(q);\r\n      if(!middleware()) {\r\n        return;\r\n      }\r\n\r\n      this.render(emojis, firstChar !== ':');\r\n      // console.log(emojis);\r\n    });\r\n  }\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport setInnerHTML from '../../helpers/dom/setInnerHTML';\r\nimport wrapEmojiText from '../../lib/richTextProcessor/wrapEmojiText';\r\nimport AvatarElement from '../avatar';\r\nimport PeerTitle from '../peerTitle';\r\nimport Scrollable from '../scrollable';\r\nimport AutocompleteHelper from './autocompleteHelper';\r\nimport AutocompleteHelperController from './autocompleteHelperController';\r\n\r\nexport default class AutocompletePeerHelper extends AutocompleteHelper {\r\n  protected static BASE_CLASS = 'autocomplete-peer-helper';\r\n  protected static BASE_CLASS_LIST_ELEMENT = AutocompletePeerHelper.BASE_CLASS + '-list-element';\r\n  private scrollable: Scrollable;\r\n\r\n  constructor(\r\n    appendTo: HTMLElement,\r\n    controller: AutocompleteHelperController,\r\n    protected className: string,\r\n    onSelect: (target: Element) => boolean | void\r\n  ) {\r\n    super({\r\n      appendTo,\r\n      controller,\r\n      listType: 'y',\r\n      onSelect\r\n    });\r\n\r\n    this.container.classList.add(AutocompletePeerHelper.BASE_CLASS, className);\r\n  }\r\n\r\n  protected init() {\r\n    this.list = document.createElement('div');\r\n    this.list.classList.add(AutocompletePeerHelper.BASE_CLASS + '-list', this.className + '-list');\r\n\r\n    this.container.append(this.list);\r\n\r\n    this.scrollable = new Scrollable(this.container);\r\n\r\n    this.addEventListener('visible', () => {\r\n      setTimeout(() => { // it is not rendered yet\r\n        this.scrollable.container.scrollTop = 0;\r\n      }, 0);\r\n    });\r\n  }\r\n\r\n  public render(data: {peerId: PeerId, name?: string, description?: string}[], doNotShow?: boolean) {\r\n    if(this.init) {\r\n      if(!data.length) {\r\n        return;\r\n      }\r\n\r\n      this.init();\r\n      this.init = null;\r\n    }\r\n\r\n    if(data.length) {\r\n      this.list.innerHTML = '';\r\n      data.forEach((d) => {\r\n        const div = AutocompletePeerHelper.listElement({\r\n          className: this.className,\r\n          peerId: d.peerId,\r\n          name: d.name,\r\n          description: d.description\r\n        });\r\n\r\n        this.list.append(div);\r\n      });\r\n    }\r\n\r\n    if(!doNotShow) {\r\n      this.toggle(!data.length);\r\n    }\r\n  }\r\n\r\n  public static listElement(options: {\r\n    className: string,\r\n    peerId: PeerId,\r\n    name?: string,\r\n    description?: string\r\n  }) {\r\n    const BASE = AutocompletePeerHelper.BASE_CLASS_LIST_ELEMENT;\r\n    options.className += '-list-element';\r\n\r\n    const div = document.createElement('div');\r\n    div.classList.add(BASE, options.className);\r\n    div.dataset.peerId = '' + options.peerId;\r\n\r\n    const avatar = new AvatarElement();\r\n    avatar.classList.add('avatar-30', BASE + '-avatar', options.className + '-avatar');\r\n    avatar.updateWithOptions({\r\n      isDialog: false,\r\n      peerId: options.peerId\r\n    });\r\n\r\n    const name = document.createElement('div');\r\n    name.classList.add(BASE + '-name', options.className + '-name');\r\n    if(!options.name) {\r\n      name.append(new PeerTitle({\r\n        peerId: options.peerId,\r\n        dialog: false,\r\n        onlyFirstName: false,\r\n        plainText: false\r\n      }).element);\r\n    } else {\r\n      setInnerHTML(name, wrapEmojiText(options.name));\r\n    }\r\n\r\n    div.append(avatar, name);\r\n\r\n    if(options.description) {\r\n      const description = document.createElement('div');\r\n      description.classList.add(BASE + '-description', options.className + '-description');\r\n      setInnerHTML(description, wrapEmojiText(options.description));\r\n      div.append(description);\r\n    }\r\n\r\n    return div;\r\n  }\r\n}\r\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport type ChatInput from './input';\nimport type {BotInfo, ChatFull, UserFull} from '../../layer';\nimport AutocompleteHelperController from './autocompleteHelperController';\nimport AutocompletePeerHelper from './autocompletePeerHelper';\nimport SearchIndex from '../../lib/searchIndex';\nimport {AppManagers} from '../../lib/appManagers/managers';\n\nexport function processPeerFullForCommands(peerId: PeerId, full: ChatFull.chatFull | ChatFull.channelFull | UserFull.userFull, query?: string) {\n  const botInfos: BotInfo.botInfo[] = [].concat(full.bot_info);\n  let index: SearchIndex<string>;\n\n  if(query !== undefined) {\n    index = new SearchIndex<string>({\n      ignoreCase: true\n    });\n  }\n\n  type T = {peerId: PeerId, name: string, description: string, index: number, command: string};\n  const commands: Map<string, T> = new Map();\n  botInfos.forEach((botInfo) => {\n    if(!botInfo.commands) {\n      return;\n    }\n\n    botInfo.commands.forEach(({command, description}, idx) => {\n      const c = '/' + command;\n      commands.set(command, {\n        peerId: botInfo.user_id ? botInfo.user_id.toPeerId(false) : peerId,\n        command: command,\n        name: c,\n        description: description,\n        index: idx\n      });\n\n      if(index) {\n        index.indexObject(command, c);\n      }\n    });\n  });\n\n  let out: T[];\n  if(!index) {\n    out = [...commands.values()];\n  } else {\n    const found = index.search(query);\n    out = Array.from(found).map((command) => commands.get(command));\n  }\n\n  out = out.sort((a, b) => commands.get(a.command).index - commands.get(b.command).index);\n\n  return out;\n}\n\nexport default class CommandsHelper extends AutocompletePeerHelper {\n  constructor(\n    appendTo: HTMLElement,\n    controller: AutocompleteHelperController,\n    chatInput: ChatInput,\n    private managers: AppManagers\n  ) {\n    super(appendTo,\n      controller,\n      'commands-helper',\n      (target) => {\n        const innerHTML = target.querySelector(`.${AutocompletePeerHelper.BASE_CLASS_LIST_ELEMENT}-name`).innerHTML;\n        return chatInput.getReadyToSend(() => {\n          chatInput.messageInput.innerHTML = innerHTML;\n          chatInput.sendMessage(true);\n        });\n      }\n    );\n  }\n\n  public async checkQuery(query: string, peerId: PeerId) {\n    if(!(await this.managers.appUsersManager.isBot(peerId))) {\n      return false;\n    }\n\n    const middleware = this.controller.getMiddleware();\n    this.managers.appProfileManager.getProfileByPeerId(peerId).then((full) => {\n      if(!middleware()) {\n        return;\n      }\n\n      const filtered = processPeerFullForCommands(peerId, full, query);\n      this.render(filtered);\n      // console.log('found commands', found, filtered);\n    });\n\n    return true;\n  }\n}\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport {getMiddleware} from '../../helpers/middleware';\r\nimport AutocompleteHelper from './autocompleteHelper';\r\n\r\nexport default class AutocompleteHelperController {\r\n  private helpers: Set<AutocompleteHelper> = new Set();\r\n  private middleware = getMiddleware();\r\n  /* private tempId = 0;\r\n\r\n  public incrementToggleCount() {\r\n    return ++this.tempId;\r\n  }\r\n\r\n  public getToggleCount() {\r\n    return this.tempId;\r\n  } */\r\n\r\n  public toggleListNavigation(enabled: boolean) {\r\n    for(const helper of this.helpers) {\r\n      helper.toggleListNavigation(enabled);\r\n    }\r\n  }\r\n\r\n  public getMiddleware() {\r\n    this.middleware.clean();\r\n    return this.middleware.get();\r\n  }\r\n\r\n  public addHelper(helper: AutocompleteHelper) {\r\n    this.helpers.add(helper);\r\n  }\r\n\r\n  public hideOtherHelpers(preserveHelper?: AutocompleteHelper) {\r\n    this.helpers.forEach((helper) => {\r\n      if(helper !== preserveHelper) {\r\n        helper.toggle(true, true);\r\n      }\r\n    });\r\n\r\n    if(!preserveHelper) {\r\n      this.middleware.clean();\r\n    }\r\n  }\r\n}\r\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport type ChatInput from './input';\nimport type {MessageEntity} from '../../layer';\nimport AutocompleteHelperController from './autocompleteHelperController';\nimport AutocompletePeerHelper from './autocompletePeerHelper';\nimport {AppManagers} from '../../lib/appManagers/managers';\n\nexport default class MentionsHelper extends AutocompletePeerHelper {\n  constructor(\n    appendTo: HTMLElement,\n    controller: AutocompleteHelperController,\n    chatInput: ChatInput,\n    private managers: AppManagers\n  ) {\n    super(\n      appendTo,\n      controller,\n      'mentions-helper',\n      (target) => {\n        const userId = (target as HTMLElement).dataset.peerId.toUserId();\n        const user = Promise.resolve(managers.appUsersManager.getUser(userId)).then((user) => {\n          let str = '', entity: MessageEntity;\n          if(user.username) {\n            str = '@' + user.username;\n          } else {\n            str = user.first_name || user.last_name;\n            entity = {\n              _: 'messageEntityMentionName',\n              length: str.length,\n              offset: 0,\n              user_id: user.id\n            };\n          }\n\n          str += ' ';\n          chatInput.insertAtCaret(str, entity);\n        });\n      }\n    );\n  }\n\n  public checkQuery(query: string, peerId: PeerId, topMsgId: number) {\n    const trimmed = query.trim(); // check that there is no whitespace\n    if(query.length !== trimmed.length) return false;\n\n    const middleware = this.controller.getMiddleware();\n    this.managers.appProfileManager.getMentions(peerId && peerId.toChatId(), trimmed, topMsgId).then(async(peerIds) => {\n      if(!middleware()) return;\n\n      const username = trimmed.slice(1).toLowerCase();\n\n      const p = peerIds.map(async(peerId) => {\n        const user = await this.managers.appUsersManager.getUser(peerId);\n        if(user.username && user.username.toLowerCase() === username) { // hide full matched suggestion\n          return;\n        }\n\n        return {\n          peerId,\n          description: user.username ? '@' + user.username : undefined\n        };\n      });\n\n      this.render((await Promise.all(p)).filter(Boolean));\n    });\n\n    return true;\n  }\n}\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport type ChatInput from './input';\r\nimport DropdownHover from '../../helpers/dropdownHover';\r\nimport {KeyboardButton, ReplyMarkup} from '../../layer';\r\nimport rootScope from '../../lib/rootScope';\r\nimport ListenerSetter, {Listener} from '../../helpers/listenerSetter';\r\nimport findUpClassName from '../../helpers/dom/findUpClassName';\r\nimport IS_TOUCH_SUPPORTED from '../../environment/touchSupport';\r\nimport findUpAsChild from '../../helpers/dom/findUpAsChild';\r\nimport cancelEvent from '../../helpers/dom/cancelEvent';\r\nimport {getHeavyAnimationPromise} from '../../hooks/useHeavyAnimationCheck';\r\nimport confirmationPopup from '../confirmationPopup';\r\nimport safeAssign from '../../helpers/object/safeAssign';\r\nimport setInnerHTML from '../../helpers/dom/setInnerHTML';\r\nimport wrapEmojiText from '../../lib/richTextProcessor/wrapEmojiText';\r\nimport {AppManagers} from '../../lib/appManagers/managers';\r\nimport {attachClickEvent} from '../../helpers/dom/clickEvent';\r\n\r\nexport default class ReplyKeyboard extends DropdownHover {\r\n  private static BASE_CLASS = 'reply-keyboard';\r\n  private appendTo: HTMLElement;\r\n  private listenerSetter: ListenerSetter;\r\n  private managers: AppManagers;\r\n  private btnHover: HTMLElement;\r\n  private peerId: PeerId;\r\n  private touchListener: Listener;\r\n  private chatInput: ChatInput;\r\n\r\n  constructor(options: {\r\n    listenerSetter: ListenerSetter,\r\n    managers: AppManagers,\r\n    appendTo: HTMLElement,\r\n    btnHover: HTMLElement,\r\n    chatInput: ChatInput\r\n  }) {\r\n    super({\r\n      element: document.createElement('div')\r\n    });\r\n\r\n    safeAssign(this, options);\r\n\r\n    this.element.classList.add(ReplyKeyboard.BASE_CLASS);\r\n    this.element.style.display = 'none';\r\n\r\n    this.attachButtonListener(this.btnHover, this.listenerSetter);\r\n    this.listenerSetter.add(rootScope)('history_reply_markup', async({peerId}) => {\r\n      if(this.peerId === peerId) {\r\n        if(this.checkAvailability() && this.isActive()) {\r\n          await this.render();\r\n        }\r\n\r\n        getHeavyAnimationPromise().then(() => {\r\n          this.checkForceReply();\r\n        });\r\n      }\r\n    });\r\n  }\r\n\r\n  protected init() {\r\n    this.appendTo.append(this.element);\r\n\r\n    this.listenerSetter.add(this)('open', async() => {\r\n      await this.render();\r\n\r\n      if(IS_TOUCH_SUPPORTED) {\r\n        this.touchListener = this.listenerSetter.add(document.body)('touchstart', this.onBodyTouchStart, {passive: false, capture: true}) as any as Listener;\r\n        this.listenerSetter.add(this)('close', () => {\r\n          this.listenerSetter.remove(this.touchListener);\r\n        }, {once: true});\r\n      }\r\n    });\r\n\r\n    attachClickEvent(this.element, (e) => {\r\n      const target = findUpClassName(e.target, 'btn');\r\n      if(!target) {\r\n        return;\r\n      }\r\n\r\n      const type = target.dataset.type as KeyboardButton['_'];\r\n      const {peerId} = this;\r\n      switch(type) {\r\n        case 'keyboardButtonRequestPhone': {\r\n          confirmationPopup({\r\n            titleLangKey: 'ShareYouPhoneNumberTitle',\r\n            button: {\r\n              langKey: 'OK'\r\n            },\r\n            descriptionLangKey: 'AreYouSureShareMyContactInfoBot'\r\n          }).then(() => {\r\n            this.managers.appMessagesManager.sendContact(peerId, rootScope.myId);\r\n          });\r\n          break;\r\n        }\r\n\r\n        default: {\r\n          this.managers.appMessagesManager.sendText(peerId, target.dataset.text);\r\n          break;\r\n        }\r\n      }\r\n\r\n      this.toggle(false);\r\n    }, {listenerSetter: this.listenerSetter});\r\n\r\n    return super.init();\r\n  }\r\n\r\n  private onBodyTouchStart = (e: TouchEvent) => {\r\n    const target = e.touches[0].target as HTMLElement;\r\n    if(!findUpAsChild(target, this.element) && target !== this.btnHover) {\r\n      cancelEvent(e);\r\n      this.toggle(false);\r\n    }\r\n  };\r\n\r\n  public async checkForceReply() {\r\n    const replyMarkup = await this.getReplyMarkup();\r\n    if(replyMarkup._ === 'replyKeyboardForceReply' &&\r\n      !replyMarkup.pFlags.hidden &&\r\n      !replyMarkup.pFlags.used) {\r\n      replyMarkup.pFlags.used = true;\r\n      this.chatInput.initMessageReply(replyMarkup.mid);\r\n    }\r\n  }\r\n\r\n  private async getReplyMarkup() {\r\n    return (await this.managers.appMessagesManager.getHistoryStorageTransferable(this.peerId)).replyMarkup ?? {\r\n      _: 'replyKeyboardHide'\r\n    };\r\n  }\r\n\r\n  public async render(replyMarkup?: ReplyMarkup.replyKeyboardMarkup) {\r\n    if(replyMarkup === undefined) {\r\n      replyMarkup = await this.getReplyMarkup() as any;\r\n    }\r\n\r\n    this.element.textContent = '';\r\n\r\n    for(const row of replyMarkup.rows) {\r\n      const div = document.createElement('div');\r\n      div.classList.add(ReplyKeyboard.BASE_CLASS + '-row');\r\n\r\n      for(const button of row.buttons) {\r\n        const btn = document.createElement('button');\r\n        btn.classList.add(ReplyKeyboard.BASE_CLASS + '-button', 'btn');\r\n        setInnerHTML(btn, wrapEmojiText(button.text));\r\n        btn.dataset.text = button.text;\r\n        btn.dataset.type = button._;\r\n        div.append(btn);\r\n      }\r\n\r\n      this.element.append(div);\r\n    }\r\n  }\r\n\r\n  public async checkAvailability(replyMarkup?: ReplyMarkup) {\r\n    if(replyMarkup === undefined) {\r\n      replyMarkup = await this.getReplyMarkup();\r\n    }\r\n\r\n    const hide = replyMarkup._ === 'replyKeyboardHide' || !(replyMarkup as ReplyMarkup.replyInlineMarkup).rows?.length;\r\n    this.btnHover.classList.toggle('hide', hide);\r\n\r\n    if(hide) {\r\n      this.toggle(false);\r\n    }\r\n\r\n    return !hide;\r\n  }\r\n\r\n  public setPeer(peerId: PeerId) {\r\n    this.peerId = peerId;\r\n\r\n    this.checkAvailability();\r\n    this.checkForceReply();\r\n  }\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport type Chat from './chat';\r\nimport debounce from '../../helpers/schedulers/debounce';\r\nimport {WebDocument} from '../../layer';\r\nimport {MyDocument} from '../../lib/appManagers/appDocsManager';\r\nimport LazyLoadQueue from '../lazyLoadQueue';\r\nimport Scrollable from '../scrollable';\r\nimport {wrapPhoto} from '../wrappers';\r\nimport AutocompleteHelper from './autocompleteHelper';\r\nimport AutocompleteHelperController from './autocompleteHelperController';\r\nimport Button from '../button';\r\nimport {attachClickEvent} from '../../helpers/dom/clickEvent';\r\nimport {MyPhoto} from '../../lib/appManagers/appPhotosManager';\r\nimport assumeType from '../../helpers/assumeType';\r\nimport GifsMasonry from '../gifsMasonry';\r\nimport {SuperStickerRenderer} from '../emoticonsDropdown/tabs/stickers';\r\nimport mediaSizes from '../../helpers/mediaSizes';\r\nimport readBlobAsDataURL from '../../helpers/blob/readBlobAsDataURL';\r\nimport setInnerHTML from '../../helpers/dom/setInnerHTML';\r\nimport renderMediaWithFadeIn from '../../helpers/dom/renderMediaWithFadeIn';\r\nimport {AppManagers} from '../../lib/appManagers/managers';\r\nimport wrapEmojiText from '../../lib/richTextProcessor/wrapEmojiText';\r\nimport wrapRichText from '../../lib/richTextProcessor/wrapRichText';\r\nimport generateQId from '../../lib/appManagers/utils/inlineBots/generateQId';\r\nimport appDownloadManager from '../../lib/appManagers/appDownloadManager';\r\nimport {AnimationItemGroup} from '../animationIntersector';\r\n\r\nconst ANIMATION_GROUP: AnimationItemGroup = 'INLINE-HELPER';\r\n// const GRID_ITEMS = 5;\r\n\r\nexport default class InlineHelper extends AutocompleteHelper {\r\n  private scrollable: Scrollable;\r\n  private lazyLoadQueue: LazyLoadQueue;\r\n  private gifsMasonry: GifsMasonry;\r\n  private superStickerRenderer: SuperStickerRenderer;\r\n  private onChangeScreen: () => void;\r\n  public checkQuery: (peerId: PeerId, username: string, query: string) => ReturnType<InlineHelper['_checkQuery']>;\r\n\r\n  constructor(\r\n    appendTo: HTMLElement,\r\n    controller: AutocompleteHelperController,\r\n    private chat: Chat,\r\n    private managers: AppManagers\r\n  ) {\r\n    super({\r\n      appendTo,\r\n      controller,\r\n      listType: 'xy',\r\n      waitForKey: ['ArrowUp', 'ArrowDown'],\r\n      onSelect: (target) => {\r\n        if(!target) return false; // can happen when there is only button\r\n        const {peerId, botId, queryId} = this.list.dataset;\r\n        return this.chat.input.getReadyToSend(() => {\r\n          const queryAndResultIds = generateQId(queryId, (target as HTMLElement).dataset.resultId);\r\n          this.managers.appInlineBotsManager.sendInlineResult(peerId.toPeerId(), botId, queryAndResultIds, {\r\n            ...this.chat.getMessageSendingParams(),\r\n            clearDraft: true\r\n          });\r\n\r\n          this.chat.input.onMessageSent(true, true);\r\n        });\r\n      }\r\n    });\r\n\r\n    this.container.classList.add('inline-helper');\r\n\r\n    this.addEventListener('visible', () => {\r\n      setTimeout(() => { // it is not rendered yet\r\n        this.scrollable.container.scrollTop = 0;\r\n      }, 0);\r\n    });\r\n\r\n    this.checkQuery = debounce(this._checkQuery, 200, true, true);\r\n\r\n    this.addEventListener('hidden', () => {\r\n      if(this.onChangeScreen) {\r\n        mediaSizes.removeEventListener('changeScreen', this.onChangeScreen);\r\n        this.onChangeScreen = undefined;\r\n      }\r\n    });\r\n  }\r\n\r\n  public _checkQuery = async(peerId: PeerId, username: string, query: string) => {\r\n    const middleware = this.controller.getMiddleware();\r\n\r\n    const peer = await this.managers.appUsersManager.resolveUsername(username);\r\n    if(!middleware()) {\r\n      throw 'PEER_CHANGED';\r\n    }\r\n\r\n    if(peer._ !== 'user') {\r\n      throw 'NOT_A_BOT';\r\n    }\r\n\r\n    const renderPromise = this.managers.appInlineBotsManager.getInlineResults(peerId, peer.id, query).then((botResults) => {\r\n      if(!middleware()) {\r\n        throw 'PEER_CHANGED';\r\n      }\r\n\r\n      if(this.init) {\r\n        this.init();\r\n        this.init = null;\r\n      }\r\n\r\n      const list = this.list.cloneNode() as HTMLElement;\r\n      list.dataset.peerId = '' + peerId;\r\n      list.dataset.botId = '' + peer.id;\r\n      list.dataset.queryId = '' + botResults.query_id;\r\n\r\n      const gifsMasonry = new GifsMasonry(null, ANIMATION_GROUP, this.scrollable, false);\r\n\r\n      this.lazyLoadQueue.clear();\r\n      this.superStickerRenderer.clear();\r\n\r\n      const loadPromises: Promise<any>[] = [];\r\n      const isGallery = !!botResults.pFlags.gallery;\r\n      // botResults.results.length = 3;\r\n      for(const item of botResults.results) {\r\n        const container = document.createElement('div');\r\n        container.classList.add('inline-helper-result');\r\n        container.dataset.resultId = item.id;\r\n\r\n        const preview = isGallery ? undefined : document.createElement('div');\r\n        if(preview) {\r\n          preview.classList.add('inline-helper-result-preview');\r\n\r\n          container.append(preview);\r\n        }\r\n\r\n        list.append(container);\r\n\r\n        if(!isGallery) {\r\n          preview.classList.add('empty');\r\n          setInnerHTML(preview, wrapEmojiText([...item.title.trim()][0]));\r\n\r\n          const title = document.createElement('div');\r\n          title.classList.add('inline-helper-result-title');\r\n          setInnerHTML(title, wrapEmojiText(item.title));\r\n\r\n          const description = document.createElement('div');\r\n          description.classList.add('inline-helper-result-description');\r\n          setInnerHTML(description, wrapRichText(item.description, {\r\n            noCommands: true,\r\n            noLinks: true\r\n          }));\r\n\r\n          container.append(title, description);\r\n\r\n          const separator = document.createElement('div');\r\n          separator.classList.add('inline-helper-separator');\r\n\r\n          list.append(separator);\r\n        } else {\r\n          container.classList.add('grid-item');\r\n        }\r\n\r\n        if(item._ === 'botInlineResult') {\r\n          if(item.thumb && item.thumb.mime_type.indexOf('image/') === 0) {\r\n            let mediaContainer: HTMLElement;\r\n            if(preview) {\r\n              mediaContainer = document.createElement('div');\r\n              preview.append(mediaContainer);\r\n            } else {\r\n              mediaContainer = container;\r\n            }\r\n\r\n            mediaContainer.classList.add('media-container');\r\n            isGallery && mediaContainer.classList.add('no-border-radius');\r\n\r\n            this.lazyLoadQueue.push({\r\n              div: container,\r\n              load: () => {\r\n                return appDownloadManager.download({\r\n                  dcId: 4,\r\n                  location: {\r\n                    _: 'inputWebFileLocation',\r\n                    access_hash: (item.thumb as WebDocument.webDocument).access_hash,\r\n                    url: item.thumb.url\r\n                  },\r\n                  size: item.thumb.size,\r\n                  mimeType: item.thumb.mime_type\r\n                }).then((blob) => {\r\n                  const image = new Image();\r\n                  image.classList.add('media-photo');\r\n                  readBlobAsDataURL(blob).then((dataURL) => {\r\n                    renderMediaWithFadeIn(mediaContainer, image, dataURL, true);\r\n                  });\r\n                });\r\n              }\r\n            });\r\n          }\r\n        } else {\r\n          const media = item.document as MyDocument || item.photo as MyPhoto;\r\n          if((['sticker', 'gif'] as MyDocument['type'][]).includes((media as MyDocument)?.type) && isGallery) {\r\n            assumeType<MyDocument>(media);\r\n\r\n            if(media.type === 'gif') {\r\n              gifsMasonry.add(media, container);\r\n            } else if(media.type === 'sticker') {\r\n              container.classList.add('super-sticker');\r\n              this.superStickerRenderer.renderSticker(media, container, loadPromises);\r\n              if(media.animated) {\r\n                this.superStickerRenderer.observeAnimated(container);\r\n              }\r\n            }\r\n          } else if(media) {\r\n            const size = isGallery ? 48 : undefined;\r\n            isGallery && container.classList.add('no-border-radius');\r\n            wrapPhoto({\r\n              photo: media,\r\n              container: isGallery ? container : preview,\r\n              boxWidth: size,\r\n              boxHeight: size,\r\n              middleware,\r\n              lazyLoadQueue: this.lazyLoadQueue,\r\n              loadPromises\r\n            });\r\n          }\r\n        }\r\n      }\r\n\r\n      return Promise.all(loadPromises).then(() => {\r\n        if(!middleware()) {\r\n          gifsMasonry.clear();\r\n          return;\r\n        }\r\n\r\n        list.classList.toggle('is-gallery', isGallery);\r\n        list.classList.toggle('super-stickers', isGallery);\r\n        this.container.classList.toggle('is-gallery', isGallery);\r\n\r\n        /* if(isGallery) {\r\n          list.style.gridTemplateColumns = `repeat(${Math.min(botResults.results.length, 4)}, 1fr)`;\r\n        }\r\n\r\n        this.container.style.setProperty('width', isGallery ? `${Math.min(botResults.results.length, 4) * 25}%` : '', 'important'); */\r\n\r\n        const parent = this.list.parentElement;\r\n        parent.textContent = '';\r\n        if(botResults.switch_pm) {\r\n          const btnSwitchToPM = Button('btn-primary btn-secondary btn-primary-transparent primary');\r\n          setInnerHTML(btnSwitchToPM, wrapEmojiText(botResults.switch_pm.text));\r\n          attachClickEvent(btnSwitchToPM, (e) => {\r\n            this.chat.appImManager.setInnerPeer({peerId});\r\n            this.managers.appInlineBotsManager.switchToPM(peerId, peer.id, botResults.switch_pm.start_param);\r\n          });\r\n          parent.append(btnSwitchToPM);\r\n        }\r\n        parent.append(this.list = list);\r\n\r\n        if(this.gifsMasonry) {\r\n          this.gifsMasonry.detach();\r\n        }\r\n        this.gifsMasonry = gifsMasonry;\r\n        gifsMasonry.attach();\r\n\r\n        if(!this.onChangeScreen) {\r\n          this.onChangeScreen = () => {\r\n            if(this.list.classList.contains('is-gallery')) {\r\n              const width = (this.list.childElementCount * mediaSizes.active.esgSticker.width) + (this.list.childElementCount - 1 * 1);\r\n              this.list.style.width = width + 'px';\r\n            } else {\r\n              this.list.style.width = '';\r\n            }\r\n          };\r\n          mediaSizes.addEventListener('changeScreen', this.onChangeScreen);\r\n        }\r\n\r\n        this.onChangeScreen();\r\n\r\n        this.toggle(!botResults.results.length && !botResults.switch_pm);\r\n        this.scrollable.scrollTop = 0;\r\n      });\r\n    });\r\n\r\n    return {user: peer, renderPromise};\r\n  };\r\n\r\n  protected init() {\r\n    this.list = document.createElement('div');\r\n    this.list.classList.add('inline-helper-results');\r\n\r\n    this.container.append(this.list);\r\n\r\n    this.scrollable = new Scrollable(this.container);\r\n    this.lazyLoadQueue = new LazyLoadQueue();\r\n    this.superStickerRenderer = new SuperStickerRenderer(this.lazyLoadQueue, ANIMATION_GROUP, this.managers);\r\n  }\r\n}\r\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport type ChatInput from './input';\nimport callbackify from '../../helpers/callbackify';\nimport AutocompletePeerHelper from './autocompletePeerHelper';\nimport {processPeerFullForCommands} from './commandsHelper';\nimport {AppManagers} from '../../lib/appManagers/managers';\n\nconst CLASS_NAME = 'bot-commands';\nexport default class ChatBotCommands extends AutocompletePeerHelper {\n  private userId: UserId;\n\n  constructor(\n    appendTo: HTMLElement,\n    chatInput: ChatInput,\n    private managers: AppManagers\n  ) {\n    super(appendTo, undefined, CLASS_NAME, (target) => {\n      const innerHTML = target.querySelector(`.${AutocompletePeerHelper.BASE_CLASS_LIST_ELEMENT}-name`).innerHTML;\n      return chatInput.getReadyToSend(() => {\n        chatInput.messageInput.innerHTML = innerHTML;\n        chatInput.sendMessage(true);\n        this.toggle(true);\n      });\n    });\n  }\n\n  public setUserId(userId: UserId, middleware: () => boolean) {\n    if(this.userId === userId && this.list?.childElementCount) {\n      this.toggle(false);\n      return;\n    }\n\n    this.userId = userId;\n    return callbackify(this.managers.appProfileManager.getProfile(userId), (full) => {\n      if(!middleware()) return;\n      const filtered = processPeerFullForCommands(userId.toPeerId(false), full);\n\n      const PADDING_TOP = 8;\n      // const PADDING_BOTTOM = 8;\n      const PADDING_BOTTOM = 24;\n      const height = filtered.length * 50 + PADDING_TOP + PADDING_BOTTOM;\n      this.container.style.setProperty('--height', height + 'px');\n\n      this.render(filtered);\n\n      // this.container.style.top =\n    });\n  }\n}\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport {AckedResult} from '../lib/mtproto/superMessagePort';\r\nimport {Modify} from '../types';\r\n\r\nexport default async function modifyAckedResult<T>(acked: AckedResult<T>): Promise<Modify<AckedResult<T>, {result: T | Promise<T>}>> {\r\n  return {\r\n    cached: acked.cached,\r\n    result: acked.cached ? await acked.result : acked.result\r\n  };\r\n}\r\n\r\nexport function modifyAckedPromise<T>(promise: Promise<AckedResult<T>>) {\r\n  return promise.then(modifyAckedResult);\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport indexOfAndSplice from '../../helpers/array/indexOfAndSplice';\r\nimport callbackify from '../../helpers/callbackify';\r\nimport ListenerSetter from '../../helpers/listenerSetter';\r\nimport {getMiddleware} from '../../helpers/middleware';\r\nimport {modifyAckedPromise} from '../../helpers/modifyAckedResult';\r\nimport {ChatFull} from '../../layer';\r\nimport {AppManagers} from '../../lib/appManagers/managers';\r\nimport getPeerId from '../../lib/appManagers/utils/peers/getPeerId';\r\nimport {i18n} from '../../lib/langPack';\r\nimport {AckedResult} from '../../lib/mtproto/superMessagePort';\r\nimport rootScope from '../../lib/rootScope';\r\nimport AvatarElement from '../avatar';\r\nimport ButtonMenu, {ButtonMenuItemOptions} from '../buttonMenu';\r\nimport ButtonMenuToggle from '../buttonMenuToggle';\r\nimport PeerTitle from '../peerTitle';\r\nimport SetTransition from '../singleTransition';\r\nimport getChatMembersString from '../wrappers/getChatMembersString';\r\n\r\nconst SEND_AS_ANIMATION_DURATION = 300;\r\n\r\nexport default class ChatSendAs {\r\n  private avatar: AvatarElement;\r\n  private container: HTMLElement;\r\n  private closeBtn: HTMLElement;\r\n  private btnMenu: HTMLElement;\r\n  private sendAsPeerIds: PeerId[];\r\n  private sendAsPeerId: PeerId;\r\n  private updatingPromise: ReturnType<ChatSendAs['updateManual']>;\r\n  private middleware: ReturnType<typeof getMiddleware>;\r\n  private listenerSetter: ListenerSetter;\r\n  private peerId: PeerId;\r\n  private addedListener: boolean;\r\n\r\n  constructor(\r\n    private managers: AppManagers,\r\n    private onReady: (container: HTMLElement, skipAnimation?: boolean) => void,\r\n    private onChange: (sendAsPeerId: PeerId) => void\r\n  ) {\r\n    this.middleware = getMiddleware();\r\n    this.listenerSetter = new ListenerSetter();\r\n    this.construct();\r\n  }\r\n\r\n  private construct() {\r\n    this.container = document.createElement('div');\r\n    this.container.classList.add('new-message-send-as-container');\r\n\r\n    this.closeBtn = document.createElement('div');\r\n    this.closeBtn.classList.add('new-message-send-as-close', 'new-message-send-as-avatar', 'tgico-close');\r\n\r\n    const sendAsButtons: ButtonMenuItemOptions[] = [{\r\n      text: 'SendMessageAsTitle',\r\n      onClick: undefined\r\n    }];\r\n\r\n    let previousAvatar: HTMLElement;\r\n    const onSendAsMenuToggle = (visible: boolean) => {\r\n      if(visible) {\r\n        previousAvatar = this.avatar;\r\n      }\r\n\r\n      const isChanged = this.avatar !== previousAvatar;\r\n      const useRafs = !visible && isChanged ? 2 : 0;\r\n\r\n      SetTransition(this.closeBtn, 'is-visible', visible, SEND_AS_ANIMATION_DURATION, undefined, useRafs);\r\n      if(!isChanged) {\r\n        SetTransition(previousAvatar, 'is-visible', !visible, SEND_AS_ANIMATION_DURATION, undefined, useRafs);\r\n      }\r\n    };\r\n\r\n    ButtonMenuToggle({\r\n      noRipple: true,\r\n      listenerSetter: this.listenerSetter,\r\n      container: this.container\r\n    }, 'top-right', sendAsButtons, () => {\r\n      onSendAsMenuToggle(true);\r\n    }, () => {\r\n      onSendAsMenuToggle(false);\r\n    });\r\n\r\n    sendAsButtons[0].element.classList.add('btn-menu-item-header');\r\n    this.btnMenu = this.container.firstElementChild as any;\r\n    this.btnMenu.classList.add('scrollable', 'scrollable-y');\r\n    this.container.append(this.closeBtn);\r\n  }\r\n\r\n  private async updateButtons(peerIds: PeerId[]) {\r\n    const promises: Promise<ButtonMenuItemOptions>[] = peerIds.map(async(sendAsPeerId, idx) => {\r\n      const textElement = document.createElement('div');\r\n\r\n      const subtitle = document.createElement('div');\r\n      subtitle.classList.add('btn-menu-item-subtitle');\r\n      if(sendAsPeerId.isUser()) {\r\n        subtitle.append(i18n('Chat.SendAs.PersonalAccount'));\r\n      } else if(sendAsPeerId === this.peerId) {\r\n        subtitle.append(i18n('VoiceChat.DiscussionGroup'));\r\n      } else {\r\n        subtitle.append(await getChatMembersString(sendAsPeerId.toChatId()));\r\n      }\r\n\r\n      textElement.append(\r\n        new PeerTitle({peerId: sendAsPeerId}).element,\r\n        subtitle\r\n      );\r\n\r\n      return {\r\n        onClick: idx ? async() => {\r\n          const currentPeerId = this.peerId;\r\n          this.changeSendAsPeerId(sendAsPeerId);\r\n\r\n          const middleware = this.middleware.get();\r\n          const executeButtonsUpdate = () => {\r\n            if(this.sendAsPeerId !== sendAsPeerId || !middleware()) return;\r\n            const peerIds = this.sendAsPeerIds.slice();\r\n            indexOfAndSplice(peerIds, sendAsPeerId);\r\n            peerIds.unshift(sendAsPeerId);\r\n            this.updateButtons(peerIds);\r\n          };\r\n\r\n          if(rootScope.settings.animationsEnabled) {\r\n            setTimeout(executeButtonsUpdate, 250);\r\n          } else {\r\n            executeButtonsUpdate();\r\n          }\r\n\r\n          // return;\r\n          this.managers.appMessagesManager.saveDefaultSendAs(currentPeerId, sendAsPeerId);\r\n        } : undefined,\r\n        textElement\r\n      };\r\n    });\r\n\r\n    const buttons = await Promise.all(promises);\r\n    const btnMenu = ButtonMenu(buttons/* , this.listenerSetter */);\r\n    buttons.forEach((button, idx) => {\r\n      const peerId = peerIds[idx];\r\n      const avatar = new AvatarElement();\r\n      avatar.classList.add('avatar-26', 'btn-menu-item-icon');\r\n      avatar.updateWithOptions({peerId});\r\n\r\n      if(!idx) {\r\n        avatar.classList.add('active');\r\n      }\r\n\r\n      button.element.prepend(avatar);\r\n    });\r\n\r\n    Array.from(this.btnMenu.children).slice(1).forEach((node) => node.remove());\r\n    this.btnMenu.append(...Array.from(btnMenu.children));\r\n  }\r\n\r\n  private async updateAvatar(sendAsPeerId: PeerId, skipAnimation?: boolean) {\r\n    const previousAvatar = this.avatar;\r\n    if(previousAvatar) {\r\n      if(previousAvatar.peerId === sendAsPeerId) {\r\n        return;\r\n      }\r\n    }\r\n\r\n    if(!previousAvatar) {\r\n      skipAnimation = true;\r\n    }\r\n\r\n    const useRafs = skipAnimation ? 0 : 2;\r\n    const duration = skipAnimation ? 0 : SEND_AS_ANIMATION_DURATION;\r\n    const avatar = this.avatar = new AvatarElement();\r\n    avatar.classList.add('new-message-send-as-avatar', 'avatar-30');\r\n    await avatar.updateWithOptions({\r\n      isDialog: false,\r\n      peerId: sendAsPeerId\r\n    });\r\n\r\n    SetTransition(avatar, 'is-visible', true, duration, undefined, useRafs);\r\n    if(previousAvatar) {\r\n      SetTransition(previousAvatar, 'is-visible', false, duration, () => {\r\n        previousAvatar.remove();\r\n      }, useRafs);\r\n    }\r\n\r\n    this.container.append(avatar);\r\n  }\r\n\r\n  private changeSendAsPeerId(sendAsPeerId: PeerId, skipAnimation?: boolean) {\r\n    this.sendAsPeerId = sendAsPeerId;\r\n    this.onChange(sendAsPeerId);\r\n    return this.updateAvatar(sendAsPeerId, skipAnimation);\r\n  }\r\n\r\n  private getDefaultSendAs(): Promise<AckedResult<PeerId>> {\r\n    // return rootScope.myId;\r\n    return this.managers.acknowledged.appProfileManager.getChannelFull(this.peerId.toChatId()).then((acked) => {\r\n      return {\r\n        cached: acked.cached,\r\n        result: acked.result.then((channelFull) => {\r\n          return channelFull.default_send_as ? getPeerId(channelFull.default_send_as) : undefined\r\n        })\r\n      };\r\n    });\r\n  }\r\n\r\n  public async updateManual(skipAnimation?: boolean): Promise<() => void> {\r\n    const peerId = this.peerId;\r\n    if(this.updatingPromise || !(await this.managers.appPeersManager.isChannel(peerId))) {\r\n      return;\r\n    }\r\n\r\n    const middleware = this.middleware.get(() => {\r\n      return !this.updatingPromise || this.updatingPromise === updatingPromise;\r\n    });\r\n\r\n    const {container} = this;\r\n    const chatId = peerId.toChatId();\r\n    const result = (await modifyAckedPromise(this.getDefaultSendAs())).result;\r\n    // const result = Promise.resolve(this.getDefaultSendAs());\r\n\r\n    const wasSkippingAnimation = skipAnimation;\r\n    if(result instanceof Promise) {\r\n      skipAnimation = undefined;\r\n    }\r\n\r\n    const auto = wasSkippingAnimation && !skipAnimation;\r\n\r\n    const updatingPromise = this.updatingPromise = callbackify(result, async(sendAsPeerId) => {\r\n      if(!middleware() || sendAsPeerId === undefined) return;\r\n\r\n      await this.changeSendAsPeerId(sendAsPeerId, skipAnimation);\r\n      if(!middleware()) return;\r\n\r\n      this.managers.appChatsManager.getSendAs(chatId).then((peers) => {\r\n        if(!middleware()) return;\r\n\r\n        const peerIds = peers.map((peer) => getPeerId(peer));\r\n        this.sendAsPeerIds = peerIds.slice();\r\n\r\n        indexOfAndSplice(peerIds, sendAsPeerId);\r\n        peerIds.unshift(sendAsPeerId);\r\n        this.updateButtons(peerIds);\r\n      });\r\n\r\n      const callback = () => {\r\n        this.onReady(container, skipAnimation);\r\n\r\n        if(!this.addedListener) {\r\n          this.listenerSetter.add(rootScope)('peer_full_update', (peerId) => {\r\n            if(this.peerId === peerId) {\r\n              this.update();\r\n            }\r\n          });\r\n\r\n          this.addedListener = true;\r\n        }\r\n      };\r\n\r\n      if(auto) {\r\n        callback();\r\n        return;\r\n      }\r\n\r\n      return callback;\r\n    });\r\n\r\n    updatingPromise.finally(() => {\r\n      if(this.updatingPromise === updatingPromise) {\r\n        this.updatingPromise = undefined;\r\n      }\r\n    });\r\n\r\n    if(!auto) {\r\n      return updatingPromise;\r\n    }\r\n  }\r\n\r\n  public update(skipAnimation?: boolean) {\r\n    return this.updateManual(skipAnimation).then((callback) => callback && callback());\r\n  }\r\n\r\n  public setPeerId(peerId?: PeerId) {\r\n    /* if(this.avatar) {\r\n      this.avatar.remove();\r\n      this.avatar = undefined;\r\n    } */\r\n\r\n    this.middleware.clean();\r\n    this.updatingPromise = undefined;\r\n    this.peerId = peerId;\r\n  }\r\n\r\n  public destroy() {\r\n    this.container.remove();\r\n    this.setPeerId();\r\n    this.listenerSetter.removeAll();\r\n  }\r\n}\r\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport {_i18n} from '../lib/langPack';\nimport InputField, {InputFieldOptions} from './inputField';\nimport SetTransition from './singleTransition';\n\nexport default class InputFieldAnimated extends InputField {\n  public inputFake: HTMLElement;\n\n  // public onLengthChange: (length: number, isOverflow: boolean) => void;\n  // protected wasInputFakeClientHeight: number;\n  // protected showScrollDebounced: () => void;\n\n  constructor(options?: InputFieldOptions) {\n    super(options);\n\n    this.input.addEventListener('input', () => {\n      this.inputFake.innerHTML = this.input.innerHTML;\n      this.onFakeInput();\n    });\n\n    if(options.placeholder) {\n      _i18n(this.inputFake, options.placeholder, undefined, 'placeholder');\n    }\n\n    this.input.classList.add('scrollable', 'scrollable-y');\n    // this.wasInputFakeClientHeight = 0;\n    // this.showScrollDebounced = debounce(() => this.input.classList.remove('no-scrollbar'), 150, false, true);\n    this.inputFake = document.createElement('div');\n    this.inputFake.setAttribute('contenteditable', 'true');\n    this.inputFake.className = this.input.className + ' input-field-input-fake';\n  }\n\n  public onFakeInput(setHeight = true) {\n    const {scrollHeight: newHeight/* , clientHeight */} = this.inputFake;\n    /* if(this.wasInputFakeClientHeight && this.wasInputFakeClientHeight !== clientHeight) {\n      this.input.classList.add('no-scrollbar'); // !         ,      reflow   overflow.\n      this.showScrollDebounced();\n    } */\n\n    const currentHeight = +this.input.style.height.replace('px', '');\n    if(currentHeight === newHeight) {\n      return;\n    }\n\n    const TRANSITION_DURATION_FACTOR = 50;\n    const transitionDuration = Math.round(\n      TRANSITION_DURATION_FACTOR * Math.log(Math.abs(newHeight - currentHeight))\n    );\n\n    // this.wasInputFakeClientHeight = clientHeight;\n    this.input.style.transitionDuration = `${transitionDuration}ms`;\n\n    if(setHeight) {\n      this.input.style.height = newHeight ? newHeight + 'px' : '';\n    }\n\n    const className = 'is-changing-height';\n    SetTransition(this.input, className, true, transitionDuration, () => {\n      this.input.classList.remove(className);\n    });\n  }\n\n  public setValueSilently(value: string, fromSet?: boolean) {\n    super.setValueSilently(value, fromSet);\n\n    this.inputFake.innerHTML = value;\n    if(!fromSet) {\n      this.onFakeInput();\n    }\n  }\n}\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport type {MyDocument} from '../../lib/appManagers/appDocsManager';\r\nimport type {AppImManager} from '../../lib/appManagers/appImManager';\r\nimport type {MyDraftMessage} from '../../lib/appManagers/appDraftsManager';\r\nimport type Chat from './chat';\r\nimport Recorder from '../../../public/recorder.min';\r\nimport IS_TOUCH_SUPPORTED from '../../environment/touchSupport';\r\n// import Recorder from '../opus-recorder/dist/recorder.min';\r\nimport opusDecodeController from '../../lib/opusDecodeController';\r\nimport ButtonMenu, {ButtonMenuItemOptions} from '../buttonMenu';\r\nimport emoticonsDropdown from '../emoticonsDropdown';\r\nimport PopupCreatePoll from '../popups/createPoll';\r\nimport PopupForward from '../popups/forward';\r\nimport PopupNewMedia from '../popups/newMedia';\r\nimport {toast, toastNew} from '../toast';\r\nimport {wrapReply} from '../wrappers';\r\nimport {MessageEntity, DraftMessage, WebPage, Message, UserFull} from '../../layer';\r\nimport StickersHelper from './stickersHelper';\r\nimport ButtonIcon from '../buttonIcon';\r\nimport ButtonMenuToggle from '../buttonMenuToggle';\r\nimport ListenerSetter, {Listener} from '../../helpers/listenerSetter';\r\nimport Button from '../button';\r\nimport PopupSchedule from '../popups/schedule';\r\nimport SendMenu from './sendContextMenu';\r\nimport rootScope from '../../lib/rootScope';\r\nimport PopupPinMessage from '../popups/unpinMessage';\r\nimport tsNow from '../../helpers/tsNow';\r\nimport appNavigationController, {NavigationItem} from '../appNavigationController';\r\nimport {IS_MOBILE, IS_MOBILE_SAFARI} from '../../environment/userAgent';\r\nimport I18n, {i18n, join, LangPackKey} from '../../lib/langPack';\r\nimport {generateTail} from './bubbles';\r\nimport findUpClassName from '../../helpers/dom/findUpClassName';\r\nimport ButtonCorner from '../buttonCorner';\r\nimport blurActiveElement from '../../helpers/dom/blurActiveElement';\r\nimport cancelEvent from '../../helpers/dom/cancelEvent';\r\nimport cancelSelection from '../../helpers/dom/cancelSelection';\r\nimport {attachClickEvent, simulateClickEvent} from '../../helpers/dom/clickEvent';\r\nimport getRichValue from '../../helpers/dom/getRichValue';\r\nimport isInputEmpty from '../../helpers/dom/isInputEmpty';\r\nimport isSendShortcutPressed from '../../helpers/dom/isSendShortcutPressed';\r\nimport placeCaretAtEnd from '../../helpers/dom/placeCaretAtEnd';\r\nimport {MarkdownType, markdownTags} from '../../helpers/dom/getRichElementValue';\r\nimport getRichValueWithCaret from '../../helpers/dom/getRichValueWithCaret';\r\nimport EmojiHelper from './emojiHelper';\r\nimport CommandsHelper from './commandsHelper';\r\nimport AutocompleteHelperController from './autocompleteHelperController';\r\nimport AutocompleteHelper from './autocompleteHelper';\r\nimport MentionsHelper from './mentionsHelper';\r\nimport fixSafariStickyInput from '../../helpers/dom/fixSafariStickyInput';\r\nimport ReplyKeyboard from './replyKeyboard';\r\nimport InlineHelper from './inlineHelper';\r\nimport debounce from '../../helpers/schedulers/debounce';\r\nimport noop from '../../helpers/noop';\r\nimport {putPreloader} from '../putPreloader';\r\nimport SetTransition from '../singleTransition';\r\nimport PeerTitle from '../peerTitle';\r\nimport {fastRaf} from '../../helpers/schedulers';\r\nimport PopupDeleteMessages from '../popups/deleteMessages';\r\nimport fixSafariStickyInputFocusing, {IS_STICKY_INPUT_BUGGED} from '../../helpers/dom/fixSafariStickyInputFocusing';\r\nimport PopupPeer from '../popups/peer';\r\nimport MEDIA_MIME_TYPES_SUPPORTED from '../../environment/mediaMimeTypesSupport';\r\nimport appMediaPlaybackController from '../appMediaPlaybackController';\r\nimport {BOT_START_PARAM, NULL_PEER_ID} from '../../lib/mtproto/mtproto_config';\r\nimport setCaretAt from '../../helpers/dom/setCaretAt';\r\nimport CheckboxField from '../checkboxField';\r\nimport DropdownHover from '../../helpers/dropdownHover';\r\nimport RadioForm from '../radioForm';\r\nimport findUpTag from '../../helpers/dom/findUpTag';\r\nimport toggleDisability from '../../helpers/dom/toggleDisability';\r\nimport callbackify from '../../helpers/callbackify';\r\nimport ChatBotCommands from './botCommands';\r\nimport copy from '../../helpers/object/copy';\r\nimport toHHMMSS from '../../helpers/string/toHHMMSS';\r\nimport documentFragmentToHTML from '../../helpers/dom/documentFragmentToHTML';\r\nimport PopupElement from '../popups';\r\nimport getEmojiEntityFromEmoji from '../../lib/richTextProcessor/getEmojiEntityFromEmoji';\r\nimport mergeEntities from '../../lib/richTextProcessor/mergeEntities';\r\nimport parseEntities from '../../lib/richTextProcessor/parseEntities';\r\nimport parseMarkdown from '../../lib/richTextProcessor/parseMarkdown';\r\nimport wrapDraftText from '../../lib/richTextProcessor/wrapDraftText';\r\nimport wrapDraft from '../wrappers/draft';\r\nimport wrapMessageForReply from '../wrappers/messageForReply';\r\nimport getServerMessageId from '../../lib/appManagers/utils/messageId/getServerMessageId';\r\nimport {AppManagers} from '../../lib/appManagers/managers';\r\nimport contextMenuController from '../../helpers/contextMenuController';\r\nimport {emojiFromCodePoints} from '../../vendor/emoji';\r\nimport {modifyAckedPromise} from '../../helpers/modifyAckedResult';\r\nimport ChatSendAs from './sendAs';\r\nimport filterAsync from '../../helpers/array/filterAsync';\r\nimport InputFieldAnimated from '../inputFieldAnimated';\r\nimport getStickerEffectThumb from '../../lib/appManagers/utils/stickers/getStickerEffectThumb';\r\nimport PopupStickers from '../popups/stickers';\r\nimport wrapPeerTitle from '../wrappers/peerTitle';\r\n\r\nconst RECORD_MIN_TIME = 500;\r\nconst POSTING_MEDIA_NOT_ALLOWED = 'Posting media content isn\\'t allowed in this group.';\r\n\r\ntype ChatInputHelperType = 'edit' | 'webpage' | 'forward' | 'reply';\r\n\r\nexport default class ChatInput {\r\n  // private static AUTO_COMPLETE_REG_EXP = /(\\s|^)((?::|.)(?!.*[:@]).*|(?:[@\\/]\\S*))$/;\r\n  private static AUTO_COMPLETE_REG_EXP = /(\\s|^)((?:(?:@|^\\/)\\S*)|(?::|^[^:@\\/])(?!.*[:@\\/]).*)$/;\r\n  public messageInput: HTMLElement;\r\n  public messageInputField: InputFieldAnimated;\r\n  private fileInput: HTMLInputElement;\r\n  private inputMessageContainer: HTMLDivElement;\r\n  private btnSend: HTMLButtonElement;\r\n  private btnCancelRecord: HTMLButtonElement;\r\n  private lastUrl = '';\r\n  private lastTimeType = 0;\r\n\r\n  public chatInput: HTMLElement;\r\n  public inputContainer: HTMLElement;\r\n  public rowsWrapper: HTMLDivElement;\r\n  private newMessageWrapper: HTMLDivElement;\r\n  private btnToggleEmoticons: HTMLButtonElement;\r\n  private btnToggleReplyMarkup: HTMLButtonElement;\r\n  private btnSendContainer: HTMLDivElement;\r\n\r\n  private replyKeyboard: ReplyKeyboard;\r\n\r\n  private attachMenu: HTMLElement;\r\n  private attachMenuButtons: (ButtonMenuItemOptions & {verify: (peerId: PeerId, threadId: number) => boolean | Promise<boolean>})[];\r\n\r\n  private sendMenu: SendMenu;\r\n\r\n  private replyElements: {\r\n    container: HTMLElement,\r\n    cancelBtn: HTMLButtonElement,\r\n    iconBtn: HTMLButtonElement\r\n  } = {} as any;\r\n\r\n  private forwardElements: {\r\n    changePeer: ButtonMenuItemOptions,\r\n    showSender: ButtonMenuItemOptions,\r\n    hideSender: ButtonMenuItemOptions,\r\n    showCaption: ButtonMenuItemOptions,\r\n    hideCaption: ButtonMenuItemOptions,\r\n    container: HTMLElement,\r\n    modifyArgs?: ButtonMenuItemOptions[]\r\n  };\r\n  private forwardHover: DropdownHover;\r\n  private forwardWasDroppingAuthor: boolean;\r\n\r\n  private getWebPagePromise: Promise<void>;\r\n  private willSendWebPage: WebPage = null;\r\n  private forwarding: {[fromPeerId: PeerId]: number[]};\r\n  public replyToMsgId: number;\r\n  public editMsgId: number;\r\n  public editMessage: Message.message;\r\n  private noWebPage: true;\r\n  public scheduleDate: number;\r\n  public sendSilent: true;\r\n  public startParam: string;\r\n\r\n  private recorder: any;\r\n  public recording = false;\r\n  private recordCanceled = false;\r\n  private recordTimeEl: HTMLElement;\r\n  private recordRippleEl: HTMLElement;\r\n  private recordStartTime = 0;\r\n  private recordingOverlayListener: Listener;\r\n  private recordingNavigationItem: NavigationItem;\r\n\r\n  // private scrollTop = 0;\r\n  // private scrollOffsetTop = 0;\r\n  // private scrollDiff = 0;\r\n\r\n  public helperType: Exclude<ChatInputHelperType, 'webpage'>;\r\n  private helperFunc: () => void | Promise<void>;\r\n  private helperWaitingForward: boolean;\r\n\r\n  public willAttachType: 'document' | 'media';\r\n\r\n  private lockRedo = false;\r\n  private canRedoFromHTML = '';\r\n  private readonly undoHistory: string[] = [];\r\n  private readonly executedHistory: string[] = [];\r\n  private canUndoFromHTML = '';\r\n\r\n  private autocompleteHelperController: AutocompleteHelperController;\r\n  private stickersHelper: StickersHelper;\r\n  private emojiHelper: EmojiHelper;\r\n  private commandsHelper: CommandsHelper;\r\n  private mentionsHelper: MentionsHelper;\r\n  private inlineHelper: InlineHelper;\r\n  private listenerSetter: ListenerSetter;\r\n\r\n  private pinnedControlBtn: HTMLButtonElement;\r\n\r\n  private goDownBtn: HTMLButtonElement;\r\n  private goDownUnreadBadge: HTMLElement;\r\n  private goMentionBtn: HTMLButtonElement;\r\n  private goMentionUnreadBadge: HTMLSpanElement;\r\n  private btnScheduled: HTMLButtonElement;\r\n\r\n  private btnPreloader: HTMLButtonElement;\r\n\r\n  private saveDraftDebounced: () => void;\r\n\r\n  private fakeRowsWrapper: HTMLDivElement;\r\n\r\n  private previousQuery: string;\r\n\r\n  private releaseMediaPlayback: () => void;\r\n\r\n  private botStartBtn: HTMLButtonElement;\r\n  private rowsWrapperWrapper: HTMLDivElement;\r\n  private controlContainer: HTMLElement;\r\n  private fakeSelectionWrapper: HTMLDivElement;\r\n\r\n  private fakeWrapperTo: HTMLElement;\r\n  private toggleBotStartBtnDisability: () => void;\r\n\r\n  private botCommandsToggle: HTMLElement;\r\n  private botCommands: ChatBotCommands;\r\n  private botCommandsIcon: HTMLDivElement;\r\n  private hasBotCommands: boolean;\r\n\r\n  // private activeContainer: HTMLElement;\r\n\r\n  private sendAs: ChatSendAs;\r\n  public sendAsPeerId: PeerId;\r\n\r\n  constructor(\r\n    private chat: Chat,\r\n    private appImManager: AppImManager,\r\n    private managers: AppManagers\r\n  ) {\r\n    this.listenerSetter = new ListenerSetter();\r\n  }\r\n\r\n  public construct() {\r\n    this.chatInput = document.createElement('div');\r\n    this.chatInput.classList.add('chat-input', 'hide');\r\n\r\n    this.inputContainer = document.createElement('div');\r\n    this.inputContainer.classList.add('chat-input-container');\r\n\r\n    this.rowsWrapperWrapper = document.createElement('div');\r\n    this.rowsWrapperWrapper.classList.add('rows-wrapper-wrapper');\r\n\r\n    this.rowsWrapper = document.createElement('div');\r\n    this.rowsWrapper.classList.add('rows-wrapper', 'chat-input-wrapper');\r\n\r\n    this.rowsWrapperWrapper.append(this.rowsWrapper);\r\n\r\n    const tail = generateTail();\r\n    this.rowsWrapper.append(tail);\r\n\r\n    const fakeRowsWrapper = this.fakeRowsWrapper = document.createElement('div');\r\n    fakeRowsWrapper.classList.add('fake-wrapper', 'fake-rows-wrapper');\r\n\r\n    const fakeSelectionWrapper = this.fakeSelectionWrapper = document.createElement('div');\r\n    fakeSelectionWrapper.classList.add('fake-wrapper', 'fake-selection-wrapper');\r\n\r\n    this.inputContainer.append(this.rowsWrapperWrapper, fakeRowsWrapper, fakeSelectionWrapper);\r\n    this.chatInput.append(this.inputContainer);\r\n\r\n    this.goDownBtn = ButtonCorner({icon: 'arrow_down', className: 'bubbles-corner-button bubbles-go-down hide'});\r\n    this.inputContainer.append(this.goDownBtn);\r\n\r\n    attachClickEvent(this.goDownBtn, (e) => {\r\n      cancelEvent(e);\r\n      this.chat.bubbles.onGoDownClick();\r\n    }, {listenerSetter: this.listenerSetter});\r\n\r\n    // * constructor end\r\n\r\n    /* let setScrollTopTimeout: number;\r\n    // @ts-ignore\r\n    let height = window.visualViewport.height; */\r\n    // @ts-ignore\r\n    // this.listenerSetter.add(window.visualViewport)('resize', () => {\r\n    //   const scrollable = this.chat.bubbles.scrollable;\r\n    //   const wasScrolledDown = scrollable.isScrolledDown;\r\n\r\n    //   /* if(wasScrolledDown) {\r\n    //     this.saveScroll();\r\n    //   } */\r\n\r\n    //   // @ts-ignore\r\n    //   let newHeight = window.visualViewport.height;\r\n    //   const diff = height - newHeight;\r\n    //   const scrollTop = scrollable.scrollTop;\r\n    //   const needScrollTop = wasScrolledDown ? scrollable.scrollHeight : scrollTop + diff; // * wasScrolledDown     ,     \r\n\r\n    //   console.log('resize before', scrollable.scrollTop, scrollable.container.clientHeight, scrollable.scrollHeight, wasScrolledDown, scrollable.lastScrollTop, diff, needScrollTop);\r\n\r\n    //   scrollable.scrollTop = needScrollTop;\r\n\r\n    //   if(setScrollTopTimeout) clearTimeout(setScrollTopTimeout);\r\n    //   setScrollTopTimeout = window.setTimeout(() => {\r\n    //     const diff = height - newHeight;\r\n    //     const isScrolledDown = scrollable.scrollHeight - Math.round(scrollable.scrollTop + scrollable.container.offsetHeight + diff) <= 1;\r\n    //     height = newHeight;\r\n\r\n    //     scrollable.scrollTop = needScrollTop;\r\n\r\n    //     console.log('resize after', scrollable.scrollTop, scrollable.container.clientHeight, scrollable.scrollHeight, scrollable.isScrolledDown, scrollable.lastScrollTop, isScrolledDown);\r\n\r\n    //     /* if(isScrolledDown) {\r\n    //       scrollable.scrollTop = scrollable.scrollHeight;\r\n    //     } */\r\n\r\n    //     //scrollable.scrollTop += diff;\r\n    //     setScrollTopTimeout = 0;\r\n    //   }, 0);\r\n    // });\r\n\r\n    // ! Can't use it with resizeObserver\r\n    /* this.listenerSetter.add(window.visualViewport)('resize', () => {\r\n      const scrollable = this.chat.bubbles.scrollable;\r\n      const wasScrolledDown = scrollable.isScrolledDown;\r\n\r\n      // @ts-ignore\r\n      let newHeight = window.visualViewport.height;\r\n      const diff = height - newHeight;\r\n      const needScrollTop = wasScrolledDown ? scrollable.scrollHeight : scrollable.scrollTop + diff; // * wasScrolledDown     ,     \r\n\r\n      //console.log('resize before', scrollable.scrollTop, scrollable.container.clientHeight, scrollable.scrollHeight, wasScrolledDown, scrollable.lastScrollTop, diff, needScrollTop);\r\n\r\n      scrollable.scrollTop = needScrollTop;\r\n      height = newHeight;\r\n\r\n      if(setScrollTopTimeout) clearTimeout(setScrollTopTimeout);\r\n      setScrollTopTimeout = window.setTimeout(() => { // * try again for scrolled down Android Chrome\r\n        scrollable.scrollTop = needScrollTop;\r\n\r\n        //console.log('resize after', scrollable.scrollTop, scrollable.container.clientHeight, scrollable.scrollHeight, scrollable.isScrolledDown, scrollable.lastScrollTop, isScrolledDown);\r\n        setScrollTopTimeout = 0;\r\n      }, 0);\r\n    }); */\r\n\r\n    const c = this.controlContainer = document.createElement('div');\r\n    c.classList.add('chat-input-control', 'chat-input-wrapper');\r\n    this.inputContainer.append(c);\r\n  }\r\n\r\n  public constructPeerHelpers() {\r\n    this.replyElements.container = document.createElement('div');\r\n    this.replyElements.container.classList.add('reply-wrapper');\r\n\r\n    this.replyElements.iconBtn = ButtonIcon('');\r\n    this.replyElements.cancelBtn = ButtonIcon('close reply-cancel', {noRipple: true});\r\n\r\n    this.replyElements.container.append(this.replyElements.iconBtn, this.replyElements.cancelBtn);\r\n\r\n    //\r\n\r\n    const onHideAuthorClick = () => {\r\n      isChangingAuthor = true;\r\n      return this.canToggleHideAuthor();\r\n    };\r\n\r\n    const onHideCaptionClick = () => {\r\n      isChangingAuthor = false;\r\n    };\r\n\r\n    const forwardElements: ChatInput['forwardElements'] = this.forwardElements = {} as any;\r\n    let isChangingAuthor = false;\r\n    const forwardButtons: ButtonMenuItemOptions[] = [\r\n      forwardElements.showSender = {\r\n        text: 'Chat.Alert.Forward.Action.Show1',\r\n        onClick: onHideAuthorClick,\r\n        checkboxField: new CheckboxField({checked: true})\r\n      },\r\n      forwardElements.hideSender = {\r\n        text: 'Chat.Alert.Forward.Action.Hide1',\r\n        onClick: onHideAuthorClick,\r\n        checkboxField: new CheckboxField({checked: false})\r\n      },\r\n      forwardElements.showCaption = {\r\n        text: 'Chat.Alert.Forward.Action.ShowCaption',\r\n        onClick: onHideCaptionClick,\r\n        checkboxField: new CheckboxField({checked: true})\r\n      },\r\n      forwardElements.hideCaption = {\r\n        text: 'Chat.Alert.Forward.Action.HideCaption',\r\n        onClick: onHideCaptionClick,\r\n        checkboxField: new CheckboxField({checked: false})\r\n      },\r\n      forwardElements.changePeer = {\r\n        text: 'Chat.Alert.Forward.Action.Another',\r\n        onClick: () => {\r\n          this.changeForwardRecipient();\r\n        },\r\n        icon: 'replace'\r\n      }\r\n    ];\r\n    const forwardBtnMenu = forwardElements.container = ButtonMenu(forwardButtons, this.listenerSetter);\r\n    // forwardBtnMenu.classList.add('top-center');\r\n\r\n    const children = Array.from(forwardBtnMenu.children) as HTMLElement[];\r\n    const groups: {\r\n      elements: HTMLElement[],\r\n      onChange: (value: string, event: Event) => void\r\n    }[] = [{\r\n      elements: children.slice(0, 2),\r\n      onChange: (value, e) => {\r\n        const checked = !!+value;\r\n        if(isChangingAuthor) {\r\n          this.forwardWasDroppingAuthor = !checked;\r\n        }\r\n\r\n        const replyTitle = this.replyElements.container.querySelector('.reply-title');\r\n        if(replyTitle) {\r\n          const el = replyTitle.firstElementChild as HTMLElement;\r\n          const i = I18n.weakMap.get(el) as I18n.IntlElement;\r\n          const langPackKey: LangPackKey = forwardElements.showSender.checkboxField.checked ? 'Chat.Accessory.Forward' : 'Chat.Accessory.Hidden';\r\n          i.key = langPackKey;\r\n          i.update();\r\n        }\r\n      }\r\n    }, {\r\n      elements: children.slice(2, 4),\r\n      onChange: (value) => {\r\n        const checked = !!+value;\r\n        let b: ButtonMenuItemOptions;\r\n        if(checked && this.forwardWasDroppingAuthor !== undefined) {\r\n          b = this.forwardWasDroppingAuthor ? forwardElements.hideSender : forwardElements.showSender;\r\n        } else {\r\n          b = checked ? forwardElements.showSender : forwardElements.hideSender;\r\n        }\r\n\r\n        b.checkboxField.checked = true;\r\n      }\r\n    }];\r\n    groups.forEach((group) => {\r\n      const container = RadioForm(group.elements.map((e) => {\r\n        return {\r\n          container: e,\r\n          input: e.querySelector('input')\r\n        };\r\n      }), group.onChange);\r\n\r\n      const hr = document.createElement('hr');\r\n      container.append(hr);\r\n      forwardBtnMenu.append(container);\r\n    });\r\n\r\n    forwardBtnMenu.append(forwardElements.changePeer.element);\r\n\r\n    if(!IS_TOUCH_SUPPORTED) {\r\n      const forwardHover = this.forwardHover = new DropdownHover({\r\n        element: forwardBtnMenu\r\n      });\r\n    }\r\n\r\n    forwardElements.modifyArgs = forwardButtons.slice(0, -1);\r\n    this.replyElements.container.append(forwardBtnMenu);\r\n\r\n    forwardElements.modifyArgs.forEach((b, idx) => {\r\n      const {input} = b.checkboxField;\r\n      input.type = 'radio';\r\n      input.name = idx < 2 ? 'author' : 'caption';\r\n      input.value = '' + +!(idx % 2);\r\n    });\r\n\r\n    //\r\n\r\n    this.newMessageWrapper = document.createElement('div');\r\n    this.newMessageWrapper.classList.add('new-message-wrapper');\r\n\r\n    this.btnToggleEmoticons = ButtonIcon('none toggle-emoticons', {noRipple: true});\r\n\r\n    this.inputMessageContainer = document.createElement('div');\r\n    this.inputMessageContainer.classList.add('input-message-container');\r\n\r\n    if(this.chat.type === 'chat') {\r\n      this.goDownUnreadBadge = document.createElement('span');\r\n      this.goDownUnreadBadge.classList.add('badge', 'badge-24', 'badge-primary');\r\n      this.goDownBtn.append(this.goDownUnreadBadge);\r\n\r\n      this.goMentionBtn = ButtonCorner({icon: 'mention', className: 'bubbles-corner-button bubbles-go-mention'});\r\n      this.goMentionUnreadBadge = document.createElement('span');\r\n      this.goMentionUnreadBadge.classList.add('badge', 'badge-24', 'badge-primary');\r\n      this.goMentionBtn.append(this.goMentionUnreadBadge);\r\n      this.inputContainer.append(this.goMentionBtn);\r\n\r\n      attachClickEvent(this.goMentionBtn, (e) => {\r\n        cancelEvent(e);\r\n        const middleware = this.chat.bubbles.getMiddleware();\r\n        this.managers.appMessagesManager.goToNextMention(this.chat.peerId).then((mid) => {\r\n          if(!middleware()) {\r\n            return;\r\n          }\r\n\r\n          if(mid) {\r\n            this.chat.setMessageId(mid);\r\n          }\r\n        });\r\n      }, {listenerSetter: this.listenerSetter});\r\n\r\n      this.btnScheduled = ButtonIcon('scheduled btn-scheduled float hide', {noRipple: true});\r\n\r\n      attachClickEvent(this.btnScheduled, (e) => {\r\n        this.appImManager.openScheduled(this.chat.peerId);\r\n      }, {listenerSetter: this.listenerSetter});\r\n\r\n      this.listenerSetter.add(rootScope)('scheduled_new', ({peerId}) => {\r\n        if(this.chat.peerId !== peerId) {\r\n          return;\r\n        }\r\n\r\n        this.btnScheduled.classList.remove('hide');\r\n      });\r\n\r\n      this.listenerSetter.add(rootScope)('scheduled_delete', ({peerId}) => {\r\n        if(this.chat.peerId !== peerId) {\r\n          return;\r\n        }\r\n\r\n        this.managers.appMessagesManager.getScheduledMessages(this.chat.peerId).then((value) => {\r\n          this.btnScheduled.classList.toggle('hide', !value.length);\r\n        });\r\n      });\r\n\r\n      this.btnToggleReplyMarkup = ButtonIcon('botcom toggle-reply-markup float hide', {noRipple: true});\r\n      this.replyKeyboard = new ReplyKeyboard({\r\n        appendTo: this.rowsWrapper,\r\n        listenerSetter: this.listenerSetter,\r\n        managers: this.managers,\r\n        btnHover: this.btnToggleReplyMarkup,\r\n        chatInput: this\r\n      });\r\n      this.listenerSetter.add(this.replyKeyboard)('open', () => this.btnToggleReplyMarkup.classList.add('active'));\r\n      this.listenerSetter.add(this.replyKeyboard)('close', () => this.btnToggleReplyMarkup.classList.remove('active'));\r\n\r\n      this.botCommands = new ChatBotCommands(this.rowsWrapper, this, this.managers);\r\n      this.botCommandsToggle = document.createElement('div');\r\n      this.botCommandsToggle.classList.add('new-message-bot-commands');\r\n\r\n      const scaler = document.createElement('div');\r\n      scaler.classList.add('new-message-bot-commands-icon-scale');\r\n\r\n      const icon = this.botCommandsIcon = document.createElement('div');\r\n      icon.classList.add('animated-menu-icon', 'animated-menu-close-icon');\r\n      scaler.append(icon);\r\n      this.botCommandsToggle.append(scaler);\r\n\r\n      attachClickEvent(this.botCommandsToggle, (e) => {\r\n        cancelEvent(e);\r\n        const isShown = icon.classList.contains('state-back');\r\n        if(isShown) {\r\n          this.botCommands.toggle(true);\r\n          icon.classList.remove('state-back');\r\n        } else {\r\n          this.botCommands.setUserId(this.chat.peerId.toUserId(), this.chat.bubbles.getMiddleware());\r\n          icon.classList.add('state-back');\r\n        }\r\n      }, {listenerSetter: this.listenerSetter});\r\n\r\n      this.botCommands.addEventListener('visible', () => {\r\n        icon.classList.add('state-back');\r\n      });\r\n\r\n      this.botCommands.addEventListener('hiding', () => {\r\n        icon.classList.remove('state-back');\r\n      });\r\n    }\r\n\r\n    this.attachMenuButtons = [{\r\n      icon: 'image',\r\n      text: 'Chat.Input.Attach.PhotoOrVideo',\r\n      onClick: () => {\r\n        this.fileInput.value = '';\r\n        const accept = [...MEDIA_MIME_TYPES_SUPPORTED].join(', ');\r\n        this.fileInput.setAttribute('accept', accept);\r\n        this.willAttachType = 'media';\r\n        this.fileInput.click();\r\n      },\r\n      verify: () => this.chat.canSend('send_media')\r\n    }, {\r\n      icon: 'document',\r\n      text: 'Chat.Input.Attach.Document',\r\n      onClick: () => {\r\n        this.fileInput.value = '';\r\n        this.fileInput.removeAttribute('accept');\r\n        this.willAttachType = 'document';\r\n        this.fileInput.click();\r\n      },\r\n      verify: () => this.chat.canSend('send_media')\r\n    }, {\r\n      icon: 'poll',\r\n      text: 'Poll',\r\n      onClick: () => {\r\n        PopupElement.createPopup(PopupCreatePoll, this.chat).show();\r\n      },\r\n      verify: (peerId) => peerId.isAnyChat() && this.chat.canSend('send_polls')\r\n    }];\r\n\r\n    this.attachMenu = ButtonMenuToggle({noRipple: true, listenerSetter: this.listenerSetter}, 'top-left', this.attachMenuButtons);\r\n    this.attachMenu.classList.add('attach-file', 'tgico-attach');\r\n    this.attachMenu.classList.remove('tgico-more');\r\n\r\n    // this.inputContainer.append(this.sendMenu);\r\n\r\n    this.recordTimeEl = document.createElement('div');\r\n    this.recordTimeEl.classList.add('record-time');\r\n\r\n    this.fileInput = document.createElement('input');\r\n    this.fileInput.type = 'file';\r\n    this.fileInput.multiple = true;\r\n    this.fileInput.style.display = 'none';\r\n\r\n    this.newMessageWrapper.append(...[this.botCommandsToggle, this.btnToggleEmoticons, this.inputMessageContainer, this.btnScheduled, this.btnToggleReplyMarkup, this.attachMenu, this.recordTimeEl, this.fileInput].filter(Boolean));\r\n\r\n    this.rowsWrapper.append(this.replyElements.container);\r\n    this.autocompleteHelperController = new AutocompleteHelperController();\r\n    this.stickersHelper = new StickersHelper(this.rowsWrapper, this.autocompleteHelperController, this.managers);\r\n    this.emojiHelper = new EmojiHelper(this.rowsWrapper, this.autocompleteHelperController, this, this.managers);\r\n    this.commandsHelper = new CommandsHelper(this.rowsWrapper, this.autocompleteHelperController, this, this.managers);\r\n    this.mentionsHelper = new MentionsHelper(this.rowsWrapper, this.autocompleteHelperController, this, this.managers);\r\n    this.inlineHelper = new InlineHelper(this.rowsWrapper, this.autocompleteHelperController, this.chat, this.managers);\r\n    this.rowsWrapper.append(this.newMessageWrapper);\r\n\r\n    this.btnCancelRecord = ButtonIcon('delete btn-circle z-depth-1 btn-record-cancel');\r\n\r\n    this.btnSendContainer = document.createElement('div');\r\n    this.btnSendContainer.classList.add('btn-send-container');\r\n\r\n    this.recordRippleEl = document.createElement('div');\r\n    this.recordRippleEl.classList.add('record-ripple');\r\n\r\n    this.btnSend = ButtonIcon('none btn-circle z-depth-1 btn-send animated-button-icon');\r\n    this.btnSend.insertAdjacentHTML('afterbegin', `\r\n    <span class=\"tgico tgico-send\"></span>\r\n    <span class=\"tgico tgico-schedule\"></span>\r\n    <span class=\"tgico tgico-check\"></span>\r\n    <span class=\"tgico tgico-microphone_filled\"></span>\r\n    `);\r\n\r\n    this.btnSendContainer.append(this.recordRippleEl, this.btnSend);\r\n\r\n    if(this.chat.type !== 'scheduled') {\r\n      this.sendMenu = new SendMenu({\r\n        onSilentClick: () => {\r\n          this.sendSilent = true;\r\n          this.sendMessage();\r\n        },\r\n        onScheduleClick: () => {\r\n          this.scheduleSending(undefined);\r\n        },\r\n        listenerSetter: this.listenerSetter,\r\n        openSide: 'top-left',\r\n        onContextElement: this.btnSend,\r\n        onOpen: () => {\r\n          return !this.isInputEmpty() || !!Object.keys(this.forwarding).length;\r\n        }\r\n      });\r\n\r\n      this.btnSendContainer.append(this.sendMenu.sendMenu);\r\n    }\r\n\r\n    this.inputContainer.append(this.btnCancelRecord, this.btnSendContainer);\r\n\r\n    emoticonsDropdown.attachButtonListener(this.btnToggleEmoticons, this.listenerSetter);\r\n    this.listenerSetter.add(emoticonsDropdown)('open', this.onEmoticonsOpen);\r\n    this.listenerSetter.add(emoticonsDropdown)('close', this.onEmoticonsClose);\r\n\r\n    this.attachMessageInputField();\r\n\r\n    /* this.attachMenu.addEventListener('mousedown', (e) => {\r\n      const hidden = this.attachMenu.querySelectorAll('.hide');\r\n      if(hidden.length === this.attachMenuButtons.length) {\r\n        toast(POSTING_MEDIA_NOT_ALLOWED);\r\n        cancelEvent(e);\r\n        return false;\r\n      }\r\n    }, {passive: false, capture: true}); */\r\n\r\n    this.listenerSetter.add(rootScope)('settings_updated', () => {\r\n      if(this.stickersHelper || this.emojiHelper) {\r\n        // this.previousQuery = undefined;\r\n        this.previousQuery = '';\r\n        this.checkAutocomplete();\r\n        /* if(!rootScope.settings.stickers.suggest) {\r\n          this.stickersHelper.checkEmoticon('');\r\n        } else {\r\n          this.onMessageInput();\r\n        } */\r\n      }\r\n\r\n      if(this.messageInputField) {\r\n        this.messageInputField.onFakeInput();\r\n      }\r\n    });\r\n\r\n    this.listenerSetter.add(rootScope)('draft_updated', ({peerId, threadId, draft, force}) => {\r\n      if(this.chat.threadId !== threadId || this.chat.peerId !== peerId) return;\r\n      this.setDraft(draft, true, force);\r\n    });\r\n\r\n    this.listenerSetter.add(this.appImManager)('peer_changing', (chat) => {\r\n      if(this.chat === chat) {\r\n        this.saveDraft();\r\n      }\r\n    });\r\n\r\n    this.listenerSetter.add(this.appImManager)('chat_changing', ({from, to}) => {\r\n      if(this.chat === from) {\r\n        this.autocompleteHelperController.toggleListNavigation(false);\r\n      } else if(this.chat === to) {\r\n        this.autocompleteHelperController.toggleListNavigation(true);\r\n      }\r\n    });\r\n\r\n    if(this.chat.type === 'scheduled') {\r\n      this.listenerSetter.add(rootScope)('scheduled_delete', ({peerId, mids}) => {\r\n        if(this.chat.peerId === peerId && mids.includes(this.editMsgId)) {\r\n          this.onMessageSent();\r\n        }\r\n      });\r\n    } else {\r\n      this.listenerSetter.add(rootScope)('history_delete', ({peerId, msgs}) => {\r\n        if(this.chat.peerId === peerId) {\r\n          if(msgs.has(this.editMsgId)) {\r\n            this.onMessageSent();\r\n          }\r\n\r\n          if(this.replyToMsgId && msgs.has(this.replyToMsgId)) {\r\n            this.clearHelper('reply');\r\n          }\r\n\r\n          /* if(this.chat.isStartButtonNeeded()) {\r\n            this.setStartParam(BOT_START_PARAM);\r\n          } */\r\n        }\r\n      });\r\n\r\n      this.listenerSetter.add(rootScope)('dialogs_multiupdate', (dialogs) => {\r\n        if(dialogs.has(this.chat.peerId)) {\r\n          if(this.startParam === BOT_START_PARAM) {\r\n            this.setStartParam();\r\n          } else { // updateNewMessage comes earlier than dialog appers\r\n            this.center(true);\r\n          }\r\n        }\r\n      });\r\n    }\r\n\r\n    try {\r\n      this.recorder = new Recorder({\r\n        // encoderBitRate: 32,\r\n        // encoderPath: \"../dist/encoderWorker.min.js\",\r\n        encoderSampleRate: 48000,\r\n        monitorGain: 0,\r\n        numberOfChannels: 1,\r\n        recordingGain: 1,\r\n        reuseWorker: true\r\n      });\r\n    } catch(err) {\r\n      console.error('Recorder constructor error:', err);\r\n    }\r\n\r\n    this.updateSendBtn();\r\n\r\n    this.listenerSetter.add(this.fileInput)('change', (e) => {\r\n      const files = (e.target as HTMLInputElement & EventTarget).files;\r\n      if(!files.length) {\r\n        return;\r\n      }\r\n\r\n      PopupElement.createPopup(PopupNewMedia, this.chat, Array.from(files).slice(), this.willAttachType);\r\n      this.fileInput.value = '';\r\n    }, false);\r\n\r\n    /* let time = Date.now();\r\n    this.btnSend.addEventListener('touchstart', (e) => {\r\n      time = Date.now();\r\n    });\r\n\r\n    let eventName1 = 'touchend';\r\n    this.btnSend.addEventListener(eventName1, (e: Event) => {\r\n      //cancelEvent(e);\r\n      console.log(eventName1 + ', time: ' + (Date.now() - time));\r\n    });\r\n\r\n    let eventName = 'mousedown';\r\n    this.btnSend.addEventListener(eventName, (e: Event) => {\r\n      cancelEvent(e);\r\n      console.log(eventName + ', time: ' + (Date.now() - time));\r\n    }); */\r\n    attachClickEvent(this.btnSend, this.onBtnSendClick, {listenerSetter: this.listenerSetter, touchMouseDown: true});\r\n\r\n    if(this.recorder) {\r\n      attachClickEvent(this.btnCancelRecord, this.onCancelRecordClick, {listenerSetter: this.listenerSetter});\r\n\r\n      this.recorder.onstop = () => {\r\n        this.setRecording(false);\r\n        this.chatInput.classList.remove('is-locked');\r\n        this.recordRippleEl.style.transform = '';\r\n      };\r\n\r\n      this.recorder.ondataavailable = (typedArray: Uint8Array) => {\r\n        if(this.releaseMediaPlayback) {\r\n          this.releaseMediaPlayback();\r\n          this.releaseMediaPlayback = undefined;\r\n        }\r\n\r\n        if(this.recordingOverlayListener) {\r\n          this.listenerSetter.remove(this.recordingOverlayListener);\r\n          this.recordingOverlayListener = undefined;\r\n        }\r\n\r\n        if(this.recordingNavigationItem) {\r\n          appNavigationController.removeItem(this.recordingNavigationItem);\r\n          this.recordingNavigationItem = undefined;\r\n        }\r\n\r\n        if(this.recordCanceled) {\r\n          return;\r\n        }\r\n\r\n        const {peerId, threadId} = this.chat;\r\n        const replyToMsgId = this.replyToMsgId;\r\n\r\n        const duration = (Date.now() - this.recordStartTime) / 1000 | 0;\r\n        const dataBlob = new Blob([typedArray], {type: 'audio/ogg'});\r\n        /* const fileName = new Date().toISOString() + \".opus\";\r\n        console.log('Recorder data received', typedArray, dataBlob); */\r\n\r\n        // let perf = performance.now();\r\n        opusDecodeController.decode(typedArray, true).then((result) => {\r\n          // console.log('WAVEFORM!:', /* waveform,  */performance.now() - perf);\r\n\r\n          opusDecodeController.setKeepAlive(false);\r\n\r\n          //  objectURL    audio/wav\r\n          this.managers.appMessagesManager.sendFile(peerId, dataBlob, {\r\n            isVoiceMessage: true,\r\n            isMedia: true,\r\n            duration,\r\n            waveform: result.waveform,\r\n            objectURL: result.url,\r\n            replyToMsgId,\r\n            threadId,\r\n            clearDraft: true\r\n          });\r\n\r\n          this.onMessageSent(false, true);\r\n        });\r\n      };\r\n    }\r\n\r\n    attachClickEvent(this.replyElements.cancelBtn, this.onHelperCancel, {listenerSetter: this.listenerSetter});\r\n    attachClickEvent(this.replyElements.container, this.onHelperClick, {listenerSetter: this.listenerSetter});\r\n\r\n    this.saveDraftDebounced = debounce(() => this.saveDraft(), 2500, false, true);\r\n\r\n    this.botStartBtn = Button('btn-primary btn-transparent text-bold chat-input-control-button');\r\n    this.botStartBtn.append(i18n('BotStart'));\r\n\r\n    attachClickEvent(this.botStartBtn, () => {\r\n      const {startParam} = this;\r\n      if(startParam === undefined) {\r\n        return;\r\n      }\r\n\r\n      const toggle = this.toggleBotStartBtnDisability = toggleDisability([this.botStartBtn], true);\r\n      const peerId = this.chat.peerId;\r\n      const middleware = this.chat.bubbles.getMiddleware(() => {\r\n        return this.chat.peerId === peerId && this.startParam === startParam && this.toggleBotStartBtnDisability === toggle;\r\n      });\r\n\r\n      this.managers.appMessagesManager.startBot(peerId.toUserId(), undefined, startParam).then(() => {\r\n        if(middleware()) {\r\n          toggle();\r\n          this.toggleBotStartBtnDisability = undefined;\r\n          this.setStartParam();\r\n        }\r\n      });\r\n    }, {listenerSetter: this.listenerSetter});\r\n\r\n    this.controlContainer.append(this.botStartBtn);\r\n  }\r\n\r\n  public constructPinnedHelpers() {\r\n    this.pinnedControlBtn = Button('btn-primary btn-transparent text-bold chat-input-control-button', {icon: 'unpin'});\r\n    this.controlContainer.append(this.pinnedControlBtn);\r\n\r\n    this.listenerSetter.add(this.pinnedControlBtn)('click', () => {\r\n      const peerId = this.chat.peerId;\r\n\r\n      new PopupPinMessage(peerId, 0, true, () => {\r\n        this.chat.appImManager.setPeer(); // * close tab\r\n\r\n        // ! ,     ,  ,      \r\n        const originalChat = this.chat.appImManager.chat;\r\n        if(originalChat.topbar.pinnedMessage) {\r\n          originalChat.topbar.pinnedMessage.pinnedMessageContainer.toggle(true);\r\n        }\r\n      });\r\n    });\r\n\r\n    this.chatInput.classList.add('type-pinned');\r\n  }\r\n\r\n  public _center(neededFakeContainer: HTMLElement, animate?: boolean) {\r\n    if(!neededFakeContainer && !this.inputContainer.classList.contains('is-centering')) {\r\n      return;\r\n    }\r\n\r\n    if(neededFakeContainer === this.fakeWrapperTo) {\r\n      return;\r\n    }\r\n\r\n    /* if(neededFakeContainer === this.botStartContainer && this.fakeWrapperTo === this.fakeSelectionWrapper) {\r\n      this.inputContainer.classList.remove('is-centering');\r\n      void this.rowsWrapper.offsetLeft; // reflow\r\n      // this.inputContainer.classList.add('is-centering');\r\n      // void this.rowsWrapper.offsetLeft; // reflow\r\n    } */\r\n\r\n    const fakeSelectionWrapper = neededFakeContainer || this.fakeWrapperTo;\r\n    const forwards = !!neededFakeContainer;\r\n    const oldFakeWrapperTo = this.fakeWrapperTo;\r\n    let transform = '', borderRadius = '', needTranslateX: number;\r\n    // if(forwards) {]\r\n    const fakeSelectionRect = fakeSelectionWrapper.getBoundingClientRect();\r\n    const fakeRowsRect = this.fakeRowsWrapper.getBoundingClientRect();\r\n    const widthFrom = fakeRowsRect.width;\r\n    const widthTo = fakeSelectionRect.width;\r\n\r\n    if(widthFrom !== widthTo) {\r\n      const scale = (widthTo/*  - 8 */) / widthFrom;\r\n      const initTranslateX = (widthFrom - widthTo) / 2;\r\n      needTranslateX = fakeSelectionRect.left - fakeRowsRect.left - initTranslateX;\r\n\r\n      if(forwards) {\r\n        transform = `translateX(${needTranslateX}px) scaleX(${scale})`;\r\n        // transform = `translateX(0px) scaleX(${scale})`;\r\n\r\n        if(scale < 1) {\r\n          const br = 12;\r\n          borderRadius = '' + (br + br * (1 - scale)) + 'px';\r\n        }\r\n      }\r\n      // scale = widthTo / widthFrom;\r\n    }\r\n    // }\r\n\r\n    this.fakeWrapperTo = neededFakeContainer;\r\n\r\n    const duration = animate ? 200 : 0;\r\n    SetTransition(this.inputContainer, 'is-centering', forwards, duration);\r\n    SetTransition(this.rowsWrapperWrapper, 'is-centering-to-control', !!(forwards && neededFakeContainer && neededFakeContainer.classList.contains('chat-input-control')), duration);\r\n    this.rowsWrapper.style.transform = transform;\r\n    this.rowsWrapper.style.borderRadius = borderRadius;\r\n\r\n    return {\r\n      transform,\r\n      borderRadius,\r\n      needTranslateX: oldFakeWrapperTo && (\r\n          (\r\n            neededFakeContainer &&\r\n            neededFakeContainer.classList.contains('chat-input-control') &&\r\n            oldFakeWrapperTo === this.fakeSelectionWrapper\r\n          ) || oldFakeWrapperTo.classList.contains('chat-input-control')\r\n        ) ? needTranslateX * -.5 : needTranslateX,\r\n      widthFrom,\r\n      widthTo\r\n    };\r\n  }\r\n\r\n  public async center(animate = false) {\r\n    return this._center(await this.getNeededFakeContainer(), animate);\r\n  }\r\n\r\n  public setStartParam(startParam?: string) {\r\n    if(this.startParam === startParam) {\r\n      return;\r\n    }\r\n\r\n    this.startParam = startParam;\r\n    this.center(true);\r\n  }\r\n\r\n  public async getNeededFakeContainer(startParam = this.startParam) {\r\n    if(this.chat.selection.isSelecting) {\r\n      return this.fakeSelectionWrapper;\r\n    } else if(\r\n      startParam !== undefined ||\r\n      !(await this.chat.canSend()) ||\r\n      this.chat.type === 'pinned' ||\r\n      await this.chat.isStartButtonNeeded()\r\n    ) {\r\n      return this.controlContainer;\r\n    }\r\n  }\r\n\r\n  // public getActiveContainer() {\r\n  //   if(this.chat.selection.isSelecting) {\r\n  //     return this.chat\r\n  //   }\r\n  //   return this.startParam !== undefined ? this.botStartContainer : this.rowsWrapper;\r\n  // }\r\n\r\n  // public setActiveContainer() {\r\n  //   const container = this.activeContainer;\r\n  //   const newContainer = this.getActiveContainer();\r\n  //   if(newContainer === container) {\r\n  //     return;\r\n  //   }\r\n\r\n\r\n  // }\r\n\r\n  private onCancelRecordClick = (e?: Event) => {\r\n    if(e) {\r\n      cancelEvent(e);\r\n    }\r\n\r\n    this.recordCanceled = true;\r\n    this.recorder.stop();\r\n    opusDecodeController.setKeepAlive(false);\r\n  };\r\n\r\n  private onEmoticonsOpen = () => {\r\n    const toggleClass = IS_TOUCH_SUPPORTED ? 'flip-icon' : 'active';\r\n    this.btnToggleEmoticons.classList.toggle(toggleClass, true);\r\n  };\r\n\r\n  private onEmoticonsClose = () => {\r\n    const toggleClass = IS_TOUCH_SUPPORTED ? 'flip-icon' : 'active';\r\n    this.btnToggleEmoticons.classList.toggle(toggleClass, false);\r\n  };\r\n\r\n  public getReadyToSend(callback: () => void) {\r\n    return this.chat.type === 'scheduled' ? (this.scheduleSending(callback), true) : (callback(), false);\r\n  }\r\n\r\n  public scheduleSending = async(callback: () => void = this.sendMessage.bind(this, true), initDate = new Date()) => {\r\n    const {peerId} = this.chat;\r\n    const middleware = this.chat.bubbles.getMiddleware();\r\n    const canSendWhenOnline = rootScope.myId !== peerId && peerId.isUser() && await this.managers.appUsersManager.isUserOnlineVisible(peerId);\r\n\r\n    new PopupSchedule(initDate, (timestamp) => {\r\n      if(!middleware()) {\r\n        return;\r\n      }\r\n\r\n      const minTimestamp = (Date.now() / 1000 | 0) + 10;\r\n      if(timestamp <= minTimestamp) {\r\n        timestamp = undefined;\r\n      }\r\n\r\n      this.scheduleDate = timestamp;\r\n      callback();\r\n\r\n      if(this.chat.type !== 'scheduled' && timestamp) {\r\n        setTimeout(() => { // ! need timeout here because .forwardMessages will be called after timeout\r\n          if(!middleware()) {\r\n            return;\r\n          }\r\n\r\n          const popups = PopupElement.getPopups(PopupStickers);\r\n          popups.forEach((popup) => popup.hide());\r\n\r\n          this.appImManager.openScheduled(peerId);\r\n        }, 0);\r\n      }\r\n    }, canSendWhenOnline).show();\r\n  };\r\n\r\n  public async setUnreadCount() {\r\n    if(!this.goDownUnreadBadge) {\r\n      return;\r\n    }\r\n\r\n    const dialog = await this.managers.appMessagesManager.getDialogOnly(this.chat.peerId);\r\n    const count = dialog?.unread_count;\r\n    this.goDownUnreadBadge.innerText = '' + (count || '');\r\n    this.goDownUnreadBadge.classList.toggle('badge-gray', await this.managers.appNotificationsManager.isPeerLocalMuted(this.chat.peerId, true));\r\n\r\n    if(this.goMentionUnreadBadge && this.chat.type === 'chat') {\r\n      const hasMentions = !!(dialog?.unread_mentions_count && dialog.unread_count);\r\n      this.goMentionUnreadBadge.innerText = hasMentions ? '' + (dialog.unread_mentions_count) : '';\r\n      this.goMentionBtn.classList.toggle('is-visible', hasMentions);\r\n    }\r\n  }\r\n\r\n  public saveDraft() {\r\n    if(!this.chat.peerId || this.editMsgId || this.chat.type === 'scheduled') return;\r\n\r\n    const {value, entities} = getRichValue(this.messageInputField.input);\r\n\r\n    let draft: DraftMessage.draftMessage;\r\n    if(value.length || this.replyToMsgId) {\r\n      draft = {\r\n        _: 'draftMessage',\r\n        date: tsNow(true),\r\n        message: value,\r\n        entities: entities.length ? entities : undefined,\r\n        pFlags: {\r\n          no_webpage: this.noWebPage\r\n        },\r\n        reply_to_msg_id: this.replyToMsgId\r\n      };\r\n    }\r\n\r\n    this.managers.appDraftsManager.syncDraft(this.chat.peerId, this.chat.threadId, draft);\r\n  }\r\n\r\n  public destroy() {\r\n    // this.chat.log.error('Input destroying');\r\n\r\n    this.listenerSetter.removeAll();\r\n  }\r\n\r\n  public cleanup(helperToo = true) {\r\n    if(!this.chat.peerId) {\r\n      this.chatInput.classList.add('hide');\r\n      this.goDownBtn.classList.add('hide');\r\n    }\r\n\r\n    cancelSelection();\r\n\r\n    this.lastTimeType = 0;\r\n    this.startParam = undefined;\r\n\r\n    if(this.toggleBotStartBtnDisability) {\r\n      this.toggleBotStartBtnDisability();\r\n      this.toggleBotStartBtnDisability = undefined;\r\n    }\r\n\r\n    if(this.messageInput) {\r\n      this.clearInput();\r\n      helperToo && this.clearHelper();\r\n    }\r\n  }\r\n\r\n  public async setDraft(draft?: MyDraftMessage, fromUpdate = true, force = false) {\r\n    if((!force && !isInputEmpty(this.messageInput)) || this.chat.type === 'scheduled') return false;\r\n\r\n    if(!draft) {\r\n      draft = await this.managers.appDraftsManager.getDraft(this.chat.peerId, this.chat.threadId);\r\n\r\n      if(!draft) {\r\n        if(force) { // this situation can only happen when sending message with clearDraft\r\n          /* const height = this.chatInput.getBoundingClientRect().height;\r\n          const willChangeHeight = 78 - height;\r\n          this.willChangeHeight = willChangeHeight; */\r\n          if(this.chat.container.classList.contains('is-helper-active')) {\r\n            this.t();\r\n          }\r\n\r\n          this.messageInputField.inputFake.textContent = '';\r\n          this.messageInputField.onFakeInput(false);\r\n\r\n          ((this.chat.bubbles.messagesQueuePromise || Promise.resolve()) as Promise<any>).then(() => {\r\n            fastRaf(() => {\r\n              this.onMessageSent();\r\n            });\r\n          });\r\n        }\r\n\r\n        return false;\r\n      }\r\n    }\r\n\r\n    const wrappedDraft = wrapDraft(draft);\r\n\r\n    if(this.messageInputField.value === wrappedDraft && this.replyToMsgId === draft.reply_to_msg_id) return false;\r\n\r\n    if(fromUpdate) {\r\n      this.clearHelper();\r\n    }\r\n\r\n    this.noWebPage = draft.pFlags.no_webpage;\r\n    if(draft.reply_to_msg_id) {\r\n      this.initMessageReply(draft.reply_to_msg_id);\r\n    }\r\n\r\n    this.setInputValue(wrappedDraft, fromUpdate, fromUpdate);\r\n    return true;\r\n  }\r\n\r\n  private createSendAs() {\r\n    this.sendAsPeerId = undefined;\r\n\r\n    if(this.chat.type === 'chat' || this.chat.type === 'discussion') {\r\n      let firstChange = true;\r\n      this.sendAs = new ChatSendAs(\r\n        this.managers,\r\n        (container, skipAnimation) => {\r\n          let useRafs = 0;\r\n          if(!container.parentElement) {\r\n            this.newMessageWrapper.prepend(container);\r\n            useRafs = 2;\r\n          }\r\n\r\n          this.updateOffset('as', true, skipAnimation, useRafs);\r\n        },\r\n        (sendAsPeerId) => {\r\n          this.sendAsPeerId = sendAsPeerId;\r\n\r\n          // do not change placeholder earlier than finishPeerChange does\r\n          if(firstChange) {\r\n            firstChange = false;\r\n            return;\r\n          }\r\n\r\n          this.getPlaceholderKey().then((key) => {\r\n            this.updateMessageInputPlaceholder(key);\r\n          });\r\n        }\r\n      );\r\n    } else {\r\n      this.sendAs = undefined;\r\n    }\r\n\r\n    return this.sendAs;\r\n  }\r\n\r\n  public async finishPeerChange(startParam?: string) {\r\n    const peerId = this.chat.peerId;\r\n\r\n    const {forwardElements, btnScheduled, replyKeyboard, sendMenu, goDownBtn, chatInput, botCommandsToggle} = this;\r\n\r\n    const previousSendAs = this.sendAs;\r\n    const sendAs = this.createSendAs();\r\n\r\n    const [\r\n      isBroadcast,\r\n      canPinMessage,\r\n      isBot,\r\n      canSend,\r\n      neededFakeContainer,\r\n      ackedPeerFull,\r\n      ackedScheduledMids,\r\n      setSendAsCallback,\r\n      filteredAttachMenuButtons\r\n    ] = await Promise.all([\r\n      this.managers.appPeersManager.isBroadcast(peerId),\r\n      this.managers.appPeersManager.canPinMessage(peerId),\r\n      this.managers.appPeersManager.isBot(peerId),\r\n      this.chat.canSend(),\r\n      this.getNeededFakeContainer(startParam),\r\n      modifyAckedPromise(this.managers.acknowledged.appProfileManager.getProfileByPeerId(peerId)),\r\n      btnScheduled ? modifyAckedPromise(this.managers.acknowledged.appMessagesManager.getScheduledMessages(peerId)) : undefined,\r\n      sendAs ? (sendAs.setPeerId(this.chat.peerId), sendAs.updateManual(true)) : undefined,\r\n      this.filterAttachMenuButtons()\r\n    ]);\r\n\r\n    const placeholderKey = this.messageInput ? await this.getPlaceholderKey() : undefined;\r\n\r\n    return () => {\r\n      // console.warn('[input] finishpeerchange start');\r\n\r\n      chatInput.classList.remove('hide');\r\n      goDownBtn.classList.toggle('is-broadcast', isBroadcast);\r\n      goDownBtn.classList.remove('hide');\r\n\r\n      if(this.goDownUnreadBadge) {\r\n        this.setUnreadCount();\r\n      }\r\n\r\n      if(this.chat.type === 'pinned') {\r\n        chatInput.classList.toggle('can-pin', canPinMessage);\r\n      }/*  else if(this.chat.type === 'chat') {\r\n      } */\r\n\r\n      if(forwardElements) {\r\n        this.forwardWasDroppingAuthor = false;\r\n        forwardElements.showCaption.checkboxField.setValueSilently(true);\r\n        forwardElements.showSender.checkboxField.setValueSilently(true);\r\n      }\r\n\r\n      if(btnScheduled && ackedScheduledMids) {\r\n        btnScheduled.classList.add('hide');\r\n        const middleware = this.chat.bubbles.getMiddleware();\r\n        callbackify(ackedScheduledMids.result, (mids) => {\r\n          if(!middleware() || !mids) return;\r\n          btnScheduled.classList.toggle('hide', !mids.length);\r\n        });\r\n      }\r\n\r\n      if(this.newMessageWrapper) {\r\n        this.updateOffset(null, false, true);\r\n      }\r\n\r\n      if(botCommandsToggle) {\r\n        this.hasBotCommands = undefined;\r\n        this.botCommands.toggle(true, undefined, true);\r\n        this.updateBotCommandsToggle(true);\r\n        botCommandsToggle.remove();\r\n        if(isBot) {\r\n          const middleware = this.chat.bubbles.getMiddleware();\r\n          const result = ackedPeerFull.result;\r\n          callbackify(result, (userFull) => {\r\n            if(!middleware()) return;\r\n            this.updateBotCommands(userFull as UserFull.userFull, !(result instanceof Promise));\r\n          });\r\n        }\r\n      }\r\n\r\n      if(previousSendAs) {\r\n        previousSendAs.destroy();\r\n      }\r\n\r\n      if(setSendAsCallback) {\r\n        setSendAsCallback();\r\n      }\r\n\r\n      if(replyKeyboard) {\r\n        replyKeyboard.setPeer(peerId);\r\n      }\r\n\r\n      if(sendMenu) {\r\n        sendMenu.setPeerId(peerId);\r\n      }\r\n\r\n      if(this.messageInput) {\r\n        this.updateMessageInput(canSend, placeholderKey, filteredAttachMenuButtons);\r\n      } else if(this.pinnedControlBtn) {\r\n        this.pinnedControlBtn.append(i18n(canPinMessage ? 'Chat.Input.UnpinAll' : 'Chat.Pinned.DontShow'));\r\n      }\r\n\r\n      // * testing\r\n      // this.startParam = this.appPeersManager.isBot(peerId) ? '123' : undefined;\r\n\r\n      this.startParam = startParam;\r\n\r\n      this._center(neededFakeContainer, false);\r\n\r\n      // console.warn('[input] finishpeerchange ends');\r\n    };\r\n  }\r\n\r\n  private updateOffset(type: 'commands' | 'as', forwards: boolean, skipAnimation?: boolean, useRafs?: number) {\r\n    if(type) {\r\n      this.newMessageWrapper.dataset.offset = type;\r\n    } else {\r\n      delete this.newMessageWrapper.dataset.offset;\r\n    }\r\n\r\n    SetTransition(this.newMessageWrapper, 'has-offset', forwards, skipAnimation ? 0 : 300, undefined, useRafs);\r\n  }\r\n\r\n  private updateBotCommands(userFull: UserFull.userFull, skipAnimation?: boolean) {\r\n    this.hasBotCommands = !!userFull.bot_info?.commands?.length;\r\n    this.updateBotCommandsToggle(skipAnimation);\r\n  }\r\n\r\n  private updateBotCommandsToggle(skipAnimation?: boolean) {\r\n    const {botCommandsToggle, hasBotCommands} = this;\r\n\r\n    const show = !!hasBotCommands && this.isInputEmpty();\r\n    if(!hasBotCommands) {\r\n      if(!botCommandsToggle.parentElement) {\r\n        return;\r\n      }\r\n\r\n      botCommandsToggle.remove();\r\n    }\r\n\r\n    const forwards = show;\r\n    const useRafs = botCommandsToggle.parentElement ? 0 : 2;\r\n\r\n    if(!botCommandsToggle.parentElement) {\r\n      this.newMessageWrapper.prepend(botCommandsToggle);\r\n    }\r\n\r\n    this.updateOffset('commands', forwards, skipAnimation, useRafs);\r\n  }\r\n\r\n  private async getPlaceholderKey() {\r\n    const {peerId, threadId} = this.chat;\r\n    let key: LangPackKey;\r\n    if(threadId) {\r\n      key = 'Comment';\r\n    } else if(await this.managers.appPeersManager.isBroadcast(peerId)) {\r\n      key = 'ChannelBroadcast';\r\n    } else if(\r\n      (this.sendAsPeerId !== undefined && this.sendAsPeerId !== rootScope.myId) ||\r\n      await this.managers.appMessagesManager.isAnonymousSending(peerId)\r\n    ) {\r\n      key = 'SendAnonymously';\r\n    } else {\r\n      key = 'Message';\r\n    }\r\n\r\n    return key;\r\n  }\r\n\r\n  private updateMessageInputPlaceholder(key: LangPackKey) {\r\n    // console.warn('[input] update placeholder');\r\n    const i = I18n.weakMap.get(this.messageInput) as I18n.IntlElement;\r\n    if(!i) {\r\n      return;\r\n    }\r\n\r\n    i.compareAndUpdate({key});\r\n  }\r\n\r\n  private filterAttachMenuButtons() {\r\n    if(!this.attachMenuButtons) return;\r\n    const {peerId, threadId} = this.chat;\r\n    return filterAsync(this.attachMenuButtons, (button) => {\r\n      return button.verify(peerId, threadId);\r\n    });\r\n  }\r\n\r\n  public updateMessageInput(canSend: boolean, placeholderKey: LangPackKey, visible: ChatInput['attachMenuButtons']) {\r\n    const {chatInput, attachMenu, messageInput} = this;\r\n    const {peerId, threadId} = this.chat;\r\n    const isHidden = chatInput.classList.contains('is-hidden');\r\n    const willBeHidden = !canSend;\r\n    if(isHidden !== willBeHidden) {\r\n      chatInput.classList.add('no-transition');\r\n      chatInput.classList.toggle('is-hidden', !canSend);\r\n      void chatInput.offsetLeft; // reflow\r\n      chatInput.classList.remove('no-transition');\r\n    }\r\n\r\n    this.updateMessageInputPlaceholder(placeholderKey);\r\n\r\n    this.attachMenuButtons && this.attachMenuButtons.forEach((button) => {\r\n      button.element.classList.toggle('hide', !visible.includes(button));\r\n    });\r\n\r\n    if(!canSend) {\r\n      messageInput.removeAttribute('contenteditable');\r\n    } else {\r\n      messageInput.setAttribute('contenteditable', 'true');\r\n      this.setDraft(undefined, false);\r\n\r\n      if(!messageInput.innerHTML) {\r\n        this.messageInputField.onFakeInput();\r\n      }\r\n    }\r\n\r\n    if(attachMenu) {\r\n      attachMenu.toggleAttribute('disabled', !visible.length);\r\n      attachMenu.classList.toggle('btn-disabled', !visible.length);\r\n    }\r\n\r\n    this.updateSendBtn();\r\n  }\r\n\r\n  private attachMessageInputField() {\r\n    const oldInputField = this.messageInputField;\r\n    this.messageInputField = new InputFieldAnimated({\r\n      placeholder: 'Message',\r\n      name: 'message',\r\n      withLinebreaks: true\r\n    });\r\n\r\n    this.messageInputField.input.classList.replace('input-field-input', 'input-message-input');\r\n    this.messageInputField.inputFake.classList.replace('input-field-input', 'input-message-input');\r\n    this.messageInput = this.messageInputField.input;\r\n    this.messageInput.classList.add('no-scrollbar');\r\n    this.attachMessageInputListeners();\r\n\r\n    if(IS_STICKY_INPUT_BUGGED) {\r\n      fixSafariStickyInputFocusing(this.messageInput);\r\n    }\r\n\r\n    if(oldInputField) {\r\n      oldInputField.input.replaceWith(this.messageInputField.input);\r\n      oldInputField.inputFake.replaceWith(this.messageInputField.inputFake);\r\n    } else {\r\n      this.inputMessageContainer.append(this.messageInputField.input, this.messageInputField.inputFake);\r\n    }\r\n  }\r\n\r\n  private attachMessageInputListeners() {\r\n    this.listenerSetter.add(this.messageInput)('keydown', (e: KeyboardEvent) => {\r\n      const key = e.key;\r\n      if(isSendShortcutPressed(e)) {\r\n        cancelEvent(e);\r\n        this.sendMessage();\r\n      } else if(e.ctrlKey || e.metaKey) {\r\n        this.handleMarkdownShortcut(e);\r\n      } else if((key === 'PageUp' || key === 'PageDown') && !e.shiftKey) { // * fix pushing page to left (Chrome Windows)\r\n        e.preventDefault();\r\n\r\n        if(key === 'PageUp') {\r\n          const range = document.createRange();\r\n          const sel = window.getSelection();\r\n\r\n          range.setStart(this.messageInput.childNodes[0] || this.messageInput, 0);\r\n          range.collapse(true);\r\n\r\n          sel.removeAllRanges();\r\n          sel.addRange(range);\r\n        } else {\r\n          placeCaretAtEnd(this.messageInput);\r\n        }\r\n      }\r\n    });\r\n\r\n    if(IS_TOUCH_SUPPORTED) {\r\n      attachClickEvent(this.messageInput, (e) => {\r\n        this.appImManager.selectTab(1); // * set chat tab for album orientation\r\n        // this.saveScroll();\r\n        emoticonsDropdown.toggle(false);\r\n      }, {listenerSetter: this.listenerSetter});\r\n\r\n      /* this.listenerSetter.add(window)('resize', () => {\r\n        this.restoreScroll();\r\n      }); */\r\n\r\n      /* if(isSafari) {\r\n        this.listenerSetter.add(this.messageInput)('mousedown', () => {\r\n          window.requestAnimationFrame(() => {\r\n            window.requestAnimationFrame(() => {\r\n              emoticonsDropdown.toggle(false);\r\n            });\r\n          });\r\n        });\r\n      } */\r\n    }\r\n\r\n    /* this.listenerSetter.add(this.messageInput)('beforeinput', (e: Event) => {\r\n      // * validate due to manual formatting through browser's context menu\r\n      const inputType = (e as InputEvent).inputType;\r\n      //console.log('message beforeinput event', e);\r\n\r\n      if(inputType.indexOf('format') === 0) {\r\n        //console.log('message beforeinput format', e, inputType, this.messageInput.innerHTML);\r\n        const markdownType = inputType.split('format')[1].toLowerCase() as MarkdownType;\r\n        if(this.applyMarkdown(markdownType)) {\r\n          cancelEvent(e); // * cancel legacy markdown event\r\n        }\r\n      }\r\n    }); */\r\n    this.listenerSetter.add(this.messageInput)('input', this.onMessageInput);\r\n    this.listenerSetter.add(this.messageInput)('keyup', () => {\r\n      this.checkAutocomplete();\r\n    });\r\n\r\n    if(this.chat.type === 'chat' || this.chat.type === 'discussion') {\r\n      this.listenerSetter.add(this.messageInput)('focusin', () => {\r\n        if(this.chat.bubbles.scrollable.loadedAll.bottom) {\r\n          this.managers.appMessagesManager.readAllHistory(this.chat.peerId, this.chat.threadId);\r\n        }\r\n      });\r\n    }\r\n  }\r\n\r\n  private prepareDocumentExecute = () => {\r\n    this.executedHistory.push(this.messageInput.innerHTML);\r\n    return () => this.canUndoFromHTML = this.messageInput.innerHTML;\r\n  };\r\n\r\n  private undoRedo = (e: Event, type: 'undo' | 'redo', needHTML: string) => {\r\n    cancelEvent(e); // cancel legacy event\r\n\r\n    let html = this.messageInput.innerHTML;\r\n    if(html && html !== needHTML) {\r\n      this.lockRedo = true;\r\n\r\n      let sameHTMLTimes = 0;\r\n      do {\r\n        document.execCommand(type, false, null);\r\n        const currentHTML = this.messageInput.innerHTML;\r\n        if(html === currentHTML) {\r\n          if(++sameHTMLTimes > 2) { // * unlink, removeFormat (   , :    (  ),  )\r\n            break;\r\n          }\r\n        } else {\r\n          sameHTMLTimes = 0;\r\n        }\r\n\r\n        html = currentHTML;\r\n      } while(html !== needHTML);\r\n\r\n      this.lockRedo = false;\r\n    }\r\n  };\r\n\r\n  public applyMarkdown(type: MarkdownType, href?: string) {\r\n    const MONOSPACE_FONT = 'var(--font-monospace)';\r\n    const SPOILER_FONT = 'spoiler';\r\n    const commandsMap: Partial<{[key in typeof type]: string | (() => void)}> = {\r\n      bold: 'Bold',\r\n      italic: 'Italic',\r\n      underline: 'Underline',\r\n      strikethrough: 'Strikethrough',\r\n      monospace: () => document.execCommand('fontName', false, MONOSPACE_FONT),\r\n      link: href ? () => document.execCommand('createLink', false, href) : () => document.execCommand('unlink', false, null),\r\n      spoiler: () => document.execCommand('fontName', false, SPOILER_FONT)\r\n    };\r\n\r\n    if(!commandsMap[type]) {\r\n      return false;\r\n    }\r\n\r\n    const command = commandsMap[type];\r\n\r\n    // type = 'monospace';\r\n\r\n    const saveExecuted = this.prepareDocumentExecute();\r\n    const executed: any[] = [];\r\n    /**\r\n     * * clear previous formatting, due to Telegram's inability to handle several entities\r\n     */\r\n    /* const checkForSingle = () => {\r\n      const nodes = getSelectedNodes();\r\n      //console.log('Using formatting:', commandsMap[type], nodes, this.executedHistory);\r\n\r\n      const parents = [...new Set(nodes.map((node) => node.parentNode))];\r\n      //const differentParents = !!nodes.find((node) => node.parentNode !== firstParent);\r\n      const differentParents = parents.length > 1;\r\n\r\n      let notSingle = false;\r\n      if(differentParents) {\r\n        notSingle = true;\r\n      } else {\r\n        const node = nodes[0];\r\n        if(node && (node.parentNode as HTMLElement) !== this.messageInput && (node.parentNode.parentNode as HTMLElement) !== this.messageInput) {\r\n          notSingle = true;\r\n        }\r\n      }\r\n\r\n      if(notSingle) {\r\n        //if(type === 'monospace') {\r\n          executed.push(document.execCommand('styleWithCSS', false, 'true'));\r\n        //}\r\n\r\n        executed.push(document.execCommand('unlink', false, null));\r\n        executed.push(document.execCommand('removeFormat', false, null));\r\n        executed.push(typeof(command) === 'function' ? command() : document.execCommand(command, false, null));\r\n\r\n        //if(type === 'monospace') {\r\n          executed.push(document.execCommand('styleWithCSS', false, 'false'));\r\n        //}\r\n      }\r\n    }; */\r\n\r\n    executed.push(document.execCommand('styleWithCSS', false, 'true'));\r\n\r\n    const checkType = (type: MarkdownType) => {\r\n      let haveThisType = false;\r\n      // executed.push(document.execCommand('styleWithCSS', false, 'true'));\r\n\r\n      const selection = window.getSelection();\r\n      if(!selection.isCollapsed) {\r\n        const range = selection.getRangeAt(0);\r\n        const tag = markdownTags[type];\r\n\r\n        const node = range.commonAncestorContainer;\r\n        if((node.parentNode as HTMLElement).matches(tag.match) || (node instanceof HTMLElement && node.matches(tag.match))) {\r\n          haveThisType = true;\r\n        }\r\n      }\r\n\r\n      return haveThisType;\r\n    };\r\n\r\n    // * monospace can't be combined with different types\r\n    if(type === 'monospace' || type === 'spoiler') {\r\n      // executed.push(document.execCommand('styleWithCSS', false, 'true'));\r\n\r\n      const haveThisType = checkType(type);\r\n      // executed.push(document.execCommand('removeFormat', false, null));\r\n\r\n      if(haveThisType) {\r\n        executed.push(this.resetCurrentFontFormatting());\r\n      } else {\r\n        if(type === 'monospace' || checkType('monospace')) {\r\n          executed.push(this.resetCurrentFormatting());\r\n        }\r\n\r\n        executed.push(typeof(command) === 'function' ? command() : document.execCommand(command, false, null));\r\n      }\r\n    } else {\r\n      if(checkType('monospace')) {\r\n        executed.push(this.resetCurrentFormatting());\r\n      }\r\n\r\n      executed.push(typeof(command) === 'function' ? command() : document.execCommand(command, false, null));\r\n    }\r\n\r\n    executed.push(document.execCommand('styleWithCSS', false, 'false'));\r\n\r\n    // checkForSingle();\r\n    saveExecuted();\r\n    if(this.appImManager.markupTooltip) {\r\n      this.appImManager.markupTooltip.setActiveMarkupButton();\r\n    }\r\n\r\n    return true;\r\n  }\r\n\r\n  private resetCurrentFormatting() {\r\n    return document.execCommand('removeFormat', false, null);\r\n  }\r\n\r\n  private resetCurrentFontFormatting() {\r\n    return document.execCommand('fontName', false, 'Roboto');\r\n  }\r\n\r\n  private handleMarkdownShortcut = (e: KeyboardEvent) => {\r\n    // console.log('handleMarkdownShortcut', e);\r\n    const formatKeys: {[key: string]: MarkdownType} = {\r\n      'KeyB': 'bold',\r\n      'KeyI': 'italic',\r\n      'KeyU': 'underline',\r\n      'KeyS': 'strikethrough',\r\n      'KeyM': 'monospace',\r\n      'KeyP': 'spoiler'\r\n    };\r\n\r\n    if(this.appImManager.markupTooltip) {\r\n      formatKeys['KeyK'] = 'link';\r\n    }\r\n\r\n    const code = e.code;\r\n    const applyMarkdown = formatKeys[code];\r\n\r\n    const selection = document.getSelection();\r\n    if(selection.toString().trim().length && applyMarkdown) {\r\n      // * \r\n      if(code === 'KeyK') {\r\n        this.appImManager.markupTooltip.showLinkEditor();\r\n      } else {\r\n        this.applyMarkdown(applyMarkdown);\r\n      }\r\n\r\n      cancelEvent(e); // cancel legacy event\r\n    }\r\n\r\n    // return;\r\n    if(code === 'KeyZ') {\r\n      let html = this.messageInput.innerHTML;\r\n\r\n      if(e.shiftKey) {\r\n        if(this.undoHistory.length) {\r\n          this.executedHistory.push(html);\r\n          html = this.undoHistory.pop();\r\n          this.undoRedo(e, 'redo', html);\r\n          html = this.messageInput.innerHTML;\r\n          this.canRedoFromHTML = this.undoHistory.length ? html : '';\r\n          this.canUndoFromHTML = html;\r\n        }\r\n      } else {\r\n        // * ,        ,     saveExecuted\r\n        if(this.executedHistory.length && (!this.canUndoFromHTML || html === this.canUndoFromHTML)) {\r\n          this.undoHistory.push(html);\r\n          html = this.executedHistory.pop();\r\n          this.undoRedo(e, 'undo', html);\r\n\r\n          // *      ,    -,       \r\n          this.canUndoFromHTML = this.canRedoFromHTML = this.messageInput.innerHTML;\r\n        }\r\n      }\r\n    }\r\n  };\r\n\r\n  private onMessageInput = (e?: Event) => {\r\n    // * validate due to manual formatting through browser's context menu\r\n    /* const inputType = (e as InputEvent).inputType;\r\n    console.log('message input event', e);\r\n    if(inputType === 'formatBold') {\r\n      console.log('message input format', this.messageInput.innerHTML);\r\n      cancelEvent(e);\r\n    }\r\n\r\n    if(!isSelectionSingle()) {\r\n      alert('not single');\r\n    } */\r\n\r\n    // console.log('messageInput input', this.messageInput.innerText);\r\n    // const value = this.messageInput.innerText;\r\n    const {value: richValue, entities: markdownEntities, caretPos} = getRichValueWithCaret(this.messageInputField.input);\r\n\r\n    // const entities = parseEntities(value);\r\n    const value = parseMarkdown(richValue, markdownEntities, true);\r\n    const entities = mergeEntities(markdownEntities, parseEntities(value));\r\n\r\n    // this.chat.log('messageInput entities', richValue, value, markdownEntities, caretPos);\r\n\r\n    if(this.canRedoFromHTML && !this.lockRedo && this.messageInput.innerHTML !== this.canRedoFromHTML) {\r\n      this.canRedoFromHTML = '';\r\n      this.undoHistory.length = 0;\r\n    }\r\n\r\n    const urlEntities: Array<MessageEntity.messageEntityUrl | MessageEntity.messageEntityTextUrl> = (!this.editMessage?.media || this.editMessage.media._ === 'messageMediaWebPage') && entities.filter((e) => e._ === 'messageEntityUrl' || e._ === 'messageEntityTextUrl') as any;\r\n    if(urlEntities.length) {\r\n      for(const entity of urlEntities) {\r\n        let url: string;\r\n        if(entity._ === 'messageEntityTextUrl') {\r\n          url = entity.url;\r\n        } else {\r\n          url = richValue.slice(entity.offset, entity.offset + entity.length);\r\n\r\n          if(!(url.includes('http://') || url.includes('https://'))) {\r\n            continue;\r\n          }\r\n        }\r\n\r\n        // console.log('messageInput url:', url);\r\n\r\n        if(this.lastUrl !== url) {\r\n          this.lastUrl = url;\r\n          // this.willSendWebPage = null;\r\n          const promise = this.getWebPagePromise = this.managers.appWebPagesManager.getWebPage(url).then((webpage) => {\r\n            if(this.getWebPagePromise === promise) this.getWebPagePromise = undefined;\r\n            if(this.lastUrl !== url) return;\r\n            if(webpage._  === 'webPage') {\r\n              // console.log('got webpage: ', webpage);\r\n\r\n              this.setTopInfo('webpage', () => {}, webpage.site_name || webpage.title || 'Webpage', webpage.description || webpage.url || '');\r\n              delete this.noWebPage;\r\n              this.willSendWebPage = webpage;\r\n            } else if(this.willSendWebPage) {\r\n              this.onHelperCancel();\r\n            }\r\n          });\r\n        }\r\n\r\n        break;\r\n      }\r\n    } else if(this.lastUrl) {\r\n      this.lastUrl = '';\r\n      delete this.noWebPage;\r\n      this.willSendWebPage = null;\r\n\r\n      if(this.helperType) {\r\n        this.helperFunc();\r\n      } else {\r\n        this.clearHelper();\r\n      }\r\n    }\r\n\r\n    const isEmpty = !richValue.trim();\r\n    if(isEmpty) {\r\n      if(this.lastTimeType) {\r\n        this.managers.appMessagesManager.setTyping(this.chat.peerId, {_: 'sendMessageCancelAction'});\r\n      }\r\n\r\n      if(this.appImManager.markupTooltip) {\r\n        this.appImManager.markupTooltip.hide();\r\n      }\r\n\r\n      // * Chrome has a bug - it will preserve the formatting if the input with monospace text is cleared\r\n      // * so have to reset formatting\r\n      if(document.activeElement === this.messageInput) {\r\n        // document.execCommand('styleWithCSS', false, 'true');\r\n        setTimeout(() => {\r\n          if(document.activeElement === this.messageInput) {\r\n            this.resetCurrentFontFormatting();\r\n          }\r\n        }, 0);\r\n        // document.execCommand('styleWithCSS', false, 'false');\r\n      }\r\n    } else {\r\n      const time = Date.now();\r\n      if(time - this.lastTimeType >= 6000) {\r\n        this.lastTimeType = time;\r\n        this.managers.appMessagesManager.setTyping(this.chat.peerId, {_: 'sendMessageTypingAction'});\r\n      }\r\n\r\n      if(this.botCommands) {\r\n        this.botCommands.toggle(true);\r\n      }\r\n    }\r\n\r\n    if(this.botCommands) {\r\n      this.updateBotCommandsToggle();\r\n    }\r\n\r\n    if(!this.editMsgId) {\r\n      this.saveDraftDebounced();\r\n    }\r\n\r\n    this.checkAutocomplete(richValue, caretPos, entities);\r\n\r\n    this.updateSendBtn();\r\n  };\r\n\r\n  public insertAtCaret(insertText: string, insertEntity?: MessageEntity, isHelper = true) {\r\n    const {value: fullValue, caretPos, entities} = getRichValueWithCaret(this.messageInput);\r\n    const pos = caretPos >= 0 ? caretPos : fullValue.length;\r\n    const prefix = fullValue.substr(0, pos);\r\n    const suffix = fullValue.substr(pos);\r\n\r\n    const matches = isHelper ? prefix.match(ChatInput.AUTO_COMPLETE_REG_EXP) : null;\r\n\r\n    const matchIndex = matches ? matches.index + (matches[0].length - matches[2].length) : prefix.length;\r\n    const newPrefix = prefix.slice(0, matchIndex);\r\n    const newValue = newPrefix + insertText + suffix;\r\n\r\n    // merge emojis\r\n    const hadEntities = parseEntities(fullValue);\r\n    mergeEntities(entities, hadEntities);\r\n\r\n    // max for additional whitespace\r\n    const insertLength = insertEntity ? Math.max(insertEntity.length, insertText.length) : insertText.length;\r\n    const addEntities: MessageEntity[] = [];\r\n    if(insertEntity) {\r\n      addEntities.push(insertEntity);\r\n      insertEntity.offset = matchIndex;\r\n    }\r\n\r\n    // add offset to entities next to emoji\r\n    const diff = matches ? insertLength - matches[2].length : insertLength;\r\n    entities.forEach((entity) => {\r\n      if(entity.offset >= matchIndex) {\r\n        entity.offset += diff;\r\n      }\r\n    });\r\n\r\n    mergeEntities(entities, addEntities);\r\n\r\n    if(/* caretPos !== -1 && caretPos !== fullValue.length */true) {\r\n      const caretEntity: MessageEntity.messageEntityCaret = {\r\n        _: 'messageEntityCaret',\r\n        offset: matchIndex + insertLength,\r\n        length: 0\r\n      };\r\n\r\n      let insertCaretAtIndex = 0;\r\n      for(let length = entities.length; insertCaretAtIndex < length; ++insertCaretAtIndex) {\r\n        const entity = entities[insertCaretAtIndex];\r\n        if(entity.offset > caretEntity.offset) {\r\n          break;\r\n        }\r\n      }\r\n\r\n      entities.splice(insertCaretAtIndex, 0, caretEntity);\r\n    }\r\n\r\n    // const saveExecuted = this.prepareDocumentExecute();\r\n    // can't exec .value here because it will instantly check for autocomplete\r\n    const value = documentFragmentToHTML(wrapDraftText(newValue, {entities}));\r\n    this.messageInputField.setValueSilently(value);\r\n\r\n    const caret = this.messageInput.querySelector('.composer-sel');\r\n    if(caret) {\r\n      setCaretAt(caret);\r\n      caret.remove();\r\n    }\r\n\r\n    // but it's needed to be checked only here\r\n    this.onMessageInput();\r\n\r\n    // saveExecuted();\r\n\r\n    // document.execCommand('insertHTML', true, wrapEmojiText(emoji));\r\n  }\r\n\r\n  public onEmojiSelected = (emoji: string, autocomplete: boolean) => {\r\n    this.insertAtCaret(emoji, getEmojiEntityFromEmoji(emoji), autocomplete);\r\n  };\r\n\r\n  private async checkAutocomplete(value?: string, caretPos?: number, entities?: MessageEntity[]) {\r\n    // return;\r\n\r\n    if(value === undefined) {\r\n      const r = getRichValueWithCaret(this.messageInputField.input, true);\r\n      value = r.value;\r\n      caretPos = r.caretPos;\r\n      entities = r.entities;\r\n    }\r\n\r\n    if(caretPos === -1) {\r\n      caretPos = value.length;\r\n    }\r\n\r\n    if(entities === undefined) {\r\n      const _value = parseMarkdown(value, entities, true);\r\n      entities = mergeEntities(entities, parseEntities(_value));\r\n    }\r\n\r\n    value = value.slice(0, caretPos);\r\n\r\n    if(this.previousQuery === value) {\r\n      return;\r\n    }\r\n\r\n    this.previousQuery = value;\r\n\r\n    const matches = value.match(ChatInput.AUTO_COMPLETE_REG_EXP);\r\n    let foundHelper: AutocompleteHelper;\r\n    if(matches) {\r\n      const entity = entities[0];\r\n\r\n      let query = matches[2];\r\n      const firstChar = query[0];\r\n\r\n      if(this.stickersHelper &&\r\n        rootScope.settings.stickers.suggest &&\r\n        await this.chat.canSend('send_stickers') &&\r\n        entity?._ === 'messageEntityEmoji' && entity.length === value.length && !entity.offset) {\r\n        foundHelper = this.stickersHelper;\r\n        this.stickersHelper.checkEmoticon(value);\r\n      } else if(firstChar === '@') { // mentions\r\n        const topMsgId = this.chat.threadId ? getServerMessageId(this.chat.threadId) : undefined;\r\n        if(await this.mentionsHelper.checkQuery(query, this.chat.peerId.isUser() ? NULL_PEER_ID : this.chat.peerId, topMsgId)) {\r\n          foundHelper = this.mentionsHelper;\r\n        }\r\n      } else if(!matches[1] && firstChar === '/') { // commands\r\n        if(await this.commandsHelper.checkQuery(query, this.chat.peerId)) {\r\n          foundHelper = this.commandsHelper;\r\n        }\r\n      } else if(rootScope.settings.emoji.suggest) { // emoji\r\n        query = query.replace(/^\\s*/, '');\r\n        if(!value.match(/^\\s*:(.+):\\s*$/) && !value.match(/:[;!@#$%^&*()-=|]/) && query) {\r\n          foundHelper = this.emojiHelper;\r\n          this.emojiHelper.checkQuery(query, firstChar);\r\n        }\r\n      }\r\n    }\r\n\r\n    foundHelper = this.checkInlineAutocomplete(value, foundHelper);\r\n\r\n    this.autocompleteHelperController.hideOtherHelpers(foundHelper);\r\n  }\r\n\r\n  private checkInlineAutocomplete(value: string, foundHelper?: AutocompleteHelper): AutocompleteHelper {\r\n    let needPlaceholder = false;\r\n\r\n    if(!foundHelper) {\r\n      const inlineMatch = value.match(/^@([a-zA-Z\\\\d_]{3,32})\\s/);\r\n      if(inlineMatch) {\r\n        const username = inlineMatch[1];\r\n        const query = value.slice(inlineMatch[0].length);\r\n        needPlaceholder = inlineMatch[0].length === value.length;\r\n\r\n        foundHelper = this.inlineHelper;\r\n\r\n        if(!this.btnPreloader) {\r\n          this.btnPreloader = ButtonIcon('none btn-preloader float show disable-hover', {noRipple: true});\r\n          putPreloader(this.btnPreloader, true);\r\n          this.inputMessageContainer.parentElement.insertBefore(this.btnPreloader, this.inputMessageContainer.nextSibling);\r\n        } else {\r\n          SetTransition(this.btnPreloader, 'show', true, 400);\r\n        }\r\n\r\n        this.inlineHelper.checkQuery(this.chat.peerId, username, query).then(({user, renderPromise}) => {\r\n          if(needPlaceholder && user.bot_inline_placeholder) {\r\n            this.messageInput.dataset.inlinePlaceholder = user.bot_inline_placeholder;\r\n          }\r\n\r\n          renderPromise.then(() => {\r\n            SetTransition(this.btnPreloader, 'show', false, 400);\r\n          });\r\n        }).catch(noop);\r\n      }\r\n    }\r\n\r\n    if(!needPlaceholder) {\r\n      delete this.messageInput.dataset.inlinePlaceholder;\r\n    }\r\n\r\n    if(foundHelper !== this.inlineHelper) {\r\n      if(this.btnPreloader) {\r\n        SetTransition(this.btnPreloader, 'show', false, 400);\r\n      }\r\n    }\r\n\r\n    return foundHelper;\r\n  }\r\n\r\n  private setRecording(value: boolean) {\r\n    if(this.recording === value) {\r\n      return;\r\n    }\r\n\r\n    SetTransition(this.chatInput, 'is-recording', value, 200);\r\n    this.recording = value;\r\n    this.updateSendBtn();\r\n  }\r\n\r\n  private onBtnSendClick = async(e: Event) => {\r\n    cancelEvent(e);\r\n\r\n    if(!this.recorder || this.recording || !this.isInputEmpty() || this.forwarding || this.editMsgId) {\r\n      if(this.recording) {\r\n        if((Date.now() - this.recordStartTime) < RECORD_MIN_TIME) {\r\n          this.onCancelRecordClick();\r\n        } else {\r\n          this.recorder.stop();\r\n        }\r\n      } else {\r\n        this.sendMessage();\r\n      }\r\n    } else {\r\n      const isAnyChat = this.chat.peerId.isAnyChat();\r\n      if(isAnyChat && !(await this.chat.canSend('send_media'))) {\r\n        toast(POSTING_MEDIA_NOT_ALLOWED);\r\n        return;\r\n      }\r\n\r\n      this.chatInput.classList.add('is-locked');\r\n      blurActiveElement();\r\n\r\n      let restricted = false;\r\n      if(!isAnyChat) {\r\n        const userFull = await this.managers.appProfileManager.getProfile(this.chat.peerId.toUserId());\r\n        if(userFull?.pFlags.voice_messages_forbidden) {\r\n          toastNew({\r\n            langPackKey: 'Chat.SendVoice.PrivacyError',\r\n            langPackArguments: [await wrapPeerTitle({peerId: this.chat.peerId})]\r\n          });\r\n          restricted = true;\r\n        }\r\n      }\r\n\r\n      if(restricted) {\r\n        this.chatInput.classList.remove('is-locked');\r\n        return;\r\n      }\r\n\r\n      this.recorder.start().then(() => {\r\n        this.releaseMediaPlayback = appMediaPlaybackController.setSingleMedia();\r\n        this.recordCanceled = false;\r\n\r\n        this.setRecording(true);\r\n        opusDecodeController.setKeepAlive(true);\r\n\r\n        const showDiscardPopup = () => {\r\n          new PopupPeer('popup-cancel-record', {\r\n            titleLangKey: 'DiscardVoiceMessageTitle',\r\n            descriptionLangKey: 'DiscardVoiceMessageDescription',\r\n            buttons: [{\r\n              langKey: 'DiscardVoiceMessageAction',\r\n              callback: () => {\r\n                simulateClickEvent(this.btnCancelRecord);\r\n              }\r\n            }, {\r\n              langKey: 'Continue',\r\n              isCancel: true\r\n            }]\r\n          }).show();\r\n        };\r\n\r\n        this.recordingOverlayListener = this.listenerSetter.add(document.body)('mousedown', (e) => {\r\n          if(!findUpClassName(e.target, 'chat-input') && !findUpClassName(e.target, 'popup-cancel-record')) {\r\n            cancelEvent(e);\r\n            showDiscardPopup();\r\n          }\r\n        }, {capture: true, passive: false}) as any;\r\n\r\n        appNavigationController.pushItem(this.recordingNavigationItem = {\r\n          type: 'voice',\r\n          onPop: () => {\r\n            setTimeout(() => {\r\n              showDiscardPopup();\r\n            }, 0);\r\n\r\n            return false;\r\n          }\r\n        });\r\n\r\n        this.recordStartTime = Date.now();\r\n\r\n        const sourceNode: MediaStreamAudioSourceNode = this.recorder.sourceNode;\r\n        const context = sourceNode.context;\r\n\r\n        const analyser = context.createAnalyser();\r\n        sourceNode.connect(analyser);\r\n        // analyser.connect(context.destination);\r\n        analyser.fftSize = 32;\r\n\r\n        const frequencyData = new Uint8Array(analyser.frequencyBinCount);\r\n        const max = frequencyData.length * 255;\r\n        const min = 54 / 150;\r\n        const r = () => {\r\n          if(!this.recording) return;\r\n\r\n          analyser.getByteFrequencyData(frequencyData);\r\n\r\n          let sum = 0;\r\n          frequencyData.forEach((value) => {\r\n            sum += value;\r\n          });\r\n\r\n          const percents = Math.min(1, (sum / max) + min);\r\n          // console.log('frequencyData', frequencyData, percents);\r\n\r\n          this.recordRippleEl.style.transform = `scale(${percents})`;\r\n\r\n          const diff = Date.now() - this.recordStartTime;\r\n          const ms = diff % 1000;\r\n\r\n          const formatted = toHHMMSS(diff / 1000) + ',' + ('00' + Math.round(ms / 10)).slice(-2);\r\n\r\n          this.recordTimeEl.innerText = formatted;\r\n\r\n          fastRaf(r);\r\n        };\r\n\r\n        r();\r\n      }).catch((e: Error) => {\r\n        switch(e.name as string) {\r\n          case 'NotAllowedError': {\r\n            toast('Please allow access to your microphone');\r\n            break;\r\n          }\r\n\r\n          case 'NotReadableError': {\r\n            toast(e.message);\r\n            break;\r\n          }\r\n\r\n          default:\r\n            console.error('Recorder start error:', e, e.name, e.message);\r\n            toast(e.message);\r\n            break;\r\n        }\r\n\r\n        this.setRecording(false);\r\n        this.chatInput.classList.remove('is-locked');\r\n      });\r\n    }\r\n  };\r\n\r\n  private onHelperCancel = async(e?: Event, force?: boolean) => {\r\n    if(e) {\r\n      cancelEvent(e);\r\n    }\r\n\r\n    if(this.willSendWebPage) {\r\n      const lastUrl = this.lastUrl;\r\n      let needReturn = false;\r\n      if(this.helperType) {\r\n        // if(this.helperFunc) {\r\n        await this.helperFunc();\r\n        // }\r\n\r\n        needReturn = true;\r\n      }\r\n\r\n      // * restore values\r\n      this.lastUrl = lastUrl;\r\n      this.noWebPage = true;\r\n      this.willSendWebPage = null;\r\n\r\n      if(needReturn) return;\r\n    }\r\n\r\n    if(this.helperType === 'edit' && !force) {\r\n      const message = this.editMessage\r\n      const value = parseMarkdown(this.messageInputField.value, []);\r\n      if(message.message !== value) {\r\n        new PopupPeer('discard-editing', {\r\n          buttons: [{\r\n            langKey: 'Alert.Confirm.Discard',\r\n            callback: () => {\r\n              this.onHelperCancel(undefined, true);\r\n            }\r\n          }],\r\n          descriptionLangKey: 'Chat.Edit.Cancel.Text'\r\n        }).show();\r\n\r\n        return;\r\n      }\r\n    }\r\n\r\n    this.clearHelper();\r\n    this.updateSendBtn();\r\n  };\r\n\r\n  private onHelperClick = (e: Event) => {\r\n    cancelEvent(e);\r\n\r\n    if(!findUpClassName(e.target, 'reply')) return;\r\n    if(this.helperType === 'forward') {\r\n      const {forwardElements} = this;\r\n      if(forwardElements && IS_TOUCH_SUPPORTED && !forwardElements.container.classList.contains('active')) {\r\n        contextMenuController.openBtnMenu(forwardElements.container);\r\n      }\r\n    } else if(this.helperType === 'reply') {\r\n      this.chat.setMessageId(this.replyToMsgId);\r\n    } else if(this.helperType === 'edit') {\r\n      this.chat.setMessageId(this.editMsgId);\r\n    }\r\n  };\r\n\r\n  private changeForwardRecipient() {\r\n    if(this.helperWaitingForward) return;\r\n    this.helperWaitingForward = true;\r\n\r\n    const forwarding = copy(this.forwarding);\r\n    const helperFunc = this.helperFunc;\r\n    this.clearHelper();\r\n    this.updateSendBtn();\r\n    let selected = false;\r\n    const popup = new PopupForward(forwarding, () => {\r\n      selected = true;\r\n    });\r\n\r\n    popup.addEventListener('close', () => {\r\n      this.helperWaitingForward = false;\r\n\r\n      if(!selected) {\r\n        helperFunc();\r\n      }\r\n    });\r\n  }\r\n\r\n  public async clearInput(canSetDraft = true, fireEvent = true, clearValue = '') {\r\n    if(document.activeElement === this.messageInput && IS_MOBILE_SAFARI) { // fix first char uppercase\r\n      const i = document.createElement('input');\r\n      document.body.append(i);\r\n      fixSafariStickyInput(i);\r\n      this.messageInputField.setValueSilently(clearValue);\r\n      fixSafariStickyInput(this.messageInput);\r\n      i.remove();\r\n    } else {\r\n      this.messageInputField.setValueSilently(clearValue);\r\n    }\r\n\r\n    if(IS_TOUCH_SUPPORTED) {\r\n      // this.messageInput.innerText = '';\r\n    } else {\r\n      // this.attachMessageInputField();\r\n      // this.messageInput.innerText = '';\r\n\r\n      // clear executions\r\n      this.canRedoFromHTML = '';\r\n      this.undoHistory.length = 0;\r\n      this.executedHistory.length = 0;\r\n      this.canUndoFromHTML = '';\r\n    }\r\n\r\n    let set = false;\r\n    if(canSetDraft) {\r\n      set = await this.setDraft(undefined, false);\r\n    }\r\n\r\n    if(!set && fireEvent) {\r\n      this.onMessageInput();\r\n    }\r\n  }\r\n\r\n  public isInputEmpty() {\r\n    return isInputEmpty(this.messageInput);\r\n  }\r\n\r\n  public updateSendBtn() {\r\n    let icon: 'send' | 'record' | 'edit' | 'schedule';\r\n\r\n    const isInputEmpty = this.isInputEmpty();\r\n\r\n    if(this.editMsgId) icon = 'edit';\r\n    else if(!this.recorder || this.recording || !isInputEmpty || this.forwarding) icon = this.chat.type === 'scheduled' ? 'schedule' : 'send';\r\n    else icon = 'record';\r\n\r\n    ['send', 'record', 'edit', 'schedule'].forEach((i) => {\r\n      this.btnSend.classList.toggle(i, icon === i);\r\n    });\r\n\r\n    if(this.btnScheduled) {\r\n      this.btnScheduled.classList.toggle('show', isInputEmpty);\r\n    }\r\n\r\n    if(this.btnToggleReplyMarkup) {\r\n      this.btnToggleReplyMarkup.classList.toggle('show', isInputEmpty);\r\n    }\r\n  }\r\n\r\n  public onMessageSent(clearInput = true, clearReply?: boolean) {\r\n    if(this.chat.type !== 'scheduled') {\r\n      this.managers.appMessagesManager.readAllHistory(this.chat.peerId, this.chat.threadId, true);\r\n    }\r\n\r\n    this.scheduleDate = undefined;\r\n    this.sendSilent = undefined;\r\n\r\n    const value = this.messageInputField.value;\r\n    const entities = parseEntities(value);\r\n    const emojiEntities: MessageEntity.messageEntityEmoji[] = entities.filter((entity) => entity._ === 'messageEntityEmoji') as any;\r\n    emojiEntities.forEach((entity) => {\r\n      const emoji = emojiFromCodePoints(entity.unicode);\r\n      this.managers.appEmojiManager.pushRecentEmoji(emoji);\r\n    });\r\n\r\n    if(clearInput) {\r\n      this.lastUrl = '';\r\n      delete this.noWebPage;\r\n      this.willSendWebPage = null;\r\n      this.clearInput();\r\n    }\r\n\r\n    if(clearReply || clearInput) {\r\n      this.clearHelper();\r\n    }\r\n\r\n    this.updateSendBtn();\r\n  }\r\n\r\n  public sendMessage(force = false) {\r\n    const {editMsgId, chat} = this;\r\n    if(chat.type === 'scheduled' && !force && !editMsgId) {\r\n      this.scheduleSending();\r\n      return;\r\n    }\r\n\r\n    const {peerId} = chat;\r\n    const {noWebPage} = this;\r\n    const sendingParams = this.chat.getMessageSendingParams();\r\n\r\n    const {value, entities} = getRichValue(this.messageInputField.input);\r\n\r\n    // return;\r\n    if(editMsgId) {\r\n      const message = this.editMessage;\r\n      if(value.trim() || message.media) {\r\n        this.managers.appMessagesManager.editMessage(message, value, {\r\n          entities,\r\n          noWebPage: noWebPage\r\n        });\r\n\r\n        this.onMessageSent();\r\n      } else {\r\n        new PopupDeleteMessages(peerId, [editMsgId], chat.type);\r\n\r\n        return;\r\n      }\r\n    } else if(value.trim()) {\r\n      this.managers.appMessagesManager.sendText(peerId, value, {\r\n        entities,\r\n        ...sendingParams,\r\n        noWebPage: noWebPage,\r\n        webPage: this.getWebPagePromise ? undefined : this.willSendWebPage,\r\n        clearDraft: true\r\n      });\r\n\r\n      if(this.chat.type === 'scheduled') {\r\n        this.onMessageSent(true);\r\n      } else {\r\n        this.onMessageSent(false, false);\r\n      }\r\n      // this.onMessageSent();\r\n    }\r\n\r\n    // * wait for sendText set messageId for invokeAfterMsg\r\n    if(this.forwarding) {\r\n      const forwarding = copy(this.forwarding);\r\n      // setTimeout(() => {\r\n      for(const fromPeerId in forwarding) {\r\n        this.managers.appMessagesManager.forwardMessages(peerId, fromPeerId.toPeerId(), forwarding[fromPeerId], {\r\n          ...sendingParams,\r\n          dropAuthor: this.forwardElements && this.forwardElements.hideSender.checkboxField.checked,\r\n          dropCaptions: this.isDroppingCaptions()\r\n        }).catch(async(err: ApiError) => {\r\n          if(err.type === 'VOICE_MESSAGES_FORBIDDEN') {\r\n            toastNew({\r\n              langPackKey: 'Chat.SendVoice.PrivacyError',\r\n              langPackArguments: [await wrapPeerTitle({peerId})]\r\n            });\r\n          }\r\n        });\r\n      }\r\n\r\n      if(!value) {\r\n        this.onMessageSent();\r\n      }\r\n      // }, 0);\r\n    }\r\n\r\n    // this.onMessageSent();\r\n  }\r\n\r\n  public async sendMessageWithDocument(\r\n    document: MyDocument | DocId,\r\n    force = false,\r\n    clearDraft = false,\r\n    silent = false\r\n  ) {\r\n    document = await this.managers.appDocsManager.getDoc(document);\r\n\r\n    const flag = document.type === 'sticker' ? 'send_stickers' : (document.type === 'gif' ? 'send_gifs' : 'send_media');\r\n    if(this.chat.peerId.isAnyChat() && !(await this.chat.canSend(flag))) {\r\n      toast(POSTING_MEDIA_NOT_ALLOWED);\r\n      return false;\r\n    }\r\n\r\n    if(this.chat.type === 'scheduled' && !force) {\r\n      this.scheduleSending(() => this.sendMessageWithDocument(document, true, clearDraft, silent));\r\n      return false;\r\n    }\r\n\r\n    if(!document) {\r\n      return false;\r\n    }\r\n\r\n    if(getStickerEffectThumb(document) && !rootScope.premium) {\r\n      return false;\r\n    }\r\n\r\n    this.managers.appMessagesManager.sendFile(this.chat.peerId, document, {\r\n      ...this.chat.getMessageSendingParams(),\r\n      isMedia: true,\r\n      clearDraft: clearDraft || undefined,\r\n      silent\r\n    });\r\n    this.onMessageSent(clearDraft, true);\r\n\r\n    if(document.type === 'sticker') {\r\n      emoticonsDropdown.stickersTab?.unshiftRecentSticker(document);\r\n    }\r\n\r\n    return true;\r\n  }\r\n\r\n  private canToggleHideAuthor() {\r\n    const {forwardElements} = this;\r\n    if(!forwardElements) return false;\r\n    const hideCaptionCheckboxField = forwardElements.hideCaption.checkboxField;\r\n    return !hideCaptionCheckboxField.checked ||\r\n      findUpTag(hideCaptionCheckboxField.label, 'FORM').classList.contains('hide');\r\n  }\r\n\r\n  private isDroppingCaptions() {\r\n    return !this.canToggleHideAuthor();\r\n  }\r\n\r\n  /* public sendSomething(callback: () => void, force = false) {\r\n    if(this.chat.type === 'scheduled' && !force) {\r\n      this.scheduleSending(() => this.sendSomething(callback, true));\r\n      return false;\r\n    }\r\n\r\n    callback();\r\n    this.onMessageSent(false, true);\r\n\r\n    return true;\r\n  } */\r\n\r\n  public async initMessageEditing(mid: number) {\r\n    const message = (await this.chat.getMessage(mid)) as Message.message;\r\n\r\n    let input = documentFragmentToHTML(wrapDraftText(message.message, {entities: message.totalEntities}));\r\n    const f = async() => {\r\n      const replyFragment = await wrapMessageForReply(message, undefined, [message.mid]);\r\n      this.setTopInfo('edit', f, i18n('AccDescrEditing'), replyFragment, input, message);\r\n\r\n      this.editMsgId = mid;\r\n      this.editMessage = message;\r\n      input = undefined;\r\n    };\r\n    f();\r\n  }\r\n\r\n  public initMessagesForward(fromPeerIdsMids: {[fromPeerId: PeerId]: number[]}) {\r\n    const f = async() => {\r\n      // const peerTitles: string[]\r\n      const fromPeerIds = Object.keys(fromPeerIdsMids).map((fromPeerId) => fromPeerId.toPeerId());\r\n      const smth: Set<string> = new Set();\r\n      let length = 0, messagesWithCaptionsLength = 0;\r\n\r\n      const p = fromPeerIds.map(async(fromPeerId) => {\r\n        const mids = fromPeerIdsMids[fromPeerId];\r\n        const promises = mids.map(async(mid) => {\r\n          const message = (await this.managers.appMessagesManager.getMessageByPeer(fromPeerId, mid)) as Message.message;\r\n          if(message.fwd_from?.from_name && !message.fromId && !message.fwdFromId) {\r\n            smth.add('N' + message.fwd_from.from_name);\r\n          } else {\r\n            smth.add('P' + message.fromId);\r\n          }\r\n\r\n          if(message.media && message.message) {\r\n            ++messagesWithCaptionsLength;\r\n          }\r\n        });\r\n\r\n        await Promise.all(promises);\r\n\r\n        length += mids.length;\r\n      });\r\n\r\n      await Promise.all(p);\r\n\r\n      const onlyFirstName = smth.size > 2;\r\n      const peerTitles = [...smth].map((smth) => {\r\n        const type = smth[0];\r\n        smth = smth.slice(1);\r\n        if(type === 'P') {\r\n          const peerId = smth.toPeerId();\r\n          return peerId === rootScope.myId ? i18n('Chat.Accessory.Forward.You') : new PeerTitle({peerId, dialog: false, onlyFirstName}).element;\r\n        } else {\r\n          return onlyFirstName ? smth.split(' ')[0] : smth;\r\n        }\r\n      });\r\n\r\n      const {forwardElements} = this;\r\n      const form = findUpTag(forwardElements.showCaption.checkboxField.label, 'FORM');\r\n      form.classList.toggle('hide', !messagesWithCaptionsLength);\r\n      const hideCaption = forwardElements.hideCaption.checkboxField.checked;\r\n      if(messagesWithCaptionsLength && hideCaption) {\r\n        forwardElements.hideSender.checkboxField.setValueSilently(true);\r\n      } else if(this.forwardWasDroppingAuthor !== undefined) {\r\n        (this.forwardWasDroppingAuthor ? forwardElements.hideSender : forwardElements.showSender).checkboxField.setValueSilently(true);\r\n      }\r\n\r\n      const titleKey: LangPackKey = forwardElements.showSender.checkboxField.checked ? 'Chat.Accessory.Forward' : 'Chat.Accessory.Hidden';\r\n      const title = i18n(titleKey, [length]);\r\n\r\n      const senderTitles = document.createDocumentFragment();\r\n      if(peerTitles.length < 3) {\r\n        senderTitles.append(...join(peerTitles, false));\r\n      } else {\r\n        senderTitles.append(peerTitles[0], i18n('AndOther', [peerTitles.length - 1]));\r\n      }\r\n\r\n      let firstMessage: Message.message, usingFullAlbum: boolean;\r\n      if(fromPeerIds.length === 1) {\r\n        const fromPeerId = fromPeerIds[0];\r\n        const mids = fromPeerIdsMids[fromPeerId];\r\n        firstMessage = (await this.managers.appMessagesManager.getMessageByPeer(fromPeerId, mids[0])) as Message.message;\r\n\r\n        usingFullAlbum = !!firstMessage.grouped_id;\r\n        if(usingFullAlbum) {\r\n          const albumMids = await this.managers.appMessagesManager.getMidsByMessage(firstMessage);\r\n          if(albumMids.length !== length || albumMids.find((mid) => !mids.includes(mid))) {\r\n            usingFullAlbum = false;\r\n          }\r\n        }\r\n      }\r\n\r\n      const subtitleFragment = document.createDocumentFragment();\r\n      const delimiter = ': ';\r\n      if(usingFullAlbum || length === 1) {\r\n        const mids = fromPeerIdsMids[fromPeerIds[0]];\r\n        const replyFragment = await wrapMessageForReply(firstMessage, undefined, mids);\r\n        subtitleFragment.append(\r\n          senderTitles,\r\n          delimiter,\r\n          replyFragment\r\n        );\r\n      } else {\r\n        subtitleFragment.append(\r\n          i18n('Chat.Accessory.Forward.From'),\r\n          delimiter,\r\n          senderTitles\r\n        );\r\n      }\r\n\r\n      const newReply = this.setTopInfo('forward', f, title, subtitleFragment);\r\n\r\n      forwardElements.modifyArgs.forEach((b, idx) => {\r\n        const text = b.textElement;\r\n        const intl: I18n.IntlElement = I18n.weakMap.get(text) as any;\r\n        intl.args = [idx < 2 ? fromPeerIds.length : messagesWithCaptionsLength];\r\n        intl.update();\r\n      });\r\n\r\n      if(this.forwardHover) {\r\n        this.forwardHover.attachButtonListener(newReply, this.listenerSetter);\r\n      }\r\n\r\n      this.forwarding = fromPeerIdsMids;\r\n    };\r\n\r\n    f();\r\n  }\r\n\r\n  public async initMessageReply(mid: number) {\r\n    if(this.replyToMsgId === mid) {\r\n      return;\r\n    }\r\n\r\n    let message = await this.chat.getMessage(mid);\r\n    const f = () => {\r\n      let peerTitleEl: HTMLElement;\r\n      if(!message) { // load missing replying message\r\n        peerTitleEl = i18n('Loading');\r\n\r\n        this.managers.appMessagesManager.wrapSingleMessage(this.chat.peerId, mid).then((_message) => {\r\n          if(this.replyToMsgId !== mid) {\r\n            return;\r\n          }\r\n\r\n          message = _message;\r\n          if(!message) {\r\n            this.clearHelper('reply');\r\n          } else {\r\n            f();\r\n          }\r\n        });\r\n      } else {\r\n        peerTitleEl = new PeerTitle({\r\n          peerId: message.fromId,\r\n          dialog: false\r\n        }).element;\r\n      }\r\n\r\n      this.setTopInfo('reply', f, peerTitleEl, message && (message as Message.message).message, undefined, message);\r\n      this.replyToMsgId = mid;\r\n    };\r\n    f();\r\n  }\r\n\r\n  public clearHelper(type?: ChatInputHelperType) {\r\n    if(this.helperType === 'edit' && type !== 'edit') {\r\n      this.clearInput();\r\n    }\r\n\r\n    if(type) {\r\n      this.lastUrl = '';\r\n      delete this.noWebPage;\r\n      this.willSendWebPage = null;\r\n    }\r\n\r\n    if(type !== 'reply') {\r\n      this.replyToMsgId = undefined;\r\n      this.forwarding = undefined;\r\n    }\r\n\r\n    this.editMsgId = this.editMessage = undefined;\r\n    this.helperType = this.helperFunc = undefined;\r\n\r\n    if(this.chat.container.classList.contains('is-helper-active')) {\r\n      appNavigationController.removeByType('input-helper');\r\n      this.chat.container.classList.remove('is-helper-active');\r\n      this.t();\r\n    }\r\n  }\r\n\r\n  private t() {\r\n    const className = 'is-toggling-helper';\r\n    SetTransition(this.chat.container, className, true, 150, () => {\r\n      this.chat.container.classList.remove(className);\r\n    });\r\n  }\r\n\r\n  public setInputValue(value: string, clear = true, focus = true) {\r\n    if(!value) value = '';\r\n\r\n    if(clear) this.clearInput(false, false, value);\r\n    else this.messageInputField.setValueSilently(value);\r\n\r\n    fastRaf(() => {\r\n      focus && placeCaretAtEnd(this.messageInput);\r\n      this.onMessageInput();\r\n      this.messageInput.scrollTop = this.messageInput.scrollHeight;\r\n    });\r\n  }\r\n\r\n  public setTopInfo(\r\n    type: ChatInputHelperType,\r\n    callerFunc: () => void,\r\n    title: Parameters<typeof wrapReply>[0] = '',\r\n    subtitle: Parameters<typeof wrapReply>[1] = '',\r\n    input?: string,\r\n    message?: any\r\n  ) {\r\n    if(this.willSendWebPage && type === 'reply') {\r\n      return;\r\n    }\r\n\r\n    if(type !== 'webpage') {\r\n      this.clearHelper(type);\r\n      this.helperType = type;\r\n      this.helperFunc = callerFunc;\r\n    }\r\n\r\n    const replyParent = this.replyElements.container;\r\n    const oldReply = replyParent.lastElementChild.previousElementSibling;\r\n    const haveReply = oldReply.classList.contains('reply');\r\n\r\n    this.replyElements.iconBtn.replaceWith(this.replyElements.iconBtn = ButtonIcon((type === 'webpage' ? 'link' : type) + ' active reply-icon', {noRipple: true}));\r\n    const {container} = wrapReply(title, subtitle, message);\r\n    if(haveReply) {\r\n      oldReply.replaceWith(container);\r\n    } else {\r\n      replyParent.insertBefore(container, replyParent.lastElementChild);\r\n    }\r\n\r\n    if(type === 'webpage') {\r\n      container.style.cursor = 'default';\r\n    }\r\n\r\n    if(!this.chat.container.classList.contains('is-helper-active')) {\r\n      this.chat.container.classList.add('is-helper-active');\r\n      this.t();\r\n    }\r\n\r\n    /* const scroll = appImManager.scrollable;\r\n    if(scroll.isScrolledDown && !scroll.scrollLocked && !appImManager.messagesQueuePromise && !appImManager.setPeerPromise) {\r\n      scroll.scrollTo(scroll.scrollHeight, 'top', true, true, 200);\r\n    } */\r\n\r\n    if(!IS_MOBILE) {\r\n      appNavigationController.pushItem({\r\n        type: 'input-helper',\r\n        onPop: () => {\r\n          this.onHelperCancel();\r\n        }\r\n      });\r\n    }\r\n\r\n    if(input !== undefined) {\r\n      this.setInputValue(input);\r\n    }\r\n\r\n    setTimeout(() => {\r\n      this.updateSendBtn();\r\n    }, 0);\r\n\r\n    return container;\r\n  }\r\n\r\n  // public saveScroll() {\r\n  //   this.scrollTop = this.chat.bubbles.scrollable.container.scrollTop;\r\n  //   this.scrollOffsetTop = this.chatInput.offsetTop;\r\n  // }\r\n\r\n  // public restoreScroll() {\r\n  //   if(this.chatInput.style.display) return;\r\n  //   //console.log('input resize', offsetTop, this.chatInput.offsetTop);\r\n  //   let newOffsetTop = this.chatInput.offsetTop;\r\n  //   let container = this.chat.bubbles.scrollable.container;\r\n  //   let scrollTop = container.scrollTop;\r\n  //   let clientHeight = container.clientHeight;\r\n  //   let maxScrollTop = container.scrollHeight;\r\n\r\n  //   if(newOffsetTop < this.scrollOffsetTop) {\r\n  //     this.scrollDiff = this.scrollOffsetTop - newOffsetTop;\r\n  //     container.scrollTop += this.scrollDiff;\r\n  //   } else if(scrollTop !== this.scrollTop) {\r\n  //     let endDiff = maxScrollTop - (scrollTop + clientHeight);\r\n  //     if(endDiff < this.scrollDiff/*  && false */) {\r\n  //       //container.scrollTop -= endDiff;\r\n  //     } else {\r\n  //       container.scrollTop -= this.scrollDiff;\r\n  //     }\r\n  //   }\r\n  // }\r\n}\r\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport documentFragmentToHTML from '../../helpers/dom/documentFragmentToHTML';\nimport {DraftMessage} from '../../layer';\nimport mergeEntities from '../../lib/richTextProcessor/mergeEntities';\nimport parseEntities from '../../lib/richTextProcessor/parseEntities';\nimport wrapDraftText from '../../lib/richTextProcessor/wrapDraftText';\n\nexport default function wrapDraft(draft: DraftMessage.draftMessage) {\n  const myEntities = parseEntities(draft.message);\n  const apiEntities = draft.entities || [];\n  const totalEntities = mergeEntities(apiEntities.slice(), myEntities); // ! only in this order, otherwise bold and emoji formatting won't work\n\n  return documentFragmentToHTML(wrapDraftText(draft.message, {entities: totalEntities}));\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nexport default function setCaretAt(node: Node) {\n  // node.appendChild(document.createTextNode(''));\n\n  const originalNode = node;\n  node = node.previousSibling;\n\n  if(node.nodeType === 1) {\n    const newNode = document.createTextNode('');\n    node.parentNode.insertBefore(newNode, !originalNode.nextSibling || originalNode.nextSibling.nodeType === node.nodeType ? originalNode : originalNode.nextSibling);\n    node = newNode;\n  }\n\n  if(window.getSelection && document.createRange) {\n    const range = document.createRange();\n    if(node) {\n      range.setStartAfter(node);\n      range.insertNode(node);\n      range.setStart(node, node.nodeValue.length);\n    }\n\n    range.collapse(true);\n\n    const sel = window.getSelection();\n    sel.removeAllRanges();\n    sel.addRange(range);\n  }\n}\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport type Chat from './chat';\r\nimport type ChatTopbar from './topbar';\r\nimport mediaSizes from '../../helpers/mediaSizes';\r\nimport DivAndCaption from '../divAndCaption';\r\nimport ripple from '../ripple';\r\nimport ListenerSetter from '../../helpers/listenerSetter';\r\nimport cancelEvent from '../../helpers/dom/cancelEvent';\r\nimport {attachClickEvent} from '../../helpers/dom/clickEvent';\r\nimport {Message} from '../../layer';\r\nimport safeAssign from '../../helpers/object/safeAssign';\r\n\r\nconst classNames: string[] = ['is-pinned-message-shown', 'is-pinned-audio-shown'];\r\nconst CLASSNAME_BASE = 'pinned-container';\r\nconst HEIGHT = 52;\r\n\r\nexport default class PinnedContainer {\r\n  public wrapperUtils: HTMLElement;\r\n  public btnClose: HTMLElement;\r\n  protected wrapper: HTMLElement;\r\n\r\n  protected topbar: ChatTopbar;\r\n  protected chat: Chat;\r\n  protected listenerSetter: ListenerSetter;\r\n  public className: string;\r\n  public divAndCaption: DivAndCaption<(title: string | HTMLElement | DocumentFragment, subtitle: string | HTMLElement | DocumentFragment, message?: any) => void>;\r\n\r\n  protected floating = false;\r\n\r\n  public onClose?: () => void | Promise<boolean>;\r\n\r\n  constructor(options: {\r\n    topbar: PinnedContainer['topbar'],\r\n    chat: PinnedContainer['chat'],\r\n    listenerSetter: PinnedContainer['listenerSetter'],\r\n    className: PinnedContainer['className'],\r\n    divAndCaption: PinnedContainer['divAndCaption'],\r\n    onClose?: PinnedContainer['onClose'],\r\n    floating?: PinnedContainer['floating']\r\n  }) {\r\n    safeAssign(this, options);\r\n\r\n    const {divAndCaption, className} = this;\r\n    divAndCaption.container.classList.add(CLASSNAME_BASE, 'hide');\r\n    divAndCaption.title.classList.add(CLASSNAME_BASE + '-title');\r\n    divAndCaption.subtitle.classList.add(CLASSNAME_BASE + '-subtitle');\r\n    divAndCaption.content.classList.add(CLASSNAME_BASE + '-content');\r\n\r\n    this.btnClose = document.createElement('button');\r\n    this.btnClose.classList.add(CLASSNAME_BASE + '-close', `pinned-${className}-close`, 'btn-icon', 'tgico-close');\r\n\r\n    this.wrapper = document.createElement('div');\r\n    this.wrapper.classList.add(CLASSNAME_BASE + '-wrapper');\r\n    ripple(this.wrapper);\r\n\r\n    this.wrapperUtils = document.createElement('div');\r\n    this.wrapperUtils.classList.add(CLASSNAME_BASE + '-wrapper-utils');\r\n    this.wrapperUtils.append(this.btnClose);\r\n\r\n    this.wrapper.append(...Array.from(divAndCaption.container.children), this.wrapperUtils);\r\n\r\n    divAndCaption.container.append(this.wrapper/* , this.close */);\r\n\r\n    this.attachOnCloseEvent(this.btnClose);\r\n  }\r\n\r\n  public attachOnCloseEvent(elem: HTMLElement) {\r\n    attachClickEvent(elem, (e) => {\r\n      cancelEvent(e);\r\n\r\n      ((this.onClose ? this.onClose() : null) || Promise.resolve(true)).then((needClose) => {\r\n        if(needClose) {\r\n          this.toggle(true);\r\n        }\r\n      });\r\n    }, {listenerSetter: this.listenerSetter});\r\n  }\r\n\r\n  public toggle(hide?: boolean) {\r\n    const isHidden = this.divAndCaption.container.classList.contains('hide');\r\n    if(hide === undefined) {\r\n      hide = !isHidden;\r\n    } else if(hide === isHidden) {\r\n      return;\r\n    }\r\n\r\n    // const scrollable = this.chat.bubbles.scrollable;\r\n\r\n    const isFloating = (this.floating || mediaSizes.isMobile) && !hide;\r\n    // const scrollTop = isFloating || this.divAndCaption.container.classList.contains('is-floating') ? scrollable.scrollTop : undefined;\r\n\r\n    this.divAndCaption.container.classList.toggle('is-floating', isFloating);\r\n    this.divAndCaption.container.classList.toggle('hide', hide);\r\n\r\n    this.topbar.container.classList.toggle('is-pinned-floating', isFloating);\r\n    this.topbar.container.classList.toggle(`is-pinned-${this.className}-shown`, !hide);\r\n\r\n    // const active = classNames.filter((className) => this.topbar.container.classList.contains(className));\r\n    // const maxActive = hide ? 0 : 1;\r\n\r\n    // * not sure when it became unneeded\r\n    // if(scrollTop !== undefined && active.length <= maxActive/*  && !scrollable.isScrolledDown */) {\r\n    //   scrollable.scrollTop = scrollTop + ((hide ? -1 : 1) * HEIGHT);\r\n    // }\r\n\r\n    this.topbar.setFloating();\r\n    this.topbar.setUtilsWidth();\r\n  }\r\n\r\n  public isVisible() {\r\n    return !this.divAndCaption.container.classList.contains('hide');\r\n  }\r\n\r\n  public isFloating() {\r\n    return this.divAndCaption.container.classList.contains('is-floating');\r\n  }\r\n\r\n  public fill(title: string | HTMLElement | DocumentFragment, subtitle: string | HTMLElement | DocumentFragment, message: Message.message) {\r\n    this.divAndCaption.container.dataset.peerId = '' + message.peerId;\r\n    this.divAndCaption.container.dataset.mid = '' + message.mid;\r\n    this.divAndCaption.fill(title, subtitle, message);\r\n    this.topbar.setUtilsWidth();\r\n  }\r\n}\r\n","// https://github.com/evgeny-nadymov/telegram-react/blob/master/src/Components/ColumnMiddle/PinnedMessageBorder.js\n\nenum BAR_HEIGHTS {\n  ONE = 32,\n  TWO = 15,\n  THREE = 10,\n  FOUR = 8,\n  MORE = 8\n};\n\nconst GAP = 1;\nconst WIDTH = 2;\nconst BASE_CLASS = 'pinned-message-border';\n\nexport default class PinnedMessageBorder {\n  private border: HTMLElement;\n  private wrapper: HTMLElement;\n  private svg: SVGSVGElement;\n  private defs: SVGDefsElement;\n  private clipPath: SVGClipPathElement;\n  private path: SVGPathElement;\n  private mark: HTMLElement;\n\n  private count: number;\n  private index: number;\n\n  private drawRect = (x: number, y: number, width: number, height: number, radius: number) => {\n    return `M${x},${y + radius}a${radius},${radius},0,0,1,${width},0v${height - 2 * radius}a${radius},${radius},0,0,1,${-width},0Z`;\n  };\n\n  private getClipPath = (id: string, barHeight: number, count: number) => {\n    const radius = 1;\n\n    let d = '';\n    /* if(count === 3) {\n      d = this.drawRect(0, 0, WIDTH, barHeight, radius)\n        + this.drawRect(0, barHeight + GAP, WIDTH, barHeight + 1, radius)\n        + this.drawRect(0, barHeight * 2 + GAP * 2 + 1, WIDTH, barHeight, radius);\n    } */if(count === 2) {\n      d = this.drawRect(0, 0, WIDTH, barHeight, radius) + this.drawRect(0, barHeight + GAP * 2, WIDTH, barHeight, radius);\n    } else {\n      for(let i = 0; i < count; ++i) {\n        d += this.drawRect(0, (barHeight + GAP) * i, WIDTH, barHeight, radius);\n      }\n    }\n\n    if(!this.clipPath) {\n      this.clipPath = document.createElementNS('http://www.w3.org/2000/svg', 'clipPath');\n      this.path = document.createElementNS('http://www.w3.org/2000/svg', 'path');\n\n      this.clipPath.append(this.path);\n    }\n\n    this.clipPath.id = id;\n    this.path.setAttributeNS(null, 'd', d);\n\n    return this.clipPath;\n  };\n\n  private getBarHeight = (count: number, index: number) => {\n    let barHeight: number;\n    if(count <= 1) {\n      barHeight = BAR_HEIGHTS.ONE;\n    } else if(count === 2) {\n      barHeight = BAR_HEIGHTS.TWO;\n    } else if(count === 3) {\n      barHeight = BAR_HEIGHTS.THREE;\n    } else if(count === 4) {\n      barHeight = BAR_HEIGHTS.FOUR;\n    } else if(count > 3) {\n      barHeight = BAR_HEIGHTS.MORE;\n    }\n\n    return barHeight;\n  };\n\n  private getMarkHeight = (count: number, index: number) => {\n    let markHeight: number;\n    if(count <= 1) {\n      markHeight = BAR_HEIGHTS.ONE;\n    } else if(count === 2) {\n      markHeight = BAR_HEIGHTS.TWO;\n    } else if(count === 3) {\n      markHeight = BAR_HEIGHTS.THREE;\n    } else if(count === 4) {\n      markHeight = BAR_HEIGHTS.FOUR;\n    } else if(count > 3) {\n      markHeight = BAR_HEIGHTS.MORE;\n    }\n\n    return markHeight;\n  };\n\n  private getMarkTranslateY = (index: number, barHeight: number, count: number) => {\n    if(count === 1) {\n      return 0;\n    } else if(count === 2) {\n      return !index ? 0 : barHeight + GAP;\n    }\n\n    if(count === 3) {\n      if(!index) {\n        return 0;\n      } else if(index === 1) {\n        return barHeight + GAP;\n      }\n\n      return barHeight * 2 + GAP * 2 + 1;\n    } else {\n      return (barHeight + GAP) * index;\n    }\n  };\n\n  private getTrackTranslateY = (index: number, count: number, barHeight: number, trackHeight: number) => {\n    if(count <= 4) {\n      return 0;\n    }\n\n    if(index <= 1) {\n      return 0;\n    } else if(index >= (count - 2)) {\n      return trackHeight - BAR_HEIGHTS.ONE - barHeight;\n    }\n\n    // return (index + 1) * barHeight + index * GAP;\n    return (index - 2) * barHeight + index * GAP;\n    // return (barHeight + GAP * 2) / 2 + (index - 2) * (barHeight + GAP);\n  };\n\n  private getTrackHeight = (count: number, barHeight: number) => {\n    return count <= 3 ? BAR_HEIGHTS.ONE : barHeight * count + GAP * (count - 1);\n  };\n\n  public render(count: number, index: number) {\n    if(!this.border) {\n      this.border = document.createElement('div');\n      this.border.classList.add(BASE_CLASS);\n\n      this.wrapper = document.createElement('div');\n      this.border.append(this.wrapper);\n    }\n\n    if(count === 1) {\n      if(this.count !== count) {\n        this.wrapper.className = BASE_CLASS + '-wrapper-1';\n        this.border.classList.remove(BASE_CLASS + '-mask');\n        this.wrapper.innerHTML = this.wrapper.style.cssText = '';\n      }\n\n      return this.border;\n    }\n\n    const barHeight = this.getBarHeight(count, index);\n    const markHeight = this.getMarkHeight(count, index);\n    const trackHeight = this.getTrackHeight(count, barHeight);\n\n    const clipPathId = `clipPath_${count}`;\n    const clipPath = this.getClipPath(clipPathId, barHeight, count);\n\n    const markTranslateY = this.getMarkTranslateY(index, barHeight, count);\n    const trackTranslateY = this.getTrackTranslateY(index, count, barHeight, trackHeight);\n\n    this.border.classList.toggle(BASE_CLASS + '-mask', count > 4);\n\n    if(index <= 1) {\n      this.border.classList.add('mask-bottom');\n      this.border.classList.remove('mask-top');\n    } else if(index >= (count - 2)) {\n      this.border.classList.add('mask-top');\n      this.border.classList.remove('mask-bottom');\n    } else {\n      this.border.classList.add('mask-top', 'mask-bottom');\n    }\n\n    this.wrapper.className = BASE_CLASS + '-wrapper';\n    this.wrapper.style.cssText = `clip-path: url(#${clipPathId}); width: 2px; height: ${trackHeight}px; transform: translateY(-${trackTranslateY}px);`;\n\n    if(!this.svg) {\n      this.svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');\n      this.svg.setAttributeNS(null, 'height', '0');\n      this.svg.setAttributeNS(null, 'width', '0');\n\n      this.defs = document.createElementNS('http://www.w3.org/2000/svg', 'defs');\n      this.defs.append(clipPath);\n\n      this.svg.append(this.defs);\n\n      this.mark = document.createElement('div');\n      this.mark.classList.add(BASE_CLASS + '-mark');\n    }\n\n    if(!this.svg.parentElement) {\n      this.wrapper.append(this.svg, this.mark);\n    }\n\n    this.mark.style.cssText = `height: ${markHeight}px; transform: translateY(${markTranslateY}px);`;\n\n    this.count = count;\n    this.index = index;\n\n    return this.border;\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport type {AppMessagesManager} from '../../lib/appManagers/appMessagesManager';\nimport type ChatTopbar from './topbar';\nimport rootScope from '../../lib/rootScope';\nimport appMediaPlaybackController, {AppMediaPlaybackController} from '../appMediaPlaybackController';\nimport DivAndCaption from '../divAndCaption';\nimport PinnedContainer from './pinnedContainer';\nimport Chat from './chat';\nimport cancelEvent from '../../helpers/dom/cancelEvent';\nimport {attachClickEvent} from '../../helpers/dom/clickEvent';\nimport replaceContent from '../../helpers/dom/replaceContent';\nimport PeerTitle from '../peerTitle';\nimport {i18n} from '../../lib/langPack';\nimport {formatFullSentTime} from '../../helpers/date';\nimport ButtonIcon from '../buttonIcon';\nimport {DocumentAttribute} from '../../layer';\nimport MediaProgressLine from '../mediaProgressLine';\nimport VolumeSelector from '../volumeSelector';\nimport wrapEmojiText from '../../lib/richTextProcessor/wrapEmojiText';\nimport {AppManagers} from '../../lib/appManagers/managers';\n\nexport default class ChatAudio extends PinnedContainer {\n  private toggleEl: HTMLElement;\n  private progressLine: MediaProgressLine;\n  private volumeSelector: VolumeSelector;\n  private fasterEl: HTMLElement;\n  private repeatEl: HTMLButtonElement;\n\n  constructor(protected topbar: ChatTopbar, protected chat: Chat, protected managers: AppManagers) {\n    super({\n      topbar,\n      chat,\n      listenerSetter: topbar.listenerSetter,\n      className: 'audio',\n      divAndCaption: new DivAndCaption(\n        'pinned-audio',\n        (title: string | HTMLElement | DocumentFragment, subtitle: string | HTMLElement | DocumentFragment) => {\n          replaceContent(this.divAndCaption.title, title);\n          replaceContent(this.divAndCaption.subtitle, subtitle);\n        }\n      ),\n      onClose: () => {\n        appMediaPlaybackController.stop();\n      },\n      floating: true\n    });\n\n    this.divAndCaption.border.remove();\n\n    const prevEl = ButtonIcon('fast_rewind active', {noRipple: true});\n    const nextEl = ButtonIcon('fast_forward active', {noRipple: true});\n\n    const attachClick = (elem: HTMLElement, callback: () => void) => {\n      attachClickEvent(elem, (e) => {\n        cancelEvent(e);\n        callback();\n      }, {listenerSetter: this.topbar.listenerSetter});\n    };\n\n    attachClick(prevEl, () => {\n      appMediaPlaybackController.previous();\n    });\n\n    attachClick(nextEl, () => {\n      appMediaPlaybackController.next();\n    });\n\n    this.toggleEl = ButtonIcon('', {noRipple: true});\n    this.toggleEl.classList.add('active', 'pinned-audio-ico', 'tgico');\n    attachClick(this.toggleEl, () => {\n      appMediaPlaybackController.toggle();\n    });\n    this.wrapper.prepend(this.wrapper.firstElementChild, prevEl, this.toggleEl, nextEl);\n\n    this.volumeSelector = new VolumeSelector(this.listenerSetter, true);\n    const volumeProgressLineContainer = document.createElement('div');\n    volumeProgressLineContainer.classList.add('progress-line-container');\n    volumeProgressLineContainer.append(this.volumeSelector.container);\n    const tunnel = document.createElement('div');\n    tunnel.classList.add('pinned-audio-volume-tunnel');\n    this.volumeSelector.btn.classList.add('pinned-audio-volume', 'active');\n    this.volumeSelector.btn.prepend(tunnel);\n    this.volumeSelector.btn.append(volumeProgressLineContainer);\n\n    this.repeatEl = ButtonIcon('audio_repeat', {noRipple: true});\n    attachClick(this.repeatEl, () => {\n      const params = appMediaPlaybackController.getPlaybackParams();\n      if(!params.round) {\n        appMediaPlaybackController.round = true;\n      } else if(params.loop) {\n        appMediaPlaybackController.round = false;\n        appMediaPlaybackController.loop = false;\n      } else {\n        appMediaPlaybackController.loop = !appMediaPlaybackController.loop;\n      }\n    });\n\n    const fasterEl = this.fasterEl = ButtonIcon('playback_2x', {noRipple: true});\n    attachClick(fasterEl, () => {\n      appMediaPlaybackController.playbackRate = fasterEl.classList.contains('active') ? 1 : 1.75;\n    });\n\n    this.wrapperUtils.prepend(this.volumeSelector.btn, fasterEl, this.repeatEl);\n\n    const progressWrapper = document.createElement('div');\n    progressWrapper.classList.add('pinned-audio-progress-wrapper');\n\n    this.progressLine = new MediaProgressLine(undefined, undefined, true, true);\n    this.progressLine.container.classList.add('pinned-audio-progress');\n    progressWrapper.append(this.progressLine.container);\n    this.wrapper.insertBefore(progressWrapper, this.wrapperUtils);\n\n    this.topbar.listenerSetter.add(appMediaPlaybackController)('play', this.onMediaPlay);\n    this.topbar.listenerSetter.add(appMediaPlaybackController)('pause', this.onPause);\n    this.topbar.listenerSetter.add(appMediaPlaybackController)('stop', this.onStop);\n    this.topbar.listenerSetter.add(appMediaPlaybackController)('playbackParams', this.onPlaybackParams);\n\n    const playingDetails = appMediaPlaybackController.getPlayingDetails();\n    if(playingDetails) {\n      this.onMediaPlay(playingDetails);\n      this.onPlaybackParams(playingDetails.playbackParams);\n    }\n  }\n\n  public destroy() {\n    if(this.progressLine) {\n      this.progressLine.removeListeners();\n    }\n  }\n\n  private onPlaybackParams = (playbackParams: ReturnType<AppMediaPlaybackController['getPlaybackParams']>) => {\n    this.fasterEl.classList.toggle('active', playbackParams.playbackRate > 1);\n\n    this.repeatEl.classList.remove('tgico-audio_repeat', 'tgico-audio_repeat_single');\n    this.repeatEl.classList.add(playbackParams.loop ? 'tgico-audio_repeat_single' : 'tgico-audio_repeat');\n    this.repeatEl.classList.toggle('active', playbackParams.loop || playbackParams.round);\n  };\n\n  private onPause = () => {\n    this.toggleEl.classList.remove('flip-icon');\n  };\n\n  private onStop = () => {\n    this.toggle(true);\n  };\n\n  private onMediaPlay = ({doc, message, media, playbackParams}: ReturnType<AppMediaPlaybackController['getPlayingDetails']>) => {\n    let title: string | HTMLElement | DocumentFragment, subtitle: string | HTMLElement | DocumentFragment;\n    const isMusic = doc.type !== 'voice' && doc.type !== 'round';\n    if(!isMusic) {\n      title = new PeerTitle({peerId: message.fromId, fromName: message.fwd_from?.from_name}).element;\n\n      // subtitle = 'Voice message';\n      subtitle = formatFullSentTime(message.date);\n    } else {\n      const audioAttribute = doc.attributes.find((attr) => attr._ === 'documentAttributeAudio') as DocumentAttribute.documentAttributeAudio;\n      title = wrapEmojiText(audioAttribute?.title ?? doc.file_name);\n      subtitle = audioAttribute?.performer ? wrapEmojiText(audioAttribute.performer) : i18n('AudioUnknownArtist');\n    }\n\n    this.fasterEl.classList.toggle('hide', isMusic);\n    this.repeatEl.classList.toggle('hide', !isMusic);\n\n    this.onPlaybackParams(playbackParams);\n    this.volumeSelector.setVolume();\n\n    this.progressLine.setMedia(media);\n\n    this.fill(title, subtitle, message);\n    // this.toggleEl.classList.add('flip-icon');\n    this.toggleEl.classList.toggle('flip-icon', !media.paused);\n    this.toggle(false);\n  };\n}\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport type ChatTopbar from './topbar';\r\nimport PopupPinMessage from '../popups/unpinMessage';\r\nimport PinnedContainer from './pinnedContainer';\r\nimport PinnedMessageBorder from './pinnedMessageBorder';\r\nimport ReplyContainer, {wrapReplyDivAndCaption} from './replyContainer';\r\nimport rootScope from '../../lib/rootScope';\r\nimport Chat from './chat';\r\nimport ListenerSetter from '../../helpers/listenerSetter';\r\nimport ButtonIcon from '../buttonIcon';\r\nimport {getHeavyAnimationPromise} from '../../hooks/useHeavyAnimationCheck';\r\nimport {i18n} from '../../lib/langPack';\r\nimport cancelEvent from '../../helpers/dom/cancelEvent';\r\nimport {attachClickEvent} from '../../helpers/dom/clickEvent';\r\nimport handleScrollSideEvent from '../../helpers/dom/handleScrollSideEvent';\r\nimport debounce from '../../helpers/schedulers/debounce';\r\nimport throttle from '../../helpers/schedulers/throttle';\r\nimport {AppManagers} from '../../lib/appManagers/managers';\r\nimport {Message} from '../../layer';\r\nimport {logger} from '../../lib/logger';\r\n\r\nclass AnimatedSuper {\r\n  static DURATION = 200;\r\n  static BASE_CLASS = 'animated-super';\r\n  container: HTMLDivElement;\r\n  rows: {[index: string]: {element: HTMLElement, timeout?: number, new?: true}} = {};\r\n  clearTimeout: number;\r\n\r\n  constructor() {\r\n    this.container = document.createElement('div');\r\n    this.container.className = AnimatedSuper.BASE_CLASS;\r\n  }\r\n\r\n  public getRow(index: number, animateFirst = false) {\r\n    if(this.rows[index]) return this.rows[index].element;\r\n    const row = document.createElement('div');\r\n    const isFirst = !Object.keys(this.rows).length && !animateFirst;\r\n    row.className = AnimatedSuper.BASE_CLASS + '-row' + (isFirst ? '' : ' is-hiding hide');\r\n    this.rows[index] = {element: row, new: true};\r\n    this.container.append(row);\r\n    return row;\r\n  }\r\n\r\n  public clearRow(index: number) {\r\n    if(!this.rows[index]) return;\r\n    this.rows[index].element.remove();\r\n    delete this.rows[index];\r\n  }\r\n\r\n  public clearRows(currentIndex?: number) {\r\n    if(this.clearTimeout) clearTimeout(this.clearTimeout);\r\n    this.clearTimeout = window.setTimeout(() => {\r\n      for(const i in this.rows) {\r\n        if(+i === currentIndex) continue;\r\n        this.clearRow(+i);\r\n      }\r\n    }, AnimatedSuper.DURATION);\r\n  }\r\n\r\n  public setNewRow(index: number, reflow = false) {\r\n    const row = this.rows[index];\r\n    if(row.new) {\r\n      if(reflow) {\r\n        row.element.classList.remove('hide');\r\n        void row.element.offsetLeft; // reflow\r\n      } else {\r\n        row.element.classList.remove('is-hiding', 'hide');\r\n      }\r\n\r\n      delete row.new;\r\n    }\r\n\r\n    this.clearRows(index);\r\n  }\r\n\r\n  public animate(index: number, previousIndex: number, fromTop = index > previousIndex, ignorePrevious = false) {\r\n    if(index === previousIndex) { // * handle if set index 0 and previousIndex 0\r\n      return this.setNewRow(index);\r\n    }\r\n\r\n    const row = this.rows[index];\r\n    const previousRow = this.rows[previousIndex];\r\n    if(!previousRow && !ignorePrevious) {\r\n      return this.setNewRow(index);\r\n    }\r\n\r\n    const sides = ['from-top', 'from-bottom'];\r\n    if(!fromTop) sides.reverse();\r\n\r\n    row.element.classList.add(sides[0]);\r\n    row.element.classList.remove(sides[1]);\r\n    if(previousRow) {\r\n      previousRow.element.classList.add(sides[1]);\r\n      previousRow.element.classList.remove(sides[0]);\r\n    }\r\n\r\n    if(row.new) {\r\n      this.setNewRow(index, true);\r\n    }\r\n\r\n    row.element.classList.toggle('is-hiding', false);\r\n    previousRow && previousRow.element.classList.toggle('is-hiding', true);\r\n\r\n    /* const height = row.element.getBoundingClientRect().height;\r\n    row.element.style.transform = `translateY(${fromTop ? height * -1 : height}px)`;\r\n    if(previousRow) {\r\n      previousRow.element.style.transform = `translateY(${fromTop ? height : height * -1}px)`;\r\n    } */\r\n\r\n    /* row.element.style.setProperty('--height', row.element.getBoundingClientRect().height + 'px');\r\n    if(previousRow) {\r\n      previousRow.element.style.setProperty('--height', previousRow.element.getBoundingClientRect().height + 'px');\r\n    } */\r\n\r\n    this.clearRows(index);\r\n  }\r\n}\r\n\r\nclass AnimatedCounter {\r\n  static EMPTY_INDEX = -1;\r\n  static BASE_CLASS = 'animated-counter';\r\n  container: HTMLElement;\r\n  decimals: {\r\n    container: HTMLElement,\r\n    placeholder: HTMLElement,\r\n    animatedSuper: AnimatedSuper\r\n  }[] = [];\r\n  previousNumber = 0;\r\n  clearTimeout: number;\r\n\r\n  constructor(private reverse = false) {\r\n    this.container = document.createElement('div');\r\n    this.container.className = AnimatedCounter.BASE_CLASS;\r\n  }\r\n\r\n  getDecimal(index: number) {\r\n    if(this.decimals[index]) return this.decimals[index];\r\n    const item = document.createElement('div');\r\n    item.className = AnimatedCounter.BASE_CLASS + '-decimal';\r\n\r\n    const placeholder = document.createElement('div');\r\n    placeholder.className = AnimatedCounter.BASE_CLASS + '-decimal-placeholder';\r\n\r\n    const animatedSuper = new AnimatedSuper();\r\n    animatedSuper.container.className = AnimatedCounter.BASE_CLASS + '-decimal-wrapper';\r\n\r\n    item.append(placeholder, animatedSuper.container);\r\n\r\n    this.container.append(item);\r\n\r\n    return this.decimals[index] = {container: item, placeholder, animatedSuper};\r\n  }\r\n\r\n  clear(number: number) {\r\n    if(this.clearTimeout) clearTimeout(this.clearTimeout);\r\n\r\n    const decimals = ('' + number).length;\r\n    if(decimals >= this.decimals.length) {\r\n      return;\r\n    }\r\n\r\n    this.clearTimeout = window.setTimeout(() => {\r\n      const byDecimal = this.decimals.splice(decimals, this.decimals.length - decimals);\r\n      byDecimal.forEach((decimal) => {\r\n        decimal.container.remove();\r\n      });\r\n    }, AnimatedSuper.DURATION);\r\n  }\r\n\r\n  /* prepareNumber(number: number) {\r\n    const decimals = ('' + number).length;\r\n    if(this.decimals.length < decimals) {\r\n      for(let i = this.decimals.length; i < decimals; ++i) {\r\n        this.getDecimal(i);\r\n      }\r\n    }\r\n  } */\r\n\r\n  hideLeft(number: number) {\r\n    const decimals = ('' + number).length;\r\n    const byDecimal = this.decimals.slice(decimals);// this.decimals.splice(deleteCount, this.decimals.length - deleteCount);\r\n    byDecimal.forEach((decimal) => {\r\n      const previousDecimalNumber = +decimal.placeholder.innerText || 0;\r\n      const row = decimal.animatedSuper.getRow(AnimatedCounter.EMPTY_INDEX, true);\r\n      decimal.animatedSuper.animate(AnimatedCounter.EMPTY_INDEX, previousDecimalNumber, this.reverse ? number < this.previousNumber : number > this.previousNumber, true);\r\n    });\r\n\r\n    this.clear(number);\r\n  }\r\n\r\n  setCount(number: number) {\r\n    // this.prepareNumber(number);\r\n\r\n    const previousByDecimal = Array.from('' + this.previousNumber).map((n) => +n);\r\n    const byDecimal = Array.from('' + number).map((n) => +n);\r\n    byDecimal.forEach((decimalNumber, idx) => {\r\n      const decimal = this.getDecimal(idx);\r\n      // const row = decimal.animatedSuper.getRow(number, true);\r\n      const row = decimal.animatedSuper.getRow(decimalNumber, true);\r\n      const previousDecimalNumber = previousByDecimal[idx] ?? AnimatedCounter.EMPTY_INDEX;\r\n      row.innerText = decimal.placeholder.innerText = '' + decimalNumber;\r\n      // decimal.animatedSuper.animate(number, this.previousNumber, this.reverse ? number < this.previousNumber : number > this.previousNumber, true);\r\n      decimal.animatedSuper.animate(decimalNumber, previousDecimalNumber, this.reverse ? number < this.previousNumber : number > this.previousNumber, true);\r\n    });\r\n\r\n    this.hideLeft(number);\r\n    // this.clear(number);\r\n    this.previousNumber = number;\r\n  }\r\n}\r\n\r\nexport default class ChatPinnedMessage {\r\n  private static LOAD_COUNT = 50;\r\n  private static LOAD_OFFSET = 5;\r\n\r\n  public pinnedMessageContainer: PinnedContainer;\r\n  private pinnedMessageBorder: PinnedMessageBorder;\r\n\r\n  private pinnedMaxMid = 0;\r\n  public pinnedMid = 0;\r\n  public pinnedIndex = -1;\r\n  private wasPinnedIndex = 0;\r\n  private wasPinnedMediaIndex = 0;\r\n\r\n  public locked = false;\r\n  private waitForScrollBottom = false;\r\n\r\n  public count = 0;\r\n  private mids: number[] = [];\r\n  private offsetIndex = 0;\r\n\r\n  private loading = false;\r\n  private loadedBottom = false;\r\n  private loadedTop = false;\r\n\r\n  private animatedSubtitle: AnimatedSuper;\r\n  private animatedMedia: AnimatedSuper;\r\n  private animatedCounter: AnimatedCounter;\r\n\r\n  private listenerSetter: ListenerSetter;\r\n  private scrollDownListenerSetter: ListenerSetter = null;\r\n\r\n  public hidden = false;\r\n\r\n  private getCurrentIndexPromise: Promise<any> = null;\r\n  private btnOpen: HTMLButtonElement;\r\n\r\n  private setPinnedMessage: () => void;\r\n\r\n  private isStatic: boolean;\r\n\r\n  private debug: boolean;\r\n\r\n  public setCorrectIndexThrottled: (lastScrollDirection?: number) => void;\r\n\r\n  private log: ReturnType<typeof logger>;\r\n\r\n  constructor(private topbar: ChatTopbar, private chat: Chat, private managers: AppManagers) {\r\n    this.listenerSetter = new ListenerSetter();\r\n    this.log = logger('PM');\r\n    this.debug = true;\r\n    this.isStatic = false;\r\n\r\n    const dAC = new ReplyContainer('pinned-message');\r\n    this.pinnedMessageContainer = new PinnedContainer({\r\n      topbar,\r\n      chat,\r\n      listenerSetter: this.listenerSetter,\r\n      className: 'message',\r\n      divAndCaption: dAC,\r\n      onClose: async() => {\r\n        if(await managers.appPeersManager.canPinMessage(this.chat.peerId)) {\r\n          new PopupPinMessage(this.chat.peerId, this.pinnedMid, true);\r\n        } else {\r\n          new PopupPinMessage(this.chat.peerId, 0, true);\r\n        }\r\n\r\n        return false;\r\n      }\r\n    });\r\n\r\n    this.pinnedMessageBorder = new PinnedMessageBorder();\r\n    dAC.border.replaceWith(this.pinnedMessageBorder.render(1, 0));\r\n\r\n    this.animatedSubtitle = new AnimatedSuper();\r\n    dAC.subtitle.append(this.animatedSubtitle.container);\r\n\r\n    this.animatedMedia = new AnimatedSuper();\r\n    this.animatedMedia.container.classList.add('pinned-message-media-container');\r\n    dAC.content.prepend(this.animatedMedia.container);\r\n\r\n    this.animatedCounter = new AnimatedCounter(true);\r\n    dAC.title.append(i18n('PinnedMessage'), ' ', this.animatedCounter.container);\r\n\r\n    const btnClose = this.pinnedMessageContainer.btnClose.cloneNode(true) as HTMLElement;\r\n    this.pinnedMessageContainer.attachOnCloseEvent(btnClose);\r\n    dAC.container.prepend(btnClose);\r\n\r\n    this.btnOpen = ButtonIcon('pinlist pinned-container-close pinned-message-pinlist', {noRipple: true});\r\n\r\n    this.pinnedMessageContainer.wrapperUtils.prepend(this.btnOpen);\r\n\r\n    attachClickEvent(this.btnOpen, (e) => {\r\n      cancelEvent(e);\r\n      this.topbar.openPinned(true);\r\n    }, {listenerSetter: this.listenerSetter});\r\n\r\n    this.listenerSetter.add(rootScope)('peer_pinned_messages', ({peerId}) => {\r\n      if(peerId === this.chat.peerId) {\r\n        // this.wasPinnedIndex = 0;\r\n        // setTimeout(() => {\r\n        if(this.hidden) {\r\n          this.pinnedMessageContainer.toggle(this.hidden = false);\r\n        }\r\n\r\n        this.loadedTop = this.loadedBottom = false;\r\n        this.pinnedIndex = -1;\r\n        this.pinnedMid = 0;\r\n        this.count = 0;\r\n        this.mids = [];\r\n        this.offsetIndex = 0;\r\n        this.pinnedMaxMid = 0;\r\n        this.setCorrectIndex(0);\r\n        // }, 300);\r\n      }\r\n    });\r\n\r\n    this.listenerSetter.add(rootScope)('peer_pinned_hidden', ({peerId}) => {\r\n      if(peerId === this.chat.peerId) {\r\n        this.pinnedMessageContainer.toggle(this.hidden = true);\r\n      }\r\n    });\r\n\r\n    // * 200 - no lags\r\n    // * 100 - need test\r\n    this.setPinnedMessage = debounce(() => this._setPinnedMessage(), 100, true, true);\r\n    this.setCorrectIndexThrottled = throttle(this.setCorrectIndex.bind(this), 100, false);\r\n\r\n    this.isStatic = this.chat.type === 'discussion';\r\n  }\r\n\r\n  public destroy() {\r\n    this.pinnedMessageContainer.divAndCaption.container.remove();\r\n    this.pinnedMessageContainer.toggle(true);\r\n    this.listenerSetter.removeAll();\r\n    this.unsetScrollDownListener(false);\r\n  }\r\n\r\n  public setCorrectIndex(lastScrollDirection?: number) {\r\n    if(this.isStatic) return;\r\n    // return;\r\n\r\n    if(this.locked || this.hidden/*  || this.chat.setPeerPromise || this.chat.bubbles.messagesQueuePromise */) {\r\n      return;\r\n    }\r\n\r\n    if((this.loadedBottom || this.loadedTop) && !this.count) {\r\n      return;\r\n    }\r\n\r\n    // const perf = performance.now();\r\n    const el = this.chat.bubbles.getBubbleByPoint('bottom');\r\n    // this.log('setCorrectIndex: get last element perf:', performance.now() - perf, el);\r\n    if(!el) return;\r\n\r\n    // return;\r\n\r\n    const mid = el.dataset.mid;\r\n    if(el && mid !== undefined) {\r\n      // this.log('setCorrectIndex will test mid:', mid);\r\n      this.testMid(+mid, lastScrollDirection);\r\n    }\r\n  }\r\n\r\n  public testMid(mid: number, lastScrollDirection?: number) {\r\n    if(this.isStatic) return;\r\n\r\n    // if(lastScrollDirection !== undefined) return;\r\n    if(this.hidden) return;\r\n\r\n    // this.log('testMid', mid);\r\n\r\n    let currentIndex: number = this.mids.findIndex((_mid) => _mid <= mid);\r\n    if(currentIndex !== -1 && !this.isNeededMore(currentIndex)) {\r\n      currentIndex += this.offsetIndex;\r\n    } else if(this.loadedTop && mid < this.mids[this.mids.length - 1]) {\r\n      // currentIndex = 0;\r\n      currentIndex = this.mids.length - 1 + this.offsetIndex;\r\n    } else {\r\n      if(!this.getCurrentIndexPromise) {\r\n        this.getCurrentIndexPromise = this.getCurrentIndex(mid, lastScrollDirection !== undefined);\r\n      }\r\n\r\n      return;\r\n    }\r\n\r\n    // const idx = Math.max(0, this.mids.indexOf(mid));\r\n\r\n    /* if(currentIndex === this.count) {\r\n      currentIndex = 0;\r\n    } */\r\n\r\n    // this.log('testMid: pinned currentIndex', currentIndex, mid);\r\n\r\n    const changed = this.pinnedIndex !== currentIndex;\r\n    if(changed) {\r\n      if(this.waitForScrollBottom && lastScrollDirection !== undefined) {\r\n        if(this.pinnedIndex === 0 || this.pinnedIndex > currentIndex) { //          - \r\n          return;\r\n        }\r\n      }\r\n\r\n      this.pinnedIndex = currentIndex;\r\n      this.pinnedMid = this.mids.find((_mid) => _mid <= mid) || this.mids[this.mids.length - 1];\r\n      this.setPinnedMessage();\r\n    }\r\n  }\r\n\r\n  private isNeededMore(currentIndex: number) {\r\n    return (this.count > ChatPinnedMessage.LOAD_COUNT &&\r\n      (\r\n        (!this.loadedBottom && currentIndex <= ChatPinnedMessage.LOAD_OFFSET) ||\r\n        (!this.loadedTop && (this.count - 1 - currentIndex) <= ChatPinnedMessage.LOAD_OFFSET)\r\n      )\r\n    );\r\n  }\r\n\r\n  private async getCurrentIndex(mid: number, correctAfter = true) {\r\n    if(this.loading) return;\r\n    this.loading = true;\r\n\r\n    try {\r\n      const log = this.debug ? this.log.bindPrefix('getCurrentIndex') : undefined;\r\n      log && log('start', mid, correctAfter);\r\n\r\n      let gotRest = false;\r\n      const promises = [\r\n        this.managers.appMessagesManager.getSearch({\r\n          peerId: this.chat.peerId,\r\n          inputFilter: {_: 'inputMessagesFilterPinned'},\r\n          maxId: mid,\r\n          limit: ChatPinnedMessage.LOAD_COUNT,\r\n          backLimit: ChatPinnedMessage.LOAD_COUNT\r\n        })\r\n        .then((r) => {\r\n          gotRest = true;\r\n          return r;\r\n        })\r\n      ];\r\n\r\n      if(!this.pinnedMaxMid) {\r\n        const promise = this.managers.appMessagesManager.getPinnedMessage(this.chat.peerId).then((p) => {\r\n          if(!p.maxId) return;\r\n          this.pinnedMaxMid = p.maxId;\r\n\r\n          if(!gotRest && correctAfter) {\r\n            this.mids = [this.pinnedMaxMid];\r\n            this.count = p.count;\r\n            this.pinnedIndex = 0;\r\n            this.pinnedMid = this.mids[0];\r\n            this.setPinnedMessage();\r\n            // this.pinnedMessageContainer.toggle(false);\r\n          }\r\n        });\r\n\r\n        promises.push(promise as any);\r\n      }\r\n\r\n      const result = (await Promise.all(promises))[0];\r\n\r\n      let backLimited = result.history.findIndex((message) => message.mid <= mid);\r\n      if(backLimited === -1) {\r\n        backLimited = result.history.length;\r\n      }/*  else {\r\n        backLimited -= 1;\r\n      } */\r\n\r\n      this.offsetIndex = result.offset_id_offset ? result.offset_id_offset - backLimited : 0;\r\n      this.mids = result.history.map((message) => message.mid).slice();\r\n      this.count = result.count;\r\n\r\n      if(!this.count) {\r\n        this.pinnedMessageContainer.toggle(true);\r\n      }\r\n\r\n      this.loadedTop = (this.offsetIndex + this.mids.length) === this.count;\r\n      this.loadedBottom = !this.offsetIndex;\r\n\r\n      log && log('result', mid, result, backLimited, this.offsetIndex, this.loadedTop, this.loadedBottom);\r\n    } catch(err) {\r\n      this.log.error('getCurrentIndex error', err);\r\n    }\r\n\r\n    this.loading = false;\r\n\r\n    if(this.locked) {\r\n      this.testMid(mid);\r\n    } else if(correctAfter) {\r\n      this.setCorrectIndex(0);\r\n    }\r\n\r\n    this.getCurrentIndexPromise = null;\r\n    // return result.offset_id_offset || 0;\r\n  }\r\n\r\n  public setScrollDownListener() {\r\n    this.waitForScrollBottom = true;\r\n\r\n    if(!this.scrollDownListenerSetter) {\r\n      this.scrollDownListenerSetter = new ListenerSetter();\r\n      handleScrollSideEvent(this.chat.bubbles.scrollable.container, 'bottom', () => {\r\n        this.unsetScrollDownListener();\r\n      }, this.scrollDownListenerSetter);\r\n    }\r\n  }\r\n\r\n  public unsetScrollDownListener(refreshPosition = true) {\r\n    this.waitForScrollBottom = false;\r\n\r\n    if(this.scrollDownListenerSetter) {\r\n      this.scrollDownListenerSetter.removeAll();\r\n      this.scrollDownListenerSetter = null;\r\n    }\r\n\r\n    if(refreshPosition) {\r\n      this.setCorrectIndex(0);\r\n    }\r\n  }\r\n\r\n  public async handleFollowingPinnedMessage() {\r\n    this.locked = true;\r\n\r\n    this.debug && this.log('handleFollowingPinnedMessage');\r\n    try {\r\n      this.setScrollDownListener();\r\n\r\n      const setPeerPromise = this.chat.setPeerPromise;\r\n      if(setPeerPromise instanceof Promise) {\r\n        await setPeerPromise;\r\n      }\r\n\r\n      // await this.chat.bubbles.scrollable.scrollLockedPromise;\r\n      await getHeavyAnimationPromise();\r\n\r\n      if(this.getCurrentIndexPromise) {\r\n        await this.getCurrentIndexPromise;\r\n      }\r\n\r\n      this.debug && this.log('handleFollowingPinnedMessage: unlock');\r\n      this.locked = false;\r\n\r\n      /* // ,   \r\n      setTimeout(() => {\r\n        this.log('handleFollowingPinnedMessage: unlock');\r\n        this.locked = false;\r\n      }, 50); */\r\n    } catch(err) {\r\n      this.log.error('handleFollowingPinnedMessage error:', err);\r\n\r\n      this.locked = false;\r\n      this.waitForScrollBottom = false;\r\n      this.setCorrectIndex(0);\r\n    }\r\n  }\r\n\r\n  public async followPinnedMessage(mid: number) {\r\n    const message = await this.chat.getMessage(mid);\r\n    if(!message) {\r\n      return;\r\n    }\r\n\r\n    this.chat.setMessageId(mid);\r\n    (this.chat.setPeerPromise || Promise.resolve()).then(() => { // * debounce fast clicker\r\n      this.handleFollowingPinnedMessage();\r\n      this.testMid(this.pinnedIndex >= (this.count - 1) ? this.pinnedMaxMid : mid - 1);\r\n    });\r\n  }\r\n\r\n  public async _setPinnedMessage() {\r\n    // ///this.log('setting pinned message', message);\r\n    // return;\r\n    /* const promise: Promise<any> = this.chat.setPeerPromise || this.chat.bubbles.messagesQueuePromise || Promise.resolve();\r\n    Promise.all([\r\n      promise\r\n    ]).then(() => { */\r\n    // const mids = results[0];\r\n    const count = this.count;\r\n    if(count) {\r\n      const pinnedIndex = this.pinnedIndex;\r\n      const message = await this.chat.getMessage(this.pinnedMid);\r\n\r\n      // this.animatedCounter.prepareNumber(count);\r\n\r\n      // setTimeout(() => {\r\n      const isLast = pinnedIndex === 0;\r\n      this.animatedCounter.container.classList.toggle('is-last', isLast);\r\n      // SetTransition(this.animatedCounter.container, 'is-last', isLast, AnimatedSuper.DURATION);\r\n      if(!isLast) {\r\n        this.animatedCounter.setCount(count - pinnedIndex);\r\n      }\r\n      // }, 100);\r\n\r\n      // this.pinnedMessageContainer.fill(undefined, message.message, message);\r\n      this.pinnedMessageContainer.toggle(false);\r\n\r\n      const fromTop = pinnedIndex > this.wasPinnedIndex;\r\n\r\n      this.debug && this.log('setPinnedMessage: fromTop', fromTop, pinnedIndex, this.wasPinnedIndex);\r\n\r\n      const writeTo = this.animatedSubtitle.getRow(pinnedIndex);\r\n      const writeMediaTo = this.animatedMedia.getRow(pinnedIndex);\r\n      writeMediaTo.classList.add('pinned-message-media');\r\n      // writeMediaTo.innerHTML = writeMediaTo.style.cssText = writeMediaTo.dataset.docId = '';\r\n      const loadPromises: Promise<any>[] = [];\r\n      const isMediaSet = await wrapReplyDivAndCaption({\r\n        title: undefined,\r\n        titleEl: null,\r\n        subtitle: (message as Message.message).message,\r\n        subtitleEl: writeTo,\r\n        message,\r\n        mediaEl: writeMediaTo,\r\n        loadPromises\r\n      });\r\n\r\n      await Promise.all(loadPromises);\r\n\r\n      this.pinnedMessageContainer.divAndCaption.container.classList.toggle('is-media', isMediaSet);\r\n\r\n      // if(this.wasPinnedIndex !== this.pinnedIndex) {\r\n      this.animatedSubtitle.animate(pinnedIndex, this.wasPinnedIndex);\r\n      if(isMediaSet) {\r\n        this.animatedMedia.animate(pinnedIndex, this.wasPinnedMediaIndex); // * wasPinnedMediaIndex - ,      \r\n        this.wasPinnedMediaIndex = pinnedIndex;\r\n      } else {\r\n        this.animatedMedia.clearRows();\r\n      }\r\n      // }\r\n\r\n      this.pinnedMessageBorder.render(count, count - pinnedIndex - 1);\r\n      this.wasPinnedIndex = pinnedIndex;\r\n      this.pinnedMessageContainer.divAndCaption.container.dataset.mid = '' + message.mid;\r\n    } else {\r\n      this.pinnedMessageContainer.toggle(true);\r\n      this.wasPinnedIndex = 0;\r\n    }\r\n\r\n    this.pinnedMessageContainer.divAndCaption.container.classList.toggle('is-many', this.count > 1);\r\n    // });\r\n  }\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport type ListenerSetter from '../listenerSetter';\r\nimport IS_TOUCH_SUPPORTED from '../../environment/touchSupport';\r\n\r\nexport default function handleScrollSideEvent(elem: HTMLElement, side: 'top' | 'bottom', callback: () => void, listenerSetter: ListenerSetter) {\r\n  if(IS_TOUCH_SUPPORTED) {\r\n    let lastY: number;\r\n    const options = {passive: true};\r\n    listenerSetter.add(elem)('touchstart', (e) => {\r\n      if(e.touches.length > 1) {\r\n        onTouchEnd();\r\n        return;\r\n      }\r\n\r\n      lastY = e.touches[0].clientY;\r\n\r\n      listenerSetter.add(elem)('touchmove', onTouchMove, options);\r\n      listenerSetter.add(elem)('touchend', onTouchEnd, options);\r\n    }, options);\r\n\r\n    const onTouchMove = (e: TouchEvent) => {\r\n      const clientY = e.touches[0].clientY;\r\n\r\n      const isDown = clientY < lastY;\r\n      if(side === 'bottom' && isDown) callback();\r\n      else if(side === 'top' && !isDown) callback();\r\n      lastY = clientY;\r\n      // alert('isDown: ' + !!isDown);\r\n    };\r\n\r\n    const onTouchEnd = () => {\r\n      listenerSetter.removeManual(elem, 'touchmove', onTouchMove, options);\r\n      listenerSetter.removeManual(elem, 'touchend', onTouchEnd, options);\r\n    };\r\n  } else {\r\n    listenerSetter.add(elem)('wheel', (e) => {\r\n      const isDown = e.deltaY > 0;\r\n      // this.log('wheel', e, isDown);\r\n      if(side === 'bottom' && isDown) callback();\r\n      else if(side === 'top' && !isDown) callback();\r\n    }, {passive: true});\r\n  }\r\n}\r\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport type {Channel} from '../../lib/appManagers/appChatsManager';\nimport type {AppSidebarRight} from '../sidebarRight';\nimport type Chat from './chat';\nimport {RIGHT_COLUMN_ACTIVE_CLASSNAME} from '../sidebarRight';\nimport mediaSizes, {ScreenSize} from '../../helpers/mediaSizes';\nimport {IS_SAFARI} from '../../environment/userAgent';\nimport rootScope from '../../lib/rootScope';\nimport AvatarElement from '../avatar';\nimport Button from '../button';\nimport ButtonIcon from '../buttonIcon';\nimport ButtonMenuToggle from '../buttonMenuToggle';\nimport ChatAudio from './audio';\nimport ChatPinnedMessage from './pinnedMessage';\nimport {ButtonMenuItemOptions} from '../buttonMenu';\nimport ListenerSetter from '../../helpers/listenerSetter';\nimport PopupDeleteDialog from '../popups/deleteDialog';\nimport appNavigationController from '../appNavigationController';\nimport {LEFT_COLUMN_ACTIVE_CLASSNAME} from '../sidebarLeft';\nimport PeerTitle from '../peerTitle';\nimport {i18n} from '../../lib/langPack';\nimport findUpClassName from '../../helpers/dom/findUpClassName';\nimport blurActiveElement from '../../helpers/dom/blurActiveElement';\nimport cancelEvent from '../../helpers/dom/cancelEvent';\nimport {attachClickEvent} from '../../helpers/dom/clickEvent';\nimport findUpTag from '../../helpers/dom/findUpTag';\nimport {toast, toastNew} from '../toast';\nimport replaceContent from '../../helpers/dom/replaceContent';\nimport {ChatFull, Chat as MTChat, GroupCall} from '../../layer';\nimport PopupPickUser from '../popups/pickUser';\nimport PopupPeer from '../popups/peer';\nimport AppEditContactTab from '../sidebarRight/tabs/editContact';\nimport appMediaPlaybackController from '../appMediaPlaybackController';\nimport IS_GROUP_CALL_SUPPORTED from '../../environment/groupCallSupport';\nimport IS_CALL_SUPPORTED from '../../environment/callSupport';\nimport {CallType} from '../../lib/calls/types';\nimport PopupMute from '../popups/mute';\nimport {AppManagers} from '../../lib/appManagers/managers';\nimport hasRights from '../../lib/appManagers/utils/chats/hasRights';\nimport wrapPeerTitle from '../wrappers/peerTitle';\nimport groupCallsController from '../../lib/calls/groupCallsController';\nimport apiManagerProxy from '../../lib/mtproto/mtprotoworker';\n\ntype ButtonToVerify = {element?: HTMLElement, verify: () => boolean | Promise<boolean>};\n\nexport default class ChatTopbar {\n  public container: HTMLDivElement;\n  private btnBack: HTMLButtonElement;\n  private chatInfo: HTMLDivElement;\n  private avatarElement: AvatarElement;\n  private title: HTMLDivElement;\n  private subtitle: HTMLDivElement;\n  private chatUtils: HTMLDivElement;\n  private btnJoin: HTMLButtonElement;\n  private btnPinned: HTMLButtonElement;\n  private btnCall: HTMLButtonElement;\n  private btnGroupCall: HTMLButtonElement;\n  private btnMute: HTMLButtonElement;\n  private btnSearch: HTMLButtonElement;\n  private btnMore: HTMLElement;\n\n  private chatAudio: ChatAudio;\n  public pinnedMessage: ChatPinnedMessage;\n\n  private setUtilsRAF: number;\n  private setPeerStatusInterval: number;\n\n  public listenerSetter: ListenerSetter;\n\n  private menuButtons: (ButtonMenuItemOptions & {verify: ButtonToVerify['verify']})[];\n  private buttonsToVerify: ButtonToVerify[];\n  private chatInfoContainer: HTMLDivElement;\n\n  constructor(\n    private chat: Chat,\n    private appSidebarRight: AppSidebarRight,\n    private managers: AppManagers\n  ) {\n    this.listenerSetter = new ListenerSetter();\n\n    this.menuButtons = [];\n    this.buttonsToVerify = [];\n  }\n\n  public construct() {\n    // this.chat.log.error('Topbar construction');\n\n    this.container = document.createElement('div');\n    this.container.classList.add('sidebar-header', 'topbar', 'hide');\n    this.container.dataset.floating = '0';\n\n    this.btnBack = ButtonIcon('left sidebar-close-button', {noRipple: true});\n\n    // * chat info section\n    this.chatInfoContainer = document.createElement('div');\n    this.chatInfoContainer.classList.add('chat-info-container');\n\n    this.chatInfo = document.createElement('div');\n    this.chatInfo.classList.add('chat-info');\n\n    const person = document.createElement('div');\n    person.classList.add('person');\n\n    const content = document.createElement('div');\n    content.classList.add('content');\n\n    const top = document.createElement('div');\n    top.classList.add('top');\n\n    this.title = document.createElement('div');\n    this.title.classList.add('user-title');\n\n    top.append(this.title);\n\n    const bottom = document.createElement('div');\n    bottom.classList.add('bottom');\n\n    if(this.subtitle) {\n      bottom.append(this.subtitle);\n    }\n\n    content.append(top, bottom);\n    if(this.avatarElement) {\n      person.append(this.avatarElement);\n    }\n\n    person.append(content);\n    this.chatInfo.append(person);\n\n    // * chat utils section\n    this.chatUtils = document.createElement('div');\n    this.chatUtils.classList.add('chat-utils');\n\n    this.chatAudio = new ChatAudio(this, this.chat, this.managers);\n\n    if(this.menuButtons.length) {\n      this.btnMore = ButtonMenuToggle({listenerSetter: this.listenerSetter}, 'bottom-left', this.menuButtons, this.verifyButtons);\n    }\n\n    this.chatUtils.append(...[\n      // this.chatAudio ? this.chatAudio.divAndCaption.container : null,\n      this.pinnedMessage ? this.pinnedMessage.pinnedMessageContainer.divAndCaption.container : null,\n      this.btnJoin,\n      this.btnPinned,\n      this.btnCall,\n      this.btnGroupCall,\n      this.btnMute,\n      this.btnSearch,\n      this.btnMore\n    ].filter(Boolean));\n\n    this.pushButtonToVerify(this.btnCall, this.verifyCallButton.bind(this, 'voice'));\n    this.pushButtonToVerify(this.btnGroupCall, this.verifyVideoChatButton);\n\n    this.chatInfoContainer.append(this.btnBack, this.chatInfo, this.chatUtils);\n    this.container.append(this.chatInfoContainer);\n\n    if(this.chatAudio) {\n      // this.container.append(this.chatAudio.divAndCaption.container, this.chatUtils);\n      this.container.append(this.chatAudio.divAndCaption.container);\n    }\n\n    // * construction end\n\n    // * fix topbar overflow section\n\n    this.listenerSetter.add(window)('resize', this.onResize);\n    this.listenerSetter.add(mediaSizes)('changeScreen', this.onChangeScreen);\n\n    attachClickEvent(this.container, (e) => {\n      const container = findUpClassName(e.target, 'pinned-container');\n      blurActiveElement();\n      if(container) {\n        cancelEvent(e);\n\n        if(findUpClassName(e.target, 'progress-line')) {\n          return;\n        }\n\n        const mid = +container.dataset.mid;\n        if(container.classList.contains('pinned-message')) {\n          // if(!this.pinnedMessage.locked) {\n          this.pinnedMessage.followPinnedMessage(mid);\n          // }\n        } else {\n          const peerId = container.dataset.peerId.toPeerId();\n          const searchContext = appMediaPlaybackController.getSearchContext();\n          this.chat.appImManager.setInnerPeer({\n            peerId,\n            lastMsgId: mid,\n            type: searchContext.isScheduled ? 'scheduled' : (searchContext.threadId ? 'discussion' : undefined),\n            threadId: searchContext.threadId\n          });\n        }\n      } else {\n        if(mediaSizes.activeScreen === ScreenSize.medium && document.body.classList.contains(LEFT_COLUMN_ACTIVE_CLASSNAME)) {\n          onBtnBackClick();\n        } else if(findUpTag(e.target, 'AVATAR-ELEMENT')) {\n          this.appSidebarRight.toggleSidebar(!document.body.classList.contains(RIGHT_COLUMN_ACTIVE_CLASSNAME));\n        } else {\n          this.appSidebarRight.toggleSidebar(true);\n        }\n      }\n    }, {listenerSetter: this.listenerSetter});\n\n    const onBtnBackClick = (e?: Event) => {\n      if(e) {\n        cancelEvent(e);\n      }\n\n      // const item = appNavigationController.findItemByType('chat');\n      // * return manually to chat by arrow, since can't get back to\n      if(mediaSizes.activeScreen === ScreenSize.medium && document.body.classList.contains(LEFT_COLUMN_ACTIVE_CLASSNAME)) {\n        this.chat.appImManager.setPeer({peerId: this.peerId});\n      } else {\n        const isFirstChat = this.chat.appImManager.chats.indexOf(this.chat) === 0;\n        appNavigationController.back(isFirstChat ? 'im' : 'chat');\n        /* return;\n\n        if(mediaSizes.activeScreen === ScreenSize.medium && !appNavigationController.findItemByType('chat')) {\n          this.chat.appImManager.setPeer(0);\n          blurActiveElement();\n        } else {\n          appNavigationController.back('chat');\n        } */\n      }\n    };\n\n    attachClickEvent(this.btnBack, onBtnBackClick, {listenerSetter: this.listenerSetter});\n  }\n\n  private pushButtonToVerify(element: HTMLElement, verify: ButtonToVerify['verify']) {\n    if(!element) {\n      return;\n    }\n\n    this.buttonsToVerify.push({element, verify});\n  }\n\n  private verifyButtons = (e?: Event) => {\n    const isMenuOpen = !!e || !!(this.btnMore && this.btnMore.classList.contains('menu-open'));\n\n    e && cancelEvent(e);\n\n    const r = async() => {\n      const deleteButtonText = await this.managers.appPeersManager.getDeleteButtonText(this.peerId);\n      if(isMenuOpen) {\n        // delete button\n        this.menuButtons[this.menuButtons.length - 1].element.lastChild.replaceWith(i18n(deleteButtonText));\n      }\n\n      const buttons = this.buttonsToVerify.concat(isMenuOpen ? this.menuButtons : []);\n      const results = await Promise.all(buttons.map(async(button) => {\n        return {\n          result: await button.verify(),\n          button\n        }\n      }));\n\n      results.forEach(({button, result}) => {\n        button.element.classList.toggle('hide', !result);\n      });\n    };\n\n    r();\n  };\n\n  private verifyVideoChatButton = async(type?: 'group' | 'broadcast') => {\n    if(!IS_GROUP_CALL_SUPPORTED || this.peerId.isUser()) return false;\n\n    const currentGroupCall = groupCallsController.groupCall;\n    const chatId = this.peerId.toChatId();\n    if(currentGroupCall?.chatId === chatId) {\n      return false;\n    }\n\n    if(type) {\n      if(((await this.managers.appPeersManager.isBroadcast(this.peerId)) && type === 'group') ||\n        ((await this.managers.appPeersManager.isAnyGroup(this.peerId)) && type === 'broadcast')) {\n        return false;\n      }\n    }\n\n    const chat = await this.managers.appChatsManager.getChatTyped(chatId);\n    return (chat as MTChat.chat).pFlags?.call_active || hasRights(chat, 'manage_call');\n  };\n\n  private verifyCallButton = async(type?: CallType) => {\n    if(!IS_CALL_SUPPORTED || !this.peerId.isUser()) return false;\n    const userId = this.peerId.toUserId();\n    const userFull = await this.managers.appProfileManager.getCachedFullUser(userId);\n\n    return !!userFull && !!(type === 'voice' ? userFull.pFlags.phone_calls_available : userFull.pFlags.video_calls_available);\n  };\n\n  public constructUtils() {\n    this.menuButtons = [{\n      icon: 'search',\n      text: 'Search',\n      onClick: () => {\n        this.chat.initSearch();\n      },\n      verify: () => mediaSizes.isMobile\n    }, /* {\n      icon: 'pinlist',\n      text: 'Pinned Messages',\n      onClick: () => this.openPinned(false),\n      verify: () => mediaSizes.isMobile\n    }, */{\n      icon: 'mute',\n      text: 'ChatList.Context.Mute',\n      onClick: this.onMuteClick,\n      verify: async() => this.chat.type === 'chat' && rootScope.myId !== this.peerId && !(await this.managers.appNotificationsManager.isPeerLocalMuted(this.peerId, false))\n    }, {\n      icon: 'unmute',\n      text: 'ChatList.Context.Unmute',\n      onClick: () => {\n        this.managers.appMessagesManager.togglePeerMute(this.peerId);\n      },\n      verify: async() => this.chat.type === 'chat' && rootScope.myId !== this.peerId && (await this.managers.appNotificationsManager.isPeerLocalMuted(this.peerId, false))\n    }, {\n      icon: 'comments',\n      text: 'ViewDiscussion',\n      onClick: () => {\n        const middleware = this.chat.bubbles.getMiddleware();\n        Promise.resolve(this.managers.appProfileManager.getChannelFull(this.peerId.toChatId())).then((channelFull) => {\n          if(middleware() && channelFull.linked_chat_id) {\n            this.chat.appImManager.setInnerPeer({\n              peerId: channelFull.linked_chat_id.toPeerId(true)\n            });\n          }\n        });\n      },\n      verify: async() => {\n        const chatFull = await this.managers.appProfileManager.getCachedFullChat(this.peerId.toChatId());\n        return this.chat.type === 'chat' && !!(chatFull as ChatFull.channelFull)?.linked_chat_id;\n      }\n    }, {\n      icon: 'phone',\n      text: 'Call',\n      onClick: this.onCallClick.bind(this, 'voice'),\n      verify: this.verifyCallButton.bind(this, 'voice')\n    }, {\n      icon: 'videocamera',\n      text: 'VideoCall',\n      onClick: this.onCallClick.bind(this, 'video'),\n      verify: this.verifyCallButton.bind(this, 'video')\n    }, {\n      icon: 'videochat',\n      text: 'PeerInfo.Action.LiveStream',\n      onClick: this.onJoinGroupCallClick,\n      verify: this.verifyVideoChatButton.bind(this, 'broadcast')\n    }, {\n      icon: 'videochat',\n      text: 'PeerInfo.Action.VoiceChat',\n      onClick: this.onJoinGroupCallClick,\n      verify: this.verifyVideoChatButton.bind(this, 'group')\n    }, {\n      icon: 'select',\n      text: 'Chat.Menu.SelectMessages',\n      onClick: () => {\n        const selection = this.chat.selection;\n        selection.toggleSelection(true, true);\n        apiManagerProxy.getState().then((state) => {\n          if(state.chatContextMenuHintWasShown) {\n            return;\n          }\n\n          const original = selection.toggleByElement.bind(selection);\n          selection.toggleByElement = async(bubble) => {\n            this.managers.appStateManager.pushToState('chatContextMenuHintWasShown', true);\n            toast(i18n('Chat.Menu.Hint'));\n\n            selection.toggleByElement = original;\n            selection.toggleByElement(bubble);\n          };\n        });\n      },\n      verify: () => !this.chat.selection.isSelecting && !!this.chat.bubbles.getRenderedLength()\n    }, {\n      icon: 'select',\n      text: 'Chat.Menu.ClearSelection',\n      onClick: () => {\n        this.chat.selection.cancelSelection();\n      },\n      verify: () => this.chat.selection.isSelecting\n    }, {\n      icon: 'adduser',\n      text: 'AddContact',\n      onClick: () => {\n        if(!this.appSidebarRight.isTabExists(AppEditContactTab)) {\n          const tab = this.appSidebarRight.createTab(AppEditContactTab);\n          tab.peerId = this.peerId;\n          tab.open();\n\n          this.appSidebarRight.toggleSidebar(true);\n        }\n      },\n      verify: async() => this.peerId.isUser() && !(await this.managers.appPeersManager.isContact(this.peerId))\n    }, {\n      icon: 'forward',\n      text: 'ShareContact',\n      onClick: () => {\n        const contactPeerId = this.peerId;\n        new PopupPickUser({\n          peerTypes: ['dialogs', 'contacts'],\n          onSelect: (peerId) => {\n            return new Promise((resolve, reject) => {\n              new PopupPeer('', {\n                titleLangKey: 'SendMessageTitle',\n                descriptionLangKey: 'SendContactToGroupText',\n                descriptionLangArgs: [new PeerTitle({peerId, dialog: true}).element],\n                buttons: [{\n                  langKey: 'Send',\n                  callback: () => {\n                    resolve();\n\n                    this.managers.appMessagesManager.sendContact(peerId, contactPeerId);\n                    this.chat.appImManager.setInnerPeer({peerId});\n                  }\n                }, {\n                  langKey: 'Cancel',\n                  callback: () => {\n                    reject();\n                  },\n                  isCancel: true\n                }],\n                peerId,\n                overlayClosable: true\n              }).show();\n            });\n          },\n          placeholder: 'ShareModal.Search.Placeholder',\n          chatRightsAction: 'send_messages',\n          selfPresence: 'ChatYourSelf'\n        });\n      },\n      verify: async() => rootScope.myId !== this.peerId && this.peerId.isUser() && (await this.managers.appPeersManager.isContact(this.peerId)) && !!(await this.managers.appUsersManager.getUser(this.peerId.toUserId())).phone\n    }, {\n      icon: 'lock',\n      text: 'BlockUser',\n      onClick: () => {\n        new PopupPeer('', {\n          peerId: this.peerId,\n          titleLangKey: 'BlockUser',\n          descriptionLangKey: 'AreYouSureBlockContact2',\n          descriptionLangArgs: [new PeerTitle({peerId: this.peerId}).element],\n          buttons: [{\n            langKey: 'BlockUser',\n            isDanger: true,\n            callback: () => {\n              this.managers.appUsersManager.toggleBlock(this.peerId, true).then((value) => {\n                if(value) {\n                  toastNew({langPackKey: 'UserBlocked'});\n                }\n              });\n            }\n          }]\n        }).show();\n      },\n      verify: async() => {\n        if(!this.peerId.isUser()) return false;\n        const userFull = await this.managers.appProfileManager.getCachedFullUser(this.peerId.toUserId());\n        return this.peerId !== rootScope.myId && userFull && !userFull.pFlags?.blocked;\n      }\n    }, {\n      icon: 'lockoff',\n      text: 'Unblock',\n      onClick: () => {\n        this.managers.appUsersManager.toggleBlock(this.peerId, false).then((value) => {\n          if(value) {\n            toastNew({langPackKey: 'UserUnblocked'});\n          }\n        });\n      },\n      verify: async() => {\n        const userFull = await this.managers.appProfileManager.getCachedFullUser(this.peerId.toUserId());\n        return !!userFull?.pFlags?.blocked;\n      }\n    }, {\n      icon: 'delete danger',\n      text: 'Delete',\n      onClick: () => {\n        new PopupDeleteDialog(this.peerId/* , 'leave' */);\n      },\n      verify: async() => this.chat.type === 'chat' && !!(await this.managers.appMessagesManager.getDialogOnly(this.peerId))\n    }];\n\n    this.btnSearch = ButtonIcon('search');\n    this.attachClickEvent(this.btnSearch, (e) => {\n      this.chat.initSearch();\n    }, true);\n  }\n\n  public attachClickEvent(el: HTMLElement, cb: (e: MouseEvent) => void, noBlur?: boolean) {\n    attachClickEvent(el, (e) => {\n      cancelEvent(e);\n      !noBlur && blurActiveElement();\n      cb(e);\n    }, {listenerSetter: this.listenerSetter});\n  }\n\n  private onCallClick(type: CallType) {\n    this.chat.appImManager.callUser(this.peerId.toUserId(), type);\n  }\n\n  private onJoinGroupCallClick = () => {\n    this.chat.appImManager.joinGroupCall(this.peerId);\n  };\n\n  private constructAvatar() {\n    const avatarElement = new AvatarElement();\n    avatarElement.isDialog = true;\n    avatarElement.classList.add('avatar-42', 'person-avatar');\n    return avatarElement;\n  }\n\n  private get peerId() {\n    return this.chat.peerId;\n  }\n\n  public constructPeerHelpers() {\n    this.avatarElement = this.constructAvatar();\n\n    this.subtitle = document.createElement('div');\n    this.subtitle.classList.add('info');\n\n    this.pinnedMessage = new ChatPinnedMessage(this, this.chat, this.managers);\n\n    this.btnJoin = Button('btn-primary btn-color-primary chat-join hide');\n    this.btnCall = ButtonIcon('phone');\n    this.btnGroupCall = ButtonIcon('videochat');\n    this.btnPinned = ButtonIcon('pinlist');\n    this.btnMute = ButtonIcon('mute');\n\n    this.attachClickEvent(this.btnCall, this.onCallClick.bind(this, 'voice'));\n    this.attachClickEvent(this.btnGroupCall, this.onJoinGroupCallClick);\n\n    this.attachClickEvent(this.btnPinned, () => {\n      this.openPinned(true);\n    });\n\n    this.attachClickEvent(this.btnMute, this.onMuteClick);\n\n    this.attachClickEvent(this.btnJoin, async() => {\n      const middleware = this.chat.bubbles.getMiddleware();\n      this.btnJoin.setAttribute('disabled', 'true');\n\n      const chatId = this.peerId.toChatId();\n      let promise: Promise<any>;\n      if(await this.managers.appChatsManager.isChannel(chatId)) {\n        promise = this.managers.appChatsManager.joinChannel(chatId);\n      } else {\n        promise = this.managers.appChatsManager.addChatUser(chatId, rootScope.myId);\n      }\n\n      promise.finally(() => {\n        if(!middleware()) {\n          return;\n        }\n\n        this.btnJoin.removeAttribute('disabled');\n      });\n    });\n\n    this.listenerSetter.add(rootScope)('chat_update', async(chatId) => {\n      if(this.peerId === chatId.toPeerId(true)) {\n        const chat = await this.managers.appChatsManager.getChat(chatId) as Channel/*  | Chat */;\n\n        this.btnJoin.classList.toggle('hide', !(chat as Channel)?.pFlags?.left);\n        this.setUtilsWidth();\n        this.verifyButtons();\n      }\n    });\n\n    this.listenerSetter.add(rootScope)('dialog_notify_settings', (dialog) => {\n      if(dialog.peerId === this.peerId) {\n        this.setMutedState();\n      }\n    });\n\n    this.listenerSetter.add(rootScope)('peer_typings', ({peerId}) => {\n      if(this.peerId === peerId) {\n        this.setPeerStatus();\n      }\n    });\n\n    this.listenerSetter.add(rootScope)('user_update', (userId) => {\n      if(this.peerId === userId.toPeerId()) {\n        this.setPeerStatus();\n      }\n    });\n\n    this.listenerSetter.add(rootScope)('peer_full_update', (peerId) => {\n      if(this.peerId === peerId) {\n        this.verifyButtons();\n      }\n    });\n\n    if(this.pinnedMessage) {\n      this.chat.addEventListener('setPeer', (mid, isTopMessage) => {\n        const middleware = this.chat.bubbles.getMiddleware();\n        apiManagerProxy.getState().then((state) => {\n          if(!middleware()) return;\n\n          this.pinnedMessage.hidden = !!state.hiddenPinnedMessages[this.chat.peerId];\n\n          if(isTopMessage) {\n            this.pinnedMessage.unsetScrollDownListener();\n            this.pinnedMessage.testMid(mid, 0); // * because slider will not let get bubble by document.elementFromPoint\n          } else if(!this.pinnedMessage.locked) {\n            this.pinnedMessage.handleFollowingPinnedMessage();\n            this.pinnedMessage.testMid(mid);\n          }\n        });\n      });\n    }\n\n    this.setPeerStatusInterval = window.setInterval(this.setPeerStatus, 60e3);\n\n    return this;\n  }\n\n  public constructPinnedHelpers() {\n    this.listenerSetter.add(rootScope)('peer_pinned_messages', ({peerId, mids}) => {\n      if(peerId !== this.peerId) return;\n\n      if(mids) {\n        this.setTitle();\n      }\n    });\n  }\n\n  public constructDiscussionHelpers() {\n    this.pinnedMessage = new ChatPinnedMessage(this, this.chat, this.managers);\n  }\n\n  public openPinned(byCurrent: boolean) {\n    this.chat.appImManager.setInnerPeer({\n      peerId: this.peerId,\n      lastMsgId: byCurrent ? +this.pinnedMessage.pinnedMessageContainer.divAndCaption.container.dataset.mid : 0,\n      type: 'pinned'\n    });\n  }\n\n  private onMuteClick = () => {\n    new PopupMute(this.peerId);\n  };\n\n  private onResize = () => {\n    this.setUtilsWidth(true);\n    this.setFloating();\n  };\n\n  private onChangeScreen = (from: ScreenSize, to: ScreenSize) => {\n    this.container.classList.toggle('is-pinned-floating', mediaSizes.isMobile);\n    // this.chatAudio && this.chatAudio.divAndCaption.container.classList.toggle('is-floating', to === ScreenSize.mobile);\n    this.pinnedMessage && this.pinnedMessage.pinnedMessageContainer.divAndCaption.container.classList.toggle('is-floating', to === ScreenSize.mobile);\n    this.onResize();\n  };\n\n  public destroy() {\n    // this.chat.log.error('Topbar destroying');\n    this.listenerSetter.removeAll();\n    window.clearInterval(this.setPeerStatusInterval);\n\n    if(this.pinnedMessage) {\n      this.pinnedMessage.destroy(); // *     \n    }\n\n    if(this.chatAudio) {\n      this.chatAudio.destroy();\n    }\n\n    delete this.chatAudio;\n    delete this.pinnedMessage;\n  }\n\n  public cleanup() {\n    if(!this.chat.peerId) {\n      this.container.classList.add('hide');\n    }\n  }\n\n  public async finishPeerChange(isTarget: boolean) {\n    const peerId = this.peerId;\n\n    let newAvatar: AvatarElement;\n    if(this.avatarElement) {\n      newAvatar = this.constructAvatar();\n    }\n\n    const [isBroadcast, isAnyChat, chat, _, setTitleCallback, setStatusCallback, state] = await Promise.all([\n      this.managers.appPeersManager.isBroadcast(peerId),\n      this.managers.appPeersManager.isAnyChat(peerId),\n      peerId.isAnyChat() ? this.managers.appChatsManager.getChat(peerId.toChatId()) : undefined,\n      newAvatar ? newAvatar.updateWithOptions({peerId}) : undefined,\n      this.setTitleManual(),\n      this.setPeerStatusManual(true),\n      apiManagerProxy.getState()\n    ]);\n\n    return () => {\n      this.btnMute && this.btnMute.classList.toggle('hide', !isBroadcast);\n      if(this.btnJoin) {\n        if(isAnyChat) {\n          replaceContent(this.btnJoin, i18n(isBroadcast ? 'Chat.Subscribe' : 'ChannelJoin'));\n          this.btnJoin.classList.toggle('hide', !chat?.pFlags?.left);\n        } else {\n          this.btnJoin.classList.add('hide');\n        }\n      }\n\n      if(newAvatar) {\n        this.avatarElement.replaceWith(newAvatar);\n        this.avatarElement = newAvatar;\n      }\n\n      this.setUtilsWidth();\n\n      this.verifyButtons();\n\n      if(this.pinnedMessage) { // * replace with new one\n        if(this.chat.type === 'chat') {\n          if(this.chat.wasAlreadyUsed) { // * change\n            const newPinnedMessage = new ChatPinnedMessage(this, this.chat, this.managers);\n            this.pinnedMessage.pinnedMessageContainer.divAndCaption.container.replaceWith(newPinnedMessage.pinnedMessageContainer.divAndCaption.container);\n            this.pinnedMessage.destroy();\n            // this.pinnedMessage.pinnedMessageContainer.toggle(true);\n            this.pinnedMessage = newPinnedMessage;\n          }\n\n          this.pinnedMessage.hidden = !!state.hiddenPinnedMessages[peerId];\n        } else if(this.chat.type === 'discussion') {\n          this.pinnedMessage.pinnedMid = this.chat.threadId;\n          this.pinnedMessage.count = 1;\n          this.pinnedMessage.pinnedIndex = 0;\n          this.pinnedMessage._setPinnedMessage();\n        }\n      }\n\n      setTitleCallback();\n      setStatusCallback && setStatusCallback();\n      this.setMutedState();\n\n      this.container.classList.remove('hide');\n    };\n  }\n\n  public async setTitleManual(count?: number) {\n    const peerId = this.peerId;\n    const middleware = () => this.peerId === peerId;\n    let titleEl: HTMLElement, icons: Element[];\n    if(this.chat.type === 'pinned') {\n      if(count === undefined) titleEl = i18n('Loading');\n      else titleEl = i18n('PinnedMessagesCount', [count]);\n\n      if(count === undefined) {\n        this.managers.appMessagesManager.getSearchCounters(peerId, [{_: 'inputMessagesFilterPinned'}], false).then((result) => {\n          if(!middleware()) return;\n          const count = result[0].count;\n          this.setTitle(count);\n\n          // !  2,      \n          if(!count) {\n            this.chat.appImManager.setPeer(); // * close tab\n\n            // ! ,     ,  ,      \n            const originalChat = this.chat.appImManager.chat;\n            if(originalChat.topbar.pinnedMessage) {\n              originalChat.topbar.pinnedMessage.pinnedMessageContainer.toggle(true);\n            }\n          }\n        });\n      }\n    } else if(this.chat.type === 'scheduled') {\n      titleEl = i18n(peerId === rootScope.myId ? 'Reminders' : 'ScheduledMessages');\n    } else if(this.chat.type === 'discussion') {\n      if(count === undefined) {\n        const result = await this.managers.acknowledged.appMessagesManager.getHistory(peerId, 0, 1, 0, this.chat.threadId);\n        if(result.cached) {\n          const historyResult = await result.result;\n          count = historyResult.count;\n        } else result.result.then((historyResult) => this.setTitle(historyResult.count));\n      }\n\n      if(count === undefined) titleEl = i18n('Loading');\n      else titleEl = i18n('Chat.Title.Comments', [count]);\n    } else if(this.chat.type === 'chat') {\n      [titleEl/* , icons */] = await Promise.all([\n        wrapPeerTitle({\n          peerId,\n          dialog: true,\n          withIcons: true\n        })\n        // generateTitleIcons(peerId)\n      ]);\n\n      if(!middleware()) {\n        return;\n      }\n    }\n\n    return () => {\n      replaceContent(this.title, titleEl);\n      // if(icons) {\n      //   this.title.append(...icons);\n      // }\n    };\n  }\n\n  public setTitle(count?: number) {\n    this.setTitleManual(count).then((setTitleCallback) => setTitleCallback());\n  }\n\n  public async setMutedState() {\n    if(!this.btnMute) return;\n\n    const peerId = this.peerId;\n    const muted = await this.managers.appNotificationsManager.isPeerLocalMuted(peerId, false);\n    if(await this.managers.appPeersManager.isBroadcast(peerId)) { // not human\n      this.btnMute.classList.remove('tgico-mute', 'tgico-unmute');\n      this.btnMute.classList.add(muted ? 'tgico-unmute' : 'tgico-mute');\n      this.btnMute.style.display = '';\n    } else {\n      this.btnMute.style.display = 'none';\n    }\n  }\n\n  // !    ,    -    ,          ,    !\n  public setUtilsWidth = (resize = false) => {\n    // return;\n    if(this.setUtilsRAF) window.cancelAnimationFrame(this.setUtilsRAF);\n\n    if(IS_SAFARI && resize) {\n      this.chatUtils.classList.add('hide');\n    }\n\n    // mutationObserver.disconnect();\n    this.setUtilsRAF = window.requestAnimationFrame(() => {\n      // mutationRAF = window.requestAnimationFrame(() => {\n\n      // setTimeout(() => {\n      if(IS_SAFARI && resize) {\n        this.chatUtils.classList.remove('hide');\n      }\n      /* this.chatInfo.style.removeProperty('--utils-width');\n          void this.chatInfo.offsetLeft; // reflow */\n      const width = /* chatUtils.scrollWidth */this.chatUtils.getBoundingClientRect().width;\n      this.chat.log('utils width:', width);\n      this.container.style.setProperty('--utils-width', width + 'px');\n      // this.chatInfo.classList.toggle('have-utils-width', !!width);\n      // }, 0);\n\n      this.setUtilsRAF = 0;\n\n      // mutationObserver.observe(chatUtils, observeOptions);\n      // });\n    });\n  };\n\n  public setFloating = () => {\n    const containers = [this.chatAudio, this.pinnedMessage && this.pinnedMessage.pinnedMessageContainer].filter(Boolean);\n    const count = containers.reduce((acc, container) => {\n      const isFloating = container.isFloating();\n      this.container.classList.toggle(`is-pinned-${container.className}-floating`, isFloating);\n\n      if(!container.isVisible()) {\n        return acc;\n      }\n\n      return acc + +isFloating;\n    }, 0);\n    this.container.dataset.floating = '' + count;\n  };\n\n  public setPeerStatusManual = async(needClear = false) => {\n    if(!this.subtitle) return;\n\n    const peerId = this.peerId;\n    return this.chat.appImManager.setPeerStatus(\n      peerId,\n      this.subtitle,\n      needClear,\n      false,\n      () => peerId === this.peerId\n    );\n  };\n\n  public setPeerStatus = (needClear?: boolean) => {\n    return this.setPeerStatusManual(needClear).then((callback) => {\n      if(callback) {\n        callback();\n      }\n    });\n  };\n}\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport appSidebarRight from '..';\r\nimport {attachClickEvent} from '../../../helpers/dom/clickEvent';\r\nimport AppSearch, {SearchGroup} from '../../appSearch';\r\nimport ButtonIcon from '../../buttonIcon';\r\nimport InputSearch from '../../inputSearch';\r\nimport PopupElement from '../../popups';\r\nimport PopupDatePicker from '../../popups/datePicker';\r\nimport {SliderSuperTab} from '../../slider';\r\n\r\nexport default class AppPrivateSearchTab extends SliderSuperTab {\r\n  private inputSearch: InputSearch;\r\n  private appSearch: AppSearch;\r\n  private btnPickDate: HTMLElement;\r\n\r\n  private peerId: PeerId;\r\n  private threadId = 0;\r\n  private query = '';\r\n  private onDatePick: (timestamp: number) => void;\r\n\r\n  onOpenAfterTimeout() {\r\n    this.appSearch.beginSearch(this.peerId, this.threadId, this.query);\r\n  }\r\n\r\n  protected init() {\r\n    this.container.id = 'search-private-container';\r\n    this.container.classList.add('chatlist-container');\r\n    this.inputSearch = new InputSearch('Search');\r\n    this.title.replaceWith(this.inputSearch.container);\r\n\r\n    this.btnPickDate = ButtonIcon('calendar sidebar-header-right');\r\n    this.header.append(this.btnPickDate);\r\n\r\n    const c = document.createElement('div');\r\n    c.classList.add('chatlist-container');\r\n    this.scrollable.container.replaceWith(c);\r\n    this.appSearch = new AppSearch(c, this.inputSearch, {\r\n      messages: new SearchGroup('Chat.Search.PrivateSearch', 'messages')\r\n    });\r\n  }\r\n\r\n  open(peerId: PeerId, threadId?: number, onDatePick?: AppPrivateSearchTab['onDatePick'], query?: string) {\r\n    const ret = super.open();\r\n\r\n    if(!this.peerId) {\r\n      this.query = query;\r\n      this.peerId = peerId;\r\n      this.threadId = threadId;\r\n      this.onDatePick = onDatePick;\r\n\r\n      this.btnPickDate.classList.toggle('hide', !this.onDatePick);\r\n      if(this.onDatePick) {\r\n        attachClickEvent(this.btnPickDate, () => {\r\n          PopupElement.createPopup(PopupDatePicker, new Date(), this.onDatePick).show();\r\n        });\r\n      }\r\n\r\n      query && this.appSearch.searchInput.inputField.setValueSilently(query);\r\n\r\n      appSidebarRight.toggleSidebar(true);\r\n    } else {\r\n      this.appSearch.beginSearch(this.peerId, this.threadId, query);\r\n    }\r\n\r\n    return ret;\r\n  }\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport type ChatTopbar from './topbar';\r\nimport AppSearch, {SearchGroup} from '../appSearch';\r\nimport PopupDatePicker from '../popups/datePicker';\r\nimport ripple from '../ripple';\r\nimport InputSearch from '../inputSearch';\r\nimport type Chat from './chat';\r\nimport findUpTag from '../../helpers/dom/findUpTag';\r\nimport cancelEvent from '../../helpers/dom/cancelEvent';\r\nimport whichChild from '../../helpers/dom/whichChild';\r\nimport replaceContent from '../../helpers/dom/replaceContent';\r\nimport {i18n} from '../../lib/langPack';\r\nimport ListenerSetter from '../../helpers/listenerSetter';\r\nimport {attachClickEvent} from '../../helpers/dom/clickEvent';\r\nimport appNavigationController, {NavigationItem} from '../appNavigationController';\r\nimport {IS_MOBILE_SAFARI} from '../../environment/userAgent';\r\nimport PopupElement from '../popups';\r\nimport {DIALOG_LIST_ELEMENT_TAG} from '../../lib/appManagers/appDialogsManager';\r\n\r\nexport default class ChatSearch {\r\n  private element: HTMLElement;\r\n  private backBtn: HTMLElement;\r\n  private inputSearch: InputSearch;\r\n\r\n  private results: HTMLElement;\r\n\r\n  private footer: HTMLElement;\r\n  private dateBtn: HTMLElement;\r\n  private foundCountEl: HTMLElement;\r\n  private controls: HTMLElement;\r\n  private downBtn: HTMLElement;\r\n  private upBtn: HTMLElement;\r\n\r\n  private appSearch: AppSearch;\r\n  private searchGroup: SearchGroup;\r\n\r\n  private foundCount = 0;\r\n  private selectedIndex = 0;\r\n  private setPeerPromise: Promise<any>;\r\n  private listenerSetter: ListenerSetter;\r\n  private navigationItem: NavigationItem;\r\n\r\n  constructor(private topbar: ChatTopbar, private chat: Chat, query?: string) {\r\n    this.element = document.createElement('div');\r\n    this.element.classList.add('sidebar-header', 'chat-search', 'chatlist-container');\r\n\r\n    this.backBtn = document.createElement('button');\r\n    this.backBtn.classList.add('btn-icon', 'tgico-left', 'sidebar-close-button');\r\n    ripple(this.backBtn);\r\n\r\n    const listenerSetter = this.listenerSetter = new ListenerSetter();\r\n\r\n    const attachClick = (element: HTMLElement, callback: (e: MouseEvent) => void) => {\r\n      attachClickEvent(element, callback, {listenerSetter});\r\n    };\r\n\r\n    attachClick(this.backBtn, () => {\r\n      this.destroy();\r\n    });\r\n\r\n    this.inputSearch = new InputSearch('Search');\r\n\r\n    // Results\r\n    this.results = document.createElement('div');\r\n    this.results.classList.add('chat-search-results', 'chatlist-container');\r\n\r\n    this.searchGroup = new SearchGroup(false, 'messages', undefined, '', false);\r\n    attachClick(this.searchGroup.list, this.onResultsClick);\r\n\r\n    this.appSearch = new AppSearch(this.results, this.inputSearch, {\r\n      messages: this.searchGroup\r\n    }, (count) => {\r\n      this.foundCount = count;\r\n\r\n      if(!this.foundCount) {\r\n        replaceContent(this.foundCountEl, this.inputSearch.value ? i18n('NoResult') : '');\r\n        this.results.classList.remove('active');\r\n        this.chat.bubbles.container.classList.remove('search-results-active');\r\n        this.upBtn.setAttribute('disabled', 'true');\r\n        this.downBtn.setAttribute('disabled', 'true');\r\n      } else {\r\n        this.selectResult(this.searchGroup.list.children[0] as HTMLElement);\r\n      }\r\n    });\r\n    this.appSearch.beginSearch(this.chat.peerId, this.chat.threadId);\r\n\r\n    // appImManager.topbar.parentElement.insertBefore(this.results, appImManager.bubblesContainer);\r\n    this.chat.bubbles.container.append(this.results);\r\n\r\n    // Footer\r\n    this.footer = document.createElement('div');\r\n    this.footer.classList.add('chat-search-footer');\r\n\r\n    attachClick(this.footer, this.onFooterClick);\r\n    ripple(this.footer);\r\n\r\n    this.foundCountEl = document.createElement('span');\r\n    this.foundCountEl.classList.add('chat-search-count');\r\n\r\n    this.dateBtn = document.createElement('button');\r\n    this.dateBtn.classList.add('btn-icon', 'tgico-calendar');\r\n\r\n    this.controls = document.createElement('div');\r\n    this.controls.classList.add('chat-search-controls');\r\n\r\n    this.upBtn = document.createElement('button');\r\n    this.upBtn.classList.add('btn-icon', 'tgico-up');\r\n    this.downBtn = document.createElement('button');\r\n    this.downBtn.classList.add('btn-icon', 'tgico-down');\r\n\r\n    this.upBtn.setAttribute('disabled', 'true');\r\n    this.downBtn.setAttribute('disabled', 'true');\r\n\r\n    attachClick(this.dateBtn, this.onDateClick);\r\n    attachClick(this.upBtn, this.onUpClick);\r\n    attachClick(this.downBtn, this.onDownClick);\r\n    this.controls.append(this.upBtn, this.downBtn);\r\n\r\n    this.footer.append(this.foundCountEl, this.dateBtn, this.controls);\r\n\r\n    this.topbar.container.parentElement.insertBefore(this.footer, chat.input.chatInput);\r\n\r\n    // Append container\r\n    this.element.append(this.backBtn, this.inputSearch.container);\r\n\r\n    this.topbar.container.classList.add('hide-pinned');\r\n    this.topbar.container.parentElement.append(this.element);\r\n\r\n    this.inputSearch.input.focus();\r\n\r\n    if(query) {\r\n      this.setQuery(query);\r\n    }\r\n\r\n    if(!IS_MOBILE_SAFARI) {\r\n      this.navigationItem = {\r\n        type: 'mobile-search',\r\n        onPop: () => {\r\n          this.destroy();\r\n        }\r\n      };\r\n\r\n      appNavigationController.pushItem(this.navigationItem);\r\n    }\r\n  }\r\n\r\n  public destroy() {\r\n    this.topbar.container.classList.remove('hide-pinned');\r\n    this.element.remove();\r\n    this.inputSearch.remove();\r\n    this.results.remove();\r\n    this.footer.remove();\r\n    this.listenerSetter.removeAll();\r\n    this.chat.bubbles.container.classList.remove('search-results-active');\r\n    this.chat.search = undefined;\r\n    appNavigationController.removeItem(this.navigationItem);\r\n  }\r\n\r\n  public setQuery(query: string) {\r\n    this.inputSearch.inputField.value = query;\r\n  }\r\n\r\n  private onDateClick = (e: MouseEvent) => {\r\n    cancelEvent(e);\r\n    PopupElement.createPopup(PopupDatePicker, new Date(), this.chat.bubbles.onDatePick).show();\r\n  };\r\n\r\n  private selectResult(elem: HTMLElement) {\r\n    if(this.setPeerPromise) return this.setPeerPromise;\r\n\r\n    const peerId = elem.dataset.peerId.toPeerId();\r\n    const lastMsgId = +elem.dataset.mid || undefined;\r\n\r\n    const index = whichChild(elem);\r\n\r\n    if(index === (this.foundCount - 1)) {\r\n      this.upBtn.setAttribute('disabled', 'true');\r\n    } else {\r\n      this.upBtn.removeAttribute('disabled');\r\n    }\r\n\r\n    if(!index) {\r\n      this.downBtn.setAttribute('disabled', 'true');\r\n    } else {\r\n      this.downBtn.removeAttribute('disabled');\r\n    }\r\n\r\n    this.results.classList.remove('active');\r\n    this.chat.bubbles.container.classList.remove('search-results-active');\r\n\r\n    const res = this.chat.setPeer(peerId, lastMsgId);\r\n    this.setPeerPromise = ((res instanceof Promise ? res : Promise.resolve(res)) as Promise<any>).then(() => {\r\n      this.selectedIndex = index;\r\n      replaceContent(this.foundCountEl, i18n('Of', [index + 1, this.foundCount]));\r\n\r\n      const renderedCount = this.searchGroup.list.childElementCount;\r\n      if(this.selectedIndex >= (renderedCount - 6)) {\r\n        this.appSearch.searchMore();\r\n      }\r\n    }).finally(() => {\r\n      this.setPeerPromise = null;\r\n    });\r\n  }\r\n\r\n  private onResultsClick = (e: MouseEvent) => {\r\n    const target = findUpTag(e.target, DIALOG_LIST_ELEMENT_TAG);\r\n    if(target) {\r\n      this.selectResult(target);\r\n    }\r\n  };\r\n\r\n  private onFooterClick = (e: MouseEvent) => {\r\n    if(this.foundCount) {\r\n      this.chat.bubbles.container.classList.toggle('search-results-active');\r\n      this.results.classList.toggle('active');\r\n    }\r\n  };\r\n\r\n  private onUpClick = (e: MouseEvent) => {\r\n    cancelEvent(e);\r\n    this.selectResult(this.searchGroup.list.children[this.selectedIndex + 1] as HTMLElement);\r\n  };\r\n\r\n  private onDownClick = (e: MouseEvent) => {\r\n    cancelEvent(e);\r\n    this.selectResult(this.searchGroup.list.children[this.selectedIndex - 1] as HTMLElement);\r\n  };\r\n}\r\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport indexOfAndSplice from '../../helpers/array/indexOfAndSplice';\nimport deepEqual from '../../helpers/object/deepEqual';\nimport {renderImageFromUrlPromise} from '../../helpers/dom/renderImageFromUrl';\nimport mediaSizes, {ScreenSize} from '../../helpers/mediaSizes';\n\ntype ChatBackgroundPatternRendererInitOptions = {\n  url: string,\n  width: number,\n  height: number,\n  mask?: boolean\n};\n\nexport default class ChatBackgroundPatternRenderer {\n  private static INSTANCES: ChatBackgroundPatternRenderer[] = [];\n\n  // private pattern: CanvasPattern;\n  private objectUrl: string;\n  private options: ChatBackgroundPatternRendererInitOptions;\n  private canvases: Set<HTMLCanvasElement>;\n  // private createCanvasPatternPromise: Promise<CanvasPattern>;\n  // private exportCanvasPatternToImagePromise: Promise<string>;\n  private renderImageFromUrlPromise: Promise<HTMLImageElement>;\n  private img: HTMLImageElement;\n\n  constructor() {\n    this.canvases = new Set();\n  }\n\n  public static getInstance(options: ChatBackgroundPatternRendererInitOptions) {\n    let instance = this.INSTANCES.find((instance) => {\n      return deepEqual(instance.options, options);\n    });\n\n    if(!instance) {\n      instance = new ChatBackgroundPatternRenderer();\n      instance.init(options);\n      this.INSTANCES.push(instance);\n    }\n\n    return instance;\n  }\n\n  public init(options: ChatBackgroundPatternRendererInitOptions) {\n    // if(this.options) {\n    //   if(this.options.width !== options.width || this.options.height !== options.height) {\n    //     this.createCanvasPatternPromise =\n    //       this.pattern =\n    //       this.exportCanvasPatternToImagePromise =\n    //       undefined;\n    //   }\n    // }\n\n    this.options = options;\n  }\n\n  public renderToCanvas(canvas: HTMLCanvasElement) {\n    // return this.createCanvasPattern(canvas).then(() => {\n    // return this.fillCanvas(canvas);\n    // });\n\n    return this.renderImageFromUrl(this.options.url).then(() => {\n      return this.fillCanvas(canvas);\n    });\n  }\n\n  private renderImageFromUrl(url: string) {\n    if(this.renderImageFromUrlPromise) return this.renderImageFromUrlPromise;\n    const img = this.img = document.createElement('img');\n    img.crossOrigin = 'anonymous';\n    return this.renderImageFromUrlPromise = renderImageFromUrlPromise(img, url, false).then(() => img);\n  }\n\n  /* private createCanvasPattern(canvas: HTMLCanvasElement) {\n    if(this.createCanvasPatternPromise) return this.createCanvasPatternPromise;\n    return this.createCanvasPatternPromise = this.renderImageFromUrl(this.options.url).then((img) => {\n      let createPatternFrom: HTMLImageElement | HTMLCanvasElement;\n      if(IS_SAFARI) {\n        const canvas = createPatternFrom = document.createElement('canvas');\n        canvas.width = img.naturalWidth;\n        canvas.height = img.naturalHeight;\n        const ctx = canvas.getContext('2d');\n        ctx.drawImage(img, 0, 0, canvas.width, canvas.height);\n      } else {\n        createPatternFrom = img;\n      }\n\n      const perf = performance.now();\n      this.pattern = canvas.getContext('2d').createPattern(createPatternFrom, 'repeat-x');\n      console.warn('creating pattern time:', performance.now() - perf);\n\n      return this.pattern;\n    });\n  }\n\n  public exportCanvasPatternToImage(canvas: HTMLCanvasElement) {\n    if(this.exportCanvasPatternToImagePromise) return this.exportCanvasPatternToImagePromise;\n    return this.exportCanvasPatternToImagePromise = new Promise<string>((resolve) => {\n      canvas.toBlob((blob) => {\n        const newUrl = this.objectUrl = URL.createObjectURL(blob);\n        resolve(newUrl);\n      }, 'image/png');\n    });\n  } */\n\n  public cleanup(canvas: HTMLCanvasElement) {\n    this.canvases.delete(canvas);\n\n    if(!this.canvases.size) {\n      indexOfAndSplice(ChatBackgroundPatternRenderer.INSTANCES, this);\n\n      if(this.objectUrl) {\n        URL.revokeObjectURL(this.objectUrl);\n      }\n    }\n  }\n\n  public fillCanvas(canvas: HTMLCanvasElement) {\n    const context = canvas.getContext('2d');\n    const {width, height} = canvas;\n    // const perf = performance.now();\n    // if(context.fillStyle instanceof CanvasPattern) {\n    //   context.clearRect(0, 0, width, height);\n    // }\n\n    const img = this.img;\n\n    let imageWidth = img.width, imageHeight = img.height;\n    // if(imageHeight < height) {\n    let patternHeight = 1480 * canvas.dpr;\n    // * correct\n    // if(+canvas.dataset.originalHeight !== height) hhh *= 2 / 3;\n    // * but have to make it good\n    if(+canvas.dataset.originalHeight !== height) patternHeight *= .875;\n    const ratio = patternHeight / imageHeight;\n    imageWidth *= ratio;\n    imageHeight = patternHeight;\n    // }\n\n    if(this.options.mask) {\n      context.fillStyle = '#000';\n      context.fillRect(0, 0, width, height);\n      context.globalCompositeOperation = 'destination-out';\n    } else {\n      context.globalCompositeOperation = 'source-over';\n    }\n\n    const d = (y: number) => {\n      for(let x = 0; x < width; x += imageWidth) {\n        context.drawImage(img, x, y, imageWidth, imageHeight);\n      }\n    };\n\n    const centerY = height / 2 - imageHeight / 2;\n    d(centerY);\n\n    if(centerY > 0) {\n      let topY = centerY;\n      do {\n        d(topY -= imageHeight);\n      } while(topY >= 0);\n    }\n\n    const endY = height - 1;\n    for(let bottomY = centerY + imageHeight; bottomY < endY; bottomY += imageHeight) {\n      d(bottomY);\n    }\n\n    // for(let x = 0; x < width; x += imageWidth) {\n    //   for(let y = 0; y < height; y += imageHeight) {\n    //     context.drawImage(img, x, y, imageWidth, imageHeight);\n    //   }\n    // }\n    // context.fillStyle = this.pattern;\n    // context.fillRect(0, 0, width, height);\n    // console.warn('fill canvas time', performance.now() - perf);\n  }\n\n  public setCanvasDimensions(canvas: HTMLCanvasElement) {\n    const devicePixelRatio = Math.min(2, window.devicePixelRatio);\n    const width = this.options.width * devicePixelRatio;\n    let height = this.options.height * devicePixelRatio;\n\n    canvas.dpr = devicePixelRatio;\n    canvas.dataset.originalHeight = '' + height;\n    if(mediaSizes.activeScreen === ScreenSize.large) height *= 1.5;\n    canvas.width = width;\n    canvas.height = height;\n  }\n\n  public createCanvas() {\n    const canvas = document.createElement('canvas');\n    this.canvases.add(canvas);\n    this.setCanvasDimensions(canvas);\n    return canvas;\n  }\n\n  public resize(width: number, height: number) {\n    this.init({\n      ...this.options,\n      width,\n      height\n    });\n\n    const promises: Promise<any>[] = [];\n    for(const canvas of this.canvases) {\n      this.setCanvasDimensions(canvas);\n      promises.push(this.renderToCanvas(canvas));\n    }\n\n    return Promise.all(promises);\n  }\n\n  public static resizeInstances(width: number, height: number) {\n    return Promise.all(this.INSTANCES.map((instance) => instance.resize(width, height)));\n  }\n\n  /* public setResizeMode(resizing: boolean) {\n    const canvases = Array.from(this.canvases);\n    const canvas = canvases[canvases.length - 1];\n    canvas.style.display = resizing ? 'none' : '';\n    const img = this.img;\n    img.style.display = resizing ? '' : 'none';\n\n    return {img, canvas};\n  } */\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport type {ChatRights} from '../../lib/appManagers/appChatsManager';\nimport type {AppImManager} from '../../lib/appManagers/appImManager';\nimport type {MessagesStorageKey} from '../../lib/appManagers/appMessagesManager';\nimport EventListenerBase from '../../helpers/eventListenerBase';\nimport {logger, LogTypes} from '../../lib/logger';\nimport rootScope from '../../lib/rootScope';\nimport appSidebarRight from '../sidebarRight';\nimport ChatBubbles from './bubbles';\nimport ChatContextMenu from './contextMenu';\nimport ChatInput from './input';\nimport ChatSelection from './selection';\nimport ChatTopbar from './topbar';\nimport {NULL_PEER_ID, REPLIES_PEER_ID} from '../../lib/mtproto/mtproto_config';\nimport SetTransition from '../singleTransition';\nimport AppPrivateSearchTab from '../sidebarRight/tabs/search';\nimport renderImageFromUrl from '../../helpers/dom/renderImageFromUrl';\nimport mediaSizes from '../../helpers/mediaSizes';\nimport ChatSearch from './search';\nimport IS_TOUCH_SUPPORTED from '../../environment/touchSupport';\nimport getAutoDownloadSettingsByPeerId, {ChatAutoDownloadSettings} from '../../helpers/autoDownload';\nimport ChatBackgroundGradientRenderer from './gradientRenderer';\nimport ChatBackgroundPatternRenderer from './patternRenderer';\nimport pause from '../../helpers/schedulers/pause';\nimport {AppManagers} from '../../lib/appManagers/managers';\nimport SlicedArray from '../../helpers/slicedArray';\nimport themeController from '../../helpers/themeController';\nimport AppSharedMediaTab from '../sidebarRight/tabs/sharedMedia';\nimport noop from '../../helpers/noop';\nimport middlewarePromise from '../../helpers/middlewarePromise';\nimport indexOfAndSplice from '../../helpers/array/indexOfAndSplice';\nimport {Message} from '../../layer';\n\nexport type ChatType = 'chat' | 'pinned' | 'replies' | 'discussion' | 'scheduled';\n\nexport default class Chat extends EventListenerBase<{\n  setPeer: (mid: number, isTopMessage: boolean) => void\n}> {\n  public container: HTMLElement;\n  public backgroundEl: HTMLElement;\n\n  public topbar: ChatTopbar;\n  public bubbles: ChatBubbles;\n  public input: ChatInput;\n  public selection: ChatSelection;\n  public contextMenu: ChatContextMenu;\n  public search: ChatSearch;\n\n  public wasAlreadyUsed: boolean;\n  // public initPeerId = 0;\n  public peerId: PeerId;\n  public threadId: number;\n  public setPeerPromise: Promise<void>;\n  public peerChanged: boolean;\n\n  public log: ReturnType<typeof logger>;\n\n  public type: ChatType;\n  public messagesStorageKey: MessagesStorageKey;\n\n  public noForwards: boolean;\n\n  public inited: boolean;\n\n  public isRestricted: boolean;\n  public autoDownload: ChatAutoDownloadSettings;\n\n  public gradientRenderer: ChatBackgroundGradientRenderer;\n  public patternRenderer: ChatBackgroundPatternRenderer;\n  public gradientCanvas: HTMLCanvasElement;\n  public patternCanvas: HTMLCanvasElement;\n  public backgroundTempId: number;\n  public setBackgroundPromise: Promise<void>;\n  public sharedMediaTab: AppSharedMediaTab;\n  public sharedMediaTabs: AppSharedMediaTab[];\n  // public renderDarkPattern: () => Promise<void>;\n\n  public isBot: boolean;\n  public isChannel: boolean;\n  public isBroadcast: boolean;\n  public isAnyGroup: boolean;\n  public isMegagroup: boolean;\n\n  constructor(\n    public appImManager: AppImManager,\n    public managers: AppManagers\n  ) {\n    super();\n\n    this.type = 'chat';\n\n    this.container = document.createElement('div');\n    this.container.classList.add('chat', 'tabs-tab');\n\n    this.backgroundEl = document.createElement('div');\n    this.backgroundEl.classList.add('chat-background');\n\n    // * constructor end\n\n    this.log = logger('CHAT', LogTypes.Log | LogTypes.Warn | LogTypes.Debug | LogTypes.Error);\n    // this.log.error('Chat construction');\n\n    this.peerId = NULL_PEER_ID;\n\n    this.container.append(this.backgroundEl);\n    this.appImManager.chatsContainer.append(this.container);\n\n    this.backgroundTempId = 0;\n    this.sharedMediaTabs = [];\n  }\n\n  public setBackground(url: string, skipAnimation?: boolean): Promise<void> {\n    const theme = themeController.getTheme();\n\n    let item: HTMLElement;\n    const isColorBackground = !!theme.background.color && !theme.background.slug && !theme.background.intensity;\n    if(\n      isColorBackground &&\n      document.documentElement.style.cursor === 'grabbing' &&\n      this.gradientRenderer &&\n      !this.patternRenderer\n    ) {\n      this.gradientCanvas.dataset.colors = theme.background.color;\n      this.gradientRenderer.init(this.gradientCanvas);\n      return Promise.resolve();\n    }\n\n    const tempId = ++this.backgroundTempId;\n\n    const previousGradientRenderer = this.gradientRenderer;\n    const previousPatternRenderer = this.patternRenderer;\n    const previousGradientCanvas = this.gradientCanvas;\n    const previousPatternCanvas = this.patternCanvas;\n\n    this.gradientRenderer =\n      this.patternRenderer =\n      this.gradientCanvas =\n      this.patternCanvas =\n      // this.renderDarkPattern =\n      undefined;\n\n    const intensity = theme.background.intensity && theme.background.intensity / 100;\n    const isDarkPattern = !!intensity && intensity < 0;\n\n    let patternRenderer: ChatBackgroundPatternRenderer;\n    let patternCanvas = item?.firstElementChild as HTMLCanvasElement;\n    let gradientCanvas: HTMLCanvasElement;\n    if(!item) {\n      item = document.createElement('div');\n      item.classList.add('chat-background-item');\n\n      if(url) {\n        if(intensity) {\n          item.classList.add('is-pattern');\n\n          const rect = this.appImManager.chatsContainer.getBoundingClientRect();\n          patternRenderer = this.patternRenderer = ChatBackgroundPatternRenderer.getInstance({\n            url,\n            width: rect.width,\n            height: rect.height,\n            mask: isDarkPattern\n          });\n\n          patternCanvas = this.patternCanvas = patternRenderer.createCanvas();\n          patternCanvas.classList.add('chat-background-item-canvas', 'chat-background-item-pattern-canvas');\n\n          if(isDarkPattern) {\n            item.classList.add('is-dark');\n          }\n\n          // if(isDarkPattern) {\n          //   this.renderDarkPattern = () => {\n          //     return patternRenderer.exportCanvasPatternToImage(patternCanvas).then((url) => {\n          //       if(this.backgroundTempId !== tempId) {\n          //         return;\n          //       }\n\n          //       gradientCanvas.style.webkitMaskImage = `url(${url})`;\n          //     });\n          //   };\n          // }\n        } else if(theme.background.slug) {\n          item.classList.add('is-image');\n        }\n      } else if(theme.background.color) {\n        item.classList.add('is-color');\n      }\n    }\n\n    let gradientRenderer: ChatBackgroundGradientRenderer;\n    const color = theme.background.color;\n    if(color) {\n      // if(color.includes(',')) {\n      const {canvas, gradientRenderer: _gradientRenderer} = ChatBackgroundGradientRenderer.create(color);\n      gradientRenderer = this.gradientRenderer = _gradientRenderer;\n      gradientCanvas = this.gradientCanvas = canvas;\n      gradientCanvas.classList.add('chat-background-item-canvas', 'chat-background-item-color-canvas');\n\n      if(rootScope.settings.animationsEnabled) {\n        gradientRenderer.scrollAnimate(true);\n      }\n      // } else {\n      //   item.style.backgroundColor = color;\n      //   item.style.backgroundImage = 'none';\n      // }\n    }\n\n    if(patternRenderer) {\n      const setOpacityTo = isDarkPattern ? gradientCanvas : patternCanvas;\n      setOpacityTo.style.setProperty('--opacity-max', '' + Math.abs(intensity));\n    }\n\n    const promise = new Promise<void>((resolve) => {\n      const cb = () => {\n        if(this.backgroundTempId !== tempId) {\n          if(patternRenderer) {\n            patternRenderer.cleanup(patternCanvas);\n          }\n\n          if(gradientRenderer) {\n            gradientRenderer.cleanup();\n          }\n\n          return;\n        }\n\n        const prev = this.backgroundEl.lastElementChild as HTMLElement;\n\n        if(prev === item) {\n          resolve();\n          return;\n        }\n\n        const append = [\n          gradientCanvas,\n          // isDarkPattern && this.renderDarkPattern ? undefined : patternCanvas\n          patternCanvas\n        ].filter(Boolean);\n        if(append.length) {\n          item.append(...append);\n        }\n\n        this.backgroundEl.append(item);\n\n        SetTransition(item, 'is-visible', true, !skipAnimation ? 200 : 0, prev ? () => {\n          if(previousPatternRenderer) {\n            previousPatternRenderer.cleanup(previousPatternCanvas);\n          }\n\n          if(previousGradientRenderer) {\n            previousGradientRenderer.cleanup();\n          }\n\n          prev.remove();\n        } : null, 2);\n\n        resolve();\n      };\n\n      if(patternRenderer) {\n        const renderPatternPromise = patternRenderer.renderToCanvas(patternCanvas);\n        renderPatternPromise.then(() => {\n          if(this.backgroundTempId !== tempId) {\n            return;\n          }\n\n          // let promise: Promise<any>;\n          // if(isDarkPattern && this.renderDarkPattern) {\n          //   promise = this.renderDarkPattern();\n          // } else {\n          // const promise = Promise.resolve();\n          // }\n\n          // promise.then(cb);\n          cb();\n        });\n      } else if(url) {\n        renderImageFromUrl(item, url, cb);\n      } else {\n        cb();\n      }\n    });\n\n    return this.setBackgroundPromise = Promise.race([\n      pause(500),\n      promise\n    ]);\n  }\n\n  public setType(type: ChatType) {\n    this.type = type;\n  }\n\n  public init(/* peerId: PeerId */) {\n    // this.initPeerId = peerId;\n\n    this.topbar = new ChatTopbar(this, appSidebarRight, this.managers);\n    this.bubbles = new ChatBubbles(this, this.managers);\n    this.input = new ChatInput(this, this.appImManager, this.managers);\n    this.contextMenu = new ChatContextMenu(this, this.managers);\n    this.selection = new ChatSelection(this, this.bubbles, this.input, this.managers);\n\n    if(this.type === 'chat') {\n      this.topbar.constructUtils();\n      this.topbar.constructPeerHelpers();\n    } else if(this.type === 'pinned') {\n      this.topbar.constructPinnedHelpers();\n    } else if(this.type === 'discussion') {\n      this.topbar.constructUtils();\n      this.topbar.constructDiscussionHelpers();\n    }\n\n    this.topbar.construct();\n    this.input.construct();\n\n    if(this.type === 'chat') { // *   ,   -   \n      this.bubbles.constructPeerHelpers();\n      this.input.constructPeerHelpers();\n    } else if(this.type === 'pinned') {\n      this.bubbles.constructPinnedHelpers();\n      this.input.constructPinnedHelpers();\n    } else if(this.type === 'scheduled') {\n      this.bubbles.constructScheduledHelpers();\n      this.input.constructPeerHelpers();\n    } else if(this.type === 'discussion') {\n      this.bubbles.constructPeerHelpers();\n      this.input.constructPeerHelpers();\n    }\n\n    if(this.type !== 'scheduled' && !IS_TOUCH_SUPPORTED) {\n      this.bubbles.setReactionsHoverListeners();\n    }\n\n    this.bubbles.attachContainerListeners();\n\n    this.container.classList.add('type-' + this.type);\n    this.container.append(this.topbar.container, this.bubbles.container, this.input.chatInput);\n\n    this.bubbles.listenerSetter.add(rootScope)('dialog_migrate', ({migrateFrom, migrateTo}) => {\n      if(this.peerId === migrateFrom) {\n        this.setPeer(migrateTo);\n      }\n    });\n\n    this.bubbles.listenerSetter.add(rootScope)('dialog_drop', (e) => {\n      if(e.peerId === this.peerId) {\n        this.appImManager.setPeer();\n      }\n    });\n  }\n\n  public beforeDestroy() {\n    this.bubbles.cleanup();\n  }\n\n  private cleanupBackground() {\n    ++this.backgroundTempId;\n    if(this.patternRenderer) {\n      this.patternRenderer.cleanup(this.patternCanvas);\n      this.patternRenderer = undefined;\n    }\n\n    if(this.gradientRenderer) {\n      this.gradientRenderer.cleanup();\n      this.gradientRenderer = undefined;\n    }\n  }\n\n  public destroy() {\n    // const perf = performance.now();\n\n    this.topbar.destroy();\n    this.bubbles.destroy();\n    this.input.destroy();\n    this.contextMenu && this.contextMenu.destroy();\n    this.selection && this.selection.attachListeners(undefined, undefined);\n\n    this.cleanupBackground();\n\n    delete this.topbar;\n    delete this.bubbles;\n    delete this.input;\n    delete this.selection;\n    delete this.contextMenu;\n\n    this.container.remove();\n\n    // this.log.error('Chat destroy time:', performance.now() - perf);\n  }\n\n  public cleanup(helperToo = true) {\n    this.input.cleanup(helperToo);\n    this.topbar.cleanup();\n    this.selection.cleanup();\n  }\n\n  public async onChangePeer(m: ReturnType<typeof middlewarePromise>) {\n    const {peerId} = this;\n\n    const searchTab = appSidebarRight.getTab(AppPrivateSearchTab);\n    if(searchTab) {\n      searchTab.close();\n    }\n\n    const [\n      noForwards,\n      isRestricted,\n      isAnyGroup,\n      _,\n      isMegagroup,\n      isBroadcast,\n      isChannel,\n      isBot\n    ] = await m(Promise.all([\n      this.managers.appPeersManager.noForwards(peerId),\n      this.managers.appPeersManager.isRestricted(peerId),\n      this._isAnyGroup(peerId),\n      this.setAutoDownloadMedia(),\n      this.managers.appPeersManager.isMegagroup(peerId),\n      this.managers.appPeersManager.isBroadcast(peerId),\n      this.managers.appPeersManager.isChannel(peerId),\n      this.managers.appPeersManager.isBot(peerId)\n    ]));\n\n    this.noForwards = noForwards;\n    this.isRestricted = isRestricted;\n    this.isAnyGroup = isAnyGroup;\n    this.isMegagroup = isMegagroup;\n    this.isBroadcast = isBroadcast;\n    this.isChannel = isChannel;\n    this.isBot = isBot;\n\n    this.container.classList.toggle('no-forwards', this.noForwards);\n\n    this.sharedMediaTab = appSidebarRight.createSharedMediaTab();\n    this.sharedMediaTabs.push(this.sharedMediaTab);\n\n    this.sharedMediaTab.setPeer(peerId, this.threadId);\n    this.input.clearHelper(); // \n    this.selection.cleanup(); // TODO: REFACTOR !!!!!!\n  }\n\n  public setPeer(peerId: PeerId, lastMsgId?: number, startParam?: string) {\n    if(!peerId) {\n      this.inited = undefined;\n    } else if(!this.inited) {\n      if(this.init) {\n        this.init(/* peerId */);\n        this.init = null;\n      }\n\n      this.inited = true;\n    }\n\n    // const appMediaViewer = (window as any).appMediaViewer as AppMediaViewerBase<any, any, any>;\n    // if(appMediaViewer) {\n    //   appMediaViewer.close();\n    // }\n\n    const samePeer = this.peerId === peerId;\n    if(!samePeer) {\n      this.appImManager.dispatchEvent('peer_changing', this);\n      this.peerId = peerId || NULL_PEER_ID;\n      this.messagesStorageKey = `${this.peerId}_${this.type === 'scheduled' ? 'scheduled' : 'history'}`;\n    } else if(this.setPeerPromise) {\n      return;\n    }\n\n    if(!peerId) {\n      appSidebarRight.toggleSidebar(false);\n      this.cleanup(true);\n      this.bubbles.setPeer(false, peerId);\n      this.appImManager.dispatchEvent('peer_changed', peerId);\n\n      appSidebarRight.replaceSharedMediaTab();\n      this.destroySharedMediaTab();\n      this.sharedMediaTab = undefined;\n\n      return;\n    }\n\n    this.peerChanged = samePeer;\n\n    const bubblesSetPeerPromise = this.bubbles.setPeer(samePeer, peerId, lastMsgId, startParam);\n    const setPeerPromise = this.setPeerPromise = bubblesSetPeerPromise.then((result) => {\n      return result.promise;\n    }).catch(noop).finally(() => {\n      if(this.setPeerPromise === setPeerPromise) {\n        this.setPeerPromise = null;\n      }\n    });\n\n    return bubblesSetPeerPromise;\n  }\n\n  public destroySharedMediaTab(tab = this.sharedMediaTab) {\n    indexOfAndSplice(this.sharedMediaTabs, tab);\n    tab.destroy();\n  }\n\n  public async setAutoDownloadMedia() {\n    this.autoDownload = await getAutoDownloadSettingsByPeerId(this.peerId);\n  }\n\n  public setMessageId(messageId?: number) {\n    return this.setPeer(this.peerId, messageId);\n  }\n\n  public async finishPeerChange(isTarget: boolean, isJump: boolean, lastMsgId: number, startParam?: string) {\n    if(this.peerChanged) return;\n\n    const peerId = this.peerId;\n    this.peerChanged = true;\n    this.wasAlreadyUsed = true;\n\n    const middleware = this.bubbles.getMiddleware();\n\n    this.cleanup(false);\n\n    const sharedMediaTab = this.sharedMediaTab;\n    sharedMediaTab.loadSidebarMedia(true);\n\n    const callbacksPromise = Promise.all([\n      this.topbar.finishPeerChange(isTarget),\n      this.bubbles.finishPeerChange(),\n      this.input.finishPeerChange(startParam)\n    ]);\n\n    const [callbacks] = await Promise.all([\n      callbacksPromise,\n      sharedMediaTab.fillProfileElements()\n    ]);\n\n    if(!middleware()) {\n      return;\n    }\n\n    callbacks.forEach((callback) => {\n      callback();\n    });\n\n    appSidebarRight.replaceSharedMediaTab(sharedMediaTab);\n\n    this.sharedMediaTabs.filter((tab) => tab !== sharedMediaTab).forEach((tab) => this.destroySharedMediaTab(tab));\n\n    this.log.setPrefix('CHAT-' + peerId + '-' + this.type);\n\n    this.appImManager.dispatchEvent('peer_changed', peerId);\n  }\n\n  public getMessage(mid: number) {\n    return this.managers.appMessagesManager.getMessageFromStorage(this.messagesStorageKey, mid);\n  }\n\n  public async getMidsByMid(mid: number) {\n    return this.managers.appMessagesManager.getMidsByMessage(await this.getMessage(mid));\n  }\n\n  public getHistoryStorage(ignoreThreadId?: boolean) {\n    return this.managers.appMessagesManager.getHistoryStorageTransferable(this.peerId, ignoreThreadId ? undefined : this.threadId)\n    .then((historyStorageTransferable) => {\n      return {\n        ...historyStorageTransferable,\n        history: SlicedArray.fromJSON<number>(historyStorageTransferable.historySerialized)\n      }\n    });\n  }\n\n  public getHistoryMaxId() {\n    return this.getHistoryStorage().then((historyStorage) => historyStorage.maxId);\n  }\n\n  public async _isAnyGroup(peerId: PeerId) {\n    return peerId === rootScope.myId || peerId === REPLIES_PEER_ID || (await this.managers.appPeersManager.isAnyGroup(peerId));\n  }\n\n  public initSearch(query?: string) {\n    if(!this.peerId) return;\n\n    if(mediaSizes.isMobile) {\n      if(!this.search) {\n        this.search = new ChatSearch(this.topbar, this, query);\n      } else {\n        this.search.setQuery(query);\n      }\n    } else {\n      let tab = appSidebarRight.getTab(AppPrivateSearchTab);\n      if(!tab) {\n        tab = appSidebarRight.createTab(AppPrivateSearchTab);\n      }\n\n      tab.open(this.peerId, this.threadId, this.bubbles.onDatePick, query);\n    }\n  }\n\n  public canSend(action?: ChatRights) {\n    return this.managers.appMessagesManager.canSendToPeer(this.peerId, this.threadId, action);\n  }\n\n  public isStartButtonNeeded() {\n    return Promise.all([\n      this.managers.appPeersManager.isBot(this.peerId),\n      this.managers.appMessagesManager.getDialogOnly(this.peerId),\n      this.getHistoryStorage(true)\n    ]).then(([isBot, dialog, historyStorage]) => {\n      return isBot && !dialog && !historyStorage.history.length;\n    });\n  }\n\n  public getMessageSendingParams() {\n    return {\n      threadId: this.threadId,\n      replyToMsgId: this.input.replyToMsgId,\n      scheduleDate: this.input.scheduleDate,\n      sendSilent: this.input.sendSilent,\n      sendAsPeerId: this.input.sendAsPeerId\n    };\n  }\n\n  public isOurMessage(message: Message.message | Message.messageService) {\n    return message.fromId === rootScope.myId || (!!message.pFlags.out && this.isMegagroup);\n  }\n\n  public isOutMessage(message: Message.message | Message.messageService) {\n    const fwdFrom = (message as Message.message).fwd_from;\n    const isOut = this.isOurMessage(message) && (!fwdFrom || this.peerId !== rootScope.myId);\n    return !!isOut;\n  }\n\n  public isAvatarNeeded(message: Message.message | Message.messageService) {\n    return this.isAnyGroup && !this.isOutMessage(message);\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport type {State} from '../config/state';\nimport rootScope from '../lib/rootScope';\n\nexport type ChatAutoDownloadSettings = {\n  photo: number,\n  video: number,\n  file: number\n};\n\nexport default async function getAutoDownloadSettingsByPeerId(peerId: PeerId): Promise<ChatAutoDownloadSettings> {\n  let type: keyof State['settings']['autoDownload'];\n\n  let photoSizeMax = 0, videoSizeMax = 0, fileSizeMax = 0;\n  const settings = rootScope.settings;\n  const appPeersManager = rootScope.managers.appPeersManager;\n  if(!settings.autoDownloadNew.pFlags.disabled && peerId) {\n    if(peerId.isUser()) {\n      if(await appPeersManager.isContact(peerId)) {\n        type = 'contacts';\n      } else {\n        type = 'private';\n      }\n    } else if(await appPeersManager.isBroadcast(peerId)) {\n      type = 'channels';\n    } else {\n      type = 'groups';\n    }\n\n    if(settings.autoDownload.photo[type]) photoSizeMax = settings.autoDownloadNew.photo_size_max;\n    if(settings.autoDownload.video[type]) videoSizeMax = settings.autoDownloadNew.video_size_max;\n    if(settings.autoDownload.file[type]) fileSizeMax = settings.autoDownloadNew.file_size_max;\n  }\n\n  return {\n    photo: photoSizeMax,\n    video: videoSizeMax,\n    file: fileSizeMax\n  };\n}\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport type {AppImManager} from '../../lib/appManagers/appImManager';\r\nimport ButtonIcon from '../buttonIcon';\r\nimport IS_TOUCH_SUPPORTED from '../../environment/touchSupport';\r\nimport {IS_APPLE, IS_MOBILE} from '../../environment/userAgent';\r\nimport appNavigationController from '../appNavigationController';\r\nimport {_i18n} from '../../lib/langPack';\r\nimport cancelEvent from '../../helpers/dom/cancelEvent';\r\nimport {attachClickEvent} from '../../helpers/dom/clickEvent';\r\nimport getSelectedNodes from '../../helpers/dom/getSelectedNodes';\r\nimport isSelectionEmpty from '../../helpers/dom/isSelectionEmpty';\r\nimport {MarkdownType, markdownTags} from '../../helpers/dom/getRichElementValue';\r\nimport getVisibleRect from '../../helpers/dom/getVisibleRect';\r\nimport clamp from '../../helpers/number/clamp';\r\nimport matchUrl from '../../lib/richTextProcessor/matchUrl';\r\nimport matchUrlProtocol from '../../lib/richTextProcessor/matchUrlProtocol';\r\n// import { logger } from \"../../lib/logger\";\r\n\r\nexport default class MarkupTooltip {\r\n  public container: HTMLElement;\r\n  private wrapper: HTMLElement;\r\n  private buttons: {[type in MarkdownType]: HTMLElement} = {} as any;\r\n  private linkBackButton: HTMLElement;\r\n  private linkApplyButton: HTMLButtonElement;\r\n  private hideTimeout: number;\r\n  private addedListener = false;\r\n  private waitingForMouseUp = false;\r\n  private linkInput: HTMLInputElement;\r\n  private savedRange: Range;\r\n  private mouseUpCounter: number = 0;\r\n  // private log: ReturnType<typeof logger>;\r\n\r\n  constructor(private appImManager: AppImManager) {\r\n    // this.log = logger('MARKUP');\r\n  }\r\n\r\n  private init() {\r\n    this.container = document.createElement('div');\r\n    this.container.classList.add('markup-tooltip', 'z-depth-1', 'hide');\r\n\r\n    this.wrapper = document.createElement('div');\r\n    this.wrapper.classList.add('markup-tooltip-wrapper');\r\n\r\n    const tools1 = document.createElement('div');\r\n    const tools2 = document.createElement('div');\r\n    tools1.classList.add('markup-tooltip-tools');\r\n    tools2.classList.add('markup-tooltip-tools');\r\n\r\n    const arr = ['bold', 'italic', 'underline', 'strikethrough', 'monospace', 'spoiler', 'link'] as (keyof MarkupTooltip['buttons'])[];\r\n    arr.forEach((c) => {\r\n      const button = ButtonIcon(c, {noRipple: true});\r\n      tools1.append(this.buttons[c] = button);\r\n\r\n      if(c !== 'link') {\r\n        button.addEventListener('mousedown', (e) => {\r\n          cancelEvent(e);\r\n          this.appImManager.chat.input.applyMarkdown(c);\r\n          this.cancelClosening();\r\n\r\n          /* this.mouseUpCounter = 0;\r\n          this.setMouseUpEvent(); */\r\n          // this.hide();\r\n        });\r\n      } else {\r\n        attachClickEvent(button, (e) => {\r\n          cancelEvent(e);\r\n          this.showLinkEditor();\r\n          this.cancelClosening();\r\n        });\r\n      }\r\n    });\r\n\r\n    this.linkBackButton = ButtonIcon('left', {noRipple: true});\r\n    this.linkInput = document.createElement('input');\r\n    _i18n(this.linkInput, 'MarkupTooltip.LinkPlaceholder', undefined, 'placeholder');\r\n    this.linkInput.classList.add('input-clear');\r\n    this.linkInput.addEventListener('keydown', (e) => {\r\n      const valid = !this.linkInput.value.length || !!matchUrl(this.linkInput.value);// /^(http)|(https):\\/\\//i.test(this.linkInput.value);\r\n\r\n      if(e.key === 'Enter') {\r\n        if(!valid) {\r\n          if(this.linkInput.classList.contains('error')) {\r\n            this.linkInput.classList.remove('error');\r\n            void this.linkInput.offsetLeft; // reflow\r\n          }\r\n\r\n          this.linkInput.classList.add('error');\r\n        } else {\r\n          this.applyLink(e);\r\n        }\r\n      }\r\n    });\r\n\r\n    this.linkInput.addEventListener('input', (e) => {\r\n      const valid = this.isLinkValid();\r\n\r\n      this.linkInput.classList.toggle('is-valid', valid);\r\n      this.linkInput.classList.remove('error');\r\n    });\r\n\r\n    this.linkBackButton.addEventListener('mousedown', (e) => {\r\n      // this.log('linkBackButton click');\r\n      cancelEvent(e);\r\n      this.container.classList.remove('is-link');\r\n      // input.value = '';\r\n      this.resetSelection();\r\n      this.setTooltipPosition();\r\n      this.cancelClosening();\r\n    });\r\n\r\n    this.linkApplyButton = ButtonIcon('check markup-tooltip-link-apply', {noRipple: true});\r\n    this.linkApplyButton.addEventListener('mousedown', (e) => {\r\n      // this.log('linkApplyButton click');\r\n      this.applyLink(e);\r\n    });\r\n\r\n    const applyDiv = document.createElement('div');\r\n    applyDiv.classList.add('markup-tooltip-link-apply-container');\r\n\r\n    const delimiter1 = document.createElement('span');\r\n    const delimiter2 = document.createElement('span');\r\n    const delimiter3 = document.createElement('span');\r\n    delimiter1.classList.add('markup-tooltip-delimiter');\r\n    delimiter2.classList.add('markup-tooltip-delimiter');\r\n    delimiter3.classList.add('markup-tooltip-delimiter');\r\n    tools1.insertBefore(delimiter1, this.buttons.link);\r\n    applyDiv.append(delimiter3, this.linkApplyButton);\r\n    tools2.append(this.linkBackButton, delimiter2, this.linkInput, applyDiv);\r\n    // tools1.insertBefore(delimiter2, this.buttons.link.nextSibling);\r\n\r\n    this.wrapper.append(tools1, tools2);\r\n    this.container.append(this.wrapper);\r\n    document.body.append(this.container);\r\n\r\n    window.addEventListener('resize', () => {\r\n      this.hide();\r\n    });\r\n  }\r\n\r\n  public showLinkEditor() {\r\n    if(!this.container || !this.container.classList.contains('is-visible')) { // * if not inited yet (Ctrl+A + Ctrl+K)\r\n      this.show();\r\n    }\r\n\r\n    const button = this.buttons.link;\r\n    this.container.classList.add('is-link');\r\n\r\n    const selection = document.getSelection();\r\n    this.savedRange = selection.getRangeAt(0);\r\n\r\n    if(button.classList.contains('active')) {\r\n      const startContainer = this.savedRange.startContainer;\r\n      const anchor = startContainer.parentElement as HTMLAnchorElement;\r\n      this.linkInput.value = anchor.href;\r\n    } else {\r\n      this.linkInput.value = '';\r\n    }\r\n\r\n    this.setTooltipPosition(true);\r\n\r\n    setTimeout(() => {\r\n      this.linkInput.focus(); // !!! instant focus will break animation\r\n    }, 200);\r\n    this.linkInput.classList.toggle('is-valid', this.isLinkValid());\r\n  }\r\n\r\n  private applyLink(e: Event) {\r\n    cancelEvent(e);\r\n    this.resetSelection();\r\n    let url = this.linkInput.value;\r\n    if(url && !matchUrlProtocol(url)) {\r\n      url = 'https://' + url;\r\n    }\r\n    this.appImManager.chat.input.applyMarkdown('link', url);\r\n    setTimeout(() => {\r\n      this.hide();\r\n    }, 0);\r\n  }\r\n\r\n  private isLinkValid() {\r\n    return !this.linkInput.value.length || !!matchUrl(this.linkInput.value);\r\n  }\r\n\r\n  private resetSelection(range: Range = this.savedRange) {\r\n    const selection = window.getSelection();\r\n    selection.removeAllRanges();\r\n    selection.addRange(range);\r\n    this.appImManager.chat.input.messageInput.focus();\r\n  }\r\n\r\n  public hide() {\r\n    // return;\r\n\r\n    if(this.init) return;\r\n\r\n    this.container.classList.remove('is-visible');\r\n    // document.removeEventListener('mouseup', this.onMouseUp);\r\n    document.removeEventListener('mouseup', this.onMouseUpSingle);\r\n    this.waitingForMouseUp = false;\r\n\r\n    appNavigationController.removeByType('markup');\r\n\r\n    if(this.hideTimeout) clearTimeout(this.hideTimeout);\r\n    this.hideTimeout = window.setTimeout(() => {\r\n      this.hideTimeout = undefined;\r\n      this.container.classList.add('hide');\r\n      this.container.classList.remove('is-link');\r\n    }, 200);\r\n  }\r\n\r\n  public getActiveMarkupButton() {\r\n    const nodes = getSelectedNodes();\r\n    const parents = [...new Set(nodes.map((node) => node.parentNode))];\r\n    // if(parents.length > 1 && parents) return [];\r\n\r\n    const currentMarkups: Set<HTMLElement> = new Set();\r\n    (parents as HTMLElement[]).forEach((node) => {\r\n      for(const type in markdownTags) {\r\n        const tag = markdownTags[type as MarkdownType];\r\n        const closest = node.closest(tag.match + ', [contenteditable]');\r\n        if(closest !== this.appImManager.chat.input.messageInput) {\r\n          currentMarkups.add(this.buttons[type as MarkdownType]);\r\n        }\r\n      }\r\n    });\r\n\r\n\r\n    return [...currentMarkups];\r\n  }\r\n\r\n  public setActiveMarkupButton() {\r\n    const activeButtons = this.getActiveMarkupButton();\r\n\r\n    for(const i in this.buttons) {\r\n      // @ts-ignore\r\n      const button = this.buttons[i];\r\n      button.classList.toggle('active', activeButtons.includes(button));\r\n    }\r\n  }\r\n\r\n  private setTooltipPosition(isLinkToggle = false) {\r\n    const selection = document.getSelection();\r\n    const range = selection.getRangeAt(0);\r\n\r\n    const bodyRect = document.body.getBoundingClientRect();\r\n    const selectionRect = range.getBoundingClientRect();\r\n    const inputRect = this.appImManager.chat.input.rowsWrapper.getBoundingClientRect();\r\n\r\n    this.container.style.maxWidth = inputRect.width + 'px';\r\n\r\n    const visibleRect = getVisibleRect(undefined, this.appImManager.chat.input.messageInput, false, selectionRect);\r\n\r\n    const selectionTop = visibleRect.rect.top/* selectionRect.top */ + (bodyRect.top * -1);\r\n\r\n    const currentTools = this.container.classList.contains('is-link') ? this.wrapper.lastElementChild : this.wrapper.firstElementChild;\r\n\r\n    const sizesRect = currentTools.getBoundingClientRect();\r\n    const top = selectionTop - sizesRect.height - 8;\r\n\r\n    const minX = inputRect.left;\r\n    const maxX = (inputRect.left + inputRect.width) - Math.min(inputRect.width, sizesRect.width);\r\n    let left: number;\r\n    if(isLinkToggle) {\r\n      const containerRect = this.container.getBoundingClientRect();\r\n      left = clamp(containerRect.left, minX, maxX);\r\n    } else {\r\n      const x = selectionRect.left + (selectionRect.width - sizesRect.width) / 2;\r\n      left = clamp(x, minX, maxX);\r\n    }\r\n\r\n    /* const isClamped = x !== minX && x !== maxX && (left === minX || left === maxX || this.container.getBoundingClientRect().left >= maxX);\r\n\r\n    if(isLinkToggle && this.container.classList.contains('is-link') && !isClamped) return; */\r\n\r\n    this.container.style.transform = `translate3d(${left}px, ${top}px, 0)`;\r\n  }\r\n\r\n  public show() {\r\n    if(this.init) {\r\n      this.init();\r\n      this.init = null;\r\n    }\r\n\r\n    if(isSelectionEmpty()) {\r\n      this.hide();\r\n      return;\r\n    }\r\n\r\n    if(this.hideTimeout !== undefined) {\r\n      clearTimeout(this.hideTimeout);\r\n    }\r\n\r\n    if(this.container.classList.contains('is-visible')) {\r\n      return;\r\n    }\r\n\r\n    this.setActiveMarkupButton();\r\n\r\n    this.container.classList.remove('is-link');\r\n    const isFirstShow = this.container.classList.contains('hide');\r\n    if(isFirstShow) {\r\n      this.container.classList.remove('hide');\r\n      this.container.classList.add('no-transition');\r\n    }\r\n\r\n    this.setTooltipPosition();\r\n\r\n    if(isFirstShow) {\r\n      void this.container.offsetLeft; // reflow\r\n      this.container.classList.remove('no-transition');\r\n    }\r\n\r\n    this.container.classList.add('is-visible');\r\n\r\n    if(!IS_MOBILE) {\r\n      appNavigationController.pushItem({\r\n        type: 'markup',\r\n        onPop: () => {\r\n          this.hide();\r\n        }\r\n      });\r\n    }\r\n\r\n    // this.log('selection', selectionRect, activeButton);\r\n  }\r\n\r\n  /* private onMouseUp = (e: Event) => {\r\n    this.log('onMouseUp');\r\n    if(findUpClassName(e.target, 'markup-tooltip')) return;\r\n\r\n    this.hide();\r\n    //document.removeEventListener('mouseup', this.onMouseUp);\r\n  }; */\r\n\r\n  private onMouseUpSingle = (e?: Event) => {\r\n    // this.log('onMouseUpSingle');\r\n    this.waitingForMouseUp = false;\r\n\r\n    if(IS_TOUCH_SUPPORTED) {\r\n      e && cancelEvent(e);\r\n      if(this.mouseUpCounter++ === 0) {\r\n        this.resetSelection(this.savedRange);\r\n      } else {\r\n        this.hide();\r\n        return;\r\n      }\r\n    }\r\n\r\n    this.show();\r\n\r\n    /* !isTouchSupported && document.addEventListener('mouseup', this.onMouseUp); */\r\n  };\r\n\r\n  public setMouseUpEvent() {\r\n    if(this.waitingForMouseUp) return;\r\n    this.waitingForMouseUp = true;\r\n\r\n    // this.log('setMouseUpEvent');\r\n\r\n    document.addEventListener('mouseup', this.onMouseUpSingle, {once: true});\r\n  }\r\n\r\n  public cancelClosening() {\r\n    if(IS_TOUCH_SUPPORTED && !IS_APPLE) {\r\n      document.removeEventListener('mouseup', this.onMouseUpSingle);\r\n      document.addEventListener('mouseup', (e) => {\r\n        cancelEvent(e);\r\n        this.mouseUpCounter = 1;\r\n        this.waitingForMouseUp = false;\r\n        this.setMouseUpEvent();\r\n      }, {once: true});\r\n    }\r\n  }\r\n\r\n  public handleSelection() {\r\n    if(this.addedListener) return;\r\n    this.addedListener = true;\r\n    document.addEventListener('selectionchange', (e) => {\r\n      // this.log('selectionchange');\r\n\r\n      if(document.activeElement === this.linkInput) {\r\n        return;\r\n      }\r\n\r\n      const messageInput = this.appImManager.chat.input.messageInput;\r\n      if(document.activeElement !== messageInput) {\r\n        this.hide();\r\n        return;\r\n      }\r\n\r\n      const selection = document.getSelection();\r\n      if(isSelectionEmpty(selection)) {\r\n        this.hide();\r\n        return;\r\n      }\r\n\r\n      if(IS_TOUCH_SUPPORTED) {\r\n        if(IS_APPLE) {\r\n          this.show();\r\n          this.setTooltipPosition(); // * because can skip this in .show();\r\n        } else {\r\n          if(this.mouseUpCounter === 2) {\r\n            this.mouseUpCounter = 0;\r\n            return;\r\n          }\r\n\r\n          this.savedRange = selection.getRangeAt(0);\r\n          this.setMouseUpEvent();\r\n          /* document.addEventListener('touchend', (e) => {\r\n            cancelEvent(e);\r\n            this.resetSelection(range);\r\n            this.show();\r\n          }, {once: true, passive: false}); */\r\n        }\r\n      } else if(this.container && this.container.classList.contains('is-visible')) {\r\n        this.setTooltipPosition();\r\n      } else if(messageInput.matches(':active')) {\r\n        this.setMouseUpEvent();\r\n      } else {\r\n        this.show();\r\n      }\r\n    });\r\n  }\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nexport default function getSelectedNodes() {\r\n  const nodes: Node[] = [];\r\n  const selection = window.getSelection();\r\n  for(let i = 0; i < selection.rangeCount; ++i) {\r\n    const range = selection.getRangeAt(i);\r\n    let {startContainer, endContainer} = range;\r\n    if(endContainer.nodeType !== 3) endContainer = endContainer.firstChild;\r\n\r\n    while(startContainer && startContainer !== endContainer) {\r\n      nodes.push(startContainer.nodeType === 3 ? startContainer : startContainer.firstChild);\r\n      startContainer = startContainer.nextSibling;\r\n    }\r\n\r\n    if(nodes[nodes.length - 1] !== endContainer) {\r\n      nodes.push(endContainer);\r\n    }\r\n  }\r\n\r\n  // * filter null's due to <br>\r\n  return nodes.filter((node) => !!node);\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport generatePathData from '../../helpers/generatePathData';\r\nimport {FormatterArguments, i18n, LangPackKey} from '../../lib/langPack';\r\n\r\nexport default class ChatDragAndDrop {\r\n  container: HTMLDivElement;\r\n  svg: SVGSVGElement;\r\n  outlineWrapper: HTMLDivElement;\r\n  path: SVGPathElement;\r\n\r\n  constructor(appendTo: HTMLElement, private options: {\r\n    icon?: string,\r\n    header: LangPackKey,\r\n    headerArgs?: FormatterArguments,\r\n    subtitle?: LangPackKey,\r\n    onDrop: (e: DragEvent) => void\r\n  }) {\r\n    this.container = document.createElement('div');\r\n    this.container.classList.add('drop', 'z-depth-1');\r\n\r\n    this.outlineWrapper = document.createElement('div');\r\n    this.outlineWrapper.classList.add('drop-outline-wrapper');\r\n\r\n    this.svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');\r\n    this.svg.classList.add('drop-outline');\r\n\r\n    this.path = document.createElementNS('http://www.w3.org/2000/svg', 'path');\r\n    this.path.classList.add('drop-outline-path');\r\n\r\n    let dropIcon: HTMLElement;\r\n    if(options.icon) {\r\n      dropIcon = document.createElement('div');\r\n      dropIcon.classList.add('drop-icon', 'tgico-' + options.icon);\r\n    }\r\n\r\n    const dropHeader = document.createElement('div');\r\n    dropHeader.classList.add('drop-header');\r\n    dropHeader.append(i18n(options.header, options.headerArgs));\r\n\r\n    let dropSubtitle: HTMLElement;\r\n    if(options.subtitle) {\r\n      dropSubtitle = document.createElement('div');\r\n      dropSubtitle.classList.add('drop-subtitle');\r\n      dropSubtitle.append(i18n(options.subtitle));\r\n    }\r\n\r\n    this.svg.append(this.path);\r\n    this.outlineWrapper.append(this.svg);\r\n\r\n    this.container.append(...[this.outlineWrapper, dropIcon, dropHeader, dropSubtitle].filter(Boolean));\r\n    appendTo.append(this.container);\r\n\r\n    this.container.addEventListener('dragover', this.onDragOver);\r\n    this.container.addEventListener('dragleave', this.onDragLeave);\r\n    this.container.addEventListener('drop', this.onDrop);\r\n  }\r\n\r\n  onDragOver = (e: DragEvent) => {\r\n    this.container.classList.add('is-dragover');\r\n    // SetTransition(this.container, 'is-dragover', true, 500);\r\n  };\r\n\r\n  onDragLeave = (e: DragEvent) => {\r\n    this.container.classList.remove('is-dragover');\r\n    // SetTransition(this.container, 'is-dragover', false, 500);\r\n  };\r\n\r\n  onDrop = (e: DragEvent) => {\r\n    this.options.onDrop(e);\r\n  };\r\n\r\n  destroy() {\r\n    delete this.options;\r\n    this.container.remove();\r\n    this.container.removeEventListener('dragover', this.onDragOver);\r\n    this.container.removeEventListener('dragleave', this.onDragLeave);\r\n    this.container.removeEventListener('drop', this.onDrop);\r\n  }\r\n\r\n  setPath() {\r\n    const rect = this.outlineWrapper.getBoundingClientRect();\r\n    this.svg.setAttributeNS(null, 'preserveAspectRatio', 'none');\r\n    this.svg.setAttributeNS(null, 'viewBox', `0 0 ${rect.width} ${rect.height}`);\r\n    this.svg.setAttributeNS(null, 'width', `${rect.width}`);\r\n    this.svg.setAttributeNS(null, 'height', `${rect.height}`);\r\n\r\n    const radius = 10;\r\n    // const strokeWidth = 2;\r\n    const sizeX = rect.width - radius;\r\n    const sizeY = rect.height - radius;\r\n    const pos = radius / 2;\r\n    const d = generatePathData(pos, pos, sizeX, sizeY, radius, radius, radius, radius);\r\n    this.path.setAttributeNS(null, 'd', d);\r\n  }\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport {doubleRaf} from '../schedulers';\r\n\r\nexport default function disableTransition(elements: HTMLElement[]) {\r\n  elements.forEach((el) => el.classList.add('no-transition'));\r\n\r\n  doubleRaf().then(() => {\r\n    elements.forEach((el) => el.classList.remove('no-transition'));\r\n  });\r\n}\r\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n *\n * Originally from:\n * https://github.com/evgeny-nadymov/telegram-react\n * Copyright (C) 2018 Evgeny Nadymov\n * https://github.com/evgeny-nadymov/telegram-react/blob/master/LICENSE\n */\n\nexport const MAX_SPEED = 8.2;\nexport const MIN_SPEED = 0.8;\n\n// import { MIN_SPEED, MAX_SPEED } from './BlobDrawable';\n\ntype Radius = number[];\n\nexport default class LineBlobDrawable {\n  public maxRadius: number;\n  public minRadius: number;\n  private N: number;\n  private radius: Radius;\n  private radiusNext: Radius;\n  private progress: number[];\n  private speed: number[];\n\n  constructor(n: number) {\n    this.maxRadius = 10;\n    this.minRadius = 0;\n\n    this.N = n;\n    this.radius = new Array(n + 1);\n\n    this.radiusNext = new Array(n + 1);\n    this.progress = new Array(n + 1);\n    this.speed = new Array(n + 1);\n\n    for(let i = 0; i <= n; i++) {\n      this.generateBlob(this.radius, i);\n      this.generateBlob(this.radiusNext, i);\n      this.progress[i] = 0;\n    }\n  }\n\n  private generateBlob(radius: Radius, i: number) {\n    const {maxRadius, minRadius, speed} = this;\n\n    const radDif = maxRadius - minRadius;\n    radius[i] = minRadius + Math.random() * radDif;\n    speed[i] = 0.017 + 0.003 * Math.random();\n  }\n\n  private generateNextBlob() {\n    const {radius, radiusNext, progress, N} = this;\n    for(let i = 0; i < N; i++) {\n      this.generateBlob(radius, i);\n      this.generateBlob(radiusNext, i);\n      progress[i] = 0.0;\n    }\n  }\n\n  public update(amplitude: number, speedScale: number) {\n    const {N, progress, speed, radius, radiusNext} = this;\n    for(let i = 0; i <= N; i++) {\n      progress[i] += (speed[i] * MIN_SPEED) + amplitude * speed[i] * MAX_SPEED * speedScale;\n      if(progress[i] >= 1.0) {\n        progress[i] = 0.0;\n        radius[i] = radiusNext[i];\n        this.generateBlob(radiusNext, i);\n      }\n    }\n  }\n\n  public draw(left: number, top: number, right: number, bottom: number, canvas: HTMLCanvasElement, paint: (ctx: CanvasRenderingContext2D) => void, pinnedTop: number, progressToPinned: number) {\n    if(canvas.getContext) {\n      const ctx = canvas.getContext('2d');\n      // ctx.globalAlpha = 0.5;\n      // ctx.lineWidth = 1;\n\n      ctx.beginPath();\n      ctx.moveTo(right, bottom);\n      ctx.lineTo(left, bottom);\n\n      const {radius, radiusNext, N} = this;\n      for(let i = 0; i <= N; i++) {\n        if(i === 0) {\n          const progress = this.progress[i];\n          const r1 = radius[i] * (1.0 - progress) + radiusNext[i] * progress;\n          const y = (top - r1) * progressToPinned + pinnedTop * (1.0 - progressToPinned);\n          ctx.lineTo(left, y);\n        } else {\n          const progress = this.progress[i - 1];\n          const r1 = radius[i - 1] * (1.0 - progress) + radiusNext[i - 1] * progress;\n          const progressNext = this.progress[i];\n          const r2 = radius[i] * (1.0 - progressNext) + radiusNext[i] * progressNext;\n          const x1 = (right - left) / N * (i - 1);\n          const x2 = (right - left) / N * i;\n          const cx = x1 + (x2 - x1) / 2;\n\n          const y1 = (top - r1) * progressToPinned + pinnedTop * (1.0 - progressToPinned);\n          const y2 = (top - r2) * progressToPinned + pinnedTop * (1.0 - progressToPinned);\n          ctx.bezierCurveTo(cx, y1, cx, y2, x2, y2);\n          if(i === N) {\n            ctx.lineTo(right, bottom);\n          }\n        }\n      }\n\n      // ctx.scale(1.0, 1.0);\n      paint(ctx);\n      ctx.fill();\n      ctx.closePath();\n    }\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n *\n * Originally from:\n * https://github.com/evgeny-nadymov/telegram-react\n * Copyright (C) 2018 Evgeny Nadymov\n * https://github.com/evgeny-nadymov/telegram-react/blob/master/LICENSE\n */\n\nimport GROUP_CALL_STATE from '../lib/calls/groupCallState';\nimport LineBlobDrawable from './lineBlobDrawable';\n\nexport class WeavingState {\n  public shader: (ctx: CanvasRenderingContext2D, left: number, top: number, right: number, bottom: number) => void;\n\n  constructor(public stateId: GROUP_CALL_STATE) {\n    this.createGradient(stateId);\n  }\n\n  public createGradient(stateId: GROUP_CALL_STATE) {\n    this.shader = (ctx, left, top, right, bottom) => {\n      ctx.fillStyle = WeavingState.getGradientFromType(ctx, stateId, left, top, right, bottom);\n    };\n  }\n\n  // Android colors\n  static getGradientFromType(ctx: CanvasRenderingContext2D, type: GROUP_CALL_STATE, x0: number, y0: number, x1: number, y1: number) {\n    const gradient = ctx.createLinearGradient(x0, y0, x1, y1);\n    if(type === GROUP_CALL_STATE.MUTED_BY_ADMIN) {\n      gradient.addColorStop(0, '#F05459');\n      gradient.addColorStop(.4, '#766EE9');\n      gradient.addColorStop(1, '#57A4FE');\n    } else if(type === GROUP_CALL_STATE.UNMUTED) {\n      gradient.addColorStop(0, '#52CE5D');\n      gradient.addColorStop(1, '#00B1C0');\n    } else if(type === GROUP_CALL_STATE.MUTED) {\n      gradient.addColorStop(0, '#0976E3');\n      gradient.addColorStop(1, '#2BCEFF');\n    } else if(type === GROUP_CALL_STATE.CONNECTING) {\n      gradient.addColorStop(0, '#8599aa');\n      gradient.addColorStop(1, '#8599aa');\n    }\n\n    return gradient;\n  }\n\n  update(height: number, width: number, dt: number, amplitude: number) {\n    // TODO: move gradient here\n  }\n}\n\nexport default class TopbarWeave {\n  private focused: boolean;\n  private resizing: boolean;\n  private lastUpdateTime: number;\n  private amplitude: number;\n  private amplitude2: number;\n\n  private states: Map<GROUP_CALL_STATE, WeavingState>;\n  private previousState: WeavingState;\n  private currentState: WeavingState;\n  private progressToState: number;\n\n  private scale: number;\n  private left: number;\n  private top: number;\n  private right: number;\n  private bottom: number;\n\n  private mounted: boolean;\n  private media: MediaQueryList;\n\n  private container: HTMLDivElement;\n  private canvas: HTMLCanvasElement;\n\n  private resizeHandler: number;\n  private raf: number;\n\n  private lbd: LineBlobDrawable;\n  private lbd1: LineBlobDrawable;\n  private lbd2: LineBlobDrawable;\n\n  private animateToAmplitude: number;\n  private animateAmplitudeDiff: number;\n  private animateAmplitudeDiff2: number;\n\n  constructor() {\n    this.focused = true;\n    this.resizing = false;\n    this.lastUpdateTime = Date.now();\n    this.amplitude = 0.0;\n    this.amplitude2 = 0.0;\n\n    this.states = new Map([\n      [GROUP_CALL_STATE.UNMUTED, new WeavingState(GROUP_CALL_STATE.UNMUTED)],\n      [GROUP_CALL_STATE.MUTED, new WeavingState(GROUP_CALL_STATE.MUTED)],\n      [GROUP_CALL_STATE.MUTED_BY_ADMIN, new WeavingState(GROUP_CALL_STATE.MUTED_BY_ADMIN)],\n      [GROUP_CALL_STATE.CONNECTING, new WeavingState(GROUP_CALL_STATE.CONNECTING)]\n    ]);\n    this.previousState = null;\n    this.currentState = this.states.get(GROUP_CALL_STATE.CONNECTING);\n    this.progressToState = 1.0;\n  }\n\n  public componentDidMount() {\n    if(this.mounted) {\n      return;\n    }\n\n    this.mounted = true;\n    // window.addEventListener('blur', this.handleBlur);\n    // window.addEventListener('focus', this.handleFocus);\n    window.addEventListener('resize', this.handleResize);\n    this.media = window.matchMedia('screen and (min-resolution: 2dppx)');\n    this.media.addEventListener('change', this.handleDevicePixelRatioChanged);\n\n    this.setSize();\n    this.forceUpdate();\n\n    this.lbd = new LineBlobDrawable(3);\n    this.lbd1 = new LineBlobDrawable(7);\n    this.lbd2 = new LineBlobDrawable(8);\n    this.setAmplitude(this.amplitude);\n\n    this.draw();\n  }\n\n  public componentWillUnmount() {\n    this.mounted = false;\n    // window.removeEventListener('blur', this.handleBlur);\n    // window.removeEventListener('focus', this.handleFocus);\n    window.removeEventListener('resize', this.handleResize);\n    this.media.addEventListener('change', this.handleDevicePixelRatioChanged);\n\n    const {canvas} = this;\n    const ctx = canvas.getContext('2d');\n    ctx.clearRect(0, 0, canvas.width, canvas.height);\n  }\n\n  private setSize() {\n    this.scale = window.devicePixelRatio;\n    this.top = 20 * this.scale;\n    this.right = (this.mounted ? this.container.offsetWidth : 1261) * this.scale;\n    this.bottom = (this.mounted ? this.container.offsetHeight : 68) * this.scale;\n    this.left = 0 * this.scale;\n    this.setCanvasSize();\n  }\n\n  private setCanvasSize() {\n    this.canvas.width = this.right;\n    this.canvas.height = this.bottom;\n  }\n\n  private handleDevicePixelRatioChanged = (e: Event) => {\n    this.setSize();\n    this.forceUpdate();\n  }\n\n  private handleResize = () => {\n    if(this.resizeHandler) {\n      clearTimeout(this.resizeHandler);\n      this.resizeHandler = null;\n    }\n\n    this.resizing = true;\n    this.resizeCanvas();\n    this.resizeHandler = window.setTimeout(() => {\n      this.resizing = false;\n      this.invokeDraw();\n    }, 250);\n  }\n\n  private resizeCanvas() {\n    this.scale = window.devicePixelRatio;\n    this.right = this.container.offsetWidth * this.scale;\n\n    this.forceUpdate();\n    this.invokeDraw();\n  }\n\n  public handleFocus = () => {\n    this.focused = true;\n    this.invokeDraw();\n  }\n\n  public handleBlur = () => {\n    this.focused = false;\n  }\n\n  private invokeDraw = () => {\n    if(this.raf) return;\n\n    this.draw();\n  }\n\n  private draw = (force = false) => {\n    this.raf = null;\n    if(!this.mounted) {\n      return;\n    }\n    const {lbd, lbd1, lbd2, scale, left, top, right, bottom, currentState, previousState, focused, resizing, canvas} = this;\n    if(!focused && !resizing && this.progressToState >= 1.0) {\n      return;\n    }\n\n    // console.log('[top] draw', [focused, resizing, this.mounted]);\n\n    const newTime = Date.now();\n    let dt = (newTime - this.lastUpdateTime);\n    if(dt > 20) {\n      dt = 17;\n    }\n\n    // console.log('draw start', this.amplitude, this.animateToAmplitude);\n    if(this.animateToAmplitude !== this.amplitude) {\n      this.amplitude += this.animateAmplitudeDiff * dt;\n      if(this.animateAmplitudeDiff > 0) {\n        if(this.amplitude > this.animateToAmplitude) {\n          this.amplitude = this.animateToAmplitude;\n        }\n      } else {\n        if(this.amplitude < this.animateToAmplitude) {\n          this.amplitude = this.animateToAmplitude;\n        }\n      }\n    }\n\n    if(this.animateToAmplitude !== this.amplitude2) {\n      this.amplitude2 += this.animateAmplitudeDiff2 * dt;\n      if(this.animateAmplitudeDiff2 > 0) {\n        if(this.amplitude2 > this.animateToAmplitude) {\n          this.amplitude2 = this.animateToAmplitude;\n        }\n      } else {\n        if(this.amplitude2 < this.animateToAmplitude) {\n          this.amplitude2 = this.animateToAmplitude;\n        }\n      }\n    }\n\n    if(previousState) {\n      this.progressToState += dt / 250;\n      if(this.progressToState > 1) {\n        this.progressToState = 1;\n        this.previousState = null;\n      }\n    }\n\n    const {amplitude, amplitude2, progressToState} = this;\n\n    const top1 = 6 * amplitude2 * scale;\n    const top2 = 6 * amplitude2 * scale;\n\n    const ctx = canvas.getContext('2d');\n    ctx.clearRect(0, 0, canvas.width, canvas.height);\n\n    lbd.minRadius = 0;\n    lbd.maxRadius = (2 + 2 * amplitude) * scale;\n    lbd1.minRadius = 0;\n    lbd1.maxRadius = (3 + 9 * amplitude) * scale;\n    lbd2.minRadius = 0;\n    lbd2.maxRadius = (3 + 9 * amplitude) * scale;\n\n    lbd.update(amplitude, 0.3);\n    lbd1.update(amplitude, 0.7);\n    lbd2.update(amplitude, 0.7);\n\n    for(let i = 0; i < 2; i++) {\n      if(i === 0 && !previousState) {\n        continue;\n      }\n\n      let alpha = 1;\n      let state: WeavingState = null;\n      if(i === 0) {\n        alpha = 1 - progressToState;\n        state = previousState;\n        // previousState.setToPaint(paint);\n      } else {\n        alpha = previousState ? progressToState : 1;\n        currentState.update(bottom - top, right - left, dt, amplitude);\n        state = currentState;\n        // currentState.setToPaint(paint);\n      }\n\n      const paint1 = (ctx: CanvasRenderingContext2D) => {\n        ctx.globalAlpha = 0.3 * alpha;\n        state.shader(ctx, left, top, right, bottom);\n      };\n      const paint = (ctx: CanvasRenderingContext2D) => {\n        ctx.globalAlpha = i === 0 ? 1 : alpha;\n        state.shader(ctx, left, top, right, bottom);\n      };\n\n      lbd1.draw(left, top - top1, right, bottom, canvas, paint1, top, 1.0);\n      lbd2.draw(left, top - top2, right, bottom, canvas, paint1, top, 1.0);\n      lbd.draw(left, top, right, bottom, canvas, paint, top, 1.0);\n    }\n\n    if(!force) {\n      this.raf = requestAnimationFrame(() => this.draw());\n    }\n  };\n\n  public setCurrentState = (stateId: GROUP_CALL_STATE, animated: boolean) => {\n    const {currentState, states} = this;\n\n    if(currentState?.stateId === stateId) {\n      return;\n    }\n\n    this.previousState = animated ? currentState : null;\n    this.currentState = states.get(stateId);\n    this.progressToState = this.previousState ? 0.0 : 1.0;\n  };\n\n  public setAmplitude(value: number) {\n    const {amplitude} = this;\n    this.animateToAmplitude = value;\n    this.animateAmplitudeDiff = (value - amplitude) / 250;\n    this.animateAmplitudeDiff2 = (value - amplitude) / 120;\n  }\n\n  private forceUpdate() {\n    this.setCanvasSize();\n  }\n\n  public render(className: string) {\n    const container = this.container = document.createElement('div');\n    container.classList.add(className);\n\n    const canvas = this.canvas = document.createElement('canvas');\n    canvas.classList.add(className + '-canvas');\n\n    container.append(canvas);\n\n    return container;\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport noop from '../../helpers/noop';\nimport safeAssign from '../../helpers/object/safeAssign';\nimport rootScope from '../rootScope';\nimport lottieLoader, {LottieAssetName} from './lottieLoader';\nimport type RLottiePlayer from './rlottiePlayer';\nimport {RLottieColor} from './rlottiePlayer';\n\nexport type RLottieIconOptions = {\n  width: number,\n  height: number,\n  container?: HTMLElement,\n  skipAnimation?: boolean\n};\n\nexport type RLottieIconItemPartOptions = {\n  startFrame: number,\n  endFrame: number,\n  name?: string\n};\n\nexport type RLottieIconItemOptions = {\n  name: LottieAssetName,\n  parts: RLottieIconItemPartOptions[],\n  initFrame?: number,\n  player?: RLottiePlayer,\n  autoplay?: boolean,\n  color?: RLottieColor,\n  inverseColor?: RLottieColor,\n};\n\nexport class RLottieIconItemPart implements RLottieIconItemPartOptions {\n  public startFrame: number;\n  public endFrame: number;\n  public name?: string;\n\n  constructor(public item: RLottieIconItem, options: RLottieIconItemPartOptions) {\n    safeAssign(this, options);\n  }\n\n  public play(callback?: () => void) {\n    return this.item.playPart(this, callback);\n  }\n}\n\n// export type RLottieIconItemPart = RLottieIconItemPartOptions;\n\nexport class RLottieIconItem implements RLottieIconItemOptions {\n  public name: LottieAssetName;\n  public parts: RLottieIconItemPart[];\n  public player: RLottiePlayer;\n  public initFrame: number;\n  public autoplay: boolean;\n  public color: RLottieColor;\n  public inverseColor: RLottieColor;\n  public loadPromise: Promise<void>;\n  public onLoadForPart: () => void;\n  public onLoadForColor: () => void;\n\n  constructor(public icon: RLottieIcon, options: RLottieIconItemOptions) {\n    this.autoplay = false;\n\n    safeAssign(this, options);\n\n    this.parts = this.parts.map((options) => this.createPart(options));\n  }\n\n  public load() {\n    let loadPromise = this.loadPromise;\n    if(loadPromise) {\n      return loadPromise;\n    }\n\n    const {container, canvas, width, height} = this.icon;\n    loadPromise = lottieLoader.loadAnimationAsAsset({\n      container,\n      canvas,\n      width,\n      height,\n      group: 'none',\n      loop: false,\n      autoplay: this.autoplay ?? false,\n      initFrame: this.initFrame,\n      skipFirstFrameRendering: this.initFrame === undefined,\n      color: this.color,\n      inverseColor: this.inverseColor\n    }, this.name).then((player) => {\n      return lottieLoader.waitForFirstFrame(player);\n    }).then((player) => {\n      this.player = player;\n\n      if(this.onLoadForColor) {\n        this.onLoadForColor();\n        this.onLoadForColor = undefined;\n      }\n\n      if(this.onLoadForPart) {\n        this.onLoadForPart();\n        this.onLoadForPart = undefined;\n      }\n    });\n\n    this.loadPromise = loadPromise;\n    this.icon.loadPromises.set(this.name, loadPromise);\n    return loadPromise;\n  }\n\n  public createPart(options: RLottieIconItemPartOptions) {\n    return new RLottieIconItemPart(this, options);\n  }\n\n  public getPart(index: string | number | RLottieIconItemPart) {\n    if(index instanceof RLottieIconItemPart) return index;\n    else if(typeof(index) === 'string') return this.parts.find((part) => part.name === index);\n    else return this.parts[index];\n  }\n\n  public playPart(part: RLottieIconItemPart, callback?: () => void) {\n    return this.icon.playPart(this, part, callback);\n  }\n}\n\nexport default class RLottieIcon {\n  public container: HTMLElement;\n  public canvas: HTMLCanvasElement;\n  public width: number;\n  public height: number;\n\n  protected items: Map<LottieAssetName, RLottieIconItem>;\n  public loadPromises: Map<LottieAssetName, Promise<void>>;\n\n  protected skipAnimation: boolean;\n\n  constructor(options: RLottieIconOptions) {\n    safeAssign(this, options);\n\n    if(!this.container) this.container = document.createElement('div');\n    this.container.classList.add('rlottie-icon');\n\n    const {width, height} = this;\n    this.container.style.width = width + 'px';\n    this.container.style.height = height + 'px';\n\n    const canvas = this.canvas = document.createElement('canvas');\n    canvas.classList.add('rlottie');\n    canvas.width = width;\n    canvas.height = height;\n\n    this.items = new Map();\n    this.loadPromises = new Map();\n  }\n\n  public get loadPromise() {\n    return Promise.all([...this.loadPromises.values()]).then(noop);\n  }\n\n  public getItem(name?: LottieAssetName): RLottieIconItem {\n    return !name && this.items.size === 1 ? this.items.values().next().value : this.items.get(name);\n  }\n\n  public add(options: Omit<RLottieIconItemOptions, 'player'>) {\n    const item = new RLottieIconItem(this, options);\n    this.items.set(options.name, item);\n\n    return item;\n  }\n\n  public playPart(item: RLottieIconItem, index: Parameters<RLottieIconItem['getPart']>[0], callback?: () => void) {\n    if(!item.player) {\n      item.onLoadForPart = () => {\n        this.playPart(item, index, callback);\n      };\n\n      return;\n    }\n\n    const part = item.getPart(index);\n    item.player.playPart({\n      from: rootScope.settings.animationsEnabled && !this.skipAnimation ? part.startFrame : part.endFrame,\n      to: part.endFrame,\n      callback\n    });\n  }\n\n  /* public playToPart(item: RLottieIconItem, index: Parameters<RLottieIconItem['getPart']>[0], toEnd: boolean) {\n    if(!item.player) return;\n    const part = item.getPart(index);\n    const toFrame = toEnd ? part.endFrame : part.startFrame;\n    item.player.playToFrame({\n      frame: toFrame\n    });\n  } */\n\n  public static generateEqualParts(length: number, frameCount: number): RLottieIconItemPartOptions[] {\n    return new Array(length).fill(0).map((_, idx) => {\n      const startFrame = idx * frameCount;\n      return {startFrame, endFrame: startFrame + frameCount - 1};\n    });\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport noop from '../helpers/noop';\nimport safeAssign from '../helpers/object/safeAssign';\nimport {LottieAssetName} from '../lib/rlottie/lottieLoader';\nimport RLottieIcon, {RLottieIconItemPartOptions, RLottieIconItemPart} from '../lib/rlottie/rlottieIcon';\nimport {RLottieColor} from '../lib/rlottie/rlottiePlayer';\n\nexport type SuperRLottieIconAddItemOptions = {name: LottieAssetName, parts: RLottieIconItemPartOptions};\nexport type SuperRLottieIconGetInfoResult = RLottieIconItemPart;\nexport class SuperRLottieIcon<Options extends {\n  PartState: any,\n  ColorState?: any,\n  Items?: {\n    name: string\n  }[]\n}> extends RLottieIcon {\n  protected getPart: (state: Options['PartState'], prevState?: Options['PartState']) => SuperRLottieIconGetInfoResult;\n  protected getColor?: (state: Options['ColorState'], prevState?: Options['ColorState']) => RLottieColor;\n\n  protected partState: Options['PartState'];\n  protected colorState: Options['ColorState'];\n  protected loaded: boolean;\n\n  constructor(options: {\n    width: number,\n    height: number,\n    skipAnimation?: boolean,\n    getPart: (state: Options['PartState'], prevState?: Options['PartState']) => SuperRLottieIconGetInfoResult,\n    getColor?: (state: Options['ColorState'], prevState?: Options['ColorState']) => RLottieColor,\n  }) {\n    super({\n      width: options.width,\n      height: options.height\n    });\n\n    safeAssign(this, options);\n\n    // hook the first call\n    /* const originalFunction = this.setState.bind(this);\n    this.setState = (partState, colorState) => {\n      this.setState = originalFunction;\n      this.load(partState, colorState);\n      return originalFunction(partState, colorState);\n    }; */\n  }\n\n  public load(partState: Options['PartState'], colorState?: Options['ColorState']) {\n    if(this.loaded) {\n      return this.loadPromise;\n    }\n\n    this.loaded = true;\n    this.partState = partState;\n    this.colorState = colorState;\n\n    const part = this.getPart(partState);\n    const color = colorState !== undefined && this.getColor && this.getColor(colorState);\n\n    const item = part.item;\n    item.initFrame = part.endFrame;\n    item.color = color;\n\n    const promises = [...this.items.values()].map((item) => item.load());\n    return Promise.all(promises).then(noop);\n  }\n\n  /**\n   * Will redirect setting color state to part callback to synchronize the rendering\n   */\n  public setState(partState: Options['PartState'], colorState?: Options['ColorState'], partCallback?: () => void) {\n    if(!this.loaded) this.load(partState, colorState);\n\n    let changedPartState = false, changedColorState = false;\n    if(partState !== undefined) changedPartState = this.setPartState(partState, colorState, partCallback);\n    else if(colorState !== undefined) changedColorState = this.setColorState(colorState);\n\n    return changedPartState || changedColorState;\n  }\n\n  public setPartState(state: Options['PartState'], colorState?: Options['ColorState'], callback?: () => void) {\n    const {partState: prevState} = this;\n    if(prevState === state) {\n      return colorState !== undefined ? this.setColorState(colorState) : false;\n    }\n\n    if(colorState !== undefined) {\n      this.setColorState(colorState, false);\n    }\n\n    this.partState = state;\n\n    const part = this.getPart(state, prevState);\n    part.play(callback);\n\n    return true;\n  }\n\n  public setColorState(state: Options['ColorState'], renderIfPaused = true) {\n    const {colorState: prevState} = this;\n    if(prevState === state || !this.getColor) {\n      return false;\n    }\n\n    this.colorState = state;\n\n    const item = this.getItem();\n    const color = this.getColor(state, prevState);\n    const invoke = () => {\n      item.player.setColor(color, renderIfPaused);\n    };\n\n    if(item.player) {\n      invoke();\n    } else {\n      item.onLoadForColor = invoke;\n    }\n\n    return true;\n  }\n\n  public destroy() {\n    this.items.forEach((item) => {\n      item.loadPromise.then(() => {\n        item.player.remove();\n      });\n    });\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport {RLottieIconItemPartOptions} from '../../lib/rlottie/rlottieIcon';\nimport {GROUP_CALL_MICROPHONE_BUTTON_STATE} from '.';\nimport {SuperRLottieIcon} from '../superIcon';\n\nexport default class GroupCallMicrophoneIcon extends SuperRLottieIcon<{\n  PartState: GROUP_CALL_MICROPHONE_BUTTON_STATE\n}> {\n  constructor() {\n    super({\n      width: 36,\n      height: 36,\n      getPart: (state, prevState) => {\n        const states = GROUP_CALL_MICROPHONE_BUTTON_STATE;\n        let partName: string;\n        switch(state) {\n          case states.HAND:\n            partName = prevState === states.MUTED ? 'muted-to-hand' : 'unmuted-to-hand';\n            break;\n          case states.MUTED:\n            partName = prevState === states.HAND ? 'hand-to-muted' : 'mute';\n            break;\n          case states.UNMUTED:\n            partName = 'unmute';\n            break;\n        }\n\n        return this.getItem().getPart(partName);\n      }\n    });\n\n    const className = 'group-call-microphone-icon';\n    this.container.classList.add(className + '-container');\n\n    const parts: RLottieIconItemPartOptions[] = [{\n      startFrame: 0,\n      endFrame: 35,\n      name: 'hand-to-muted'\n    }, {\n      startFrame: 36,\n      endFrame: 68,\n      name: 'unmute'\n    }, {\n      startFrame: 69,\n      endFrame: 98,\n      name: 'mute'\n    }, {\n      startFrame: 99,\n      endFrame: 135,\n      name: 'muted-to-hand'\n    }, {\n      startFrame: 136,\n      endFrame: 172,\n      name: 'unmuted-to-hand'\n    }, {\n      startFrame: 173,\n      endFrame: 201,\n      name: 'scheduled-crossing'\n    }, {\n      startFrame: 202,\n      endFrame: 236,\n      name: 'scheduled-to-muted'\n    }, {\n      startFrame: 237,\n      endFrame: 273,\n      name: 'scheduled-to-hand'\n    }, {\n      startFrame: 274,\n      endFrame: 310,\n      name: 'scheduled-crossed-to-hand'\n    }, {\n      startFrame: 311,\n      endFrame: 343,\n      name: 'scheduled-uncrossing'\n    }, {\n      startFrame: 344,\n      endFrame: 375,\n      name: 'scheduled-to-muted'\n    }, {\n      startFrame: 376,\n      endFrame: 403,\n      name: 'play-to-muted'\n    }];\n\n    this.add({\n      name: 'voip_filled',\n      parts\n    });\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport RLottieIcon from '../../lib/rlottie/rlottieIcon';\nimport {GROUP_CALL_PARTICIPANT_CLEARED_MUTED_STATE, GROUP_CALL_PARTICIPANT_MUTED_STATE, getColorByMutedState, clearMutedStateModifier} from '.';\nimport {SuperRLottieIcon} from '../superIcon';\n\nexport default class GroupCallParticipantMutedIcon extends SuperRLottieIcon<{\n  PartState: GROUP_CALL_PARTICIPANT_CLEARED_MUTED_STATE,\n  ColorState: GROUP_CALL_PARTICIPANT_MUTED_STATE\n}> {\n  constructor(private colored: boolean) {\n    super({\n      width: 32,\n      height: 32,\n      getPart: (state, prevState) => {\n        const states = GROUP_CALL_PARTICIPANT_MUTED_STATE;\n\n        let index: number;\n        switch(state) {\n          case states.HAND:\n            index = 3;\n            break;\n          case states.MUTED:\n            index = prevState === states.HAND ? 0 : 2;\n            break;\n          case states.UNMUTED:\n            index = 1;\n            break;\n        }\n\n        return this.getItem().getPart(index);\n      },\n      getColor: colored ? (state, prevState) => {\n        return getColorByMutedState(state);\n      } : undefined\n    });\n\n    const className = 'group-call-participant-muted-icon';\n    this.container.classList.add(className + '-container');\n\n    const parts = RLottieIcon.generateEqualParts(4, 21);\n    this.add({\n      name: 'voice_outlined2',\n      parts\n    });\n  }\n\n  public setState(state: GROUP_CALL_PARTICIPANT_MUTED_STATE) {\n    return super.setState(clearMutedStateModifier(state), state);\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport PopupElement from '../popups';\nimport {hexToRgb} from '../../helpers/color';\nimport {attachClickEvent} from '../../helpers/dom/clickEvent';\nimport customProperties from '../../helpers/dom/customProperties';\nimport {GroupCall, GroupCallParticipant} from '../../layer';\nimport type {AppChatsManager} from '../../lib/appManagers/appChatsManager';\nimport type {AppGroupCallsManager} from '../../lib/appManagers/appGroupCallsManager';\nimport type {AppPeersManager} from '../../lib/appManagers/appPeersManager';\nimport GROUP_CALL_STATE from '../../lib/calls/groupCallState';\nimport {RLottieColor} from '../../lib/rlottie/rlottiePlayer';\nimport rootScope from '../../lib/rootScope';\nimport ButtonIcon from '../buttonIcon';\nimport GroupCallMicrophoneIcon from './microphoneIcon';\nimport GroupCallParticipantsElement from './participants';\nimport GroupCallParticipantsVideoElement from './participantVideos';\nimport PopupPeer from '../popups/peer';\nimport GroupCallDescriptionElement from './description';\nimport GroupCallTitleElement from './title';\nimport {addFullScreenListener, cancelFullScreen, isFullScreen, requestFullScreen} from '../../helpers/dom/fullScreen';\nimport Scrollable from '../scrollable';\nimport {MovableState} from '../movableElement';\nimport animationIntersector from '../animationIntersector';\nimport {IS_APPLE_MOBILE} from '../../environment/userAgent';\nimport throttle from '../../helpers/schedulers/throttle';\nimport IS_SCREEN_SHARING_SUPPORTED from '../../environment/screenSharingSupport';\nimport GroupCallInstance from '../../lib/calls/groupCallInstance';\nimport makeButton from '../call/button';\nimport MovablePanel from '../../helpers/movablePanel';\nimport findUpClassName from '../../helpers/dom/findUpClassName';\nimport safeAssign from '../../helpers/object/safeAssign';\nimport toggleClassName from '../../helpers/toggleClassName';\nimport {AppManagers} from '../../lib/appManagers/managers';\nimport themeController from '../../helpers/themeController';\nimport groupCallsController from '../../lib/calls/groupCallsController';\n\nexport enum GROUP_CALL_PARTICIPANT_MUTED_STATE {\n  UNMUTED,\n  MUTED,\n  MUTED_FOR_ME,\n  MUTED_BY_ADMIN,\n  HAND\n}\n\nexport type GROUP_CALL_PARTICIPANT_CLEARED_MUTED_STATE = Exclude<GROUP_CALL_PARTICIPANT_MUTED_STATE, GROUP_CALL_PARTICIPANT_MUTED_STATE.MUTED_BY_ADMIN | GROUP_CALL_PARTICIPANT_MUTED_STATE.MUTED_FOR_ME>;\n\nexport function getGroupCallParticipantMutedState(participant: GroupCallParticipant) {\n  const states = GROUP_CALL_PARTICIPANT_MUTED_STATE;\n  if(participant.pFlags.muted_by_you) {\n    return states.MUTED_FOR_ME;\n  } else if(participant.raise_hand_rating !== undefined) {\n    return states.HAND;\n  } else if(participant.pFlags.muted) {\n    return participant.pFlags.can_self_unmute ? states.MUTED : states.MUTED_BY_ADMIN;\n  } else {\n    return states.UNMUTED;\n  }\n}\n\nexport function clearMutedStateModifier(state: GROUP_CALL_PARTICIPANT_MUTED_STATE): GROUP_CALL_PARTICIPANT_CLEARED_MUTED_STATE {\n  const states = GROUP_CALL_PARTICIPANT_MUTED_STATE;\n  switch(state) {\n    case states.MUTED_BY_ADMIN:\n    case states.MUTED_FOR_ME:\n      return states.MUTED;\n    default:\n      return state;\n  }\n}\n\nexport function getColorByMutedState(state: GROUP_CALL_PARTICIPANT_MUTED_STATE) {\n  const states = GROUP_CALL_PARTICIPANT_MUTED_STATE;\n  let colorStr: 'blue' | 'green' | 'secondary' | 'red';\n  switch(state) {\n    case states.HAND:\n      colorStr = 'blue';\n      break;\n    case states.MUTED:\n    case states.MUTED_FOR_ME:\n    case states.MUTED_BY_ADMIN:\n      colorStr = state === states.MUTED ? 'secondary' : 'red';\n      break;\n    case states.UNMUTED:\n      colorStr = 'green';\n      break;\n  }\n\n  const propertyValue = customProperties.getProperty('gc-' + colorStr + '-text-color');\n  const color: RLottieColor = hexToRgb(propertyValue);\n\n  return color;\n}\n\nexport enum GROUP_CALL_MICROPHONE_BUTTON_STATE {\n  HAND,\n  MUTED,\n  UNMUTED,\n}\n\nexport function getGroupCallMicrophoneButtonState(groupCall: GroupCall.groupCall, participant: GroupCallParticipant) {\n  const states = GROUP_CALL_MICROPHONE_BUTTON_STATE;\n  if(!participant.pFlags.can_self_unmute) {\n    return states.HAND;\n  } else if(participant.pFlags.muted) {\n    return states.MUTED\n  } else {\n    return states.UNMUTED;\n  }\n}\n\nlet previousState: MovableState = {\n  width: 420,\n  height: 640\n};\n\nconst className = 'group-call';\n\nexport default class PopupGroupCall extends PopupElement {\n  private instance: GroupCallInstance;\n  private groupCallTitle: GroupCallTitleElement;\n  private groupCallDescription: GroupCallDescriptionElement;\n  private groupCallBodyHeaderDescription: GroupCallDescriptionElement;\n  private groupCallParticipants: GroupCallParticipantsElement;\n  private groupCallParticipantsVideo: GroupCallParticipantsVideoElement;\n  private groupCallMicrophoneIcon: GroupCallMicrophoneIcon;\n  private videosCount: number;\n  private btnFullScreen: HTMLButtonElement;\n  private btnExitFullScreen: HTMLButtonElement;\n  private btnInvite: HTMLButtonElement;\n  private btnShowColumn: HTMLButtonElement;\n  private movablePanel: MovablePanel;\n  private buttonsContainer: HTMLDivElement;\n  private btnFullScreen2: HTMLButtonElement;\n  private btnVideo: HTMLDivElement;\n  private btnScreen: HTMLDivElement;\n\n  constructor() {\n    super('popup-group-call', {\n      body: true,\n      withoutOverlay: true,\n      closable: true,\n      title: true\n    });\n\n    this.videosCount = 0;\n    this.container.classList.add(className, 'night');\n\n    const instance = this.instance = groupCallsController.groupCall;\n    const {listenerSetter} = this;\n\n    if(!IS_APPLE_MOBILE) {\n      const btnFullScreen = this.btnFullScreen = ButtonIcon('fullscreen');\n      const btnFullScreen2 = this.btnFullScreen2 = ButtonIcon('fullscreen ' + className + '-cfs');\n      const btnExitFullScreen = this.btnExitFullScreen = ButtonIcon('smallscreen');\n\n      attachClickEvent(btnFullScreen, this.onFullScreenClick, {listenerSetter});\n      attachClickEvent(btnFullScreen2, this.onFullScreenClick, {listenerSetter});\n\n      attachClickEvent(btnExitFullScreen, () => {\n        cancelFullScreen();\n      }, {listenerSetter});\n\n      addFullScreenListener(this.container, this.onFullScreenChange, listenerSetter);\n    }\n\n    const btnInvite = this.btnInvite = ButtonIcon('adduser');\n    const btnShowColumn = this.btnShowColumn = ButtonIcon('rightpanel ' + className + '-only-big');\n\n    attachClickEvent(btnShowColumn, this.toggleRightColumn, {listenerSetter});\n\n    const headerInfo = document.createElement('div');\n    headerInfo.classList.add(className + '-header-info');\n\n    this.title.classList.add(className + '-header-title');\n\n    const subtitle = document.createElement('div');\n    subtitle.classList.add(className + '-header-subtitle');\n\n    headerInfo.append(this.title, subtitle);\n\n    this.header.classList.add(className + '-header');\n    this.header.append(...[this.btnExitFullScreen, headerInfo/* , btnInvite */, this.btnFullScreen, btnShowColumn].filter(Boolean));\n\n    const newHeader = this.header.cloneNode(false) as HTMLElement;\n    const newHeaderInfo = headerInfo.cloneNode(false) as HTMLElement;\n    const newHeaderTitle = this.title.cloneNode(false) as HTMLElement;\n\n    newHeaderInfo.append(newHeaderTitle);\n\n    const btnHideColumn = ButtonIcon('rightpanel');\n    newHeader.append(...[btnHideColumn, newHeaderInfo, this.btnFullScreen2].filter(Boolean));\n\n    attachClickEvent(btnHideColumn, this.toggleRightColumn, {listenerSetter});\n\n    this.body.prepend(newHeader);\n\n    const videosScrollable = new Scrollable(undefined);\n    videosScrollable.container.classList.add('group-call-big-video-container');\n    this.container.append(videosScrollable.container);\n\n    this.groupCallTitle = new GroupCallTitleElement(this.title);\n    this.groupCallDescription = new GroupCallDescriptionElement(subtitle);\n    this.groupCallBodyHeaderDescription = new GroupCallDescriptionElement(newHeaderTitle);\n    this.constructButtons();\n\n    this.groupCallParticipantsVideo = new GroupCallParticipantsVideoElement({\n      appendTo: videosScrollable.container,\n      instance,\n      listenerSetter,\n      displayPinned: true,\n      onLengthChange: (length) => {\n        this.videosCount = length;\n        this.toggleBigLayout();\n      },\n      managers: this.managers\n    });\n    this.groupCallParticipants = new GroupCallParticipantsElement({\n      appendTo: this.body,\n      instance,\n      listenerSetter,\n      managers: this.managers\n    });\n\n    this.movablePanel = new MovablePanel({\n      listenerSetter,\n      movableOptions: {\n        minWidth: 400,\n        minHeight: 480,\n        element: this.element,\n        verifyTouchTarget: (e) => {\n          const target = e.target;\n          if(findUpClassName(target, 'chatlist') ||\n            findUpClassName(target, 'group-call-button') ||\n            findUpClassName(target, 'btn-icon') ||\n            findUpClassName(target, 'group-call-participants-video-container') ||\n            isFullScreen()) {\n            return false;\n          }\n\n          return true;\n        }\n      },\n      onResize: () => this.toggleBigLayout(),\n      previousState\n    });\n\n    listenerSetter.add(instance)('state', () => {\n      this.updateInstance();\n    });\n\n    listenerSetter.add(rootScope)('group_call_update', (groupCall) => {\n      if(this.instance?.id === groupCall.id) {\n        this.updateInstance();\n      }\n    });\n\n    listenerSetter.add(instance)('pinned', () => {\n      this.setHasPinned();\n    });\n\n    listenerSetter.add(this.groupCallParticipantsVideo)('toggleControls', this.onToggleControls);\n\n    this.addEventListener('close', () => {\n      const {movablePanel} = this;\n      previousState = movablePanel.state;\n\n      this.groupCallParticipantsVideo.destroy();\n      this.groupCallParticipants.destroy();\n      this.groupCallMicrophoneIcon.destroy();\n\n      movablePanel.destroy();\n    });\n\n    this.toggleRightColumn();\n    this.onFullScreenChange();\n\n    this.updateInstance();\n  }\n\n  private constructButtons() {\n    const buttons = this.buttonsContainer = document.createElement('div');\n    buttons.classList.add(className + '-buttons');\n\n    const _makeButton = makeButton.bind(null, className, this.listenerSetter);\n\n    const btnVideo = this.btnVideo = _makeButton({\n      // text: 'VoiceChat.Video.Stream.Video',\n      callback: this.onVideoClick,\n      icon: 'videocamera_filled'\n    });\n\n    const btnScreen = this.btnScreen = _makeButton({\n      // text: 'VoiceChat.Video.Stream.Screencast',\n      callback: this.onScreenClick,\n      icon: 'sharescreen_filled'\n    });\n\n    btnScreen.classList.toggle('hide', !IS_SCREEN_SHARING_SUPPORTED);\n\n    const btnMute = _makeButton({\n      noRipple: true,\n      callback: throttle(this.onMuteClick, 600, true)\n    });\n    btnMute.classList.add(className + '-microphone-button');\n\n    const microphoneIcon = this.groupCallMicrophoneIcon = new GroupCallMicrophoneIcon();\n    btnMute.append(microphoneIcon.container);\n\n    const btnMore = _makeButton({\n      // text: 'VoiceChat.Video.Stream.More'\n      icon: 'settings_filled'\n    });\n\n    btnMore.classList.add('btn-disabled');\n    btnMore.classList.toggle('hide', !IS_SCREEN_SHARING_SUPPORTED);\n\n    const btnLeave = _makeButton({\n      // text: 'VoiceChat.Leave',\n      isDanger: true,\n      callback: this.onLeaveClick,\n      icon: 'close'\n    });\n\n    buttons.append(btnVideo, btnScreen, btnMute, btnMore, btnLeave);\n\n    this.container.append(buttons);\n  }\n\n  private onFullScreenClick = () => {\n    requestFullScreen(this.container);\n  };\n\n  private onToggleControls = (show: boolean) => {\n    this.container.classList.toggle('show-controls', show);\n    this.buttonsContainer.classList.toggle('show-controls', show);\n  };\n\n  private toggleDisability = toggleClassName.bind(null, 'btn-disabled');\n\n  private onVideoClick = () => {\n    const toggle = this.toggleDisability([this.btnVideo], true);\n    this.instance.toggleVideoSharing().finally(() => {\n      toggle();\n    });\n  };\n\n  private onScreenClick = () => {\n    const toggle = this.toggleDisability([this.btnScreen], true);\n    this.instance.toggleScreenSharing().finally(() => {\n      toggle();\n    });\n  };\n\n  private onMuteClick = () => {\n    const participant = this.instance.participant;\n    if(!participant.pFlags.can_self_unmute) {\n      if(participant.raise_hand_rating === undefined) {\n        this.instance.changeRaiseHand(true);\n      }\n    } else {\n      this.instance.toggleMuted();\n    }\n  };\n\n  private onLeaveClick = async() => {\n    const hangUp = (discard: boolean) => {\n      this.instance.hangUp(discard);\n    };\n\n    if(await this.managers.appChatsManager.hasRights(this.instance.chatId, 'manage_call')) {\n      new PopupPeer('popup-end-video-chat', {\n        titleLangKey: 'VoiceChat.End.Title',\n        descriptionLangKey: 'VoiceChat.End.Text',\n        checkboxes: [{\n          text: 'VoiceChat.End.Third'\n        }],\n        buttons: [{\n          langKey: 'VoiceChat.End.OK',\n          callback: (checkboxes) => {\n            hangUp(!!checkboxes.size);\n          },\n          isDanger: true\n        }]\n      }).show();\n    } else {\n      hangUp(false);\n    }\n  };\n\n  public getContainer() {\n    return this.container;\n  }\n\n  private onFullScreenChange = () => {\n    this.toggleBigLayout();\n    const isFull = isFullScreen();\n\n    const {btnFullScreen, btnExitFullScreen} = this;\n\n    const wasFullScreen = this.container.classList.contains('is-full-screen');\n    this.container.classList.toggle('is-full-screen', isFull);\n    btnFullScreen && btnFullScreen.classList.toggle('hide', isFull);\n    btnExitFullScreen && btnExitFullScreen.classList.toggle('hide', !isFull);\n    this.btnClose.classList.toggle('hide', isFull);\n\n    if(isFull !== wasFullScreen) {\n      animationIntersector.checkAnimations(isFull);\n\n      themeController.setThemeColor(isFull ? '#000000' : undefined);\n    }\n  };\n\n  private toggleBigLayout = () => {\n    const isFull = isFullScreen();\n    const movable = this.movablePanel?.movable;\n    const isBig = (isFull || !!(movable && movable.width >= 680)) && !!this.videosCount;\n\n    /* if(!isBig && isFull) {\n      cancelFullScreen();\n      return;\n    } */\n\n    const wasBig = this.container.classList.contains('is-big-layout');\n    let buttons: HTMLElement[];\n    if(isBig && !wasBig) { // fix buttons transition to 0 opacity\n      buttons = Array.from(this.buttonsContainer.children) as HTMLElement[];\n      buttons.forEach((element) => {\n        element.style.opacity = '0';\n      });\n\n      void this.buttonsContainer.offsetLeft;\n    }\n\n    this.container.classList.toggle('is-big-layout', isBig);\n    this.btnInvite.classList.toggle('hide', isBig);\n    this.btnShowColumn.classList.toggle('hide', !isBig);\n\n    if(buttons) {\n      // window.requestAnimationFrame(() => {\n      buttons.forEach((element) => {\n        element.style.opacity = '';\n      });\n      // });\n    }\n  };\n\n  private toggleRightColumn = () => {\n    this.container.classList.toggle('is-right-column-shown');\n  };\n\n  private setHasPinned() {\n    this.container.classList.toggle('has-pinned', !!this.instance.pinnedSource);\n  }\n\n  private updateInstance() {\n    if(this.instance.state === GROUP_CALL_STATE.CLOSED) {\n      if(this.container.classList.contains('is-full-screen')) {\n        cancelFullScreen();\n      }\n\n      this.hide();\n      return;\n    }\n\n    const {participant, groupCall} = this.instance;\n    if(!participant) {\n      return;\n    }\n\n    this.setTitle();\n    this.setDescription();\n    this.setHasPinned();\n\n    const microphoneButtonState = getGroupCallMicrophoneButtonState(groupCall as any, participant);\n    this.container.dataset.micState = microphoneButtonState === GROUP_CALL_MICROPHONE_BUTTON_STATE.HAND ? 'hand' : (microphoneButtonState === GROUP_CALL_MICROPHONE_BUTTON_STATE.MUTED ? 'muted' : 'unmuted');\n    this.groupCallMicrophoneIcon.setState(microphoneButtonState);\n  }\n\n  private setTitle() {\n    this.groupCallTitle.update(this.instance);\n  }\n\n  private setDescription() {\n    this.groupCallDescription.update(this.instance);\n    this.groupCallBodyHeaderDescription.update(this.instance);\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport replaceContent from '../../helpers/dom/replaceContent';\nimport setInnerHTML from '../../helpers/dom/setInnerHTML';\nimport {GroupCallParticipant} from '../../layer';\nimport {i18n} from '../../lib/langPack';\nimport {GROUP_CALL_PARTICIPANT_MUTED_STATE} from '.';\nimport {GroupCallParticipantVideoType} from './participantVideo';\nimport wrapEmojiText from '../../lib/richTextProcessor/wrapEmojiText';\n\nconst className = 'group-call-participant-status';\nexport default class GroupCallParticipantStatusElement {\n  public container: HTMLElement;\n\n  constructor(private withIcons: GroupCallParticipantVideoType[]) {\n    this.container = document.createElement('div');\n    this.container.classList.add(className + '-container');\n  }\n\n  public setState(state: GROUP_CALL_PARTICIPANT_MUTED_STATE, participant: GroupCallParticipant) {\n    const states = GROUP_CALL_PARTICIPANT_MUTED_STATE;\n    const icons = this.withIcons.filter((type) => !!participant[type]).map((type) => {\n      const iconClassName = `tgico-${type === 'presentation' ? 'listscreenshare' : 'videocamera_filled'}`;\n      const i = document.createElement('i');\n      i.classList.add(className + '-icon', className + '-icon-' + type, iconClassName);\n      return i;\n    });\n\n    let element2: HTMLElement, actionClassName: string;\n    if(state === states.MUTED_FOR_ME) {\n      element2 = i18n('VoiceChat.Status.MutedForYou');\n      actionClassName = 'is-muted';\n    } else if(state === states.UNMUTED) {\n      element2 = i18n('VoiceChat.Status.Speaking');\n      actionClassName = 'is-speaking';\n    } else if(state === states.HAND) {\n      element2 = i18n('VoiceChat.Status.WantsSpeak');\n      actionClassName = 'is-waiting';\n    } else if(participant.about && !icons.length) {\n      setInnerHTML(this.container, wrapEmojiText(participant.about));\n      return;\n    } else {\n      element2 = i18n('VoiceChat.Status.Listening');\n      actionClassName = 'is-listening';\n    }\n\n    const span = document.createElement('span');\n    span.classList.add(className, actionClassName);\n    span.append(...icons, element2);\n\n    replaceContent(this.container, span);\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport positionElementByIndex from '../../helpers/dom/positionElementByIndex';\nimport replaceContent from '../../helpers/dom/replaceContent';\nimport {fastRaf} from '../../helpers/schedulers';\nimport SortedList, {SortedElementBase} from '../../helpers/sortedList';\nimport {GroupCallParticipant} from '../../layer';\nimport appDialogsManager, {DialogDom, AppDialogsManager} from '../../lib/appManagers/appDialogsManager';\nimport {getGroupCallParticipantMutedState} from '.';\nimport GroupCallParticipantMutedIcon from './participantMutedIcon';\nimport GroupCallParticipantStatusElement from './participantStatus';\nimport type GroupCallInstance from '../../lib/calls/groupCallInstance';\nimport type LazyLoadQueue from '../lazyLoadQueue';\n\ninterface SortedParticipant extends SortedElementBase {\n  dom: DialogDom,\n  mutedIcon: GroupCallParticipantMutedIcon,\n  status: GroupCallParticipantStatusElement\n}\n\nexport default class GroupCallParticipantsList extends SortedList<SortedParticipant> {\n  public list: HTMLUListElement;\n\n  protected lazyLoadQueue: LazyLoadQueue;\n  protected avatarSize = 54;\n  protected rippleEnabled = true;\n  protected autonomous = true;\n  protected createChatListOptions: Parameters<AppDialogsManager['createChatList']>[0] = {/* new: true,  */dialogSize: 72};\n\n  constructor(private instance: GroupCallInstance) {\n    super({\n      getIndex: async(element) => (await this.instance.getParticipantByPeerId(element.id)).date,\n      onDelete: (element) => {\n        element.dom.listEl.remove();\n        this.onElementDestroy(element);\n      },\n      onUpdate: async(element) => {\n        const participant = await this.instance.getParticipantByPeerId(element.id);\n        const state = getGroupCallParticipantMutedState(participant);\n\n        element.mutedIcon.setState(state);\n        element.status.setState(state, participant);\n      },\n      onSort: (element, idx) => {\n        positionElementByIndex(element.dom.listEl, this.list, idx);\n      },\n      onElementCreate: (base) => {\n        const {dom} = appDialogsManager.addDialogNew({\n          peerId: base.id,\n          container: false,\n          avatarSize: this.avatarSize,\n          autonomous: this.autonomous,\n          meAsSaved: false,\n          rippleEnabled: this.rippleEnabled,\n          lazyLoadQueue: this.lazyLoadQueue\n        });\n\n        const className = 'group-call-participant';\n        dom.listEl.classList.add(className);\n\n        const mutedIcon = new GroupCallParticipantMutedIcon(true);\n        const status = new GroupCallParticipantStatusElement(['presentation', 'video']);\n        replaceContent(dom.lastMessageSpan, status.container);\n        dom.listEl.append(mutedIcon.container);\n        (base as SortedParticipant).mutedIcon = mutedIcon;\n        (base as SortedParticipant).status = status;\n\n        /* instance.getParticipantByPeerId(base.id).then((participant) => {\n          const mutedState = getGroupCallParticipantMutedState(participant);\n\n          mutedIcon.setState(mutedState);\n          status.setState(mutedState, participant);\n        }); */\n\n        (base as SortedParticipant).dom = dom;\n\n        return base as SortedParticipant;\n      },\n      updateElementWith: fastRaf\n    });\n\n    this.list = appDialogsManager.createChatList(this.createChatListOptions);\n  }\n\n  public destroy() {\n    this.elements.forEach((element) => {\n      this.onElementDestroy(element);\n    });\n  }\n\n  protected onElementDestroy(element: SortedParticipant) {\n    element.mutedIcon.destroy();\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport {animate} from '../../helpers/animation';\n\nexport default function callVideoCanvasBlur(video: HTMLVideoElement) {\n  const canvas = document.createElement('canvas');\n  canvas.classList.add('call-video-blur');\n  const size = 16;\n  canvas.width = size;\n  canvas.height = size;\n\n  const ctx = canvas.getContext('2d', {alpha: false});\n  ctx.filter = 'blur(2px)';\n  const renderFrame = () => {\n    ctx.drawImage(video, 0, 0, video.videoWidth, video.videoHeight, 0, 0, canvas.width, canvas.height);\n  };\n\n  animate(() => {\n    renderFrame();\n    return canvas.isConnected;\n  });\n\n  renderFrame();\n\n  return canvas;\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport {GroupCallParticipant} from '../../layer';\nimport type {GroupCallOutputSource} from '../../lib/appManagers/appGroupCallsManager';\nimport {i18n} from '../../lib/langPack';\nimport PeerTitle from '../peerTitle';\nimport {getGroupCallParticipantMutedState} from '.';\nimport GroupCallParticipantMutedIcon from './participantMutedIcon';\nimport GroupCallParticipantStatusElement from './participantStatus';\nimport GroupCallInstance from '../../lib/calls/groupCallInstance';\nimport callVideoCanvasBlur from '../call/videoCanvasBlur';\nimport getPeerId from '../../lib/appManagers/utils/peers/getPeerId';\nimport {AppManagers} from '../../lib/appManagers/managers';\n\nconst className = 'group-call-participant-video';\n\nexport type GroupCallParticipantVideoType = 'video' | 'presentation';\nexport default class GroupCallParticipantVideoElement {\n  public container: HTMLElement;\n  private peerTitle: PeerTitle;\n  private subtitle: HTMLElement;\n  private info: HTMLElement;\n  private left: HTMLElement;\n  private right: HTMLElement;\n  private header: HTMLElement;\n  private groupCallParticipantMutedIcon: GroupCallParticipantMutedIcon;\n  private groupCallParticipantStatus: GroupCallParticipantStatusElement;\n\n  constructor(private managers: AppManagers, private instance: GroupCallInstance, public source: GroupCallOutputSource) {\n    this.container = document.createElement('div');\n    this.container.classList.add(className + '-container');\n\n    this.info = document.createElement('div');\n    this.info.classList.add(className + '-info');\n\n    this.left = document.createElement('div');\n    this.left.classList.add(className + '-info-left');\n\n    this.right = document.createElement('div');\n    this.right.classList.add(className + '-info-right');\n\n    this.info.append(this.left, this.right);\n\n    this.container.append(this.info);\n  }\n\n  public setPinned(value: boolean) {\n    if(!value) {\n      if(this.header) {\n        this.header.remove();\n        this.header = undefined;\n      }\n\n      return;\n    } else if(this.header) {\n      return;\n    }\n\n    // if(!this.header) {\n    this.header = document.createElement('div');\n    this.header.classList.add(className + '-header');\n\n    const icon = document.createElement('i');\n    icon.classList.add('group-call-pin-icon', 'tgico-pin');\n    this.header.append(icon);\n\n    this.container.append(this.header);\n    // }\n\n    // this.container.classList.toggle('is-pinned', value);\n  }\n\n  public setParticipant(participant: GroupCallParticipant, type: GroupCallParticipantVideoType, video: HTMLVideoElement) {\n    let peerTitleElement: HTMLElement;\n    if(participant.pFlags.self) {\n      peerTitleElement = i18n('VoiceChat.Status.You');\n      peerTitleElement.classList.add('peer-title');\n    } else {\n      this.peerTitle = new PeerTitle({\n        peerId: getPeerId(participant.peer)\n      });\n\n      peerTitleElement = this.peerTitle.element;\n    }\n\n    this.groupCallParticipantMutedIcon = new GroupCallParticipantMutedIcon(false);\n    this.groupCallParticipantStatus = new GroupCallParticipantStatusElement([type]);\n\n    this.left.append(peerTitleElement, this.groupCallParticipantStatus.container);\n\n    this.right.append(this.groupCallParticipantMutedIcon.container);\n\n    video.classList.add(className, 'call-video');\n\n    if(video.paused) {\n      video.play();\n    }\n\n    const canvas = callVideoCanvasBlur(video);\n    canvas.classList.add(className + '-blur');\n\n    this.container.prepend(canvas, video);\n\n    this.updateParticipant(participant);\n  }\n\n  public updateParticipant(participant: GroupCallParticipant) {\n    const state = getGroupCallParticipantMutedState(participant);\n\n    this.groupCallParticipantMutedIcon.setState(state);\n    this.groupCallParticipantStatus.setState(state, participant);\n  }\n\n  public destroy() {\n    this.groupCallParticipantMutedIcon.destroy();\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport {attachClickEvent} from '../../helpers/dom/clickEvent';\nimport ControlsHover from '../../helpers/dom/controlsHover';\nimport findUpClassName from '../../helpers/dom/findUpClassName';\nimport ListenerSetter from '../../helpers/listenerSetter';\nimport safeAssign from '../../helpers/object/safeAssign';\nimport {GroupCallParticipant} from '../../layer';\nimport {GroupCallOutputSource} from '../../lib/appManagers/appGroupCallsManager';\nimport {AppManagers} from '../../lib/appManagers/managers';\nimport getPeerId from '../../lib/appManagers/utils/peers/getPeerId';\nimport GroupCallInstance from '../../lib/calls/groupCallInstance';\nimport rootScope from '../../lib/rootScope';\nimport GroupCallParticipantVideoElement, {GroupCallParticipantVideoType} from './participantVideo';\n\nexport default class GroupCallParticipantsVideoElement extends ControlsHover {\n  private container: HTMLDivElement;\n  private instance: GroupCallInstance;\n  private participantsElements: Map<PeerId, Map<GroupCallParticipantVideoType, GroupCallParticipantVideoElement>>;\n  private displayPinned: boolean;\n  private containers: Map<HTMLElement, GroupCallParticipantVideoElement>;\n  private onLengthChange: (length: number) => void;\n  private managers: AppManagers;\n\n  constructor(options: {\n    appendTo: HTMLElement,\n    instance: GroupCallInstance,\n    listenerSetter: ListenerSetter,\n    displayPinned: boolean,\n    onLengthChange?: GroupCallParticipantsVideoElement['onLengthChange'],\n    managers: AppManagers\n  }) {\n    super();\n    safeAssign(this, options);\n\n    const className = 'group-call-participants-video';\n    const container = this.container = document.createElement('div');\n    this.container.classList.add(className + '-container');\n\n    options.appendTo.append(container);\n\n    this.participantsElements = new Map();\n    this.containers = new Map();\n\n    const {listenerSetter} = this;\n\n    listenerSetter.add(rootScope)('group_call_participant', ({groupCallId, participant}) => {\n      if(this.instance.id === groupCallId) {\n        this.updateParticipant(participant);\n      }\n    });\n\n    listenerSetter.add(this.instance)('pinned', (source) => {\n      this.participantsElements.forEach((map) => {\n        map.forEach((element) => {\n          this.setElementDisplay(element, source);\n        });\n      });\n    });\n\n    attachClickEvent(this.container, (e) => {\n      const container = findUpClassName(e.target, 'group-call-participant-video-container');\n      if(!container) {\n        return;\n      }\n\n      const element = this.containers.get(container);\n      if(this.instance.pinnedSource === element.source) {\n        this.instance.unpinAll();\n        return;\n      }\n\n      this.instance.pinSource(element.source);\n    }, {listenerSetter});\n\n    this.setInstance(this.instance);\n\n    this.setup({\n      element: container,\n      listenerSetter: listenerSetter,\n      showOnLeaveToClassName: 'group-call-buttons'\n    });\n  }\n\n  private shouldDisplayElement(element: GroupCallParticipantVideoElement, pinnedSource: GroupCallOutputSource) {\n    return this.displayPinned ? !pinnedSource || element.source === pinnedSource : pinnedSource && element.source !== pinnedSource;\n  }\n\n  private setElementDisplay(element: GroupCallParticipantVideoElement, pinnedSource: GroupCallOutputSource) {\n    const shouldDisplay = this.shouldDisplayElement(element, pinnedSource);\n    element.container.classList.toggle('video-hidden', !shouldDisplay);\n\n    const isPinned = element.source === pinnedSource;\n    element.setPinned(isPinned);\n  }\n\n  private updateParticipant(participant: GroupCallParticipant) {\n    const peerId = getPeerId(participant.peer);\n    const types: GroupCallParticipantVideoType[] = ['video', 'presentation'];\n    const hasAnyVideo = types.some((type) => !!participant[type]);\n    let participantElements = this.participantsElements.get(peerId);\n    if(!hasAnyVideo && !participantElements) {\n      return;\n    }\n\n    if(!participantElements) {\n      this.participantsElements.set(peerId, participantElements = new Map());\n    }\n\n    types.forEach((type) => {\n      let element = participantElements.get(type);\n      const participantVideo = participant[type];\n      if(!!participantVideo === !!element) {\n        if(element) {\n          element.updateParticipant(participant);\n        }\n\n        return;\n      }\n\n      if(participantVideo) {\n        const result = this.instance.getVideoElementFromParticipantByType(participant, type);\n        if(!result) {\n          return;\n        }\n\n        const {video, source} = result;\n\n        element = new GroupCallParticipantVideoElement(this.managers, this.instance, source);\n\n        this.containers.set(element.container, element);\n\n        this.setElementDisplay(element, this.instance.pinnedSource);\n        participantElements.set(type, element);\n        element.setParticipant(participant, type, video);\n\n        this.container.prepend(element.container);\n      } else {\n        participantElements.delete(type);\n        element.container.remove();\n\n        if(!participantElements.size) {\n          this.participantsElements.delete(peerId);\n          this.containers.delete(element.container);\n          element.destroy();\n        }\n      }\n\n      this._onLengthChange();\n    });\n  }\n\n  private _onLengthChange() {\n    const length = this.container.childElementCount;\n    this.container.dataset.length = '' + length;\n    this.container.dataset.layout = length <= 2 ? '1' : (length === 3 ? '3' : '4');\n\n    this.onLengthChange && this.onLengthChange(length);\n  }\n\n  public async setInstance(instance: GroupCallInstance) {\n    (await instance.participants).forEach((participant) => {\n      this.updateParticipant(participant);\n    });\n  }\n\n  public destroy() {\n    this.containers.forEach((element) => {\n      element.destroy();\n    });\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport PopupGroupCall from '.';\nimport filterAsync from '../../helpers/array/filterAsync';\nimport contextMenuController from '../../helpers/contextMenuController';\nimport {attachContextMenuListener} from '../../helpers/dom/attachContextMenuListener';\nimport cancelEvent from '../../helpers/dom/cancelEvent';\nimport findUpClassName from '../../helpers/dom/findUpClassName';\nimport {addFullScreenListener, isFullScreen} from '../../helpers/dom/fullScreen';\nimport ListenerSetter from '../../helpers/listenerSetter';\nimport noop from '../../helpers/noop';\nimport safeAssign from '../../helpers/object/safeAssign';\nimport positionMenu from '../../helpers/positionMenu';\nimport ScrollableLoader from '../../helpers/scrollableLoader';\nimport {GroupCallParticipant} from '../../layer';\nimport type {AppChatsManager} from '../../lib/appManagers/appChatsManager';\nimport type {AppGroupCallsManager} from '../../lib/appManagers/appGroupCallsManager';\nimport appImManager from '../../lib/appManagers/appImManager';\nimport type {AppPeersManager} from '../../lib/appManagers/appPeersManager';\nimport {AppManagers} from '../../lib/appManagers/managers';\nimport getPeerId from '../../lib/appManagers/utils/peers/getPeerId';\nimport GroupCallInstance from '../../lib/calls/groupCallInstance';\nimport rootScope from '../../lib/rootScope';\nimport ButtonMenu, {ButtonMenuItemOptions} from '../buttonMenu';\nimport confirmationPopup from '../confirmationPopup';\nimport PeerTitle from '../peerTitle';\nimport PopupElement from '../popups';\nimport Scrollable from '../scrollable';\nimport GroupCallParticipantsList from './participantsList';\nimport GroupCallParticipantsVideoElement from './participantVideos';\n\nexport class GroupCallParticipantContextMenu {\n  private buttons: (ButtonMenuItemOptions & {verify: (peerId: PeerId) => boolean | Promise<boolean>})[];\n  private element: HTMLDivElement;\n  private chatId: ChatId;\n  private targetPeerId: PeerId;\n  private participant: GroupCallParticipant;\n  private instance: GroupCallInstance;\n  private canManageCall: boolean;\n  private managers: AppManagers;\n\n  constructor(options: {\n    listenerSetter: ListenerSetter,\n    onContextElement: HTMLElement,\n    managers: AppManagers,\n    instance: GroupCallInstance,\n  }) {\n    this.buttons = [{\n      icon: 'gc_microphoneoff',\n      text: 'VoiceChat.MutePeer',\n      verify: () => this.canManageCall && this.participant.pFlags.can_self_unmute,\n      onClick: () => this.toggleParticipantMuted(true)\n    }, {\n      icon: 'gc_microphone',\n      text: 'VoiceChat.UnmutePeer',\n      verify: () => this.canManageCall && !this.participant.pFlags.can_self_unmute,\n      onClick: () => this.toggleParticipantMuted(false)\n    }, {\n      icon: 'gc_microphoneoff',\n      text: 'VoiceChat.MuteForMe',\n      verify: () => !this.canManageCall && !this.participant.pFlags.muted_by_you,\n      onClick: () => this.toggleParticipantMuted(true)\n    }, {\n      icon: 'gc_microphone',\n      text: 'VoiceChat.UnmuteForMe',\n      verify: () => !this.canManageCall && this.participant.pFlags.muted_by_you,\n      onClick: () => this.toggleParticipantMuted(false)\n    }, {\n      icon: 'newprivate',\n      text: 'VoiceChat.OpenProfile',\n      verify: () => true,\n      onClick: this.onOpenProfileClick\n    }, {\n      icon: 'deleteuser danger',\n      text: 'VoiceChat.RemovePeer',\n      verify: () => this.managers.appChatsManager.hasRights(this.chatId, 'ban_users'),\n      onClick: async() => {\n        confirmationPopup({\n          peerId: this.targetPeerId,\n          title: new PeerTitle({peerId: this.targetPeerId}).element,\n          descriptionLangKey: await this.managers.appChatsManager.isBroadcast(this.chatId) ? 'VoiceChat.RemovePeer.Confirm.Channel' : 'VoiceChat.RemovePeer.Confirm',\n          descriptionLangArgs: [new PeerTitle({peerId: this.targetPeerId}).element],\n          button: {\n            langKey: 'VoiceChat.RemovePeer.Confirm.OK',\n            isDanger: true\n          }\n        }).then(() => {\n          this.managers.appChatsManager.kickFromChat(this.chatId, this.targetPeerId);\n        }, noop);\n      }\n    }];\n\n    const {listenerSetter} = options;\n    this.managers = options.managers;\n    this.instance = options.instance;\n    this.chatId = this.instance.chatId;\n\n    this.element = ButtonMenu(this.buttons, listenerSetter);\n    this.element.classList.add('group-call-participant-menu', 'night');\n\n    attachContextMenuListener(options.onContextElement, async(e: any) => {\n      const li = findUpClassName(e.target, 'group-call-participant');\n      if(!li) {\n        return;\n      }\n\n      if(this.element.parentElement !== appendTo) {\n        appendTo.append(this.element);\n      }\n\n      cancelEvent(e);\n\n      const peerId = this.targetPeerId = li.dataset.peerId.toPeerId();\n      this.participant = await this.instance.getParticipantByPeerId(peerId);\n      if(this.participant.pFlags.self) {\n        return;\n      }\n\n      this.canManageCall = await this.managers.appChatsManager.hasRights(this.chatId, 'manage_call');\n\n      await filterAsync(this.buttons, async(button) => {\n        const good = await button.verify(peerId);\n        button.element.classList.toggle('hide', !good);\n        return good;\n      });\n\n      positionMenu((e as TouchEvent).touches ? (e as TouchEvent).touches[0] : e as MouseEvent, this.element, 'right');\n      contextMenuController.openBtnMenu(this.element);\n    }, listenerSetter);\n\n    listenerSetter.add(rootScope)('group_call_participant', ({groupCallId, participant}) => {\n      if(this.instance.id === groupCallId) {\n        const peerId = getPeerId(participant.peer);\n        if(this.targetPeerId === peerId) {\n          contextMenuController.close();\n        }\n      }\n    });\n\n    let appendTo: HTMLElement = document.body;\n    addFullScreenListener(document.body, () => {\n      const isFull = isFullScreen();\n      appendTo = isFull ? PopupElement.getPopups(PopupGroupCall)[0].getContainer(): document.body;\n\n      if(!isFull) {\n        contextMenuController.close();\n      }\n    }, listenerSetter);\n  }\n\n  private onOpenProfileClick = () => {\n    const popup = PopupElement.getPopups(PopupGroupCall)[0];\n    if(popup) {\n      popup.hide();\n    }\n\n    appImManager.setInnerPeer({peerId: this.targetPeerId});\n  };\n\n  private toggleParticipantMuted = (muted: boolean) => {\n    this.instance.editParticipant(this.participant, {\n      muted\n    });\n  };\n};\n\nexport default class GroupCallParticipantsElement {\n  private container: HTMLDivElement;\n  private sortedList: GroupCallParticipantsList;\n  private instance: GroupCallInstance;\n  private listenerSetter: ListenerSetter;\n  private groupCallParticipantsVideo: GroupCallParticipantsVideoElement;\n  private contextMenu: GroupCallParticipantContextMenu;\n  private managers: AppManagers;\n\n  constructor(options: {\n    appendTo: HTMLElement,\n    instance: GroupCallInstance,\n    listenerSetter: ListenerSetter,\n    managers: AppManagers\n  }) {\n    safeAssign(this, options);\n\n    const className = 'group-call-participants';\n\n    const scrollable = new Scrollable(undefined);\n    scrollable.container.classList.add(className + '-scrollable');\n\n    const container = this.container = document.createElement('div');\n    container.classList.add(className);\n\n    // const invite = Button(`btn-primary btn-transparent ${className}-invite`, {icon: 'adduser', text: 'VoiceChat.Invite.InviteMembers'});\n\n    const sortedList = this.sortedList = new GroupCallParticipantsList(this.instance);\n\n    const {instance, listenerSetter} = this;\n    this.contextMenu = new GroupCallParticipantContextMenu({\n      ...options,\n      onContextElement: sortedList.list,\n      listenerSetter,\n      instance\n    });\n\n    this.groupCallParticipantsVideo = new GroupCallParticipantsVideoElement({\n      ...options,\n      appendTo: scrollable.container,\n      displayPinned: false\n    });\n\n    scrollable.append(/* invite,  */sortedList.list);\n    container.append(scrollable.container);\n\n    options.appendTo.append(container);\n\n    listenerSetter.add(rootScope)('group_call_participant', ({groupCallId, participant}) => {\n      if(this.instance.id === groupCallId) {\n        this.updateParticipant(participant);\n      }\n    });\n\n    const scrollableLoader = new ScrollableLoader({\n      scrollable,\n      getPromise: () => {\n        return this.managers.appGroupCallsManager.getGroupCallParticipants(this.instance.id).then(({participants, isEnd}) => {\n          participants.forEach((participant) => {\n            this.updateParticipant(participant);\n          });\n\n          return isEnd;\n        });\n      }\n    });\n\n    this.setInstance(instance);\n  }\n\n  private updateParticipant(participant: GroupCallParticipant) {\n    const peerId = getPeerId(participant.peer);\n    const has = this.sortedList.has(peerId);\n    if(participant.pFlags.left) {\n      if(has) {\n        this.sortedList.delete(peerId);\n      }\n\n      return;\n    }\n\n    if(!has) {\n      this.sortedList.add(peerId);\n      return;\n    }\n\n    this.sortedList.update(peerId);\n  }\n\n  public async setInstance(instance: GroupCallInstance) {\n    // @ts-ignore\n    /* const users = appUsersManager.users;\n    for(const userId in users) {\n      const participant: GroupCallParticipant = {\n        _: 'groupCallParticipant',\n        date: 0,\n        peer: {_: 'peerUser', user_id: userId.toPeerId()},\n        pFlags: {\n          muted: true\n        },\n        source: 1\n      };\n\n      instance.participants.set(userId.toPeerId(), participant);\n      this.updateParticipant(participant);\n    } */\n    const participants = await instance.participants;\n    participants.forEach((participant) => {\n      this.updateParticipant(participant);\n    });\n  }\n\n  public destroy() {\n    this.sortedList.destroy();\n    this.groupCallParticipantsVideo.destroy();\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport {GroupCall} from '../../layer';\nimport GroupCallInstance from '../../lib/calls/groupCallInstance';\nimport GROUP_CALL_STATE from '../../lib/calls/groupCallState';\nimport I18n, {LangPackKey, FormatterArguments} from '../../lib/langPack';\n\nexport default class GroupCallDescriptionElement {\n  private descriptionIntl: I18n.IntlElement;\n\n  constructor(private appendTo: HTMLElement) {\n    this.descriptionIntl = new I18n.IntlElement({\n      key: 'VoiceChat.Status.Connecting'\n    });\n\n    this.descriptionIntl.element.classList.add('group-call-description');\n  }\n\n  public detach() {\n    this.descriptionIntl.element.remove();\n  }\n\n  public update(instance: GroupCallInstance) {\n    const {state} = instance;\n\n    let key: LangPackKey, args: FormatterArguments;\n    if(state === GROUP_CALL_STATE.CONNECTING) {\n      key = 'VoiceChat.Status.Connecting';\n    } else {\n      key = 'VoiceChat.Status.Members';\n      args = [(instance.groupCall as GroupCall.groupCall).participants_count];\n    }\n\n    const {descriptionIntl} = this;\n    descriptionIntl.compareAndUpdate({\n      key,\n      args\n    });\n\n    if(!this.descriptionIntl.element.parentElement) {\n      this.appendTo.append(this.descriptionIntl.element);\n    }\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport setInnerHTML from '../../helpers/dom/setInnerHTML';\nimport {GroupCall} from '../../layer';\nimport GroupCallInstance from '../../lib/calls/groupCallInstance';\nimport wrapEmojiText from '../../lib/richTextProcessor/wrapEmojiText';\nimport PeerTitle from '../peerTitle';\n\nexport default class GroupCallTitleElement {\n  private peerTitle: PeerTitle;\n\n  constructor(private appendTo: HTMLElement) {\n    this.peerTitle = new PeerTitle({peerId: 0});\n  }\n\n  public update(instance: GroupCallInstance) {\n    const {peerTitle, appendTo} = this;\n    const groupCall = instance.groupCall as GroupCall.groupCall;\n    const peerId = instance.chatId.toPeerId(true);\n    if(groupCall.title) {\n      setInnerHTML(appendTo, wrapEmojiText(groupCall.title));\n    } else {\n      if(peerTitle.peerId !== peerId) {\n        peerTitle.peerId = peerId;\n        peerTitle.update();\n      }\n\n      if(peerTitle.element.parentElement !== appendTo) {\n        appendTo.append(peerTitle.element);\n      }\n    }\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport {attachClickEvent} from '../../helpers/dom/clickEvent';\nimport ListenerSetter from '../../helpers/listenerSetter';\nimport {i18n, LangPackKey} from '../../lib/langPack';\nimport ripple from '../ripple';\n\nexport default function makeButton(className: string, listenerSetter: ListenerSetter, options: {\n  text?: LangPackKey | HTMLElement,\n  isDanger?: boolean,\n  noRipple?: boolean,\n  callback?: () => void,\n  icon?: string,\n  isConfirm?: boolean,\n}) {\n  const _className = className + '-button';\n  const buttonDiv = document.createElement('div');\n  buttonDiv.classList.add(_className, 'call-button', 'rp-overflow');\n\n  if(options.icon) {\n    buttonDiv.classList.add('tgico-' + options.icon);\n  }\n\n  if(!options.noRipple) {\n    ripple(buttonDiv);\n  }\n\n  if(options.isDanger) {\n    buttonDiv.classList.add(_className + '-red');\n  }\n\n  if(options.isConfirm) {\n    buttonDiv.classList.add(_className + '-green');\n  }\n\n  if(options.callback) {\n    attachClickEvent(buttonDiv, options.callback, {listenerSetter});\n  }\n\n  let ret = buttonDiv;\n  if(options.text) {\n    const div = document.createElement('div');\n    div.classList.add(_className + '-container', 'call-button-container');\n\n    const textEl = typeof(options.text) === 'string' ? i18n(options.text) : options.text;\n    textEl.classList.add(_className + '-text', 'call-button-text');\n\n    div.append(buttonDiv, textEl);\n\n    ret = div;\n  }\n\n  return ret;\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport findUpClassName from '../helpers/dom/findUpClassName';\nimport EventListenerBase from '../helpers/eventListenerBase';\nimport mediaSizes from '../helpers/mediaSizes';\nimport clamp from '../helpers/number/clamp';\nimport safeAssign from '../helpers/object/safeAssign';\nimport windowSize from '../helpers/windowSize';\nimport SwipeHandler from './swipeHandler';\n\ntype ResizeSide = 'n' | 'e' | 's' | 'w' | 'ne' | 'se' | 'sw' | 'nw';\nexport type MovableState = {\n  top?: number;\n  left?: number;\n  width: number;\n  height: number;\n};\n\nconst className = 'movable-element';\nconst resizeHandlerClassName = className + '-resize-handler';\n\nexport type MovableElementOptions = {\n  minWidth: MovableElement['minWidth'],\n  minHeight: MovableElement['minHeight'],\n  element: MovableElement['element'],\n  verifyTouchTarget?: MovableElement['verifyTouchTarget']\n};\n\nexport default class MovableElement extends EventListenerBase<{\n  resize: () => void\n}> {\n  private minWidth: number;\n  private minHeight: number;\n  private element: HTMLElement;\n  private verifyTouchTarget: (e: TouchEvent | MouseEvent) => boolean;\n\n  private top: number;\n  private left: number;\n  private _width: number;\n  private _height: number;\n\n  private swipeHandler: SwipeHandler;\n  private handlers: HTMLElement[];\n\n  constructor(options: MovableElementOptions) {\n    super(true);\n    safeAssign(this, options);\n\n    this.top = this.left = this.width = this.height = 0;\n    this.element.classList.add(className);\n\n    this.addResizeHandlers();\n    this.setSwipeHandler();\n\n    mediaSizes.addEventListener('resize', this.onResize);\n  }\n\n  private onResize = () => {\n    this.fixDimensions();\n    this.fixPosition();\n    this.setPosition();\n  };\n\n  public destroyElements() {\n    this.element.classList.remove(className);\n\n    if(this.handlers) {\n      this.handlers.forEach((handler) => {\n        handler.remove();\n      });\n    }\n  }\n\n  public destroy() {\n    mediaSizes.removeEventListener('resize', this.onResize);\n    this.swipeHandler.removeListeners();\n  }\n\n  private addResizeHandlers() {\n    const sides: ResizeSide[] = ['n', 'e', 's', 'w', 'ne', 'se', 'sw', 'nw'];\n    this.handlers = sides.map((side) => {\n      const div = document.createElement('div');\n      div.dataset.side = side;\n      div.classList.add(resizeHandlerClassName, resizeHandlerClassName + '-side-' + side);\n      this.element.append(div);\n      return div;\n    });\n  }\n\n  private setSwipeHandler() {\n    let startTop: number, startLeft: number, startWidth: number, startHeight: number, resizingSide: ResizeSide;\n    const swipeHandler = this.swipeHandler = new SwipeHandler({\n      element: this.element,\n      onSwipe: (xDiff, yDiff, e) => {\n        xDiff *= -1; // to right will be positive\n        yDiff *= -1; // to bottom will be positive\n        // console.log(xDiff, yDiff, e);\n\n        if(resizingSide) {\n          if(resizingSide.includes('e') || resizingSide.includes('w')) {\n            const isEnlarging = resizingSide.includes('e') && xDiff > 0 || resizingSide.includes('w') && xDiff < 0;\n            const resizeDiff = Math.abs(xDiff) * (isEnlarging ? 1 : -1);\n\n            const maxPossible = resizingSide.includes('e') ? windowSize.width - startLeft : startWidth + startLeft;\n            this.width = Math.min(maxPossible, startWidth + resizeDiff);\n          }\n\n          if(resizingSide.includes('n') || resizingSide.includes('s')) {\n            const isEnlarging = resizingSide.includes('s') && yDiff > 0 || resizingSide.includes('n') && yDiff < 0;\n            const resizeDiff = Math.abs(yDiff) * (isEnlarging ? 1 : -1);\n\n            const maxPossible = resizingSide.includes('s') ? windowSize.height - startTop : startHeight + startTop;\n            this.height = Math.min(maxPossible, startHeight + resizeDiff);\n          }\n\n          this.fixDimensions();\n\n          if(resizingSide.includes('w')) {\n            this.left = Math.min(startLeft + startWidth - this.minWidth, startLeft + xDiff);\n          }\n\n          if(resizingSide.includes('n')) {\n            this.top = Math.min(startTop + startHeight - this.minHeight, startTop + yDiff);\n          }\n        } else {\n          this.top = startTop + yDiff;\n          this.left = startLeft + xDiff;\n        }\n\n        this.fixPosition();\n        this.setPosition();\n      },\n      verifyTouchTarget: (e) => {\n        const target = e.target;\n        if(this.verifyTouchTarget && !this.verifyTouchTarget(e)) {\n          return false;\n        }\n\n        const resizeHandler = findUpClassName(target, resizeHandlerClassName);\n        if(resizeHandler) {\n          resizingSide = resizeHandler.dataset.side as ResizeSide;\n          swipeHandler.setCursor('');\n        } else {\n          resizingSide = undefined;\n          swipeHandler.setCursor('grabbing');\n        }\n\n        return true;\n      },\n      onFirstSwipe: () => {\n        startTop = this.top;\n        startLeft = this.left;\n        startWidth = this.width;\n        startHeight = this.height;\n      }\n    });\n  }\n\n  public setPositionToCenter() {\n    this.top = (windowSize.height / 2) - (this.height / 2);\n    this.left = (windowSize.width / 2) - (this.width / 2);\n    this.setPosition();\n  }\n\n  private fixDimensions() {\n    this.width = clamp(this.width, this.minWidth, windowSize.width);\n    this.height = clamp(this.height, this.minHeight, windowSize.height);\n  }\n\n  private fixPosition() {\n    this.top = clamp(this.top, 0, windowSize.height - this.height);\n    this.left = clamp(this.left, 0, windowSize.width - this.width);\n  }\n\n  private setPosition() {\n    this.element.style.top = this.top + 'px';\n    this.element.style.left = this.left + 'px';\n    this.element.style.right = 'auto';\n    this.element.style.bottom = 'auto';\n    this.element.style.width = this.width + 'px';\n    this.element.style.height = this.height + 'px';\n\n    this.dispatchEvent('resize');\n  }\n\n  public get width() {\n    return this._width;\n  }\n\n  public get height() {\n    return this._height;\n  }\n\n  private set width(value: number) {\n    this._width = value;\n  }\n\n  private set height(value: number) {\n    this._height = value;\n  }\n\n  public get state(): MovableState {\n    const {top, left, width, height} = this;\n    return {\n      top,\n      left,\n      width,\n      height\n    };\n  }\n\n  public set state(state: MovableState) {\n    const {top, left, width, height} = state;\n    this.top = top;\n    this.left = left;\n    this.width = width;\n    this.height = height;\n    this.onResize();\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport MovableElement, {MovableElementOptions, MovableState} from '../components/movableElement';\nimport IS_TOUCH_SUPPORTED from '../environment/touchSupport';\nimport ListenerSetter from './listenerSetter';\nimport mediaSizes, {ScreenSize} from './mediaSizes';\nimport safeAssign from './object/safeAssign';\n\nexport default class MovablePanel {\n  #movable: MovableElement;\n  private listenerSetter: ListenerSetter;\n  private previousState: MovableState;\n  private onResize: () => void;\n  private movableOptions: MovableElementOptions;\n\n  constructor(options: {\n    listenerSetter: ListenerSetter,\n    previousState: MovableState,\n    onResize?: () => void,\n    movableOptions: MovableElementOptions\n  }) {\n    safeAssign(this, options);\n\n    this.toggleMovable(!IS_TOUCH_SUPPORTED);\n\n    this.listenerSetter.add(mediaSizes)('changeScreen', (from, to) => {\n      if(to === ScreenSize.mobile || from === ScreenSize.mobile) {\n        this.toggleMovable(!IS_TOUCH_SUPPORTED);\n      }\n    });\n  }\n\n  public destroy() {\n    const movable = this.movable;\n    if(movable) {\n      movable.destroy();\n    }\n  }\n\n  public get movable() {\n    return this.#movable;\n  }\n\n  public get state() {\n    return this.movable ? this.movable.state : this.previousState;\n  }\n\n  public set state(state: MovableState) {\n    this.previousState = state;\n  }\n\n  private toggleMovable(enabled: boolean) {\n    let {movable} = this;\n    if(enabled) {\n      if(movable) {\n        return;\n      }\n\n      movable = this.#movable = new MovableElement(this.movableOptions);\n\n      movable.state = this.previousState;\n      if(this.previousState.top === undefined) {\n        movable.setPositionToCenter();\n      }\n\n      if(this.onResize) {\n        this.listenerSetter.add(movable)('resize', this.onResize);\n      }\n    } else {\n      if(!movable) {\n        return;\n      }\n\n      this.previousState = movable.state;\n      movable.destroyElements();\n      movable.destroy();\n      this.#movable = undefined;\n    }\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nexport default function toggleClassName(className: string, elements: HTMLElement[], disable: boolean) {\n  elements.forEach((element) => {\n    element.classList.toggle(className, disable);\n  });\n\n  return () => toggleClassName(className, elements, !disable);\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport replaceContent from '../../helpers/dom/replaceContent';\nimport toHHMMSS from '../../helpers/string/toHHMMSS';\nimport CALL_STATE from '../../lib/calls/callState';\nimport {i18n, LangPackKey} from '../../lib/langPack';\n\nexport default class CallDescriptionElement {\n  private container: HTMLElement;\n  private state: CALL_STATE;\n  private interval: number;\n\n  constructor(private appendTo: HTMLElement) {\n    this.container = document.createElement('div');\n    this.container.classList.add('call-description');\n  }\n\n  public detach() {\n    if(this.interval !== undefined) {\n      clearInterval(this.interval);\n      this.interval = undefined;\n    }\n\n    this.container.remove();\n    this.state = undefined;\n  }\n\n  public update(instance: any) {\n    const {connectionState} = instance;\n\n    if(this.state === connectionState) {\n      return;\n    }\n\n    this.state = connectionState;\n\n    let element: HTMLElement;\n    if(connectionState === CALL_STATE.CONNECTED) {\n      element = document.createElement('span');\n      element.classList.add('call-description-duration');\n\n      const setTime = () => {\n        element.innerText = toHHMMSS(instance.duration, true);\n      };\n\n      this.interval = window.setInterval(setTime, 1000);\n      setTime();\n    } else {\n      let langPackKey: LangPackKey;\n      switch(connectionState) {\n        case CALL_STATE.PENDING:\n          langPackKey = instance.isOutgoing ? 'Call.StatusRinging' : 'Call.StatusCalling';\n          break;\n        case CALL_STATE.REQUESTING:\n          langPackKey = 'Call.StatusRequesting';\n          break;\n        case CALL_STATE.EXCHANGING_KEYS:\n          langPackKey = 'VoipExchangingKeys';\n          break;\n        case CALL_STATE.CLOSED:\n          langPackKey = instance.connectedAt !== undefined ? 'Call.StatusEnded' : 'Call.StatusFailed';\n          break;\n        default:\n          langPackKey = 'Call.StatusConnecting';\n          break;\n      }\n\n      element = i18n(langPackKey);\n      if(this.interval !== undefined) {\n        clearInterval(this.interval);\n        this.interval = undefined;\n      }\n    }\n\n    this.container.classList.toggle('has-duration', connectionState === CALL_STATE.CONNECTED);\n    replaceContent(this.container, element);\n\n    if(!this.container.parentElement) {\n      this.appendTo.append(this.container);\n    }\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport {SuperRLottieIcon} from '../superIcon';\n\nexport default class GroupCallMicrophoneIconMini extends SuperRLottieIcon<{\n  PartState: boolean,\n  ColorState: boolean,\n  Items: {\n    name: 'voice_mini'\n  }[]\n}> {\n  constructor(colored?: boolean, skipAnimation?: boolean) {\n    super({\n      width: 36,\n      height: 36,\n      getPart: (state) => {\n        return this.getItem().getPart(state ? 'unmute' : 'mute');\n      },\n      getColor: colored ? (state) => {\n        return state ? [255, 255, 255] : [158, 158, 158];\n      } : undefined,\n      skipAnimation\n    });\n\n    this.add({\n      name: 'voice_mini',\n      parts: [{\n        startFrame: 0,\n        endFrame: 35,\n        name: 'hand-to-muted'\n      }, {\n        startFrame: 36,\n        endFrame: 68,\n        name: 'unmute'\n      }, {\n        startFrame: 69,\n        endFrame: 98,\n        name: 'mute'\n      }, {\n        startFrame: 99,\n        endFrame: 135,\n        name: 'muted-to-hand'\n      }, {\n        startFrame: 136,\n        endFrame: 171,\n        name: 'unmuted-to-hand'\n      }]\n    });\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport IS_SCREEN_SHARING_SUPPORTED from '../../environment/screenSharingSupport';\nimport {IS_MOBILE} from '../../environment/userAgent';\nimport {attachClickEvent} from '../../helpers/dom/clickEvent';\nimport ControlsHover from '../../helpers/dom/controlsHover';\nimport findUpClassName from '../../helpers/dom/findUpClassName';\nimport {addFullScreenListener, cancelFullScreen, isFullScreen, requestFullScreen} from '../../helpers/dom/fullScreen';\nimport replaceContent from '../../helpers/dom/replaceContent';\nimport MovablePanel from '../../helpers/movablePanel';\nimport onMediaLoad from '../../helpers/onMediaLoad';\nimport themeController from '../../helpers/themeController';\nimport toggleClassName from '../../helpers/toggleClassName';\nimport CallInstance from '../../lib/calls/callInstance';\nimport CALL_STATE from '../../lib/calls/callState';\nimport I18n, {i18n} from '../../lib/langPack';\nimport wrapEmojiText from '../../lib/richTextProcessor/wrapEmojiText';\nimport animationIntersector from '../animationIntersector';\nimport AvatarElement from '../avatar';\nimport ButtonIcon from '../buttonIcon';\nimport GroupCallMicrophoneIconMini from '../groupCall/microphoneIconMini';\nimport {MovableState} from '../movableElement';\nimport PeerTitle from '../peerTitle';\nimport PopupElement from '../popups';\nimport SetTransition from '../singleTransition';\nimport makeButton from './button';\nimport CallDescriptionElement from './description';\nimport callVideoCanvasBlur from './videoCanvasBlur';\n\nconst className = 'call';\n\nconst MIN_WIDTH = 400;\nconst MIN_HEIGHT = 580;\n\nconst INIT_STATE: MovableState = {\n  width: MIN_WIDTH,\n  height: MIN_HEIGHT\n};\n\nlet previousState: MovableState = {...INIT_STATE};\n\nexport default class PopupCall extends PopupElement {\n  private peerId: PeerId;\n\n  private description: CallDescriptionElement;\n  private emojisSubtitle: HTMLElement;\n\n  private partyStates: HTMLElement;\n  private partyMutedState: HTMLElement;\n\n  private firstButtonsRow: HTMLElement;\n  private secondButtonsRow: HTMLElement;\n\n  private declineI18nElement: I18n.IntlElement;\n\n  private makeButton: (options: Parameters<typeof makeButton>[2]) => HTMLElement;\n  private btnAccept: HTMLElement;\n  private btnDecline: HTMLElement;\n  private btnVideo: HTMLElement;\n  private btnScreen: HTMLElement;\n  private btnMute: HTMLElement;\n  private btnFullScreen: HTMLButtonElement;\n  private btnExitFullScreen: HTMLButtonElement;\n\n  private movablePanel: MovablePanel;\n  private microphoneIcon: GroupCallMicrophoneIconMini;\n  private muteI18nElement: I18n.IntlElement;\n\n  private videoContainers: {\n    input?: HTMLElement,\n    output?: HTMLElement\n  };\n\n  private controlsHover: ControlsHover;\n\n  constructor(private instance: CallInstance) {\n    super('popup-call', {\n      withoutOverlay: true,\n      closable: true\n    });\n\n    this.videoContainers = {};\n\n    const {container, listenerSetter} = this;\n    container.classList.add(className, 'night');\n\n    const avatarContainer = document.createElement('div');\n    avatarContainer.classList.add(className + '-avatar');\n\n    const peerId = this.peerId = this.instance.interlocutorUserId.toPeerId();\n    const avatar = new AvatarElement();\n    avatar.classList.add('avatar-full');\n    avatar.updateWithOptions({\n      isBig: true,\n      peerId: peerId\n    });\n    avatarContainer.append(avatar);\n\n    const title = new PeerTitle({\n      peerId\n    }).element;\n\n    title.classList.add(className + '-title');\n\n    const subtitle = document.createElement('div');\n    subtitle.classList.add(className + '-subtitle');\n\n    const description = this.description = new CallDescriptionElement(subtitle);\n\n    const emojisSubtitle = this.emojisSubtitle = document.createElement('div');\n    emojisSubtitle.classList.add(className + '-emojis');\n\n    container.append(avatarContainer, title, subtitle);\n\n    if(!IS_MOBILE) {\n      this.btnFullScreen = ButtonIcon('fullscreen');\n      this.btnExitFullScreen = ButtonIcon('smallscreen hide');\n      attachClickEvent(this.btnFullScreen, this.onFullScreenClick, {listenerSetter});\n      attachClickEvent(this.btnExitFullScreen, () => cancelFullScreen(), {listenerSetter});\n      addFullScreenListener(this.container, this.onFullScreenChange, listenerSetter);\n      this.header.prepend(this.btnExitFullScreen);\n      this.header.append(this.btnFullScreen);\n\n      container.append(emojisSubtitle);\n    } else {\n      this.header.append(emojisSubtitle);\n    }\n\n    this.partyStates = document.createElement('div');\n    this.partyStates.classList.add(className + '-party-states');\n\n    this.partyMutedState = document.createElement('div');\n    this.partyMutedState.classList.add(className + '-party-state');\n    const stateText = i18n('VoipUserMicrophoneIsOff', [new PeerTitle({peerId, onlyFirstName: true, limitSymbols: 18}).element]);\n    stateText.classList.add(className + '-party-state-text');\n    const mutedIcon = new GroupCallMicrophoneIconMini(false, true);\n    mutedIcon.setState(false, false);\n    this.partyMutedState.append(\n      mutedIcon.container,\n      stateText\n    );\n\n    this.partyStates.append(this.partyMutedState);\n    this.container.append(this.partyStates);\n\n    this.makeButton = makeButton.bind(null, className, this.listenerSetter);\n    this.constructFirstButtons();\n    this.constructSecondButtons();\n\n    listenerSetter.add(instance)('state', () => {\n      this.updateInstance();\n    });\n\n    listenerSetter.add(instance)('mediaState', () => {\n      this.updateInstance();\n    });\n\n    this.movablePanel = new MovablePanel({\n      listenerSetter,\n      movableOptions: {\n        minWidth: MIN_WIDTH,\n        minHeight: MIN_HEIGHT,\n        element: this.element,\n        verifyTouchTarget: (e) => {\n          const target = e.target;\n          if(findUpClassName(target, 'call-button') ||\n            findUpClassName(target, 'btn-icon') ||\n            isFullScreen()) {\n            return false;\n          }\n\n          return true;\n        }\n      },\n      // onResize: () => this.toggleBigLayout(),\n      previousState: !this.instance.wasTryingToJoin && !this.instance.isOutgoing ? {...INIT_STATE} : previousState\n    });\n\n    const movableElement = this.movablePanel.movable;\n    if(movableElement) {\n      this.listenerSetter.add(movableElement)('resize', () => {\n        this.resizeVideoContainers();\n      });\n    }\n\n    const controlsHover = this.controlsHover = new ControlsHover();\n    controlsHover.setup({\n      element: this.container,\n      listenerSetter: this.listenerSetter,\n      showOnLeaveToClassName: 'call-buttons'\n    });\n    controlsHover.showControls(false);\n\n    this.addEventListener('close', () => {\n      const {movablePanel} = this;\n      previousState = movablePanel.state;\n\n      this.microphoneIcon.destroy();\n\n      movablePanel.destroy();\n    });\n\n    this.updateInstance();\n  }\n\n  public getCallInstance() {\n    return this.instance;\n  }\n\n  private constructFirstButtons() {\n    const buttons = this.firstButtonsRow = document.createElement('div');\n    buttons.classList.add(className + '-buttons', 'is-first');\n\n    const toggleDisability = toggleClassName.bind(null, 'btn-disabled');\n\n    const btnVideo = this.btnVideo = this.makeButton({\n      text: 'Call.Camera',\n      icon: 'videocamera_filled',\n      callback: () => {\n        const toggle = toggleDisability([btnVideo, btnScreen], true);\n        this.instance.toggleVideoSharing().finally(toggle);\n      }\n    });\n\n    const btnScreen = this.btnScreen = this.makeButton({\n      text: 'Call.Screen',\n      icon: 'sharescreen_filled',\n      callback: () => {\n        const toggle = toggleDisability([btnVideo, btnScreen], true);\n        this.instance.toggleScreenSharing().finally(toggle);\n      }\n    });\n\n    if(!IS_SCREEN_SHARING_SUPPORTED) {\n      btnScreen.classList.add('hide');\n      this.container.classList.add('no-screen');\n    }\n\n    this.muteI18nElement = new I18n.IntlElement({\n      key: 'Call.Mute'\n    });\n    const btnMute = this.btnMute = this.makeButton({\n      text: this.muteI18nElement.element,\n      callback: () => {\n        this.instance.toggleMuted();\n      }\n    });\n\n    const microphoneIcon = this.microphoneIcon = new GroupCallMicrophoneIconMini(true, true);\n    btnMute.firstElementChild.append(microphoneIcon.container);\n\n    // btnVideo.classList.add('disabled');\n    // btnScreen.classList.add('disabled');\n\n    buttons.append(btnVideo, btnScreen, btnMute);\n    this.container.append(buttons);\n  }\n\n  private constructSecondButtons() {\n    const buttons = this.secondButtonsRow = document.createElement('div');\n    buttons.classList.add(className + '-buttons', 'is-second');\n\n    this.declineI18nElement = new I18n.IntlElement({\n      key: 'Call.Decline'\n    });\n    const btnDecline = this.btnDecline = this.makeButton({\n      text: this.declineI18nElement.element,\n      icon: 'endcall_filled',\n      callback: () => {\n        this.instance.hangUp('phoneCallDiscardReasonHangup');\n      },\n      isDanger: true\n    });\n\n    const btnAccept = this.btnAccept = this.makeButton({\n      text: 'Call.Accept',\n      icon: 'phone_filled',\n      callback: () => {\n        this.instance.acceptCall();\n      },\n      isConfirm: true\n    });\n\n    buttons.append(btnDecline, btnAccept);\n    this.container.append(buttons);\n  }\n\n  private onFullScreenClick = () => {\n    requestFullScreen(this.container);\n  };\n\n  private onFullScreenChange = () => {\n    const isFull = isFullScreen();\n\n    const {btnFullScreen, btnExitFullScreen} = this;\n\n    const wasFullScreen = this.container.classList.contains('is-full-screen');\n    this.container.classList.toggle('is-full-screen', isFull);\n    btnFullScreen && btnFullScreen.classList.toggle('hide', isFull);\n    btnExitFullScreen && btnExitFullScreen.classList.toggle('hide', !isFull);\n    this.btnClose.classList.toggle('hide', isFull);\n\n    if(isFull !== wasFullScreen) {\n      animationIntersector.checkAnimations(isFull);\n\n      themeController.setThemeColor(isFull ? '#000000' : undefined);\n\n      this.resizeVideoContainers();\n    }\n  };\n\n  private createVideoContainer(video: HTMLVideoElement) {\n    const _className = className + '-video';\n    const container = document.createElement('div');\n    container.classList.add(_className + '-container');\n\n    video.classList.add(_className);\n    if(video.paused) {\n      video.play();\n    }\n\n    attachClickEvent(container, () => {\n      if(!container.classList.contains('small')) {\n        return;\n      }\n\n      const big = Object.values(this.videoContainers).find((container) => !container.classList.contains('small'));\n      big.classList.add('small');\n      big.style.cssText = container.style.cssText;\n      container.classList.remove('small');\n      container.style.cssText = '';\n\n      this.resizeVideoContainers();\n    });\n\n    const canvas = callVideoCanvasBlur(video);\n    canvas.classList.add(_className + '-blur');\n\n    container.append(canvas, video);\n\n    return container;\n  }\n\n  private updateInstance() {\n    const {instance} = this;\n    const {connectionState} = instance;\n    if(connectionState === CALL_STATE.CLOSED) {\n      if(this.container.classList.contains('is-full-screen')) {\n        cancelFullScreen();\n      }\n\n      this.btnVideo.classList.add('disabled');\n\n      this.hide();\n      return;\n    }\n\n    const isPendingIncoming = !instance.isOutgoing && connectionState === CALL_STATE.PENDING;\n    this.declineI18nElement.compareAndUpdate({\n      key: connectionState === CALL_STATE.PENDING ? 'Call.Decline' : 'Call.End'\n    });\n    this.btnAccept.classList.toggle('disable', !isPendingIncoming);\n    this.btnAccept.classList.toggle('hide-me', !isPendingIncoming);\n    this.container.classList.toggle('two-button-rows', isPendingIncoming);\n\n    const isMuted = instance.isMuted;\n    const onFrame = () => {\n      this.btnMute.firstElementChild.classList.toggle('active', isMuted);\n    };\n\n    const player = this.microphoneIcon.getItem().player;\n    this.microphoneIcon.setState(!isMuted, !isMuted, onFrame);\n    if(!player) {\n      onFrame();\n    }\n\n    this.muteI18nElement.compareAndUpdate({\n      key: isMuted ? 'VoipUnmute' : 'Call.Mute'\n    });\n\n    const isSharingVideo = instance.isSharingVideo;\n    this.btnVideo.firstElementChild.classList.toggle('active', isSharingVideo);\n\n    const isSharingScreen = instance.isSharingScreen;\n    this.btnScreen.firstElementChild.classList.toggle('active', isSharingScreen);\n\n    const outputState = instance.getMediaState('output');\n\n    SetTransition(this.partyMutedState, 'is-visible', !!outputState?.muted, 300);\n\n    const containers = this.videoContainers;\n    const oldContainers = {...containers};\n    ['input' as const, 'output' as const].forEach((type) => {\n      const mediaState = instance.getMediaState(type);\n      const video = instance.getVideoElement(type) as HTMLVideoElement;\n\n      const hasFrame = !!(video && video.videoWidth && video.videoHeight);\n      if(video && !hasFrame && !video.dataset.hasPromise) {\n        video.dataset.hasPromise = '1';\n        // container.classList.add('hide');\n        onMediaLoad(video).then(() => {\n          delete video.dataset.hasPromise;\n          this.updateInstance();\n          // this.resizeVideoContainers();\n          // container.classList.remove('hide');\n        });\n      }\n\n      const isActive = !!video && hasFrame && !!(mediaState && (mediaState.videoState === 'active' || mediaState.screencastState === 'active'));\n      let videoContainer = containers[type];\n\n      if(isActive && video && !videoContainer) {\n        videoContainer = containers[type] = this.createVideoContainer(video);\n        this.container.append(videoContainer);\n      }\n\n      if(!isActive && videoContainer) {\n        videoContainer.remove();\n        delete containers[type];\n      }\n    });\n\n    {\n      const input = containers.input;\n      const output = containers.output;\n      if(Object.keys(oldContainers).length !== Object.keys(containers).length && input) {\n        input.classList.toggle('small', !!output);\n      }\n\n      if(output && !input) {\n        output.classList.remove('small');\n      }\n    }\n\n    this.resizeVideoContainers();\n\n    this.container.classList.toggle('no-video', !Object.keys(containers).length);\n\n    if(!this.emojisSubtitle.textContent && connectionState < CALL_STATE.EXCHANGING_KEYS) {\n      Promise.resolve(instance.getEmojisFingerprint()).then((emojis) => {\n        replaceContent(this.emojisSubtitle, wrapEmojiText(emojis.join('')));\n      });\n    }\n\n    this.setDescription();\n  }\n\n  private resizeVideoContainers() {\n    Object.values(this.videoContainers).forEach((container) => {\n      const isSmall = container.classList.contains('small');\n      if(isSmall) {\n        const video = container.querySelector('video');\n        const popupWidth = this.movablePanel.state;\n        const MAX_WIDTH_PX = 240;\n        const MAX_HEIGHT_PX = 240;\n\n        const isVertical = video.videoHeight > video.videoWidth;\n        const MAX_SIZE = isVertical ? MAX_HEIGHT_PX : MAX_WIDTH_PX;\n\n        const biggestSideSize = 1 / 3 * (isFullScreen() ? 0xFFFF : (isVertical ? popupWidth.height : popupWidth.width));\n        const widthRatio = isVertical ? video.videoWidth / video.videoHeight : 1;\n        const heightRatio = isVertical ? 1 : video.videoHeight / video.videoWidth;\n        container.style.width = biggestSideSize * widthRatio + 'px';\n        container.style.height = biggestSideSize * heightRatio + 'px';\n        container.style.maxWidth = MAX_SIZE * widthRatio + 'px';\n        container.style.maxHeight = MAX_SIZE * heightRatio + 'px';\n      } else {\n        container.style.cssText = '';\n      }\n    });\n  }\n\n  private setDescription() {\n    this.description.update(this.instance);\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport cancelEvent from '../helpers/dom/cancelEvent';\nimport {attachClickEvent} from '../helpers/dom/clickEvent';\nimport ListenerSetter from '../helpers/listenerSetter';\nimport GROUP_CALL_STATE from '../lib/calls/groupCallState';\nimport rootScope from '../lib/rootScope';\nimport ButtonIcon from './buttonIcon';\nimport TopbarWeave from './topbarWeave';\nimport SetTransition from './singleTransition';\nimport PopupGroupCall from './groupCall';\nimport GroupCallDescriptionElement from './groupCall/description';\nimport GroupCallTitleElement from './groupCall/title';\nimport PopupElement from './popups';\nimport throttle from '../helpers/schedulers/throttle';\nimport GroupCallInstance from '../lib/calls/groupCallInstance';\nimport CALL_STATE from '../lib/calls/callState';\nimport replaceContent from '../helpers/dom/replaceContent';\nimport PeerTitle from './peerTitle';\nimport CallDescriptionElement from './call/description';\nimport PopupCall from './call';\nimport GroupCallMicrophoneIconMini from './groupCall/microphoneIconMini';\nimport CallInstance from '../lib/calls/callInstance';\nimport {AppManagers} from '../lib/appManagers/managers';\nimport groupCallsController from '../lib/calls/groupCallsController';\nimport StreamManager from '../lib/calls/streamManager';\nimport callsController from '../lib/calls/callsController';\n\nfunction convertCallStateToGroupState(state: CALL_STATE, isMuted: boolean) {\n  switch(state) {\n    case CALL_STATE.CLOSING:\n    case CALL_STATE.CLOSED:\n      return GROUP_CALL_STATE.CLOSED;\n    case CALL_STATE.CONNECTED:\n      return isMuted ? GROUP_CALL_STATE.MUTED : GROUP_CALL_STATE.UNMUTED;\n    default:\n      return GROUP_CALL_STATE.CONNECTING;\n  }\n}\n\nconst CLASS_NAME = 'topbar-call';\n\nexport default class TopbarCall {\n  public container: HTMLElement;\n  private listenerSetter: ListenerSetter;\n  private weave: TopbarWeave;\n  private center: HTMLDivElement;\n  private groupCallTitle: GroupCallTitleElement;\n  private groupCallDescription: GroupCallDescriptionElement;\n  private groupCallMicrophoneIconMini: GroupCallMicrophoneIconMini;\n  private callDescription: CallDescriptionElement;\n\n  private currentDescription: GroupCallDescriptionElement | CallDescriptionElement;\n\n  private instance: GroupCallInstance | any/* CallInstance */;\n  private instanceListenerSetter: ListenerSetter;\n\n  constructor(\n    private managers: AppManagers\n  ) {\n    const listenerSetter = this.listenerSetter = new ListenerSetter();\n\n    listenerSetter.add(callsController)('instance', ({instance}) => {\n      if(!this.instance) {\n        this.updateInstance(instance);\n      }\n    });\n\n    listenerSetter.add(callsController)('accepting', (instance) => {\n      if(this.instance !== instance) {\n        this.updateInstance(instance);\n      }\n    });\n\n    listenerSetter.add(groupCallsController)('instance', (instance) => {\n      this.updateInstance(instance);\n    });\n\n    listenerSetter.add(rootScope)('group_call_update', (groupCall) => {\n      const instance = groupCallsController.groupCall;\n      if(instance?.id === groupCall.id) {\n        this.updateInstance(instance);\n      }\n    });\n\n    listenerSetter.add(StreamManager.ANALYSER_LISTENER)('amplitude', ({amplitudes, type}) => {\n      const {weave} = this;\n      if(!amplitudes.length || !weave/*  || type !== 'input' */) return;\n\n      let max = 0;\n      for(let i = 0; i < amplitudes.length; ++i) {\n        const {type, value} = amplitudes[i];\n        max = value > max ? value : max;\n      }\n\n      weave.setAmplitude(max);\n    });\n  }\n\n  private onState = () => {\n    this.updateInstance(this.instance);\n  };\n\n  private clearCurrentInstance() {\n    if(!this.instance) return;\n    this.center.textContent = '';\n\n    if(this.currentDescription) {\n      this.currentDescription.detach();\n      this.currentDescription = undefined;\n    }\n\n    this.instance = undefined;\n    this.instanceListenerSetter.removeAll();\n  }\n\n  private updateInstance(instance: TopbarCall['instance']) {\n    if(this.construct) {\n      this.construct();\n      this.construct = undefined;\n    }\n\n    const isChangingInstance = this.instance !== instance;\n    if(isChangingInstance) {\n      this.clearCurrentInstance();\n\n      this.instance = instance;\n      this.instanceListenerSetter = new ListenerSetter();\n\n      this.instanceListenerSetter.add(instance as GroupCallInstance)('state', this.onState);\n\n      if(instance instanceof GroupCallInstance) {\n        this.currentDescription = this.groupCallDescription;\n      } else {\n        this.currentDescription = this.callDescription;\n        this.instanceListenerSetter.add(instance)('muted', this.onState);\n      }\n\n      this.container.classList.toggle('is-call', !(instance instanceof GroupCallInstance));\n    }\n\n    const isMuted = this.instance.isMuted;\n    const state = instance instanceof GroupCallInstance ? instance.state : convertCallStateToGroupState(instance.connectionState, isMuted);\n\n    const {weave} = this;\n\n    weave.componentDidMount();\n\n    const isClosed = state === GROUP_CALL_STATE.CLOSED;\n    if((!document.body.classList.contains('is-calling') || isChangingInstance) || isClosed) {\n      if(isClosed) {\n        weave.setAmplitude(0);\n      }\n\n      SetTransition(document.body, 'is-calling', !isClosed, 250, isClosed ? () => {\n        weave.componentWillUnmount();\n\n        this.clearCurrentInstance();\n      }: undefined);\n    }\n\n    if(isClosed) {\n      return;\n    }\n\n    weave.setCurrentState(state, true);\n    // if(state === GROUP_CALL_STATE.CONNECTING) {\n    //   weave.setCurrentState(state, true);\n    // } else {\n    //   /* var a = 0;\n    //   animate(() => {\n    //     a += 0.1;\n    //     if(a > 1) a = 0;\n    //     weave.setAmplitude(a);\n    //     return true;\n    //   });\n    //   weave.setAmplitude(1); */\n    //   weave.setCurrentState(state, true);\n    // }\n\n    this.setTitle(instance);\n    this.setDescription(instance);\n    this.groupCallMicrophoneIconMini.setState(!isMuted);\n  }\n\n  private setDescription(instance: TopbarCall['instance']) {\n    return this.currentDescription.update(instance as any);\n  }\n\n  private setTitle(instance: TopbarCall['instance']) {\n    if(instance instanceof GroupCallInstance) {\n      return this.groupCallTitle.update(instance);\n    } else {\n      replaceContent(this.center, new PeerTitle({peerId: instance.interlocutorUserId.toPeerId()}).element);\n    }\n  }\n\n  private construct() {\n    const {listenerSetter} = this;\n    const container = this.container = document.createElement('div');\n    container.classList.add('sidebar-header', CLASS_NAME + '-container');\n\n    const left = document.createElement('div');\n    left.classList.add(CLASS_NAME + '-left');\n\n    const groupCallMicrophoneIconMini = this.groupCallMicrophoneIconMini = new GroupCallMicrophoneIconMini();\n\n    const mute = ButtonIcon();\n    mute.append(groupCallMicrophoneIconMini.container);\n    left.append(mute);\n\n    const throttledMuteClick = throttle(() => {\n      this.instance.toggleMuted();\n    }, 600, true);\n\n    attachClickEvent(mute, (e) => {\n      cancelEvent(e);\n      throttledMuteClick();\n    }, {listenerSetter});\n\n    const center = this.center = document.createElement('div');\n    center.classList.add(CLASS_NAME + '-center');\n\n    this.groupCallTitle = new GroupCallTitleElement(center);\n    this.groupCallDescription = new GroupCallDescriptionElement(left);\n\n    this.callDescription = new CallDescriptionElement(left);\n\n    const right = document.createElement('div');\n    right.classList.add(CLASS_NAME + '-right');\n\n    const end = ButtonIcon('endcall_filled');\n    right.append(end);\n\n    attachClickEvent(end, (e) => {\n      cancelEvent(e);\n\n      const {instance} = this;\n      if(!instance) {\n        return;\n      }\n\n      if(instance instanceof GroupCallInstance) {\n        instance.hangUp();\n      } else {\n        instance.hangUp('phoneCallDiscardReasonHangup');\n      }\n    }, {listenerSetter});\n\n    attachClickEvent(container, () => {\n      if(this.instance instanceof GroupCallInstance) {\n        if(PopupElement.getPopups(PopupGroupCall).length) {\n          return;\n        }\n\n        new PopupGroupCall().show();\n      } else if(this.instance instanceof CallInstance) {\n        const popups = PopupElement.getPopups(PopupCall);\n        if(popups.find((popup) => popup.getCallInstance() === this.instance)) {\n          return;\n        }\n\n        new PopupCall(this.instance).show();\n      }\n    }, {listenerSetter});\n\n    container.append(left, center, right);\n\n    const weave = this.weave = new TopbarWeave();\n    const weaveContainer = weave.render(CLASS_NAME + '-weave');\n    container.prepend(weaveContainer);\n\n    document.getElementById('column-center').prepend(container);\n    weave.componentDidMount();\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport getPeerTitle from '../../components/wrappers/getPeerTitle';\nimport wrapMessageForReply from '../../components/wrappers/messageForReply';\nimport {MOUNT_CLASS_TO} from '../../config/debug';\nimport {FontFamily} from '../../config/font';\nimport {IS_MOBILE} from '../../environment/userAgent';\nimport IS_VIBRATE_SUPPORTED from '../../environment/vibrateSupport';\nimport deferredPromise, {CancellablePromise} from '../../helpers/cancellablePromise';\nimport idleController from '../../helpers/idleController';\nimport deepEqual from '../../helpers/object/deepEqual';\nimport tsNow from '../../helpers/tsNow';\nimport {Message, MessagePeerReaction, PeerNotifySettings} from '../../layer';\nimport I18n, {FormatterArguments, LangPackKey} from '../langPack';\nimport apiManagerProxy from '../mtproto/mtprotoworker';\nimport singleInstance from '../mtproto/singleInstance';\nimport webPushApiManager, {PushSubscriptionNotify} from '../mtproto/webPushApiManager';\nimport fixEmoji from '../richTextProcessor/fixEmoji';\nimport wrapPlainText from '../richTextProcessor/wrapPlainText';\nimport rootScope from '../rootScope';\nimport appImManager from './appImManager';\nimport appRuntimeManager from './appRuntimeManager';\nimport {AppManagers} from './managers';\nimport generateMessageId from './utils/messageId/generateMessageId';\nimport getPeerId from './utils/peers/getPeerId';\n\ntype MyNotification = Notification & {\n  hidden?: boolean,\n  show?: () => void,\n};\n\nexport type NotifyOptions = Partial<{\n  tag: string;\n  image: string;\n  key: string;\n  title: string;\n  message: string;\n  silent: boolean;\n  onclick: () => void;\n  noIncrement: boolean;\n}>;\n\nexport type NotificationSettings = {\n  nodesktop: boolean,\n  volume: number,\n  novibrate: boolean,\n  nopreview: boolean,\n  nopush: boolean,\n  nosound: boolean\n};\n\nexport class UiNotificationsManager {\n  private notificationsUiSupport: boolean;\n  private notificationsShown: {[key: string]: MyNotification | true} = {};\n  private notificationIndex = 0;\n  private notificationsCount = 0;\n  private soundsPlayed: {[tag: string]: number} = {};\n  private vibrateSupport = IS_VIBRATE_SUPPORTED;\n  private nextSoundAt: number;\n  private prevSoundVolume: number;\n\n  private faviconEl: HTMLLinkElement = document.head.querySelector('link[rel=\"icon\"]');\n\n  private titleBackup = document.title;\n  private titleChanged = false;\n  private titleInterval: number;\n  private prevFavicon: string;\n\n  private notifySoundEl: HTMLElement;\n\n  private stopped = false;\n\n  private topMessagesDeferred: CancellablePromise<void>;\n\n  private settings: NotificationSettings = {} as any;\n\n  private registeredDevice: any;\n  private pushInited = false;\n\n  private managers: AppManagers;\n  private setAppBadge: (contents?: any) => Promise<void>;\n\n  construct(managers: AppManagers) {\n    this.managers = managers;\n\n    navigator.vibrate = navigator.vibrate || (navigator as any).mozVibrate || (navigator as any).webkitVibrate;\n    this.setAppBadge = (navigator as any).setAppBadge && (navigator as any).setAppBadge.bind(navigator);\n    this.setAppBadge && this.setAppBadge(0);\n\n    this.notificationsUiSupport = ('Notification' in window) || ('mozNotification' in navigator);\n\n    this.notifySoundEl = document.createElement('div');\n    this.notifySoundEl.id = 'notify-sound';\n    document.body.append(this.notifySoundEl);\n\n    this.topMessagesDeferred = deferredPromise<void>();\n\n    singleInstance.addEventListener('deactivated', () => {\n      this.stop();\n    });\n\n    singleInstance.addEventListener('activated', () => {\n      if(this.stopped) {\n        this.start();\n      }\n    });\n\n    idleController.addEventListener('change', (idle) => {\n      if(this.stopped) {\n        return;\n      }\n\n      if(!idle) {\n        this.clear();\n      }\n\n      this.toggleToggler();\n    });\n\n    rootScope.addEventListener('notification_reset', (peerString) => {\n      this.soundReset(peerString);\n    });\n\n    rootScope.addEventListener('notification_cancel', (str) => {\n      this.cancel(str);\n    });\n\n    if(this.setAppBadge) {\n      rootScope.addEventListener('folder_unread', (folder) => {\n        if(folder.id === 0) {\n          this.setAppBadge(folder.unreadUnmutedPeerIds.size);\n        }\n      });\n    }\n\n    webPushApiManager.addEventListener('push_init', (tokenData) => {\n      this.pushInited = true;\n      if(!this.settings.nodesktop && !this.settings.nopush) {\n        if(tokenData) {\n          this.registerDevice(tokenData);\n        } else {\n          webPushApiManager.subscribe();\n        }\n      } else {\n        this.unregisterDevice(tokenData);\n      }\n    });\n    webPushApiManager.addEventListener('push_subscribe', (tokenData) => {\n      this.registerDevice(tokenData);\n    });\n    webPushApiManager.addEventListener('push_unsubscribe', (tokenData) => {\n      this.unregisterDevice(tokenData);\n    });\n\n    rootScope.addEventListener('dialogs_multiupdate', () => {\n      // unregisterTopMsgs()\n      this.topMessagesDeferred.resolve();\n    }, {once: true});\n\n    webPushApiManager.addEventListener('push_notification_click', (notificationData) => {\n      if(notificationData.action === 'push_settings') {\n        /* this.topMessagesDeferred.then(() => {\n          $modal.open({\n            templateUrl: templateUrl('settings_modal'),\n            controller: 'SettingsModalController',\n            windowClass: 'settings_modal_window mobile_modal',\n            backdrop: 'single'\n          })\n        }); */\n        return;\n      }\n\n      if(notificationData.action === 'mute1d') {\n        this.managers.apiManager.invokeApi('account.updateDeviceLocked', {\n          period: 86400\n        }).then(() => {\n          // var toastData = toaster.pop({\n          //   type: 'info',\n          //   body: _('push_action_mute1d_success'),\n          //   bodyOutputType: 'trustedHtml',\n          //   clickHandler: () => {\n          //     toaster.clear(toastData)\n          //   },\n          //   showCloseButton: false\n          // })\n        });\n\n        return;\n      }\n\n      const peerId = notificationData.custom && notificationData.custom.peerId.toPeerId();\n      console.log('click', notificationData, peerId);\n      if(peerId) {\n        this.topMessagesDeferred.then(async() => {\n          if(notificationData.custom.channel_id &&\n              !(await this.managers.appChatsManager.hasChat(notificationData.custom.channel_id))) {\n            return;\n          }\n\n          if(peerId.isUser() && !(await this.managers.appUsersManager.hasUser(peerId))) {\n            return;\n          }\n\n          appImManager.setInnerPeer({\n            peerId,\n            lastMsgId: generateMessageId(+notificationData.custom.msg_id)\n          });\n        });\n      }\n    });\n  }\n\n  public async buildNotification({message, fwdCount, peerReaction, peerTypeNotifySettings}: {\n    message: Message.message | Message.messageService,\n    fwdCount?: number,\n    peerReaction?: MessagePeerReaction,\n    peerTypeNotifySettings?: PeerNotifySettings\n  }) {\n    const peerId = message.peerId;\n    const isAnyChat = peerId.isAnyChat();\n    const notification: NotifyOptions = {};\n    const peerString = await this.managers.appPeersManager.getPeerString(peerId);\n    let notificationMessage: string;\n\n    if(peerTypeNotifySettings.show_previews) {\n      if(message._ === 'message' && message.fwd_from && fwdCount > 1) {\n        notificationMessage = I18n.format('Notifications.Forwarded', true, [fwdCount]);\n      } else {\n        notificationMessage = await wrapMessageForReply(message, undefined, undefined, true);\n\n        if(peerReaction) {\n          const langPackKey: LangPackKey = /* isAnyChat ? 'Notification.Group.Reacted' :  */'Notification.Contact.Reacted';\n          const args: FormatterArguments = [\n            fixEmoji(peerReaction.reaction), // can be plain heart\n            notificationMessage\n          ];\n\n          /* if(isAnyChat) {\n            args.unshift(appPeersManager.getPeerTitle(message.fromId, true));\n          } */\n\n          notificationMessage = I18n.format(langPackKey, true, args);\n        }\n      }\n    } else {\n      notificationMessage = I18n.format('Notifications.New', true);\n    }\n\n    if(peerReaction) {\n      notification.noIncrement = true;\n      notification.silent = true;\n    }\n\n    const notificationFromPeerId = peerReaction ? getPeerId(peerReaction.peer_id) : message.fromId;\n    notification.title = await getPeerTitle(peerId, true, undefined, undefined, this.managers);\n    if(isAnyChat && notificationFromPeerId !== message.peerId) {\n      notification.title = await getPeerTitle(notificationFromPeerId, true, undefined, undefined, this.managers) +\n        ' @ ' +\n        notification.title;\n    }\n\n    notification.title = wrapPlainText(notification.title);\n\n    notification.onclick = () => {\n      appImManager.setInnerPeer({peerId, lastMsgId: message.mid});\n    };\n\n    notification.message = notificationMessage;\n    notification.key = 'msg' + message.mid;\n    notification.tag = peerString;\n    notification.silent = true;// message.pFlags.silent || false;\n\n    const peerPhoto = await this.managers.appPeersManager.getPeerPhoto(peerId);\n    if(peerPhoto) {\n      this.managers.appAvatarsManager.loadAvatar(peerId, peerPhoto, 'photo_small').then((url) => {\n        // ! WARNING, message can be already read\n        if(message.pFlags.unread || peerReaction) {\n          notification.image = url;\n          this.notify(notification);\n        }\n      });\n    } else {\n      this.notify(notification);\n    }\n  }\n\n  private toggleToggler(enable = idleController.isIdle) {\n    if(IS_MOBILE) return;\n\n    const resetTitle = (isBlink?: boolean) => {\n      this.titleChanged = false;\n      document.title = this.titleBackup;\n      this.setFavicon();\n    };\n\n    window.clearInterval(this.titleInterval);\n    this.titleInterval = 0;\n\n    if(!enable) {\n      resetTitle();\n    } else {\n      this.titleInterval = window.setInterval(() => {\n        const count = this.notificationsCount;\n        if(!count) {\n          this.toggleToggler(false);\n        } else if(this.titleChanged) {\n          resetTitle(true);\n        } else {\n          this.titleChanged = true;\n          document.title = I18n.format('Notifications.Count', true, [count]);\n          // this.setFavicon('assets/img/favicon_unread.ico');\n\n          // fetch('assets/img/favicon.ico')\n          // .then((res) => res.blob())\n          // .then((blob) => {\n          // const img = document.createElement('img');\n          // img.src = URL.createObjectURL(blob);\n\n          const canvas = document.createElement('canvas');\n          canvas.width = 32 * window.devicePixelRatio;\n          canvas.height = canvas.width;\n\n          const ctx = canvas.getContext('2d');\n          ctx.beginPath();\n          ctx.arc(canvas.width / 2, canvas.height / 2, canvas.width / 2, 0, 2 * Math.PI, false);\n          ctx.fillStyle = '#3390ec';\n          ctx.fill();\n\n          let fontSize = 24;\n          let str = '' + count;\n          if(count < 10) {\n            fontSize = 22;\n          } else if(count < 100) {\n            fontSize = 20;\n          } else {\n            str = '99+';\n            fontSize = 16;\n          }\n\n          fontSize *= window.devicePixelRatio;\n\n          ctx.font = `700 ${fontSize}px ${FontFamily}`;\n          ctx.textBaseline = 'middle';\n          ctx.textAlign = 'center';\n          ctx.fillStyle = 'white';\n          ctx.fillText(str, canvas.width / 2, canvas.height * .5625);\n\n          /* const ctx = canvas.getContext('2d');\n            ctx.drawImage(img, 0, 0, canvas.width, canvas.height); */\n\n          this.setFavicon(canvas.toDataURL());\n          // });\n        }\n      }, 1000);\n    }\n  }\n\n  private setFavicon(href: string = 'assets/img/favicon.ico') {\n    if(this.prevFavicon === href) {\n      return;\n    }\n\n    const link = this.faviconEl.cloneNode() as HTMLLinkElement;\n    link.href = href;\n    this.faviconEl.parentNode.replaceChild(link, this.faviconEl);\n    this.faviconEl = link;\n\n    this.prevFavicon = href;\n  }\n\n  public notify(data: NotifyOptions) {\n    // console.log('notify', data, rootScope.idle.isIDLE, this.notificationsUiSupport, this.stopped);\n\n    if(this.stopped) {\n      return;\n    }\n\n    // FFOS Notification blob src bug workaround\n    /* if(Config.Navigator.ffos && !Config.Navigator.ffos2p) {\n      data.image = 'https://telegram.org/img/t_logo.png'\n    }\n    else if (data.image && !angular.isString(data.image)) {\n      if (Config.Navigator.ffos2p) {\n        FileManager.getDataUrl(data.image, 'image/jpeg').then(function (url) {\n          data.image = url\n          notify(data)\n        })\n        return false\n      } else {\n        data.image = FileManager.getUrl(data.image, 'image/jpeg')\n      }\n    }\n    else */ if(!data.image) {\n      data.image = 'assets/img/logo_filled_rounded.png';\n    }\n    // console.log('notify image', data.image)\n\n    if(!data.noIncrement) {\n      ++this.notificationsCount;\n    }\n\n    if(!this.titleInterval) {\n      this.toggleToggler();\n    }\n\n    const idx = ++this.notificationIndex;\n    const key = data.key || 'k' + idx;\n    this.notificationsShown[key] = true;\n\n    const now = tsNow();\n    if(this.settings.volume > 0 && !this.settings.nosound/* &&\n      (\n        !data.tag ||\n        !this.soundsPlayed[data.tag] ||\n        now > this.soundsPlayed[data.tag] + 60000\n      ) */\n    ) {\n      this.testSound(this.settings.volume);\n      this.soundsPlayed[data.tag] = now;\n    }\n\n    if(!this.notificationsUiSupport ||\n      'Notification' in window && Notification.permission !== 'granted') {\n      return false;\n    }\n\n    if(this.settings.nodesktop) {\n      if(this.vibrateSupport && !this.settings.novibrate) {\n        navigator.vibrate([200, 100, 200]);\n        return;\n      }\n\n      return;\n    }\n\n    let notification: MyNotification;\n\n    if('Notification' in window) {\n      try {\n        if(data.tag) {\n          for(const i in this.notificationsShown) {\n            const notification = this.notificationsShown[i];\n            if(typeof(notification) !== 'boolean' && notification.tag === data.tag) {\n              notification.hidden = true;\n            }\n          }\n        }\n\n        notification = new Notification(data.title, {\n          icon: data.image || '',\n          body: data.message || '',\n          tag: data.tag || '',\n          silent: data.silent || false\n        });\n\n        // console.log('notify constructed notification');\n      } catch(e) {\n        this.notificationsUiSupport = false;\n        webPushApiManager.setLocalNotificationsDisabled();\n        return;\n      }\n    } /* else if('mozNotification' in navigator) {\n      notification = navigator.mozNotification.createNotification(data.title, data.message || '', data.image || '')\n    } else if(notificationsMsSiteMode) {\n      window.external.msSiteModeClearIconOverlay()\n      window.external.msSiteModeSetIconOverlay('img/icons/icon16.png', data.title)\n      window.external.msSiteModeActivate()\n      notification = {\n        index: idx\n      }\n    } */ else {\n      return;\n    }\n\n    notification.onclick = () => {\n      notification.close();\n      appRuntimeManager.focus();\n      this.clear();\n      if(data.onclick) {\n        data.onclick();\n      }\n    };\n\n    notification.onclose = () => {\n      if(!notification.hidden) {\n        delete this.notificationsShown[key];\n        this.clear();\n      }\n    };\n\n    if(notification.show) {\n      notification.show();\n    }\n    this.notificationsShown[key] = notification;\n\n    if(!IS_MOBILE) {\n      setTimeout(() => {\n        this.hide(key);\n      }, 8000);\n    }\n  }\n\n  public updateLocalSettings = () => {\n    const keys = ['notify_nodesktop', 'notify_volume', 'notify_novibrate', 'notify_nopreview', 'notify_nopush'];\n    const promises = keys.map(() => undefined);\n    // const promises = keys.map((k) => stateStorage.get(k as any));\n    Promise.all(promises)\n    .then((updSettings) => {\n      this.settings.nodesktop = updSettings[0];\n      this.settings.volume = updSettings[1] === undefined ? 0.5 : updSettings[1];\n      this.settings.novibrate = updSettings[2];\n      this.settings.nopreview = updSettings[3];\n      this.settings.nopush = updSettings[4];\n\n      if(this.pushInited) {\n        const needPush = !this.settings.nopush && !this.settings.nodesktop && webPushApiManager.isAvailable || false;\n        const hasPush = this.registeredDevice !== false;\n        if(needPush !== hasPush) {\n          if(needPush) {\n            webPushApiManager.subscribe();\n          } else {\n            webPushApiManager.unsubscribe();\n          }\n        }\n      }\n\n      webPushApiManager.setSettings(this.settings);\n    });\n\n    apiManagerProxy.getState().then((state) => {\n      this.settings.nosound = !state.settings.notifications.sound;\n    });\n  }\n\n  public getLocalSettings() {\n    return this.settings;\n  }\n\n  private hide(key: string) {\n    const notification = this.notificationsShown[key];\n    if(notification && typeof(notification) !== 'boolean') {\n      try {\n        if(notification.close) {\n          notification.hidden = true;\n          notification.close();\n        }\n      } catch(e) {}\n    }\n  }\n\n  public soundReset(tag: string) {\n    delete this.soundsPlayed[tag];\n  }\n\n  private requestPermission = () => {\n    Notification.requestPermission();\n    window.removeEventListener('click', this.requestPermission);\n  };\n\n  public testSound(volume: number) {\n    const now = tsNow();\n    if(this.nextSoundAt && now < this.nextSoundAt && this.prevSoundVolume === volume) {\n      return;\n    }\n\n    this.nextSoundAt = now + 1000;\n    this.prevSoundVolume = volume;\n    const filename = 'assets/audio/notification.mp3';\n    const audio = document.createElement('audio');\n    audio.autoplay = true;\n    audio.setAttribute('mozaudiochannel', 'notification');\n    audio.volume = volume;\n    audio.innerHTML = `\n      <source src=\"${filename}\" type=\"audio/mpeg\" />\n      <embed hidden=\"true\" autostart=\"true\" loop=\"false\" volume=\"${volume * 100}\" src=\"${filename}\" />\n    `;\n    this.notifySoundEl.append(audio);\n\n    audio.addEventListener('ended', () => {\n      audio.remove();\n    }, {once: true});\n  }\n\n  public cancel(key: string) {\n    const notification = this.notificationsShown[key];\n    if(notification) {\n      if(this.notificationsCount > 0) {\n        --this.notificationsCount;\n      }\n\n      try {\n        if(typeof(notification) !== 'boolean' && notification.close) {\n          notification.hidden = true;\n          notification.close();\n        }/*  else if(notificationsMsSiteMode &&\n          notification.index === notificationIndex) {\n          window.external.msSiteModeClearIconOverlay()\n        } */\n      } catch(e) {}\n\n      delete this.notificationsShown[key];\n    }\n  }\n\n  public clear() {\n    /* if(notificationsMsSiteMode) {\n      window.external.msSiteModeClearIconOverlay()\n    } else { */\n    for(const i in this.notificationsShown) {\n      const notification = this.notificationsShown[i];\n      try {\n        if(typeof(notification) !== 'boolean' && notification.close) {\n          notification.close();\n        }\n      } catch(e) {}\n    }\n    /* } */\n    this.notificationsShown = {};\n    this.notificationsCount = 0;\n\n    webPushApiManager.hidePushNotifications();\n  }\n\n  public start() {\n    this.updateLocalSettings();\n    rootScope.addEventListener('settings_updated', this.updateLocalSettings);\n    webPushApiManager.start();\n\n    if(!this.notificationsUiSupport) {\n      return false;\n    }\n\n    if('Notification' in window && Notification.permission !== 'granted' && Notification.permission !== 'denied') {\n      window.addEventListener('click', this.requestPermission);\n    }\n\n    try {\n      if('onbeforeunload' in window) {\n        window.addEventListener('beforeunload', this.clear);\n      }\n    } catch(e) {}\n  }\n\n  private stop() {\n    this.clear();\n    window.clearInterval(this.titleInterval);\n    this.titleInterval = 0;\n    this.setFavicon();\n    this.stopped = true;\n  }\n\n  private registerDevice(tokenData: PushSubscriptionNotify) {\n    if(this.registeredDevice && deepEqual(this.registeredDevice, tokenData)) {\n      return false;\n    }\n\n    this.managers.apiManager.invokeApi('account.registerDevice', {\n      token_type: tokenData.tokenType,\n      token: tokenData.tokenValue,\n      other_uids: [],\n      app_sandbox: false,\n      secret: new Uint8Array()\n    }).then(() => {\n      this.registeredDevice = tokenData;\n    }, (error) => {\n      error.handled = true;\n    });\n  }\n\n  private unregisterDevice(tokenData: PushSubscriptionNotify) {\n    if(!this.registeredDevice) {\n      return false;\n    }\n\n    this.managers.apiManager.invokeApi('account.unregisterDevice', {\n      token_type: tokenData.tokenType,\n      token: tokenData.tokenValue,\n      other_uids: []\n    }).then(() => {\n      this.registeredDevice = false;\n    }, (error) => {\n      error.handled = true;\n    });\n  }\n}\n\nconst uiNotificationsManager = new UiNotificationsManager();\nMOUNT_CLASS_TO && (MOUNT_CLASS_TO.uiNotificationsManager = uiNotificationsManager);\nexport default uiNotificationsManager;\n","export default async function getFilesFromEvent(e: ClipboardEvent | DragEvent, onlyTypes = false): Promise<any[]> {\n  const files: any[] = [];\n\n  const scanFiles = async(entry: any, item: DataTransferItem) => {\n    if(entry.isDirectory) {\n      const directoryReader = entry.createReader();\n      await new Promise<void>((resolve, reject) => {\n        directoryReader.readEntries(async(entries: any) => {\n          for(const entry of entries) {\n            await scanFiles(entry, item);\n          }\n\n          resolve();\n        });\n      });\n    } else if(entry) {\n      if(onlyTypes) {\n        files.push(entry.type);\n      } else {\n        const itemFile = item.getAsFile(); // * Safari can't handle entry.file with pasting\n        const file = entry instanceof File ?\n          entry :\n          (\n            entry instanceof DataTransferItem ?\n              entry.getAsFile() :\n              await new Promise((resolve, reject) => entry.file(resolve, (err: any) => resolve(itemFile)))\n          );\n\n        /* if(!onlyTypes) {\n          console.log('getFilesFromEvent: got file', item, file);\n        } */\n\n        if(!file) return;\n        files.push(file);\n      }\n    }\n  };\n\n  if(e instanceof DragEvent && e.dataTransfer.files && !e.dataTransfer.items) {\n    for(let i = 0; i < e.dataTransfer.files.length; i++) {\n      const file = e.dataTransfer.files[i];\n      files.push(onlyTypes ? file.type : file);\n    }\n  } else {\n    // @ts-ignore\n    const items = (e.dataTransfer || e.clipboardData || e.originalEvent.clipboardData).items;\n\n    const promises: Promise<any>[] = [];\n    for(let i = 0; i < items.length; ++i) {\n      const item: DataTransferItem = items[i];\n      if(item.kind === 'file') {\n        const entry = (onlyTypes ? item : item.webkitGetAsEntry()) || item.getAsFile();\n        promises.push(scanFiles(entry, item));\n      }\n    }\n\n    await Promise.all(promises);\n  }\n\n  /* if(!onlyTypes) {\n    console.log('getFilesFromEvent: got files:', e, files);\n  } */\n\n  return files;\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport animationIntersector, {AnimationItemGroup} from '../../components/animationIntersector';\nimport appSidebarLeft, {LEFT_COLUMN_ACTIVE_CLASSNAME} from '../../components/sidebarLeft';\nimport appSidebarRight, {RIGHT_COLUMN_ACTIVE_CLASSNAME} from '../../components/sidebarRight';\nimport mediaSizes, {ScreenSize} from '../../helpers/mediaSizes';\nimport {logger, LogTypes} from '../logger';\nimport rootScope from '../rootScope';\nimport Chat, {ChatType} from '../../components/chat/chat';\nimport PopupNewMedia, {getCurrentNewMediaPopup} from '../../components/popups/newMedia';\nimport MarkupTooltip from '../../components/chat/markupTooltip';\nimport IS_TOUCH_SUPPORTED from '../../environment/touchSupport';\nimport SetTransition from '../../components/singleTransition';\nimport ChatDragAndDrop from '../../components/chat/dragAndDrop';\nimport {doubleRaf} from '../../helpers/schedulers';\nimport lottieLoader from '../rlottie/lottieLoader';\nimport useHeavyAnimationCheck, {dispatchHeavyAnimationEvent} from '../../hooks/useHeavyAnimationCheck';\nimport stateStorage from '../stateStorage';\nimport {MOUNT_CLASS_TO} from '../../config/debug';\nimport appNavigationController from '../../components/appNavigationController';\nimport AppPrivateSearchTab from '../../components/sidebarRight/tabs/search';\nimport I18n, {i18n, join, LangPackKey} from '../langPack';\nimport {ChatFull, ChatInvite, ChatParticipant, ChatParticipants, Message, MessageAction, MessageMedia, SendMessageAction} from '../../layer';\nimport PeerTitle from '../../components/peerTitle';\nimport PopupPeer from '../../components/popups/peer';\nimport blurActiveElement from '../../helpers/dom/blurActiveElement';\nimport cancelEvent from '../../helpers/dom/cancelEvent';\nimport disableTransition from '../../helpers/dom/disableTransition';\nimport placeCaretAtEnd from '../../helpers/dom/placeCaretAtEnd';\nimport replaceContent from '../../helpers/dom/replaceContent';\nimport whichChild from '../../helpers/dom/whichChild';\nimport PopupElement from '../../components/popups';\nimport singleInstance, {InstanceDeactivateReason, SingleInstance} from '../mtproto/singleInstance';\nimport PopupStickers from '../../components/popups/stickers';\nimport PopupJoinChatInvite from '../../components/popups/joinChatInvite';\nimport {toast, toastNew} from '../../components/toast';\nimport debounce from '../../helpers/schedulers/debounce';\nimport pause from '../../helpers/schedulers/pause';\nimport {InternalLink, InternalLinkTypeMap, INTERNAL_LINK_TYPE} from './internalLink';\nimport MEDIA_MIME_TYPES_SUPPORTED from '../../environment/mediaMimeTypesSupport';\nimport {NULL_PEER_ID} from '../mtproto/mtproto_config';\nimport telegramMeWebManager from '../mtproto/telegramMeWebManager';\nimport {ONE_DAY} from '../../helpers/date';\nimport type {GroupCallId, MyGroupCall} from './appGroupCallsManager';\nimport TopbarCall from '../../components/topbarCall';\nimport confirmationPopup from '../../components/confirmationPopup';\nimport IS_GROUP_CALL_SUPPORTED from '../../environment/groupCallSupport';\nimport IS_CALL_SUPPORTED from '../../environment/callSupport';\nimport {CallType} from '../calls/types';\nimport {Awaited, Modify, SendMessageEmojiInteractionData} from '../../types';\nimport htmlToSpan from '../../helpers/dom/htmlToSpan';\nimport getVisibleRect from '../../helpers/dom/getVisibleRect';\nimport {attachClickEvent, simulateClickEvent} from '../../helpers/dom/clickEvent';\nimport PopupCall from '../../components/call';\nimport copy from '../../helpers/object/copy';\nimport getObjectKeysAndSort from '../../helpers/object/getObjectKeysAndSort';\nimport type GroupCallInstance from '../calls/groupCallInstance';\nimport type CallInstance from '../calls/callInstance';\nimport numberThousandSplitter from '../../helpers/number/numberThousandSplitter';\nimport ChatBackgroundPatternRenderer from '../../components/chat/patternRenderer';\nimport {IS_FIREFOX} from '../../environment/userAgent';\nimport compareVersion from '../../helpers/compareVersion';\nimport {AppManagers} from './managers';\nimport uiNotificationsManager from './uiNotificationsManager';\nimport appMediaPlaybackController from '../../components/appMediaPlaybackController';\nimport {PHONE_NUMBER_REG_EXP} from '../richTextProcessor';\nimport wrapEmojiText from '../richTextProcessor/wrapEmojiText';\nimport wrapRichText from '../richTextProcessor/wrapRichText';\nimport wrapUrl from '../richTextProcessor/wrapUrl';\nimport generateMessageId from './utils/messageId/generateMessageId';\nimport getUserStatusString from '../../components/wrappers/getUserStatusString';\nimport getChatMembersString from '../../components/wrappers/getChatMembersString';\nimport {STATE_INIT} from '../../config/state';\nimport CacheStorageController from '../files/cacheStorage';\nimport themeController from '../../helpers/themeController';\nimport overlayCounter from '../../helpers/overlayCounter';\nimport appDialogsManager from './appDialogsManager';\nimport idleController from '../../helpers/idleController';\nimport EventListenerBase from '../../helpers/eventListenerBase';\nimport {AckedResult} from '../mtproto/superMessagePort';\nimport groupCallsController from '../calls/groupCallsController';\nimport callsController from '../calls/callsController';\nimport getFilesFromEvent from '../../helpers/files/getFilesFromEvent';\nimport apiManagerProxy from '../mtproto/mtprotoworker';\nimport appRuntimeManager from './appRuntimeManager';\nimport paymentsWrapCurrencyAmount from '../../helpers/paymentsWrapCurrencyAmount';\nimport findUpClassName from '../../helpers/dom/findUpClassName';\nimport {CLICK_EVENT_NAME} from '../../helpers/dom/clickEvent';\nimport PopupPayment from '../../components/popups/payment';\n\nexport const CHAT_ANIMATION_GROUP: AnimationItemGroup = 'chat';\n\nexport type ChatSavedPosition = {\n  mids: number[],\n  top: number\n};\n\nexport type ChatSetPeerOptions = {\n  peerId?: PeerId,\n  lastMsgId?: number,\n  threadId?: number,\n  startParam?: string\n};\n\nexport type ChatSetInnerPeerOptions = Modify<ChatSetPeerOptions, {\n  peerId: PeerId\n}> & {\n  type?: ChatType\n};\n\nexport class AppImManager extends EventListenerBase<{\n  chat_changing: (details: {from: Chat, to: Chat}) => void,\n  peer_changed: (peerId: PeerId) => void,\n  peer_changing: (chat: Chat) => void,\n}> {\n  public columnEl = document.getElementById('column-center') as HTMLDivElement;\n  public chatsContainer: HTMLElement;\n\n  public offline = false;\n  public updateStatusInterval = 0;\n\n  public log: ReturnType<typeof logger>;\n\n  public setPeerPromise: Promise<void> = null;\n\n  public tabId = -1;\n\n  public chats: Chat[] = [];\n  private prevTab: HTMLElement;\n  private chatsSelectTabDebounced: () => void;\n\n  public markupTooltip: MarkupTooltip;\n  private backgroundPromises: {[slug: string]: Promise<string>};\n\n  private topbarCall: TopbarCall;\n  public emojiAnimationContainer: HTMLDivElement;\n\n  private lastBackgroundUrl: string;\n\n  public managers: AppManagers;\n\n  public cacheStorage = new CacheStorageController('cachedFiles');\n\n  get myId() {\n    return rootScope.myId;\n  }\n\n  get chat(): Chat {\n    return this.chats[this.chats.length - 1];\n  }\n\n  public construct(managers: AppManagers) {\n    this.managers = managers;\n\n    const {\n      apiUpdatesManager\n    } = managers;\n    apiUpdatesManager.attach(I18n.lastRequestedLangCode);\n\n    appMediaPlaybackController.construct(managers);\n    uiNotificationsManager.construct(managers);\n    uiNotificationsManager.start();\n\n    this.log = logger('IM', LogTypes.Log | LogTypes.Warn | LogTypes.Debug | LogTypes.Error);\n\n    this.backgroundPromises = {};\n    STATE_INIT.settings.themes.forEach((theme) => {\n      if(theme.background.slug) {\n        const url = 'assets/img/' + theme.background.slug + '.svg' + (IS_FIREFOX ? '?1' : '');\n        this.backgroundPromises[theme.background.slug] = Promise.resolve(url);\n      }\n    });\n\n    this.selectTab(0);\n\n    idleController.addEventListener('change', (idle) => {\n      this.offline = idle;\n      this.updateStatus();\n      if(idle) {\n        clearInterval(this.updateStatusInterval);\n      } else {\n        this.updateStatusInterval = window.setInterval(() => this.updateStatus(), 50e3);\n      }\n    });\n\n    this.chatsContainer = document.createElement('div');\n    this.chatsContainer.classList.add('chats-container', 'tabs-container');\n    this.chatsContainer.dataset.animation = 'navigation';\n\n    this.emojiAnimationContainer = document.createElement('div');\n    this.emojiAnimationContainer.classList.add('emoji-animation-container');\n    this.appendEmojiAnimationContainer(mediaSizes.activeScreen);\n\n    this.columnEl.append(this.chatsContainer);\n\n    this.createNewChat();\n    this.chatsSelectTab(this.chat.container);\n\n    appNavigationController.onHashChange = this.onHashChange;\n    // window.addEventListener('hashchange', this.onHashChange);\n\n    this.setSettings();\n    rootScope.addEventListener('settings_updated', this.setSettings);\n\n    const onPremiumToggle = (isPremium: boolean) => {\n      document.body.classList.toggle('is-premium', isPremium);\n    };\n    rootScope.addEventListener('premium_toggle', onPremiumToggle);\n    onPremiumToggle(rootScope.premium);\n\n    useHeavyAnimationCheck(() => {\n      animationIntersector.setOnlyOnePlayableGroup('lock');\n      animationIntersector.checkAnimations(true);\n    }, () => {\n      animationIntersector.setOnlyOnePlayableGroup();\n      animationIntersector.checkAnimations(false);\n    });\n\n    if(IS_FIREFOX && apiManagerProxy.oldVersion && compareVersion(apiManagerProxy.oldVersion, '1.4.3') === -1) {\n      this.deleteFilesIterative((response) => {\n        return response.headers.get('Content-Type') === 'image/svg+xml';\n      }).then(() => {\n        this.applyCurrentTheme();\n      });\n    } else {\n      this.applyCurrentTheme();\n    }\n\n    // * fix simultaneous opened both sidebars, can happen when floating sidebar is opened with left sidebar\n    mediaSizes.addEventListener('changeScreen', (from, to) => {\n      if(document.body.classList.contains(LEFT_COLUMN_ACTIVE_CLASSNAME) &&\n        document.body.classList.contains(RIGHT_COLUMN_ACTIVE_CLASSNAME)) {\n        appSidebarRight.toggleSidebar(false);\n      }\n\n      this.appendEmojiAnimationContainer(to);\n    });\n\n    mediaSizes.addEventListener('resize', () => {\n      // const perf = performance.now();\n      const rect = this.chatsContainer.getBoundingClientRect();\n      ChatBackgroundPatternRenderer.resizeInstances(rect.width, rect.height).then(() => {\n        // this.log.warn('resize bg time:', performance.now() - perf);\n        // for(const chat of this.chats) {\n        //   if(chat.renderDarkPattern) {\n        //     chat.renderDarkPattern();\n        //   }\n        // }\n      });\n    });\n\n    this.addEventListener('peer_changing', (chat) => {\n      this.saveChatPosition(chat);\n    });\n\n    rootScope.addEventListener('theme_change', () => {\n      this.applyCurrentTheme();\n    });\n\n    rootScope.addEventListener('choosing_sticker', (choosing) => {\n      this.setChoosingStickerTyping(!choosing);\n    });\n\n    rootScope.addEventListener('peer_typings', ({peerId, typings}) => {\n      const chat = this.chat;\n      if(\n        !chat ||\n        chat.peerId !== peerId ||\n        overlayCounter.isOverlayActive || (\n          mediaSizes.activeScreen === ScreenSize.mobile &&\n          this.tabId !== 1\n        )\n      ) {\n        return;\n      }\n\n      const typing = typings.find((typing) => typing.action._ === 'sendMessageEmojiInteraction');\n      if(typing?.action?._ === 'sendMessageEmojiInteraction') {\n        const action = typing.action;\n        const bubble = chat.bubbles.bubbles[generateMessageId(typing.action.msg_id)];\n        if(bubble && bubble.classList.contains('emoji-big') && getVisibleRect(bubble, chat.bubbles.scrollable.container)) {\n          const stickerWrapper: HTMLElement = bubble.querySelector('.media-sticker-wrapper:not(.bubble-hover-reaction-sticker):not(.reaction-sticker)');\n\n          const data: SendMessageEmojiInteractionData = JSON.parse(action.interaction.data);\n          data.a.forEach((a) => {\n            setTimeout(() => {\n              simulateClickEvent(stickerWrapper);\n            }, a.t * 1000);\n          });\n\n          this.managers.appMessagesManager.setTyping(peerId, {\n            _: 'sendMessageEmojiInteractionSeen',\n            emoticon: action.emoticon\n          });\n        }\n      }\n    });\n\n    const onInstanceDeactivated = (reason: InstanceDeactivateReason) => {\n      const isUpdated = reason === 'version';\n      const popup = new PopupElement('popup-instance-deactivated', {overlayClosable: true});\n      const c = document.createElement('div');\n      c.classList.add('instance-deactivated-container');\n      (popup as any).container.replaceWith(c);\n\n      const header = document.createElement('div');\n      header.classList.add('header');\n      header.append(i18n(isUpdated ? 'Deactivated.Version.Title' : 'Deactivated.Title'));\n\n      const subtitle = document.createElement('div');\n      subtitle.classList.add('subtitle');\n      subtitle.append(i18n(isUpdated ? 'Deactivated.Version.Subtitle' : 'Deactivated.Subtitle'));\n\n      c.append(header, subtitle);\n\n      document.body.classList.add('deactivated');\n\n      const onClose = isUpdated ? () => {\n        appRuntimeManager.reload();\n      } : () => {\n        document.body.classList.add('deactivated-backwards');\n\n        singleInstance.activateInstance();\n\n        setTimeout(() => {\n          document.body.classList.remove('deactivated', 'deactivated-backwards');\n        }, 333);\n      };\n\n      popup.addEventListener('close', onClose);\n      popup.show();\n    };\n\n    singleInstance.addEventListener('deactivated', onInstanceDeactivated);\n    if(singleInstance.deactivatedReason) {\n      onInstanceDeactivated(singleInstance.deactivatedReason);\n    }\n\n    // remove scroll listener when setting chat to tray\n    this.addEventListener('chat_changing', ({to}) => {\n      this.toggleChatGradientAnimation(to);\n    });\n\n    rootScope.addEventListener('service_notification', (update) => {\n      confirmationPopup({\n        button: {langKey: 'OK', isCancel: true},\n        description: wrapRichText(update.message)\n      });\n    });\n\n    rootScope.addEventListener('payment_sent', async({peerId, mid, receiptMessage}) => {\n      const message = await this.managers.appMessagesManager.getMessageByPeer(peerId, mid);\n      if(!message) {\n        return;\n      }\n\n      const action = receiptMessage.action as MessageAction.messageActionPaymentSent;\n      toastNew({\n        langPackKey: 'PaymentInfoHint',\n        langPackArguments: [\n          paymentsWrapCurrencyAmount(action.total_amount, action.currency),\n          wrapEmojiText(((message as Message.message).media as MessageMedia.messageMediaInvoice).title)\n        ]\n      });\n    });\n\n    (window as any).onSpoilerClick = (e: MouseEvent) => {\n      const spoiler = findUpClassName(e.target, 'spoiler');\n      const parentElement = findUpClassName(spoiler, 'spoilers-container') || spoiler.parentElement;\n\n      const className = 'is-spoiler-visible';\n      const isVisible = parentElement.classList.contains(className);\n      if(!isVisible) {\n        cancelEvent(e);\n\n        if(CLICK_EVENT_NAME !== 'click') {\n          window.addEventListener('click', cancelEvent, {capture: true, once: true});\n        }\n      }\n\n      const duration = 400 / 2;\n      const showDuration = 5000;\n      const useRafs = !isVisible ? 2 : 0;\n      if(useRafs) {\n        parentElement.classList.add('will-change');\n      }\n\n      const spoilerTimeout = parentElement.dataset.spoilerTimeout;\n      if(spoilerTimeout !== null) {\n        clearTimeout(+spoilerTimeout);\n        delete parentElement.dataset.spoilerTimeout;\n      }\n\n      SetTransition(parentElement, className, true, duration, () => {\n        parentElement.dataset.spoilerTimeout = '' + window.setTimeout(() => {\n          SetTransition(parentElement, className, false, duration, () => {\n            parentElement.classList.remove('will-change');\n            delete parentElement.dataset.spoilerTimeout;\n          });\n        }, showDuration);\n      }, useRafs);\n    };\n\n    rootScope.addEventListener('sticker_updated', ({type, faved}) => {\n      if(type === 'faved') {\n        toastNew({\n          langPackKey: faved ? 'AddedToFavorites' : 'RemovedFromFavorites'\n        });\n      } else if(!faved) {\n        toastNew({\n          langPackKey: 'RemovedFromRecent'\n        });\n      }\n    });\n\n    apiManagerProxy.addEventListener('notificationBuild', (options) => {\n      if(this.chat.peerId === options.message.peerId && !idleController.isIdle) {\n        return;\n      }\n\n      uiNotificationsManager.buildNotification(options);\n    });\n\n    this.addEventListener('peer_changed', async(peerId) => {\n      document.body.classList.toggle('has-chat', !!peerId);\n\n      this.emojiAnimationContainer.textContent = '';\n\n      this.overrideHash(peerId);\n\n      apiManagerProxy.updateTabState('chatPeerIds', this.chats.map((chat) => chat.peerId).filter(Boolean));\n    });\n\n    // stateStorage.get('chatPositions').then((c) => {\n    stateStorage.setToCache('chatPositions', /* c ||  */{});\n    // });\n\n    if(IS_CALL_SUPPORTED || IS_GROUP_CALL_SUPPORTED) {\n      this.topbarCall = new TopbarCall(managers);\n    }\n\n    if(IS_CALL_SUPPORTED) {\n      callsController.addEventListener('instance', ({instance/* , hasCurrent */}) => {\n        // if(hasCurrent) {\n        // return;\n        // }\n\n        const popup = new PopupCall(instance);\n\n        instance.addEventListener('acceptCallOverride', () => {\n          return this.discardCurrentCall(instance.interlocutorUserId.toPeerId(), undefined, instance)\n          .then(() => {\n            callsController.dispatchEvent('accepting', instance);\n            return true;\n          })\n          .catch(() => false);\n        });\n\n        popup.addEventListener('close', () => {\n          const currentCall = callsController.currentCall;\n          if(currentCall && currentCall !== instance && !instance.wasTryingToJoin) {\n            instance.hangUp('phoneCallDiscardReasonBusy');\n          }\n        }, {once: true});\n\n        popup.show();\n      });\n\n      callsController.addEventListener('incompatible', (userId) => {\n        toastNew({\n          langPackKey: 'VoipPeerIncompatible',\n          langPackArguments: [\n            new PeerTitle({peerId: userId.toPeerId()}).element\n          ]\n        });\n      });\n    }\n\n    // ! do not remove this line\n    // ! instance can be deactivated before the UI starts, because it waits in background for RAF that is delayed\n    singleInstance.activateInstance();\n\n    const setAuthorized = () => {\n      telegramMeWebManager.setAuthorized(true);\n    };\n\n    setInterval(setAuthorized, ONE_DAY);\n    setAuthorized();\n\n    this.addAnchorListener<{}>({\n      name: 'showMaskedAlert',\n      callback: (params, element) => {\n        const href = element.href;\n\n        const a = element.cloneNode(true) as HTMLAnchorElement;\n        a.className = 'anchor-url';\n        a.innerText = href;\n        a.removeAttribute('onclick');\n\n        new PopupPeer('popup-masked-url', {\n          titleLangKey: 'OpenUrlTitle',\n          descriptionLangKey: 'OpenUrlAlert2',\n          descriptionLangArgs: [a],\n          buttons: [{\n            langKey: 'Open',\n            callback: () => {\n              a.click();\n            }\n          }]\n        }).show();\n      }\n    });\n\n    this.addAnchorListener<{uriParams: {command: string, bot: string}}>({\n      name: 'execBotCommand',\n      callback: ({uriParams}) => {\n        const {command, bot} = uriParams;\n\n        /* const promise = bot ? this.openUsername(bot).then(() => this.chat.peerId) : Promise.resolve(this.chat.peerId);\n        promise.then((peerId) => {\n          this.managers.appMessagesManager.sendText(peerId, '/' + command);\n        }); */\n\n        this.managers.appMessagesManager.sendText(this.chat.peerId, '/' + command + (bot ? '@' + bot : ''));\n\n        // console.log(command, bot);\n      }\n    });\n\n    this.addAnchorListener<{uriParams: {hashtag: string}}>({\n      name: 'searchByHashtag',\n      callback: ({uriParams}) => {\n        const {hashtag} = uriParams;\n        if(!hashtag) {\n          return;\n        }\n\n        this.chat.initSearch('#' + hashtag + ' ');\n      }\n    });\n\n    ([\n      ['addstickers', INTERNAL_LINK_TYPE.STICKER_SET],\n      ['addemoji', INTERNAL_LINK_TYPE.EMOJI_SET]\n    ] as [\n      'addstickers' | 'addemoji',\n      INTERNAL_LINK_TYPE.STICKER_SET | INTERNAL_LINK_TYPE.EMOJI_SET\n    ][]).forEach(([name, type]) => {\n      this.addAnchorListener<{pathnameParams: [typeof name, string]}>({\n        name,\n        callback: ({pathnameParams}) => {\n          if(!pathnameParams[1]) {\n            return;\n          }\n\n          const link: InternalLink = {\n            _: type,\n            set: pathnameParams[1]\n          };\n\n          this.processInternalLink(link);\n        }\n      });\n\n      this.addAnchorListener<{\n        uriParams: {\n          set: string\n        }\n      }>({\n        name,\n        protocol: 'tg',\n        callback: ({uriParams}) => {\n          const link = this.makeLink(type, uriParams);\n          this.processInternalLink(link);\n        }\n      });\n    });\n\n    // * t.me/invoice/asdasdad\n    // * t.me/$asdasdad\n    this.addAnchorListener<{pathnameParams: ['invoice', string] | string}>({\n      name: 'invoice',\n      callback: ({pathnameParams}) => {\n        const link: InternalLink = {\n          _: INTERNAL_LINK_TYPE.INVOICE,\n          slug: pathnameParams.length > 1 ? pathnameParams[1] : pathnameParams[0].slice(1)\n        };\n\n        this.processInternalLink(link);\n      }\n    });\n\n    // Support old t.me/joinchat/asd and new t.me/+asd\n    this.addAnchorListener<{pathnameParams: ['joinchat', string]}>({\n      name: 'joinchat',\n      callback: ({pathnameParams}) => {\n        const link: InternalLink = {\n          _: INTERNAL_LINK_TYPE.JOIN_CHAT,\n          invite: pathnameParams[1] || decodeURIComponent(pathnameParams[0]).slice(1)\n        };\n\n        this.processInternalLink(link);\n      }\n    });\n\n    if(IS_GROUP_CALL_SUPPORTED) {\n      this.addAnchorListener<{\n        uriParams: Omit<InternalLink.InternalLinkVoiceChat, '_'>\n      }>({\n        name: 'voicechat',\n        protocol: 'tg',\n        callback: ({uriParams}) => {\n          const link = this.makeLink(INTERNAL_LINK_TYPE.VOICE_CHAT, uriParams);\n          this.processInternalLink(link);\n        }\n      });\n    }\n\n    this.addAnchorListener<{\n    //   pathnameParams: ['c', string, string],\n    //   uriParams: {thread?: number}\n    // } | {\n    //   pathnameParams: [string, string?],\n    //   uriParams: {comment?: number}\n      pathnameParams: ['c', string, string] | [string, string?],\n      uriParams: {thread?: string, comment?: string} | {comment?: string, start?: string}\n    }>({\n      name: 'im',\n      callback: async({pathnameParams, uriParams}) => {\n        let link: InternalLink;\n        if(PHONE_NUMBER_REG_EXP.test(pathnameParams[0])) {\n          link = {\n            _: INTERNAL_LINK_TYPE.USER_PHONE_NUMBER,\n            phone: pathnameParams[0].slice(1)\n          };\n        } else if(pathnameParams[0] === 'c') {\n          link = {\n            _: INTERNAL_LINK_TYPE.PRIVATE_POST,\n            channel: pathnameParams[1],\n            post: pathnameParams[2],\n            thread: 'thread' in uriParams && uriParams.thread,\n            comment: uriParams.comment\n          };\n        } else {\n          link = {\n            _: INTERNAL_LINK_TYPE.MESSAGE,\n            domain: pathnameParams[0],\n            post: pathnameParams[1],\n            comment: uriParams.comment,\n            start: 'start' in uriParams ? uriParams.start : undefined\n          };\n        }\n\n        this.processInternalLink(link);\n      }\n    });\n\n    this.addAnchorListener<{\n      uriParams: {\n        domain: string,\n\n        // telegrampassport\n        scope?: string,\n        nonce?: string,\n        payload?: string,\n        bot_id?: string,\n        public_key?: string,\n        callback_url?: string,\n\n        // regular\n        start?: string,\n        startgroup?: string,\n        game?: string,\n        voicechat?: string,\n        post?: string,\n        thread?: string,\n        comment?: string,\n        phone?: string\n      }\n    }>({\n      name: 'resolve',\n      protocol: 'tg',\n      callback: ({uriParams}) => {\n        let link: InternalLink;\n        if(uriParams.phone) {\n          link = this.makeLink(INTERNAL_LINK_TYPE.USER_PHONE_NUMBER, uriParams as Required<typeof uriParams>);\n        } else if(uriParams.domain === 'telegrampassport') {\n\n        } else {\n          link = this.makeLink(INTERNAL_LINK_TYPE.MESSAGE, uriParams);\n        }\n\n        this.processInternalLink(link);\n      }\n    });\n\n    this.addAnchorListener<{\n      uriParams: {\n        channel: string,\n        post: string,\n        thread?: string,\n        comment?: string\n      }\n    }>({\n      name: 'privatepost',\n      protocol: 'tg',\n      callback: ({uriParams}) => {\n        const link = this.makeLink(INTERNAL_LINK_TYPE.PRIVATE_POST, uriParams);\n        this.processInternalLink(link);\n      }\n    });\n\n    this.addAnchorListener<{\n      uriParams: {\n        slug: string\n      }\n    }>({\n      name: 'invoice',\n      protocol: 'tg',\n      callback: ({uriParams}) => {\n        const link = this.makeLink(INTERNAL_LINK_TYPE.INVOICE, uriParams);\n        this.processInternalLink(link);\n      }\n    });\n\n    ['joinchat' as const, 'join' as const].forEach((name) => {\n      this.addAnchorListener<{\n        uriParams: {\n          invite: string\n        }\n      }>({\n        name,\n        protocol: 'tg',\n        callback: ({uriParams}) => {\n          const link = this.makeLink(INTERNAL_LINK_TYPE.JOIN_CHAT, uriParams);\n          this.processInternalLink(link);\n        }\n      });\n    });\n\n    this.onHashChange(true);\n    this.attachKeydownListener();\n  }\n\n  private deleteFilesIterative(callback: (response: Response) => boolean) {\n    return this.cacheStorage.timeoutOperation((cache) => {\n      const perf = performance.now();\n      return cache.keys().then((requests) => {\n        const promises = requests.map((request) => {\n          return cache.match(request).then((response) => {\n            return callback(response);\n          });\n        });\n\n        return Promise.all(promises).then((values) => {\n          values.map((isBad, idx) => {\n            if(!isBad) {\n              return;\n            }\n\n            const request = requests[idx];\n            return cache.delete(request);\n          });\n\n          return Promise.all(values.filter(Boolean));\n        });\n      }).then(() => {\n        this.log('deleted files', performance.now() - perf);\n      });\n    });\n  }\n\n  private toggleChatGradientAnimation(activatingChat: Chat) {\n    this.chats.forEach((chat) => {\n      if(chat.gradientRenderer) {\n        chat.gradientRenderer.scrollAnimate(rootScope.settings.animationsEnabled && chat === activatingChat);\n      }\n    });\n  }\n\n  private appendEmojiAnimationContainer(screen: ScreenSize) {\n    const appendTo = screen === ScreenSize.mobile ? this.columnEl : document.body;\n    if(this.emojiAnimationContainer.parentElement !== appendTo) {\n      appendTo.append(this.emojiAnimationContainer)\n    }\n  }\n\n  private attachKeydownListener() {\n    const IGNORE_KEYS = new Set(['PageUp', 'PageDown', 'Meta', 'Control']);\n    const onKeyDown = (e: KeyboardEvent) => {\n      const key = e.key;\n      if(overlayCounter.isOverlayActive || IGNORE_KEYS.has(key)) return;\n\n      const target = e.target as HTMLElement;\n\n      // if(target.tagName === 'INPUT') return;\n\n      // this.log('onkeydown', e, document.activeElement);\n\n      const chat = this.chat;\n\n      if(e.code === 'KeyC' && (e.ctrlKey || e.metaKey) && target.tagName !== 'INPUT') {\n        return;\n      } else if(e.altKey && (key === 'ArrowUp' || key === 'ArrowDown')) {\n        cancelEvent(e);\n        this.managers.dialogsStorage.getNextDialog(this.chat.peerId, key === 'ArrowDown', appDialogsManager.filterId).then((dialog) => {\n          if(dialog) {\n            this.setPeer({peerId: dialog.peerId});\n          }\n        });\n      } else if(key === 'ArrowUp' && this.chat.type !== 'scheduled') {\n        if(!chat.input.editMsgId && chat.input.isInputEmpty()) {\n          this.managers.appMessagesManager.getFirstMessageToEdit(chat.peerId, chat.threadId).then((message) => {\n            if(message) {\n              chat.input.initMessageEditing(message.mid);\n              cancelEvent(e); // * prevent from scrolling\n            }\n          });\n        } else {\n          return;\n        }\n      } else if(key === 'ArrowDown') {\n        return;\n      }\n\n      if(\n        chat?.input?.messageInput &&\n        e.target !== chat.input.messageInput &&\n        target.tagName !== 'INPUT' &&\n        !target.hasAttribute('contenteditable') &&\n        !IS_TOUCH_SUPPORTED &&\n        (!mediaSizes.isMobile || this.tabId === 1) &&\n        !chat.selection.isSelecting &&\n        !chat.input.recording\n      ) {\n        chat.input.messageInput.focus();\n        placeCaretAtEnd(chat.input.messageInput);\n\n        // clone and dispatch same event to new input. it is needed for sending message if input was blurred\n        const newEvent = new KeyboardEvent(e.type, e);\n        chat.input.messageInput.dispatchEvent(newEvent);\n      }\n    };\n\n    document.body.addEventListener('keydown', onKeyDown);\n  }\n\n  private makeLink<T extends INTERNAL_LINK_TYPE>(type: T, uriParams: Omit<InternalLinkTypeMap[T], '_'>) {\n    return {\n      _: type,\n      ...uriParams\n    } as any as InternalLinkTypeMap[T];\n  }\n\n  public async processInternalLink(link: InternalLink) {\n    switch(link?._) {\n      case INTERNAL_LINK_TYPE.MESSAGE: {\n        const postId = link.post ? generateMessageId(+link.post) : undefined;\n        const commentId = link.comment ? generateMessageId(+link.comment) : undefined;\n\n        this.openUsername({\n          userName: link.domain,\n          lastMsgId: postId,\n          commentId,\n          startParam: link.start\n        });\n        break;\n      }\n\n      case INTERNAL_LINK_TYPE.PRIVATE_POST: {\n        const chatId = link.channel.toChatId();\n        const peerId = chatId.toPeerId(true);\n\n        const chat = await this.managers.appChatsManager.getChat(chatId);\n        if(chat.deleted) {\n          try {\n            await this.managers.appChatsManager.resolveChannel(chatId);\n          } catch(err) {\n            toastNew({langPackKey: 'LinkNotFound'});\n            throw err;\n          }\n        }\n\n        const postId = generateMessageId(+link.post);\n        const threadId = link.thread ? generateMessageId(+link.thread) : undefined;\n\n        if(threadId) this.openThread(peerId, postId, threadId);\n        else this.setInnerPeer({\n          peerId,\n          lastMsgId: postId,\n          threadId\n        });\n        break;\n      }\n\n      case INTERNAL_LINK_TYPE.EMOJI_SET:\n      case INTERNAL_LINK_TYPE.STICKER_SET: {\n        new PopupStickers({id: link.set}, link._ === INTERNAL_LINK_TYPE.EMOJI_SET).show();\n        break;\n      }\n\n      case INTERNAL_LINK_TYPE.JOIN_CHAT: {\n        this.managers.appChatsManager.checkChatInvite(link.invite).then((chatInvite) => {\n          if((chatInvite as ChatInvite.chatInvitePeek).chat) {\n            this.managers.appChatsManager.saveApiChat((chatInvite as ChatInvite.chatInvitePeek).chat, true);\n          }\n\n          // console.log(chatInvite);\n\n          if(chatInvite._ === 'chatInviteAlready' ||\n            chatInvite._ === 'chatInvitePeek'/*  && chatInvite.expires > tsNow(true) */) {\n            this.setInnerPeer({\n              peerId: chatInvite.chat.id.toPeerId(true)\n            });\n            return;\n          }\n\n          new PopupJoinChatInvite(link.invite, chatInvite);\n        }, (err) => {\n          if(err.type === 'INVITE_HASH_EXPIRED') {\n            toast(i18n('InviteExpired'));\n          }\n        });\n        break;\n      }\n\n      case INTERNAL_LINK_TYPE.VOICE_CHAT: {\n        if(IS_GROUP_CALL_SUPPORTED) {\n          this.joinGroupCall(link.chat_id.toPeerId(true), link.id);\n        }\n\n        break;\n      }\n\n      case INTERNAL_LINK_TYPE.USER_PHONE_NUMBER: {\n        this.managers.appUsersManager.resolvePhone(link.phone).then((user) => {\n          this.setInnerPeer({\n            peerId: user.id.toPeerId(false)\n          });\n        }).catch((err) => {\n          if(err.type === 'PHONE_NOT_OCCUPIED') {\n            toastNew({langPackKey: 'Alert.UserDoesntExists'});\n          }\n        });\n\n        break;\n      }\n\n      case INTERNAL_LINK_TYPE.INVOICE: {\n        this.managers.appPaymentsManager.getInputInvoiceBySlug(link.slug).then((inputInvoice) => {\n          this.managers.appPaymentsManager.getPaymentForm(inputInvoice).then((paymentForm) => {\n            // const message: Message.message = {\n            //   _: 'message',\n            //   date: 0,\n            //   id: 0,\n            //   peerId: 0,\n            //   peer_id: undefined,\n            //   message: '',\n            //   media: {\n            //     _: 'messageMediaInvoice',\n            //     currency: paymentForm.invoice.currency,\n            //     description: paymentForm.description,\n\n            //   }\n            // };\n            new PopupPayment(undefined, inputInvoice, paymentForm);\n          });\n        });\n        break;\n      }\n\n      default: {\n        this.log.warn('Not supported internal link:', link);\n        break;\n      }\n    }\n  }\n\n  public openUrl(url: string) {\n    const {url: wrappedUrl, onclick} = wrapUrl(url);\n    const a = document.createElement('a');\n    a.href = wrappedUrl;\n\n    (window as any)[onclick](a);\n  }\n\n  private addAnchorListener<Params extends {pathnameParams?: any, uriParams?: any}>(options: {\n    name: 'showMaskedAlert' | 'execBotCommand' | 'searchByHashtag' | 'addstickers' | 'im' |\n          'resolve' | 'privatepost' | 'addstickers' | 'voicechat' | 'joinchat' | 'join' | 'invoice' |\n          'addemoji',\n    protocol?: 'tg',\n    callback: (params: Params, element?: HTMLAnchorElement) => boolean | any,\n    noPathnameParams?: boolean,\n    noUriParams?: boolean\n  }) {\n    (window as any)[(options.protocol ? options.protocol + '_' : '') + options.name] = (element?: HTMLAnchorElement/* , e: Event */) => {\n      cancelEvent(null);\n\n      let href = element.href;\n      let pathnameParams: any[];\n      let uriParams: any;\n\n      const u = new URL(href);\n      const match = u.host.match(/(.+?)\\.t(?:elegram)?\\.me/);\n      if(match) {\n        u.pathname = match[1] + (u.pathname === '/' ? '' : u.pathname);\n        href = u.toString();\n      }\n\n      if(!options.noPathnameParams) pathnameParams = new URL(href).pathname.split('/').slice(1);\n      if(!options.noUriParams) uriParams = this.parseUriParams(href);\n\n      const res = options.callback({pathnameParams, uriParams} as Params, element);\n      return res === undefined ? res : false;\n    };\n  }\n\n  private parseUriParams(uri: string, splitted = uri.split('?')) {\n    const params: any = {};\n    if(!splitted[1]) return params;\n    splitted[1].split('&').forEach((item) => {\n      params[item.split('=')[0]] = decodeURIComponent(item.split('=')[1]);\n    });\n\n    return params;\n  }\n\n  private onHashChange = (saveState?: boolean) => {\n    const hash = location.hash;\n    if(!saveState) {\n      appNavigationController.replaceState();\n    }\n\n    const splitted = hash.split('?');\n    const params = this.parseUriParams(hash, splitted);\n    this.log('hashchange', hash, splitted[0], params);\n    if(!hash) {\n      return;\n    }\n\n    if(params.tgaddr) {\n      const {onclick} = wrapUrl(params.tgaddr);\n      if(onclick) {\n        const a = document.createElement('a');\n        a.href = params.tgaddr;\n        (window as any)[onclick](a);\n      }\n      return;\n    }\n\n    switch(splitted[0]) {\n      default: {\n        params.p = splitted[0].slice(1);\n      }\n\n      case '#/im': {\n        const p: string = params.p;\n        const postId = params.post !== undefined ? generateMessageId(+params.post) : undefined;\n\n        switch(p[0]) {\n          case '@': {\n            this.openUsername({\n              userName: p,\n              lastMsgId: postId\n            });\n            break;\n          }\n\n          default: { // peerId\n            this.setInnerPeer({\n              peerId: postId ? p.toPeerId(true) : p.toPeerId(),\n              lastMsgId: postId\n            });\n            break;\n          }\n        }\n      }\n    }\n\n    // appNavigationController.replaceState();\n    // location.hash = '';\n  };\n\n  public openUsername(options: {\n    userName: string,\n    lastMsgId?: number,\n    threadId?: number,\n    commentId?: number,\n    startParam?: string\n  }) {\n    const {userName, lastMsgId, threadId, commentId, startParam} = options;\n    return this.managers.appUsersManager.resolveUsername(userName).then((peer) => {\n      const isUser = peer._ === 'user';\n      const peerId = peer.id.toPeerId(!isUser);\n\n      if(threadId) {\n        return this.openThread(peerId, lastMsgId, threadId);\n      } else if(commentId) {\n        return this.openComment(peerId, lastMsgId, commentId);\n      }\n\n      return this.setInnerPeer({\n        peerId,\n        lastMsgId,\n        startParam: startParam\n      });\n    }, (err) => {\n      if(err.type === 'USERNAME_NOT_OCCUPIED') {\n        toastNew({langPackKey: 'NoUsernameFound'});\n      } else if(err.type === 'USERNAME_INVALID') {\n        toastNew({langPackKey: 'Alert.UserDoesntExists'});\n      }\n    });\n  }\n\n  /**\n   * Opens thread when peerId of discussion group is known\n   */\n  public openThread(peerId: PeerId, lastMsgId: number, threadId: number) {\n    return this.managers.appMessagesManager.wrapSingleMessage(peerId, threadId).then((message) => {\n      // const message: Message = this.managers.appMessagesManager.getMessageByPeer(peerId, threadId);\n      if(!message) {\n        lastMsgId = undefined;\n      } else {\n        this.managers.appMessagesManager.generateThreadServiceStartMessage(message);\n      }\n\n      return this.setInnerPeer({\n        peerId,\n        lastMsgId,\n        threadId,\n        type: 'discussion'\n      });\n    });\n  }\n\n  /**\n   * Opens comment directly from original channel\n   */\n  public openComment(peerId: PeerId, msgId: number, commentId: number) {\n    return this.managers.appMessagesManager.getDiscussionMessage(peerId, msgId).then((message) => {\n      return this.openThread(message.peerId, commentId, message.mid);\n    });\n  }\n\n  public async callUser(userId: UserId, type: CallType) {\n    const call = callsController.getCallByUserId(userId);\n    if(call) {\n      return;\n    }\n\n    const userFull = await this.managers.appProfileManager.getProfile(userId);\n    if(userFull.pFlags.phone_calls_private) {\n      confirmationPopup({\n        descriptionLangKey: 'Call.PrivacyErrorMessage',\n        descriptionLangArgs: [new PeerTitle({peerId: userId.toPeerId()}).element],\n        button: {\n          langKey: 'OK',\n          isCancel: true\n        }\n      });\n\n      return;\n    }\n\n    await this.discardCurrentCall(userId.toPeerId());\n\n    callsController.startCallInternal(userId, type === 'video');\n  }\n\n  private discardCurrentCall(toPeerId: PeerId, ignoreGroupCall?: GroupCallInstance, ignoreCall?: CallInstance) {\n    if(groupCallsController.groupCall && groupCallsController.groupCall !== ignoreGroupCall) return this.discardGroupCallConfirmation(toPeerId);\n    else if(callsController.currentCall && callsController.currentCall !== ignoreCall) return this.discardCallConfirmation(toPeerId);\n    else return Promise.resolve();\n  }\n\n  private async discardCallConfirmation(toPeerId: PeerId) {\n    const currentCall = callsController.currentCall;\n    if(currentCall) {\n      await confirmationPopup({\n        titleLangKey: 'Call.Confirm.Discard.Call.Header',\n        descriptionLangKey: toPeerId.isUser() ? 'Call.Confirm.Discard.Call.ToCall.Text' : 'Call.Confirm.Discard.Call.ToVoice.Text',\n        descriptionLangArgs: [\n          new PeerTitle({peerId: currentCall.interlocutorUserId.toPeerId(false)}).element,\n          new PeerTitle({peerId: toPeerId}).element\n        ],\n        button: {\n          langKey: 'OK'\n        }\n      });\n\n      if(!currentCall.isClosing) {\n        await currentCall.hangUp('phoneCallDiscardReasonDisconnect');\n      }\n    }\n  }\n\n  private async discardGroupCallConfirmation(toPeerId: PeerId) {\n    const currentGroupCall = groupCallsController.groupCall;\n    if(currentGroupCall) {\n      await confirmationPopup({\n        titleLangKey: 'Call.Confirm.Discard.Voice.Header',\n        descriptionLangKey: toPeerId.isUser() ? 'Call.Confirm.Discard.Voice.ToCall.Text' : 'Call.Confirm.Discard.Voice.ToVoice.Text',\n        descriptionLangArgs: [\n          new PeerTitle({peerId: currentGroupCall.chatId.toPeerId(true)}).element,\n          new PeerTitle({peerId: toPeerId}).element\n        ],\n        button: {\n          langKey: 'OK'\n        }\n      });\n\n      if(groupCallsController.groupCall === currentGroupCall) {\n        await currentGroupCall.hangUp();\n      }\n    }\n  }\n\n  public async joinGroupCall(peerId: PeerId, groupCallId?: GroupCallId) {\n    const chatId = peerId.toChatId();\n    const hasRights = this.managers.appChatsManager.hasRights(chatId, 'manage_call');\n    const next = async() => {\n      const chatFull = await this.managers.appProfileManager.getChatFull(chatId);\n      let call: MyGroupCall;\n      if(!chatFull.call) {\n        if(!hasRights) {\n          return;\n        }\n\n        call = await this.managers.appGroupCallsManager.createGroupCall(chatId);\n      } else {\n        call = chatFull.call;\n      }\n\n      groupCallsController.joinGroupCall(chatId, call.id, true, false);\n    };\n\n    if(groupCallId) {\n      const groupCall = await this.managers.appGroupCallsManager.getGroupCallFull(groupCallId);\n      if(groupCall._ === 'groupCallDiscarded') {\n        if(!hasRights) {\n          toastNew({\n            langPackKey: 'VoiceChat.Chat.Ended'\n          });\n\n          return;\n        }\n\n        await confirmationPopup({\n          descriptionLangKey: 'VoiceChat.Chat.StartNew',\n          button: {\n            langKey: 'VoiceChat.Chat.StartNew.OK'\n          }\n        });\n      }\n    }\n\n    // await this.discardCurrentCall(peerId);\n\n    next();\n  };\n\n  public setCurrentBackground(broadcastEvent = false): ReturnType<AppImManager['setBackground']> {\n    const theme = themeController.getTheme();\n\n    if(theme.background.slug) {\n      const defaultTheme = STATE_INIT.settings.themes.find((t) => t.name === theme.name);\n      // const isDefaultBackground = theme.background.blur === defaultTheme.background.blur &&\n      // theme.background.slug === defaultTheme.background.slug;\n\n      // if(!isDefaultBackground) {\n      return this.getBackground(theme.background.slug).then((url) => {\n        return this.setBackground(url, broadcastEvent);\n      }, () => { // * if NO_ENTRY_FOUND\n        theme.background = copy(defaultTheme.background); // * reset background\n        return this.setCurrentBackground(true);\n      });\n      // }\n    }\n\n    return this.setBackground('', broadcastEvent);\n  }\n\n  private getBackground(slug: string) {\n    if(this.backgroundPromises[slug]) return this.backgroundPromises[slug];\n    return this.backgroundPromises[slug] = this.cacheStorage.getFile('backgrounds/' + slug).then((blob) => {\n      return URL.createObjectURL(blob);\n    });\n  }\n\n  public setBackground(url: string, broadcastEvent = true): Promise<void> {\n    this.lastBackgroundUrl = url;\n    const promises = this.chats.map((chat) => chat.setBackground(url));\n    return promises[promises.length - 1].then(() => {\n      if(broadcastEvent) {\n        rootScope.dispatchEvent('background_change');\n      }\n    });\n  }\n\n  public saveChatPosition(chat: Chat) {\n    if(!(['chat', 'discussion'] as ChatType[]).includes(chat.type) || !chat.peerId) {\n      return;\n    }\n\n    // const bubble = chat.bubbles.getBubbleByPoint('top');\n    // if(bubble) {\n    // const top = bubble.getBoundingClientRect().top;\n    const chatBubbles = chat.bubbles;\n    const key = chat.peerId + (chat.threadId ? '_' + chat.threadId : '');\n    const chatPositions = stateStorage.getFromCache('chatPositions');\n    if(!(chatBubbles.scrollable.getDistanceToEnd() <= 16 && chatBubbles.scrollable.loadedAll.bottom) && chatBubbles.getRenderedLength()) {\n      chatBubbles.sliceViewport(true);\n      const top = chatBubbles.scrollable.scrollTop;\n\n      const position = {\n        mids: getObjectKeysAndSort(chatBubbles.bubbles, 'desc').filter((mid) => !chatBubbles.skippedMids.has(mid)),\n        top\n      };\n\n      chatPositions[key] = position;\n\n      this.log('saved chat position:', position);\n    } else {\n      delete chatPositions[key];\n\n      this.log('deleted chat position');\n    }\n\n    stateStorage.set({chatPositions}, true);\n    // }\n  }\n\n  public getChatSavedPosition(chat: Chat): ChatSavedPosition {\n    if(!(['chat', 'discussion'] as ChatType[]).includes(chat.type) || !chat.peerId) {\n      return;\n    }\n\n    const key = chat.peerId + (chat.threadId ? '_' + chat.threadId : '');\n    const cache = stateStorage.getFromCache('chatPositions');\n    return cache && cache[key];\n  }\n\n  public applyCurrentTheme(slug?: string, backgroundUrl?: string, broadcastEvent?: boolean) {\n    if(backgroundUrl) {\n      this.backgroundPromises[slug] = Promise.resolve(backgroundUrl);\n    }\n\n    themeController.setTheme();\n\n    return this.setCurrentBackground(broadcastEvent === undefined ? !!slug : broadcastEvent);\n  }\n\n  private setSettings = () => {\n    document.documentElement.style.setProperty('--messages-text-size', rootScope.settings.messagesTextSize + 'px');\n\n    document.body.classList.toggle('animation-level-0', !rootScope.settings.animationsEnabled);\n    document.body.classList.toggle('animation-level-1', false);\n    document.body.classList.toggle('animation-level-2', rootScope.settings.animationsEnabled);\n\n    this.chatsSelectTabDebounced = debounce(() => {\n      const topbar = this.chat.topbar;\n      if(topbar.pinnedMessage) { // *   ,     ,       \n        topbar.pinnedMessage.setCorrectIndex(0);\n      }\n\n      this.managers.apiFileManager.setQueueId(this.chat.bubbles.lazyLoadQueue.queueId);\n    }, rootScope.settings.animationsEnabled ? 250 : 0, false, true);\n\n    lottieLoader.setLoop(rootScope.settings.stickers.loop);\n    animationIntersector.checkAnimations(false);\n\n    for(const chat of this.chats) {\n      chat.setAutoDownloadMedia();\n    }\n\n    I18n.setTimeFormat(rootScope.settings.timeFormat);\n\n    this.toggleChatGradientAnimation(this.chat);\n  };\n\n  // *     TransitionSlider,       \n  // * (   )     (. scrollTop)\n  private chatsSelectTab(tab: HTMLElement, animate?: boolean) {\n    if(this.prevTab === tab) {\n      return;\n    }\n\n    if(animate === false && this.prevTab) { // * will be used for Safari iOS history swipe\n      disableTransition([tab, this.prevTab].filter(Boolean));\n    }\n\n    if(this.prevTab) {\n      this.prevTab.classList.remove('active');\n      this.chatsSelectTabDebounced();\n\n      // !    animation,         250\n      if(rootScope.settings.animationsEnabled && animate !== false) {\n        dispatchHeavyAnimationEvent(pause(250 + 150), 250 + 150);\n      }\n\n      const prevIdx = whichChild(this.prevTab);\n      const idx = whichChild(tab);\n      if(idx > prevIdx) {\n        appNavigationController.pushItem({\n          type: 'chat',\n          onPop: (canAnimate) => {\n            this.setPeer({}, canAnimate);\n            blurActiveElement();\n          }\n        });\n      }\n    }\n\n    tab.classList.add('active');\n    this.prevTab = tab;\n  }\n\n  private init() {\n    document.addEventListener('paste', this.onDocumentPaste, true);\n\n    if(!IS_TOUCH_SUPPORTED) {\n      this.attachDragAndDropListeners();\n    }\n\n    // if(!isTouchSupported) {\n    this.markupTooltip = new MarkupTooltip(this);\n    this.markupTooltip.handleSelection();\n    // }\n  }\n\n  private attachDragAndDropListeners() {\n    const drops: ChatDragAndDrop[] = [];\n    const mediaDrops: ChatDragAndDrop[] = [];\n    let mounted = false;\n    const toggle = async(e: DragEvent, mount: boolean) => {\n      if(mount === mounted) return;\n\n      const _types = e.dataTransfer.types;\n      // @ts-ignore\n      const isFiles = _types.contains ? _types.contains('Files') : _types.indexOf('Files') >= 0;\n\n      const newMediaPopup = getCurrentNewMediaPopup();\n      const types: string[] = await getFilesFromEvent(e, true);\n      if(!isFiles || (!(await this.canDrag()) && !newMediaPopup)) { // * skip dragging text case\n        counter = 0;\n        return;\n      }\n\n      const _dropsContainer = newMediaPopup ? mediaDropsContainer : dropsContainer;\n      const _drops = newMediaPopup ? mediaDrops : drops;\n\n      if(mount && !_drops.length) {\n        const force = isFiles && !types.length; // * can't get file items not from 'drop' on Safari\n\n        const foundMedia = types.filter((t) => MEDIA_MIME_TYPES_SUPPORTED.has(t)).length;\n        // const foundDocuments = types.length - foundMedia;\n\n        this.log('drag files', types);\n\n        if(newMediaPopup) {\n          newMediaPopup.appendDrops(_dropsContainer);\n\n          if(types.length || force) {\n            _drops.push(new ChatDragAndDrop(_dropsContainer, {\n              header: 'Preview.Dragging.AddItems',\n              headerArgs: [types.length],\n              onDrop: (e: DragEvent) => {\n                toggle(e, false);\n                this.log('drop', e);\n                this.onDocumentPaste(e, 'document');\n              }\n            }));\n          }\n        } else {\n          if(types.length || force) {\n            _drops.push(new ChatDragAndDrop(_dropsContainer, {\n              icon: 'dragfiles',\n              header: 'Chat.DropTitle',\n              subtitle: 'Chat.DropAsFilesDesc',\n              onDrop: (e: DragEvent) => {\n                toggle(e, false);\n                this.log('drop', e);\n                this.onDocumentPaste(e, 'document');\n              }\n            }));\n          }\n\n          // if((foundMedia && !foundDocuments) || force) {\n          if(foundMedia || force) {\n            _drops.push(new ChatDragAndDrop(_dropsContainer, {\n              icon: 'dragmedia',\n              header: 'Chat.DropTitle',\n              subtitle: 'Chat.DropQuickDesc',\n              onDrop: (e: DragEvent) => {\n                toggle(e, false);\n                this.log('drop', e);\n                this.onDocumentPaste(e, 'media');\n              }\n            }));\n          }\n\n          this.chat.container.append(_dropsContainer);\n        }\n      }\n\n      // if(!mount) return;\n\n      SetTransition(_dropsContainer, 'is-visible', mount, 200, () => {\n        if(!mount) {\n          _drops.forEach((drop) => {\n            drop.destroy();\n          });\n\n          _drops.length = 0;\n        }\n      });\n\n      if(mount) {\n        _drops.forEach((drop) => {\n          drop.setPath();\n        });\n      } else {\n        counter = 0;\n      }\n\n      document.body.classList.toggle('is-dragging', mount);\n      mounted = mount;\n    };\n\n    /* document.body.addEventListener('dragover', (e) => {\n      cancelEvent(e);\n    }); */\n\n    let counter = 0;\n    document.body.addEventListener('dragenter', (e) => {\n      counter++;\n    });\n\n    document.body.addEventListener('dragover', (e) => {\n      // this.log('dragover', e/* , e.dataTransfer.types[0] */);\n      toggle(e, true);\n      cancelEvent(e);\n    });\n\n    document.body.addEventListener('dragleave', (e) => {\n      // this.log('dragleave', e, counter);\n      // if((e.pageX <= 0 || e.pageX >= this.managers.appPhotosManager.windowW) || (e.pageY <= 0 || e.pageY >= this.managers.appPhotosManager.windowH)) {\n      counter--;\n      if(counter === 0) {\n      // if(!findUpClassName(e.target, 'drops-container')) {\n        toggle(e, false);\n      }\n    });\n\n    const dropsContainer = document.createElement('div');\n    dropsContainer.classList.add('drops-container');\n\n    const mediaDropsContainer = dropsContainer.cloneNode(true) as HTMLElement;\n  }\n\n  private async canDrag() {\n    const chat = this.chat;\n    const peerId = chat?.peerId;\n    return !(!peerId || overlayCounter.isOverlayActive || !(await chat.canSend('send_media')));\n  }\n\n  private onDocumentPaste = async(e: ClipboardEvent | DragEvent, attachType?: 'media' | 'document') => {\n    const newMediaPopup = getCurrentNewMediaPopup();\n\n    // console.log('document paste');\n    // console.log('item', event.clipboardData.getData());\n\n    if(e instanceof DragEvent) {\n      const _types = e.dataTransfer.types;\n      // @ts-ignore\n      const isFiles = _types.contains ? _types.contains('Files') : _types.indexOf('Files') >= 0;\n      if(isFiles) {\n        cancelEvent(e);\n      }\n    }\n\n    const files = await getFilesFromEvent(e);\n    if(!(await this.canDrag()) && !newMediaPopup) return;\n    if(files.length) {\n      if(newMediaPopup) {\n        newMediaPopup.addFiles(files);\n        return;\n      }\n\n      const chatInput = this.chat.input;\n      chatInput.willAttachType = attachType || (MEDIA_MIME_TYPES_SUPPORTED.has(files[0].type) ? 'media' : 'document');\n      PopupElement.createPopup(PopupNewMedia, this.chat, files, chatInput.willAttachType);\n    }\n  };\n\n  private async overrideHash(peerId?: PeerId) {\n    let str: string;\n    if(peerId) {\n      const username = await this.managers.appPeersManager.getPeerUsername(peerId);\n      str = username ? '@' + username : '' + peerId;\n    }\n\n    appNavigationController.overrideHash(str);\n  }\n\n  public selectTab(id: number, animate?: boolean) {\n    if(animate === false) { // * will be used for Safari iOS history swipe\n      disableTransition([appSidebarLeft.sidebarEl, this.columnEl, appSidebarRight.sidebarEl]);\n    }\n\n    document.body.classList.toggle(LEFT_COLUMN_ACTIVE_CLASSNAME, id === 0);\n\n    const prevTabId = this.tabId;\n    if(prevTabId !== -1) {\n      this.overrideHash(id > 0 ? this.chat?.peerId : undefined);\n    }\n\n    this.log('selectTab', id, prevTabId);\n\n    let animationPromise: Promise<any> = rootScope.settings.animationsEnabled ? doubleRaf() : Promise.resolve();\n    if(prevTabId !== -1 && prevTabId !== id && rootScope.settings.animationsEnabled && animate !== false && mediaSizes.activeScreen !== ScreenSize.large) {\n      const transitionTime = (mediaSizes.isMobile ? 250 : 200) + 100; // * cause transition time could be > 250ms\n      animationPromise = pause(transitionTime);\n      dispatchHeavyAnimationEvent(animationPromise, transitionTime);\n\n      // ! it's very heavy operation. will blink in firefox\n      /* this.columnEl.classList.add('disable-hover');\n      animationPromise.finally(() => {\n        this.columnEl.classList.remove('disable-hover');\n      }); */\n    }\n\n    this.tabId = id;\n    blurActiveElement();\n    if(mediaSizes.isMobile && prevTabId === 2 && id < 2) {\n      document.body.classList.remove(RIGHT_COLUMN_ACTIVE_CLASSNAME);\n    }\n\n    if(prevTabId !== -1 && id > prevTabId) {\n      if(id < 2 || !appNavigationController.findItemByType('im')) {\n        appNavigationController.pushItem({\n          type: 'im',\n          onPop: (canAnimate) => {\n            // this.selectTab(prevTabId, !isSafari);\n            this.setPeer({}, canAnimate);\n          }\n        });\n      }\n    }\n\n    const onImTabChange = (window as any).onImTabChange;\n    onImTabChange && onImTabChange(id);\n\n    // this._selectTab(id, mediaSizes.isMobile);\n    // document.body.classList.toggle(RIGHT_COLUMN_ACTIVE_CLASSNAME, id === 2);\n\n    return animationPromise;\n  }\n\n  public updateStatus() {\n    return this.managers.appUsersManager.updateMyOnlineStatus(this.offline);\n  }\n\n  private createNewChat() {\n    const chat = new Chat(\n      this,\n      this.managers\n    );\n\n    if(this.chats.length) {\n      chat.setBackground(this.lastBackgroundUrl, true);\n    }\n\n    this.chats.push(chat);\n\n    return chat;\n  }\n\n  private spliceChats(fromIndex: number, justReturn = true, animate?: boolean, spliced?: Chat[]) {\n    if(fromIndex >= this.chats.length) return;\n\n    const chatFrom = this.chat;\n    if(this.chats.length > 1 && justReturn) {\n      this.dispatchEvent('peer_changing', this.chat);\n    }\n\n    if(!spliced) {\n      spliced = this.chats.splice(fromIndex, this.chats.length - fromIndex);\n    }\n\n    const chatTo = this.chat;\n    this.dispatchEvent('chat_changing', {from: chatFrom, to: chatTo});\n\n    // * -1 because one item is being sliced when closing the chat by calling .removeByType\n    for(let i = 0; i < spliced.length - 1; ++i) {\n      appNavigationController.removeByType('chat', true);\n    }\n\n    // * fix middle chat z-index on animation\n    if(spliced.length > 1) {\n      spliced.slice(0, -1).forEach((chat) => {\n        chat.container.remove();\n      });\n    }\n\n    this.chatsSelectTab(chatTo.container, animate);\n\n    if(justReturn) {\n      this.dispatchEvent('peer_changed', chatTo.peerId);\n\n      const searchTab = appSidebarRight.getTab(AppPrivateSearchTab);\n      if(searchTab) {\n        searchTab.close();\n      }\n\n      appSidebarRight.replaceSharedMediaTab(chatTo.sharedMediaTab);\n    }\n\n    spliced.forEach((chat) => {\n      chat.beforeDestroy();\n    });\n\n    setTimeout(() => {\n      // chat.setPeer(0);\n      spliced.forEach((chat) => {\n        chat.destroy();\n      });\n    }, 250 + 100);\n  }\n\n  public async setPeer(options: ChatSetPeerOptions = {}, animate?: boolean): Promise<boolean> {\n    if(this.init) {\n      this.init();\n      this.init = null;\n    }\n\n    options.peerId ??= NULL_PEER_ID;\n\n    const {peerId, lastMsgId} = options;\n\n    const chat = this.chat;\n    const chatIndex = this.chats.indexOf(chat);\n\n    if(!peerId) {\n      if(chatIndex > 0) {\n        this.spliceChats(chatIndex, undefined, animate);\n        return;\n      } else if(mediaSizes.activeScreen === ScreenSize.medium) { // * floating sidebar case\n        this.selectTab(+!this.tabId, animate);\n        return;\n      }\n    } else if(chatIndex > 0 && chat.peerId && chat.peerId !== peerId) {\n      // const firstChat = this.chats[0];\n      // if(firstChat.peerId !== chat.peerId) {\n      /* // * slice idx > 0, set background and slice first, so new one will be the first\n        const spliced = this.chats.splice(1, this.chats.length - 1);\n        this.createNewChat();\n        this.chats.splice(0, 1); */\n      const spliced = this.chats.splice(1, this.chats.length - 1);\n      if(this.chat.peerId === peerId) {\n        this.spliceChats(0, true, true, spliced);\n        return;\n      } else {\n        const ret = this.setPeer(options);\n        this.spliceChats(0, false, false, spliced);\n        return ret;\n      }\n      // } else {\n      //   this.spliceChats(1, false, animate);\n      // }\n\n      // return ret;\n    }\n\n    // * don't reset peer if returning\n    if(peerId === chat.peerId && mediaSizes.activeScreen <= ScreenSize.medium && document.body.classList.contains(LEFT_COLUMN_ACTIVE_CLASSNAME)) {\n      this.selectTab(1, animate);\n      return false;\n    }\n\n    if(peerId || mediaSizes.activeScreen !== ScreenSize.mobile) {\n      const result = await chat.setPeer(peerId, lastMsgId, options.startParam);\n\n      // * wait for cached render\n      const promise = result?.cached ? result.promise : Promise.resolve();\n      if(peerId) {\n        Promise.all([\n          promise,\n          chat.setBackgroundPromise\n        ]).then(() => {\n          // window.requestAnimationFrame(() => {\n          setTimeout(() => { // * setTimeout is better here\n            setTimeout(() => {\n              this.chatsSelectTab(this.chat.container);\n            }, 0);\n            this.selectTab(1, animate);\n          }, 0);\n        });\n      }\n    }\n\n    if(!peerId) {\n      this.selectTab(0, animate);\n      return false;\n    }\n  }\n\n  public setInnerPeer(options: ChatSetInnerPeerOptions) {\n    const {peerId} = options;\n    if(peerId === NULL_PEER_ID || !peerId) {\n      return;\n    }\n\n    if(options.threadId) {\n      options.type = 'discussion';\n    }\n\n    const type = options.type ??= 'chat';\n\n    // * prevent opening already opened peer\n    const existingIndex = this.chats.findIndex((chat) => chat.peerId === peerId && chat.type === type);\n    if(existingIndex !== -1) {\n      this.spliceChats(existingIndex + 1);\n      return this.setPeer(options);\n    }\n\n    const oldChat = this.chat;\n    let chat = oldChat;\n    if(oldChat.inited) { // * use first not inited chat\n      chat = this.createNewChat();\n    }\n\n    if(type) {\n      chat.setType(type);\n\n      if(options.threadId) {\n        chat.threadId = options.threadId;\n      }\n    }\n\n    this.dispatchEvent('chat_changing', {from: oldChat, to: chat});\n\n    // this.chatsSelectTab(chat.container);\n\n    return this.setPeer(options);\n  }\n\n  public openScheduled(peerId: PeerId) {\n    this.setInnerPeer({\n      peerId,\n      type: 'scheduled'\n    });\n  }\n\n  private getTypingElement(action: SendMessageAction) {\n    const el = document.createElement('span');\n    let c = 'peer-typing';\n    el.classList.add(c);\n    el.dataset.action = action._;\n    switch(action._) {\n      case 'sendMessageTypingAction': {\n      // default: {\n        c += '-text';\n        for(let i = 0; i < 3; ++i) {\n          const dot = document.createElement('span');\n          dot.className = c + '-dot';\n          el.append(dot);\n        }\n        break;\n      }\n\n      case 'sendMessageUploadAudioAction':\n      case 'sendMessageUploadDocumentAction':\n      case 'sendMessageUploadRoundAction':\n      case 'sendMessageUploadVideoAction':\n      case 'sendMessageUploadPhotoAction': {\n        c += '-upload';\n        /* const trail = document.createElement('span');\n        trail.className = c + '-trail';\n        el.append(trail); */\n        break;\n      }\n\n      case 'sendMessageRecordAudioAction':\n      case 'sendMessageRecordRoundAction':\n      case 'sendMessageRecordVideoAction': {\n        c += '-record';\n        break;\n      }\n\n      case 'sendMessageEmojiInteractionSeen':\n      case 'sendMessageChooseStickerAction': {\n        c += '-choosing-sticker';\n        for(let i = 0; i < 2; ++i) {\n          const eye = document.createElement('div');\n          eye.className = c + '-eye';\n          el.append(eye);\n        }\n        break;\n      }\n    }\n\n    el.classList.add(c);\n\n    return el;\n  }\n\n  public async getPeerTyping(peerId: PeerId, container?: HTMLElement) {\n    // const log = this.log.bindPrefix('getPeerTyping-' + peerId);\n    // log('getting peer typing');\n\n    const isUser = peerId.isUser();\n    if(isUser && await this.managers.appUsersManager.isBot(peerId)) {\n      // log('a bot');\n      return;\n    }\n\n    const typings = await this.managers.appProfileManager.getPeerTypings(peerId);\n    if(!typings?.length) {\n      // log('have no typing');\n      return;\n    }\n\n    const typing = typings[0];\n\n    const langPackKeys: {\n      [peerType in 'private' | 'chat' | 'multi']?: Partial<{[action in SendMessageAction['_']]: LangPackKey}>\n    } = {\n      private: {\n        'sendMessageTypingAction': 'Peer.Activity.User.TypingText',\n        'sendMessageUploadAudioAction': 'Peer.Activity.User.SendingFile',\n        'sendMessageUploadDocumentAction': 'Peer.Activity.User.SendingFile',\n        'sendMessageUploadPhotoAction': 'Peer.Activity.User.SendingPhoto',\n        'sendMessageUploadVideoAction': 'Peer.Activity.User.SendingVideo',\n        'sendMessageUploadRoundAction': 'Peer.Activity.User.SendingVideo',\n        'sendMessageRecordVideoAction': 'Peer.Activity.User.RecordingVideo',\n        'sendMessageRecordAudioAction': 'Peer.Activity.User.RecordingAudio',\n        'sendMessageRecordRoundAction': 'Peer.Activity.User.RecordingVideo',\n        'sendMessageGamePlayAction': 'Peer.Activity.User.PlayingGame',\n        'sendMessageChooseStickerAction': 'Peer.Activity.User.ChoosingSticker',\n        'sendMessageEmojiInteractionSeen': 'Peer.Activity.User.EnjoyingAnimations'\n      },\n      chat: {\n        'sendMessageTypingAction': 'Peer.Activity.Chat.TypingText',\n        'sendMessageUploadAudioAction': 'Peer.Activity.Chat.SendingFile',\n        'sendMessageUploadDocumentAction': 'Peer.Activity.Chat.SendingFile',\n        'sendMessageUploadPhotoAction': 'Peer.Activity.Chat.SendingPhoto',\n        'sendMessageUploadVideoAction': 'Peer.Activity.Chat.SendingVideo',\n        'sendMessageUploadRoundAction': 'Peer.Activity.Chat.SendingVideo',\n        'sendMessageRecordVideoAction': 'Peer.Activity.Chat.RecordingVideo',\n        'sendMessageRecordAudioAction': 'Peer.Activity.Chat.RecordingAudio',\n        'sendMessageRecordRoundAction': 'Peer.Activity.Chat.RecordingVideo',\n        'sendMessageGamePlayAction': 'Peer.Activity.Chat.PlayingGame',\n        'sendMessageChooseStickerAction': 'Peer.Activity.Chat.ChoosingSticker',\n        'sendMessageEmojiInteractionSeen': 'Peer.Activity.Chat.EnjoyingAnimations'\n      },\n      multi: {\n        'sendMessageTypingAction': 'Peer.Activity.Chat.Multi.TypingText1',\n        'sendMessageUploadAudioAction': 'Peer.Activity.Chat.Multi.SendingFile1',\n        'sendMessageUploadDocumentAction': 'Peer.Activity.Chat.Multi.SendingFile1',\n        'sendMessageUploadPhotoAction': 'Peer.Activity.Chat.Multi.SendingPhoto1',\n        'sendMessageUploadVideoAction': 'Peer.Activity.Chat.Multi.SendingVideo1',\n        'sendMessageUploadRoundAction': 'Peer.Activity.Chat.Multi.SendingVideo1',\n        'sendMessageRecordVideoAction': 'Peer.Activity.Chat.Multi.RecordingVideo1',\n        'sendMessageRecordAudioAction': 'Peer.Activity.Chat.Multi.RecordingAudio1',\n        'sendMessageRecordRoundAction': 'Peer.Activity.Chat.Multi.RecordingVideo1',\n        'sendMessageGamePlayAction': 'Peer.Activity.Chat.Multi.PlayingGame1',\n        'sendMessageChooseStickerAction': 'Peer.Activity.Chat.Multi.ChoosingSticker1'\n      }\n    };\n\n    const mapa = isUser ? langPackKeys.private : (typings.length > 1 ? langPackKeys.multi : langPackKeys.chat);\n    let action = typing.action;\n\n    if(typings.length > 1) {\n      const s: any = {};\n      typings.forEach((typing) => {\n        const type = typing.action._;\n        if(s[type] === undefined) s[type] = 0;\n        ++s[type];\n      });\n\n      if(Object.keys(s).length > 1) {\n        action = {\n          _: 'sendMessageTypingAction'\n        };\n      }\n    }\n\n    const langPackKey = mapa[action._];\n    if(!langPackKey) {\n      // log('no langPackKey');\n      return;\n    }\n\n    let peerTitlePromise: Promise<any>;\n    let args: any[];\n    if(peerId.isAnyChat()) {\n      const peerTitle = new PeerTitle();\n      peerTitlePromise = peerTitle.update({peerId: typing.userId.toPeerId(false), onlyFirstName: true});\n      args = [\n        peerTitle.element,\n        typings.length - 1\n      ];\n\n      await peerTitlePromise;\n    }\n\n    if(!container) {\n      container = document.createElement('span');\n      container.classList.add('online', 'peer-typing-container');\n    }\n\n    container.classList.toggle('peer-typing-flex', action._ === 'sendMessageChooseStickerAction' || action._ === 'sendMessageEmojiInteractionSeen');\n\n    let typingElement = container.firstElementChild as HTMLElement;\n    if(!typingElement) {\n      typingElement = this.getTypingElement(action);\n      container.prepend(typingElement);\n    } else {\n      if(typingElement.dataset.action !== action._) {\n        typingElement.replaceWith(this.getTypingElement(action));\n      }\n    }\n\n    if(action._ === 'sendMessageEmojiInteractionSeen') {\n      if(args) {\n        args.pop();\n      } else {\n        args = [];\n      }\n\n      const span = htmlToSpan(wrapEmojiText(action.emoticon));\n      args.push(span);\n    }\n\n    const descriptionElement = i18n(langPackKey, args);\n    descriptionElement.classList.add('peer-typing-description');\n\n    if(container.childElementCount > 1) container.lastElementChild.replaceWith(descriptionElement);\n    else container.append(descriptionElement);\n\n    // log('returning typing');\n    return container;\n  }\n\n  private async getChatStatus(chatId: ChatId): Promise<AckedResult<HTMLElement>> {\n    const typingEl = await this.getPeerTyping(chatId.toPeerId(true));\n    if(typingEl) {\n      return {cached: true, result: Promise.resolve(typingEl)};\n    }\n\n    const result = await this.managers.acknowledged.appProfileManager.getChatFull(chatId);\n    const dooo = async(chatInfo: ChatFull) => {\n      // this.chat.log('chatInfo res:', chatInfo);\n\n      const participants_count = (chatInfo as ChatFull.channelFull).participants_count ||\n        ((chatInfo as ChatFull.chatFull).participants as ChatParticipants.chatParticipants)?.participants?.length ||\n        1;\n      // if(participants_count) {\n      let subtitle = await getChatMembersString(chatId);\n\n      if(participants_count < 2) {\n        return subtitle;\n      }\n\n      const onlines = await this.managers.appProfileManager.getOnlines(chatId);\n      if(onlines > 1) {\n        const span = document.createElement('span');\n\n        span.append(...join([subtitle, i18n('OnlineCount', [numberThousandSplitter(onlines)])], false));\n        subtitle = span;\n      }\n\n      return subtitle;\n      // }\n    };\n\n    const promise = Promise.resolve(result.result).then(dooo);\n    return {\n      cached: result.cached,\n      result: promise\n    };\n  }\n\n  private async getUserStatus(userId: UserId, ignoreSelf?: boolean) {\n    const result: AckedResult<HTMLElement> = {\n      cached: true,\n      result: Promise.resolve(undefined as HTMLElement)\n    };\n\n    const user = await this.managers.appUsersManager.getUser(userId);\n    if(!user || (user.pFlags.self && !ignoreSelf)) {\n      return result;\n    }\n\n    const subtitle = getUserStatusString(user);\n\n    if(!user.pFlags.bot) {\n      let typingEl = await this.getPeerTyping(userId.toPeerId());\n      if(!typingEl && user.status?._ === 'userStatusOnline') {\n        typingEl = document.createElement('span');\n        typingEl.classList.add('online');\n        typingEl.append(subtitle);\n      }\n\n      if(typingEl) {\n        result.result = Promise.resolve(typingEl);\n        return result;\n      }\n    }\n\n    result.result = Promise.resolve(subtitle);\n    return result;\n  }\n\n  private async getPeerStatus(peerId: PeerId, ignoreSelf?: boolean) {\n    if(!peerId) return;\n    let promise: Promise<AckedResult<HTMLElement>>;\n    if(peerId.isAnyChat()) {\n      promise = this.getChatStatus(peerId.toChatId());\n    } else {\n      promise = this.getUserStatus(peerId.toUserId(), ignoreSelf);\n    }\n\n    return promise;\n  }\n\n  public async setPeerStatus(\n    peerId: PeerId,\n    element: HTMLElement,\n    needClear: boolean,\n    useWhitespace: boolean,\n    middleware: () => boolean,\n    ignoreSelf?: boolean\n  ) {\n    // const log = this.log.bindPrefix('status-' + peerId);\n    // log('setting status', element);\n\n    if(!needClear) {\n      // * good good good\n      const typingContainer = element.querySelector('.peer-typing-container') as HTMLElement;\n      if(typingContainer && await this.getPeerTyping(peerId, typingContainer)) {\n        // log('already have a status');\n        return;\n      }\n    }\n\n    const result = await this.getPeerStatus(peerId, ignoreSelf);\n    // log('getPeerStatus result', result);\n    if(!middleware()) {\n      // log.warn('middleware');\n      return;\n    }\n\n    const set = async() => {\n      const subtitle = result && await result.result;\n      if(!middleware()) {\n        return;\n      }\n\n      return () => replaceContent(element, subtitle || placeholder);\n    };\n\n    const placeholder = useWhitespace ? '' : ''; // ! HERE U CAN FIND WHITESPACE\n    if(!result || result.cached) {\n      return await set();\n    } else if(needClear) {\n      return () => {\n        element.textContent = placeholder;\n        return set().then((callback) => callback && callback());\n      };\n    }\n  }\n\n  public setChoosingStickerTyping(cancel: boolean) {\n    this.managers.appMessagesManager.setTyping(this.chat.peerId, {_: cancel ? 'sendMessageCancelAction' : 'sendMessageChooseStickerAction'});\n  }\n}\n\nconst appImManager = new AppImManager();\nMOUNT_CLASS_TO && (MOUNT_CLASS_TO.appImManager = appImManager);\nexport default appImManager;\n","import {Document, Message, MessageAction, MessageMedia, Photo, WebPage} from '../../../../layer';\n\nexport default function getMediaFromMessage(message: Message) {\n  if(!message) return;\n\n  const media = (message as Message.messageService).action ?\n    ((message as Message.messageService).action as MessageAction.messageActionChannelEditPhoto).photo :\n    (message as Message.message).media && (\n      ((message as Message.message).media as MessageMedia.messageMediaPhoto).photo ||\n      ((message as Message.message).media as MessageMedia.messageMediaDocument).document || (\n        ((message as Message.message).media as MessageMedia.messageMediaWebPage).webpage && (\n          (((message as Message.message).media as MessageMedia.messageMediaWebPage).webpage as WebPage.webPage).document ||\n          (((message as Message.message).media as MessageMedia.messageMediaWebPage).webpage as WebPage.webPage).photo\n        )\n      )\n    );\n\n  return media as Photo.photo | Document.document;\n}\n","import {Message} from '../../../../layer';\nimport type {MyMessage} from '../../appMessagesManager';\n\nexport default function getMessageSenderPeerIdOrName(message: MyMessage) {\n  if(message.fromId) {\n    return {\n      peerId: message.fromId\n    };\n  } else {\n    return {\n      fromName: (message as Message.message).fwd_from?.from_name\n    };\n  }\n}\n","import {isRestricted} from '../../../../helpers/restrictions';\nimport {Message} from '../../../../layer';\n\nexport default function isMessageRestricted(message: Message.message) {\n  return !!(message.restriction_reason && isRestricted(message.restriction_reason));\n}\n","// https://github.com/eelcohn/Telegram-API/wiki/Calculating-color-for-a-Telegram-user-on-IRC\n/*\n  HTML-color  IRC-color  Description\n  #c03d33     4          red\n  #4fad2d     3          green\n  #d09306     7          yellow\n  #168acd     10         blue\n  #8544d6     6          purple\n  #cd4073     13         pink\n  #2996ad     11         sea\n  #ce671b     5          orange\n*/\nconst DialogColorsFg = ['#fc5c51', '#0fb297', '#d09306', '#3d72ed', '#895dd5', '#cd4073', '#00c1a6', '#fa790f'];\nconst DialogColors = ['red', 'green', 'yellow', 'blue', 'violet', 'pink', 'cyan', 'orange'];\nconst DialogColorsMap = [0, 7, 4, 1, 6, 3, 5];\n\nexport default function getPeerColorById(peerId: PeerId, pic = true) {\n  if(!peerId) return '';\n\n  const idx = DialogColorsMap[Math.abs(+peerId) % 7];\n  const color = (pic ? DialogColors : DialogColorsFg)[idx];\n  return color;\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport type {MyDocument} from '../../appDocsManager';\nimport type {MyPhoto} from '../../appPhotosManager';\nimport type {PhotoSize, VideoSize, WebDocument} from '../../../../layer';\nimport calcImageInBox from '../../../../helpers/calcImageInBox';\nimport {THUMB_TYPE_FULL} from '../../../mtproto/mtproto_config';\n\nexport default function choosePhotoSize(\n  photo: MyPhoto | MyDocument | WebDocument,\n  boxWidth = 0,\n  boxHeight = 0,\n  useBytes = false,\n  pushDocumentSize = false\n) {\n  if(window.devicePixelRatio > 1) {\n    boxWidth *= 2;\n    boxHeight *= 2;\n  }\n\n  /*\n  s box 100x100\n  m box 320x320\n  x box 800x800\n  y box 1280x1280\n  w box 2560x2560\n  a crop  160x160\n  b crop  320x320\n  c crop  640x640\n  d crop  1280x1280 */\n\n  let sizes: PhotoSize[] = (photo as MyPhoto).sizes || (photo as MyDocument).thumbs as PhotoSize[];\n  let bestPhotoSize: typeof sizes[0] = {_: 'photoSizeEmpty', type: THUMB_TYPE_FULL};\n  if(pushDocumentSize && sizes && photo._ !== 'photo') {\n    sizes = sizes.concat({\n      _: 'photoSize',\n      w: photo.w,\n      h: photo.h,\n      size: photo.size,\n      type: THUMB_TYPE_FULL\n    });\n  }\n\n  if(sizes?.length) {\n    for(let i = 0, length = sizes.length; i < length; ++i) {\n      const photoSize = sizes[i];\n      if(!('w' in photoSize) && !('h' in photoSize)) continue;\n\n      bestPhotoSize = photoSize;\n\n      const size = calcImageInBox(photoSize.w, photoSize.h, boxWidth, boxHeight);\n      if(size.width >= boxWidth || size.height >= boxHeight) {\n        break;\n      }\n    }\n\n    if(useBytes && bestPhotoSize._ === 'photoSizeEmpty' && sizes[0]._ === 'photoStrippedSize') {\n      bestPhotoSize = sizes[0];\n    }\n  }\n\n  return bestPhotoSize;\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport safeAssign from '../../helpers/object/safeAssign';\nimport {logger} from '../logger';\nimport createDataChannel from './helpers/createDataChannel';\nimport createPeerConnection from './helpers/createPeerConnection';\nimport LocalConferenceDescription from './localConferenceDescription';\nimport StreamManager from './streamManager';\nimport {Ssrc} from './types';\n\nexport type CallConnectionInstanceOptions = {\n  streamManager: StreamManager,\n  connection?: RTCPeerConnection,\n  log?: ReturnType<typeof logger>\n};\n\nexport default abstract class CallConnectionInstanceBase {\n  public connection: RTCPeerConnection;\n  public streamManager: StreamManager;\n  public dataChannel: RTCDataChannel;\n  public description: LocalConferenceDescription;\n  public sources: {\n    audio: Ssrc,\n    video?: Ssrc,\n  };\n  protected negotiating: Promise<void>;\n  protected log: ReturnType<typeof logger>;\n\n  constructor(options: CallConnectionInstanceOptions) {\n    safeAssign(this, options);\n\n    if(!this.log) {\n      this.log = this.connection?.log || logger('CALL-CONNECTION-BASE');\n    }\n\n    this.sources = {} as any;\n  }\n\n  public createPeerConnection(config?: RTCConfiguration) {\n    return this.connection || (this.connection = createPeerConnection(config, this.log.bindPrefix('connection')).connection);\n  }\n\n  public createDataChannel(dict?: RTCDataChannelInit) {\n    return this.dataChannel || (this.dataChannel = createDataChannel(this.connection, dict, this.log.bindPrefix('data')));\n  }\n\n  public createDescription() {\n    return this.description || (this.description = new LocalConferenceDescription(this.connection));\n  }\n\n  public appendStreamToConference() {\n    return this.streamManager.appendToConference(this.description);\n  }\n\n  public closeConnection() {\n    const {connection} = this;\n    if(!connection) {\n      return;\n    }\n\n    try {\n      connection.log('close');\n      connection.close();\n    } catch(e) {\n      this.log.error(e);\n    }\n  }\n\n  public closeConnectionAndStream(stopStream: boolean) {\n    this.closeConnection();\n    stopStream && this.streamManager.stop();\n  }\n\n  protected abstract negotiateInternal(): CallConnectionInstanceBase['negotiating'];\n\n  public negotiate() {\n    const promise = this.negotiating;\n    if(promise) {\n      return promise;\n    }\n\n    return this.negotiating = this.negotiateInternal().finally(() => {\n      this.negotiating = undefined;\n    });\n  }\n\n  public sendDataChannelData(data: any) {\n    if(this.dataChannel.readyState !== 'open') {\n      return;\n    }\n\n    this.dataChannel.send(JSON.stringify(data));\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport {Logger, logger} from '../../logger';\n\nexport default function createPeerConnection(config: RTCConfiguration, log?: Logger) {\n  if(!log) {\n    log = logger('RTCPeerConnection');\n  }\n\n  log('constructor');\n\n  // @ts-ignore\n  const connection = new RTCPeerConnection(config);\n  connection.addEventListener('track', (event) => {\n    log('ontrack', event);\n  });\n  connection.addEventListener('signalingstatechange', () => {\n    log('onsignalingstatechange', connection.signalingState);\n  });\n  connection.addEventListener('connectionstatechange', () => {\n    log('onconnectionstatechange', connection.connectionState);\n  });\n  connection.addEventListener('negotiationneeded', () => { // * will be fired every time input device changes\n    log('onnegotiationneeded', connection.signalingState);\n  });\n  connection.addEventListener('icecandidate', (event) => {\n    log('onicecandidate', event);\n  });\n  connection.addEventListener('iceconnectionstatechange', () => {\n    log('oniceconnectionstatechange', connection.iceConnectionState);\n  });\n  connection.addEventListener('datachannel', () => {\n    log('ondatachannel');\n  });\n\n  connection.log = log;\n\n  return {connection};\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport {Logger, logger} from '../../logger';\n\nexport default function createDataChannel(connection: RTCPeerConnection, dict?: RTCDataChannelInit, log?: Logger) {\n  // return;\n\n  if(!log) {\n    log = logger('RTCDataChannel');\n  }\n\n  const channel = connection.createDataChannel('data', dict);\n\n  channel.addEventListener('message', (e) => {\n    log('onmessage', e);\n  });\n  channel.addEventListener('open', () => {\n    log('onopen');\n  });\n  channel.addEventListener('close', () => {\n    log('onclose');\n  });\n\n  channel.log = log;\n\n  return channel;\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport SDP from '../sdp';\nimport {CallSignalingData, P2PVideoCodec} from '../types';\nimport parseMediaSectionInfo from './parseMediaSectionInfo';\n\nexport default function parseSignalingData(sdp: SDP) {\n  const info = parseMediaSectionInfo(sdp, sdp.media[0]);\n\n  const data: CallSignalingData.initialSetup = {\n    '@type': 'InitialSetup',\n    'fingerprints': [info.fingerprint],\n    'ufrag': info.ufrag,\n    'pwd': info.pwd,\n    'audio': undefined,\n    'video': undefined,\n    'screencast': undefined\n  };\n\n  const convertNumber = (number: number) => '' + number;\n\n  for(const section of sdp.media) {\n    const mediaType = section.mediaType;\n    if(mediaType === 'application' || !section.isSending) {\n      continue;\n    }\n\n    const codec: P2PVideoCodec = data[mediaType === 'video' && data['video'] ? 'screencast' : mediaType] = {} as any;\n    const info = parseMediaSectionInfo(sdp, section);\n    codec.ssrc = convertNumber(info.source);\n\n    if(info.sourceGroups) {\n      codec.ssrcGroups = info.sourceGroups.map((sourceGroup) => ({semantics: sourceGroup.semantics, ssrcs: sourceGroup.sources.map(convertNumber)}));\n    }\n\n    const rtpExtensions: P2PVideoCodec['rtpExtensions'] = codec.rtpExtensions = [];\n    section.attributes.get('extmap').forEach((attribute) => {\n      rtpExtensions.push({\n        id: +attribute.key,\n        uri: attribute.value\n      });\n    });\n\n    const payloadTypesMap: Map<number, P2PVideoCodec['payloadTypes'][0]> = new Map();\n\n    const getPayloadType = (id: number) => {\n      let payloadType = payloadTypesMap.get(id);\n      if(!payloadType) {\n        payloadTypesMap.set(id, payloadType = {\n          id\n        } as any);\n      }\n\n      return payloadType;\n    };\n\n    section.attributes.get('rtpmap').forEach((attribute) => {\n      const id = +attribute.key;\n      const payloadType = getPayloadType(id);\n      const splitted = attribute.value.split('/');\n      const [name, clockrate, channels] = splitted;\n      payloadType.name = name;\n      payloadType.clockrate = +clockrate;\n      payloadType.channels = channels ? +channels : 0;\n    });\n\n    section.attributes.get('rtcp-fb').forEach((attribute) => {\n      const id = +attribute.key;\n      const payloadType = getPayloadType(id);\n      payloadType.feedbackTypes = attribute.lines.map((line) => {\n        const splitted = line.split(' ');\n        const [type, subtype] = splitted;\n        return {\n          type,\n          subtype: subtype || ''\n        };\n      });\n    });\n\n    section.attributes.get('fmtp').forEach((attribute) => {\n      const id = +attribute.key;\n      const payloadType = getPayloadType(id);\n      const parameters: P2PVideoCodec['payloadTypes'][0]['parameters'] = payloadType.parameters = {};\n      const splitted = attribute.value.split(';');\n      for(const str of splitted) {\n        const [key, value] = str.split('=');\n        parameters[key] = value;\n      }\n    });\n\n    codec.payloadTypes = Array.from(payloadTypesMap.values());\n\n    /* if(codec.payloadTypes.length > 5) {\n      codec.payloadTypes.length = Math.min(codec.payloadTypes.length, 5);\n    } */\n  }\n\n  return data;\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport CallConnectionInstanceBase, {CallConnectionInstanceOptions} from './callConnectionInstanceBase';\nimport CallInstance from './callInstance';\nimport parseSignalingData from './helpers/parseSignalingData';\nimport {parseSdp} from './sdp/utils';\n\nexport default class CallConnectionInstance extends CallConnectionInstanceBase {\n  private call: CallInstance;\n\n  constructor(options: CallConnectionInstanceOptions & {\n    call: CallConnectionInstance['call']\n  }) {\n    super(options);\n  }\n\n  protected async negotiateInternal() {\n    const {connection, call} = this;\n\n    if(!connection.localDescription && !connection.remoteDescription && !call.isOutgoing) {\n      return;\n    }\n\n    let descriptionInit: RTCSessionDescriptionInit;\n    if(call.offerReceived) {\n      call.offerReceived = false;\n\n      const answer = descriptionInit = await connection.createAnswer();\n\n      this.log('[sdp] local', answer.type, answer.sdp);\n      await connection.setLocalDescription(answer);\n\n      this.log('[InitialSetup] send 2');\n    } else {\n      const offer = descriptionInit = await connection.createOffer();\n\n      this.log('[sdp] local', offer.sdp);\n      await connection.setLocalDescription(offer);\n\n      call.offerSent = true;\n\n      this.log('[InitialSetup] send 0');\n    }\n\n    const initialSetup = parseSignalingData(parseSdp(descriptionInit.sdp));\n    call.sendCallSignalingData(initialSetup);\n  }\n}\n","const subtle = typeof(window) !== 'undefined' && 'crypto' in window ? window.crypto.subtle : self.crypto.subtle;\n\nexport default subtle;\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n *\n * Originally from:\n * https://github.com/evgeny-nadymov/telegram-react\n * Copyright (C) 2018 Evgeny Nadymov\n * https://github.com/evgeny-nadymov/telegram-react/blob/master/LICENSE\n */\n\nimport bufferConcats from '../../../helpers/bytes/bufferConcats';\nimport subtle from '../../crypto/subtle';\nimport sha256 from '../../crypto/utils/sha256';\n\nconst kMaxIncomingPacketSize = 128 * 1024 * 1024;\n\nexport default class P2PEncryptor {\n  private type: 'Signaling';\n  private counter: number;\n  private seqMap: Map<number, number>;\n\n  constructor(private isOutgoing: boolean, private p2pKey: Uint8Array) {\n    this.type = 'Signaling';\n    this.counter = 0;\n    this.seqMap = new Map();\n  }\n\n  private concatSHA256(parts: Uint8Array[]) {\n    return sha256(bufferConcats(...parts));\n  }\n\n  private async encryptPrepared(buffer: Uint8Array) {\n    const result = {\n      counter: 0, // this.counterFromSeq(this.readSeq(buffer)),\n      bytes: new Uint8Array(16 + buffer.length)\n    };\n\n    const x = (this.isOutgoing ? 0 : 8) + (this.type === 'Signaling' ? 128 : 0);\n    const key = this.p2pKey;\n\n    const msgKeyLarge = await this.concatSHA256([key.subarray(x + 88, x + 88 + 32), buffer]);\n    const msgKey = result.bytes;\n    for(let i = 0; i < 16; ++i) {\n      msgKey[i] = msgKeyLarge[i + 8];\n    }\n\n    const aesKeyIv = await this.prepareAesKeyIv(key, msgKey, x);\n\n    const bytes = await this.aesProcessCtr(buffer, buffer.length, aesKeyIv, true);\n\n    result.bytes = new Uint8Array([...result.bytes.subarray(0, 16), ...bytes]);\n\n    return result;\n  }\n\n  public encryptRawPacket(buffer: Uint8Array) {\n    const seq = ++this.counter;\n    const arr = new ArrayBuffer(4);\n    const view = new DataView(arr);\n    view.setUint32(0, seq >>> 0, false); // byteOffset = 0; litteEndian = false\n\n    const result = new Uint8Array([...new Uint8Array(arr), ...buffer]);\n\n    return this.encryptPrepared(result);\n  }\n\n  private async prepareAesKeyIv(key: Uint8Array, msgKey: Uint8Array, x: number) {\n    const [sha256a, sha256b] = await Promise.all([\n      this.concatSHA256([\n        msgKey.subarray(0, 16),\n        key.subarray(x, x + 36)\n      ]),\n\n      this.concatSHA256([\n        key.subarray(40 + x, 40 + x + 36),\n        msgKey.subarray(0, 16)\n      ])\n    ]);\n\n    return {\n      key: new Uint8Array([\n        ...sha256a.subarray(0, 8),\n        ...sha256b.subarray(8, 8 + 16),\n        ...sha256a.subarray(24, 24 + 8)\n      ]),\n      iv: new Uint8Array([\n        ...sha256b.subarray(0, 4),\n        ...sha256a.subarray(8, 8 + 8),\n        ...sha256b.subarray(24, 24 + 4)\n      ])\n    };\n  }\n\n  private async aesProcessCtr(encryptedData: Uint8Array, dataSize: number, aesKeyIv: {key: Uint8Array, iv: Uint8Array}, encrypt = true) {\n    const cryptoKey = await subtle.importKey(\n      'raw',\n      aesKeyIv.key,\n      {name: 'AES-CTR'},\n      false,\n      [encrypt ? 'encrypt' : 'decrypt']\n    );\n\n    const buffer: ArrayBuffer = await subtle[encrypt ? 'encrypt' : 'decrypt']({\n      name: 'AES-CTR',\n      counter: aesKeyIv.iv,\n      length: aesKeyIv.iv.length * 8\n    },\n    cryptoKey,\n    encryptedData\n    );\n\n    return new Uint8Array(buffer);\n  }\n\n  private constTimeIsDifferent(a: Uint8Array, b: Uint8Array, count: number) {\n    let msgKeyEquals = true;\n    for(let i = 0; i < count; ++i) {\n      if(a[i] !== b[i]) {\n        msgKeyEquals = false;\n      }\n    }\n\n    return !msgKeyEquals;\n  }\n\n  public async decryptRawPacket(buffer: Uint8Array) {\n    if(buffer.length < 21 || buffer.length > kMaxIncomingPacketSize) {\n      return;\n    }\n\n    const {isOutgoing, type} = this;\n\n    const x = (isOutgoing ? 8 : 0) + (type === 'Signaling' ? 128 : 0);\n    const key = this.p2pKey;\n\n    const msgKey = buffer.subarray(0, 16);\n    const encryptedData = buffer.subarray(16);\n    const encryptedDataSize = buffer.length - 16;\n\n    const aesKeyIv = await this.prepareAesKeyIv(key, msgKey, x);\n\n    const decryptionBuffer = await this.aesProcessCtr(encryptedData, encryptedDataSize, aesKeyIv, false);\n\n    const msgKeyLarge = await this.concatSHA256([\n      key.subarray(88 + x, 88 + x + 32),\n      decryptionBuffer\n    ]);\n\n    if(this.constTimeIsDifferent(msgKeyLarge.subarray(8), msgKey, 16)) {\n      return;\n    }\n\n    const dataView = new DataView(decryptionBuffer.buffer);\n    const seq = dataView.getUint32(0);\n    if(this.seqMap.has(seq)) {\n      return;\n    }\n    this.seqMap.set(seq, seq);\n\n    return decryptionBuffer.slice(4);\n  }\n}\n","import convertToUint8Array from '../../../helpers/bytes/convertToUint8Array';\nimport subtle from '../subtle';\n// import sha256 from '@cryptography/sha256';\n\nexport default function sha256(bytes: Parameters<typeof convertToUint8Array>[0]) {\n  return subtle.digest('SHA-256', convertToUint8Array(bytes)).then((b) => {\n    // console.log('legacy', performance.now() - perfS);\n    return new Uint8Array(b);\n  });\n  /* //console.log('SHA-256 hash start');\n\n  let perfS = performance.now();\n\n\n  let perfD = performance.now();\n  let words = typeof(bytes) === 'string' ? bytes : bytesToWordss(bytes as any);\n  let hash = sha256(words);\n  console.log('darutkin', performance.now() - perfD);\n\n  //console.log('SHA-256 hash finish', hash, sha256(words, 'hex'));\n\n  return bytesFromWordss(hash); */\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n *\n * Originally from:\n * https://github.com/evgeny-nadymov/telegram-react\n * Copyright (C) 2018 Evgeny Nadymov\n * https://github.com/evgeny-nadymov/telegram-react/blob/master/LICENSE\n */\n\nimport StringFromLineBuilder from '../stringFromLineBuilder';\nimport {addDataChannel, addExtmap, addPayloadTypes, addSsrc} from './p2PSdpBuilder';\n\nexport default class ChromeP2PSdpBuilder {\n  static generateOffer(info: any) {\n    const {fingerprints, ufrag, pwd, audio, video} = info;\n    audio.type = 'audio';\n    video.type = 'video';\n    const media = [audio, video];\n\n    const stringBuilder = new StringFromLineBuilder();\n    stringBuilder.add(\n      'v=0',\n      'o=- 1 2 IN IP4 127.0.0.1',\n      's=-',\n      't=0 0'\n    );\n\n    if(fingerprints) {\n      fingerprints.forEach((x: any) => {\n        const {hash, fingerprint, setup} = x;\n        stringBuilder.add(\n          `a=fingerprint:${hash} ${fingerprint}`,\n          `a=setup:${setup}`\n        );\n      });\n    }\n    if(ufrag && pwd) {\n      stringBuilder.add(\n        `a=ice-ufrag:${ufrag}`,\n        `a=ice-pwd:${pwd}`\n      );\n    }\n\n    stringBuilder.add(\n      'a=group:BUNDLE 0 1 2',\n      'a=extmap-allow-mixed',\n      'a=msid-semantic: WMS *'\n    );\n    const streamName = 'stream' + media.map((x) => x.ssrc).join('_');\n    for(let i = 0; i < media.length; i++) {\n      const m = media[i];\n      const {type, ssrc, ssrcGroups, payloadTypes, rtpExtensions} = m;\n      switch(type) {\n        case 'audio': {\n          stringBuilder.add(\n            `m=audio 56930 UDP/TLS/RTP/SAVPF ${payloadTypes.map((x: any) => x.id).join(' ')}`,\n            'c=IN IP4 0.0.0.0',\n            'a=rtcp:9 IN IP4 0.0.0.0',\n            'a=ice-options:trickle',\n            `a=mid:${i}`,\n            'a=sendrecv',\n            addExtmap(rtpExtensions)\n          );\n          if(ssrc) {\n            stringBuilder.add(`a=msid:${streamName} audio${ssrc}`);\n          }\n          stringBuilder.add(\n            'a=rtcp-mux',\n            addPayloadTypes(payloadTypes),\n            addSsrc(type, ssrc, ssrcGroups, streamName)\n          );\n\n          break;\n        }\n\n        case 'video': {\n          stringBuilder.add(\n            `m=video 61986 UDP/TLS/RTP/SAVPF ${payloadTypes.map((x: any) => x.id).join(' ')}`,\n            'c=IN IP4 0.0.0.0',\n            'a=rtcp:9 IN IP4 0.0.0.0',\n            'a=ice-options:trickle',\n            `a=mid:${i}`,\n            'a=sendrecv',\n            addExtmap(rtpExtensions)\n          );\n          if(ssrc) {\n            stringBuilder.add(`a=msid:${streamName} video${ssrc}`);\n          }\n          stringBuilder.add(\n            'a=rtcp-mux',\n            'a=rtcp-rsize',\n            addPayloadTypes(payloadTypes),\n            addSsrc(type, ssrc, ssrcGroups, streamName)\n          );\n          break;\n        }\n      }\n    }\n    stringBuilder.add(addDataChannel(2));\n    return stringBuilder.finalize();\n  }\n\n  static generateAnswer(info: any) {\n    const {fingerprints, ufrag, pwd, audio, video} = info;\n    audio.type = 'audio';\n    video.type = 'video';\n    const media = [audio, video];\n\n    const stringBuilder = new StringFromLineBuilder();\n    stringBuilder.add(\n      'v=0',\n      'o=- 1 2 IN IP4 127.0.0.1',\n      's=-',\n      't=0 0'\n    );\n\n    if(fingerprints) {\n      fingerprints.forEach((x: any) => {\n        const {hash, fingerprint, setup} = x;\n        stringBuilder.add(\n          `a=fingerprint:${hash} ${fingerprint}`,\n          `a=setup:${setup}`\n        );\n      });\n    }\n    if(ufrag && pwd) {\n      stringBuilder.add(\n        `a=ice-ufrag:${ufrag}`,\n        `a=ice-pwd:${pwd}`\n      );\n    }\n\n    stringBuilder.add(\n      'a=group:BUNDLE 0 1 2',\n      'a=extmap-allow-mixed',\n      'a=msid-semantic: WMS *'\n    );\n    const streamName = 'stream' + media.map((x) => x.ssrc).join('_');\n    for(let i = 0; i < media.length; i++) {\n      const m = media[i];\n      const {type, ssrc, ssrcGroups, payloadTypes, rtpExtensions} = m;\n      switch(type) {\n        case 'audio': {\n          stringBuilder.add(\n            `m=audio 56930 UDP/TLS/RTP/SAVPF ${payloadTypes.map((x: any) => x.id).join(' ')}`,\n            'c=IN IP4 0.0.0.0',\n            'a=rtcp:9 IN IP4 0.0.0.0',\n            'a=ice-options:trickle',\n            `a=mid:${i}`,\n            'a=sendrecv',\n            addExtmap(rtpExtensions)\n          );\n          if(ssrc) {\n            stringBuilder.add(`a=msid:${streamName} audio${ssrc}`);\n          }\n          stringBuilder.add(\n            'a=rtcp-mux',\n            addPayloadTypes(payloadTypes),\n            addSsrc(type, ssrc, ssrcGroups, streamName)\n          );\n          break;\n        }\n\n        case 'video': {\n          stringBuilder.add(\n            `m=video 61986 UDP/TLS/RTP/SAVPF ${payloadTypes.map((x: any) => x.id).join(' ')}`,\n            'c=IN IP4 0.0.0.0',\n            'a=rtcp:9 IN IP4 0.0.0.0',\n            'a=ice-options:trickle',\n            `a=mid:${i}`,\n            'a=sendrecv',\n            addExtmap(rtpExtensions)\n          );\n          if(ssrc) {\n            stringBuilder.add(`a=msid:${streamName} video${ssrc}`);\n          }\n\n          stringBuilder.add(\n            'a=rtcp-mux',\n            'a=rtcp-rsize',\n            addPayloadTypes(payloadTypes),\n            addSsrc(type, ssrc, ssrcGroups, streamName)\n          );\n          break;\n        }\n      }\n    }\n    stringBuilder.add(addDataChannel(2));\n    return stringBuilder.finalize();\n  }\n}\n","/*\n*  Copyright (c) 2018-present, Evgeny Nadymov\n*\n* This source code is licensed under the GPL v.3.0 license found in the\n* LICENSE file in the root directory of this source tree.\n*/\n\nimport ChromeP2PSdpBuilder from './chromeP2PSdpBuilder';\nimport { FirefoxP2PSdpBuilder } from './firefoxP2PSdpBuilder';\nimport { SafariP2PSdpBuilder } from './safariP2PSdpBuilder';\n// import { TG_CALLS_SDP_STRING } from '../../Stores/CallStore';\n\nexport function p2pParseCandidate(candidate) {\n  if(!candidate || !candidate.startsWith('candidate:')) {\n    return;\n  }\n  \n  const sdpString = candidate;\n  candidate = candidate.substr('candidate:'.length);\n  \n  const [foundation, component, protocol, priority, ip, port, ...other] = candidate.split(' ');\n  const c = {\n    sdpString,\n    foundation,\n    component,\n    protocol,\n    priority,\n    address: { ip, port }\n  };\n  \n  for(let i = 0; i < other.length; i += 2) {\n    switch(other[i]) {\n      case 'typ': {\n        c.type = other[i + 1];\n        break;\n      }\n      case 'raddr': {\n        if(!c.relAddress) {\n          c.relAddress = {};\n        }\n        \n        c.relAddress.ip = other[i + 1];\n        break;\n      }\n      case 'rport': {\n        if(!c.relAddress) {\n          c.relAddress = {};\n        }\n        \n        c.relAddress.port = other[i + 1];\n        break;\n      }\n      case 'generation': {\n        c.generation = other[i + 1];\n        break;\n      }\n      case 'tcptype': {\n        c.tcpType = other[i + 1];\n        break;\n      }\n      case 'network-id': {\n        c.networkId = other[i + 1];\n        break;\n      }\n      case 'network-cost': {\n        c.networkCost = other[i + 1];\n        break;\n      }\n      case 'ufrag': {\n        c.username = other[i + 1];\n        break;\n      }\n    }\n  }\n  \n  return c;\n}\n\nexport function p2pParseSdp(sdp) {\n  const lines = sdp.split('\\r\\n');\n  const lookup = (prefix, force = true, lineFrom = 0, lineTo = Number.MAX_VALUE) => {\n    if (lineTo === -1) {\n      lineTo = Number.MAX_VALUE;\n    }\n    for (let i = lineFrom; i < lines.length && i < lineTo; i++) {\n      const line = lines[i];\n      if (line.startsWith(prefix)) {\n        return line.substr(prefix.length);\n      }\n    }\n    \n    if (force) {\n      console.error(\"Can't find prefix\", prefix);\n    }\n    \n    return null;\n  };\n  const findIndex = (prefix, lineFrom = 0, lineTo = Number.MAX_VALUE) => {\n    if (lineTo === -1) {\n      lineTo = Number.MAX_VALUE;\n    }\n    for (let i = lineFrom; i < lines.length && i < lineTo; i++) {\n      const line = lines[i];\n      if (line.startsWith(prefix)) {\n        return i;\n      }\n    }\n    \n    return -1;\n  };\n  \n  const pwdIndex = findIndex('a=ice-pwd:');\n  const ufragIndex = findIndex('a=ice-ufrag:');\n  if (pwdIndex === -1 && ufragIndex === -1) {\n    return {\n      // sessionId: lookup('o=').split(' ')[1],\n      ufrag: null,\n      pwd: null,\n      fingerprints: []\n    };\n  }\n  \n  const info = {\n    // sessionId: lookup('o=').split(' ')[1],\n    ufrag: null,\n    pwd: null,\n    fingerprints: []\n  };\n  \n  let mediaIndex = findIndex('m=');\n  const fingerprint = lookup('a=fingerprint:', false);\n  const setup = lookup('a=setup:', false);\n  if (fingerprint && setup) {\n    info.fingerprints.push({\n      hash: fingerprint.split(' ')[0],\n      fingerprint: fingerprint.split(' ')[1],\n      setup\n    });\n  }\n  \n  const ufrag = lookup('a=ice-ufrag:', false);\n  const pwd = lookup('a=ice-pwd:', false);\n  if (ufrag && pwd) {\n    info.ufrag = ufrag;\n    info.pwd = pwd;\n  }\n  \n  while (mediaIndex !== -1) {\n    let nextMediaIndex = findIndex('m=', mediaIndex + 1);\n    \n    const extmap = [];\n    const types = [];\n    const mediaType = lookup('m=', true, mediaIndex, nextMediaIndex).split(' ')[0];\n    const media = {\n      // type: lookup('m=', true, mediaIndex, nextMediaIndex).split(' ')[0],\n      // mid: lookup('a=mid:', true, mediaIndex, nextMediaIndex),\n      // dir: findDirection(mediaIndex, nextMediaIndex),\n      rtpExtensions: extmap,\n      payloadTypes: types\n    }\n    \n    const lineTo = nextMediaIndex === -1 ? lines.length : nextMediaIndex;\n    const fmtp = new Map();\n    const rtcpFb = new Map();\n    for (let i = mediaIndex; i < lineTo; i++) {\n      const line = lines[i];\n      if (line.startsWith('a=extmap:')) {\n        const [ id, uri ] = line.substr('a=extmap:'.length).split(' ');\n        extmap.push({ id: parseInt(id), uri });\n      } else if (line.startsWith('a=fmtp:')) {\n        const [ id, str ] = line.substr('a=fmtp:'.length).split(' ');\n        const obj = { };\n        const arr =  str.split(';').map(x => {\n          const [ key, value ] = x.split('=');\n          obj[key] = value;\n          return { [key]: value };\n        });\n        fmtp.set(parseInt(id), obj);\n      } else if (line.startsWith('a=rtcp-fb:')) {\n        const [ id, type = '', subtype = '' ] = line.substr('a=rtcp-fb:'.length).split(' ');\n        if (rtcpFb.has(parseInt(id))) {\n          rtcpFb.get(parseInt(id)).push({ type, subtype });\n        } else {\n          rtcpFb.set(parseInt(id), [{ type, subtype }])\n        }\n      } else if (line.startsWith('a=rtpmap')) {\n        const [ id, str ] = line.substr('a=rtpmap:'.length).split(' ');\n        const [ name, clockrate, channels = '0' ] = str.split('/');\n        const obj = { id: parseInt(id), name, clockrate: parseInt(clockrate), channels: parseInt(channels) };\n        \n        types.push(obj);\n      }\n    }\n    \n    for (let i = 0; i < types.length; i++) {\n      const { id } = types[i];\n      if (rtcpFb.has(id)) {\n        types[i].feedbackTypes = rtcpFb.get(id);\n      }\n      if (fmtp.has(id)) {\n        types[i].parameters = fmtp.get(id);\n      }\n    }\n    \n    const ssrc = lookup('a=ssrc:', false, mediaIndex, nextMediaIndex);\n    if (ssrc) {\n      media.ssrc = ssrc.split(' ')[0];\n    }\n    \n    const ssrcGroup = lookup('a=ssrc-group:', false, mediaIndex, nextMediaIndex);\n    if (ssrcGroup) {\n      const [ semantics, ...ssrcs ] = ssrcGroup.split(' ');\n      media.ssrcGroups = [{\n        semantics,\n        ssrcs\n      }]\n    }\n    \n    switch (mediaType) {\n      case 'audio': {\n        info.audio = media;\n        break;\n      }\n      case 'video': {\n        info.video = media;\n        break;\n      }\n    }\n    \n    mediaIndex = nextMediaIndex;\n  }\n\n  if(!info.video.ssrcGroups) {\n    info.video.ssrcGroups = [];\n  }\n\n  info['@type'] = 'InitialSetup';\n  \n  // console.log('[p2pParseSdp]', sdp, info);\n  return info;\n}\n\nexport function isFirefox() {\n  return navigator.userAgent.toLowerCase().indexOf('firefox') > -1;\n}\n\nfunction isSafari() {\n  return navigator.userAgent.toLowerCase().indexOf('safari') > -1 && navigator.userAgent.toLowerCase().indexOf('chrome') === -1;\n}\n\nexport function addExtmap(extmap) {\n  let sdp = [];\n  // return sdp;\n  for (let j = 0; j < extmap.length; j++) {\n    const ext = extmap[j];\n    const { id, uri } = ext;\n    // if (isFirefox() && uri.indexOf(''))\n    console.log('[extmap] add', id, uri);\n    sdp.push(`a=extmap:${id} ${uri}`);\n  }\n  \n  return sdp.join('\\n');\n}\n\nexport function addPayloadTypes(types) {\n  let sdp = [];\n  console.log('[SDP] addPayloadTypes', types);\n  for (let i = 0; i < types.length; i++) {\n    const type = types[i];\n    const { id, name, clockrate, channels, feedbackTypes, parameters } = type;\n    sdp.push(`a=rtpmap:${id} ${name}/${clockrate}${channels ? '/' + channels : ''}`);\n    if (feedbackTypes) {\n      feedbackTypes.forEach(x => {\n        const { type, subtype } = x;\n        sdp.push(`a=rtcp-fb:${id} ${[type, subtype].join(' ')}`);\n      });\n    }\n    if (parameters) {\n      const fmtp = [];\n      Object.getOwnPropertyNames(parameters).forEach(pName => {\n        fmtp.push(`${pName}=${parameters[pName]}`);\n      });\n      \n      sdp.push(`a=fmtp:${id} ${fmtp.join(';')}`);\n    }\n  }\n  \n  return sdp.join('\\n');\n}\n\nexport function addSsrc(type, ssrc, ssrcGroups, streamName) {\n  let sdp = [];\n  \n  if (ssrcGroups && ssrcGroups.length > 0) {\n    ssrcGroups.forEach(ssrcGroup => {\n      if (ssrcGroup && ssrcGroup.ssrcs.length > 0) {\n        sdp.push(`a=ssrc-group:${ssrcGroup.semantics} ${ssrcGroup.ssrcs.join(' ')}`);\n        ssrcGroup.ssrcs.forEach(ssrc => {\n          sdp.push(\n            `a=ssrc:${ssrc} cname:stream${ssrc}`,\n            `a=ssrc:${ssrc} msid:${streamName} ${type}${ssrc}`,\n            `a=ssrc:${ssrc} mslabel:${type}${ssrc}`,\n            `a=ssrc:${ssrc} label:${type}${ssrc}`\n          );\n        });\n      }\n    });\n  } else if (ssrc) {\n    sdp.push(\n      `a=ssrc:${ssrc} cname:stream${ssrc}`,\n      `a=ssrc:${ssrc} msid:${streamName} ${type}${ssrc}`,\n      `a=ssrc:${ssrc} mslabel:${type}${ssrc}`,\n      `a=ssrc:${ssrc} label:${type}${ssrc}`\n    );\n  }\n  \n  return sdp.join('\\n');\n}\n\nexport function addDataChannel(mid) {\n  return `m=application 9 UDP/DTLS/SCTP webrtc-datachannel\nc=IN IP4 0.0.0.0\na=ice-options:trickle\na=mid:2\na=sctp-port:5000\na=max-message-size:262144`;\n}\n\nexport class P2PSdpBuilder {\n  static generateCandidate(info) {\n    if (!info) return null;\n    \n    const { sdpString, sdpMLineIndex, sdpMid, foundation, component, protocol, priority, address, type, relAddress, generation, tcpType, networkId, networkCost, username } = info;\n    if (/* TG_CALLS_SDP_STRING */true) {\n      if (sdpString) {\n        return {\n          candidate: sdpString,\n          sdpMLineIndex,\n          sdpMid\n        };\n      }\n    }\n    throw 'no sdpString';\n    \n    let candidate = `candidate:${foundation} ${component} ${protocol} ${priority} ${address.ip} ${address.port}`;\n    const attrs = []\n    if (type) {\n      attrs.push(`typ ${type}`);\n    }\n    if (relAddress) {\n      attrs.push(`raddr ${relAddress.ip}`);\n      attrs.push(`rport ${relAddress.port}`);\n    }\n    if (tcpType) {\n      attrs.push(`tcptype ${tcpType}`);\n    }\n    if (generation) {\n      attrs.push(`generation ${generation}`);\n    }\n    if (username) {\n      attrs.push(`ufrag ${username}`);\n    }\n    if (networkId) {\n      attrs.push(`network-id ${networkId}`);\n    }\n    if (networkCost) {\n      attrs.push(`network-cost ${networkCost}`);\n    }\n    if (attrs.length > 0) {\n      candidate += ` ${attrs.join(' ')}`;\n    }\n    \n    return { candidate, sdpMid, sdpMLineIndex };\n  }\n  \n  static generateOffer(info) {\n    if (isFirefox()) {\n      return FirefoxP2PSdpBuilder.generateOffer(info);\n    } else if (isSafari()) {\n      return SafariP2PSdpBuilder.generateOffer(info);\n    }\n    \n    return ChromeP2PSdpBuilder.generateOffer(info);\n  }\n  \n  static generateAnswer(info) {\n    if (isFirefox()) {\n      return FirefoxP2PSdpBuilder.generateAnswer(info);\n    } else if (isSafari()) {\n      return SafariP2PSdpBuilder.generateAnswer(info);\n    }\n    \n    return ChromeP2PSdpBuilder.generateAnswer(info);\n  }\n}","/*\n *  Copyright (c) 2018-present, Evgeny Nadymov\n *\n * This source code is licensed under the GPL v.3.0 license found in the\n * LICENSE file in the root directory of this source tree.\n */\n\nimport { addDataChannel, addExtmap, addPayloadTypes, addSsrc } from './p2PSdpBuilder';\n\nexport class FirefoxP2PSdpBuilder {\n    static generateOffer(info) {\n        const { fingerprints, ufrag, pwd, audio, video } = info;\n        audio.type = 'audio';\n        video.type = 'video';\n        const media = [audio, video];\n\n        let sdp = `v=0\no=- 1 0 IN IP4 0.0.0.0\ns=-\nt=0 0`;\n        if (fingerprints) {\n            fingerprints.forEach(x => {\n                const { hash, fingerprint, setup } = x;\n                sdp += `\na=fingerprint:${hash} ${fingerprint}\na=setup:${setup}`;\n            });\n        }\n        if (ufrag && pwd) {\n            sdp += `\na=ice-ufrag:${ufrag}\na=ice-pwd:${pwd}`;\n        }\n\n        sdp += `\na=group:BUNDLE 0 1 2\na=ice-options:trickle\na=msid-semantic:WMS *`;\n        const streamName = 'stream' + media.map(x => x.ssrc).join('_');\n        for (let i = 0; i < media.length; i++) {\n            const m = media[i];\n            const { type, ssrc, ssrcGroups, payloadTypes, rtpExtensions } = m;\n            switch (type) {\n                case 'audio': {\n                    sdp += `\nm=audio 9 UDP/TLS/RTP/SAVPF ${payloadTypes.map(x => x.id).join(' ')}\nc=IN IP4 0.0.0.0\na=mid:${i}\na=sendrecv`;\n                    sdp += addExtmap(rtpExtensions);\n                    sdp += `\na=rtcp-mux`;\n                    sdp += addPayloadTypes(payloadTypes);\n                    sdp += addSsrc(type, ssrc, ssrcGroups, streamName);\n\n                    break;\n                }\n                case 'video': {\n                    sdp += `\nm=video 9 UDP/TLS/RTP/SAVPF ${payloadTypes.map(x => x.id).join(' ')}\nc=IN IP4 0.0.0.0\na=mid:${i}\na=sendrecv`;\n                    sdp += addExtmap(rtpExtensions);\n                    sdp += `\na=rtcp-mux\na=rtcp-rsize`;\n                    sdp += addPayloadTypes(payloadTypes);\n                    sdp += addSsrc(type, ssrc, ssrcGroups, streamName);\n\n                    break;\n                }\n            }\n        }\n        sdp += addDataChannel(2);\n        sdp += `\n`;\n\n        return sdp;\n    }\n\n    static generateAnswer(info) {\n        const { fingerprints, ufrag, pwd, audio, video } = info;\n        audio.type = 'audio';\n        video.type = 'video';\n        const media = [audio, video];\n\n        let sdp = `v=0\no=- 1 0 IN IP4 0.0.0.0\ns=-\nt=0 0`;\n        if (fingerprints) {\n            fingerprints.forEach(x => {\n                const { hash, fingerprint, setup } = x;\n                sdp += `\na=fingerprint:${hash} ${fingerprint}\na=setup:${setup}`;\n            });\n        }\n        if (ufrag && pwd) {\n            sdp += `\na=ice-ufrag:${ufrag}\na=ice-pwd:${pwd}`;\n        }\n\n        sdp += `\na=group:BUNDLE 0 1 2\na=ice-options:trickle\na=msid-semantic:WMS *`;\n        const streamName = 'stream' + media.map(x => x.ssrc).join('_');\n        for (let i = 0; i < media.length; i++) {\n            const m = media[i];\n            const { type, mid, ssrc, ssrcGroups, payloadTypes, dir, rtpExtensions } = m;\n            switch (type) {\n                case 'audio': {\n                    sdp += `\nm=audio 9 UDP/TLS/RTP/SAVPF ${payloadTypes.map(x => x.id).join(' ')}\nc=IN IP4 0.0.0.0\na=mid:${i}\na=sendrecv`;\n                    sdp += addExtmap(rtpExtensions);\n                    sdp += `\na=rtcp-mux`;\n                    sdp += addPayloadTypes(payloadTypes);\n                    sdp += addSsrc(type, ssrc, ssrcGroups, streamName);\n\n                    break;\n                }\n                case 'video': {\n                    sdp += `\nm=video 9 UDP/TLS/RTP/SAVPF ${payloadTypes.map(x => x.id).join(' ')}\nc=IN IP4 0.0.0.0\na=mid:${i}\na=sendrecv`;\n                    sdp += addExtmap(rtpExtensions);\n                    sdp += `\na=rtcp-mux\na=rtcp-rsize`;\n                    sdp += addPayloadTypes(payloadTypes);\n                    sdp += addSsrc(type, ssrc, ssrcGroups, streamName);\n                    break;\n                }\n            }\n        }\n        sdp += addDataChannel(2);\n        sdp += `\n`;\n\n        return sdp;\n    }\n}","/*\n *  Copyright (c) 2018-present, Evgeny Nadymov\n *\n * This source code is licensed under the GPL v.3.0 license found in the\n * LICENSE file in the root directory of this source tree.\n */\n\nimport { addDataChannel, addExtmap, addPayloadTypes, addSsrc } from './p2PSdpBuilder';\n\nexport class SafariP2PSdpBuilder {\n    static generateOffer(info) {\n        const { fingerprints, ufrag, pwd, audio, video } = info;\n        audio.type = 'audio';\n        video.type = 'video';\n        const media = [audio, video];\n\n        if (!media.length) {\n            return `v=0\no=- 1 2 IN IP4 127.0.0.1\ns=-\nt=0 0\na=msid-semantic: WMS\n`;\n        }\n\n        let sdp = `v=0\no=- 1 2 IN IP4 127.0.0.1\ns=-\nt=0 0`;\n        if (fingerprints) {\n            fingerprints.forEach(x => {\n                const { hash, fingerprint, setup } = x;\n                sdp += `\na=fingerprint:${hash} ${fingerprint}\na=setup:${setup}`;\n            });\n        }\n        if (ufrag && pwd) {\n            sdp += `\na=ice-ufrag:${ufrag}\na=ice-pwd:${pwd}`;\n        }\n\n        sdp += `\na=group:BUNDLE 0 1 2\na=extmap-allow-mixed\na=msid-semantic: WMS *`;\n        const streamName = 'stream' + media.map(x => x.ssrc).join('_');\n        for (let i = 0; i < media.length; i++) {\n            const m = media[i];\n            const { type, ssrc, ssrcGroups, payloadTypes, rtpExtensions } = m;\n            switch (type) {\n                case 'audio': {\n                    sdp += `\nm=audio 9 UDP/TLS/RTP/SAVPF ${payloadTypes.map(x => x.id).join(' ')}\nc=IN IP4 0.0.0.0\na=rtcp:9 IN IP4 0.0.0.0\na=ice-options:trickle\na=mid:${i}\na=sendrecv`;\n                    sdp += addExtmap(rtpExtensions);\n                    if (ssrc) {\n                        sdp += `\na=msid:${streamName} audio${ssrc}`;\n                    }\n                    sdp += `\na=rtcp-mux`;\n                    sdp += addPayloadTypes(payloadTypes);\n                    sdp += addSsrc(type, ssrc, ssrcGroups, streamName);\n\n                    break;\n                }\n                case 'video': {\n                    sdp += `\nm=video 9 UDP/TLS/RTP/SAVPF ${payloadTypes.map(x => x.id).join(' ')}\nc=IN IP4 0.0.0.0\na=rtcp:9 IN IP4 0.0.0.0\na=ice-options:trickle\na=mid:${i}\na=sendrecv`;\n                    sdp += addExtmap(rtpExtensions);\n                    if (ssrc) {\n                        sdp += `\na=msid:${streamName} video${ssrc}`;\n                    }\n                    sdp += `\na=rtcp-mux\na=rtcp-rsize`;\n                    sdp += addPayloadTypes(payloadTypes);\n                    sdp += addSsrc(type, ssrc, ssrcGroups, streamName);\n                    break;\n                }\n            }\n        }\n        sdp += addDataChannel(2);\n        sdp += `\n`;\n\n        return sdp;\n    }\n\n    static generateAnswer(info) {\n        const { fingerprints, ufrag, pwd, audio, video } = info;\n        audio.type = 'audio';\n        video.type = 'video';\n        const media = [audio, video];\n\n        if (!media.length) {\n            return `v=0\no=- 1 2 IN IP4 127.0.0.1\ns=-\nt=0 0\na=msid-semantic: WMS\n`;\n        }\n\n        let sdp = `v=0\no=- 1 2 IN IP4 127.0.0.1\ns=-\nt=0 0`;\n        if (fingerprints) {\n            fingerprints.forEach(x => {\n                const { hash, fingerprint, setup } = x;\n                sdp += `\na=fingerprint:${hash} ${fingerprint}\na=setup:${setup}`;\n            });\n        }\n        if (ufrag && pwd) {\n            sdp += `\na=ice-ufrag:${ufrag}\na=ice-pwd:${pwd}`;\n        }\n\n        sdp += `\na=group:BUNDLE 0 1 2\na=extmap-allow-mixed\na=msid-semantic: WMS *`;\n        const streamName = 'stream' + media.map(x => x.ssrc).join('_');\n        for (let i = 0; i < media.length; i++) {\n            const m = media[i];\n            const { type, ssrc, ssrcGroups, payloadTypes, rtpExtensions } = m;\n            switch (type) {\n                case 'audio': {\n                    sdp += `\nm=audio 9 UDP/TLS/RTP/SAVPF ${payloadTypes.map(x => x.id).join(' ')}\nc=IN IP4 0.0.0.0\na=rtcp:9 IN IP4 0.0.0.0\na=ice-options:trickle\na=mid:${i}\na=sendrecv`;\n                    sdp += addExtmap(rtpExtensions);\n                    if (ssrc) {\n                        sdp += `\na=msid:${streamName} audio${ssrc}`;\n                    }\n                    sdp += `\na=rtcp-mux`;\n                    sdp += addPayloadTypes(payloadTypes);\n                    sdp += addSsrc(type, ssrc, ssrcGroups, streamName);\n\n                    break;\n                }\n                case 'video': {\n                    sdp += `\nm=video 9 UDP/TLS/RTP/SAVPF ${payloadTypes.map(x => x.id).join(' ')}\nc=IN IP4 0.0.0.0\na=rtcp:9 IN IP4 0.0.0.0\na=ice-options:trickle\na=mid:${i}\na=sendrecv`;\n                    sdp += addExtmap(rtpExtensions);\n                    if (ssrc) {\n                        sdp += `\na=msid:${streamName} video${ssrc}`;\n                    }\n                    sdp += `\na=rtcp-mux\na=rtcp-rsize`;\n                    sdp += addPayloadTypes(payloadTypes);\n                    sdp += addSsrc(type, ssrc, ssrcGroups, streamName);\n                    break;\n                }\n            }\n        }\n        sdp += addDataChannel(2);\n        sdp += `\n`;\n\n        return sdp;\n    }\n}","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport ctx from '../../environment/ctx';\nimport {IS_SAFARI} from '../../environment/userAgent';\nimport safeAssign from '../../helpers/object/safeAssign';\nimport debounce from '../../helpers/schedulers/debounce';\nimport {GroupCallParticipantVideoSourceGroup, PhoneCall, PhoneCallDiscardReason, PhoneCallProtocol, Update} from '../../layer';\nimport {emojiFromCodePoints} from '../../vendor/emoji';\nimport type {CallId} from '../appManagers/appCallsManager';\nimport type {AppManagers} from '../appManagers/managers';\nimport {logger} from '../logger';\nimport apiManagerProxy from '../mtproto/mtprotoworker';\nimport CallConnectionInstance from './callConnectionInstance';\nimport CallInstanceBase from './callInstanceBase';\nimport callsController from './callsController';\nimport CALL_STATE from './callState';\nimport {GROUP_CALL_AMPLITUDE_ANALYSE_INTERVAL_MS} from './constants';\nimport parseSignalingData from './helpers/parseSignalingData';\nimport stopTrack from './helpers/stopTrack';\nimport localConferenceDescription, {ConferenceEntry, generateSsrc} from './localConferenceDescription';\nimport getCallProtocol from './p2P/getCallProtocol';\nimport getRtcConfiguration from './p2P/getRtcConfiguration';\nimport P2PEncryptor from './p2P/p2PEncryptor';\nimport {p2pParseCandidate, P2PSdpBuilder} from './p2P/p2PSdpBuilder';\nimport {parseSdp} from './sdp/utils';\nimport {WebRTCLineType} from './sdpBuilder';\nimport StreamManager from './streamManager';\nimport {AudioCodec, CallMediaState, CallSignalingData, DiffieHellmanInfo, P2PAudioCodec, P2PVideoCodec, VideoCodec} from './types';\n\nexport default class CallInstance extends CallInstanceBase<{\n  state: (state: CALL_STATE) => void,\n  id: (id: CallId, prevId: CallId) => void,\n  muted: (muted: boolean) => void,\n  mediaState: (mediaState: CallMediaState) => void,\n  acceptCallOverride: () => Promise<boolean>,\n}> {\n  public dh: Partial<DiffieHellmanInfo.a & DiffieHellmanInfo.b>;\n  public id: CallId;\n  public call: PhoneCall;\n  public interlocutorUserId: UserId;\n  public protocol: PhoneCallProtocol;\n  public isOutgoing: boolean;\n  public encryptionKey: Uint8Array;\n  public connectionInstance: CallConnectionInstance;\n  public encryptor: P2PEncryptor;\n  public decryptor: P2PEncryptor;\n  public candidates: RTCIceCandidate[];\n\n  public offerReceived: boolean;\n  public offerSent: boolean;\n\n  public createdParticipantEntries: boolean;\n  public release: () => Promise<void>;\n  public _connectionState: CALL_STATE;\n\n  public createdAt: number;\n  public connectedAt: number;\n  public discardReason: string;\n\n  private managers: AppManagers;\n\n  private hangUpTimeout: number;\n\n  private mediaStates: {\n    input: CallMediaState,\n    output?: CallMediaState\n  };\n\n  private sendMediaState: () => Promise<void>;\n\n  private decryptQueue: Uint8Array[];\n\n  private getEmojisFingerprintPromise: Promise<CallInstance['emojisFingerprint']>;\n  private emojisFingerprint: [string, string, string, string];\n\n  private wasStartingScreen: boolean;\n  private wasStartingVideo: boolean;\n  public wasTryingToJoin: boolean;\n\n  public streamManager: StreamManager;\n\n  constructor(options: {\n    isOutgoing: boolean,\n    interlocutorUserId: UserId,\n    managers: CallInstance['managers'],\n    protocol?: PhoneCallProtocol\n  }) {\n    super();\n\n    this.log = logger('CALL');\n\n    if(!this.protocol) {\n      this.protocol = getCallProtocol();\n    }\n\n    safeAssign(this, options);\n\n    this.createdAt = Date.now();\n    this.offerReceived = false;\n    this.offerSent = false;\n    this.decryptQueue = [];\n    this.candidates = [];\n\n    this.addEventListener('state', (state) => {\n      this.log('state', CALL_STATE[state]);\n\n      if(state === CALL_STATE.CLOSED) {\n        this.cleanup();\n      }\n    });\n\n    const streamManager = this.streamManager = new StreamManager(GROUP_CALL_AMPLITUDE_ANALYSE_INTERVAL_MS);\n    streamManager.direction = 'sendrecv';\n    streamManager.types.push('screencast');\n    if(!this.isOutgoing) {\n      streamManager.locked = true;\n      streamManager.canCreateConferenceEntry = false;\n    }\n\n    let mediaState: CallMediaState = {\n      '@type': 'MediaState',\n      'type': 'input',\n      'lowBattery': false,\n      'muted': true,\n      'screencastState': 'inactive',\n      'videoRotation': 0,\n      'videoState': 'inactive'\n    };\n\n    const self = this;\n    mediaState = new Proxy(mediaState, {\n      set: function(target, key, value) {\n        // @ts-ignore\n        target[key] = value;\n        self.setMediaState(mediaState);\n        self.sendMediaState();\n        return true;\n      }\n    });\n\n    this.mediaStates = {\n      input: mediaState\n    };\n\n    this.sendMediaState = debounce(this._sendMediaState.bind(this), 0, false, true);\n  }\n\n  get connectionState() {\n    const {_connectionState, connectionInstance} = this;\n    if(_connectionState !== undefined) {\n      return _connectionState;\n    } else if(!connectionInstance) {\n      return CALL_STATE.CONNECTING;\n    } else {\n      const {iceConnectionState} = connectionInstance.connection;\n      if(iceConnectionState === 'closed') {\n        return CALL_STATE.CLOSED;\n      } else if(iceConnectionState !== 'connected' && (!IS_SAFARI || iceConnectionState !== 'completed')) {\n        return CALL_STATE.CONNECTING;\n      } else {\n        return CALL_STATE.CONNECTED;\n      }\n    }\n  }\n\n  get sortIndex() {\n    const connectionState = this.connectionState;\n    const state = CALL_STATE.CLOSED - connectionState + 1;\n    let index = state * 10000000000000;\n    index += 2147483647000 - (connectionState === CALL_STATE.PENDING && this.isOutgoing ? 0 : this.createdAt);\n    return index;\n  }\n\n  public getVideoElement(type: CallMediaState['type']) {\n    if(type === 'input') return this.elements.get('main');\n    else {\n      const mediaState = this.getMediaState('output');\n      if(!mediaState) {\n        return;\n      }\n\n      const type: WebRTCLineType = mediaState.videoState === 'active' ? 'video' : (mediaState.screencastState === 'active' ? 'screencast' : undefined);\n      if(!type) {\n        return;\n      }\n\n      const entry = this.description.findEntry((entry) => entry.type === type);\n      if(!entry) {\n        return;\n      }\n\n      return this.elements.get('' + entry.recvEntry.source);\n    }\n  }\n\n  public async startScreenSharingInternal() {\n    try {\n      this.wasStartingScreen = true;\n      this.wasStartingVideo = false;\n      this.streamManager.types = ['audio', 'screencast'];\n      await this.requestScreen();\n    } catch(err) {\n      this.log.error('startScreenSharing error', err);\n    }\n  }\n\n  public async toggleScreenSharing() {\n    if(this.isSharingVideo) {\n      await this.stopVideoSharing();\n    }\n\n    if(this.isSharingScreen) {\n      return this.stopVideoSharing();\n    } else {\n      return this.startScreenSharingInternal();\n    }\n  }\n\n  public async startVideoSharingInternal() {\n    try {\n      this.wasStartingScreen = false;\n      this.wasStartingVideo = true;\n      this.streamManager.types = ['audio', 'video'];\n      await this.requestInputSource(false, true, false);\n    } catch(err) {\n      this.log.error('startVideoSharing error', err);\n    }\n  }\n\n  public async stopVideoSharing() {\n    const mediaState = this.getMediaState('input');\n    mediaState.videoState = mediaState.screencastState = 'inactive';\n\n    const {streamManager, description} = this;\n    const track = streamManager.inputStream.getVideoTracks()[0];\n    if(track) {\n      stopTrack(track);\n      streamManager.appendToConference(description); // clear sender track\n    }\n  }\n\n  public async toggleVideoSharing() {\n    if(this.isSharingScreen) {\n      await this.stopVideoSharing();\n    }\n\n    if(this.isSharingVideo) {\n      return this.stopVideoSharing();\n    } else {\n      return this.startVideoSharingInternal();\n    }\n  }\n\n  public getMediaState(type: CallMediaState['type']) {\n    return this.mediaStates[type];\n  }\n\n  public setMediaState(mediaState: CallMediaState) {\n    this.mediaStates[mediaState.type] = mediaState;\n    this.dispatchEvent('mediaState', mediaState);\n  }\n\n  public isSharingVideoType(type: 'video' | 'screencast') {\n    try {\n      const hasVideoTrack = super.isSharingVideo;\n      return hasVideoTrack && !!((this.wasStartingScreen && type === 'screencast') || (this.wasStartingVideo && type === 'video'));\n\n      // ! it will be used before the track appears\n      // return !!this.description.entries.find((entry) => entry.type === type && entry.transceiver.sender.track.enabled);\n    } catch(err) {\n      return false;\n    }\n  }\n\n  public get isSharingVideo() {\n    return this.isSharingVideoType('video');\n  }\n\n  public get isSharingScreen() {\n    return this.isSharingVideoType('screencast');\n  }\n\n  public get isMuted() {\n    const audioTrack = this.streamManager.inputStream.getAudioTracks()[0];\n    return !audioTrack?.enabled;\n  }\n\n  public get isClosing() {\n    const {connectionState} = this;\n    return connectionState === CALL_STATE.CLOSING || connectionState === CALL_STATE.CLOSED;\n  }\n\n  public get description(): localConferenceDescription {\n    return this.connectionInstance?.description;\n  }\n\n  public setHangUpTimeout(timeout: number, reason: PhoneCallDiscardReason['_']) {\n    this.clearHangUpTimeout();\n    this.hangUpTimeout = ctx.setTimeout(() => {\n      this.hangUpTimeout = undefined;\n      this.hangUp(reason);\n    }, timeout);\n  }\n\n  public clearHangUpTimeout() {\n    if(this.hangUpTimeout !== undefined) {\n      clearTimeout(this.hangUpTimeout);\n      this.hangUpTimeout = undefined;\n    }\n  }\n\n  public setPhoneCall(phoneCall: PhoneCall) {\n    this.call = phoneCall;\n\n    const {id} = phoneCall;\n    if(this.id !== id) {\n      const prevId = this.id;\n      this.id = id;\n      this.dispatchEvent('id', id, prevId);\n    }\n  }\n\n  public async acceptCall() {\n    const canAccept = (await Promise.all(this.dispatchResultableEvent('acceptCallOverride')))[0] ?? true;\n    if(this.isClosing || !canAccept) {\n      return;\n    }\n\n    // this.clearHangUpTimeout();\n    this.overrideConnectionState(CALL_STATE.EXCHANGING_KEYS);\n\n    const call = this.call as PhoneCall.phoneCallRequested;\n    this.requestInputSource(true, !!call.pFlags.video, false);\n\n    const g_a_hash = call.g_a_hash;\n    this.managers.appCallsManager.generateDh().then(async(dh) => {\n      this.dh = { // ! it is correct\n        g_a_hash,\n        b: dh.a,\n        g_b: dh.g_a,\n        g_b_hash: dh.g_a_hash,\n        p: dh.p\n      };\n\n      return this.managers.apiManager.invokeApi('phone.acceptCall', {\n        peer: await this.managers.appCallsManager.getCallInput(this.id),\n        protocol: this.protocol,\n        g_b: this.dh.g_b\n      });\n    }).then(async(phonePhoneCall) => {\n      await this.managers.appCallsManager.savePhonePhoneCall(phonePhoneCall);\n    }).catch((err) => {\n      this.log.error('accept call error', err);\n      // if(err.type === 'CALL_PROTOCOL_COMPAT_LAYER_INVALID') {\n\n      // }\n\n      this.hangUp('phoneCallDiscardReasonHangup');\n    });\n  }\n\n  public joinCall() {\n    this.log('joinCall');\n\n    this.getEmojisFingerprint();\n\n    this.overrideConnectionState();\n\n    const {isOutgoing, encryptionKey, streamManager} = this;\n\n    const configuration = getRtcConfiguration(this.call as PhoneCall.phoneCall);\n    this.log('joinCall configuration', configuration);\n    if(!configuration) return;\n\n    const connectionInstance = this.connectionInstance = new CallConnectionInstance({\n      call: this,\n      streamManager,\n      log: this.log.bindPrefix('connection')\n    });\n\n    const connection = connectionInstance.createPeerConnection(configuration);\n    connection.addEventListener('iceconnectionstatechange', () => {\n      const state = this.connectionState;\n      if(this.connectedAt === undefined && state === CALL_STATE.CONNECTED) {\n        this.connectedAt = Date.now();\n      }\n\n      this.dispatchEvent('state', state);\n    });\n    connection.addEventListener('negotiationneeded', () => {\n      connectionInstance.negotiate();\n    });\n    connection.addEventListener('icecandidate', (event) => {\n      const {candidate} = event;\n      connection.log('onicecandidate', candidate);\n      if(candidate?.candidate) {\n        this.sendIceCandidate(candidate);\n      }\n    });\n    connection.addEventListener('track', (event) => {\n      const {track} = event;\n      connection.log('ontrack', track);\n      this.onTrack(event);\n    });\n\n    const description = connectionInstance.createDescription();\n\n    this.encryptor = new P2PEncryptor(isOutgoing, encryptionKey);\n    this.decryptor = new P2PEncryptor(!isOutgoing, encryptionKey);\n\n    this.log('currentCall', this);\n\n    if(isOutgoing) {\n      connectionInstance.appendStreamToConference();\n    }\n\n    this.createDataChannel();\n\n    this.processDecryptQueue();\n  }\n\n  private createDataChannelEntry() {\n    const dataChannelEntry = this.description.createEntry('application');\n    dataChannelEntry.setDirection('sendrecv');\n    dataChannelEntry.sendEntry = dataChannelEntry.recvEntry = dataChannelEntry;\n  }\n\n  private createDataChannel() {\n    if(this.connectionInstance.dataChannel) {\n      return;\n    }\n\n    const channel = this.connectionInstance.createDataChannel({\n      id: 0,\n      negotiated: true\n    });\n    channel.addEventListener('message', (e) => {\n      this.applyDataChannelData(JSON.parse(e.data));\n    });\n    channel.addEventListener('open', () => {\n      this.sendMediaState();\n    });\n  }\n\n  private applyDataChannelData(data: CallMediaState) {\n    switch(data['@type']) {\n      case 'MediaState': {\n        data.type = 'output';\n        this.log('got output media state', data);\n        this.setMediaState(data);\n        break;\n      }\n\n      default:\n        this.log.error('unknown data channel data:', data);\n        break;\n    }\n  }\n\n  private _sendMediaState() {\n    const {connectionInstance} = this;\n    if(!connectionInstance) return;\n\n    const mediaState = {...this.getMediaState('input')};\n    // mediaState.videoRotation = 90;\n    delete mediaState.type;\n    this.log('sendMediaState', mediaState);\n\n    connectionInstance.sendDataChannelData(mediaState);\n  }\n\n  public async sendCallSignalingData(data: CallSignalingData) {\n    /* if(data['@type'] === 'InitialSetup') {\n      this.filterNotVP8(data);\n    } */\n\n    const json = JSON.stringify(data);\n    const arr = new TextEncoder().encode(json);\n    const {bytes} = await this.encryptor.encryptRawPacket(arr);\n\n    this.log('sendCallSignalingData', this.id, json);\n    await this.managers.apiManager.invokeApi('phone.sendSignalingData', {\n      peer: await this.managers.appCallsManager.getCallInput(this.id),\n      data: bytes\n    });\n  }\n\n  public sendIceCandidate(iceCandidate: RTCIceCandidate) {\n    this.log('sendIceCandidate', iceCandidate);\n    const {candidate, sdpMLineIndex} = iceCandidate;\n    if(sdpMLineIndex !== 0) {\n      return;\n    }\n\n    const parsed = p2pParseCandidate(candidate);\n    // const parsed = {sdpString: candidate};\n    /* if(parsed.address.ip !== '') {\n      return;\n    } */\n\n    this.sendCallSignalingData({\n      '@type': 'Candidates',\n      'candidates': [parsed]\n    });\n  }\n\n  public async confirmCall() {\n    const {protocol, id, call} = this;\n    const dh = this.dh as DiffieHellmanInfo.a;\n\n    // this.clearHangUpTimeout();\n    this.overrideConnectionState(CALL_STATE.EXCHANGING_KEYS);\n    const {key, key_fingerprint} = await this.managers.appCallsManager.computeKey((call as PhoneCall.phoneCallAccepted).g_b, dh.a, dh.p);\n\n    const phonePhoneCall = await this.managers.apiManager.invokeApi('phone.confirmCall', {\n      peer: await this.managers.appCallsManager.getCallInput(id),\n      protocol: protocol,\n      g_a: dh.g_a,\n      key_fingerprint: key_fingerprint\n    });\n\n    this.encryptionKey = key;\n    await this.managers.appCallsManager.savePhonePhoneCall(phonePhoneCall);\n    this.joinCall();\n  }\n\n  public getEmojisFingerprint() {\n    if(this.emojisFingerprint) return this.emojisFingerprint;\n    if(this.getEmojisFingerprintPromise) return this.getEmojisFingerprintPromise;\n    return this.getEmojisFingerprintPromise = apiManagerProxy.invokeCrypto('get-emojis-fingerprint', this.encryptionKey, this.dh.g_a).then((codePoints) => {\n      this.getEmojisFingerprintPromise = undefined;\n      return this.emojisFingerprint = codePoints.map((codePoints) => emojiFromCodePoints(codePoints)) as [string, string, string, string];\n    });\n  }\n\n  private unlockStreamManager() {\n    this.connectionInstance.streamManager.locked = false;\n    this.connectionInstance.appendStreamToConference();\n  }\n\n  private async doTheMagic() {\n    this.connectionInstance.appendStreamToConference();\n\n    const connection = this.connectionInstance.connection;\n\n    let answer = await connection.createAnswer();\n\n    this.log('[sdp] local', answer.type, answer.sdp);\n    await connection.setLocalDescription(answer);\n\n    connection.getTransceivers().filter((transceiver) => transceiver.direction === 'recvonly').forEach((transceiver) => {\n      const entry = this.connectionInstance.description.getEntryByMid(transceiver.mid);\n      entry.transceiver = entry.recvEntry.transceiver = transceiver;\n      transceiver.direction = 'sendrecv';\n    });\n\n    const isAnswer = false;\n\n    const description = this.description;\n    const bundle = description.entries.map((entry) => entry.mid);\n    const sdpDescription: RTCSessionDescriptionInit = {\n      type: isAnswer ? 'answer' : 'offer',\n      sdp: description.generateSdp({\n        bundle,\n        entries: description.entries.filter((entry) => bundle.includes(entry.mid)),\n        // isAnswer: isAnswer\n        isAnswer: !isAnswer\n      })\n    };\n\n    await connection.setRemoteDescription(sdpDescription);\n\n    answer = await connection.createAnswer();\n\n    await connection.setLocalDescription(answer);\n\n    const initialSetup = parseSignalingData(parseSdp(answer.sdp));\n    this.log('[InitialSetup] send 1');\n    this.sendCallSignalingData(initialSetup);\n\n    this.unlockStreamManager();\n  }\n\n  public overrideConnectionState(state?: CALL_STATE) {\n    this._connectionState = state;\n    this.dispatchEvent('state', this.connectionState);\n  }\n\n  public get duration() {\n    return this.connectedAt !== undefined ? (Date.now() - this.connectedAt) / 1000 | 0 : 0;\n  }\n\n  protected onInputStream(stream: MediaStream): void {\n    super.onInputStream(stream);\n\n    const videoTrack = stream.getVideoTracks()[0];\n    if(videoTrack) {\n      const state = this.getMediaState('input');\n\n      // handle starting camera\n      if(!this.wasStartingScreen && !this.wasStartingVideo) {\n        this.wasStartingVideo = true;\n      }\n\n      if(this.isSharingVideo) {\n        state.videoState = 'active';\n      } else if(this.isSharingScreen) {\n        state.screencastState = 'active';\n      }\n\n      videoTrack.addEventListener('ended', () => {\n        this.stopVideoSharing();\n      }, {once: true});\n    }\n\n    if(stream.getAudioTracks().length) {\n      this.onMutedChange();\n    }\n  }\n\n  private onMutedChange() {\n    const isMuted = this.isMuted;\n    this.dispatchEvent('muted', isMuted);\n\n    const state = this.getMediaState('input');\n    state.muted = isMuted;\n  }\n\n  public toggleMuted(): Promise<void> {\n    return this.requestAudioSource(true).then(() => {\n      this.setMuted();\n      this.onMutedChange();\n    });\n  }\n\n  public async hangUp(discardReason?: PhoneCallDiscardReason['_'], discardedByOtherParty?: boolean) {\n    if(this.isClosing) {\n      return;\n    }\n\n    this.discardReason = discardReason;\n    this.log('hangUp', discardReason);\n    this.overrideConnectionState(CALL_STATE.CLOSED);\n\n    if(this.connectionInstance) {\n      this.connectionInstance.closeConnectionAndStream(true);\n    }\n\n    if(discardReason && !discardedByOtherParty) {\n      let hasVideo = false;\n      for(const type in this.mediaStates) {\n        const mediaState = this.mediaStates[type as 'input' | 'output'];\n        hasVideo = mediaState.videoState === 'active' || mediaState.screencastState === 'active' || hasVideo;\n      }\n\n      await this.managers.appCallsManager.discardCall(this.id, this.duration, discardReason, hasVideo);\n    }\n  }\n\n  private performCodec(_codec: P2PAudioCodec | P2PVideoCodec) {\n    const payloadTypes: AudioCodec['payload-types'] = _codec.payloadTypes.map((payloadType) => {\n      return {\n        ...payloadType,\n        'rtcp-fbs': payloadType.feedbackTypes\n      }\n    });\n\n    const codec: AudioCodec = {\n      'rtp-hdrexts': _codec.rtpExtensions,\n      'payload-types': payloadTypes\n    };\n\n    return codec;\n  }\n\n  private setDataToDescription(data: CallSignalingData.initialSetup) {\n    this.description.setData({\n      transport: {\n        'pwd': data.pwd,\n        'ufrag': data.ufrag,\n        'fingerprints': data.fingerprints,\n        'rtcp-mux': true\n      },\n      audio: this.performCodec(data.audio),\n      video: data.video ? this.performCodec(data.video) as VideoCodec : undefined,\n      screencast: data.screencast ? this.performCodec(data.screencast) as VideoCodec : undefined\n    });\n  }\n\n  private filterNotVP8(initialSetup: CallSignalingData.initialSetup) {\n    if(!this.isOutgoing) { // only VP8 works now\n      [initialSetup.video, initialSetup.screencast].filter(Boolean).forEach((codec) => {\n        const payloadTypes = codec.payloadTypes;\n        const idx = payloadTypes.findIndex((payloadType) => payloadType.name === 'VP8');\n        const vp8PayloadType = payloadTypes[idx];\n        const rtxIdx = payloadTypes.findIndex((payloadType) => +payloadType.parameters?.apt === vp8PayloadType.id);\n        codec.payloadTypes = [payloadTypes[idx], payloadTypes[rtxIdx]];\n      });\n    }\n  }\n\n  public async applyCallSignalingData(data: CallSignalingData) {\n    this.log('applyCallSignalingData', this, data);\n\n    const {connection, description} = this.connectionInstance;\n\n    switch(data['@type']) {\n      case 'InitialSetup': {\n        this.log('[sdp] InitialSetup', data);\n\n        this.filterNotVP8(data);\n        this.setDataToDescription(data);\n\n        const performSsrcGroups = (ssrcGroups: P2PVideoCodec['ssrcGroups']): GroupCallParticipantVideoSourceGroup[] => {\n          return ssrcGroups.map((ssrcGroup) => {\n            return {\n              _: 'groupCallParticipantVideoSourceGroup',\n              semantics: ssrcGroup.semantics,\n              sources: ssrcGroup.ssrcs.map((source) => +source)\n            };\n          });\n        };\n\n        const ssrcs = [\n          generateSsrc('audio', +data.audio.ssrc),\n          data.video ? generateSsrc('video', performSsrcGroups(data.video.ssrcGroups)) : undefined,\n          data.screencast ? generateSsrc('screencast', performSsrcGroups(data.screencast.ssrcGroups)) : undefined\n        ].filter(Boolean);\n\n        ssrcs.forEach((ssrc) => {\n          let entry = description.getEntryBySource(ssrc.source);\n          if(entry) {\n            return;\n          }\n\n          const sendRecvEntry = description.findFreeSendRecvEntry(ssrc.type, false);\n          entry = new ConferenceEntry(sendRecvEntry.mid, ssrc.type);\n          entry.setDirection('sendrecv');\n          sendRecvEntry.recvEntry = entry;\n\n          description.setEntrySource(entry, ssrc.sourceGroups || ssrc.source);\n        });\n\n        this.createDataChannelEntry();\n\n        const isAnswer = this.offerSent;\n        this.offerSent = false;\n\n        const bundle = description.entries.map((entry) => entry.mid);\n        const sdpDescription: RTCSessionDescriptionInit = {\n          type: isAnswer ? 'answer' : 'offer',\n          sdp: description.generateSdp({\n            bundle,\n            entries: description.entries.filter((entry) => bundle.includes(entry.mid)),\n            // isAnswer: isAnswer\n            isAnswer: !isAnswer\n          })\n        };\n\n        this.log('[sdp] remote', sdpDescription.sdp);\n\n        await connection.setRemoteDescription(sdpDescription);\n\n        await this.tryToReleaseCandidates();\n\n        if(!isAnswer) {\n          await this.doTheMagic();\n        }\n\n        break;\n      }\n\n      case 'Candidates': {\n        for(const candidate of data.candidates) {\n          const init: RTCIceCandidateInit = P2PSdpBuilder.generateCandidate(candidate);\n          init.sdpMLineIndex = 0;\n          const iceCandidate = new RTCIceCandidate(init);\n          this.candidates.push(iceCandidate);\n        }\n\n        await this.tryToReleaseCandidates();\n        break;\n      }\n\n      default: {\n        this.log.error('unrecognized signaling data', data);\n      }\n    }\n  }\n\n  public async tryToReleaseCandidates() {\n    const {connectionInstance} = this;\n    if(!connectionInstance) {\n      return;\n    }\n\n    const {connection} = connectionInstance;\n    if(connection.remoteDescription) {\n      const promises: Promise<void>[] = this.candidates.map((candidate) => this.addIceCandidate(connection, candidate));\n      this.candidates.length = 0;\n\n      await Promise.all(promises);\n    } else {\n      this.log('[candidates] postpone');\n    }\n  }\n\n  private async addIceCandidate(connection: RTCPeerConnection, candidate: RTCIceCandidate) {\n    this.log('[candidate] start', candidate);\n    try {\n      // if(!candidate.address) return;\n      await connection.addIceCandidate(candidate);\n      this.log('[candidate] add', candidate);\n    } catch(e) {\n      this.log.error('[candidate] error', candidate, e);\n    }\n  }\n\n  private async processDecryptQueue() {\n    const {encryptor} = this;\n    if(!encryptor) {\n      this.log.warn('got encrypted signaling data before the encryption key');\n      return;\n    }\n\n    const length = this.decryptQueue.length;\n    if(!length) {\n      return;\n    }\n\n    const queue = this.decryptQueue.slice();\n    this.decryptQueue.length = 0;\n\n    for(const data of queue) {\n      const decryptedData = await encryptor.decryptRawPacket(data);\n      if(!decryptedData) {\n        continue;\n      }\n\n      // this.log('[update] updateNewCallSignalingData', update, decryptedData);\n\n      const str = new TextDecoder().decode(decryptedData);\n      try {\n        const signalingData: CallSignalingData = JSON.parse(str);\n        this.log('[update] updateNewCallSignalingData', signalingData);\n        this.applyCallSignalingData(signalingData);\n      } catch(err) {\n        this.log.error('wrong signaling data', str);\n        this.hangUp('phoneCallDiscardReasonDisconnect');\n        callsController.dispatchEvent('incompatible', this.interlocutorUserId);\n      }\n    }\n  }\n\n  public onUpdatePhoneCallSignalingData(data: Uint8Array) {\n    this.decryptQueue.push(data);\n    this.processDecryptQueue();\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n *\n * Originally from:\n * https://github.com/evgeny-nadymov/telegram-react\n * Copyright (C) 2018 Evgeny Nadymov\n * https://github.com/evgeny-nadymov/telegram-react/blob/master/LICENSE\n */\n\nimport {PhoneCallProtocol} from '../../../layer';\n\nexport default function getCallProtocol(): PhoneCallProtocol {\n  return {\n    _: 'phoneCallProtocol',\n    pFlags: {\n      udp_p2p: true,\n      udp_reflector: true\n    },\n    min_layer: 92,\n    max_layer: 92,\n    library_versions: ['4.0.0']\n  };\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n *\n * Originally from:\n * https://github.com/evgeny-nadymov/telegram-react\n * Copyright (C) 2018 Evgeny Nadymov\n * https://github.com/evgeny-nadymov/telegram-react/blob/master/LICENSE\n */\n\nimport {PhoneCall} from '../../../layer';\n\nexport default function getRtcConfiguration(call: PhoneCall.phoneCall): RTCConfiguration {\n  const iceServers: RTCIceServer[] = [];\n  call.connections.forEach((connection) => {\n    switch(connection._) {\n      /* case 'callServerTypeTelegramReflector': {\n        break;\n      } */\n      case 'phoneConnectionWebrtc': {\n        const {ip, ipv6, port, username, password} = connection;\n        const urls: string[] = [];\n        if(connection.pFlags.turn) {\n          if(ip) {\n            urls.push(`turn:${ip}:${port}`);\n          }\n          if(ipv6) {\n            urls.push(`turn:[${ipv6}]:${port}`);\n          }\n        } else if(connection.pFlags.stun) {\n          if(ip) {\n            urls.push(`stun:${ip}:${port}`);\n          }\n          if(ipv6) {\n            urls.push(`stun:[${ipv6}]:${port}`);\n          }\n        }\n\n        if(urls.length > 0) {\n          iceServers.push({\n            urls,\n            username,\n            credential: password\n          });\n        }\n        break;\n      }\n    }\n  });\n\n  return {\n    iceServers,\n    iceTransportPolicy: call.pFlags.p2p_allowed ? 'all' : 'relay'\n  };\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport getScreenStream from './getScreenStream';\nimport getStream from './getStream';\n\n/**\n * ! Use multiple constraints together only with first invoke\n */\nexport default function getStreamCached() {\n  const _cache: {\n    main: Partial<{\n      audio: Promise<MediaStream>,\n      video: Promise<MediaStream>\n    }>,\n    screen: Partial<{\n      audio: Promise<MediaStream>,\n      video: Promise<MediaStream>\n    }>\n  } = {\n    main: {},\n    screen: {}\n  };\n\n  return async(options: {\n    isScreen: true,\n    constraints: DisplayMediaStreamConstraints,\n  } | {\n    isScreen?: false,\n    constraints: MediaStreamConstraints,\n    muted: boolean\n  }) => {\n    const {isScreen, constraints} = options;\n    const cache = _cache[isScreen ? 'screen' : 'main'];\n    let promise: Promise<MediaStream> = cache[constraints.audio ? 'audio' : 'video'];\n\n    if(!promise) {\n      promise = (isScreen ? getScreenStream : getStream)(constraints, (options as any).muted);\n      if(constraints.audio && !cache.audio) cache.audio = promise.finally(() => cache.audio = undefined);\n      if(constraints.video && !cache.video) cache.video = promise.finally(() => cache.video = undefined);\n    }\n\n    try {\n      return await promise;\n      /* let out: Partial<{\n        audio: MediaStream,\n        video: MediaStream\n      }> = {};\n\n      await Promise.all([\n        constraints.audio && cache.audio.then((stream) => out.audio = stream),\n        constraints.video && cache.video.then((stream) => out.video = stream)\n      ].filter(Boolean));\n\n      return out; */\n    } catch(err) {\n      throw err;\n    }\n  };\n}\n\n(window as any).getStreamCached = getStreamCached;\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport EventListenerBase, {EventListenerListeners} from '../../helpers/eventListenerBase';\nimport noop from '../../helpers/noop';\nimport {logger} from '../logger';\nimport getAudioConstraints from './helpers/getAudioConstraints';\nimport getScreenConstraints from './helpers/getScreenConstraints';\nimport getStreamCached from './helpers/getStreamCached';\nimport getVideoConstraints from './helpers/getVideoConstraints';\nimport stopTrack from './helpers/stopTrack';\nimport LocalConferenceDescription from './localConferenceDescription';\nimport StreamManager, {StreamItem} from './streamManager';\n\nexport type TryAddTrackOptions = {\n  stream: MediaStream,\n  track: MediaStreamTrack,\n  type: StreamItem['type'],\n  source?: string\n};\n\nexport default abstract class CallInstanceBase<E extends EventListenerListeners> extends EventListenerBase<E> {\n  protected log: ReturnType<typeof logger>;\n  protected outputDeviceId: string;\n\n  protected player: HTMLElement;\n  protected elements: Map<string, HTMLMediaElement>;\n\n  protected audio: HTMLAudioElement;\n  // protected fixedSafariAudio: boolean;\n\n  protected getStream: ReturnType<typeof getStreamCached>;\n\n  constructor() {\n    super(false);\n\n    const player = this.player = document.createElement('div');\n    player.classList.add('call-player');\n    player.style.display = 'none';\n    document.body.append(player);\n\n    this.elements = new Map();\n\n    // possible Safari fix\n    const audio = this.audio = new Audio();\n    audio.autoplay = true;\n    audio.volume = 1.0;\n    this.player.append(audio);\n    this.elements.set('audio', audio);\n\n    this.fixSafariAudio();\n\n    this.getStream = getStreamCached();\n  }\n\n  public get isSharingAudio() {\n    return !!this.streamManager.hasInputTrackKind('audio');\n  }\n\n  public get isSharingVideo() {\n    return !!this.streamManager.hasInputTrackKind('video');\n  }\n\n  public abstract get isMuted(): boolean;\n  public abstract get isClosing(): boolean;\n\n  public fixSafariAudio() {\n    // if(this.fixedSafariAudio) return;\n    this.audio.play().catch(noop);\n    // this.fixedSafariAudio = true;\n  }\n\n  public requestAudioSource(muted: boolean) {\n    return this.requestInputSource(true, false, muted);\n  }\n\n  public requestInputSource(audio: boolean, video: boolean, muted: boolean) {\n    const {streamManager} = this;\n    if(streamManager) {\n      const isAudioGood = !audio || this.isSharingAudio;\n      const isVideoGood = !video || this.isSharingVideo;\n      if(isAudioGood && isVideoGood) {\n        return Promise.resolve();\n      }\n    }\n\n    const constraints: MediaStreamConstraints = {\n      audio: audio && getAudioConstraints(),\n      video: video && getVideoConstraints()\n    };\n\n    return this.getStream({\n      constraints,\n      muted\n    }).then((stream) => {\n      this.onInputStream(stream);\n    });\n  }\n\n  public requestScreen() {\n    return this.getStream({\n      isScreen: true,\n      constraints: getScreenConstraints(true)\n    }).then((stream) => {\n      this.onInputStream(stream);\n    });\n  }\n\n  public getElement(endpoint: number | string) {\n    return this.elements.get('' + endpoint);\n  }\n\n  public abstract get streamManager(): StreamManager;\n  public abstract get description(): LocalConferenceDescription;\n  public abstract toggleMuted(): Promise<void>;\n\n  public cleanup() {\n    this.player.textContent = '';\n    this.player.remove();\n    this.elements.clear();\n\n    // can have no connectionInstance but streamManager with input stream\n    this.streamManager.stop();\n\n    super.cleanup();\n  }\n\n  public onTrack(event: RTCTrackEvent) {\n    this.tryAddTrack({\n      stream: event.streams[0],\n      track: event.track,\n      type: 'output'\n    });\n  }\n\n  public saveInputVideoStream(stream: MediaStream, type?: string) {\n    const track = stream.getVideoTracks()[0];\n    this.tryAddTrack({\n      stream,\n      track,\n      type: 'input',\n      source: type || 'main'\n    });\n  }\n\n  public tryAddTrack({stream, track, type, source}: TryAddTrackOptions) {\n    if(!source) {\n      source = StreamManager.getSource(stream, type);\n    }\n\n    this.log('tryAddTrack', stream, track, type, source);\n\n    const isOutput = type === 'output';\n\n    const {player, elements, streamManager} = this;\n\n    const tagName = track.kind as StreamItem['kind'];\n    const isVideo = tagName === 'video';\n\n    const elementEndpoint = isVideo ? source : tagName;\n    let element = elements.get(elementEndpoint);\n\n    if(isVideo) {\n      track.addEventListener('ended', () => {\n        this.log('[track] onended');\n        elements.delete(elementEndpoint);\n        // element.remove();\n      }, {once: true});\n    }\n\n    if(isOutput) {\n      streamManager.addTrack(stream, track, type);\n    }\n\n    const useStream = isVideo ? stream : streamManager.outputStream;\n    if(!element) {\n      element = document.createElement(tagName);\n      element.autoplay = true;\n      element.srcObject = useStream;\n      element.volume = 1.0;\n\n      if((element as any).sinkId !== 'undefined') {\n        const {outputDeviceId} = this;\n        if(outputDeviceId) {\n          (element as any).setSinkId(outputDeviceId);\n        }\n      }\n\n      if(!isVideo) {\n        player.appendChild(element);\n      } else {\n        element.setAttribute('playsinline', 'true');\n        element.muted = true;\n      }\n      // audio.play();\n\n      elements.set(elementEndpoint, element);\n    } else {\n      if(element.paused) {\n        element.play().catch(noop);\n      }\n\n      // ! EVEN IF MEDIASTREAM IS THE SAME NEW TRACK WON'T PLAY WITHOUT REPLACING IT WHEN NEW PARTICIPANT IS ENTERING !\n      // if(element.srcObject !== useStream) {\n      element.srcObject = useStream;\n      // }\n    }\n\n    return source;\n  }\n\n  public setMuted(muted?: boolean) {\n    this.streamManager.inputStream.getAudioTracks().forEach((track) => {\n      if(track?.kind === 'audio') {\n        track.enabled = muted === undefined ? !track.enabled : !muted;\n      }\n    });\n  }\n\n  protected onInputStream(stream: MediaStream): void {\n    if(!this.isClosing) {\n      const videoTracks = stream.getVideoTracks();\n      if(videoTracks.length) {\n        this.saveInputVideoStream(stream, 'main');\n      }\n\n      const {streamManager, description} = this;\n      streamManager.addStream(stream, 'input');\n\n      if(description) {\n        streamManager.appendToConference(description);\n      }\n    } else { // if call is declined earlier than stream appears\n      stream.getTracks().forEach((track) => {\n        stopTrack(track);\n      });\n    }\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nenum CALL_STATE {\n  CONNECTED,\n  CONNECTING,\n  EXCHANGING_KEYS,\n  PENDING,\n  REQUESTING,\n  CLOSING,\n  CLOSED\n}\n\nexport default CALL_STATE;\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport AudioAssetPlayer from '../../helpers/audioAssetPlayer';\r\n\r\nexport type CallAudioAssetName = 'call_busy.mp3' | 'call_connect.mp3' | 'call_end.mp3' | 'call_incoming.mp3' | 'call_outgoing.mp3' | 'voip_failed.mp3' | 'voip_connecting.mp3';\r\n\r\nlet audioAsset: AudioAssetPlayer<CallAudioAssetName>;\r\nexport default function getCallAudioAsset() {\r\n  return audioAsset ??= new AudioAssetPlayer([\r\n    'call_busy.mp3',\r\n    'call_connect.mp3',\r\n    'call_end.mp3',\r\n    'call_incoming.mp3',\r\n    'call_outgoing.mp3',\r\n    'voip_failed.mp3'\r\n  ]);\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport getCallAudioAsset, {CallAudioAssetName} from '../../components/call/getAudioAsset';\r\nimport {MOUNT_CLASS_TO} from '../../config/debug';\r\nimport IS_CALL_SUPPORTED from '../../environment/callSupport';\r\nimport indexOfAndSplice from '../../helpers/array/indexOfAndSplice';\r\nimport insertInDescendSortedArray from '../../helpers/array/insertInDescendSortedArray';\r\nimport AudioAssetPlayer from '../../helpers/audioAssetPlayer';\r\nimport bytesCmp from '../../helpers/bytes/bytesCmp';\r\nimport EventListenerBase from '../../helpers/eventListenerBase';\r\nimport tsNow from '../../helpers/tsNow';\r\nimport {PhoneCallProtocol} from '../../layer';\r\nimport {CallId} from '../appManagers/appCallsManager';\r\nimport {AppManagers} from '../appManagers/managers';\r\nimport {logger} from '../logger';\r\nimport apiManagerProxy from '../mtproto/mtprotoworker';\r\nimport {NULL_PEER_ID} from '../mtproto/mtproto_config';\r\nimport rootScope from '../rootScope';\r\nimport CallInstance from './callInstance';\r\nimport CALL_STATE from './callState';\r\n\r\nconst CALL_REQUEST_TIMEOUT = 45e3;\r\n\r\nexport class CallsController extends EventListenerBase<{\r\n  instance: (details: {hasCurrent: boolean, instance: CallInstance}) => void,\r\n  accepting: (instance: CallInstance) => void, //  .    ,     topbarCall\r\n  incompatible: (userId: UserId) => void,\r\n}> {\r\n  private log: ReturnType<typeof logger>;\r\n  private managers: AppManagers;\r\n  private audioAsset: AudioAssetPlayer<CallAudioAssetName>;\r\n  private instances: Map<CallId, CallInstance>;\r\n  private sortedInstances: Array<CallInstance>;\r\n  private tempId: number;\r\n\r\n  public construct(managers: AppManagers) {\r\n    this.managers = managers;\r\n    this.log = logger('CC');\r\n\r\n    if(!IS_CALL_SUPPORTED) {\r\n      return;\r\n    }\r\n\r\n    this.audioAsset = getCallAudioAsset();\r\n    this.tempId = 0;\r\n    this.instances = new Map();\r\n    this.sortedInstances = [];\r\n\r\n    rootScope.addEventListener('call_update', async(call) => {\r\n      let instance = this.instances.get(call.id);\r\n\r\n      if(instance) {\r\n        instance.setPhoneCall(call);\r\n      }\r\n\r\n      switch(call._) {\r\n        case 'phoneCallDiscarded': {\r\n          if(instance) {\r\n            instance.hangUp(call.reason?._, true);\r\n          }\r\n\r\n          break;\r\n        }\r\n\r\n        case 'phoneCallAccepted': {\r\n          if(instance) {\r\n            /* if(!this.verifyProtocolCompatibility(call.protocol)) {\r\n              instance.hangUp('phoneCallDiscardReasonDisconnect');\r\n              rootScope.dispatchEvent('call_incompatible', instance.interlocutorUserId);\r\n              break;\r\n            } */\r\n\r\n            instance.confirmCall();\r\n          }\r\n\r\n          break;\r\n        }\r\n\r\n        case 'phoneCallRequested': {\r\n          if(!instance) {\r\n            /* if(!this.verifyProtocolCompatibility(call.protocol)) {\r\n              rootScope.dispatchEvent('call_incompatible', call.admin_id);\r\n              break;\r\n            } */\r\n\r\n            instance = this.createCallInstance({\r\n              isOutgoing: false,\r\n              interlocutorUserId: call.admin_id\r\n            });\r\n\r\n            instance.overrideConnectionState(CALL_STATE.PENDING);\r\n            instance.setPhoneCall(call);\r\n            instance.setHangUpTimeout(CALL_REQUEST_TIMEOUT, 'phoneCallDiscardReasonMissed');\r\n          }\r\n\r\n          break;\r\n        }\r\n\r\n        case 'phoneCall': {\r\n          if(!instance || instance.encryptionKey) {\r\n            break;\r\n          }\r\n\r\n          const g_a = instance.dh.g_a = call.g_a_or_b;\r\n          const dh = instance.dh;\r\n          const g_a_hash = await apiManagerProxy.invokeCrypto('sha256', g_a);\r\n          if(!bytesCmp(dh.g_a_hash, g_a_hash)) {\r\n            this.log.error('Incorrect g_a_hash', dh.g_a_hash, g_a_hash);\r\n            break;\r\n          }\r\n\r\n          const {key, key_fingerprint} = await this.managers.appCallsManager.computeKey(g_a, dh.b, dh.p);\r\n          if(call.key_fingerprint !== key_fingerprint) {\r\n            this.log.error('Incorrect key fingerprint', call.key_fingerprint, key_fingerprint, g_a, dh);\r\n            instance.hangUp('phoneCallDiscardReasonDisconnect');\r\n            break;\r\n          }\r\n\r\n          instance.encryptionKey = key;\r\n          instance.joinCall();\r\n\r\n          break;\r\n        }\r\n      }\r\n    });\r\n\r\n    rootScope.addEventListener('call_signaling', ({callId, data}) => {\r\n      const instance = this.instances.get(callId);\r\n      if(instance?.id !== callId) {\r\n        return;\r\n      }\r\n\r\n      instance.onUpdatePhoneCallSignalingData(data);\r\n    });\r\n  }\r\n\r\n  public get currentCall() {\r\n    return this.sortedInstances[0];\r\n  }\r\n\r\n  public getCallByUserId(userId: UserId) {\r\n    for(const [callId, instance] of this.instances) {\r\n      if(instance.interlocutorUserId === userId) {\r\n        return instance;\r\n      }\r\n    }\r\n  }\r\n\r\n  private createCallInstance(options: {\r\n    isOutgoing: boolean,\r\n    interlocutorUserId: UserId,\r\n    protocol?: PhoneCallProtocol\r\n  }) {\r\n    const call = new CallInstance({\r\n      managers: this.managers,\r\n      ...options\r\n    });\r\n\r\n    call.addEventListener('state', (state) => {\r\n      const currentCall = this.currentCall;\r\n      if(state === CALL_STATE.CLOSED) {\r\n        this.instances.delete(call.id);\r\n        indexOfAndSplice(this.sortedInstances, call);\r\n      } else {\r\n        insertInDescendSortedArray(this.sortedInstances, call, 'sortIndex');\r\n      }\r\n\r\n      if(state === CALL_STATE.EXCHANGING_KEYS) {\r\n        call.wasTryingToJoin = true;\r\n      }\r\n\r\n      const hasConnected = call.connectedAt !== undefined;\r\n      if(state === CALL_STATE.EXCHANGING_KEYS || (state === CALL_STATE.CONNECTING && hasConnected)) {\r\n        call.setHangUpTimeout(CALL_REQUEST_TIMEOUT, 'phoneCallDiscardReasonDisconnect');\r\n      } else {\r\n        call.clearHangUpTimeout();\r\n      }\r\n\r\n      if(currentCall === call || !currentCall) {\r\n        if(state === CALL_STATE.CLOSED) {\r\n          if(!call.isOutgoing && !call.wasTryingToJoin) { // incoming call has been accepted on other device or ended\r\n            this.audioAsset.stopSound();\r\n          } else if(call.wasTryingToJoin && !hasConnected) { // something has happened during the key exchanging\r\n            this.audioAsset.playSound('voip_failed.mp3');\r\n          } else {\r\n            this.audioAsset.playSound(call.discardReason === 'phoneCallDiscardReasonBusy' ? 'call_busy.mp3' : 'call_end.mp3');\r\n          }\r\n        } else if(state === CALL_STATE.PENDING) {\r\n          this.audioAsset.playSound(call.isOutgoing ? 'call_outgoing.mp3' : 'call_incoming.mp3', true);\r\n        } else if(state === CALL_STATE.EXCHANGING_KEYS) {\r\n          this.audioAsset.playSoundIfDifferent('call_connect.mp3');\r\n        } else if(state === CALL_STATE.CONNECTING) {\r\n          if(call.duration) {\r\n            this.audioAsset.playSound('voip_connecting.mp3', true);\r\n          }\r\n        } else {\r\n          this.audioAsset.stopSound();\r\n        }\r\n      }\r\n    });\r\n\r\n    call.addEventListener('id', (id, prevId) => {\r\n      if(prevId !== undefined) {\r\n        this.instances.delete(prevId);\r\n      }\r\n\r\n      const hasCurrent = !!this.currentCall;\r\n      this.instances.set(id, call);\r\n\r\n      if(prevId === undefined) {\r\n        this.dispatchEvent('instance', {instance: call, hasCurrent: hasCurrent});\r\n      }\r\n    });\r\n\r\n    return call;\r\n  }\r\n\r\n  public async startCallInternal(userId: UserId, isVideo: boolean) {\r\n    this.log('p2pStartCallInternal', userId, isVideo);\r\n\r\n    const fullInfo = await this.managers.appProfileManager.getProfile(userId);\r\n    if(!fullInfo) return;\r\n\r\n    const {video_calls_available} = fullInfo.pFlags;\r\n\r\n    const call = this.createCallInstance({\r\n      isOutgoing: true,\r\n      interlocutorUserId: userId\r\n    });\r\n\r\n    call.requestInputSource(true, !!(isVideo && video_calls_available), false);\r\n\r\n    call.overrideConnectionState(CALL_STATE.REQUESTING);\r\n    call.setPhoneCall({\r\n      _: 'phoneCallWaiting',\r\n      access_hash: '',\r\n      admin_id: NULL_PEER_ID,\r\n      date: tsNow(true),\r\n      id: --this.tempId,\r\n      participant_id: userId,\r\n      protocol: call.protocol,\r\n      pFlags: {\r\n        video: isVideo || undefined\r\n      }\r\n    });\r\n\r\n    // return;\r\n    this.managers.appCallsManager.generateDh().then(async(dh) => {\r\n      call.dh = dh;\r\n\r\n      return this.managers.appCallsManager.requestCall(userId, call.protocol, call.dh.g_a_hash, isVideo && video_calls_available);\r\n    }).then((phoneCall) => {\r\n      call.overrideConnectionState(CALL_STATE.PENDING);\r\n      call.setPhoneCall(phoneCall);\r\n      call.setHangUpTimeout(CALL_REQUEST_TIMEOUT, 'phoneCallDiscardReasonHangup');\r\n    });\r\n  }\r\n}\r\n\r\nconst callsController = new CallsController();\r\nMOUNT_CLASS_TO && (MOUNT_CLASS_TO.callsController = callsController);\r\nexport default callsController;\r\n","export const GROUP_CALL_AMPLITUDE_ANALYSE_COUNT_MAX = 50;\nexport const GROUP_CALL_AMPLITUDE_ANALYSE_INTERVAL_MS = 100;\nexport const GROUP_CALL_PARTICIPANTS_LOAD_LIMIT = 100;\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport forEachReverse from '../../helpers/array/forEachReverse';\nimport throttle from '../../helpers/schedulers/throttle';\nimport {GroupCallConnectionType, JoinGroupCallJsonPayload} from '../appManagers/appGroupCallsManager';\nimport {AppManagers} from '../appManagers/managers';\nimport rootScope from '../rootScope';\nimport CallConnectionInstanceBase, {CallConnectionInstanceOptions} from './callConnectionInstanceBase';\nimport GroupCallInstance from './groupCallInstance';\nimport filterServerCodecs from './helpers/filterServerCodecs';\nimport fixLocalOffer from './helpers/fixLocalOffer';\nimport processMediaSection from './helpers/processMediaSection';\nimport {ConferenceEntry} from './localConferenceDescription';\nimport SDP from './sdp';\nimport SDPMediaSection from './sdp/mediaSection';\nimport {WebRTCLineType} from './sdpBuilder';\nimport {UpdateGroupCallConnectionData} from './types';\n\nexport default class GroupCallConnectionInstance extends CallConnectionInstanceBase {\n  private groupCall: GroupCallInstance;\n  public updateConstraints?: boolean;\n  private type: GroupCallConnectionType;\n  private options: {\n    type: Extract<GroupCallConnectionType, 'main'>,\n    isMuted?: boolean,\n    joinVideo?: boolean,\n    rejoin?: boolean\n  } | {\n    type: Extract<GroupCallConnectionType, 'presentation'>,\n  };\n\n  private updateConstraintsInterval: number;\n  public negotiateThrottled: () => void;\n\n  private managers: AppManagers;\n\n  constructor(options: CallConnectionInstanceOptions & {\n    groupCall: GroupCallConnectionInstance['groupCall'],\n    type: GroupCallConnectionInstance['type'],\n    options: GroupCallConnectionInstance['options'],\n    managers: AppManagers\n  }) {\n    super(options);\n\n    this.negotiateThrottled = throttle(this.negotiate.bind(this), 0, false);\n  }\n\n  public createPeerConnection() {\n    return this.connection || super.createPeerConnection({\n      iceServers: [],\n      iceTransportPolicy: 'all',\n      bundlePolicy: 'max-bundle',\n      rtcpMuxPolicy: 'require',\n      iceCandidatePoolSize: 0\n      // sdpSemantics: \"unified-plan\",\n      // extmapAllowMixed: true,\n    });\n  }\n\n  public createDataChannel() {\n    if(this.dataChannel) {\n      return this.dataChannel;\n    }\n\n    const dataChannel = super.createDataChannel();\n\n    dataChannel.addEventListener('open', () => {\n      this.maybeUpdateRemoteVideoConstraints();\n    });\n\n    dataChannel.addEventListener('close', () => {\n      if(this.updateConstraintsInterval) {\n        clearInterval(this.updateConstraintsInterval);\n        this.updateConstraintsInterval = undefined;\n      }\n    });\n\n    return dataChannel;\n  }\n\n  public createDescription() {\n    if(this.description) {\n      return this.description;\n    }\n\n    const description = super.createDescription();\n\n    /* const perType = 0;\n    const types = ['audio' as const, 'video' as const];\n    const count = types.length * perType;\n    const init: RTCRtpTransceiverInit = {direction: 'recvonly'};\n    types.forEach((type) => {\n      for(let i = 0; i < perType; ++i) {\n        description.createEntry(type).createTransceiver(connection, init);\n      }\n    }); */\n\n    return description;\n  }\n\n  public appendStreamToConference() {\n    super.appendStreamToConference();/* .then(() => {\n      currentGroupCall.connections.main.negotiating = false;\n      this.startNegotiation({\n        type: type,\n        isMuted: muted,\n        rejoin\n      });\n    }); */\n  }\n\n  private async invokeJoinGroupCall(localSdp: SDP, mainChannels: SDPMediaSection[], options: GroupCallConnectionInstance['options']) {\n    const {groupCall, description} = this;\n    const groupCallId = groupCall.id;\n\n    const processedChannels = mainChannels.map((section) => {\n      const processed = processMediaSection(localSdp, section);\n\n      this.sources[processed.entry.type as 'video' | 'audio'] = processed.entry;\n\n      return processed;\n    });\n\n    const audioChannel = processedChannels.find((channel) => channel.media.mediaType === 'audio');\n    const videoChannel = processedChannels.find((channel) => channel.media.mediaType === 'video');\n    let {source, params} = audioChannel || {};\n    const useChannel = videoChannel || audioChannel;\n\n    const channels: {[type in WebRTCLineType]?: typeof audioChannel} = {\n      audio: audioChannel,\n      video: videoChannel\n    };\n\n    description.entries.forEach((entry) => {\n      if(entry.direction === 'sendonly') {\n        const channel = channels[entry.type];\n        if(!channel) return;\n\n        description.setEntrySource(entry, channel.sourceGroups || channel.source);\n        description.setEntryPeerId(entry, rootScope.myId);\n      }\n    });\n\n    // overwrite ssrc with audio in video params\n    if(params !== useChannel.params) {\n      const data: JoinGroupCallJsonPayload = JSON.parse(useChannel.params.data);\n      // data.ssrc = source || data.ssrc - 1; // audio channel can be missed in screensharing\n      if(source) data.ssrc = source;\n      else delete data.ssrc;\n      params = {\n        _: 'dataJSON',\n        data: JSON.stringify(data)\n      };\n    }\n\n    const update = await this.managers.appGroupCallsManager.joinGroupCall(groupCallId, params, options);\n\n    const data: UpdateGroupCallConnectionData = JSON.parse(update.params.data);\n\n    data.audio = data.audio || groupCall.connections.main.description.audio;\n    description.setData(data);\n    filterServerCodecs(mainChannels, data);\n\n    return data;\n  }\n\n  protected async negotiateInternal() {\n    const {connection, description} = this;\n    const isNewConnection = connection.iceConnectionState === 'new' && !description.getEntryByMid('0').source;\n    const log = this.log.bindPrefix('startNegotiation');\n    log('start');\n\n    const originalOffer = await connection.createOffer({iceRestart: false});\n\n    if(isNewConnection && this.dataChannel) {\n      const dataChannelEntry = description.createEntry('application');\n      dataChannelEntry.setDirection('sendrecv');\n    }\n\n    const {sdp: localSdp, offer} = fixLocalOffer({\n      offer: originalOffer,\n      data: description\n    });\n\n    log('[sdp] setLocalDescription', offer.sdp);\n    await connection.setLocalDescription(offer);\n\n    const mainChannels = localSdp.media.filter((media) => {\n      return media.mediaType !== 'application' && media.isSending;\n    });\n\n    if(isNewConnection) {\n      try {\n        await this.invokeJoinGroupCall(localSdp, mainChannels, this.options);\n      } catch(e) {\n        this.log.error('[tdweb] joinGroupCall error', e);\n      }\n    }\n\n    /* if(!data) {\n      log('abort 0');\n      this.closeConnectionAndStream(connection, streamManager);\n      return;\n    } */\n\n    /* if(connection.iceConnectionState !== 'new') {\n      log(`abort 1 connectionState=${connection.iceConnectionState}`);\n      this.closeConnectionAndStream(connection, streamManager);\n      return;\n    } */\n    /* if(this.currentGroupCall !== currentGroupCall || connectionHandler.connection !== connection) {\n      log('abort', this.currentGroupCall, currentGroupCall);\n      this.closeConnectionAndStream(connection, streamManager);\n      return;\n    } */\n\n    const isAnswer = true;\n    // const _bundleMids = bundleMids.slice();\n    const entriesToDelete: ConferenceEntry[] = [];\n    const bundle = localSdp.bundle;\n    forEachReverse(bundle, (mid, idx, arr) => {\n      const entry = description.getEntryByMid(mid);\n      if(entry.shouldBeSkipped(isAnswer)) {\n        arr.splice(idx, 1);\n        entriesToDelete.push(entry);\n      }\n    });\n\n    /* forEachReverse(description.entries, (entry, idx, arr) => {\n      const mediaSection = _parsedSdp.media.find((section) => section.oa.get('mid').oa === entry.mid);\n      const deleted = !mediaSection;\n      // const deleted = !_bundleMids.includes(entry.mid); // ! can't use it because certain mid can be missed in bundle\n      if(deleted) {\n        arr.splice(idx, 1);\n      }\n    }); */\n\n    const entries = localSdp.media.map((section) => {\n      const mid = section.mid;\n      let entry = description.getEntryByMid(mid);\n      if(!entry) {\n        entry = new ConferenceEntry(mid, section.mediaType);\n        entry.setDirection('inactive');\n      }\n\n      return entry;\n    });\n\n    const answerDescription: RTCSessionDescriptionInit = {\n      type: 'answer',\n      sdp: description.generateSdp({\n        bundle,\n        entries,\n        isAnswer\n      })\n    };\n\n    entriesToDelete.forEach((entry) => {\n      description.deleteEntry(entry);\n    });\n\n    log(`[sdp] setRemoteDescription signaling=${connection.signalingState} ice=${connection.iceConnectionState} gathering=${connection.iceGatheringState} connection=${connection.connectionState}`, answerDescription.sdp);\n    await connection.setRemoteDescription(answerDescription);\n\n    log('end');\n  }\n\n  public negotiate() {\n    let promise = this.negotiating;\n    if(promise) {\n      return promise;\n    }\n\n    promise = super.negotiate();\n\n    if(this.updateConstraints) {\n      promise.then(() => {\n        this.maybeUpdateRemoteVideoConstraints();\n        this.updateConstraints = false;\n      });\n    }\n\n    if(this.options.type === 'presentation') {\n      promise.then(() => {\n        this.connection.getTransceivers().find((transceiver) => {\n          if(transceiver.sender?.track?.kind === 'video') {\n            transceiver.sender.setParameters({\n              ...transceiver.sender.getParameters(),\n              degradationPreference: 'maintain-resolution'\n            });\n          }\n        });\n      });\n    }\n\n    return promise;\n  }\n\n  public maybeUpdateRemoteVideoConstraints() {\n    if(this.dataChannel.readyState !== 'open') {\n      return;\n    }\n\n    this.log('maybeUpdateRemoteVideoConstraints');\n\n    // * https://github.com/TelegramMessenger/tgcalls/blob/6f2746e04c9b040f8c8dfc64d916a1853d09c4ce/tgcalls/group/GroupInstanceCustomImpl.cpp#L2549\n    type VideoConstraints = {minHeight?: number, maxHeight: number};\n    const obj: {\n      colibriClass: 'ReceiverVideoConstraints',\n      constraints: {[endpoint: string]: VideoConstraints},\n      defaultConstraints: VideoConstraints,\n      onStageEndpoints: string[]\n    } = {\n      colibriClass: 'ReceiverVideoConstraints',\n      constraints: {},\n      defaultConstraints: {maxHeight: 0},\n      onStageEndpoints: []\n    };\n\n    for(const entry of this.description.entries) {\n      if(entry.direction !== 'recvonly' || entry.type !== 'video') {\n        continue;\n      }\n\n      const {endpoint} = entry;\n      obj.onStageEndpoints.push(endpoint);\n      obj.constraints[endpoint] = {\n        minHeight: 180,\n        maxHeight: 720\n      };\n    }\n\n    this.sendDataChannelData(obj);\n\n    if(!obj.onStageEndpoints.length) {\n      if(this.updateConstraintsInterval) {\n        clearInterval(this.updateConstraintsInterval);\n        this.updateConstraintsInterval = undefined;\n      }\n    } else if(!this.updateConstraintsInterval) {\n      this.updateConstraintsInterval = window.setInterval(this.maybeUpdateRemoteVideoConstraints.bind(this), 5000);\n    }\n  }\n\n  public addInputVideoStream(stream: MediaStream) {\n    // const {sources} = this;\n    // if(sources?.video) {\n    // const source = this.sources.video.source;\n    // stream.source = '' + source;\n    this.groupCall.saveInputVideoStream(stream, this.type);\n    // }\n\n    this.streamManager.addStream(stream, 'input');\n    this.appendStreamToConference(); // replace sender track\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport {DataJSON} from '../../../layer';\nimport {JoinGroupCallJsonPayload} from '../../appManagers/appGroupCallsManager';\nimport SDP from '../sdp';\nimport {Ssrc} from '../types';\nimport parseMediaSectionInfo from './parseMediaSectionInfo';\n\nexport default function processMediaSection(sdp: SDP, media: SDP['media'][0]) {\n  const sectionInfo = parseMediaSectionInfo(sdp, media);\n\n  const mediaType: Exclude<typeof media['mediaType'], 'application'> = media.mediaType as any;\n  const entry: Ssrc = {\n    source: sectionInfo.source,\n    sourceGroups: sectionInfo.sourceGroups,\n    type: mediaType\n  };\n\n  // do not change this value, otherwise onconnectionstatechange won't fire\n  sectionInfo.fingerprint.setup = 'active';\n  const payload: JoinGroupCallJsonPayload = {\n    'fingerprints': [sectionInfo.fingerprint],\n    'pwd': sectionInfo.pwd,\n    'ssrc': sectionInfo.source,\n    'ssrc-groups': sectionInfo.sourceGroups || [],\n    'ufrag': sectionInfo.ufrag\n  };\n  const paramsDataJson = JSON.stringify(payload);\n\n  const params: DataJSON = {\n    _: 'dataJSON',\n    data: paramsDataJson\n  };\n\n  return {\n    params,\n    source: sectionInfo.source,\n    media,\n    sourceGroups: sectionInfo.sourceGroups,\n    entry\n  };\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport forEachReverse from '../../../helpers/array/forEachReverse';\nimport SDPMediaSection from '../sdp/mediaSection';\nimport {UpdateGroupCallConnectionData, Codec} from '../types';\n\nexport default function filterServerCodecs(mainChannels: SDPMediaSection[], data: UpdateGroupCallConnectionData) {\n  // ! Need to filter server's extmap for Firefox\n  const performExtmap = (channel: typeof mainChannels[0]) => {\n    const out: {[id: string]: string} = {};\n    const extmap = channel.attributes.get('extmap');\n    extmap.forEach((extmap) => {\n      const id = extmap.key.split('/', 1)[0];\n      out[id] = extmap.value;\n    });\n\n    return out;\n  };\n\n  const codecsToPerform: [Codec, 'audio' | 'video'][] = /* flatten([data, dataPresentation].filter(Boolean).map((data) => {\n    return  */['audio' as const, 'video' as const].filter((type) => data[type]).map((type) => ([data[type], type]));\n  // }));\n\n  codecsToPerform.forEach(([codec, type]) => {\n    const channel = mainChannels.find((line) => line.mediaType === type);\n    if(!channel) {\n      return;\n    }\n\n    const extmap = performExtmap(channel);\n    forEachReverse(codec['rtp-hdrexts'], (value, index, arr) => {\n      if(extmap[value.id] !== value.uri) {\n        arr.splice(index, 1);\n        console.log(`[sdp] filtered extmap:`, value, index, type);\n      }\n    });\n  });\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport forEachReverse from '../../../helpers/array/forEachReverse';\nimport copy from '../../../helpers/object/copy';\nimport {ConferenceEntry} from '../localConferenceDescription';\nimport {parseSdp, addSimulcast} from '../sdp/utils';\nimport {generateMediaFirstLine, SDPBuilder} from '../sdpBuilder';\nimport {UpdateGroupCallConnectionData} from '../types';\nimport parseMediaSectionInfo from './parseMediaSectionInfo';\n\nexport default function fixLocalOffer(options: {\n  offer: RTCSessionDescriptionInit,\n  data: UpdateGroupCallConnectionData,\n  skipAddingMulticast?: boolean\n  // mids?: string[]\n}) {\n  const {offer, data} = options;\n  const sdp = parseSdp(offer.sdp);\n  let hasMunged = false;\n\n  if(!options.skipAddingMulticast) {\n    hasMunged = addSimulcast(sdp) || hasMunged;\n  }\n\n  // const bundleLine = parsedSdp.session.lines.find((line) => line.Ha?.key === 'group');\n  // const bundleMids = bundleLine.value.split(' ').slice(1);\n\n  forEachReverse(sdp.media, (section, idx, arr) => {\n    // const mid = section.oa.get('mid').oa;\n\n    //        . -    \n    // !     ,  \n    /* if(mids && !mids.includes(mid) && !bundleMids.includes(mid)) {\n      console.error('wtf');\n      hasMunged = true;\n      arr.splice(idx, 1);\n      return;\n    } */\n\n    if(/* section.mediaType !== 'video' ||  */section.isSending) {\n      return;\n    }\n\n    if(section.mediaType === 'application') {\n      return;\n    }\n\n    const mediaLine = section.mediaLine;\n    const mediaLineParts = mediaLine.mediaLineParts;\n    const mediaCodecIds = mediaLineParts.ids;\n    const localMLine = mediaLine.toString();\n\n    const codec = data[section.mediaType];\n    const payloadTypes = codec['payload-types'];\n\n    /* forEachReverse(payloadTypes, (payloadType, idx, arr) => {\n      if(!mediaCodecIds.includes('' + payloadType.id) && section.mediaType === 'video') {\n      // if(payloadType.name === 'H265') {\n        console.warn('[sdp] filtered unsupported codec', payloadType, mediaCodecIds, section.mediaType);\n        arr.splice(idx, 1);\n      }\n    }); */\n\n    const codecIds = payloadTypes.map((payload) => '' + payload.id);\n    const correctMLine = generateMediaFirstLine(section.mediaType, undefined, codecIds);\n\n    if(localMLine !== correctMLine) {\n      const sectionInfo = parseMediaSectionInfo(sdp, section);\n\n      const newData = {...data};\n      newData.transport = copy(newData.transport);\n      newData.transport.ufrag = sectionInfo.ufrag;\n      newData.transport.pwd = sectionInfo.pwd;\n      newData.transport.fingerprints = [sectionInfo.fingerprint];\n      newData.transport.candidates = [];\n\n      const entry = new ConferenceEntry(sectionInfo.mid, mediaLineParts.type);\n      entry.setPort(mediaLineParts.port);\n      sectionInfo.source && entry.setSource(sectionInfo.sourceGroups || sectionInfo.source);\n      entry.setDirection(section.direction);\n\n      const newSdp = new SDPBuilder().addSsrcEntry(entry, newData).finalize();\n\n      const newChannel = parseSdp(newSdp).media[0];\n      arr[idx] = newChannel;\n\n      hasMunged = true;\n    }\n  });\n\n  if(hasMunged) {\n    const mungedSdp = sdp.toString();\n    offer.sdp = mungedSdp;\n  }\n\n  return {offer, sdp/* , bundleMids */};\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport type {GroupCallConnectionType, GroupCallId, GroupCallOutputSource} from '../appManagers/appGroupCallsManager';\nimport {IS_SAFARI} from '../../environment/userAgent';\nimport indexOfAndSplice from '../../helpers/array/indexOfAndSplice';\nimport safeAssign from '../../helpers/object/safeAssign';\nimport throttle from '../../helpers/schedulers/throttle';\nimport {GroupCall, GroupCallParticipant} from '../../layer';\nimport {logger} from '../logger';\nimport {NULL_PEER_ID} from '../mtproto/mtproto_config';\nimport rootScope from '../rootScope';\nimport CallInstanceBase, {TryAddTrackOptions} from './callInstanceBase';\nimport GroupCallConnectionInstance from './groupCallConnectionInstance';\nimport GROUP_CALL_STATE from './groupCallState';\nimport getScreenConstraints from './helpers/getScreenConstraints';\nimport getScreenStream from './helpers/getScreenStream';\nimport getStream from './helpers/getStream';\nimport getVideoConstraints from './helpers/getVideoConstraints';\nimport stopTrack from './helpers/stopTrack';\nimport localConferenceDescription from './localConferenceDescription';\nimport {WebRTCLineType} from './sdpBuilder';\nimport StreamManager from './streamManager';\nimport {Ssrc} from './types';\nimport getPeerId from '../appManagers/utils/peers/getPeerId';\nimport {AppManagers} from '../appManagers/managers';\nimport {generateSelfVideo, makeSsrcFromParticipant, makeSsrcsFromParticipant} from './groupCallsController';\n\nexport default class GroupCallInstance extends CallInstanceBase<{\n  state: (state: GROUP_CALL_STATE) => void,\n  pinned: (source?: GroupCallOutputSource) => void,\n}> {\n  public id: GroupCallId;\n  public chatId: ChatId;\n  public handleUpdateGroupCallParticipants: boolean;\n  public updatingSdp: boolean;\n  public isSpeakingMap: Map<any, any>;\n  public connections: {[k in GroupCallConnectionType]?: GroupCallConnectionInstance};\n  public groupCall: GroupCall;\n  public participant: GroupCallParticipant;\n\n  // will be set with negotiation\n  public joined: boolean;\n\n  private pinnedSources: Array<GroupCallOutputSource>;\n  private participantsSsrcs: Map<PeerId, Ssrc[]>;\n  private hadAutoPinnedSources: Set<GroupCallOutputSource>;\n  private dispatchPinnedThrottled: () => void;\n  private startVideoSharingPromise: Promise<void>;\n  private startScreenSharingPromise: Promise<void>;\n\n  private managers: AppManagers;\n\n  constructor(options: {\n    id: GroupCallInstance['id'],\n    chatId: GroupCallInstance['chatId'],\n    isSpeakingMap?: GroupCallInstance['isSpeakingMap'],\n    connections?: GroupCallInstance['connections'],\n    managers: AppManagers\n  }) {\n    super();\n\n    safeAssign(this, options);\n\n    if(!this.log) {\n      this.log = logger('GROUP-CALL');\n    }\n\n    if(!this.connections) {\n      this.connections = {};\n    }\n\n    if(!this.isSpeakingMap) {\n      this.isSpeakingMap = new Map();\n    }\n\n    this.pinnedSources = [];\n    this.participantsSsrcs = new Map();\n    this.hadAutoPinnedSources = new Set();\n    this.dispatchPinnedThrottled = throttle(() => {\n      this.dispatchEvent('pinned', this.pinnedSource);\n    }, 0, false);\n\n    this.addEventListener('state', (state) => {\n      if(state === GROUP_CALL_STATE.CLOSED) {\n        this.cleanup();\n      }\n    });\n  }\n\n  get connectionState() {\n    return this.connections.main.connection.iceConnectionState;\n  }\n\n  get state() {\n    const {connectionState} = this;\n    if(connectionState === 'closed') {\n      return GROUP_CALL_STATE.CLOSED;\n    } else if(connectionState !== 'connected' && (!IS_SAFARI || connectionState !== 'completed')) {\n      return GROUP_CALL_STATE.CONNECTING;\n    } else {\n      const {participant} = this;\n      if(!participant.pFlags.can_self_unmute) {\n        return GROUP_CALL_STATE.MUTED_BY_ADMIN;\n      } else if(participant.pFlags.muted) {\n        return GROUP_CALL_STATE.MUTED;\n      } else {\n        return GROUP_CALL_STATE.UNMUTED;\n      }\n    }\n  }\n\n  get participants() {\n    return this.managers.appGroupCallsManager.getCachedParticipants(this.id);\n  }\n\n  get isSharingScreen() {\n    return !!this.connections.presentation;\n  }\n\n  get pinnedSource() {\n    return this.pinnedSources[this.pinnedSources.length - 1];\n  }\n\n  public get isMuted() {\n    return this.state !== GROUP_CALL_STATE.UNMUTED;\n  }\n\n  public get isClosing() {\n    const {state} = this;\n    return state === GROUP_CALL_STATE.CLOSED;\n  }\n\n  public get streamManager(): StreamManager {\n    return this.connections.main.streamManager;\n  }\n\n  public get description(): localConferenceDescription {\n    return this.connections.main.description;\n  }\n\n  public pinSource(source: GroupCallOutputSource) {\n    indexOfAndSplice(this.pinnedSources, source);\n    this.pinnedSources.push(source);\n    this.dispatchPinnedThrottled();\n  }\n\n  public unpinSource(source: GroupCallOutputSource) {\n    this.hadAutoPinnedSources.delete(source);\n    indexOfAndSplice(this.pinnedSources, source);\n    this.dispatchPinnedThrottled();\n  }\n\n  public unpinAll() {\n    this.pinnedSources.length = 0;\n    this.dispatchPinnedThrottled();\n  }\n\n  public async getParticipantByPeerId(peerId: PeerId) {\n    return NULL_PEER_ID === peerId ? this.participant : (await this.participants).get(peerId);\n  }\n\n  public toggleMuted() {\n    return this.requestAudioSource(true).then(() => this.changeUserMuted(NULL_PEER_ID));\n  }\n\n  public async changeUserMuted(peerId: PeerId, muted?: boolean) {\n    const participant = await this.getParticipantByPeerId(peerId);\n    if(NULL_PEER_ID === peerId && participant.pFlags.can_self_unmute) {\n      muted = muted === undefined ? !participant.pFlags.muted : muted;\n    }\n\n    return this.editParticipant(participant, {muted});\n  }\n\n  public getElement(endpoint: GroupCallOutputSource) {\n    return super.getElement(endpoint);\n  }\n\n  public getVideoElementFromParticipantByType(participant: GroupCallParticipant, type: 'video' | 'presentation') {\n    let source: GroupCallOutputSource;\n    if(participant.pFlags.self) {\n      const connectionType: GroupCallConnectionType = type === 'video' ? 'main' : 'presentation';\n      source = connectionType;\n    } else {\n      const codec = participant[type];\n      source = codec.source_groups[0].sources[0];\n    }\n\n    const element = this.getElement(source) as HTMLVideoElement;\n    if(!element) return;\n\n    const clone = element.cloneNode() as typeof element;\n    clone.srcObject = element.srcObject;\n    return {video: clone, source};\n  }\n\n  public createConnectionInstance(options: {\n    streamManager: StreamManager,\n    type: GroupCallConnectionType,\n    options: GroupCallConnectionInstance['options'],\n  }) {\n    return this.connections[options.type] = new GroupCallConnectionInstance({\n      groupCall: this,\n      log: this.log.bindPrefix(options.type),\n      managers: this.managers,\n      ...options\n    });\n  }\n\n  public changeRaiseHand(raise: boolean) {\n    return this.editParticipant(this.participant, {raiseHand: raise});\n  }\n\n  public async startScreenSharingInternal() {\n    try {\n      const type: GroupCallConnectionType = 'presentation';\n\n      const stream = await getScreenStream(getScreenConstraints());\n      const streamManager = new StreamManager();\n\n      const connectionInstance = this.createConnectionInstance({\n        streamManager,\n        type,\n        options: {\n          type\n        }\n      });\n\n      const connection = connectionInstance.createPeerConnection();\n      connection.addEventListener('negotiationneeded', () => {\n        connectionInstance.negotiate();\n      });\n\n      stream.getVideoTracks()[0].addEventListener('ended', () => {\n        if(this.connections.presentation) { // maybe user has stopped screensharing through browser's ui\n          this.stopScreenSharing();\n        }\n      }, {once: true});\n\n      connectionInstance.createDescription();\n      connectionInstance.addInputVideoStream(stream);\n    } catch(err) {\n      this.log.error('start screen sharing error', err);\n    }\n  }\n\n  public startScreenSharing() {\n    return this.startScreenSharingPromise ??= this.startScreenSharingInternal().finally(() => {\n      this.startScreenSharingPromise = undefined;\n    });\n  }\n\n  public stopScreenSharing() {\n    const connectionInstance = this.connections.presentation;\n    if(!connectionInstance) {\n      return Promise.resolve();\n    }\n\n    delete this.connections.presentation;\n    this.unpinSource('presentation');\n    connectionInstance.closeConnectionAndStream(true);\n\n    delete this.participant.presentation;\n    this.managers.appGroupCallsManager.saveApiParticipant(this.id, this.participant);\n\n    return this.managers.appGroupCallsManager.leaveGroupCallPresentation(this.id);\n  }\n\n  public toggleScreenSharing() {\n    if(this.isSharingScreen) {\n      return this.stopScreenSharing();\n    } else {\n      return this.startScreenSharing();\n    }\n  }\n\n  public async startVideoSharingInternal() {\n    const constraints: MediaStreamConstraints = {\n      video: getVideoConstraints()\n    };\n\n    try {\n      const stream = await getStream(constraints, false);\n      const connectionInstance = this.connections.main;\n      connectionInstance.addInputVideoStream(stream);\n\n      await this.editParticipant(this.participant, {\n        videoPaused: false,\n        videoStopped: false\n      });\n    } catch(err) {\n      this.log.error('startVideoSharing error', err, constraints);\n    }\n  }\n\n  public startVideoSharing() {\n    return this.startVideoSharingPromise ??= this.startVideoSharingInternal().finally(() => {\n      this.startVideoSharingPromise = undefined;\n    });\n  }\n\n  public async stopVideoSharing() {\n    const connectionInstance = this.connections.main;\n    const track = connectionInstance.streamManager.inputStream.getVideoTracks()[0];\n    if(!track) {\n      return;\n    }\n\n    stopTrack(track);\n    connectionInstance.streamManager.appendToConference(connectionInstance.description); // clear sender track\n\n    await this.editParticipant(this.participant, {\n      videoStopped: true\n    });\n  }\n\n  public toggleVideoSharing() {\n    if(this.isSharingVideo) {\n      return this.stopVideoSharing();\n    } else {\n      return this.startVideoSharing();\n    }\n  }\n\n  public async hangUp(discard = false, rejoin = false, isDiscarded = false) {\n    for(const type in this.connections) {\n      const connection = this.connections[type as GroupCallConnectionType];\n      connection.closeConnectionAndStream(!rejoin);\n    }\n\n    this.dispatchEvent('state', this.state);\n\n    if(isDiscarded) {\n      return;\n    }\n\n    if(!rejoin) {\n      const d = discard || (this.joined ? this.connections.main.sources.audio.source : undefined);\n      this.managers.appGroupCallsManager.hangUp(this.id, d);\n    }\n  }\n\n  public tryAddTrack(options: Omit<TryAddTrackOptions, 'streamManager'>) {\n    const {description} = this;\n    const source = super.tryAddTrack(options);\n\n    if(options.type === 'output') {\n      const entry = description.getEntryBySource(+source);\n      this.getParticipantByPeerId(entry.peerId).then((participant) => {\n        if(participant) {\n          rootScope.dispatchEvent('group_call_participant', {groupCallId: this.id, participant});\n        }\n      });\n    }\n\n    return source;\n  }\n\n  public async editParticipant(participant: GroupCallParticipant, options: Partial<{\n    muted: boolean,\n    volume: number,\n    raiseHand: boolean,\n    videoStopped: boolean,\n    videoPaused: boolean,\n    presentationPaused: boolean\n  }>) {\n    if(!Object.keys(options).length) {\n      return;\n    }\n\n    // let processUpdate = true;\n    if(participant) {\n      // const {currentGroupCall} = this;\n      // const isCurrentCall = currentGroupCall?.id === groupCallId;\n      const isCurrentCall = true;\n      const isUpdatingMeInCurrentCall = isCurrentCall && participant.pFlags.self;\n\n      if(isUpdatingMeInCurrentCall) {\n        if(options.muted !== undefined && !this.isSharingAudio) {\n          delete options.muted;\n\n          if(!Object.keys(options).length) {\n            return;\n          }\n        }\n      }\n\n      // if(isCurrentCall) {\n      const muted = options.muted;\n      if(muted !== undefined) {\n        /* const isAdmin = appChatsManager.hasRights(currentGroupCall.chatId, 'manage_call');\n          if(isAdmin) {\n            if(muted) {\n              participant.pFlags.muted = true;\n              delete participant.pFlags.can_self_unmute;\n            } else {\n              participant.pFlags.can_self_unmute = true;\n            }\n          } else  */if(participant.pFlags.self) {\n          if(muted) {\n            participant.pFlags.muted = true;\n          } else if(participant.pFlags.can_self_unmute) {\n            delete participant.pFlags.muted;\n          }\n        }/*  else {\n            if(muted) {\n              participant.pFlags.muted_by_you = true;\n            } else {\n              delete participant.pFlags.muted_by_you;\n            }\n          } */\n      }\n      // }\n\n      /* const a: [keyof GroupCallParticipant['pFlags'], keyof typeof options][] = [\n        ['muted', 'muted']\n      ];\n\n      a.forEach(([key, optionKey]) => {\n        const value = options[optionKey];\n        if(value === undefined) {\n          return;\n        }\n\n        if(value) {\n          participant.pFlags[key] = true;\n        } else {\n          delete participant.pFlags[key];\n        }\n      }); */\n\n      if(options.raiseHand !== undefined) {\n        if(options.raiseHand) participant.raise_hand_rating = '1';\n        else delete participant.raise_hand_rating;\n      }\n\n      if(isUpdatingMeInCurrentCall) {\n        if(options.videoStopped !== undefined) {\n          if(options.videoStopped) delete participant.video;\n          else participant.video = generateSelfVideo(this.connections.main.sources.video);\n        }\n\n        if(!participant.pFlags.muted && participant.pFlags.can_self_unmute) {\n          this.setMuted(false);\n        }\n\n        this.dispatchEvent('state', this.state);\n      }\n\n      // rootScope.dispatchEvent('group_call_participant', {groupCallId, participant});\n\n      /* if(participant.pFlags.self) {\n        processUpdate = false;\n      } */\n    }\n\n    return this.managers.appGroupCallsManager.editParticipant(this.id, participant, options);\n  }\n\n  public onParticipantUpdate(participant: GroupCallParticipant, doNotDispatchParticipantUpdate?: PeerId) {\n    const connectionInstance = this.connections.main;\n    const {connection, description} = connectionInstance;\n\n    const peerId = getPeerId(participant.peer);\n    const hasLeft = !!participant.pFlags.left;\n    const oldSsrcs = this.participantsSsrcs.get(peerId) || [];\n\n    if(participant.presentation && !hasLeft) {\n      const {source} = makeSsrcFromParticipant(participant, 'video', participant.presentation.source_groups, participant.presentation.endpoint);\n      if(!this.hadAutoPinnedSources.has(source)) {\n        this.hadAutoPinnedSources.add(source);\n        this.pinSource(participant.pFlags.self ? 'presentation' : source);\n      }\n    }\n\n    if(participant.pFlags.self) {\n      this.participant = participant;\n\n      if(connectionInstance.sources.audio.source !== participant.source) {\n        this.hangUp();\n      }\n\n      let mute = false;\n      if(!participant.pFlags.can_self_unmute) {\n        this.stopScreenSharing();\n        this.stopVideoSharing();\n        mute = true;\n      } else if(participant.pFlags.muted) {\n        mute = true;\n      }\n\n      if(mute) {\n        this.setMuted(true);\n      }\n\n      if(doNotDispatchParticipantUpdate !== peerId) {\n        this.dispatchEvent('state', this.state);\n      }\n\n      return;\n    }\n\n    const ssrcs = hasLeft ? [] : makeSsrcsFromParticipant(participant);\n\n    if(!hasLeft) {\n      this.participantsSsrcs.set(peerId, ssrcs);\n    } else {\n      this.participantsSsrcs.delete(peerId);\n    }\n\n    // const TEST_OLD = false;\n\n    const modifiedTypes: Set<WebRTCLineType> = new Set();\n    oldSsrcs.forEach((oldSsrc) => {\n      const oldSource = oldSsrc.source;\n      const newSsrc = ssrcs.find((ssrc) => ssrc.source === oldSource);\n      if(!newSsrc) {\n        this.unpinSource(oldSource);\n\n        const oldEntry = description.getEntryBySource(oldSource);\n        if(oldEntry && oldEntry.direction !== 'inactive') {\n          oldEntry.setDirection('inactive');\n          modifiedTypes.add(oldEntry.type);\n        }\n      }\n    });\n\n    ssrcs.forEach((ssrc) => {\n      let entry = description.getEntryBySource(ssrc.source);\n      if(entry) {\n        if(entry.direction === 'inactive') {\n          entry.setDirection(entry.originalDirection);\n          modifiedTypes.add(entry.type);\n        }\n\n        return;\n      }\n\n      entry = description.createEntry(ssrc.type);\n      description.setEntrySource(entry, ssrc.sourceGroups || ssrc.source);\n      description.setEntryPeerId(entry, peerId);\n\n      // if(TEST_OLD) {\n      //   description.bundleMids.push(entry.mid);\n      //   entry.setDirection('recvonly');\n      // } else {\n      ssrc.type === 'video' && entry.setEndpoint(ssrc.endpoint);\n      entry.createTransceiver(connection, {direction: 'recvonly'});\n      // }\n\n      modifiedTypes.add(entry.type);\n    });\n\n    /* if(TEST_OLD) {\n      this.setRemoteOffer({\n        connection,\n        description,\n        ssrcs\n      });\n    } else  */if(modifiedTypes.size) {\n      if(modifiedTypes.has('video')) {\n        connectionInstance.updateConstraints = true;\n      }\n\n      connectionInstance.negotiateThrottled();\n    }\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nenum GROUP_CALL_STATE {\n  UNMUTED,\n  MUTED,\n  MUTED_BY_ADMIN,\n  CONNECTING,\n  CLOSED\n}\n\nexport default GROUP_CALL_STATE;\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport AudioAssetPlayer from '../../helpers/audioAssetPlayer';\r\n\r\nexport type GroupCallAudioAssetName = 'group_call_connect.mp3' | 'group_call_end.mp3' | 'group_call_start.mp3' | 'voip_onallowtalk.mp3';\r\n\r\nlet audioAsset: AudioAssetPlayer<GroupCallAudioAssetName>;\r\nexport default function getGroupCallAudioAsset() {\r\n  return audioAsset ??= new AudioAssetPlayer([\r\n    'group_call_connect.mp3',\r\n    'group_call_end.mp3',\r\n    'group_call_start.mp3',\r\n    'voip_onallowtalk.mp3'\r\n  ]);\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport getGroupCallAudioAsset from '../../components/groupCall/getAudioAsset';\r\nimport {MOUNT_CLASS_TO} from '../../config/debug';\r\nimport EventListenerBase from '../../helpers/eventListenerBase';\r\nimport {GroupCallParticipant, GroupCallParticipantVideo, GroupCallParticipantVideoSourceGroup} from '../../layer';\r\nimport {GroupCallId, GroupCallConnectionType} from '../appManagers/appGroupCallsManager';\r\nimport {AppManagers} from '../appManagers/managers';\r\nimport {logger} from '../logger';\r\nimport rootScope from '../rootScope';\r\nimport GroupCallInstance from './groupCallInstance';\r\nimport GROUP_CALL_STATE from './groupCallState';\r\nimport createMainStreamManager from './helpers/createMainStreamManager';\r\nimport {generateSsrc} from './localConferenceDescription';\r\nimport {WebRTCLineType} from './sdpBuilder';\r\nimport StreamManager from './streamManager';\r\nimport {Ssrc} from './types';\r\n\r\nconst IS_MUTED = true;\r\n\r\nexport function makeSsrcsFromParticipant(participant: GroupCallParticipant) {\r\n  return [\r\n    makeSsrcFromParticipant(participant, 'audio', participant.source),\r\n    participant.video?.audio_source && makeSsrcFromParticipant(participant, 'audio', participant.video.audio_source),\r\n    participant.video && makeSsrcFromParticipant(participant, 'video', participant.video.source_groups, participant.video.endpoint),\r\n    participant.presentation?.audio_source && makeSsrcFromParticipant(participant, 'audio', participant.presentation.audio_source),\r\n    participant.presentation && makeSsrcFromParticipant(participant, 'video', participant.presentation.source_groups, participant.presentation.endpoint)\r\n  ].filter(Boolean);\r\n};\r\n\r\nexport function makeSsrcFromParticipant(participant: GroupCallParticipant, type: WebRTCLineType, source?: number | GroupCallParticipantVideoSourceGroup[], endpoint?: string): Ssrc {\r\n  return generateSsrc(type, source, endpoint);\r\n}\r\n\r\nexport function generateSelfVideo(source: Ssrc, audioSource?: number): GroupCallParticipantVideo {\r\n  return source && {\r\n    _: 'groupCallParticipantVideo',\r\n    pFlags: {},\r\n    endpoint: '',\r\n    source_groups: source.sourceGroups,\r\n    audio_source: audioSource\r\n  };\r\n}\r\n\r\nexport class GroupCallsController extends EventListenerBase<{\r\n  instance: (instance: GroupCallInstance) => void\r\n}> {\r\n  private audioAsset: ReturnType<typeof getGroupCallAudioAsset>;\r\n  private log: ReturnType<typeof logger>;\r\n  private currentGroupCall: GroupCallInstance;\r\n  private managers: AppManagers;\r\n\r\n  public construct(managers: AppManagers) {\r\n    this.managers = managers;\r\n    this.audioAsset = getGroupCallAudioAsset();\r\n    this.log = logger('GCC');\r\n\r\n    rootScope.addEventListener('group_call_update', (groupCall) => {\r\n      const {currentGroupCall} = this;\r\n      if(currentGroupCall?.id === groupCall.id) {\r\n        currentGroupCall.groupCall = groupCall;\r\n\r\n        if(groupCall._ === 'groupCallDiscarded') {\r\n          currentGroupCall.hangUp(false, false, true);\r\n        }\r\n      }\r\n    });\r\n\r\n    rootScope.addEventListener('group_call_participant', ({groupCallId, participant}) => {\r\n      const {currentGroupCall} = this;\r\n      if(currentGroupCall?.id === groupCallId) {\r\n        currentGroupCall.onParticipantUpdate(participant/* , this.doNotDispatchParticipantUpdate */);\r\n      }\r\n    });\r\n  }\r\n\r\n  get groupCall() {\r\n    return this.currentGroupCall;\r\n  }\r\n\r\n  public setCurrentGroupCall(groupCall: GroupCallInstance) {\r\n    this.currentGroupCall = groupCall;\r\n\r\n    if(groupCall) {\r\n      this.dispatchEvent('instance', groupCall);\r\n    }\r\n  }\r\n\r\n  public startConnectingSound() {\r\n    this.stopConnectingSound();\r\n    this.audioAsset.playSoundWithTimeout('group_call_connect.mp3', true, 2500);\r\n  }\r\n\r\n  public stopConnectingSound() {\r\n    this.audioAsset.stopSound();\r\n    this.audioAsset.cancelDelayedPlay();\r\n  }\r\n\r\n  public async joinGroupCall(chatId: ChatId, groupCallId: GroupCallId, muted = IS_MUTED, rejoin?: boolean, joinVideo?: boolean) {\r\n    this.audioAsset.createAudio();\r\n\r\n    this.log(`joinGroupCall chatId=${chatId} id=${groupCallId} muted=${muted} rejoin=${rejoin}`);\r\n\r\n    let streamManager: StreamManager;\r\n    if(rejoin) {\r\n      streamManager = this.currentGroupCall.connections.main.streamManager;\r\n    } else {\r\n      streamManager = await createMainStreamManager(muted, joinVideo);\r\n    }\r\n\r\n    return this.joinGroupCallInternal(chatId, groupCallId, streamManager, muted, rejoin, joinVideo);\r\n  }\r\n\r\n  public async joinGroupCallInternal(chatId: ChatId, groupCallId: GroupCallId, streamManager: StreamManager, muted: boolean, rejoin = false, joinVideo?: boolean) {\r\n    const log = this.log.bindPrefix('joinGroupCallInternal');\r\n    log('start', groupCallId);\r\n\r\n    const type: GroupCallConnectionType = 'main';\r\n\r\n    let {currentGroupCall} = this;\r\n    if(currentGroupCall && rejoin) {\r\n      // currentGroupCall.connections.main.connection = connection;\r\n      currentGroupCall.handleUpdateGroupCallParticipants = false;\r\n      currentGroupCall.updatingSdp = false;\r\n      log('update currentGroupCall', groupCallId, currentGroupCall);\r\n    } else {\r\n      currentGroupCall = new GroupCallInstance({\r\n        chatId,\r\n        id: groupCallId,\r\n        managers: this.managers\r\n      });\r\n\r\n      currentGroupCall.fixSafariAudio();\r\n\r\n      currentGroupCall.addEventListener('state', (state) => {\r\n        if(this.currentGroupCall === currentGroupCall && state === GROUP_CALL_STATE.CLOSED) {\r\n          this.setCurrentGroupCall(null);\r\n          this.stopConnectingSound();\r\n          this.audioAsset.playSound('group_call_end.mp3');\r\n          rootScope.dispatchEvent('chat_update', currentGroupCall.chatId);\r\n        }\r\n      });\r\n\r\n      currentGroupCall.groupCall = await this.managers.appGroupCallsManager.getGroupCallFull(groupCallId);\r\n\r\n      const connectionInstance = currentGroupCall.createConnectionInstance({\r\n        streamManager,\r\n        type,\r\n        options: {\r\n          type,\r\n          isMuted: muted,\r\n          joinVideo,\r\n          rejoin\r\n        }\r\n      });\r\n\r\n      const connection = connectionInstance.createPeerConnection();\r\n      connection.addEventListener('negotiationneeded', () => {\r\n        connectionInstance.negotiate();\r\n      });\r\n\r\n      connection.addEventListener('track', (event) => {\r\n        log('ontrack', event);\r\n        currentGroupCall.onTrack(event);\r\n      });\r\n\r\n      connection.addEventListener('iceconnectionstatechange', () => {\r\n        currentGroupCall.dispatchEvent('state', currentGroupCall.state);\r\n\r\n        const {iceConnectionState} = connection;\r\n        if(iceConnectionState === 'disconnected' || iceConnectionState === 'checking' || iceConnectionState === 'new') {\r\n          this.startConnectingSound();\r\n        } else {\r\n          this.stopConnectingSound();\r\n        }\r\n\r\n        switch(iceConnectionState) {\r\n          case 'checking': {\r\n            break;\r\n          }\r\n\r\n          case 'closed': {\r\n            currentGroupCall.hangUp();\r\n            break;\r\n          }\r\n\r\n          case 'completed': {\r\n            break;\r\n          }\r\n\r\n          case 'connected': {\r\n            if(!currentGroupCall.joined) {\r\n              currentGroupCall.joined = true;\r\n              this.audioAsset.playSound('group_call_start.mp3');\r\n              this.managers.appGroupCallsManager.getGroupCallParticipants(groupCallId);\r\n            }\r\n\r\n            break;\r\n          }\r\n\r\n          case 'disconnected': {\r\n            break;\r\n          }\r\n\r\n          case 'failed': {\r\n            // TODO: replace with ICE restart\r\n            currentGroupCall.hangUp();\r\n            // connection.restartIce();\r\n            break;\r\n          }\r\n\r\n          case 'new': {\r\n            break;\r\n          }\r\n        }\r\n      });\r\n\r\n      connectionInstance.createDescription();\r\n      connectionInstance.createDataChannel();\r\n\r\n      connectionInstance.appendStreamToConference();\r\n\r\n      this.setCurrentGroupCall(currentGroupCall);\r\n      log('set currentGroupCall', groupCallId, currentGroupCall);\r\n\r\n      this.startConnectingSound();\r\n\r\n      return connectionInstance.negotiate();\r\n    }\r\n  }\r\n}\r\n\r\nconst groupCallsController = new GroupCallsController();\r\nMOUNT_CLASS_TO && (MOUNT_CLASS_TO.groupCallController = groupCallsController);\r\nexport default groupCallsController;\r\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport {GROUP_CALL_AMPLITUDE_ANALYSE_INTERVAL_MS} from '../constants';\nimport StreamManager from '../streamManager';\nimport getAudioConstraints from './getAudioConstraints';\nimport getStream from './getStream';\nimport getVideoConstraints from './getVideoConstraints';\n\nexport default async function createMainStreamManager(muted?: boolean, joinVideo?: boolean) {\n  const constraints: MediaStreamConstraints = {\n    audio: getAudioConstraints(),\n    video: joinVideo && getVideoConstraints()\n  };\n\n  const streamManager = new StreamManager(GROUP_CALL_AMPLITUDE_ANALYSE_INTERVAL_MS);\n\n  try {\n    const stream = await getStream(constraints, muted);\n    streamManager.addStream(stream, 'input');\n  } catch(err) {\n    console.error('joinGroupCall getStream error', err, constraints);\n    streamManager.inputStream = new MediaStream();\n  }\n\n  return streamManager;\n}\n","import constraintSupported, {MyMediaTrackSupportedConstraints} from '../../../environment/constraintSupport';\n\nexport default function getAudioConstraints(): MediaTrackConstraints {\n  const constraints: MediaTrackConstraints = {\n    channelCount: 2\n  };\n\n  const desirable: (keyof MyMediaTrackSupportedConstraints)[] = [\n    'noiseSuppression',\n    'echoCancellation',\n    'autoGainControl'\n  ];\n\n  desirable.forEach((constraint) => {\n    if(constraintSupported(constraint)) {\n      // @ts-ignore\n      constraints[constraint] = true;\n    }\n  });\n\n  return constraints;\n}\n","export type MyMediaTrackSupportedConstraints = MediaTrackSupportedConstraints & {\n  noiseSuppression?: boolean,\n  autoGainControl?: boolean\n};\n\nexport default function constraintSupported(constraint: keyof MyMediaTrackSupportedConstraints) {\n  return (!!navigator?.mediaDevices?.getSupportedConstraints() as any as MyMediaTrackSupportedConstraints)[constraint];\n}\n","export default function getScreenConstraints(skipAudio?: boolean) {\n  const constraints: DisplayMediaStreamConstraints = {\n    video: {\n      // @ts-ignore\n      // cursor: 'always',\n      width: {max: 1920},\n      height: {max: 1080},\n      frameRate: {max: 30}\n    }\n  };\n\n  if(!skipAudio) {\n    constraints.audio = true;\n  }\n\n  return constraints;\n}\n","export default async function getScreenStream(constraints: DisplayMediaStreamConstraints) {\n  const screenStream = await navigator.mediaDevices.getDisplayMedia(constraints);\n  const track = screenStream.getVideoTracks()[0];\n  track.contentHint = 'text';\n  return screenStream;\n}\n","export default async function getStream(constraints: MediaStreamConstraints, muted: boolean) {\n  // console.log('getStream', constraints);\n\n  const stream = await navigator.mediaDevices.getUserMedia(constraints);\n  stream.getTracks().forEach((x) => {\n    x.enabled = !muted;\n  });\n\n  // console.log('getStream result', stream);\n  return stream;\n}\n\n(window as any).getStream = getStream;\n","export default function getVideoConstraints(): MediaTrackConstraints {\n  return {\n    width: {min: 1280, max: 1920/* , ideal: 1920 */},\n    height: {min: 720, max: 1080/* , ideal: 1080 */},\n    frameRate: {min: 24, max: 30}\n  };\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport SDP from '../sdp';\nimport SDPMediaSection from '../sdp/mediaSection';\nimport {toTelegramSource} from '../utils';\nimport {parseSourceGroups} from './parseSourceGroups';\n\nexport default function parseMediaSectionInfo(sdp: SDP, channel: SDPMediaSection) {\n  const clientInfo = channel.lookupAttributeKeys({\n    'ice-ufrag': true,\n    'ice-pwd': true,\n    'fingerprint': true,\n    'setup': true,\n    'ssrc': true,\n    'mid': true,\n    'ssrc-group': false\n  });\n\n  if(!clientInfo.fingerprint) { // support Firefox\n    const line = sdp.session.lines.find((line) => line.parsed?.key === 'fingerprint');\n    clientInfo.fingerprint = line.parsed.value;\n  }\n\n  const telegramSourceGroups = parseSourceGroups(clientInfo['ssrc-group']);\n  const [hash, fingerprint] = clientInfo.fingerprint.split(' ', 2);\n  const ssrc = clientInfo.ssrc && toTelegramSource(+clientInfo.ssrc.split(' ', 1)[0]);\n  // ssrc = telegramSourceGroups ? telegramSourceGroups[0].sources[0] : ssrc;\n\n  return {\n    raw: clientInfo,\n    ufrag: clientInfo['ice-ufrag'],\n    pwd: clientInfo['ice-pwd'],\n    fingerprint: {\n      fingerprint,\n      setup: clientInfo.setup,\n      hash\n    },\n    source: ssrc,\n    sourceGroups: telegramSourceGroups,\n    mid: clientInfo.mid\n  };\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport {GroupCallParticipantVideoSourceGroup} from '../../../layer';\nimport {toTelegramSource} from '../utils';\n\nexport function parseSourceGroups(sdpLines: string[]) {\n  const telegramSourceGroups = sdpLines.map((str) => {\n    const [semantics, ...rest] = str.split(' ');\n\n    const sourceGroup: GroupCallParticipantVideoSourceGroup = {\n      _: 'groupCallParticipantVideoSourceGroup',\n      semantics,\n      // sources: rest.map((ssrc) => +ssrc)\n      sources: rest.map((ssrc) => toTelegramSource(+ssrc))\n    };\n\n    return sourceGroup;\n  });\n\n  /* const simIndex = telegramSourceGroups.findIndex((g) => g.semantics === 'SIM');\n  if(simIndex !== -1) {\n    const sourceGroup = telegramSourceGroups.splice(simIndex, 1)[0];\n    telegramSourceGroups.unshift(sourceGroup);\n  } */\n\n  return telegramSourceGroups.length ? telegramSourceGroups : undefined;\n}\n","import simulateEvent from '../../../helpers/dom/dispatchEvent';\n\nexport default function stopTrack(track: MediaStreamTrack) {\n  track.stop();\n  simulateEvent(track, 'ended');\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n *\n * Originally from:\n * https://github.com/evgeny-nadymov/telegram-react\n * Copyright (C) 2018 Evgeny Nadymov\n * https://github.com/evgeny-nadymov/telegram-react/blob/master/LICENSE\n */\n\nimport indexOfAndSplice from '../../helpers/array/indexOfAndSplice';\nimport safeAssign from '../../helpers/object/safeAssign';\nimport {GroupCallParticipantVideoSourceGroup} from '../../layer';\nimport {fixMediaLineType, SDPBuilder, WebRTCLineType, WEBRTC_MEDIA_PORT} from './sdpBuilder';\nimport {AudioCodec, GroupCallConnectionTransport, Ssrc, UpdateGroupCallConnectionData, VideoCodec} from './types';\n\nexport class ConferenceEntry {\n  public source: number;\n  public sourceGroups: GroupCallParticipantVideoSourceGroup[];\n  public transceiver: RTCRtpTransceiver;\n  public originalDirection: RTCRtpTransceiverDirection;\n  public direction: RTCRtpTransceiverDirection;\n  public port: string;\n  public endpoint: string;\n  public peerId: PeerId;\n\n  public sendEntry: ConferenceEntry;\n  public recvEntry: ConferenceEntry;\n\n  constructor(public mid: string, public type: WebRTCLineType) {\n    this.port = WEBRTC_MEDIA_PORT;\n  }\n\n  public setDirection(direction: RTCRtpTransceiverDirection) {\n    if(!this.originalDirection) {\n      this.originalDirection = direction;\n    }\n\n    return this.direction = direction;\n  }\n\n  public setPort(port: string) {\n    return this.port = port;\n  }\n\n  public setEndpoint(endpoint: string) {\n    return this.endpoint = endpoint;\n  }\n\n  public setPeerId(peerId: PeerId) {\n    return this.peerId = peerId;\n  }\n\n  public createTransceiver(connection: RTCPeerConnection, init?: RTCRtpTransceiverInit) {\n    if(init?.direction) {\n      this.setDirection(init.direction);\n    }\n\n    return this.transceiver = connection.addTransceiver(fixMediaLineType(this.type), init);\n  }\n\n  public setSource(source: number | GroupCallParticipantVideoSourceGroup[]) {\n    let sourceGroups: GroupCallParticipantVideoSourceGroup[];\n    if(Array.isArray(source)) {\n      if(!source[0]) return;\n      sourceGroups = source;\n      source = sourceGroups[0].sources[0];\n    }\n\n    this.sourceGroups = sourceGroups;\n    return this.source = source;\n  }\n\n  public shouldBeSkipped(isAnswer?: boolean) {\n    return isAnswer && this.direction === 'inactive';\n  }\n}\n\nexport function generateSsrc(type: WebRTCLineType, source: number | GroupCallParticipantVideoSourceGroup[], endpoint?: string): Ssrc {\n  let sourceGroups: GroupCallParticipantVideoSourceGroup[];\n  if(Array.isArray(source)) {\n    if(!source[0]) return;\n    sourceGroups = source;\n    source = sourceGroups[0].sources[0];\n  }\n\n  return {\n    endpoint,\n    type,\n    source,\n    sourceGroups\n  };\n}\n\nexport default class LocalConferenceDescription implements UpdateGroupCallConnectionData {\n  public readonly sessionId: string;\n  // public ssrcs: Ssrc[];\n  public readonly transport: GroupCallConnectionTransport;\n  public readonly audio?: AudioCodec;\n  public readonly video: VideoCodec;\n  public readonly screencast?: VideoCodec;\n\n  private maxSeenId: number;\n  public readonly entries: ConferenceEntry[];\n  private entriesByMid: Map<ConferenceEntry['mid'], ConferenceEntry>;\n  private entriesBySource: Map<ConferenceEntry['source'], ConferenceEntry>;\n  private entriesByPeerId: Map<ConferenceEntry['peerId'], Set<ConferenceEntry>>;\n\n  constructor(public connection: RTCPeerConnection) {\n    this.sessionId = '' + Date.now();\n    // this.ssrcs = [];\n    this.maxSeenId = -1;\n    this.entries = [];\n    this.entriesByMid = new Map();\n    this.entriesBySource = new Map();\n    this.entriesByPeerId = new Map();\n  }\n\n  public setData(data: UpdateGroupCallConnectionData) {\n    return safeAssign(this, data);\n  }\n\n  public createEntry(type: WebRTCLineType) {\n    const mid = '' + ++this.maxSeenId;\n    const entry = new ConferenceEntry(mid, type);\n    this.entries.push(entry);\n    this.entriesByMid.set(mid, entry);\n    return entry;\n  }\n\n  public deleteEntry(entry: ConferenceEntry) {\n    indexOfAndSplice(this.entries, entry);\n    this.entriesByMid.delete(entry.mid);\n    this.entriesBySource.delete(entry.source);\n\n    const set = this.entriesByPeerId.get(entry.peerId);\n    if(set) {\n      set.delete(entry);\n      if(!set.size) {\n        this.entriesByPeerId.delete(entry.peerId);\n      }\n    }\n  }\n\n  public setEntrySource(entry: ConferenceEntry, source: Parameters<ConferenceEntry['setSource']>[0]) {\n    entry.setSource(source);\n    this.entriesBySource.set(entry.source, entry);\n  }\n\n  public setEntryPeerId(entry: ConferenceEntry, peerId: ConferenceEntry['peerId']) {\n    entry.setPeerId(peerId);\n    let set = this.entriesByPeerId.get(peerId);\n    if(!set) {\n      this.entriesByPeerId.set(peerId, set = new Set());\n    }\n\n    set.add(entry);\n  }\n\n  public findEntry(verify: Parameters<LocalConferenceDescription['entries']['find']>[0]) {\n    return this.entries.find(verify);\n  }\n\n  public findFreeSendRecvEntry(type: WebRTCLineType, isSending: boolean) {\n    let entry = this.entries.find((entry) => {\n      return entry.direction === 'sendrecv' && entry.type === type && !(isSending ? entry.sendEntry : entry.recvEntry);\n    });\n\n    if(!entry) {\n      entry = this.createEntry(type);\n      entry.setDirection('sendrecv');\n    }\n\n    return entry;\n  }\n\n  public getEntryByMid(mid: ConferenceEntry['mid']) {\n    return this.entriesByMid.get(mid);\n  }\n\n  public getEntryBySource(source: ConferenceEntry['source']) {\n    return this.entriesBySource.get(source);\n  }\n\n  public getEntriesByPeerId(peerId: ConferenceEntry['peerId']) {\n    return this.entriesByPeerId.get(peerId);\n  }\n\n  public generateSdp(options: Omit<Parameters<SDPBuilder['addConference']>[0], 'conference'>) {\n    return SDPBuilder.fromConference({\n      conference: this,\n      ...options\n    });\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport SDPMediaSection from './mediaSection';\nimport SDPSessionSection from './sessionSection';\n\nexport type AttributeKey = 'group' | 'rtcp' | 'ice-ufrag' |\n  'ice-pwd' | 'ice-options' | 'fingerprint' | 'setup' |\n  'mid' | 'extmap' | 'sendonly' | 'msid' | 'rtcp-mux' |\n  'rtpmap' | 'rtcp-fb' | 'fmtp' | 'ssrc' | 'ssrc-group' |\n  'extmap-allow-mixed' | 'msid-semantic';\n\nexport type AttributeMap = {[k in AttributeKey]?: boolean};\n\nexport default class SDP {\n  #session: SDPSessionSection;\n  #media: SDPMediaSection[];\n\n  constructor(session: SDP['session'], mediaSections: SDP['media']) {\n    this.#session = session;\n    this.#media = mediaSections;\n  }\n\n  public get session() {\n    return this.#session;\n  }\n\n  public get media() {\n    return this.#media;\n  }\n\n  public get bundle() {\n    const bundleLine = this.session.lines.find((line) => line.parsed?.key === 'group');\n    return bundleLine.value.split(' ').slice(1);\n  }\n\n  toString() {\n    return this.session.lines\n    .concat(...this.media.map((section) => section.lines))\n    .map((line) => line.toString()).join('\\r\\n') + '\\r\\n';\n  }\n\n  /* get buggedMedia() {\n    const bundle = this.bundle;\n    type A = {\n      mid: SDPMediaSection['mid'],\n      mediaType: SDPMediaSection['mediaType'],\n      direction: SDPMediaSection['direction']\n    };\n    const out: A[] = [];\n    for(let i = 0, length = this.media.length; i < length; ++i) {\n      const section = this.media[i];\n      const mid = section.mid;\n      if(!bundle.includes(mid)) {\n        out.push(section);\n      }\n    }\n\n    return out;\n  } */\n\n  /* get mediaTypes() {\n    return this.media.map((section) => {\n      return {mid: section.oa.get('mid').oa, type: section.mediaType, direction: section.direction};\n    });\n  } */\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nexport default function splitStringByLimitWithRest(str: string, separator: string, limit: number) {\n  const splitted = str.split(separator);\n  const out: string[] = [];\n\n  while(limit > 0 && splitted.length) {\n    out.push(splitted.shift());\n    --limit;\n  }\n\n  if(splitted.length) {\n    out.push(splitted.join(separator));\n  }\n\n  return out;\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nexport default class UniqueNumberGenerator {\n  #set: Set<number>;\n  #min: number;\n  #max: number;\n\n  constructor(min: number, max: number) {\n    this.#set = new Set();\n    this.#min = min;\n    this.#max = max;\n  }\n\n  public generate() {\n    const min = this.#min;\n    const max = this.#max;\n    const set = this.#set;\n\n    const maxTries = max - min + 1;\n    let value = Math.floor(min + maxTries * Math.random()), _try = 0;\n    while(set.has(value)) {\n      if(value < max) {\n        ++value;\n      } else {\n        value = min;\n      }\n\n      if(++_try >= maxTries) {\n        return null;\n      }\n    }\n\n    set.add(value);\n    return value;\n  }\n\n  public add(value: number) {\n    this.#set.add(value);\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport {AttributeKey} from '.';\n\nexport default class SDPAttributeSplitted {\n  #key: AttributeKey;\n  #value: string;\n\n  // key = 'ssrc-group', value = 'SIM 1 2 3'\n  constructor(key: AttributeKey, value: string) {\n    this.#key = key;\n    this.#value = value;\n  }\n\n  public get key() {\n    return this.#key;\n  }\n\n  public get value() {\n    return this.#value;\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nexport default class SDPMediaLineParts {\n  #type: 'audio' | 'video' | 'application';\n  #port: string;\n  #protocol: string;\n  #ids: string[];\n\n  constructor(\n    type: SDPMediaLineParts['type'],\n    port: SDPMediaLineParts['port'],\n    protocol: SDPMediaLineParts['protocol'],\n    ids: SDPMediaLineParts['ids']\n  ) {\n    this.#type = type;\n    this.#port = port;\n    this.#protocol = protocol;\n    this.#ids = ids;\n  }\n\n  public get type() {\n    return this.#type;\n  }\n\n  public get port() {\n    return this.#port;\n  }\n\n  public get protocol() {\n    return this.#protocol;\n  }\n\n  public get ids() {\n    return this.#ids;\n  }\n\n  toString() {\n    return this.type + ' ' + this.port + ' ' + this.protocol + ' ' + this.ids.join(' ');\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport splitStringByLimitWithRest from '../../../helpers/string/splitStringByLimitWithRest';\nimport SDPAttributeSplitted from './attributeSplitted';\nimport SDPMediaLineParts from './mediaLineParts';\n\nexport default class SDPLine {\n  #key: 'm' | 'a' | 'o' | 'v' | 's' | 't' | 'c';\n  #value: string;\n  #mediaLineParts: SDPMediaLineParts;\n  #parsed?: SDPAttributeSplitted;\n\n  // key = 'a', value = 'ssrc-group:SIM 1 2 3'\n  constructor(key: SDPLine['key'], value: string | SDPMediaLineParts | SDPAttributeSplitted) {\n    this.#key = key;\n\n    if(typeof(value) === 'string') {\n      this.#value = value;\n\n      if(key === 'm') {\n        const splitted = value.split(' ');\n        this.#mediaLineParts = new SDPMediaLineParts(splitted[0] as any, splitted[1], splitted[2], splitted.slice(3));\n      } else {\n        if(key === 'a') {\n          const result = splitStringByLimitWithRest(value, ':', 1);\n          value = result[0];\n          this.#parsed = result.length === 1 ? new SDPAttributeSplitted(value as any, null) : new SDPAttributeSplitted(value as any, result[1]);\n        }\n      }\n    } else {\n      if(value instanceof SDPMediaLineParts) {\n        this.#mediaLineParts = value;\n        this.#value = value.toString();\n      } else if(value instanceof SDPAttributeSplitted) {\n        this.#parsed = value;\n        this.#value = value.value ? `${value.key}:${value.value}` : value.key;\n      }\n    }\n  }\n\n  public get key() {\n    return this.#key;\n  }\n\n  public get value() {\n    return this.#value;\n  }\n\n  public get parsed() {\n    return this.#parsed;\n  }\n\n  public get mediaLineParts() {\n    return this.#mediaLineParts;\n  }\n\n  toString() {\n    return `${this.key}=${this.value}`;\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport splitStringByLimitWithRest from '../../../helpers/string/splitStringByLimitWithRest';\n\nexport default class SDPAttributeInner {\n  #key: string;\n  #lines: Array<string>;\n  #prefix: string;\n  #nestedMap: Map<string, SDPAttributeInner>;\n  #missed: boolean;\n  #keys: Array<string>;\n\n  constructor(key: SDPAttributeInner['key'], lines: SDPAttributeInner['lines'], prefix: string = ':', missed = false) {\n    this.#key = key;\n    this.#lines = lines;\n    this.#prefix = prefix;\n    this.#missed = missed;\n    this.#nestedMap = missed ? new Map() : null;\n    this.#keys = missed ? [] : null;\n  }\n\n  public get lines() {\n    return this.#lines;\n  }\n\n  public get value() {\n    return this.#missed || !this.lines.length ? null : this.lines[0];\n  }\n\n  public get exists() {\n    return !this.#missed;\n  }\n\n  public get key() {\n    return this.#key;\n  }\n\n  public get keys() {\n    SDPAttributeInner.fill(this);\n    return this.#keys;\n  }\n\n  public forEach(callback: Parameters<Map<string, SDPAttributeInner>['forEach']>[0]) {\n    SDPAttributeInner.fill(this);\n    this.#nestedMap.forEach(callback);\n  }\n\n  public get(key: string) {\n    SDPAttributeInner.fill(this);\n    return this.#nestedMap.get(key) || new SDPAttributeInner(key, [], ':', true);\n  }\n\n  private static fill(attribute: SDPAttributeInner) {\n    if(attribute.#nestedMap !== null) {\n      return;\n    }\n\n    const map: Map<string, Array<string>> = new Map();\n    attribute.lines.forEach((str) => {\n      const [key, rest] = splitStringByLimitWithRest(str, attribute.#prefix, 1);\n      const values = map.get(key) || [];\n      map.set(key, [...values, rest || '']);\n    });\n\n    const nestedMap = attribute.#nestedMap = SDPAttributeInner.makeAttributes(map);\n    attribute.#keys = Array.from(nestedMap.keys());\n  }\n\n  private static makeAttributes(innerParts: Map<string, Array<string>>) {\n    const out: Map<string, SDPAttributeInner> = new Map();\n\n    innerParts.forEach((lines, key) => {\n      out.set(key, new SDPAttributeInner(key, lines));\n    });\n\n    return out;\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport SDPAttributeInner from './attributeInner';\nimport SDPLine from './line';\n\nexport default class SDPAttributes {\n  #lines: SDPLine[];\n  #attributes: Map<string, SDPAttributeInner>;\n\n  constructor(lines: SDPLine[]) {\n    this.#lines = lines;\n    this.#attributes = new Map();\n    SDPAttributes.fillAttributes(this);\n  }\n\n  public get(key: string) {\n    return this.#attributes.get(key) || new SDPAttributeInner(key, [], ' ', true);\n  }\n\n  private static fillAttributes(attributes: SDPAttributes) {\n    const attributesMap: Map<string, Array<string>> = new Map();\n    attributes.#lines.forEach((line) => {\n      if(line.key === 'a') {\n        const {key, value} = line.parsed;\n\n        let linesArray = attributesMap.get(key);\n        if(!linesArray) {\n          linesArray = [];\n          attributesMap.set(key, linesArray);\n        }\n\n        linesArray.push(value || '');\n      }\n    });\n\n    attributesMap.forEach((linesArray, key) => {\n      attributes.#attributes.set(key, new SDPAttributeInner(key, linesArray, ' ', false));\n    });\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport {AttributeMap} from '.';\nimport {NoExtraProperties} from '../../../types';\nimport SDPAttributes from './attributes';\nimport SDPLine from './line';\n\nexport type SDPMediaDirection = 'sendonly' | 'recvonly' | 'inactive' | 'sendrecv';\nexport default class SDPMediaSection {\n  #lines: Array<SDPLine>;\n  #mediaLine: SDPLine;\n  #attributes: SDPAttributes;\n  #direction: SDPMediaDirection;\n\n  constructor(lines: Array<SDPLine>) {\n    this.#lines = lines;\n    this.#mediaLine = lines[0];\n    this.#attributes = this.#direction = null;\n  }\n\n  public get lines() {\n    return this.#lines;\n  }\n\n  public get mediaLine() {\n    return this.#mediaLine;\n  }\n\n  public get mediaLineParts() {\n    return this.#mediaLine.mediaLineParts;\n  }\n\n  public get mediaType() {\n    return this.mediaLineParts.type;\n  }\n\n  public get direction() {\n    if(!this.#direction) {\n      const attributes = this.attributes;\n\n      let direction: SDPMediaDirection;\n      if(attributes.get('sendonly').exists) direction = 'sendonly';\n      else if(attributes.get('recvonly').exists) direction = 'recvonly';\n      else if(attributes.get('inactive').exists) direction = 'inactive';\n      else direction = 'sendrecv';\n\n      this.#direction = direction;\n    }\n\n    return this.#direction;\n  }\n\n  public get isSending() {\n    return this.direction === 'sendrecv' || this.direction === 'sendonly';\n  }\n\n  public get isReceiving() {\n    return this.direction === 'sendrecv' || this.direction === 'recvonly';\n  }\n\n  public get attributes() {\n    this.#attributes || (this.#attributes = new SDPAttributes(this.lines));\n    return this.#attributes;\n  }\n\n  public get mid() {\n    return this.attributes.get('mid').value;\n  }\n\n  public lookupAttributeKeys<T extends AttributeMap>(keys: NoExtraProperties<AttributeMap, T>): {[k in keyof T]: T[k] extends true ? string : string[]} {\n    const out: any = {};\n\n    for(const key in keys) {\n      const result = this.attributes.get(key);\n      // @ts-ignore\n      const resultShouldBeArray = !keys[key];\n      if(!result) {\n        out[key] = resultShouldBeArray ? [] : undefined;\n      } else {\n        out[key] = resultShouldBeArray ? result.lines : result.value;\n      }\n    }\n\n    return out;\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport SDPLine from './line';\n\nexport default class SDPSessionSection {\n  #lines: SDPLine[];\n  #sessionId: string;\n\n  constructor(lines: SDPLine[]) {\n    this.#lines = lines;\n    this.#sessionId = lines.filter((line) => line.key === 'o').map((line) => line.value.split(' ')[1])[0];\n  }\n\n  public get lines() {\n    return this.#lines;\n  }\n\n  public get sessionId() {\n    return this.#sessionId;\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport SDP from '.';\nimport splitStringByLimitWithRest from '../../../helpers/string/splitStringByLimitWithRest';\nimport UniqueNumberGenerator from '../../../helpers/uniqueNumberGenerator';\nimport SDPLine from './line';\nimport SDPMediaSection from './mediaSection';\nimport SDPSessionSection from './sessionSection';\n\nexport function parseSdp(str: string) {\n  function createSection() {\n    if(sessionSection) {\n      mediaSections.push(new SDPMediaSection(lines));\n    } else {\n      sessionSection = new SDPSessionSection(lines);\n    }\n  }\n\n  let sessionSection: SDPSessionSection = null, lines: SDPLine[] = [];\n  const mediaSections: SDPMediaSection[] = [];\n  str.split(/\\r?\\n/).forEach((lineStr) => {\n    if(!isIncorrectSdpLine(lineStr)) {\n      const line = parseSdpLine(lineStr);\n      if(line.key === 'm') {\n        createSection();\n        lines = [];\n      }\n\n      lines.push(line);\n    }\n  });\n\n  createSection();\n  return new SDP(sessionSection, mediaSections);\n}\n\nexport function isIncorrectSdpLine(str: string) {\n  return /^[\\s\\xa0]*$/.test(str);\n}\n\nexport function parseSdpLine(str: string) {\n  const splitted = splitStringByLimitWithRest(str, '=', 1);\n  return new SDPLine(splitted[0] as any, splitted[1]);\n}\n\nexport function addSimulcast(sdp: SDP) {\n  let generator: UniqueNumberGenerator;\n  sdp.media.forEach((section, idx) => {\n    if(section.mediaType === 'video' && section.isSending && !section.attributes.get('ssrc-group').get('SIM').exists) {\n      if(!generator) {\n        generator = new UniqueNumberGenerator(2, 4294967295);\n      }\n\n      const originalSsrcs = section.attributes.get('ssrc-group').get('FID').value.split(' ');\n      const lines = section.lines;\n      originalSsrcs.forEach((ssrc) => generator.add(+ssrc)); // fix possible duplicates\n      const ssrcs = [originalSsrcs[0], generator.generate(), generator.generate()];\n      const ssrcs2 = [originalSsrcs[1], generator.generate(), generator.generate()];\n\n      lines.push(parseSdpLine('a=ssrc-group:SIM ' + ssrcs.join(' ')));\n\n      const ssrcsStrLines = section.attributes.get('ssrc').get(originalSsrcs[0]).lines;\n\n      ssrcs.forEach((ssrc, idx) => {\n        const ssrc2 = ssrcs2[idx];\n        if(idx > 0) {\n          lines.push(parseSdpLine('a=ssrc-group:FID ' + ssrc + ' ' + ssrc2));\n\n          ssrcsStrLines.forEach((v) => {\n            lines.push(parseSdpLine('a=ssrc:' + ssrc + ' ' + v));\n          });\n\n          ssrcsStrLines.forEach((v) => {\n            lines.push(parseSdpLine('a=ssrc:' + ssrc2 + ' ' + v));\n          });\n        }\n      });\n\n      sdp.media[idx] = new SDPMediaSection(lines);\n    }\n  });\n\n  return !!generator;\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n *\n * Originally from:\n * https://github.com/evgeny-nadymov/telegram-react\n * Copyright (C) 2018 Evgeny Nadymov\n * https://github.com/evgeny-nadymov/telegram-react/blob/master/LICENSE\n */\n\nimport {IS_FIREFOX} from '../../environment/userAgent';\nimport LocalConferenceDescription, {ConferenceEntry} from './localConferenceDescription';\nimport StringFromLineBuilder from './stringFromLineBuilder';\nimport {GroupCallConnectionTransport, PayloadType, UpdateGroupCallConnectionData} from './types';\nimport {fromTelegramSource} from './utils';\n\n// screencast is for Peer-to-Peer only\nexport type WebRTCLineTypeTrue = 'video' | 'audio' | 'application';\nexport type WebRTCLineType = WebRTCLineTypeTrue | 'screencast';\n\nexport const WEBRTC_MEDIA_PORT = '9';\n\nexport function fixMediaLineType(mediaType: WebRTCLineType) {\n  return mediaType === 'screencast' ? 'video' : mediaType;\n}\n\nexport function performCandidate(c: GroupCallConnectionTransport['candidates'][0]) {\n  const arr: string[] = [];\n  arr.push('a=candidate:');\n  arr.push(`${c.foundation} ${c.component} ${c.protocol.toUpperCase()} ${c.priority} ${c.ip} ${c.port} typ ${c.type}`);\n  if(c['rel-addr'] !== undefined) {\n    arr.push(` raddr ${c['rel-addr']} rport ${c['rel-port']}`);\n  }\n  arr.push(` generation ${c.generation}`);\n  return arr.join('');\n}\n\nexport function getConnectionTypeForMediaType(mediaType: WebRTCLineType) {\n  // return mediaType === 'application' ? 'DTLS/SCTP' : 'RTP/SAVPF';\n  return mediaType === 'application' ? 'DTLS/SCTP' : 'UDP/TLS/RTP/SAVPF';\n}\n\nexport function generateMediaFirstLine(mediaType: WebRTCLineType, port = WEBRTC_MEDIA_PORT, payloadIds: (string | number)[]) {\n  const connectionType = getConnectionTypeForMediaType(mediaType);\n  return `m=${fixMediaLineType(mediaType)} ${port} ${connectionType} ${payloadIds.join(' ')}`;\n}\n\ntype ConferenceData = UpdateGroupCallConnectionData | LocalConferenceDescription;\n\n// https://tools.ietf.org/id/draft-ietf-rtcweb-sdp-08.html\n// https://datatracker.ietf.org/doc/html/draft-roach-mmusic-unified-plan-00\nexport class SDPBuilder extends StringFromLineBuilder {\n  public addCandidate(c: GroupCallConnectionTransport['candidates'][0]) {\n    return this.add(performCandidate(c));\n  }\n\n  /* public addDataChannel(mid: string, transport: GroupCallConnectionTransport, isAnswer?: boolean) {\n    this.add(\n      'm=application 9 UDP/DTLS/SCTP webrtc-datachannel',\n      'c=IN IP4 0.0.0.0',\n      'a=ice-options:trickle',\n      `a=mid:${mid}`\n    );\n\n    // if(!isAnswer) {\n      this.add('a=sendrecv');\n    // }\n\n    this.addTransport(transport, isAnswer);\n\n    return this.add(\n      'a=sctp-port:5000',\n      'a=max-message-size:262144'\n    );\n  } */\n\n  public addHeader(sId: string, bundleMids: string[]) {\n    const bundle = bundleMids.join(' ');\n    return this.add(\n      'v=0',                          // version\n      `o=- ${sId} 2 IN IP4 0.0.0.0`,  // sessionId, 2=sessionVersion\n      's=-',                          // name of the session\n      't=0 0',                        // time when session is valid\n      'a=extmap-allow-mixed',\n      `a=group:BUNDLE ${bundle}`,\n      'a=ice-options:trickle',\n      // 'a=ice-lite',                   // ice-lite: is a minimal version of the ICE specification, intended for servers running on a public IP address.\n      'a=msid-semantic:WMS *'\n    );\n  }\n\n  public addTransport(transport: GroupCallConnectionTransport, skipCandidates?: boolean) {\n    this.add(\n      `a=ice-ufrag:${transport.ufrag}`,\n      `a=ice-pwd:${transport.pwd}`,\n      'a=ice-options:trickle'           // ! test\n    );\n\n    for(const fingerprint of transport.fingerprints) {\n      this.add(\n        `a=fingerprint:${fingerprint.hash} ${fingerprint.fingerprint}`,\n        `a=setup:${fingerprint.setup}`\n      );\n    }\n\n    if(!skipCandidates && transport.candidates) {\n      for(const candidate of transport.candidates) {\n        this.addCandidate(candidate);\n      }\n    }\n\n    return this;\n  }\n\n  public addSsrc(entry: ConferenceEntry) {\n    let streamName = 'stream';\n    let {type, sourceGroups} = entry;\n\n    // let source = ssrc.source ?? ssrc.sourceGroups[0].sources[0];\n    // source = fromTelegramSource(source);\n    const source = fromTelegramSource(entry.source);\n\n    streamName += source;\n    type += source as any;\n\n    // streamName += mid;\n    // type += mid as any;\n\n    // streamName = type = entry.transceiver.receiver.track.id as any;\n\n    const addMsid = () => {\n      this.add(`a=msid:${streamName} ${type}`);\n    };\n\n    const addSource = (ssrc: number) => {\n      this.add(\n        `a=ssrc:${ssrc} cname:${streamName}`,\n        `a=ssrc:${ssrc} msid:${streamName} ${type}`,\n        `a=ssrc:${ssrc} mslabel:${streamName}`,\n        `a=ssrc:${ssrc} label:${type}`\n      );\n    };\n\n    addMsid();\n    if(sourceGroups?.length) {\n      sourceGroups.forEach((ssrcGroup) => {\n        if(ssrcGroup.sources.length) {\n          const sources = ssrcGroup.sources.map(fromTelegramSource);\n          this.add(`a=ssrc-group:${ssrcGroup.semantics} ${sources.join(' ')}`);\n          sources.forEach(addSource);\n        }\n      });\n    } else {\n      addSource(source);\n    }\n\n    return this;\n  }\n\n  public addSsrcEntry(entry: ConferenceEntry, data: ConferenceData, isAnswer?: boolean) {\n    const add = (...x: string[]) => this.add(...x);\n\n    const {type, mid, direction, port} = entry;\n    const transport = data.transport;\n\n    /* if(type === 'application') {\n      return this.addDataChannel(mid, transport, isAnswer);\n    } */\n\n    const isApplication = type === 'application';\n    const codec = isApplication ? undefined : data[type];\n\n    const isInactive = direction === 'inactive';\n    if(entry.shouldBeSkipped(isAnswer)) {\n      return add(\n        `m=${fixMediaLineType(type)} 0 ${getConnectionTypeForMediaType(type)} 0`,\n        `c=IN IP4 0.0.0.0`,\n        `a=inactive`,\n        `a=mid:${mid}`\n      );\n    }\n\n    const payloadTypes = !isApplication ? codec['payload-types'] : [{id: 5000} as PayloadType];\n    const ids = payloadTypes.map((type) => type.id);\n    add(\n      generateMediaFirstLine(type, port, ids),\n      'c=IN IP4 0.0.0.0',\n      `a=rtcp:${port} IN IP4 0.0.0.0`\n    );\n\n    if(transport['rtcp-mux']) {\n      add('a=rtcp-mux');\n    }\n\n    add(`a=mid:${mid}`);\n    /* if(type === 'video') {\n      add('b=AS:2500');\n    } */\n\n    let setDirection = direction;\n    if(direction !== 'sendrecv' && isAnswer && !(isInactive || isApplication)) {\n      setDirection = direction === 'sendonly' ? 'recvonly' : 'sendonly';\n    }\n\n    // a=bundle-only\n    add(`a=${setDirection}`);\n\n    // this.addTransport(transport, isAnswer);\n    this.addTransport(transport);\n\n    if(!isApplication) {\n      const hdrexts = codec['rtp-hdrexts'];\n      if(hdrexts?.length) {\n        hdrexts.forEach((hdrext) => {\n          add(`a=extmap:${hdrext.id} ${hdrext.uri}`);\n        });\n      }\n\n      payloadTypes.forEach((type) => {\n        add(`a=rtpmap:${type.id} ${type.name}/${type.clockrate}${type.channels && type.channels > 1 ? `/${type.channels}` : ''}`);\n\n        const parameters = type.parameters;\n        if(Array.isArray(parameters)) {\n          if(parameters.length) {\n            console.error('parameters is array???', parameters);\n          }\n        } else if(parameters && Object.keys(parameters).length) {\n          const p: string[] = [];\n          for(const i in parameters) {\n            p.push(`${i}=${parameters[i]}`);\n          }\n          add(`a=fmtp:${type.id} ${p.join(';')}`);\n        }\n\n        const fbs = type['rtcp-fbs'];\n        if(fbs?.length) {\n          fbs.forEach((fb) => {\n            add(`a=rtcp-fb:${type.id} ${fb.type}${fb.subtype ? ' ' + fb.subtype : ''}`);\n          });\n        }\n      });\n    } else {\n      add(`a=sctpmap:${payloadTypes[0].id} webrtc-datachannel 256`);\n    }\n\n    if(entry.source && (setDirection === 'sendonly' || setDirection === 'sendrecv')) {\n      this.addSsrc(entry);\n    }\n\n    return this;\n  }\n\n  public addConference(options: {\n    conference: LocalConferenceDescription,\n    bundle: string[],\n    entries: ConferenceEntry[],\n    isAnswer?: boolean,\n  }) {\n    const {conference, entries, bundle, isAnswer} = options;\n    this.addHeader(conference.sessionId, bundle);\n\n    if(IS_FIREFOX) {\n      this.addTransport(conference.transport); // support Firefox\n    }\n\n    for(const entry of entries) {\n      // this.addSsrcEntry(entry, conference, isAnswer);\n      this.addSsrcEntry((isAnswer ? entry.recvEntry || entry.sendEntry : entry.sendEntry || entry.recvEntry) || entry, conference, isAnswer);\n    }\n\n    return this;\n  }\n\n  public static fromConference(options: Parameters<SDPBuilder['addConference']>[0]) {\n    return new SDPBuilder().addConference(options).finalize();\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n *\n * Originally from:\n * https://github.com/evgeny-nadymov/telegram-react\n * Copyright (C) 2018 Evgeny Nadymov\n * https://github.com/evgeny-nadymov/telegram-react/blob/master/LICENSE\n */\n\nimport EventListenerBase from '../../helpers/eventListenerBase';\nimport {logger} from '../logger';\nimport rootScope from '../rootScope';\nimport {GROUP_CALL_AMPLITUDE_ANALYSE_COUNT_MAX} from './constants';\nimport stopTrack from './helpers/stopTrack';\nimport LocalConferenceDescription from './localConferenceDescription';\nimport {fixMediaLineType, WebRTCLineType} from './sdpBuilder';\nimport {getAmplitude, toTelegramSource} from './utils';\n\nexport type StreamItemBase = {\n  type: 'input' | 'output',\n  track: MediaStreamTrack,\n  source: string,\n  stream: MediaStream\n};\n\nexport type StreamItem = StreamAudioItem | StreamVideoItem;\n\nexport type StreamAudioItem = StreamItemBase & {kind: 'audio', streamAnalyser: AudioStreamAnalyser};\nexport type StreamVideoItem = StreamItemBase & {kind: 'video'};\n\nexport type StreamAmplitude = {\n  type: 'input' | 'output';\n  source: string;\n  stream: MediaStream;\n  track: MediaStreamTrack;\n  value: number;\n};\n\nclass AudioStreamAnalyser {\n  public analyser: AnalyserNode;\n  public gain: GainNode;\n  public streamSource: MediaStreamAudioSourceNode;\n\n  constructor(context: AudioContext, stream: MediaStream) {\n    const streamSource = this.streamSource = context.createMediaStreamSource(stream);\n    const analyser = this.analyser = context.createAnalyser();\n    const gain = this.gain = context.createGain();\n    // const streamDestination = context.createMediaStreamDestination();\n\n    analyser.minDecibels = -100;\n    analyser.maxDecibels = -30;\n    analyser.smoothingTimeConstant = 0.05;\n    analyser.fftSize = 1024;\n\n    // connect Web Audio API\n    streamSource.connect(analyser);\n    // analyser.connect(context.destination);\n  }\n}\n\nexport default class StreamManager {\n  public static ANALYSER_LISTENER = new EventListenerBase<{amplitude: (details: {amplitudes: StreamAmplitude[], type: 'all' | 'input'}) => void}>();\n  private context: AudioContext;\n  public outputStream: MediaStream;\n  public inputStream: MediaStream;\n\n  private timer: number;\n  private counter: number;\n\n  private items: StreamItem[];\n\n  private log: ReturnType<typeof logger>;\n\n  public direction: RTCRtpTransceiver['direction'];\n  public canCreateConferenceEntry: boolean;\n  public locked: boolean;\n  public types: WebRTCLineType[];\n\n  constructor(private interval?: number) {\n    this.context = new (window.AudioContext || (window as any).webkitAudioContext)();\n    this.items = [];\n    this.outputStream = new MediaStream();\n    this.inputStream = new MediaStream();\n    this.counter = 0;\n    this.log = logger('SM');\n    this.direction = 'sendonly';\n    this.canCreateConferenceEntry = true;\n    // this.lol = true;\n    this.types = ['audio', 'video'];\n  }\n\n  public addStream(stream: MediaStream, type: StreamItem['type']) {\n    stream.getTracks().forEach((track) => {\n      this.addTrack(stream, track, type);\n    });\n  }\n\n  public addTrack(stream: MediaStream, track: MediaStreamTrack, type: StreamItem['type']) {\n    this.log('addTrack', type, track, stream);\n\n    const {context, items, inputStream, outputStream} = this;\n    const kind: StreamItem['kind'] = track.kind as any;\n    const source = StreamManager.getSource(stream, type);\n\n    // this.removeTrack(track);\n    switch(type) {\n      case 'input': {\n        if(!inputStream) {\n          this.inputStream = stream;\n        } else {\n          inputStream.addTrack(track);\n        }\n\n        break;\n      }\n\n      case 'output': {\n        for(let i = 0; i < items.length; ++i) {\n          const {track: t, type, source: itemSource} = items[i];\n          if(itemSource === source && type === 'input') {\n            items.splice(i, 1);\n            outputStream.removeTrack(t);\n            break;\n          }\n        }\n\n        if(kind !== 'video') {\n          outputStream.addTrack(track);\n        }\n\n        break;\n      }\n    }\n\n    this.finalizeAddingTrack({\n      type,\n      source,\n      stream,\n      track,\n      kind,\n      streamAnalyser: kind === 'audio' ? new AudioStreamAnalyser(context, stream) : undefined\n    });\n\n    if(kind === 'audio' && this.interval) {\n      this.changeTimer();\n    }\n  }\n\n  private finalizeAddingTrack(item: StreamItem) {\n    const {track} = item;\n    track.addEventListener('ended', () => {\n      this.removeTrack(track);\n    }, {once: true});\n\n    this.items.push(item);\n  }\n\n  public hasInputTrackKind(kind: StreamItem['kind']) {\n    return this.items.find((item) => item.type === 'input' && item.kind === kind);\n  }\n\n  public static getSource(stream: MediaStream, type: StreamItem['type']) {\n    return type === 'input' ? (stream.source || stream.id) : '' + toTelegramSource(+stream.id.substring(6));\n  }\n\n  public removeTrack(track: MediaStreamTrack) {\n    this.log('removeTrack', track);\n\n    const {items} = this;\n\n    let handled = false;\n    for(let i = 0, length = items.length; !handled && i < length; ++i) {\n      const {track: t, type} = items[i];\n      switch(type) {\n        case 'output': {\n          if(t === track) {\n            items.splice(i, 1);\n            this.outputStream.removeTrack(track);\n            handled = true;\n          }\n\n          break;\n        }\n\n        case 'input': {\n          if(t === track) {\n            items.splice(i, 1);\n            this.inputStream.removeTrack(track);\n            handled = true;\n          }\n\n          break;\n        }\n      }\n    }\n\n    if(track.kind === 'audio' && this.interval) {\n      this.changeTimer();\n    }\n  }\n\n  public replaceInputAudio(stream: MediaStream, oldTrack: MediaStreamTrack) {\n    this.removeTrack(oldTrack);\n    this.addStream(stream, 'input');\n  }\n\n  private changeTimer() {\n    if(this.timer !== undefined) {\n      clearInterval(this.timer);\n    }\n\n    if(this.items.length) {\n      this.timer = window.setInterval(this.analyse, this.interval);\n    }\n  }\n\n  public getAmplitude = (item: StreamAudioItem): StreamAmplitude => {\n    const {streamAnalyser, stream, track, source, type} = item;\n    const analyser = streamAnalyser.analyser;\n    if(!analyser) return;\n\n    const array = new Uint8Array(analyser.frequencyBinCount);\n    analyser.getByteFrequencyData(array);\n    const value = getAmplitude(array);\n\n    return {\n      type,\n      source,\n      stream,\n      track,\n      value\n    };\n  };\n\n  public analyse = () => {\n    const all = this.counter % 3 === 0;\n    const filteredItems = all ? this.items : this.items.filter((x) => x.type === 'input');\n    const audioItems = filteredItems.filter((x) => x.kind === 'audio') as StreamAudioItem[];\n    const amplitudes = audioItems.slice(0, GROUP_CALL_AMPLITUDE_ANALYSE_COUNT_MAX).map(this.getAmplitude);\n    if(++this.counter >= 1000) {\n      this.counter = 0;\n    }\n\n    StreamManager.ANALYSER_LISTENER.dispatchEvent('amplitude', {\n      amplitudes,\n      type: all ? 'all' : 'input'\n    });\n  };\n\n  /* public appendToConnection(connection: RTCPeerConnection) {\n    if(this.inputStream) {\n      this.inputStream.getTracks().forEach((track) => {\n        connection.log('addTrack', track);\n        connection.addTrack(track, this.inputStream);\n\n        if(track.kind === 'video') {\n          track.enabled = true;\n        }\n      });\n    }\n  } */\n\n  public appendToConference(conference: LocalConferenceDescription) {\n    if(this.locked) {\n      return;\n    }\n\n    const {inputStream, direction, canCreateConferenceEntry} = this;\n    const transceiverInit: RTCRtpTransceiverInit = {direction, streams: [inputStream]};\n    const types = this.types.map((type) => {\n      return [\n        type,\n        /* type === 'video' || type === 'screencast' ?\n          {sendEncodings: [{maxBitrate: 2500000}], ...transceiverInit} :  */\n        transceiverInit\n      ] as const;\n    });\n\n    const tracks = inputStream.getTracks();\n    // const transceivers = conference.connection.getTransceivers();\n    for(const [type, transceiverInit] of types) {\n      let entry = conference.findEntry((entry) => entry.direction === direction && entry.type === type);\n      if(!entry) {\n        if(!canCreateConferenceEntry) {\n          continue;\n        }\n\n        entry = conference.createEntry(type);\n      }\n      /* const entry = conference.findFreeSendRecvEntry(type, true);\n      if(!entry.transceiver) {\n        entry.transceiver = transceivers.find((transceiver) => transceiver.mid === entry.mid);\n      } */\n\n      let {transceiver} = entry;\n      if(!transceiver) {\n        transceiver = entry.createTransceiver(conference.connection, transceiverInit);\n\n        /* if(this.isScreenSharingManager) {\n          transceiver.sender.setParameters({\n            ...transceiver.sender.getParameters(),\n            degradationPreference: 'maintain-resolution'\n          });\n        } */\n      }\n\n      if(entry.direction !== transceiver.direction) {\n        transceiver.direction = entry.direction;\n      }\n\n      const mediaTrackType = fixMediaLineType(type);\n      const trackIdx = tracks.findIndex((track) => track.kind === mediaTrackType);\n      const track = trackIdx !== -1 ? tracks.splice(trackIdx, 1)[0] : undefined;\n      const sender = transceiver.sender;\n      if(sender.track === track) {\n        continue;\n      }\n\n      // try { // ! don't use await here. it will wait for adding track and fake one won't be visible in startNegotiation.\n      /* await  */sender.replaceTrack(track).catch((err) => {\n        this.log.error(err);\n      });\n      // } catch(err) {\n\n      // }\n    }\n  }\n\n  public stop() {\n    try {\n      const tracks = this.inputStream.getTracks().concat(this.outputStream.getTracks());\n      tracks.forEach((track) => {\n        stopTrack(track);\n      });\n    } catch(e) {\n      this.log.error(e);\n    }\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n *\n * Originally from:\n * https://github.com/evgeny-nadymov/telegram-react\n * Copyright (C) 2018 Evgeny Nadymov\n * https://github.com/evgeny-nadymov/telegram-react/blob/master/LICENSE\n */\n\nexport default class StringFromLineBuilder {\n  private lines: string[];\n  private newLine: string[];\n\n  constructor(private joiner = '\\r\\n') {\n    this.lines = [];\n    this.newLine = [];\n  }\n\n  public add(...strs: string[]) {\n    this.lines.push(...strs);\n    return this;\n  }\n\n  public push(word: string) {\n    this.newLine.push(word);\n    return this;\n  }\n\n  public addJoined(separator = '') {\n    this.add(this.newLine.join(separator));\n    this.newLine = [];\n    return this;\n  }\n\n  public join() {\n    return this.lines.join(this.joiner);\n  }\n\n  public finalize() {\n    return this.join() + this.joiner;\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n *\n * Originally from:\n * https://github.com/evgeny-nadymov/telegram-react\n * Copyright (C) 2018 Evgeny Nadymov\n * https://github.com/evgeny-nadymov/telegram-react/blob/master/LICENSE\n */\n\n// NOTE: telegram returns sign source, while webrtc uses unsign source internally\n// unsign => sign\nexport function toTelegramSource(source: number) {\n  return source << 0;\n}\n\n// NOTE: telegram returns sign source, while webrtc uses unsign source internally\n// sign => unsign\nexport function fromTelegramSource(source: number) {\n  return source >>> 0;\n}\n\nexport function getAmplitude(array: Uint8Array, scale = 3) {\n  if(!array) return 0;\n\n  const {length} = array;\n  let total = 0;\n  for(let i = 0; i < length; ++i) {\n    total += array[i] * array[i];\n  }\n  const rms = Math.sqrt(total / length) / 255;\n\n  return Math.min(1, rms * scale);\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport wrapEmojiText from './wrapEmojiText';\n\nexport default function getAbbreviation(str: string, onlyFirst = false) {\n  if(!str) return '';\n  const splitted = str.trim().split(' ');\n  if(!splitted[0]) return '';\n\n  const first = [...splitted[0]][0];\n\n  if(onlyFirst || splitted.length === 1) return wrapEmojiText(first);\n\n  const last = [...splitted[splitted.length - 1]][0];\n\n  return wrapEmojiText(first + last);\n}\n","import {MessageEntity} from '../../layer';\nimport {toCodePoints} from '../../vendor/emoji';\n\nexport default function getEmojiEntityFromEmoji(emoji: string): MessageEntity.messageEntityEmoji {\n  return {\n    _: 'messageEntityEmoji',\n    offset: 0,\n    length: emoji.length,\n    unicode: toCodePoints(emoji).join('-').replace(/-?fe0f/g, '')\n  };\n}\n","import {EMAIL_REG_EXP} from '.';\n\nexport default function matchEmail(text: string) {\n  return !text ? null : text.match(EMAIL_REG_EXP);\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport {MessageEntity} from '../../layer';\nimport wrapRichText from './wrapRichText';\n\nexport default function wrapDraftText(text: string, options: Partial<{\n  entities: MessageEntity[]\n}> = {}) {\n  if(!text) {\n    return wrapRichText('');\n  }\n\n  return wrapRichText(text, {\n    entities: options.entities,\n    noLinks: true,\n    wrappingDraft: true,\n    passEntities: {\n      messageEntityTextUrl: true,\n      messageEntityMentionName: true\n    }\n  });\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport parseEntities from './parseEntities';\nimport wrapRichText from './wrapRichText';\n\nexport default function wrapEmojiText(text: string, isDraft = false) {\n  if(!text) return wrapRichText('');\n\n  const entities = parseEntities(text).filter((e) => e._ === 'messageEntityEmoji');\n  return wrapRichText(text, {entities, wrappingDraft: isDraft});\n}\n","export default function setBlankToAnchor(anchor: HTMLAnchorElement) {\n  anchor.target = '_blank';\n  anchor.rel = 'noopener noreferrer';\n  return anchor;\n}\n","import IS_EMOJI_SUPPORTED from './emojiSupport';\n\nexport type EMOJI_VERSION = '' | '14';\n\nconst EMOJI_VERSIONS_SUPPORTED: {\n  [v in EMOJI_VERSION]: boolean\n} = {} as any;\n\n// Thanks to WebZ for the detect\nfunction isEmojiSupported(emoji: string) {\n  const ALLOWABLE_CALCULATION_ERROR_SIZE = 5;\n  const inlineEl = document.createElement('span');\n  inlineEl.classList.add('emoji');\n  document.body.appendChild(inlineEl);\n\n  inlineEl.innerText = emoji; // Emoji from 14.0 version\n  const newEmojiWidth = inlineEl.offsetWidth;\n  inlineEl.innerText = ''; // Emoji from 1.0 version\n  const legacyEmojiWidth = inlineEl.offsetWidth;\n\n  document.body.removeChild(inlineEl);\n\n  return Math.abs(newEmojiWidth - legacyEmojiWidth) < ALLOWABLE_CALCULATION_ERROR_SIZE;\n}\n\nif(IS_EMOJI_SUPPORTED) {\n  EMOJI_VERSIONS_SUPPORTED[''] = true;\n\n  const a: [keyof typeof EMOJI_VERSIONS_SUPPORTED, string][] = [\n    ['14', '']\n  ];\n\n  a.forEach(([version, emoji]) => {\n    EMOJI_VERSIONS_SUPPORTED[version] = isEmojiSupported(emoji);\n  });\n}\n\nexport default EMOJI_VERSIONS_SUPPORTED;\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport type {EMOJI_VERSION} from '../../environment/emojiVersionsSupport';\nimport {SITE_HASHTAGS} from '.';\nimport {EmojiVersions} from '../../config/emoji';\nimport IS_EMOJI_SUPPORTED from '../../environment/emojiSupport';\nimport {IS_SAFARI} from '../../environment/userAgent';\nimport buildURLHash from '../../helpers/buildURLHash';\nimport copy from '../../helpers/object/copy';\nimport encodeEntities from '../../helpers/string/encodeEntities';\nimport {MessageEntity} from '../../layer';\nimport encodeSpoiler from './encodeSpoiler';\nimport parseEntities from './parseEntities';\nimport setBlankToAnchor from './setBlankToAnchor';\nimport wrapUrl from './wrapUrl';\nimport EMOJI_VERSIONS_SUPPORTED from '../../environment/emojiVersionsSupport';\nimport {CLICK_EVENT_NAME} from '../../helpers/dom/clickEvent';\nimport IS_CUSTOM_EMOJI_SUPPORTED from '../../environment/customEmojiSupport';\nimport rootScope from '../rootScope';\nimport mediaSizes from '../../helpers/mediaSizes';\nimport {wrapSticker} from '../../components/wrappers';\nimport RLottiePlayer from '../rlottie/rlottiePlayer';\nimport animationIntersector, {AnimationItemGroup} from '../../components/animationIntersector';\nimport type {MyDocument} from '../appManagers/appDocsManager';\nimport LazyLoadQueue from '../../components/lazyLoadQueue';\nimport {Awaited} from '../../types';\nimport {MediaSize} from '../../helpers/mediaSize';\nimport IS_WEBM_SUPPORTED from '../../environment/webmSupport';\nimport assumeType from '../../helpers/assumeType';\nimport noop from '../../helpers/noop';\nimport indexOfAndSplice from '../../helpers/array/indexOfAndSplice';\nimport findUpClassName from '../../helpers/dom/findUpClassName';\nimport getViewportSlice from '../../helpers/dom/getViewportSlice';\nimport {getMiddleware, Middleware} from '../../helpers/middleware';\n\nconst resizeObserver = new ResizeObserver((entries) => {\n  for(const entry of entries) {\n    const renderer = entry.target.parentElement as CustomEmojiRendererElement;\n    renderer.setDimensionsFromRect(entry.contentRect);\n  }\n});\n\nclass CustomEmojiElement extends HTMLElement {\n  public elements: CustomEmojiElement[];\n  public renderer: CustomEmojiRendererElement;\n  public player: RLottiePlayer | HTMLVideoElement;\n  public paused: boolean;\n  public syncedPlayer: SyncedPlayer;\n\n  constructor() {\n    super();\n    this.paused = true;\n  }\n\n  public connectedCallback() {\n    if(this.player) {\n      animationIntersector.addAnimation(this, this.renderer.animationGroup);\n    }\n\n    this.connectedCallback = undefined;\n  }\n\n  public disconnectedCallback() {\n    if(this.syncedPlayer) {\n      this.syncedPlayer.pausedElements.delete(this);\n    }\n\n    // otherwise https://bugs.chromium.org/p/chromium/issues/detail?id=1144736#c27 will happen\n    this.textContent = '';\n\n    this.disconnectedCallback = this.elements = this.renderer = this.player = this.syncedPlayer = undefined;\n  }\n\n  public pause() {\n    if(this.paused) {\n      return;\n    }\n\n    this.paused = true;\n\n    if(this.player instanceof HTMLVideoElement) {\n      this.renderer.lastPausedVideo = this.player;\n      this.player.pause();\n    }\n\n    if(this.syncedPlayer && !this.syncedPlayer.pausedElements.has(this)) {\n      this.syncedPlayer.pausedElements.add(this);\n\n      if(this.syncedPlayer.pausedElements.size === this.syncedPlayer.elementsCounter) {\n        this.syncedPlayer.player.pause();\n      }\n    }\n  }\n\n  public play() {\n    if(!this.paused) {\n      return;\n    }\n\n    this.paused = false;\n\n    if(this.player instanceof HTMLVideoElement) {\n      this.player.currentTime = this.renderer.lastPausedVideo?.currentTime || this.player.currentTime;\n      this.player.play().catch(noop);\n    }\n\n    if(this.syncedPlayer && this.syncedPlayer.pausedElements.has(this)) {\n      this.syncedPlayer.pausedElements.delete(this);\n\n      if(this.syncedPlayer.pausedElements.size !== this.syncedPlayer.elementsCounter) {\n        this.player.play();\n      }\n    }\n  }\n\n  public remove() {\n    this.elements = this.renderer = this.player = undefined;\n  }\n\n  public get autoplay() {\n    return true;\n  }\n}\n\nexport class CustomEmojiRendererElement extends HTMLElement {\n  public canvas: HTMLCanvasElement;\n  public context: CanvasRenderingContext2D;\n\n  public playersSynced: Map<CustomEmojiElement[], RLottiePlayer | HTMLVideoElement>;\n  public syncedElements: Map<SyncedPlayer, CustomEmojiElement[]>;\n  public clearedElements: Set<CustomEmojiElement[]>;\n  public lastPausedVideo: HTMLVideoElement;\n\n  public lastRect: DOMRect;\n  public isDimensionsSet: boolean;\n\n  public animationGroup: AnimationItemGroup;\n  public size: MediaSize;\n\n  public lazyLoadQueue: LazyLoadQueue;\n\n  constructor() {\n    super();\n\n    this.classList.add('custom-emoji-renderer');\n    this.canvas = document.createElement('canvas');\n    this.canvas.classList.add('custom-emoji-canvas');\n    this.context = this.canvas.getContext('2d');\n    this.append(this.canvas);\n\n    this.playersSynced = new Map();\n    this.syncedElements = new Map();\n    this.clearedElements = new Set();\n\n    this.animationGroup = 'EMOJI';\n  }\n\n  public connectedCallback() {\n    // this.setDimensions();\n    // animationIntersector.addAnimation(this, this.animationGroup);\n    resizeObserver.observe(this.canvas);\n    emojiRenderers.push(this);\n\n    this.connectedCallback = undefined;\n  }\n\n  public disconnectedCallback() {\n    for(const [syncedPlayer, elements] of this.syncedElements) {\n      if(syncedPlayers.get(syncedPlayer.key) !== syncedPlayer) {\n        continue;\n      }\n\n      if(elements) {\n        syncedPlayer.elementsCounter -= elements.length;\n      }\n\n      if(!--syncedPlayer.counter) {\n        if(syncedPlayer.player) {\n          const frame = syncedPlayersFrames.get(syncedPlayer.player);\n          if(frame) {\n            (frame as ImageBitmap).close?.();\n            syncedPlayersFrames.delete(syncedPlayer.player);\n          }\n\n          syncedPlayersFrames.delete(syncedPlayer.player);\n          syncedPlayer.player.overrideRender = noop;\n          syncedPlayer.player.remove();\n          syncedPlayer.player = undefined;\n        }\n\n        syncedPlayers.delete(syncedPlayer.key);\n\n        if(!syncedPlayers.size) {\n          clearRenderInterval();\n        }\n      }\n    }\n\n    resizeObserver.unobserve(this.canvas);\n\n    indexOfAndSplice(emojiRenderers, this);\n    this.playersSynced.clear();\n    this.syncedElements.clear();\n    this.clearedElements.clear();\n    this.lazyLoadQueue?.clear();\n    this.middlewareHelper?.clean();\n\n    this.disconnectedCallback = this.lastPausedVideo = this.lazyLoadQueue = undefined;\n  }\n\n  public getOffsets(offsetsMap: Map<CustomEmojiElement[], {top: number, left: number}[]> = new Map()) {\n    if(!this.playersSynced.size) {\n      return offsetsMap;\n    }\n\n    const overflowElement = findUpClassName(this, 'scrollable') || this.offsetParent as HTMLElement;\n    const overflowRect = overflowElement.getBoundingClientRect();\n    const rect = this.getBoundingClientRect();\n\n    for(const elements of this.playersSynced.keys()) {\n      const {visible} = getViewportSlice({\n        overflowElement,\n        overflowRect,\n        elements,\n        extraSize: this.size.height * 2.5 // let's add some margin\n      });\n\n      const offsets = visible.map(({rect: elementRect}) => {\n        const top = elementRect.top - rect.top;\n        const left = elementRect.left - rect.left;\n        return {top, left};\n      });\n\n      if(offsets.length) {\n        offsetsMap.set(elements, offsets);\n      }\n    }\n\n    // const rect = this.getBoundingClientRect();\n    // const visibleRect = getVisibleRect(this, overflowElement, undefined, rect);\n    // const minTop = visibleRect ? visibleRect.rect.top - this.size.height : 0;\n    // const maxTop = Infinity;\n    // for(const elements of this.playersSynced.keys()) {\n    //   const offsets = elements.map((element) => {\n    //     const elementRect = element.getBoundingClientRect();\n    //     const top = elementRect.top - rect.top;\n    //     const left = elementRect.left - rect.left;\n    //     return top >= minTop && (top + elementRect.height) <= maxTop ? {top, left} : undefined;\n    //   }).filter(Boolean);\n\n    //   if(offsets.length) {\n    //     offsetsMap.set(elements, offsets);\n    //   }\n    // }\n\n    return offsetsMap;\n  }\n\n  public clearCanvas() {\n    const {context, canvas} = this;\n    context.clearRect(0, 0, canvas.width, canvas.height);\n  }\n\n  public render(offsetsMap: ReturnType<CustomEmojiRendererElement['getOffsets']>) {\n    const {context, canvas, isDimensionsSet} = this;\n    if(!isDimensionsSet) {\n      this.setDimensionsFromRect();\n    }\n\n    const {width, height, dpr} = canvas;\n    for(const [elements, offsets] of offsetsMap) {\n      const player = this.playersSynced.get(elements);\n      const frame = syncedPlayersFrames.get(player);\n      if(!frame) {\n        continue;\n      }\n\n      const isImageData = frame instanceof ImageData;\n      const {width: frameWidth, height: frameHeight} = frame;\n      const maxTop = height - frameHeight;\n      const maxLeft = width - frameWidth;\n\n      if(!this.clearedElements.has(elements)) {\n        elements.forEach((element) => {\n          element.textContent = '';\n        });\n\n        this.clearedElements.add(elements);\n      }\n\n      offsets.forEach(({top, left}) => {\n        top = Math.round(top * dpr), left = Math.round(left * dpr);\n        if(/* top > maxTop ||  */left > maxLeft) {\n          return;\n        }\n\n        if(isImageData) {\n          context.putImageData(frame as ImageData, left, top);\n        } else {\n          // context.clearRect(left, top, width, height);\n          context.drawImage(frame as ImageBitmap, left, top, frameWidth, frameHeight);\n        }\n      });\n    }\n  }\n\n  public checkForAnyFrame() {\n    for(const player of this.playersSynced.values()) {\n      if(syncedPlayersFrames.has(player)) {\n        return true;\n      }\n    }\n\n    return false;\n  }\n\n  public remove() {\n    // this.canvas.remove();\n  }\n\n  // public setDimensions() {\n  //   const {canvas} = this;\n  //   sequentialDom.mutateElement(canvas, () => {\n  //     const rect = canvas.getBoundingClientRect();\n  //     this.setDimensionsFromRect(rect);\n  //   });\n  // }\n\n  public setDimensionsFromRect(rect: DOMRect = this.lastRect) {\n    const {canvas} = this;\n    const {dpr} = canvas;\n\n    if(this.lastRect !== rect) {\n      this.lastRect = rect;\n    }\n\n    if(!rect || !dpr) {\n      return;\n    }\n\n    this.isDimensionsSet = true;\n    canvas.width = Math.round(rect.width * dpr);\n    canvas.height = Math.round(rect.height * dpr);\n  }\n}\n\ntype CustomEmojiRenderer = CustomEmojiRendererElement;\ntype SyncedPlayer = {\n  player: RLottiePlayer,\n  middlewares: Set<() => boolean>,\n  pausedElements: Set<CustomEmojiElement>,\n  elementsCounter: number,\n  counter: number,\n  key: string\n};\ntype CustomEmojiFrame = Parameters<RLottiePlayer['overrideRender']>[0] | HTMLVideoElement;\n\nconst CUSTOM_EMOJI_INSTANT_PLAY = true; // do not wait for animationIntersector\nlet emojiRenderInterval: number;\nconst emojiRenderers: Array<CustomEmojiRenderer> = [];\nconst syncedPlayers: Map<string, SyncedPlayer> = new Map();\nconst syncedPlayersFrames: Map<RLottiePlayer | HTMLVideoElement, CustomEmojiFrame> = new Map();\nconst renderEmojis = () => {\n  const t = emojiRenderers.filter((r) => r.isConnected && r.checkForAnyFrame());\n  if(!t.length) {\n    return;\n  }\n\n  const o = t.map((renderer) => {\n    const offsets = renderer.getOffsets();\n    return offsets.size ? [renderer, offsets] as const : undefined;\n  }).filter(Boolean);\n\n  for(const [renderer] of o) {\n    renderer.clearCanvas();\n  }\n\n  for(const [renderer, offsets] of o) {\n    renderer.render(offsets);\n  }\n};\nconst CUSTOM_EMOJI_FPS = 60;\nconst CUSTOM_EMOJI_FRAME_INTERVAL = 1000 / CUSTOM_EMOJI_FPS;\nconst setRenderInterval = () => {\n  if(emojiRenderInterval) {\n    return;\n  }\n\n  emojiRenderInterval = window.setInterval(renderEmojis, CUSTOM_EMOJI_FRAME_INTERVAL);\n  renderEmojis();\n};\nconst clearRenderInterval = () => {\n  if(!emojiRenderInterval) {\n    return;\n  }\n\n  clearInterval(emojiRenderInterval);\n  emojiRenderInterval = undefined;\n};\n\n(window as any).syncedPlayers = syncedPlayers;\n\ncustomElements.define('custom-emoji-element', CustomEmojiElement);\ncustomElements.define('custom-emoji-renderer-element', CustomEmojiRendererElement);\n\n/**\n * * Expecting correctly sorted nested entities (RichTextProcessor.sortEntities)\n */\nexport default function wrapRichText(text: string, options: Partial<{\n  entities: MessageEntity[],\n  contextSite: string,\n  highlightUsername: string,\n  noLinks: boolean,\n  noLinebreaks: boolean,\n  noCommands: boolean,\n  wrappingDraft: boolean,\n  // mustWrapEmoji: boolean,\n  fromBot: boolean,\n  noTextFormat: boolean,\n  passEntities: Partial<{\n    [_ in MessageEntity['_']]: boolean\n  }>,\n  noEncoding: boolean,\n\n  contextHashtag?: string,\n\n  // ! recursive, do not provide\n  nasty?: {\n    i: number,\n    usedLength: number,\n    text: string,\n    lastEntity?: MessageEntity\n  },\n  voodoo?: boolean,\n  customEmojis?: {[docId: DocId]: CustomEmojiElement[]},\n  wrappingSpoiler?: boolean,\n\n  loadPromises?: Promise<any>[],\n  middleware?: Middleware,\n  lazyLoadQueue?: LazyLoadQueue,\n  customEmojiSize?: MediaSize,\n  animationGroup?: AnimationItemGroup\n}> = {}) {\n  const fragment = document.createDocumentFragment();\n  if(!text) {\n    return fragment;\n  }\n\n  const nasty = options.nasty ??= {\n    i: 0,\n    usedLength: 0,\n    text\n  };\n\n  const customEmojis = options.customEmojis ??= {};\n\n  const entities = options.entities ??= parseEntities(nasty.text);\n\n  const passEntities = options.passEntities ??= {};\n  const contextSite = options.contextSite ??= 'Telegram';\n  const contextExternal = contextSite !== 'Telegram';\n\n  const textLength = nasty.text.length;\n  const length = entities.length;\n  let lastElement: HTMLElement | DocumentFragment;\n  for(; nasty.i < length; ++nasty.i) {\n    let entity = entities[nasty.i];\n\n    // * check whether text was sliced\n    // TODO: consider about moving it to other function\n    if(entity.offset >= textLength) {\n      if(entity._ !== 'messageEntityCaret') { // * can set caret to the end\n        continue;\n      }\n    } else if((entity.offset + entity.length) > textLength) {\n      entity = copy(entity);\n      entity.length = entity.offset + entity.length - textLength;\n    }\n\n    if(entity.length) {\n      nasty.lastEntity = entity;\n    }\n\n    let nextEntity = entities[nasty.i + 1];\n\n    const startOffset = entity.offset;\n    const endOffset = startOffset + entity.length;\n    const endPartOffset = Math.min(endOffset, nextEntity?.offset ?? 0xFFFF);\n    const fullEntityText = nasty.text.slice(startOffset, endOffset);\n    const sliced = nasty.text.slice(startOffset, endPartOffset);\n    let partText = sliced;\n\n    if(nasty.usedLength < startOffset) {\n      (lastElement || fragment).append(nasty.text.slice(nasty.usedLength, startOffset));\n    }\n\n    if(lastElement) {\n      lastElement = fragment;\n    }\n\n    nasty.usedLength = endPartOffset;\n\n    let element: HTMLElement,\n      property: 'textContent' | 'alt' = 'textContent',\n      usedText = false;\n    switch(entity._) {\n      case 'messageEntityBold': {\n        if(!options.noTextFormat) {\n          if(options.wrappingDraft) {\n            element = document.createElement('span');\n            element.style.fontWeight = 'bold';\n          } else {\n            element = document.createElement('strong');\n          }\n        }\n\n        break;\n      }\n\n      case 'messageEntityItalic': {\n        if(!options.noTextFormat) {\n          if(options.wrappingDraft) {\n            element = document.createElement('span');\n            element.style.fontStyle = 'italic';\n          } else {\n            element = document.createElement('em');\n          }\n        }\n\n        break;\n      }\n\n      case 'messageEntityStrike': {\n        if(options.wrappingDraft) {\n          const styleName = IS_SAFARI ? 'text-decoration' : 'text-decoration-line';\n          element = document.createElement('span');\n          element.style.cssText = `${styleName}: line-through;`;\n        } else if(!options.noTextFormat) {\n          element = document.createElement('del');\n        }\n\n        break;\n      }\n\n      case 'messageEntityUnderline': {\n        if(options.wrappingDraft) {\n          const styleName = IS_SAFARI ? 'text-decoration' : 'text-decoration-line';\n          element = document.createElement('span');\n          element.style.cssText = `${styleName}: underline;`;\n        } else if(!options.noTextFormat) {\n          element = document.createElement('u');\n        }\n\n        break;\n      }\n\n      case 'messageEntityPre':\n      case 'messageEntityCode': {\n        if(options.wrappingDraft) {\n          element = document.createElement('span');\n          element.style.fontFamily = 'var(--font-monospace)';\n        } else if(!options.noTextFormat) {\n          element = document.createElement('code');\n        }\n\n        break;\n      }\n\n      // case 'messageEntityPre': {\n      //   if(options.wrappingDraft) {\n      //     element = document.createElement('span');\n      //     element.style.fontFamily = 'var(--font-monospace)';\n      //   } else if(!options.noTextFormat) {\n      //     element = document.createElement('pre');\n      //     const inner = document.createElement('code');\n      //     if(entity.language) {\n      //       inner.className = 'language-' + entity.language;\n      //       inner.textContent = entityText;\n      //       usedText = true;\n      //     }\n      //   }\n\n      //   break;\n      // }\n\n      case 'messageEntityHighlight': {\n        element = document.createElement('i');\n        element.className = 'text-highlight';\n        break;\n      }\n\n      case 'messageEntityBotCommand': {\n        // if(!(options.noLinks || options.noCommands || contextExternal)/*  && !entity.unsafe */) {\n        if(!options.noLinks && passEntities[entity._]) {\n          let command = fullEntityText.slice(1);\n          let bot: string | boolean;\n          let atPos: number;\n          if((atPos = command.indexOf('@')) !== -1) {\n            bot = command.slice(atPos + 1);\n            command = command.slice(0, atPos);\n          } else {\n            bot = options.fromBot;\n          }\n\n          element = document.createElement('a');\n          (element as HTMLAnchorElement).href = encodeEntities('tg://bot_command?command=' + encodeURIComponent(command) + (bot ? '&bot=' + encodeURIComponent(bot) : ''));\n          if(!contextExternal) {\n            element.setAttribute('onclick', 'execBotCommand(this)');\n          }\n        }\n\n        break;\n      }\n\n      case 'messageEntityCustomEmoji': {\n        if(!IS_CUSTOM_EMOJI_SUPPORTED) {\n          break;\n        }\n\n        if(nextEntity?._ === 'messageEntityEmoji') {\n          ++nasty.i;\n          nasty.lastEntity = nextEntity;\n          nasty.usedLength += nextEntity.length;\n          nextEntity = entities[nasty.i + 1];\n        }\n\n        (customEmojis[entity.document_id] ??= []).push(element = new CustomEmojiElement());\n        element.classList.add('custom-emoji');\n\n        property = 'alt';\n        break;\n      }\n\n      case 'messageEntityEmoji': {\n        let isSupported = IS_EMOJI_SUPPORTED;\n        if(isSupported) {\n          for(const version in EmojiVersions) {\n            if(version) {\n              const emojiData = EmojiVersions[version as EMOJI_VERSION];\n              if(emojiData.hasOwnProperty(entity.unicode) && !EMOJI_VERSIONS_SUPPORTED[version as EMOJI_VERSION]) {\n                isSupported = false;\n                break;\n              }\n            }\n          }\n        }\n\n        // if(!(options.wrappingDraft && isSupported)) { // * fix safari emoji\n        if(!isSupported) { // no wrapping needed\n          // if(isSupported) { // ! contenteditable=\"false\"    ,       Safari,     ,  \n          //   insertPart(entity, '<span class=\"emoji\">', '</span>');\n          // } else {\n          element = document.createElement('img');\n          (element as HTMLImageElement).src = `assets/img/emoji/${entity.unicode}.png`;\n          property = 'alt';\n          element.className = 'emoji';\n          // }\n        // } else if(options.mustWrapEmoji) {\n        } else if(!options.wrappingDraft) {\n          element = document.createElement('span');\n          element.className = 'emoji';\n        }/*  else if(!IS_SAFARI) {\n          insertPart(entity, '<span class=\"emoji\" contenteditable=\"false\">', '</span>');\n        } */\n        /* if(!isSupported) {\n          insertPart(entity, `<img src=\"assets/img/emoji/${entity.unicode}.png\" alt=\"`, `\" class=\"emoji\">`);\n        } */\n\n        break;\n      }\n\n      case 'messageEntityCaret': {\n        element = document.createElement('span');\n        element.className = 'composer-sel';\n        break;\n      }\n\n      // case 'messageEntityLinebreak': {\n      //   if(options.noLinebreaks) {\n      //     insertPart(entity, ' ');\n      //   } else {\n      //     insertPart(entity, '<br/>');\n      //   }\n\n      //   break;\n      // }\n\n      case 'messageEntityUrl':\n      case 'messageEntityTextUrl': {\n        if(!(options.noLinks && !passEntities[entity._])) {\n          // let inner: string;\n          let url: string = (entity as MessageEntity.messageEntityTextUrl).url || fullEntityText;\n          let masked = false;\n          let onclick: string;\n\n          const wrapped = wrapUrl(url, true);\n          url = wrapped.url;\n          onclick = wrapped.onclick;\n\n          if(entity._ === 'messageEntityTextUrl') {\n            if(nextEntity?._ === 'messageEntityUrl' &&\n              nextEntity.length === entity.length &&\n              nextEntity.offset === entity.offset) {\n              nasty.lastEntity = nextEntity;\n              ++nasty.i;\n            }\n\n            if(url !== fullEntityText) {\n              masked = true;\n            }\n          } else {\n            // inner = encodeEntities(replaceUrlEncodings(entityText));\n          }\n\n          const currentContext = !!onclick;\n          if(!onclick && masked && !currentContext) {\n            onclick = 'showMaskedAlert';\n          }\n\n          if(options.wrappingDraft) {\n            onclick = undefined;\n          }\n\n          const href = (currentContext || typeof electronHelpers === 'undefined') ?\n            url :\n            `javascript:electronHelpers.openExternal('${url}');`;\n\n          element = document.createElement('a');\n          element.className = 'anchor-url';\n          (element as HTMLAnchorElement).href = href;\n\n          if(!(currentContext || typeof electronHelpers !== 'undefined')) {\n            setBlankToAnchor(element as HTMLAnchorElement);\n          }\n\n          if(onclick) {\n            element.setAttribute('onclick', onclick + '(this)');\n          }\n        }\n\n        break;\n      }\n\n      case 'messageEntityEmail': {\n        if(!options.noLinks) {\n          element = document.createElement('a');\n          (element as HTMLAnchorElement).href = encodeEntities('mailto:' + fullEntityText);\n          setBlankToAnchor(element as HTMLAnchorElement);\n        }\n\n        break;\n      }\n\n      case 'messageEntityHashtag': {\n        const contextUrl = !options.noLinks && SITE_HASHTAGS[contextSite];\n        if(contextUrl) {\n          const hashtag = fullEntityText.slice(1);\n          element = document.createElement('a');\n          element.className = 'anchor-hashtag';\n          (element as HTMLAnchorElement).href = contextUrl.replace('{1}', encodeURIComponent(hashtag));\n          if(contextExternal) {\n            setBlankToAnchor(element as HTMLAnchorElement);\n          } else {\n            element.setAttribute('onclick', 'searchByHashtag(this)');\n          }\n        }\n\n        break;\n      }\n\n      case 'messageEntityMentionName': {\n        if(!(options.noLinks && !passEntities[entity._])) {\n          element = document.createElement('a');\n          (element as HTMLAnchorElement).href = buildURLHash('' + entity.user_id);\n          element.className = 'follow';\n          element.dataset.follow = '' + entity.user_id;\n        }\n\n        break;\n      }\n\n      case 'messageEntityMention': {\n        // const contextUrl = !options.noLinks && siteMentions[contextSite];\n        if(!options.noLinks) {\n          const username = fullEntityText.slice(1);\n\n          const {url, onclick} = wrapUrl('t.me/' + username);\n\n          element = document.createElement('a');\n          element.className = 'mention';\n          (element as HTMLAnchorElement).href = url;\n          if(onclick) {\n            element.setAttribute('onclick', `${onclick}(this)`);\n          }\n\n          // insertPart(entity, `<a class=\"mention\" href=\"${contextUrl.replace('{1}', encodeURIComponent(username))}\"${contextExternal ? ' target=\"_blank\" rel=\"noopener noreferrer\"' : ''}>`, '</a>');\n        }\n\n        break;\n      }\n\n      case 'messageEntitySpoiler': {\n        if(options.noTextFormat) {\n          const encoded = encodeSpoiler(nasty.text, entity);\n          nasty.text = encoded.text;\n          partText = encoded.entityText;\n          nasty.usedLength += partText.length;\n          let n: MessageEntity;\n          for(; n = entities[nasty.i + 1], n && n.offset < endOffset;) {\n            // nasty.usedLength += n.length;\n            ++nasty.i;\n            nasty.lastEntity = n;\n            nextEntity = entities[nasty.i + 1];\n          }\n        } else if(options.wrappingDraft) {\n          element = document.createElement('span');\n          element.style.fontFamily = 'spoiler';\n        } else {\n          const container = document.createElement('span');\n          container.className = 'spoiler';\n          element = document.createElement('span');\n          element.className = 'spoiler-text';\n          element.textContent = partText;\n          usedText = true;\n          container.append(element);\n          fragment.append(container);\n\n          container[`on${CLICK_EVENT_NAME}`] = (window as any).onSpoilerClick;\n        }\n\n        break;\n      }\n    }\n\n    if(!usedText) {\n      if(element) {\n        // @ts-ignore\n        element[property] = partText;\n      } else {\n        (element || fragment).append(partText);\n      }\n    }\n\n    if(element && !element.parentElement) {\n      (lastElement || fragment).append(element);\n    }\n\n    while(nextEntity && nextEntity.offset < endOffset) {\n      ++nasty.i;\n\n      (element || fragment).append(wrapRichText(nasty.text, {\n        ...options,\n        voodoo: true\n      }));\n\n      nextEntity = entities[nasty.i + 1];\n    }\n\n    // if(!element?.parentElement) {\n    //   (lastElement || fragment).append(element ?? partText);\n    // }\n\n    if(nasty.usedLength <= endOffset) {\n      if(nasty.usedLength < endOffset) {\n        (element || fragment).append(nasty.text.slice(nasty.usedLength, endOffset));\n        nasty.usedLength = endOffset;\n      }\n\n      lastElement = fragment;\n      nasty.lastEntity = undefined;\n    } else if(entity.length > partText.length && element) {\n      lastElement = element;\n    } else {\n      lastElement = fragment;\n    }\n\n    if(options.voodoo) {\n      return fragment;\n    }\n  }\n\n  if(nasty.lastEntity) {\n    nasty.usedLength = nasty.lastEntity.offset + nasty.lastEntity.length;\n  }\n\n  if(nasty.usedLength < textLength) {\n    (lastElement || fragment).append(nasty.text.slice(nasty.usedLength));\n  }\n\n  const docIds = Object.keys(customEmojis) as DocId[];\n  if(docIds.length) {\n    const managers = rootScope.managers;\n    const size = options.customEmojiSize || mediaSizes.active.customEmoji;\n    const renderer = new CustomEmojiRendererElement();\n    // const middleware = () => !!renderer.disconnectedCallback && (!options.middleware || options.middleware());\n    let middleware: Middleware;\n    if(options.middleware) {\n      middleware = options.middleware;\n      options.middleware.onDestroy(() => {\n        renderer.disconnectedCallback?.();\n      });\n    } else {\n      renderer.middlewareHelper = getMiddleware();\n      middleware = renderer.middlewareHelper.get();\n    }\n\n    renderer.animationGroup = options.animationGroup;\n    renderer.size = size;\n    fragment.prepend(renderer);\n\n    const loadPromise = managers.appEmojiManager.getCachedCustomEmojiDocuments(docIds).then((docs) => {\n      if(middleware && !middleware()) return;\n\n      const loadPromises: Promise<any>[] = [];\n      const wrap = (doc: MyDocument, _loadPromises?: Promise<any>[]) => {\n        const elements = customEmojis[doc.id];\n        const isLottie = doc.sticker === 2;\n\n        const loadPromises: Promise<any>[] = [];\n        const promise = wrapSticker({\n          div: elements,\n          doc,\n          width: size.width,\n          height: size.height,\n          loop: true,\n          play: CUSTOM_EMOJI_INSTANT_PLAY,\n          managers,\n          isCustomEmoji: true,\n          group: 'none',\n          loadPromises,\n          middleware,\n          exportLoad: true,\n          needFadeIn: false,\n          loadStickerMiddleware: isLottie && middleware ? middleware.create().get(() => {\n            if(syncedPlayers.get(key) !== syncedPlayer) {\n              return false;\n            }\n\n            let good = !syncedPlayer.middlewares.size;\n            for(const middleware of syncedPlayer.middlewares) {\n              if(middleware()) {\n                good = true;\n              }\n            }\n\n            return good;\n          }) : undefined,\n          static: doc.mime_type === 'video/webm' && !IS_WEBM_SUPPORTED\n        });\n\n        if(_loadPromises) {\n          promise.then(() => _loadPromises.push(...loadPromises));\n        }\n\n        const addition: {\n          onRender?: (_p: Awaited<Awaited<typeof promise>['render']>) => Promise<void>,\n          elements: typeof elements\n        } = {\n          elements\n        };\n\n        if(doc.sticker === 1) {\n          return promise.then((res) => ({...res, ...addition}));\n        }\n\n        // eslint-disable-next-line prefer-const\n        addition.onRender = (_p) => Promise.all(loadPromises).then(() => {\n          if((middleware && !middleware()) || !doc.animated) {\n            return;\n          }\n\n          const players = Array.isArray(_p) ? _p as HTMLVideoElement[] : [_p as RLottiePlayer];\n          const player = Array.isArray(players) ? players[0] : players;\n          assumeType<RLottiePlayer | HTMLVideoElement>(player);\n          elements.forEach((element, idx) => {\n            const player = players[idx] || players[0];\n            element.renderer = renderer;\n            element.elements = elements;\n            element.player = player;\n\n            if(syncedPlayer) {\n              element.syncedPlayer = syncedPlayer;\n              if(element.paused) {\n                element.syncedPlayer.pausedElements.add(element);\n              }\n            }\n\n            if(element.isConnected) {\n              animationIntersector.addAnimation(element, element.renderer.animationGroup);\n            }\n          });\n\n          if(syncedPlayer) {\n            syncedPlayer.elementsCounter += elements.length;\n            syncedPlayer.middlewares.delete(middleware);\n            renderer.syncedElements.set(syncedPlayer, elements);\n          }\n\n          if(player instanceof RLottiePlayer) {\n            syncedPlayer.player = player;\n            renderer.playersSynced.set(elements, player);\n            renderer.canvas.dpr = player.canvas[0].dpr;\n            player.group = renderer.animationGroup;\n\n            player.overrideRender ??= (frame) => {\n              syncedPlayersFrames.set(player, frame);\n              // frames.set(containers, frame);\n            };\n\n            setRenderInterval();\n          } else if(player instanceof HTMLVideoElement) {\n            // player.play();\n\n            // const cache = framesCache.getCache(key);\n            // let {width, height} = renderer.size;\n            // width *= dpr;\n            // height *= dpr;\n\n            // const onFrame = (frame: ImageBitmap | HTMLCanvasElement) => {\n            //   topFrames.set(player, frame);\n            //   player.requestVideoFrameCallback(callback);\n            // };\n\n            // let frameNo = -1, lastTime = 0;\n            // const callback: VideoFrameRequestCallback = (now, metadata) => {\n            //   const time = player.currentTime;\n            //   if(lastTime > time) {\n            //     frameNo = -1;\n            //   }\n\n            //   const _frameNo = ++frameNo;\n            //   lastTime = time;\n            //   // const frameNo = Math.floor(player.currentTime * 1000 / CUSTOM_EMOJI_FRAME_INTERVAL);\n            //   // const frameNo = metadata.presentedFrames;\n            //   const imageBitmap = cache.framesNew.get(_frameNo);\n\n            //   if(imageBitmap) {\n            //     onFrame(imageBitmap);\n            //   } else if(IS_IMAGE_BITMAP_SUPPORTED) {\n            //     createImageBitmap(player, {resizeWidth: width, resizeHeight: height}).then((imageBitmap) => {\n            //       cache.framesNew.set(_frameNo, imageBitmap);\n            //       if(frameNo === _frameNo) onFrame(imageBitmap);\n            //     });\n            //   } else {\n            //     const canvas = document.createElement('canvas');\n            //     const context = canvas.getContext('2d');\n            //     canvas.width = width;\n            //     canvas.height = height;\n            //     context.drawImage(player, 0, 0);\n            //     cache.framesNew.set(_frameNo, canvas);\n            //     onFrame(canvas);\n            //   }\n            // };\n\n            // // player.requestVideoFrameCallback(callback);\n            // // setInterval(callback, CUSTOM_EMOJI_FRAME_INTERVAL);\n          }\n        });\n\n        let syncedPlayer: SyncedPlayer;\n        const key = [doc.id, size.width, size.height].join('-');\n        if(isLottie) {\n          syncedPlayer = syncedPlayers.get(key);\n          if(!syncedPlayer) {\n            syncedPlayer = {\n              player: undefined,\n              middlewares: new Set(),\n              pausedElements: new Set(),\n              elementsCounter: 0,\n              counter: 0,\n              key\n            };\n\n            syncedPlayers.set(key, syncedPlayer);\n          }\n\n          renderer.syncedElements.set(syncedPlayer, undefined);\n\n          ++syncedPlayer.counter;\n\n          if(middleware) {\n            syncedPlayer.middlewares.add(middleware);\n          }\n        }\n\n        return promise.then((res) => ({...res, ...addition}));\n      };\n\n      const missing: DocId[] = [];\n      const cachedPromises = docs.map((doc, idx) => {\n        if(!doc) {\n          missing.push(docIds[idx]);\n          return;\n        }\n\n        return wrap(doc, loadPromises);\n      }).filter(Boolean);\n\n      const uncachedPromisesPromise = managers.appEmojiManager.getCustomEmojiDocuments(missing).then((docs) => {\n        if(middleware && !middleware()) return [];\n        return docs.filter(Boolean).map((doc) => wrap(doc));\n      });\n\n      const loadFromPromises = (promises: typeof cachedPromises) => {\n        return Promise.all(promises).then((arr) => {\n          const promises = arr.map(({load, onRender, elements}) => {\n            if(!load) {\n              return;\n            }\n\n            const l = () => load().then(onRender);\n\n            if(renderer.lazyLoadQueue) {\n              elements.forEach((element) => {\n                renderer.lazyLoadQueue.push({\n                  div: element,\n                  load: () => {\n                    elements.forEach((element) => {\n                      renderer.lazyLoadQueue.unobserve(element);\n                    });\n\n                    return l();\n                  }\n                });\n              });\n            } else {\n              return l();\n            }\n          });\n\n          return Promise.all(promises);\n        });\n      };\n\n      const load = () => {\n        if(middleware && !middleware()) return;\n        const cached = loadFromPromises(cachedPromises);\n        const uncached = uncachedPromisesPromise.then((promises) => loadFromPromises(promises));\n        return Promise.all([cached, uncached]);\n      };\n\n      if(options.lazyLoadQueue) {\n        options.lazyLoadQueue.push({\n          div: renderer.canvas,\n          load\n        });\n      } else {\n        renderer.lazyLoadQueue = new LazyLoadQueue();\n        load();\n      }\n\n      return Promise.all(cachedPromises).then(() => Promise.all(loadPromises)).then(() => {});\n    });\n\n    // recordPromise(loadPromise, 'render emojis: ' + docIds.length);\n\n    options.loadPromises?.push(loadPromise);\n  }\n\n  return fragment;\n}\n\n(window as any).wrapRichText = wrapRichText;\n","// just for the future\nexport default function buildURLHash(str: string) {\n  return '#' + encodeURIComponent(str);\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport CAN_USE_TRANSFERABLES from '../../environment/canUseTransferables';\nimport EventListenerBase from '../../helpers/eventListenerBase';\n\nexport default class QueryableWorker extends EventListenerBase<{\n  ready: () => void,\n  frame: (reqId: number, frameNo: number, frame: Uint8ClampedArray | ImageBitmap) => void,\n  loaded: (reqId: number, frameCount: number, fps: number) => void,\n  error: (reqId: number, error: Error) => void,\n  workerError: (error: ErrorEvent) => void\n}> {\n  constructor(private worker: Worker) {\n    super();\n\n    this.worker.onerror = (error) => {\n      try {\n        this.dispatchEvent('workerError', error);\n        this.cleanup();\n        this.terminate();\n      } catch(err) {\n\n      }\n    };\n\n    this.worker.onmessage = (event) => {\n      this.dispatchEvent(event.data.queryMethodListener, ...event.data.queryMethodArguments);\n    };\n  }\n\n  public postMessage(message: any) {\n    this.worker.postMessage(message);\n  }\n\n  public terminate() {\n    this.worker.terminate();\n  }\n\n  public sendQuery(args: any[], transfer?: Transferable[]) {\n    this.worker.postMessage({\n      queryMethod: args.shift(),\n      queryMethodArguments: args\n    }, CAN_USE_TRANSFERABLES ? transfer: undefined);\n  }\n}\n","const IS_WEB_ASSEMBLY_SUPPORTED = typeof(WebAssembly) !== 'undefined';\n\nexport default IS_WEB_ASSEMBLY_SUPPORTED;\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport animationIntersector, {AnimationItemGroup} from '../../components/animationIntersector';\r\nimport {MOUNT_CLASS_TO} from '../../config/debug';\r\nimport pause from '../../helpers/schedulers/pause';\r\nimport {logger, LogTypes} from '../logger';\r\nimport RLottiePlayer, {RLottieOptions} from './rlottiePlayer';\r\nimport QueryableWorker from './queryableWorker';\r\nimport blobConstruct from '../../helpers/blob/blobConstruct';\r\nimport apiManagerProxy from '../mtproto/mtprotoworker';\r\nimport IS_WEB_ASSEMBLY_SUPPORTED from '../../environment/webAssemblySupport';\r\nimport makeError from '../../helpers/makeError';\r\n\r\nexport type LottieAssetName = 'EmptyFolder' | 'Folders_1' | 'Folders_2' |\r\n  'TwoFactorSetupMonkeyClose' | 'TwoFactorSetupMonkeyCloseAndPeek' |\r\n  'TwoFactorSetupMonkeyCloseAndPeekToIdle' | 'TwoFactorSetupMonkeyIdle' |\r\n  'TwoFactorSetupMonkeyPeek' | 'TwoFactorSetupMonkeyTracking' |\r\n  'voice_outlined2' | 'voip_filled' | 'voice_mini';\r\n\r\nexport class LottieLoader {\r\n  private loadPromise: Promise<void> = !IS_WEB_ASSEMBLY_SUPPORTED ? Promise.reject() : undefined;\r\n  private loaded = false;\r\n\r\n  private workersLimit = 4;\r\n  private players: {[reqId: number]: RLottiePlayer} = {};\r\n  private playersByCacheName: {[cacheName: string]: Set<RLottiePlayer>} = {};\r\n\r\n  private workers: QueryableWorker[] = [];\r\n  private curWorkerNum = 0;\r\n\r\n  private log = logger('LOTTIE', LogTypes.Error);\r\n\r\n  public getAnimation(element: HTMLElement) {\r\n    for(const i in this.players) {\r\n      if(this.players[i].el.includes(element)) {\r\n        return this.players[i];\r\n      }\r\n    }\r\n\r\n    return null;\r\n  }\r\n\r\n  public setLoop(loop: boolean) {\r\n    for(const i in this.players) {\r\n      const player = this.players[i];\r\n      player.loop = loop;\r\n      player.autoplay = player._autoplay;\r\n    }\r\n  }\r\n\r\n  public loadLottieWorkers() {\r\n    if(this.loadPromise) {\r\n      return this.loadPromise;\r\n    }\r\n\r\n    return this.loadPromise = new Promise((resolve, reject) => {\r\n      let remain = this.workersLimit;\r\n      for(let i = 0; i < this.workersLimit; ++i) {\r\n        const worker = new Worker(new URL('./rlottie.worker.ts', import.meta.url));\r\n        const queryableWorker = this.workers[i] = new QueryableWorker(worker);\r\n\r\n        queryableWorker.addEventListener('ready', () => {\r\n          this.log('worker #' + i + ' ready');\r\n\r\n          queryableWorker.addEventListener('frame', this.onFrame);\r\n          queryableWorker.addEventListener('loaded', this.onPlayerLoaded);\r\n          queryableWorker.addEventListener('error', this.onPlayerError);\r\n\r\n          --remain;\r\n          if(!remain) {\r\n            this.log('workers ready');\r\n            resolve();\r\n            this.loaded = true;\r\n          }\r\n        }, {once: true});\r\n\r\n        queryableWorker.addEventListener('workerError', (error) => {\r\n          reject('rlottie load error: ' + error.message);\r\n          this.loaded = false;\r\n        }, {once: true});\r\n      }\r\n    });\r\n  }\r\n\r\n  public loadAnimationAsAsset(params: Omit<RLottieOptions, 'animationData' | 'name'>, name: LottieAssetName) {\r\n    (params as RLottieOptions).name = name;\r\n    return this.loadAnimationFromURL(params, 'assets/tgs/' + name + '.json');\r\n  }\r\n\r\n  public loadAnimationFromURL(params: Omit<RLottieOptions, 'animationData'>, url: string): Promise<RLottiePlayer> {\r\n    if(!IS_WEB_ASSEMBLY_SUPPORTED) {\r\n      return this.loadPromise as any;\r\n    }\r\n\r\n    if(!this.loaded) {\r\n      this.loadLottieWorkers();\r\n    }\r\n\r\n    return fetch(url)\r\n    .then((res) => {\r\n      if(!res.headers || res.headers.get('content-type') === 'application/octet-stream') {\r\n        return res.arrayBuffer().then((data) => apiManagerProxy.invokeCrypto('gzipUncompress', data)).then((arr) => blobConstruct(arr as Uint8Array, ''))\r\n      } else {\r\n        return res.blob();\r\n      }\r\n    })\r\n    /* .then((str) => {\r\n      return new Promise<string>((resolve) => setTimeout(() => resolve(str), 2e3));\r\n    }) */\r\n    .then((blob) => {\r\n      const newParams = Object.assign(params, {animationData: blob, needUpscale: true});\r\n      if(!newParams.name) newParams.name = url;\r\n      return this.loadAnimationWorker(newParams);\r\n    });\r\n  }\r\n\r\n  public waitForFirstFrame(player: RLottiePlayer) {\r\n    return Promise.race([\r\n      /* new Promise<void>((resolve) => {\r\n        player.addEventListener('firstFrame', () => {\r\n          setTimeout(() => resolve(), 1500);\r\n        }, true);\r\n      }) */\r\n      new Promise<void>((resolve) => {\r\n        player.addEventListener('firstFrame', resolve, {once: true});\r\n      }),\r\n      pause(2500)\r\n    ]).then(() => player);\r\n  }\r\n\r\n  public async loadAnimationWorker(\r\n    params: RLottieOptions,\r\n    group: AnimationItemGroup = params.group || '',\r\n    middleware?: () => boolean\r\n  ): Promise<RLottiePlayer> {\r\n    if(!IS_WEB_ASSEMBLY_SUPPORTED) {\r\n      return this.loadPromise as any;\r\n    }\r\n\r\n    if(!this.loaded) {\r\n      await this.loadLottieWorkers();\r\n    }\r\n\r\n    if(middleware && !middleware()) {\r\n      throw makeError('MIDDLEWARE');\r\n    }\r\n\r\n    if(params.sync) {\r\n      const cacheName = RLottiePlayer.CACHE.generateName(params.name, params.width, params.height, params.color, params.toneIndex);\r\n      const players = this.playersByCacheName[cacheName];\r\n      if(players?.size) {\r\n        return Promise.resolve(players.entries().next().value[0]);\r\n      }\r\n    }\r\n\r\n    const containers = Array.isArray(params.container) ? params.container : [params.container];\r\n    if(!params.width || !params.height) {\r\n      params.width = parseInt(containers[0].style.width);\r\n      params.height = parseInt(containers[0].style.height);\r\n    }\r\n\r\n    if(!params.width || !params.height) {\r\n      throw new Error('No size for sticker!');\r\n    }\r\n\r\n    params.group = group;\r\n\r\n    const player = this.initPlayer(containers, params);\r\n\r\n    animationIntersector.addAnimation(player, group);\r\n\r\n    return player;\r\n  }\r\n\r\n  private onPlayerLoaded = (reqId: number, frameCount: number, fps: number) => {\r\n    const player = this.players[reqId];\r\n    if(!player) {\r\n      this.log.warn('onPlayerLoaded on destroyed player:', reqId, frameCount);\r\n      return;\r\n    }\r\n\r\n    this.log.debug('onPlayerLoaded');\r\n    player.onLoad(frameCount, fps);\r\n  };\r\n\r\n  private onFrame = (reqId: number, frameNo: number, frame: Uint8ClampedArray | ImageBitmap) => {\r\n    const player = this.players[reqId];\r\n    if(!player) {\r\n      this.log.warn('onFrame on destroyed player:', reqId, frameNo);\r\n      return;\r\n    }\r\n\r\n    if(player.clamped !== undefined && frame instanceof Uint8ClampedArray) {\r\n      player.clamped = frame;\r\n    }\r\n\r\n    player.renderFrame(frame, frameNo);\r\n  };\r\n\r\n  private onPlayerError = (reqId: number, error: Error) => {\r\n    const player = this.players[reqId];\r\n    if(!player) {\r\n      return;\r\n    }\r\n\r\n    // ! will need refactoring later, this is not the best way to remove the animation\r\n    const animations = animationIntersector.getAnimations(player.el[0]);\r\n    animations.forEach((animation) => {\r\n      animationIntersector.checkAnimation(animation, true, true);\r\n    });\r\n  };\r\n\r\n  public onDestroy(reqId: number) {\r\n    delete this.players[reqId];\r\n  }\r\n\r\n  public destroyWorkers() {\r\n    if(!IS_WEB_ASSEMBLY_SUPPORTED) {\r\n      return;\r\n    }\r\n\r\n    this.workers.forEach((worker, idx) => {\r\n      worker.terminate();\r\n      this.log('worker #' + idx + ' terminated');\r\n    });\r\n\r\n    this.log('workers destroyed');\r\n    this.workers.length = 0;\r\n    this.curWorkerNum = 0;\r\n    this.loaded = false;\r\n    this.loadPromise = undefined;\r\n  }\r\n\r\n  private initPlayer(el: RLottiePlayer['el'], options: RLottieOptions) {\r\n    const player = new RLottiePlayer({\r\n      el,\r\n      worker: this.workers[this.curWorkerNum++],\r\n      options\r\n    });\r\n\r\n    const {reqId, cacheName} = player;\r\n    this.players[reqId] = player;\r\n\r\n    const playersByCacheName = cacheName ? this.playersByCacheName[cacheName] ??= new Set() : undefined;\r\n    if(cacheName) {\r\n      playersByCacheName.add(player);\r\n    }\r\n\r\n    if(this.curWorkerNum >= this.workers.length) {\r\n      this.curWorkerNum = 0;\r\n    }\r\n\r\n    player.addEventListener('destroy', () => {\r\n      this.onDestroy(reqId);\r\n      if(playersByCacheName.delete(player) && !playersByCacheName.size) {\r\n        delete this.playersByCacheName[cacheName];\r\n      }\r\n    });\r\n\r\n    player.loadFromData(options.animationData);\r\n\r\n    return player;\r\n  }\r\n}\r\n\r\nconst lottieLoader = new LottieLoader();\r\nMOUNT_CLASS_TO.lottieLoader = lottieLoader;\r\nexport default lottieLoader;\r\n","const IS_IMAGE_BITMAP_SUPPORTED = typeof(ImageBitmap) !== 'undefined';\n\nexport default IS_IMAGE_BITMAP_SUPPORTED;\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport type {RLottieColor} from '../lib/rlottie/rlottiePlayer';\n\nexport type FramesCacheMap = Map<number, Uint8ClampedArray>;\nexport type FramesCacheMapNew = Map<number, HTMLCanvasElement | ImageBitmap>;\nexport type FramesCacheMapURLs = Map<number, string>;\nexport type FramesCacheItem = {\n  frames: FramesCacheMap,\n  framesNew: FramesCacheMapNew,\n  framesURLs: FramesCacheMapURLs,\n  clearCache: () => void,\n  counter: number\n};\n\nexport class FramesCache {\n  private cache: Map<string, FramesCacheItem>;\n\n  constructor() {\n    this.cache = new Map();\n  }\n\n  public static createCache(): FramesCacheItem {\n    const cache: FramesCacheItem = {\n      frames: new Map(),\n      framesNew: new Map(),\n      framesURLs: new Map(),\n      clearCache: () => {\n        cache.framesNew.forEach((value) => {\n          (value as ImageBitmap).close?.();\n        });\n\n        cache.frames.clear();\n        cache.framesNew.clear();\n        cache.framesURLs.clear();\n      },\n      counter: 0\n    };\n\n    return cache;\n  }\n\n  public getCache(name: string) {\n    let cache = this.cache.get(name);\n    if(!cache) {\n      this.cache.set(name, cache = FramesCache.createCache());\n    } else {\n      // console.warn('[RLottieCache] cache will be reused', cache);\n    }\n\n    ++cache.counter;\n    return cache;\n  }\n\n  public releaseCache(name: string) {\n    const cache = this.cache.get(name);\n    if(cache && !--cache.counter) {\n      this.cache.delete(name);\n      // console.warn('[RLottieCache] released cache', cache);\n    }\n  }\n\n  public getCacheCounter(name: string) {\n    const cache = this.cache.get(name);\n    return cache?.counter;\n  }\n\n  public generateName(name: string, width: number, height: number, color: RLottieColor, toneIndex: number) {\n    return [\n      name,\n      width,\n      height,\n      // color ? rgbaToHexa(color) : ''\n      color ? 'colored' : '',\n      toneIndex || ''\n    ].filter(Boolean).join('-');\n  }\n}\n\nconst framesCache = new FramesCache();\n\nexport default framesCache;\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport type {AnimationItemGroup, AnimationItemWrapper} from '../../components/animationIntersector';\nimport CAN_USE_TRANSFERABLES from '../../environment/canUseTransferables';\nimport IS_APPLE_MX from '../../environment/appleMx';\nimport {IS_ANDROID, IS_APPLE_MOBILE, IS_APPLE, IS_SAFARI} from '../../environment/userAgent';\nimport EventListenerBase from '../../helpers/eventListenerBase';\nimport mediaSizes from '../../helpers/mediaSizes';\nimport clamp from '../../helpers/number/clamp';\nimport QueryableWorker from './queryableWorker';\nimport IS_IMAGE_BITMAP_SUPPORTED from '../../environment/imageBitmapSupport';\nimport framesCache, {FramesCache, FramesCacheItem} from '../../helpers/framesCache';\n\nexport type RLottieOptions = {\n  container: HTMLElement | HTMLElement[],\n  canvas?: HTMLCanvasElement,\n  autoplay?: boolean,\n  animationData: Blob,\n  loop?: boolean,\n  width?: number,\n  height?: number,\n  group?: AnimationItemGroup,\n  noCache?: boolean,\n  needUpscale?: boolean,\n  skipRatio?: number,\n  initFrame?: number, // index\n  color?: RLottieColor,\n  inverseColor?: RLottieColor,\n  name?: string,\n  skipFirstFrameRendering?: boolean,\n  toneIndex?: number,\n  sync?: boolean\n};\n\nexport type RLottieColor = [number, number, number];\n\nexport function getLottiePixelRatio(width: number, height: number, needUpscale?: boolean) {\n  let pixelRatio = clamp(window.devicePixelRatio, 1, 2);\n  if(pixelRatio > 1 && !needUpscale) {\n    if(width > 90 && height > 90) {\n      if(!IS_APPLE && mediaSizes.isMobile) {\n        pixelRatio = 1;\n      }\n    } else if(width > 60 && height > 60) {\n      pixelRatio = Math.max(1.5, pixelRatio - 1.5);\n    }\n  }\n\n  return pixelRatio;\n}\n\nexport default class RLottiePlayer extends EventListenerBase<{\n  enterFrame: (frameNo: number) => void,\n  ready: () => void,\n  firstFrame: () => void,\n  cached: () => void,\n  destroy: () => void\n}> implements AnimationItemWrapper {\n  public static CACHE = framesCache;\n  private static reqId = 0;\n\n  public reqId = 0;\n  public curFrame: number;\n  private frameCount: number;\n  private fps: number;\n  private skipDelta: number;\n  public name: string;\n  public cacheName: string;\n  private toneIndex: number;\n\n  private worker: QueryableWorker;\n\n  private width = 0;\n  private height = 0;\n\n  public el: HTMLElement[];\n  public canvas: HTMLCanvasElement[];\n  private contexts: CanvasRenderingContext2D[];\n\n  public paused = true;\n  // public paused = false;\n  public direction = 1;\n  private speed = 1;\n  public autoplay = true;\n  public _autoplay: boolean; // ! will be used to store original value for settings.stickers.loop\n  public loop = true;\n  private _loop: boolean; // ! will be used to store original value for settings.stickers.loop\n  public group: AnimationItemGroup = '';\n\n  private frInterval: number;\n  private frThen: number;\n  private rafId: number;\n\n  // private caching = false;\n  // private removed = false;\n\n  private cache: FramesCacheItem;\n  private imageData: ImageData;\n  public clamped: Uint8ClampedArray;\n  private cachingDelta = 0;\n\n  private initFrame: number;\n  private color: RLottieColor;\n  private inverseColor: RLottieColor;\n\n  public minFrame: number;\n  public maxFrame: number;\n\n  // private playedTimes = 0;\n\n  private currentMethod: RLottiePlayer['mainLoopForwards'] | RLottiePlayer['mainLoopBackwards'];\n  private frameListener: (currentFrame: number) => void;\n  private skipFirstFrameRendering: boolean;\n  private playToFrameOnFrameCallback: (frameNo: number) => void;\n\n  public overrideRender: (frame: ImageData | HTMLCanvasElement | ImageBitmap) => void;\n  private renderedFirstFrame: boolean;\n\n  constructor({el, worker, options}: {\n    el: RLottiePlayer['el'],\n    worker: QueryableWorker,\n    options: RLottieOptions\n  }) {\n    super(true);\n\n    this.reqId = ++RLottiePlayer['reqId'];\n    this.el = el;\n    this.worker = worker;\n\n    for(const i in options) {\n      if(this.hasOwnProperty(i)) {\n        // @ts-ignore\n        this[i] = options[i];\n      }\n    }\n\n    this._loop = this.loop;\n    this._autoplay = this.autoplay;\n\n    // ! :(\n    this.initFrame = options.initFrame;\n    this.color = options.color;\n    this.inverseColor = options.inverseColor;\n    this.name = options.name;\n    this.skipFirstFrameRendering = options.skipFirstFrameRendering;\n    this.toneIndex = options.toneIndex;\n\n    if(this.name) {\n      this.cacheName = RLottiePlayer.CACHE.generateName(this.name, this.width, this.height, this.color, this.toneIndex);\n    }\n\n    // * Skip ratio (30fps)\n    let skipRatio: number;\n    if(options.skipRatio !== undefined) skipRatio = options.skipRatio;\n    else if((IS_ANDROID || IS_APPLE_MOBILE || (IS_APPLE && !IS_SAFARI && !IS_APPLE_MX)) && this.width < 100 && this.height < 100 && !options.needUpscale) {\n      skipRatio = 0.5;\n    }\n\n    this.skipDelta = skipRatio !== undefined ? 1 / skipRatio | 0 : 1;\n\n    // options.needUpscale = true;\n\n    // * Pixel ratio\n    const pixelRatio = getLottiePixelRatio(this.width, this.height, options.needUpscale);\n\n    this.width = Math.round(this.width * pixelRatio);\n    this.height = Math.round(this.height * pixelRatio);\n\n    // options.noCache = true;\n\n    // * Cache frames params\n    if(!options.noCache/*  && false */) {\n      //      ,     ,   8080  6868,   75%\n      if(IS_APPLE && this.width > 100 && this.height > 100) {\n        this.cachingDelta = 2; // 2 // 50%\n      } else if(this.width < 100 && this.height < 100) {\n        this.cachingDelta = Infinity; // 100%\n      } else {\n        this.cachingDelta = 4; // 75%\n      }\n    }\n\n    // this.cachingDelta = Infinity;\n    // this.cachingDelta = 0;\n    // if(isApple) {\n    //   this.cachingDelta = 0; //2 // 50%\n    // }\n\n    if(!this.canvas) {\n      this.canvas = this.el.map(() => {\n        const canvas = document.createElement('canvas');\n        canvas.classList.add('rlottie');\n        canvas.width = this.width;\n        canvas.height = this.height;\n        canvas.dpr = pixelRatio;\n        return canvas;\n      });\n    }\n\n    this.contexts = this.canvas.map((canvas) => canvas.getContext('2d'));\n\n    if(!IS_IMAGE_BITMAP_SUPPORTED) {\n      this.imageData = new ImageData(this.width, this.height);\n\n      if(CAN_USE_TRANSFERABLES) {\n        this.clamped = new Uint8ClampedArray(this.width * this.height * 4);\n      }\n    }\n\n    if(this.name) {\n      this.cache = RLottiePlayer.CACHE.getCache(this.cacheName);\n    } else {\n      this.cache = FramesCache.createCache();\n    }\n  }\n\n  public clearCache() {\n    if(this.cachingDelta === Infinity) {\n      return;\n    }\n\n    if(this.cacheName && this.cache.counter > 1) { // skip clearing because same sticker can be still visible\n      return;\n    }\n\n    this.cache.clearCache();\n  }\n\n  public sendQuery(args: any[]) {\n    this.worker.sendQuery([args.shift(), this.reqId, ...args]);\n  }\n\n  public loadFromData(data: RLottieOptions['animationData']) {\n    this.sendQuery(['loadFromData', data, this.width, this.height, this.toneIndex/* , this.canvas.transferControlToOffscreen() */]);\n  }\n\n  public play() {\n    if(!this.paused) {\n      return;\n    }\n\n    this.paused = false;\n    this.setMainLoop();\n  }\n\n  public pause(clearPendingRAF = true) {\n    if(this.paused) {\n      return;\n    }\n\n    this.paused = true;\n    if(clearPendingRAF) {\n      clearTimeout(this.rafId);\n    }\n    // window.cancelAnimationFrame(this.rafId);\n  }\n\n  private resetCurrentFrame() {\n    return this.curFrame = this.initFrame ?? (this.direction === 1 ? this.minFrame : this.maxFrame);\n  }\n\n  public stop(renderFirstFrame = true) {\n    this.pause();\n\n    const curFrame = this.resetCurrentFrame();\n    if(renderFirstFrame) {\n      this.requestFrame(curFrame);\n      // this.sendQuery('renderFrame', this.curFrame);\n    }\n  }\n\n  public restart() {\n    this.stop(false);\n    this.play();\n  }\n\n  public setSpeed(speed: number) {\n    if(this.speed === speed) {\n      return;\n    }\n\n    this.speed = speed;\n\n    if(!this.paused) {\n      this.setMainLoop();\n    }\n  }\n\n  public setDirection(direction: number) {\n    if(this.direction === direction) {\n      return;\n    }\n\n    this.direction = direction;\n\n    if(!this.paused) {\n      this.setMainLoop();\n    }\n  }\n\n  public remove() {\n    this.pause();\n    this.sendQuery(['destroy']);\n    if(this.cacheName) RLottiePlayer.CACHE.releaseCache(this.cacheName);\n    this.dispatchEvent('destroy');\n    this.cleanup();\n  }\n\n  private applyColor(frame: Uint8ClampedArray) {\n    const [r, g, b] = this.color;\n    for(let i = 0, length = frame.length; i < length; i += 4) {\n      if(frame[i + 3] !== 0) {\n        frame[i] = r;\n        frame[i + 1] = g;\n        frame[i + 2] = b;\n      }\n    }\n  }\n\n  private applyInversing(frame: Uint8ClampedArray) {\n    const [r, g, b] = this.inverseColor;\n    for(let i = 0, length = frame.length; i < length; i += 4) {\n      if(frame[i + 3] === 0) {\n        frame[i] = r;\n        frame[i + 1] = g;\n        frame[i + 2] = b;\n        frame[i + 3] = 255;\n      } else {\n        frame[i + 3] = 0;\n      }\n    }\n  }\n\n  public renderFrame2(frame: Uint8ClampedArray | HTMLCanvasElement | ImageBitmap, frameNo: number) {\n    /* this.setListenerResult('enterFrame', frameNo);\n    return; */\n\n    try {\n      if(frame instanceof Uint8ClampedArray) {\n        if(this.color) {\n          this.applyColor(frame);\n        }\n\n        if(this.inverseColor) {\n          this.applyInversing(frame);\n        }\n\n        this.imageData.data.set(frame);\n      }\n\n      // this.context.putImageData(new ImageData(frame, this.width, this.height), 0, 0);\n      this.contexts.forEach((context, idx) => {\n        let cachedSource: HTMLCanvasElement | ImageBitmap = this.cache.framesNew.get(frameNo);\n        if(!(frame instanceof Uint8ClampedArray)) {\n          cachedSource = frame;\n        } else if(idx > 0) {\n          cachedSource = this.canvas[0];\n        }\n\n        if(!cachedSource) {\n          // console.log('drawing from data');\n          const c = document.createElement('canvas');\n          c.width = context.canvas.width;\n          c.height = context.canvas.height;\n          c.getContext('2d').putImageData(this.imageData, 0, 0);\n          this.cache.framesNew.set(frameNo, c);\n          cachedSource = c;\n        }\n\n        if(this.overrideRender && this.renderedFirstFrame) {\n          this.overrideRender(cachedSource || this.imageData);\n        } else if(cachedSource) {\n          // console.log('drawing from canvas');\n          context.clearRect(0, 0, cachedSource.width, cachedSource.height);\n          context.drawImage(cachedSource, 0, 0);\n        } else {\n          context.putImageData(this.imageData, 0, 0);\n        }\n\n        if(!this.renderedFirstFrame) {\n          this.renderedFirstFrame = true;\n        }\n      });\n\n      this.dispatchEvent('enterFrame', frameNo);\n    } catch(err) {\n      console.error('RLottiePlayer renderFrame error:', err/* , frame */, this.width, this.height);\n      this.autoplay = false;\n      this.pause();\n    }\n  }\n\n  public renderFrame(frame: Parameters<RLottiePlayer['renderFrame2']>[0], frameNo: number) {\n    const canCacheFrame = this.cachingDelta && (frameNo % this.cachingDelta || !frameNo);\n    if(canCacheFrame) {\n      if(frame instanceof Uint8ClampedArray && !this.cache.frames.has(frameNo)) {\n        this.cache.frames.set(frameNo, new Uint8ClampedArray(frame));// frame;\n      } else if(IS_IMAGE_BITMAP_SUPPORTED && frame instanceof ImageBitmap && !this.cache.framesNew.has(frameNo)) {\n        this.cache.framesNew.set(frameNo, frame);\n      }\n    }\n\n    /* if(!this.listenerResults.hasOwnProperty('cached')) {\n      this.setListenerResult('enterFrame', frameNo);\n      if(frameNo === (this.frameCount - 1)) {\n        this.setListenerResult('cached');\n      }\n\n      return;\n    } */\n\n    if(this.frInterval) {\n      const now = Date.now(), delta = now - this.frThen;\n\n      if(delta < 0) {\n        const timeout = this.frInterval > -delta ? -delta % this.frInterval : this.frInterval;\n        if(this.rafId) clearTimeout(this.rafId);\n        this.rafId = window.setTimeout(() => {\n          this.renderFrame2(frame, frameNo);\n        }, timeout);\n        // await new Promise((resolve) => setTimeout(resolve, -delta % this.frInterval));\n        return;\n      }\n    }\n\n    this.renderFrame2(frame, frameNo);\n  }\n\n  public requestFrame(frameNo: number) {\n    const frame = this.cache.frames.get(frameNo);\n    const frameNew = this.cache.framesNew.get(frameNo);\n    if(frameNew) {\n      this.renderFrame(frameNew, frameNo);\n    } else if(frame) {\n      this.renderFrame(frame, frameNo);\n    } else {\n      if(this.clamped && !this.clamped.length) { // fix detached\n        this.clamped = new Uint8ClampedArray(this.width * this.height * 4);\n      }\n\n      this.sendQuery(['renderFrame', frameNo, this.clamped]);\n    }\n  }\n\n  private onLap() {\n    // this.playedTimes++;\n\n    if(!this.loop) {\n      this.pause(false);\n      return false;\n    }\n\n    return true;\n  }\n\n  private mainLoopForwards() {\n    const {skipDelta, maxFrame} = this;\n    const frame = (this.curFrame + skipDelta) > maxFrame ? this.curFrame = (this.loop ? this.minFrame : this.maxFrame) : this.curFrame += skipDelta;\n    // console.log('mainLoopForwards', this.curFrame, skipDelta, frame);\n\n    this.requestFrame(frame);\n    if((frame + skipDelta) > maxFrame) {\n      return this.onLap();\n    }\n\n    return true;\n  }\n\n  private mainLoopBackwards() {\n    const {skipDelta, minFrame} = this;\n    const frame = (this.curFrame - skipDelta) < minFrame ? this.curFrame = (this.loop ? this.maxFrame : this.minFrame) : this.curFrame -= skipDelta;\n    // console.log('mainLoopBackwards', this.curFrame, skipDelta, frame);\n\n    this.requestFrame(frame);\n    if((frame - skipDelta) < minFrame) {\n      return this.onLap();\n    }\n\n    return true;\n  }\n\n  public setMainLoop() {\n    // window.cancelAnimationFrame(this.rafId);\n    clearTimeout(this.rafId);\n\n    this.frInterval = 1000 / this.fps / this.speed * this.skipDelta;\n    this.frThen = Date.now() - this.frInterval;\n\n    // console.trace('setMainLoop', this.frInterval, this.direction, this, JSON.stringify(this.listenerResults), this.listenerResults);\n\n    const method = (this.direction === 1 ? this.mainLoopForwards : this.mainLoopBackwards).bind(this);\n    this.currentMethod = method;\n    // this.frameListener && this.removeListener('enterFrame', this.frameListener);\n\n    // setTimeout(() => {\n    // this.addListener('enterFrame', this.frameListener);\n    // }, 0);\n\n    if(this.frameListener) {\n      const lastResult = this.listenerResults.enterFrame;\n      if(lastResult !== undefined) {\n        this.frameListener(this.curFrame);\n      }\n    }\n\n    // this.mainLoop(method);\n    // this.r(method);\n    // method();\n  }\n\n  public playPart(options: {\n    from: number,\n    to: number,\n    callback?: () => void\n  }) {\n    this.pause();\n\n    const {from, to, callback} = options;\n    this.curFrame = from - 1;\n\n    return this.playToFrame({\n      frame: to,\n      direction: to > from ? 1 : -1,\n      callback\n    });\n  }\n\n  public playToFrame(options: {\n    frame: number,\n    speed?: number,\n    direction?: number,\n    callback?: () => void\n  }) {\n    this.pause();\n\n    const {frame, speed, callback, direction} = options;\n    this.setDirection(direction === undefined ? this.curFrame > frame ? -1 : 1 : direction);\n    speed !== undefined && this.setSpeed(speed);\n\n    const bounds = [this.curFrame, frame];\n    if(this.direction === -1) bounds.reverse();\n\n    this.loop = false;\n    this.setMinMax(bounds[0], bounds[1]);\n\n    if(this.playToFrameOnFrameCallback) {\n      this.removeEventListener('enterFrame', this.playToFrameOnFrameCallback);\n    }\n\n    if(callback) {\n      this.playToFrameOnFrameCallback = (frameNo: number) => {\n        if(frameNo === frame) {\n          this.removeEventListener('enterFrame', this.playToFrameOnFrameCallback);\n          callback();\n        }\n      };\n\n      this.addEventListener('enterFrame', this.playToFrameOnFrameCallback);\n    }\n\n    this.play();\n  }\n\n  public setColor(color: RLottieColor, renderIfPaused: boolean) {\n    this.color = color;\n\n    if(renderIfPaused && this.paused) {\n      this.renderFrame2(this.imageData.data, this.curFrame);\n    }\n  }\n\n  public setInverseColor(color: RLottieColor) {\n    this.inverseColor = color;\n  }\n\n  private setMinMax(minFrame = 0, maxFrame = this.frameCount - 1) {\n    this.minFrame = minFrame;\n    this.maxFrame = maxFrame;\n  }\n\n  public async onLoad(frameCount: number, fps: number) {\n    this.frameCount = frameCount;\n    this.fps = fps;\n    this.setMinMax();\n    if(this.initFrame !== undefined) {\n      this.initFrame = clamp(this.initFrame, this.minFrame, this.maxFrame);\n    }\n\n    const curFrame = this.resetCurrentFrame();\n\n    // * Handle 30fps stickers if 30fps set\n    if(this.fps < 60 && this.skipDelta !== 1) {\n      const diff = 60 / fps;\n      this.skipDelta = this.skipDelta / diff | 0;\n    }\n\n    this.frInterval = 1000 / this.fps / this.speed * this.skipDelta;\n    this.frThen = Date.now() - this.frInterval;\n    // this.sendQuery('renderFrame', 0);\n\n    //    ,   ()  519,\n    //   75%      ,  475, ..  100%   593,    84.\n\n    /* console.time('cache' + this.reqId);\n    for(let i = 0; i < frameCount; ++i) {\n      //if(this.removed) return;\n\n      if(i % 4) {\n        await new Promise((resolve) => {\n          delete this.listenerResults.enterFrame;\n          this.addListener('enterFrame', resolve, true);\n          this.requestFrame(i);\n        });\n      }\n    }\n\n    console.timeEnd('cache' + this.reqId); */\n    // console.log('cached');\n    /* this.el.innerHTML = '';\n    this.el.append(this.canvas);\n    return; */\n\n    !this.skipFirstFrameRendering && this.requestFrame(curFrame);\n    this.dispatchEvent('ready');\n    this.addEventListener('enterFrame', () => {\n      this.dispatchEvent('firstFrame');\n\n      if(!this.canvas[0].parentNode && this.el && !this.overrideRender) {\n        this.el.forEach((container, idx) => container.append(this.canvas[idx]));\n      }\n\n      // console.log('enterFrame firstFrame');\n\n      // let lastTime = this.frThen;\n      this.frameListener = () => {\n        if(this.paused || !this.currentMethod) {\n          return;\n        }\n\n        const time = Date.now();\n        // console.log(`enterFrame handle${this.reqId}`, time, (time - lastTime), this.frInterval);\n        /* if(Math.round(time - lastTime + this.frInterval * 0.25) < Math.round(this.frInterval)) {\n          return;\n        } */\n\n        // lastTime = time;\n\n        this.frThen = time + this.frInterval;\n        const canContinue = this.currentMethod();\n        if(!canContinue && !this.loop && this.autoplay) {\n          this.autoplay = false;\n        }\n      };\n\n      this.addEventListener('enterFrame', this.frameListener);\n      // setInterval(this.frameListener, this.frInterval);\n\n      // ! fix autoplaying since there will be no animationIntersector for it\n      if(this.group === 'none' && this.autoplay) {\n        this.play();\n      }\n    }, {once: true});\n  }\n}\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport Page from './page';\r\nimport lottieLoader from '../lib/rlottie/lottieLoader';\r\nimport {horizontalMenu} from '../components/horizontalMenu';\r\nimport {MOUNT_CLASS_TO} from '../config/debug';\r\nimport fastSmoothScroll from '../helpers/fastSmoothScroll';\r\nimport whichChild from '../helpers/dom/whichChild';\r\n\r\nclass PagesManager {\r\n  private pageId = -1;\r\n  private page: Page;\r\n\r\n  private selectTab: ReturnType<typeof horizontalMenu>;\r\n  public pagesDiv: HTMLDivElement;\r\n  public scrollableDiv: HTMLElement;\r\n\r\n  constructor() {\r\n    this.pagesDiv = document.getElementById('auth-pages') as HTMLDivElement;\r\n    this.scrollableDiv = this.pagesDiv.querySelector('.scrollable') as HTMLElement;\r\n    this.selectTab = horizontalMenu(null, this.scrollableDiv.querySelector('.tabs-container') as HTMLDivElement, null, () => {\r\n      if(this.page?.onShown) {\r\n        this.page.onShown();\r\n      }\r\n    });\r\n  }\r\n\r\n  public setPage(page: Page) {\r\n    if(page.isAuthPage) {\r\n      this.pagesDiv.style.display = '';\r\n\r\n      const id = whichChild(page.pageEl);\r\n      if(this.pageId === id) return;\r\n\r\n      this.selectTab(id);\r\n\r\n      if(this.pageId !== -1 && id > 1) {\r\n        lottieLoader.loadLottieWorkers();\r\n      }\r\n\r\n\r\n      this.pageId = id;\r\n\r\n      if(this.scrollableDiv) {\r\n        fastSmoothScroll({\r\n          container: this.scrollableDiv,\r\n          element: this.scrollableDiv.firstElementChild as HTMLElement,\r\n          position: 'start'\r\n        });\r\n      }\r\n    } else {\r\n      this.pagesDiv.style.display = 'none';\r\n      page.pageEl.style.display = '';\r\n\r\n      this.pageId = -1;\r\n    }\r\n\r\n    this.page = page;\r\n  }\r\n}\r\n\r\nconst pagesManager = new PagesManager();\r\nMOUNT_CLASS_TO.pagesManager = pagesManager;\r\nexport default pagesManager;\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport pagesManager from './pagesManager';\r\n\r\nexport default class Page {\r\n  public pageEl: HTMLDivElement;\r\n  private installed = false;\r\n\r\n  constructor(className: string, public isAuthPage: boolean, private onFirstMount?: (...args: any[]) => Promise<any> | void, private onMount?: (...args: any[]) => void, public onShown?: () => void) {\r\n    this.pageEl = document.body.querySelector('.' + className) as HTMLDivElement;\r\n  }\r\n\r\n  public async mount(...args: any[]) {\r\n    // this.pageEl.style.display = '';\r\n\r\n    if(this.onMount) {\r\n      this.onMount(...args);\r\n    }\r\n\r\n    if(!this.installed) {\r\n      if(this.onFirstMount) {\r\n        try {\r\n          const res = this.onFirstMount(...args);\r\n          if(res instanceof Promise) {\r\n            await res;\r\n          }\r\n        } catch(err) {\r\n          console.error('PAGE MOUNT ERROR:', err);\r\n        }\r\n      }\r\n\r\n      this.installed = true;\r\n    }\r\n\r\n    pagesManager.setPage(this);\r\n  }\r\n}\r\n","// https://github.com/twitter/twemoji-parser/blob/master/src/lib/regex.js\r\n\r\nexport function encodeEmoji(emojiText: string) {\r\n  const codepoints = toCodePoints(removeVS16s(emojiText)).join('-');\r\n  return codepoints;\r\n}\r\n\r\nconst vs16RegExp = /\\uFE0F/g;\r\n// avoid using a string literal like '\\u200D' here because minifiers expand it inline\r\nconst zeroWidthJoiner = String.fromCharCode(0x200d);\r\n\r\nconst removeVS16s = (rawEmoji: string) => (rawEmoji.indexOf(zeroWidthJoiner) < 0 ? rawEmoji.replace(vs16RegExp, '') : rawEmoji);\r\n\r\nexport function toCodePoints(unicodeSurrogates: string): Array<string> {\r\n  const points = [];\r\n  let char = 0;\r\n  let previous = 0;\r\n  let i = 0;\r\n  while(i < unicodeSurrogates.length) {\r\n    char = unicodeSurrogates.charCodeAt(i++);\r\n    if(previous) {\r\n      points.push((0x10000 + ((previous - 0xd800) << 10) + (char - 0xdc00)).toString(16));\r\n      previous = 0;\r\n    } else if(char > 0xd800 && char <= 0xdbff) {\r\n      previous = char;\r\n    } else {\r\n      points.push(char.toString(16));\r\n    }\r\n  }\r\n\r\n  if(points.length && points[0].length === 2) {\r\n    points[0] = '00' + points[0];\r\n  }\r\n\r\n  return points;\r\n}\r\n\r\nexport function getEmojiToneIndex(input: string) {\r\n  const match = input.match(/[\\uDFFB-\\uDFFF]/);\r\n  return match ? 5 - (57343 - match[0].charCodeAt(0)) : 0;\r\n}\r\n\r\nexport function getCountryEmoji(iso2: string) {\r\n  return String.fromCharCode(55356, 56741 + iso2.charCodeAt(0), 55356, 56741 + iso2.charCodeAt(1));\r\n}\r\n\r\nexport function emojiFromCodePoints(codePoints: string) {\r\n  return codePoints.split('-').reduce((prev, curr) => prev + String.fromCodePoint(parseInt(curr, 16)), '');\r\n}\n","!function(e,t){\"object\"==typeof exports&&\"object\"==typeof module?module.exports=t():\"function\"==typeof define&&define.amd?define([],t):\"object\"==typeof exports?exports.Recorder=t():e.Recorder=t()}(\"undefined\"!=typeof self?self:this,(function(){return function(e){var t={};function o(i){if(t[i])return t[i].exports;var n=t[i]={i:i,l:!1,exports:{}};return e[i].call(n.exports,n,n.exports,o),n.l=!0,n.exports}return o.m=e,o.c=t,o.d=function(e,t,i){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},o.r=function(e){\"undefined\"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:\"Module\"}),Object.defineProperty(e,\"__esModule\",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&\"object\"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(o.r(i),Object.defineProperty(i,\"default\",{enumerable:!0,value:e}),2&t&&\"string\"!=typeof e)for(var n in e)o.d(i,n,function(t){return e[t]}.bind(null,n));return i},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,\"a\",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p=\"\",o(o.s=0)}([function(e,t,o){\"use strict\";(function(t){var o=t.AudioContext||t.webkitAudioContext,i=function(e){if(!i.isRecordingSupported())throw new Error(\"Recording is not supported in this browser\");e||(e={}),this.state=\"inactive\",this.config=Object.assign({bufferLength:4096,encoderApplication:2049,encoderFrameSize:20,encoderPath:\"encoderWorker.min.js\",encoderSampleRate:48e3,maxFramesPerPage:40,mediaTrackConstraints:!0,monitorGain:0,numberOfChannels:1,recordingGain:1,resampleQuality:3,streamPages:!1,reuseWorker:!1,wavBitDepth:16},e),this.encodedSamplePosition=0};i.isRecordingSupported=function(){return o&&t.navigator&&t.navigator.mediaDevices&&t.navigator.mediaDevices.getUserMedia&&t.WebAssembly},i.prototype.clearStream=function(){this.stream&&(this.stream.getTracks?this.stream.getTracks().forEach((function(e){e.stop()})):this.stream.stop(),delete this.stream),this.audioContext&&this.closeAudioContext&&(this.audioContext.close(),delete this.audioContext)},i.prototype.encodeBuffers=function(e){if(\"recording\"===this.state){for(var t=[],o=0;o<e.numberOfChannels;o++)t[o]=e.getChannelData(o);this.encoder.postMessage({command:\"encode\",buffers:t})}},i.prototype.initAudioContext=function(e){return e&&e.context?(this.audioContext=e.context,this.closeAudioContext=!1):(this.audioContext=new o,this.closeAudioContext=!0),this.audioContext},i.prototype.initAudioGraph=function(){this.encodeBuffers=function(){delete this.encodeBuffers},this.scriptProcessorNode=this.audioContext.createScriptProcessor(this.config.bufferLength,this.config.numberOfChannels,this.config.numberOfChannels),this.scriptProcessorNode.connect(this.audioContext.destination),this.scriptProcessorNode.onaudioprocess=e=>{this.encodeBuffers(e.inputBuffer)},this.monitorGainNode=this.audioContext.createGain(),this.setMonitorGain(this.config.monitorGain),this.monitorGainNode.connect(this.audioContext.destination),this.recordingGainNode=this.audioContext.createGain(),this.setRecordingGain(this.config.recordingGain),this.recordingGainNode.connect(this.scriptProcessorNode)},i.prototype.initSourceNode=function(e){return e&&e.context?t.Promise.resolve(e):t.navigator.mediaDevices.getUserMedia({audio:this.config.mediaTrackConstraints}).then(e=>(this.stream=e,this.audioContext.createMediaStreamSource(e)))},i.prototype.loadWorker=function(){this.encoder||(this.encoder=new t.Worker(this.config.encoderPath))},i.prototype.initWorker=function(){var e=(this.config.streamPages?this.streamPage:this.storePage).bind(this);return this.recordedPages=[],this.totalLength=0,this.loadWorker(),new Promise((t,o)=>{var i=o=>{switch(o.data.message){case\"ready\":t();break;case\"page\":this.encodedSamplePosition=o.data.samplePosition,e(o.data.page);break;case\"done\":this.encoder.removeEventListener(\"message\",i),this.finish()}};this.encoder.addEventListener(\"message\",i),this.encoder.postMessage(Object.assign({command:\"init\",originalSampleRate:this.audioContext.sampleRate,wavSampleRate:this.audioContext.sampleRate},this.config))})},i.prototype.pause=function(e){if(\"recording\"===this.state){if(this.state=\"paused\",e&&this.config.streamPages){var t=this.encoder;return new Promise((e,o)=>{var i=o=>{\"flushed\"===o.data.message&&(t.removeEventListener(\"message\",i),this.onpause(),e())};t.addEventListener(\"message\",i),t.postMessage({command:\"flush\"})})}return this.onpause(),Promise.resolve()}},i.prototype.resume=function(){\"paused\"===this.state&&(this.state=\"recording\",this.onresume())},i.prototype.setRecordingGain=function(e){this.config.recordingGain=e,this.recordingGainNode&&this.audioContext&&this.recordingGainNode.gain.setTargetAtTime(e,this.audioContext.currentTime,.01)},i.prototype.setMonitorGain=function(e){this.config.monitorGain=e,this.monitorGainNode&&this.audioContext&&this.monitorGainNode.gain.setTargetAtTime(e,this.audioContext.currentTime,.01)},i.prototype.start=function(e){if(\"inactive\"===this.state)return this.initAudioContext(e),this.initAudioGraph(),this.encodedSamplePosition=0,this.initWorker().then(()=>this.initSourceNode(e)).then(e=>{this.sourceNode=e,this.state=\"recording\",this.onstart(),this.encoder.postMessage({command:\"getHeaderPages\"}),this.sourceNode.connect(this.monitorGainNode),this.sourceNode.connect(this.recordingGainNode)})},i.prototype.stop=function(){if(\"inactive\"!==this.state){this.state=\"inactive\",this.monitorGainNode.disconnect(),this.scriptProcessorNode.disconnect(),this.recordingGainNode.disconnect(),this.sourceNode.disconnect(),this.clearStream();var e=this.encoder;return new Promise(t=>{var o=i=>{\"done\"===i.data.message&&(e.removeEventListener(\"message\",o),t())};e.addEventListener(\"message\",o),e.postMessage({command:\"done\"}),this.config.reuseWorker||e.postMessage({command:\"close\"})})}return Promise.resolve()},i.prototype.destroyWorker=function(){\"inactive\"===this.state&&this.encoder&&(this.encoder.postMessage({command:\"close\"}),delete this.encoder)},i.prototype.storePage=function(e){this.recordedPages.push(e),this.totalLength+=e.length},i.prototype.streamPage=function(e){this.ondataavailable(e)},i.prototype.finish=function(){if(!this.config.streamPages){var e=new Uint8Array(this.totalLength);this.recordedPages.reduce((function(t,o){return e.set(o,t),t+o.length}),0),this.ondataavailable(e)}this.onstop(),this.config.reuseWorker||delete this.encoder},i.prototype.ondataavailable=function(){},i.prototype.onpause=function(){},i.prototype.onresume=function(){},i.prototype.onstart=function(){},i.prototype.onstop=function(){},e.exports=i}).call(this,o(1))},function(e,t){var o;o=function(){return this}();try{o=o||new Function(\"return this\")()}catch(e){\"object\"==typeof window&&(o=window)}e.exports=o}])}));"],"names":["animationIntersector","constructor","visible","Set","byGroups","lockedGroups","onlyOnePlayableGroup","intersectionLockedGroups","videosLocked","this","observer","IntersectionObserver","entries","entry","target","group","animation","find","p","el","isIntersecting","add","checkAnimation","delete","_animation","clearCache","overrideIdleGroups","doc","type","checkAnimations","idle","setOverrideIdleGroup","override","getAnimations","element","found","player","push","removeAnimation","remove","HTMLVideoElement","IS_SAFARI","setTimeout","src","load","length","unobserve","addAnimation","canvas","HTMLElement","loop","observe","blurred","destroy","undefined","groups","Object","keys","animations","paused","pause","has","autoplay","play","getOnlyOnePlayableGroup","setOnlyOnePlayableGroup","lockGroup","unlockGroup","refreshGroup","forEach","lockIntersectionGroup","unlockIntersectionGroup","SHOULD_USE_SAFARI_FIX","navigator","userAgent","match","err","AppMediaPlaybackController","media","Map","scheduled","mediaDetails","waitingMediaForLoad","waitingScheduledMediaForLoad","waitingDocumentsForLoad","playbackRates","voice","video","audio","seekBackward","details","playingMedia","currentTime","Math","max","seekOffset","seekForward","min","duration","seekTo","seekTime","onMediaDocumentLoad","get","managers","appDocsManager","getDoc","docId","supportsStreaming","handleSafariStreamable","cacheContext","thumbsStorage","getCacheContext","url","playbackRate","set","id","size","onPlay","e","peerId","mid","pip","message","getMessageByMedia","stop","setMedia","verify","listLoader","current","getCurrent","jumpLength","withOtherSide","previous","getPrevious","idx","findIndex","getNext","go","setTargets","dispatchEvent","getPlayingDetails","pauseMediaInOtherTabs","onPause","onEnded","isTrusted","lockedSwitchers","round","next","toggle","clean","s","isScheduled","storage","playingMediaType","playItem","item","searchContext","getMedia","resolveWaitingForLoadMedia","dispatchJump","goRound","browserPlay","bindBrowserCallback","browserPause","browserStop","browserSeekBackward","browserSeekForward","browserSeekTo","browserNext","browserPrevious","seekToStart","construct","container","document","createElement","style","cssText","body","append","mediaSession","actions","seekbackward","seekforward","seekto","previoustrack","nexttrack","action","setActionHandler","console","warn","skipMediaPlayEvent","properties","key","_key","value","dispatchPlaybackParams","defineProperties","getPlaybackParams","volume","muted","setPlaybackParams","params","_volume","_muted","_playbackRate","_loop","_round","addMedia","autoload","pFlags","is_scheduled","setAttribute","addEventListener","media_unread","fromId","appMessagesManager","readMessages","once","deferred","resolve","w","waitingStorage","then","promise","isSafariBuffering","safariBuffering","setSafariBuffering","setNewMediadata","pictureInPictureElement","artwork","isVoice","title","artist","thumbs","bytes","sizes","h","thumb","appPeersManager","getPeerPhoto","attribute","attributes","_","file_name","performer","IS_APPLE","metadata","MediaMetadata","setCurrentMediadata","playbackParams","cb","willBePlayed","willBePlayedMedia","setSearchContext","context","getSearchContext","prev","reset","loadCount","loadWhenLeft","processItem","onJump","older","onEmptied","reverse","folderId","getPlaybackMediaTypeFromMessage","mediaType","setSingleMedia","wasPlaying","toggleSwitchers","playPaused","removeEventListener","enabled","setPictureInPicture","listenerSetter","removeAll","appMediaPlaybackController","AppMediaViewer","captionTimeout","super","isForDocument","inputFilter","isMediaCompatibleForDocumentViewer","onPrevClick","openMedia","getMessageByPeer","onNextClick","onDeleteClick","content","close","onForwardClick","onAuthorClick","Number","MAX_SAFE_INTEGER","threadId","tab","lastMsgId","onDownloadClick","queueId","caption","classList","setCaptionTimeout","clearTimeout","window","onAdditionalScroll","wholeDiv","buttons","btnMenuForward","icon","text","onClick","btnMenuDownload","btnMenuDelete","setBtnMenuToggle","setListeners","forward","author","onCaptionClick","a","spoiler","HTMLAnchorElement","contains","onclick","getAttribute","includes","capture","click","getScheduledMessageByPeer","setCaption","html","entities","totalEntities","firstElementChild","fromRight","prevTargets","nextTargets","setMoverPromise","fwd_from","from_name","cantForwardMessage","canForward","button","cantDownloadMessage","download","canDeleteMessage","_openMedia","date","static","mime_type","VideoPlayer","streamable","onPlaybackRackMenuToggle","onPip","onPipClose","wrapper","setup","canHideControls","playbackRateButton","showOnLeaveToClassName","ignoreClickClassName","parentNode","insertBefore","appendChild","skin","stylePlayer","controls","querySelector","progress","prepend","catch","name","finally","initDuration","buildControls","timeDuration","insertAdjacentHTML","pipButton","querySelectorAll","fullScreenButton","timeElapsed","textContent","toHHMMSS","volumeSelector","leftControls","btn","parentElement","Array","from","togglePlay","requestPictureInPicture","visibility","debounceTime","debouncedPip","debounce","listener","timeout","overlayCounter","code","good","toggleFullScreen","altKey","nextIdx","PLAYBACK_RATES","indexOf","cancelEvent","onFullScreen","bind","hideControls","showControls","setPlaybackRateIcon","onMediaLoad","IS_MOBILE","pictureInPictureEnabled","map","rate","regularText","btnMenu","PLAYBACK_RATES_ICONS","className","IS_APPLE_MOBILE","webkitEnterFullscreen","enterFullscreen","isFull","cleanup","removeListeners","MEDIA_VIEWER_CLASSNAME","AppMediaViewerBase","topButtons","tempId","preloader","preloaderStreamable","isFirstOpen","pageEl","getElementById","zoomElements","zoomSwipeStartX","zoomSwipeStartY","zoomSwipeX","zoomSwipeY","setZoomValue","rangeSelector","moversContainer","transform","btnOut","btnIn","toggleZoom","setMoverAnimationPromise","tagName","highlightSwitchersTimeout","isZooming","mover","classNames","findUpClassName","onKeyDown","ctrlKeyDown","changeZoom","ctrlKey","metaKey","onKeyUp","onWheel","scrollingUp","deltaY","rootScope","log","logger","cancelable","lazyLoadQueue","overlaysDiv","mainDiv","topbar","topbarLeft","onlyMobile","authorRight","avatarEl","nameEl","buttonsDiv","concat","noRipple","zoom","step","withTransition","setHandlers","onScrub","onMouseUp","main","innerHTML","onLoadedMore","setNewMover","moveLength","onSwipe","xDiff","yDiff","abs","windowSize","verifyTouchTarget","evt","enable","isVisible","mousedown","zoomValue","setProgress","videoPlayer","lockControls","zoomSwipeHandler","lastDiffX","lastDiffY","multiplier","onFirstSwipe","onReset","cursor","addProgress","btnMenuToggle","Promise","reject","navigationItem","appNavigationController","clear","setMoverToTarget","onAnimationEnd","appMediaViewer","removeGlobalListeners","toggleOverlay","active","toggleGlobalListeners","setGlobalListeners","passive","closing","removeCenterFromMover","wasActive","delay","realParent","rect","getBoundingClientRect","SVGImageElement","SVGForeignObjectElement","left","needOpacity","overflowElement","visibleRect","getVisibleRect","overflow","vertical","horizontal","containerRect","top","aspecter","width","HTMLImageElement","setFullAspect","offsetLeft","height","scaleX","scaleY","borderRadius","getComputedStyle","getPropertyValue","brSplitted","str","splitted","split","i","fillPropertyValue","r","parseInt","join","willBeLeft","willBeTop","path","opacity","isOut","ret","isFulfilled","isRejected","SVGSVGElement","sizeTailPath","toggleWholeActive","mediaElement","selector","queryFrom","matches","elements","pop","getContext","naturalWidth","naturalHeight","videoWidth","videoHeight","HTMLCanvasElement","drawImage","image","Image","createVideo","clipId","dataset","newClipId","newSvg","createElementNS","setAttributeNS","outerHTML","replace","lastElementChild","defs","use","SVGUseElement","d","getAttributeNS","x","y","sX","sY","br","v","generatePathData","foreignObject","renderImageFromUrl","display","proportion","upscale","start","Date","now","diff","_br","moveTheMover","toLeft","windowW","newTransform","p1","newMover","updateMediaSource","toLowerCase","setAuthorInfo","timestamp","isPeerId","wrapTitlePromise","dialog","onlyFirstName","plainText","wrapEmojiText","oldAvatar","newAvatar","cloneNode","all","updateWithOptions","peerTitle","replaceContent","replaceWith","setAuthorPromise","isDocument","isVideo","useContainerAsTarget","IS_MOBILE_SAFARI","onPop","canAnimate","maxWidth","padding","windowH","mediaSizes","maxHeight","thumbPromise","setAttachmentSize","photoSize","img","downloaded","gotThumb","getStrippedThumbIfNeeded","loadPromise","useController","div","moverVideo","canPlayThrough","createPlayer","ckin","overlay","open","otherMediaViewer","releaseSingleMedia","show","readyState","HAVE_FUTURE_DATA","attach","attachCanPlay","detach","loading","networkState","NETWORK_LOADING","isntEnoughData","unshift","appDownloadManager","error","cancellablePromise","attachPromise","imgs","haveImage","setManual","onPopState","hash","location","state","debug","isPossibleSwipe","currentHash","overriddenHash","overrideHash","onHashChange","pushState","navigations","manual","handleItem","onEscape","back","onTouchStart","touches","options","history","scrollRestoration","replaceState","pushItem","noBlurOnPop","findItemByType","index","backByItem","splice","onItemAdded","noHistory","unshiftItem","spliceItems","items","origin","pathname","search","removeItem","removeByType","single","SearchGroup","clearable","clickable","autonomous","onFound","noIcons","list","setActive","childElementCount","AppSearch","searchInput","searchGroups","onSearch","minMsgId","loadedCount","foundCount","searchPromise","searchTimeout","query","listsContainer","scrollable","messages","setVirtualContainer","onChange","searchMore","onScrolledBottom","trim","beginSearch","inputField","input","focus","maxId","limit","res","count","shift","searchGroup","avatarSize","meAsSaved","SearchContextMenu","attachTo","searchSuper","onGotoClick","appImManager","selection","isSelecting","selectionForwardBtn","onSelectClick","toggleByElement","onClearSelectionClick","cancelSelection","selectionDeleteBtn","attachContextMenuListener","init","MouseEvent","preventDefault","cancelBubble","toPeerId","isSelected","isMidSelected","withSelection","positionMenu","contextMenuController","AppSearchSuper","tabs","prevTabId","middleware","historyStorage","usedFromHistory","urlsToRevoke","loadMutex","nextRates","loadPromises","loaded","loadedChats","firstLoad","monthContainers","mediaTabsMap","asChatList","groupByMonth","hideEmptyTabs","showSender","onTransitionStart","onTransitionEnd","safeAssign","searchContextMenu","navScrollableContainer","navScrollable","nav","tabsMenu","mediaTab","mediaTabs","menuTab","span","ripple","unlockScroll","tabsContainer","swipeHandler","handleTabSwipe","prevId","selectTab","children","onTouchMove","lockers","lockTouchScroll","contentTab","searchGroupMedia","canLoadMediaTab","horizontalMenu","tabContent","animate","skipScroll","scrollIntoViewNew","position","startCallback","scrollStartCallback","newMediaTab","onChangeTab","fromMediaTab","offsetTop","scrollTop","scroll","scrollHeight","rect2","onScroll","onMediaClick","targetClassName","targets","containerEl","copySearchContext","slice","inputMessagesFilterPhotoVideo","inputMessagesFilterDocument","useHeavyAnimationCheck","lock","unlockAndRefresh","filterMessagesByType","filterMessagesByInputFilter","processEmptyFilter","dom","appDialogsManager","setLastMessagePromise","lastMessage","highlightWord","processPhotoVideoFilter","promises","getMediaFromMessage","wrapped","choosePhotoSize","boxWidth","boxHeight","onlyPreview","withoutPreloader","noPlayButton","photo","noBlur","images","full","filter","Boolean","processDocumentFilter","withTime","fontWeight","voiceAsMusic","autoDownloadSize","processUrlFilter","webpage","entity","display_url","sliced","offset","matchUrl","same","URL","hostname","description","previewDiv","setInnerHTML","getAbbreviation","subtitleFragment","htmlToDocumentFragment","wrapRichText","innerText","decodeURIComponent","href","firstChild","wrapPlainText","row","titleRight","subtitle","havePadding","performSearchResult","elemsToAppend","sharedMediaDiv","processCallback","results","awaited","method","monthContainer","getMonthContainerByTimestamp","toggleElementCheckbox","afterPerforming","parent","child","loadChats","renderedPeerIds","inputMessagesFilterEmpty","setResults","showMembersCount","peer","getPeer","participants_count","participants","regExp","RegExp","escapeRegExp","cleanSearchText","titleSpan","lastMessageSpan","getChatMembersString","toChatId","username","getPeerUsername","user","appUsersManager","getUser","phone","formatPhoneNumber","formatted","onLoad","arg","getContactsPeerIds","contacts","searchContacts","my_results","globalContacts","showMore","intlElement","isShort","update","getConversations","dialogs","minDate","renderRecentSearch","recent","recentSearch","isUser","getUserStatusString","toUserId","getTopPeers","peers","people","loadMembers","renderParticipants","membersList","rippleEnabled","li","findUpTag","DIALOG_LIST_ELEMENT_TAG","participant","getParticipantPeerId","isAnyChat","deleted","appChatsManager","isChannel","LOAD_COUNT","appProfileManager","getChannelParticipants","getChatFull","chatFull","loadType","justLoad","used","slicedLength","ids","notFilteredMessages","m","checkForTriggers","getSearch","nextRate","next_rate","loadFirstTime","filters","counters","canViewMembers","getSearchCounters","firstMediaTab","counter","c","membersTab","loadFirstTimePromise","toLoad","t","findAndSplice","setHours","setDate","dateTimestamp","getTime","containers","month","getFullYear","year","dateElement","haveTimestamps","getObjectKeysAndSort","positionElementByIndex","isBroadcast","hasRights","cleanScrollPositions","cleanupHTML","goFirst","revokeObjectURL","putPreloader","empty","newInputFilter","copy","setQuery","maxDate","AppSelectPeers","chatsContainer","selected","freezed","offsetIndex","loadedWhat","peerType","multiSelect","exceptSelf","tempIds","selfPresence","needSwitchList","onInput","cachedContacts","getMoreResults","f","renderResultsFunc","renderResults","peerIds","splitUp","notRendered","filterPeerTypeBy","placeholder","section","innerContainer","topContainer","selectedContainer","selectedScrollable","sectionNameLangPackKey","noShadow","checkbox","checked","debouncedInput","appendTo","getResultsPromise","onFirstRender","renderSaved","testSelfSearch","getTempId","getMoreDialogs","archived","pageCount","newOffsetIndex","chatRightsAction","filterByRights","isEnd","getMoreContacts","isGlobalSearch","searchResult","resultPeerIds","arr","getMoreChannelParticipants","channelParticipants","q","isNonContactUser","checkboxField","label","subtitleEl","isDialog","insertAdjacentElement","offsetWidth","getSelected","addInitial","values","requestAnimationFrame","forceDirection","constructDownloadPreloader","tryAgainOnFail","circle","totalLength","mids","attr","elem","findMediaTargets","anchor","anchorMid","isBubbles","justAudioSelector","selectors","prefix","mediaItems","AudioElement","render","isRealVoice","isOutgoing","is_outgoing","uploadingFileName","durationStr","downloadDiv","onTypeLoad","audioEl","out","waveform","Uint8Array","valueCount","result","dataView","DataView","buffer","byteIndex","bitShift","getUint16","decodeWaveform","svg","svgContainer","availW","barHeightMax","minW","maxW","normValue","wfSize","barCount","maxValue","maxDelta","barX","sumI","bar_value","barWidth","createWaveformBars","fakeSvgContainer","waveformContainer","timeDiv","onTimeUpdate","throttledTimeUpdate","addAudioListener","readyPromise","mousemove","scrub","offsetX","targetTouches","pageX","scrubTime","wrapVoiceMessage","descriptionEl","audioAttribute","parts","titleEl","middleEllipsisEl","sizeType","subtitleDiv","launched","progressLine","lastChild","wrapAudio","audioTimeDiv","HAVE_CURRENT_DATA","onTypeDisconnect","getTimeStr","hadSearchContext","useSearch","autoDownload","shouldPlay","onDownloadInit","pauseListener","notifyAll","done","total","cancel","Error","playListener","setDownloadFunction","disconnectedCallback","isConnected","customElements","define","AvatarListLoader","loadMore","photoId","appPhotosManager","getUserPhotos","photos","loadedAllUp","AppMediaViewerAvatar","getPhoto","onAvatarUpdate","openAvatarViewer","getTarget","hadMessage","isObject","believeMe","seen","AvatarElement","addedToQueue","attachClickEvent","updateOptions","wasPeerId","newPeerId","onlyThumb","putPhoto","isBig","AvatarEdit","clearRect","asDiv","rippleSquare","disabled","ButtonMenuItem","noCheckboxClickListener","textElement","textArgs","keepOpen","menu","b","ButtonMenuToggleHandler","onOpen","onClose","openedMenu","direction","ChatBackgroundGradientRenderer","_width","_height","_tails","_scrollTails","_curve","_positions","_phases","_animatingToNextPosition","_scrollDelta","_onWheelRAF","drawOnWheel","floor","ceil","changeTail","curPos","curPosition","_phase","_tail","drawGradient","drawNextPositionAnimated","frames","_frames","drawImageData","leftLength","_incrementalCurve","hexToRgb","hex","g","getPositions","positions","getNextPositions","phase","curveMax","curve","pos","distances","nextPos","distance","tail","getGradientImageData","_hctx","createImageData","pixels","data","centerDistanceY","centerDistanceY2","centerDistanceX","swirlFactor","sqrt","theta","sinTheta","sin","cosTheta","cos","pixelX","pixelY","distanceSum","_colors","distanceX","distanceY","putImageData","_ctx","_hc","cancelAnimationFrame","colors","color","alpha","_canvas","fillStyle","fillRect","toNextPosition","tails","nextPhaseOnIdx","inc","toFixed","curves","last","scrollAnimate","_addedScrollListener","createCanvas","gradientRenderer","MEDIA_SIZE","wrapReplyDivAndCaption","mediaEl","messageMedia","isRound","mediaChildren","video_thumbs","noInfo","videoSize","ReplyContainer","isMediaSet","accumulateMapSet","reduce","acc","AppSelection","selectedMids","onMouseDown","targetLookupClassName","verifyTarget","selecting","firstTarget","processElement","checkBetween","isInDOM","seenSet","seenLength","findUpAsChild","elementsBetween","getElementsBetween","toggleByMid","canceledSelection","onMouseMove","getElementFromTarget","verifyMouseMoveTarget","removeManual","listenElement","documentListenerOptions","first","firstRect","lastRect","isHigher","lookupBetweenParentClassName","lookupBetweenElementsQuery","firstIndex","lastIndex","doNotAnimate","onCancelSelection","toggleSelection","navigationType","random","attachListeners","selectedText","getSelection","toString","createRange","verifyTouchLongPress","isElementShouldBeSelected","appendCheckbox","hasCheckbox","getCheckboxInputFromElement","updateContainer","forceSelection","cantForward","cantDelete","cantSend","storageKey","cantForwardDeleteMids","onUpdateContainer","toggleCheckboxes","wasSelecting","blurActiveElement","forwards","onToggleSelection","updateElementSelection","toggleMid","unselect","deleteSelectedMids","SearchSelection","selectionCountEl","selectionGotoBtn","selectionContainer","BASE_CLASS","btnCancel","attachClickOptions","obj","fromPeerId","sort","isPrivate","transitionElement","ChatSelection","chat","bubbles","recording","bubble","canSelectBubble","isGroupedBubbleSelected","getMidsFromGroupContainer","getBubbleGroupedItems","groupContainer","isGroupedSelected","isGroupedMidsSelected","mounted","getMountedBubble","needTranslateX","widthFrom","widthTo","center","selectionInputWrapper","selectionSendNowBtn","selectionLeft","selectionRight","translateButtonsX","right","inputContainer","toggleAttribute","skippedMids","isGrouped","groupedCheckboxInput","CheckboxField","restriction","toggleDisability","stateKey","stateValues","stateValue","setValueSilently","box","checkSvg","bg","border","withRipple","withHover","event","Event","disable","CodeInputField","autocomplete","lastLength","setLabel","onFill","confirmationPopup","callback","cancelButton","isCancel","checkboxes","countries","setCountries","country","hidden","default_name","localeCompare","CountryInputField","hidePicker","hideTimeout","selectWrapper","selectCountryByTarget","defaultName","phoneCodeEl","phoneCode","countryCode","lastCountrySelected","lastCountryCodeSelected","country_codes","_countryCode","country_code","onCountryChange","liMap","arrowDown","selectList","initSelect","emoji","iso2","liArr","noPhoneCodes","Infinity","spanEmoji","select","margin","mouseDownHandlerAttached","onKeyPress","_value","names","abbr","word","test","blur","selectCountryByIso2","countryName","DivAndCaption","fill","EditPeer","_disabled","isChanged","uploadAvatar","changedLength","requiredLength","requiredValidLength","inputFields","isValid","required","handleChange","nextBtn","withoutAvatar","avatarElem","doNotEditAvatar","avatarEdit","_upload","lockWithPromise","unlockOnSuccess","GifsTab","gifsContainer","EmoticonsDropdown","masonry","EMOTICONSSTICKERGROUP","getGifs","docs","processInvisibleDiv","ANIMATIONGROUP","AppGifsTab","nextOffset","loadedAll","onGifsClick","fileId","inputSearch","gifsDiv","onCloseAfterTimeout","newSearch","gifBotPeerId","resolveUsername","appInlineBotsManager","getInlineResults","next_offset","AppStickersTab","setsDiv","listenTo","sticker","stickerSet","access_hash","appStickersManager","getStickerSet","toggleStickerSet","changed","installed_date","removeAttribute","renderSet","header","countDiv","stickersDiv","stickerDiv","documents","withLock","renderFeatured","getFeaturedStickers","coveredSets","filterRendered","forEachReverse","covered","searchStickerSets","tabId","onSelectTabClick","searchButton","deleteBtn","checkRights","tabsEl","tabsElements","canSendStickers","canSendGifs","canSendToPeer","whichChild","savedRange","getGoodRange","unlock","refresh","emojiTab","stickersTab","gifsTab","HIDE_EMOJI_TAB","INIT_TAB_ID","lastMouseMoveEvent","mouseMoveEventAttached","isActive","onMouseOut","getElement","clearDraft","silent","emoticonsDropdown","forceClose","addLazyLoadQueueRepeat","divs","intersector","getVisible","clearVisible","getSavedRange","sel","rangeCount","activeElement","getRangeAt","menuOnClick","menuScroll","jumpedTo","stickyIntersector","stuck","which","axis","sendDocId","loadedURLs","appendEmoji","unify","kek","getEmojiEntityFromEmoji","wrapSingleEmoji","fixEmoji","getEmojiFromElement","nodeType","nodeValue","EmojiTab","closeScrollTop","onContentClick","categories","sorted","category","emojis","titleDiv","itemsDiv","unified","previousElementSibling","emojiScroll","appEmojiManager","getRecentEmojis","hasRecent","activeId","setMenuActive","recentItemsDiv","observeStickyHeaderChanges","LazyLoadQueueRepeat","parallelLimit","onVisibilityChange","_queue","spliced","findAndSpliceAll","queue","setProcessQueueTimeout","SuperStickerRenderer","regularLazyLoadQueue","animated","checkAnimationContainer","processVisible","processInvisible","renderSticker","observeAnimated","unobserveAnimated","StickersTab","categoriesMap","localCategories","setFavedLimit","appConfig","stickers_faved_limit_premium","stickers_faved_limit_default","createCategory","_title","menuTabPadding","categoriesIntersector","categoryAppendStickers","isCategoryVisible","superStickerRenderer","setCategoryItemsHeight","containerWidth","stickerSize","itemsPerRow","minHeight","renderStickerSet","menuWrapper","setTyping","intersectionOptions","root","clearCategoryItems","createLocalCategory","toggleLocalCategory","onCategoryStickers","stickers","deleteSticker","unshiftSticker","spliceExceed","favedCategory","recentCategory","clearButton","titleLangKey","descriptionLangKey","langKey","clearRecentStickers","noop","premiumCategory","apiManager","getAppConfig","getFavedStickersStickers","getRecentStickersStickers","getAllStickers","sets","getPremiumStickers","isPremium","race","rendererLazyLoadQueue","faved","resizeCategories","createStickersContextMenu","verifyRecent","notMounted","onLocalCategoryUpdate","batch","unshiftRecentSticker","saveRecentSticker","deleteRecentSticker","generateFakeIcon","isScam","LazyLoadQueueRepeat2","GifsMasonry","scrollPromise","processVisibleDiv","noPreview","gifWidth","gifHeight","willUseWidth","calcImageInBox","transitionTime","scrollableX","proxy","Proxy","apply","that","args","selectTarget","result1","canChange","forceDuration","mutateCallback","useStripe","indicator","currentIndicator","shiftLeft","scaleFactor","clientWidth","findUpAttribute","noLinebreaks","originalEvent","clipboardData","getData","usePlainText","filterEntity","curChild","nextSibling","richValue","getRichValue","entities2","parseEntities","mergeEntities","fragment","wrapDraftText","documentFragmentToHTML","execCommand","InputState","InputField","validate","maxLength","showLengthOn","canBeEdited","labelText","onInputCallbacks","String","isInputEmpty","inputMode","labelEl","showingLength","wasError","inputLength","isError","withLinebreaks","range","selectNodeContents","removeAllRanges","addRange","selectElementContents","labelOptions","fromSet","originalValue","isValidToChange","setDraftValue","setOriginalValue","setState","Valid","setError","InputSearch","prevValue","onClearClick","onClear","searchIcon","clearBtn","LazyLoadQueue","wasSeen","getItem","addElement","hasOwnProperty","LazyLoadQueueIntersector","inProcess","disconnect","loadItem","intersectorTimeout","processQueue","MediaProgressLine","useTransform","progressRAF","onLoadedData","seek","setLoadProgress","onProgress","filledLoad","setSeekMax","buf","buffered","numRanges","nearestStart","end","percents","testQueue","pendingTest","setTestQueue","testElement","getElementWidth","mapped","firstTime","textLength","font","textWidth","elementWidth","newElementWidth","widthChanged","smallerText","smallerWidth","smallerTextLength","half","half1","substr","half2","MiddleEllipsisElement","connectedCallback","PasswordMonkey","passwordInputField","needFrame","noCache","currentFrame","setSpeed","onVisibilityClickAdditional","passwordVisible","setDirection","curFrame","TrackingMonkey","playAnimation","frame","idleAnimation","PasswordInputField","onVisibilityClick","toggleVisible","stealthy","tabIndex","PeerProfileAvatars","avatar","avatars","draggable","loadCallback","intersectionObserver","loadCallbacks","addTab","gradient","info","arrowPrevious","arrowNext","checkScrollTop","SWITCH_ZONE","freeze","_e","clickX","toRight","cancelNextClick","minX","lastX","SCALE","TRANSLATE_TEMPLATE","addIndex","loadNearestToTarget","setPeer","backLimit","filterChatPhotosMessages","chat_photo","generateFakeAvatarMessage","activeTab","photo_id","setText","PeerProfile","setPeerStatus","needClear","noDelimiter","bio","subtitleLangKey","getProfileByPeerId","about","toast","link","notifications","togglePeerMute","appNotificationsManager","isPeerLocalMuted","setMoreDetails","fillUsername","userId","self","fillUserPhone","setAvatar","setPeerStatusInterval","setInterval","clearSetMoreDetailsTimeout","canBeDetailed","oldAvatars","formatUserPhone","fillNotifications","notificationsRow","fillRows","withIcons","fillProfileElements","cleaned","_setMoreDetails","peerFull","getChat","exportedInvite","exported_invite","address","setMoreDetailsTimeout","isRestricted","acknowledged","setPromise","cached","clearInterval","generateTitleIcons","verified","use2","generateVerifiedIcon","fake","scam","premium","generatePremiumIcon","weakMap","WeakMap","PeerTitle","setOptions","hasInner","fromName","limitSymbols","icons","getPeerTitle","inner","createDocumentFragment","PopupAvatar","closable","withConfirm","cropper","crop","removeHandlers","h6","btnClose","cropContainer","file","files","readBlobAsDataURL","contents","onload","originalImage","cropComponent","cropImage","event_state","cropLeft","cropTop","cropWidth","cropHeight","scaledRatio","overlayColor","CROPWIDTH","offsetHeight","CROPHEIGHT","updateCropSize","updateCropImage","startMoving","resizing","keyHandler","imgZoom","PI","bottom","newWidth","newHeight","clientHeight","fromCharCode","charCode","stopPropagation","container_width","container_height","container_left","container_top","mouse_x","clientX","scrollX","mouse_y","clientY","pageY","scrollY","saveEventState","moving","endMoving","currentTouch","complete","btnConfirm","hide","toBlob","blob","darkenCanvas","onCrop","postCanvas","ctx","PopupDeleteDialog","onSelect","peerTitleElement","getDialogType","callbackLeave","flush","leave","flushHistory","callbackDelete","descriptionArgs","isDanger","descriptionLangArgs","PopupDeleteMessages","onConfirm","revoke","deleteScheduledMessages","deleteMessages","titleArgs","isMegagroup","_hasRights","canRevoke","titleLangArgs","PopupForward","peerIdMids","overrideOnSelect","peerTypes","DEFAULT_APPEND_TO","appendPopupTo","onFullScreenChange","PopupElement","reAppend","middlewareHelper","MANAGERS","confirmShortcutIsSendShortcut","withoutOverlay","overlayClosable","isScrolledDown","btnConfirmOnEnter","buttonsEl","buttonsElements","langArgs","POPUPS","onContentUpdate","popup","popupConstructor","ctor","addCancelButton","times","time","ONE_HOUR","PopupMute","mutePeer","rows","radioField","radioForm","PopupPeer","noTitle","o","original","nextElementSibling","PopupPickUser","PopupSendNow","sendScheduledMessages","ANIMATION_GROUP","PopupStickers","stickerSetInput","isEmojis","onStickersClick","updateAdded","stickersFooter","onStickerSetUpdate","_set","updateButton","loadStickerSet","createStickerSetElements","headerRow","buttonRight","added","itemsContainer","setsPromises","isArray","firstSet","langPackKey","isStickerPack","onSend","containersPromises","stickerEmojiRaw","document_id","animationGroup","customEmojiSize","toggleStickerSets","isAdd","buttonAppend","installed","ProgressivePreloader","detached","isUpload","attachMethod","loadFunc","constructContainer","bold","constructDownloadIcon","downloadSvg","cancelSvg","func","startTime","onEnd","notify","elapsedTime","TRANSITION_TIME","addNotifyListener","useRafs","getTotalLength","strokeDasharray","Layouter","minWidth","spacing","ratios","countRatios","proportions","countProportions","averageRatio","accumulate","maxSizeRatio","layout","ComplexLayouter","layoutTwo","layoutThree","layoutFour","layoutTwoTopBottom","layoutTwoLeftRightEqual","layoutTwoLeftRight","layoutThreeLeftAndOther","layoutThreeTopAndOther","layoutFourTopAndOther","layoutFourLeftAndOther","geometry","sides","RectPart","minimalWidth","secondWidth","firstWidth","firstHeight","thirdHeight","secondHeight","rightWidth","leftWidth","thirdWidth","h0","w0","w2","w1","h1","h2","ratio","cropRatios","clamp","attempts","multiHeight","sum","pushAttempt","lineCounts","heights","second","third","fourth","optimalAttempt","optimalDiff","attempt","counts","lineCount","totalHeight","minLineHeight","bad1","bad2","line","optimalCounts","optimalHeights","rowCount","colCount","lineHeight","col","prepareAlbum","widthItem","heightItem","borderTopLeftRadius","borderBottomLeftRadius","borderTopRightRadius","borderBottomRightRadius","forMedia","mediaDiv","putAvatar","renderThumbPromise","thumbImage","isFullLoaded","stripped_thumb","getPreviewURLFromBytes","sequentialDom","renderPromise","myId","getPeerColorById","avatarAvailable","avatarRendered","appAvatarsManager","isAvatarCached","first_name","last_name","getPeerInitials","returnDiv","setButtonLoader","RadioField","alignRight","RadioForm","radios","form","RangeSelector","events","setFilled","filled","stepStr","decimals","_removeListeners","rectMax","offsetAxisValue","rippleClickId","attachListenerTo","handler","drawRipple","clickId","touchStartFired","clickY","isRippleUnneeded","touchEnd","Row","subtitleLangArgs","isToggle","noCheckboxSubtitle","titleRightSecondary","noWrap","titleRightEl","navigationTab","buttonRightLangKey","createMedia","RadioFormFromRows","SCROLL_THROTTLE","IS_ANDROID","ScrollableBase","logPrefix","onScrollMeasure","lastScrollPosition","lastScrollDirection","isHeavyAnimationInProgress","needCheckAfterAnimation","cancelMeasure","onScrolledTop","scrollPosition","scrollProperty","addScrollListener","addedScrollListener","removeScrollListener","removeHeavyAnimationListener","Scrollable","onScrollOffset","withPaddingContainer","maxScrollTop","getDistanceToEnd","setScrollTopSilently","ignoreNextScrollEvent","ScrollableX","splitCount","scrollHorizontally","deltaX","scrollWidth","scrollLeft","AppNewGroupTab","isGeoChat","setTitle","SettingSection","inputWrapper","groupNameInputField","groupLocationInputField","valueCheck","userLocationCoords","userLocationAddress","createChannel","geo_point","megagroup","chatId","inputFile","editPhoto","inviteToChannel","createChat","chatsSection","nameArgs","new","startLocating","geolocation","getCurrentPosition","lat","coords","latitude","long","longitude","uri","fetch","response","json","display_name","GeolocationPositionError","PrivacyType","getPrivacyRulesDetails","rules","types","allowPeers","users","chats","disallowPeers","rule","PrivacySection","onRadioChange","captions","captionElement","radioSection","exceptions","radioRows","skipTypes","noExceptions","generateSection","exceptionTexts","exception","_peerIds","slider","createTab","skippable","takeOut","newPeerIds","generateStr","splitPeersByType","selectedPeerIds","appPrivacyManager","getPrivacy","inputKey","setRadio","k","eventListener","chatKey","usersKey","getUserInput","setPrivacy","AppPrivacyPhoneNumberTab","getSelf","captionEl","mePath","anchorCopy","phoneSection","sCaption","AppTwoStepVerificationSetTab","captionOld","stickerContainer","inputContent","generateContentElement","btnReturn","sliceTabsUntilTab","AppSettingsTab","canFocus","isFirstInput","AppTwoStepVerificationEmailConfirmationTab","isFirst","email","codeInputField","passwordManager","confirmPasswordEmail","goNext","btnChange","btnResend","cancelPasswordEmail","AppTwoStepVerificationEmailTab","resendPasswordEmail","onOpenAfterTimeout","onContinueClick","btnContinue","btnSkip","matchEmail","toggleButtons","updateSettings","hint","currentPassword","plainPassword","newPassword","symbols","AppTwoStepVerificationHintTab","onSkipClick","saveHint","AppTwoStepVerificationReEnterPasswordTab","monkey","I","verifyInput","AppTwoStepVerificationEnterPasswordTab","isNew","has_password","textEl","getStateInterval","getState","_state","check","auth","AppTwoStepVerificationTab","removeTabFromHistory","btnChangePassword","btnDisablePassword","btnSetRecoveryEmail","has_recovery","btnSetPassword","AppPrivacyLastSeenTab","AppPrivacyProfilePhotoTab","AppPrivacyForwardMessagesTab","AppPrivacyAddToGroupsTab","AppPrivacyCallsTab","AppActiveSessionsTab","Session","app_name","app_version","ip","date_active","date_created","midtitle","device_model","system_version","platform","authorizations","session","btnTerminate","invokeApi","otherSection","onError","onTerminateClick","menuElement","AppBlockedUsersTab","btnAdd","toggleBlock","bot","blocked","getBlocked","convertKeyToInputKey","toUpperCase","AppPrivacyVoicesTab","AppPrivacyAndSecurityTab","SUBTITLE","blockedPeerIds","blockedUsersRow","passwordState","twoFactorRowOptions","email_unconfirmed_pattern","twoFactorRow","activeSessionsRow","updateActiveSessions","setBlockedCount","updateBlocked","rowsByKeys","numberVisibilityRow","lastSeenTimeRow","photoVisibilityRow","callRow","linkAccountRow","groupChatsAddRow","voicesRow","updatePrivacyRow","disallowLength","allowLength","destroyed","setGlobalPrivacySettings","archive_and_mute_new_noncontact_peers","getGlobalPrivacySettings","settings","onPremiumToggle","autoarchive_setting_available","_enabled","sensitive_enabled","sensitive_can_change","payment","appPaymentsManager","clearSavedInfo","deleteButton","appDraftsManager","clearAllDrafts","auths","averageColorFromCanvas","pixel","getImageData","pixelsLength","outPixel","Uint8ClampedArray","highlightningColor","rgba","l","ColorPicker","hue","saturation","lightness","onGrabStart","documentElement","boxDragger","onGrabEnd","sliders","hueDragger","hexInputField","rgbInputField","inputs","valid","setColor","rgbRegExp","attachBoxListeners","attachHueListeners","attachGrabListeners","boxRect","saturationHandler","hueRect","hueHandler","updateHexInput","updateRgbInput","rgb","boxX","percentY","boxY","percentHue","hueX","updatePicker","getCurrentColor","rgbaArray","hexa","hsl","hsla","maxX","maxY","posX","posY","lightnessX","lightnessY","AppBackgroundColorTab","_applyColor","updateColorPicker","colorPicker","background","theme","intensity","slug","appStateManager","pushToState","onColorChange","applyColor","themeController","gridSection","grid","backgroundColor","throttle","isColored","AppBackgroundTab","clicked","wallPapersByElement","elementsByKey","onUploadClick","accept","requestFile","endsWith","createObjectURL","mimeType","scaleMediaElement","File","wallPaper","prepareWallPaperUpload","uploadPromise","uploadWallPaper","uploadDeferred","newKey","getWallPaperKey","setBackgroundDocument","addWallPaper","onResetClick","defaultTheme","blurCheckboxField","onGridClick","wallpaper","saveToCache","_tempId","onReady","getPixelPromise","imageUrl","imageSource","averageColorFromImageSource","averageColor","getColorsFromWallPaper","toDataURL","getWallPaperKeyFromTheme","uploadButton","colorButton","resetButton","pattern","getWallPapers","wallPapers","gridContainer","background_color","second_background_color","third_background_color","fourth_background_color","hasFile","isDark","dark","noFadeIn","webkitMaskImage","AppQuickReactionTab","appReactionsManager","getQuickReaction","getAvailableReactions","quickReaction","availableReactions","reaction","inactive","availableReaction","static_icon","setDefaultReaction","RangeSettingSelector","initialValue","minValue","writeValue","nameDiv","valueDiv","valueContainer","AppGeneralSettingsTab","chatBackgroundButton","animationsCheckboxField","enterRow","ctrlEnterRow","kilometersRow","milesRow","formats","format","runFirst","getNextTimeout","_callback","run","eachTimeout","getSeconds","eachMinute","toLocaleTimeString","hour","minute","suggestCheckboxField","bigCheckboxField","reactionsRow","renderQuickReaction","loopCheckboxField","stickerSets","stickersContent","allStickers","assumeType","AppEditProfileTab","firstNameInputField","lastNameInputField","bioInputField","about_length_limit_premium","about_length_limit_default","editPeer","usernameInputField","setProfileUrl","availableText","takenText","invalidText","profileUrlContainer","profileUrlAnchor","updateProfile","uploadProfilePhoto","updateUsername","userFull","getProfile","AppNotificationsTab","NotifySection","enabledRow","typeText","previewEnabledRow","inputNotifyPeer","getNotifySettings","notifySettings","applySettings","isMuted","show_previews","mute","showPreviews","inputSettings","mute_until","updateNotifySettings","notify_settings","contactsSignUpRow","soundRow","sound","getContactSignUpNotification","setContactSignUpNotification","AppLanguageTab","invokeApiCacheable","lang_pack","languages1","languages2","rendered","webLangCodes","language","lang_code","native_name","langPack","autoDownloadPeerTypeSection","contactsCheckboxField","privateCheckboxField","groupsCheckboxField","channelsCheckboxField","AppAutoDownloadPhotoTab","AppAutoDownloadFileTab","debouncedSave","sizeMax","setByKey","MIN","MAX_RANGE","MAX","upTo","formatBytes","compareAndUpdate","AppAutoDownloadVideoTab","AUTO_DOWNLOAD_FOR_KEYS","private","channels","AppDataAndStorageTab","autoCheckboxField","autoDownloadNew","deepEqual","setSubtitles","setAutoDownloadSubtitle","photoRow","videoRow","fileRow","file_size_max","openTab","tabConstructor","onDisabledChange","gifsCheckboxField","videosCheckboxField","peerKeys","enabledKeys","isAll","logOut","edit","profile","fillPromise","changeAvatarBtn","upload","updateChangeAvatarBtn","devicesRow","languageRow","buttonsSection","lottieLoader","getAuthorizations","overwrite","getAuthorizationsPromise","AppNewChannelTab","channelNameInputField","channelDescriptionInputField","onLengthChange","broadcast","channelId","PopupCreateContact","importContact","nameInputField","telInputField","AppContactsTab","openContacts","isContact","sortedUserList","createList","renderPage","AppArchivedTab","wasFilterId","filterId","chatList","localId","AppPeopleNearbyTab","isLocationWatched","parseDistance","retryBtn","latestLocationSaved","accuracy","getLocated","updates","orderedPeers","groupsCounter","usersCounter","getPeerId","peopleSection","locatedPeers","sortedList","errorCategory","startWatching","watchPosition","isLongitudeDifferent","isLatitudeDifferent","distanceCheck","calculateDistance","stopWatching","lat1","long1","lat2","long2","asin","LEFT_COLUMN_ACTIVE_CLASSNAME","AppSidebarLeft","sidebarEl","sidebarHeader","onContactsClick","backBtn","btnArchive","dialogsStorage","getFolderDialogs","isDialogsLoaded","themeCheckboxField","filteredButtons","sessionStorage","kz_version","toolsBtn","btnMenuFooter","rel","newBtnMenu","updateBtn","reload","initSearch","archivedCount","folder","unreadPeerIds","formatNumber","checkUpdateInterval","cache","status","ok","hasUpdate","searchContainer","pickedElements","selectedPeerId","selectedMinDate","selectedMaxDate","updatePicked","setProperty","removeProperty","helper","unselectEntity","renderEntity","indexOfAndSplice","dates","dateData","pushRecentSearch","peopleContainer","hideNewBtnMenuTimeout","transition","activeClassName","onFocus","clearRecentSearchBtn","clearRecentSearch","fakeGradientDelimiter","generateDelimiter","hr","captionArgs","delimiter","appSidebarLeft","AppAddMembersTab","attachToPromise","removeLoader","isPrivacy","AppChatFoldersTab","filtersRendered","renderFolder","dialogFilter","non_contacts","broadcasts","bots","isAnyGroup","filtersStorage","getFilter","createFolderBtn","foldersSection","suggestedSection","canCreateFolder","onFiltersContainerUpdate","getDialogFilters","toggleAllChats","getSuggestedFilters","order","loadAnimationPromise","dialog_filters_limit_premium","dialog_filters_limit_default","getSuggestedDialogsFilters","suggestedFilters","includePeerIds","excludePeerIds","pinnedPeerIds","createDialogFilter","bool","AppIncludedChatsTab","getContacts","foundInFilters","dialogsByFilters","onSelectChange","confirmBtn","cmp","pinned_peers","other","otherLegacy","getInputPeerById","editFolderTab","setFilter","onAppConfig","dialog_filters_chats_limit_premium","dialog_filters_chats_limit_default","categoriesSection","exclude_muted","ico","exclude_archived","exclude_read","selectedPeers","addedInitial","_add","flag","originalFilter","AppEditFolderTab","flags","deleteFolderButton","updateDialogFilter","menuBtn","inputSection","generateList","h2Text","to","includedFlagsContainer","excludedFlagsContainer","include","include_peers","editCheckForChange","reloadMissingPromises","reloadMissingPeerIds","onCreateOpen","onEditOpen","ul","ignoreClick","hasPeer","getDialogOnly","filtered","filterAsync","renderMore","_length","exclude_peers","RIGHT_COLUMN_ACTIVE_CLASSNAME","AppSidebarRight","canHideFirst","isColumnProportionSet","toggleSidebar","setColumnProportion","createSharedMediaTab","replaceSharedMediaTab","previousTab","sharedMediaTab","historyTabIds","_selectTab","getFrom","setFrom","onCloseTab","isNavigation","willChange","animationPromise","appSidebarRight","AppEditContactTab","notificationsCheckboxField","profileNameDiv","profileSubtitleDiv","phoneRow","addContact","btnDelete","deleteContacts","AppChatTypeTab","privateRow","publicRow","privateSection","publicSection","linkRow","btnRevoke","getChatInviteLink","linkInputField","applyBtn","head","getValue","migrateChat","toggleNoForwards","onChatUpdate","noforwards","AppUserPermissionsTab","destroyListener","ChatPermissions","rights","banned_rights","editBanned","btnDeleteException","clearChannelParticipantBannedRights","kickFromChannel","exceptionText","toggleWith","defaultBannedRights","default_banned_rights","defaultRights","combineParticipantBannedRights","restrictionText","mainFlag","until_date","AppGroupPermissionsTab","chatPermissions","editChatDefaultBannedRights","addExceptionRow","openPermissions","getChannelParticipant","setSubtitle","bannedRights","cantWhat","listEl","setLength","exceptionsCount","loader","setLoader","getPromise","migrateFrom","migrateTo","AppChatReactionsTab","getActiveAvailableReactions","originalReactions","available_reactions","enabledReactions","toggleSection","toggleCheckboxField","toggleRow","reactionsSection","checkboxFields","saveReactionsDebounced","every","saveReactions","newReactions","getCachedFullChat","setChatAvailableReactions","AppEditChatTab","_init","chatUpdateListeners","addChatUpdateListener","canChangeType","canChangePermissions","chatNameInputField","descriptionInputField","chatTypeRow","setChatTypeSubtitle","setReactionsLength","availableReactionsLength","reactions","permissionsRow","setPermissionsLength","getChatTyped","editTitle","editAbout","signMessagesCheckboxField","signatures","toggleSignatures","showChatHistoryCheckboxField","togglePreHistoryHidden","hidden_prehistory","historiesStorage","AppSharedMediaTab","newCloseBtn","closeBtn","animatedCloseIcon","transitionContainer","transitionFirstItem","editBtn","transitionLastItem","secondTitle","setIsSharedMedia","isSharedMedia","onCloseBtnClick","toggleEditBtn","renderNewMessages","msgs","deleteDeletedMessages","btnAddMembers","showConfirmation","addChatUser","setLoadMutex","peerChanged","loadSidebarMedia","destroyable","SetTransition","raf","afterTimeout","SidebarSlider","closeTab","closingId","preserveTab","getTab","isTabExists","doNotAppend","SliderSuperTab","_constructor","SliderSuperTabEventable","SortedUserList","getIndex","getUserStatusForSort","onDelete","onListLengthChange","onUpdate","onSort","willChangeLength","onElementCreate","base","updateElementWith","updateListWith","createChatListOptions","doTimeout","updateList","SORT_INTERVAL","CLASS_NAME","StackedAvatars","avatarContainer","AVATAR_CLASS_NAME","hasViewer","attachStickerViewerListeners","findTarget","checkForParent","closest","mediaContainer","previousGroup","_middleware","previousTransformer","doThatSticker","lockGroups","isSwitching","effectThumb","mediaRect","boxSize","fitted","aspectFitted","transformer","stickerEmoji","transformX","transformY","needFadeIn","withThumb","relativeEffect","loopEffect","firstFramePromise","prevPlayer","ready","onMousePreMove","newMediaContainer","_previousTransformer","StickyIntersector","observeHeaders","observeElements","headersObserver","targetInfo","boundingClientRect","stickyTarget","rootBoundsInfo","rootBounds","threshold","elementsObserver","addSentinel","sentinel","headerSentinel","getEvent","attachGlobalListenerTo","RESET_GLOBAL","SwipeHandler","listenerOptions","hadMove","xDown","yDown","handleMove","setCursorTo","handleStart","xUp","yUp","onSwipeResult","setCursor","TelInputField","pasted","lastValue","telEl","HTMLInputElement","pixelRatio","devicePixelRatio","letterSpacing","originalFunc","formattedPhoneNumber","leftPattern","shiftKey","toastEl","hideToast","toastNew","langPackArguments","slideNavigation","prevTabContent","slideTabs","TransitionSlider","isHeavy","animationFunction","Transition","withAnimationListener","onTransitionEndCallbacks","animationDeferred","listenerName","onEndEvent","overrideFrom","onTransitionEndCallback","_from","isUsernameValid","UsernameInputField","checkUsernameDebounced","checkUsername","checkUsernamePromise","available","VisibilityIntersector","locked","change","refreshVisible","VolumeSelector","onMuteClick","setVolume","iconIndex","ICONS","wrapPhoto","withTail","noThumb","blurAfter","isWebDoc","isWebDocument","noAutoDownload","isFit","loadThumbPromise","isGif","renderOnLoad","renderMediaWithFadeIn","canAttachPreloader","haveToDownload","onlyCache","getDownloadPromise","roundVideoCircumference","wrapVideo","isAlbumItem","canAutoplay","spanTime","spanPlay","needPlayButton","photoRes","divRound","halfSize","strokeWidth","radius","strokeDashoffset","globalVideo","onPaused","onFrame","uploadFileName","renderDeferred","loadPhotoThumbFunc","wrapAlbum","attachmentDiv","uploading","wrapDocument","audioElement","extSplitted","ext","docDiv","icoDiv","icoTextEl","hadContext","hasThumb","performance","fileName","bytesContainer","descriptionParts","bytesMaxEl","sizeDiv","_downloadDiv","addByteProgress","sizeContainer","_bytesContainer","_d","save","canOpenAfter","downloadFileName","getDownloadMediaDetails","downloadId","apiFileManager","isDownloading","wrapGroupedDocuments","albumMustBeRenderedFull","messageDiv","nameContainer","getMidsByMid","getMessage","richText","AppPollResultsTab","resultsDiv","poll","appPollsManager","getPoll","quiz","question","voters","total_voters","roundPercents","answer","answers","answerEl","answerTitle","answerPercents","getVotes","option","votesList","votes","vote","user_id","down","lineTotalLength","minIndex","minRemainder","remainder","maxRemainder","pollElement","isClosed","closed","performResults","chosenIndexes","PollElement","setMaxLength","resizePolls","hideQuizHint","onHide","prevQuizHint","prevQuizHintOnHide","prevQuizHintTimeout","isListenerSet","isQuiz","isRetracted","isPublic","isMultiple","chosingIndexes","sentVote","MAX_LENGTH","MAX_OFFSET","svgLines","setLineProgress","descKey","public_voters","multiple_choice","multipleSelect","descDiv","typeDiv","avatarsDiv","close_period","close_date","timeLeftDiv","quizTimer","circumference","period","closeTime","quizInterval","timeLeft","stroke","getResults","answerDivs","numberDivs","footerDiv","viewResults","votersCountDiv","sendVoteBtn","sendVotes","canVote","setVotersCount","clickHandler","initQuizHint","solution","solution_entities","toggleHint","setQuizHint","correctResult","correct","chosen","answerIndex","foundIndex","indexes","sendVotePromise","sendVote","timeEl","recent_voters","stackedAvatars","isVoted","hideSendVoteBtn","hideViewResultsBtn","maxPercents","getPercentValue","iterate","fullTime","votersCount","wrapPoll","wrapReply","setColorPeerId","replyContainer","wrapStickerSetThumb","downloadOptions","getStickerSetThumbDownloadOptions","videos","animationData","needUpscale","wrapStickerToRow","previousMedia","_size","_limitSymbols","support","was_online","today","getDate","dateEl","wrapJoinVoiceChatAnchor","wrapUrl","call","wrapLinkToMessage","plain","savedFrom","dir","wrapMessageActionTextNew","unsafeMessage","getNameDivHTML","formatCallDuration","post","schedule_date","daysToStart","tomorrowDate","_args","day","pinnedMessage","reply_to_mid","fetchMessageReplyTo","htmlToSpan","joined","anchorHTML","domain","isRecurringInit","recurring_init","isRecurringUsed","recurring_used","paymentsWrapCurrencyAmount","total_amount","currency","invoiceMessage","reply_to","reply_to_peer_id","waited","wrapMessageActionTextNewUnsafe","wrapMessageForReply","usingMids","withoutMediaType","hasAlbumKey","addPart","part","usingFullAlbum","grouped_id","getMidsByMessage","albumText","getAlbumText","emoticon","game","actionWrapped","restriction_reason","exec","messageWrapped","noLinks","noTextFormat","wrapPeerTitle","wrapSenderToPeer","senderTitle","fromMe","wrapSentTime","STICKER_EFFECT_MULTIPLIER","locksUrls","wrapSticker","loadStickerMiddleware","exportLoad","skipRatio","asStatic","fullThumb","noPremium","isCustomEmoji","stickerType","emojiSticker","animatedSticker","staticSticker","isAnimated","getStickerEffectThumb","willHaveLock","lockUrl","toneIndex","isThumbNeededForType","lottieCachedThumb","getLottieCachedThumb","haveThumbCached","afterRender","num","getPathFromBytes","ns","getPreviewURLFromThumb","stickerThumbConverted","webpWorkerController","saveWebPConvertedStrippedThumb","getImageFromStrippedThumb","middlewareError","makeError","sync","setLockColor","dpr","skipx","skipy","imageData","sr","sg","sb","sa","outCanvas","outContext","computeLockColor","saveLottiePreview","onFirstFrame","preloadAnimatedEmojiStickerAnimation","isSingleVideo","mediaLength","lastPromise","_media","preloadSticker","playing","animationDiv","stickerPromise","side","attachStickerEffectHandler","onEmojiStickerClick","emojiData","sendInteractionThrottled","msg_id","getServerMessageId","interaction","JSON","stringify","getAnimatedEmojiSoundDocument","restart","getAnimatedEmojiSticker","withRandomOffset","wrapStickerAnimation","unmountAnimation","frameNo","maxFrame","vibrate","generateRandomSigned","randomOffsetX","randomOffsetY","setPosition","factor","stableOffsetX","stableOffsetY","rectX","rectY","addOffsetX","addOffsetY","wrapStickerEmoji","wrapWebPageDescription","webPage","shortDescriptionText","wrapWebPageTitle","shortTitle","site_name","EmojiVersions","Emoji","version","assign","FontFamily","FontSize","FontWeight","instances","cancelAnimationByKey","instance","getAnimationInstance","isCancelled","animateSingle","tick","createAnimationInstance","array","AudioAssetPlayer","assets","playSound","assetName","createAudio","playSoundIfDifferent","Audio","stopSound","cancelDelayedPlay","playSoundWithTimeout","heavyQueue","processingQueue","addHeavyTask","processHeavyQueue","todo","possiblePromise","process","realResult","timedChunk","requireBlurPromise","fastBlurFunc","processBlurNext","iterations","default","dataUri","JPEG_HEADER","bytesFromHex","JPEG_TAIL","isSticker","btoa","bytesToDataURL","imageW","imageH","boxW","boxH","noZoom","boxedImageW","boxedImageH","getTextWidth","measureText","mediaSize","quality","badCharsRe","trimRe","C2L","clearBadCharsAndTrim","latinize","processSearchText","clearBadChars","ignoreCase","hasTag","includeTag","charAt","originalText","ch","latinizeCh","latinizeString","fixCyrillic","copyTextToClipboard","clipboard","writeText","textArea","removeChild","fallbackCopyTextToClipboard","ContextMenuController","diffX","diffY","isOpened","openBtnMenu","months","days","ONE_DAY","getWeekNumber","UTC","getMonth","dayNum","getUTCDay","setUTCDate","getUTCDate","yearStart","getUTCFullYear","formatDateAccordingToTodayNew","weekday","formatFullSentTimeRaw","formatTime","capitalize","textTransform","formatFullSentTime","getFullDate","joiner","monthAsNumber","getHours","getMinutes","noSeconds","leadingZero","noTime","minYear","yearPattern","monthYearOrDayPattern","yearOrDayAndMonthPattern","shortDate","longDate","numberOfDaysEachMonth","fillTipDates","setFullYear","dayOfWeek","formatWeekLong","getDay","getDayOfWeek","setTime","g1","g2","createForDayMonth","createForMonthYear","selectedYear","currentYear","g3","validDateForMonth","formatterYearMax","k1","setMonth","formatterMonthYear","formatterDayMonth","_cancelContextMenuOpening","_cancelContextMenuOpeningTimeout","cancelContextMenuOpening","onCancel","onStart","onMove","isTouch","onTouchEnd","CLICK_EVENT_NAME","touchMouseDown","detachClickEvent","simulateClickEvent","ControlsHover","setHideTimeout","hideControlsTimeout","isShown","controlsLocked","toggleControls","relatedTarget","verifyFavoriteSticker","toAdd","favedStickers","some","_doc","findElement","filterButtons","attachListenerSetter","_element","initResult","createContextMenu","disablePictureInPicture","computedStyle","getProperty","simulateEvent","childNodes","node","tag","requestFullScreen","requestFullscreen","mozRequestFullScreen","webkitRequestFullscreen","msRequestFullscreen","cancelFullScreen","mozCancelFullScreen","webkitCancelFullScreen","msExitFullscreen","addFullScreenListener","addListener","eventName","getFullScreenElement","fullscreenElement","mozFullScreenElement","webkitFullscreenElement","msFullscreenElement","isFullScreen","markdownTags","entityName","underline","italic","monospace","strikethrough","mentionName","BLOCK_TAG_NAMES","getRichElementValue","lines","selNode","selOffset","follow","isBlock","alt","isTableCell","wasEntitiesLength","wasLength","field","withEntities","getViewportSlice","overflowRect","extraSize","invisibleTop","invisibleBottom","foundVisible","lookForSticky","overflowTop","overflowRight","overflowBottom","overflowLeft","sticky","windowWidth","windowHeight","handleHorizontalSwipe","cancelY","DocumentFragment","template","hasAttribute","isSendShortcutPressed","isComposing","secondaryKey","isSwipingBackSafari","TouchEvent","placeCaretAtEnd","ignoreTouchCheck","selectionStart","selectionEnd","collapse","createTextRange","textRange","moveToElementText","prevPos","backgroundImage","useCache","isImage","renderImageFromUrlPromise","DropdownHover","inited","ignoreMouseOut","displayTimeout","toElement","willBeActive","dispatchResultableEvent","attachButtonListener","onmouseout","onmouseover","setIgnoreMouseOut","ignore","FocusDirection","fastSmoothScroll","maxDistance","Static","scrollWithJs","getNormalSize","rectStartKey","rectEndKey","sizeKey","scrollSizeKey","scrollPositionKey","elementRect","elementPosition","elementSize","containerSize","scrollSize","fallbackToElementStartWhenCentering","remainingPath","absPath","startAt","shortTransition","longTransition","currentPath","distanceToEnd","FILENAME_JOINER","getFileNameByLocation","thumb_size","big","stickerset","short_name","thumb_version","volume_id","local_id","strictDecimals","_decimals","dm","fixed","pow","parseFloat","CALL_DURATION_LANG_KEYS","showLast","modulus","formatDuration","strings","prefixes","maxPrefixLength","setPrefix","originalStr","prefixCountry","patterns","searchForPattern","mostMatchedPatternMatches","mostMatchedPattern","_pattern","patternMatches","symbol","arcParameter","rx","ry","xAxisRotation","largeArcFlag","sweepFlag","tl","tr","bl","useBlur","ignoreCache","ListLoader","loadedAllDown","setLoaded","unsetCurrent","toPrevious","goUnsafe","loadPromiseDown","loadPromiseUp","processedArr","processed","ListenerSetter","listeners","addManual","onceCallback","onceFired","_listener","MediaSize","aspect","aspectCovered","makeMediaSize","ScreenSize","MediaSizes","screenSizes","mobile","medium","large","handhelds","regular","album","esgSticker","documentName","invoice","customEmoji","esgCustomEmoji","desktop","isMobile","handleResize","innerWidth","activeScreen","wasScreen","rAF","middlewarePromise","throwWhat","numberThousandSplitter","HAVE_METADATA","useCanplayOnIos","OverlayClickHandler","withOverlay","amount","skipSymbol","isNegative","currencyData","amountExp","exp","number","dec_point","thousands_sep","n","isFinite","prec","sep","dec","toFixedFix","number_format","decimal_sep","space_between","symbol_left","splitter","additionalPadding","getScrollWidthFromElement","menuWidth","menuHeight","paddingTop","paddingRight","paddingBottom","paddingLeft","verticalSide","maxTop","maxLeft","minLeft","intermediateX","intermediateY","possibleSides","platforms","getRestrictionReason","reasons","reason","savingLottiePreview","isSavingLottiePreview","saving","throttleWithRaf","fn","schedulerFn","waiting","throttleWith","ScrollableLoader","SearchListLoader","messageId","generateMessageId","filterMids","onHistoryDelete","shouldBeDeleted","onHistoryMultiappend","onMessageSent","isInner","otherSideLoader","filterMessagesByInputFilterFromStorage","goToOtherEnd","do","kind","scheduleFlush","measure","mutate","mutateElement","read","write","pushDocumentSize","_isWebDocument","replies","comments","channel_id","SortedList","_updateList","canUpdate","getAll","updateBatch","noScheduler","encodeEntities","charCodeAt","limitFrom","leadZero","sec_num","hours","minutes","seconds","visualViewport","innerHeight","ANIMATION_START_EVENT","ANIMATION_END_EVENT","isAnimating","heavyAnimationPromise","promisesInQueue","dispatchHeavyAnimationEvent","perf","_heavyAnimationPromise","onHeavyAnimationEnd","interruptHeavyAnimation","getHeavyAnimationPromise","handleAnimationStart","handleAnimationEnd","DialogsContextMenu","onArchiveClick","selectedId","editPeerFolders","folder_id","onPinClick","toggleDialogPin","config","getConfig","pinned_dialogs_count_max","onUnmuteClick","onUnreadClick","unread_count","readHistory","top_message","markDialogUnread","onContextMenu","getDeleteButtonText","isDialogUnread","pinned","ConnectionStatusComponent","hadConnect","connecting","timedOut","updating","setConnectionStatus","baseDcId","connectionStatus","setFirstConnectionTimeout","online","apiUpdatesManager","forceGetDifference","retryAt","setStatusText","currentLangPackKey","statusEl","statusPreloader","singleInstance","CHANGE_STATE_DELAY","getA","networkerFactory","forceReconnect","timerSpan","interval","forceReconnectTimeout","setStateTimeout","statusContainer","SENDING_STATUS","easeInOutSine","roundRect","defaultRadius","beginPath","moveTo","lineTo","quadraticCurveTo","closePath","DPR","SIZE","MARGIN","WIDTH","RADIUS","Shimmer","currTime","diffTime","spread","pausedTime","pauseInterval","lightSource","lightSpread","currentAnimationIndex","keepTime","cycleAnimation","currentAnimation","animateGlow","animateSlide","smartInc","lightLeft","lightRight","lightCenter","createLinearGradient","customProperties","shimmerColor","addColorStop","dict","on","fillText","DialogsPlaceholder","onThemeChange","stopAnimation","startAnimation","onResize","updateCanvasSize","shimmer","generatedValues","marginVertical","lineBorderRadius","lineMarginVertical","statusWidth","getRectFrom","onRemove","blockScrollable","overflowY","availableLength","detachTime","renderDetachAnimationFrame","globalCompositeOperation","completed","elapsedRowTime","dialogHeight","renderFrame","createPattern","patternCanvas","patternContext","drawChat","firstLineWidth","secondLineWidth","marginLeft","arc","drawCircle","drawCircleFromStart","setPromiseMiddleware","oldPromise","SortedDialogList","indexKey","getDialogIndex","addListDialog","isBatch","AppDialogsManager","Log","placeholders","sortedLists","scrollables","folders","menuScrollContainer","lastActiveElements","offsets","initedListeners","loadedDialogsAtLeastOnce","onTabChange","loadDialogsRenderPromise","loadDialogsPromise","onChatsScroll","_onListLengthChange","checkIfPlaceholderNeeded","hasContacts","removeContactsPlaceholder","updateContactsLength","dialogSize","loadContacts","verifyPeerIdForContacts","processContact","setListClickListener","onChatsRegularScroll","sliceTimeout","scrollTopWas","rectContainer","rectTarget","firstY","lastY","firstElement","elementFromPoint","lastElement","elementOverflow","sliceFromStart","sliceFromEnd","deleteDialog","setOffsets","onChatsScrollTop","loadDialogs","getProxiedManagers","contextMenu","bottomPart","allChatsIntlElement","isFilterIdAvailable","clearCurrent","onStateLoaded","setFilterId","addFilter","foldersScrollable","_id","filtersNavigationItem","setFilterIdAndChangeTab","changeFiltersAllChatsKey","groupCallsController","callsController","getDialogIndexKey","getDialogIndexKeyByFilterId","setOnlineStatus","hasClassName","initListeners","getDialogDom","isBot","processDialogForCallStatus","setFilterUnreadCount","setLastMessageN","setUnread","validateDialogForFilter","setFiltersUnreadCount","updateDialog","setUnreadMessagesN","drop","setDialogActive","getCachedDialogs","validateListForFilter","onFiltersLengthChange","containerToAppend","renderedFilter","typings","unsetTyping","dialogDom","callIcon","filtersArr","haveFilters","addFilters","addFiltersPromise","showFiltersPromise","getNotifyPeerTypeSettings","fillConversations","getOffsetIndex","isDialogMustBeInViewport","migratedTo","testDialogForFilter","topOffset","bottomOffset","unreadSpan","unread","unreadUnmutedCount","unreadCount","getFolderUnreadCount","generateScrollable","sortedDialogList","createChatList","wasShowing","cachedInfoPromise","currentOffsetIndex","needIndex","getConversationsResult","isTopEnd","callbacks","cccc","offsetDialog","generateEmptyPlaceholder","classNameType","subtitleArgs","placeholderContainer","needPlaceholder","emptyDialogsPlaceholderSubtitle","usersLength","placeholderType","updatePartClassName","updateContactsLengthPromise","firstDialog","getDialogFromElement","lastDialog","withContext","openInner","lastActiveListElement","setPeerFunc","sameElement","getDialogByPeerId","setLastMessage","draftMessage","draft","topMessage","lastTimeSpan","isMessageRestricted","willPrepend","videoTypes","playIcon","senderBold","setUnreadMessages","wasMuted","setStatusMessage","isPinned","hasUnreadBadge","transitionDuration","disableAnimationIfRippleFound","iconClassName","setSendingStatus","statusSpan","isUnreadBadgeMounted","unreadBadge","hasMentionsBadge","unread_mentions_count","isMentionBadgeMounted","mentionsBadge","isUnread","isMention","getDialog","originalDialog","getOutputPeer","setCallStatus","START_X","wasMounted","itemProgress","groupCallActiveIcon","addDialogNew","call_active","call_not_empty","addDialogAndSetLastMessage","getMessageSenderPeerIdOrName","addDialog","captionDiv","titleSpanContainer","peerTitlePromise","titleP","rightSpan","oldTypingElement","newTypingElement","downloads","getNewDeferred","cancelDownload","clearDownload","getNewDeferredForUpload","getUpload","getDownload","getUploadPromise","getDownloadFileNameFromOptions","downloadMedia","promiseBefore","downloadMediaURL","downloadMediaVoid","getFileNameForUpload","downloadToDisc","justAttach","pingPromise","iframe","hadProgress","getDocumentDownloadOptions","getPhotoDownloadOptions","clickEvent","createEvent","initMouseEvent","createDownloadAnchor","BubbleGroup","createAvatar","avatarLoadPromise","fwdFrom","fwdFromId","isForwardFromChannel","from_id","currentPeerId","firstTimestamp","firstItem","firstMid","lastTimestamp","lastItem","lastMid","updateClassNames","insertItem","insertInDescendSortedArray","sortGroupItemsKey","insertGroup","mount","onItemUnmount","mountItem","onItemMount","unmountItem","dateContainer","getDateContainerByTimestamp","dateGroups","_group","dateGroupsLength","unmountedLength","STICKY_OFFSET","deleteEmptyDateGroups","BubbleGroups","itemsArr","itemsMap","newGroupDiff","sortItemsKey","sortGroupsKey","removeItemFromCache","removeAndUnmountBubble","getItemByBubble","siblings","getSiblingsAtIndex","modifiedGroups","previousSibling","canItemsBeGrouped","groupUngrouped","mountUnmountGroups","toMount","toUnmount","bad","partition","getLastGroup","changeBubbleMid","insertItemToArray","changeItemBubble","changeBubbleByBubble","item1","item2","itemIndex","findGroupSiblingByItem","findGroupSiblingInItems","previousItem","siblingGroupedItem","nextItem","addItemToGroup","addItemToCache","getMessageFromId","viaBotId","createItem","SERVICE_AS_REGULAR","getDateForDateContainer","groupMid","splitSiblingsOnGrouping","prepareForGrouping","hadGroup","foundItem","splittedGroups","PopupDatePicker","initDate","onPick","noButtons","selectedDate","selectedMonth","minMonth","prevBtn","maxMonth","onDateClick","selectedEl","setTimeTitle","controlsDiv","monthTitle","monthsContainer","handleTimeInput","onOverflow","maxString","hoursInputField","minutesInputField","setMinutes","popupCenterer","timeOptions","sendDate","dateOptions","renderElement","firstDate","weekStartDate","dayIndex","clonedDate","showOverflowMonths","ReactionElement","reactionCount","_reactionCount","setCanRenderAvatars","canRenderAvatars","doNotRenderSticker","hadStickerContainer","getReaction","callbackify","center_icon","wrapPromise","wrapStickerPromise","renderCounter","displayOn","renderAvatars","recentReactions","peer_id","setIsChosen","isChosen","fireAroundAnimation","REACTION_INLINE_SIZE","REACTION_BLOCK_SIZE","around_animation","iconPlayer","aroundPlayer","REACTIONS_ELEMENTS","ReactionsElement","onConnectCallback","getReactionCount","reactionElement","isPlaceholder","changeMessage","changedResults","hasReactions","availableReactionsResult","isReactionActive","totalReactions","can_see_list","reactionElementIdx","recent_reactions","handleChangedResults","timeSpan","RepliesElement","updated","postKey","leftPart","recent_repliers","read_max_id","max_id","textSpan","iconSpan","rippleContainer","subscribeRepliesThread","updateMessage","makeEdited","edited","makeSponsored","MessageRender","chatType","editedSpan","sponsoredSpan","reactionsElement","reactionsMessage","isSponsored","sponsored","isMessage","views","postAuthor","post_author","postViewsSpan","channelViews","edit_date","edit_hide","clonedArgs","_reactionsElement","renderReplies","bubbleContainer","isFooter","repliesFooter","setReply","isReplacing","currentReplyDiv","replyToPeerId","originalMessage","originalPeerTitle","titlePeerId","originalMessageFwdFromId","needUpdate","replyMid","getElementByPoint","horizontalSide","reflowScrollableElement","SEND_WHEN_ONLINE_TIMESTAMP","INTERNAL_LINK_TYPE","PopupJoinChatInvite","chatInvite","request_needed","importChatInvite","savePhoto","peopleCount","ScrollSaver","getSaved","findElements","replaceSaved","findAndSetElements","_save","scrollHeightMinusTop","onRestore","useReflow","setScrollTop","newScrollTop","restore","_restore","previousScrollHeightMinusTop","SuperIntersectionObserver","observing","observingQueue","freezedObservingNew","toggleObservingNew","isMentionUnread","mentioned","stringResults","numberResults","replaceNonNumber","CARD_BRAND_REGEXP","visa","mastercard","amex","discover","diners","diners14","jcb","unionpay","elo","mir","CARD_BRANDS","minLength","cvcMaxLength","cvcMinLength","unknown","detectCardBrand","card","sanitizedCard","brand","detectUnifiedCardBrand","createArray","delta","buggedRegExp","getDistanceFromBuggedToNormal","char","fixBuggedNumbers","makeOptionalCharacter","consumed","makeRequiredCharacter","partial","wrapCharacterRegExpFactory","optional","_regExp","source","makeCharacter","makeMonthDigitPatternCharacter","digit","capitalCharacter","cleanedResult","formattingCharacter","str1","makeFormattingCharacter","optionalPattern","spaceCharacter","yearOptionalPattern","sixteenPattern","fifteenPattern","requiredPostcodes","generateFourPattern","cardFormattingPatterns","cardNumber","cardExpiry","cardCvc","cardCvcFromBrand","postalCodeFromCountry","optionalDigits","accumulateLengths","strs","nbspRegExp","makeValidationError","validateCardNumber","sanitized","getCardInfoByNumber","ignoreIncomplete","validateCompleteCardNumber","makeCardNumberError","validateCardExpiry","monthStr","yearStr","_year","nextMonth","isNaN","validateExpiry","createVerificationIframe","allow","contentWindow","parse","PopupPaymentVerification","eventType","eventData","path_full","InputFieldCorrected","lastKeyDown","deleting","lastTransformed","getPattern","pushRest","autocorrectComplete","character","getCharacter","meta","formatInputValueByPattern","formatMethod","transformedValue","validateNew","onBlur","justReturn","validateMethod","validateAnyIncomplete","errorKeys","handleInputFieldsOnChange","_onChange","createCountryZipFields","zip","countryInputField","postcodeInputField","SUPPORTED_NATIVE_PROVIDERS","PopupPaymentCard","paymentForm","savedCard","native_provider","cardOut","token","credentials","can_save_credentials","cardSection","nativeParams","native_params","lastBrand","lastBrandImg","brandIconTempId","cardInputField","invalid","incomplete","transformed","getPaymentBrandIconPath","setBrandIcon","cvcInputField","need_cardholder_name","expireInputField","switchFocusOrder","previousInputField","nextInputField","inputFieldsRow","billingSection","need_country","need_zip","canSave","saveCheckboxField","saveRow","payButton","PaymentButton","expiryFull","expiryMonth","expiryYear","cvc","cardholderName","nativeProvider","URLSearchParams","headers","publishable_key","expiration_month","expiration_year","security_code","public_token","PopupPaymentCardConfirmation","inputCheckPassword","getInputCheckPassword","tmpPassword","password","handled","PopupPaymentShipping","inputInvoice","savedInfo","saved_info","addressSection","address1InputField","address2InputField","cityInputField","stateInputField","receiverSection","emailInputField","shipping_address_requested","name_requested","email_requested","phone_requested","validateEmail","validatePhone","selectedCountry","shipping_address","street_line1","street_line2","city","country_iso2","post_code","requestedInfo","validateRequestedInfo","shippingAddress","ADDRESS_STREET_LINE1_INVALID","ADDRESS_STREET_LINE2_INVALID","ADDRESS_COUNTRY_INVALID","ADDRESS_CITY_INVALID","ADDRESS_STATE_INVALID","ADDRESS_POSTCODE_INVALID","REQ_INFO_NAME_INVALID","REQ_INFO_EMAIL_INVALID","REQ_INFO_PHONE_INVALID","focusField","PopupPaymentShippingMethods","shippingOption","shipping_options","prices","lastShippingId","PopupPayment","tipButtonsMap","confirmed","onConfirmed","popupPaymentVerification","mediaInvoice","isReceipt","receipt_msg_id","isTest","itemEl","detailsClassName","photoEl","linesClassName","linesEl","botName","preloaderContainer","getPaymentReceipt","getPaymentForm","savedCredentials","saved_credentials","lastRequestedInfo","providerPeerTitle","provider_id","bot_id","wrapAmount","isRecurring","recurring","peerTitle2","makeLabel","pricesClassName","makePricesElements","price","_label","wrappedAmount","pricesElements","getTipsAmount","shippingAmount","setTotal","totalAmount","totalLabel","payI18n","canTip","max_tip_amount","tip_amount","tipsClassName","getInputValue","setInputWidth","setInputValue","unsetActiveTip","tipEl","tipsLabel","haveToIgnoreEvents","onSelectionChange","ignoreNextSelectionChange","onFocusOut","tipsEl","tipClassName","tipButtons","suggested_tip_amounts","tipAmount","prevTipEl","setRowIcon","createRow","setRowTitle","setCardSubtitle","methodRow","onMethodClick","previousCardDetails","previousToken","credentials_title","providerRow","providerAvatar","shippingAddressRow","shippingNameRow","shippingEmailRow","shippingPhoneRow","shippingMethodRow","lastShippingOption","onShippingAddressClick","onShippingMethodClick","setShippingTitle","postAddress","setShippingInfo","setShippingOption","scrollSaver","lastShippingPricesElements","shipping","acceptTermsCheckboxField","recurring_terms_url","acceptTermsRow","recurringElements","lastTmpPasword","missingInfo","tmp_password","paymentResult","sendPaymentForm","form_id","_passwordState","valid_until","tsNow","IGNORE_ACTIONS","TEST_SCROLL_TIMES","TEST_SCROLL","PEER_CHANGED_ERROR","getMainMidForGrouped","ChatBubbles","unreadOut","bubblesNewByGroupedId","bubblesNew","dateMessages","scrolledDown","isScrollingTimeout","unreaded","unreadedSeen","messagesQueuePromise","messagesQueue","messagesQueueOnRenderAdditional","firstUnreadBubble","replyFollowHistory","isFirstLoad","passEntities","viewsMids","isTopPaddingSet","renderingMessages","bubblesToEject","bubblesToReplace","setPeerTempId","renderNewPromises","unreadedObserverCallback","onUnreadedInViewport","viewsObserverCallback","sendViewCountersDebounced","sponsoredMessage","random_id","viewSponsoredMessage","stickerEffectObserverCallback","onBubblesMouseMove","unhoverPrevious","hoverBubble","hoverReaction","setHoverVisible","stickerWrapper","getGroupsFirstMessage","getMiddleware","getAvailableReactionsByMessage","select_animation","CHAT_ANIMATION_GROUP","sendReaction","onBubblesClick","setInnerPeer","chatInner","onDatePick","contactDiv","callDiv","callUser","getInputInvoiceByPeerId","stickerEmojiEl","bubbleMid","reply_to_top_id","saved_from_msg_id","openThread","message1","getMessageWithReplies","getDiscussionMessage","via","setDraft","peerIdStr","documentDiv","groupedItem","SINGLE_MEDIA_CLASSNAME","isSingleMedia","parents","hasAspecter","albumItem","isReplyClick","replyToMid","reply_to_msg_id","ignoreHeavyAnimation","scrollDimensions","forceDown","sliceViewportDebounced","setCorrectIndexThrottled","setStickyDateManually","setPeerPromise","requestHistory","setMessageId","constructBubbles","bubbleGroups","sequential","messagesStorageKey","newItem","_items","groupBubbles","scrollingToBubble","scrollToEnd","deleteMessagesByIds","tempMessage","_bubble","groupedId","getMessagesByAlbum","reactionsElements","repliesElement","newDiv","safeRenderMessage","scrollToBubbleIfLast","deletedMids","wasMainMid","mainMid","createScrollSaver","appendReactionsElementToBubble","dateMessage","dateBubble","previousStickyDate","sliceViewport","setScroll","attachContainerListeners","highlightBubble","replyAfter","shouldReply","canSend","_target","initMessageReply","constructPeerHelpers","renderNewMessage","setUnreadCount","updateUnreadByDialog","finishPeerChange","postViewsElements","different","postViews","incrementMessageViews","createResizeObserver","resizeObserver","wasHeight","skip","scrolled","onResizeEnd","setEndRAF","ResizeObserver","contentRect","realDiff","_part","needScrollTop","destroyResizeObserver","setReactionsHoverListeners","getRenderedLength","readUnreaded","readPromise","idleController","bubblesMaxId","getHistoryMaxId","readContents","constructPinnedHelpers","constructScheduledHelpers","getScheduledMessagesStorage","onGoDownClick","getBubbleByPoint","getGroupedBubble","groupId","getMidsByAlbum","findNextMountedBubbleByMsgId","filterCallback","_mid","foundMid","loadMoreHistory","getHistoryTopPromise","getHistoryBottomPromise","getHistory1","destroyScrollable","getHistoryStorage","readMaxId","readOutboxMaxId","msgId","permanent","ignoreOnScroll","emptyPlaceholderBubble","setTopPadding","setPaddingTo","isPaddingNeeded","unsetPadding","_renderNewMessage","newMessage","replyTo","getLastBubble","performHistoryResult","scrollToBubbleEnd","scrollToBubble","isChangingHeight","messageInput","dimensions","datasetKey","createDateBubble","bubbleContent","serviceMsg","fakeBubble","bubblesToo","cleanupPlaceholders","attachedUnreadBubble","fetchNewPromise","getSponsoredMessagePromise","onAnimateLadder","resolveLadderAnimation","attachPlaceholderOnRender","samePeer","startParam","bindPrefix","onChangePeer","getPinnedMessagesMaxId","isTarget","followingUnread","savedPosition","overrideAdditionMsgId","getChatSavedPosition","getReadMaxIdIfUnread","foundSlice","findSliceOffset","isJump","isStartButtonNeeded","setStartParam","setQueueId","messageEntityBotCommand","additionMsgId","maxBubbleId","oldChatInner","oldPlaceholderBubble","haveToScrollToBubble","fromUp","scrollFromDown","scrollFromUp","willScrollOnLoad","setPeerOptions","waitPromise","setPeerCached","mountedByLastMsgId","setCorrectIndex","lastBubble","onRenderScrollSet","afterSetPromise","setFetchReactionsInterval","setFetchHistoryInterval","onScrolledAllDown","unread_mark","fetchReactions","getMessagesReactions","needFetchInterval","isFetchIntervalNeeded","getNewHistory","isBottomEnd","historyMaxId","canWrite","renderMessagesQueue","setMessagesQueuePromise","possibleError","renderQueue","renderQueuePromises","loadQueue","filterQueue","avatarPromises","updatePosition","timePromises","groupCollapsed","groupEnd","setUnreadDelimiter","restoreScroll","prepareToSaveScroll","ejectBubbles","oldBubble","local","updatePlaceholderPosition","isAvatarNeeded","additionalCallback","processResult","create","newBubble","originalPromise","renderMessage","albumMids","albumMessages","our","isOurMessage","contentWrapper","isInUnread","chat_id","is_single","messageMessage","bigEmojis","emojiEntities","strLength","curr","canHaveTail","isStandaloneMedia","needToSetHTML","replyMarkup","reply_markup","containerDiv","rowDiv","buttonEl","botId","same_peer","checkSwitchReturn","switchInlineQuery","column","callbackButtonClick","callbackAnswer","messageWithReplies","getMessageWithCommentReplies","withReplies","isOutMessage","canHideNameIfMedia","processingWebPage","quote","previewResizer","preview","quoteTextDiv","strong","textDiv","isSquare","isEmoji","nopremium","newNameContainer","lastContainer","contact","contactDetails","contactNameDiv","contactNumberDiv","phone_number","priceEl","needName","titleVia","isHidden","goto","generateTail","documentContainer","documentMessageDiv","viewportSlice","deleteViewportSlice","historyResult","needReflowScroll","setLoadedPromises","firstSlice","lastSlice","both","processLocalMessageRender","getHistory","ackedResult","getScheduledMessages","animateAsLadder","additionMsgIds","isAdditionRender","targetMid","sortedMids","topIds","middleIds","bottomIds","setBubbles","lastMsDelay","elementsToAnimate","transitionDelay","topRes","middleRes","bottomRes","delays","renderEmptyPlaceholder","listElements","getRestrictionReasonText","getGreetingSticker","channel_post","start_param","chat_invite","chat_invite_hash","JOIN_CHAT","invite","processInternalLink","creator","isWaitingForAnimation","noTransition","setOn","generateLocalMessageId","addOffset","generateLocalFirstMessage","service","saveMessages","ignoreScrollSaving","invisible","checkPlaceholders","toggleSponsoredMessage","renderBotPlaceholder","checkIfEmptyPlaceholderNeeded","_log","getSponsoredMessage","sponsoredMessages","messagePromise","processPromise","bot_info","botInfo","description_document","description_photo","isBackLimit","resultPromise","isFirstMessageRender","serviceStartMessageId","getThreadServiceMessageId","sup","_promise","mustBeCount","PopupPinMessage","unpin","canUnpin","canPinMessage","oneSide","unpinAllMessages","hidePinnedMessages","updatePinnedMessage","buttonText","getPinnedMessagesCount","pinButtonText","isSelectionEmpty","selectionRange","START_TO_END","preloadAnimatedEmojiSticker","PopupReportMessagesConfirm","reportMessages","STICKER_EMOJI","PopupReportMessages","preloadStickerPromise","marginTop","PopupSponsored","PopupReactedList","canViewReadParticipants","canViewMessageReadParticipants","loaders","hasAllReactions","createFakeReaction","hasReadParticipants","readUserIds","getMessageReadParticipants","chatlist","skipReadParticipants","skipReactionsList","getMessageReactionsListAndReadParticipants","combined","getReactionCached","allReactionsSticker","REACTION_CLASS_NAME","REACTIONS_CLASS_NAME","CAN_USE_TRANSFORM","ChatReactionsMenu","reactionsMap","players","onScrollProcessItem","reactionDiv","appear","widthContainer","reactionsContainer","reactionsScrollable","renderReaction","setVisible","canUseAnimations","scaleContainer","appearWrapper","appear_animation","selectLoadPromise","selectPlayer","REACTION_SIZE","ChatContextMenu","isSelectable","isTextSelected","isAnchorTarget","isUsernameTarget","selectedMid","isOverBubble","isTargetAGroupedItem","noForwards","viewerPeerId","canOpenReactedList","menuPadding","reactionsMenu","reactionsMenuPosition","isReactionsMenuVisible","offsetSize","nextVisiblePart","MIN_NEXT_VISIBLE_PART","minSize","onSendScheduledClick","onReplyClick","onFaveStickerClick","unfave","faveSticker","onEditClick","initMessageEditing","onCopyClick","onCopyAnchorLinkClick","onCopyLinkClick","threadMessage","onUnpinClick","onRetractVote","onStopPoll","stopPoll","setButtons","notDirect","scheduleSending","editMessage","scheduleDate","canEditMessage","getMessageFromStorage","hasTarget","isGoodType","localName","emojiInputsPromise","viewsButton","isViewingReactions","participantsCount","reactedLength","i18nElem","fakeText","AVATAR_SIZE","MAX_AVATARS","PADDING_PER_AVATAR","reactionsCount","fakeElem","readParticipants","totalSize","emojisButton","setPadding","docIds","filterUnique","inputsPromise","getCachedCustomEmojiDocuments","getCustomEmojiDocuments","SendMenu","sendMenuButtons","onSilentClick","onScheduleClick","sendMenu","openSide","onContextElement","setPeerId","PopupCreatePoll","onSubmitClick","send","radioLabel","isEmpty","questions","appendMoreField","correctAnswers","optionInputFields","questionInputField","sendSilent","dd","settingsCaption","anonymousCheckboxField","multipleCheckboxField","quizCheckboxField","quizSolutionField","quizElements","quizSolutionCaption","quizHr","quizSolutionContainer","quizSolutionSubtitle","getFilledAnswers","quizSolution","force","quizSolutionEntities","inputMediaPoll","getInputMediaPoll","sendOther","getMessageSendingParams","helperType","clearHelper","questionField","createPosterFromMedia","getGifDuration","arrayBuffer","currentPopup","getCurrentNewMediaPopup","PopupNewMedia","willAttachType","attachFile","willAttach","shouldCompress","itemDiv","attachMedia","attachDocument","sendFileDetails","captionLengthMax","caption_length_max","wasInputValue","messageInputField","attachFiles","appendDrops","appendGroupCheckboxField","groupCheckboxField","mediaCheckboxField","appendMediaCheckboxField","addFiles","toPush","_file","lastModified","isMedia","sendingParams","sendText","sendAlbum","replyToMsgId","startsWith","objectURL","audioDecodedByteCount","webkitAudioDecodedByteCount","noSound","onseeked","onerror","createPosterFromVideo","isPhoto","isAudio","finish","onRender","foundPhotos","foundVideos","foundFiles","appendMediaToContainer","firstType","albumContainer","HANDLE_EVENT","ACTIVE_CLASS_NAME","AXIS_Y_KEYS","AXIS_X_KEYS","attachListNavigation","waitForKey","waitForKeySet","keyNames","getCurrentTarget","setCurrentTarget","scrollTo","hadTarget","getNextTargetX","currentTarget","isNext","nextTarget","handleArrowKey","property","endProperty","currentRect","targetRect","getNextTargetY","fireSelect","canContinue","attached","resetTarget","_onKeyDown","AutocompleteHelper","onVisible","listType","attachNavigation","controller","addHelper","toggleListNavigation","fromController","skipAnimation","hideOtherHelpers","StickersHelper","onChangeScreen","checkEmoticon","getStickersByEmoticon","getMinDate","getMaxDate","PopupSchedule","canSendWhenOnline","btnSendWhenOnline","getRichValueWithCaret","startOffset","startContainer","endContainer","endOffset","possibleChildrenFocusOffset","caretPos","combineSameEntities","EmojiHelper","chatInput","onEmojiSelected","checkQuery","firstChar","getBothEmojiKeywords","searchEmojis","AutocompletePeerHelper","doNotShow","listElement","BASE","BASE_CLASS_LIST_ELEMENT","processPeerFullForCommands","botInfos","commands","command","indexObject","CommandsHelper","getReadyToSend","sendMessage","AutocompleteHelperController","helpers","preserveHelper","MentionsHelper","insertAtCaret","topMsgId","trimmed","getMentions","ReplyKeyboard","onBodyTouchStart","btnHover","checkAvailability","checkForceReply","touchListener","sendContact","getReplyMarkup","getHistoryStorageTransferable","InlineHelper","queryId","queryAndResultIds","generateQId","resultId","sendInlineResult","_checkQuery","botResults","query_id","gifsMasonry","isGallery","gallery","noCommands","separator","dcId","dataURL","switch_pm","btnSwitchToPM","switchToPM","ChatBotCommands","setUserId","modifyAckedResult","acked","modifyAckedPromise","ChatSendAs","sendAsButtons","previousAvatar","onSendAsMenuToggle","updateButtons","sendAsPeerId","changeSendAsPeerId","executeButtonsUpdate","sendAsPeerIds","saveDefaultSendAs","updateAvatar","getDefaultSendAs","getChannelFull","channelFull","default_send_as","updateManual","updatingPromise","wasSkippingAnimation","auto","getSendAs","addedListener","InputFieldAnimated","inputFake","onFakeInput","setHeight","currentHeight","POSTING_MEDIA_NOT_ALLOWED","ChatInput","lastUrl","lastTimeType","replyElements","willSendWebPage","recordCanceled","recordStartTime","lockRedo","canRedoFromHTML","undoHistory","executedHistory","canUndoFromHTML","onCancelRecordClick","recorder","opusDecodeController","onEmoticonsOpen","toggleClass","btnToggleEmoticons","onEmoticonsClose","isUserOnlineVisible","openScheduled","prepareDocumentExecute","undoRedo","needHTML","sameHTMLTimes","currentHTML","handleMarkdownShortcut","formatKeys","markupTooltip","applyMarkdown","showLinkEditor","onMessageInput","markdownEntities","parseMarkdown","urlEntities","getWebPagePromise","appWebPagesManager","getWebPage","setTopInfo","noWebPage","onHelperCancel","helperFunc","botCommands","resetCurrentFontFormatting","updateBotCommandsToggle","editMsgId","saveDraftDebounced","checkAutocomplete","updateSendBtn","onBtnSendClick","forwarding","restricted","voice_messages_forbidden","releaseMediaPlayback","setRecording","showDiscardPopup","btnCancelRecord","recordingOverlayListener","recordingNavigationItem","sourceNode","analyser","createAnalyser","connect","fftSize","frequencyData","frequencyBinCount","getByteFrequencyData","recordRippleEl","ms","recordTimeEl","needReturn","onHelperClick","forwardElements","rowsWrapperWrapper","rowsWrapper","fakeRowsWrapper","fakeSelectionWrapper","goDownBtn","controlContainer","iconBtn","cancelBtn","onHideAuthorClick","isChangingAuthor","canToggleHideAuthor","onHideCaptionClick","forwardButtons","hideSender","showCaption","hideCaption","changePeer","changeForwardRecipient","forwardBtnMenu","forwardWasDroppingAuthor","replyTitle","forwardHover","modifyArgs","newMessageWrapper","inputMessageContainer","goDownUnreadBadge","goMentionBtn","goMentionUnreadBadge","goToNextMention","btnScheduled","btnToggleReplyMarkup","replyKeyboard","botCommandsToggle","scaler","botCommandsIcon","attachMenuButtons","fileInput","attachMenu","multiple","autocompleteHelperController","stickersHelper","emojiHelper","commandsHelper","mentionsHelper","inlineHelper","btnSendContainer","btnSend","attachMessageInputField","previousQuery","saveDraft","encoderSampleRate","monitorGain","numberOfChannels","recordingGain","reuseWorker","onstop","ondataavailable","typedArray","dataBlob","Blob","sendFile","isVoiceMessage","botStartBtn","toggleBotStartBtnDisability","startBot","pinnedControlBtn","originalChat","pinnedMessageContainer","_center","neededFakeContainer","fakeWrapperTo","oldFakeWrapperTo","fakeSelectionRect","fakeRowsRect","scale","initTranslateX","getNeededFakeContainer","hasMentions","no_webpage","syncDraft","helperToo","clearInput","fromUpdate","getDraft","wrappedDraft","myEntities","apiEntities","wrapDraft","createSendAs","firstChange","sendAs","updateOffset","getPlaceholderKey","updateMessageInputPlaceholder","previousSendAs","ackedPeerFull","ackedScheduledMids","setSendAsCallback","filteredAttachMenuButtons","filterAttachMenuButtons","placeholderKey","hasBotCommands","updateBotCommands","updateMessageInput","isAnonymousSending","oldInputField","attachMessageInputListeners","fixSafariStickyInputFocusing","setStart","readAllHistory","commandsMap","saveExecuted","executed","checkType","haveThisType","isCollapsed","commonAncestorContainer","resetCurrentFormatting","setActiveMarkupButton","insertText","insertEntity","isHelper","fullValue","suffix","AUTO_COMPLETE_REG_EXP","matchIndex","newValue","hadEntities","insertLength","addEntities","caretEntity","insertCaretAtIndex","caret","originalNode","newNode","createTextNode","setStartAfter","insertNode","setCaretAt","foundHelper","checkInlineAutocomplete","inlineMatch","btnPreloader","bot_inline_placeholder","inlinePlaceholder","helperWaitingForward","canSetDraft","fireEvent","clearValue","fixSafariStickyInput","clearReply","unicode","pushRecentEmoji","forwardMessages","dropAuthor","dropCaptions","isDroppingCaptions","sendMessageWithDocument","hideCaptionCheckboxField","replyFragment","initMessagesForward","fromPeerIdsMids","fromPeerIds","smth","messagesWithCaptionsLength","peerTitles","titleKey","senderTitles","firstMessage","newReply","intl","peerTitleEl","wrapSingleMessage","_message","callerFunc","replyParent","oldReply","haveReply","CLASSNAME_BASE","PinnedContainer","floating","divAndCaption","wrapperUtils","attachOnCloseEvent","needClose","isFloating","setFloating","setUtilsWidth","BAR_HEIGHTS","ChatAudio","onPlaybackParams","fasterEl","repeatEl","toggleEl","onStop","onMediaPlay","isMusic","prevEl","nextEl","attachClick","volumeProgressLineContainer","tunnel","progressWrapper","playingDetails","PinnedMessageBorder","drawRect","getClipPath","barHeight","GAP","clipPath","getBarHeight","ONE","TWO","THREE","FOUR","MORE","getMarkHeight","markHeight","getMarkTranslateY","getTrackTranslateY","trackHeight","getTrackHeight","clipPathId","markTranslateY","trackTranslateY","mark","AnimatedSuper","getRow","animateFirst","clearRow","clearRows","currentIndex","DURATION","setNewRow","reflow","previousIndex","fromTop","ignorePrevious","previousRow","AnimatedCounter","previousNumber","getDecimal","animatedSuper","decimal","hideLeft","previousDecimalNumber","EMPTY_INDEX","setCount","previousByDecimal","decimalNumber","ChatPinnedMessage","pinnedMaxMid","pinnedMid","pinnedIndex","wasPinnedIndex","wasPinnedMediaIndex","waitForScrollBottom","loadedBottom","loadedTop","scrollDownListenerSetter","getCurrentIndexPromise","isStatic","dAC","pinnedMessageBorder","animatedSubtitle","animatedMedia","animatedCounter","btnOpen","openPinned","setPinnedMessage","_setPinnedMessage","unsetScrollDownListener","testMid","isNeededMore","getCurrentIndex","LOAD_OFFSET","correctAfter","gotRest","getPinnedMessage","backLimited","offset_id_offset","setScrollDownListener","isDown","handleScrollSideEvent","refreshPosition","handleFollowingPinnedMessage","followPinnedMessage","isLast","writeTo","writeMediaTo","ChatTopbar","verifyButtons","isMenuOpen","btnMore","deleteButtonText","menuButtons","buttonsToVerify","verifyVideoChatButton","currentGroupCall","groupCall","verifyCallButton","getCachedFullUser","phone_calls_available","video_calls_available","onJoinGroupCallClick","joinGroupCall","resize","setUtilsRAF","chatUtils","chatAudio","setPeerStatusManual","btnBack","chatInfoContainer","chatInfo","person","avatarElement","btnJoin","btnPinned","btnCall","btnGroupCall","btnMute","btnSearch","pushButtonToVerify","onBtnBackClick","isFirstChat","constructUtils","linked_chat_id","onCallClick","chatContextMenuHintWasShown","contactPeerId","constructAvatar","joinChannel","setMutedState","isTopMessage","hiddenPinnedMessages","constructDiscussionHelpers","byCurrent","setTitleCallback","setStatusCallback","setTitleManual","wasAlreadyUsed","newPinnedMessage","AppPrivateSearchTab","appSearch","btnPickDate","ChatSearch","selectedIndex","onResultsClick","selectResult","onFooterClick","onUpClick","onDownClick","foundCountEl","upBtn","downBtn","footer","dateBtn","renderedCount","ChatBackgroundPatternRenderer","canvases","INSTANCES","renderToCanvas","fillCanvas","crossOrigin","objectUrl","imageWidth","imageHeight","patternHeight","originalHeight","mask","centerY","topY","endY","bottomY","setCanvasDimensions","Chat","backgroundEl","backgroundTempId","sharedMediaTabs","setBackground","patternRenderer","gradientCanvas","previousGradientRenderer","previousPatternRenderer","previousPatternCanvas","isDarkPattern","getInstance","_gradientRenderer","setBackgroundPromise","setType","beforeDestroy","cleanupBackground","searchTab","_isAnyGroup","setAutoDownloadMedia","destroySharedMediaTab","bubblesSetPeerPromise","photoSizeMax","videoSizeMax","fileSizeMax","photo_size_max","video_size_max","getAutoDownloadSettingsByPeerId","callbacksPromise","ignoreThreadId","historyStorageTransferable","historySerialized","MarkupTooltip","waitingForMouseUp","mouseUpCounter","onMouseUpSingle","resetSelection","tools1","tools2","cancelClosening","linkBackButton","linkInput","applyLink","isLinkValid","setTooltipPosition","linkApplyButton","applyDiv","delimiter1","delimiter2","delimiter3","matchUrlProtocol","getActiveMarkupButton","nodes","getSelectedNodes","currentMarkups","activeButtons","isLinkToggle","bodyRect","selectionRect","inputRect","selectionTop","sizesRect","isFirstShow","setMouseUpEvent","handleSelection","ChatDragAndDrop","dropIcon","onDragOver","onDragLeave","onDrop","outlineWrapper","dropHeader","dropSubtitle","headerArgs","setPath","sizeX","sizeY","disableTransition","LineBlobDrawable","maxRadius","minRadius","N","radiusNext","speed","generateBlob","radDif","generateNextBlob","amplitude","speedScale","draw","paint","pinnedTop","progressToPinned","r1","progressNext","x1","x2","cx","y1","y2","bezierCurveTo","WeavingState","stateId","createGradient","shader","getGradientFromType","x0","y0","dt","TopbarWeave","handleDevicePixelRatioChanged","setSize","forceUpdate","resizeHandler","resizeCanvas","invokeDraw","handleFocus","focused","handleBlur","lbd","lbd1","lbd2","currentState","previousState","progressToState","lastUpdateTime","animateToAmplitude","animateAmplitudeDiff","amplitude2","animateAmplitudeDiff2","top1","top2","paint1","globalAlpha","setCurrentState","states","componentDidMount","matchMedia","setAmplitude","componentWillUnmount","setCanvasSize","RLottieIconItemPart","playPart","RLottieIconItem","createPart","initFrame","skipFirstFrameRendering","inverseColor","onLoadForColor","onLoadForPart","getPart","RLottieIcon","startFrame","endFrame","frameCount","SuperRLottieIcon","partState","colorState","getColor","partCallback","changedPartState","changedColorState","setPartState","setColorState","prevState","renderIfPaused","invoke","GroupCallMicrophoneIcon","GROUP_CALL_MICROPHONE_BUTTON_STATE","partName","HAND","MUTED","UNMUTED","GroupCallParticipantMutedIcon","colored","GROUP_CALL_PARTICIPANT_MUTED_STATE","colorStr","MUTED_FOR_ME","MUTED_BY_ADMIN","propertyValue","getColorByMutedState","generateEqualParts","clearMutedStateModifier","GroupCallParticipantStatusElement","element2","actionClassName","GroupCallParticipantsList","getParticipantByPeerId","onElementDestroy","getGroupCallParticipantMutedState","mutedIcon","callVideoCanvasBlur","GroupCallParticipantVideoElement","setPinned","setParticipant","groupCallParticipantMutedIcon","groupCallParticipantStatus","updateParticipant","GroupCallParticipantsVideoElement","participantsElements","groupCallId","setElementDisplay","pinnedSource","pinSource","unpinAll","setInstance","shouldDisplayElement","displayPinned","shouldDisplay","hasAnyVideo","participantElements","participantVideo","getVideoElementFromParticipantByType","_onLengthChange","GroupCallParticipantContextMenu","onOpenProfileClick","PopupGroupCall","targetPeerId","toggleParticipantMuted","editParticipant","canManageCall","can_self_unmute","muted_by_you","kickFromChat","getContainer","GroupCallParticipantsElement","groupCallParticipantsVideo","appGroupCallsManager","getGroupCallParticipants","GroupCallDescriptionElement","descriptionIntl","GroupCallTitleElement","makeButton","_className","buttonDiv","isConfirm","resizeHandlerClassName","MovableElement","fixDimensions","fixPosition","addResizeHandlers","setSwipeHandler","destroyElements","handlers","startTop","startLeft","startWidth","startHeight","resizingSide","isEnlarging","resizeDiff","maxPossible","setPositionToCenter","MovablePanel","toggleMovable","movable","movableOptions","toggleClassName","raise_hand_rating","onFullScreenClick","onToggleControls","buttonsContainer","onVideoClick","btnVideo","toggleVideoSharing","onScreenClick","btnScreen","toggleScreenSharing","toggleMuted","changeRaiseHand","onLeaveClick","hangUp","discard","toggleBigLayout","btnFullScreen","btnExitFullScreen","wasFullScreen","movablePanel","videosCount","wasBig","btnInvite","btnShowColumn","toggleRightColumn","btnFullScreen2","headerInfo","newHeader","newHeaderInfo","newHeaderTitle","btnHideColumn","videosScrollable","groupCallTitle","groupCallDescription","groupCallBodyHeaderDescription","constructButtons","groupCallParticipants","updateInstance","setHasPinned","groupCallMicrophoneIcon","_makeButton","microphoneIcon","btnLeave","setDescription","microphoneButtonState","getGroupCallMicrophoneButtonState","micState","CallDescriptionElement","connectionState","connectedAt","GroupCallMicrophoneIconMini","INIT_STATE","PopupCall","resizeVideoContainers","videoContainers","interlocutorUserId","emojisSubtitle","partyStates","partyMutedState","stateText","constructFirstButtons","constructSecondButtons","wasTryingToJoin","movableElement","controlsHover","getCallInstance","firstButtonsRow","muteI18nElement","secondButtonsRow","declineI18nElement","btnDecline","btnAccept","acceptCall","createVideoContainer","isPendingIncoming","isSharingVideo","isSharingScreen","outputState","getMediaState","oldContainers","mediaState","getVideoElement","hasFrame","hasPromise","videoState","screencastState","videoContainer","output","getEmojisFingerprint","popupWidth","MAX_WIDTH_PX","MAX_HEIGHT_PX","isVertical","MAX_SIZE","biggestSideSize","widthRatio","heightRatio","TopbarCall","onState","amplitudes","weave","clearCurrentInstance","currentDescription","instanceListenerSetter","isChangingInstance","callDescription","convertCallStateToGroupState","groupCallMicrophoneIconMini","throttledMuteClick","weaveContainer","uiNotificationsManager","notificationsShown","notificationIndex","notificationsCount","soundsPlayed","vibrateSupport","faviconEl","titleBackup","titleChanged","stopped","pushInited","updateLocalSettings","updSettings","nodesktop","novibrate","nopreview","nopush","needPush","webPushApiManager","registeredDevice","nosound","requestPermission","Notification","mozVibrate","webkitVibrate","setAppBadge","notificationsUiSupport","notifySoundEl","topMessagesDeferred","toggleToggler","peerString","soundReset","unreadUnmutedPeerIds","tokenData","unregisterDevice","registerDevice","notificationData","custom","hasChat","hasUser","buildNotification","fwdCount","peerReaction","peerTypeNotifySettings","notification","getPeerString","notificationMessage","noIncrement","notificationFromPeerId","peerPhoto","loadAvatar","resetTitle","isBlink","setFavicon","titleInterval","fontSize","textBaseline","textAlign","prevFavicon","replaceChild","testSound","permission","appRuntimeManager","onclose","getLocalSettings","nextSoundAt","prevSoundVolume","filename","token_type","tokenType","tokenValue","other_uids","app_sandbox","secret","getFilesFromEvent","onlyTypes","scanFiles","isDirectory","directoryReader","createReader","readEntries","itemFile","getAsFile","DataTransferItem","DragEvent","dataTransfer","webkitGetAsEntry","AppImManager","columnEl","offline","updateStatusInterval","cacheStorage","saveState","parseUriParams","tgaddr","postId","openUsername","userName","setSettings","chatsSelectTabDebounced","toggleChatGradientAnimation","onDocumentPaste","attachType","newMediaPopup","_types","canDrag","backgroundPromises","IS_FIREFOX","updateStatus","emojiAnimationContainer","appendEmojiAnimationContainer","createNewChat","chatsSelectTab","compareVersion","deleteFilesIterative","applyCurrentTheme","resizeInstances","saveChatPosition","choosing","setChoosingStickerTyping","typing","onInstanceDeactivated","isUpdated","receiptMessage","onSpoilerClick","spoilerTimeout","stateStorage","topbarCall","discardCurrentCall","currentCall","setAuthorized","telegramMeWebManager","addAnchorListener","uriParams","hashtag","STICKER_SET","EMOJI_SET","pathnameParams","protocol","makeLink","INVOICE","VOICE_CHAT","USER_PHONE_NUMBER","PRIVATE_POST","channel","thread","comment","MESSAGE","attachKeydownListener","timeoutOperation","requests","request","isBad","activatingChat","screen","IGNORE_KEYS","getFirstMessageToEdit","getNextDialog","newEvent","KeyboardEvent","commentId","resolveChannel","checkChatInvite","saveApiChat","resolvePhone","getInputInvoiceBySlug","openUrl","wrappedUrl","u","host","noPathnameParams","noUriParams","openComment","generateThreadServiceStartMessage","phone_calls_private","ignoreGroupCall","ignoreCall","discardGroupCallConfirmation","discardCallConfirmation","isClosing","getGroupCallFull","createGroupCall","setCurrentBackground","broadcastEvent","getBackground","getFile","lastBackgroundUrl","chatBubbles","chatPositions","backgroundUrl","prevTab","prevIdx","attachDragAndDropListeners","drops","mediaDrops","isFiles","_dropsContainer","mediaDropsContainer","dropsContainer","_drops","foundMedia","onImTabChange","updateMyOnlineStatus","spliceChats","fromIndex","chatFrom","chatTo","chatIndex","existingIndex","oldChat","getTypingElement","dot","eye","getPeerTyping","getPeerTypings","langPackKeys","multi","mapa","typingElement","descriptionElement","getChatStatus","typingEl","onlines","getOnlines","getUserStatus","ignoreSelf","getPeerStatus","useWhitespace","typingContainer","DialogColorsFg","DialogColors","DialogColorsMap","pic","useBytes","bestPhotoSize","CallConnectionInstanceBase","connection","sources","createPeerConnection","RTCPeerConnection","signalingState","iceConnectionState","createDataChannel","dataChannel","createDescription","appendStreamToConference","streamManager","appendToConference","closeConnection","closeConnectionAndStream","stopStream","negotiate","negotiating","negotiateInternal","sendDataChannelData","parseSignalingData","sdp","parseMediaSectionInfo","fingerprint","ufrag","pwd","convertNumber","isSending","codec","ssrc","sourceGroups","ssrcGroups","sourceGroup","semantics","ssrcs","rtpExtensions","payloadTypesMap","getPayloadType","payloadType","clockrate","feedbackTypes","subtype","parameters","payloadTypes","CallConnectionInstance","localDescription","remoteDescription","descriptionInit","offerReceived","createAnswer","setLocalDescription","offer","createOffer","offerSent","initialSetup","sendCallSignalingData","crypto","subtle","P2PEncryptor","p2pKey","seqMap","concatSHA256","bufferConcats","convertToUint8Array","encryptPrepared","msgKeyLarge","subarray","msgKey","aesKeyIv","prepareAesKeyIv","aesProcessCtr","encryptRawPacket","seq","ArrayBuffer","setUint32","sha256a","sha256b","iv","encryptedData","dataSize","encrypt","cryptoKey","constTimeIsDifferent","msgKeyEquals","decryptRawPacket","encryptedDataSize","decryptionBuffer","getUint32","ChromeP2PSdpBuilder","fingerprints","stringBuilder","streamName","addExtmap","addPayloadTypes","addSsrc","finalize","FirefoxP2PSdpBuilder","SafariP2PSdpBuilder","isFirefox","isSafari","extmap","j","fmtp","getOwnPropertyNames","pName","ssrcGroup","P2PSdpBuilder","sdpString","sdpMLineIndex","sdpMid","foundation","component","priority","relAddress","generation","tcpType","networkId","networkCost","candidate","generateOffer","generateAnswer","CallInstance","udp_p2p","udp_reflector","min_layer","max_layer","library_versions","createdAt","decryptQueue","candidates","canCreateConferenceEntry","setMediaState","sendMediaState","mediaStates","_sendMediaState","_connectionState","connectionInstance","sortIndex","findEntry","recvEntry","startScreenSharingInternal","wasStartingScreen","wasStartingVideo","requestScreen","stopVideoSharing","startVideoSharingInternal","requestInputSource","track","inputStream","getVideoTracks","stopTrack","isSharingVideoType","audioTrack","getAudioTracks","setHangUpTimeout","clearHangUpTimeout","hangUpTimeout","setPhoneCall","phoneCall","canAccept","overrideConnectionState","g_a_hash","appCallsManager","generateDh","dh","g_b","g_a","g_b_hash","getCallInput","phonePhoneCall","savePhonePhoneCall","joinCall","encryptionKey","configuration","iceServers","connections","ipv6","port","urls","turn","stun","credential","iceTransportPolicy","p2p_allowed","getRtcConfiguration","sendIceCandidate","onTrack","encryptor","decryptor","processDecryptQueue","createDataChannelEntry","dataChannelEntry","createEntry","sendEntry","negotiated","applyDataChannelData","TextEncoder","encode","iceCandidate","parsed","p2pParseCandidate","confirmCall","key_fingerprint","computeKey","emojisFingerprint","getEmojisFingerprintPromise","codePoints","unlockStreamManager","doTheMagic","getTransceivers","transceiver","getEntryByMid","bundle","sdpDescription","generateSdp","isAnswer","setRemoteDescription","onInputStream","stream","videoTrack","onMutedChange","requestAudioSource","setMuted","discardReason","discardedByOtherParty","hasVideo","discardCall","performCodec","_codec","setDataToDescription","setData","transport","screencast","filterNotVP8","vp8PayloadType","rtxIdx","apt","applyCallSignalingData","performSsrcGroups","getEntryBySource","sendRecvEntry","findFreeSendRecvEntry","setEntrySource","tryToReleaseCandidates","generateCandidate","RTCIceCandidate","addIceCandidate","decryptedData","TextDecoder","decode","signalingData","onUpdatePhoneCallSignalingData","getStreamCached","_cache","isScreen","constraints","getScreenStream","getStream","CallInstanceBase","fixSafariAudio","isSharingAudio","hasInputTrackKind","isAudioGood","isVideoGood","getAudioConstraints","getVideoConstraints","getScreenConstraints","endpoint","tryAddTrack","streams","saveInputVideoStream","isOutput","elementEndpoint","addTrack","useStream","outputStream","srcObject","sinkId","outputDeviceId","setSinkId","getTracks","addStream","CALL_STATE","audioAsset","CALL_REQUEST_TIMEOUT","CallsController","sortedInstances","createCallInstance","admin_id","g_a_or_b","bytesCmp","callId","getCallByUserId","hasConnected","hasCurrent","startCallInternal","fullInfo","participant_id","requestCall","GROUP_CALL_AMPLITUDE_ANALYSE_COUNT_MAX","GROUP_CALL_AMPLITUDE_ANALYSE_INTERVAL_MS","GroupCallConnectionInstance","negotiateThrottled","bundlePolicy","rtcpMuxPolicy","iceCandidatePoolSize","maybeUpdateRemoteVideoConstraints","updateConstraintsInterval","invokeJoinGroupCall","localSdp","mainChannels","processedChannels","sectionInfo","payload","processMediaSection","audioChannel","videoChannel","useChannel","setEntryPeerId","performExtmap","filterServerCodecs","isNewConnection","originalOffer","iceRestart","hasMunged","skipAddingMulticast","mediaLine","mediaLineParts","localMLine","codecIds","newData","setPort","setSource","newSdp","addSsrcEntry","newChannel","mungedSdp","fixLocalOffer","entriesToDelete","shouldBeSkipped","answerDescription","deleteEntry","iceGatheringState","updateConstraints","sender","setParameters","getParameters","degradationPreference","colibriClass","defaultConstraints","onStageEndpoints","addInputVideoStream","GroupCallInstance","isSpeakingMap","pinnedSources","participantsSsrcs","hadAutoPinnedSources","dispatchPinnedThrottled","getCachedParticipants","presentation","unpinSource","changeUserMuted","source_groups","clone","createConnectionInstance","raise","raiseHand","stopScreenSharing","startScreenSharing","startScreenSharingPromise","saveApiParticipant","leaveGroupCallPresentation","videoPaused","videoStopped","startVideoSharing","startVideoSharingPromise","rejoin","isDiscarded","isUpdatingMeInCurrentCall","onParticipantUpdate","doNotDispatchParticipantUpdate","hasLeft","oldSsrcs","modifiedTypes","oldSsrc","oldSource","oldEntry","originalDirection","setEndpoint","createTransceiver","GROUP_CALL_STATE","makeSsrcsFromParticipant","makeSsrcFromParticipant","audio_source","generateSelfVideo","audioSource","GroupCallsController","setCurrentGroupCall","startConnectingSound","stopConnectingSound","joinVideo","MediaStream","createMainStreamManager","joinGroupCallInternal","handleUpdateGroupCallParticipants","updatingSdp","channelCount","constraint","mediaDevices","getSupportedConstraints","constraintSupported","skipAudio","frameRate","screenStream","getDisplayMedia","contentHint","getUserMedia","clientInfo","lookupAttributeKeys","telegramSourceGroups","sdpLines","rest","parseSourceGroups","raw","ConferenceEntry","addTransceiver","generateSsrc","LocalConferenceDescription","sessionId","maxSeenId","entriesByMid","entriesBySource","entriesByPeerId","getEntriesByPeerId","conference","SDP","mediaSections","splitStringByLimitWithRest","UniqueNumberGenerator","generate","maxTries","_try","SDPAttributeSplitted","SDPMediaLineParts","SDPLine","SDPAttributeInner","missed","exists","nestedMap","makeAttributes","innerParts","SDPAttributes","fillAttributes","attributesMap","linesArray","SDPMediaSection","isReceiving","resultShouldBeArray","SDPSessionSection","parseSdp","createSection","sessionSection","lineStr","isIncorrectSdpLine","parseSdpLine","addSimulcast","generator","originalSsrcs","ssrcs2","ssrcsStrLines","ssrc2","WEBRTC_MEDIA_PORT","fixMediaLineType","getConnectionTypeForMediaType","generateMediaFirstLine","payloadIds","connectionType","SDPBuilder","addCandidate","performCandidate","addHeader","sId","bundleMids","addTransport","skipCandidates","addSource","addMsid","isApplication","isInactive","hdrexts","hdrext","fbs","fb","addConference","AudioStreamAnalyser","streamSource","createMediaStreamSource","gain","createGain","minDecibels","maxDecibels","smoothingTimeConstant","StreamManager","getAmplitude","streamAnalyser","analyse","ANALYSER_LISTENER","AudioContext","webkitAudioContext","getSource","itemSource","removeTrack","finalizeAddingTrack","changeTimer","substring","replaceInputAudio","oldTrack","timer","transceiverInit","tracks","mediaTrackType","trackIdx","replaceTrack","StringFromLineBuilder","newLine","addJoined","toTelegramSource","fromTelegramSource","rms","onlyFirst","E","wrappingDraft","messageEntityTextUrl","messageEntityMentionName","isDraft","setBlankToAnchor","EMOJI_VERSIONS_SUPPORTED","inlineEl","newEmojiWidth","legacyEmojiWidth","isEmojiSupported","setDimensionsFromRect","CustomEmojiElement","renderer","syncedPlayer","pausedElements","lastPausedVideo","elementsCounter","CustomEmojiRendererElement","playersSynced","syncedElements","clearedElements","emojiRenderers","syncedPlayers","syncedPlayersFrames","overrideRender","clearRenderInterval","getOffsets","offsetsMap","offsetParent","clearCanvas","isDimensionsSet","isImageData","ImageData","frameWidth","frameHeight","checkForAnyFrame","emojiRenderInterval","renderEmojis","nasty","usedLength","customEmojis","contextSite","contextExternal","lastEntity","nextEntity","endPartOffset","fullEntityText","partText","usedText","fontStyle","styleName","fontFamily","atPos","fromBot","encodeURIComponent","isSupported","masked","currentContext","electronHelpers","contextUrl","encoded","encodeSpoiler","entityText","voodoo","onDestroy","wrap","_loadPromises","isLottie","middlewares","addition","_p","missing","cachedPromises","uncachedPromisesPromise","loadFromPromises","uncached","QueryableWorker","worker","terminate","onmessage","queryMethodListener","queryMethodArguments","postMessage","sendQuery","transfer","queryMethod","workersLimit","playersByCacheName","workers","curWorkerNum","onPlayerLoaded","reqId","fps","clamped","onPlayerError","getAnimation","setLoop","_autoplay","loadLottieWorkers","remain","Worker","queryableWorker","loadAnimationAsAsset","loadAnimationFromURL","blobConstruct","newParams","loadAnimationWorker","waitForFirstFrame","cacheName","initPlayer","destroyWorkers","loadFromData","FramesCache","framesNew","framesURLs","getCache","createCache","releaseCache","getCacheCounter","generateName","RLottiePlayer","cachingDelta","CACHE","skipDelta","getLottiePixelRatio","contexts","setMainLoop","clearPendingRAF","rafId","resetCurrentFrame","minFrame","renderFirstFrame","requestFrame","applyInversing","renderFrame2","cachedSource","renderedFirstFrame","ImageBitmap","frInterval","frThen","frameNew","onLap","mainLoopForwards","mainLoopBackwards","currentMethod","frameListener","listenerResults","enterFrame","playToFrame","bounds","setMinMax","playToFrameOnFrameCallback","setInverseColor","pagesManager","pageId","pagesDiv","scrollableDiv","page","onShown","setPage","isAuthPage","Page","onFirstMount","onMount","encodeEmoji","emojiText","toCodePoints","removeVS16s","vs16RegExp","zeroWidthJoiner","rawEmoji","unicodeSurrogates","points","getEmojiToneIndex","getCountryEmoji","emojiFromCodePoints","fromCodePoint","module","exports","defineProperty","enumerable","Symbol","toStringTag","__esModule","prototype","isRecordingSupported","bufferLength","encoderApplication","encoderFrameSize","encoderPath","maxFramesPerPage","mediaTrackConstraints","resampleQuality","streamPages","wavBitDepth","encodedSamplePosition","WebAssembly","clearStream","audioContext","closeAudioContext","encodeBuffers","getChannelData","encoder","buffers","initAudioContext","initAudioGraph","scriptProcessorNode","createScriptProcessor","destination","onaudioprocess","inputBuffer","monitorGainNode","setMonitorGain","recordingGainNode","setRecordingGain","initSourceNode","loadWorker","initWorker","streamPage","storePage","recordedPages","samplePosition","originalSampleRate","sampleRate","wavSampleRate","onpause","resume","onresume","setTargetAtTime","onstart","destroyWorker","Function"],"sourceRoot":""}