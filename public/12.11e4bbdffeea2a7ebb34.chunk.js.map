{"version":3,"sources":["webpack:///./src/helpers/touchSupport.ts","webpack:///./src/components/ripple.ts","webpack:///./src/pages/pagePassword.ts","webpack:///./src/helpers/dom/clickEvent.ts","webpack:///./src/components/button.ts","webpack:///./src/components/misc.ts","webpack:///./src/helpers/cleanUsername.ts","webpack:///./src/lib/appManagers/appUsersManager.ts","webpack:///./src/lib/appManagers/appChatsManager.ts","webpack:///./src/lib/appManagers/appPeersManager.ts","webpack:///./src/components/appNavigationController.ts","webpack:///./src/helpers/dom/toggleDisability.ts","webpack:///./src/lib/mtproto/serverTimeManager.ts","webpack:///./src/lib/appManagers/apiUpdatesManager.ts","webpack:///./src/helpers/sequentialDom.ts","webpack:///./src/countries.ts","webpack:///./src/lib/mtproto/passwordManager.ts","webpack:///./src/pages/loginPage.ts","webpack:///./src/components/passwordInputField.ts","webpack:///./src/lib/searchIndex.ts","webpack:///./src/components/monkeys/password.ts","webpack:///./src/helpers/cleanSearchText.ts","webpack:///./src/lib/mtproto/mtproto_config.ts","webpack:///./src/helpers/dom/htmlToSpan.ts"],"names":["isTouchSupported","window","DocumentTouch","document","rippleClickId","ripple","elem","callback","Promise","resolve","onEnd","prepend","querySelector","classList","add","r","createElement","handler","contains","drawRipple","clientX","clientY","startTime","Date","now","clickId","duration","getComputedStyle","getPropertyValue","replace","elapsedTime","cb","mutate","remove","delay","Math","max","setTimeout","removeEventListener","touchStartFired","requestAnimationFrame","rect","getBoundingClientRect","clickX","left","clickY","top","size","sqrt","abs","height","width","x","y","style","append","isRippleUnneeded","e","target","includes","tagName","touchEnd","addEventListener","settings","animationsEnabled","touches","length","once","cancelBubble","stopPropagation","passive","button","dataset","passwordInput","page","className","withInputWrapper","titleLangKey","subtitleLangKey","btnNext","btnNextI18n","IntlElement","key","element","passwordInputField","label","name","getStateInterval","input","inputWrapper","container","state","getState","setInterval","then","_state","hint","wrapEmojiText","setLabel","onSubmit","value","toggle","update","preloader","check","response","_","clearInterval","m","default","mount","monkey","removeAttribute","catch","err","type","select","this","isMobile","imageDiv","all","load","focus","pushToState","CLICK_EVENT_NAME","attachClickEvent","options","listenerSetter","bind","removeManual","touchMouseDown","detachClickEvent","asDiv","icon","noRipple","rippleSquare","onlyMobile","disabled","setAttribute","text","putPreloader","returnDiv","html","div","innerHTML","appendChild","insertAdjacentHTML","lastElementChild","setButtonLoader","sortedCountries","formatPhoneNumber","str","phoneCode","slice","sort","a","b","country","find","c","split","indexOf","pattern","forEach","symbol","idx","formatted","onMouseMove","openedMenu","diffX","right","diffY","bottom","closeBtnMenu","onClick","parentElement","menuOverlay","openedMenuOnClose","removeByType","openBtnMenu","menuElement","onClose","pushItem","onPop","canAnimate","insertBefore","positionMenu","pageX","pageY","side","scrollWidth","menuWidth","scrollHeight","menuHeight","body","windowWidth","windowHeight","verticalSide","sides","intermediateX","intermediateY","possibleSides","attachContextMenuListener","timeout","capture","onCancel","clearTimeout","cleanUsername","username","toLowerCase","appUsersManager","storage","appStateManager","storages","users","updateUsersStatuses","timestampNow","i","user","status","expires","was_online","rootScope","dispatchEvent","id","setUserToStateIfNeeded","clear","addMultipleEventsListeners","updateUserStatus","userId","user_id","serverTimeManager","serverTimeOffset","updateUserPhoto","forceUserOnline","photo","console","warn","updateUserName","saveApiUser","Object","assign","first_name","last_name","getSelf","contactsIndex","indexObject","getUserSearchText","storagesResults","contactsList","Array","isArray","pushContact","contactsFillPromise","peerId","getFromCache","set","getUser","delete","init","usernames","_userId","isPeerNeeded","findAndSplice","undefined","Set","updatedContactsList","promise","invokeApi","result","saveApiUsers","contacts","contact","onContactsModified","resolvedPeer","appChatsManager","saveApiChats","chats","appPeersManager","getPeer","getPeerId","peer","requestPeer","phone","pFlags","self","format","filter","Boolean","join","query","includeSaved","fillContacts","_contactsList","results","search","has","userId1","userId2","sortName1","sortName","sortName2","localeCompare","testSelfSearch","p","myId","unshift","block","getInputPeerById","apiUpdatesManager","processLocalUpdate","peer_id","getOutputPeer","blocked","index","apiUsers","override","oldUser","min","fullName","searchUsername","deleted","cleanSearchText","initials","getAbbreviation","changedPhoto","changedTitle","photo_id","access_hash","args","isBot","support","date","d","getDate","getMonth","getHours","getMinutes","bot","isRegularUser","isContact","allowMin","eventTimestamp","timestamp","updatesState","syncLoading","getTopPeersPromise","topPeers","correspondents","offset","limit","hash","peerIds","categories","peers","map","topPeer","contactsBlocked","count","u","concat","q","my_results","offline","showPhone","getUserInput","add_phone_privacy_exception","updates","processUpdateMessage","onContactUpdated","userIds","onChatUpdated","chatId","isChannel","updateChannelParticipant","clearCache","params","channel","channel_id","updateChatDefaultBannedRights","chat","default_banned_rights","getChat","_chatId","apiChats","saveApiChat","oldChat","title","participants_count","rights","defaultRights","action","isThread","kicked","megagroup","creator","admin_rights","banned_rights","myFlags","post_messages","delete_messages","broadcast","until_date","isMegagroup","good","deactivated","chat_id","about","channelId","getChannelInput","usersInputs","fwdLimit","fwd_limit","deleteChatUser","leaveChannel","leaveChat","deleteChannel","deleteChat","bool","inputFile","inputChatPhoto","file","participant","getParticipantPeerId","actor_id","qts","prev_participant","new_participant","keys","kicked_by","editBanned","view_messages","DialogColorsFg","DialogColors","DialogColorsMap","updatePeerBlocked","hasRights","getUserPhoto","getChatPhoto","migrated_to","plainText","onlyFirstName","trim","getUserString","getChatString","isUser","charAt","peerParams","substr","isBroadcast","ignorePeerId","getChannelInputPeer","getChatInputPeer","pic","getDialogType","appNavigationController","navigations","manual","log","debug","currentHash","location","isPossibleSwipe","onHashChange","replaceState","pushState","item","pop","handleItem","onEscape","back","detach","onTouchEnd","onTouchMove","moved","history","scrollRestoration","noBlurOnPop","ret","findItemByType","splice","push","noHistory","origin","pathname","single","toggleDisability","elements","disable","el","get","to","addTaskListener","task","payload","pendingPtsUpdates","pendingSeqUpdates","syncPending","channelStates","attached","Error","Warn","Log","updateMessage","processOpts","seq","seqStart","seq_start","forceGetDifference","processUpdate","isOut","out","fromId","from_id","toId","message","fwd_from","reply_to","entities","pts","pts_count","Proxy","saveUpdatesState","us","nextSeq","pendingUpdatesData","saveUpdate","popPendingSeqUpdate","seqAwaiting","ptsAwaiting","curState","getChannelState","curPts","goodPts","goodIndex","getDifference","first","wasSyncing","pts_total_limit","differenceResult","other_updates","new_messages","apiMessage","nextState","intermediate_state","justAName","channelState","getChannelDifference","addChannelState","lastPtsUpdateTime","toPeerId","fwdHeader","reason","hasUser","post","hasChat","popPts","popSeq","popPendingPtsUpdate","noErrorBox","stateResult","setUpdatesProcessor","setProxy","sequentialDom","promises","raf","scheduled","kind","scheduleFlush","do","read","write","Countries","PhoneCodesMain","passwordManager","currentHashPromise","newHashPromise","password","new_settings","email","currentPassword","computeSRP","newAlgo","new_algo","salt1","Uint8Array","randomize","newPassword","hashes","new_password_hash","inputCheckPassword","auth","setUserAuth","code","LoginPage","subtitle","PasswordInputField","super","passwordVisible","onVisibilityClick","toggleVisible","onVisibilityClickAdditional","autocomplete","stealthy","tabIndex","cloneNode","nextSibling","SearchIndex","cleanText","latinize","minChars","fullTexts","Map","searchText","newFoundObjs","queryWords","queryWordsLength","fullText","what","found","foundChars","word","fullTextLength","o","PasswordMonkey","needFrame","loadPromise","loadAnimationFromURL","loop","autoplay","noCache","_animation","animation","currentFrame","direction","setSpeed","pause","setDirection","curFrame","play","waitForFirstFrame","badCharsRe","trimRe","hasTag","ch","latinizeCh","LatinizeMap","REPLIES_PEER_ID","htmlToSpan","span"],"mappings":"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","file":"12.11e4bbdffeea2a7ebb34.chunk.js","sourcesContent":["/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\n// @ts-ignore\r\nexport const isTouchSupported = ('ontouchstart' in window) || (window.DocumentTouch && document instanceof DocumentTouch)/*  || true */;","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport findUpClassName from \"../helpers/dom/findUpClassName\";\r\nimport sequentialDom from \"../helpers/sequentialDom\";\r\nimport {isTouchSupported} from \"../helpers/touchSupport\";\r\nimport rootScope from \"../lib/rootScope\";\r\n\r\nlet rippleClickId = 0;\r\nexport function ripple(elem: HTMLElement, callback: (id: number) => Promise<boolean | void> = () => Promise.resolve(), onEnd: (id: number) => void = null, prepend = false) {\r\n  //return;\r\n  if(elem.querySelector('.c-ripple')) return;\r\n  elem.classList.add('rp');\r\n  \r\n  let r = document.createElement('div');\r\n  r.classList.add('c-ripple');\r\n\r\n  const isSquare = elem.classList.contains('rp-square');\r\n  if(isSquare) {\r\n    r.classList.add('is-square');\r\n  }\r\n\r\n  elem[prepend ? 'prepend' : 'append'](r);\r\n\r\n  let handler: () => void;\r\n  //let animationEndPromise: Promise<number>;\r\n  const drawRipple = (clientX: number, clientY: number) => {\r\n    const startTime = Date.now();\r\n    const elem = document.createElement('div');\r\n\r\n    const clickId = rippleClickId++;\r\n    \r\n    //console.log('ripple drawRipple');\r\n    \r\n    const duration = +window.getComputedStyle(r).getPropertyValue('--ripple-duration').replace('s', '') * 1000;\r\n    //console.log('ripple duration', duration);\r\n\r\n    handler = () => {\r\n    //handler = () => animationEndPromise.then((duration) => {\r\n      //console.log('ripple animation was:', duration);\r\n\r\n      //const duration = isSquare || mediaSizes.isMobile ? 200 : 700;\r\n      //return;\r\n      let elapsedTime = Date.now() - startTime;\r\n      const cb = () => {\r\n        //console.log('ripple elapsedTime total pre-remove:', Date.now() - startTime);\r\n        sequentialDom.mutate(() => {\r\n          elem.remove();\r\n        });\r\n        \r\n        if(onEnd) onEnd(clickId);\r\n      };\r\n      if(elapsedTime < duration) {\r\n        let delay = Math.max(duration - elapsedTime, duration / 2);\r\n        setTimeout(() => elem.classList.add('hiding'), Math.max(delay - duration / 2, 0));\r\n\r\n        setTimeout(cb, delay);\r\n      } else {\r\n        elem.classList.add('hiding');\r\n        setTimeout(cb, duration / 2);\r\n      }\r\n\r\n      if(!isTouchSupported) {\r\n        window.removeEventListener('contextmenu', handler);\r\n      }\r\n\r\n      handler = null;\r\n      touchStartFired = false;\r\n    };\r\n    //});\r\n\r\n    callback && callback(clickId);\r\n\r\n    /* callback().then((bad) => {\r\n      if(bad) {\r\n        span.remove();\r\n        return;\r\n      } */\r\n      \r\n      //console.log('ripple after promise', Date.now() - startTime);\r\n      //console.log('ripple tooSlow:', tooSlow);\r\n      /* if(tooSlow) {\r\n        span.remove();\r\n        return;\r\n      } */\r\n\r\n      window.requestAnimationFrame(() => {\r\n        const rect = r.getBoundingClientRect();\r\n        elem.classList.add('c-ripple__circle');\r\n\r\n        const clickX = clientX - rect.left;\r\n        const clickY = clientY - rect.top;\r\n\r\n        const radius = Math.sqrt((Math.abs(clickY - rect.height / 2) + rect.height / 2) ** 2 + (Math.abs(clickX - rect.width / 2) + rect.width / 2) ** 2);\r\n        const size = radius;\r\n\r\n        // center of circle\r\n        const x = clickX - size / 2;\r\n        const y = clickY - size / 2;\r\n\r\n        //console.log('ripple click', offsetFromCenter, size, clickX, clickY);\r\n\r\n        elem.style.width = elem.style.height = size + 'px';\r\n        elem.style.left = x + 'px';\r\n        elem.style.top = y + 'px';\r\n\r\n        //     \r\n        /* animationEndPromise = new Promise((resolve) => {\r\n          span.addEventListener('animationend', () => {\r\n            // 713 -> 700\r\n            resolve(((Date.now() - startTime) / 100 | 0) * 100);\r\n          }, {once: true});\r\n        }); */\r\n        \r\n        //             \r\n        /* span.style.display = 'none';\r\n        r.append(span);\r\n        duration = +window.getComputedStyle(span).getPropertyValue('animation-duration').replace('s', '') * 1000;\r\n        span.style.display = ''; */\r\n\r\n        r.append(elem);\r\n\r\n        //r.classList.add('active');\r\n        //handler();\r\n      });\r\n    //});\r\n  };\r\n\r\n  const isRippleUnneeded = (e: Event) => e.target !== elem && (\r\n      ['BUTTON', 'A'].includes((e.target as HTMLElement).tagName) \r\n      || findUpClassName(e.target as HTMLElement, 'c-ripple') !== r\r\n    );\r\n\r\n  // TODO: rename this variable\r\n  let touchStartFired = false;\r\n  if(isTouchSupported) {\r\n    let touchEnd = () => {\r\n      handler && handler();\r\n    };\r\n  \r\n    elem.addEventListener('touchstart', (e) => {\r\n      if(!rootScope.settings.animationsEnabled) {\r\n        return;\r\n      }\r\n\r\n      //console.log('ripple touchstart', e);\r\n      if(e.touches.length > 1 || touchStartFired || isRippleUnneeded(e)) {\r\n        return;\r\n      }\r\n      \r\n      //console.log('touchstart', e);\r\n      touchStartFired = true;\r\n  \r\n      let {clientX, clientY} = e.touches[0];\r\n      drawRipple(clientX, clientY);\r\n      elem.addEventListener('touchend', touchEnd, {once: true});\r\n  \r\n      window.addEventListener('touchmove', (e) => {\r\n        e.cancelBubble = true;\r\n        e.stopPropagation();\r\n        touchEnd();\r\n        elem.removeEventListener('touchend', touchEnd);\r\n      }, {once: true});\r\n    }, {passive: true});\r\n  } else {\r\n    elem.addEventListener('mousedown', (e) => {\r\n      if(![0, 2].includes(e.button)) { // only left and right buttons\r\n        return;\r\n      }\r\n\r\n      if(!rootScope.settings.animationsEnabled) {\r\n        return;\r\n      }\r\n      //console.log('ripple mousedown', e, e.target, findUpClassName(e.target as HTMLElement, 'c-ripple') === r);\r\n\r\n      if(elem.dataset.ripple === '0' || isRippleUnneeded(e)) {\r\n        return;\r\n      } else if(touchStartFired) {\r\n        touchStartFired = false;\r\n        return;\r\n      }\r\n  \r\n      let {clientX, clientY} = e;\r\n      drawRipple(clientX, clientY);\r\n      window.addEventListener('mouseup', handler, {once: true, passive: true});\r\n      window.addEventListener('contextmenu', handler, {once: true, passive: true});\r\n    }, {passive: true});\r\n  }\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport { putPreloader } from '../components/misc';\r\nimport mediaSizes from '../helpers/mediaSizes';\r\nimport { AccountPassword } from '../layer';\r\nimport appStateManager from '../lib/appManagers/appStateManager';\r\nimport passwordManager from '../lib/mtproto/passwordManager';\r\nimport Page from './page';\r\nimport Button from '../components/button';\r\nimport PasswordInputField from '../components/passwordInputField';\r\nimport PasswordMonkey from '../components/monkeys/password';\r\nimport RichTextProcessor from '../lib/richtextprocessor';\r\nimport I18n from '../lib/langPack';\r\nimport LoginPage from './loginPage';\r\nimport { cancelEvent } from '../helpers/dom/cancelEvent';\r\nimport { attachClickEvent } from '../helpers/dom/clickEvent';\r\nimport htmlToSpan from '../helpers/dom/htmlToSpan';\r\nimport replaceContent from '../helpers/dom/replaceContent';\r\nimport toggleDisability from '../helpers/dom/toggleDisability';\r\n\r\nconst TEST = false;\r\nlet passwordInput: HTMLInputElement;\r\n\r\nlet onFirstMount = (): Promise<any> => {\r\n  const page = new LoginPage({\r\n    className: 'page-password',\r\n    withInputWrapper: true,\r\n    titleLangKey: 'Login.Password.Title',\r\n    subtitleLangKey: 'Login.Password.Subtitle'\r\n  });\r\n\r\n  const btnNext = Button('btn-primary btn-color-primary');\r\n  const btnNextI18n = new I18n.IntlElement({key: 'Login.Next'});\r\n\r\n  btnNext.append(btnNextI18n.element);\r\n\r\n  const passwordInputField = new PasswordInputField({\r\n    label: 'LoginPassword',\r\n    name: 'password'\r\n  });\r\n\r\n  passwordInput = passwordInputField.input as HTMLInputElement;\r\n\r\n  page.inputWrapper.append(passwordInputField.container, btnNext);\r\n\r\n  let getStateInterval: number;\r\n\r\n  let getState = () => {\r\n    // * just to check session relevance\r\n    if(!getStateInterval) {\r\n      getStateInterval = window.setInterval(getState, 10e3);\r\n    }\r\n\r\n    return !TEST && passwordManager.getState().then(_state => {\r\n      state = _state;\r\n\r\n      if(state.hint) {\r\n        replaceContent(passwordInputField.label, htmlToSpan(RichTextProcessor.wrapEmojiText(state.hint)));\r\n      } else {\r\n        passwordInputField.setLabel();\r\n      }\r\n    });\r\n  };\r\n\r\n  let state: AccountPassword;\r\n  \r\n  const onSubmit = (e?: Event) => {\r\n    if(e) {\r\n      cancelEvent(e);\r\n    }\r\n\r\n    if(!passwordInput.value.length) {\r\n      passwordInput.classList.add('error');\r\n      return;\r\n    }\r\n\r\n    const toggle = toggleDisability([passwordInput, btnNext], true);\r\n    let value = passwordInput.value;\r\n\r\n    btnNextI18n.update({key: 'PleaseWait'});\r\n    const preloader = putPreloader(btnNext);\r\n\r\n    passwordManager.check(value, state).then((response) => {\r\n      //console.log('passwordManager response:', response);\r\n        \r\n      switch(response._) {\r\n        case 'auth.authorization':\r\n          clearInterval(getStateInterval);\r\n          import('./pageIm').then(m => {\r\n            m.default.mount();\r\n          });\r\n          if(monkey) monkey.remove();\r\n          break;\r\n        default:\r\n          btnNext.removeAttribute('disabled');\r\n          btnNextI18n.update({key: response._ as any});\r\n          preloader.remove();\r\n          break;\r\n      }\r\n    }).catch((err: any) => {\r\n      toggle();\r\n      passwordInputField.input.classList.add('error');\r\n      \r\n      switch(err.type) {\r\n        default:\r\n          //btnNext.innerText = err.type;\r\n          btnNextI18n.update({key: 'PASSWORD_HASH_INVALID'});\r\n          passwordInput.select();\r\n          break;\r\n      }\r\n\r\n      preloader.remove();\r\n  \r\n      getState();\r\n    });\r\n  };\r\n  \r\n  attachClickEvent(btnNext, onSubmit);\r\n\r\n  passwordInput.addEventListener('keypress', function(this, e) {\r\n    this.classList.remove('error');\r\n    btnNextI18n.update({key: 'Login.Next'});\r\n\r\n    if(e.key === 'Enter') {\r\n      return onSubmit();\r\n    }\r\n  });\r\n\r\n  const size = mediaSizes.isMobile ? 100 : 166;\r\n  const monkey = new PasswordMonkey(passwordInputField, size);\r\n  page.imageDiv.append(monkey.container);\r\n  return Promise.all([\r\n    monkey.load(),\r\n    getState()\r\n  ]);\r\n};\r\n\r\nconst page = new Page('page-password', true, onFirstMount, null, () => {\r\n  //if(!isAppleMobile) {\r\n    passwordInput.focus();\r\n  //}\r\n\r\n  appStateManager.pushToState('authState', {_: 'authStatePassword'});\r\n});\r\n\r\nexport default page;\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport type ListenerSetter from \"../listenerSetter\";\r\nimport { isTouchSupported } from \"../touchSupport\";\r\n\r\nexport const CLICK_EVENT_NAME: 'mousedown' | 'touchend' | 'click' = (isTouchSupported ? 'mousedown' : 'click') as any;\r\nexport type AttachClickOptions = AddEventListenerOptions & Partial<{listenerSetter: ListenerSetter, touchMouseDown: true}>;\r\nexport function attachClickEvent(elem: HTMLElement, callback: (e: TouchEvent | MouseEvent) => void, options: AttachClickOptions = {}) {\r\n  const add = options.listenerSetter ? options.listenerSetter.add.bind(options.listenerSetter, elem) : elem.addEventListener.bind(elem);\r\n  const remove = options.listenerSetter ? options.listenerSetter.removeManual.bind(options.listenerSetter, elem) : elem.removeEventListener.bind(elem);\r\n\r\n  options.touchMouseDown = true;\r\n  /* if(options.touchMouseDown && CLICK_EVENT_NAME === 'touchend') {\r\n    add('mousedown', callback, options);\r\n  } else if(CLICK_EVENT_NAME === 'touchend') {\r\n    const o = {...options, once: true};\r\n\r\n    const onTouchStart = (e: TouchEvent) => {\r\n      const onTouchMove = (e: TouchEvent) => {\r\n        remove('touchmove', onTouchMove, o);\r\n        remove('touchend', onTouchEnd, o);\r\n      };\r\n  \r\n      const onTouchEnd = (e: TouchEvent) => {\r\n        remove('touchmove', onTouchMove, o);\r\n        callback(e);\r\n        if(options.once) {\r\n          remove('touchstart', onTouchStart);\r\n        }\r\n      };\r\n  \r\n      add('touchend', onTouchEnd, o);\r\n      add('touchmove', onTouchMove, o);\r\n    };\r\n\r\n    add('touchstart', onTouchStart);\r\n  } else {\r\n    add(CLICK_EVENT_NAME, callback, options);\r\n  } */\r\n  add(CLICK_EVENT_NAME, callback, options);\r\n}\r\n\r\nexport function detachClickEvent(elem: HTMLElement, callback: (e: TouchEvent | MouseEvent) => void, options?: AddEventListenerOptions) {\r\n  if(CLICK_EVENT_NAME === 'touchend') {\r\n    elem.removeEventListener('touchstart', callback, options);\r\n  } else {\r\n    elem.removeEventListener(CLICK_EVENT_NAME, callback, options);\r\n  }\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport { i18n, LangPackKey } from \"../lib/langPack\";\r\nimport { ripple } from \"./ripple\";\r\n\r\nconst Button = (className: string, options: Partial<{\r\n  noRipple: true, \r\n  onlyMobile: true, \r\n  icon: string, \r\n  rippleSquare: true, \r\n  text: LangPackKey, \r\n  disabled: boolean,\r\n  asDiv: boolean\r\n}> = {}) => {\r\n  const button: HTMLButtonElement = document.createElement(options.asDiv ? 'div' : 'button') as any;\r\n  button.className = className + (options.icon ? ' tgico-' + options.icon : '');\r\n\r\n  if(!options.noRipple) {\r\n    if(options.rippleSquare) {\r\n      button.classList.add('rp-square');\r\n    }\r\n\r\n    ripple(button);\r\n  }\r\n\r\n  if(options.onlyMobile) {\r\n    button.classList.add('only-handhelds');\r\n  }\r\n\r\n  if(options.disabled) {\r\n    button.setAttribute('disabled', 'true');\r\n  }\r\n\r\n  if(options.text) {\r\n    button.append(i18n(options.text));\r\n  }\r\n\r\n  return button;\r\n};\r\n\r\nexport default Button;\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport { MOUNT_CLASS_TO } from \"../config/debug\";\r\nimport Countries, { Country, PhoneCodesMain } from \"../countries\";\r\nimport { cancelEvent } from \"../helpers/dom/cancelEvent\";\r\nimport { CLICK_EVENT_NAME } from \"../helpers/dom/clickEvent\";\r\nimport ListenerSetter from \"../helpers/listenerSetter\";\r\nimport mediaSizes from \"../helpers/mediaSizes\";\r\nimport { isTouchSupported } from \"../helpers/touchSupport\";\r\nimport { isApple, isMobileSafari, isSafari } from \"../helpers/userAgent\";\r\nimport appNavigationController from \"./appNavigationController\";\r\n\r\nexport function putPreloader(elem: Element, returnDiv = false): HTMLElement {\r\n  const html = `\r\n  <svg xmlns=\"http://www.w3.org/2000/svg\" class=\"preloader-circular\" viewBox=\"25 25 50 50\">\r\n  <circle class=\"preloader-path\" cx=\"50\" cy=\"50\" r=\"20\" fill=\"none\" stroke-miterlimit=\"10\"/>\r\n  </svg>`;\r\n\r\n  if(returnDiv) {\r\n    const div = document.createElement('div');\r\n    div.classList.add('preloader');\r\n    div.innerHTML = html;\r\n\r\n    if(elem) {\r\n      elem.appendChild(div);\r\n    }\r\n\r\n    return div;\r\n  }\r\n  \r\n  elem.insertAdjacentHTML('beforeend', html);\r\n  return elem.lastElementChild as HTMLElement;\r\n}\r\n\r\nMOUNT_CLASS_TO.putPreloader = putPreloader;\r\n\r\nexport function setButtonLoader(elem: HTMLButtonElement, icon = 'check') {\r\n  elem.classList.remove('tgico-' + icon);\r\n  elem.disabled = true;\r\n  putPreloader(elem);\r\n\r\n  return () => {\r\n    elem.innerHTML = '';\r\n    elem.classList.add('tgico-' + icon);\r\n    elem.removeAttribute('disabled');\r\n  };\r\n}\r\n\r\nlet sortedCountries: Country[];\r\nexport function formatPhoneNumber(str: string) {\r\n  str = str.replace(/\\D/g, '');\r\n  let phoneCode = str.slice(0, 6);\r\n  \r\n  ////console.log('str', str, phoneCode);\r\n  if(!sortedCountries) {\r\n    sortedCountries = Countries.slice().sort((a, b) => b.phoneCode.length - a.phoneCode.length);\r\n  }\r\n  \r\n  let country = sortedCountries.find((c) => {\r\n    return c.phoneCode.split(' and ').find((c) => phoneCode.indexOf(c.replace(/\\D/g, '')) === 0);\r\n  });\r\n\r\n  if(!country) return {formatted: str, country};\r\n\r\n  country = PhoneCodesMain[country.phoneCode] || country;\r\n  \r\n  let pattern = country.pattern || country.phoneCode;\r\n  pattern.split('').forEach((symbol, idx) => {\r\n    if(symbol === ' ' && str[idx] !== ' ' && str.length > idx) {\r\n      str = str.slice(0, idx) + ' ' + str.slice(idx);\r\n    }\r\n  });\r\n  \r\n  /* if(country.pattern) {\r\n    str = str.slice(0, country.pattern.length);\r\n  } */\r\n  \r\n  return {formatted: str, country};\r\n}\r\n\r\n/* export function parseMenuButtonsTo(to: {[name: string]: HTMLElement}, elements: HTMLCollection | NodeListOf<HTMLElement>) {\r\n  Array.from(elements).forEach(el => {\r\n    const match = el.className.match(/(?:^|\\s)menu-(.+?)(?:$|\\s)/);\r\n    if(!match) return;\r\n    to[match[1]] = el as HTMLElement;\r\n  });\r\n} */\r\n\r\nlet onMouseMove = (e: MouseEvent) => {\r\n  let rect = openedMenu.getBoundingClientRect();\r\n  let {clientX, clientY} = e;\r\n  \r\n  let diffX = clientX >= rect.right ? clientX - rect.right : rect.left - clientX;\r\n  let diffY = clientY >= rect.bottom ? clientY - rect.bottom : rect.top - clientY;\r\n  \r\n  if(diffX >= 100 || diffY >= 100) {\r\n    closeBtnMenu();\r\n    //openedMenu.parentElement.click();\r\n  }\r\n  //console.log('mousemove', diffX, diffY);\r\n};\r\n\r\nconst onClick = (e: MouseEvent | TouchEvent) => {\r\n  //cancelEvent(e);\r\n  closeBtnMenu();\r\n};\r\n\r\n// ! no need in this due to the same handler in appNavigationController\r\n/* const onKeyDown = (e: KeyboardEvent) => {\r\n  if(e.key === 'Escape') {\r\n    closeBtnMenu();\r\n    cancelEvent(e);\r\n  }\r\n}; */\r\n\r\nexport const closeBtnMenu = () => {\r\n  if(openedMenu) {\r\n    openedMenu.classList.remove('active');\r\n    openedMenu.parentElement.classList.remove('menu-open');\r\n    //openedMenu.previousElementSibling.remove(); // remove overlay\r\n    if(menuOverlay) menuOverlay.remove();\r\n    openedMenu = null;\r\n  }\r\n  \r\n  if(openedMenuOnClose) {\r\n    openedMenuOnClose();\r\n    openedMenuOnClose = null;\r\n  }\r\n\r\n  if(!isTouchSupported) {\r\n    window.removeEventListener('mousemove', onMouseMove);\r\n    //window.removeEventListener('keydown', onKeyDown, {capture: true});\r\n    window.removeEventListener('contextmenu', onClick);\r\n  }\r\n\r\n  document.removeEventListener(CLICK_EVENT_NAME, onClick);\r\n\r\n  if(!isMobileSafari) {\r\n    appNavigationController.removeByType('menu');\r\n  }\r\n};\r\n\r\nwindow.addEventListener('resize', () => {\r\n  if(openedMenu) {\r\n    closeBtnMenu();\r\n  }\r\n  \r\n  /* if(openedMenu && (openedMenu.style.top || openedMenu.style.left)) {\r\n    const rect = openedMenu.getBoundingClientRect();\r\n    const {innerWidth, innerHeight} = window;\r\n\r\n    console.log(innerWidth, innerHeight, rect);\r\n  } */\r\n});\r\n\r\nlet openedMenu: HTMLElement = null, openedMenuOnClose: () => void = null, menuOverlay: HTMLElement = null;\r\nexport function openBtnMenu(menuElement: HTMLElement, onClose?: () => void) {\r\n  closeBtnMenu();\r\n\r\n  if(!isMobileSafari) {\r\n    appNavigationController.pushItem({\r\n      type: 'menu',\r\n      onPop: (canAnimate) => {\r\n        closeBtnMenu();\r\n      }\r\n    });\r\n  }\r\n  \r\n  openedMenu = menuElement;\r\n  openedMenu.classList.add('active');\r\n  openedMenu.parentElement.classList.add('menu-open');\r\n\r\n  if(!menuOverlay) {\r\n    menuOverlay = document.createElement('div');\r\n    menuOverlay.classList.add('btn-menu-overlay');\r\n\r\n    // ! because this event must be canceled, and can't cancel on menu click (below)\r\n    menuOverlay.addEventListener(CLICK_EVENT_NAME, (e) => {\r\n      cancelEvent(e);\r\n      onClick(e);\r\n    });\r\n  }\r\n\r\n  openedMenu.parentElement.insertBefore(menuOverlay, openedMenu);\r\n\r\n  //document.body.classList.add('disable-hover');\r\n  \r\n  openedMenuOnClose = onClose;\r\n\r\n  if(!isTouchSupported) {\r\n    window.addEventListener('mousemove', onMouseMove);\r\n    //window.addEventListener('keydown', onKeyDown, {capture: true});\r\n    window.addEventListener('contextmenu', onClick, {once: true});\r\n  }\r\n\r\n  /* // ! because this event must be canceled, and can't cancel on menu click (below)\r\n  overlay.addEventListener(CLICK_EVENT_NAME, (e) => {\r\n    cancelEvent(e);\r\n    onClick(e);\r\n  }); */\r\n  \r\n  // ! safari iOS doesn't handle window click event on overlay, idk why\r\n  document.addEventListener(CLICK_EVENT_NAME, onClick);\r\n}\r\n\r\nconst PADDING_TOP = 8;\r\nconst PADDING_LEFT = 8;\r\nexport function positionMenu({pageX, pageY}: MouseEvent | Touch, elem: HTMLElement, side?: 'left' | 'right' | 'center') {\r\n  //let {clientX, clientY} = e;\r\n\r\n  // * side mean the OPEN side\r\n\r\n  let {scrollWidth: menuWidth, scrollHeight: menuHeight} = elem;\r\n  //let {innerWidth: windowWidth, innerHeight: windowHeight} = window;\r\n  const rect = document.body.getBoundingClientRect();\r\n  const windowWidth = rect.width;\r\n  const windowHeight = rect.height;\r\n\r\n  side = mediaSizes.isMobile ? 'right' : 'left';\r\n  let verticalSide: 'top' /* | 'bottom' */ | 'center' = 'top';\r\n\r\n  const getSides = () => {\r\n    return {\r\n      x: {\r\n        left: pageX,\r\n        right: pageX - menuWidth\r\n      },\r\n      intermediateX: side === 'right' ? PADDING_LEFT : windowWidth - menuWidth - PADDING_LEFT,\r\n      //intermediateX: clientX < windowWidth / 2 ? PADDING_LEFT : windowWidth - menuWidth - PADDING_LEFT,\r\n      y: {\r\n        top: pageY,\r\n        bottom: pageY - menuHeight\r\n      },\r\n      //intermediateY: verticalSide === 'top' ? PADDING_TOP : windowHeight - menuHeight - PADDING_TOP,\r\n      intermediateY: pageY < windowHeight / 2 ? PADDING_TOP : windowHeight - menuHeight - PADDING_TOP,\r\n    };\r\n  };\r\n\r\n  const sides = getSides();\r\n\r\n  const possibleSides = {\r\n    x: {\r\n      left: sides.x.left + menuWidth + PADDING_LEFT <= windowWidth,\r\n      right: sides.x.right >= PADDING_LEFT\r\n    },\r\n    y: {\r\n      top: sides.y.top + menuHeight + PADDING_TOP <= windowHeight,\r\n      bottom: sides.y.bottom - PADDING_TOP >= PADDING_TOP\r\n    }\r\n  };\r\n\r\n  /* if(side === undefined) {\r\n    if((clientX + menuWidth + PADDING_LEFT) > windowWidth) {\r\n      side = 'right';\r\n    }\r\n  } */\r\n\r\n  {\r\n    /* const x = sides.x;\r\n\r\n    const s = Object.keys(x) as (keyof typeof possibleSides.x)[];\r\n    if(side) {\r\n      s.findAndSplice(s => s === side);\r\n      s.unshift(side);\r\n    }\r\n\r\n    const possibleSide = s.find(s => possibleSides.x[s]); */\r\n    let left: number;\r\n    /* if(possibleSide) {\r\n      left = x[possibleSide];\r\n      side = possibleSide;\r\n    } else {\r\n      left = sides.intermediateX;\r\n      side = undefined;\r\n    } */\r\n    left = possibleSides.x[side] ? sides.x[side] : (side = 'center', sides.intermediateX);\r\n  \r\n    elem.style.left = left + 'px';\r\n  }\r\n\r\n  /* if((clientY + menuHeight + PADDING_TOP) > windowHeight) {\r\n    elem.style.top = clamp(clientY - menuHeight, PADDING_TOP, windowHeight - menuHeight - PADDING_TOP) + 'px';\r\n    // elem.style.top = (innerHeight - scrollHeight - PADDING_TOP) + 'px';\r\n    verticalSide = 'bottom';\r\n  } else {\r\n    elem.style.top = Math.max(PADDING_TOP, clientY) + 'px';\r\n    verticalSide = 'top';\r\n  } */\r\n\r\n  {\r\n    let top: number;\r\n\r\n    top = possibleSides.y[verticalSide] ? sides.y[verticalSide] : (verticalSide = 'center', sides.intermediateY);\r\n  \r\n    elem.style.top = top + 'px';\r\n  }\r\n  \r\n  elem.className = elem.className.replace(/(top|center|bottom)-(left|center|right)/g, '');\r\n  elem.classList.add(\r\n    //(verticalSide === 'center' ? verticalSide : (verticalSide === 'bottom' ? 'top' : 'bottom')) +\r\n    (verticalSide === 'center' ? verticalSide : 'bottom') +\r\n    '-' +\r\n    (side === 'center' ? side : (side === 'left' ? 'right' : 'left')));\r\n}\r\n\r\nexport function attachContextMenuListener(element: HTMLElement, callback: (e: Touch | MouseEvent) => void, listenerSetter?: ListenerSetter) {\r\n  const add = listenerSetter ? listenerSetter.add.bind(listenerSetter, element) : element.addEventListener.bind(element);\r\n  const remove = listenerSetter ? listenerSetter.removeManual.bind(listenerSetter, element) : element.removeEventListener.bind(element);\r\n\r\n  if(isApple && isTouchSupported) {\r\n    let timeout: number;\r\n\r\n    const options: any = /* null */{capture: true};\r\n\r\n    const onCancel = () => {\r\n      clearTimeout(timeout);\r\n      remove('touchmove', onCancel, options);\r\n      remove('touchend', onCancel, options);\r\n      remove('touchcancel', onCancel, options);\r\n    };\r\n\r\n    add('touchstart', (e: TouchEvent) => {\r\n      if(e.touches.length > 1) {\r\n        onCancel();\r\n        return;\r\n      }\r\n  \r\n      add('touchmove', onCancel, options);\r\n      add('touchend', onCancel, options);\r\n      add('touchcancel', onCancel, options);\r\n\r\n      timeout = window.setTimeout(() => {\r\n        callback(e.touches[0]);\r\n        onCancel();\r\n\r\n        if(openedMenu) {\r\n          element.addEventListener('touchend', cancelEvent, {once: true}); // * fix instant closing\r\n        }\r\n      }, .4e3);\r\n    });\r\n\r\n    /* if(!isSafari) {\r\n      add('contextmenu', (e: any) => {\r\n        cancelEvent(e);\r\n      }, {passive: false, capture: true});\r\n    } */\r\n  } else {\r\n    add('contextmenu', isTouchSupported ? (e: any) => {\r\n      callback(e);\r\n\r\n      if(openedMenu) {\r\n        element.addEventListener('touchend', cancelEvent, {once: true}); // * fix instant closing\r\n      }\r\n    } : callback);\r\n  }\r\n};\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n * \r\n * Originally from:\r\n * https://github.com/zhukov/webogram\r\n * Copyright (C) 2014 Igor Zhukov <igor.beatle@gmail.com>\r\n * https://github.com/zhukov/webogram/blob/master/LICENSE\r\n */\r\n\r\nexport default function cleanUsername(username: string) {\r\n  return username && username.toLowerCase() || '';\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n * \r\n * Originally from:\r\n * https://github.com/zhukov/webogram\r\n * Copyright (C) 2014 Igor Zhukov <igor.beatle@gmail.com>\r\n * https://github.com/zhukov/webogram/blob/master/LICENSE\r\n */\r\n\r\nimport { formatPhoneNumber } from \"../../components/misc\";\r\nimport { MOUNT_CLASS_TO } from \"../../config/debug\";\r\nimport cleanSearchText from \"../../helpers/cleanSearchText\";\r\nimport cleanUsername from \"../../helpers/cleanUsername\";\r\nimport { tsNow } from \"../../helpers/date\";\r\nimport { safeReplaceObject, isObject } from \"../../helpers/object\";\r\nimport { InputUser, Update, User as MTUser, UserProfilePhoto, UserStatus } from \"../../layer\";\r\nimport I18n, { i18n, LangPackKey } from \"../langPack\";\r\n//import apiManager from '../mtproto/apiManager';\r\nimport apiManager from '../mtproto/mtprotoworker';\r\nimport { REPLIES_PEER_ID } from \"../mtproto/mtproto_config\";\r\nimport serverTimeManager from \"../mtproto/serverTimeManager\";\r\nimport { RichTextProcessor } from \"../richtextprocessor\";\r\nimport rootScope from \"../rootScope\";\r\nimport SearchIndex from \"../searchIndex\";\r\nimport apiUpdatesManager from \"./apiUpdatesManager\";\r\nimport appChatsManager from \"./appChatsManager\";\r\nimport appPeersManager from \"./appPeersManager\";\r\nimport appStateManager from \"./appStateManager\";\r\n\r\n// TODO: updateUserBlocked\r\n\r\nexport type User = MTUser.user;\r\n\r\nexport class AppUsersManager {\r\n  private storage = appStateManager.storages.users;\r\n  \r\n  private users: {[userId: number]: User};\r\n  private usernames: {[username: string]: number};\r\n  private contactsIndex: SearchIndex<number>;\r\n  private contactsFillPromise: Promise<Set<number>>;\r\n  private contactsList: Set<number>;\r\n  private updatedContactsList: boolean;\r\n  \r\n  private getTopPeersPromise: Promise<number[]>;\r\n\r\n  constructor() {\r\n    this.clear(true);\r\n\r\n    setInterval(this.updateUsersStatuses, 60000);\r\n\r\n    rootScope.addEventListener('state_synchronized', this.updateUsersStatuses);\r\n\r\n    rootScope.addMultipleEventsListeners({\r\n      updateUserStatus: (update) => {\r\n        const userId = update.user_id;\r\n        const user = this.users[userId];\r\n        if(user) {\r\n          user.status = update.status;\r\n          if(user.status) {\r\n            if('expires' in user.status) {\r\n              user.status.expires -= serverTimeManager.serverTimeOffset;\r\n            }\r\n\r\n            if('was_online' in user.status) {\r\n              user.status.was_online -= serverTimeManager.serverTimeOffset;\r\n            }\r\n          }\r\n\r\n          //user.sortStatus = this.getUserStatusForSort(user.status);\r\n          rootScope.dispatchEvent('user_update', userId);\r\n          this.setUserToStateIfNeeded(user);\r\n        } //////else console.warn('No user by id:', userId);\r\n      },\r\n\r\n      updateUserPhoto: (update) => {\r\n        const userId = update.user_id;\r\n        const user = this.users[userId];\r\n        if(user) {\r\n          this.forceUserOnline(userId);\r\n\r\n          if(update.photo._ === 'userProfilePhotoEmpty') {\r\n            delete user.photo;\r\n          } else {\r\n            user.photo = safeReplaceObject(user.photo, update.photo);\r\n          }\r\n\r\n          this.setUserToStateIfNeeded(user);\r\n\r\n          rootScope.dispatchEvent('user_update', userId);\r\n          rootScope.dispatchEvent('avatar_update', userId);\r\n        } else console.warn('No user by id:', userId);\r\n      },\r\n\r\n      updateUserName: (update) => {\r\n        const userId = update.user_id;\r\n        const user = this.users[userId];\r\n        if(user) {\r\n          this.forceUserOnline(userId);\r\n          \r\n          this.saveApiUser(Object.assign({}, user, {\r\n            first_name: update.first_name,\r\n            last_name: update.last_name,\r\n            username: update.username\r\n          }), true);\r\n        }\r\n      }\r\n    });\r\n\r\n    /* case 'updateContactLink':\r\n    this.onContactUpdated(update.user_id, update.my_link._ === 'contactLinkContact');\r\n    break; */\r\n\r\n    rootScope.addEventListener('language_change', (e) => {\r\n      const userId = this.getSelf().id;\r\n      this.contactsIndex.indexObject(userId, this.getUserSearchText(userId));\r\n    });\r\n\r\n    appStateManager.getState().then((state) => {\r\n      const users = appStateManager.storagesResults.users;\r\n      if(users.length) {\r\n        for(let i = 0, length = users.length; i < length; ++i) {\r\n          const user = users[i];\r\n          if(user) {\r\n            this.users[user.id] = user;\r\n          }\r\n        }\r\n      }\r\n\r\n      const contactsList = state.contactsList;\r\n      if(contactsList && Array.isArray(contactsList)) {\r\n        contactsList.forEach(userId => {\r\n          this.pushContact(userId);\r\n        });\r\n\r\n        if(contactsList.length) {\r\n          this.contactsFillPromise = Promise.resolve(this.contactsList);\r\n        }\r\n      }\r\n\r\n      appStateManager.addEventListener('peerNeeded', (peerId: number) => {\r\n        if(peerId < 0 || this.storage.getFromCache(peerId)) {\r\n          return;\r\n        }\r\n\r\n        this.storage.set({\r\n          [peerId]: this.getUser(peerId)\r\n        });\r\n      });\r\n\r\n      appStateManager.addEventListener('peerUnneeded', (peerId: number) => {\r\n        if(peerId < 0 || !this.storage.getFromCache(peerId)) {\r\n          return;\r\n        }\r\n\r\n        this.storage.delete(peerId);\r\n      });\r\n    });\r\n  }\r\n\r\n  public clear(init = false) {\r\n    if(!init) {\r\n      const users = appStateManager.storagesResults.users;\r\n      for(const _userId in this.users) {\r\n        const userId = +_userId;\r\n        if(!userId) continue;\r\n        if(!appStateManager.isPeerNeeded(userId)) {\r\n          const user = this.users[userId];\r\n          if(user.username) {\r\n            delete this.usernames[cleanUsername(user.username)];\r\n          }\r\n\r\n          users.findAndSplice((user) => user.id === userId);\r\n          this.storage.delete(userId);\r\n          delete this.users[userId];\r\n        }\r\n      }\r\n    } else {\r\n      this.users = {};\r\n      this.usernames = {};\r\n    }\r\n    \r\n    this.contactsIndex = new SearchIndex();\r\n    this.contactsFillPromise = undefined;\r\n    this.contactsList = new Set();\r\n    this.updatedContactsList = false;\r\n  }\r\n\r\n  private onContactsModified() {\r\n    const contactsList = [...this.contactsList];\r\n    appStateManager.pushToState('contactsList', contactsList);\r\n  }\r\n\r\n  public fillContacts() {\r\n    if(this.contactsFillPromise && this.updatedContactsList) {\r\n      return this.contactsFillPromise;\r\n    }\r\n\r\n    this.updatedContactsList = true;\r\n\r\n    const promise = apiManager.invokeApi('contacts.getContacts').then((result) => {\r\n      if(result._ === 'contacts.contacts') {\r\n        this.saveApiUsers(result.users);\r\n\r\n        result.contacts.forEach((contact) => {\r\n          this.pushContact(contact.user_id);\r\n        });\r\n\r\n        this.onContactsModified();\r\n      }\r\n\r\n      this.contactsFillPromise = promise;\r\n\r\n      return this.contactsList;\r\n    });\r\n\r\n    return this.contactsFillPromise || (this.contactsFillPromise = promise);\r\n  }\r\n\r\n  public resolveUsername(username: string) {\r\n    if(username[0] === '@') {\r\n      username = username.slice(1);\r\n    }\r\n\r\n    username = username.toLowerCase();\r\n    if(this.usernames[username]) {\r\n      return Promise.resolve(this.users[this.usernames[username]]);\r\n    }\r\n\r\n    return apiManager.invokeApi('contacts.resolveUsername', {username}).then(resolvedPeer => {\r\n      this.saveApiUsers(resolvedPeer.users);\r\n      appChatsManager.saveApiChats(resolvedPeer.chats);\r\n\r\n      return appPeersManager.getPeer(appPeersManager.getPeerId(resolvedPeer.peer));\r\n    });\r\n  }\r\n\r\n  public pushContact(userId: number) {\r\n    this.contactsList.add(userId);\r\n    this.contactsIndex.indexObject(userId, this.getUserSearchText(userId));\r\n    appStateManager.requestPeer(userId, 'contacts');\r\n  }\r\n\r\n  public getUserSearchText(id: number) {\r\n    const user = this.users[id];\r\n    if(!user) {\r\n      return '';\r\n    }\r\n\r\n    const arr: string[] = [\r\n      user.first_name,\r\n      user.last_name,\r\n      user.phone,\r\n      user.username,\r\n      user.pFlags.self ? I18n.format('SavedMessages', true) : '',\r\n      user.pFlags.self ? 'Saved Messages' : ''\r\n    ];\r\n\r\n    return arr.filter(Boolean).join(' ');\r\n  }\r\n\r\n  public getContacts(query?: string, includeSaved = false) {\r\n    return this.fillContacts().then(_contactsList => {\r\n      let contactsList = [..._contactsList];\r\n      if(query) {\r\n        const results = this.contactsIndex.search(query);\r\n        const filteredContactsList = [...contactsList].filter(id => results.has(id));\r\n\r\n        contactsList = filteredContactsList;\r\n      }\r\n\r\n      contactsList.sort((userId1: number, userId2: number) => {\r\n        const sortName1 = (this.users[userId1] || {}).sortName || '';\r\n        const sortName2 = (this.users[userId2] || {}).sortName || '';\r\n\r\n        return sortName1.localeCompare(sortName2);\r\n      });\r\n\r\n      if(includeSaved) {\r\n        if(this.testSelfSearch(query)) {\r\n          contactsList.findAndSplice(p => p === rootScope.myId);\r\n          contactsList.unshift(rootScope.myId);\r\n        }\r\n      }\r\n\r\n      /* contactsList.sort((userId1: number, userId2: number) => {\r\n        const sortName1 = (this.users[userId1] || {}).sortName || '';\r\n        const sortName2 = (this.users[userId2] || {}).sortName || '';\r\n        if(sortName1 === sortName2) {\r\n          return 0;\r\n        } \r\n        \r\n        return sortName1 > sortName2 ? 1 : -1;\r\n      }); */\r\n\r\n      return contactsList;\r\n    });\r\n  }\r\n\r\n  public toggleBlock(peerId: number, block: boolean) {\r\n    return apiManager.invokeApi(block ? 'contacts.block' : 'contacts.unblock', {\r\n      id: appPeersManager.getInputPeerById(peerId)\r\n    }).then(value => {\r\n      if(value) {\r\n        apiUpdatesManager.processLocalUpdate({\r\n          _: 'updatePeerBlocked',\r\n          peer_id: appPeersManager.getOutputPeer(peerId),\r\n          blocked: block\r\n        });\r\n      }\r\n\r\n      return value;\r\n    });\r\n  }\r\n\r\n  public testSelfSearch(query: string) {\r\n    const user = this.getSelf();\r\n    const index = new SearchIndex();\r\n    index.indexObject(user.id, this.getUserSearchText(user.id));\r\n    return index.search(query).has(user.id);\r\n  }\r\n\r\n  public saveApiUsers(apiUsers: any[], override?: boolean) {\r\n    apiUsers.forEach((user) => this.saveApiUser(user, override));\r\n  }\r\n\r\n  public saveApiUser(user: MTUser, override?: boolean) {\r\n    if(user._ === 'userEmpty') return;\r\n\r\n    const userId = user.id;\r\n    const oldUser = this.users[userId];\r\n\r\n    // ! commented block can affect performance !\r\n    // if(oldUser && !override) {\r\n    //   console.log('saveApiUser same');\r\n    //   return;\r\n    // }\r\n\r\n    if(user.pFlags === undefined) {\r\n      user.pFlags = {};\r\n    }\r\n\r\n    if(user.pFlags.min && oldUser !== undefined) {\r\n      return;\r\n    }\r\n\r\n    // * exclude from state\r\n    // defineNotNumerableProperties(user, ['initials', 'num', 'rFirstName', 'rFullName', 'rPhone', 'sortName', 'sortStatus']);\r\n\r\n    const fullName = user.first_name + ' ' + (user.last_name || '');\r\n    if(user.username) {\r\n      const searchUsername = cleanUsername(user.username);\r\n      this.usernames[searchUsername] = userId;\r\n    }\r\n\r\n    user.sortName = user.pFlags.deleted ? '' : cleanSearchText(fullName, false);\r\n\r\n    user.initials = RichTextProcessor.getAbbreviation(fullName);\r\n\r\n    if(user.status) {\r\n      if((user.status as UserStatus.userStatusOnline).expires) {\r\n        (user.status as UserStatus.userStatusOnline).expires -= serverTimeManager.serverTimeOffset;\r\n      }\r\n\r\n      if((user.status as UserStatus.userStatusOffline).was_online) {\r\n        (user.status as UserStatus.userStatusOffline).was_online -= serverTimeManager.serverTimeOffset;\r\n      }\r\n    }\r\n\r\n    //user.sortStatus = user.pFlags.bot ? -1 : this.getUserStatusForSort(user.status);\r\n\r\n    let changedPhoto = false, changedTitle = false;\r\n    if(oldUser === undefined) {\r\n      this.users[userId] = user;\r\n    } else {\r\n      if(user.first_name !== oldUser.first_name \r\n        || user.last_name !== oldUser.last_name \r\n        || user.username !== oldUser.username) {\r\n        changedTitle = true;\r\n      }\r\n\r\n      const oldPhotoId = (oldUser.photo as UserProfilePhoto.userProfilePhoto)?.photo_id;\r\n      const newPhotoId = (user.photo as UserProfilePhoto.userProfilePhoto)?.photo_id;\r\n      if(oldPhotoId !== newPhotoId) {\r\n        changedPhoto = true;\r\n      }\r\n\r\n      /* if(user.pFlags.bot && user.bot_info_version !== oldUser.bot_info_version) {\r\n        \r\n      } */\r\n\r\n      safeReplaceObject(oldUser, user);\r\n      rootScope.dispatchEvent('user_update', userId);\r\n    }\r\n\r\n    if(changedPhoto) {\r\n      rootScope.dispatchEvent('avatar_update', user.id);\r\n    }\r\n\r\n    if(changedTitle) {\r\n      rootScope.dispatchEvent('peer_title_edit', user.id);\r\n    }\r\n\r\n    this.setUserToStateIfNeeded(user);\r\n  }\r\n\r\n  public setUserToStateIfNeeded(user: User) {\r\n    if(appStateManager.isPeerNeeded(user.id)) {\r\n      this.storage.set({\r\n        [user.id]: user\r\n      });\r\n    }\r\n  }\r\n\r\n  public formatUserPhone(phone: string) {\r\n    return '+' + formatPhoneNumber(phone).formatted;\r\n  }\r\n\r\n  public getUserStatusForSort(status: User['status'] | number) {\r\n    if(typeof(status) === 'number') {\r\n      status = this.getUser(status).status;\r\n    }\r\n\r\n    if(status) {\r\n      const expires = status._ === 'userStatusOnline' ? status.expires : (status._ === 'userStatusOffline' ? status.was_online : 0);\r\n      if(expires) {\r\n        return expires;\r\n      }\r\n\r\n      /* const timeNow = tsNow(true);\r\n      switch(status._) {\r\n        case 'userStatusRecently':\r\n          return timeNow - 86400 * 3;\r\n        case 'userStatusLastWeek':\r\n          return timeNow - 86400 * 7;\r\n        case 'userStatusLastMonth':\r\n          return timeNow - 86400 * 30;\r\n      } */\r\n      switch(status._) {\r\n        case 'userStatusRecently':\r\n          return 3;\r\n        case 'userStatusLastWeek':\r\n          return 2;\r\n        case 'userStatusLastMonth':\r\n          return 1;\r\n      }\r\n    }\r\n\r\n    return 0;\r\n  }\r\n\r\n  public getUser(id: any): User {\r\n    if(isObject(id)) {\r\n      return id;\r\n    }\r\n\r\n    return this.users[id] || {id: id, pFlags: {deleted: true}, access_hash: ''} as User;\r\n  }\r\n\r\n  public getSelf() {\r\n    return this.getUser(rootScope.myId);\r\n  }\r\n\r\n  public getUserStatusString(userId: number): HTMLElement {\r\n    let key: LangPackKey;\r\n    let args: any[];\r\n\r\n    switch(userId) {\r\n      case REPLIES_PEER_ID:\r\n        key = 'Peer.RepliesNotifications';\r\n        break;\r\n      case 777000:\r\n        key = 'Peer.ServiceNotifications';\r\n        break;\r\n      default: {\r\n        if(this.isBot(userId)) {\r\n          key = 'Bot';\r\n          break;\r\n        }\r\n\r\n        const user = this.getUser(userId);\r\n        if(!user) {\r\n          key = '' as any;\r\n          break;\r\n        }\r\n\r\n        if(user.pFlags.support) {\r\n          key = 'SupportStatus';\r\n          break;\r\n        }\r\n\r\n        switch(user.status?._) {\r\n          case 'userStatusRecently': {\r\n            key = 'Lately';\r\n            break;\r\n          }\r\n    \r\n          case 'userStatusLastWeek': {\r\n            key = 'WithinAWeek';\r\n            break;\r\n          }\r\n    \r\n          case 'userStatusLastMonth': {\r\n            key = 'WithinAMonth';\r\n            break;\r\n          }\r\n          \r\n          case 'userStatusOffline': {\r\n            const date = user.status.was_online;\r\n            const now = Date.now() / 1000;\r\n            \r\n            if((now - date) < 60) {\r\n              key = 'Peer.Status.justNow';\r\n            } else if((now - date) < 3600) {\r\n              key = 'Peer.Status.minAgo';\r\n              const c = (now - date) / 60 | 0;\r\n              args = [c];\r\n            } else if(now - date < 86400) {\r\n              key = 'LastSeen.HoursAgo';\r\n              const c = (now - date) / 3600 | 0;\r\n              args = [c];\r\n            } else {\r\n              key = 'Peer.Status.LastSeenAt';\r\n              const d = new Date(date * 1000);\r\n              args = [('0' + d.getDate()).slice(-2) + '.' + ('0' + (d.getMonth() + 1)).slice(-2), \r\n                ('0' + d.getHours()).slice(-2) + ':' + ('0' + d.getMinutes()).slice(-2)];\r\n            }\r\n            \r\n            break;\r\n          }\r\n    \r\n          case 'userStatusOnline': {\r\n            key = 'Online';\r\n            break;\r\n          }\r\n    \r\n          default: {\r\n            key = 'ALongTimeAgo';\r\n            break;\r\n          }\r\n        }\r\n\r\n        break;\r\n      }\r\n    }\r\n    \r\n    return i18n(key, args);\r\n  }\r\n\r\n  public isBot(id: number) {\r\n    return this.users[id] && this.users[id].pFlags.bot;\r\n  }\r\n\r\n  public isContact(id: number) {\r\n    return this.contactsList.has(id);\r\n  }\r\n  \r\n  public isRegularUser(id: number) {\r\n    const user = this.users[id];\r\n    return user && !this.isBot(id) && !user.pFlags.deleted && !user.pFlags.support;\r\n  }\r\n\r\n  public isNonContactUser(id: number) {\r\n    return this.isRegularUser(id) && !this.isContact(id) && id !== rootScope.myId;\r\n  }\r\n\r\n  public hasUser(id: number, allowMin?: boolean) {\r\n    var user = this.users[id];\r\n    return isObject(user) && (allowMin || !user.pFlags.min);\r\n  }\r\n\r\n  public canSendToUser(id: number) {\r\n    const user = this.getUser(id);\r\n    return !user.pFlags.deleted && user.username !== 'replies';\r\n  }\r\n\r\n  public getUserPhoto(id: number) {\r\n    const user = this.getUser(id);\r\n\r\n    return user && user.photo || {\r\n      _: 'userProfilePhotoEmpty'\r\n    };\r\n  }\r\n\r\n  public getUserString(id: number) {\r\n    const user = this.getUser(id);\r\n    return 'u' + id + (user.access_hash ? '_' + user.access_hash : '');\r\n  }\r\n\r\n  public getUserInput(id: number): InputUser {\r\n    const user = this.getUser(id);\r\n    if(user.pFlags && user.pFlags.self) {\r\n      return {_: 'inputUserSelf'};\r\n    }\r\n\r\n    return {\r\n      _: 'inputUser',\r\n      user_id: id,\r\n      access_hash: user.access_hash\r\n    };\r\n  }\r\n\r\n  public updateUsersStatuses = () => {\r\n    const timestampNow = tsNow(true);\r\n    for(const i in this.users) {\r\n      const user = this.users[i];\r\n\r\n      if(user.status &&\r\n        user.status._ === 'userStatusOnline' &&\r\n        user.status.expires < timestampNow) {\r\n\r\n        user.status = {_: 'userStatusOffline', was_online: user.status.expires};\r\n        rootScope.dispatchEvent('user_update', user.id);\r\n\r\n        this.setUserToStateIfNeeded(user);\r\n      }\r\n    }\r\n  };\r\n\r\n  public forceUserOnline(id: number, eventTimestamp?: number) {\r\n    if(this.isBot(id)) {\r\n      return;\r\n    }\r\n\r\n    const timestamp = tsNow(true);\r\n    const onlineTimeFor = 60;\r\n    if(eventTimestamp) {\r\n      if((timestamp - eventTimestamp) >= onlineTimeFor) {\r\n        return;\r\n      }\r\n    } else if(apiUpdatesManager.updatesState.syncLoading) {\r\n      return;\r\n    }\r\n\r\n    const user = this.getUser(id);\r\n    if(user &&\r\n      user.status &&\r\n      user.status._ !== 'userStatusOnline' &&\r\n      user.status._ !== 'userStatusEmpty' &&\r\n      !user.pFlags.support &&\r\n      !user.pFlags.deleted) {\r\n\r\n      user.status = {\r\n        _: 'userStatusOnline',\r\n        expires: timestamp + onlineTimeFor\r\n      };\r\n      \r\n      //user.sortStatus = this.getUserStatusForSort(user.status);\r\n      rootScope.dispatchEvent('user_update', id);\r\n\r\n      this.setUserToStateIfNeeded(user);\r\n    }\r\n  }\r\n\r\n  /* function importContact (phone, firstName, lastName) {\r\n      return MtpApiManager.invokeApi('contacts.importContacts', {\r\n        contacts: [{\r\n          _: 'inputPhoneContact',\r\n          client_id: '1',\r\n          phone: phone,\r\n          first_name: firstName,\r\n          last_name: lastName\r\n        }],\r\n        replace: false\r\n      }).then(function (importedContactsResult) {\r\n        saveApiUsers(importedContactsResult.users)\r\n\r\n        var foundUserID = false\r\n        angular.forEach(importedContactsResult.imported, function (importedContact) {\r\n          onContactUpdated(foundUserID = importedContact.user_id, true)\r\n        })\r\n\r\n        return foundUserID || false\r\n      })\r\n  }\r\n\r\n  function importContacts (contacts) {\r\n    var inputContacts = [],\r\n      i\r\n    var j\r\n\r\n    for (i = 0; i < contacts.length; i++) {\r\n      for (j = 0; j < contacts[i].phones.length; j++) {\r\n        inputContacts.push({\r\n          _: 'inputPhoneContact',\r\n          client_id: (i << 16 | j).toString(10),\r\n          phone: contacts[i].phones[j],\r\n          first_name: contacts[i].first_name,\r\n          last_name: contacts[i].last_name\r\n        })\r\n      }\r\n    }\r\n\r\n    return MtpApiManager.invokeApi('contacts.importContacts', {\r\n      contacts: inputContacts,\r\n      replace: false\r\n    }).then(function (importedContactsResult) {\r\n      saveApiUsers(importedContactsResult.users)\r\n\r\n      var result = []\r\n      angular.forEach(importedContactsResult.imported, function (importedContact) {\r\n        onContactUpdated(importedContact.user_id, true)\r\n        result.push(importedContact.user_id)\r\n      })\r\n\r\n      return result\r\n    })\r\n  } */\r\n\r\n  /* public deleteContacts(userIds: number[]) {\r\n    var ids: any[] = [];\r\n    userIds.forEach((userId) => {\r\n      ids.push(this.getUserInput(userId));\r\n    })\r\n\r\n    return apiManager.invokeApi('contacts.deleteContacts', {\r\n      id: ids\r\n    }).then(() => {\r\n      userIds.forEach((userId) => {\r\n        this.onContactUpdated(userId, false);\r\n      });\r\n    });\r\n  } */\r\n\r\n  public getTopPeers(): Promise<number[]> {\r\n    if(this.getTopPeersPromise) return this.getTopPeersPromise;\r\n\r\n    return this.getTopPeersPromise = appStateManager.getState().then((state) => {\r\n      if(state?.topPeers?.length) {\r\n        return state.topPeers;\r\n      }\r\n\r\n      return apiManager.invokeApi('contacts.getTopPeers', {\r\n        correspondents: true,\r\n        offset: 0,\r\n        limit: 15,\r\n        hash: 0,\r\n      }).then((result) => {\r\n        let peerIds: number[] = [];\r\n        if(result._ === 'contacts.topPeers') {\r\n          //console.log(result);\r\n          this.saveApiUsers(result.users);\r\n          appChatsManager.saveApiChats(result.chats);\r\n\r\n          if(result.categories.length) {\r\n            peerIds = result.categories[0].peers.map((topPeer) => {\r\n              const peerId = appPeersManager.getPeerId(topPeer.peer);\r\n              appStateManager.requestPeer(peerId, 'topPeer');\r\n              return peerId;\r\n            });\r\n          }\r\n        }\r\n  \r\n        appStateManager.pushToState('topPeers', peerIds);\r\n  \r\n        return peerIds;\r\n      });\r\n    });\r\n  }\r\n\r\n  public getBlocked(offset = 0, limit = 0) {\r\n    return apiManager.invokeApi('contacts.getBlocked', {offset, limit}).then(contactsBlocked => {\r\n      this.saveApiUsers(contactsBlocked.users);\r\n      appChatsManager.saveApiChats(contactsBlocked.chats);\r\n      const count = contactsBlocked._ === 'contacts.blocked' ? contactsBlocked.users.length + contactsBlocked.chats.length : contactsBlocked.count;\r\n\r\n      const peerIds = contactsBlocked.users.map(u => u.id).concat(contactsBlocked.chats.map(c => -c.id));\r\n\r\n      return {count, peerIds};\r\n    });\r\n  }\r\n\r\n  /* public searchContacts(query: string, limit = 20) {\r\n    return Promise.all([\r\n      this.getContacts(query),\r\n      apiManager.invokeApi('contacts.search', {\r\n        q: query,\r\n        limit\r\n      })\r\n    ]).then(results => {\r\n      const [myContacts, peers] = results;\r\n\r\n      this.saveApiUsers(peers.users);\r\n      appChatsManager.saveApiChats(peers.chats);\r\n\r\n      // * contacts.search returns duplicates in my_results\r\n      const myResults = new Set(myContacts.concat(peers.my_results.map(p => appPeersManager.getPeerID(p))));\r\n\r\n      const out = {\r\n        my_results: [...myResults].slice(0, limit),\r\n        results: peers.results.map(p => appPeersManager.getPeerID(p))\r\n      };\r\n\r\n      return out;\r\n    });\r\n  } */\r\n  public searchContacts(query: string, limit = 20) {\r\n    return apiManager.invokeApi('contacts.search', {\r\n      q: query,\r\n      limit\r\n    }).then(peers => {\r\n      this.saveApiUsers(peers.users);\r\n      appChatsManager.saveApiChats(peers.chats);\r\n\r\n      const out = {\r\n        my_results: [...new Set(peers.my_results.map(p => appPeersManager.getPeerId(p)))], // ! contacts.search returns duplicates in my_results\r\n        results: peers.results.map(p => appPeersManager.getPeerId(p))\r\n      };\r\n\r\n      return out;\r\n    });\r\n  }\r\n\r\n  private onContactUpdated(userId: number, isContact: boolean) {\r\n    const curIsContact = this.isContact(userId);\r\n    if(isContact !== curIsContact) {\r\n      if(isContact) {\r\n        this.pushContact(userId);\r\n      } else {\r\n        this.contactsList.delete(userId);\r\n      }\r\n\r\n      this.onContactsModified();\r\n\r\n      rootScope.dispatchEvent('contacts_update', userId);\r\n    }\r\n  }\r\n\r\n  public updateUsername(username: string) {\r\n    return apiManager.invokeApi('account.updateUsername', {\r\n      username\r\n    }).then((user) => {\r\n      this.saveApiUser(user);\r\n    });\r\n  }\r\n\r\n  public setUserStatus(userId: number, offline: boolean) {\r\n    if(this.isBot(userId)) {\r\n      return;\r\n    }\r\n\r\n    const user = this.users[userId];\r\n    if(user) {\r\n      const status: any = offline ? {\r\n        _: 'userStatusOffline',\r\n        was_online: tsNow(true)\r\n      } : {\r\n        _: 'userStatusOnline',\r\n        expires: tsNow(true) + 500\r\n      };\r\n\r\n      user.status = status;\r\n      //user.sortStatus = this.getUserStatusForSort(user.status);\r\n      rootScope.dispatchEvent('user_update', userId);\r\n    }\r\n  }\r\n\r\n  public addContact(userId: number, first_name: string, last_name: string, phone: string, showPhone?: true) {\r\n    return apiManager.invokeApi('contacts.addContact', {\r\n      id: this.getUserInput(userId),\r\n      first_name,\r\n      last_name,\r\n      phone,\r\n      add_phone_privacy_exception: showPhone\r\n    }).then((updates) => {\r\n      apiUpdatesManager.processUpdateMessage(updates, {override: true});\r\n\r\n      this.onContactUpdated(userId, true);\r\n    });\r\n  }\r\n\r\n  public deleteContacts(userIds: number[]) {\r\n    return apiManager.invokeApi('contacts.deleteContacts', {\r\n      id: userIds.map(userId => this.getUserInput(userId))\r\n    }).then((updates) => {\r\n      apiUpdatesManager.processUpdateMessage(updates, {override: true});\r\n\r\n      userIds.forEach(userId => {\r\n        this.onContactUpdated(userId, false);\r\n      });\r\n    });\r\n  }\r\n}\r\n\r\nconst appUsersManager = new AppUsersManager();\r\nMOUNT_CLASS_TO.appUsersManager = appUsersManager;\r\nexport default appUsersManager\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n * \r\n * Originally from:\r\n * https://github.com/zhukov/webogram\r\n * Copyright (C) 2014 Igor Zhukov <igor.beatle@gmail.com>\r\n * https://github.com/zhukov/webogram/blob/master/LICENSE\r\n */\r\n\r\nimport { MOUNT_CLASS_TO } from \"../../config/debug\";\r\nimport { isObject, safeReplaceObject, copy, deepEqual } from \"../../helpers/object\";\r\nimport { ChannelParticipant, Chat, ChatAdminRights, ChatBannedRights, ChatParticipant, ChatPhoto, InputChannel, InputChatPhoto, InputFile, InputPeer, Update, Updates } from \"../../layer\";\r\nimport apiManagerProxy from \"../mtproto/mtprotoworker\";\r\nimport apiManager from '../mtproto/mtprotoworker';\r\nimport { RichTextProcessor } from \"../richtextprocessor\";\r\nimport rootScope from \"../rootScope\";\r\nimport apiUpdatesManager from \"./apiUpdatesManager\";\r\nimport appPeersManager from \"./appPeersManager\";\r\nimport appStateManager from \"./appStateManager\";\r\nimport appUsersManager from \"./appUsersManager\";\r\n\r\nexport type Channel = Chat.channel;\r\n\r\nexport type ChatRights = keyof ChatBannedRights['pFlags'] | keyof ChatAdminRights['pFlags'] | 'change_type' | 'change_permissions' | 'delete_chat' | 'view_participants';\r\n\r\nexport class AppChatsManager {\r\n  private storage = appStateManager.storages.chats;\r\n  \r\n  private chats: {[id: number]: Chat.channel | Chat.chat | any};\r\n  //private usernames: any;\r\n  //private channelAccess: any;\r\n  //private megagroups: {[id: number]: true};\r\n\r\n  constructor() {\r\n    this.clear(true);\r\n\r\n    rootScope.addMultipleEventsListeners({\r\n      /* updateChannel: (update) => {\r\n        const channelId = update.channel_id;\r\n        //console.log('updateChannel:', update);\r\n        rootScope.broadcast('channel_settings', {channelId});\r\n      }, */\r\n\r\n      updateChannelParticipant: (update) => {\r\n        apiManagerProxy.clearCache('channels.getParticipants', (params) => {\r\n          return (params.channel as InputChannel.inputChannel).channel_id === update.channel_id;\r\n        });\r\n      },\r\n\r\n      updateChatDefaultBannedRights: (update) => {\r\n        const chatId = -appPeersManager.getPeerId(update.peer);\r\n        const chat: Chat.chat = this.chats[chatId];\r\n        if(chat) {\r\n          chat.default_banned_rights = update.default_banned_rights;\r\n          rootScope.dispatchEvent('chat_update', chatId);\r\n        }\r\n      }\r\n    });\r\n\r\n    appStateManager.getState().then((state) => {\r\n      const chats = appStateManager.storagesResults.chats;\r\n      if(chats.length) {\r\n        for(let i = 0, length = chats.length; i < length; ++i) {\r\n          const chat = chats[i];\r\n          if(chat) {\r\n            this.chats[chat.id] = chat;\r\n          }\r\n        }\r\n      }\r\n\r\n      appStateManager.addEventListener('peerNeeded', (peerId: number) => {\r\n        if(peerId > 0 || this.storage.getFromCache(-peerId)) {\r\n          return;\r\n        }\r\n\r\n        this.storage.set({\r\n          [-peerId]: this.getChat(-peerId)\r\n        });\r\n      });\r\n\r\n      appStateManager.addEventListener('peerUnneeded', (peerId: number) => {\r\n        if(peerId > 0 || !this.storage.getFromCache(-peerId)) {\r\n          return;\r\n        }\r\n\r\n        this.storage.delete(-peerId);\r\n      });\r\n    });\r\n  }\r\n\r\n  public clear(init = false) {\r\n    if(!init) {\r\n      const chats = appStateManager.storagesResults.chats;\r\n      for(const _chatId in this.chats) {\r\n        const chatId = +_chatId;\r\n        if(!chatId) continue;\r\n        if(!appStateManager.isPeerNeeded(-chatId)) {\r\n          /* const chat = this.chats[chatId];\r\n          if(chat.username) {\r\n            delete this.usernames[cleanUsername(chat.username)];\r\n          } */\r\n          \r\n          chats.findAndSplice((chat) => chat.id === chatId);\r\n          this.storage.delete(chatId);\r\n          delete this.chats[chatId];\r\n        }\r\n      }\r\n    } else {\r\n      this.chats = {};\r\n    }\r\n  }\r\n\r\n  public saveApiChats(apiChats: any[], override?: boolean) {\r\n    apiChats.forEach(chat => this.saveApiChat(chat, override));\r\n  }\r\n\r\n  public saveApiChat(chat: Chat, override?: boolean) {\r\n    if(chat._ === 'chatEmpty') return;\r\n    /* if(chat._ !== 'chat' && chat._ !== 'channel') {\r\n      return;\r\n    } */\r\n    \r\n    // * exclude from state\r\n    // defineNotNumerableProperties(chat, ['rTitle', 'initials']);\r\n\r\n    const oldChat: Exclude<Chat, Chat.chatEmpty> = this.chats[chat.id];\r\n\r\n    /* if(oldChat && !override) {\r\n      return;\r\n    } */\r\n\r\n    if((chat as Chat.chat).pFlags === undefined) {\r\n      (chat as Chat.chat).pFlags = {};\r\n    }\r\n\r\n    if((chat as Chat.channel).pFlags.min && oldChat !== undefined) {\r\n      return;\r\n    }\r\n\r\n    chat.initials = RichTextProcessor.getAbbreviation(chat.title);\r\n\r\n    if(chat._ === 'channel' &&\r\n        chat.participants_count === undefined &&\r\n        oldChat !== undefined &&\r\n        (oldChat as Chat.channel).participants_count) {\r\n      chat.participants_count = (oldChat as Chat.channel).participants_count;\r\n    }\r\n\r\n    /* if(chat.username) {\r\n      let searchUsername = searchIndexManager.cleanUsername(chat.username);\r\n      this.usernames[searchUsername] = chat.id;\r\n    } */\r\n\r\n    let changedPhoto = false, changedTitle = false;\r\n    if(oldChat === undefined) {\r\n      this.chats[chat.id] = chat;\r\n    } else {\r\n      const oldPhotoId = ((oldChat as Chat.chat).photo as ChatPhoto.chatPhoto)?.photo_id;\r\n      const newPhotoId = ((chat as Chat.chat).photo as ChatPhoto.chatPhoto)?.photo_id;\r\n      if(oldPhotoId !== newPhotoId) {\r\n        changedPhoto = true;\r\n      }\r\n\r\n      if(oldChat.title !== chat.title) {\r\n        changedTitle = true;\r\n      }\r\n\r\n      safeReplaceObject(oldChat, chat);\r\n      rootScope.dispatchEvent('chat_update', chat.id);\r\n    }\r\n\r\n    if(changedPhoto) {\r\n      rootScope.dispatchEvent('avatar_update', -chat.id);\r\n    }\r\n\r\n    if(changedTitle) {\r\n      rootScope.dispatchEvent('peer_title_edit', -chat.id);\r\n    }\r\n\r\n    if(appStateManager.isPeerNeeded(-chat.id)) {\r\n      this.storage.set({\r\n        [chat.id]: chat\r\n      });\r\n    }\r\n  }\r\n\r\n  public getChat(id: number) {\r\n    if(id < 0) id = -id;\r\n    return this.chats[id] || {_: 'chatEmpty', id, deleted: true, access_hash: '', pFlags: {}/* this.channelAccess[id] */};\r\n  }\r\n\r\n  public combineParticipantBannedRights(id: number, rights: ChatBannedRights) {\r\n    const chat: Chat.channel = this.getChat(id);\r\n\r\n    if(chat.default_banned_rights) {\r\n      rights = copy(rights);\r\n      const defaultRights = chat.default_banned_rights.pFlags;\r\n      for(let i in defaultRights) {\r\n        // @ts-ignore\r\n        rights.pFlags[i] = defaultRights[i];\r\n      }\r\n    }\r\n\r\n    return rights;\r\n  }\r\n\r\n  public hasRights(id: number, action: ChatRights, rights?: ChatAdminRights | ChatBannedRights, isThread?: boolean) {\r\n    const chat: Chat = this.getChat(id);\r\n    if(chat._ === 'chatEmpty') return false;\r\n\r\n    if(chat._ === 'chatForbidden' ||\r\n        chat._ === 'channelForbidden' ||\r\n        (chat as Chat.chat).pFlags.kicked ||\r\n        (chat.pFlags.left && !(chat as Chat.channel).pFlags.megagroup)) {\r\n      return false;\r\n    }\r\n\r\n    if(chat.pFlags.creator && rights === undefined) {\r\n      return true;\r\n    }\r\n\r\n    if(!rights) {\r\n      rights = chat.admin_rights || (chat as Chat.channel).banned_rights || chat.default_banned_rights;\r\n\r\n      if(!rights) {\r\n        return false;\r\n      }\r\n    }\r\n\r\n    let myFlags: Partial<{[flag in keyof ChatBannedRights['pFlags'] | keyof ChatAdminRights['pFlags']]: true}> = {};\r\n    if(rights) {\r\n      myFlags = rights.pFlags as any;\r\n    }\r\n\r\n    switch(action) {\r\n      case 'embed_links':\r\n      case 'send_games':\r\n      case 'send_gifs':\r\n      case 'send_inline':\r\n      case 'send_media':\r\n      case 'send_messages':\r\n      case 'send_polls':\r\n      case 'send_stickers': {\r\n        if(!isThread && chat.pFlags.left) {\r\n          return false;\r\n        }\r\n\r\n        if(rights._ === 'chatBannedRights' && myFlags[action]) {\r\n          return false;\r\n        }\r\n\r\n        if(chat._ === 'channel') {\r\n          if(!chat.pFlags.megagroup && !myFlags.post_messages) {\r\n            return false;\r\n          }\r\n        }\r\n\r\n        break;\r\n      }\r\n\r\n      // * revoke foreign messages\r\n      case 'delete_messages': {\r\n        return !!myFlags.delete_messages;\r\n      }\r\n\r\n      case 'pin_messages': {\r\n        return rights._ === 'chatAdminRights' ? myFlags[action] || !!myFlags.post_messages : !myFlags[action];\r\n      }\r\n\r\n      case 'invite_users':\r\n      case 'change_info': {\r\n        return rights._ === 'chatAdminRights' ? myFlags[action] : !myFlags[action];\r\n      }\r\n\r\n      // * only creator can do that\r\n      case 'change_type':\r\n      case 'delete_chat': {\r\n        return false;\r\n      }\r\n\r\n      case 'change_permissions': {\r\n        return rights._ === 'chatAdminRights' && myFlags['ban_users'];\r\n      }\r\n\r\n      case 'view_participants': {\r\n        return !!(chat._ === 'chat' || !chat.pFlags.broadcast || chat.pFlags.creator || chat.admin_rights);\r\n      }\r\n    }\r\n\r\n    return true;\r\n  }\r\n\r\n  public editChatDefaultBannedRights(id: number, banned_rights: ChatBannedRights) {\r\n    const chat: Chat.chat = this.getChat(id);\r\n    if(chat.default_banned_rights) {\r\n      if(chat.default_banned_rights.until_date === banned_rights.until_date && deepEqual(chat.default_banned_rights.pFlags, banned_rights.pFlags)) {\r\n        return Promise.resolve();\r\n      }\r\n    }\r\n    \r\n    return apiManager.invokeApi('messages.editChatDefaultBannedRights', {\r\n      peer: appPeersManager.getInputPeerById(-id),\r\n      banned_rights\r\n    }).then(this.onChatUpdated.bind(this, id));\r\n  }\r\n\r\n  /* public resolveUsername(username: string) {\r\n    return this.usernames[username] || 0;\r\n  } */\r\n\r\n  /* public saveChannelAccess(id: number, accessHash: string) {\r\n    this.channelAccess[id] = accessHash;\r\n  } */\r\n\r\n  /* public saveIsMegagroup(id: number) {\r\n    this.megagroups[id] = true;\r\n  } */\r\n\r\n  public isChannel(id: number) {\r\n    const chat = this.chats[id];\r\n    return chat && (chat._ === 'channel' || chat._ === 'channelForbidden')/*  || this.channelAccess[id] */;\r\n  }\r\n\r\n  public isMegagroup(id: number) {\r\n    /* if(this.megagroups[id]) {\r\n      return true;\r\n    } */\r\n\r\n    const chat = this.chats[id];\r\n    return chat && chat._ === 'channel' && chat.pFlags.megagroup;\r\n  }\r\n\r\n  public isBroadcast(id: number) {\r\n    return this.isChannel(id) && !this.isMegagroup(id);\r\n  }\r\n\r\n  public isInChat(id: number) {\r\n    let good = true;\r\n    const chat: Chat = this.getChat(id);\r\n    if(chat._ === 'channelForbidden' \r\n      || chat._ === 'chatForbidden' \r\n      || chat._ === 'chatEmpty' \r\n      || (chat as Chat.chat).pFlags.left \r\n      || (chat as Chat.chat).pFlags.kicked \r\n      || (chat as Chat.chat).pFlags.deactivated) {\r\n      good = false;\r\n    }\r\n\r\n    return good;\r\n  }\r\n\r\n  public getChannelInput(id: number): InputChannel {\r\n    const chat: Chat = this.getChat(id);\r\n    if(chat._ === 'chatEmpty' || !(chat as Chat.channel).access_hash) {\r\n      return {\r\n        _: 'inputChannelEmpty'\r\n      };\r\n    } else {\r\n      return {\r\n        _: 'inputChannel',\r\n        channel_id: id,\r\n        access_hash: (chat as Chat.channel).access_hash/*  || this.channelAccess[id] */ || '0'\r\n      };\r\n    }\r\n  }\r\n\r\n  public getChatInputPeer(id: number): InputPeer.inputPeerChat {\r\n    return {\r\n      _: 'inputPeerChat',\r\n      chat_id: id\r\n    };\r\n  }\r\n\r\n  public getChannelInputPeer(id: number): InputPeer.inputPeerChannel {\r\n    return {\r\n      _: 'inputPeerChannel',\r\n      channel_id: id,\r\n      access_hash: this.getChat(id).access_hash/*  || this.channelAccess[id] */ || 0\r\n    };\r\n  }\r\n\r\n  public hasChat(id: number, allowMin?: true) {\r\n    const chat = this.chats[id]\r\n    return isObject(chat) && (allowMin || !chat.pFlags.min);\r\n  }\r\n\r\n  public getChatPhoto(id: number) {\r\n    const chat: Chat.chat = this.getChat(id);\r\n\r\n    return chat && chat.photo || {\r\n      _: 'chatPhotoEmpty'\r\n    };\r\n  }\r\n\r\n  public getChatString(id: number) {\r\n    const chat = this.getChat(id);\r\n    if(this.isChannel(id)) {\r\n      return (this.isMegagroup(id) ? 's' : 'c') + id + '_' + chat.access_hash;\r\n    }\r\n    return 'g' + id;\r\n  }\r\n\r\n  /* public wrapForFull(id: number, fullChat: any) {\r\n    const chatFull = copy(fullChat);\r\n    const chat = this.getChat(id);\r\n\r\n    if(!chatFull.participants_count) {\r\n      chatFull.participants_count = chat.participants_count;\r\n    }\r\n\r\n    if(chatFull.participants &&\r\n        chatFull.participants._ === 'chatParticipants') {\r\n      chatFull.participants.participants = this.wrapParticipants(id, chatFull.participants.participants);\r\n    }\r\n\r\n    if(chatFull.about) {\r\n      chatFull.rAbout = RichTextProcessor.wrapRichText(chatFull.about, {noLinebreaks: true});\r\n    }\r\n\r\n    //chatFull.peerString = this.getChatString(id);\r\n    chatFull.chat = chat;\r\n\r\n    return chatFull;\r\n  }\r\n\r\n  public wrapParticipants(id: number, participants: any[]) {\r\n    const chat = this.getChat(id);\r\n    const myId = appUsersManager.getSelf().id;\r\n    if(this.isChannel(id)) {\r\n      const isAdmin = chat.pFlags.creator;\r\n      participants.forEach((participant) => {\r\n        participant.canLeave = myId === participant.user_id;\r\n        participant.canKick = isAdmin && participant._ === 'channelParticipant';\r\n\r\n        // just for order by last seen\r\n        participant.user = appUsersManager.getUser(participant.user_id);\r\n      });\r\n    } else {\r\n      const isAdmin = chat.pFlags.creator || chat.pFlags.admins_enabled && chat.pFlags.admin;\r\n      participants.forEach((participant) => {\r\n        participant.canLeave = myId === participant.user_id;\r\n        participant.canKick = !participant.canLeave && (\r\n          chat.pFlags.creator ||\r\n          participant._ === 'chatParticipant' && (isAdmin || myId === participant.inviter_id)\r\n        );\r\n\r\n        // just for order by last seen\r\n        participant.user = appUsersManager.getUser(participant.user_id);\r\n      });\r\n    }\r\n\r\n    return participants;\r\n  } */\r\n\r\n  public createChannel(title: string, about: string): Promise<number> {\r\n    return apiManager.invokeApi('channels.createChannel', {\r\n      broadcast: true,\r\n      title,\r\n      about\r\n    }).then((updates) => {\r\n      apiUpdatesManager.processUpdateMessage(updates);\r\n\r\n      const channelId = (updates as any).chats[0].id;\r\n      rootScope.dispatchEvent('history_focus', {peerId: -channelId});\r\n\r\n      return channelId;\r\n    });\r\n  }\r\n\r\n  public inviteToChannel(id: number, userIds: number[]) {\r\n    const input = this.getChannelInput(id);\r\n    const usersInputs = userIds.map(u => appUsersManager.getUserInput(u));\r\n\r\n    return apiManager.invokeApi('channels.inviteToChannel', {\r\n      channel: input,\r\n      users: usersInputs\r\n    }).then(updates => {\r\n      apiUpdatesManager.processUpdateMessage(updates);\r\n    });\r\n  }\r\n\r\n  public createChat(title: string, userIds: number[]): Promise<number> {\r\n    return apiManager.invokeApi('messages.createChat', {\r\n      users: userIds.map(u => appUsersManager.getUserInput(u)),\r\n      title\r\n    }).then(updates => {\r\n      apiUpdatesManager.processUpdateMessage(updates);\r\n\r\n      const chatId = (updates as any as Updates.updates).chats[0].id;\r\n      rootScope.dispatchEvent('history_focus', {peerId: -chatId});\r\n\r\n      return chatId;\r\n    });\r\n  }\r\n\r\n  private onChatUpdated = (chatId: number, updates: any) => {\r\n    //console.log('onChatUpdated', chatId, updates);\r\n\r\n    apiUpdatesManager.processUpdateMessage(updates);\r\n    if(updates &&\r\n        /* updates.updates &&\r\n        updates.updates.length && */\r\n        this.isChannel(chatId)) {\r\n      rootScope.dispatchEvent('invalidate_participants', chatId);\r\n    }\r\n  };\r\n\r\n  public leaveChannel(id: number) {\r\n    return apiManager.invokeApi('channels.leaveChannel', {\r\n      channel: this.getChannelInput(id)\r\n    }).then(this.onChatUpdated.bind(this, id));\r\n  }\r\n\r\n  public joinChannel(id: number) {\r\n    return apiManager.invokeApi('channels.joinChannel', {\r\n      channel: this.getChannelInput(id)\r\n    }).then(this.onChatUpdated.bind(this, id));\r\n  }\r\n\r\n  public addChatUser(id: number, userId: number, fwdLimit = 100) {\r\n    return apiManager.invokeApi('messages.addChatUser', {\r\n      chat_id: id,\r\n      user_id: appUsersManager.getUserInput(userId),\r\n      fwd_limit: fwdLimit\r\n    }).then(this.onChatUpdated.bind(this, id));\r\n  }\r\n\r\n  public deleteChatUser(id: number, userId: number) {\r\n    return apiManager.invokeApi('messages.deleteChatUser', {\r\n      chat_id: id,\r\n      user_id: appUsersManager.getUserInput(userId)\r\n    }).then(this.onChatUpdated.bind(this, id));\r\n  }\r\n\r\n  public leaveChat(id: number) {\r\n    return this.deleteChatUser(id, appUsersManager.getSelf().id);\r\n  }\r\n\r\n  public leave(id: number) {\r\n    return this.isChannel(id) ? this.leaveChannel(id) : this.leaveChat(id);\r\n  }\r\n\r\n  public delete(id: number) {\r\n    return this.isChannel(id) ? this.deleteChannel(id) : this.deleteChat(id);\r\n  }\r\n\r\n  public deleteChannel(id: number) {\r\n    return apiManager.invokeApi('channels.deleteChannel', {\r\n      channel: this.getChannelInput(id)\r\n    }).then(this.onChatUpdated.bind(this, id));\r\n  }\r\n\r\n  public deleteChat(id: number) {\r\n    //return this.leaveChat(id).then(() => {\r\n      return apiManager.invokeApi('messages.deleteChat', {\r\n        chat_id: id\r\n      });\r\n    //});\r\n  }\r\n\r\n  public migrateChat(id: number): Promise<number> {\r\n    const chat: Chat = this.getChat(id);\r\n    if(chat._ === 'channel') return Promise.resolve(chat.id);\r\n    return apiManager.invokeApi('messages.migrateChat', {\r\n      chat_id: id\r\n    }).then((updates) => {\r\n      this.onChatUpdated(id, updates);\r\n      const update: Update.updateChannel = (updates as Updates.updates).updates.find(u => u._ === 'updateChannel') as any;\r\n      return update.channel_id;\r\n    });\r\n  }\r\n\r\n  public updateUsername(id: number, username: string) {\r\n    return apiManager.invokeApi('channels.updateUsername', {\r\n      channel: this.getChannelInput(id),\r\n      username\r\n    }).then((bool) => {\r\n      if(bool) {\r\n        const chat: Chat.channel = this.getChat(id);\r\n        chat.username = username;\r\n      }\r\n\r\n      return bool;\r\n    });\r\n  }\r\n\r\n  public editPhoto(id: number, inputFile: InputFile) {\r\n    const inputChatPhoto: InputChatPhoto = {\r\n      _: 'inputChatUploadedPhoto',\r\n      file: inputFile\r\n    };\r\n\r\n    let promise: any;\r\n    if(this.isChannel(id)) {\r\n      promise = apiManager.invokeApi('channels.editPhoto', {\r\n        channel: this.getChannelInput(id),\r\n        photo: inputChatPhoto\r\n      });\r\n    } else {\r\n      promise = apiManager.invokeApi('messages.editChatPhoto', {\r\n        chat_id: id,\r\n        photo: inputChatPhoto\r\n      });\r\n    }\r\n\r\n    return promise.then((updates: any) => {\r\n      apiUpdatesManager.processUpdateMessage(updates);\r\n    });\r\n  }\r\n\r\n  public editTitle(id: number, title: string) {\r\n    let promise: any;\r\n\r\n    if(this.isChannel(id)) {\r\n      promise = apiManager.invokeApi('channels.editTitle', {\r\n        channel: this.getChannelInput(id),\r\n        title\r\n      });\r\n    } else {\r\n      promise = apiManager.invokeApi('messages.editChatTitle', {\r\n        chat_id: id,\r\n        title\r\n      });\r\n    }\r\n\r\n    return promise.then((updates: any) => {\r\n      apiUpdatesManager.processUpdateMessage(updates);\r\n    });\r\n  }\r\n\r\n  public editAbout(id: number, about: string) {\r\n    return apiManager.invokeApi('messages.editChatAbout', {\r\n      peer: appPeersManager.getInputPeerById(-id),\r\n      about\r\n    }).then(bool => {\r\n      //apiUpdatesManager.processUpdateMessage(updates);\r\n      rootScope.dispatchEvent('peer_bio_edit', -id);\r\n    });\r\n  }\r\n\r\n  public getParticipantPeerId(participant: ChannelParticipant | ChatParticipant) {\r\n    const peerId = (participant as ChannelParticipant.channelParticipantBanned).peer ? \r\n      appPeersManager.getPeerId((participant as ChannelParticipant.channelParticipantBanned).peer) : \r\n      (participant as ChatParticipant.chatParticipant).user_id;\r\n    return peerId;\r\n  }\r\n\r\n  public editBanned(id: number, participant: number | ChannelParticipant, banned_rights: ChatBannedRights) {\r\n    const peerId = typeof(participant) === 'number' ? participant : this.getParticipantPeerId(participant);\r\n    return apiManager.invokeApi('channels.editBanned', {\r\n      channel: this.getChannelInput(id),\r\n      participant: appPeersManager.getInputPeerById(peerId),\r\n      banned_rights\r\n    }).then((updates) => {\r\n      this.onChatUpdated(id, updates);\r\n\r\n      if(typeof(participant) !== 'number') {\r\n        const timestamp = Date.now() / 1000 | 0;\r\n        apiUpdatesManager.processLocalUpdate({\r\n          _: 'updateChannelParticipant',\r\n          channel_id: id,\r\n          date: timestamp,\r\n          actor_id: undefined,\r\n          qts: undefined,\r\n          user_id: peerId,\r\n          prev_participant: participant,\r\n          new_participant: Object.keys(banned_rights.pFlags).length ? {\r\n            _: 'channelParticipantBanned',\r\n            date: timestamp,\r\n            banned_rights,\r\n            kicked_by: appUsersManager.getSelf().id,\r\n            peer: appPeersManager.getOutputPeer(peerId),\r\n            pFlags: {}\r\n          } : undefined\r\n        });\r\n      }\r\n    });\r\n  }\r\n\r\n  public clearChannelParticipantBannedRights(id: number, participant: number | ChannelParticipant) {\r\n    return this.editBanned(id, participant, {\r\n      _: 'chatBannedRights',\r\n      until_date: 0,\r\n      pFlags: {}\r\n    });\r\n  }\r\n  \r\n  public kickFromChannel(id: number, participant: number | ChannelParticipant) {\r\n    return this.editBanned(id, participant, {\r\n      _: 'chatBannedRights',\r\n      until_date: 0,\r\n      pFlags: {\r\n        view_messages: true\r\n      }\r\n    });\r\n  }\r\n}\r\n\r\nconst appChatsManager = new AppChatsManager();\r\nMOUNT_CLASS_TO.appChatsManager = appChatsManager;\r\nexport default appChatsManager;\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n * \r\n * Originally from:\r\n * https://github.com/zhukov/webogram\r\n * Copyright (C) 2014 Igor Zhukov <igor.beatle@gmail.com>\r\n * https://github.com/zhukov/webogram/blob/master/LICENSE\r\n */\r\n\r\nimport type { ChatPhoto, DialogPeer, InputDialogPeer, InputNotifyPeer, InputPeer, Peer, Update, UserProfilePhoto } from \"../../layer\";\r\nimport type { LangPackKey } from \"../langPack\";\r\nimport { MOUNT_CLASS_TO } from \"../../config/debug\";\r\nimport { isObject } from \"../../helpers/object\";\r\nimport { RichTextProcessor } from \"../richtextprocessor\";\r\nimport rootScope from \"../rootScope\";\r\nimport appChatsManager from \"./appChatsManager\";\r\nimport appUsersManager from \"./appUsersManager\";\r\nimport I18n from '../langPack';\r\n\r\n// https://github.com/eelcohn/Telegram-API/wiki/Calculating-color-for-a-Telegram-user-on-IRC\r\n/*\r\n  HTML-color  IRC-color  Description\r\n  #c03d33     4          red\r\n  #4fad2d     3          green\r\n  #d09306     7          yellow\r\n  #168acd     10         blue\r\n  #8544d6     6          purple\r\n  #cd4073     13         pink\r\n  #2996ad     11         sea\r\n  #ce671b     5          orange\r\n  */\r\nconst DialogColorsFg = ['#fc5c51', '#0fb297', '#d09306', '#3d72ed', '#895dd5', '#cd4073', '#00c1a6', '#fa790f'];\r\nconst DialogColors = ['red', 'green', 'yellow', 'blue', 'violet', 'pink', 'cyan', 'orange'];\r\nconst DialogColorsMap = [0, 7, 4, 1, 6, 3, 5];\r\n\r\nexport type PeerType = 'channel' | 'chat' | 'megagroup' | 'group' | 'saved';\r\nexport class AppPeersManager {\r\n  constructor() {\r\n    rootScope.addMultipleEventsListeners({\r\n      updatePeerBlocked: (update) => {\r\n        rootScope.dispatchEvent('peer_block', {peerId: this.getPeerId(update.peer_id), blocked: update.blocked});\r\n      }\r\n    });\r\n  }\r\n  /* public savePeerInstance(peerId: number, instance: any) {\r\n    if(peerId < 0) appChatsManager.saveApiChat(instance);\r\n    else appUsersManager.saveApiUser(instance);\r\n  } */\r\n\r\n  public canPinMessage(peerId: number) {\r\n    return peerId > 0 || appChatsManager.hasRights(-peerId, 'pin_messages');\r\n  }\r\n\r\n  public getPeerPhoto(peerId: number): UserProfilePhoto.userProfilePhoto | ChatPhoto.chatPhoto {\r\n    const photo = peerId > 0\r\n      ? appUsersManager.getUserPhoto(peerId)\r\n      : appChatsManager.getChatPhoto(-peerId);\r\n\r\n    return photo._ !== 'chatPhotoEmpty' && photo._ !== 'userProfilePhotoEmpty' ? photo : null;\r\n  }\r\n\r\n  public getPeerMigratedTo(peerId: number) {\r\n    if(peerId >= 0) {\r\n      return false;\r\n    }\r\n\r\n    let chat = appChatsManager.getChat(-peerId);\r\n    if(chat && chat.migrated_to && chat.pFlags.deactivated) {\r\n      return this.getPeerId(chat.migrated_to);\r\n    }\r\n    \r\n    return false;\r\n  }\r\n\r\n  public getPeerTitle(peerId: number | any, plainText = false, onlyFirstName = false) {\r\n    if(!peerId) {\r\n      peerId = rootScope.myId;\r\n    }\r\n    \r\n    let peer: any = {}; \r\n    if(!isObject(peerId)) {\r\n      peer = this.getPeer(peerId);\r\n    } else peer = peerId;\r\n\r\n    let title = '';\r\n    if(peerId > 0) {\r\n      if(peer.first_name) title += peer.first_name;\r\n      if(peer.last_name) title += ' ' + peer.last_name;\r\n  \r\n      if(!title) title = peer.pFlags.deleted ? I18n.format('HiddenName', true) : peer.username;\r\n      else title = title.trim();\r\n    } else {\r\n      title = peer.title;\r\n    }\r\n\r\n    if(onlyFirstName) {\r\n      title = title.split(' ')[0];\r\n    }\r\n    \r\n    return plainText ? title : RichTextProcessor.wrapEmojiText(title);\r\n  }\r\n  \r\n  public getOutputPeer(peerId: number): Peer {\r\n    if(peerId > 0) {\r\n      return {_: 'peerUser', user_id: peerId};\r\n    }\r\n\r\n    let chatId = -peerId;\r\n    if(appChatsManager.isChannel(chatId)) {\r\n      return {_: 'peerChannel', channel_id: chatId};\r\n    }\r\n\r\n    return {_: 'peerChat', chat_id: chatId};\r\n  }\r\n\r\n  public getPeerString(peerId: number) {\r\n    if(peerId > 0) {\r\n      return appUsersManager.getUserString(peerId);\r\n    }\r\n    return appChatsManager.getChatString(-peerId);\r\n  }\r\n\r\n  public getPeerUsername(peerId: number): string {\r\n    if(peerId > 0) {\r\n      return appUsersManager.getUser(peerId).username || '';\r\n    }\r\n    return appChatsManager.getChat(-peerId).username || '';\r\n  }\r\n\r\n  public getPeer(peerId: number) {\r\n    return peerId > 0\r\n      ? appUsersManager.getUser(peerId)\r\n      : appChatsManager.getChat(-peerId)\r\n  }\r\n\r\n  public getPeerId(peerId: Peer | InputPeer | number | string): number {\r\n    if(typeof(peerId) === 'number') return peerId;\r\n    else if(isObject(peerId)) return (peerId as Peer.peerUser).user_id || -((peerId as Peer.peerChannel).channel_id || (peerId as Peer.peerChat).chat_id);\r\n    else if(!peerId) return 0;\r\n    \r\n    const isUser = (peerId as string).charAt(0) === 'u';\r\n    const peerParams = (peerId as string).substr(1).split('_');\r\n\r\n    return isUser ? +peerParams[0] : -peerParams[0] || 0;\r\n  }\r\n\r\n  public getDialogPeer(peerId: number): DialogPeer {\r\n    return {\r\n      _: 'dialogPeer',\r\n      peer: this.getOutputPeer(peerId)\r\n    };\r\n  }\r\n\r\n  public isChannel(peerId: number): boolean {\r\n    return (peerId < 0) && appChatsManager.isChannel(-peerId);\r\n  }\r\n\r\n  public isMegagroup(peerId: number) {\r\n    return (peerId < 0) && appChatsManager.isMegagroup(-peerId);\r\n  }\r\n\r\n  public isAnyGroup(peerId: number): boolean {\r\n    return (peerId < 0) && !appChatsManager.isBroadcast(-peerId);\r\n  }\r\n\r\n  public isBroadcast(peerId: number): boolean {\r\n    return this.isChannel(peerId) && !this.isMegagroup(peerId);\r\n  }\r\n\r\n  public isBot(peerId: number): boolean {\r\n    return (peerId > 0) && appUsersManager.isBot(peerId);\r\n  }\r\n\r\n  /* public getInputPeer(peerString: string): InputPeer {\r\n    var firstChar = peerString.charAt(0);\r\n    var peerParams = peerString.substr(1).split('_');\r\n    let id = +peerParams[0];\r\n\r\n    if(firstChar === 'u') {\r\n      //appUsersManager.saveUserAccess(id, peerParams[1]);\r\n\r\n      return {\r\n        _: 'inputPeerUser',\r\n        user_id: id,\r\n        access_hash: peerParams[1]\r\n      };\r\n    } else if(firstChar === 'c' || firstChar === 's') {\r\n      //appChatsManager.saveChannelAccess(id, peerParams[1]);\r\n      if(firstChar === 's') {\r\n        appChatsManager.saveIsMegagroup(id);\r\n      }\r\n\r\n      return {\r\n        _: 'inputPeerChannel',\r\n        channel_id: id,\r\n        access_hash: peerParams[1] || '0'\r\n      };\r\n    } else {\r\n      return {\r\n        _: 'inputPeerChat',\r\n        chat_id: id\r\n      };\r\n    }\r\n  } */\r\n\r\n  public getInputNotifyPeerById(peerId: number, ignorePeerId: true): Exclude<InputNotifyPeer, InputNotifyPeer.inputNotifyPeer>;\r\n  public getInputNotifyPeerById(peerId: number, ignorePeerId?: false): InputNotifyPeer.inputNotifyPeer;\r\n  public getInputNotifyPeerById(peerId: number, ignorePeerId?: boolean): InputNotifyPeer {\r\n    if(ignorePeerId) {\r\n      if(peerId > 0) {\r\n        return {_: 'inputNotifyUsers'};\r\n      } else {\r\n        if(appPeersManager.isBroadcast(peerId)) {\r\n          return {_: 'inputNotifyBroadcasts'};\r\n        } else {\r\n          return {_: 'inputNotifyChats'};\r\n        }\r\n      }\r\n    } else {\r\n      return {\r\n        _: 'inputNotifyPeer', \r\n        peer: this.getInputPeerById(peerId)\r\n      };\r\n    }\r\n  }\r\n\r\n  public getInputPeerById(peerId: number): InputPeer {\r\n    if(!peerId) {\r\n      return {_: 'inputPeerEmpty'};\r\n    }\r\n\r\n    if(peerId < 0) {\r\n      const chatId = -peerId;\r\n      if(!appChatsManager.isChannel(chatId)) {\r\n        return appChatsManager.getChatInputPeer(chatId);\r\n      } else {\r\n        return appChatsManager.getChannelInputPeer(chatId);\r\n      }\r\n    }\r\n\r\n    return {\r\n      _: 'inputPeerUser',\r\n      user_id: peerId,\r\n      access_hash: appUsersManager.getUser(peerId).access_hash\r\n    };\r\n  }\r\n\r\n  public getInputDialogPeerById(peerId: number): InputDialogPeer {\r\n    return {\r\n      _: 'inputDialogPeer',\r\n      peer: this.getInputPeerById(peerId)\r\n    }\r\n  }\r\n\r\n  public getPeerColorById(peerId: number, pic = true) {\r\n    if(!peerId) return '';\r\n\r\n    const idx = DialogColorsMap[(peerId < 0 ? -peerId : peerId) % 7];\r\n    const color = (pic ? DialogColors : DialogColorsFg)[idx];\r\n    return color;\r\n  }\r\n\r\n  public getPeerSearchText(peerId: number) {\r\n    let text;\r\n    if(peerId > 0) {\r\n      text = '%pu ' + appUsersManager.getUserSearchText(peerId);\r\n    } else if(peerId < 0) {\r\n      const chat = appChatsManager.getChat(-peerId);\r\n      text = '%pg ' + (chat.title || '');\r\n    }\r\n    return text;\r\n  }\r\n\r\n  public getDialogType(peerId: number): PeerType {\r\n    if(appPeersManager.isMegagroup(peerId)) {\r\n      return 'megagroup';\r\n    } else if(appPeersManager.isChannel(peerId)) {\r\n      return 'channel';\r\n    } else if(peerId < 0) {\r\n      return 'group';\r\n    } else {\r\n      return peerId === rootScope.myId ? 'saved' : 'chat';\r\n    }\r\n  }\r\n\r\n  public getDeleteButtonText(peerId: number): LangPackKey {\r\n    switch(this.getDialogType(peerId)) {\r\n      case 'channel':\r\n        return 'ChatList.Context.LeaveChannel';\r\n\r\n      case 'megagroup':\r\n        return 'ChatList.Context.LeaveGroup';\r\n\r\n      case 'group':\r\n        return 'ChatList.Context.DeleteAndExit';\r\n      \r\n      default:\r\n        return 'ChatList.Context.DeleteChat';\r\n    }\r\n  }\r\n}\r\n\r\nconst appPeersManager = new AppPeersManager();\r\nMOUNT_CLASS_TO.appPeersManager = appPeersManager;\r\nexport default appPeersManager;\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport { MOUNT_CLASS_TO } from \"../config/debug\";\r\nimport { isMobileSafari } from \"../helpers/userAgent\";\r\nimport { logger } from \"../lib/logger\";\r\nimport { doubleRaf } from \"../helpers/schedulers\";\r\nimport blurActiveElement from \"../helpers/dom/blurActiveElement\";\r\nimport { cancelEvent } from \"../helpers/dom/cancelEvent\";\r\n\r\nexport type NavigationItem = {\r\n  type: 'left' | 'right' | 'im' | 'chat' | 'popup' | 'media' | 'menu' | \r\n    'esg' | 'multiselect' | 'input-helper' | 'autocomplete-helper' | 'markup' | 'global-search',\r\n  onPop: (canAnimate: boolean) => boolean | void,\r\n  onEscape?: () => boolean,\r\n  noHistory?: boolean,\r\n  noBlurOnPop?: boolean,\r\n};\r\n\r\nexport class AppNavigationController {\r\n  private navigations: Array<NavigationItem> = [];\r\n  private id = Date.now();\r\n  private manual = false;\r\n  private log = logger('NC');\r\n  private debug = true;\r\n  private currentHash = window.location.hash;\r\n  public onHashChange: () => void;\r\n\r\n  constructor() {\r\n    let isPossibleSwipe = false;\r\n    window.addEventListener('popstate', (e) => {\r\n      this.debug && this.log('popstate', e, isPossibleSwipe);\r\n\r\n      if(window.location.hash !== this.currentHash) {\r\n        this.onHashChange && this.onHashChange();\r\n        this.replaceState();\r\n        return;\r\n      }\r\n      this.currentHash = window.location.hash;\r\n\r\n      const id: number = e.state;\r\n      if(id !== this.id/*  && !this.navigations.length */) {\r\n        this.pushState();\r\n        return;\r\n      }\r\n\r\n      const item = this.navigations.pop();\r\n      if(!item) {\r\n        this.pushState();\r\n        return;\r\n      }\r\n\r\n      this.manual = !isPossibleSwipe;\r\n      this.handleItem(item);\r\n      //this.pushState(); // * prevent adding forward arrow\r\n    });\r\n\r\n    window.addEventListener('keydown', (e) => {\r\n      const item = this.navigations[this.navigations.length - 1];\r\n      if(!item) return;\r\n      if(e.key === 'Escape' && (item.onEscape ? item.onEscape() : true)) {\r\n        cancelEvent(e);\r\n        this.back(item.type);\r\n      }\r\n    }, {capture: true, passive: false});\r\n\r\n    if(isMobileSafari) {\r\n      const options = {passive: true};\r\n      window.addEventListener('touchstart', (e) => {\r\n        if(e.touches.length > 1) return;\r\n        this.debug && this.log('touchstart');\r\n\r\n        const detach = () => {\r\n          window.removeEventListener('touchend', onTouchEnd);\r\n          window.removeEventListener('touchmove', onTouchMove);\r\n        };\r\n\r\n        let moved = false;\r\n        const onTouchMove = (e: TouchEvent) => {\r\n          this.debug && this.log('touchmove');\r\n          if(e.touches.length > 1) {\r\n            detach();\r\n            return;\r\n          }\r\n\r\n          moved = true;\r\n        };\r\n\r\n        const onTouchEnd = (e: TouchEvent) => {\r\n          this.debug && this.log('touchend');\r\n          if(e.touches.length > 1 || !moved) {\r\n            detach();\r\n            return;\r\n          }\r\n\r\n          isPossibleSwipe = true;\r\n          doubleRaf().then(() => {\r\n            isPossibleSwipe = false;\r\n          });\r\n\r\n          detach();\r\n        };\r\n\r\n        window.addEventListener('touchend', onTouchEnd, options);\r\n        window.addEventListener('touchmove', onTouchMove, options);\r\n      }, options);\r\n    }\r\n\r\n    history.scrollRestoration = 'manual';\r\n\r\n    this.pushState(); // * push init state\r\n  }\r\n\r\n  private handleItem(item: NavigationItem) {\r\n    const good = item.onPop(!this.manual ? false : undefined);\r\n    this.debug && this.log('popstate, navigation:', item, this.navigations);\r\n    if(good === false) {\r\n      this.pushItem(item);\r\n    } else if(!item.noBlurOnPop) {\r\n      blurActiveElement(); // no better place for it\r\n    }\r\n\r\n    this.manual = false;\r\n  }\r\n\r\n  public findItemByType(type: NavigationItem['type']) {\r\n    for(let i = this.navigations.length - 1; i >= 0; --i) {\r\n      const item = this.navigations[i];\r\n      if(item.type === type) {\r\n        return {item, index: i};\r\n      }\r\n    }\r\n  }\r\n\r\n  public back(type?: NavigationItem['type']) {\r\n    if(type) {\r\n      const ret = this.findItemByType(type);\r\n      if(ret) {\r\n        this.manual = true;\r\n        // ! commented because 'popstate' event will be fired with delay\r\n        //if(ret.index !== (this.navigations.length - 1)) {\r\n          this.navigations.splice(ret.index, 1);\r\n          this.handleItem(ret.item);\r\n          return;\r\n        //}\r\n      }\r\n    }\r\n\r\n    history.back();\r\n  }\r\n\r\n  public pushItem(item: NavigationItem) {\r\n    this.navigations.push(item);\r\n    this.debug && this.log('pushstate', item, this.navigations);\r\n\r\n    if(!item.noHistory) {\r\n      this.pushState();\r\n    }\r\n  }\r\n\r\n  private pushState() {\r\n    this.manual = false;\r\n    history.pushState(this.id, '');\r\n  }\r\n\r\n  public replaceState() {\r\n    history.replaceState(this.id, '', location.origin + location.pathname);\r\n  }\r\n\r\n  public removeItem(item: NavigationItem) {\r\n    this.navigations.findAndSplice(i => i === item);\r\n  }\r\n\r\n  public removeByType(type: NavigationItem['type'], single = false) {\r\n    for(let i = this.navigations.length - 1; i >= 0; --i) {\r\n      const item = this.navigations[i];\r\n      if(item.type === type) {\r\n        this.navigations.splice(i, 1);\r\n\r\n        if(single) {\r\n          break;\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\nconst appNavigationController = new AppNavigationController();\r\nMOUNT_CLASS_TO.appNavigationController = appNavigationController;\r\nexport default appNavigationController;\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nexport default function toggleDisability(elements: HTMLElement[], disable: boolean) {\r\n  if(disable) {\r\n    elements.forEach(el => el.setAttribute('disabled', 'true'));\r\n  } else {\r\n    elements.forEach(el => el.removeAttribute('disabled'));\r\n  }\r\n\r\n  return () => toggleDisability(elements, !disable);\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n * \r\n * Originally from:\r\n * https://github.com/zhukov/webogram\r\n * Copyright (C) 2014 Igor Zhukov <igor.beatle@gmail.com>\r\n * https://github.com/zhukov/webogram/blob/master/LICENSE\r\n */\r\n\r\nimport type { ApplyServerTimeOffsetTask } from './timeManager';\r\nimport { MOUNT_CLASS_TO } from '../../config/debug';\r\n// import { tsNow } from '../../helpers/date';\r\nimport sessionStorage from '../sessionStorage';\r\nimport apiManager from './mtprotoworker';\r\n\r\nexport class ServerTimeManager {\r\n  /* private midnightNoOffset: number;\r\n  private midnightOffseted: Date;\r\n\r\n  private midnightOffset: number; */\r\n\r\n  public serverTimeOffset: number; // in seconds\r\n  /* private timeParams: {\r\n    midnightOffset: number,\r\n    serverTimeOffset: number\r\n  }; */\r\n\r\n  constructor() {\r\n    /* const timestampNow = tsNow(true);\r\n    this.midnightNoOffset = timestampNow - (timestampNow % 86400);\r\n    this.midnightOffseted = new Date();\r\n    this.midnightOffseted.setHours(0, 0, 0, 0);\r\n    \r\n    this.midnightOffset = this.midnightNoOffset - (Math.floor(+this.midnightOffseted / 1000)); */\r\n\r\n    this.serverTimeOffset = 0;\r\n    /* this.timeParams = {\r\n      midnightOffset: this.midnightOffset,\r\n      serverTimeOffset: this.serverTimeOffset\r\n    }; */\r\n\r\n    sessionStorage.get('server_time_offset').then((to) => {\r\n      if(to) {\r\n        this.serverTimeOffset = to;\r\n        // this.timeParams.serverTimeOffset = to;\r\n      }\r\n    });\r\n\r\n    apiManager.addTaskListener('applyServerTimeOffset', (task: ApplyServerTimeOffsetTask) => {\r\n      this.serverTimeOffset = task.payload;\r\n    });\r\n  }\r\n}\r\n\r\nconst serverTimeManager = new ServerTimeManager();\r\nMOUNT_CLASS_TO && (MOUNT_CLASS_TO.serverTimeManager = serverTimeManager);\r\nexport default serverTimeManager;\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n * \r\n * Originally from:\r\n * https://github.com/zhukov/webogram\r\n * Copyright (C) 2014 Igor Zhukov <igor.beatle@gmail.com>\r\n * https://github.com/zhukov/webogram/blob/master/LICENSE\r\n */\r\n\r\n//import apiManager from '../mtproto/apiManager';\r\nimport DEBUG, { MOUNT_CLASS_TO } from '../../config/debug';\r\nimport { Update, Updates } from '../../layer';\r\nimport { logger, LogTypes } from '../logger';\r\nimport apiManager from '../mtproto/mtprotoworker';\r\nimport rootScope from '../rootScope';\r\n//import networkerFactory from '../mtproto/networkerFactory';\r\nimport appUsersManager from \"./appUsersManager\";\r\nimport appChatsManager from \"./appChatsManager\";\r\nimport appPeersManager from \"./appPeersManager\";\r\nimport appStateManager from './appStateManager';\r\nimport serverTimeManager from '../mtproto/serverTimeManager';\r\n\r\ntype UpdatesState = {\r\n  pendingPtsUpdates: {pts: number, pts_count: number}[],\r\n  pendingSeqUpdates?: {[seq: number]: {seq: number, date: number, updates: any[]}},\r\n  syncPending: {\r\n    seqAwaiting?: number,\r\n    ptsAwaiting?: true,\r\n    timeout: number\r\n  },\r\n  syncLoading: Promise<void>,\r\n\r\n  seq?: number,\r\n  pts?: number,\r\n  date?: number,\r\n  lastPtsUpdateTime?: number\r\n};\r\n\r\nconst SYNC_DELAY = 6;\r\n\r\nexport class ApiUpdatesManager {\r\n  public updatesState: UpdatesState = {\r\n    pendingPtsUpdates: [],\r\n    pendingSeqUpdates: {},\r\n    syncPending: null,\r\n    syncLoading: null\r\n  };\r\n\r\n  private channelStates: {[channelId: number]: UpdatesState} = {};\r\n  private attached = false;\r\n\r\n  private log = logger('UPDATES', LogTypes.Error | LogTypes.Warn | LogTypes.Log/*  | LogTypes.Debug */);\r\n  private debug = DEBUG;\r\n\r\n  private setProxy() {\r\n    const self = this;\r\n    this.updatesState = new Proxy(this.updatesState, {\r\n      set: function(target: ApiUpdatesManager['updatesState'], key: keyof ApiUpdatesManager['updatesState'], value: ApiUpdatesManager['updatesState'][typeof key]) {\r\n        // @ts-ignore\r\n        target[key] = value;\r\n        self.saveUpdatesState();\r\n        return true;\r\n      }\r\n    });\r\n  }\r\n\r\n  public saveUpdatesState() {\r\n    const us = this.updatesState;\r\n    appStateManager.pushToState('updates', {\r\n      seq: us.seq,\r\n      pts: us.pts,\r\n      date: us.date\r\n    });\r\n  }\r\n\r\n  private popPendingSeqUpdate() {\r\n    const state = this.updatesState;\r\n    const nextSeq = state.seq + 1;\r\n    const pendingUpdatesData = state.pendingSeqUpdates[nextSeq];\r\n    if(!pendingUpdatesData) {\r\n      return false;\r\n    }\r\n\r\n    const updates = pendingUpdatesData.updates;\r\n    for(let i = 0, length = updates.length; i < length; ++i) {\r\n      this.saveUpdate(updates[i]);\r\n    }\r\n\r\n    state.seq = pendingUpdatesData.seq;\r\n    if(pendingUpdatesData.date && state.date < pendingUpdatesData.date) {\r\n      state.date = pendingUpdatesData.date;\r\n    }\r\n    delete state.pendingSeqUpdates[nextSeq];\r\n  \r\n    if(!this.popPendingSeqUpdate() &&\r\n      state.syncPending &&\r\n      state.syncPending.seqAwaiting &&\r\n      state.seq >= state.syncPending.seqAwaiting) {\r\n      if(!state.syncPending.ptsAwaiting) {\r\n        clearTimeout(state.syncPending.timeout);\r\n        state.syncPending = null;\r\n      } else {\r\n        delete state.syncPending.seqAwaiting;\r\n      }\r\n    }\r\n  \r\n    return true;\r\n  }\r\n\r\n  private popPendingPtsUpdate(channelId: number) {\r\n    const curState = channelId ? this.getChannelState(channelId) : this.updatesState;\r\n    if(!curState.pendingPtsUpdates.length) {\r\n      return false;\r\n    }\r\n\r\n    curState.pendingPtsUpdates.sort((a, b) => {\r\n      return a.pts - b.pts;\r\n    });\r\n    // this.log('pop update', channelId, curState.pendingPtsUpdates)\r\n  \r\n    let curPts = curState.pts;\r\n    let goodPts = 0;\r\n    let goodIndex = 0;\r\n    for(let i = 0, length = curState.pendingPtsUpdates.length; i < length; ++i) {\r\n      const update = curState.pendingPtsUpdates[i];\r\n      curPts += update.pts_count;\r\n      if(curPts >= update.pts) {\r\n        goodPts = update.pts;\r\n        goodIndex = i;\r\n      }\r\n    }\r\n  \r\n    if(!goodPts) {\r\n      return false;\r\n    }\r\n  \r\n    this.debug && this.log.debug('pop pending pts updates', goodPts, curState.pendingPtsUpdates.slice(0, goodIndex + 1));\r\n  \r\n    curState.pts = goodPts;\r\n    for(let i = 0; i <= goodIndex; ++i) {\r\n      const update = curState.pendingPtsUpdates[i];\r\n\r\n      // @ts-ignore\r\n      this.saveUpdate(update);\r\n    }\r\n    curState.pendingPtsUpdates.splice(0, goodIndex + 1);\r\n  \r\n    if(!curState.pendingPtsUpdates.length && curState.syncPending) {\r\n      if(!curState.syncPending.seqAwaiting) {\r\n        clearTimeout(curState.syncPending.timeout);\r\n        curState.syncPending = null;\r\n      } else {\r\n        delete curState.syncPending.ptsAwaiting;\r\n      }\r\n    }\r\n  \r\n    return true;\r\n  }\r\n\r\n  public forceGetDifference() {\r\n    if(!this.updatesState.syncLoading) {\r\n      this.getDifference();\r\n    }\r\n  }\r\n\r\n  public processLocalUpdate(update: Update) {\r\n    this.processUpdateMessage({\r\n      _: 'updateShort',\r\n      update\r\n    } as Updates);\r\n  }\r\n\r\n  public processUpdateMessage = (updateMessage: any, options: Partial<{\r\n    override: boolean\r\n  }> = {}) => {\r\n    // return forceGetDifference()\r\n    const processOpts = {\r\n      date: updateMessage.date,\r\n      seq: updateMessage.seq,\r\n      seqStart: updateMessage.seq_start,\r\n      //ignoreSyncLoading: options.ignoreSyncLoading\r\n    };\r\n\r\n    this.debug && this.log.debug('processUpdateMessage', updateMessage);\r\n  \r\n    switch(updateMessage._) {\r\n      case 'updatesTooLong':\r\n      case 'new_session_created':\r\n        this.forceGetDifference();\r\n        break;\r\n  \r\n      case 'updateShort':\r\n        this.processUpdate(updateMessage.update, processOpts);\r\n        break;\r\n  \r\n      case 'updateShortMessage':\r\n      case 'updateShortChatMessage': {\r\n        this.debug && this.log.debug('updateShortMessage | updateShortChatMessage', {...updateMessage});\r\n        const isOut = updateMessage.pFlags.out;\r\n        const fromId = updateMessage.from_id || (isOut ? rootScope.myId : updateMessage.user_id);\r\n        const toId = updateMessage.chat_id\r\n          ? -updateMessage.chat_id\r\n          : (updateMessage.user_id || rootScope.myId);\r\n  \r\n        this.processUpdate({\r\n          _: 'updateNewMessage',\r\n          message: {\r\n            _: 'message',\r\n            pFlags: updateMessage.pFlags,\r\n            id: updateMessage.id,\r\n            from_id: appPeersManager.getOutputPeer(fromId),\r\n            peer_id: appPeersManager.getOutputPeer(toId),\r\n            date: updateMessage.date,\r\n            message: updateMessage.message,\r\n            fwd_from: updateMessage.fwd_from,\r\n            reply_to: updateMessage.reply_to,\r\n            entities: updateMessage.entities\r\n          },\r\n          pts: updateMessage.pts,\r\n          pts_count: updateMessage.pts_count\r\n        }, processOpts);\r\n        break;\r\n      }\r\n  \r\n      case 'updatesCombined':\r\n      case 'updates':\r\n        appUsersManager.saveApiUsers(updateMessage.users, options.override);\r\n        appChatsManager.saveApiChats(updateMessage.chats, options.override);\r\n  \r\n        updateMessage.updates.forEach((update: any) => {\r\n          this.processUpdate(update, processOpts);\r\n        });\r\n        break;\r\n  \r\n      default:\r\n        this.log.warn('Unknown update message', updateMessage);\r\n    }\r\n  };\r\n  \r\n  private getDifference(first = false): Promise<void> {\r\n    // this.trace('Get full diff')\r\n    const updatesState = this.updatesState;\r\n    let wasSyncing = updatesState.syncLoading;\r\n    if(!wasSyncing) {\r\n      updatesState.pendingSeqUpdates = {};\r\n      updatesState.pendingPtsUpdates = [];\r\n    }\r\n  \r\n    if(updatesState.syncPending) {\r\n      clearTimeout(updatesState.syncPending.timeout);\r\n      updatesState.syncPending = null;\r\n    }\r\n\r\n    const promise = apiManager.invokeApi('updates.getDifference', {\r\n      pts: updatesState.pts, \r\n      pts_total_limit: first /* && false  */? /* 50 */1200 : undefined,\r\n      date: updatesState.date, \r\n      qts: -1\r\n    }, {\r\n      timeout: 0x7fffffff\r\n    }).then((differenceResult) => {\r\n      this.debug && this.log.debug('Get diff result', differenceResult);\r\n\r\n      if(differenceResult._ === 'updates.differenceEmpty') {\r\n        this.debug && this.log.debug('apply empty diff', differenceResult.seq);\r\n        updatesState.date = differenceResult.date;\r\n        updatesState.seq = differenceResult.seq;\r\n        return;\r\n      }\r\n\r\n      // ! SORRY I'M SORRY I'M SORRY\r\n      if(first) {\r\n        rootScope.dispatchEvent('state_synchronizing');\r\n      }\r\n\r\n      if(differenceResult._ !== 'updates.differenceTooLong') {\r\n        appUsersManager.saveApiUsers(differenceResult.users);\r\n        appChatsManager.saveApiChats(differenceResult.chats);\r\n\r\n        // Should be first because of updateMessageID\r\n        // this.log('applying', differenceResult.other_updates.length, 'other updates')\r\n    \r\n        differenceResult.other_updates.forEach((update) => {\r\n          switch(update._) {\r\n            case 'updateChannelTooLong':\r\n            case 'updateNewChannelMessage':\r\n            case 'updateEditChannelMessage':\r\n              this.processUpdate(update);\r\n              return;\r\n          }\r\n          \r\n          this.saveUpdate(update);\r\n        });\r\n\r\n        // this.log('applying', differenceResult.new_messages.length, 'new messages')\r\n        differenceResult.new_messages.forEach((apiMessage) => {\r\n          this.saveUpdate({\r\n            _: 'updateNewMessage',\r\n            message: apiMessage,\r\n            pts: updatesState.pts,\r\n            pts_count: 0\r\n          });\r\n        });\r\n\r\n        const nextState = differenceResult._ === 'updates.difference' ? differenceResult.state : differenceResult.intermediate_state;\r\n        updatesState.seq = nextState.seq;\r\n        updatesState.pts = nextState.pts;\r\n        updatesState.date = nextState.date;\r\n      } else {\r\n        updatesState.pts = differenceResult.pts;\r\n        updatesState.date = (Date.now() / 1000 | 0) + serverTimeManager.serverTimeOffset;\r\n        delete updatesState.seq;\r\n        \r\n        this.channelStates = {};\r\n        \r\n        this.log.warn('getDifference:', differenceResult._);\r\n        rootScope.dispatchEvent('state_cleared');\r\n      }\r\n  \r\n      // this.log('apply diff', updatesState.seq, updatesState.pts)\r\n  \r\n      if(differenceResult._ === 'updates.differenceSlice') {\r\n        return this.getDifference();\r\n      } else {\r\n        this.debug && this.log.debug('finished get diff');\r\n      }\r\n    });\r\n\r\n    if(!wasSyncing) {\r\n      this.justAName(updatesState, promise);\r\n    }\r\n  \r\n    return promise;\r\n  }\r\n\r\n  private getChannelDifference(channelId: number): Promise<void> {\r\n    const channelState = this.getChannelState(channelId);\r\n    const wasSyncing = channelState.syncLoading;\r\n    if(!wasSyncing) {\r\n      channelState.pendingPtsUpdates = [];\r\n    }\r\n\r\n    if(channelState.syncPending) {\r\n      clearTimeout(channelState.syncPending.timeout);\r\n      channelState.syncPending = null;\r\n    }\r\n\r\n    //this.log.trace('Get channel diff', appChatsManager.getChat(channelId), channelState.pts);\r\n    const promise = apiManager.invokeApi('updates.getChannelDifference', {\r\n      channel: appChatsManager.getChannelInput(channelId),\r\n      filter: {_: 'channelMessagesFilterEmpty'},\r\n      pts: channelState.pts,\r\n      limit: 30\r\n    }, {timeout: 0x7fffffff}).then((differenceResult) => {\r\n      this.debug && this.log.debug('Get channel diff result', differenceResult)\r\n      channelState.pts = 'pts' in differenceResult ? differenceResult.pts : undefined;\r\n  \r\n      if(differenceResult._ === 'updates.channelDifferenceEmpty') {\r\n        this.debug && this.log.debug('apply channel empty diff', differenceResult);\r\n        return;\r\n      }\r\n  \r\n      if(differenceResult._ === 'updates.channelDifferenceTooLong') {\r\n        this.debug && this.log.debug('channel diff too long', differenceResult);\r\n        delete this.channelStates[channelId];\r\n\r\n        // @ts-ignore\r\n        this.saveUpdate({_: 'updateChannelReload', channel_id: channelId});\r\n        return;\r\n      }\r\n  \r\n      appUsersManager.saveApiUsers(differenceResult.users);\r\n      appChatsManager.saveApiChats(differenceResult.chats);\r\n  \r\n      // Should be first because of updateMessageID\r\n      this.debug && this.log.debug('applying', differenceResult.other_updates.length, 'channel other updates');\r\n      differenceResult.other_updates.forEach((update) => {\r\n        this.saveUpdate(update);\r\n      });\r\n  \r\n      this.debug && this.log.debug('applying', differenceResult.new_messages.length, 'channel new messages');\r\n      differenceResult.new_messages.forEach((apiMessage) => {\r\n        this.saveUpdate({\r\n          _: 'updateNewChannelMessage',\r\n          message: apiMessage,\r\n          pts: channelState.pts,\r\n          pts_count: 0\r\n        });\r\n      });\r\n  \r\n      this.debug && this.log.debug('apply channel diff', channelState.pts);\r\n  \r\n      if(differenceResult._ === 'updates.channelDifference' &&\r\n        !differenceResult.pFlags['final']) {\r\n        return this.getChannelDifference(channelId);\r\n      } else {\r\n        this.debug && this.log.debug('finished channel get diff');\r\n      }\r\n    });\r\n\r\n    if(!wasSyncing) {\r\n      this.justAName(channelState, promise, channelId);\r\n    }\r\n\r\n    return promise;\r\n  }\r\n\r\n  private justAName(state: UpdatesState, promise: UpdatesState['syncLoading'], channelId?: number) {\r\n    state.syncLoading = promise;\r\n    rootScope.dispatchEvent('state_synchronizing', channelId);\r\n\r\n    promise.then(() => {\r\n      state.syncLoading = null;\r\n      rootScope.dispatchEvent('state_synchronized', channelId);\r\n    }, () => {\r\n      state.syncLoading = null;\r\n    });\r\n  }\r\n  \r\n  public addChannelState(channelId: number, pts: number) {\r\n    if(!pts) {\r\n      throw new Error('Add channel state without pts ' + channelId);\r\n    }\r\n\r\n    if(!(channelId in this.channelStates)) {\r\n      this.channelStates[channelId] = {\r\n        pts,\r\n        pendingPtsUpdates: [],\r\n        syncPending: null,\r\n        syncLoading: null\r\n      };\r\n\r\n      return true;\r\n    }\r\n\r\n    return false;\r\n  }\r\n\r\n  public getChannelState(channelId: number, pts?: number) {\r\n    if(this.channelStates[channelId] === undefined) {\r\n      this.addChannelState(channelId, pts);\r\n    }\r\n\r\n    return this.channelStates[channelId];\r\n  }\r\n\r\n  private processUpdate(update: any, options: Partial<{\r\n    date: number,\r\n    seq: number,\r\n    seqStart: number/* ,\r\n    ignoreSyncLoading: boolean */\r\n  }> = {}) {\r\n    let channelId = 0;\r\n    switch(update._) {\r\n      case 'updateNewChannelMessage':\r\n      case 'updateEditChannelMessage':\r\n        channelId = -appPeersManager.getPeerId(update.message.peer_id);\r\n        break;\r\n      case 'updateDeleteChannelMessages':\r\n        channelId = update.channel_id;\r\n        break;\r\n      case 'updateChannelTooLong':\r\n        channelId = update.channel_id;\r\n        if(!(channelId in this.channelStates)) {\r\n          return false;\r\n        }\r\n        break;\r\n    }\r\n  \r\n    const curState = channelId ? this.getChannelState(channelId, update.pts) : this.updatesState;\r\n  \r\n    // this.log.log('process', channelId, curState.pts, update)\r\n  \r\n    if(curState.syncLoading/*  && !options.ignoreSyncLoading */) {\r\n      return false;\r\n    }\r\n  \r\n    if(update._ === 'updateChannelTooLong') {\r\n      if(!curState.lastPtsUpdateTime ||\r\n          curState.lastPtsUpdateTime < (Date.now() - SYNC_DELAY)) {\r\n        // this.log.trace('channel too long, get diff', channelId, update)\r\n        this.getChannelDifference(channelId);\r\n      }\r\n      return false;\r\n    }\r\n  \r\n    if(update._ === 'updateNewMessage' ||\r\n        update._ === 'updateEditMessage' ||\r\n        update._ === 'updateNewChannelMessage' ||\r\n        update._ === 'updateEditChannelMessage') {\r\n      const message = update.message;\r\n      const toPeerId = appPeersManager.getPeerId(message.peer_id);\r\n      const fwdHeader = message.fwd_from || {};\r\n      let reason: any = false;\r\n      if(message.from_id && !appUsersManager.hasUser(appPeersManager.getPeerId(message.from_id), message.pFlags.post/* || channelId*/) && (reason = 'author') ||\r\n          fwdHeader.from_id && !appUsersManager.hasUser(appPeersManager.getPeerId(fwdHeader.from_id), !!fwdHeader.channel_id) && (reason = 'fwdAuthor') ||\r\n          fwdHeader.channel_id && !appChatsManager.hasChat(fwdHeader.channel_id, true) && (reason = 'fwdChannel') ||\r\n          toPeerId > 0 && !appUsersManager.hasUser(toPeerId) && (reason = 'toPeer User') ||\r\n          toPeerId < 0 && !appChatsManager.hasChat(-toPeerId) && (reason = 'toPeer Chat')) {\r\n        this.log.warn('Not enough data for message update', toPeerId, reason, message)\r\n        if(channelId && appChatsManager.hasChat(channelId)) {\r\n          this.getChannelDifference(channelId);\r\n        } else {\r\n          this.forceGetDifference();\r\n        }\r\n        return false;\r\n      }\r\n    } else if(channelId && !appChatsManager.hasChat(channelId)) {\r\n      // this.log.log('skip update, missing channel', channelId, update)\r\n      return false;\r\n    }\r\n  \r\n    let popPts: boolean;\r\n    let popSeq: boolean;\r\n  \r\n    if(update.pts) {\r\n      const newPts = curState.pts + (update.pts_count || 0);\r\n      if(newPts < update.pts) {\r\n        this.debug && this.log.warn('Pts hole', curState, update, channelId && appChatsManager.getChat(channelId));\r\n        curState.pendingPtsUpdates.push(update);\r\n        if(!curState.syncPending && !curState.syncLoading) {\r\n          curState.syncPending = {\r\n            timeout: window.setTimeout(() => {\r\n              curState.syncPending = null;\r\n\r\n              if(curState.syncLoading) {\r\n                return;\r\n              }\r\n\r\n              if(channelId) {\r\n                this.getChannelDifference(channelId);\r\n              } else {\r\n                this.getDifference();\r\n              }\r\n            }, SYNC_DELAY)\r\n          };\r\n        }\r\n\r\n        curState.syncPending.ptsAwaiting = true;\r\n        return false;\r\n      }\r\n\r\n      if(update.pts > curState.pts) {\r\n        curState.pts = update.pts;\r\n        popPts = true;\r\n  \r\n        curState.lastPtsUpdateTime = Date.now();\r\n      } else if(update.pts_count) {\r\n        // this.log.warn('Duplicate update', update)\r\n        return false;\r\n      }\r\n\r\n      if(channelId && options.date && this.updatesState.date < options.date) {\r\n        this.updatesState.date = options.date;\r\n      }\r\n    } else if(!channelId && options.seq > 0) {\r\n      const seq = options.seq;\r\n      const seqStart = options.seqStart || seq;\r\n  \r\n      if(seqStart !== curState.seq + 1) {\r\n        if(seqStart > curState.seq) {\r\n          this.debug && this.log.warn('Seq hole', curState, curState.syncPending && curState.syncPending.seqAwaiting);\r\n  \r\n          if(curState.pendingSeqUpdates[seqStart] === undefined) {\r\n            curState.pendingSeqUpdates[seqStart] = {seq, date: options.date, updates: []};\r\n          }\r\n          curState.pendingSeqUpdates[seqStart].updates.push(update);\r\n  \r\n          if(!curState.syncPending) {\r\n            curState.syncPending = {\r\n              timeout: window.setTimeout(() => {\r\n                curState.syncPending = null;\r\n\r\n                if(curState.syncLoading) {\r\n                  return;\r\n                }\r\n\r\n                this.getDifference();\r\n              }, SYNC_DELAY)\r\n            };\r\n          }\r\n\r\n          if(!curState.syncPending.seqAwaiting ||\r\n            curState.syncPending.seqAwaiting < seqStart) {\r\n            curState.syncPending.seqAwaiting = seqStart;\r\n          }\r\n          return false;\r\n        }\r\n      }\r\n  \r\n      if(curState.seq !== seq) {\r\n        curState.seq = seq;\r\n        if(options.date && curState.date < options.date) {\r\n          curState.date = options.date;\r\n        }\r\n\r\n        popSeq = true;\r\n      }\r\n    }\r\n  \r\n    this.saveUpdate(update);\r\n  \r\n    if(popPts) {\r\n      this.popPendingPtsUpdate(channelId);\r\n    } else if(popSeq) {\r\n      this.popPendingSeqUpdate();\r\n    }\r\n  }\r\n\r\n  public saveUpdate(update: Update) {\r\n    //this.debug && this.log('saveUpdate', update);\r\n    rootScope.dispatchEvent(update._, update as any);\r\n  }\r\n  \r\n  public attach() {\r\n    if(this.attached) return;\r\n\r\n    //return;\r\n\r\n    this.log('attach');\r\n    \r\n    this.attached = true;\r\n\r\n    appStateManager.getState().then(_state => {\r\n      const state = _state.updates;\r\n\r\n      //rootScope.broadcast('state_synchronizing');\r\n      if(!state || !state.pts || !state.date || !state.seq) {\r\n        this.log('will get new state');\r\n\r\n        this.updatesState.syncLoading = new Promise((resolve) => {\r\n          apiManager.invokeApi('updates.getState', {}, {noErrorBox: true}).then((stateResult) => {\r\n            this.updatesState.seq = stateResult.seq;\r\n            this.updatesState.pts = stateResult.pts;\r\n            this.updatesState.date = stateResult.date;\r\n            this.saveUpdatesState();\r\n            //setTimeout(() => {\r\n              this.updatesState.syncLoading = null;\r\n              resolve();\r\n              //rootScope.broadcast('state_synchronized');\r\n            //}, 1000);\r\n        \r\n          // ! for testing\r\n          // updatesState.seq = 1\r\n          // updatesState.pts = stateResult.pts - 5000\r\n          // updatesState.date = 1\r\n          // getDifference()\r\n          });\r\n        });\r\n      } else {\r\n        // ! for testing\r\n        /* state.seq = 1;\r\n        state.pts = state.pts - 15;\r\n        state.date = 1; */\r\n        // state.pts -= 100;\r\n\r\n        Object.assign(this.updatesState, state);\r\n        \r\n        this.log('will get difference', Object.assign({}, state));\r\n        \r\n        this.getDifference(true)/* .finally(() => {\r\n          if(this.updatesState.syncLoading) {\r\n            rootScope.broadcast('state_synchronizing');\r\n          }\r\n        }) */;\r\n      }\r\n\r\n      apiManager.setUpdatesProcessor(this.processUpdateMessage);\r\n\r\n      // this.updatesState.syncLoading.then(() => {\r\n        this.setProxy();\r\n      // });\r\n    });\r\n  }\r\n}\r\n\r\nconst apiUpdatesManager = new ApiUpdatesManager();\r\nMOUNT_CLASS_TO.apiUpdatesManager = apiUpdatesManager;\r\nexport default apiUpdatesManager\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport { fastRaf } from \"./schedulers\";\r\nimport { CancellablePromise, deferredPromise } from \"./cancellablePromise\";\r\nimport { MOUNT_CLASS_TO } from \"../config/debug\";\r\nimport isInDOM from \"./dom/isInDOM\";\r\n\r\nclass SequentialDom {\r\n  private promises: Partial<{\r\n    read: CancellablePromise<void>,\r\n    write: CancellablePromise<void>\r\n  }> = {};\r\n  private raf = fastRaf.bind(null);\r\n  private scheduled = false;\r\n\r\n  private do(kind: keyof SequentialDom['promises'], callback?: VoidFunction) {\r\n    let promise = this.promises[kind];\r\n    if(!promise) {\r\n      this.scheduleFlush();\r\n      promise = this.promises[kind] = deferredPromise<void>();\r\n    }\r\n\r\n    if(callback !== undefined) {\r\n      promise.then(() => callback());\r\n    }\r\n    \r\n    return promise;\r\n  }\r\n\r\n  public measure(callback?: VoidFunction) {\r\n    return this.do('read', callback);\r\n  }\r\n\r\n  public mutate(callback?: VoidFunction) {\r\n    return this.do('write', callback);\r\n  }\r\n\r\n  /**\r\n   * Will fire instantly if element is not connected\r\n   * @param element \r\n   * @param callback \r\n   */\r\n  public mutateElement(element: HTMLElement, callback?: VoidFunction) {\r\n    const promise = isInDOM(element) ? this.mutate() : Promise.resolve();\r\n\r\n    if(callback !== undefined) {\r\n      promise.then(() => callback());\r\n    }\r\n\r\n    return promise;\r\n  }\r\n\r\n  private scheduleFlush() {\r\n    if(!this.scheduled) {\r\n      this.scheduled = true;\r\n\r\n      this.raf(() => {\r\n        this.promises.read && this.promises.read.resolve();\r\n        this.promises.write && this.promises.write.resolve();\r\n\r\n        this.scheduled = false;\r\n        this.promises = {};\r\n      });\r\n    }\r\n  }\r\n}\r\n\r\nconst sequentialDom = new SequentialDom();\r\nMOUNT_CLASS_TO && (MOUNT_CLASS_TO.sequentialDom = sequentialDom);\r\nexport default sequentialDom;\r\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport { MOUNT_CLASS_TO } from \"./config/debug\";\n\nexport type Country = {\n  phoneCode: string,\n  code: string,\n  name: string,\n  pattern: string,\n  emoji: string\n};\n\nconst Countries: Country[] = [{\"phoneCode\":\"7 840\",\"code\":\"AB\",\"name\":\"Abkhazia\",\"pattern\":\"\",\"emoji\":\"\"},{\"phoneCode\":\"93\",\"code\":\"AF\",\"name\":\"Afghanistan\",\"pattern\":\"93 XXX XXX XXX\",\"emoji\":\"\"},{\"phoneCode\":\"358 18\",\"code\":\"AX\",\"name\":\"Aland Islands\",\"pattern\":\"\",\"emoji\":\"\"},{\"phoneCode\":\"355\",\"code\":\"AL\",\"name\":\"Albania\",\"pattern\":\"355 XX XXX XXXX\",\"emoji\":\"\"},{\"phoneCode\":\"213\",\"code\":\"DZ\",\"name\":\"Algeria\",\"pattern\":\"213 XXX XX XX XX\",\"emoji\":\"\"},{\"phoneCode\":\"1 684\",\"code\":\"AS\",\"name\":\"American Samoa\",\"pattern\":\"1684 XXX XXXX\",\"emoji\":\"\"},{\"phoneCode\":\"376\",\"code\":\"AD\",\"name\":\"Andorra\",\"pattern\":\"376 XX XX XX\",\"emoji\":\"\"},{\"phoneCode\":\"244\",\"code\":\"AO\",\"name\":\"Angola\",\"pattern\":\"244 XXX XXX XXX\",\"emoji\":\"\"},{\"phoneCode\":\"1 264\",\"code\":\"AI\",\"name\":\"Anguilla\",\"pattern\":\"1264 XXX XXXX\",\"emoji\":\"\"},{\"phoneCode\":\"1 268\",\"code\":\"AG\",\"name\":\"Antigua & Barbuda\",\"pattern\":\"1268 XXX XXXX\",\"emoji\":\"\"},{\"phoneCode\":\"54\",\"code\":\"AR\",\"name\":\"Argentina\",\"pattern\":\"\",\"emoji\":\"\"},{\"phoneCode\":\"374\",\"code\":\"AM\",\"name\":\"Armenia\",\"pattern\":\"374 XX XXX XXX\",\"emoji\":\"\"},{\"phoneCode\":\"297\",\"code\":\"AW\",\"name\":\"Aruba\",\"pattern\":\"297 XXX XXXX\",\"emoji\":\"\"},{\"phoneCode\":\"247\",\"code\":\"SH\",\"name\":\"Ascension\",\"pattern\":\"290 XX XXX\",\"emoji\":\"\"},{\"phoneCode\":\"61\",\"code\":\"AU\",\"name\":\"Australia\",\"pattern\":\"61 XXX XXX XXX\",\"emoji\":\"\"},{\"phoneCode\":\"672\",\"code\":\"AU\",\"name\":\"Australian External Territories\",\"pattern\":\"61 XXX XXX XXX\",\"emoji\":\"\"},{\"phoneCode\":\"43\",\"code\":\"AT\",\"name\":\"Austria\",\"pattern\":\"\",\"emoji\":\"\"},{\"phoneCode\":\"994\",\"code\":\"AZ\",\"name\":\"Azerbaijan\",\"pattern\":\"994 XX XXX XX XX\",\"emoji\":\"\"},{\"phoneCode\":\"1 242\",\"code\":\"BS\",\"name\":\"Bahamas\",\"pattern\":\"1242 XXX XXXX\",\"emoji\":\"\"},{\"phoneCode\":\"973\",\"code\":\"BH\",\"name\":\"Bahrain\",\"pattern\":\"973 XXXX XXXX\",\"emoji\":\"\"},{\"phoneCode\":\"880\",\"code\":\"BD\",\"name\":\"Bangladesh\",\"pattern\":\"\",\"emoji\":\"\"},{\"phoneCode\":\"1 246\",\"code\":\"BB\",\"name\":\"Barbados\",\"pattern\":\"1246 XXX XXXX\",\"emoji\":\"\"},{\"phoneCode\":\"1 268\",\"code\":\"AG\",\"name\":\"Barbuda\",\"pattern\":\"1268 XXX XXXX\",\"emoji\":\"\"},{\"phoneCode\":\"375\",\"code\":\"BY\",\"name\":\"Belarus\",\"pattern\":\"375 XX XXX XXXX\",\"emoji\":\"\"},{\"phoneCode\":\"32\",\"code\":\"BE\",\"name\":\"Belgium\",\"pattern\":\"32 XXX XX XX XX\",\"emoji\":\"\"},{\"phoneCode\":\"501\",\"code\":\"BZ\",\"name\":\"Belize\",\"pattern\":\"\",\"emoji\":\"\"},{\"phoneCode\":\"229\",\"code\":\"BJ\",\"name\":\"Benin\",\"pattern\":\"229 XX XXX XXX\",\"emoji\":\"\"},{\"phoneCode\":\"1 441\",\"code\":\"BM\",\"name\":\"Bermuda\",\"pattern\":\"1441 XXX XXXX\",\"emoji\":\"\"},{\"phoneCode\":\"975\",\"code\":\"BT\",\"name\":\"Bhutan\",\"pattern\":\"\",\"emoji\":\"\"},{\"phoneCode\":\"591\",\"code\":\"BO\",\"name\":\"Bolivia\",\"pattern\":\"591 X XXX XXXX\",\"emoji\":\"\"},{\"phoneCode\":\"599 7\",\"code\":\"BQ\",\"name\":\"Caribbean Netherlands\",\"pattern\":\"\",\"emoji\":\"\"},{\"phoneCode\":\"387\",\"code\":\"BA\",\"name\":\"Bosnia & Herzegovina\",\"pattern\":\"\",\"emoji\":\"\"},{\"phoneCode\":\"267\",\"code\":\"BW\",\"name\":\"Botswana\",\"pattern\":\"267 XX XXX XXX\",\"emoji\":\"\"},{\"phoneCode\":\"55\",\"code\":\"BR\",\"name\":\"Brazil\",\"pattern\":\"55 XX XXXXX XXXX\",\"emoji\":\"\"},{\"phoneCode\":\"246\",\"code\":\"IO\",\"name\":\"British Indian Ocean Territory\",\"pattern\":\"246 XXX XXXX\",\"emoji\":\"\"},{\"phoneCode\":\"1 284\",\"code\":\"VG\",\"name\":\"British Virgin Islands\",\"pattern\":\"1284 XXX XXXX\",\"emoji\":\"\"},{\"phoneCode\":\"673\",\"code\":\"BN\",\"name\":\"Brunei\",\"pattern\":\"673 XXX XXXX\",\"emoji\":\"\"},{\"phoneCode\":\"359\",\"code\":\"BG\",\"name\":\"Bulgaria\",\"pattern\":\"\",\"emoji\":\"\"},{\"phoneCode\":\"226\",\"code\":\"BF\",\"name\":\"Burkina Faso\",\"pattern\":\"226 XX XX XX XX\",\"emoji\":\"\"},{\"phoneCode\":\"95\",\"code\":\"MM\",\"name\":\"Myanmar (Burma)\",\"pattern\":\"\",\"emoji\":\"\"},{\"phoneCode\":\"257\",\"code\":\"BI\",\"name\":\"Burundi\",\"pattern\":\"257 XX XX XXXX\",\"emoji\":\"\"},{\"phoneCode\":\"855\",\"code\":\"KH\",\"name\":\"Cambodia\",\"pattern\":\"\",\"emoji\":\"\"},{\"phoneCode\":\"237\",\"code\":\"CM\",\"name\":\"Cameroon\",\"pattern\":\"237 XXXX XXXX\",\"emoji\":\"\"},{\"phoneCode\":\"1\",\"code\":\"CA\",\"name\":\"Canada\",\"pattern\":\"1 XXX XXX XXXX\",\"emoji\":\"\"},{\"phoneCode\":\"238\",\"code\":\"CV\",\"name\":\"Cape Verde\",\"pattern\":\"238 XXX XXXX\",\"emoji\":\"\"},{\"phoneCode\":\"1 345\",\"code\":\"KY\",\"name\":\"Cayman Islands\",\"pattern\":\"1345 XXX XXXX\",\"emoji\":\"\"},{\"phoneCode\":\"236\",\"code\":\"CF\",\"name\":\"Central African Republic\",\"pattern\":\"236 XX XX XX XX\",\"emoji\":\"\"},{\"phoneCode\":\"235\",\"code\":\"TD\",\"name\":\"Chad\",\"pattern\":\"235 XX XX XX XX\",\"emoji\":\"\"},{\"phoneCode\":\"56\",\"code\":\"CL\",\"name\":\"Chile\",\"pattern\":\"56 X XXXX XXXX\",\"emoji\":\"\"},{\"phoneCode\":\"86\",\"code\":\"CN\",\"name\":\"China\",\"pattern\":\"86 XXX XXXX XXXX\",\"emoji\":\"\"},{\"phoneCode\":\"61\",\"code\":\"CX\",\"name\":\"Christmas Island\",\"pattern\":\"\",\"emoji\":\"\"},{\"phoneCode\":\"61\",\"code\":\"CC\",\"name\":\"Cocos (Keeling) Islands\",\"pattern\":\"\",\"emoji\":\"\"},{\"phoneCode\":\"57\",\"code\":\"CO\",\"name\":\"Colombia\",\"pattern\":\"57 XXX XXX XXXX\",\"emoji\":\"\"},{\"phoneCode\":\"269\",\"code\":\"KM\",\"name\":\"Comoros\",\"pattern\":\"269 XXX XXXX\",\"emoji\":\"\"},{\"phoneCode\":\"242\",\"code\":\"CG\",\"name\":\"Congo - Brazzaville\",\"pattern\":\"242 XX XXX XXXX\",\"emoji\":\"\"},{\"phoneCode\":\"243\",\"code\":\"CD\",\"name\":\"Congo - Kinshasa\",\"pattern\":\"243 XX XXX XXXX\",\"emoji\":\"\"},{\"phoneCode\":\"682\",\"code\":\"CK\",\"name\":\"Cook Islands\",\"pattern\":\"\",\"emoji\":\"\"},{\"phoneCode\":\"506\",\"code\":\"CR\",\"name\":\"Costa Rica\",\"pattern\":\"\",\"emoji\":\"\"},{\"phoneCode\":\"225\",\"code\":\"CI\",\"name\":\"Cote dIvoire\",\"pattern\":\"225 XX XXX XXX\",\"emoji\":\"\"},{\"phoneCode\":\"385\",\"code\":\"HR\",\"name\":\"Croatia\",\"pattern\":\"\",\"emoji\":\"\"},{\"phoneCode\":\"53\",\"code\":\"CU\",\"name\":\"Cuba\",\"pattern\":\"53 XXXX XXXX\",\"emoji\":\"\"},{\"phoneCode\":\"599 9\",\"code\":\"CW\",\"name\":\"Curacao\",\"pattern\":\"\",\"emoji\":\"\"},{\"phoneCode\":\"357\",\"code\":\"CY\",\"name\":\"Cyprus\",\"pattern\":\"357 XXXX XXXX\",\"emoji\":\"\"},{\"phoneCode\":\"420\",\"code\":\"CZ\",\"name\":\"Czech Republic\",\"pattern\":\"\",\"emoji\":\"\"},{\"phoneCode\":\"45\",\"code\":\"DK\",\"name\":\"Denmark\",\"pattern\":\"45 XXXX XXXX\",\"emoji\":\"\"},{\"phoneCode\":\"246\",\"code\":\"DG\",\"name\":\"Diego Garcia\",\"pattern\":\"\",\"emoji\":\"\"},{\"phoneCode\":\"253\",\"code\":\"DJ\",\"name\":\"Djibouti\",\"pattern\":\"253 XX XX XX XX\",\"emoji\":\"\"},{\"phoneCode\":\"1 767\",\"code\":\"DM\",\"name\":\"Dominica\",\"pattern\":\"1767 XXX XXXX\",\"emoji\":\"\"},{\"phoneCode\":\"1 809 and 1 829\",\"code\":\"DO\",\"name\":\"Dominican Republic\",\"pattern\":\"1 XXX XXX XXXX\",\"emoji\":\"\"},{\"phoneCode\":\"670\",\"code\":\"TL\",\"name\":\"Timor-Leste\",\"pattern\":\"\",\"emoji\":\"\"},{\"phoneCode\":\"593\",\"code\":\"EC\",\"name\":\"Ecuador\",\"pattern\":\"\",\"emoji\":\"\"},{\"phoneCode\":\"20\",\"code\":\"EG\",\"name\":\"Egypt\",\"pattern\":\"20 XX XXX XXXX\",\"emoji\":\"\"},{\"phoneCode\":\"503\",\"code\":\"SV\",\"name\":\"El Salvador\",\"pattern\":\"503 XXXX XXXX\",\"emoji\":\"\"},{\"phoneCode\":\"240\",\"code\":\"GQ\",\"name\":\"Equatorial Guinea\",\"pattern\":\"240 XXX XXX XXX\",\"emoji\":\"\"},{\"phoneCode\":\"291\",\"code\":\"ER\",\"name\":\"Eritrea\",\"pattern\":\"291 X XXX XXX\",\"emoji\":\"\"},{\"phoneCode\":\"372\",\"code\":\"EE\",\"name\":\"Estonia\",\"pattern\":\"\",\"emoji\":\"\"},{\"phoneCode\":\"251\",\"code\":\"ET\",\"name\":\"Ethiopia\",\"pattern\":\"251 XX XXX XXXX\",\"emoji\":\"\"},{\"phoneCode\":\"500\",\"code\":\"FK\",\"name\":\"Falkland Islands\",\"pattern\":\"\",\"emoji\":\"\"},{\"phoneCode\":\"298\",\"code\":\"FO\",\"name\":\"Faroe Islands\",\"pattern\":\"298 XXX XXX\",\"emoji\":\"\"},{\"phoneCode\":\"679\",\"code\":\"FJ\",\"name\":\"Fiji\",\"pattern\":\"\",\"emoji\":\"\"},{\"phoneCode\":\"358\",\"code\":\"FI\",\"name\":\"Finland\",\"pattern\":\"\",\"emoji\":\"\"},{\"phoneCode\":\"33\",\"code\":\"FR\",\"name\":\"France\",\"pattern\":\"33 X XX XX XX XX\",\"emoji\":\"\"},{\"phoneCode\":\"594\",\"code\":\"GF\",\"name\":\"French Guiana\",\"pattern\":\"\",\"emoji\":\"\"},{\"phoneCode\":\"689\",\"code\":\"PF\",\"name\":\"French Polynesia\",\"pattern\":\"\",\"emoji\":\"\"},{\"phoneCode\":\"241\",\"code\":\"GA\",\"name\":\"Gabon\",\"pattern\":\"241 X XX XX XX\",\"emoji\":\"\"},{\"phoneCode\":\"220\",\"code\":\"GM\",\"name\":\"Gambia\",\"pattern\":\"220 XXX XXXX\",\"emoji\":\"\"},{\"phoneCode\":\"995\",\"code\":\"GE\",\"name\":\"Georgia\",\"pattern\":\"\",\"emoji\":\"\"},{\"phoneCode\":\"49\",\"code\":\"DE\",\"name\":\"Germany\",\"pattern\":\"49 XXX XXXXXXXX\",\"emoji\":\"\"},{\"phoneCode\":\"233\",\"code\":\"GH\",\"name\":\"Ghana\",\"pattern\":\"\",\"emoji\":\"\"},{\"phoneCode\":\"350\",\"code\":\"GI\",\"name\":\"Gibraltar\",\"pattern\":\"350 XXXX XXXX\",\"emoji\":\"\"},{\"phoneCode\":\"30\",\"code\":\"GR\",\"name\":\"Greece\",\"pattern\":\"30 XX XXXX XXXX\",\"emoji\":\"\"},{\"phoneCode\":\"299\",\"code\":\"GL\",\"name\":\"Greenland\",\"pattern\":\"299 XXX XXX\",\"emoji\":\"\"},{\"phoneCode\":\"1 473\",\"code\":\"GD\",\"name\":\"Grenada\",\"pattern\":\"1473 XXX XXXX\",\"emoji\":\"\"},{\"phoneCode\":\"590\",\"code\":\"GP\",\"name\":\"Guadeloupe\",\"pattern\":\"\",\"emoji\":\"\"},{\"phoneCode\":\"1 671\",\"code\":\"GU\",\"name\":\"Guam\",\"pattern\":\"1671 XXX XXXX\",\"emoji\":\"\"},{\"phoneCode\":\"502\",\"code\":\"GT\",\"name\":\"Guatemala\",\"pattern\":\"502 X XXX XXXX\",\"emoji\":\"\"},{\"phoneCode\":\"44\",\"code\":\"GG\",\"name\":\"Guernsey\",\"pattern\":\"\",\"emoji\":\"\"},{\"phoneCode\":\"224\",\"code\":\"GN\",\"name\":\"Guinea\",\"pattern\":\"224 XXX XXX XXX\",\"emoji\":\"\"},{\"phoneCode\":\"245\",\"code\":\"GW\",\"name\":\"Guinea-Bissau\",\"pattern\":\"245 XXX XXXX\",\"emoji\":\"\"},{\"phoneCode\":\"592\",\"code\":\"GY\",\"name\":\"Guyana\",\"pattern\":\"\",\"emoji\":\"\"},{\"phoneCode\":\"509\",\"code\":\"HT\",\"name\":\"Haiti\",\"pattern\":\"\",\"emoji\":\"\"},{\"phoneCode\":\"504\",\"code\":\"HN\",\"name\":\"Honduras\",\"pattern\":\"504 XXXX XXXX\",\"emoji\":\"\"},{\"phoneCode\":\"852\",\"code\":\"HK\",\"name\":\"Hong Kong SAR China\",\"pattern\":\"\",\"emoji\":\"\"},{\"phoneCode\":\"36\",\"code\":\"HU\",\"name\":\"Hungary\",\"pattern\":\"36 XX XXX XXXX\",\"emoji\":\"\"},{\"phoneCode\":\"354\",\"code\":\"IS\",\"name\":\"Iceland\",\"pattern\":\"354 XXX XXXX\",\"emoji\":\"\"},{\"phoneCode\":\"91\",\"code\":\"IN\",\"name\":\"India\",\"pattern\":\"91 XXXXX XXXXX\",\"emoji\":\"\"},{\"phoneCode\":\"62\",\"code\":\"ID\",\"name\":\"Indonesia\",\"pattern\":\"\",\"emoji\":\"\"},{\"phoneCode\":\"98\",\"code\":\"IR\",\"name\":\"Iran\",\"pattern\":\"98 XXX XXX XXXX\",\"emoji\":\"\"},{\"phoneCode\":\"964\",\"code\":\"IQ\",\"name\":\"Iraq\",\"pattern\":\"964 XXX XXX XXXX\",\"emoji\":\"\"},{\"phoneCode\":\"353\",\"code\":\"IE\",\"name\":\"Ireland\",\"pattern\":\"353 XX XXX XXXX\",\"emoji\":\"\"},{\"phoneCode\":\"972\",\"code\":\"IL\",\"name\":\"Israel\",\"pattern\":\"972 XX XXX XXXX\",\"emoji\":\"\"},{\"phoneCode\":\"39\",\"code\":\"IT\",\"name\":\"Italy\",\"pattern\":\"39 XXX XXX XXXX\",\"emoji\":\"\"},{\"phoneCode\":\"1 876\",\"code\":\"JM\",\"name\":\"Jamaica\",\"pattern\":\"1876 XXX XXXX\",\"emoji\":\"\"},{\"phoneCode\":\"47 79\",\"code\":\"SJ\",\"name\":\"Svalbard & Jan Mayen\",\"pattern\":\"\",\"emoji\":\"\"},{\"phoneCode\":\"81\",\"code\":\"JP\",\"name\":\"Japan\",\"pattern\":\"81 XX XXXX XXXX\",\"emoji\":\"\"},{\"phoneCode\":\"44\",\"code\":\"JE\",\"name\":\"Jersey\",\"pattern\":\"\",\"emoji\":\"\"},{\"phoneCode\":\"962\",\"code\":\"JO\",\"name\":\"Jordan\",\"pattern\":\"962 X XXXX XXXX\",\"emoji\":\"\"},{\"phoneCode\":\"383\",\"code\":\"XK\",\"name\":\"Kosovo\",\"pattern\":\"383 XXXX XXXX\",\"emoji\":\"\"},{\"phoneCode\":\"7 7\",\"code\":\"KZ\",\"name\":\"Kazakhstan\",\"pattern\":\"7 XXX XXX XX XX\",\"emoji\":\"\"},{\"phoneCode\":\"254\",\"code\":\"KE\",\"name\":\"Kenya\",\"pattern\":\"254 XXX XXX XXX\",\"emoji\":\"\"},{\"phoneCode\":\"686\",\"code\":\"KI\",\"name\":\"Kiribati\",\"pattern\":\"\",\"emoji\":\"\"},{\"phoneCode\":\"850\",\"code\":\"KP\",\"name\":\"North Korea\",\"pattern\":\"\",\"emoji\":\"\"},{\"phoneCode\":\"82\",\"code\":\"KR\",\"name\":\"South Korea\",\"pattern\":\"\",\"emoji\":\"\"},{\"phoneCode\":\"965\",\"code\":\"KW\",\"name\":\"Kuwait\",\"pattern\":\"965 XXXX XXXX\",\"emoji\":\"\"},{\"phoneCode\":\"996\",\"code\":\"KG\",\"name\":\"Kyrgyzstan\",\"pattern\":\"\",\"emoji\":\"\"},{\"phoneCode\":\"856\",\"code\":\"LA\",\"name\":\"Laos\",\"pattern\":\"\",\"emoji\":\"\"},{\"phoneCode\":\"371\",\"code\":\"LV\",\"name\":\"Latvia\",\"pattern\":\"371 XXX XXXXX\",\"emoji\":\"\"},{\"phoneCode\":\"961\",\"code\":\"LB\",\"name\":\"Lebanon\",\"pattern\":\"\",\"emoji\":\"\"},{\"phoneCode\":\"266\",\"code\":\"LS\",\"name\":\"Lesotho\",\"pattern\":\"266 XX XXX XXX\",\"emoji\":\"\"},{\"phoneCode\":\"231\",\"code\":\"LR\",\"name\":\"Liberia\",\"pattern\":\"\",\"emoji\":\"\"},{\"phoneCode\":\"218\",\"code\":\"LY\",\"name\":\"Libya\",\"pattern\":\"218 XX XXX XXXX\",\"emoji\":\"\"},{\"phoneCode\":\"423\",\"code\":\"LI\",\"name\":\"Liechtenstein\",\"pattern\":\"\",\"emoji\":\"\"},{\"phoneCode\":\"370\",\"code\":\"LT\",\"name\":\"Lithuania\",\"pattern\":\"370 XXX XXXXX\",\"emoji\":\"\"},{\"phoneCode\":\"352\",\"code\":\"LU\",\"name\":\"Luxembourg\",\"pattern\":\"\",\"emoji\":\"\"},{\"phoneCode\":\"853\",\"code\":\"MO\",\"name\":\"Macau SAR China\",\"pattern\":\"\",\"emoji\":\"\"},{\"phoneCode\":\"389\",\"code\":\"MK\",\"name\":\"Macedonia\",\"pattern\":\"\",\"emoji\":\"\"},{\"phoneCode\":\"261\",\"code\":\"MG\",\"name\":\"Madagascar\",\"pattern\":\"261 XX XX XXX XX\",\"emoji\":\"\"},{\"phoneCode\":\"265\",\"code\":\"MW\",\"name\":\"Malawi\",\"pattern\":\"\",\"emoji\":\"\"},{\"phoneCode\":\"60\",\"code\":\"MY\",\"name\":\"Malaysia\",\"pattern\":\"\",\"emoji\":\"\"},{\"phoneCode\":\"960\",\"code\":\"MV\",\"name\":\"Maldives\",\"pattern\":\"\",\"emoji\":\"\"},{\"phoneCode\":\"223\",\"code\":\"ML\",\"name\":\"Mali\",\"pattern\":\"223 XXXX XXXX\",\"emoji\":\"\"},{\"phoneCode\":\"356\",\"code\":\"MT\",\"name\":\"Malta\",\"pattern\":\"356 XX XX XX XX\",\"emoji\":\"\"},{\"phoneCode\":\"692\",\"code\":\"MH\",\"name\":\"Marshall Islands\",\"pattern\":\"\",\"emoji\":\"\"},{\"phoneCode\":\"596\",\"code\":\"MQ\",\"name\":\"Martinique\",\"pattern\":\"\",\"emoji\":\"\"},{\"phoneCode\":\"222\",\"code\":\"MR\",\"name\":\"Mauritania\",\"pattern\":\"222 XXXX XXXX\",\"emoji\":\"\"},{\"phoneCode\":\"230\",\"code\":\"MU\",\"name\":\"Mauritius\",\"pattern\":\"\",\"emoji\":\"\"},{\"phoneCode\":\"262\",\"code\":\"YT\",\"name\":\"Mayotte\",\"pattern\":\"\",\"emoji\":\"\"},{\"phoneCode\":\"52\",\"code\":\"MX\",\"name\":\"Mexico\",\"pattern\":\"\",\"emoji\":\"\"},{\"phoneCode\":\"691\",\"code\":\"FM\",\"name\":\"Micronesia\",\"pattern\":\"\",\"emoji\":\"\"},{\"phoneCode\":\"373\",\"code\":\"MD\",\"name\":\"Moldova\",\"pattern\":\"373 XX XXX XXX\",\"emoji\":\"\"},{\"phoneCode\":\"377\",\"code\":\"MC\",\"name\":\"Monaco\",\"pattern\":\"377 XXXX XXXX\",\"emoji\":\"\"},{\"phoneCode\":\"976\",\"code\":\"MN\",\"name\":\"Mongolia\",\"pattern\":\"\",\"emoji\":\"\"},{\"phoneCode\":\"382\",\"code\":\"ME\",\"name\":\"Montenegro\",\"pattern\":\"\",\"emoji\":\"\"},{\"phoneCode\":\"1 664\",\"code\":\"MS\",\"name\":\"Montserrat\",\"pattern\":\"1664 XXX XXXX\",\"emoji\":\"\"},{\"phoneCode\":\"212\",\"code\":\"MA\",\"name\":\"Morocco\",\"pattern\":\"212 XX XXX XXXX\",\"emoji\":\"\"},{\"phoneCode\":\"258\",\"code\":\"MZ\",\"name\":\"Mozambique\",\"pattern\":\"258 XX XXX XXXX\",\"emoji\":\"\"},{\"phoneCode\":\"264\",\"code\":\"NA\",\"name\":\"Namibia\",\"pattern\":\"264 XX XXX XXXX\",\"emoji\":\"\"},{\"phoneCode\":\"674\",\"code\":\"NR\",\"name\":\"Nauru\",\"pattern\":\"\",\"emoji\":\"\"},{\"phoneCode\":\"977\",\"code\":\"NP\",\"name\":\"Nepal\",\"pattern\":\"\",\"emoji\":\"\"},{\"phoneCode\":\"31\",\"code\":\"NL\",\"name\":\"Netherlands\",\"pattern\":\"31 X XX XX XX XX\",\"emoji\":\"\"},{\"phoneCode\":\"687\",\"code\":\"NC\",\"name\":\"New Caledonia\",\"pattern\":\"\",\"emoji\":\"\"},{\"phoneCode\":\"64\",\"code\":\"NZ\",\"name\":\"New Zealand\",\"pattern\":\"\",\"emoji\":\"\"},{\"phoneCode\":\"505\",\"code\":\"NI\",\"name\":\"Nicaragua\",\"pattern\":\"505 XXXX XXXX\",\"emoji\":\"\"},{\"phoneCode\":\"227\",\"code\":\"NE\",\"name\":\"Niger\",\"pattern\":\"227 XX XX XX XX\",\"emoji\":\"\"},{\"phoneCode\":\"234\",\"code\":\"NG\",\"name\":\"Nigeria\",\"pattern\":\"\",\"emoji\":\"\"},{\"phoneCode\":\"683\",\"code\":\"NU\",\"name\":\"Niue\",\"pattern\":\"\",\"emoji\":\"\"},{\"phoneCode\":\"672\",\"code\":\"NF\",\"name\":\"Norfolk Island\",\"pattern\":\"\",\"emoji\":\"\"},{\"phoneCode\":\"1 670\",\"code\":\"MP\",\"name\":\"Northern Mariana Islands\",\"pattern\":\"1670 XXX XXXX\",\"emoji\":\"\"},{\"phoneCode\":\"47\",\"code\":\"NO\",\"name\":\"Norway\",\"pattern\":\"47 XXXX XXXX\",\"emoji\":\"\"},{\"phoneCode\":\"968\",\"code\":\"OM\",\"name\":\"Oman\",\"pattern\":\"968 XXXX XXXX\",\"emoji\":\"\"},{\"phoneCode\":\"92\",\"code\":\"PK\",\"name\":\"Pakistan\",\"pattern\":\"92 XXX XXX XXXX\",\"emoji\":\"\"},{\"phoneCode\":\"680\",\"code\":\"PW\",\"name\":\"Palau\",\"pattern\":\"\",\"emoji\":\"\"},{\"phoneCode\":\"970\",\"code\":\"PS\",\"name\":\"Palestinian Territories\",\"pattern\":\"970 XXX XX XXXX\",\"emoji\":\"\"},{\"phoneCode\":\"507\",\"code\":\"PA\",\"name\":\"Panama\",\"pattern\":\"507 XXXX XXXX\",\"emoji\":\"\"},{\"phoneCode\":\"675\",\"code\":\"PG\",\"name\":\"Papua New Guinea\",\"pattern\":\"\",\"emoji\":\"\"},{\"phoneCode\":\"595\",\"code\":\"PY\",\"name\":\"Paraguay\",\"pattern\":\"595 XXX XXX XXX\",\"emoji\":\"\"},{\"phoneCode\":\"51\",\"code\":\"PE\",\"name\":\"Peru\",\"pattern\":\"51 XXX XXX XXX\",\"emoji\":\"\"},{\"phoneCode\":\"63\",\"code\":\"PH\",\"name\":\"Philippines\",\"pattern\":\"63 XXX XXX XXXX\",\"emoji\":\"\"},{\"phoneCode\":\"64\",\"code\":\"PN\",\"name\":\"Pitcairn Islands\",\"pattern\":\"\",\"emoji\":\"\"},{\"phoneCode\":\"48\",\"code\":\"PL\",\"name\":\"Poland\",\"pattern\":\"48 XXX XXX XXX\",\"emoji\":\"\"},{\"phoneCode\":\"351\",\"code\":\"PT\",\"name\":\"Portugal\",\"pattern\":\"351 X XXXX XXXX\",\"emoji\":\"\"},{\"phoneCode\":\"1 787 and 1 939\",\"code\":\"PR\",\"name\":\"Puerto Rico\",\"pattern\":\"1 XXX XXX XXXX\",\"emoji\":\"\"},{\"phoneCode\":\"974\",\"code\":\"QA\",\"name\":\"Qatar\",\"pattern\":\"\",\"emoji\":\"\"},{\"phoneCode\":\"262\",\"code\":\"RE\",\"name\":\"Reunion\",\"pattern\":\"262 XXX XXX XXX\",\"emoji\":\"\"},{\"phoneCode\":\"40\",\"code\":\"RO\",\"name\":\"Romania\",\"pattern\":\"40 XXX XXX XXX\",\"emoji\":\"\"},{\"phoneCode\":\"7\",\"code\":\"RU\",\"name\":\"Russia\",\"pattern\":\"7 XXX XXX XX XX\",\"emoji\":\"\"},{\"phoneCode\":\"250\",\"code\":\"RW\",\"name\":\"Rwanda\",\"pattern\":\"250 XXX XXX XXX\",\"emoji\":\"\"},{\"phoneCode\":\"590\",\"code\":\"BL\",\"name\":\"St. Barthelemy\",\"pattern\":\"\",\"emoji\":\"\"},{\"phoneCode\":\"290\",\"code\":\"SH\",\"name\":\"St. Helena\",\"pattern\":\"290 XX XXX\",\"emoji\":\"\"},{\"phoneCode\":\"1 869\",\"code\":\"KN\",\"name\":\"St. Kitts & Nevis\",\"pattern\":\"1869 XXX XXXX\",\"emoji\":\"\"},{\"phoneCode\":\"1 758\",\"code\":\"LC\",\"name\":\"St. Lucia\",\"pattern\":\"1758 XXX XXXX\",\"emoji\":\"\"},{\"phoneCode\":\"590\",\"code\":\"MF\",\"name\":\"St. Martin (France)\",\"pattern\":\"\",\"emoji\":\"\"},{\"phoneCode\":\"508\",\"code\":\"PM\",\"name\":\"St. Pierre and Miquelon\",\"pattern\":\"\",\"emoji\":\"\"},{\"phoneCode\":\"1 784\",\"code\":\"VC\",\"name\":\"St. Vincent and the Grenadines\",\"pattern\":\"1784 XXX XXXX\",\"emoji\":\"\"},{\"phoneCode\":\"685\",\"code\":\"WS\",\"name\":\"Samoa\",\"pattern\":\"\",\"emoji\":\"\"},{\"phoneCode\":\"378\",\"code\":\"SM\",\"name\":\"San Marino\",\"pattern\":\"378 XXX XXX XXXX\",\"emoji\":\"\"},{\"phoneCode\":\"239\",\"code\":\"ST\",\"name\":\"So Tome & Principe\",\"pattern\":\"239 XX XXXXX\",\"emoji\":\"\"},{\"phoneCode\":\"966\",\"code\":\"SA\",\"name\":\"Saudi Arabia\",\"pattern\":\"\",\"emoji\":\"\"},{\"phoneCode\":\"221\",\"code\":\"SN\",\"name\":\"Senegal\",\"pattern\":\"221 XX XXX XXXX\",\"emoji\":\"\"},{\"phoneCode\":\"381\",\"code\":\"RS\",\"name\":\"Serbia\",\"pattern\":\"381 XX XXX XXXX\",\"emoji\":\"\"},{\"phoneCode\":\"248\",\"code\":\"SC\",\"name\":\"Seychelles\",\"pattern\":\"248 X XX XX XX\",\"emoji\":\"\"},{\"phoneCode\":\"232\",\"code\":\"SL\",\"name\":\"Sierra Leone\",\"pattern\":\"232 XX XXX XXX\",\"emoji\":\"\"},{\"phoneCode\":\"65\",\"code\":\"SG\",\"name\":\"Singapore\",\"pattern\":\"65 XXXX XXXX\",\"emoji\":\"\"},{\"phoneCode\":\"599 3\",\"code\":\"BQ\",\"name\":\"Sint Eustatius\",\"pattern\":\"\",\"emoji\":\"\"},{\"phoneCode\":\"1 721\",\"code\":\"SX\",\"name\":\"Sint Maarten\",\"pattern\":\"1721 XXX XXXX\",\"emoji\":\"\"},{\"phoneCode\":\"421\",\"code\":\"SK\",\"name\":\"Slovakia\",\"pattern\":\"\",\"emoji\":\"\"},{\"phoneCode\":\"386\",\"code\":\"SI\",\"name\":\"Slovenia\",\"pattern\":\"\",\"emoji\":\"\"},{\"phoneCode\":\"677\",\"code\":\"SB\",\"name\":\"Solomon Islands\",\"pattern\":\"\",\"emoji\":\"\"},{\"phoneCode\":\"252\",\"code\":\"SO\",\"name\":\"Somalia\",\"pattern\":\"252 XX XXX XXX\",\"emoji\":\"\"},{\"phoneCode\":\"27\",\"code\":\"ZA\",\"name\":\"South Africa\",\"pattern\":\"27 XX XXX XXXX\",\"emoji\":\"\"},{\"phoneCode\":\"500\",\"code\":\"GS\",\"name\":\"South Georgia & South Sandwich Islands\",\"pattern\":\"\",\"emoji\":\"\"},{\"phoneCode\":\"995 34\",\"code\":\"\",\"name\":\"South Ossetia\",\"pattern\":\"\",\"emoji\":\"\"},{\"phoneCode\":\"211\",\"code\":\"SS\",\"name\":\"South Sudan\",\"pattern\":\"211 XX XXX XXXX\",\"emoji\":\"\"},{\"phoneCode\":\"34\",\"code\":\"ES\",\"name\":\"Spain\",\"pattern\":\"34 XXX XXX XXX\",\"emoji\":\"\"},{\"phoneCode\":\"94\",\"code\":\"LK\",\"name\":\"Sri Lanka\",\"pattern\":\"94 XX XXX XXXX\",\"emoji\":\"\"},{\"phoneCode\":\"249\",\"code\":\"SD\",\"name\":\"Sudan\",\"pattern\":\"249 XX XXX XXXX\",\"emoji\":\"\"},{\"phoneCode\":\"597\",\"code\":\"SR\",\"name\":\"Suriname\",\"pattern\":\"597 XXX XXXX\",\"emoji\":\"\"},{\"phoneCode\":\"47 79\",\"code\":\"SJ\",\"name\":\"Svalbard\",\"pattern\":\"\",\"emoji\":\"\"},{\"phoneCode\":\"268\",\"code\":\"SZ\",\"name\":\"Swaziland\",\"pattern\":\"268 XXXX XXXX\",\"emoji\":\"\"},{\"phoneCode\":\"46\",\"code\":\"SE\",\"name\":\"Sweden\",\"pattern\":\"46 XX XXX XXXX\",\"emoji\":\"\"},{\"phoneCode\":\"41\",\"code\":\"CH\",\"name\":\"Switzerland\",\"pattern\":\"41 XX XXX XXXX\",\"emoji\":\"\"},{\"phoneCode\":\"963\",\"code\":\"SY\",\"name\":\"Syria\",\"pattern\":\"\",\"emoji\":\"\"},{\"phoneCode\":\"886\",\"code\":\"TW\",\"name\":\"Taiwan\",\"pattern\":\"\",\"emoji\":\"\"},{\"phoneCode\":\"992\",\"code\":\"TJ\",\"name\":\"Tajikistan\",\"pattern\":\"\",\"emoji\":\"\"},{\"phoneCode\":\"255\",\"code\":\"TZ\",\"name\":\"Tanzania\",\"pattern\":\"255 XX XXX XXXX\",\"emoji\":\"\"},{\"phoneCode\":\"66\",\"code\":\"TH\",\"name\":\"Thailand\",\"pattern\":\"66 X XXXX XXXX\",\"emoji\":\"\"},{\"phoneCode\":\"228\",\"code\":\"TG\",\"name\":\"Togo\",\"pattern\":\"228 XX XXX XXX\",\"emoji\":\"\"},{\"phoneCode\":\"690\",\"code\":\"TK\",\"name\":\"Tokelau\",\"pattern\":\"\",\"emoji\":\"\"},{\"phoneCode\":\"676\",\"code\":\"TO\",\"name\":\"Tonga\",\"pattern\":\"\",\"emoji\":\"\"},{\"phoneCode\":\"1 868\",\"code\":\"TT\",\"name\":\"Trinidad & Tobago\",\"pattern\":\"1868 XXX XXXX\",\"emoji\":\"\"},{\"phoneCode\":\"216\",\"code\":\"TN\",\"name\":\"Tunisia\",\"pattern\":\"216 XX XXX XXX\",\"emoji\":\"\"},{\"phoneCode\":\"90\",\"code\":\"TR\",\"name\":\"Turkey\",\"pattern\":\"90 XXX XXX XXXX\",\"emoji\":\"\"},{\"phoneCode\":\"993\",\"code\":\"TM\",\"name\":\"Turkmenistan\",\"pattern\":\"993 XX XXXXXX\",\"emoji\":\"\"},{\"phoneCode\":\"1 649\",\"code\":\"TC\",\"name\":\"Turks & Caicos Islands\",\"pattern\":\"1649 XXX XXXX\",\"emoji\":\"\"},{\"phoneCode\":\"688\",\"code\":\"TV\",\"name\":\"Tuvalu\",\"pattern\":\"\",\"emoji\":\"\"},{\"phoneCode\":\"256\",\"code\":\"UG\",\"name\":\"Uganda\",\"pattern\":\"256 XX XXX XXXX\",\"emoji\":\"\"},{\"phoneCode\":\"380\",\"code\":\"UA\",\"name\":\"Ukraine\",\"pattern\":\"380 XX XXX XX XX\",\"emoji\":\"\"},{\"phoneCode\":\"971\",\"code\":\"AE\",\"name\":\"United Arab Emirates\",\"pattern\":\"971 XX XXX XXXX\",\"emoji\":\"\"},{\"phoneCode\":\"44\",\"code\":\"GB\",\"name\":\"United Kingdom\",\"pattern\":\"44 XXXX XXXXXX\",\"emoji\":\"\"},{\"phoneCode\":\"1\",\"code\":\"US\",\"name\":\"United States\",\"pattern\":\"1 XXX XXX XXXX\",\"emoji\":\"\"},{\"phoneCode\":\"598\",\"code\":\"UY\",\"name\":\"Uruguay\",\"pattern\":\"598 XXXX XXXX\",\"emoji\":\"\"},{\"phoneCode\":\"1 340\",\"code\":\"VI\",\"name\":\"U.S. Virgin Islands\",\"pattern\":\"1340 XXX XXXX\",\"emoji\":\"\"},{\"phoneCode\":\"998\",\"code\":\"UZ\",\"name\":\"Uzbekistan\",\"pattern\":\"998 XX XXXXXXX\",\"emoji\":\"\"},{\"phoneCode\":\"678\",\"code\":\"VU\",\"name\":\"Vanuatu\",\"pattern\":\"\",\"emoji\":\"\"},{\"phoneCode\":\"58\",\"code\":\"VE\",\"name\":\"Venezuela\",\"pattern\":\"58 XXX XXX XXXX\",\"emoji\":\"\"},{\"phoneCode\":\"39 06 698\",\"code\":\"VA\",\"name\":\"Vatican City\",\"pattern\":\"\",\"emoji\":\"\"},{\"phoneCode\":\"84\",\"code\":\"VN\",\"name\":\"Vietnam\",\"pattern\":\"\",\"emoji\":\"\"},{\"phoneCode\":\"681\",\"code\":\"WF\",\"name\":\"Wallis & Futuna\",\"pattern\":\"\",\"emoji\":\"\"},{\"phoneCode\":\"967\",\"code\":\"YE\",\"name\":\"Yemen\",\"pattern\":\"967 XXX XXX XXX\",\"emoji\":\"\"},{\"phoneCode\":\"260\",\"code\":\"ZM\",\"name\":\"Zambia\",\"pattern\":\"260 XX XXX XXXX\",\"emoji\":\"\"},{\"phoneCode\":\"255\",\"code\":\"\",\"name\":\"Zanzibar\",\"pattern\":\"\",\"emoji\":\"\"},{\"phoneCode\":\"263\",\"code\":\"ZW\",\"name\":\"Zimbabwe\",\"pattern\":\"263 XX XXX XXXX\",\"emoji\":\"\"}];\nconst PhoneCodesMain: {[phoneCode: string]: Country} = {\n  '1': Countries.find(c => c.name === 'United States'),\n  '44': Countries.find(c => c.name === 'United Kingdom'),\n  '61': Countries.find(c => c.name === 'Australia'),\n  '64': Countries.find(c => c.name === 'New Zealand'),\n  '246': Countries.find(c => c.name === 'Diego Garcia'),\n  '255': Countries.find(c => c.name === 'Tanzania'),\n  '262': Countries.find(c => c.name === 'Reunion'),\n  '500': Countries.find(c => c.name === 'Falkland Islands'),\n  '590': Countries.find(c => c.name === 'Guadeloupe'),\n  '672': Countries.find(c => c.name === 'Norfolk Island'),\n  '1 268': Countries.find(c => c.name === 'Antigua & Barbuda'),\n};\n\n/* \nconst toInt = (str) => {\n  return parseInt(str.replace(/ /g, ''));\n};\nvar arr = window.Countries.sort((a, b) => toInt(a.phoneCode) - toInt(b.phoneCode));\narr.forEach((el, idx) => {\n  if(idx === (arr.length - 1)) {\n    return;\n  }\n\n  if(toInt(arr[idx + 1].phoneCode) === toInt(el.phoneCode)) {\n    console.log('duplicate', el, arr[idx + 1]);\n  }\n});\n*/\n\nMOUNT_CLASS_TO.Countries = Countries;\n\nexport default Countries;\nexport {PhoneCodesMain};","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n * \r\n * Originally from:\r\n * https://github.com/zhukov/webogram\r\n * Copyright (C) 2014 Igor Zhukov <igor.beatle@gmail.com>\r\n * https://github.com/zhukov/webogram/blob/master/LICENSE\r\n */\r\n\r\nimport type { AccountPassword, AccountPasswordInputSettings, AccountUpdatePasswordSettings, InputCheckPasswordSRP, PasswordKdfAlgo } from '../../layer';\r\nimport type CryptoWorkerMethods from '../crypto/crypto_methods';\r\nimport { MOUNT_CLASS_TO } from '../../config/debug';\r\nimport appUsersManager from '../appManagers/appUsersManager';\r\nimport apiManager from './mtprotoworker';\r\n//import { computeCheck } from \"../crypto/srp\";\r\n\r\nexport class PasswordManager {\r\n  public getState(): Promise<AccountPassword> {\r\n    return apiManager.invokeApi('account.getPassword').then((result) => {\r\n      return result;\r\n    });\r\n  }\r\n\r\n  public updateSettings(settings: {\r\n    hint?: string,\r\n    email?: string,\r\n    newPassword?: string,\r\n    currentPassword?: string\r\n  } = {}) {\r\n    //state = Object.assign({}, state);\r\n    //state.new_algo = Object.assign({}, state.new_algo);\r\n\r\n    return this.getState().then(state => {\r\n      let currentHashPromise: ReturnType<CryptoWorkerMethods['computeSRP']>;\r\n      let newHashPromise: Promise<Uint8Array>;\r\n      const params: AccountUpdatePasswordSettings = {\r\n        password: null,\r\n        new_settings: {\r\n          _: 'account.passwordInputSettings',\r\n          hint: settings.hint,\r\n          email: settings.email\r\n        }\r\n      };\r\n  \r\n      if(settings.currentPassword) {\r\n        currentHashPromise = apiManager.computeSRP(settings.currentPassword, state);\r\n      } else {\r\n        currentHashPromise = Promise.resolve({\r\n          _: 'inputCheckPasswordEmpty'\r\n        });\r\n      }\r\n  \r\n      // * https://core.telegram.org/api/srp#setting-a-new-2fa-password, but still there is a mistake, TDesktop passes 'new_algo' everytime\r\n      const newAlgo = state.new_algo as PasswordKdfAlgo.passwordKdfAlgoSHA256SHA256PBKDF2HMACSHA512iter100000SHA256ModPow;\r\n      const salt1 = new Uint8Array(newAlgo.salt1.length + 32);\r\n      salt1.randomize();\r\n      salt1.set(newAlgo.salt1, 0);\r\n      newAlgo.salt1 = salt1;\r\n  \r\n      if(settings.newPassword) {\r\n        newHashPromise = apiManager.computeSRP(settings.newPassword, state, true) as any;\r\n      } else {\r\n        newHashPromise = Promise.resolve(new Uint8Array());\r\n      }\r\n  \r\n      return Promise.all([currentHashPromise, newHashPromise]).then((hashes) => {\r\n        params.password = hashes[0];\r\n        params.new_settings.new_algo = newAlgo;\r\n        params.new_settings.new_password_hash = hashes[1];\r\n  \r\n        return apiManager.invokeApi('account.updatePasswordSettings', params);\r\n      });\r\n    });\r\n  }\r\n\r\n  public check(password: string, state: AccountPassword, options: any = {}) {\r\n    return apiManager.computeSRP(password, state).then((inputCheckPassword) => {\r\n      //console.log('SRP', inputCheckPassword);\r\n      return apiManager.invokeApi('auth.checkPassword', {\r\n        password: inputCheckPassword\r\n      }, options).then(auth => {\r\n        if(auth._ === 'auth.authorization') {\r\n          appUsersManager.saveApiUser(auth.user);\r\n          apiManager.setUserAuth(auth.user.id);\r\n        }\r\n\r\n        return auth;\r\n      });\r\n    });\r\n  }\r\n\r\n  public confirmPasswordEmail(code: string) {\r\n    return apiManager.invokeApi('account.confirmPasswordEmail', {code});\r\n  }\r\n\r\n  public resendPasswordEmail() {\r\n    return apiManager.invokeApi('account.resendPasswordEmail');\r\n  }\r\n\r\n  public cancelPasswordEmail() {\r\n    return apiManager.invokeApi('account.cancelPasswordEmail');\r\n  }\r\n\r\n  /* public requestRecovery(options: any = {}) {\r\n    return apiManager.invokeApi('auth.requestPasswordRecovery', {}, options);\r\n  }\r\n\r\n  public recover(code: any, options: any = {}) {\r\n    return apiManager.invokeApi('auth.recoverPassword', {\r\n      code\r\n    }, options);\r\n  } */\r\n}\r\n\r\nconst passwordManager = new PasswordManager();\r\nMOUNT_CLASS_TO.passwordManager = passwordManager;\r\nexport default passwordManager;\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport { LangPackKey, i18n } from \"../lib/langPack\";\r\n\r\nexport default class LoginPage {\r\n  public element: HTMLElement;\r\n  public container: HTMLElement;\r\n  public imageDiv: HTMLElement;\r\n  public inputWrapper: HTMLElement;\r\n  public title: HTMLElement;\r\n  public subtitle: HTMLParagraphElement;\r\n\r\n  constructor(options: {\r\n    className: string,\r\n    withInputWrapper?: boolean,\r\n    titleLangKey?: LangPackKey,\r\n    subtitleLangKey?: LangPackKey,\r\n  }) {\r\n    this.element = document.body.querySelector('.' + options.className) as HTMLDivElement;\r\n    //this.element = document.createElement('div');\r\n    //this.element.className = 'page-' + options.className;\r\n\r\n    this.container = document.createElement('div');\r\n    this.container.className = 'container center-align';\r\n\r\n    this.imageDiv = document.createElement('div');\r\n    this.imageDiv.className = 'auth-image';\r\n\r\n    this.title = document.createElement('h4');\r\n    if(options.titleLangKey) {\r\n      this.title.append(i18n(options.titleLangKey));\r\n    }\r\n\r\n    this.subtitle = document.createElement('p');\r\n    this.subtitle.className = 'subtitle';\r\n    if(options.subtitleLangKey) {\r\n      this.subtitle.append(i18n(options.subtitleLangKey));\r\n    }\r\n    \r\n    this.container.append(this.imageDiv, this.title, this.subtitle);\r\n\r\n    if(options.withInputWrapper) {\r\n      this.inputWrapper = document.createElement('div');\r\n      this.inputWrapper.className = 'input-wrapper';\r\n      this.container.append(this.inputWrapper);\r\n    }\r\n\r\n    this.element.append(this.container);\r\n  }\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport { cancelEvent } from \"../helpers/dom/cancelEvent\";\r\nimport InputField, { InputFieldOptions } from \"./inputField\";\r\n\r\nexport default class PasswordInputField extends InputField {\r\n  public passwordVisible = false;\r\n  public toggleVisible: HTMLElement;\r\n  public onVisibilityClickAdditional: () => void;\r\n\r\n  constructor(options: InputFieldOptions = {}) {\r\n    super({\r\n      plainText: true,\r\n      ...options\r\n    });\r\n\r\n    const input = this.input as HTMLInputElement;\r\n    input.type = 'password';\r\n    input.setAttribute('required', '');\r\n    input.autocomplete = 'off';\r\n    /* input.readOnly = true;\r\n\r\n    input.addEventListener('focus', () => {\r\n      input.removeAttribute('readonly');\r\n    }, {once: true}); */\r\n\r\n    // * https://stackoverflow.com/a/35949954/6758968\r\n    const stealthy = document.createElement('input');\r\n    stealthy.classList.add('stealthy');\r\n    stealthy.tabIndex = -1;\r\n    stealthy.type = 'password';\r\n    input.parentElement.prepend(stealthy);\r\n    input.parentElement.insertBefore(stealthy.cloneNode(), input.nextSibling);\r\n\r\n    const toggleVisible = this.toggleVisible = document.createElement('span');\r\n    toggleVisible.classList.add('toggle-visible', 'tgico');\r\n\r\n    this.container.classList.add('input-field-password');\r\n    this.container.append(toggleVisible);\r\n\r\n    toggleVisible.addEventListener('click', this.onVisibilityClick);\r\n    toggleVisible.addEventListener('touchend', this.onVisibilityClick);\r\n  }\r\n\r\n  public onVisibilityClick = (e: Event) => {\r\n    cancelEvent(e);\r\n    this.passwordVisible = !this.passwordVisible;\r\n\r\n    this.toggleVisible.classList.toggle('eye-hidden', this.passwordVisible);\r\n    (this.input as HTMLInputElement).type = this.passwordVisible ? 'text' : 'password';\r\n    this.onVisibilityClickAdditional && this.onVisibilityClickAdditional();\r\n  };\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n * \r\n * Originally from:\r\n * https://github.com/zhukov/webogram\r\n * Copyright (C) 2014 Igor Zhukov <igor.beatle@gmail.com>\r\n * https://github.com/zhukov/webogram/blob/master/LICENSE\r\n */\r\n\r\nimport cleanSearchText from '../helpers/cleanSearchText';\r\n\r\nexport default class SearchIndex<SearchWhat> {\r\n  private fullTexts: Map<SearchWhat, string> = new Map();\r\n\r\n  // minChars can be 0 because it requires at least one word (one symbol) to be found\r\n  constructor(private cleanText = true, private latinize = true, private minChars: number = 0) {\r\n\r\n  }\r\n\r\n  public indexObject(id: SearchWhat, searchText: string) {\r\n    /* if(searchIndex.fullTexts.hasOwnProperty(id)) {\r\n      return false;\r\n    } */\r\n\r\n    if(searchText.trim() && this.cleanText) {\r\n      searchText = cleanSearchText(searchText, this.latinize);\r\n    }\r\n\r\n    if(!searchText) {\r\n      this.fullTexts.delete(id);\r\n      return false;\r\n    }\r\n\r\n    this.fullTexts.set(id, searchText);\r\n    \r\n    /* const shortIndexes = searchIndex.shortIndexes;\r\n    searchText.split(' ').forEach((searchWord) => {\r\n      let len = Math.min(searchWord.length, 3),\r\n        wordPart, i;\r\n      for(i = 1; i <= len; i++) {\r\n        wordPart = searchWord.substr(0, i);\r\n        if(shortIndexes[wordPart] === undefined) {\r\n          shortIndexes[wordPart] = [id];\r\n        } else {\r\n          shortIndexes[wordPart].push(id);\r\n        }\r\n      }\r\n    }); */\r\n  }\r\n\r\n  public search(query: string) {\r\n    const fullTexts = this.fullTexts;\r\n    //const shortIndexes = searchIndex.shortIndexes;\r\n\r\n    if(this.cleanText) {\r\n      query = cleanSearchText(query, this.latinize);\r\n    }\r\n\r\n    const newFoundObjs: Array<{fullText: string, fullTextLength: number, what: SearchWhat, foundChars: number}> = [];\r\n    const queryWords = query.split(' ');\r\n    const queryWordsLength = queryWords.length;\r\n    fullTexts.forEach((fullText, what) => {\r\n      let found = true;\r\n      let foundChars = 0;\r\n      for(let i = 0; i < queryWordsLength; ++i) { // * verify that all words are found\r\n        const word = queryWords[i];\r\n        const idx = fullText.indexOf(word);\r\n        if(idx === -1 || (idx !== 0 && fullText[idx - 1] !== ' ')) { // * search only from word beginning\r\n          found = false;\r\n          break;\r\n        }\r\n\r\n        foundChars += word.length;\r\n      }\r\n\r\n      if(found) {\r\n        foundChars += queryWordsLength - 1;\r\n        const fullTextLength = fullText.length;\r\n        if(this.minChars <= foundChars || fullTextLength <= foundChars) {\r\n          newFoundObjs.push({fullText, fullTextLength, what, foundChars});\r\n        }\r\n      }\r\n    });\r\n\r\n    newFoundObjs.sort((a, b) => a.fullTextLength - b.fullTextLength || b.foundChars - a.foundChars);\r\n\r\n    //newFoundObjs.sort((a, b) => a.fullText.localeCompare(b.fullText));\r\n    const newFoundObjs2: Set<SearchWhat> = new Set(newFoundObjs.map(o => o.what));\r\n\r\n    /* const queryWords = query.split(' ');\r\n    let foundArr: number[];\r\n    for(let i = 0; i < queryWords.length; i++) {\r\n      const newFound = shortIndexes[queryWords[i].substr(0, 3)];\r\n      if(!newFound) {\r\n        foundArr = [];\r\n        break;\r\n      }\r\n      \r\n      if(foundArr === undefined || foundArr.length > newFound.length) {\r\n        foundArr = newFound;\r\n      }\r\n    }\r\n\r\n    for(let j = 0; j < foundArr.length; j++) {\r\n      let found = true;\r\n      let searchText = fullTexts[foundArr[j]];\r\n      for(let i = 0; i < queryWords.length; i++) {\r\n        if(searchText.indexOf(queryWords[i]) === -1) {\r\n          found = false;\r\n          break;\r\n        }\r\n      }\r\n\r\n      if(found) {\r\n        newFoundObjs[foundArr[j]] = true;\r\n      }\r\n    } */\r\n\r\n    return newFoundObjs2;\r\n  }\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport lottieLoader, { RLottiePlayer } from \"../../lib/lottieLoader\";\r\nimport PasswordInputField from \"../passwordInputField\";\r\n\r\nexport default class PasswordMonkey {\r\n  public container: HTMLElement;\r\n  public animation: RLottiePlayer;\r\n  public needFrame = 0;\r\n  protected loadPromise: Promise<void>;\r\n\r\n  constructor(protected passwordInputField: PasswordInputField, protected size: number) {\r\n    this.container = document.createElement('div');\r\n    this.container.classList.add('media-sticker-wrapper');\r\n  }\r\n\r\n  public load() {\r\n    if(this.loadPromise) return this.loadPromise;\r\n    return this.loadPromise = lottieLoader.loadAnimationFromURL({\r\n      container: this.container,\r\n      loop: false,\r\n      autoplay: false,\r\n      width: this.size,\r\n      height: this.size,\r\n      noCache: true\r\n    //}, 'assets/img/TwoFactorSetupMonkeyClose.tgs').then(_animation => {\r\n    }, 'assets/img/TwoFactorSetupMonkeyPeek.tgs').then(_animation => {\r\n      //return;\r\n      this.animation = _animation;\r\n      this.animation.addEventListener('enterFrame', currentFrame => {\r\n        //console.log('enterFrame', currentFrame, this.needFrame);\r\n\r\n        if((this.animation.direction === 1 && currentFrame >= this.needFrame) ||\r\n          (this.animation.direction === -1 && currentFrame <= this.needFrame)) {\r\n            this.animation.setSpeed(1);\r\n            this.animation.pause();\r\n        } \r\n      });\r\n\r\n      this.passwordInputField.onVisibilityClickAdditional = () => {\r\n        if(this.passwordInputField.passwordVisible) {\r\n          this.animation.setDirection(1);\r\n          this.animation.curFrame = 0;\r\n          this.needFrame = 16;\r\n          this.animation.play();\r\n        } else {\r\n          this.animation.setDirection(-1);\r\n          this.animation.curFrame = 16;\r\n          this.needFrame = 0;\r\n          this.animation.play();\r\n        }\r\n      };\r\n\r\n      return lottieLoader.waitForFirstFrame(_animation);\r\n    });\r\n  }\r\n\r\n  public remove() {\r\n    if(this.animation) {\r\n      this.animation.remove();\r\n    }\r\n  }\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n * \r\n * Originally from:\r\n * https://github.com/zhukov/webogram\r\n * Copyright (C) 2014 Igor Zhukov <igor.beatle@gmail.com>\r\n * https://github.com/zhukov/webogram/blob/master/LICENSE\r\n */\r\n\r\nimport Config from \"../lib/config\";\r\n\r\nconst badCharsRe = /[`~!@#$%^&*()\\-_=+\\[\\]\\\\|{}'\";:\\/?.>,<]+/g;\r\nconst trimRe = /^\\s+|\\s$/g;\r\n\r\nexport default function cleanSearchText(text: string, latinize = true) {\r\n  const hasTag = text.charAt(0) === '%';\r\n  text = text.replace(badCharsRe, '').replace(trimRe, '');\r\n  if(latinize) {\r\n    text = text.replace(/[^A-Za-z0-9]/g, (ch) => {\r\n      const latinizeCh = Config.LatinizeMap[ch];\r\n      return latinizeCh !== undefined ? latinizeCh : ch;\r\n    });\r\n  }\r\n  \r\n  text = text.toLowerCase();\r\n  if(hasTag) {\r\n    text = '%' + text;\r\n  }\r\n\r\n  return text;\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\n/**\r\n * Legacy Webogram's format, don't change dcID to camelCase. date is timestamp\r\n */\r\nexport type UserAuth = {dcID: number | string, date: number, id: number};\r\n\r\nexport const REPLIES_PEER_ID = 1271266957;\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nexport default function htmlToSpan(html: string) {\r\n  const span = document.createElement('span');\r\n  span.innerHTML = html;\r\n  return span;\r\n}\r\n"],"sourceRoot":""}