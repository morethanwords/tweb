import{b as r,a3 as x,i as _,h as y,t as k,am as $,bI as F,cH as S,cL as G,bi as K,Z as O,c as R,a1 as H,bz as V,a7 as P,aB as q,c3 as j,aD as z,ae as J,af as B,c4 as W,az as Z,ad as E,bG as Q,a9 as X}from"./index-DfTYkYxh.js";import{G as T,H as w,R as m,J as Y,K as M,M as ee,N as te,E as re}from"./appDialogsManager-ChFFjUti.js";import{u as se,S as ne}from"./saveButton-wEIk-hap.js";import{T as N}from"./chatBackground-DVGnHfQ0.js";import{u as ae}from"./useStarsCommissionAndWithdrawalPrice-C5BOjAML.js";import{S as oe}from"./starsRangeInput-CTLJD48X.js";import"./page-BamLxGNn.js";import"./avatar-BryH42q2.js";import"./putPreloader-QnwUs36x.js";import"./classNames-B6PjWW0V.js";import"./htmlToSpan-DhAls8qz.js";import"./_commonjsHelpers-Cpj98o6Y.js";import"./textToSvgURL-Cnw_Q8Rw.js";import"./iconTsx-j2e5Z_SD.js";import"./fastBlur-Co-79rP4.js";import"./countryInputField-DgfJ9iqb.js";import"./codeInputField-CMD-FCtI.js";import"./useAppConfig-d-2eHE_C.js";var p=(e=>(e[e.Everybody=1]="Everybody",e[e.ContactsAndPremium=2]="ContactsAndPremium",e[e.Paid=3]="Paid",e))(p||{});const D="inputPrivacyKeyNoPaidMessages",ie=[{_:"inputPrivacyValueAllowContacts"}],f=120,ce=k("<span class=primary>"),le=k("<div>"),ue=e=>{const[n,{AppAddMembersTab:a}]=T(),{commissionPercents:o,willReceiveDollars:d}=ae(()=>e.store.stars),i=()=>{n.slider.createTab(a).open({type:"privacy",skippable:!0,title:"PaidMessages.RemoveFee",placeholder:"PrivacyModal.Search.Placeholder",takeOut:s=>{e.setStore("chosenPeers",s)},selectedPeerIds:[...e.store.chosenPeers]})},l=()=>{if(!e.store.chosenPeers.length)return y("PrivacySettingsController.AddUsers");const{users:s,chats:u}=e.chosenPeersByType;return $([s.length?y("Users",[s.length]):null,u.length?y("Chats",[u.length]):null].filter(Boolean),!1)};return r(N,{onEnter:async(s,u)=>{const t=s;t.style.opacity="0",await e.exitAnimationPromise,await t.animate({opacity:[0,1]},{duration:f}).finished,t.style.removeProperty("opacity"),u()},onExit:async(s,u)=>{await s.animate({opacity:[1,0]},{duration:f}).finished,u()},get children(){return r(x,{get when(){return e.isPaid},get children(){const s=le();return _(s,r(w,{name:"PaidMessages.SetPrice",caption:"PaidMessages.SetPriceDescription",get captionArgs(){return[o(),d()]},get children(){return r(oe,{get value(){return e.store.stars},get onChange(){return e.setStore.bind(null,"stars")}})}}),null),_(s,r(w,{name:"PrivacyExceptions",caption:"PaidMessages.RemoveFeeDescription",get children(){return r(m,{clickable:i,get children(){return[r(m.Title,{get children(){return y("PaidMessages.RemoveFee")}}),r(m.RightContent,{get children(){const u=ce();return _(u,l),u}})]}})}}),null),s}})}})},I=F("useSaveSettings"),de=({store:e,globalPrivacy:n,isPaid:a,hasChanges:o,chosenPeersByType:d})=>{const{rootScope:i}=S(),[l]=T(),s=()=>{const c=structuredClone(n());c.noncontact_peers_paid_stars=a()?e.stars:0,c.pFlags??(c.pFlags={}),Y(c.pFlags,"new_noncontact_peers_require_premium",e.option===p.ContactsAndPremium),I("saving settings :>> ",c);const h=i.managers.appPrivacyManager.setGlobalPrivacySettings(c);return l.payload.onSaved(h),h},u=async()=>{const c=[],{chats:h,users:g}=d();return c.push(...ie),h.length&&c.push({_:"inputPrivacyValueAllowChatParticipants",chats:h}),g.length&&c.push({_:"inputPrivacyValueAllowUsers",users:await Promise.all(g.map(C=>i.managers.appUsersManager.getUserInput(C)))}),I("saving rules :>> ",c),i.managers.appPrivacyManager.setPrivacy(D,c)};let t=!1;return async()=>{if(!(t||!o())){t=!0;try{await Promise.all([s(),a()?u():void 0]),l.close()}finally{t=!1}}}},me="_Radio_8rde5_36",ge="_floating_8rde5_62",pe="_checked_8rde5_66",b={Radio:me,floating:ge,checked:pe},he=k("<span>"),A=e=>{const[n,a]=G(e,["checked","floating","class","classList"]);return(()=>{const o=he();return K(o,O({get class(){return b.Radio},get classList(){return{[n.class]:!!n.class,[b.checked]:n.checked,[b.floating]:n.floating,"offset-left":n.floating,...n.classList}}},a),!1,!1),o})()},L=()=>{const{rootScope:e}=S(),[n,a]=R(e.premium),o=new V;return o.add(e)("premium_toggle",d=>{a(d)}),H(()=>{o.removeAll()}),n},Pe=10,ye=e=>{const{PopupPremium:n}=S(),a=L(),o=i=>()=>{if(a())return i();ee({langPackKey:"PrivacySettings.Messages.PremiumError",langPackArguments:[M(()=>{te(),n.show({feature:"message_privacy"})})]})},d=r(N,{mode:"outin",onEnter:async(i,l)=>{await i.animate({opacity:[0,1]},{duration:f}).finished,l()},onExit:async(i,l)=>{const s=i.animate({opacity:[1,0]},{duration:f}).finished;e.onExitAnimationPromise(s),await s,l()},get children(){return P(()=>!e.isPaid)()?y("Privacy.MessagesInfo",[M(()=>void n.show())]):y("PaidMessages.ChargeForMessagesDescription")}});return r(w,{name:"PrivacyMessagesTitle",caption:d,get children(){return[r(m,{clickable:()=>{e.setStore("option",p.Everybody)},get children(){return[r(m.CheckboxField,{get children(){return r(A,{floating:!0,get checked(){return e.store.option===p.Everybody}})}}),r(m.Title,{get children(){return y("PrivacySettingsController.Everbody")}})]}}),r(m,{get clickable(){return o(()=>{e.setStore("option",p.ContactsAndPremium)})},get children(){return[P(()=>P(()=>!!a())()&&r(m.CheckboxField,{get children(){return r(A,{floating:!0,get checked(){return e.store.option===p.ContactsAndPremium}})}})),P(()=>P(()=>!a())()&&r(m.Icon,{icon:"premium_lock"})),r(m.Title,{get children(){return y("Privacy.ContactsAndPremium")}})]}}),r(m,{get clickable(){return o(()=>{e.setStore(i=>({option:p.Paid,stars:i.stars||Pe}))})},get children(){return[P(()=>P(()=>!!a())()&&r(m.CheckboxField,{get children(){return r(A,{floating:!0,get checked(){return e.isPaid}})}})),P(()=>P(()=>!a())()&&r(m.Icon,{icon:"premium_lock"})),r(m.Title,{get children(){return y("PaidMessages.ChargeForMessages")}})]}})]}})},ve=({isReady:e,globalPrivacy:n,currentOption:a,currentAllowedChats:o,currentAllowedUsers:d})=>{let i={};const[l,s]=q({});j(()=>{e()&&(i={option:a(),stars:Number(n().noncontact_peers_paid_stars)||void 0,chosenPeers:[...d(),...o()]},s(z(structuredClone(i))))});const[u,t]=R(!1),v=J(t,200,!0);B(()=>{const g=c()?[]:["chosenPeers","stars"];v(!W(l,i,g))});const c=Z(()=>l.option===p.Paid);return[l,s,{hasChanges:u,isPaid:c,chosenPeersByType:()=>({chats:l.chosenPeers.filter(g=>g.isAnyChat()).map(g=>g.toChatId()),users:l.chosenPeers.filter(g=>g.isUser())})}]},fe=e=>e instanceof Object?e.user_id?.toPeerId(!0):e.toPeerId(!0),Se=()=>{const{rootScope:e}=S(),n=re(),a=L(),[o]=E(()=>{const t=e.managers.appPrivacyManager.getPrivacy(D);return n.collect(t),t}),[d]=E(()=>{const t=e.managers.appPrivacyManager.getGlobalPrivacySettings();return n.collect(t),t});return{isReady:()=>o.state==="ready"&&d.state==="ready",globalPrivacy:d,privacyRules:o,currentOption:()=>a()?d().noncontact_peers_paid_stars?p.Paid:d().pFlags.new_noncontact_peers_require_premium?p.ContactsAndPremium:p.Everybody:p.Everybody,currentAllowedUsers:()=>o()?.filter(t=>t._==="privacyValueAllowUsers")?.map(t=>t?.users).flat()?.map(t=>t.toPeerId())||[],currentAllowedChats:()=>o()?.find(t=>t._==="privacyValueAllowChatParticipants")?.chats?.map(fe)?.filter(t=>t!==void 0)||[]}},U=F("MessagesPrivacyTab"),$e=()=>{const[e]=T(),{isReady:n,globalPrivacy:a,privacyRules:o,currentOption:d,currentAllowedUsers:i,currentAllowedChats:l}=Se(),[s,u,{isPaid:t,hasChanges:v,chosenPeersByType:c}]=ve({isReady:n,globalPrivacy:a,currentOption:d,currentAllowedChats:l,currentAllowedUsers:i}),h=de({store:s,globalPrivacy:a,isPaid:t,hasChanges:v,chosenPeersByType:c});e.isConfirmationNeededOnClose=se({hasChanges:v,saveAllSettings:h,descriptionLangKey:"UnsavedChangesDescription.Privacy"});const[g,C]=R();return Q&&B(()=>{U("privacyRules() :>> ",o()),U("globalPrivacy() :>> ",a())}),r(x,{get when(){return n()},get children(){return[r(X,{get mount(){return e.header},get children(){return r(ne,{get hasChanges(){return v()},onClick:()=>void h()})}}),r(ye,{get isPaid(){return t()},store:s,setStore:u,onExitAnimationPromise:C}),r(ue,{get isPaid(){return t()},store:s,setStore:u,get chosenPeersByType(){return c()},get exitAnimationPromise(){return g()}})]}})};export{$e as default};
//# sourceMappingURL=tab-DzybUpeO.js.map
