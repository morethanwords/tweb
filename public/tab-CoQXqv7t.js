import{b as o,a2 as E,t as b,i as v,j as P,al as O,dg as C,bB as D,cC as G,bb as V,Z as j,c as T,bs as q,a3 as H,a6 as f,ax as z,ez as W,ay as Z,ae as J,ad as K,bT as Q,ac as I,bz as X,a8 as Y,a1 as ee,C as te,a9 as re}from"./index-CBlIzVyW.js";import{I as se}from"./iconTsx-DTKeAgcD.js";import{c as ne,a as M,S as R,R as S,b as U,t as ae,h as oe,u as ie}from"./appDialogsManager-GRFV80Nd.js";import{T as x}from"./chatBackground-DUNCOPy1.js";import{u as ce,S as le}from"./starsRangeInput-Jv9ztc59.js";import"./classNames-Cq3cMY-q.js";import"./page-BA7RofvY.js";import"./avatar-Bt8osNfK.js";import"./putPreloader-DmzaPURu.js";import"./htmlToSpan-DhAls8qz.js";import"./textToSvgURL-Cnw_Q8Rw.js";import"./fastBlur-Co-79rP4.js";import"./countryInputField-RFD69yuT.js";import"./_commonjsHelpers-Cpj98o6Y.js";import"./codeInputField-Be9Kll_V.js";const ue=({hasChanges:e,saveAllSettings:t})=>async()=>{if(!e())return;const r={langKey:"Save"};try{await ne({titleLangKey:"UnsavedChanges",descriptionLangKey:"UnsavedChangesDescription.Privacy",button:r,buttons:[r,{isCancel:!0,langKey:"Discard"}],rejectWithReason:!0}),t()}catch(n){if(n==="closed")throw new Error}},F=(e=!1)=>async(t,r)=>{const n=["scale(0)","scale(1)"];e&&n.reverse(),await t.animate({transform:n},{duration:80}).finished,r()},de=e=>o(x,{get onEnter(){return F()},get onExit(){return F(!0)},get children(){return e.children}});var m=(e=>(e[e.Everybody=1]="Everybody",e[e.ContactsAndPremium=2]="ContactsAndPremium",e[e.Paid=3]="Paid",e))(m||{});const L="inputPrivacyKeyNoPaidMessages",ge=[{_:"inputPrivacyValueAllowContacts"}],_=120;var me=b("<div>"),pe=b("<span class=primary>");const Pe=e=>{const[t,{AppAddMembersTab:r}]=M(),{commissionPercents:n,willReceiveDollars:l}=ce(()=>e.store.stars),i=()=>{t.slider.createTab(r).open({type:"privacy",skippable:!0,title:"PaidMessages.RemoveFee",placeholder:"PrivacyModal.Search.Placeholder",takeOut:a=>{e.setStore("chosenPeers",a)},selectedPeerIds:[...e.store.chosenPeers]})},u=()=>{if(!e.store.chosenPeers.length)return P("PrivacySettingsController.AddUsers");const{users:a,chats:d}=e.chosenPeersByType;return O([a.length?P("Users",[a.length]):null,d.length?P("Chats",[d.length]):null].filter(Boolean),!1)};return o(x,{onEnter:async(a,d)=>{const s=a;s.style.opacity="0",await e.exitAnimationPromise,await s.animate({opacity:[0,1]},{duration:_}).finished,s.style.removeProperty("opacity"),d()},onExit:async(a,d)=>{await a.animate({opacity:[1,0]},{duration:_}).finished,d()},get children(){return o(E,{get when(){return e.isPaid},get children(){var a=me();return v(a,o(R,{name:"PaidMessages.SetPrice",caption:"PaidMessages.SetPriceDescription",get captionArgs(){return[n(),l()]},get children(){return o(le,{get value(){return e.store.stars},get onChange(){return e.setStore.bind(null,"stars")}})}}),null),v(a,o(R,{name:"PrivacyExceptions",caption:"PaidMessages.RemoveFeeDescription",get children(){return o(S,{get title(){return P("PaidMessages.RemoveFee")},get rightContent(){return(()=>{var d=pe();return v(d,u),d})()},clickable:i})}}),null),a}})}})};function he(e,t,r){r?e[t]=!0:delete e[t]}const $=D("useSaveSettings"),ye=({store:e,globalPrivacy:t,isPaid:r,hasChanges:n,chosenPeersByType:l})=>{const{rootScope:i}=C(),[u]=M(),a=()=>{const c=structuredClone(t());c.noncontact_peers_paid_stars=r()?e.stars:0,c.pFlags??(c.pFlags={}),he(c.pFlags,"new_noncontact_peers_require_premium",e.option===m.ContactsAndPremium),$("saving settings :>> ",c);const p=i.managers.appPrivacyManager.setGlobalPrivacySettings(c);return u.payload.onSaved(p),p},d=async()=>{const c=[],{chats:p,users:g}=l();return c.push(...ge),p.length&&c.push({_:"inputPrivacyValueAllowChatParticipants",chats:p}),g.length&&c.push({_:"inputPrivacyValueAllowUsers",users:await Promise.all(g.map(A=>i.managers.appUsersManager.getUserInput(A)))}),$("saving rules :>> ",c),i.managers.appPrivacyManager.setPrivacy(L,c)};let s=!1;return async()=>{if(!(s||!n())){s=!0;try{await Promise.all([a(),r()?d():void 0]),u.close()}finally{s=!1}}}},ve="_Radio_8rde5_36",fe="_floating_8rde5_62",Se="_checked_8rde5_66",w={Radio:ve,floating:fe,checked:Se};var _e=b("<span>");const k=e=>{const[t,r]=G(e,["checked","floating","class","classList"]);return(()=>{var n=_e();return V(n,j({get class(){return w.Radio},get classList(){return{[t.class]:!!t.class,[w.checked]:t.checked,[w.floating]:t.floating,"offset-left":t.floating,...t.classList}}},r),!1,!1),n})()},N=()=>{const{rootScope:e}=C(),[t,r]=T(e.premium),n=new q;return n.add(e)("premium_toggle",l=>{r(l)}),H(()=>{n.removeAll()}),t},be=10,Ce=e=>{const{PopupPremium:t}=C(),r=N(),n=i=>()=>{if(r())return i();ae({langPackKey:"PrivacySettings.Messages.PremiumError",langPackArguments:[U(()=>{oe(),t.show({feature:"message_privacy"})})]})},l=o(x,{mode:"outin",onEnter:async(i,u)=>{await i.animate({opacity:[0,1]},{duration:_}).finished,u()},onExit:async(i,u)=>{const a=i.animate({opacity:[1,0]},{duration:_}).finished;e.onExitAnimationPromise(a),await a,u()},get children(){return f(()=>!e.isPaid)()?P("Privacy.MessagesInfo",[U(()=>void t.show())]):P("PaidMessages.ChargeForMessagesDescription")}});return o(R,{name:"PrivacyMessagesTitle",caption:l,get children(){return[o(S,{get checkboxField(){return o(k,{floating:!0,get checked(){return e.store.option===m.Everybody}})},clickable:()=>{e.setStore("option",m.Everybody)},get title(){return P("PrivacySettingsController.Everbody")}}),o(S,{get checkboxField(){return f(()=>!!r())()&&o(k,{floating:!0,get checked(){return e.store.option===m.ContactsAndPremium}})},get icon(){return r()?void 0:"premium_lock"},get clickable(){return n(()=>{e.setStore("option",m.ContactsAndPremium)})},get title(){return P("Privacy.ContactsAndPremium")}}),o(S,{get checkboxField(){return f(()=>!!r())()&&o(k,{floating:!0,get checked(){return e.isPaid}})},get icon(){return r()?void 0:"premium_lock"},get clickable(){return n(()=>{e.setStore(i=>({option:m.Paid,stars:i.stars||be}))})},get title(){return P("PaidMessages.ChargeForMessages")}})]}})},Ae=({isReady:e,globalPrivacy:t,currentOption:r,currentAllowedChats:n,currentAllowedUsers:l})=>{let i={};const[u,a]=z({});W(()=>{e()&&(i={option:r(),stars:Number(t().noncontact_peers_paid_stars)||void 0,chosenPeers:[...l(),...n()]},a(Z(structuredClone(i))))});const[d,s]=T(!1),h=J(s,200,!0);K(()=>{const g=c()?[]:["chosenPeers","stars"];h(!Q(u,i,g))});const c=f(()=>u.option===m.Paid);return[u,a,{hasChanges:d,isPaid:c,chosenPeersByType:()=>({chats:u.chosenPeers.filter(g=>g.isAnyChat()).map(g=>g.toChatId()),users:u.chosenPeers.filter(g=>g.isUser())})}]},we=e=>e instanceof Object?e.user_id?.toPeerId(!0):e.toPeerId(!0),ke=()=>{const{rootScope:e}=C(),t=ie(),r=N(),[n]=I(()=>{const s=e.managers.appPrivacyManager.getPrivacy(L);return t.collect(s),s}),[l]=I(()=>{const s=e.managers.appPrivacyManager.getGlobalPrivacySettings();return t.collect(s),s});return{isReady:()=>n.state==="ready"&&l.state==="ready",globalPrivacy:l,privacyRules:n,currentOption:()=>r()?l().noncontact_peers_paid_stars?m.Paid:l().pFlags.new_noncontact_peers_require_premium?m.ContactsAndPremium:m.Everybody:m.Everybody,currentAllowedUsers:()=>n()?.filter(s=>s._==="privacyValueAllowUsers")?.map(s=>s?.users).flat()?.map(s=>s.toPeerId())||[],currentAllowedChats:()=>n()?.find(s=>s._==="privacyValueAllowChatParticipants")?.chats?.map(we)?.filter(s=>s!==void 0)||[]}};var Ee=b('<button class="btn-icon blue">');const B=D("MessagesPrivacyTab"),Ve=()=>{const[e]=M(),{isReady:t,globalPrivacy:r,privacyRules:n,currentOption:l,currentAllowedUsers:i,currentAllowedChats:u}=ke(),[a,d,{isPaid:s,hasChanges:h,chosenPeersByType:c}]=Ae({isReady:t,globalPrivacy:r,currentOption:l,currentAllowedChats:u,currentAllowedUsers:i}),p=ye({store:a,globalPrivacy:r,isPaid:s,hasChanges:h,chosenPeersByType:c});e.isConfirmationNeededOnClose=ue({hasChanges:h,saveAllSettings:p});const[g,A]=T();return X&&K(()=>{B("privacyRules() :>> ",n()),B("globalPrivacy() :>> ",r())}),o(E,{get when(){return t()},get children(){return[o(Y,{get mount(){return e.header},get children(){return o(de,{get children(){return o(E,{get when(){return h()},get children(){var y=Ee();return y.$$click=()=>void p(),ee(te,y,()=>!0),v(y,o(se,{icon:"check"})),y}})}})}}),o(Ce,{get isPaid(){return s()},store:a,setStore:d,onExitAnimationPromise:A}),o(Pe,{get isPaid(){return s()},store:a,setStore:d,get chosenPeersByType(){return c()},get exitAnimationPromise(){return g()}})]}})};re(["click"]);export{Ve as default};
//# sourceMappingURL=tab-CoQXqv7t.js.map
