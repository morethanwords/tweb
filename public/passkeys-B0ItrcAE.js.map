{"version":3,"file":"passkeys-B0ItrcAE.js","sources":["../src/components/sidebarLeft/tabs/passkeys.tsx"],"sourcesContent":["import Section from '@components/section';\nimport {useSuperTab} from '@components/solidJsTabs/superTabProvider';\nimport type {AppPasskeysTab} from '@components/solidJsTabs';\nimport anchorCallback from '@helpers/dom/anchorCallback';\nimport StickerAndTitle from '@components/stickerAndTitle';\nimport {createEffect, createSignal, For, Show} from 'solid-js';\nimport {formatFullSentTime} from '@helpers/date';\nimport createMiddleware from '@helpers/solid/createMiddleware';\nimport styles from '@components/sidebarLeft/tabs/passkeys.module.scss';\nimport {Passkey} from '@layer';\nimport showPasskeyPopup, {createPasskey} from '@components/popups/passkey';\nimport IS_WEB_AUTHN_SUPPORTED from '@environment/webAuthn';\nimport Button from '@components/buttonTsx';\nimport {useHotReloadGuard} from '@lib/solidjs/hotReloadGuard';\nimport findAndSplice from '@helpers/array/findAndSplice';\nimport {useAppConfig} from '@stores/appState';\n\ntype AppPasskeysTabClass = typeof AppPasskeysTab;\n\nconst PasskeyItem = (passkey: Passkey) => {\n  const [tab] = useSuperTab<AppPasskeysTabClass>();\n  const {rootScope, wrapEmojiText, wrapAdaptiveCustomEmoji, Row, i18n, confirmationPopup, formatDate} = useHotReloadGuard();\n  const [disabled, setDisabled] = createSignal(false);\n  const subtitle = () => {\n    const created = i18n('Privacy.Passkey.Created', [formatDate(new Date(passkey.date * 1000), {withTime: true})]);\n    if(!passkey.last_usage_date) return created;\n    const lastUsed = i18n('Privacy.Passkey.LastUsage', [formatDate(new Date(passkey.last_usage_date * 1000), {withTime: true})]);\n    return [created, ' â€¢ ', lastUsed];\n  };\n  return (\n    <Row\n      disabled={disabled()}\n      contextMenu={{\n        buttons: [{\n          icon: 'delete',\n          text: 'Delete',\n          onClick: async() => {\n            await confirmationPopup({\n              titleLangKey: 'Passkey.Deletion.Title',\n              descriptionLangKey: 'Passkey.Deletion.Text',\n              button: {\n                langKey: 'Delete',\n                isDanger: true\n              }\n            });\n\n            setDisabled(true);\n            rootScope.managers.appAccountManager.deletePasskey(passkey.id).finally(() => {\n              tab.payload.setPasskeys((passkeys) => {\n                const arr = [...passkeys];\n                findAndSplice(arr, (item) => item.id === passkey.id);\n                return arr;\n              });\n            });\n          },\n          danger: true\n        }]\n      }}\n    >\n      <Show when={!passkey.software_emoji_id}>\n        <Row.Icon icon=\"key\" />\n      </Show>\n      <Row.Title class=\"text-bold\">{wrapEmojiText(passkey.name)}</Row.Title>\n      <Row.Subtitle>{subtitle()}</Row.Subtitle>\n      <Show when={passkey.software_emoji_id}>\n        <Row.Media size=\"abitbigger\">\n          {wrapAdaptiveCustomEmoji({\n            docId: passkey.software_emoji_id,\n            size: 42,\n            wrapOptions: {\n              middleware: createMiddleware().get()\n            }\n          }).container}\n        </Row.Media>\n      </Show>\n    </Row>\n  );\n};\n\nconst PasskeysTab = () => {\n  const [tab] = useSuperTab<AppPasskeysTabClass>();\n  const {i18n} = useHotReloadGuard();\n  const appConfig = useAppConfig();\n\n  const onCreation = (passkey: Passkey) => {\n    tab.payload.setPasskeys((passkeys) => {\n      const arr = [...passkeys];\n      arr.unshift(passkey);\n      return arr;\n    });\n  };\n\n  createEffect(() => {\n    if(!tab.payload.passkeys.length && !IS_WEB_AUTHN_SUPPORTED) {\n      tab.close();\n    }\n  });\n\n  return (\n    <Section\n      class={styles.container}\n      caption=\"Privacy.Passkeys.Caption\"\n      captionArgs={[anchorCallback(() => showPasskeyPopup(onCreation))]}\n    >\n      <StickerAndTitle\n        sticker={{name: 'key', size: 100}}\n        subtitle={i18n('Passkey.Subtitle')}\n        subtitleSecondary\n      />\n      <div class={styles.items}>\n        <For each={tab.payload.passkeys}>\n          {PasskeyItem}\n        </For>\n        <Show\n          when={\n            IS_WEB_AUTHN_SUPPORTED &&\n            tab.payload.passkeys.length < appConfig.passkeys_account_passkeys_max\n          }\n        >\n          <Button\n            text=\"Privacy.Passkey.Create\"\n            primaryTransparent\n            icon=\"add\"\n            onClick={() => createPasskey().then(onCreation)}\n          />\n        </Show>\n      </div>\n    </Section>\n  );\n};\n\nexport default PasskeysTab;\n"],"names":["PasskeyItem","passkey","tab","useSuperTab","rootScope","wrapEmojiText","wrapAdaptiveCustomEmoji","Row","i18n","confirmationPopup","formatDate","useHotReloadGuard","disabled","setDisabled","createSignal","subtitle","created","Date","date","withTime","last_usage_date","lastUsed","_$createComponent","contextMenu","buttons","icon","text","onClick","titleLangKey","descriptionLangKey","button","langKey","isDanger","managers","appAccountManager","deletePasskey","id","finally","payload","setPasskeys","passkeys","arr","findAndSplice","item","danger","children","Show","when","software_emoji_id","Icon","Title","name","Subtitle","Media","size","docId","wrapOptions","middleware","createMiddleware","get","container","PasskeysTab","appConfig","useAppConfig","onCreation","unshift","createEffect","length","IS_WEB_AUTHN_SUPPORTED","close","Section","styles","caption","captionArgs","anchorCallback","showPasskeyPopup","StickerAndTitle","sticker","subtitleSecondary","_el$","_tmpl$","_$insert","For","each","passkeys_account_passkeys_max","Button","primaryTransparent","createPasskey","then","_$effect","_$className","items"],"mappings":"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"}