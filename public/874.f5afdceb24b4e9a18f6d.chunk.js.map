{"version":3,"file":"874.f5afdceb24b4e9a18f6d.chunk.js","mappings":"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MAAO,KAAO,MAAO,KAAO,MAAO,KAAO,MAAO,KAAO,MAAO,KAAO,MAAO,YAAY,MAAO,YAAY,MAAO,YAAY,MAAO,YAAY,MAAO,YAAY,MAAO,YAAY,MAAO,YAAY,MAAO,YAAY,MAAO,YAAY,MAAO,YAAY,MAAO,YAAY,MAAO,YAAY,MAAO,OAAO,MAAO,OAAO,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,KAAM,QAAQ,MAAO,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,MAAO,QAAQ,KAAM,QAAQ,MAAO,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,MAAO,QAAQ,MAAO,QAAQ,KAAM,QAAQ,MAAO,QAAQ,MAAO,QAAQ,KAAM,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,KAAM,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,KAAM,kBAAkB,KAAM,kBAAkB,KAAM,QAAQ,KAAM,kBAAkB,KAAM,kBAAkB,KAAM,QAAQ,KAAM,QAAQ,MAAO,QAAQ,MAAO,QAAQ,KAAM,QAAQ,MAAO,QAAQ,MAAO,kBAAkB,KAAM,kBAAkB,KAAM,QAAQ,KAAM,kBAAkB,KAAM,kBAAkB,KAAM,QAAQ,KAAM,kBAAkB,KAAM,kBAAkB,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,MAAO,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,MAAO,QAAQ,KAAM,QAAQ,KAAM,mBAAmB,MAAO,kBAAkB,MAAO,QAAQ,MAAO,kBAAkB,MAAO,4CAA4C,MAAO,4CAA4C,MAAO,4CAA4C,MAAO,QAAQ,MAAO,QAAQ,KAAM,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,kBAAkB,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,mBAAmB,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,kBAAkB,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,mBAAmB,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,mBAAmB,KAAM,mBAAmB,KAAM,mBAAmB,KAAM,mBAAmB,KAAM,mBAAmB,KAAM,mBAAmB,KAAM,mBAAmB,KAAM,mBAAmB,KAAM,8BAA8B,KAAM,mBAAmB,KAAM,8BAA8B,KAAM,8BAA8B,KAAM,mBAAmB,KAAM,8BAA8B,KAAM,yCAAyC,KAAM,8BAA8B,KAAM,yCAAyC,KAAM,yCAAyC,KAAM,8BAA8B,KAAM,yCAAyC,KAAM,8BAA8B,KAAM,yCAAyC,KAAM,yCAAyC,KAAM,mBAAmB,KAAM,mBAAmB,KAAM,mBAAmB,KAAM,mBAAmB,KAAM,mBAAmB,KAAM,mBAAmB,KAAM,mBAAmB,KAAM,mBAAmB,KAAM,mBAAmB,KAAM,mBAAmB,KAAM,mBAAmB,KAAM,mBAAmB,KAAM,mBAAmB,KAAM,kBAAkB,KAAM,kBAAkB,KAAM,kBAAkB,KAAM,6BAA6B,KAAM,wCAAwC,KAAM,QAAQ,KAAM,mBAAmB,KAAM,mBAAmB,KAAM,mBAAmB,KAAM,mBAAmB,KAAM,mBAAmB,KAAM,mBAAmB,KAAM,mBAAmB,KAAM,mBAAmB,KAAM,8BAA8B,KAAM,mBAAmB,KAAM,8BAA8B,KAAM,8BAA8B,KAAM,mBAAmB,KAAM,8BAA8B,KAAM,yCAAyC,KAAM,8BAA8B,KAAM,yCAAyC,KAAM,yCAAyC,KAAM,mBAAmB,KAAM,mBAAmB,KAAM,mBAAmB,KAAM,mBAAmB,KAAM,mBAAmB,KAAM,mBAAmB,KAAM,mBAAmB,KAAM,mBAAmB,KAAM,mBAAmB,KAAM,mBAAmB,KAAM,mBAAmB,KAAM,mBAAmB,KAAM,mBAAmB,KAAM,kBAAkB,KAAM,kBAAkB,KAAM,kBAAkB,KAAM,6BAA6B,KAAM,6BAA6B,KAAM,wCAAwC,KAAM,wCAAwC,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,kBAAkB,KAAM,kBAAkB,KAAM,QAAQ,KAAM,kBAAkB,KAAM,kBAAkB,KAAM,QAAQ,KAAM,kBAAkB,KAAM,kBAAkB,KAAM,QAAQ,KAAM,kBAAkB,KAAM,kBAAkB,KAAM,QAAQ,KAAM,QAAQ,KAAM,kBAAkB,KAAM,kBAAkB,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,kBAAkB,KAAM,kBAAkB,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,kBAAkB,KAAM,kBAAkB,KAAM,QAAQ,KAAM,kBAAkB,KAAM,kBAAkB,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,MAAO,QAAQ,KAAM,kBAAkB,KAAM,kBAAkB,KAAM,QAAQ,KAAM,kBAAkB,KAAM,kBAAkB,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,MAAO,QAAQ,MAAO,QAAQ,KAAM,QAAQ,KAAM,QAAQ,MAAO,QAAQ,MAAO,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,MAAO,QAAQ,MAAO,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,MAAO,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,KAAM,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,KAAM,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,MAAO,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,MAAO,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,kBAAkB,KAAM,kBAAkB,KAAM,QAAQ,KAAM,QAAQ,MAAO,QAAQ,KAAM,QAAQ,KAAM,QAAQ,MAAO,QAAQ,KAAM,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,MAAO,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,MAAO,QAAQ,GAAI,QAAQ,GAAI,QAAQ,GAAI,QAAQ,GAAI,QAAQ,GAAI,QAAQ,GAAI,QAAQ,GAAI,QAAQ,IAAK,QAAQ,KAAM,QAAQ,IAAK,QAAQ,IAAK,QAAQ,IAAK,QAAQ,IAAK,QAAQ,IAAK,QAAQ,IAAK,QAAQ,IAAK,QAAQ,IAAK,QAAQ,IAAK,QAAQ,IAAK,QAAQ,IAAK,QAAQ,IAAK,QAAQ,IAAK,QAAQ,IAAK,QAAQ,IAAK,QAAQ,IAAK,QAAQ,IAAK,QAAQ,IAAK,QAAQ,IAAK,QAAQ,IAAK,QAAQ,IAAK,QAAQ,IAAK,QAAQ,IAAK,QAAQ,KAAM,QAAQ,KAAM,QAAQ,IAAK,QAAQ,IAAK,QAAQ,IAAK,QAAQ,IAAK,QAAQ,IAAK,QAAQ,IAAK,QAAQ,IAAK,QAAQ,IAAK,QAAQ,IAAK,QAAQ,IAAK,QAAQ,IAAK,QAAQ,IAAK,mBAAmB,IAAK,QAAQ,IAAK,QAAQ,IAAK,QAAQ,IAAK,QAAQ,IAAK,QAAQ,IAAK,QAAQ,IAAK,QAAQ,IAAK,mBAAmB,IAAK,QAAQ,IAAK,mBAAmB,IAAK,QAAQ,IAAK,QAAQ,IAAK,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,IAAK,QAAQ,GAAI,QAAQ,IAAK,QAAQ,IAAK,kBAAkB,KAAM,kBAAkB,KAAM,QAAQ,KAAM,kBAAkB,KAAM,kBAAkB,KAAM,QAAQ,KAAM,kBAAkB,KAAM,kBAAkB,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,kBAAkB,KAAM,kBAAkB,KAAM,QAAQ,KAAM,QAAQ,KAAM,kBAAkB,KAAM,kBAAkB,KAAM,QAAQ,KAAM,kBAAkB,KAAM,kBAAkB,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,kBAAkB,KAAM,kBAAkB,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,KAAM,QAAQ,MAAO,kBAAkB,KAAM,kBAAkB,KAAM,QAAQ,KAAM,kBAAkB,KAAM,kBAAkB,KAAM,QAAQ,KAAM,kBAAkB,KAAM,kBAAkB,KAAM,QAAQ,KAAM,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,KAAM,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,KAAM,QAAQ,MAAO,QAAQ,KAAM,QAAQ,MAAO,QAAQ,MAAO,QAAQ,KAAM,QAAQ,MAAO,QAAQ,KAAM,QAAQ,KAAM,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,MAAO,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,IAAK,QAAQ,IAAK,QAAQ,IAAK,QAAQ,IAAK,QAAQ,IAAK,QAAQ,IAAK,QAAQ,KAAM,QAAQ,IAAK,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,IAAK,QAAQ,KAAM,QAAQ,IAAK,QAAQ,GAAI,QAAQ,IAAK,QAAQ,IAAK,kBAAkB,KAAM,kBAAkB,KAAM,QAAQ,KAAM,QAAQ,IAAK,QAAQ,IAAK,QAAQ,IAAK,QAAQ,IAAK,QAAQ,IAAK,QAAQ,KAAM,QAAQ,IAAK,QAAQ,IAAK,QAAQ,IAAK,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,kBAAkB,KAAM,kBAAkB,KAAM,QAAQ,KAAM,QAAQ,KAAM,kBAAkB,KAAM,kBAAkB,KAAM,QAAQ,KAAM,kBAAkB,KAAM,kBAAkB,KAAM,QAAQ,KAAM,kBAAkB,KAAM,kBAAkB,KAAM,QAAQ,KAAM,QAAQ,KAAM,kBAAkB,KAAM,kBAAkB,KAAM,QAAQ,KAAM,kBAAkB,KAAM,kBAAkB,KAAM,QAAQ,KAAM,kBAAkB,KAAM,kBAAkB,KAAM,QAAQ,KAAM,QAAQ,MAAO,QAAQ,KAAM,QAAQ,MAAO,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,IAAK,QAAQ,IAAK,QAAQ,IAAK,QAAQ,IAAK,QAAQ,IAAK,QAAQ,IAAK,QAAQ,IAAK,QAAQ,KAAM,QAAQ,IAAK,QAAQ,IAAK,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,MAAO,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,kBAAkB,KAAM,kBAAkB,KAAM,QAAQ,KAAM,kBAAkB,KAAM,kBAAkB,KAAM,QAAQ,KAAM,QAAQ,MAAO,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,kBAAkB,KAAM,kBAAkB,KAAM,QAAQ,KAAM,kBAAkB,KAAM,kBAAkB,KAAM,QAAQ,KAAM,kBAAkB,KAAM,kBAAkB,KAAM,QAAQ,KAAM,QAAQ,IAAK,mBAAmB,KAAM,mBAAmB,KAAM,mBAAmB,KAAM,mBAAmB,KAAM,mBAAmB,KAAM,mBAAmB,KAAM,mBAAmB,KAAM,mBAAmB,KAAM,mBAAmB,KAAM,mBAAmB,KAAM,mBAAmB,KAAM,mBAAmB,KAAM,mBAAmB,KAAM,mBAAmB,KAAM,mBAAmB,KAAM,8BAA8B,KAAM,mBAAmB,KAAM,mBAAmB,KAAM,mBAAmB,KAAM,mBAAmB,KAAM,mBAAmB,KAAM,mBAAmB,KAAM,mBAAmB,KAAM,kBAAkB,KAAM,kBAAkB,KAAM,kBAAkB,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,kBAAkB,KAAM,kBAAkB,KAAM,QAAQ,KAAM,QAAQ,KAAM,kBAAkB,KAAM,kBAAkB,KAAM,QAAQ,KAAM,kBAAkB,KAAM,kBAAkB,KAAM,QAAQ,KAAM,kBAAkB,KAAM,kBAAkB,KAAM,QAAQ,KAAM,kBAAkB,KAAM,kBAAkB,KAAM,QAAQ,KAAM,kBAAkB,KAAM,kBAAkB,KAAM,QAAQ,KAAM,kBAAkB,KAAM,kBAAkB,KAAM,QAAQ,KAAM,kBAAkB,KAAM,kBAAkB,KAAM,QAAQ,KAAM,kBAAkB,KAAM,kBAAkB,KAAM,QAAQ,KAAM,kBAAkB,KAAM,kBAAkB,KAAM,QAAQ,KAAM,kBAAkB,KAAM,kBAAkB,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,KAAM,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,KAAM,QAAQ,MAAO,QAAQ,KAAM,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,KAAM,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,KAAM,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,OAAO,MAAO,OAAO,MAAO,OAAO,MAAO,OAAO,KAAM,OAAO,KAAM,OAAO,MAAO,OAAO,MAAO,OAAO,MAAO,OAAO,MAAO,OAAO,MAAO,OAAO,MAAO,OAAO,MAAO,OAAO,MAAO,OAAO,KAAM,OAAO,KAAM,OAAO,KAAM,OAAO,KAAM,OAAO,MAAO,OAAO,MAAO,OAAO,MAAO,OAAO,MAAO,OAAO,MAAO,OAAO,MAAO,OAAO,MAAO,OAAO,MAAO,OAAO,MAAO,OAAO,MAAO,OAAO,MAAO,OAAO,MAAO,OAAO,MAAO,OAAO,KAAM,OAAO,MAAO,OAAO,MAAO,OAAO,MAAO,OAAO,IAAK,OAAO,MAAO,OAAO,MAAO,OAAO,MAAO,OAAO,MAAO,OAAO,MAAO,OAAO,MAAO,OAAO,MAAO,OAAO,MAAO,OAAO,MAAO,OAAO,MAAO,OAAO,MAAO,OAAO,MAAO,OAAO,MAAO,OAAO,MAAO,OAAO,MAAO,OAAO,MAAO,OAAO,MAAO,OAAO,MAAO,OAAO,MAAO,OAAO,MAAO,OAAO,MAAO,OAAO,MAAO,OAAO,KAAM,OAAO,KAAO,OAAO,MAAO,OAAO,MAAO,OAAO,MAAO,OAAO,MAAO,OAAO,MAAO,OAAO,KAAM,OAAO,KAAM,OAAO,KAAM,OAAO,MAAO,OAAO,KAAM,OAAO,MAAO,OAAO,KAAM,OAAO,KAAM,OAAO,KAAM,OAAO,MAAO,iBAAiB,KAAM,iBAAiB,KAAM,OAAO,KAAM,OAAO,KAAM,OAAO,KAAM,OAAO,KAAM,OAAO,KAAM,OAAO,KAAM,OAAO,KAAM,OAAO,MAAO,OAAO,MAAO,OAAO,MAAO,OAAO,MAAO,kBAAkB,KAAM,kBAAkB,KAAM,OAAO,MAAO,OAAO,MAAO,OAAO,MAAO,OAAO,MAAO,OAAO,MAAO,OAAO,MAAO,OAAO,MAAO,OAAO,MAAO,OAAO,KAAM,OAAO,MAAO,OAAO,MAAO,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,aAAa,EAAG,aAAa,EAAG,aAAa,EAAG,aAAa,EAAG,aAAa,EAAG,uBAAuB,EAAG,uBAAuB,EAAG,uBAAuB,EAAG,uBAAuB,EAAG,uBAAuB,EAAG,uBAAuB,EAAG,uBAAuB,EAAG,uBAAuB,EAAG,uBAAuB,EAAG,uBAAuB,EAAG,aAAa,EAAG,aAAa,EAAG,aAAa,EAAG,aAAa,EAAG,aAAa,EAAG,aAAa,EAAG,aAAa,EAAG,aAAa,EAAG,aAAa,EAAG,aAAa,EAAG,aAAa,EAAG,aAAa,EAAG,aAAa,EAAG,aAAa,EAAG,aAAa,EAAG,aAAa,EAAG,aAAa,EAAG,aAAa,EAAG,aAAa,EAAG,aAAa,EAAG,aAAa,EAAG,aAAa,EAAG,aAAa,EAAG,a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","sources":["webpack://tweb/./src/components/animationIntersector.ts","webpack://tweb/./src/components/appMediaPlaybackController.ts","webpack://tweb/./src/components/appMediaViewer.ts","webpack://tweb/./src/lib/mediaPlayer.ts","webpack://tweb/./src/components/appMediaViewerBase.ts","webpack://tweb/./src/helpers/fillPropertyValue.ts","webpack://tweb/./src/components/appNavigationController.ts","webpack://tweb/./src/components/appSearch.ts","webpack://tweb/./src/components/appSearchSuper..ts","webpack://tweb/./src/helpers/dom/lockTouchScroll.ts","webpack://tweb/./src/components/appSelectPeers.ts","webpack://tweb/./src/components/audio.ts","webpack://tweb/./src/helpers/avatarListLoader.ts","webpack://tweb/./src/components/appMediaViewerAvatar.ts","webpack://tweb/./src/components/avatar.ts","webpack://tweb/./src/components/avatarEdit.ts","webpack://tweb/./src/components/button.ts","webpack://tweb/./src/components/buttonCorner.ts","webpack://tweb/./src/components/buttonIcon.ts","webpack://tweb/./src/components/buttonMenu.ts","webpack://tweb/./src/components/buttonMenuToggle.ts","webpack://tweb/./src/components/chat/gradientRenderer.ts","webpack://tweb/./src/helpers/easing/easeOutQuad.ts","webpack://tweb/./src/components/chat/replyContainer.ts","webpack://tweb/./src/components/chat/selection.ts","webpack://tweb/./src/helpers/dom/getSelectedText.ts","webpack://tweb/./src/components/checkboxField.ts","webpack://tweb/./src/components/codeInputField.ts","webpack://tweb/./src/components/confirmationPopup.ts","webpack://tweb/./src/components/countryInputField.ts","webpack://tweb/./src/components/divAndCaption.ts","webpack://tweb/./src/components/editPeer.ts","webpack://tweb/./src/components/emoticonsDropdown/tabs/gifs.ts","webpack://tweb/./src/components/sidebarRight/tabs/gifs.ts","webpack://tweb/./src/components/sidebarRight/tabs/stickers.ts","webpack://tweb/./src/components/emoticonsDropdown/index.ts","webpack://tweb/./src/components/emoticonsDropdown/tabs/emoji.ts","webpack://tweb/./src/lib/richTextProcessor/wrapSingleEmoji.ts","webpack://tweb/./src/components/lazyLoadQueueRepeat.ts","webpack://tweb/./src/components/emoticonsDropdown/tabs/stickers.ts","webpack://tweb/./src/components/generateFakeIcon.ts","webpack://tweb/./src/components/lazyLoadQueueRepeat2.ts","webpack://tweb/./src/components/gifsMasonry.ts","webpack://tweb/./src/components/horizontalMenu.ts","webpack://tweb/./src/components/inputField.ts","webpack://tweb/./src/helpers/dom/selectElementContents.ts","webpack://tweb/./src/components/inputSearch.ts","webpack://tweb/./src/components/lazyLoadQueue.ts","webpack://tweb/./src/components/lazyLoadQueueIntersector.ts","webpack://tweb/./src/components/mediaProgressLine.ts","webpack://tweb/./src/components/middleEllipsis.ts","webpack://tweb/./src/components/monkeys/password.ts","webpack://tweb/./src/components/monkeys/tracking.ts","webpack://tweb/./src/components/passwordInputField.ts","webpack://tweb/./src/components/peerProfileAvatars.ts","webpack://tweb/./src/components/peerProfile.ts","webpack://tweb/./src/components/generateTitleIcons.ts","webpack://tweb/./src/components/generateVerifiedIcon.ts","webpack://tweb/./src/components/generatePremiumIcon.ts","webpack://tweb/./src/components/peerTitle.ts","webpack://tweb/./src/components/popups/avatar.ts","webpack://tweb/./src/lib/cropper.ts","webpack://tweb/./src/components/popups/deleteDialog.ts","webpack://tweb/./src/components/popups/deleteMessages.ts","webpack://tweb/./src/components/popups/forward.ts","webpack://tweb/./src/components/popups/index.ts","webpack://tweb/./src/components/popups/mute.ts","webpack://tweb/./src/components/popups/peer.ts","webpack://tweb/./src/components/popups/pickUser.ts","webpack://tweb/./src/components/popups/sendNow.ts","webpack://tweb/./src/components/popups/stickers.ts","webpack://tweb/./src/components/preloader.ts","webpack://tweb/./src/components/groupedLayout.ts","webpack://tweb/./src/components/prepareAlbum.ts","webpack://tweb/./src/components/putPhoto.ts","webpack://tweb/./src/components/wrappers/getPeerInitials.ts","webpack://tweb/./src/components/putPreloader.ts","webpack://tweb/./src/components/radioField.ts","webpack://tweb/./src/components/radioForm.ts","webpack://tweb/./src/components/rangeSelector.ts","webpack://tweb/./src/components/ripple.ts","webpack://tweb/./src/components/row.ts","webpack://tweb/./src/components/scrollable.ts","webpack://tweb/./src/components/sidebarLeft/tabs/newGroup.ts","webpack://tweb/./src/lib/appManagers/utils/privacy/privacyType.ts","webpack://tweb/./src/lib/appManagers/utils/privacy/getPrivacyRulesDetails.ts","webpack://tweb/./src/components/privacySection.ts","webpack://tweb/./src/components/sidebarLeft/tabs/privacy/phoneNumber.ts","webpack://tweb/./src/helpers/dom/anchorCopy.ts","webpack://tweb/./src/components/sidebarLeft/tabs/2fa/passwordSet.ts","webpack://tweb/./src/helpers/dom/canFocus.ts","webpack://tweb/./src/components/sidebarLeft/tabs/2fa/emailConfirmation.ts","webpack://tweb/./src/components/sidebarLeft/tabs/2fa/email.ts","webpack://tweb/./src/components/sidebarLeft/tabs/2fa/hint.ts","webpack://tweb/./src/components/sidebarLeft/tabs/2fa/reEnterPassword.ts","webpack://tweb/./src/components/sidebarLeft/tabs/2fa/enterPassword.ts","webpack://tweb/./src/components/sidebarLeft/tabs/2fa/index.ts","webpack://tweb/./src/components/sidebarLeft/tabs/privacy/lastSeen.ts","webpack://tweb/./src/components/sidebarLeft/tabs/privacy/profilePhoto.ts","webpack://tweb/./src/components/sidebarLeft/tabs/privacy/forwardMessages.ts","webpack://tweb/./src/components/sidebarLeft/tabs/privacy/addToGroups.ts","webpack://tweb/./src/components/sidebarLeft/tabs/privacy/calls.ts","webpack://tweb/./src/components/sidebarLeft/tabs/activeSessions.ts","webpack://tweb/./src/components/sidebarLeft/tabs/blockedUsers.ts","webpack://tweb/./src/helpers/string/convertKeyToInputKey.ts","webpack://tweb/./src/components/sidebarLeft/tabs/privacy/voices.ts","webpack://tweb/./src/components/sidebarLeft/tabs/privacyAndSecurity.ts","webpack://tweb/./src/helpers/averageColor.ts","webpack://tweb/./src/helpers/highlightningColor.ts","webpack://tweb/./src/components/colorPicker.ts","webpack://tweb/./src/components/sidebarLeft/tabs/backgroundColor.ts","webpack://tweb/./src/components/sidebarLeft/tabs/background.ts","webpack://tweb/./src/helpers/files/requestFile.ts","webpack://tweb/./src/components/sidebarLeft/tabs/quickReaction.ts","webpack://tweb/./src/components/sidebarLeft/tabs/generalSettings.ts","webpack://tweb/./src/helpers/eachMinute.ts","webpack://tweb/./src/helpers/eachTimeout.ts","webpack://tweb/./src/components/sidebarLeft/tabs/editProfile.ts","webpack://tweb/./src/components/sidebarLeft/tabs/notifications.ts","webpack://tweb/./src/components/sidebarLeft/tabs/language.ts","webpack://tweb/./src/components/sidebarLeft/tabs/autoDownload/photo.ts","webpack://tweb/./src/components/sidebarLeft/tabs/autoDownload/file.ts","webpack://tweb/./src/components/sidebarLeft/tabs/autoDownload/video.ts","webpack://tweb/./src/components/sidebarLeft/tabs/dataAndStorage.ts","webpack://tweb/./src/components/sidebarLeft/tabs/settings.ts","webpack://tweb/./src/components/sidebarLeft/tabs/newChannel.ts","webpack://tweb/./src/components/popups/createContact.ts","webpack://tweb/./src/components/sidebarLeft/tabs/contacts.ts","webpack://tweb/./src/components/sidebarLeft/tabs/archivedTab.ts","webpack://tweb/./src/components/sidebarLeft/tabs/peopleNearby.ts","webpack://tweb/./src/components/sidebarLeft/index.ts","webpack://tweb/./src/components/sidebarLeft/tabs/addMembers.ts","webpack://tweb/./src/components/sidebarLeft/tabs/chatFolders.ts","webpack://tweb/./src/components/sidebarLeft/tabs/includedChats.ts","webpack://tweb/./src/components/sidebarLeft/tabs/editFolder.ts","webpack://tweb/./src/components/sidebarRight/index.ts","webpack://tweb/./src/components/sidebarRight/tabs/editContact.ts","webpack://tweb/./src/components/sidebarRight/tabs/chatType.ts","webpack://tweb/./src/components/sidebarRight/tabs/userPermissions.ts","webpack://tweb/./src/components/sidebarRight/tabs/groupPermissions.ts","webpack://tweb/./src/lib/appManagers/utils/chats/combineParticipantBannedRights.ts","webpack://tweb/./src/components/sidebarRight/tabs/chatReactions.ts","webpack://tweb/./src/components/sidebarRight/tabs/editChat.ts","webpack://tweb/./src/components/sidebarRight/tabs/sharedMedia.ts","webpack://tweb/./src/components/singleTransition.ts","webpack://tweb/./src/components/slider.ts","webpack://tweb/./src/components/sliderTab.ts","webpack://tweb/./src/components/sortedUserList.ts","webpack://tweb/./src/components/stackedAvatars.ts","webpack://tweb/./src/components/stickerViewer.ts","webpack://tweb/./src/components/stickyIntersector.ts","webpack://tweb/./src/components/swipeHandler.ts","webpack://tweb/./src/components/telInputField.ts","webpack://tweb/./src/components/toast.ts","webpack://tweb/./src/components/transition.ts","webpack://tweb/./src/lib/richTextProcessor/isUsernameValid.ts","webpack://tweb/./src/components/usernameInputField.ts","webpack://tweb/./src/components/visibilityIntersector.ts","webpack://tweb/./src/components/volumeSelector.ts","webpack://tweb/./src/components/wrappers/photo.ts","webpack://tweb/./src/components/wrappers/video.ts","webpack://tweb/./src/components/wrappers/album.ts","webpack://tweb/./src/components/wrappers/document.ts","webpack://tweb/./src/components/wrappers/groupedDocuments.ts","webpack://tweb/./src/components/sidebarRight/tabs/pollResults.ts","webpack://tweb/./src/components/poll.ts","webpack://tweb/./src/components/wrappers/poll.ts","webpack://tweb/./src/components/wrappers/reply.ts","webpack://tweb/./src/components/wrappers/stickerSetThumb.ts","webpack://tweb/./src/components/wrappers/stickerToRow.ts","webpack://tweb/./src/components/wrappers/formatUserPhone.ts","webpack://tweb/./src/components/wrappers/getChatMembersString.ts","webpack://tweb/./src/components/wrappers/getPeerTitle.ts","webpack://tweb/./src/components/wrappers/getUserStatusString.ts","webpack://tweb/./src/components/wrappers/joinVoiceChatAnchor.ts","webpack://tweb/./src/components/wrappers/messageActionTextNewUnsafe.ts","webpack://tweb/./src/components/wrappers/messageActionTextNew.ts","webpack://tweb/./src/components/wrappers/messageForReply.ts","webpack://tweb/./src/components/wrappers/peerTitle.ts","webpack://tweb/./src/components/wrappers/senderToPeer.ts","webpack://tweb/./src/components/wrappers/sentTime.ts","webpack://tweb/./src/components/wrappers/sticker.ts","webpack://tweb/./src/helpers/bytes/getPathFromBytes.ts","webpack://tweb/./src/helpers/computeLockColor.ts","webpack://tweb/./src/components/wrappers/stickerAnimation.ts","webpack://tweb/./src/components/wrappers/stickerEmoji.ts","webpack://tweb/./src/components/wrappers/webPageDescription.ts","webpack://tweb/./src/components/wrappers/webPageTitle.ts","webpack://tweb/./src/config/currencies.ts","webpack://tweb/./src/config/emoji.ts","webpack://tweb/./src/config/font.ts","webpack://tweb/./src/helpers/animation.ts","webpack://tweb/./src/helpers/array/accumulate.ts","webpack://tweb/./src/helpers/array/filterAsync.ts","webpack://tweb/./src/helpers/array/findAndSpliceAll.ts","webpack://tweb/./src/helpers/audioAssetPlayer.ts","webpack://tweb/./src/helpers/blob/readBlobAsDataURL.ts","webpack://tweb/./src/helpers/heavyQueue.ts","webpack://tweb/./src/helpers/blur.ts","webpack://tweb/./src/helpers/bytes/getPreviewURLFromBytes.ts","webpack://tweb/./src/helpers/bytes/bytesToDataURL.ts","webpack://tweb/./src/helpers/calcImageInBox.ts","webpack://tweb/./src/helpers/canvas/getTextWidth.ts","webpack://tweb/./src/helpers/canvas/scaleMediaElement.ts","webpack://tweb/./src/helpers/cleanSearchText.ts","webpack://tweb/./src/helpers/clipboard.ts","webpack://tweb/./src/helpers/contextMenuController.ts","webpack://tweb/./src/helpers/date.ts","webpack://tweb/./src/helpers/dom/attachContextMenuListener.ts","webpack://tweb/./src/helpers/dom/attachGrabListeners.ts","webpack://tweb/./src/helpers/dom/cancelSelection.ts","webpack://tweb/./src/helpers/dom/clickEvent.ts","webpack://tweb/./src/helpers/dom/controlsHover.ts","webpack://tweb/./src/helpers/dom/createStickersContextMenu.ts","webpack://tweb/./src/helpers/dom/createContextMenu.ts","webpack://tweb/./src/helpers/dom/createVideo.ts","webpack://tweb/./src/helpers/dom/customProperties.ts","webpack://tweb/./src/helpers/dom/dispatchEvent.ts","webpack://tweb/./src/helpers/dom/documentFragmentToHTML.ts","webpack://tweb/./src/helpers/dom/findUpAsChild.ts","webpack://tweb/./src/helpers/dom/findUpAttribute.ts","webpack://tweb/./src/helpers/dom/findUpTag.ts","webpack://tweb/./src/helpers/dom/fullScreen.ts","webpack://tweb/./src/helpers/dom/getRichElementValue.ts","webpack://tweb/./src/helpers/dom/getRichValue.ts","webpack://tweb/./src/helpers/dom/getViewportSlice.ts","webpack://tweb/./src/helpers/dom/getVisibleRect.ts","webpack://tweb/./src/helpers/dom/handleHorizontalSwipe.ts","webpack://tweb/./src/helpers/dom/handleTabSwipe.ts","webpack://tweb/./src/helpers/dom/htmlToDocumentFragment.ts","webpack://tweb/./src/helpers/dom/htmlToSpan.ts","webpack://tweb/./src/helpers/dom/isInDOM.ts","webpack://tweb/./src/helpers/dom/isInputEmpty.ts","webpack://tweb/./src/helpers/dom/isSendShortcutPressed.ts","webpack://tweb/./src/helpers/dom/isSwipingBackSafari.ts","webpack://tweb/./src/helpers/dom/placeCaretAtEnd.ts","webpack://tweb/./src/helpers/dom/positionElementByIndex.ts","webpack://tweb/./src/helpers/dom/renderImageFromUrl.ts","webpack://tweb/./src/helpers/dom/renderMediaWithFadeIn.ts","webpack://tweb/./src/helpers/dom/replaceContent.ts","webpack://tweb/./src/helpers/dom/setInnerHTML.ts","webpack://tweb/./src/helpers/dom/toggleDisability.ts","webpack://tweb/./src/helpers/dom/whichChild.ts","webpack://tweb/./src/helpers/dropdownHover.ts","webpack://tweb/./src/helpers/fastSmoothScroll.ts","webpack://tweb/./src/helpers/fileName.ts","webpack://tweb/./src/helpers/filterChatPhotosMessages.ts","webpack://tweb/./src/helpers/formatBytes.ts","webpack://tweb/./src/helpers/formatCallDuration.ts","webpack://tweb/./src/helpers/formatDuration.ts","webpack://tweb/./src/helpers/formatPhoneNumber.ts","webpack://tweb/./src/helpers/generatePathData.ts","webpack://tweb/./src/helpers/getImageFromStrippedThumb.ts","webpack://tweb/./src/helpers/getPreviewURLFromThumb.ts","webpack://tweb/./src/helpers/getStrippedThumbIfNeeded.ts","webpack://tweb/./src/helpers/listLoader.ts","webpack://tweb/./src/helpers/listenerSetter.ts","webpack://tweb/./src/helpers/mediaSize.ts","webpack://tweb/./src/helpers/mediaSizes.ts","webpack://tweb/./src/helpers/middlewarePromise.ts","webpack://tweb/./src/helpers/number/clamp.ts","webpack://tweb/./src/helpers/number/formatNumber.ts","webpack://tweb/./src/helpers/number/numberThousandSplitter.ts","webpack://tweb/./src/helpers/onMediaLoad.ts","webpack://tweb/./src/helpers/overlayClickHandler.ts","webpack://tweb/./src/helpers/paymentsWrapCurrencyAmount.ts","webpack://tweb/./src/helpers/positionMenu.ts","webpack://tweb/./src/helpers/restrictions.ts","webpack://tweb/./src/helpers/saveLottiePreview.ts","webpack://tweb/./src/helpers/schedulers/throttleWithRaf.ts","webpack://tweb/./src/helpers/schedulers/throttleWith.ts","webpack://tweb/./src/helpers/scrollableLoader.ts","webpack://tweb/./src/helpers/searchListLoader.ts","webpack://tweb/./src/lib/appManagers/utils/messageId/incrementMessageId.ts","webpack://tweb/./src/helpers/sequentialDom.ts","webpack://tweb/./src/helpers/setAttachmentSize.ts","webpack://tweb/./src/helpers/sortedList.ts","webpack://tweb/./src/helpers/string/encodeEntities.ts","webpack://tweb/./src/helpers/string/escapeRegExp.ts","webpack://tweb/./src/helpers/string/limitSymbols.ts","webpack://tweb/./src/helpers/string/toHHMMSS.ts","webpack://tweb/./src/helpers/windowSize.ts","webpack://tweb/./src/hooks/useHeavyAnimationCheck.ts","webpack://tweb/./src/components/dialogsContextMenu.ts","webpack://tweb/./src/components/connectionStatus.ts","webpack://tweb/./src/components/sendingStatus.ts","webpack://tweb/./src/helpers/easing/easeInOutSine.ts","webpack://tweb/./src/helpers/canvas/roundRect.ts","webpack://tweb/./src/components/groupCallActiveIcon.ts","webpack://tweb/./src/helpers/canvas/shimmer.ts","webpack://tweb/./src/helpers/dialogsPlaceholder.ts","webpack://tweb/./src/helpers/canvas/drawCircle.ts","webpack://tweb/./src/lib/appManagers/appDialogsManager.ts","webpack://tweb/./src/lib/appManagers/appDownloadManager.ts","webpack://tweb/./src/helpers/dom/createDownloadAnchor.ts","webpack://tweb/./src/components/chat/bubbleGroups.ts","webpack://tweb/./src/helpers/array/partition.ts","webpack://tweb/./src/components/popups/datePicker.ts","webpack://tweb/./src/components/chat/reaction.ts","webpack://tweb/./src/components/chat/reactions.ts","webpack://tweb/./src/components/chat/replies.ts","webpack://tweb/./src/components/chat/messageRender.ts","webpack://tweb/./src/helpers/dom/getElementByPoint.ts","webpack://tweb/./src/helpers/dom/reflowScrollableElement.ts","webpack://tweb/./src/lib/mtproto/constants.ts","webpack://tweb/./src/lib/appManagers/internalLink.ts","webpack://tweb/./src/components/popups/joinChatInvite.ts","webpack://tweb/./src/helpers/scrollSaver.ts","webpack://tweb/./src/helpers/dom/superIntersectionObserver.ts","webpack://tweb/./src/lib/appManagers/utils/messages/isMentionUnread.ts","webpack://tweb/./src/helpers/cacheCallback.ts","webpack://tweb/./src/helpers/string/replaceNonNumber.ts","webpack://tweb/./src/helpers/cards/cardBrands.ts","webpack://tweb/./src/helpers/array/createArray.ts","webpack://tweb/./src/helpers/string/buggedNumbers.ts","webpack://tweb/./src/helpers/cards/patternCharacters.ts","webpack://tweb/./src/helpers/cards/cardFormattingPatterns.ts","webpack://tweb/./src/helpers/cards/formatValueByPattern.ts","webpack://tweb/./src/helpers/cards/validateCard.ts","webpack://tweb/./src/helpers/string/nbsp.ts","webpack://tweb/./src/components/popups/paymentVerification.ts","webpack://tweb/./src/components/popups/paymentCard.ts","webpack://tweb/./src/helpers/cards/formatInputValueByPattern.ts","webpack://tweb/./src/components/popups/paymentCardConfirmation.ts","webpack://tweb/./src/components/popups/paymentShipping.ts","webpack://tweb/./src/components/popups/paymentShippingMethods.ts","webpack://tweb/./src/components/popups/payment.ts","webpack://tweb/./src/components/chat/bubbles.ts","webpack://tweb/./src/helpers/dom/copyFromElement.ts","webpack://tweb/./src/components/popups/unpinMessage.ts","webpack://tweb/./src/helpers/dom/isSelectionEmpty.ts","webpack://tweb/./src/helpers/preloadAnimatedEmojiSticker.ts","webpack://tweb/./src/components/popups/reportMessagesConfirm.ts","webpack://tweb/./src/components/popups/reportMessages.ts","webpack://tweb/./src/components/popups/sponsored.ts","webpack://tweb/./src/components/popups/reactedList.ts","webpack://tweb/./src/components/chat/reactionsMenu.ts","webpack://tweb/./src/components/chat/contextMenu.ts","webpack://tweb/./src/components/chat/sendContextMenu.ts","webpack://tweb/./src/components/popups/createPoll.ts","webpack://tweb/./src/helpers/createPoster.ts","webpack://tweb/./src/helpers/getGifDuration.ts","webpack://tweb/./src/components/popups/newMedia.ts","webpack://tweb/./src/helpers/dom/attachListNavigation.ts","webpack://tweb/./src/components/chat/autocompleteHelper.ts","webpack://tweb/./src/components/chat/stickersHelper.ts","webpack://tweb/./src/components/popups/schedule.ts","webpack://tweb/./src/helpers/dom/getRichValueWithCaret.ts","webpack://tweb/./src/components/chat/emojiHelper.ts","webpack://tweb/./src/components/chat/autocompletePeerHelper.ts","webpack://tweb/./src/components/chat/commandsHelper.ts","webpack://tweb/./src/components/chat/autocompleteHelperController.ts","webpack://tweb/./src/components/chat/mentionsHelper.ts","webpack://tweb/./src/components/chat/replyKeyboard.ts","webpack://tweb/./src/components/chat/inlineHelper.ts","webpack://tweb/./src/components/chat/botCommands.ts","webpack://tweb/./src/helpers/modifyAckedResult.ts","webpack://tweb/./src/components/chat/sendAs.ts","webpack://tweb/./src/components/inputFieldAnimated.ts","webpack://tweb/./src/components/chat/input.ts","webpack://tweb/./src/components/wrappers/draft.ts","webpack://tweb/./src/helpers/dom/setCaretAt.ts","webpack://tweb/./src/components/chat/pinnedContainer.ts","webpack://tweb/./src/components/chat/pinnedMessageBorder.ts","webpack://tweb/./src/components/chat/audio.ts","webpack://tweb/./src/components/chat/pinnedMessage.ts","webpack://tweb/./src/helpers/dom/handleScrollSideEvent.ts","webpack://tweb/./src/components/chat/topbar.ts","webpack://tweb/./src/components/sidebarRight/tabs/search.ts","webpack://tweb/./src/components/chat/search.ts","webpack://tweb/./src/components/chat/patternRenderer.ts","webpack://tweb/./src/components/chat/chat.ts","webpack://tweb/./src/helpers/autoDownload.ts","webpack://tweb/./src/components/chat/markupTooltip.ts","webpack://tweb/./src/helpers/dom/getSelectedNodes.ts","webpack://tweb/./src/components/chat/dragAndDrop.ts","webpack://tweb/./src/helpers/dom/disableTransition.ts","webpack://tweb/./src/components/lineBlobDrawable.ts","webpack://tweb/./src/components/topbarWeave.ts","webpack://tweb/./src/lib/rlottie/rlottieIcon.ts","webpack://tweb/./src/components/superIcon.ts","webpack://tweb/./src/components/groupCall/microphoneIcon.ts","webpack://tweb/./src/components/groupCall/participantMutedIcon.ts","webpack://tweb/./src/components/groupCall/index.ts","webpack://tweb/./src/components/groupCall/participantStatus.ts","webpack://tweb/./src/components/groupCall/participantsList.ts","webpack://tweb/./src/components/call/videoCanvasBlur.ts","webpack://tweb/./src/components/groupCall/participantVideo.ts","webpack://tweb/./src/components/groupCall/participantVideos.ts","webpack://tweb/./src/components/groupCall/participants.ts","webpack://tweb/./src/components/groupCall/description.ts","webpack://tweb/./src/components/groupCall/title.ts","webpack://tweb/./src/components/call/button.ts","webpack://tweb/./src/components/movableElement.ts","webpack://tweb/./src/helpers/movablePanel.ts","webpack://tweb/./src/helpers/toggleClassName.ts","webpack://tweb/./src/components/call/description.ts","webpack://tweb/./src/components/groupCall/microphoneIconMini.ts","webpack://tweb/./src/components/call/index.ts","webpack://tweb/./src/components/topbarCall.ts","webpack://tweb/./src/lib/appManagers/uiNotificationsManager.ts","webpack://tweb/./src/helpers/files/getFilesFromEvent.ts","webpack://tweb/./src/lib/appManagers/appImManager.ts","webpack://tweb/./src/lib/appManagers/utils/messages/getMediaFromMessage.ts","webpack://tweb/./src/lib/appManagers/utils/messages/getMessageSenderPeerIdOrName.ts","webpack://tweb/./src/lib/appManagers/utils/messages/isMessageRestricted.ts","webpack://tweb/./src/lib/appManagers/utils/peers/getPeerColorById.ts","webpack://tweb/./src/lib/appManagers/utils/photos/choosePhotoSize.ts","webpack://tweb/./src/lib/calls/callConnectionInstanceBase.ts","webpack://tweb/./src/lib/calls/helpers/createPeerConnection.ts","webpack://tweb/./src/lib/calls/helpers/createDataChannel.ts","webpack://tweb/./src/lib/calls/helpers/parseSignalingData.ts","webpack://tweb/./src/lib/calls/callConnectionInstance.ts","webpack://tweb/./src/lib/crypto/subtle.ts","webpack://tweb/./src/lib/calls/p2P/p2PEncryptor.ts","webpack://tweb/./src/lib/crypto/utils/sha256.ts","webpack://tweb/./src/lib/calls/p2P/chromeP2PSdpBuilder.ts","webpack://tweb/./src/lib/calls/p2P/p2PSdpBuilder.js","webpack://tweb/./src/lib/calls/p2P/firefoxP2PSdpBuilder.js","webpack://tweb/./src/lib/calls/p2P/safariP2PSdpBuilder.js","webpack://tweb/./src/lib/calls/callInstance.ts","webpack://tweb/./src/lib/calls/p2P/getCallProtocol.ts","webpack://tweb/./src/lib/calls/p2P/getRtcConfiguration.ts","webpack://tweb/./src/lib/calls/helpers/getStreamCached.ts","webpack://tweb/./src/lib/calls/callInstanceBase.ts","webpack://tweb/./src/lib/calls/callState.ts","webpack://tweb/./src/components/call/getAudioAsset.ts","webpack://tweb/./src/lib/calls/callsController.ts","webpack://tweb/./src/lib/calls/constants.ts","webpack://tweb/./src/lib/calls/groupCallConnectionInstance.ts","webpack://tweb/./src/lib/calls/helpers/processMediaSection.ts","webpack://tweb/./src/lib/calls/helpers/filterServerCodecs.ts","webpack://tweb/./src/lib/calls/helpers/fixLocalOffer.ts","webpack://tweb/./src/lib/calls/groupCallInstance.ts","webpack://tweb/./src/lib/calls/groupCallState.ts","webpack://tweb/./src/components/groupCall/getAudioAsset.ts","webpack://tweb/./src/lib/calls/groupCallsController.ts","webpack://tweb/./src/lib/calls/helpers/createMainStreamManager.ts","webpack://tweb/./src/lib/calls/helpers/getAudioConstraints.ts","webpack://tweb/./src/environment/constraintSupport.ts","webpack://tweb/./src/lib/calls/helpers/getScreenConstraints.ts","webpack://tweb/./src/lib/calls/helpers/getScreenStream.ts","webpack://tweb/./src/lib/calls/helpers/getStream.ts","webpack://tweb/./src/lib/calls/helpers/getVideoConstraints.ts","webpack://tweb/./src/lib/calls/helpers/parseMediaSectionInfo.ts","webpack://tweb/./src/lib/calls/helpers/parseSourceGroups.ts","webpack://tweb/./src/lib/calls/helpers/stopTrack.ts","webpack://tweb/./src/lib/calls/localConferenceDescription.ts","webpack://tweb/./src/lib/calls/sdp/index.ts","webpack://tweb/./src/helpers/string/splitStringByLimitWithRest.ts","webpack://tweb/./src/helpers/uniqueNumberGenerator.ts","webpack://tweb/./src/lib/calls/sdp/attributeSplitted.ts","webpack://tweb/./src/lib/calls/sdp/mediaLineParts.ts","webpack://tweb/./src/lib/calls/sdp/line.ts","webpack://tweb/./src/lib/calls/sdp/attributeInner.ts","webpack://tweb/./src/lib/calls/sdp/attributes.ts","webpack://tweb/./src/lib/calls/sdp/mediaSection.ts","webpack://tweb/./src/lib/calls/sdp/sessionSection.ts","webpack://tweb/./src/lib/calls/sdp/utils.ts","webpack://tweb/./src/lib/calls/sdpBuilder.ts","webpack://tweb/./src/lib/calls/streamManager.ts","webpack://tweb/./src/lib/calls/stringFromLineBuilder.ts","webpack://tweb/./src/lib/calls/utils.ts","webpack://tweb/./src/lib/richTextProcessor/getAbbreviation.ts","webpack://tweb/./src/lib/richTextProcessor/getEmojiEntityFromEmoji.ts","webpack://tweb/./src/lib/richTextProcessor/matchEmail.ts","webpack://tweb/./src/lib/richTextProcessor/wrapDraftText.ts","webpack://tweb/./src/lib/richTextProcessor/wrapEmojiText.ts","webpack://tweb/./src/lib/richTextProcessor/setBlankToAnchor.ts","webpack://tweb/./src/environment/emojiVersionsSupport.ts","webpack://tweb/./src/lib/richTextProcessor/wrapRichText.ts","webpack://tweb/./src/helpers/buildURLHash.ts","webpack://tweb/./src/lib/rlottie/queryableWorker.ts","webpack://tweb/./src/environment/webAssemblySupport.ts","webpack://tweb/./src/lib/rlottie/lottieLoader.ts","webpack://tweb/./src/environment/imageBitmapSupport.ts","webpack://tweb/./src/helpers/framesCache.ts","webpack://tweb/./src/lib/rlottie/rlottiePlayer.ts","webpack://tweb/./src/pages/pagesManager.ts","webpack://tweb/./src/pages/page.ts","webpack://tweb/./src/vendor/emoji/index.ts","webpack://tweb/./public/recorder.min.js"],"sourcesContent":["/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport {CustomEmojiRendererElement} from '../lib/richTextProcessor/wrapRichText';\r\nimport rootScope from '../lib/rootScope';\r\nimport {IS_SAFARI} from '../environment/userAgent';\r\nimport {MOUNT_CLASS_TO} from '../config/debug';\r\nimport isInDOM from '../helpers/dom/isInDOM';\r\nimport RLottiePlayer from '../lib/rlottie/rlottiePlayer';\r\nimport indexOfAndSplice from '../helpers/array/indexOfAndSplice';\r\nimport forEachReverse from '../helpers/array/forEachReverse';\r\nimport idleController from '../helpers/idleController';\r\nimport appMediaPlaybackController from './appMediaPlaybackController';\r\nimport {fastRaf} from '../helpers/schedulers';\r\n\r\nexport type AnimationItemGroup = '' | 'none' | 'chat' | 'lock' |\r\n  'STICKERS-POPUP' | 'emoticons-dropdown' | 'STICKERS-SEARCH' | 'GIFS-SEARCH' |\r\n  `CHAT-MENU-REACTIONS-${number}` | 'INLINE-HELPER' | 'GENERAL-SETTINGS' | 'STICKER-VIEWER' | 'EMOJI';\r\nexport interface AnimationItem {\r\n  el: HTMLElement,\r\n  group: AnimationItemGroup,\r\n  animation: AnimationItemWrapper\r\n};\r\n\r\nexport interface AnimationItemWrapper {\r\n  remove: () => void;\r\n  paused: boolean;\r\n  pause: () => any;\r\n  play: () => any;\r\n  autoplay: boolean;\r\n  // onVisibilityChange?: (visible: boolean) => boolean;\r\n};\r\n\r\nexport class AnimationIntersector {\r\n  private observer: IntersectionObserver;\r\n  private visible: Set<AnimationItem> = new Set();\r\n\r\n  private overrideIdleGroups: Set<string>;\r\n  private byGroups: {[group in AnimationItemGroup]?: AnimationItem[]} = {};\r\n  private lockedGroups: {[group in AnimationItemGroup]?: true} = {};\r\n  private onlyOnePlayableGroup: AnimationItemGroup = '';\r\n\r\n  private intersectionLockedGroups: {[group in AnimationItemGroup]?: true} = {};\r\n  private videosLocked = false;\r\n\r\n  constructor() {\r\n    this.observer = new IntersectionObserver((entries) => {\r\n      // if(rootScope.idle.isIDLE) return;\r\n\r\n      for(const entry of entries) {\r\n        const target = entry.target;\r\n\r\n        for(const group in this.byGroups) {\r\n          if(this.intersectionLockedGroups[group as AnimationItemGroup]) {\r\n            continue;\r\n          }\r\n\r\n          const animation = this.byGroups[group as AnimationItemGroup].find((p) => p.el === target);\r\n          if(!animation) {\r\n            continue;\r\n          }\r\n\r\n          if(entry.isIntersecting) {\r\n            this.visible.add(animation);\r\n            this.checkAnimation(animation, false);\r\n\r\n            /* if(animation instanceof HTMLVideoElement && animation.dataset.src) {\r\n              animation.src = animation.dataset.src;\r\n              animation.load();\r\n            } */\r\n          } else {\r\n            this.visible.delete(animation);\r\n            this.checkAnimation(animation, true);\r\n\r\n            const _animation = animation.animation;\r\n            if(_animation instanceof RLottiePlayer/*  && animation.cachingDelta === 2 */) {\r\n              // console.warn('will clear cache', player);\r\n              _animation.clearCache();\r\n            }/*  else if(animation instanceof HTMLVideoElement && animation.src) {\r\n              animation.dataset.src = animation.src;\r\n              animation.src = '';\r\n              animation.load();\r\n            } */\r\n          }\r\n\r\n          break;\r\n        }\r\n      }\r\n    });\r\n\r\n    this.overrideIdleGroups = new Set();\r\n\r\n    appMediaPlaybackController.addEventListener('play', ({doc}) => {\r\n      if(doc.type === 'round') {\r\n        this.videosLocked = true;\r\n        this.checkAnimations();\r\n      }\r\n    });\r\n\r\n    appMediaPlaybackController.addEventListener('pause', () => {\r\n      if(this.videosLocked) {\r\n        this.videosLocked = false;\r\n        this.checkAnimations();\r\n      }\r\n    });\r\n\r\n    idleController.addEventListener('change', (idle) => {\r\n      this.checkAnimations(idle);\r\n    });\r\n  }\r\n\r\n  public setOverrideIdleGroup(group: string, override: boolean) {\r\n    if(override) this.overrideIdleGroups.add(group);\r\n    else this.overrideIdleGroups.delete(group);\r\n  }\r\n\r\n  public getAnimations(element: HTMLElement) {\r\n    const found: AnimationItem[] = [];\r\n    for(const group in this.byGroups) {\r\n      for(const player of this.byGroups[group as AnimationItemGroup]) {\r\n        if(player.el === element) {\r\n          found.push(player);\r\n        }\r\n      }\r\n    }\r\n\r\n    return found;\r\n  }\r\n\r\n  public removeAnimation(player: AnimationItem) {\r\n    const {el, animation} = player;\r\n    animation.remove();\r\n\r\n    if(animation instanceof HTMLVideoElement && IS_SAFARI) {\r\n      setTimeout(() => { // TODO:   ,       \r\n        animation.src = '';\r\n        animation.load();\r\n      }, 1e3);\r\n    }\r\n\r\n    const group = this.byGroups[player.group];\r\n    if(group) {\r\n      indexOfAndSplice(group, player);\r\n      if(!group.length) {\r\n        delete this.byGroups[player.group];\r\n      }\r\n    }\r\n\r\n    this.observer.unobserve(el);\r\n    this.visible.delete(player);\r\n  }\r\n\r\n  public addAnimation(_animation: AnimationItem['animation'], group: AnimationItemGroup = '') {\r\n    if(group === 'none') {\r\n      return;\r\n    }\r\n\r\n    let el: HTMLElement;\r\n    if(_animation instanceof RLottiePlayer) {\r\n      el = _animation.el[0];\r\n    } else if(_animation instanceof CustomEmojiRendererElement) {\r\n      el = _animation.canvas;\r\n    } else if(_animation instanceof HTMLElement) {\r\n      el = _animation;\r\n    }\r\n\r\n    const animation: AnimationItem = {\r\n      el,\r\n      animation: _animation,\r\n      group\r\n    };\r\n\r\n    if(_animation instanceof RLottiePlayer) {\r\n      if(!rootScope.settings.stickers.loop && _animation.loop) {\r\n        _animation.loop = rootScope.settings.stickers.loop;\r\n      }\r\n    }\r\n\r\n    (this.byGroups[group as AnimationItemGroup] ??= []).push(animation);\r\n    this.observer.observe(animation.el);\r\n  }\r\n\r\n  public checkAnimations(blurred?: boolean, group?: AnimationItemGroup, destroy = false) {\r\n    // if(rootScope.idle.isIDLE) return;\r\n\r\n    if(group !== undefined && !this.byGroups[group]) {\r\n      // console.warn('no animation group:', group);\r\n      return;\r\n    }\r\n\r\n    const groups = group !== undefined /* && false */ ? [group] : Object.keys(this.byGroups) as AnimationItemGroup[];\r\n\r\n    for(const group of groups) {\r\n      const animations = this.byGroups[group];\r\n\r\n      forEachReverse(animations, (animation) => {\r\n        this.checkAnimation(animation, blurred, destroy);\r\n      });\r\n    }\r\n  }\r\n\r\n  public checkAnimation(player: AnimationItem, blurred = false, destroy = false) {\r\n    const {el, animation, group} = player;\r\n    // return;\r\n    if(destroy || (!this.lockedGroups[group] && !isInDOM(el))) {\r\n      this.removeAnimation(player);\r\n      return;\r\n    }\r\n\r\n    if(blurred ||\r\n      (this.onlyOnePlayableGroup && this.onlyOnePlayableGroup !== group) ||\r\n      (animation instanceof HTMLVideoElement && this.videosLocked)\r\n    ) {\r\n      if(!animation.paused) {\r\n        // console.warn('pause animation:', animation);\r\n        animation.pause();\r\n      }\r\n    } else if(animation.paused &&\r\n      this.visible.has(player) &&\r\n      animation.autoplay &&\r\n      (!this.onlyOnePlayableGroup || this.onlyOnePlayableGroup === group) &&\r\n      (!idleController.isIdle || this.overrideIdleGroups.has(player.group))\r\n    ) {\r\n      // console.warn('play animation:', animation);\r\n      animation.play();\r\n    }\r\n  }\r\n\r\n  public getOnlyOnePlayableGroup() {\r\n    return this.onlyOnePlayableGroup;\r\n  }\r\n\r\n  public setOnlyOnePlayableGroup(group: AnimationItemGroup = '') {\r\n    this.onlyOnePlayableGroup = group;\r\n  }\r\n\r\n  public lockGroup(group: AnimationItemGroup) {\r\n    this.lockedGroups[group] = true;\r\n  }\r\n\r\n  public unlockGroup(group: AnimationItemGroup) {\r\n    delete this.lockedGroups[group];\r\n    this.checkAnimations(undefined, group);\r\n  }\r\n\r\n  public refreshGroup(group: AnimationItemGroup) {\r\n    const animations = this.byGroups[group];\r\n    if(!animations?.length) {\r\n      return;\r\n    }\r\n\r\n    animations.forEach((animation) => {\r\n      this.observer.unobserve(animation.el);\r\n    });\r\n\r\n    fastRaf(() => {\r\n      animations.forEach((animation) => {\r\n        this.observer.observe(animation.el);\r\n      });\r\n    });\r\n  }\r\n\r\n  public lockIntersectionGroup(group: AnimationItemGroup) {\r\n    this.intersectionLockedGroups[group] = true;\r\n  }\r\n\r\n  public unlockIntersectionGroup(group: AnimationItemGroup) {\r\n    delete this.intersectionLockedGroups[group];\r\n    this.refreshGroup(group);\r\n  }\r\n}\r\n\r\nconst animationIntersector = new AnimationIntersector();\r\nMOUNT_CLASS_TO && (MOUNT_CLASS_TO.animationIntersector = animationIntersector);\r\nexport default animationIntersector;\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport rootScope from '../lib/rootScope';\r\nimport {MyDocument} from '../lib/appManagers/appDocsManager';\r\nimport deferredPromise, {CancellablePromise} from '../helpers/cancellablePromise';\r\nimport {IS_APPLE, IS_SAFARI} from '../environment/userAgent';\r\nimport {MOUNT_CLASS_TO} from '../config/debug';\r\nimport simulateEvent from '../helpers/dom/dispatchEvent';\r\nimport type {SearchSuperContext} from './appSearchSuper.';\r\nimport {Document, DocumentAttribute, Message, PhotoSize} from '../layer';\r\nimport IS_TOUCH_SUPPORTED from '../environment/touchSupport';\r\nimport I18n from '../lib/langPack';\r\nimport SearchListLoader from '../helpers/searchListLoader';\r\nimport copy from '../helpers/object/copy';\r\nimport deepEqual from '../helpers/object/deepEqual';\r\nimport ListenerSetter from '../helpers/listenerSetter';\r\nimport {AppManagers} from '../lib/appManagers/managers';\r\nimport getMediaFromMessage from '../lib/appManagers/utils/messages/getMediaFromMessage';\r\nimport getPeerTitle from './wrappers/getPeerTitle';\r\nimport appDownloadManager from '../lib/appManagers/appDownloadManager';\r\nimport onMediaLoad from '../helpers/onMediaLoad';\r\nimport EventListenerBase from '../helpers/eventListenerBase';\r\n\r\n// TODO: Safari:  ,          \r\n// TODO: Safari:     \r\n// TODO: Safari:  ,         -    \r\n\r\nexport type MediaItem = {mid: number, peerId: PeerId};\r\n\r\ntype HTMLMediaElement = HTMLAudioElement | HTMLVideoElement;\r\n\r\nconst SHOULD_USE_SAFARI_FIX = (() => {\r\n  try {\r\n    return IS_SAFARI && +navigator.userAgent.match(/ Version\\/(\\d+)/)[1] < 14;\r\n  } catch(err) {\r\n    return false;\r\n  }\r\n})();\r\n\r\nconst SEEK_OFFSET = 10;\r\n\r\nexport type MediaSearchContext = SearchSuperContext & Partial<{\r\n  isScheduled: boolean,\r\n  useSearch: boolean\r\n}>;\r\n\r\ntype MediaDetails = {\r\n  peerId: PeerId,\r\n  mid: number,\r\n  docId: DocId,\r\n  doc: MyDocument,\r\n  message: Message.message,\r\n  clean?: boolean,\r\n  isScheduled?: boolean,\r\n  isSingle?: boolean\r\n};\r\n\r\nexport type PlaybackMediaType = 'voice' | 'video' | 'audio';\r\n\r\nexport class AppMediaPlaybackController extends EventListenerBase<{\r\n  play: (details: ReturnType<AppMediaPlaybackController['getPlayingDetails']>) => void,\r\n  pause: () => void,\r\n  playbackParams: (params: ReturnType<AppMediaPlaybackController['getPlaybackParams']>) => void,\r\n  stop: () => void,\r\n}> {\r\n  private container: HTMLElement;\r\n  private media: Map<PeerId, Map<number, HTMLMediaElement>> = new Map();\r\n  private scheduled: AppMediaPlaybackController['media'] = new Map();\r\n  private mediaDetails: Map<HTMLMediaElement, MediaDetails> = new Map();\r\n  private playingMedia: HTMLMediaElement;\r\n  private playingMediaType: PlaybackMediaType;\r\n\r\n  private waitingMediaForLoad: Map<PeerId, Map<number, CancellablePromise<void>>> = new Map();\r\n  private waitingScheduledMediaForLoad: AppMediaPlaybackController['waitingMediaForLoad'] = new Map();\r\n  private waitingDocumentsForLoad: {[docId: string]: Set<HTMLMediaElement>} = {};\r\n\r\n  public willBePlayedMedia: HTMLMediaElement;\r\n  private searchContext: MediaSearchContext;\r\n\r\n  private listLoader: SearchListLoader<MediaItem>;\r\n\r\n  public volume: number;\r\n  public muted: boolean;\r\n  public playbackRate: number;\r\n  public loop: boolean;\r\n  public round: boolean;\r\n  private _volume: number;\r\n  private _muted: boolean;\r\n  private _playbackRate: number;\r\n  private _loop: boolean;\r\n  private _round: boolean;\r\n  private lockedSwitchers: boolean;\r\n  private playbackRates: Record<PlaybackMediaType, number> = {\r\n    voice: 1,\r\n    video: 1,\r\n    audio: 1\r\n  };\r\n\r\n  private pip: HTMLVideoElement;\r\n  private managers: AppManagers;\r\n  private skipMediaPlayEvent: boolean;\r\n\r\n  construct(managers: AppManagers) {\r\n    this.managers = managers;\r\n    this.container = document.createElement('div');\r\n    // this.container.style.cssText = 'position: absolute; top: -10000px; left: -10000px;';\r\n    this.container.style.cssText = 'display: none;';\r\n    document.body.append(this.container);\r\n\r\n    if(navigator.mediaSession) {\r\n      const actions: {[action in MediaSessionAction]?: MediaSessionActionHandler} = {\r\n        play: this.browserPlay,\r\n        pause: this.browserPause,\r\n        stop: this.browserStop,\r\n        seekbackward: this.browserSeekBackward,\r\n        seekforward: this.browserSeekForward,\r\n        seekto: this.browserSeekTo,\r\n        previoustrack: this.browserPrevious,\r\n        nexttrack: this.browserNext\r\n      };\r\n\r\n      for(const action in actions) {\r\n        try {\r\n          navigator.mediaSession.setActionHandler(action as MediaSessionAction, actions[action as MediaSessionAction]);\r\n        } catch(err) {\r\n          console.warn('MediaSession action is not supported:', action);\r\n        }\r\n      }\r\n    }\r\n\r\n    rootScope.addEventListener('document_downloaded', (docId) => {\r\n      const set = this.waitingDocumentsForLoad[docId];\r\n      if(set) {\r\n        for(const media of set) {\r\n          this.onMediaDocumentLoad(media);\r\n        }\r\n      }\r\n    });\r\n\r\n    rootScope.addEventListener('media_play', () => {\r\n      if(this.skipMediaPlayEvent) {\r\n        this.skipMediaPlayEvent = false;\r\n        return;\r\n      }\r\n\r\n      if(!this.pause() && this.pip) {\r\n        this.pip.pause();\r\n      }\r\n    });\r\n\r\n    const properties: {[key: PropertyKey]: PropertyDescriptor} = {};\r\n    const keys = [\r\n      'volume' as const,\r\n      'muted' as const,\r\n      'playbackRate' as const,\r\n      'loop' as const,\r\n      'round' as const\r\n    ];\r\n    keys.forEach((key) => {\r\n      const _key = ('_' + key) as `_${typeof key}`;\r\n      properties[key] = {\r\n        get: () => this[_key],\r\n        set: (value: number | boolean) => {\r\n          if(this[_key] === value) {\r\n            return;\r\n          }\r\n\r\n          // @ts-ignore\r\n          this[_key] = value;\r\n          if(this.playingMedia && (key !== 'loop' || this.playingMediaType === 'audio') && key !== 'round') {\r\n            // @ts-ignore\r\n            this.playingMedia[key] = value;\r\n          }\r\n\r\n          if(key === 'playbackRate' && this.playingMediaType !== undefined) {\r\n            this.playbackRates[this.playingMediaType] = value as number;\r\n          }\r\n\r\n          this.dispatchPlaybackParams();\r\n        }\r\n      };\r\n    });\r\n    Object.defineProperties(this, properties);\r\n  }\r\n\r\n  private dispatchPlaybackParams() {\r\n    this.dispatchEvent('playbackParams', this.getPlaybackParams());\r\n  }\r\n\r\n  public getPlaybackParams() {\r\n    const {volume, muted, playbackRate, playbackRates, loop, round} = this;\r\n    return {\r\n      volume,\r\n      muted,\r\n      playbackRate,\r\n      playbackRates,\r\n      loop,\r\n      round\r\n    };\r\n  }\r\n\r\n  public setPlaybackParams(params: ReturnType<AppMediaPlaybackController['getPlaybackParams']>) {\r\n    this.playbackRates = params.playbackRates;\r\n    this._volume = params.volume;\r\n    this._muted = params.muted;\r\n    this._playbackRate = params.playbackRate;\r\n    this._loop = params.loop;\r\n    this._round = params.round;\r\n  }\r\n\r\n  public seekBackward = (details: MediaSessionActionDetails, media = this.playingMedia) => {\r\n    if(media) {\r\n      media.currentTime = Math.max(0, media.currentTime - (details.seekOffset || SEEK_OFFSET));\r\n    }\r\n  };\r\n\r\n  public seekForward = (details: MediaSessionActionDetails, media = this.playingMedia) => {\r\n    if(media) {\r\n      media.currentTime = Math.min(media.duration, media.currentTime + (details.seekOffset || SEEK_OFFSET));\r\n    }\r\n  };\r\n\r\n  public seekTo = (details: MediaSessionActionDetails, media = this.playingMedia) => {\r\n    if(media) {\r\n      media.currentTime = details.seekTime;\r\n    }\r\n  };\r\n\r\n  public addMedia(message: Message.message, autoload: boolean, clean?: boolean): HTMLMediaElement {\r\n    const {peerId, mid} = message;\r\n\r\n    const isScheduled = !!message.pFlags.is_scheduled;\r\n    const s = isScheduled ? this.scheduled : this.media;\r\n    let storage = s.get(message.peerId);\r\n    if(!storage) {\r\n      s.set(message.peerId, storage = new Map());\r\n    }\r\n\r\n    let media = storage.get(mid);\r\n    if(media) {\r\n      return media;\r\n    }\r\n\r\n    const doc = getMediaFromMessage(message) as Document.document;\r\n    storage.set(mid, media = document.createElement(doc.type === 'round' || doc.type === 'video' ? 'video' : 'audio'));\r\n    // const source = document.createElement('source');\r\n    // source.type = doc.type === 'voice' && !opusDecodeController.isPlaySupported() ? 'audio/wav' : doc.mime_type;\r\n\r\n    if(doc.type === 'round') {\r\n      media.setAttribute('playsinline', 'true');\r\n      // media.muted = true;\r\n    }\r\n\r\n    const details: MediaDetails = {\r\n      peerId,\r\n      mid,\r\n      docId: doc.id,\r\n      doc,\r\n      message,\r\n      clean,\r\n      isScheduled: message.pFlags.is_scheduled\r\n    };\r\n\r\n    this.mediaDetails.set(media, details);\r\n\r\n    // media.autoplay = true;\r\n    media.volume = 1;\r\n    // media.append(source);\r\n\r\n    this.container.append(media);\r\n\r\n    media.addEventListener('play', this.onPlay);\r\n    media.addEventListener('pause', this.onPause);\r\n    media.addEventListener('ended', this.onEnded);\r\n\r\n    if(doc.type !== 'audio' && message?.pFlags.media_unread && message.fromId !== rootScope.myId) {\r\n      media.addEventListener('timeupdate', () => {\r\n        this.managers.appMessagesManager.readMessages(peerId, [mid]);\r\n      }, {once: true});\r\n    }\r\n\r\n    /* const onError = (e: Event) => {\r\n      //console.log('appMediaPlaybackController: video onError', e);\r\n\r\n      if(this.nextMid === mid) {\r\n        this.loadSiblingsMedia(peerId, doc.type as MediaType, mid).then(() => {\r\n          if(this.nextMid && storage[this.nextMid]) {\r\n            storage[this.nextMid].play();\r\n          }\r\n        });\r\n      }\r\n    };\r\n\r\n    media.addEventListener('error', onError); */\r\n\r\n    const deferred = deferredPromise<void>();\r\n    if(autoload) {\r\n      deferred.resolve();\r\n    } else {\r\n      const w = message.pFlags.is_scheduled ? this.waitingScheduledMediaForLoad : this.waitingMediaForLoad;\r\n      let waitingStorage = w.get(peerId);\r\n      if(!waitingStorage) {\r\n        w.set(peerId, waitingStorage = new Map());\r\n      }\r\n\r\n      waitingStorage.set(mid, deferred);\r\n    }\r\n\r\n    deferred.then(async() => {\r\n      // media.autoplay = true;\r\n      // console.log('will set media url:', media, doc, doc.type, doc.url);\r\n\r\n      if(doc.supportsStreaming || (await this.managers.thumbsStorage.getCacheContext(doc)).url) {\r\n        this.onMediaDocumentLoad(media);\r\n      } else {\r\n        let set = this.waitingDocumentsForLoad[doc.id];\r\n        if(!set) {\r\n          set = this.waitingDocumentsForLoad[doc.id] = new Set();\r\n        }\r\n\r\n        set.add(media);\r\n        appDownloadManager.downloadMediaURL({media: doc});\r\n      }\r\n    }/* , onError */);\r\n\r\n    return media;\r\n  }\r\n\r\n  public getMedia(peerId: PeerId, mid: number, isScheduled?: boolean) {\r\n    const s = (isScheduled ? this.scheduled : this.media).get(peerId);\r\n    return s?.get(mid);\r\n  }\r\n\r\n  private onMediaDocumentLoad = async(media: HTMLMediaElement) => {\r\n    const details = this.mediaDetails.get(media);\r\n    const doc = await this.managers.appDocsManager.getDoc(details.docId);\r\n    if(doc.type === 'audio' && doc.supportsStreaming && SHOULD_USE_SAFARI_FIX) {\r\n      this.handleSafariStreamable(media);\r\n    }\r\n\r\n    // setTimeout(() => {\r\n    const cacheContext = await this.managers.thumbsStorage.getCacheContext(doc);\r\n    media.src = cacheContext.url;\r\n\r\n    if(this.playingMedia === media) {\r\n      media.playbackRate = this.playbackRate;\r\n\r\n      if(doc.type === 'audio') {\r\n        media.loop = this.loop;\r\n      }\r\n    }\r\n    // }, doc.supportsStreaming ? 500e3 : 0);\r\n\r\n    const set = this.waitingDocumentsForLoad[doc.id];\r\n    if(set) {\r\n      set.delete(media);\r\n\r\n      if(!set.size) {\r\n        delete this.waitingDocumentsForLoad[doc.id];\r\n      }\r\n    }\r\n  };\r\n\r\n  // safari      ,\r\n  //         SW,     \r\n  private handleSafariStreamable(media: HTMLMediaElement) {\r\n    media.addEventListener('play', () => {\r\n      /* if(media.readyState === 4) { // https://developer.mozilla.org/ru/docs/Web/API/XMLHttpRequest/readyState\r\n        return;\r\n      } */\r\n\r\n      // media.volume = 0;\r\n      const currentTime = media.currentTime;\r\n      // this.setSafariBuffering(media, true);\r\n\r\n      media.addEventListener('progress', () => {\r\n        media.currentTime = media.duration - 1;\r\n\r\n        media.addEventListener('progress', () => {\r\n          media.currentTime = currentTime;\r\n          // media.volume = 1;\r\n          // this.setSafariBuffering(media, false);\r\n\r\n          if(!media.paused) {\r\n            media.play()/* .catch(() => {}) */;\r\n          }\r\n        }, {once: true});\r\n      }, {once: true});\r\n    }/* , {once: true} */);\r\n  }\r\n\r\n  public resolveWaitingForLoadMedia(peerId: PeerId, mid: number, isScheduled?: boolean) {\r\n    const w = isScheduled ? this.waitingScheduledMediaForLoad : this.waitingMediaForLoad;\r\n    const storage = w.get(peerId);\r\n    if(!storage) {\r\n      return;\r\n    }\r\n\r\n    const promise = storage.get(mid);\r\n    if(promise) {\r\n      promise.resolve();\r\n      storage.delete(mid);\r\n\r\n      if(!storage.size) {\r\n        w.delete(peerId);\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Only for audio\r\n   */\r\n  public isSafariBuffering(media: HTMLMediaElement) {\r\n    // @ts-ignore\r\n    return !!media.safariBuffering;\r\n  }\r\n\r\n  private setSafariBuffering(media: HTMLMediaElement, value: boolean) {\r\n    // @ts-ignore\r\n    media.safariBuffering = value;\r\n  }\r\n\r\n  private async setNewMediadata(message: Message.message, playingMedia = this.playingMedia) {\r\n    if(document.pictureInPictureElement) {\r\n      return;\r\n    }\r\n\r\n    await onMediaLoad(playingMedia, undefined, false); // have to wait for load, otherwise on macOS won't set\r\n\r\n    const doc = getMediaFromMessage(message) as MyDocument;\r\n\r\n    const artwork: MediaImage[] = [];\r\n\r\n    const isVoice = doc.type === 'voice' || doc.type === 'round';\r\n    let title = '', artist = '';\r\n\r\n    if(doc.thumbs?.length) {\r\n      const size = doc.thumbs[doc.thumbs.length - 1];\r\n      if(!(size as PhotoSize.photoStrippedSize).bytes) {\r\n        const cacheContext = await this.managers.thumbsStorage.getCacheContext(doc, size.type);\r\n\r\n        if(cacheContext.url) {\r\n          artwork.push({\r\n            src: cacheContext.url,\r\n            sizes: `${(size as PhotoSize.photoSize).w}x${(size as PhotoSize.photoSize).h}`,\r\n            type: 'image/jpeg'\r\n          });\r\n        } else {\r\n          const download = appDownloadManager.downloadMediaURL({media: doc, thumb: size});\r\n          download.then(() => {\r\n            if(this.playingMedia !== playingMedia || !cacheContext.url) {\r\n              return;\r\n            }\r\n\r\n            this.setNewMediadata(message);\r\n          });\r\n        }\r\n      }\r\n    } else if(isVoice) {\r\n      const peerId = message.fromId || message.peerId;\r\n      const peerPhoto = await this.managers.appPeersManager.getPeerPhoto(peerId);\r\n      if(peerPhoto) {\r\n        // const result = this.managers.appAvatarsManager.loadAvatar(peerId, peerPhoto, 'photo_small');\r\n        // if(result.cached) {\r\n        //   const url = await result.loadPromise;\r\n        //   artwork.push({\r\n        //     src: url,\r\n        //     sizes: '160x160',\r\n        //     type: 'image/jpeg'\r\n        //   });\r\n        // } else {\r\n        //   result.loadPromise.then((url) => {\r\n        //     if(this.playingMedia !== playingMedia || !url) {\r\n        //       return;\r\n        //     }\r\n\r\n        //     this.setNewMediadata(message);\r\n        //   });\r\n        // }\r\n      }\r\n\r\n      title = await getPeerTitle(peerId, true, false);\r\n      artist = I18n.format(doc.type === 'voice' ? 'AttachAudio' : 'AttachRound', true);\r\n    }\r\n\r\n    if(!isVoice) {\r\n      const attribute = doc.attributes.find((attribute) => attribute._ === 'documentAttributeAudio') as DocumentAttribute.documentAttributeAudio;\r\n      title = attribute?.title ?? doc.file_name;\r\n      artist = attribute?.performer;\r\n    }\r\n\r\n    if(!artwork.length) {\r\n      if(IS_APPLE) {\r\n        if(IS_TOUCH_SUPPORTED) {\r\n          artwork.push({\r\n            src: `assets/img/apple-touch-icon-precomposed.png`,\r\n            sizes: '180x180',\r\n            type: 'image/png'\r\n          });\r\n        } else {\r\n          artwork.push({\r\n            src: `assets/img/apple-touch-icon.png`,\r\n            sizes: '180x180',\r\n            type: 'image/png'\r\n          });\r\n        }\r\n      } else {\r\n        [72, 96, 144, 192, 256, 384, 512].forEach((size) => {\r\n          const sizes = `${size}x${size}`;\r\n          artwork.push({\r\n            src: `assets/img/android-chrome-${sizes}.png`,\r\n            sizes,\r\n            type: 'image/png'\r\n          });\r\n        });\r\n      }\r\n    }\r\n\r\n    const metadata = new MediaMetadata({\r\n      title,\r\n      artist,\r\n      artwork\r\n    });\r\n\r\n    navigator.mediaSession.metadata = metadata;\r\n  }\r\n\r\n  public setCurrentMediadata() {\r\n    const {playingMedia} = this;\r\n    if(!playingMedia) return;\r\n    const message = this.getMessageByMedia(playingMedia);\r\n    this.setNewMediadata(message, playingMedia);\r\n  }\r\n\r\n  private getMessageByMedia(media: HTMLMediaElement): Message.message {\r\n    const details = this.mediaDetails.get(media);\r\n    return details.message;\r\n    // const {peerId, mid} = details;\r\n    // const message = details.isScheduled ?\r\n    //   this.managers.appMessagesManager.getScheduledMessageByPeer(peerId, mid) :\r\n    //   this.managers.appMessagesManager.getMessageByPeer(peerId, mid);\r\n    // return message;\r\n  }\r\n\r\n  public getPlayingDetails() {\r\n    const {playingMedia} = this;\r\n    if(!playingMedia) {\r\n      return;\r\n    }\r\n\r\n    const message = this.getMessageByMedia(playingMedia);\r\n    return {\r\n      doc: getMediaFromMessage(message) as MyDocument,\r\n      message,\r\n      media: playingMedia,\r\n      playbackParams: this.getPlaybackParams()\r\n    };\r\n  }\r\n\r\n  private onPlay = (e?: Event) => {\r\n    const media = e.target as HTMLMediaElement;\r\n    const details = this.mediaDetails.get(media);\r\n    const {peerId, mid} = details;\r\n\r\n    // console.log('appMediaPlaybackController: video playing', this.currentPeerId, this.playingMedia, media);\r\n\r\n    const pip = this.pip;\r\n    if(pip) {\r\n      pip.pause();\r\n    }\r\n\r\n    const message = this.getMessageByMedia(media);\r\n\r\n    const previousMedia = this.playingMedia;\r\n    if(previousMedia !== media) {\r\n      this.stop();\r\n      this.setMedia(media, message);\r\n\r\n      const verify = (element: MediaItem) => element.mid === mid && element.peerId === peerId;\r\n      const listLoader = this.listLoader;\r\n      const current = listLoader.getCurrent();\r\n      if(!current || !verify(current)) {\r\n        let jumpLength: number;\r\n\r\n        for(const withOtherSide of [false, true]) {\r\n          const previous = listLoader.getPrevious(withOtherSide);\r\n\r\n          let idx = previous.findIndex(verify);\r\n          if(idx !== -1) {\r\n            jumpLength = -(previous.length - idx);\r\n          } else {\r\n            const next = listLoader.getNext(withOtherSide);\r\n            idx = next.findIndex(verify);\r\n            if(idx !== -1) {\r\n              jumpLength = idx + 1;\r\n            }\r\n          }\r\n\r\n          if(jumpLength !== undefined) {\r\n            break;\r\n          }\r\n        }\r\n\r\n        if(jumpLength) {\r\n          this.go(jumpLength, false);\r\n        } else {\r\n          this.setTargets({peerId, mid});\r\n        }\r\n      }\r\n    }\r\n\r\n    // audio_pause     \r\n    setTimeout(() => {\r\n      if(this.playingMedia !== media) {\r\n        return;\r\n      }\r\n\r\n      this.dispatchEvent('play', this.getPlayingDetails());\r\n      this.pauseMediaInOtherTabs();\r\n    }, 0);\r\n  };\r\n\r\n  private onPause = (e?: Event) => {\r\n    /* const target = e.target as HTMLMediaElement;\r\n    if(!isInDOM(target)) {\r\n      this.container.append(target);\r\n      target.play();\r\n      return;\r\n    } */\r\n\r\n    // if(this.pip) {\r\n    //   this.pip.play();\r\n    // }\r\n\r\n    this.dispatchEvent('pause');\r\n  };\r\n\r\n  private onEnded = (e?: Event) => {\r\n    if(!e.isTrusted) {\r\n      return;\r\n    }\r\n\r\n    this.onPause(e);\r\n\r\n    // console.log('on media end');\r\n\r\n    const listLoader = this.listLoader;\r\n    if(this.lockedSwitchers ||\r\n      (!this.round && listLoader.current && !listLoader.next.length) ||\r\n      !listLoader.getNext(true).length ||\r\n      !this.next()) {\r\n      this.stop();\r\n      this.dispatchEvent('stop');\r\n    }\r\n  };\r\n\r\n  public pauseMediaInOtherTabs() {\r\n    this.skipMediaPlayEvent = true;\r\n    rootScope.dispatchEvent('media_play');\r\n  }\r\n\r\n  // public get pip() {\r\n  //   return document.pictureInPictureElement as HTMLVideoElement;\r\n  // }\r\n\r\n  public toggle(play?: boolean, media = this.playingMedia) {\r\n    if(!media) {\r\n      return false;\r\n    }\r\n\r\n    if(play === undefined) {\r\n      play = media.paused;\r\n    }\r\n\r\n    if(media.paused !== play) {\r\n      return false;\r\n    }\r\n\r\n    if(play) {\r\n      media.play();\r\n    } else {\r\n      media.pause();\r\n    }\r\n\r\n    return true;\r\n  }\r\n\r\n  public play = () => {\r\n    return this.toggle(true);\r\n  };\r\n\r\n  public pause = () => {\r\n    return this.toggle(false);\r\n  };\r\n\r\n  public stop = (media = this.playingMedia) => {\r\n    if(!media) {\r\n      return false;\r\n    }\r\n\r\n    if(!media.paused) {\r\n      media.pause();\r\n    }\r\n\r\n    media.currentTime = 0;\r\n    simulateEvent(media, 'ended');\r\n\r\n    if(media === this.playingMedia) {\r\n      const details = this.mediaDetails.get(media);\r\n      if(details?.clean) {\r\n        media.src = '';\r\n        const peerId = details.peerId;\r\n        const s = details.isScheduled ? this.scheduled : this.media;\r\n        const storage = s.get(peerId);\r\n        if(storage) {\r\n          storage.delete(details.mid);\r\n\r\n          if(!storage.size) {\r\n            s.delete(peerId);\r\n          }\r\n        }\r\n\r\n        media.remove();\r\n\r\n        this.mediaDetails.delete(media);\r\n      }\r\n\r\n      this.playingMedia = undefined;\r\n      this.playingMediaType = undefined;\r\n    }\r\n\r\n    return true;\r\n  };\r\n\r\n  public playItem = (item: MediaItem) => {\r\n    const {peerId, mid} = item;\r\n    const isScheduled = this.searchContext.isScheduled;\r\n    const media = this.getMedia(peerId, mid, isScheduled);\r\n\r\n    /* if(isSafari) {\r\n      media.autoplay = true;\r\n    } */\r\n\r\n    media.play();\r\n\r\n    setTimeout(() => {\r\n      this.resolveWaitingForLoadMedia(peerId, mid, isScheduled);\r\n    }, 0);\r\n  };\r\n\r\n  public go = (length: number, dispatchJump?: boolean) => {\r\n    const listLoader = this.listLoader;\r\n    if(this.lockedSwitchers || !listLoader) {\r\n      return;\r\n    }\r\n\r\n    if(this.playingMediaType === 'audio') {\r\n      return listLoader.goRound(length, dispatchJump);\r\n    } else {\r\n      return listLoader.go(length, dispatchJump);\r\n    }\r\n  };\r\n\r\n  private bindBrowserCallback(cb: (video: HTMLVideoElement, details: MediaSessionActionDetails) => void) {\r\n    const handler: MediaSessionActionHandler = (details) => {\r\n      cb(this.pip, details);\r\n    };\r\n\r\n    return handler;\r\n  }\r\n\r\n  public browserPlay = this.bindBrowserCallback((video) => this.toggle(true, video));\r\n  public browserPause = this.bindBrowserCallback((video) => this.toggle(false, video));\r\n  public browserStop = this.bindBrowserCallback((video) => this.stop(video));\r\n  public browserSeekBackward = this.bindBrowserCallback((video, details) => this.seekBackward(details, video));\r\n  public browserSeekForward = this.bindBrowserCallback((video, details) => this.seekForward(details, video));\r\n  public browserSeekTo = this.bindBrowserCallback((video, details) => this.seekTo(details, video));\r\n  public browserNext = this.bindBrowserCallback((video) => video || this.next());\r\n  public browserPrevious = this.bindBrowserCallback((video) => video ? this.seekToStart(video) : this.previous());\r\n\r\n  public next = () => {\r\n    return this.go(1);\r\n  };\r\n\r\n  public previous = () => {\r\n    if(this.seekToStart(this.playingMedia)) {\r\n      return;\r\n    }\r\n\r\n    return this.go(-1);\r\n  };\r\n\r\n  public seekToStart(media: HTMLMediaElement) {\r\n    if(media?.currentTime > 5) {\r\n      media.currentTime = 0;\r\n      this.toggle(true, media);\r\n      return true;\r\n    }\r\n\r\n    return false;\r\n  }\r\n\r\n  public willBePlayed(media: HTMLMediaElement) {\r\n    this.willBePlayedMedia = media;\r\n  }\r\n\r\n  public setSearchContext(context: MediaSearchContext) {\r\n    if(deepEqual(this.searchContext, context)) {\r\n      return false;\r\n    }\r\n\r\n    this.searchContext = copy(context); // {_: type === 'audio' ? 'inputMessagesFilterMusic' : 'inputMessagesFilterRoundVoice'}\r\n    return true;\r\n  }\r\n\r\n  public getSearchContext() {\r\n    return this.searchContext;\r\n  }\r\n\r\n  public setTargets(current: MediaItem, prev?: MediaItem[], next?: MediaItem[]) {\r\n    let listLoader = this.listLoader;\r\n    if(!listLoader) {\r\n      listLoader = this.listLoader = new SearchListLoader({\r\n        loadCount: 10,\r\n        loadWhenLeft: 5,\r\n        processItem: (message: Message.message) => {\r\n          this.addMedia(message, false);\r\n          return {peerId: message.peerId, mid: message.mid};\r\n        },\r\n        onJump: (item, older) => {\r\n          this.playItem(item);\r\n        },\r\n        onEmptied: () => {\r\n          this.dispatchEvent('stop');\r\n          this.stop();\r\n        }\r\n      });\r\n    } else {\r\n      listLoader.reset();\r\n    }\r\n\r\n    const reverse = this.searchContext.folderId !== undefined ? false : true;\r\n    if(prev) {\r\n      listLoader.setTargets(prev, next, reverse);\r\n    } else {\r\n      listLoader.reverse = reverse;\r\n    }\r\n\r\n    listLoader.setSearchContext(this.searchContext);\r\n    listLoader.current = current;\r\n\r\n    listLoader.load(true);\r\n    listLoader.load(false);\r\n  }\r\n\r\n  private getPlaybackMediaTypeFromMessage(message: Message.message) {\r\n    const doc = getMediaFromMessage(message) as MyDocument;\r\n    let mediaType: PlaybackMediaType = 'audio';\r\n    if(doc?.type) {\r\n      if(doc.type === 'voice' || doc.type === 'round') {\r\n        mediaType = 'voice';\r\n      } else if(doc.type === 'video') {\r\n        mediaType = 'video';\r\n      }\r\n    }\r\n\r\n    return mediaType;\r\n  }\r\n\r\n  public setMedia(media: HTMLMediaElement, message: Message.message) {\r\n    const mediaType = this.getPlaybackMediaTypeFromMessage(message);\r\n\r\n    this._playbackRate = this.playbackRates[mediaType];\r\n\r\n    this.playingMedia = media;\r\n    this.playingMediaType = mediaType;\r\n    this.playingMedia.volume = this.volume;\r\n    this.playingMedia.muted = this.muted;\r\n    this.playingMedia.playbackRate = this.playbackRate;\r\n\r\n    if(mediaType === 'audio') {\r\n      this.playingMedia.loop = this.loop;\r\n    }\r\n\r\n    if('mediaSession' in navigator) {\r\n      this.setNewMediadata(message);\r\n    }\r\n  }\r\n\r\n  public setSingleMedia(media?: HTMLMediaElement, message?: Message.message) {\r\n    const playingMedia = this.playingMedia;\r\n\r\n    const wasPlaying = this.pause();\r\n\r\n    let onPlay: () => void;\r\n    if(media) {\r\n      onPlay = () => {\r\n        const pip = this.pip;\r\n        if(pip) {\r\n          pip.pause();\r\n        }\r\n\r\n        this.pauseMediaInOtherTabs();\r\n      };\r\n\r\n      if(!media.paused) {\r\n        onPlay();\r\n      }\r\n\r\n      media.addEventListener('play', onPlay);\r\n    } else { // maybe it's voice recording\r\n      this.pauseMediaInOtherTabs();\r\n    }\r\n\r\n    this.willBePlayed(undefined);\r\n    if(media) this.setMedia(media, message);\r\n    else this.playingMedia = undefined;\r\n    this.toggleSwitchers(false);\r\n\r\n    return (playPaused = wasPlaying) => {\r\n      this.toggleSwitchers(true);\r\n\r\n      if(playingMedia) {\r\n        if(this.mediaDetails.get(playingMedia)) {\r\n          this.setMedia(playingMedia, this.getMessageByMedia(playingMedia));\r\n        } else {\r\n          this.next() || this.previous();\r\n        }\r\n      }\r\n\r\n      // If it's still not cleaned\r\n      if(this.playingMedia === media) {\r\n        this.playingMedia = undefined;\r\n        this.playingMediaType = undefined;\r\n      }\r\n\r\n      if(media) {\r\n        media.removeEventListener('play', onPlay);\r\n      }\r\n\r\n      // I don't remember what it was for\r\n      // if(media && this.playingMedia === media) {\r\n      //   this.stop();\r\n      // }\r\n\r\n      if(playPaused) {\r\n        this.play();\r\n      }\r\n    };\r\n  }\r\n\r\n  public toggleSwitchers(enabled: boolean) {\r\n    this.lockedSwitchers = !enabled;\r\n  }\r\n\r\n  public setPictureInPicture(video: HTMLVideoElement) {\r\n    this.pip = video;\r\n\r\n    // let wasPlaying = this.pause();\r\n\r\n    const listenerSetter = new ListenerSetter();\r\n    listenerSetter.add(video)('leavepictureinpicture', () => {\r\n      if(this.pip !== video) {\r\n        return;\r\n      }\r\n\r\n      this.pip = undefined;\r\n      // if(wasPlaying) {\r\n      //   this.play();\r\n      // }\r\n\r\n      listenerSetter.removeAll();\r\n    }, {once: true});\r\n\r\n    listenerSetter.add(video)('play', (e) => {\r\n      if(this.playingMedia !== video) {\r\n        this.pause();\r\n      }\r\n\r\n      this.pauseMediaInOtherTabs();\r\n      // if(this.pause()) {\r\n      //   listenerSetter.add(video)('pause', () => {\r\n      //     this.play();\r\n      //   }, {once: true});\r\n      // }\r\n    });\r\n  }\r\n}\r\n\r\nconst appMediaPlaybackController = new AppMediaPlaybackController();\r\nMOUNT_CLASS_TO.appMediaPlaybackController = appMediaPlaybackController;\r\nexport default appMediaPlaybackController;\r\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport MEDIA_MIME_TYPES_SUPPORTED from '../environment/mediaMimeTypesSupport';\nimport cancelEvent from '../helpers/dom/cancelEvent';\nimport {attachClickEvent, detachClickEvent} from '../helpers/dom/clickEvent';\nimport findUpClassName from '../helpers/dom/findUpClassName';\nimport findUpTag from '../helpers/dom/findUpTag';\nimport setInnerHTML from '../helpers/dom/setInnerHTML';\nimport mediaSizes from '../helpers/mediaSizes';\nimport SearchListLoader from '../helpers/searchListLoader';\nimport {Message} from '../layer';\nimport type {MyDocument} from '../lib/appManagers/appDocsManager';\nimport appDownloadManager from '../lib/appManagers/appDownloadManager';\nimport appImManager from '../lib/appManagers/appImManager';\nimport {MyMessage} from '../lib/appManagers/appMessagesManager';\nimport {MyPhoto} from '../lib/appManagers/appPhotosManager';\nimport getMediaFromMessage from '../lib/appManagers/utils/messages/getMediaFromMessage';\nimport wrapRichText from '../lib/richTextProcessor/wrapRichText';\nimport {MediaSearchContext} from './appMediaPlaybackController';\nimport AppMediaViewerBase, {MEDIA_VIEWER_CLASSNAME} from './appMediaViewerBase';\nimport {ButtonMenuItemOptions} from './buttonMenu';\nimport PopupDeleteMessages from './popups/deleteMessages';\nimport PopupForward from './popups/forward';\nimport Scrollable from './scrollable';\nimport appSidebarRight from './sidebarRight';\nimport AppSharedMediaTab from './sidebarRight/tabs/sharedMedia';\n\ntype AppMediaViewerTargetType = {\n  element: HTMLElement,\n  mid: number,\n  peerId: PeerId\n};\nexport default class AppMediaViewer extends AppMediaViewerBase<'caption', 'delete' | 'forward', AppMediaViewerTargetType> {\n  protected listLoader: SearchListLoader<AppMediaViewerTargetType>;\n  protected btnMenuForward: ButtonMenuItemOptions;\n  protected btnMenuDownload: ButtonMenuItemOptions;\n  protected btnMenuDelete: ButtonMenuItemOptions;\n\n  get searchContext() {\n    return this.listLoader.searchContext;\n  }\n\n  constructor() {\n    super(new SearchListLoader({\n      processItem: (item) => {\n        const isForDocument = this.searchContext.inputFilter._ === 'inputMessagesFilterDocument';\n        const {mid, peerId} = item;\n        const media: MyPhoto | MyDocument = getMediaFromMessage(item);\n\n        if(!media) return;\n\n        if(isForDocument && !AppMediaViewer.isMediaCompatibleForDocumentViewer(media)) {\n          return;\n        }\n\n        return {element: null as HTMLElement, mid, peerId};\n      }\n    }), ['delete', 'forward']);\n\n    this.listLoader.onEmptied = () => {\n      this.close();\n    };\n\n    /* const stub = document.createElement('div');\n    stub.classList.add(MEDIA_VIEWER_CLASSNAME + '-stub');\n    this.content.main.prepend(stub); */\n\n    this.content.caption = document.createElement('div');\n    this.content.caption.classList.add(MEDIA_VIEWER_CLASSNAME + '-caption', 'spoilers-container'/* , 'media-viewer-stub' */);\n\n    let captionTimeout: number;\n    const setCaptionTimeout = () => {\n      if(captionTimeout) {\n        clearTimeout(captionTimeout);\n      }\n\n      captionTimeout = window.setTimeout(() => {\n        captionTimeout = undefined;\n        this.content.caption.classList.remove('is-focused');\n      }, 800);\n    };\n    this.content.caption.addEventListener('touchstart', () => {\n      if(!mediaSizes.isMobile) return;\n\n      this.content.caption.classList.add('is-focused');\n\n      if(captionTimeout) {\n        clearTimeout(captionTimeout);\n        captionTimeout = undefined;\n      }\n\n      document.addEventListener('touchend', setCaptionTimeout, {once: true});\n    });\n\n    const captionScrollable = new Scrollable(this.content.caption);\n    captionScrollable.onAdditionalScroll = setCaptionTimeout;\n\n    // this.content.main.append(this.content.caption);\n    this.wholeDiv.append(this.content.caption);\n\n    attachClickEvent(this.buttons.delete, this.onDeleteClick);\n\n    const buttons: ButtonMenuItemOptions[] = [this.btnMenuForward = {\n      icon: 'forward',\n      text: 'Forward',\n      onClick: this.onForwardClick\n    }, this.btnMenuDownload = {\n      icon: 'download',\n      text: 'MediaViewer.Context.Download',\n      onClick: this.onDownloadClick\n    }, this.btnMenuDelete = {\n      icon: 'delete danger',\n      text: 'Delete',\n      onClick: this.onDeleteClick\n    }];\n\n    this.setBtnMenuToggle(buttons);\n\n    // * constructing html end\n\n    this.setListeners();\n  }\n\n  protected setListeners() {\n    super.setListeners();\n    attachClickEvent(this.buttons.forward, this.onForwardClick);\n    attachClickEvent(this.author.container, this.onAuthorClick);\n\n    const onCaptionClick = (e: MouseEvent) => {\n      const a = findUpTag(e.target, 'A');\n      const spoiler = findUpClassName(e.target, 'spoiler');\n      if(a instanceof HTMLAnchorElement && (!spoiler || this.content.caption.classList.contains('is-spoiler-visible'))) { // close viewer if it's t.me/ redirect\n        const onclick = a.getAttribute('onclick');\n        if(!onclick || onclick.includes('showMaskedAlert')) {\n          return;\n        }\n\n        cancelEvent(e);\n\n        this.close().then(() => {\n          this.content.caption.removeEventListener('click', onCaptionClick, {capture: true});\n          a.click();\n        });\n\n        return false;\n      }\n    };\n\n    this.content.caption.addEventListener('click', onCaptionClick, {capture: true});\n  }\n\n  /* public close(e?: MouseEvent) {\n    const good = !this.setMoverAnimationPromise;\n    const promise = super.close(e);\n\n    if(good) { // clear\n      this.currentMessageId = 0;\n      this.peerId = 0;\n    }\n\n    return promise;\n  } */\n\n  protected getMessageByPeer(peerId: PeerId, mid: number) {\n    return this.searchContext.isScheduled ? this.managers.appMessagesManager.getScheduledMessageByPeer(peerId, mid) : this.managers.appMessagesManager.getMessageByPeer(peerId, mid);\n  }\n\n  onPrevClick = async(target: AppMediaViewerTargetType) => {\n    this.openMedia(await this.getMessageByPeer(target.peerId, target.mid), target.element, -1);\n  };\n\n  onNextClick = async(target: AppMediaViewerTargetType) => {\n    this.openMedia(await this.getMessageByPeer(target.peerId, target.mid), target.element, 1);\n  };\n\n  onDeleteClick = () => {\n    const target = this.target;\n    new PopupDeleteMessages(target.peerId, [target.mid], 'chat', () => {\n      this.target = {element: this.content.media} as any;\n      this.close();\n    });\n  };\n\n  onForwardClick = () => {\n    const target = this.target;\n    if(target.mid) {\n      // appSidebarRight.forwardTab.open([target.mid]);\n      new PopupForward({\n        [target.peerId]: [target.mid]\n      }, () => {\n        return this.close();\n      });\n    }\n  };\n\n  onAuthorClick = async(e: MouseEvent) => {\n    const {mid, peerId} = this.target;\n    if(mid && mid !== Number.MAX_SAFE_INTEGER) {\n      const threadId = this.searchContext.threadId;\n      const message = await this.getMessageByPeer(peerId, mid);\n      this.close(e)\n      // .then(() => mediaSizes.isMobile ? appSidebarRight.sharedMediaTab.closeBtn.click() : Promise.resolve())\n      .then(async() => {\n        if(mediaSizes.isMobile) {\n          const tab = appSidebarRight.getTab(AppSharedMediaTab);\n          if(tab) {\n            tab.close();\n          }\n        }\n\n        appImManager.setInnerPeer({\n          peerId: message.peerId,\n          lastMsgId: mid,\n          type: threadId ? 'discussion' : undefined,\n          threadId\n        });\n      });\n    }\n  };\n\n  onDownloadClick = async() => {\n    const {peerId, mid} = this.target;\n    const message = await this.getMessageByPeer(peerId, mid);\n    const media = getMediaFromMessage(message);\n    if(!media) return;\n    appDownloadManager.downloadToDisc({media, queueId: appImManager.chat.bubbles.lazyLoadQueue.queueId});\n  };\n\n  private setCaption(message: MyMessage) {\n    const caption = (message as Message.message).message;\n    let html: Parameters<typeof setInnerHTML>[1] = '';\n    if(caption) {\n      html = wrapRichText(caption, {\n        entities: (message as Message.message).totalEntities\n      });\n    }\n\n    // html = 'Dandelion are a family of flowering plants that grow in many parts of the world.';\n    setInnerHTML(this.content.caption.firstElementChild, html);\n    this.content.caption.classList.toggle('hide', !caption);\n    // this.content.container.classList.toggle('with-caption', !!caption);\n  }\n\n  public setSearchContext(context: MediaSearchContext) {\n    this.listLoader.setSearchContext(context);\n\n    return this;\n  }\n\n  public async openMedia(message: MyMessage, target?: HTMLElement, fromRight = 0, reverse = false,\n    prevTargets: AppMediaViewerTargetType[] = [], nextTargets: AppMediaViewerTargetType[] = []/* , needLoadMore = true */) {\n    if(this.setMoverPromise) return this.setMoverPromise;\n\n    const mid = message.mid;\n    const fromId = (message as Message.message).fwd_from && !message.fromId ? (message as Message.message).fwd_from.from_name : message.fromId;\n    const media = getMediaFromMessage(message);\n\n    const cantForwardMessage = message._ === 'messageService' || !this.managers.appMessagesManager.canForward(message);\n    [this.buttons.forward, this.btnMenuForward.element].forEach((button) => {\n      button.classList.toggle('hide', cantForwardMessage);\n    });\n\n    this.wholeDiv.classList.toggle('no-forwards', cantForwardMessage);\n\n    const cantDownloadMessage = cantForwardMessage;\n    [this.buttons.download, this.btnMenuDownload.element].forEach((button) => {\n      button.classList.toggle('hide', cantDownloadMessage);\n    });\n\n    const canDeleteMessage = this.managers.appMessagesManager.canDeleteMessage(message);\n    [this.buttons.delete, this.btnMenuDelete.element].forEach((button) => {\n      button.classList.toggle('hide', !canDeleteMessage);\n    });\n\n    this.setCaption(message);\n    const promise = super._openMedia(media, message.date, fromId, fromRight, target, reverse, prevTargets, nextTargets, message/* , needLoadMore */);\n    this.target.mid = mid;\n    this.target.peerId = message.peerId;\n\n    return promise;\n  }\n\n  public static isMediaCompatibleForDocumentViewer(media: MyPhoto | MyDocument) {\n    return media._ === 'photo' || MEDIA_MIME_TYPES_SUPPORTED.has(media.mime_type);\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport appMediaPlaybackController from '../components/appMediaPlaybackController';\nimport {IS_APPLE_MOBILE, IS_MOBILE} from '../environment/userAgent';\nimport IS_TOUCH_SUPPORTED from '../environment/touchSupport';\nimport cancelEvent from '../helpers/dom/cancelEvent';\nimport ListenerSetter, {Listener} from '../helpers/listenerSetter';\nimport ButtonMenu from '../components/buttonMenu';\nimport {ButtonMenuToggleHandler} from '../components/buttonMenuToggle';\nimport ControlsHover from '../helpers/dom/controlsHover';\nimport {addFullScreenListener, cancelFullScreen, isFullScreen, requestFullScreen} from '../helpers/dom/fullScreen';\nimport toHHMMSS from '../helpers/string/toHHMMSS';\nimport MediaProgressLine from '../components/mediaProgressLine';\nimport VolumeSelector from '../components/volumeSelector';\nimport debounce from '../helpers/schedulers/debounce';\nimport overlayCounter from '../helpers/overlayCounter';\nimport onMediaLoad from '../helpers/onMediaLoad';\nimport {attachClickEvent} from '../helpers/dom/clickEvent';\n\nexport default class VideoPlayer extends ControlsHover {\n  private static PLAYBACK_RATES = [0.5, 1, 1.5, 2];\n  private static PLAYBACK_RATES_ICONS = ['playback_05', 'playback_1x', 'playback_15', 'playback_2x'];\n\n  protected video: HTMLVideoElement;\n  protected wrapper: HTMLDivElement;\n  protected progress: MediaProgressLine;\n  protected skin: 'default';\n\n  protected listenerSetter: ListenerSetter;\n  protected playbackRateButton: HTMLElement;\n  protected pipButton: HTMLElement;\n\n  /* protected videoParent: HTMLElement;\n  protected videoWhichChild: number; */\n\n  protected onPlaybackRackMenuToggle?: (open: boolean) => void;\n  protected onPip?: (pip: boolean) => void;\n  protected onPipClose?: () => void;\n\n  constructor({video, play = false, streamable = false, duration, onPlaybackRackMenuToggle, onPip, onPipClose}: {\n    video: HTMLVideoElement,\n    play?: boolean,\n    streamable?: boolean,\n    duration?: number,\n    onPlaybackRackMenuToggle?: VideoPlayer['onPlaybackRackMenuToggle'],\n    onPip?: VideoPlayer['onPip'],\n    onPipClose?: VideoPlayer['onPipClose']\n  }) {\n    super();\n\n    this.video = video;\n    this.wrapper = document.createElement('div');\n    this.wrapper.classList.add('ckin__player');\n\n    this.onPlaybackRackMenuToggle = onPlaybackRackMenuToggle;\n    this.onPip = onPip;\n    this.onPipClose = onPipClose;\n\n    this.listenerSetter = new ListenerSetter();\n\n    this.setup({\n      element: this.wrapper,\n      listenerSetter: this.listenerSetter,\n      canHideControls: () => {\n        return !this.video.paused && (!this.playbackRateButton || !this.playbackRateButton.classList.contains('menu-open'));\n      },\n      showOnLeaveToClassName: 'media-viewer-caption',\n      ignoreClickClassName: 'ckin__controls'\n    });\n\n    video.parentNode.insertBefore(this.wrapper, video);\n    this.wrapper.appendChild(video);\n\n    this.skin = 'default';\n\n    this.stylePlayer(duration);\n    this.setBtnMenuToggle();\n\n    if(this.skin === 'default') {\n      const controls = this.wrapper.querySelector('.default__controls.ckin__controls') as HTMLDivElement;\n      this.progress = new MediaProgressLine(video, streamable);\n      controls.prepend(this.progress.container);\n    }\n\n    if(play/*  && video.paused */) {\n      const promise = video.play();\n      promise.catch((err: Error) => {\n        if(err.name === 'NotAllowedError') {\n          video.muted = true;\n          video.autoplay = true;\n          video.play();\n        }\n      }).finally(() => { // due to autoplay, play will not call\n        this.wrapper.classList.toggle('is-playing', !this.video.paused);\n      });\n    }\n  }\n\n  private stylePlayer(initDuration: number) {\n    const {wrapper, video, skin, listenerSetter} = this;\n\n    wrapper.classList.add(skin);\n\n    const html = this.buildControls();\n    wrapper.insertAdjacentHTML('beforeend', html);\n    let timeDuration: HTMLElement;\n\n    if(skin === 'default') {\n      this.playbackRateButton = this.wrapper.querySelector('.playback-rate') as HTMLElement;\n      this.pipButton = this.wrapper.querySelector('.pip') as HTMLElement;\n\n      const toggle = wrapper.querySelectorAll('.toggle') as NodeListOf<HTMLElement>;\n      const fullScreenButton = wrapper.querySelector('.fullscreen') as HTMLElement;\n      const timeElapsed = wrapper.querySelector('#time-elapsed');\n      timeDuration = wrapper.querySelector('#time-duration') as HTMLElement;\n      timeDuration.textContent = toHHMMSS(video.duration | 0);\n\n      const volumeSelector = new VolumeSelector(listenerSetter);\n\n      const leftControls = wrapper.querySelector('.left-controls');\n      volumeSelector.btn.classList.remove('btn-icon');\n      leftControls.insertBefore(volumeSelector.btn, timeElapsed.parentElement);\n\n      Array.from(toggle).forEach((button) => {\n        attachClickEvent(button, () => {\n          this.togglePlay();\n        }, {listenerSetter: this.listenerSetter});\n      });\n\n      if(this.pipButton) {\n        attachClickEvent(this.pipButton, () => {\n          this.video.requestPictureInPicture();\n        }, {listenerSetter: this.listenerSetter});\n\n        const onPip = (pip: boolean) => {\n          this.wrapper.style.visibility = pip ? 'hidden': '';\n          if(this.onPip) {\n            this.onPip(pip);\n          }\n        };\n\n        const debounceTime = 20;\n        const debouncedPip = debounce(onPip, debounceTime, false, true);\n\n        listenerSetter.add(video)('enterpictureinpicture', () => {\n          debouncedPip(true);\n\n          listenerSetter.add(video)('leavepictureinpicture', () => {\n            const onPause = () => {\n              clearTimeout(timeout);\n              if(this.onPipClose) {\n                this.onPipClose();\n              }\n            };\n            const listener = listenerSetter.add(video)('pause', onPause, {once: true}) as any as Listener;\n            const timeout = setTimeout(() => {\n              listenerSetter.remove(listener);\n            }, debounceTime);\n          }, {once: true});\n        });\n\n        listenerSetter.add(video)('leavepictureinpicture', () => {\n          debouncedPip(false);\n        });\n      }\n\n      if(!IS_TOUCH_SUPPORTED) {\n        attachClickEvent(video, () => {\n          this.togglePlay();\n        }, {listenerSetter: this.listenerSetter});\n\n        listenerSetter.add(document)('keydown', (e: KeyboardEvent) => {\n          if(overlayCounter.overlaysActive > 1 || document.pictureInPictureElement === video) { // forward popup is active, etc\n            return;\n          }\n\n          const {key, code} = e;\n\n          let good = true;\n          if(code === 'KeyF') {\n            this.toggleFullScreen();\n          } else if(code === 'KeyM') {\n            appMediaPlaybackController.muted = !appMediaPlaybackController.muted;\n          } else if(code === 'Space') {\n            this.togglePlay();\n          } else if(e.altKey && (code === 'Equal' || code === 'Minus')) {\n            const add = code === 'Equal' ? 1 : -1;\n            const playbackRate = appMediaPlaybackController.playbackRate;\n            const idx = VideoPlayer.PLAYBACK_RATES.indexOf(playbackRate);\n            const nextIdx = idx + add;\n            if(nextIdx >= 0 && nextIdx < VideoPlayer.PLAYBACK_RATES.length) {\n              appMediaPlaybackController.playbackRate = VideoPlayer.PLAYBACK_RATES[nextIdx];\n            }\n          } else if(wrapper.classList.contains('ckin__fullscreen') && (key === 'ArrowLeft' || key === 'ArrowRight')) {\n            if(key === 'ArrowLeft') appMediaPlaybackController.seekBackward({action: 'seekbackward'});\n            else appMediaPlaybackController.seekForward({action: 'seekforward'});\n          } else {\n            good = false;\n          }\n\n          if(good) {\n            cancelEvent(e);\n            return false;\n          }\n        });\n      }\n\n      listenerSetter.add(video)('dblclick', () => {\n        if(!IS_TOUCH_SUPPORTED) {\n          this.toggleFullScreen();\n        }\n      });\n\n      attachClickEvent(fullScreenButton, () => {\n        this.toggleFullScreen();\n      }, {listenerSetter: this.listenerSetter});\n\n      addFullScreenListener(wrapper, this.onFullScreen.bind(this, fullScreenButton), listenerSetter);\n\n      listenerSetter.add(video)('timeupdate', () => {\n        timeElapsed.textContent = toHHMMSS(video.currentTime | 0);\n      });\n\n      listenerSetter.add(video)('play', () => {\n        wrapper.classList.add('played');\n\n        if(!IS_TOUCH_SUPPORTED) {\n          listenerSetter.add(video)('play', () => {\n            this.hideControls(true);\n          });\n        }\n      }, {once: true});\n\n      listenerSetter.add(video)('pause', () => {\n        this.showControls(false);\n      });\n\n      listenerSetter.add(appMediaPlaybackController)('playbackParams', () => {\n        this.setPlaybackRateIcon();\n      });\n    }\n\n    listenerSetter.add(video)('play', () => {\n      wrapper.classList.add('is-playing');\n    });\n\n    listenerSetter.add(video)('pause', () => {\n      wrapper.classList.remove('is-playing');\n    });\n\n    if(video.duration || initDuration) {\n      timeDuration.textContent = toHHMMSS(Math.round(video.duration || initDuration));\n    } else {\n      onMediaLoad(video).then(() => {\n        timeDuration.textContent = toHHMMSS(Math.round(video.duration));\n      });\n    }\n  }\n\n  protected togglePlay() {\n    this.video[this.video.paused ? 'play' : 'pause']();\n  }\n\n  private buildControls() {\n    const skin = this.skin;\n    if(skin === 'default') {\n      return `\n      <button class=\"${skin}__button--big toggle tgico\" title=\"Toggle Play\"></button>\n      <div class=\"${skin}__gradient-bottom ckin__controls\"></div>\n      <div class=\"${skin}__controls ckin__controls\">\n        <div class=\"bottom-controls\">\n          <div class=\"left-controls\">\n            <button class=\"btn-icon ${skin}__button toggle tgico\" title=\"Toggle Video\"></button>\n            <div class=\"time\">\n              <time id=\"time-elapsed\">0:00</time>\n              <span> / </span>\n              <time id=\"time-duration\">0:00</time>\n            </div>\n          </div>\n          <div class=\"right-controls\">\n            <button class=\"btn-icon ${skin}__button btn-menu-toggle playback-rate night\" title=\"Playback Rate\"></button>\n            ${!IS_MOBILE && document.pictureInPictureEnabled ? `<button class=\"btn-icon ${skin}__button pip tgico-pip\" title=\"Picture-in-Picture\"></button>` : ''}\n            <button class=\"btn-icon ${skin}__button fullscreen tgico-fullscreen\" title=\"Full Screen\"></button>\n          </div>\n        </div>\n      </div>`;\n    }\n  }\n\n  protected setBtnMenuToggle() {\n    const buttons: Parameters<typeof ButtonMenu>[0] = VideoPlayer.PLAYBACK_RATES.map((rate, idx) => {\n      return {\n        // icon: VideoPlayer.PLAYBACK_RATES_ICONS[idx],\n        regularText: rate + 'x',\n        onClick: () => {\n          appMediaPlaybackController.playbackRate = rate;\n        }\n      };\n    });\n    const btnMenu = ButtonMenu(buttons);\n    btnMenu.classList.add('top-left');\n    ButtonMenuToggleHandler(\n      this.playbackRateButton,\n      this.onPlaybackRackMenuToggle ? () => {\n        this.onPlaybackRackMenuToggle(true);\n      } : undefined,\n      undefined,\n      this.onPlaybackRackMenuToggle ? () => {\n        this.onPlaybackRackMenuToggle(false);\n      } : undefined\n    );\n    this.playbackRateButton.append(btnMenu);\n\n    this.setPlaybackRateIcon();\n  }\n\n  protected setPlaybackRateIcon() {\n    const playbackRateButton = this.playbackRateButton;\n    VideoPlayer.PLAYBACK_RATES_ICONS.forEach((className) => {\n      className = 'tgico-' + className;\n      playbackRateButton.classList.remove(className);\n    });\n\n    let idx = VideoPlayer.PLAYBACK_RATES.indexOf(appMediaPlaybackController.playbackRate);\n    if(idx === -1) idx = VideoPlayer.PLAYBACK_RATES.indexOf(1);\n\n    playbackRateButton.classList.add('tgico-' + VideoPlayer.PLAYBACK_RATES_ICONS[idx]);\n  }\n\n  protected toggleFullScreen() {\n    const player = this.wrapper;\n\n    // * https://caniuse.com/#feat=fullscreen\n    if(IS_APPLE_MOBILE) {\n      const video = this.video as any;\n      video.webkitEnterFullscreen();\n      video.enterFullscreen();\n      return;\n    }\n\n    if(!isFullScreen()) {\n      /* const videoParent = this.video.parentElement;\n      const videoWhichChild = whichChild(this.video);\n      const needVideoRemount = videoParent !== player;\n\n      if(needVideoRemount) {\n        this.videoParent = videoParent;\n        this.videoWhichChild = videoWhichChild;\n        player.prepend(this.video);\n      } */\n\n      requestFullScreen(player);\n    } else {\n      /* if(this.videoParent) {\n        const {videoWhichChild, videoParent} = this;\n        if(!videoWhichChild) {\n          videoParent.prepend(this.video);\n        } else {\n          videoParent.insertBefore(this.video, videoParent.children[videoWhichChild]);\n        }\n\n        this.videoParent = null;\n        this.videoWhichChild = -1;\n      } */\n\n      cancelFullScreen();\n    }\n  }\n\n  protected onFullScreen(fullScreenButton: HTMLElement) {\n    const isFull = isFullScreen();\n    this.wrapper.classList.toggle('ckin__fullscreen', isFull);\n    if(!isFull) {\n      fullScreenButton.classList.remove('tgico-smallscreen');\n      fullScreenButton.classList.add('tgico-fullscreen');\n      fullScreenButton.setAttribute('title', 'Full Screen');\n    } else {\n      fullScreenButton.classList.remove('tgico-fullscreen');\n      fullScreenButton.classList.add('tgico-smallscreen');\n      fullScreenButton.setAttribute('title', 'Exit Full Screen');\n    }\n  }\n\n  public cleanup() {\n    super.cleanup();\n    this.listenerSetter.removeAll();\n    this.progress.removeListeners();\n    this.onPlaybackRackMenuToggle = this.onPip = undefined;\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport deferredPromise from '../helpers/cancellablePromise';\nimport mediaSizes from '../helpers/mediaSizes';\nimport IS_TOUCH_SUPPORTED from '../environment/touchSupport';\nimport {IS_MOBILE_SAFARI, IS_SAFARI} from '../environment/userAgent';\nimport type {MyDocument} from '../lib/appManagers/appDocsManager';\nimport type {MyPhoto} from '../lib/appManagers/appPhotosManager';\nimport {logger} from '../lib/logger';\nimport VideoPlayer from '../lib/mediaPlayer';\nimport rootScope from '../lib/rootScope';\nimport animationIntersector from './animationIntersector';\nimport appMediaPlaybackController, {AppMediaPlaybackController} from './appMediaPlaybackController';\nimport AvatarElement from './avatar';\nimport ButtonIcon from './buttonIcon';\nimport {ButtonMenuItemOptions} from './buttonMenu';\nimport ButtonMenuToggle from './buttonMenuToggle';\nimport ProgressivePreloader from './preloader';\nimport SwipeHandler from './swipeHandler';\nimport {formatFullSentTime} from '../helpers/date';\nimport appNavigationController, {NavigationItem} from './appNavigationController';\nimport {Message} from '../layer';\nimport findUpClassName from '../helpers/dom/findUpClassName';\nimport renderImageFromUrl, {renderImageFromUrlPromise} from '../helpers/dom/renderImageFromUrl';\nimport getVisibleRect from '../helpers/dom/getVisibleRect';\nimport cancelEvent from '../helpers/dom/cancelEvent';\nimport fillPropertyValue from '../helpers/fillPropertyValue';\nimport generatePathData from '../helpers/generatePathData';\nimport replaceContent from '../helpers/dom/replaceContent';\nimport PeerTitle from './peerTitle';\nimport {doubleRaf, fastRaf} from '../helpers/schedulers';\nimport RangeSelector from './rangeSelector';\nimport windowSize from '../helpers/windowSize';\nimport ListLoader from '../helpers/listLoader';\nimport EventListenerBase from '../helpers/eventListenerBase';\nimport {MyMessage} from '../lib/appManagers/appMessagesManager';\nimport {NULL_PEER_ID} from '../lib/mtproto/mtproto_config';\nimport {isFullScreen} from '../helpers/dom/fullScreen';\nimport {attachClickEvent} from '../helpers/dom/clickEvent';\nimport SearchListLoader from '../helpers/searchListLoader';\nimport createVideo from '../helpers/dom/createVideo';\nimport {AppManagers} from '../lib/appManagers/managers';\nimport getStrippedThumbIfNeeded from '../helpers/getStrippedThumbIfNeeded';\nimport setAttachmentSize from '../helpers/setAttachmentSize';\nimport wrapEmojiText from '../lib/richTextProcessor/wrapEmojiText';\nimport LazyLoadQueueBase from './lazyLoadQueueBase';\nimport overlayCounter from '../helpers/overlayCounter';\nimport {ThumbCache} from '../lib/storages/thumbs';\nimport appDownloadManager from '../lib/appManagers/appDownloadManager';\nimport wrapPeerTitle from './wrappers/peerTitle';\n\nconst ZOOM_STEP = 0.5;\nconst ZOOM_INITIAL_VALUE = 1;\nconst ZOOM_MIN_VALUE = 0.5;\nconst ZOOM_MAX_VALUE = 4;\n\n// TODO:   ( SVG)  ,      \n// TODO:  \"\"      ,     (,  )\n// TODO:    ,    :    ,     , ..  -   ,   \n\nexport const MEDIA_VIEWER_CLASSNAME = 'media-viewer';\n\nexport default class AppMediaViewerBase<\n  ContentAdditionType extends string,\n  ButtonsAdditionType extends string,\n  TargetType extends {element: HTMLElement\n}> extends EventListenerBase<{\n  setMoverBefore: () => void,\n  setMoverAfter: () => void\n}> {\n  protected wholeDiv: HTMLElement;\n  protected overlaysDiv: HTMLElement;\n  protected author: {[k in 'container' | 'avatarEl' | 'nameEl' | 'date']: HTMLElement} = {} as any;\n  protected content: {[k in 'main' | 'container' | 'media' | 'mover' | ContentAdditionType]: HTMLElement} = {} as any;\n  protected buttons: {[k in 'download' | 'close' | 'prev' | 'next' | 'mobile-close' | 'zoom' | ButtonsAdditionType]: HTMLElement} = {} as any;\n  protected topbar: HTMLElement;\n  protected moversContainer: HTMLElement;\n\n  protected tempId = 0;\n  protected preloader: ProgressivePreloader = null;\n  protected preloaderStreamable: ProgressivePreloader = null;\n\n  // protected targetContainer: HTMLElement = null;\n  // protected loadMore: () => void = null;\n\n  protected log: ReturnType<typeof logger>;\n\n  protected isFirstOpen = true;\n\n  // protected needLoadMore = true;\n\n  protected pageEl = document.getElementById('page-chats') as HTMLDivElement;\n\n  protected setMoverPromise: Promise<void>;\n  protected setMoverAnimationPromise: Promise<void>;\n\n  protected lazyLoadQueue: LazyLoadQueueBase;\n\n  protected highlightSwitchersTimeout: number;\n\n  protected onDownloadClick: (e: MouseEvent) => void;\n  protected onPrevClick: (target: TargetType) => void;\n  protected onNextClick: (target: TargetType) => void;\n\n  protected videoPlayer: VideoPlayer;\n\n  protected zoomElements: {\n    container: HTMLElement,\n    btnOut: HTMLElement,\n    btnIn: HTMLElement,\n    rangeSelector: RangeSelector\n  } = {} as any;\n  // protected zoomValue = ZOOM_INITIAL_VALUE;\n  protected zoomSwipeHandler: SwipeHandler;\n  protected zoomSwipeStartX = 0;\n  protected zoomSwipeStartY = 0;\n  protected zoomSwipeX = 0;\n  protected zoomSwipeY = 0;\n\n  protected ctrlKeyDown: boolean;\n  protected releaseSingleMedia: ReturnType<AppMediaPlaybackController['setSingleMedia']>;\n  protected navigationItem: NavigationItem;\n\n  protected managers: AppManagers;\n\n  get target() {\n    return this.listLoader.current;\n  }\n\n  set target(value) {\n    this.listLoader.current = value;\n  }\n\n  constructor(\n    protected listLoader: ListLoader<TargetType, any>,\n    topButtons: Array<keyof AppMediaViewerBase<ContentAdditionType, ButtonsAdditionType, TargetType>['buttons']>\n  ) {\n    super(false);\n\n    this.managers = rootScope.managers;\n\n    this.log = logger('AMV');\n    this.preloader = new ProgressivePreloader();\n    this.preloaderStreamable = new ProgressivePreloader({\n      cancelable: false,\n      streamable: true\n    });\n    this.preloader.construct();\n    this.preloaderStreamable.construct();\n    this.lazyLoadQueue = new LazyLoadQueueBase();\n\n    this.wholeDiv = document.createElement('div');\n    this.wholeDiv.classList.add(MEDIA_VIEWER_CLASSNAME + '-whole');\n\n    this.overlaysDiv = document.createElement('div');\n    this.overlaysDiv.classList.add('overlays');\n\n    const mainDiv = document.createElement('div');\n    mainDiv.classList.add(MEDIA_VIEWER_CLASSNAME);\n\n    const topbar = this.topbar = document.createElement('div');\n    topbar.classList.add(MEDIA_VIEWER_CLASSNAME + '-topbar', MEDIA_VIEWER_CLASSNAME + '-appear');\n\n    const topbarLeft = document.createElement('div');\n    topbarLeft.classList.add(MEDIA_VIEWER_CLASSNAME + '-topbar-left');\n\n    this.buttons['mobile-close'] = ButtonIcon('close', {onlyMobile: true});\n\n    // * author\n    this.author.container = document.createElement('div');\n    this.author.container.classList.add(MEDIA_VIEWER_CLASSNAME + '-author', 'no-select');\n    const authorRight = document.createElement('div');\n\n    this.author.avatarEl = new AvatarElement();\n    this.author.avatarEl.classList.add(MEDIA_VIEWER_CLASSNAME + '-userpic', 'avatar-44');\n\n    this.author.nameEl = document.createElement('div');\n    this.author.nameEl.classList.add(MEDIA_VIEWER_CLASSNAME + '-name');\n\n    this.author.date = document.createElement('div');\n    this.author.date.classList.add(MEDIA_VIEWER_CLASSNAME + '-date');\n\n    authorRight.append(this.author.nameEl, this.author.date);\n\n    this.author.container.append(this.author.avatarEl, authorRight);\n\n    // * buttons\n    const buttonsDiv = document.createElement('div');\n    buttonsDiv.classList.add(MEDIA_VIEWER_CLASSNAME + '-buttons');\n\n    topButtons.concat(['download', 'zoom', 'close']).forEach((name) => {\n      const button = ButtonIcon(name, {noRipple: true});\n      this.buttons[name] = button;\n      buttonsDiv.append(button);\n    });\n\n    this.buttons.zoom.classList.add('zoom-in');\n\n    // * zoom\n    this.zoomElements.container = document.createElement('div');\n    this.zoomElements.container.classList.add('zoom-container');\n\n    this.zoomElements.btnOut = ButtonIcon('zoomout', {noRipple: true});\n    attachClickEvent(this.zoomElements.btnOut, () => this.changeZoom(false));\n    this.zoomElements.btnIn = ButtonIcon('zoomin', {noRipple: true});\n    attachClickEvent(this.zoomElements.btnIn, () => this.changeZoom(true));\n\n    this.zoomElements.rangeSelector = new RangeSelector({\n      step: ZOOM_STEP,\n      min: ZOOM_MIN_VALUE,\n      max: ZOOM_MAX_VALUE,\n      withTransition: true\n    }, ZOOM_INITIAL_VALUE);\n    this.zoomElements.rangeSelector.setListeners();\n    this.zoomElements.rangeSelector.setHandlers({\n      onScrub: this.setZoomValue,\n      onMouseUp: () => this.setZoomValue()\n    });\n\n    this.zoomElements.container.append(this.zoomElements.btnOut, this.zoomElements.rangeSelector.container, this.zoomElements.btnIn);\n\n    this.wholeDiv.append(this.zoomElements.container);\n\n    // * content\n    this.content.main = document.createElement('div');\n    this.content.main.classList.add(MEDIA_VIEWER_CLASSNAME + '-content');\n\n    this.content.container = document.createElement('div');\n    this.content.container.classList.add(MEDIA_VIEWER_CLASSNAME + '-container');\n\n    this.content.media = document.createElement('div');\n    this.content.media.classList.add(MEDIA_VIEWER_CLASSNAME + '-media');\n\n    this.content.container.append(this.content.media);\n\n    this.content.main.append(this.content.container);\n    mainDiv.append(this.content.main);\n    this.overlaysDiv.append(mainDiv);\n    // * overlays end\n\n    topbarLeft.append(this.buttons['mobile-close'], this.author.container);\n    topbar.append(topbarLeft, buttonsDiv);\n\n    this.buttons.prev = document.createElement('div');\n    this.buttons.prev.className = `${MEDIA_VIEWER_CLASSNAME}-switcher ${MEDIA_VIEWER_CLASSNAME}-switcher-left`;\n    this.buttons.prev.innerHTML = `<span class=\"tgico-down ${MEDIA_VIEWER_CLASSNAME}-prev-button\"></span>`;\n\n    this.buttons.next = document.createElement('div');\n    this.buttons.next.className = `${MEDIA_VIEWER_CLASSNAME}-switcher ${MEDIA_VIEWER_CLASSNAME}-switcher-right`;\n    this.buttons.next.innerHTML = `<span class=\"tgico-down ${MEDIA_VIEWER_CLASSNAME}-next-button\"></span>`;\n\n    this.moversContainer = document.createElement('div');\n    this.moversContainer.classList.add(MEDIA_VIEWER_CLASSNAME + '-movers');\n\n    this.wholeDiv.append(this.overlaysDiv, this.buttons.prev, this.buttons.next, this.topbar, this.moversContainer);\n\n    // * constructing html end\n\n    this.listLoader.onLoadedMore = () => {\n      this.buttons.prev.classList.toggle('hide', !this.listLoader.previous.length);\n      this.buttons.next.classList.toggle('hide', !this.listLoader.next.length);\n    };\n\n    this.setNewMover();\n  }\n\n  protected setListeners() {\n    attachClickEvent(this.buttons.download, this.onDownloadClick);\n    [this.buttons.close, this.buttons['mobile-close'], this.preloaderStreamable.preloader].forEach((el) => {\n      attachClickEvent(el, this.close.bind(this));\n    });\n\n    ([[-1, this.buttons.prev], [1, this.buttons.next]] as [number, HTMLElement][]).forEach(([moveLength, button]) => {\n      // attachClickEvent(button, (e) => {\n      button.addEventListener('click', (e) => {\n        cancelEvent(e);\n        if(this.setMoverPromise) return;\n\n        this.listLoader.go(moveLength);\n      });\n    });\n\n    attachClickEvent(this.buttons.zoom, () => {\n      if(this.isZooming()) this.toggleZoom(false);\n      else {\n        this.changeZoom(true);\n      }\n    });\n\n    // ! cannot use the function because it'll cancel slide event on touch devices\n    // attachClickEvent(this.wholeDiv, this.onClick);\n    this.wholeDiv.addEventListener('click', this.onClick);\n\n    this.listLoader.onJump = (item, older) => {\n      if(older) this.onNextClick(item);\n      else this.onPrevClick(item);\n    };\n\n    if(IS_TOUCH_SUPPORTED) {\n      const swipeHandler = new SwipeHandler({\n        element: this.wholeDiv,\n        onSwipe: (xDiff, yDiff) => {\n          if(isFullScreen()) {\n            return;\n          }\n          // console.log(xDiff, yDiff);\n\n          const percents = Math.abs(xDiff) / windowSize.width;\n          if(percents > .2 || xDiff > 125) {\n            // console.log('will swipe', xDiff);\n\n            if(xDiff < 0) {\n              this.buttons.prev.click();\n            } else {\n              this.buttons.next.click();\n            }\n\n            return true;\n          }\n\n          const percentsY = Math.abs(yDiff) / windowSize.height;\n          if(percentsY > .2 || yDiff > 125) {\n            this.close();\n            return true;\n          }\n\n          return false;\n        },\n        verifyTouchTarget: (evt) => {\n          // * Fix for seek input\n          if((evt.target as HTMLElement).tagName === 'INPUT' || findUpClassName(evt.target, 'media-viewer-caption')) {\n            return false;\n          }\n\n          return true;\n        }\n      });\n    }\n  }\n\n  protected toggleZoom(enable?: boolean) {\n    const isVisible = this.isZooming();\n    if(this.zoomElements.rangeSelector.mousedown || this.ctrlKeyDown) {\n      enable = true;\n    }\n\n    if(isVisible === enable) return;\n\n    if(enable === undefined) {\n      enable = !isVisible;\n    }\n\n    this.buttons.zoom.classList.toggle('zoom-in', !enable);\n    this.zoomElements.container.classList.toggle('is-visible', enable);\n    const zoomValue = enable ? this.zoomElements.rangeSelector.value : 1;\n    this.setZoomValue(zoomValue);\n    this.zoomElements.rangeSelector.setProgress(zoomValue);\n\n    if(this.videoPlayer) {\n      this.videoPlayer.lockControls(enable ? false : undefined);\n    }\n\n    if(enable) {\n      if(!this.zoomSwipeHandler) {\n        let lastDiffX: number, lastDiffY: number;\n        const multiplier = -1;\n        this.zoomSwipeHandler = new SwipeHandler({\n          element: this.moversContainer,\n          onFirstSwipe: () => {\n            lastDiffX = lastDiffY = 0;\n            this.moversContainer.classList.add('no-transition');\n          },\n          onSwipe: (xDiff, yDiff) => {\n            [xDiff, yDiff] = [xDiff * multiplier, yDiff * multiplier];\n            this.zoomSwipeX += xDiff - lastDiffX;\n            this.zoomSwipeY += yDiff - lastDiffY;\n            [lastDiffX, lastDiffY] = [xDiff, yDiff];\n\n            this.setZoomValue();\n          },\n          onReset: () => {\n            this.moversContainer.classList.remove('no-transition');\n          },\n          cursor: 'move'\n        });\n      } else {\n        this.zoomSwipeHandler.setListeners();\n      }\n\n      this.zoomElements.rangeSelector.setProgress(zoomValue);\n    } else if(!enable) {\n      this.zoomSwipeHandler.removeListeners();\n    }\n  }\n\n  protected changeZoom(add: boolean) {\n    this.zoomElements.rangeSelector.addProgress(ZOOM_STEP * (add ? 1 : -1));\n    this.setZoomValue();\n  }\n\n  protected setZoomValue = (value = this.zoomElements.rangeSelector.value) => {\n    // this.zoomValue = value;\n    if(value === ZOOM_INITIAL_VALUE) {\n      this.zoomSwipeX = 0;\n      this.zoomSwipeY = 0;\n    }\n\n    this.moversContainer.style.transform = `matrix(${value}, 0, 0, ${value}, ${this.zoomSwipeX}, ${this.zoomSwipeY})`;\n\n    this.zoomElements.btnOut.classList.toggle('inactive', value === ZOOM_MIN_VALUE);\n    this.zoomElements.btnIn.classList.toggle('inactive', value === ZOOM_MAX_VALUE);\n\n    this.toggleZoom(value !== ZOOM_INITIAL_VALUE);\n  };\n\n  protected isZooming() {\n    return this.zoomElements.container.classList.contains('is-visible');\n  }\n\n  protected setBtnMenuToggle(buttons: ButtonMenuItemOptions[]) {\n    const btnMenuToggle = ButtonMenuToggle({onlyMobile: true}, 'bottom-left', buttons);\n    this.topbar.append(btnMenuToggle);\n  }\n\n  public close(e?: MouseEvent) {\n    if(e) {\n      cancelEvent(e);\n    }\n\n    if(this.setMoverAnimationPromise) return Promise.reject();\n\n    if(this.navigationItem) {\n      appNavigationController.removeItem(this.navigationItem);\n    }\n\n    this.lazyLoadQueue.clear();\n\n    const promise = this.setMoverToTarget(this.target?.element, true).then(({onAnimationEnd}) => onAnimationEnd);\n\n    this.listLoader.reset();\n    (this.listLoader as SearchListLoader<any>).cleanup && (this.listLoader as SearchListLoader<any>).cleanup();\n    this.setMoverPromise = null;\n    this.tempId = -1;\n    if((window as any).appMediaViewer === this) {\n      (window as any).appMediaViewer = undefined;\n    }\n\n    /* if(appSidebarRight.historyTabIDs.slice(-1)[0] === AppSidebarRight.SLIDERITEMSIDS.forward) {\n      promise.then(() => {\n        appSidebarRight.forwardTab.closeBtn.click();\n      });\n    } */\n\n    this.removeGlobalListeners();\n\n    this.zoomSwipeHandler = undefined;\n\n    promise.finally(() => {\n      this.wholeDiv.remove();\n      this.toggleOverlay(false);\n    });\n\n    return promise;\n  }\n\n  protected toggleOverlay(active: boolean) {\n    overlayCounter.isOverlayActive = active;\n    animationIntersector.checkAnimations(active);\n  }\n\n  protected toggleGlobalListeners(active: boolean) {\n    if(active) this.setGlobalListeners();\n    else this.removeGlobalListeners();\n  }\n\n  protected removeGlobalListeners() {\n    if(this.zoomSwipeHandler) {\n      this.zoomSwipeHandler.removeListeners();\n    }\n\n    window.removeEventListener('keydown', this.onKeyDown);\n    window.removeEventListener('keyup', this.onKeyUp);\n    window.removeEventListener('wheel', this.onWheel, {capture: true});\n  }\n\n  protected setGlobalListeners() {\n    if(this.isZooming()) {\n      this.zoomSwipeHandler.setListeners();\n    }\n\n    window.addEventListener('keydown', this.onKeyDown);\n    window.addEventListener('keyup', this.onKeyUp);\n    if(!IS_TOUCH_SUPPORTED) window.addEventListener('wheel', this.onWheel, {passive: false, capture: true});\n  }\n\n  onClick = (e: MouseEvent) => {\n    if(this.setMoverAnimationPromise) return;\n\n    const target = e.target as HTMLElement;\n    if(target.tagName === 'A') return;\n    cancelEvent(e);\n\n    if(IS_TOUCH_SUPPORTED) {\n      if(this.highlightSwitchersTimeout) {\n        clearTimeout(this.highlightSwitchersTimeout);\n      } else {\n        this.wholeDiv.classList.add('highlight-switchers');\n      }\n\n      this.highlightSwitchersTimeout = window.setTimeout(() => {\n        this.wholeDiv.classList.remove('highlight-switchers');\n        this.highlightSwitchersTimeout = 0;\n      }, 3e3);\n\n      return;\n    }\n\n    const isZooming = this.isZooming();\n    let mover: HTMLElement = null;\n    const classNames = ['ckin__player', 'media-viewer-buttons', 'media-viewer-author', 'media-viewer-caption', 'zoom-container'];\n    if(isZooming) {\n      classNames.push('media-viewer-movers');\n    }\n\n    classNames.find((s) => {\n      try {\n        mover = findUpClassName(target, s);\n        if(mover) return true;\n      } catch(err) {return false;}\n    });\n\n    if(/* target === this.mediaViewerDiv */!mover || (!isZooming && (target.tagName === 'IMG' || target.tagName === 'image'))) {\n      this.close();\n    }\n  };\n\n  private onKeyDown = (e: KeyboardEvent) => {\n    // this.log('onKeyDown', e);\n    if(overlayCounter.overlaysActive > 1) {\n      return;\n    }\n\n    const key = e.key;\n\n    let good = true;\n    if(key === 'ArrowRight') {\n      this.buttons.next.click();\n    } else if(key === 'ArrowLeft') {\n      this.buttons.prev.click();\n    } else if(key === '-' || key === '=') {\n      if(this.ctrlKeyDown) {\n        this.changeZoom(key === '=');\n      }\n    } else {\n      good = false;\n    }\n\n    if(e.ctrlKey || e.metaKey) {\n      this.ctrlKeyDown = true;\n    }\n\n    if(good) {\n      cancelEvent(e);\n    }\n  };\n\n  private onKeyUp = (e: KeyboardEvent) => {\n    if(overlayCounter.overlaysActive > 1) {\n      return;\n    }\n\n    if(!(e.ctrlKey || e.metaKey)) {\n      this.ctrlKeyDown = false;\n\n      if(this.isZooming()) {\n        this.setZoomValue();\n      }\n    }\n  };\n\n  private onWheel = (e: WheelEvent) => {\n    if(overlayCounter.overlaysActive > 1 || (findUpClassName(e.target, 'media-viewer-caption') && !this.ctrlKeyDown)) {\n      return;\n    }\n\n    cancelEvent(e);\n\n    if(this.ctrlKeyDown) {\n      const scrollingUp = e.deltaY < 0;\n      // if(!scrollingUp && !this.isZooming()) return;\n      this.changeZoom(!!scrollingUp);\n    }\n  };\n\n  protected async setMoverToTarget(target: HTMLElement, closing = false, fromRight = 0) {\n    this.dispatchEvent('setMoverBefore');\n\n    const mover = this.content.mover;\n\n    if(!closing) {\n      mover.innerHTML = '';\n      // mover.append(this.buttons.prev, this.buttons.next);\n    }\n\n    const zoomValue = this.isZooming() && closing /* && false */ ? this.zoomElements.rangeSelector.value : ZOOM_INITIAL_VALUE;\n    /* if(!(zoomValue > 1 && closing)) */ this.removeCenterFromMover(mover);\n\n    const wasActive = fromRight !== 0;\n\n    const delay = rootScope.settings.animationsEnabled ? (wasActive ? 350 : 200) : 0;\n    // let delay = wasActive ? 350 : 10000;\n\n    /* if(wasActive) {\n      this.moveTheMover(mover);\n      mover = this.setNewMover();\n    } */\n\n    /* if(DEBUG) {\n      this.log('setMoverToTarget', target, closing, wasActive, fromRight);\n    } */\n\n    let realParent: HTMLElement;\n\n    let rect: DOMRect;\n    if(target) {\n      if(target instanceof AvatarElement || target.classList.contains('grid-item')/*  || target.classList.contains('document-ico') */) {\n        realParent = target;\n        rect = target.getBoundingClientRect();\n      } else if(target instanceof SVGImageElement || target.parentElement instanceof SVGForeignObjectElement) {\n        realParent = findUpClassName(target, 'attachment');\n        rect = realParent.getBoundingClientRect();\n      } else if(target.classList.contains('profile-avatars-avatar')) {\n        realParent = findUpClassName(target, 'profile-avatars-container');\n        rect = realParent.getBoundingClientRect();\n\n        // * if not active avatar\n        if(closing && target.getBoundingClientRect().left !== rect.left) {\n          target = realParent = rect = undefined;\n        }\n      }\n    }\n\n    if(!target) {\n      target = this.content.media;\n    }\n\n    if(!rect) {\n      realParent = target.parentElement as HTMLElement;\n      rect = target.getBoundingClientRect();\n    }\n\n    let needOpacity = false;\n    if(target !== this.content.media && !target.classList.contains('profile-avatars-avatar')) {\n      const overflowElement = findUpClassName(realParent, 'scrollable');\n      const visibleRect = getVisibleRect(realParent, overflowElement, true);\n\n      if(closing && (!visibleRect || visibleRect.overflow.vertical === 2 || visibleRect.overflow.horizontal === 2)) {\n        target = this.content.media;\n        realParent = target.parentElement as HTMLElement;\n        rect = target.getBoundingClientRect();\n      } else if(visibleRect && (visibleRect.overflow.vertical === 1 || visibleRect.overflow.horizontal === 1)) {\n        needOpacity = true;\n      }\n    }\n\n    const containerRect = this.content.media.getBoundingClientRect();\n\n    let transform = '';\n    let left: number;\n    let top: number;\n\n    if(wasActive) {\n      left = fromRight === 1 ? windowSize.width : -containerRect.width;\n      top = containerRect.top;\n    } else {\n      left = rect.left;\n      top = rect.top;\n    }\n\n    /* if(zoomValue > 1) { // 33\n      // const diffX = (rect.width * zoomValue - rect.width) / 4;\n      const diffX = (rect.width * zoomValue - rect.width) / 2;\n      const diffY = (rect.height * zoomValue - rect.height) / 4;\n      // left -= diffX;\n      // top += diffY;\n    } */\n\n    transform += `translate3d(${left}px,${top}px,0) `;\n\n    /* if(wasActive) {\n      left = fromRight === 1 ? appPhotosManager.windowW / 2 : -(containerRect.width + appPhotosManager.windowW / 2);\n      transform += `translate(${left}px,-50%) `;\n    } else {\n      left = rect.left - (appPhotosManager.windowW / 2);\n      top = rect.top - (appPhotosManager.windowH / 2);\n      transform += `translate(${left}px,${top}px) `;\n    } */\n\n    let aspecter: HTMLDivElement;\n    if(target instanceof HTMLImageElement || target instanceof HTMLVideoElement || target.tagName === 'DIV') {\n      if(mover.firstElementChild && mover.firstElementChild.classList.contains('media-viewer-aspecter')) {\n        aspecter = mover.firstElementChild as HTMLDivElement;\n\n        const player = aspecter.querySelector('.ckin__player');\n        if(player) {\n          const video = player.firstElementChild as HTMLVideoElement;\n          aspecter.append(video);\n          player.remove();\n        }\n\n        if(!aspecter.style.cssText) { //  - ,   ,       \n          mover.classList.remove('active');\n          this.setFullAspect(aspecter, containerRect, rect);\n          void mover.offsetLeft; // reflow\n          mover.classList.add('active');\n        }\n      } else {\n        aspecter = document.createElement('div');\n        aspecter.classList.add('media-viewer-aspecter'/* , 'disable-hover' */);\n        mover.prepend(aspecter);\n      }\n\n      aspecter.style.cssText = `width: ${rect.width}px; height: ${rect.height}px; transform: scale3d(${containerRect.width / rect.width}, ${containerRect.height / rect.height}, 1);`;\n    }\n\n    mover.style.width = containerRect.width + 'px';\n    mover.style.height = containerRect.height + 'px';\n\n    // const scaleX = rect.width / (containerRect.width * zoomValue);\n    // const scaleY = rect.height / (containerRect.height * zoomValue);\n    const scaleX = rect.width / containerRect.width;\n    const scaleY = rect.height / containerRect.height;\n    if(!wasActive) {\n      transform += `scale3d(${scaleX},${scaleY},1) `;\n    }\n\n    let borderRadius = window.getComputedStyle(realParent).getPropertyValue('border-radius');\n    const brSplitted = fillPropertyValue(borderRadius) as string[];\n    borderRadius = brSplitted.map((r) => (parseInt(r) / scaleX) + 'px').join(' ');\n    if(!wasActive) {\n      mover.style.borderRadius = borderRadius;\n    }\n    // let borderRadius = '0px 0px 0px 0px';\n\n    if(closing && zoomValue !== 1) {\n      // const width = this.moversContainer.scrollWidth * scaleX;\n      // const height = this.moversContainer.scrollHeight * scaleY;\n      const willBeLeft = windowSize.width / 2 - rect.width / 2;\n      const willBeTop = windowSize.height / 2 - rect.height / 2;\n      const left = rect.left - willBeLeft/*  + (width - rect.width) / 2 */;\n      const top = rect.top - willBeTop/*  + (height - rect.height) / 2 */;\n      this.moversContainer.style.transform = `matrix(${scaleX}, 0, 0, ${scaleY}, ${left}, ${top})`;\n    } else {\n      mover.style.transform = transform;\n    }\n\n    needOpacity && (mover.style.opacity = '0'/* !closing ? '0' : '' */);\n\n    /* if(wasActive) {\n      this.log('setMoverToTarget', mover.style.transform);\n    } */\n\n    let path: SVGPathElement;\n    const isOut = target.classList.contains('is-out');\n\n    const deferred = this.setMoverAnimationPromise = deferredPromise<void>();\n    const ret = {onAnimationEnd: deferred};\n\n    const timeout = setTimeout(() => {\n      if(!deferred.isFulfilled && !deferred.isRejected) {\n        deferred.resolve();\n      }\n    }, 1000);\n\n    deferred.finally(() => {\n      this.dispatchEvent('setMoverAfter');\n\n      if(this.setMoverAnimationPromise === deferred) {\n        this.setMoverAnimationPromise = null;\n      }\n\n      clearTimeout(timeout);\n    });\n\n    if(!closing) {\n      let mediaElement: HTMLImageElement | HTMLVideoElement | HTMLCanvasElement;\n      let src: string;\n\n      // if(target instanceof HTMLVideoElement) {\n      const selector = 'video, img, .canvas-thumbnail';\n      const queryFrom = target.matches(selector) ? target.parentElement : target;\n      const elements = Array.from(queryFrom.querySelectorAll(selector)) as HTMLImageElement[];\n      if(elements.length) {\n        target = elements.pop();\n        const canvas = document.createElement('canvas');\n        const context = canvas.getContext('2d');\n        if(target instanceof HTMLImageElement) {\n          canvas.width = target.naturalWidth;\n          canvas.height = target.naturalHeight;\n        } else if(target instanceof HTMLVideoElement) {\n          canvas.width = target.videoWidth;\n          canvas.height = target.videoHeight;\n        } else if(target instanceof HTMLCanvasElement) {\n          canvas.width = target.width;\n          canvas.height = target.height;\n        }\n\n        canvas.className = 'canvas-thumbnail thumbnail media-photo';\n        context.drawImage(target as HTMLImageElement | HTMLCanvasElement, 0, 0);\n        target = canvas;\n      }\n      // }\n\n      if(target.tagName === 'DIV' || target.tagName === 'AVATAR-ELEMENT') { // useContainerAsTarget\n        const images = Array.from(target.querySelectorAll('img')) as HTMLImageElement[];\n        const image = images.pop();\n        if(image) {\n          mediaElement = new Image();\n          src = image.src;\n          mover.append(mediaElement);\n        }\n        /* mediaElement = new Image();\n        src = target.style.backgroundImage.slice(5, -2); */\n      } else if(target instanceof HTMLImageElement) {\n        mediaElement = new Image();\n        src = target.src;\n      } else if(target instanceof HTMLVideoElement) {\n        mediaElement = createVideo();\n        mediaElement.src = target.src;\n      } else if(target instanceof SVGSVGElement) {\n        const clipId = target.dataset.clipId;\n        const newClipId = clipId + '-mv';\n\n        const {width, height} = containerRect;\n\n        const newSvg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');\n        newSvg.setAttributeNS(null, 'width', '' + width);\n        newSvg.setAttributeNS(null, 'height', '' + height);\n\n        //     \n        newSvg.setAttributeNS(null, 'viewBox', `0 0 ${width} ${height}`);\n        newSvg.setAttributeNS(null, 'preserveAspectRatio', 'xMidYMid meet');\n\n        newSvg.insertAdjacentHTML('beforeend', target.firstElementChild.outerHTML.replace(clipId, newClipId));\n        newSvg.insertAdjacentHTML('beforeend', target.lastElementChild.outerHTML.replace(clipId, newClipId));\n\n        //       \n        const defs = newSvg.firstElementChild;\n        const use = defs.firstElementChild.firstElementChild as SVGUseElement;\n        if(use instanceof SVGUseElement) {\n          let transform = use.getAttributeNS(null, 'transform');\n          transform = transform.replace(/translate\\((.+?), (.+?)\\) scale\\((.+?), (.+?)\\)/, (match, x, y, sX, sY) => {\n            x = +x;\n            if(x !== 2) {\n              x = width - (2 / scaleX);\n            } else {\n              x = 2 / scaleX;\n            }\n\n            y = height;\n\n            return `translate(${x}, ${y}) scale(${+sX / scaleX}, ${+sY / scaleY})`;\n          });\n          use.setAttributeNS(null, 'transform', transform);\n\n          //   RECT\n          path = defs.firstElementChild.lastElementChild as SVGPathElement;\n\n          //            \n          let d: string;\n          const br: [number, number, number, number] = borderRadius.split(' ').map((v) => parseInt(v)) as any;\n          if(isOut) d = generatePathData(0, 0, width - 9 / scaleX, height, ...br);\n          else d = generatePathData(9 / scaleX, 0, width - 9 / scaleX, height, ...br);\n          path.setAttributeNS(null, 'd', d);\n        }\n\n        const foreignObject = newSvg.lastElementChild;\n        foreignObject.setAttributeNS(null, 'width', '' + containerRect.width);\n        foreignObject.setAttributeNS(null, 'height', '' + containerRect.height);\n\n        mover.prepend(newSvg);\n      } else if(target instanceof HTMLCanvasElement) {\n        mediaElement = target;\n      }\n\n      if(aspecter) {\n        aspecter.style.borderRadius = borderRadius;\n\n        if(mediaElement) {\n          aspecter.append(mediaElement);\n        }\n      }\n\n      mediaElement = mover.querySelector('video, img');\n      if(mediaElement instanceof HTMLImageElement) {\n        mediaElement.classList.add('thumbnail');\n        if(!aspecter) {\n          mediaElement.style.width = containerRect.width + 'px';\n          mediaElement.style.height = containerRect.height + 'px';\n        }\n\n        if(src) {\n          await renderImageFromUrlPromise(mediaElement, src);\n        }\n      }/*  else if(mediaElement instanceof HTMLVideoElement && mediaElement.firstElementChild && ((mediaElement.firstElementChild as HTMLSourceElement).src || src)) {\n        await new Promise((resolve, reject) => {\n          mediaElement.addEventListener('loadeddata', resolve);\n\n          if(src) {\n            (mediaElement.firstElementChild as HTMLSourceElement).src = src;\n          }\n        });\n      } */\n\n      mover.style.display = '';\n\n      fastRaf(() => {\n        mover.classList.add(wasActive ? 'moving' : 'active');\n      });\n    } else {\n      /* if(mover.classList.contains('center')) {\n        mover.classList.remove('center');\n        void mover.offsetLeft; // reflow\n      } */\n\n      if(target instanceof SVGSVGElement) {\n        path = mover.querySelector('path');\n\n        if(path) {\n          this.sizeTailPath(path, containerRect, scaleX, delay, false, isOut, borderRadius);\n        }\n      }\n\n      if(target.classList.contains('media-viewer-media')) {\n        mover.classList.add('hiding');\n      }\n\n      this.toggleWholeActive(false);\n\n      // return ret;\n\n      setTimeout(() => {\n        mover.style.borderRadius = borderRadius;\n\n        if(mover.firstElementChild) {\n          (mover.firstElementChild as HTMLElement).style.borderRadius = borderRadius;\n        }\n      }, delay / 2);\n\n      setTimeout(() => {\n        mover.innerHTML = '';\n        mover.classList.remove('moving', 'active', 'hiding');\n        mover.style.cssText = 'display: none;';\n\n        deferred.resolve();\n      }, delay);\n\n      mover.classList.remove('opening');\n\n      return ret;\n    }\n\n    mover.classList.add('opening');\n\n    // await new Promise((resolve) => setTimeout(resolve, 0));\n    // await new Promise((resolve) => window.requestAnimationFrame(resolve));\n    // *  RAF' ,       (  )\n    await doubleRaf();\n\n    //     - \n    // throw '';\n\n    // await new Promise((resolve) => setTimeout(resolve, 5e3));\n\n    mover.style.transform = `translate3d(${containerRect.left}px,${containerRect.top}px,0) scale3d(1,1,1)`;\n    // mover.style.transform = `translate(-50%,-50%) scale(1,1)`;\n    needOpacity && (mover.style.opacity = ''/* closing ? '0' : '' */);\n\n    if(aspecter) {\n      this.setFullAspect(aspecter, containerRect, rect);\n    }\n\n    // throw '';\n\n    setTimeout(() => {\n      mover.style.borderRadius = '';\n\n      if(mover.firstElementChild) {\n        (mover.firstElementChild as HTMLElement).style.borderRadius = '';\n      }\n    }, 0/* delay / 2 */);\n\n    mover.dataset.timeout = '' + setTimeout(() => {\n      mover.classList.remove('moving', 'opening');\n\n      if(aspecter) { //  - ,   ,       \n        if(mover.querySelector('video') || true) {\n          mover.classList.remove('active');\n          aspecter.style.cssText = '';\n          void mover.offsetLeft; // reflow\n        }\n\n        // aspecter.classList.remove('disable-hover');\n      }\n\n      //       ,      \n      mover.classList.add('center', 'no-transition');\n      /* mover.style.left = mover.style.top = '50%';\n      mover.style.transform = 'translate(-50%, -50%)';\n      void mover.offsetLeft; // reflow */\n\n      //      \n      mover.classList.add('active');\n      delete mover.dataset.timeout;\n\n      deferred.resolve();\n    }, delay);\n\n    if(path) {\n      this.sizeTailPath(path, containerRect, scaleX, delay, true, isOut, borderRadius);\n    }\n\n    return ret;\n  }\n\n  protected toggleWholeActive(active: boolean) {\n    if(active) {\n      this.wholeDiv.classList.add('active');\n    } else {\n      this.wholeDiv.classList.add('backwards');\n      setTimeout(() => {\n        this.wholeDiv.classList.remove('active');\n      }, 0);\n    }\n  }\n\n  protected setFullAspect(aspecter: HTMLDivElement, containerRect: DOMRect, rect: DOMRect) {\n    /* let media = aspecter.firstElementChild;\n    let proportion: number;\n    if(media instanceof HTMLImageElement) {\n      proportion = media.naturalWidth / media.naturalHeight;\n    } else if(media instanceof HTMLVideoElement) {\n      proportion = media.videoWidth / media.videoHeight;\n    } */\n    const proportion = containerRect.width / containerRect.height;\n\n    let {width, height} = rect;\n    /* if(proportion === 1) {\n      aspecter.style.cssText = '';\n    } else { */\n    if(proportion > 0) {\n      width = height * proportion;\n    } else {\n      height = width * proportion;\n    }\n\n    // this.log('will set style aspecter:', `width: ${width}px; height: ${height}px; transform: scale(${containerRect.width / width}, ${containerRect.height / height});`);\n\n    aspecter.style.cssText = `width: ${width}px; height: ${height}px; transform: scale3d(${containerRect.width / width}, ${containerRect.height / height}, 1);`;\n    // }\n  }\n\n  protected sizeTailPath(path: SVGPathElement, rect: DOMRect, scaleX: number, delay: number, upscale: boolean, isOut: boolean, borderRadius: string) {\n    const start = Date.now();\n    const {width, height} = rect;\n    delay = delay / 2;\n\n    const br = borderRadius.split(' ').map((v) => parseInt(v));\n\n    const step = () => {\n      const diff = Date.now() - start;\n\n      let progress = delay ? diff / delay : 1;\n      if(progress > 1) progress = 1;\n      if(upscale) progress = 1 - progress;\n\n      const _br: [number, number, number, number] = br.map((v) => v * progress) as any;\n\n      let d: string;\n      if(isOut) d = generatePathData(0, 0, width - (9 / scaleX * progress), height, ..._br);\n      else d = generatePathData(9 / scaleX * progress, 0, width/* width - (9 / scaleX * progress) */, height, ..._br);\n      path.setAttributeNS(null, 'd', d);\n\n      if(diff < delay) fastRaf(step);\n    };\n\n    // window.requestAnimationFrame(step);\n    step();\n  }\n\n  protected removeCenterFromMover(mover: HTMLElement) {\n    if(mover.classList.contains('center')) {\n      // const rect = mover.getBoundingClientRect();\n      const rect = this.content.media.getBoundingClientRect();\n      mover.style.transform = `translate3d(${rect.left}px,${rect.top}px,0)`;\n      mover.classList.remove('center');\n      void mover.offsetLeft; // reflow\n      mover.classList.remove('no-transition');\n    }\n  }\n\n  protected moveTheMover(mover: HTMLElement, toLeft = true) {\n    const windowW = windowSize.width;\n\n    this.removeCenterFromMover(mover);\n\n    // mover.classList.remove('active');\n    mover.classList.add('moving');\n\n    if(mover.dataset.timeout) { //     -  ,      \n      clearTimeout(+mover.dataset.timeout);\n    }\n\n    const rect = mover.getBoundingClientRect();\n\n    const newTransform = mover.style.transform.replace(/translate3d\\((.+?),/, (match, p1) => {\n      const x = toLeft ? -rect.width : windowW;\n      // const x = toLeft ? -(rect.right + (rect.width / 2)) : windowW / 2;\n\n      return match.replace(p1, x + 'px');\n    });\n\n    // //////this.log('set newTransform:', newTransform, mover.style.transform, toLeft);\n    mover.style.transform = newTransform;\n\n    setTimeout(() => {\n      mover.remove();\n    }, 350);\n  }\n\n  protected setNewMover() {\n    const newMover = document.createElement('div');\n    newMover.classList.add('media-viewer-mover');\n    newMover.style.display = 'none';\n\n    if(this.content.mover) {\n      const oldMover = this.content.mover;\n      oldMover.parentElement.append(newMover);\n    } else {\n      this.moversContainer.append(newMover);\n    }\n\n    return this.content.mover = newMover;\n  }\n\n  protected updateMediaSource(target: HTMLElement, url: string, tagName: 'video' | 'img') {\n    // if(target instanceof SVGSVGElement) {\n    const el = target.tagName.toLowerCase() === tagName ? target : target.querySelector(tagName) as HTMLElement;\n    if(el && !findUpClassName(target, 'document')) {\n      if(findUpClassName(target, 'attachment')) {\n        // two parentElements because element can be contained in aspecter\n        const preloader = target.parentElement.parentElement.querySelector('.preloader-container') as HTMLElement;\n        if(preloader) {\n          if(tagName === 'video') {\n            if(preloader.classList.contains('manual')) {\n              preloader.click();\n              // return;\n            }\n\n            return;\n          }\n\n          preloader.remove();\n        }\n      }\n\n      if((el as HTMLImageElement).src !== url) {\n        renderImageFromUrl(el, url);\n      }\n\n      // ! ,       \n      if(el.classList.contains('thumbnail') && el.parentElement.classList.contains('media-container-aspecter')) {\n        el.classList.remove('thumbnail');\n      }\n    }\n    /* } else {\n\n    } */\n  }\n\n  protected setAuthorInfo(fromId: PeerId | string, timestamp: number) {\n    const isPeerId = fromId.isPeerId();\n    let wrapTitlePromise: Promise<HTMLElement> | HTMLElement;\n    if(isPeerId) {\n      wrapTitlePromise = wrapPeerTitle({\n        peerId: fromId as PeerId,\n        dialog: false,\n        onlyFirstName: false,\n        plainText: false\n      })\n    } else {\n      const title = wrapTitlePromise = document.createElement('span');\n      title.append(wrapEmojiText(fromId));\n      title.classList.add('peer-title');\n    }\n\n    const oldAvatar = this.author.avatarEl;\n    const newAvatar = this.author.avatarEl = (oldAvatar.cloneNode() as AvatarElement);\n\n    return Promise.all([\n      (this.author.avatarEl as AvatarElement).updateWithOptions({\n        peerId: fromId as PeerId || NULL_PEER_ID,\n        peerTitle: isPeerId ? undefined : '' + fromId\n      }),\n\n      wrapTitlePromise\n    ]).then(([_, title]) => {\n      if(this.author.avatarEl !== newAvatar) {\n        return;\n      }\n\n      replaceContent(this.author.date, formatFullSentTime(timestamp));\n      replaceContent(this.author.nameEl, title);\n      oldAvatar.replaceWith(this.author.avatarEl);\n    });\n  }\n\n  protected async _openMedia(\n    media: MyDocument | MyPhoto,\n    timestamp: number,\n    fromId: PeerId | string,\n    fromRight: number,\n    target?: HTMLElement,\n    reverse = false,\n    prevTargets: TargetType[] = [],\n    nextTargets: TargetType[] = [],\n    message?: MyMessage\n    /* , needLoadMore = true */\n  ) {\n    if(this.setMoverPromise) return this.setMoverPromise;\n\n    /* if(DEBUG) {\n      this.log('openMedia:', media, fromId, prevTargets, nextTargets);\n    } */\n\n    const setAuthorPromise = this.setAuthorInfo(fromId, timestamp);\n\n    const isDocument = media._ === 'document';\n    const isVideo = isDocument && media.mime_type && ((['video', 'gif'] as MyDocument['type'][]).includes(media.type) || media.mime_type.indexOf('video/') === 0);\n\n    if(this.isFirstOpen) {\n      // this.targetContainer = targetContainer;\n      // this.needLoadMore = needLoadMore;\n      this.isFirstOpen = false;\n      this.listLoader.setTargets(prevTargets, nextTargets, reverse);\n      (window as any).appMediaViewer = this;\n      // this.loadMore = loadMore;\n\n      /* if(appSidebarRight.historyTabIDs.slice(-1)[0] === AppSidebarRight.SLIDERITEMSIDS.forward) {\n        appSidebarRight.forwardTab.closeBtn.click();\n        await new Promise((resolve) => setTimeout(resolve, 200));\n      } */\n    }\n\n    if(this.listLoader.next.length < 10) {\n      setTimeout(() => {\n        this.listLoader.load(true);\n      }, 0);\n    }\n\n    // if(prevTarget && (!prevTarget.parentElement || !this.isElementVisible(this.targetContainer, prevTarget))) prevTarget = null;\n    // if(nextTarget && (!nextTarget.parentElement || !this.isElementVisible(this.targetContainer, nextTarget))) nextTarget = null;\n\n    this.buttons.prev.classList.toggle('hide', !this.listLoader.previous.length);\n    this.buttons.next.classList.toggle('hide', !this.listLoader.next.length);\n\n    const container = this.content.media;\n    const useContainerAsTarget = !target || target === container;\n    if(useContainerAsTarget) target = container;\n\n    this.target = {element: target} as any;\n    const tempId = ++this.tempId;\n\n    if(container.firstElementChild) {\n      container.innerHTML = '';\n    }\n\n    // ok set\n\n    const wasActive = fromRight !== 0;\n    if(wasActive) {\n      this.moveTheMover(this.content.mover, fromRight === 1);\n      this.setNewMover();\n    } else {\n      this.toggleOverlay(true);\n      this.setGlobalListeners();\n      await setAuthorPromise;\n\n      if(!this.wholeDiv.parentElement) {\n        this.pageEl.insertBefore(this.wholeDiv, document.getElementById('main-columns'));\n        void this.wholeDiv.offsetLeft; // reflow\n      }\n\n      this.toggleWholeActive(true);\n\n      if(!IS_MOBILE_SAFARI) {\n        this.navigationItem = {\n          type: 'media',\n          onPop: (canAnimate) => {\n            if(this.setMoverAnimationPromise) {\n              return false;\n            }\n\n            this.close();\n          }\n        };\n\n        appNavigationController.pushItem(this.navigationItem);\n      }\n    }\n\n    // //////this.log('wasActive:', wasActive);\n\n    const mover = this.content.mover;\n\n    const maxWidth = windowSize.width;\n    // const maxWidth = this.pageEl.scrollWidth;\n    // TODO: const maxHeight = mediaSizes.isMobile ? appPhotosManager.windowH : appPhotosManager.windowH - 100;\n    let padding = 0;\n    const windowH = windowSize.height;\n    if(windowH < 1000000 && !mediaSizes.isMobile) {\n      padding = 120;\n    }\n    const maxHeight = windowH - 120 - padding;\n    let thumbPromise: Promise<any> = Promise.resolve();\n    const size = setAttachmentSize(media, container, maxWidth, maxHeight, mediaSizes.isMobile ? false : true, undefined, !!(isDocument && media.w && media.h)).photoSize;\n    if(useContainerAsTarget) {\n      const cacheContext = await this.managers.thumbsStorage.getCacheContext(media, size.type);\n      let img: HTMLImageElement | HTMLCanvasElement;\n      if(cacheContext.downloaded) {\n        img = new Image();\n        img.src = cacheContext.url;\n      } else {\n        const gotThumb = getStrippedThumbIfNeeded(media, cacheContext, true);\n        if(gotThumb) {\n          thumbPromise = gotThumb.loadPromise;\n          img = gotThumb.image;\n        }\n      }\n\n      if(img) {\n        img.classList.add('thumbnail');\n        container.append(img);\n      }\n    }\n\n    // need after setAttachmentSize\n    /* if(useContainerAsTarget) {\n      target = target.querySelector('img, video') || target;\n    } */\n\n    const supportsStreaming: boolean = !!(isDocument && media.supportsStreaming);\n    const preloader = supportsStreaming ? this.preloaderStreamable : this.preloader;\n\n    const getCacheContext = () => {\n      return this.managers.thumbsStorage.getCacheContext(media, size?.type);\n    };\n\n    let setMoverPromise: Promise<void>;\n    if(isVideo) {\n      // //////this.log('will wrap video', media, size);\n\n      //    safari     event'\n      // const video = document.createElement('video');\n      const useController = message && media.type !== 'gif';\n      const video = /* useController ?\n        appMediaPlaybackController.addMedia(message, false, true) as HTMLVideoElement :\n         */createVideo({pip: useController});\n\n      const set = () => this.setMoverToTarget(target, false, fromRight).then(({onAnimationEnd}) => {\n      // return; // set and don't move\n      // if(wasActive) return;\n        // return;\n\n        const div = mover.firstElementChild && mover.firstElementChild.classList.contains('media-viewer-aspecter') ? mover.firstElementChild : mover;\n        // const video = mover.querySelector('video') || document.createElement('video');\n\n        const moverVideo = mover.querySelector('video');\n        if(moverVideo) {\n          moverVideo.remove();\n        }\n\n        // video.src = '';\n\n        video.setAttribute('playsinline', 'true');\n\n        // * fix for playing video if viewer is closed (https://contest.com/javascript-web-bonus/entry1425#issue11629)\n        video.addEventListener('timeupdate', () => {\n          if(this.tempId !== tempId) {\n            video.pause();\n          }\n        });\n\n        this.addEventListener('setMoverAfter', () => {\n          video.src = '';\n          video.load();\n        }, {once: true});\n\n        if(IS_SAFARI) {\n          // test stream\n          // video.controls = true;\n          video.autoplay = true;\n        }\n\n        if(media.type === 'gif') {\n          video.muted = true;\n          video.autoplay = true;\n          video.loop = true;\n        } else if(media.duration < 60) {\n          video.loop = true;\n        }\n\n        // if(!video.parentElement) {\n        div.append(video);\n        // }\n\n        const canPlayThrough = new Promise((resolve) => {\n          video.addEventListener('canplay', resolve, {once: true});\n        });\n\n        const createPlayer = () => {\n          if(media.type !== 'gif') {\n            video.dataset.ckin = 'default';\n            video.dataset.overlay = '1';\n\n            Promise.all([canPlayThrough, onAnimationEnd]).then(() => {\n              if(this.tempId !== tempId) {\n                return;\n              }\n\n              // const play = useController ? appMediaPlaybackController.willBePlayedMedia === video : true;\n              const play = true;\n              const player = this.videoPlayer = new VideoPlayer({\n                video,\n                play,\n                streamable: supportsStreaming,\n                onPlaybackRackMenuToggle: (open) => {\n                  this.wholeDiv.classList.toggle('hide-caption', !!open);\n                },\n                onPip: (pip) => {\n                  const otherMediaViewer = (window as any).appMediaViewer;\n                  if(!pip && otherMediaViewer && otherMediaViewer !== this) {\n                    this.releaseSingleMedia = undefined;\n                    this.close();\n                    return;\n                  }\n\n                  const mover = this.moversContainer.lastElementChild as HTMLElement;\n                  mover.classList.toggle('hiding', pip);\n                  this.toggleWholeActive(!pip);\n                  this.toggleOverlay(!pip);\n                  this.toggleGlobalListeners(!pip);\n\n                  if(this.navigationItem) {\n                    if(pip) appNavigationController.removeItem(this.navigationItem);\n                    else appNavigationController.pushItem(this.navigationItem);\n                  }\n\n                  if(useController) {\n                    if(pip) {\n                      // appMediaPlaybackController.toggleSwitchers(true);\n\n                      this.releaseSingleMedia(false);\n                      this.releaseSingleMedia = undefined;\n\n                      appMediaPlaybackController.setPictureInPicture(video);\n                    } else {\n                      this.releaseSingleMedia = appMediaPlaybackController.setSingleMedia(video, message as Message.message);\n                    }\n                  }\n                },\n                onPipClose: () => {\n                  // this.target = undefined;\n                  // this.toggleWholeActive(false);\n                  // this.toggleOverlay(false);\n                  this.close();\n                }\n              });\n              player.addEventListener('toggleControls', (show) => {\n                this.wholeDiv.classList.toggle('has-video-controls', show);\n              });\n\n              this.addEventListener('setMoverBefore', () => {\n                this.wholeDiv.classList.remove('has-video-controls');\n                this.videoPlayer.cleanup();\n                this.videoPlayer = undefined;\n              }, {once: true});\n\n              if(this.isZooming()) {\n                this.videoPlayer.lockControls(false);\n              }\n              /* div.append(video);\n              mover.append(player.wrapper); */\n            });\n          }\n        };\n\n        if(supportsStreaming) {\n          onAnimationEnd.then(() => {\n            if(video.readyState < video.HAVE_FUTURE_DATA) {\n              // console.log('ppp 1');\n              preloader.attach(mover, true);\n            }\n\n            /* canPlayThrough.then(() => {\n              preloader.detach();\n            }); */\n          });\n\n          const attachCanPlay = () => {\n            video.addEventListener('canplay', () => {\n              // console.log('ppp 2');\n              preloader.detach();\n              video.parentElement.classList.remove('is-buffering');\n            }, {once: true});\n          };\n\n          video.addEventListener('waiting', () => {\n            const loading = video.networkState === video.NETWORK_LOADING;\n            const isntEnoughData = video.readyState < video.HAVE_FUTURE_DATA;\n\n            // this.log('video waiting for progress', loading, isntEnoughData);\n            if(loading && isntEnoughData) {\n              attachCanPlay();\n\n              // console.log('ppp 3');\n              preloader.attach(mover, true);\n\n              //    ,        \n              video.parentElement.classList.add('is-buffering');\n            }\n          });\n\n          if(this.wholeDiv.classList.contains('no-forwards')) {\n            video.addEventListener('contextmenu', (e) => {\n              cancelEvent(e);\n            });\n          }\n\n          attachCanPlay();\n        }\n\n        // if(!video.src || media.url !== video.src) {\n        const load = async() => {\n          /* if(useController) {\n              appMediaPlaybackController.resolveWaitingForLoadMedia(message.peerId, message.mid, message.pFlags.is_scheduled);\n            } */\n\n          const promise: Promise<any> = supportsStreaming ? Promise.resolve() : appDownloadManager.downloadMediaURL({media});\n\n          if(!supportsStreaming) {\n            onAnimationEnd.then(async() => {\n              if(!(await getCacheContext()).url) {\n                // console.log('ppp 4');\n                preloader.attach(mover, true, promise);\n              }\n            });\n          }\n\n          Promise.all([promise, onAnimationEnd]).then(async() => {\n            if(this.tempId !== tempId) {\n              this.log.warn('media viewer changed video');\n              return;\n            }\n\n            const url = (await getCacheContext()).url;\n\n            video.addEventListener('error', () => {\n              if(video.error.code !== 4) {\n                this.log.error('Error ' + video.error.code + '; details: ' + video.error.message);\n              }\n\n              if(preloader) {\n                preloader.detach();\n              }\n            }, {once: true});\n\n            if(target instanceof SVGSVGElement/*  && (video.parentElement || !isSafari) */) { // if video exists\n              // if(!video.parentElement) {\n              div.firstElementChild.lastElementChild.append(video);\n              // }\n            } else {\n              renderImageFromUrl(video, url);\n            }\n\n            // * have to set options (especially playbackRate) after src\n            // * https://github.com/videojs/video.js/issues/2516\n            if(useController) {\n              this.releaseSingleMedia = appMediaPlaybackController.setSingleMedia(video, message as Message.message);\n\n              this.addEventListener('setMoverBefore', () => {\n                if(this.releaseSingleMedia) {\n                  this.releaseSingleMedia();\n                  this.releaseSingleMedia = undefined;\n                }\n              }, {once: true});\n            }\n\n            this.updateMediaSource(target, url, 'video');\n\n            createPlayer();\n          });\n\n          return promise;\n        };\n\n        this.lazyLoadQueue.unshift({load});\n        // } else createPlayer();\n      });\n\n      setMoverPromise = thumbPromise.then(set);\n    } else {\n      const set = () => this.setMoverToTarget(target, false, fromRight).then(({onAnimationEnd}) => {\n      // return; // set and don't move\n      // if(wasActive) return;\n        // return;\n\n        const load = async() => {\n          const cancellablePromise = isDocument ? appDownloadManager.downloadMediaURL({media}) : appDownloadManager.downloadMediaURL({media, thumb: size});\n\n          onAnimationEnd.then(async() => {\n            if(!(await getCacheContext()).url) {\n              this.preloader.attachPromise(cancellablePromise);\n              // this.preloader.attach(mover, true, cancellablePromise);\n            }\n          });\n\n          Promise.all([onAnimationEnd, cancellablePromise]).then(async() => {\n            if(this.tempId !== tempId) {\n              this.log.warn('media viewer changed photo');\n              return;\n            }\n\n            // /////this.log('indochina', blob);\n\n            const url = (await getCacheContext()).url;\n            if(target instanceof SVGSVGElement) {\n              this.updateMediaSource(target, url, 'img');\n              this.updateMediaSource(mover, url, 'img');\n\n              if(mediaSizes.isMobile) {\n                const imgs = mover.querySelectorAll('img');\n                if(imgs && imgs.length) {\n                  imgs.forEach((img) => {\n                    img.classList.remove('thumbnail'); //      \n                  });\n                }\n              }\n            } else {\n              const div = mover.firstElementChild && mover.firstElementChild.classList.contains('media-viewer-aspecter') ? mover.firstElementChild : mover;\n              const haveImage = div.firstElementChild?.tagName === 'IMG' ? div.firstElementChild as HTMLImageElement : null;\n              if(!haveImage || haveImage.src !== url)  {\n                const image = new Image();\n                image.classList.add('thumbnail');\n\n                // this.log('will renderImageFromUrl:', image, div, target);\n\n                renderImageFromUrl(image, url, () => {\n                  this.updateMediaSource(target, url, 'img');\n\n                  if(haveImage) {\n                    fastRaf(() => {\n                      haveImage.remove();\n                    });\n                  }\n\n                  div.append(image);\n                });\n              }\n            }\n\n            // this.preloader.detach();\n          }).catch((err) => {\n            this.log.error(err);\n            this.preloader.attach(mover);\n            this.preloader.setManual();\n          });\n\n          return cancellablePromise;\n        };\n\n        this.lazyLoadQueue.unshift({load});\n      });\n\n      setMoverPromise = thumbPromise.then(set);\n    }\n\n    return this.setMoverPromise = setMoverPromise.catch(() => {\n      this.setMoverAnimationPromise = null;\n    }).finally(() => {\n      this.setMoverPromise = null;\n    });\n  }\n}\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nexport default function fillPropertyValue(str: string) {\r\n  const splitted = str.split(' ');\r\n  if(splitted.length !== 4) {\r\n    if(!splitted[0]) splitted[0] = '0px';\r\n    for(let i = splitted.length; i < 4; ++i) {\r\n      splitted[i] = splitted[i % 2] || splitted[0] || '0px';\r\n    }\r\n  }\r\n\r\n  return splitted;\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport {MOUNT_CLASS_TO} from '../config/debug';\r\nimport {IS_MOBILE_SAFARI} from '../environment/userAgent';\r\nimport {logger} from '../lib/logger';\r\nimport blurActiveElement from '../helpers/dom/blurActiveElement';\r\nimport cancelEvent from '../helpers/dom/cancelEvent';\r\nimport isSwipingBackSafari from '../helpers/dom/isSwipingBackSafari';\r\nimport indexOfAndSplice from '../helpers/array/indexOfAndSplice';\r\n\r\nexport type NavigationItem = {\r\n  type: 'left' | 'right' | 'im' | 'chat' | 'popup' | 'media' | 'menu' |\r\n    'esg' | 'multiselect' | 'input-helper' | 'autocomplete-helper' | 'markup' |\r\n    'global-search' | 'voice' | 'mobile-search' | 'filters' | 'global-search-focus' |\r\n    'toast',\r\n  onPop: (canAnimate: boolean) => boolean | void,\r\n  onEscape?: () => boolean,\r\n  noHistory?: boolean,\r\n  noBlurOnPop?: boolean,\r\n};\r\n\r\nexport class AppNavigationController {\r\n  private navigations: Array<NavigationItem>;\r\n  private id: number;\r\n  private manual: boolean;\r\n  private log: ReturnType<typeof logger>;\r\n  private debug: boolean;\r\n  private currentHash: string; // have to start with # if not empty\r\n  private overriddenHash: string; // have to start with # if not empty\r\n  private isPossibleSwipe: boolean;\r\n  public onHashChange: () => void;\r\n\r\n  constructor() {\r\n    this.navigations = [];\r\n    this.id = Date.now();\r\n    this.manual = false;\r\n    this.log = logger('NC');\r\n    this.debug = true;\r\n    this.currentHash = window.location.hash;\r\n    this.overriddenHash = '';\r\n    this.isPossibleSwipe = false;\r\n\r\n    window.addEventListener('popstate', this.onPopState);\r\n    window.addEventListener('keydown', this.onKeyDown, {capture: true, passive: false});\r\n\r\n    if(IS_MOBILE_SAFARI) {\r\n      const options = {passive: true};\r\n      window.addEventListener('touchstart', this.onTouchStart, options);\r\n    }\r\n\r\n    history.scrollRestoration = 'manual';\r\n\r\n    this.pushState(); // * push init state\r\n  }\r\n\r\n  private onPopState = (e: PopStateEvent) => {\r\n    const hash = window.location.hash;\r\n    const id: number = e.state;\r\n    this.debug && this.log('popstate', e, this.isPossibleSwipe, hash);\r\n    if(hash !== this.currentHash) {\r\n      this.debug && this.log.warn(`hash changed, new=${hash}, current=${this.currentHash}, overridden=${this.overriddenHash}`);\r\n      // fix for returning to wrong hash (e.g. chat -> archive -> chat -> 3x back)\r\n      if(id === this.id && this.overriddenHash && this.overriddenHash !== hash) {\r\n        this.overrideHash(this.overriddenHash);\r\n      } else if(id/*  === this.id */ && !this.overriddenHash && hash) {\r\n        this.overrideHash();\r\n      } else {\r\n        this.currentHash = hash;\r\n        this.onHashChange && this.onHashChange();\r\n        // this.replaceState();\r\n        return;\r\n      }\r\n    }\r\n\r\n    if(id !== this.id/*  && !this.navigations.length */) {\r\n      this.pushState();\r\n\r\n      if(!this.navigations.length) {\r\n        return;\r\n      }\r\n    }\r\n\r\n    const item = this.navigations.pop();\r\n    if(!item) {\r\n      this.pushState();\r\n      return;\r\n    }\r\n\r\n    this.manual = !this.isPossibleSwipe;\r\n    this.handleItem(item);\r\n    // this.pushState(); // * prevent adding forward arrow\r\n  };\r\n\r\n  private onKeyDown = (e: KeyboardEvent) => {\r\n    const item = this.navigations[this.navigations.length - 1];\r\n    if(!item) return;\r\n    if(e.key === 'Escape' && (item.onEscape ? item.onEscape() : true)) {\r\n      cancelEvent(e);\r\n      this.back(item.type);\r\n    }\r\n  };\r\n\r\n  private onTouchStart = (e: TouchEvent) => {\r\n    if(e.touches.length > 1) return;\r\n    this.debug && this.log('touchstart');\r\n\r\n    if(isSwipingBackSafari(e)) {\r\n      this.isPossibleSwipe = true;\r\n\r\n      window.addEventListener('touchend', () => {\r\n        setTimeout(() => {\r\n          this.isPossibleSwipe = false;\r\n        }, 100);\r\n      }, {passive: true, once: true});\r\n    }\r\n\r\n    /* const detach = () => {\r\n      window.removeEventListener('touchend', onTouchEnd);\r\n      window.removeEventListener('touchmove', onTouchMove);\r\n    };\r\n\r\n    let moved = false;\r\n    const onTouchMove = (e: TouchEvent) => {\r\n      this.debug && this.log('touchmove');\r\n      if(e.touches.length > 1) {\r\n        detach();\r\n        return;\r\n      }\r\n\r\n      moved = true;\r\n    };\r\n\r\n    const onTouchEnd = (e: TouchEvent) => {\r\n      this.debug && this.log('touchend');\r\n      if(e.touches.length > 1 || !moved) {\r\n        detach();\r\n        return;\r\n      }\r\n\r\n      isPossibleSwipe = true;\r\n      doubleRaf().then(() => {\r\n        isPossibleSwipe = false;\r\n      });\r\n\r\n      detach();\r\n    };\r\n\r\n    window.addEventListener('touchend', onTouchEnd, options);\r\n    window.addEventListener('touchmove', onTouchMove, options); */\r\n  };\r\n\r\n  public overrideHash(hash: string = '') {\r\n    if(hash && hash[0] !== '#') hash = '#' + hash;\r\n    else if(hash === '#') hash = '';\r\n\r\n    this.overriddenHash = this.currentHash = hash;\r\n    this.replaceState();\r\n    this.pushState();\r\n  }\r\n\r\n  private handleItem(item: NavigationItem) {\r\n    const good = item.onPop(!this.manual ? false : undefined);\r\n    this.debug && this.log('popstate, navigation:', item, this.navigations);\r\n    if(good === false) {\r\n      this.pushItem(item);\r\n    } else if(!item.noBlurOnPop) {\r\n      blurActiveElement(); // no better place for it\r\n    }\r\n\r\n    this.manual = false;\r\n  }\r\n\r\n  public findItemByType(type: NavigationItem['type']) {\r\n    for(let i = this.navigations.length - 1; i >= 0; --i) {\r\n      const item = this.navigations[i];\r\n      if(item.type === type) {\r\n        return {item, index: i};\r\n      }\r\n    }\r\n  }\r\n\r\n  public back(type?: NavigationItem['type']) {\r\n    if(type) {\r\n      const ret = this.findItemByType(type);\r\n      if(ret) {\r\n        this.backByItem(ret.item, ret.index);\r\n        return;\r\n      }\r\n    }\r\n\r\n    history.back();\r\n  }\r\n\r\n  public backByItem(item: NavigationItem, index = this.navigations.indexOf(item)) {\r\n    this.manual = true;\r\n    // ! commented because 'popstate' event will be fired with delay\r\n    // if(index !== (this.navigations.length - 1)) {\r\n    this.navigations.splice(index, 1);\r\n    this.handleItem(item);\r\n    // }\r\n  }\r\n\r\n  private onItemAdded(item: NavigationItem) {\r\n    this.debug && this.log('onItemAdded', item, this.navigations);\r\n\r\n    if(!item.noHistory) {\r\n      this.pushState();\r\n    }\r\n  }\r\n\r\n  public pushItem(item: NavigationItem) {\r\n    this.navigations.push(item);\r\n    this.onItemAdded(item);\r\n  }\r\n\r\n  public unshiftItem(item: NavigationItem) {\r\n    this.navigations.unshift(item);\r\n    this.onItemAdded(item);\r\n  }\r\n\r\n  public spliceItems(index: number, length: number, ...items: NavigationItem[]) {\r\n    this.navigations.splice(index, length, ...items);\r\n    items.forEach((item) => {\r\n      this.onItemAdded(item);\r\n    });\r\n  }\r\n\r\n  private pushState() {\r\n    this.debug && this.log('push');\r\n    this.manual = false;\r\n    history.pushState(this.id, '');\r\n  }\r\n\r\n  public replaceState() {\r\n    this.debug && this.log.warn('replace');\r\n\r\n    const url = location.origin + location.pathname + location.search + this.overriddenHash;\r\n    history.replaceState(this.id, '', url);\r\n  }\r\n\r\n  public removeItem(item: NavigationItem) {\r\n    if(!item) {\r\n      return;\r\n    }\r\n\r\n    indexOfAndSplice(this.navigations, item);\r\n  }\r\n\r\n  public removeByType(type: NavigationItem['type'], single = false) {\r\n    for(let i = this.navigations.length - 1; i >= 0; --i) {\r\n      const item = this.navigations[i];\r\n      if(item.type === type) {\r\n        this.navigations.splice(i, 1);\r\n\r\n        if(single) {\r\n          break;\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\nconst appNavigationController = new AppNavigationController();\r\nMOUNT_CLASS_TO.appNavigationController = appNavigationController;\r\nexport default appNavigationController;\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport appDialogsManager from '../lib/appManagers/appDialogsManager';\r\nimport Scrollable from './scrollable';\r\nimport InputSearch from './inputSearch';\r\nimport replaceContent from '../helpers/dom/replaceContent';\r\nimport {i18n, LangPackKey} from '../lib/langPack';\r\nimport rootScope from '../lib/rootScope';\r\n\r\nexport class SearchGroup {\r\n  container: HTMLDivElement;\r\n  nameEl: HTMLDivElement;\r\n  list: HTMLUListElement;\r\n\r\n  constructor(\r\n    public name: LangPackKey | boolean,\r\n    public type: string,\r\n    private clearable = true,\r\n    className?: string,\r\n    clickable = true,\r\n    public autonomous = true,\r\n    public onFound?: () => void,\r\n    public noIcons?: boolean\r\n  ) {\r\n    this.list = appDialogsManager.createChatList();\r\n    this.container = document.createElement('div');\r\n    if(className) this.container.className = className;\r\n\r\n    if(name) {\r\n      this.nameEl = document.createElement('div');\r\n      this.nameEl.classList.add('search-group__name');\r\n      if(typeof(name) === 'string') {\r\n        this.nameEl.append(i18n(name));\r\n      }\r\n      this.container.append(this.nameEl);\r\n    }\r\n\r\n    this.container.classList.add('search-group', 'search-group-' + type);\r\n    this.container.append(this.list);\r\n    this.container.style.display = 'none';\r\n\r\n    if(clickable) {\r\n      appDialogsManager.setListClickListener(this.list, onFound, undefined, autonomous);\r\n    }\r\n  }\r\n\r\n  clear() {\r\n    this.container.style.display = 'none';\r\n\r\n    if(this.clearable) {\r\n      this.list.innerHTML = '';\r\n    }\r\n  }\r\n\r\n  setActive() {\r\n    this.container.style.display = '';\r\n  }\r\n\r\n  toggle() {\r\n    if(this.list.childElementCount) {\r\n      this.setActive();\r\n    } else {\r\n      this.clear();\r\n    }\r\n  }\r\n}\r\n\r\nexport type SearchGroupType = 'contacts' | 'globalContacts' | 'messages' | string;\r\n\r\nexport default class AppSearch {\r\n  private minMsgId = 0;\r\n  private loadedCount = -1;\r\n  private foundCount = -1;\r\n\r\n  private searchPromise: Promise<void> = null;\r\n  private searchTimeout: number = 0;\r\n\r\n  private query = '';\r\n\r\n  private listsContainer: HTMLDivElement = null;\r\n\r\n  private peerId: PeerId; // 0 - means global\r\n  private threadId = 0;\r\n\r\n  private scrollable: Scrollable;\r\n\r\n  constructor(\r\n    public container: HTMLElement,\r\n    public searchInput: InputSearch,\r\n    public searchGroups: {[group in SearchGroupType]: SearchGroup},\r\n    public onSearch?: (count: number) => void,\r\n    public noIcons?: boolean\r\n  ) {\r\n    this.scrollable = new Scrollable(this.container);\r\n    this.listsContainer = this.scrollable.container as HTMLDivElement;\r\n    for(const i in this.searchGroups) {\r\n      this.listsContainer.append(this.searchGroups[i as SearchGroupType].container);\r\n    }\r\n\r\n    if(this.searchGroups.messages) {\r\n      this.scrollable.setVirtualContainer(this.searchGroups.messages.list);\r\n    }\r\n\r\n    this.searchInput.onChange = (value) => {\r\n      /* if(!value.trim()) {\r\n        //this.peerId = 0;\r\n        return;\r\n      } */\r\n\r\n      this.query = value;\r\n      this.reset(false);\r\n      this.searchMore();\r\n    };\r\n\r\n    this.scrollable.onScrolledBottom = () => {\r\n      if(!this.query.trim()) return;\r\n\r\n      if(!this.searchTimeout) {\r\n        this.searchTimeout = window.setTimeout(() => {\r\n          this.searchMore();\r\n          this.searchTimeout = 0;\r\n        }, 0);\r\n      }\r\n    };\r\n  }\r\n\r\n  public reset(all = true) {\r\n    if(all) {\r\n      this.searchInput.value = '';\r\n      this.query = '';\r\n      this.peerId = undefined;\r\n      this.threadId = 0;\r\n    }\r\n\r\n    this.minMsgId = 0;\r\n    this.loadedCount = -1;\r\n    this.foundCount = -1;\r\n\r\n    for(const i in this.searchGroups) {\r\n      this.searchGroups[i as SearchGroupType].clear();\r\n    }\r\n\r\n    this.searchPromise = null;\r\n  }\r\n\r\n  public beginSearch(peerId?: PeerId, threadId = 0, query = '') {\r\n    this.peerId = peerId;\r\n    this.threadId = threadId;\r\n\r\n    if(this.query !== query) {\r\n      this.searchInput.inputField.value = query;\r\n    }\r\n\r\n    this.searchInput.input.focus();\r\n  }\r\n\r\n  public searchMore() {\r\n    if(this.searchPromise) return this.searchPromise;\r\n\r\n    const query = this.query;\r\n\r\n    if(!query.trim()) {\r\n      this.onSearch && this.onSearch(0);\r\n      return;\r\n    }\r\n\r\n    if(this.foundCount !== -1 && this.loadedCount >= this.foundCount) {\r\n      return Promise.resolve();\r\n    }\r\n\r\n    const maxId = this.minMsgId || 0;\r\n\r\n    return this.searchPromise = rootScope.managers.appMessagesManager.getSearch({\r\n      peerId: this.peerId,\r\n      query,\r\n      inputFilter: {_: 'inputMessagesFilterEmpty'},\r\n      maxId,\r\n      limit: 20,\r\n      threadId: this.threadId\r\n    }).then((res) => {\r\n      this.searchPromise = null;\r\n\r\n      if(this.searchInput.value !== query) {\r\n        return;\r\n      }\r\n\r\n      // console.log('input search result:', this.peerId, query, null, maxId, 20, res);\r\n\r\n      const {count, history} = res;\r\n\r\n      if(history.length && history[0].mid === this.minMsgId) {\r\n        history.shift();\r\n      }\r\n\r\n      const searchGroup = this.searchGroups.messages;\r\n\r\n      history.forEach((message) => {\r\n        try {\r\n          const peerId = this.peerId ? message.fromId : message.peerId;\r\n          appDialogsManager.addDialogAndSetLastMessage({\r\n            peerId,\r\n            container: this.scrollable/* searchGroup.list */,\r\n            avatarSize: 54,\r\n            meAsSaved: false,\r\n            message,\r\n            query,\r\n            noIcons: this.noIcons\r\n          });\r\n        } catch(err) {\r\n          console.error('[appSearch] render search result', err);\r\n        }\r\n      });\r\n\r\n      searchGroup.toggle();\r\n\r\n      this.minMsgId = history.length && history[history.length - 1].mid;\r\n\r\n      if(this.loadedCount === -1) {\r\n        this.loadedCount = 0;\r\n      }\r\n      this.loadedCount += history.length;\r\n\r\n      if(this.foundCount === -1) {\r\n        this.foundCount = count;\r\n\r\n        if(searchGroup.nameEl) {\r\n          replaceContent(searchGroup.nameEl, i18n(count ? 'Chat.Search.MessagesFound' : 'Chat.Search.NoMessagesFound', [count]));\r\n        }\r\n\r\n        this.onSearch && this.onSearch(this.foundCount);\r\n      }\r\n    }).catch((err) => {\r\n      console.error('search error', err);\r\n      this.searchPromise = null;\r\n    });\r\n  }\r\n}\r\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport appDialogsManager, {DIALOG_LIST_ELEMENT_TAG} from '../lib/appManagers/appDialogsManager';\nimport type {MyInputMessagesFilter, MyMessage} from '../lib/appManagers/appMessagesManager';\nimport {logger} from '../lib/logger';\nimport rootScope from '../lib/rootScope';\nimport {SearchGroup, SearchGroupType} from './appSearch';\nimport {horizontalMenu} from './horizontalMenu';\nimport LazyLoadQueue from './lazyLoadQueue';\nimport {putPreloader} from './putPreloader';\nimport ripple from './ripple';\nimport Scrollable, {ScrollableX} from './scrollable';\nimport {wrapDocument, wrapPhoto, wrapVideo} from './wrappers';\nimport useHeavyAnimationCheck, {getHeavyAnimationPromise} from '../hooks/useHeavyAnimationCheck';\nimport I18n, {LangPackKey, i18n} from '../lib/langPack';\nimport findUpClassName from '../helpers/dom/findUpClassName';\nimport {getMiddleware, Middleware} from '../helpers/middleware';\nimport {ChannelParticipant, ChatFull, ChatParticipant, ChatParticipants, Document, Message, MessageMedia, Photo, WebPage} from '../layer';\nimport SortedUserList from './sortedUserList';\nimport findUpTag from '../helpers/dom/findUpTag';\nimport appSidebarRight from './sidebarRight';\nimport mediaSizes from '../helpers/mediaSizes';\nimport appImManager from '../lib/appManagers/appImManager';\nimport positionElementByIndex from '../helpers/dom/positionElementByIndex';\nimport cleanSearchText from '../helpers/cleanSearchText';\nimport IS_TOUCH_SUPPORTED from '../environment/touchSupport';\nimport handleTabSwipe from '../helpers/dom/handleTabSwipe';\nimport windowSize from '../helpers/windowSize';\nimport {formatPhoneNumber} from '../helpers/formatPhoneNumber';\nimport ButtonMenu, {ButtonMenuItemOptions} from './buttonMenu';\nimport PopupForward from './popups/forward';\nimport PopupDeleteMessages from './popups/deleteMessages';\nimport Row from './row';\nimport htmlToDocumentFragment from '../helpers/dom/htmlToDocumentFragment';\nimport {SearchSelection} from './chat/selection';\nimport cancelEvent from '../helpers/dom/cancelEvent';\nimport {attachClickEvent, simulateClickEvent} from '../helpers/dom/clickEvent';\nimport {MyDocument} from '../lib/appManagers/appDocsManager';\nimport AppMediaViewer from './appMediaViewer';\nimport lockTouchScroll from '../helpers/dom/lockTouchScroll';\nimport copy from '../helpers/object/copy';\nimport getObjectKeysAndSort from '../helpers/object/getObjectKeysAndSort';\nimport safeAssign from '../helpers/object/safeAssign';\nimport escapeRegExp from '../helpers/string/escapeRegExp';\nimport findAndSplice from '../helpers/array/findAndSplice';\nimport {ScrollStartCallbackDimensions} from '../helpers/fastSmoothScroll';\nimport setInnerHTML from '../helpers/dom/setInnerHTML';\nimport {AppManagers} from '../lib/appManagers/managers';\nimport choosePhotoSize from '../lib/appManagers/utils/photos/choosePhotoSize';\nimport wrapWebPageDescription from './wrappers/webPageDescription';\nimport wrapWebPageTitle from './wrappers/webPageTitle';\nimport getAbbreviation from '../lib/richTextProcessor/getAbbreviation';\nimport matchUrl from '../lib/richTextProcessor/matchUrl';\nimport wrapPlainText from '../lib/richTextProcessor/wrapPlainText';\nimport wrapRichText from '../lib/richTextProcessor/wrapRichText';\nimport wrapSenderToPeer from './wrappers/senderToPeer';\nimport wrapSentTime from './wrappers/sentTime';\nimport getMediaFromMessage from '../lib/appManagers/utils/messages/getMediaFromMessage';\nimport filterMessagesByInputFilter from '../lib/appManagers/utils/messages/filterMessagesByInputFilter';\nimport getChatMembersString from './wrappers/getChatMembersString';\nimport getUserStatusString from './wrappers/getUserStatusString';\nimport getParticipantPeerId from '../lib/appManagers/utils/chats/getParticipantPeerId';\nimport {Awaited} from '../types';\nimport {attachContextMenuListener} from '../helpers/dom/attachContextMenuListener';\nimport contextMenuController from '../helpers/contextMenuController';\nimport positionMenu from '../helpers/positionMenu';\nimport apiManagerProxy from '../lib/mtproto/mtprotoworker';\nimport ListenerSetter from '../helpers/listenerSetter';\nimport SwipeHandler from './swipeHandler';\n\n// const testScroll = false;\n\nexport type SearchSuperType = MyInputMessagesFilter/*  | 'members' */;\nexport type SearchSuperContext = {\n  peerId: PeerId,\n  inputFilter: {_: MyInputMessagesFilter},\n  query?: string,\n  maxId?: number,\n  folderId?: number,\n  threadId?: number,\n  date?: number,\n  nextRate?: number,\n  minDate?: number,\n  maxDate?: number\n};\n\nexport type SearchSuperMediaType = 'members' | 'media' | 'files' | 'links' | 'music' | 'chats' | 'voice';\nexport type SearchSuperMediaTab = {\n  inputFilter: SearchSuperType,\n  name: LangPackKey,\n  type: SearchSuperMediaType,\n  contentTab?: HTMLElement,\n  menuTab?: HTMLElement,\n  scroll?: {scrollTop: number, scrollHeight: number}\n};\n\nclass SearchContextMenu {\n  private buttons: (ButtonMenuItemOptions & {verify?: () => boolean | Promise<boolean>, withSelection?: true})[];\n  private element: HTMLElement;\n  private target: HTMLElement;\n  private peerId: PeerId;\n  private mid: number;\n  private isSelected: boolean;\n  private managers: AppManagers;\n\n  constructor(\n    private attachTo: HTMLElement,\n    private searchSuper: AppSearchSuper,\n    private listenerSetter: ListenerSetter\n  ) {\n    this.managers = searchSuper.managers;\n\n    const onContextMenu = (e: MouseEvent) => {\n      if(this.init) {\n        this.init();\n        this.init = null;\n      }\n\n      let item: HTMLElement;\n      try {\n        item = findUpClassName(e.target, 'search-super-item');\n      } catch(e) {}\n\n      if(!item) return;\n\n      if(e instanceof MouseEvent) e.preventDefault();\n      if(this.element.classList.contains('active')) {\n        return false;\n      }\n      if(e instanceof MouseEvent) e.cancelBubble = true;\n\n      const r = async() => {\n        this.target = item;\n        this.peerId = item.dataset.peerId.toPeerId();\n        this.mid = +item.dataset.mid;\n        this.isSelected = searchSuper.selection.isMidSelected(this.peerId, this.mid);\n\n        await Promise.all(this.buttons.map(async(button) => {\n          let good: boolean;\n\n          if(this.isSelected && !button.withSelection) {\n            good = false;\n          } else {\n            good = button.verify ? await button.verify() : true;\n          }\n\n          button.element.classList.toggle('hide', !good);\n        }));\n\n        item.classList.add('menu-open');\n\n        positionMenu(e, this.element);\n        contextMenuController.openBtnMenu(this.element, () => {\n          item.classList.remove('menu-open');\n        });\n      };\n\n      r();\n    };\n\n    if(IS_TOUCH_SUPPORTED) {\n\n    } else {\n      attachContextMenuListener(attachTo, onContextMenu as any, listenerSetter);\n    }\n  }\n\n  private init() {\n    this.buttons = [{\n      icon: 'forward',\n      text: 'Forward',\n      onClick: this.onForwardClick,\n      verify: async() => this.managers.appMessagesManager.canForward(await this.managers.appMessagesManager.getMessageByPeer(this.peerId, this.mid))\n    }, {\n      icon: 'forward',\n      text: 'Message.Context.Selection.Forward',\n      onClick: this.onForwardClick,\n      verify: () => this.isSelected &&\n        !this.searchSuper.selection.selectionForwardBtn.classList.contains('hide'),\n      withSelection: true\n    }, {\n      icon: 'message',\n      text: 'Message.Context.Goto',\n      onClick: this.onGotoClick,\n      withSelection: true\n    }, {\n      icon: 'select',\n      text: 'Message.Context.Select',\n      onClick: this.onSelectClick\n    }, {\n      icon: 'select',\n      text: 'Message.Context.Selection.Clear',\n      onClick: this.onClearSelectionClick,\n      verify: () => this.isSelected,\n      withSelection: true\n    }, {\n      icon: 'delete danger',\n      text: 'Delete',\n      onClick: this.onDeleteClick,\n      verify: async() => this.managers.appMessagesManager.canDeleteMessage(await this.managers.appMessagesManager.getMessageByPeer(this.peerId, this.mid))\n    }, {\n      icon: 'delete danger',\n      text: 'Message.Context.Selection.Delete',\n      onClick: this.onDeleteClick,\n      verify: () => this.isSelected && !this.searchSuper.selection.selectionDeleteBtn.classList.contains('hide'),\n      withSelection: true\n    }];\n\n    this.element = ButtonMenu(this.buttons);\n    this.element.classList.add('search-contextmenu', 'contextmenu');\n    document.getElementById('page-chats').append(this.element);\n  }\n\n  private onGotoClick = () => {\n    appImManager.setInnerPeer({\n      peerId: this.peerId,\n      lastMsgId: this.mid,\n      threadId: this.searchSuper.searchContext.threadId\n    });\n  };\n\n  private onForwardClick = () => {\n    if(this.searchSuper.selection.isSelecting) {\n      simulateClickEvent(this.searchSuper.selection.selectionForwardBtn);\n    } else {\n      new PopupForward({\n        [this.peerId]: [this.mid]\n      });\n    }\n  };\n\n  private onSelectClick = () => {\n    this.searchSuper.selection.toggleByElement(this.target);\n  };\n\n  private onClearSelectionClick = () => {\n    this.searchSuper.selection.cancelSelection();\n  };\n\n  private onDeleteClick = () => {\n    if(this.searchSuper.selection.isSelecting) {\n      simulateClickEvent(this.searchSuper.selection.selectionDeleteBtn);\n    } else {\n      new PopupDeleteMessages(this.peerId, [this.mid], 'chat');\n    }\n  };\n}\n\nexport type ProcessSearchSuperResult = {\n  message: Message.message,\n  middleware: Middleware,\n  promises: Promise<any>[],\n  elemsToAppend: {element: HTMLElement, message: any}[],\n  inputFilter: MyInputMessagesFilter,\n  searchGroup?: SearchGroup\n};\n\nexport default class AppSearchSuper {\n  public tabs: {[t in SearchSuperType]: HTMLDivElement} = {} as any;\n\n  public mediaTab: SearchSuperMediaTab;\n\n  public container: HTMLElement;\n  public nav: HTMLElement;\n  public navScrollableContainer: HTMLDivElement;\n  public tabsContainer: HTMLElement;\n  public navScrollable: ScrollableX;\n  private tabsMenu: HTMLElement;\n  private prevTabId = -1;\n\n  private lazyLoadQueue = new LazyLoadQueue();\n  public middleware = getMiddleware();\n\n  public historyStorage: Partial<{[type in SearchSuperType]: {mid: number, peerId: PeerId}[]}> = {};\n  public usedFromHistory: Partial<{[type in SearchSuperType]: number}> = {};\n  public urlsToRevoke: string[] = [];\n\n  public searchContext: SearchSuperContext;\n  public loadMutex: Promise<any> = Promise.resolve();\n\n  private nextRates: Partial<{[type in SearchSuperType]: number}> = {};\n  private loadPromises: Partial<{[type in SearchSuperType]: Promise<void>}> = {};\n  private loaded: Partial<{[type in SearchSuperType]: boolean}> = {};\n  private loadedChats = false;\n  private firstLoad = true;\n\n  private log = logger('SEARCH-SUPER');\n  public selectTab: ReturnType<typeof horizontalMenu>;\n\n  private monthContainers: Partial<{\n    [type in SearchSuperType]: {\n      [timestamp: number]: {\n        container: HTMLElement,\n        items: HTMLElement\n      }\n    }\n  }> = {};\n\n  private searchGroupMedia: SearchGroup;\n\n  public mediaTabsMap: Map<SearchSuperMediaType, SearchSuperMediaTab> = new Map();\n\n  private membersList: SortedUserList;\n\n  private skipScroll: boolean;\n\n  // * arguments\n  public mediaTabs: SearchSuperMediaTab[];\n  public scrollable: Scrollable;\n  public searchGroups?: {[group in SearchGroupType]: SearchGroup};\n  public asChatList? = false;\n  public groupByMonth? = true;\n  public hideEmptyTabs? = true;\n  public onChangeTab?: (mediaTab: SearchSuperMediaTab) => void;\n  public showSender? = false;\n\n  private searchContextMenu: SearchContextMenu;\n  public selection: SearchSelection;\n\n  public scrollStartCallback: (dimensions: ScrollStartCallbackDimensions) => void;\n\n  public managers: AppManagers;\n  private loadFirstTimePromise: Promise<void>;\n\n  private listenerSetter: ListenerSetter;\n  private swipeHandler: SwipeHandler;\n\n  constructor(options: Pick<AppSearchSuper, 'mediaTabs' | 'scrollable' | 'searchGroups' | 'asChatList' | 'groupByMonth' | 'hideEmptyTabs' | 'onChangeTab' | 'showSender' | 'managers'>) {\n    safeAssign(this, options);\n\n    this.container = document.createElement('div');\n    this.container.classList.add('search-super');\n\n    this.listenerSetter = new ListenerSetter();\n    this.searchContextMenu = new SearchContextMenu(this.container, this, this.listenerSetter);\n    this.selection = new SearchSelection(this, this.managers, this.listenerSetter);\n\n    const navScrollableContainer = this.navScrollableContainer = document.createElement('div');\n    navScrollableContainer.classList.add('search-super-tabs-scrollable', 'menu-horizontal-scrollable', 'sticky');\n\n    const navScrollable = this.navScrollable = new ScrollableX(navScrollableContainer);\n    navScrollable.container.classList.add('search-super-nav-scrollable');\n\n    const nav = this.nav = document.createElement('nav');\n    nav.classList.add('search-super-tabs', 'menu-horizontal-div');\n    this.tabsMenu = nav;\n\n    navScrollable.container.append(nav);\n\n    for(const mediaTab of this.mediaTabs) {\n      const menuTab = document.createElement('div');\n      menuTab.classList.add('menu-horizontal-div-item');\n      const span = document.createElement('span');\n      const i = document.createElement('i');\n\n      span.append(i18n(mediaTab.name));\n      span.append(i);\n\n      menuTab.append(span);\n\n      ripple(menuTab);\n\n      this.tabsMenu.append(menuTab);\n\n      this.mediaTabsMap.set(mediaTab.type, mediaTab);\n\n      mediaTab.menuTab = menuTab;\n    }\n\n    this.tabsContainer = document.createElement('div');\n    this.tabsContainer.classList.add('search-super-tabs-container', 'tabs-container');\n\n    let unlockScroll: ReturnType<typeof lockTouchScroll>;\n    if(IS_TOUCH_SUPPORTED) {\n      this.swipeHandler = handleTabSwipe({\n        element: this.tabsContainer,\n        onSwipe: (xDiff, yDiff, e) => {\n          const prevId = this.selectTab.prevId();\n          const children = Array.from(this.tabsMenu.children) as HTMLElement[];\n          let idx: number;\n          if(xDiff > 0) {\n            for(let i = prevId + 1; i < children.length; ++i) {\n              if(!children[i].classList.contains('hide')) {\n                idx = i;\n                break;\n              }\n            }\n          } else {\n            for(let i = prevId - 1; i >= 0; --i) {\n              if(!children[i].classList.contains('hide')) {\n                idx = i;\n                break;\n              }\n            }\n          }\n\n          if(idx !== undefined) {\n            unlockScroll = lockTouchScroll(this.tabsContainer);\n            this.selectTab(idx);\n          }\n        }\n      });\n    }\n\n    for(const mediaTab of this.mediaTabs) {\n      const container = document.createElement('div');\n      container.classList.add('search-super-container-' + mediaTab.type, 'tabs-tab');\n\n      const content = document.createElement('div');\n      content.classList.add('search-super-content-' + mediaTab.type);\n\n      container.append(content);\n\n      this.tabsContainer.append(container);\n\n      this.tabs[mediaTab.inputFilter] = content;\n\n      mediaTab.contentTab = content;\n    }\n\n    this.container.append(navScrollableContainer, this.tabsContainer);\n\n    // * construct end\n\n    this.searchGroupMedia = new SearchGroup(false, 'messages', true);\n\n    this.scrollable.onScrolledBottom = () => {\n      if(this.mediaTab.contentTab && this.canLoadMediaTab(this.mediaTab)/* && false */) {\n        // this.log('onScrolledBottom will load media');\n        this.load(true);\n      }\n    };\n    // this.scroll.attachSentinels(undefined, 400);\n\n    this.selectTab = horizontalMenu(this.tabsMenu, this.tabsContainer, (id, tabContent, animate) => {\n      if(this.prevTabId === id && !this.skipScroll) {\n        this.scrollable.scrollIntoViewNew({\n          element: this.container,\n          position: 'start',\n          startCallback: this.scrollStartCallback\n        });\n        return;\n      }\n\n      const newMediaTab = this.mediaTabs[id];\n      if(this.onChangeTab) {\n        this.onChangeTab(newMediaTab);\n      }\n\n      const fromMediaTab = this.mediaTab;\n      this.mediaTab = newMediaTab;\n\n      if(this.prevTabId !== -1 && animate) {\n        this.onTransitionStart();\n      }\n\n      if(this.skipScroll) {\n        this.skipScroll = false;\n      } else {\n        const offsetTop = this.container.offsetTop;\n        let scrollTop = this.scrollable.scrollTop;\n        if(scrollTop < offsetTop) {\n          this.scrollable.scrollIntoViewNew({\n            element: this.container,\n            position: 'start',\n            startCallback: this.scrollStartCallback\n          });\n          scrollTop = offsetTop;\n        }\n\n        fromMediaTab.scroll = {scrollTop: scrollTop, scrollHeight: this.scrollable.scrollHeight};\n\n        if(newMediaTab.scroll === undefined) {\n          const rect = this.container.getBoundingClientRect();\n          const rect2 = this.container.parentElement.getBoundingClientRect();\n          const diff = rect.y - rect2.y;\n\n          if(scrollTop > diff) {\n            newMediaTab.scroll = {scrollTop: diff, scrollHeight: 0};\n          }\n        }\n\n        if(newMediaTab.scroll) {\n          const diff = fromMediaTab.scroll.scrollTop - newMediaTab.scroll.scrollTop;\n          // console.log('what you gonna do', this.goingHard, diff);\n\n          // this.scrollable.scrollTop = scrollTop;\n          if(diff/*  && diff < 0 */) {\n            /* if(diff > -(fromMediaTab.contentTab.scrollHeight + this.nav.scrollHeight)) {\n              fromMediaTab.contentTab.style.transform = `translateY(${diff}px)`;\n              this.scrollable.scrollTop = scrollTop - diff;\n            } else { */\n            newMediaTab.contentTab.style.transform = `translateY(${diff}px)`;\n            // }\n          }\n        }\n      }\n\n      /* if(this.prevTabId !== -1 && nav.offsetTop) {\n        this.scrollable.scrollTop -= nav.offsetTop;\n      } */\n\n      /* this.log('setVirtualContainer', id, this.sharedMediaSelected, this.sharedMediaSelected.childElementCount);\n      this.scroll.setVirtualContainer(this.sharedMediaSelected); */\n\n      if(this.prevTabId !== -1 && !newMediaTab.contentTab.childElementCount) { // quick brown fix\n        // this.contentContainer.classList.remove('loaded');\n        this.load(true);\n      }\n\n      this.prevTabId = id;\n    }, () => {\n      this.scrollable.onScroll();\n\n      // console.log('what y', this.tabSelected.style.transform);\n      if(this.mediaTab.scroll !== undefined) {\n        this.mediaTab.contentTab.style.transform = '';\n        this.scrollable.scrollTop = this.mediaTab.scroll.scrollTop;\n      }\n\n      if(unlockScroll) {\n        unlockScroll();\n        unlockScroll = undefined;\n      }\n\n      this.onTransitionEnd();\n    }, undefined, navScrollable, this.listenerSetter);\n\n    attachClickEvent(this.tabsContainer, (e) => {\n      if(this.selection.isSelecting) {\n        cancelEvent(e);\n        this.selection.toggleByElement(findUpClassName(e.target, 'search-super-item'));\n      }\n    }, {capture: true, passive: false, listenerSetter: this.listenerSetter});\n\n    const onMediaClick = async(className: string, targetClassName: string, inputFilter: MyInputMessagesFilter, e: MouseEvent) => {\n      const target = findUpClassName(e.target as HTMLDivElement, className);\n      if(!target) return;\n\n      const mid = +target.dataset.mid;\n      if(!mid) {\n        this.log.warn('no messageId by click on target:', target);\n        return;\n      }\n\n      const peerId = target.dataset.peerId.toPeerId();\n\n      const targets = (Array.from(this.tabs[inputFilter].querySelectorAll('.' + targetClassName)) as HTMLElement[]).map((el) => {\n        const containerEl = findUpClassName(el, className);\n        return {\n          element: el,\n          mid: +containerEl.dataset.mid,\n          peerId: containerEl.dataset.peerId.toPeerId()\n        };\n      });\n\n      // const ids = Object.keys(this.mediaDivsByIds).map((k) => +k).sort((a, b) => a - b);\n      const idx = targets.findIndex((item) => item.mid === mid && item.peerId === peerId);\n\n      const message = await this.managers.appMessagesManager.getMessageByPeer(peerId, mid);\n      new AppMediaViewer()\n      .setSearchContext(this.copySearchContext(inputFilter))\n      .openMedia(message, targets[idx].element, 0, false, targets.slice(0, idx), targets.slice(idx + 1));\n    };\n\n    attachClickEvent(this.tabs.inputMessagesFilterPhotoVideo, onMediaClick.bind(null, 'grid-item', 'grid-item', 'inputMessagesFilterPhotoVideo'), {listenerSetter: this.listenerSetter});\n    attachClickEvent(this.tabs.inputMessagesFilterDocument, onMediaClick.bind(null, 'document-with-thumb', 'media-container', 'inputMessagesFilterDocument'), {listenerSetter: this.listenerSetter});\n\n    /* attachClickEvent(this.tabs.inputMessagesFilterUrl, (e) => {\n      const target = e.target as HTMLElement;\n      if(target.tagName === 'A') {\n        return;\n      }\n\n      try {\n        const a = findUpClassName(target, 'row').querySelector('.anchor-url:last-child') as HTMLAnchorElement;\n        a.click();\n      } catch(err) {}\n    }); */\n\n    this.mediaTab = this.mediaTabs[0];\n\n    useHeavyAnimationCheck(() => {\n      this.lazyLoadQueue.lock();\n    }, () => {\n      this.lazyLoadQueue.unlockAndRefresh(); // ! maybe not so efficient\n    }, this.listenerSetter);\n  }\n\n  private onTransitionStart = () => {\n    this.container.classList.add('sliding');\n  };\n\n  private onTransitionEnd = () => {\n    this.container.classList.remove('sliding');\n  };\n\n  public filterMessagesByType(messages: any[], type: SearchSuperType): MyMessage[] {\n    return filterMessagesByInputFilter(type, messages, messages.length);\n  }\n\n  private processEmptyFilter({message, searchGroup}: ProcessSearchSuperResult) {\n    const loadPromises: Promise<any>[] = [];\n    const {dom} = appDialogsManager.addDialogNew({\n      peerId: message.peerId,\n      container: searchGroup.list,\n      avatarSize: 54,\n      loadPromises\n    });\n\n    const setLastMessagePromise = appDialogsManager.setLastMessageN({\n      dialog: {\n        _: 'dialog',\n        peerId: message.peerId\n      } as any,\n      lastMessage: message,\n      dom,\n      highlightWord: this.searchContext.query\n    });\n\n    loadPromises.push(setLastMessagePromise);\n    return Promise.all(loadPromises);\n  }\n\n  private async processPhotoVideoFilter({message, promises, middleware}: ProcessSearchSuperResult) {\n    const media = getMediaFromMessage(message);\n\n    const div = document.createElement('div');\n    div.classList.add('grid-item');\n    // this.log(message, photo);\n\n    let wrapped: Awaited<ReturnType<typeof wrapPhoto>>;\n    const size = choosePhotoSize(media, 200, 200);\n    if(media._ !== 'photo') {\n      wrapped = await (await wrapVideo({\n        doc: media,\n        message,\n        container: div,\n        boxWidth: 0,\n        boxHeight: 0,\n        lazyLoadQueue: this.lazyLoadQueue,\n        middleware,\n        onlyPreview: true,\n        withoutPreloader: true,\n        noPlayButton: true,\n        photoSize: size\n      })).thumb;\n    } else {\n      wrapped = await wrapPhoto({\n        photo: media,\n        message,\n        container: div,\n        boxWidth: 0,\n        boxHeight: 0,\n        lazyLoadQueue: this.lazyLoadQueue,\n        middleware,\n        withoutPreloader: true,\n        noBlur: true,\n        size\n      });\n    }\n\n    [wrapped.images.thumb, wrapped.images.full].filter(Boolean).forEach((image) => {\n      image.classList.add('grid-item-media');\n    });\n\n    promises.push(wrapped.loadPromises.thumb);\n\n    return {element: div, message};\n  }\n\n  private async processDocumentFilter({message, inputFilter}: ProcessSearchSuperResult) {\n    const document = getMediaFromMessage(message) as Document.document;\n    const showSender = this.showSender || (['voice', 'round'] as MyDocument['type'][]).includes(document.type);\n\n    const div = await wrapDocument({\n      message,\n      withTime: !showSender,\n      fontWeight: 400,\n      voiceAsMusic: true,\n      showSender,\n      searchContext: this.copySearchContext(inputFilter),\n      lazyLoadQueue: this.lazyLoadQueue,\n      autoDownloadSize: 0\n    });\n\n    if((['audio', 'voice', 'round'] as MyDocument['type'][]).includes(document.type)) {\n      div.classList.add('audio-48');\n    }\n\n    return {message, element: div};\n  }\n\n  private async processUrlFilter({message, promises, middleware}: ProcessSearchSuperResult) {\n    let webpage = (message.media as MessageMedia.messageMediaWebPage)?.webpage as WebPage.webPage;\n\n    if(!webpage) {\n      const entity = message.totalEntities ? message.totalEntities.find((e: any) => e._ === 'messageEntityUrl' || e._ === 'messageEntityTextUrl') : null;\n      let url: string, display_url: string, sliced: string;\n\n      if(!entity) {\n        // this.log.error('NO ENTITY:', message);\n        const match = matchUrl(message.message);\n        if(!match) {\n          // this.log.error('NO ENTITY AND NO MATCH:', message);\n          return;\n        }\n\n        url = match[0];\n      } else {\n        sliced = message.message.slice(entity.offset, entity.offset + entity.length);\n      }\n\n      if(entity?._ === 'messageEntityTextUrl') {\n        url = entity.url;\n        // display_url = sliced;\n      } else {\n        url = url || sliced;\n      }\n\n      display_url = url;\n\n      const same = message.message === url;\n      if(!url.match(/^(ftp|http|https):\\/\\//)) {\n        display_url = 'https://' + url;\n        url = url.includes('@') ? url : 'https://' + url;\n      }\n\n      display_url = new URL(display_url).hostname;\n\n      webpage = {\n        _: 'webPage',\n        url,\n        display_url,\n        id: '',\n        hash: 0\n      };\n\n      if(!same) {\n        webpage.description = message.message;\n      }\n    }\n\n    const previewDiv = document.createElement('div');\n    previewDiv.classList.add('preview', 'row-media');\n\n    // this.log('wrapping webpage', webpage);\n\n    if(webpage.photo) {\n      const res = wrapPhoto({\n        container: previewDiv,\n        message: null,\n        photo: webpage.photo as Photo.photo,\n        boxWidth: 0,\n        boxHeight: 0,\n        withoutPreloader: true,\n        lazyLoadQueue: this.lazyLoadQueue,\n        middleware,\n        size: choosePhotoSize(webpage.photo as Photo.photo, 60, 60, false),\n        loadPromises: promises,\n        noBlur: true\n      });\n    } else {\n      previewDiv.classList.add('empty');\n      setInnerHTML(previewDiv, getAbbreviation(webpage.title || webpage.display_url || webpage.description || webpage.url, true));\n    }\n\n    const title = wrapWebPageTitle(webpage);\n\n    const subtitleFragment = wrapWebPageDescription(webpage);\n    const aFragment = htmlToDocumentFragment(wrapRichText(webpage.url || ''));\n    const a = aFragment.firstElementChild;\n    if(a instanceof HTMLAnchorElement) {\n      try { // can have 'URIError: URI malformed'\n        a.innerText = decodeURIComponent(a.href);\n      } catch(err) {\n\n      }\n    }\n\n    if(subtitleFragment.firstChild) {\n      subtitleFragment.append('\\n');\n    }\n\n    subtitleFragment.append(a);\n\n    if(this.showSender) {\n      subtitleFragment.append('\\n', await wrapSenderToPeer(message));\n    }\n\n    if(!title.textContent) {\n      // title = new URL(webpage.url).hostname;\n      title.append(wrapPlainText(webpage.display_url.split('/', 1)[0]));\n    }\n\n    const row = new Row({\n      title,\n      titleRight: wrapSentTime(message),\n      subtitle: subtitleFragment,\n      havePadding: true,\n      clickable: true,\n      noRipple: true\n    });\n\n    /* const mediaDiv = document.createElement('div');\n    mediaDiv.classList.add('row-media'); */\n\n    row.container.append(previewDiv);\n\n    /* ripple(div);\n    div.append(previewDiv);\n    div.insertAdjacentHTML('beforeend', `\n    <div class=\"title\">${title}${titleAdditionHTML}</div>\n    <div class=\"subtitle\">${subtitle}</div>\n    <div class=\"url\">${url}</div>\n    ${sender}\n    `); */\n\n    if(row.container.innerText.trim().length) {\n      return {message, element: row.container};\n    }\n  }\n\n  public async performSearchResult(messages: any[], mediaTab: SearchSuperMediaTab, append = true) {\n    const elemsToAppend: {element: HTMLElement, message: any}[] = [];\n    const sharedMediaDiv: HTMLElement = mediaTab.contentTab;\n    const promises: Promise<any>[] = [];\n    const middleware = this.middleware.get();\n    let inputFilter = mediaTab.inputFilter;\n\n    await getHeavyAnimationPromise();\n\n    let searchGroup: SearchGroup;\n    if(inputFilter === 'inputMessagesFilterPhotoVideo' && !!this.searchContext.query.trim()) {\n      inputFilter = 'inputMessagesFilterEmpty';\n      searchGroup = this.searchGroupMedia;\n      sharedMediaDiv.append(searchGroup.container);\n    } else if(inputFilter === 'inputMessagesFilterEmpty') {\n      searchGroup = this.searchGroups.messages;\n    }\n\n    const options: ProcessSearchSuperResult = {\n      elemsToAppend,\n      inputFilter,\n      message: undefined,\n      middleware,\n      promises,\n      searchGroup\n    };\n\n    let processCallback: (options: ProcessSearchSuperResult) => any;\n\n    // https://core.telegram.org/type/MessagesFilter\n    switch(inputFilter) {\n      case 'inputMessagesFilterEmpty': {\n        processCallback = this.processEmptyFilter;\n        break;\n      }\n\n      case 'inputMessagesFilterPhotoVideo': {\n        processCallback = this.processPhotoVideoFilter;\n        break;\n      }\n\n      case 'inputMessagesFilterVoice':\n      case 'inputMessagesFilterRoundVoice':\n      case 'inputMessagesFilterMusic':\n      case 'inputMessagesFilterDocument': {\n        processCallback = this.processDocumentFilter;\n        break;\n      }\n\n      case 'inputMessagesFilterUrl': {\n        processCallback = this.processUrlFilter;\n        break;\n      }\n\n      default:\n        // this.log.warn('death is my friend', messages);\n        break;\n    }\n\n    if(processCallback) {\n      processCallback = processCallback.bind(this);\n\n      type K = {element: HTMLElement, message: Message.message | Message.messageService};\n      const results: (Promise<K> | K)[] = messages.map(async(message) => {\n        try {\n          options.message = message;\n          return await processCallback(options);\n        } catch(err) {\n          this.log.error('error rendering filter', inputFilter, options, message, err);\n        }\n      });\n\n      const awaited = (await Promise.all(results)).filter(Boolean);\n      elemsToAppend.push(...awaited.filter(Boolean));\n    }\n\n    if(searchGroup && searchGroup.list.childElementCount) {\n      searchGroup.setActive();\n    }\n\n    if(this.loadMutex) {\n      promises.push(this.loadMutex);\n    }\n\n    if(promises.length) {\n      await Promise.all(promises);\n      if(!middleware()) {\n        // this.log.warn('peer changed');\n        return;\n      }\n    }\n\n    if(elemsToAppend.length) {\n      const method = append ? 'append' : 'prepend';\n      elemsToAppend.forEach((details) => {\n        const {element, message} = details;\n        const monthContainer = this.getMonthContainerByTimestamp(this.groupByMonth ? message.date : 0, inputFilter);\n        element.classList.add('search-super-item');\n        element.dataset.mid = '' + message.mid;\n        element.dataset.peerId = '' + message.peerId;\n        monthContainer.items[method](element);\n\n        if(this.selection?.isSelecting) {\n          this.selection.toggleElementCheckbox(element, true);\n        }\n      });\n    }\n\n    // if(type !== 'inputMessagesFilterEmpty') {\n    this.afterPerforming(inputFilter === 'inputMessagesFilterEmpty' ? 1 : messages.length, sharedMediaDiv);\n    // }\n  }\n\n  private afterPerforming(length: number, contentTab: HTMLElement) {\n    if(contentTab) {\n      const parent = contentTab.parentElement;\n      Array.from(parent.children).slice(1).forEach((child) => {\n        child.remove();\n      });\n\n      // this.contentContainer.classList.add('loaded');\n\n      if(!length && !contentTab.childElementCount) {\n        const div = document.createElement('div');\n        div.innerText = 'Nothing interesting here yet...';\n        div.classList.add('position-center', 'text-center', 'content-empty', 'no-select');\n\n        parent.append(div);\n      }\n    }\n  }\n\n  private loadChats() {\n    const renderedPeerIds: Set<PeerId> = new Set();\n    const middleware = this.middleware.get();\n\n    for(const i in this.searchGroups) {\n      const group = this.searchGroups[i as SearchGroupType];\n      this.tabs.inputMessagesFilterEmpty.append(group.container);\n      group.clear();\n    }\n\n    const query = this.searchContext.query;\n    if(query) {\n      const setResults = (results: PeerId[], group: SearchGroup, showMembersCount = false) => {\n        results.map((peerId) => {\n          if(renderedPeerIds.has(peerId)) {\n            return;\n          }\n\n          renderedPeerIds.add(peerId);\n\n          const {dom} = appDialogsManager.addDialogNew({\n            peerId: peerId,\n            container: group.list,\n            avatarSize: 48,\n            autonomous: group.autonomous\n          });\n\n          return {dom, peerId};\n        }).forEach(async({dom, peerId}) => {\n          const peer = await this.managers.appPeersManager.getPeer(peerId);\n          if(showMembersCount && (peer.participants_count || peer.participants)) {\n            const regExp = new RegExp(`(${escapeRegExp(query)}|${escapeRegExp(cleanSearchText(query))})`, 'gi');\n            dom.titleSpan.innerHTML = dom.titleSpan.innerHTML.replace(regExp, '<i>$1</i>');\n            dom.lastMessageSpan.append(await getChatMembersString(peerId.toChatId()));\n          } else if(peerId === rootScope.myId) {\n            dom.lastMessageSpan.append(i18n('Presence.YourChat'));\n          } else {\n            let username = await this.managers.appPeersManager.getPeerUsername(peerId);\n            if(!username) {\n              const user = await this.managers.appUsersManager.getUser(peerId);\n              if(user && user.phone) {\n                username = '+' + formatPhoneNumber(user.phone).formatted;\n              }\n            } else {\n              username = '@' + username;\n            }\n\n            dom.lastMessageSpan.innerHTML = '<i>' + username + '</i>';\n          }\n        });\n\n        group.toggle();\n      };\n\n      const onLoad = <T>(arg: T) => {\n        if(!middleware()) {\n          return;\n        }\n\n        // this.loadedContacts = true;\n\n        return arg;\n      };\n\n      return Promise.all([\n        this.managers.appUsersManager.getContactsPeerIds(query, true)\n        .then(onLoad)\n        .then((contacts) => {\n          if(contacts) {\n            setResults(contacts, this.searchGroups.contacts, true);\n          }\n        }),\n\n        this.managers.appUsersManager.searchContacts(query, 20)\n        .then(onLoad)\n        .then((contacts) => {\n          if(contacts) {\n            setResults(contacts.my_results, this.searchGroups.contacts, true);\n            setResults(contacts.results/* .concat(contacts.results, contacts.results, contacts.results) */, this.searchGroups.globalContacts);\n\n            this.searchGroups.globalContacts.container.classList.add('is-short');\n\n            if(this.searchGroups.globalContacts.nameEl.lastElementChild !== this.searchGroups.globalContacts.nameEl.firstElementChild) {\n              this.searchGroups.globalContacts.nameEl.lastElementChild.remove();\n            }\n\n            if(this.searchGroups.globalContacts.list.childElementCount > 3) {\n              const showMore = document.createElement('div');\n              showMore.classList.add('search-group__show-more');\n              const intlElement = new I18n.IntlElement({\n                key: 'Separator.ShowMore'\n              });\n              showMore.append(intlElement.element);\n              this.searchGroups.globalContacts.nameEl.append(showMore);\n              attachClickEvent(showMore, () => {\n                const isShort = this.searchGroups.globalContacts.container.classList.toggle('is-short');\n                intlElement.key = isShort ? 'Separator.ShowMore' : 'Separator.ShowLess';\n                intlElement.update();\n              });\n            }\n          }\n        }),\n\n        this.managers.appMessagesManager.getConversations(query, 0, 20, 0)\n        .then(onLoad)\n        .then((value) => {\n          if(value) {\n            setResults(value.dialogs.map((d) => d.peerId), this.searchGroups.contacts, true);\n          }\n        })\n      ]);\n    } else if(!this.searchContext.peerId && !this.searchContext.minDate) {\n      const renderRecentSearch = (setActive = true) => {\n        return apiManagerProxy.getState().then((state) => {\n          if(!middleware()) {\n            return;\n          }\n\n          this.searchGroups.recent.list.innerHTML = '';\n\n          state.recentSearch.slice(0, 20).forEach(async(peerId) => {\n            const {dom} = appDialogsManager.addDialogNew({\n              peerId: peerId,\n              container: this.searchGroups.recent.list,\n              meAsSaved: true,\n              avatarSize: 48,\n              autonomous: true\n            });\n\n            dom.lastMessageSpan.append(await (peerId.isUser() ?\n              getUserStatusString(await this.managers.appUsersManager.getUser(peerId.toUserId())) :\n              getChatMembersString(peerId.toChatId())));\n          });\n\n          if(!state.recentSearch.length) {\n            this.searchGroups.recent.clear();\n          } else if(setActive) {\n            this.searchGroups.recent.setActive();\n          }\n        });\n      };\n\n      return Promise.all([\n        this.managers.appUsersManager.getTopPeers('correspondents').then((peers) => {\n          if(!middleware()) return;\n\n          const idx = peers.findIndex((peer) => peer.id === rootScope.myId);\n          if(idx !== -1) {\n            peers = peers.slice();\n            peers.splice(idx, 1);\n          }\n          // console.log('got top categories:', categories);\n          if(peers.length) {\n            peers.forEach((peer) => {\n              appDialogsManager.addDialogNew({\n                peerId: peer.id,\n                container: this.searchGroups.people.list,\n                onlyFirstName: true,\n                avatarSize: 54,\n                autonomous: false,\n                noIcons: this.searchGroups.people.noIcons\n              });\n            });\n          }\n\n          this.searchGroups.people.setActive();\n        }),\n\n        renderRecentSearch()\n      ]);\n    } else return Promise.resolve();\n  }\n\n  private async loadMembers(mediaTab: SearchSuperMediaTab) {\n    const id = this.searchContext.peerId.toChatId();\n    const middleware = this.middleware.get();\n    let promise: Promise<void>;\n\n    const renderParticipants = async(participants: (ChatParticipant | ChannelParticipant)[]) => {\n      if(this.loadMutex) {\n        await this.loadMutex;\n\n        if(!middleware()) {\n          return;\n        }\n      }\n\n      if(!this.membersList) {\n        this.membersList = new SortedUserList({\n          lazyLoadQueue: this.lazyLoadQueue,\n          rippleEnabled: false,\n          managers: this.managers\n        });\n        attachClickEvent(this.membersList.list, (e) => {\n          const li = findUpTag(e.target, DIALOG_LIST_ELEMENT_TAG);\n          if(!li) {\n            return;\n          }\n\n          const peerId = li.dataset.peerId.toPeerId();\n          let promise: Promise<any> = Promise.resolve();\n          if(mediaSizes.isMobile) {\n            promise = appSidebarRight.toggleSidebar(false);\n          }\n\n          promise.then(() => {\n            appImManager.setInnerPeer({peerId});\n          });\n        });\n        mediaTab.contentTab.append(this.membersList.list);\n        this.afterPerforming(1, mediaTab.contentTab);\n      }\n\n      for(const participant of participants) {\n        const peerId = getParticipantPeerId(participant);\n        if(peerId.isAnyChat()) {\n          continue;\n        }\n\n        const user = await this.managers.appUsersManager.getUser(peerId);\n        if(user.pFlags.deleted) {\n          continue;\n        }\n\n        this.membersList.add(peerId);\n      }\n    };\n\n    if(await this.managers.appChatsManager.isChannel(id)) {\n      const LOAD_COUNT = !this.membersList ? 50 : 200;\n      promise = this.managers.appProfileManager.getChannelParticipants(id, undefined, LOAD_COUNT, this.nextRates[mediaTab.inputFilter]).then((participants) => {\n        if(!middleware()) {\n          return;\n        }\n\n        const list = mediaTab.contentTab.firstElementChild as HTMLUListElement;\n        this.nextRates[mediaTab.inputFilter] = (list ? list.childElementCount : 0) + participants.participants.length;\n\n        if(participants.participants.length < LOAD_COUNT) {\n          this.loaded[mediaTab.inputFilter] = true;\n        }\n\n        return renderParticipants(participants.participants);\n      });\n    } else {\n      promise = this.managers.appProfileManager.getChatFull(id).then((chatFull) => {\n        if(!middleware()) {\n          return;\n        }\n\n        // console.log('anymore', chatFull);\n        this.loaded[mediaTab.inputFilter] = true;\n        const participants = (chatFull as ChatFull.chatFull).participants;\n        if(participants._ === 'chatParticipantsForbidden') {\n          return;\n        }\n\n        return renderParticipants(participants.participants);\n      });\n    }\n\n    return this.loadPromises[mediaTab.inputFilter] = promise.finally(() => {\n      if(!middleware()) {\n        return;\n      }\n\n      this.loadPromises[mediaTab.inputFilter] = null;\n    });\n  }\n\n  private loadType(mediaTab: SearchSuperMediaTab, justLoad: boolean, loadCount: number, middleware: () => boolean) {\n    const type = mediaTab.inputFilter;\n\n    if(this.loadPromises[type]) {\n      return this.loadPromises[type];\n    }\n\n    if(mediaTab.type === 'members') {\n      return this.loadMembers(mediaTab);\n    }\n\n    const history = this.historyStorage[type] ?? (this.historyStorage[type] = []);\n\n    if(type === 'inputMessagesFilterEmpty' && !history.length) {\n      if(!this.loadedChats) {\n        this.loadChats();\n        this.loadedChats = true;\n      }\n\n      if(!this.searchContext.query.trim() && !this.searchContext.peerId && !this.searchContext.minDate) {\n        this.loaded[type] = true;\n        return Promise.resolve();\n      }\n    }\n\n    const promise = this.loadPromises[type] = Promise.resolve().then(async() => {\n      // render from cache\n      if(history.length && this.usedFromHistory[type] < history.length && !justLoad) {\n        const messages: any[] = [];\n        let used = Math.max(0, this.usedFromHistory[type]);\n        let slicedLength = 0;\n\n        do {\n          const ids = history.slice(used, used + loadCount);\n          used += ids.length;\n          slicedLength += ids.length;\n\n          const notFilteredMessages = await Promise.all(ids.map((m) => this.managers.appMessagesManager.getMessageByPeer(m.peerId, m.mid)));\n\n          messages.push(...this.filterMessagesByType(notFilteredMessages, type));\n        } while(slicedLength < loadCount && used < history.length);\n\n        //  \n        /* if(slicedLength > loadCount) {\n          let diff = messages.length - loadCount;\n          messages = messages.slice(0, messages.length - diff);\n          used -= diff;\n        } */\n\n        this.usedFromHistory[type] = used;\n        // if(messages.length) {\n        return this.performSearchResult(messages, mediaTab).finally(() => {\n          setTimeout(() => {\n            this.scrollable.checkForTriggers();\n          }, 0);\n        });\n        // }\n      }\n\n      const maxId = history.length ? history[history.length - 1].mid : 0;\n\n      const value = await this.managers.appMessagesManager.getSearch({\n        ...this.searchContext,\n        inputFilter: {_: type},\n        maxId,\n        limit: loadCount,\n        nextRate: this.nextRates[type] ??= 0\n      });\n\n      history.push(...value.history.map((m) => ({mid: m.mid, peerId: m.peerId})));\n\n      if(!middleware()) {\n        // this.log.warn('peer changed');\n        return;\n      }\n\n      // !  ,         ( - ,        getSearch)\n      if(value.history.length < loadCount || (this.searchContext.folderId !== undefined && !value.next_rate) || value.history.length === value.count) {\n      // if((value.count || history.length === value.count) && history.length >= value.count) {\n        // this.log(logStr + 'loaded all media', value, loadCount);\n        this.loaded[type] = true;\n      }\n\n      this.nextRates[type] = value.next_rate;\n\n      if(justLoad) {\n        return;\n      }\n\n      this.usedFromHistory[type] = history.length;\n\n      if(!this.loaded[type]) {\n        promise.then(() => {\n          setTimeout(() => {\n            if(!middleware()) return;\n            // this.log('will preload more');\n            if(this.mediaTab === mediaTab) {\n              const promise = this.load(true, true);\n              if(promise) {\n                promise.then(() => {\n                  if(!middleware()) return;\n                  // this.log('preloaded more');\n                  setTimeout(() => {\n                    this.scrollable.checkForTriggers();\n                  }, 0);\n                });\n              }\n            }\n          }, 0);\n        });\n      }\n\n      // if(value.history.length) {\n      return this.performSearchResult(this.filterMessagesByType(value.history, type), mediaTab);\n      // }\n    }).catch((err) => {\n      this.log.error('load error:', err);\n    }).finally(() => {\n      this.loadPromises[type] = null;\n    });\n\n    return promise;\n  }\n\n  private canLoadMediaTab(mediaTab: SearchSuperMediaTab) {\n    const inputFilter = mediaTab.inputFilter;\n    return !this.loaded[inputFilter] || (this.historyStorage[inputFilter] && this.usedFromHistory[inputFilter] < this.historyStorage[inputFilter].length);\n  }\n\n  private async loadFirstTime() {\n    const middleware = this.middleware.get();\n    const peerId = this.searchContext.peerId;\n    if(!this.hideEmptyTabs) {\n      return;\n    }\n\n    const mediaTabs = this.mediaTabs.filter((mediaTab) => mediaTab.inputFilter !== 'inputMessagesFilterEmpty');\n    const filters = mediaTabs.map((mediaTab) => ({_: mediaTab.inputFilter}));\n\n    const [counters, canViewMembers] = await Promise.all([\n      this.managers.appMessagesManager.getSearchCounters(peerId, filters),\n      this.canViewMembers()\n    ]);\n\n    if(!middleware()) {\n      return;\n    }\n\n    if(this.loadMutex) {\n      await this.loadMutex;\n\n      if(!middleware()) {\n        return;\n      }\n    }\n\n    let firstMediaTab: SearchSuperMediaTab;\n    let count = 0;\n    mediaTabs.forEach((mediaTab) => {\n      const counter = counters.find((c) => c.filter._ === mediaTab.inputFilter);\n\n      mediaTab.menuTab.classList.toggle('hide', !counter.count);\n      mediaTab.menuTab.classList.remove('active');\n      // mediaTab.contentTab.classList.toggle('hide', !counter.count);\n\n      if(counter.count) {\n        if(firstMediaTab === undefined) {\n          firstMediaTab = mediaTab;\n        }\n\n        ++count;\n      }\n    });\n\n    const membersTab = this.mediaTabsMap.get('members');\n    membersTab.menuTab.classList.toggle('hide', !canViewMembers);\n\n    if(canViewMembers) {\n      firstMediaTab = membersTab;\n    }\n\n    this.container.classList.toggle('hide', !firstMediaTab);\n    this.container.parentElement.classList.toggle('search-empty', !firstMediaTab);\n    if(firstMediaTab) {\n      this.skipScroll = true;\n      this.selectTab(this.mediaTabs.indexOf(firstMediaTab), false);\n      // firstMediaTab.menuTab.classList.add('active');\n\n      this.navScrollableContainer.classList.toggle('hide', count <= 1);\n    }\n  }\n\n  public async load(single = false, justLoad = false) {\n    const peerId = this.searchContext.peerId;\n    this.log('load', single, peerId, this.loadPromises);\n    const middleware = this.middleware.get();\n\n    if(this.firstLoad) {\n      await (this.loadFirstTimePromise ??= this.loadFirstTime());\n      if(!middleware()) {\n        return;\n      }\n\n      this.loadFirstTimePromise = undefined;\n      this.firstLoad = false;\n    }\n\n    let toLoad = single ? [this.mediaTab] : this.mediaTabs.filter((t) => t !== this.mediaTab);\n    toLoad = toLoad.filter((mediaTab) => {\n      return this.canLoadMediaTab(mediaTab);\n    });\n\n    if(peerId.isUser()) {\n      findAndSplice(toLoad, (mediaTab) => mediaTab.type === 'members');\n    }\n\n    if(!toLoad.length) {\n      return;\n    }\n\n    const loadCount = justLoad ? 50 : Math.round((windowSize.height / 130 | 0) * 3 * 1.25); // that's good for all types\n\n    const promises: Promise<any>[] = toLoad.map((mediaTab) => {\n      return this.loadType(mediaTab, justLoad, loadCount, middleware);\n    });\n\n    return Promise.all(promises).catch((err) => {\n      this.log.error('Load error all promises:', err);\n    });\n  }\n\n  public getMonthContainerByTimestamp(timestamp: number, type: SearchSuperType) {\n    const date = new Date(timestamp * 1000);\n    date.setHours(0, 0, 0);\n    date.setDate(1);\n    const dateTimestamp = date.getTime();\n    const containers = this.monthContainers[type] ?? (this.monthContainers[type] = {});\n    if(!(dateTimestamp in containers)) {\n      const container = document.createElement('div');\n      container.className = 'search-super-month';\n\n      const name = document.createElement('div');\n      name.classList.add('search-super-month-name');\n\n      const options: Intl.DateTimeFormatOptions = {\n        month: 'long'\n      };\n\n      if(date.getFullYear() !== new Date().getFullYear()) {\n        options.year = 'numeric';\n      }\n\n      const dateElement = new I18n.IntlDateElement({\n        date,\n        options\n      }).element;\n      name.append(dateElement);\n\n      container.append(name);\n\n      const items = document.createElement('div');\n      items.classList.add('search-super-month-items');\n\n      container.append(name, items);\n\n      const haveTimestamps = getObjectKeysAndSort(containers, 'desc');\n      let i = 0;\n      for(; i < haveTimestamps.length; ++i) {\n        const t = haveTimestamps[i];\n        if(dateTimestamp > t) {\n          break;\n        }\n      }\n\n      containers[dateTimestamp] = {container, items};\n      positionElementByIndex(container, this.tabs[type], i);\n    }\n\n    return containers[dateTimestamp];\n  }\n\n  public canViewMembers() {\n    return Promise.all([\n      this.searchContext.peerId.isAnyChat(),\n      this.managers.appChatsManager.isBroadcast(this.searchContext.peerId.toChatId()),\n      this.managers.appChatsManager.hasRights(this.searchContext.peerId.toChatId(), 'view_participants')\n    ]).then(([isAnyChat, isBroadcast, hasRights]) => {\n      return isAnyChat && !isBroadcast && hasRights;\n    });\n  }\n\n  public cleanup() {\n    this.loadPromises = {};\n    this.loaded = {};\n    this.loadedChats = false;\n    this.nextRates = {};\n    this.firstLoad = true;\n    this.prevTabId = -1;\n\n    this.lazyLoadQueue.clear();\n\n    this.mediaTabs.forEach((mediaTab) => {\n      this.usedFromHistory[mediaTab.inputFilter] = -1;\n    });\n\n    if(this.selection?.isSelecting) {\n      this.selection.cancelSelection();\n    }\n\n    // * must go to first tab ( )\n    /* const membersTab = this.mediaTabsMap.get('members');\n    if(membersTab) {\n      const tab = this.canViewMembers() ? membersTab : this.mediaTabs[this.mediaTabs.indexOf(membersTab) + 1];\n      this.mediaTab = tab;\n    } */\n\n    this.middleware.clean();\n    this.loadFirstTimePromise = undefined;\n    this.cleanScrollPositions();\n    this.membersList = undefined;\n  }\n\n  public cleanScrollPositions() {\n    this.mediaTabs.forEach((mediaTab) => {\n      mediaTab.scroll = undefined;\n    });\n  }\n\n  public cleanupHTML(goFirst = false) {\n    if(this.urlsToRevoke.length) {\n      this.urlsToRevoke.forEach((url) => {\n        URL.revokeObjectURL(url);\n      });\n      this.urlsToRevoke.length = 0;\n    }\n\n    this.mediaTabs.forEach((tab) => {\n      tab.contentTab.innerHTML = '';\n\n      if(this.hideEmptyTabs) {\n        // tab.menuTab.classList.add('hide');\n        this.container.classList.add('hide');\n        this.container.parentElement.classList.add('search-empty');\n      }\n\n      if(tab.type === 'chats') {\n        return;\n      }\n\n      if(!this.historyStorage[tab.inputFilter]) {\n        const parent = tab.contentTab.parentElement;\n        // if(!testScroll) {\n        if(!parent.querySelector('.preloader')) {\n          putPreloader(parent, true);\n        }\n        // }\n\n        const empty = parent.querySelector('.content-empty');\n        if(empty) {\n          empty.remove();\n        }\n      }\n    });\n\n    /* if(goFirst) {\n      const membersTab = this.mediaTabsMap.get('members');\n      if(membersTab) {\n        let idx = this.canViewMembers() ? 0 : 1;\n        membersTab.menuTab.classList.toggle('hide', idx !== 0);\n\n        this.selectTab(idx, false);\n      } else {\n        this.selectTab(0, false);\n      }\n    } */\n\n    this.monthContainers = {};\n    this.searchGroupMedia.clear();\n    this.scrollable.scrollTop = 0;\n\n    /* if(testScroll) {\n      for(let i = 0; i < 1500; ++i) {\n        let div = document.createElement('div');\n        div.insertAdjacentHTML('beforeend', `<img class=\"media-image\" src=\"assets/img/camomile.jpg\">`);\n        div.classList.add('grid-item');\n        div.dataset.id = '' + (i / 3 | 0);\n        //div.innerText = '' + (i / 3 | 0);\n        this.tabs.inputMessagesFilterPhotoVideo.append(div);\n      }\n    } */\n  }\n\n  private copySearchContext(newInputFilter: MyInputMessagesFilter) {\n    const context = copy(this.searchContext);\n    context.inputFilter = {_: newInputFilter};\n    context.nextRate = this.nextRates[newInputFilter];\n    return context;\n  }\n\n  public setQuery({peerId, query, threadId, historyStorage, folderId, minDate, maxDate}: {\n    peerId: PeerId,\n    query?: string,\n    threadId?: number,\n    historyStorage?: AppSearchSuper['historyStorage'],\n    folderId?: number,\n    minDate?: number,\n    maxDate?: number\n  }) {\n    this.searchContext = {\n      peerId,\n      query: query || '',\n      inputFilter: {_: this.mediaTab.inputFilter},\n      threadId,\n      folderId,\n      minDate,\n      maxDate\n    };\n\n    this.historyStorage = historyStorage ?? {};\n\n    this.cleanup();\n  }\n\n  public destroy() {\n    this.listenerSetter.removeAll();\n    this.scrollable.destroy();\n    this.swipeHandler?.removeListeners();\n    this.selection?.cleanup();\n\n    this.scrollStartCallback = undefined;\n    this.onChangeTab = undefined;\n    this.selectTab = undefined;\n    this.searchContextMenu = undefined;\n    this.swipeHandler = undefined;\n    this.selection = undefined;\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport cancelEvent from './cancelEvent';\n\nexport default function lockTouchScroll(container: HTMLElement) {\n  const onTouchMove = (e: TouchEvent) => {\n    cancelEvent(e);\n  };\n\n  let lockers = 2;\n  const cb = () => {\n    if(!--lockers) {\n      container.removeEventListener('touchmove', onTouchMove, {capture: true});\n    }\n  };\n\n  container.addEventListener('touchmove', onTouchMove, {capture: true, passive: false});\n  container.addEventListener('touchend', cb, {once: true});\n\n  return cb;\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport type {ChatRights} from '../lib/appManagers/appChatsManager';\nimport type {Dialog} from '../lib/appManagers/appMessagesManager';\nimport appDialogsManager from '../lib/appManagers/appDialogsManager';\nimport rootScope from '../lib/rootScope';\nimport Scrollable from './scrollable';\nimport {FocusDirection} from '../helpers/fastSmoothScroll';\nimport CheckboxField from './checkboxField';\nimport {i18n, LangPackKey, _i18n} from '../lib/langPack';\nimport findUpAttribute from '../helpers/dom/findUpAttribute';\nimport findUpClassName from '../helpers/dom/findUpClassName';\nimport PeerTitle from './peerTitle';\nimport cancelEvent from '../helpers/dom/cancelEvent';\nimport replaceContent from '../helpers/dom/replaceContent';\nimport debounce from '../helpers/schedulers/debounce';\nimport windowSize from '../helpers/windowSize';\nimport type {IsPeerType} from '../lib/appManagers/appPeersManager';\nimport {generateDelimiter, SettingSection} from './sidebarLeft';\nimport {attachClickEvent, simulateClickEvent} from '../helpers/dom/clickEvent';\nimport filterUnique from '../helpers/array/filterUnique';\nimport indexOfAndSplice from '../helpers/array/indexOfAndSplice';\nimport safeAssign from '../helpers/object/safeAssign';\nimport findAndSplice from '../helpers/array/findAndSplice';\nimport AvatarElement from './avatar';\nimport {AppManagers} from '../lib/appManagers/managers';\nimport filterAsync from '../helpers/array/filterAsync';\nimport getParticipantPeerId from '../lib/appManagers/utils/chats/getParticipantPeerId';\nimport getChatMembersString from './wrappers/getChatMembersString';\nimport getUserStatusString from './wrappers/getUserStatusString';\nimport {Chat, User} from '../layer';\nimport canSendToUser from '../lib/appManagers/utils/users/canSendToUser';\nimport hasRights from '../lib/appManagers/utils/chats/hasRights';\nimport getDialogIndex from '../lib/appManagers/utils/dialogs/getDialogIndex';\n\ntype SelectSearchPeerType = 'contacts' | 'dialogs' | 'channelParticipants';\n\n// TODO:    addMembers, ..  peerType: 'contacts',       -  ,      \n\nexport default class AppSelectPeers {\n  public container = document.createElement('div');\n  public list = appDialogsManager.createChatList(/* {\n    handheldsSize: 66,\n    avatarSize: 48\n  } */);\n  private chatsContainer = document.createElement('div');\n  public scrollable: Scrollable;\n  private selectedScrollable: Scrollable;\n\n  private selectedContainer: HTMLElement;\n  public input: HTMLInputElement;\n\n  // public selected: {[peerId: PeerId]: HTMLElement} = {};\n  public selected = new Set<PeerId | string>();\n\n  public freezed = false;\n\n  private folderId = 0;\n  private offsetIndex = 0;\n  private promise: Promise<any>;\n\n  private query = '';\n  private cachedContacts: PeerId[];\n\n  private loadedWhat: Partial<{[k in 'dialogs' | 'archived' | 'contacts' | 'channelParticipants']: true}> = {};\n\n  private renderedPeerIds: Set<PeerId> = new Set();\n\n  private appendTo: HTMLElement;\n  private onChange: (length: number) => void;\n  private peerType: SelectSearchPeerType[] = ['dialogs'];\n  private renderResultsFunc: (peerIds: PeerId[]) => void | Promise<void>;\n  private chatRightsAction: ChatRights;\n  private multiSelect = true;\n  private rippleEnabled = true;\n  private avatarSize = 48;\n  private exceptSelf = false;\n  private filterPeerTypeBy: IsPeerType[];\n\n  private tempIds: {[k in keyof AppSelectPeers['loadedWhat']]: number} = {};\n  private peerId: PeerId;\n\n  private placeholder: LangPackKey;\n\n  private selfPresence: LangPackKey = 'Presence.YourChat';\n\n  private needSwitchList = false;\n\n  private sectionNameLangPackKey: LangPackKey;\n\n  private managers: AppManagers;\n\n  constructor(options: {\n    appendTo: AppSelectPeers['appendTo'],\n    onChange?: AppSelectPeers['onChange'],\n    peerType?: AppSelectPeers['peerType'],\n    peerId?: AppSelectPeers['peerId'],\n    onFirstRender?: () => void,\n    renderResultsFunc?: AppSelectPeers['renderResultsFunc'],\n    chatRightsAction?: AppSelectPeers['chatRightsAction'],\n    multiSelect?: AppSelectPeers['multiSelect'],\n    rippleEnabled?: AppSelectPeers['rippleEnabled'],\n    avatarSize?: AppSelectPeers['avatarSize'],\n    placeholder?: AppSelectPeers['placeholder'],\n    selfPresence?: AppSelectPeers['selfPresence'],\n    exceptSelf?: AppSelectPeers['exceptSelf'],\n    filterPeerTypeBy?: AppSelectPeers['filterPeerTypeBy'],\n    sectionNameLangPackKey?: AppSelectPeers['sectionNameLangPackKey'],\n    managers: AppSelectPeers['managers']\n  }) {\n    safeAssign(this, options);\n\n    this.container.classList.add('selector');\n\n    const f = (this.renderResultsFunc || this.renderResults).bind(this);\n    this.renderResultsFunc = async(peerIds) => {\n      if(this.needSwitchList) {\n        this.scrollable.splitUp.replaceWith(this.list);\n        this.scrollable.setVirtualContainer(this.list);\n        this.needSwitchList = false;\n      }\n\n      peerIds = peerIds.filter((peerId) => {\n        const notRendered = !this.renderedPeerIds.has(peerId);\n        if(notRendered) this.renderedPeerIds.add(peerId);\n        return notRendered;\n      });\n\n      if(this.filterPeerTypeBy) {\n        peerIds = await filterAsync(peerIds, async(peerId) => {\n          if(peerId.isPeerId()) {\n            const peer = await this.managers.appPeersManager.getPeer(peerId);\n            if(!peer.deleted) {\n              for(const method of this.filterPeerTypeBy) {\n                if(await this.managers.appPeersManager[method](peerId)) {\n                  return true;\n                }\n              }\n            }\n          }\n\n          return true;\n        });\n      }\n\n      return f(peerIds);\n    };\n\n    this.input = document.createElement('input');\n    this.input.classList.add('selector-search-input');\n    if(this.placeholder) {\n      _i18n(this.input, this.placeholder, undefined, 'placeholder');\n    } else {\n      _i18n(this.input, 'SendMessageTo', undefined, 'placeholder');\n    }\n\n    this.input.type = 'text';\n\n    if(this.multiSelect) {\n      const section = new SettingSection({});\n      section.innerContainer.classList.add('selector-search-section');\n      const topContainer = document.createElement('div');\n      topContainer.classList.add('selector-search-container');\n\n      this.selectedContainer = document.createElement('div');\n      this.selectedContainer.classList.add('selector-search');\n\n      this.selectedContainer.append(this.input);\n      topContainer.append(this.selectedContainer);\n      this.selectedScrollable = new Scrollable(topContainer);\n\n      // let delimiter = document.createElement('hr');\n\n      attachClickEvent(this.selectedContainer, (e) => {\n        if(this.freezed) return;\n        let target = e.target as HTMLElement;\n        target = findUpClassName(target, 'selector-user');\n\n        if(!target) return;\n\n        const peerId = target.dataset.key;\n        const li = this.chatsContainer.querySelector('[data-peer-id=\"' + peerId + '\"]') as HTMLElement;\n        if(!li) {\n          this.remove(peerId.toPeerId());\n        } else {\n          simulateClickEvent(li);\n        }\n      });\n\n      section.content.append(topContainer);\n      this.container.append(section.container/* , delimiter */);\n    }\n\n    this.chatsContainer.classList.add('chatlist-container');\n    // this.chatsContainer.append(this.list);\n    const section = new SettingSection({\n      name: this.sectionNameLangPackKey,\n      noShadow: true\n    });\n    section.content.append(this.list);\n    this.chatsContainer.append(section.container);\n    this.scrollable = new Scrollable(this.chatsContainer);\n    this.scrollable.setVirtualContainer(this.list);\n\n    attachClickEvent(this.chatsContainer, (e) => {\n      const target = findUpAttribute(e.target, 'data-peer-id') as HTMLElement;\n      cancelEvent(e);\n\n      if(!target) return;\n      if(this.freezed) return;\n\n      let key: PeerId | string = target.dataset.peerId;\n      key = key.isPeerId() ? key.toPeerId() : key;\n\n      if(!this.multiSelect) {\n        this.add(key);\n        return;\n      }\n\n      // target.classList.toggle('active');\n      if(this.selected.has(key)) {\n        this.remove(key);\n      } else {\n        this.add(key);\n      }\n\n      const checkbox = target.querySelector('input') as HTMLInputElement;\n      checkbox.checked = !checkbox.checked;\n    });\n\n    const debouncedInput = debounce(this.onInput, 200, false, true);\n    this.input.addEventListener('input', debouncedInput);\n\n    this.scrollable.onScrolledBottom = () => {\n      this.getMoreResults();\n    };\n\n    this.scrollable.container.prepend(generateDelimiter());\n\n    this.container.append(this.chatsContainer);\n    this.appendTo.append(this.container);\n\n    // WARNING TIMEOUT\n    setTimeout(() => {\n      const getResultsPromise = this.getMoreResults() as Promise<any>;\n      if(options.onFirstRender) {\n        getResultsPromise.then(() => {\n          options.onFirstRender();\n        });\n      }\n    }, 0);\n  }\n\n  private onInput = () => {\n    const value = this.input.value;\n    if(this.query !== value) {\n      if(this.peerType.includes('contacts') || this.peerType.includes('dialogs')) {\n        this.cachedContacts = null;\n      }\n\n      if(this.peerType.includes('dialogs')) {\n        this.folderId = 0;\n        this.offsetIndex = 0;\n      }\n\n      for(const i in this.tempIds) {\n        // @ts-ignore\n        ++this.tempIds[i];\n      }\n\n      this.list = appDialogsManager.createChatList();\n\n      this.promise = null;\n      this.loadedWhat = {};\n      this.query = value;\n      this.renderedPeerIds.clear();\n      this.needSwitchList = true;\n\n      // console.log('selectPeers input:', this.query);\n      this.getMoreResults();\n    }\n  };\n\n  private async renderSaved() {\n    if(\n      !this.exceptSelf &&\n      !this.offsetIndex &&\n      this.folderId === 0 &&\n      this.peerType.includes('dialogs') &&\n      (!this.query || await this.managers.appUsersManager.testSelfSearch(this.query))\n    ) {\n      await this.renderResultsFunc([rootScope.myId]);\n    }\n  }\n\n  private getTempId(type: keyof AppSelectPeers['tempIds']) {\n    if(this.tempIds[type] === undefined) {\n      this.tempIds[type] = 0;\n    }\n\n    return ++this.tempIds[type];\n  }\n\n  private async getMoreDialogs(): Promise<any> {\n    if(this.promise) return this.promise;\n\n    if(this.loadedWhat.dialogs && this.loadedWhat.archived) {\n      return;\n    }\n\n    //   -   ,  ,    \n    const pageCount = windowSize.height / 72 * 1.25 | 0;\n\n    const tempId = this.getTempId('dialogs');\n    const promise = this.managers.appMessagesManager.getConversations(this.query, this.offsetIndex, pageCount, this.folderId, true);\n    this.promise = promise;\n    const value = await promise;\n    if(this.tempIds.dialogs !== tempId) {\n      return;\n    }\n\n    this.promise = null;\n\n    let dialogs = value.dialogs as Dialog[];\n    if(dialogs.length) {\n      const newOffsetIndex = getDialogIndex(dialogs[dialogs.length - 1]) || 0;\n\n      dialogs = dialogs.slice();\n      findAndSplice(dialogs, d => d.peerId === rootScope.myId); // no my account\n\n      if(this.chatRightsAction) {\n        dialogs = await filterAsync(dialogs, (d) => this.filterByRights(d.peerId));\n      }\n\n      await this.renderSaved();\n\n      this.offsetIndex = newOffsetIndex;\n    }\n\n    this.renderResultsFunc(dialogs.map((dialog) => dialog.peerId));\n\n    if(value.isEnd) {\n      if(!this.loadedWhat.dialogs) {\n        await this.renderSaved();\n\n        this.loadedWhat.dialogs = true;\n        this.offsetIndex = 0;\n        this.folderId = 1;\n\n        return this.getMoreDialogs();\n      } else {\n        this.loadedWhat.archived = true;\n\n        if(!this.loadedWhat.contacts/*  && this.peerType.includes('contacts') */) {\n          return this.getMoreContacts();\n        }\n      }\n    }\n  }\n\n  private async filterByRights(peerId: PeerId) {\n    const peer: User | Chat = await this.managers.appPeersManager.getPeer(peerId);\n    if(peerId.isUser()) {\n      return this.chatRightsAction !== 'send_messages' || canSendToUser(peer as User.user);\n    } else if(hasRights(peer as Chat.chat, this.chatRightsAction)) {\n      return true;\n    }\n  }\n\n  private async getMoreContacts() {\n    if(this.promise) return this.promise;\n\n    if(this.loadedWhat.contacts) {\n      return;\n    }\n\n    const isGlobalSearch = this.peerType.includes('contacts');\n\n    if(!this.cachedContacts) {\n      /* const promises: Promise<any>[] = [appUsersManager.getContacts(this.query)];\n      if(!this.peerType.includes('dialogs')) {\n        promises.push(appMessagesManager.getConversationsAll());\n      }\n\n      this.promise = Promise.all(promises);\n      this.cachedContacts = (await this.promise)[0].slice(); */\n      const tempId = this.getTempId('contacts');\n      const promise = Promise.all([\n        isGlobalSearch ? this.managers.appUsersManager.getContactsPeerIds(this.query) : [],\n        this.query ? this.managers.appUsersManager.searchContacts(this.query) : undefined\n      ]);\n\n      this.promise = promise;\n      const [cachedContacts, searchResult] = await promise;\n      if(this.tempIds.contacts !== tempId) {\n        return;\n      }\n\n      if(searchResult) {\n        // do not add global result if only dialogs needed\n        let resultPeerIds = isGlobalSearch ? searchResult.my_results.concat(searchResult.results) : searchResult.my_results;\n\n        if(this.chatRightsAction) {\n          resultPeerIds = await filterAsync(resultPeerIds, (peerId) => this.filterByRights(peerId));\n        }\n\n        if(!this.peerType.includes('dialogs')) {\n          resultPeerIds = resultPeerIds.filter((peerId) => peerId.isUser());\n        }\n\n        this.cachedContacts = filterUnique(cachedContacts.concat(resultPeerIds));\n      } else this.cachedContacts = cachedContacts.slice();\n\n      indexOfAndSplice(this.cachedContacts, rootScope.myId); // no my account\n      this.promise = null;\n    }\n\n    // if(this.cachedContacts.length) {\n    const pageCount = windowSize.height / 72 * 1.25 | 0;\n    const arr = this.cachedContacts.splice(0, pageCount);\n    this.renderResultsFunc(arr);\n    // }\n\n    if(!this.cachedContacts.length) {\n      this.loadedWhat.contacts = true;\n\n      // need to load non-contacts\n      /* if(!this.peerType.includes('dialogs')) {\n        return this.getMoreDialogs();\n      } */\n    }\n  }\n\n  private async getMoreChannelParticipants() {\n    if(this.promise) return this.promise;\n\n    if(this.loadedWhat.channelParticipants) {\n      return;\n    }\n\n    const pageCount = 50; // same as in group permissions to use cache\n\n    const tempId = this.getTempId('channelParticipants');\n    const promise = this.managers.appProfileManager.getChannelParticipants(this.peerId.toChatId(), {_: 'channelParticipantsSearch', q: this.query}, pageCount, this.list.childElementCount);\n    const participants = await promise;\n    if(this.tempIds.channelParticipants !== tempId) {\n      return;\n    }\n\n    const peerIds = participants.participants.map((participant) => {\n      return getParticipantPeerId(participant);\n    });\n    indexOfAndSplice(peerIds, rootScope.myId);\n    this.renderResultsFunc(peerIds);\n\n    if(this.list.childElementCount >= participants.count || participants.participants.length < pageCount) {\n      this.loadedWhat.channelParticipants = true;\n    }\n  }\n\n  checkForTriggers = () => {\n    this.scrollable.checkForTriggers();\n  };\n\n  private getMoreResults() {\n    const get = () => {\n      const promises: Promise<any>[] = [];\n\n      // if(!loadedAllDialogs && (this.peerType.includes('dialogs')/*  || this.peerType.includes('contacts') */)) {\n      //   if(!loadAllDialogsPromise) {\n      //     loadAllDialogsPromise = appMessagesManager.getConversationsAll()\n      //     .then(() => {\n      //       loadedAllDialogs = true;\n      //     }).finally(() => {\n      //       loadAllDialogsPromise = null;\n      //     });\n      //   }\n\n      //   promises.push(loadAllDialogsPromise);\n      // }\n\n      if((this.peerType.includes('dialogs')/*  || this.loadedWhat.contacts */) && !this.loadedWhat.archived) { // to load non-contacts\n        promises.push(this.getMoreDialogs());\n\n        if(!this.loadedWhat.archived) {\n          return promises;\n        }\n      }\n\n      if((this.peerType.includes('contacts') || this.peerType.includes('dialogs')) && !this.loadedWhat.contacts) {\n        promises.push(this.getMoreContacts());\n      }\n\n      if(this.peerType.includes('channelParticipants') && !this.loadedWhat.channelParticipants) {\n        promises.push(this.getMoreChannelParticipants());\n      }\n\n      return promises;\n    };\n\n    const promises = get();\n    const promise = Promise.all(promises);\n    if(promises.length) {\n      promise.then(this.checkForTriggers);\n    }\n\n    return promise;\n  }\n\n  private async renderResults(peerIds: PeerId[]) {\n    // console.log('will renderResults:', peerIds);\n\n    //     \n    if(!this.peerType.includes('dialogs') && this.loadedWhat.contacts) {\n      peerIds = await filterAsync(peerIds, (peerId) => {\n        return this.managers.appUsersManager.isNonContactUser(peerId);\n      });\n    }\n\n    peerIds.forEach(async(peerId) => {\n      const {dom} = appDialogsManager.addDialogNew({\n        peerId: peerId,\n        container: this.scrollable,\n        rippleEnabled: this.rippleEnabled,\n        avatarSize: this.avatarSize\n      });\n\n      if(this.multiSelect) {\n        const selected = this.selected.has(peerId);\n        const checkboxField = new CheckboxField();\n\n        if(selected) {\n          // dom.listEl.classList.add('active');\n          checkboxField.input.checked = true;\n        }\n\n        dom.containerEl.prepend(checkboxField.label);\n      }\n\n      let subtitleEl: HTMLElement;\n      if(peerId.isAnyChat()) {\n        subtitleEl = await getChatMembersString(peerId.toChatId());\n      } else if(peerId === rootScope.myId) {\n        subtitleEl = i18n(this.selfPresence);\n      } else {\n        subtitleEl = getUserStatusString(await this.managers.appUsersManager.getUser(peerId.toUserId()));\n      }\n\n      dom.lastMessageSpan.append(subtitleEl);\n    });\n  }\n\n  public add(key: PeerId | string, title?: string | HTMLElement, scroll = true) {\n    // console.trace('add');\n    this.selected.add(key);\n\n    if(!this.multiSelect) {\n      this.onChange(this.selected.size);\n      return;\n    }\n\n    if(this.query.trim()) {\n      this.input.value = '';\n      this.onInput();\n    }\n\n    const div = document.createElement('div');\n    div.classList.add('selector-user', 'scale-in');\n\n    const avatarEl = new AvatarElement();\n    avatarEl.classList.add('selector-user-avatar', 'tgico', 'avatar-32');\n    avatarEl.isDialog = true;\n\n    div.dataset.key = '' + key;\n    if(key.isPeerId()) {\n      if(title === undefined) {\n        title = new PeerTitle({peerId: key.toPeerId(), dialog: true}).element;\n      }\n\n      avatarEl.updateWithOptions({\n        peerId: key as PeerId\n      });\n    }\n\n    if(title) {\n      if(typeof(title) === 'string') {\n        div.innerHTML = title;\n      } else {\n        replaceContent(div, title);\n        div.append(title);\n      }\n    }\n\n    div.insertAdjacentElement('afterbegin', avatarEl);\n\n    this.selectedContainer.insertBefore(div, this.input);\n    // this.selectedScrollable.scrollTop = this.selectedScrollable.scrollHeight;\n    this.onChange && this.onChange(this.selected.size);\n\n    if(scroll) {\n      this.selectedScrollable.scrollIntoViewNew({\n        element: this.input,\n        position: 'center'\n      });\n    }\n\n    return div;\n  }\n\n  public remove(key: PeerId | string) {\n    if(!this.multiSelect) return;\n    // const div = this.selected[peerId];\n    const div = this.selectedContainer.querySelector(`[data-key=\"${key}\"]`) as HTMLElement;\n    div.classList.remove('scale-in');\n    void div.offsetWidth;\n    div.classList.add('scale-out');\n\n    const onAnimationEnd = () => {\n      this.selected.delete(key);\n      div.remove();\n      this.onChange && this.onChange(this.selected.size);\n    };\n\n    if(rootScope.settings.animationsEnabled) {\n      div.addEventListener('animationend', onAnimationEnd, {once: true});\n    } else {\n      onAnimationEnd();\n    }\n  }\n\n  public getSelected() {\n    return [...this.selected];\n  }\n\n  public addInitial(values: any[]) {\n    values.forEach((value) => {\n      this.add(value, undefined, false);\n    });\n\n    window.requestAnimationFrame(() => { // ! not the best place for this raf though it works\n      this.selectedScrollable.scrollIntoViewNew({\n        element: this.input,\n        position: 'center',\n        forceDirection: FocusDirection.Static\n      });\n    });\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport type {MyDocument} from '../lib/appManagers/appDocsManager';\nimport {wrapPhoto} from './wrappers';\nimport ProgressivePreloader from './preloader';\nimport appMediaPlaybackController, {MediaItem, MediaSearchContext} from './appMediaPlaybackController';\nimport {DocumentAttribute, Message} from '../layer';\nimport mediaSizes from '../helpers/mediaSizes';\nimport {IS_SAFARI} from '../environment/userAgent';\nimport rootScope from '../lib/rootScope';\nimport cancelEvent from '../helpers/dom/cancelEvent';\nimport {attachClickEvent} from '../helpers/dom/clickEvent';\nimport LazyLoadQueue from './lazyLoadQueue';\nimport deferredPromise, {CancellablePromise} from '../helpers/cancellablePromise';\nimport ListenerSetter, {Listener} from '../helpers/listenerSetter';\nimport noop from '../helpers/noop';\nimport findUpClassName from '../helpers/dom/findUpClassName';\nimport {joinElementsWith} from '../lib/langPack';\nimport {MiddleEllipsisElement} from './middleEllipsis';\nimport {formatFullSentTime} from '../helpers/date';\nimport throttleWithRaf from '../helpers/schedulers/throttleWithRaf';\nimport {NULL_PEER_ID} from '../lib/mtproto/mtproto_config';\nimport formatBytes from '../helpers/formatBytes';\nimport {animateSingle} from '../helpers/animation';\nimport clamp from '../helpers/number/clamp';\nimport toHHMMSS from '../helpers/string/toHHMMSS';\nimport MediaProgressLine from './mediaProgressLine';\nimport setInnerHTML from '../helpers/dom/setInnerHTML';\nimport {AppManagers} from '../lib/appManagers/managers';\nimport wrapEmojiText from '../lib/richTextProcessor/wrapEmojiText';\nimport wrapSenderToPeer from './wrappers/senderToPeer';\nimport wrapSentTime from './wrappers/sentTime';\nimport getMediaFromMessage from '../lib/appManagers/utils/messages/getMediaFromMessage';\nimport appDownloadManager from '../lib/appManagers/appDownloadManager';\n\nrootScope.addEventListener('messages_media_read', ({mids, peerId}) => {\n  mids.forEach((mid) => {\n    const attr = `[data-mid=\"${mid}\"][data-peer-id=\"${peerId}\"]`;\n    (Array.from(document.querySelectorAll(`audio-element.is-unread${attr}, .media-round.is-unread${attr}`)) as AudioElement[]).forEach((elem) => {\n      elem.classList.remove('is-unread');\n    });\n  });\n});\n\n// https://github.com/LonamiWebs/Telethon/blob/4393ec0b83d511b6a20d8a20334138730f084375/telethon/utils.py#L1285\nexport function decodeWaveform(waveform: Uint8Array | number[]) {\n  if(!(waveform instanceof Uint8Array)) {\n    waveform = new Uint8Array(waveform);\n  }\n\n  const bitCount = waveform.length * 8;\n  const valueCount = bitCount / 5 | 0;\n  if(!valueCount) {\n    return new Uint8Array([]);\n  }\n\n  let result: Uint8Array;\n  try {\n    const dataView = new DataView(waveform.buffer);\n    result = new Uint8Array(valueCount);\n    for(let i = 0; i < valueCount; i++) {\n      const byteIndex = i * 5 / 8 | 0;\n      const bitShift = i * 5 % 8;\n      const value = dataView.getUint16(byteIndex, true);\n      result[i] = (value >> bitShift) & 0b00011111;\n    }\n  } catch(err) {\n    result = new Uint8Array([]);\n  }\n\n  /* var byteIndex = (valueCount - 1) / 8 | 0;\n  var bitShift = (valueCount - 1) % 8;\n  if(byteIndex === waveform.length - 1) {\n    var value = waveform[byteIndex];\n  } else {\n    var value = dataView.getUint16(byteIndex, true);\n  }\n  console.log('decoded waveform, setting last value:', value, byteIndex, bitShift);\n  result[valueCount - 1] = (value >> bitShift) & 0b00011111; */\n  return result;\n}\n\nfunction createWaveformBars(waveform: Uint8Array, duration: number) {\n  const barWidth = 2;\n  const barMargin = 2;      // mediaSizes.isMobile ? 2 : 1;\n  const barHeightMin = 4;   // mediaSizes.isMobile ? 3 : 2;\n  const barHeightMax = mediaSizes.isMobile ? 16 : 23;\n  // const availW = 150;       //mediaSizes.isMobile ? 152 : 190;\n\n  const minW = mediaSizes.isMobile ? 152 : 190;\n  const maxW = mediaSizes.isMobile ? 190 : 256;\n  const availW = clamp(duration / 60 * maxW, minW, maxW); // mediaSizes.isMobile ? 152 : 224;\n\n  const svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');\n  svg.classList.add('audio-waveform-bars');\n  svg.setAttributeNS(null, 'width', '' + availW);\n  svg.setAttributeNS(null, 'height', '' + barHeightMax);\n  svg.setAttributeNS(null, 'viewBox', `0 0 ${availW} ${barHeightMax}`);\n\n  // console.log('decoded waveform:', waveform);\n\n  const normValue = Math.max(...waveform);\n  const wfSize = waveform.length ? waveform.length : 100;\n  const barCount = Math.min((availW / (barWidth + barMargin)) | 0, wfSize);\n\n  let maxValue = 0;\n  const maxDelta = barHeightMax - barHeightMin;\n\n  let html = '';\n  for(let i = 0, barX = 0, sumI = 0; i < wfSize; ++i) {\n    const value = waveform[i] || 0;\n    if((sumI + barCount) >= wfSize) { // draw bar\n      sumI = sumI + barCount - wfSize;\n      if(sumI < (barCount + 1) / 2) {\n        if(maxValue < value) maxValue = value;\n      }\n\n      const bar_value = Math.max(((maxValue * maxDelta) + ((normValue + 1) / 2)) / (normValue + 1), barHeightMin);\n\n      const h = `\n      <rect x=\"${barX}\" y=\"${barHeightMax - bar_value}\" width=\"${barWidth}\" height=\"${bar_value}\" rx=\"1\" ry=\"1\"></rect>\n      `;\n      html += h;\n\n      barX += barWidth + barMargin;\n\n      if(sumI < (barCount + 1) / 2) {\n        maxValue = 0;\n      } else {\n        maxValue = value;\n      }\n    } else {\n      if(maxValue < value) maxValue = value;\n\n      sumI += barCount;\n    }\n  }\n\n  const container = document.createElement('div');\n  container.classList.add('audio-waveform');\n  container.append(svg);\n\n  svg.insertAdjacentHTML('beforeend', html);\n  return {svg, container, availW};\n}\n\nasync function wrapVoiceMessage(audioEl: AudioElement) {\n  audioEl.classList.add('is-voice');\n\n  const message = audioEl.message;\n  const doc = getMediaFromMessage(message) as MyDocument;\n\n  if(message.pFlags.out) {\n    audioEl.classList.add('is-out');\n  }\n\n  let waveform = (doc.attributes.find((attribute) => attribute._ === 'documentAttributeAudio') as DocumentAttribute.documentAttributeAudio).waveform || new Uint8Array([]);\n  waveform = decodeWaveform(waveform.slice(0, 63));\n\n  const {svg, container: svgContainer, availW} = createWaveformBars(waveform, doc.duration);\n\n  const fakeSvgContainer = svgContainer.cloneNode(true) as HTMLElement;\n  fakeSvgContainer.classList.add('audio-waveform-fake');\n  svgContainer.classList.add('audio-waveform-background');\n\n  const waveformContainer = document.createElement('div');\n  waveformContainer.classList.add('audio-waveform-container');\n  waveformContainer.append(svgContainer, fakeSvgContainer);\n\n  const timeDiv = document.createElement('div');\n  timeDiv.classList.add('audio-time');\n  audioEl.append(waveformContainer, timeDiv);\n\n  let progress = svg as any as HTMLElement;\n\n  const onLoad = () => {\n    let audio = audioEl.audio;\n\n    const setAnimation = () => {\n      animateSingle(() => {\n        if(!audio) return false;\n        onTimeUpdate();\n        return !audio.paused;\n      }, audioEl);\n    };\n\n    const onTimeUpdate = () => {\n      fakeSvgContainer.style.width = (audio.currentTime / audio.duration * 100) + '%';\n    };\n\n    if(!audio.paused || (audio.currentTime > 0 && audio.currentTime !== audio.duration)) {\n      onTimeUpdate();\n    }\n\n    const throttledTimeUpdate = throttleWithRaf(onTimeUpdate);\n    audioEl.addAudioListener('timeupdate', throttledTimeUpdate);\n    audioEl.addAudioListener('ended', throttledTimeUpdate);\n    audioEl.addAudioListener('play', setAnimation);\n\n    audioEl.readyPromise.then(() => {\n      let mousedown = false, mousemove = false;\n      progress.addEventListener('mouseleave', (e) => {\n        if(mousedown) {\n          audio.play();\n          mousedown = false;\n        }\n        mousemove = false;\n      })\n      progress.addEventListener('mousemove', (e) => {\n        mousemove = true;\n        if(mousedown) scrub(e);\n      });\n      progress.addEventListener('mousedown', (e) => {\n        e.preventDefault();\n        if(e.button !== 0) return;\n        if(!audio.paused) {\n          audio.pause();\n        }\n\n        scrub(e);\n        mousedown = true;\n      });\n      progress.addEventListener('mouseup', (e) => {\n        if(mousemove && mousedown) {\n          audio.play();\n          mousedown = false;\n        }\n      });\n      attachClickEvent(progress, (e) => {\n        cancelEvent(e);\n        if(!audio.paused) scrub(e);\n      });\n\n      function scrub(e: MouseEvent | TouchEvent) {\n        let offsetX: number;\n        if(e instanceof MouseEvent) {\n          offsetX = e.offsetX;\n        } else { // touch\n          const rect = (e.target as HTMLElement).getBoundingClientRect();\n          offsetX = e.targetTouches[0].pageX - rect.left;\n        }\n\n        const scrubTime = offsetX / availW /* width */ * audio.duration;\n        audio.currentTime = scrubTime;\n      }\n    }, noop);\n\n    return () => {\n      progress.remove();\n      progress = null;\n      audio = null;\n    };\n  };\n\n  return onLoad;\n}\n\nasync function wrapAudio(audioEl: AudioElement) {\n  const withTime = audioEl.withTime;\n\n  const message = audioEl.message;\n  const doc = getMediaFromMessage(message) as MyDocument;\n\n  const isVoice = doc.type === 'voice' || doc.type === 'round';\n  const descriptionEl = document.createElement('div');\n  descriptionEl.classList.add('audio-description');\n\n  const audioAttribute = doc.attributes.find((attr) => attr._ === 'documentAttributeAudio') as DocumentAttribute.documentAttributeAudio;\n\n  if(!isVoice) {\n    const parts: (Node | string)[] = [];\n    if(audioAttribute?.performer) {\n      parts.push(wrapEmojiText(audioAttribute.performer));\n    }\n\n    if(withTime) {\n      parts.push(formatFullSentTime(message.date));\n    } else if(!parts.length) {\n      parts.push(formatBytes(doc.size));\n    }\n\n    if(audioEl.showSender) {\n      parts.push(await wrapSenderToPeer(message));\n    }\n\n    descriptionEl.append(...joinElementsWith(parts, '  '));\n  }\n\n  const html = `\n  <div class=\"audio-details\">\n    <div class=\"audio-title\"></div>\n    <div class=\"audio-subtitle\"><div class=\"audio-time\"></div></div>\n  </div>`;\n  audioEl.insertAdjacentHTML('beforeend', html);\n\n  const titleEl = audioEl.querySelector('.audio-title') as HTMLElement;\n\n  const middleEllipsisEl = new MiddleEllipsisElement();\n  middleEllipsisEl.dataset.fontWeight = audioEl.dataset.fontWeight;\n  middleEllipsisEl.dataset.sizeType = audioEl.dataset.sizeType;\n  if(isVoice) {\n    middleEllipsisEl.append(await wrapSenderToPeer(message));\n  } else {\n    setInnerHTML(middleEllipsisEl, wrapEmojiText(audioAttribute?.title ?? doc.file_name));\n  }\n\n  titleEl.append(middleEllipsisEl);\n\n  if(audioEl.showSender) {\n    titleEl.append(wrapSentTime(message));\n  }\n\n  const subtitleDiv = audioEl.querySelector('.audio-subtitle') as HTMLDivElement;\n  subtitleDiv.append(descriptionEl);\n\n  const onLoad = () => {\n    let launched = false;\n\n    let progressLine = new MediaProgressLine(audioEl.audio, doc.supportsStreaming);\n\n    audioEl.addAudioListener('ended', () => {\n      audioEl.classList.remove('audio-show-progress');\n      // Reset subtitle\n      subtitleDiv.lastChild.replaceWith(descriptionEl);\n      launched = false;\n    });\n\n    const onPlay = () => {\n      if(!launched) {\n        audioEl.classList.add('audio-show-progress');\n        launched = true;\n\n        if(progressLine) {\n          subtitleDiv.lastChild.replaceWith(progressLine.container);\n        }\n      }\n    };\n\n    audioEl.addAudioListener('play', onPlay);\n\n    if(!audioEl.audio.paused || audioEl.audio.currentTime > 0) {\n      onPlay();\n    }\n\n    return () => {\n      progressLine.removeListeners();\n      progressLine.container.remove();\n      progressLine = null;\n    };\n  };\n\n  return onLoad;\n}\n\nfunction constructDownloadPreloader(tryAgainOnFail = true) {\n  const preloader = new ProgressivePreloader({cancelable: true, tryAgainOnFail});\n  preloader.construct();\n\n  if(!tryAgainOnFail) {\n    preloader.circle.setAttributeNS(null, 'r', '23');\n    preloader.totalLength = 143.58203125;\n  }\n\n  return preloader;\n}\n\nexport const findMediaTargets = (anchor: HTMLElement, anchorMid: number/* , useSearch: boolean */) => {\n  let prev: MediaItem[], next: MediaItem[];\n  // if(anchor.classList.contains('search-super-item') || !useSearch) {\n  const isBubbles = !anchor.classList.contains('search-super-item');\n  const container = findUpClassName(anchor, !isBubbles ? 'tabs-tab' : 'bubbles-inner');\n  if(container) {\n    const attr = `:not([data-is-outgoing=\"1\"])`;\n    const justAudioSelector = `.audio:not(.is-voice)${attr}`;\n    let selectors: string[];\n    if(!anchor.matches(justAudioSelector)) {\n      selectors = [`.audio.is-voice${attr}`, `.media-round${attr}`];\n    } else {\n      selectors = [justAudioSelector];\n    }\n\n    if(isBubbles) {\n      const prefix = '.bubble:not(.webpage) ';\n      selectors = selectors.map((s) => prefix + s);\n    }\n\n    const selector = selectors.join(', ');\n\n    const elements = Array.from(container.querySelectorAll(selector)) as HTMLElement[];\n    const idx = elements.indexOf(anchor);\n\n    const mediaItems: MediaItem[] = elements.map((element) => ({peerId: element.dataset.peerId.toPeerId(), mid: +element.dataset.mid}));\n\n    prev = mediaItems.slice(0, idx);\n    next = mediaItems.slice(idx + 1);\n  }\n  // }\n\n  if((next.length && next[0].mid < anchorMid) || (prev.length && prev[prev.length - 1].mid > anchorMid)) {\n    [prev, next] = [next.reverse(), prev.reverse()];\n  }\n\n  // prev = next = undefined;\n\n  return [prev, next];\n};\n\nexport default class AudioElement extends HTMLElement {\n  public audio: HTMLAudioElement;\n  public preloader: ProgressivePreloader;\n  public message: Message.message;\n  public withTime = false;\n  public voiceAsMusic = false;\n  public searchContext: MediaSearchContext;\n  public showSender = false;\n  public noAutoDownload: boolean;\n  public lazyLoadQueue: LazyLoadQueue;\n  public loadPromises: Promise<any>[];\n  public managers: AppManagers;\n\n  private listenerSetter = new ListenerSetter();\n  private onTypeDisconnect: () => void;\n  public onLoad: (autoload?: boolean) => void;\n  public readyPromise: CancellablePromise<void>;\n\n  public async render() {\n    this.classList.add('audio');\n    this.managers = rootScope.managers;\n\n    this.dataset.mid = '' + this.message.mid;\n    this.dataset.peerId = '' + this.message.peerId;\n\n    const doc = getMediaFromMessage(this.message) as MyDocument;\n    const isRealVoice = doc.type === 'voice';\n    const isVoice = !this.voiceAsMusic && isRealVoice;\n    const isOutgoing = this.message.pFlags.is_outgoing;\n    const uploadingFileName = this.message?.uploadingFileName;\n\n    const durationStr = toHHMMSS(doc.duration | 0);\n\n    this.innerHTML = `\n    <div class=\"audio-toggle audio-ico\">\n      <div class=\"audio-play-icon\">\n        <div class=\"part one\" x=\"0\" y=\"0\" fill=\"#fff\"></div>\n        <div class=\"part two\" x=\"0\" y=\"0\" fill=\"#fff\"></div>\n      </div>\n    </div>`;\n\n    const toggle = this.firstElementChild as HTMLElement;\n\n    const downloadDiv = document.createElement('div');\n    downloadDiv.classList.add('audio-download');\n\n    const isUnread = doc.type !== 'audio' && this.message && this.message.pFlags.media_unread;\n    if(isUnread) {\n      this.classList.add('is-unread');\n    }\n\n    if(uploadingFileName) {\n      this.classList.add('is-outgoing');\n      this.append(downloadDiv);\n    }\n\n    const onTypeLoad = await (isVoice ? wrapVoiceMessage(this) : wrapAudio(this));\n\n    const audioTimeDiv = this.querySelector('.audio-time') as HTMLDivElement;\n    audioTimeDiv.innerHTML = durationStr;\n\n    const onLoad = this.onLoad = (autoload: boolean) => {\n      this.onLoad = undefined;\n\n      const audio = this.audio = appMediaPlaybackController.addMedia(this.message, autoload);\n\n      const readyPromise = this.readyPromise = deferredPromise<void>();\n      if(this.audio.readyState >= this.audio.HAVE_CURRENT_DATA) readyPromise.resolve();\n      else {\n        this.addAudioListener('canplay', () => readyPromise.resolve(), {once: true});\n      }\n\n      this.onTypeDisconnect = onTypeLoad();\n\n      const getTimeStr = () => toHHMMSS(audio.currentTime | 0) + (isVoice ? (' / ' + durationStr) : '');\n\n      const onPlay = () => {\n        audioTimeDiv.innerText = getTimeStr();\n        toggle.classList.toggle('playing', !audio.paused);\n      };\n\n      if(!audio.paused || (audio.currentTime > 0 && audio.currentTime !== audio.duration)) {\n        onPlay();\n      }\n\n      const togglePlay = (e?: Event, paused = audio.paused) => {\n        e && cancelEvent(e);\n\n        if(paused) {\n          const hadSearchContext = !!this.searchContext;\n          if(appMediaPlaybackController.setSearchContext(this.searchContext || {\n            peerId: NULL_PEER_ID,\n            inputFilter: {_: 'inputMessagesFilterEmpty'},\n            useSearch: false\n          })) {\n            const [prev, next] = !hadSearchContext ? [] : findMediaTargets(this, this.message.mid/* , this.searchContext.useSearch */);\n            appMediaPlaybackController.setTargets({peerId: this.message.peerId, mid: this.message.mid}, prev, next);\n          }\n\n          audio.play().catch(() => {});\n        } else {\n          audio.pause();\n        }\n      };\n\n      attachClickEvent(toggle, (e) => togglePlay(e), {listenerSetter: this.listenerSetter});\n\n      this.addAudioListener('ended', () => {\n        toggle.classList.remove('playing');\n        audioTimeDiv.innerText = durationStr;\n      });\n\n      this.addAudioListener('timeupdate', () => {\n        if((!audio.currentTime && audio.paused) || appMediaPlaybackController.isSafariBuffering(audio)) return;\n        audioTimeDiv.innerText = getTimeStr();\n      });\n\n      this.addAudioListener('pause', () => {\n        toggle.classList.remove('playing');\n      });\n\n      this.addAudioListener('play', onPlay);\n\n      return togglePlay;\n    };\n\n    if(doc.thumbs?.length) {\n      const imgs: HTMLElement[] = [];\n      const wrapped = await wrapPhoto({\n        photo: doc,\n        message: null,\n        container: toggle,\n        boxWidth: 48,\n        boxHeight: 48,\n        loadPromises: this.loadPromises,\n        withoutPreloader: true,\n        lazyLoadQueue: this.lazyLoadQueue\n      });\n      toggle.style.width = toggle.style.height = '';\n      if(wrapped.images.thumb) imgs.push(wrapped.images.thumb);\n      if(wrapped.images.full) imgs.push(wrapped.images.full);\n\n      this.classList.add('audio-with-thumb');\n      imgs.forEach((img) => img.classList.add('audio-thumb'));\n    }\n\n    if(!isOutgoing) {\n      let preloader: ProgressivePreloader = this.preloader;\n\n      const autoDownload = doc.type !== 'audio'/*  || !this.noAutoDownload */;\n      onLoad(autoDownload);\n\n      const r = (shouldPlay: boolean) => {\n        if(this.audio.src) {\n          return;\n        }\n\n        appMediaPlaybackController.resolveWaitingForLoadMedia(this.message.peerId, this.message.mid, this.message.pFlags.is_scheduled);\n\n        const onDownloadInit = () => {\n          if(shouldPlay) {\n            appMediaPlaybackController.willBePlayed(this.audio); // prepare for loading audio\n\n            if(IS_SAFARI && !this.audio.autoplay) {\n              this.audio.autoplay = true;\n            }\n          }\n        };\n\n        onDownloadInit();\n\n        if(!preloader) {\n          if(doc.supportsStreaming) {\n            this.classList.add('corner-download');\n\n            let pauseListener: Listener;\n            const onPlay = () => {\n              const preloader = constructDownloadPreloader(false);\n              const deferred = deferredPromise<void>();\n              deferred.notifyAll({done: 75, total: 100});\n              deferred.catch(() => {\n                this.audio.pause();\n                appMediaPlaybackController.willBePlayed(undefined);\n              });\n              deferred.cancel = () => {\n                deferred.cancel = noop;\n                const err = new Error();\n                (err as any).type = 'CANCELED';\n                deferred.reject(err);\n              };\n              preloader.attach(downloadDiv, false, deferred);\n\n              pauseListener = this.addAudioListener('pause', () => {\n                deferred.cancel();\n              }, {once: true}) as any;\n\n              onDownloadInit();\n            };\n\n            /* if(!this.audio.paused) {\n              onPlay();\n            } */\n\n            const playListener: any = this.addAudioListener('play', onPlay);\n            this.readyPromise.then(() => {\n              this.listenerSetter.remove(playListener);\n              this.listenerSetter.remove(pauseListener);\n            });\n          } else {\n            preloader = constructDownloadPreloader();\n\n            if(!shouldPlay) {\n              this.readyPromise = deferredPromise();\n            }\n\n            const load = () => {\n              onDownloadInit();\n\n              const download = appDownloadManager.downloadMediaURL({media: doc});\n\n              if(!shouldPlay) {\n                download.then(() => {\n                  this.readyPromise.resolve();\n                });\n              }\n\n              preloader.attach(downloadDiv, false, download);\n              return {download};\n            };\n\n            preloader.setDownloadFunction(load);\n            load();\n          }\n        }\n\n        if(this.classList.contains('corner-download')) {\n          toggle.append(downloadDiv);\n        } else {\n          this.append(downloadDiv);\n        }\n\n        this.classList.add('downloading');\n\n        this.readyPromise.then(() => {\n          this.classList.remove('downloading');\n          downloadDiv.classList.add('downloaded');\n          setTimeout(() => {\n            downloadDiv.remove();\n          }, 200);\n\n          // setTimeout(() => {\n          // release loaded audio\n          if(appMediaPlaybackController.willBePlayedMedia === this.audio) {\n            this.audio.play();\n            appMediaPlaybackController.willBePlayed(undefined);\n          }\n          // }, 10e3);\n        });\n      };\n\n      if(!this.audio?.src) {\n        if(autoDownload) {\n          r(false);\n        } else {\n          attachClickEvent(toggle, () => {\n            r(true);\n          }, {once: true, capture: true, passive: false, listenerSetter: this.listenerSetter});\n        }\n      }\n    } else if(uploadingFileName) {\n      this.preloader = constructDownloadPreloader(false);\n      this.preloader.attachPromise(appDownloadManager.getUpload(uploadingFileName));\n      this.dataset.isOutgoing = '1';\n      this.preloader.attach(downloadDiv, false);\n      // onLoad();\n    }\n  }\n\n  get addAudioListener() {\n    return this.listenerSetter.add(this.audio);\n  }\n\n  disconnectedCallback() {\n    setTimeout(() => {\n      if(this.isConnected) {\n        return;\n      }\n\n      if(this.onTypeDisconnect) {\n        this.onTypeDisconnect();\n        this.onTypeDisconnect = null;\n      }\n\n      if(this.readyPromise) {\n        this.readyPromise.reject();\n      }\n\n      if(this.listenerSetter) {\n        this.listenerSetter.removeAll();\n        this.listenerSetter = null;\n      }\n\n      if(this.preloader) {\n        this.preloader = null;\n      }\n    }, 100);\n  }\n}\n\ncustomElements.define('audio-element', AudioElement);\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport {Photo} from '../layer';\nimport {AppManagers} from '../lib/appManagers/managers';\nimport ListLoader, {ListLoaderOptions} from './listLoader';\n\nexport default class AvatarListLoader<Item extends {photoId: Photo.photo['id']}> extends ListLoader<Item, any> {\n  private peerId: PeerId;\n  private managers: AppManagers;\n\n  constructor(options: Omit<ListLoaderOptions<Item, any>, 'loadMore'> & {peerId: PeerId, managers: AppManagers}) {\n    super({\n      ...options,\n      loadMore: (anchor, older, loadCount) => {\n        if(this.peerId.isAnyChat() || !older) return Promise.resolve({count: 0, items: []}); // !  ,    ,    .\n\n        const maxId = anchor?.photoId;\n        return this.managers.appPhotosManager.getUserPhotos(this.peerId, maxId, loadCount).then((value) => {\n          const items = value.photos.map((photoId) => {\n            return {element: null as HTMLElement, photoId} as any;\n          });\n\n          return {count: value.count, items};\n        });\n      }\n    });\n\n    this.loadedAllUp = true;\n    this.peerId = options.peerId;\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport AvatarListLoader from '../helpers/avatarListLoader';\nimport {Photo} from '../layer';\nimport appDownloadManager from '../lib/appManagers/appDownloadManager';\nimport appImManager from '../lib/appManagers/appImManager';\nimport rootScope from '../lib/rootScope';\nimport AppMediaViewerBase from './appMediaViewerBase';\n\ntype AppMediaViewerAvatarTargetType = {element: HTMLElement, photoId: Photo.photo['id']};\nexport default class AppMediaViewerAvatar extends AppMediaViewerBase<'', 'delete', AppMediaViewerAvatarTargetType> {\n  public peerId: PeerId;\n\n  constructor(peerId: PeerId) {\n    super(new AvatarListLoader({peerId, managers: rootScope.managers}), [/* 'delete' */]);\n\n    this.peerId = peerId;\n\n    this.setBtnMenuToggle([{\n      icon: 'download',\n      text: 'MediaViewer.Context.Download',\n      onClick: this.onDownloadClick\n    }/* , {\n      icon: 'delete danger btn-disabled',\n      text: 'Delete',\n      onClick: () => {}\n    } */]);\n\n    // * constructing html end\n\n    this.setListeners();\n  }\n\n  onPrevClick = (target: AppMediaViewerAvatarTargetType) => {\n    this.openMedia(target.photoId, target.element, -1);\n  };\n\n  onNextClick = (target: AppMediaViewerAvatarTargetType) => {\n    this.openMedia(target.photoId, target.element, 1);\n  };\n\n  onDownloadClick = async() => {\n    appDownloadManager.downloadToDisc({\n      media: await this.managers.appPhotosManager.getPhoto(this.target.photoId),\n      queueId: appImManager.chat.bubbles.lazyLoadQueue.queueId\n    });\n  };\n\n  public async openMedia(photoId: Photo.photo['id'], target?: HTMLElement, fromRight = 0, prevTargets?: AppMediaViewerAvatarTargetType[], nextTargets?: AppMediaViewerAvatarTargetType[]) {\n    if(this.setMoverPromise) return this.setMoverPromise;\n\n    const photo = await this.managers.appPhotosManager.getPhoto(photoId);\n    const ret = super._openMedia(photo, photo.date, this.peerId, fromRight, target, false, prevTargets, nextTargets);\n    this.target.photoId = photo.id;\n\n    return ret;\n  }\n}\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport rootScope from '../lib/rootScope';\r\nimport {Message, Photo} from '../layer';\r\nimport type LazyLoadQueue from './lazyLoadQueue';\r\nimport {attachClickEvent} from '../helpers/dom/clickEvent';\r\nimport cancelEvent from '../helpers/dom/cancelEvent';\r\nimport AppMediaViewer from './appMediaViewer';\r\nimport AppMediaViewerAvatar from './appMediaViewerAvatar';\r\nimport isObject from '../helpers/object/isObject';\r\nimport {ArgumentTypes} from '../types';\r\nimport putPhoto from './putPhoto';\r\nimport {recordPromise} from '../helpers/recordPromise';\r\n\r\nconst onAvatarUpdate = (peerId: PeerId) => {\r\n  (Array.from(document.querySelectorAll('avatar-element[data-peer-id=\"' + peerId + '\"]')) as AvatarElement[]).forEach((elem) => {\r\n    // console.log('updating avatar:', elem);\r\n    elem.update();\r\n  });\r\n};\r\n\r\nrootScope.addEventListener('avatar_update', onAvatarUpdate);\r\nrootScope.addEventListener('peer_title_edit', async(peerId) => {\r\n  if(!(await rootScope.managers.appAvatarsManager.isAvatarCached(peerId))) {\r\n    onAvatarUpdate(peerId);\r\n  }\r\n});\r\n\r\nexport async function openAvatarViewer(\r\n  target: HTMLElement,\r\n  peerId: PeerId,\r\n  middleware: () => boolean,\r\n  message?: any,\r\n  prevTargets?: {element: HTMLElement, item: Photo.photo['id'] | Message.messageService}[],\r\n  nextTargets?: typeof prevTargets\r\n) {\r\n  let photo = await rootScope.managers.appProfileManager.getFullPhoto(peerId);\r\n  if(!middleware() || !photo) {\r\n    return;\r\n  }\r\n\r\n  const getTarget = () => {\r\n    const good = Array.from(target.querySelectorAll('img')).find((img) => !img.classList.contains('emoji'));\r\n    return good ? target : null;\r\n  };\r\n\r\n  if(peerId.isAnyChat()) {\r\n    const hadMessage = !!message;\r\n    const inputFilter = 'inputMessagesFilterChatPhotos';\r\n    if(!message) {\r\n      message = await rootScope.managers.appMessagesManager.getSearch({\r\n        peerId,\r\n        inputFilter: {_: inputFilter},\r\n        maxId: 0,\r\n        limit: 1\r\n      }).then((value) => {\r\n        // console.log(lol);\r\n        // ! by descend\r\n        return value.history[0];\r\n      });\r\n\r\n      if(!middleware()) {\r\n        return;\r\n      }\r\n    }\r\n\r\n    if(message) {\r\n      // !   ,  (  )\r\n      const messagePhoto = message.action.photo;\r\n      if(messagePhoto.id !== photo.id) {\r\n        if(!hadMessage) {\r\n          message = rootScope.managers.appMessagesManager.generateFakeAvatarMessage(peerId, photo);\r\n        } else {\r\n\r\n        }\r\n      }\r\n\r\n      const f = (arr: typeof prevTargets) => arr.map((el) => ({\r\n        element: el.element,\r\n        mid: (el.item as Message.messageService).mid,\r\n        peerId: (el.item as Message.messageService).peerId\r\n      }));\r\n\r\n      new AppMediaViewer()\r\n      .setSearchContext({\r\n        peerId,\r\n        inputFilter: {_: inputFilter}\r\n      })\r\n      .openMedia(message, getTarget(), undefined, undefined, prevTargets ? f(prevTargets) : undefined, nextTargets ? f(nextTargets) : undefined);\r\n\r\n      return;\r\n    }\r\n  }\r\n\r\n  if(photo) {\r\n    if(!isObject(message) && message) {\r\n      photo = await rootScope.managers.appPhotosManager.getPhoto(message);\r\n    }\r\n\r\n    const f = (arr: typeof prevTargets) => arr.map((el) => ({\r\n      element: el.element,\r\n      photoId: el.item as string\r\n    }));\r\n\r\n    new AppMediaViewerAvatar(peerId).openMedia(\r\n      photo.id,\r\n      getTarget(),\r\n      undefined,\r\n      prevTargets ? f(prevTargets) : undefined,\r\n      nextTargets ? f(nextTargets) : undefined\r\n    );\r\n  }\r\n}\r\n\r\nconst believeMe: Map<PeerId, Set<AvatarElement>> = new Map();\r\nconst seen: Set<PeerId> = new Set();\r\n\r\nexport default class AvatarElement extends HTMLElement {\r\n  public peerId: PeerId;\r\n  public isDialog: boolean;\r\n  public peerTitle: string;\r\n  public loadPromises: Promise<any>[];\r\n  public lazyLoadQueue: LazyLoadQueue;\r\n  public isBig: boolean;\r\n  private addedToQueue = false;\r\n\r\n  disconnectedCallback() {\r\n    //         \r\n    // (   ,    /)\r\n    const set = believeMe.get(this.peerId);\r\n    if(set && set.has(this)) {\r\n      set.delete(this);\r\n      if(!set.size) {\r\n        believeMe.delete(this.peerId);\r\n      }\r\n    }\r\n\r\n    if(this.lazyLoadQueue) {\r\n      this.lazyLoadQueue.unobserve(this);\r\n    }\r\n  }\r\n\r\n  public attachClickEvent() {\r\n    let loading = false;\r\n    attachClickEvent(this, async(e) => {\r\n      cancelEvent(e);\r\n      if(loading) return;\r\n      // console.log('avatar clicked');\r\n      const peerId = this.peerId;\r\n      loading = true;\r\n      await openAvatarViewer(this, this.peerId, () => this.peerId === peerId);\r\n      loading = false;\r\n    });\r\n  }\r\n\r\n  public updateOptions(options: Partial<ArgumentTypes<AvatarElement['updateWithOptions']>[0]>) {\r\n    for(const i in options) {\r\n      // @ts-ignore\r\n      this[i] = options[i];\r\n    }\r\n  }\r\n\r\n  public updateWithOptions(options: {\r\n    peerId: PeerId,\r\n    isDialog?: boolean,\r\n    isBig?: boolean,\r\n    peerTitle?: string,\r\n    lazyLoadQueue?: LazyLoadQueue,\r\n    loadPromises?: Promise<any>[]\r\n  }) {\r\n    const wasPeerId = this.peerId;\r\n    this.updateOptions(options);\r\n    const newPeerId = this.peerId;\r\n\r\n    if(wasPeerId === newPeerId) {\r\n      return;\r\n    }\r\n\r\n    this.peerId = /* rootScope.managers.appPeersManager.getPeerMigratedTo(newPeerId) ||  */newPeerId;\r\n    this.dataset.peerId = '' + newPeerId;\r\n\r\n    if(wasPeerId) {\r\n      const set = believeMe.get(wasPeerId);\r\n      if(set) {\r\n        set.delete(this);\r\n        if(!set.size) {\r\n          believeMe.delete(wasPeerId);\r\n        }\r\n      }\r\n    }\r\n\r\n    return this.update();\r\n  }\r\n\r\n  private r(onlyThumb = false) {\r\n    const promise = putPhoto(this, this.peerId, this.isDialog, this.peerTitle, onlyThumb, this.isBig);\r\n    // recordPromise(promise, 'avatar putPhoto-' + this.peerId);\r\n\r\n    if(this.loadPromises) {\r\n      this.loadPromises.push(promise);\r\n\r\n      promise.finally(() => {\r\n        this.loadPromises = undefined;\r\n      });\r\n    }\r\n\r\n    return promise;\r\n  }\r\n\r\n  public update() {\r\n    if(this.lazyLoadQueue) {\r\n      if(!seen.has(this.peerId)) {\r\n        if(this.addedToQueue) return;\r\n        this.addedToQueue = true;\r\n\r\n        let set = believeMe.get(this.peerId);\r\n        if(!set) {\r\n          set = new Set();\r\n          believeMe.set(this.peerId, set);\r\n        }\r\n\r\n        set.add(this);\r\n\r\n        this.lazyLoadQueue.push({\r\n          div: this,\r\n          load: () => {\r\n            seen.add(this.peerId);\r\n            return this.update();\r\n          }\r\n        });\r\n\r\n        return this.r(true);\r\n      } else if(this.addedToQueue) {\r\n        this.lazyLoadQueue.unobserve(this);\r\n      }\r\n    }\r\n\r\n    seen.add(this.peerId);\r\n\r\n    const promise = this.r();\r\n\r\n    if(this.addedToQueue) {\r\n      promise.finally(() => {\r\n        this.addedToQueue = false;\r\n      });\r\n    }\r\n\r\n    const set = believeMe.get(this.peerId);\r\n    if(set) {\r\n      set.delete(this);\r\n      const arr = Array.from(set);\r\n      believeMe.delete(this.peerId);\r\n\r\n\r\n      for(let i = 0, length = arr.length; i < length; ++i) {\r\n        arr[i].update();\r\n      }\r\n    }\r\n\r\n    return promise;\r\n  }\r\n}\r\n\r\ncustomElements.define('avatar-element', AvatarElement);\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport type {CancellablePromise} from '../helpers/cancellablePromise';\r\nimport type {InputFile} from '../layer';\r\nimport {attachClickEvent} from '../helpers/dom/clickEvent';\r\nimport PopupElement from './popups';\r\nimport PopupAvatar from './popups/avatar';\r\n\r\nexport default class AvatarEdit {\r\n  public container: HTMLElement;\r\n  private canvas: HTMLCanvasElement;\r\n  private icon: HTMLSpanElement;\r\n\r\n  constructor(onChange: (uploadAvatar: () => CancellablePromise<InputFile>) => void) {\r\n    this.container = document.createElement('div');\r\n    this.container.classList.add('avatar-edit');\r\n\r\n    this.canvas = document.createElement('canvas');\r\n    this.canvas.classList.add('avatar-edit-canvas');\r\n\r\n    this.icon = document.createElement('span');\r\n    this.icon.classList.add('tgico', 'tgico-cameraadd');\r\n\r\n    this.container.append(this.canvas, this.icon);\r\n\r\n    attachClickEvent(this.container, () => {\r\n      PopupElement.createPopup(PopupAvatar).open(this.canvas, onChange);\r\n    });\r\n  }\r\n\r\n  public clear() {\r\n    const ctx = this.canvas.getContext('2d');\r\n    ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);\r\n  }\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport {i18n, LangPackKey} from '../lib/langPack';\r\nimport ripple from './ripple';\r\n\r\nexport type ButtonOptions = Partial<{\r\n  noRipple: true,\r\n  onlyMobile: true,\r\n  icon: string,\r\n  rippleSquare: true,\r\n  text: LangPackKey,\r\n  disabled: boolean,\r\n  asDiv: boolean\r\n}>;\r\n\r\nconst Button = (className: string, options: ButtonOptions = {}) => {\r\n  const button: HTMLButtonElement = document.createElement(options.asDiv ? 'div' : 'button') as any;\r\n  button.className = className + (options.icon ? ' tgico-' + options.icon : '');\r\n\r\n  if(!options.noRipple) {\r\n    if(options.rippleSquare) {\r\n      button.classList.add('rp-square');\r\n    }\r\n\r\n    ripple(button);\r\n  }\r\n\r\n  if(options.onlyMobile) {\r\n    button.classList.add('only-handhelds');\r\n  }\r\n\r\n  if(options.disabled) {\r\n    button.setAttribute('disabled', 'true');\r\n  }\r\n\r\n  if(options.text) {\r\n    button.append(i18n(options.text));\r\n  }\r\n\r\n  return button;\r\n};\r\n\r\nexport default Button;\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport Button from './button';\r\n\r\nconst ButtonCorner = (options: Partial<{className: string, icon: string, noRipple: true, onlyMobile: true, asDiv: boolean}> = {}) => {\r\n  const button = Button('btn-circle btn-corner z-depth-1' + (options.className ? ' ' + options.className : ''), options);\r\n  return button;\r\n};\r\n\r\nexport default ButtonCorner;\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport Button from './button';\r\n\r\nconst ButtonIcon = (className?: string, options: Partial<{noRipple: true, onlyMobile: true, asDiv: boolean}> = {}) => {\r\n  const button = Button('btn-icon', {\r\n    icon: className || undefined,\r\n    ...options\r\n  });\r\n\r\n  return button;\r\n};\r\n\r\nexport default ButtonIcon;\r\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport contextMenuController from '../helpers/contextMenuController';\nimport cancelEvent from '../helpers/dom/cancelEvent';\nimport {AttachClickOptions, attachClickEvent} from '../helpers/dom/clickEvent';\nimport findUpClassName from '../helpers/dom/findUpClassName';\nimport ListenerSetter from '../helpers/listenerSetter';\nimport {FormatterArguments, i18n, LangPackKey} from '../lib/langPack';\nimport CheckboxField from './checkboxField';\n\nexport type ButtonMenuItemOptions = {\n  icon?: string,\n  text?: LangPackKey,\n  textArgs?: FormatterArguments,\n  regularText?: string,\n  onClick: (e: MouseEvent | TouchEvent) => void | boolean | any,\n  element?: HTMLElement,\n  textElement?: HTMLElement,\n  options?: AttachClickOptions,\n  checkboxField?: CheckboxField,\n  noCheckboxClickListener?: boolean,\n  keepOpen?: boolean\n  /* , cancelEvent?: true */\n};\n\nconst ButtonMenuItem = (options: ButtonMenuItemOptions) => {\n  if(options.element) return options.element;\n\n  const {icon, text, onClick, checkboxField, noCheckboxClickListener} = options;\n  const el = document.createElement('div');\n  el.className = 'btn-menu-item rp-overflow' + (icon ? ' tgico-' + icon : '');\n  // ripple(el);\n\n  let textElement = options.textElement;\n  if(!textElement) {\n    textElement = options.textElement = text ? i18n(text, options.textArgs) : document.createElement('span');\n    if(options.regularText) textElement.innerHTML = options.regularText;\n  }\n\n  textElement.classList.add('btn-menu-item-text');\n  el.append(textElement);\n\n  const keepOpen = !!checkboxField || !!options.keepOpen;\n\n  // * cancel mobile keyboard close\n  onClick && attachClickEvent(el, /* CLICK_EVENT_NAME !== 'click' || keepOpen ? */ (e) => {\n    cancelEvent(e);\n\n    const menu = findUpClassName(e.target, 'btn-menu');\n    if(menu && !menu.classList.contains('active')) {\n      return;\n    }\n\n    const result = onClick(e);\n\n    if(result === false) {\n      return;\n    }\n\n    if(!keepOpen) {\n      contextMenuController.close();\n    }\n\n    if(checkboxField && !noCheckboxClickListener/*  && result !== false */) {\n      checkboxField.checked = checkboxField.input.type === 'radio' ? true : !checkboxField.checked;\n    }\n  }/*  : onClick */, options.options);\n\n  if(checkboxField) {\n    el.append(checkboxField.label);\n  }\n\n  return options.element = el;\n};\n\nconst ButtonMenu = (buttons: ButtonMenuItemOptions[], listenerSetter?: ListenerSetter) => {\n  const el = document.createElement('div');\n  el.classList.add('btn-menu');\n\n  if(listenerSetter) {\n    buttons.forEach((b) => {\n      if(b.options) {\n        b.options.listenerSetter = listenerSetter;\n      } else {\n        b.options = {listenerSetter};\n      }\n    });\n  }\n\n  const items = buttons.map(ButtonMenuItem);\n\n  el.append(...items);\n\n  return el;\n};\n\nexport default ButtonMenu;\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport contextMenuController from '../helpers/contextMenuController';\r\nimport cancelEvent from '../helpers/dom/cancelEvent';\r\nimport {AttachClickOptions, CLICK_EVENT_NAME} from '../helpers/dom/clickEvent';\r\nimport ListenerSetter from '../helpers/listenerSetter';\r\nimport ButtonIcon from './buttonIcon';\r\nimport ButtonMenu, {ButtonMenuItemOptions} from './buttonMenu';\r\n\r\nconst ButtonMenuToggle = (\r\n  options: Partial<{\r\n    noRipple: true,\r\n    onlyMobile: true,\r\n    listenerSetter: ListenerSetter,\r\n    asDiv: boolean,\r\n    container: HTMLElement\r\n  }> = {},\r\n  direction: 'bottom-left' | 'bottom-right' | 'top-left' | 'top-right',\r\n  buttons: ButtonMenuItemOptions[],\r\n  onOpen?: (e: Event) => void,\r\n  onClose?: () => void\r\n) => {\r\n  options.asDiv = true;\r\n  const button = options.container ?? ButtonIcon('more', options);\r\n  button.classList.add('btn-menu-toggle');\r\n\r\n  const btnMenu = ButtonMenu(buttons, options.listenerSetter);\r\n  btnMenu.classList.add(direction);\r\n  ButtonMenuToggleHandler(button, onOpen, options, onClose);\r\n  button.append(btnMenu);\r\n  return button;\r\n};\r\n\r\n// TODO: refactor for attachClickEvent, because if move finger after touchstart, it will start anyway\r\nconst ButtonMenuToggleHandler = (el: HTMLElement, onOpen?: (e: Event) => void | Promise<any>, options?: AttachClickOptions, onClose?: () => void) => {\r\n  const add = options?.listenerSetter ? options.listenerSetter.add(el) : el.addEventListener.bind(el);\r\n\r\n  // console.trace('ButtonMenuToggleHandler attach', el, onOpen, options);\r\n  add(CLICK_EVENT_NAME, (e: Event) => {\r\n    // console.log('ButtonMenuToggleHandler click', e);\r\n    if(!el.classList.contains('btn-menu-toggle')) return false;\r\n\r\n    // window.removeEventListener('mousemove', onMouseMove);\r\n    const openedMenu = el.querySelector('.btn-menu') as HTMLDivElement;\r\n    cancelEvent(e);\r\n\r\n    if(el.classList.contains('menu-open')) {\r\n      contextMenuController.close();\r\n    } else {\r\n      const result = onOpen && onOpen(e);\r\n      const open = () => {\r\n        contextMenuController.openBtnMenu(openedMenu, onClose);\r\n      };\r\n\r\n      if(result instanceof Promise) {\r\n        result.then(open);\r\n      } else {\r\n        open();\r\n      }\r\n    }\r\n  });\r\n};\r\n\r\nexport {ButtonMenuToggleHandler};\r\nexport default ButtonMenuToggle;\r\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko, Artem Kolnogorov and unknown creator of the script taken from http://useless.altervista.org/gradient.html\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport {animateSingle} from '../../helpers/animation';\nimport {hexToRgb} from '../../helpers/color';\nimport {easeOutCubicApply} from '../../helpers/easing/easeOutCubic';\nimport {easeOutQuadApply} from '../../helpers/easing/easeOutQuad';\n\nconst WIDTH = 50;\nconst HEIGHT = WIDTH;\n\nexport default class ChatBackgroundGradientRenderer {\n  private readonly _width = WIDTH;\n  private readonly _height = HEIGHT;\n  private _phase: number;\n  private _tail: number;\n  private readonly _tails = 90;\n  private readonly _scrollTails = 50;\n  private _frames: ImageData[];\n  private _colors: {r: number, g: number, b: number}[];\n  private readonly _curve = [\n    0, 0.25, 0.50, 0.75, 1, 1.5, 2, 2.5, 3, 3.5, 4, 5, 6, 7, 8, 9, 10, 11, 12,\n    13, 14, 15, 16, 17, 18, 18.3, 18.6, 18.9, 19.2, 19.5, 19.8, 20.1, 20.4, 20.7,\n    21.0, 21.3, 21.6, 21.9, 22.2, 22.5, 22.8, 23.1, 23.4, 23.7, 24.0, 24.3, 24.6,\n    24.9, 25.2, 25.5, 25.8, 26.1, 26.3, 26.4, 26.5, 26.6, 26.7, 26.8, 26.9, 27\n  ];\n  private readonly _incrementalCurve: number[];\n  private readonly _positions = [\n    {x: 0.80, y: 0.10},\n    {x: 0.60, y: 0.20},\n    {x: 0.35, y: 0.25},\n    {x: 0.25, y: 0.60},\n    {x: 0.20, y: 0.90},\n    {x: 0.40, y: 0.80},\n    {x: 0.65, y: 0.75},\n    {x: 0.75, y: 0.40}\n  ];\n  private readonly _phases = this._positions.length;\n  private _onWheelRAF: number;\n  private _scrollDelta: number;\n\n  // private _ts = 0;\n  // private _fps = 15;\n  // private _frametime = 1000 / this._fps;\n  // private _raf: number;\n\n  private _canvas: HTMLCanvasElement;\n  private _ctx: CanvasRenderingContext2D;\n  private _hc: HTMLCanvasElement;\n  private _hctx: CanvasRenderingContext2D;\n\n  private _addedScrollListener: boolean;\n  private _animatingToNextPosition: boolean;\n  private _nextPositionTail: number;\n  private _nextPositionTails: number;\n  private _nextPositionLeft: number;\n\n  constructor() {\n    const diff = this._tails / this._curve[this._curve.length - 1];\n\n    for(let i = 0, length = this._curve.length; i < length; ++i) {\n      this._curve[i] = this._curve[i] * diff;\n    }\n\n    this._incrementalCurve = this._curve.map((v, i, arr) => {\n      return v - (arr[i - 1] ?? 0);\n    });\n  }\n\n  private hexToRgb(hex: string) {\n    const result = hexToRgb(hex);\n    return {r: result[0], g: result[1], b: result[2]};\n  }\n\n  private getPositions(shift: number) {\n    const positions = this._positions.slice();\n    positions.push(...positions.splice(0, shift));\n\n    const result: typeof positions = [];\n    for(let i = 0; i < positions.length; i += 2) {\n      result.push(positions[i]);\n    }\n    return result;\n  }\n\n  private getNextPositions(phase: number, curveMax: number, curve: number[]) {\n    const pos = this.getPositions(phase);\n    if(!curve[0] && curve.length === 1) {\n      return [pos];\n    }\n\n    const nextPos = this.getPositions(++phase % this._phases);\n    const distances = nextPos.map((nextPos, idx) => {\n      return {\n        x: (nextPos.x - pos[idx].x) / curveMax,\n        y: (nextPos.y - pos[idx].y) / curveMax\n      };\n    });\n\n    const positions = curve.map((value) => {\n      return distances.map((distance, idx) => {\n        return {\n          x: pos[idx].x + distance.x * value,\n          y: pos[idx].y + distance.y * value\n        };\n      });\n    });\n\n    return positions;\n  }\n\n  private curPosition(phase: number, tail: number) {\n    const positions = this.getNextPositions(phase, this._tails, [tail]);\n    return positions[0];\n  }\n\n  private changeTail(diff: number) {\n    this._tail += diff;\n\n    while(this._tail >= this._tails) {\n      this._tail -= this._tails;\n      if(++this._phase >= this._phases) {\n        this._phase -= this._phases;\n      }\n    }\n\n    while(this._tail < 0) {\n      this._tail += this._tails;\n      if(--this._phase < 0) {\n        this._phase += this._phases;\n      }\n    }\n  }\n\n  private onWheel = (e: {deltaY: number}) => {\n    if(this._animatingToNextPosition) {\n      return;\n    }\n\n    this._scrollDelta += e.deltaY;\n    if(this._onWheelRAF === undefined) {\n      this._onWheelRAF = requestAnimationFrame(this.drawOnWheel);\n    }\n  };\n\n  private changeTailAndDraw(diff: number) {\n    this.changeTail(diff);\n    const curPos = this.curPosition(this._phase, this._tail);\n    this.drawGradient(curPos);\n  }\n\n  private drawOnWheel = () => {\n    const value = this._scrollDelta / this._scrollTails;\n    this._scrollDelta %= this._scrollTails;\n    const diff = value > 0 ? Math.floor(value) : Math.ceil(value);\n    if(diff) {\n      this.changeTailAndDraw(diff);\n    }\n    this._onWheelRAF = undefined;\n  };\n\n  private drawNextPositionAnimated = (getProgress?: () => number) => {\n    let done: boolean, id: ImageData;\n    if(getProgress) {\n      const value = getProgress();\n      done = value >= 1;\n      const transitionValue = easeOutQuadApply(value, 1);\n      const nextPositionTail = this._nextPositionTail ?? 0;\n      const tail = this._nextPositionTail = this._nextPositionTails * transitionValue;\n      const diff = tail - nextPositionTail;\n      if(diff) {\n        this._nextPositionLeft -= diff;\n        this.changeTailAndDraw(diff);\n      }\n    } else {\n      const frames = this._frames;\n      id = frames.shift();\n      done = !frames.length;\n    }\n\n    if(id) {\n      this.drawImageData(id);\n    }\n\n    if(done) {\n      this._nextPositionLeft = undefined;\n      this._nextPositionTails = undefined;\n      this._nextPositionTail = undefined;\n      this._animatingToNextPosition = undefined;\n    }\n\n    return !done;\n  };\n\n  private getGradientImageData(positions: {x: number, y: number}[]) {\n    const id = this._hctx.createImageData(this._width, this._height);\n    const pixels = id.data;\n\n    let offset = 0;\n    for(let y = 0; y < this._height; ++y) {\n      const directPixelY = y / this._height;\n      const centerDistanceY = directPixelY - 0.5;\n      const centerDistanceY2 = centerDistanceY * centerDistanceY;\n\n      for(let x = 0; x < this._width; ++x) {\n        const directPixelX = x / this._width;\n\n        const centerDistanceX = directPixelX - 0.5;\n        const centerDistance = Math.sqrt(centerDistanceX * centerDistanceX + centerDistanceY2);\n\n        const swirlFactor = 0.35 * centerDistance;\n        const theta = swirlFactor * swirlFactor * 0.8 * 8.0;\n        const sinTheta = Math.sin(theta);\n        const cosTheta = Math.cos(theta);\n\n        const pixelX = Math.max(0.0, Math.min(1.0, 0.5 + centerDistanceX * cosTheta - centerDistanceY * sinTheta));\n        const pixelY = Math.max(0.0, Math.min(1.0, 0.5 + centerDistanceX * sinTheta + centerDistanceY * cosTheta));\n\n        let distanceSum = 0.0;\n\n        let r = 0.0;\n        let g = 0.0;\n        let b = 0.0;\n\n        for(let i = 0; i < this._colors.length; i++) {\n          const colorX = positions[i].x;\n          const colorY = positions[i].y;\n\n          const distanceX = pixelX - colorX;\n          const distanceY = pixelY - colorY;\n\n          let distance = Math.max(0.0, 0.9 - Math.sqrt(distanceX * distanceX + distanceY * distanceY));\n          distance = distance * distance * distance * distance;\n          distanceSum += distance;\n\n          r += distance * this._colors[i].r / 255;\n          g += distance * this._colors[i].g / 255;\n          b += distance * this._colors[i].b / 255;\n        }\n\n        pixels[offset++] = r / distanceSum * 255.0;\n        pixels[offset++] = g / distanceSum * 255.0;\n        pixels[offset++] = b / distanceSum * 255.0;\n        pixels[offset++] = 0xFF;\n      }\n    }\n    return id;\n  }\n\n  private drawImageData(id: ImageData) {\n    this._hctx.putImageData(id, 0, 0);\n    this._ctx.drawImage(this._hc, 0, 0, this._width, this._height);\n  }\n\n  private drawGradient(positions: {x: number, y: number}[]) {\n    this.drawImageData(this.getGradientImageData(positions));\n  }\n\n  // private doAnimate = () => {\n  //   const now = +Date.now();\n  //   if(!document.hasFocus() || (now - this._ts) < this._frametime) {\n  //     this._raf = requestAnimationFrame(this.doAnimate);\n  //     return;\n  //   }\n\n  //   this._ts = now;\n  //   this.changeTail(1);\n  //   const cur_pos = this.curPosition(this._phase, this._tail);\n  //   this.drawGradient(cur_pos);\n  //   this._raf = requestAnimationFrame(this.doAnimate);\n  // };\n\n  // public animate(start?: boolean) {\n  //   if(!start) {\n  //     cancelAnimationFrame(this._raf);\n  //     return;\n  //   }\n  //   this.doAnimate();\n  // }\n\n  public init(el: HTMLCanvasElement) {\n    this._frames = [];\n    this._phase = 0;\n    this._tail = 0;\n    this._scrollDelta = 0;\n    if(this._onWheelRAF !== undefined) {\n      cancelAnimationFrame(this._onWheelRAF);\n      this._onWheelRAF = undefined;\n    }\n\n    const colors = el.getAttribute('data-colors').split(',').reverse();\n    this._colors = colors.map((color) => {\n      return this.hexToRgb(color);\n    });\n\n    if(!this._hc) {\n      this._hc = document.createElement('canvas');\n      this._hc.width = this._width;\n      this._hc.height = this._height;\n      this._hctx = this._hc.getContext('2d', {alpha: false});\n    }\n\n    this._canvas = el;\n    this._ctx = this._canvas.getContext('2d', {alpha: false});\n    this.update();\n  }\n\n  public update() {\n    if(this._colors.length < 2) {\n      const color = this._colors[0];\n      this._ctx.fillStyle = `rgb(${color.r}, ${color.g}, ${color.b})`;\n      this._ctx.fillRect(0, 0, this._width, this._height);\n      return;\n    }\n\n    const pos = this.curPosition(this._phase, this._tail);\n    this.drawGradient(pos);\n  }\n\n  public toNextPosition(getProgress?: () => number) {\n    if(this._colors.length < 2) {\n      return;\n    }\n\n    if(getProgress) {\n      this._nextPositionLeft = this._tails + (this._nextPositionLeft ?? 0);\n      this._nextPositionTails = this._nextPositionLeft;\n      this._nextPositionTail = undefined;\n      this._animatingToNextPosition = true;\n      animateSingle(this.drawNextPositionAnimated.bind(this, getProgress), this);\n      return;\n    }\n\n    const tail = this._tail;\n    const tails = this._tails;\n\n    let nextPhaseOnIdx: number;\n\n    const curve: number[] = [];\n    for(let i = 0, length = this._incrementalCurve.length; i < length; ++i) {\n      const inc = this._incrementalCurve[i];\n      let value = (curve[i - 1] ?? tail) + inc;\n\n      if(+value.toFixed(2) > tails && nextPhaseOnIdx === undefined) {\n        nextPhaseOnIdx = i;\n        value %= tails;\n      }\n\n      curve.push(value);\n    }\n\n    const currentPhaseCurve = curve.slice(0, nextPhaseOnIdx);\n    const nextPhaseCurve = nextPhaseOnIdx !== undefined ? curve.slice(nextPhaseOnIdx) : [];\n\n    [currentPhaseCurve, nextPhaseCurve].forEach((curve, idx, curves) => {\n      const last = curve[curve.length - 1];\n      if(last !== undefined && last > tails) {\n        curve[curve.length - 1] = +last.toFixed(2);\n      }\n\n      this._tail = last ?? 0;\n\n      if(!curve.length) {\n        return;\n      }\n\n      const positions = this.getNextPositions(this._phase, tails, curve);\n      if(idx !== (curves.length - 1)) {\n        if(++this._phase >= this._phases) {\n          this._phase -= this._phases;\n        }\n      }\n\n      const ids = positions.map((pos) => {\n        return this.getGradientImageData(pos);\n      });\n\n      this._frames.push(...ids);\n    });\n\n    this._animatingToNextPosition = true;\n    animateSingle(this.drawNextPositionAnimated, this);\n  }\n\n  // public toNextPositionThrottled = throttle(this.toNextPosition.bind(this), 100, true);\n\n  public scrollAnimate(start?: boolean) {\n    // return;\n\n    if(this._colors.length < 2 && start) {\n      return;\n    }\n\n    if(start && !this._addedScrollListener) {\n      document.addEventListener('wheel', this.onWheel);\n      this._addedScrollListener = true;\n    } else if(!start && this._addedScrollListener) {\n      document.removeEventListener('wheel', this.onWheel);\n      this._addedScrollListener = false;\n    }\n  }\n\n  public cleanup() {\n    this.scrollAnimate(false);\n    // this.animate(false);\n  }\n\n  public static createCanvas(colors?: string) {\n    const canvas = document.createElement('canvas');\n    canvas.width = WIDTH;\n    canvas.height = HEIGHT;\n    if(colors !== undefined) {\n      canvas.dataset.colors = colors;\n    }\n\n    return canvas;\n  }\n\n  public static create(colors?: string) {\n    const canvas = this.createCanvas(colors);\n    const gradientRenderer = new ChatBackgroundGradientRenderer();\n    gradientRenderer.init(canvas);\n\n    return {gradientRenderer, canvas};\n  }\n}\n","export default function easeOutQuad(t: number, b: number, c: number, d: number) {\n  return t >= d ? b + c : easeOutQuadApply(t / d, c) + b;\n}\n\nexport function easeOutQuadApply(v: number, c: number) {\n  return -c * v * (v - 2);\n}\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport replaceContent from '../../helpers/dom/replaceContent';\r\nimport {Middleware} from '../../helpers/middleware';\r\nimport limitSymbols from '../../helpers/string/limitSymbols';\r\nimport {Document, MessageMedia, Photo, WebPage} from '../../layer';\r\nimport appImManager, {CHAT_ANIMATION_GROUP} from '../../lib/appManagers/appImManager';\r\nimport choosePhotoSize from '../../lib/appManagers/utils/photos/choosePhotoSize';\r\nimport wrapEmojiText from '../../lib/richTextProcessor/wrapEmojiText';\r\nimport DivAndCaption from '../divAndCaption';\r\nimport {wrapPhoto, wrapSticker, wrapVideo} from '../wrappers';\r\nimport wrapMessageForReply from '../wrappers/messageForReply';\r\n\r\nconst MEDIA_SIZE = 32;\r\n\r\nexport async function wrapReplyDivAndCaption(options: {\r\n  title: string | HTMLElement | DocumentFragment,\r\n  titleEl: HTMLElement,\r\n  subtitle: string | HTMLElement | DocumentFragment,\r\n  subtitleEl: HTMLElement,\r\n  message: any,\r\n  mediaEl: HTMLElement,\r\n  loadPromises?: Promise<any>[]\r\n}) {\r\n  let {title, titleEl, subtitle, subtitleEl, mediaEl, message, loadPromises} = options;\r\n  if(title !== undefined) {\r\n    if(typeof(title) === 'string') {\r\n      title = limitSymbols(title, 140);\r\n      title = wrapEmojiText(title);\r\n    }\r\n\r\n    replaceContent(titleEl, title);\r\n  }\r\n\r\n  if(!loadPromises) {\r\n    loadPromises = [];\r\n  }\r\n\r\n  let messageMedia: MessageMedia | WebPage.webPage = message?.media;\r\n  let setMedia = false, isRound = false;\r\n  const mediaChildren = mediaEl ? Array.from(mediaEl.children).slice() : [];\r\n  let middleware: Middleware;\r\n  if(messageMedia && mediaEl) {\r\n    subtitleEl.textContent = '';\r\n    subtitleEl.append(await wrapMessageForReply(message, undefined, undefined, undefined, undefined, true));\r\n\r\n    messageMedia = (messageMedia as MessageMedia.messageMediaWebPage).webpage as WebPage.webPage || messageMedia;\r\n    const photo = (messageMedia as MessageMedia.messageMediaPhoto).photo as Photo.photo;\r\n    const document = (messageMedia as MessageMedia.messageMediaDocument).document as Document.document;\r\n    if(photo || (document && document.thumbs?.length)/* ['video', 'sticker', 'gif', 'round', 'photo', 'audio'].indexOf(document.type) !== -1) */) {\r\n      middleware = appImManager.chat.bubbles.getMiddleware();\r\n      const lazyLoadQueue = appImManager.chat.bubbles.lazyLoadQueue;\r\n\r\n      if(document?.type === 'sticker') {\r\n        await wrapSticker({\r\n          doc: document,\r\n          div: mediaEl,\r\n          lazyLoadQueue,\r\n          group: CHAT_ANIMATION_GROUP,\r\n          // onlyThumb: document.sticker === 2,\r\n          width: MEDIA_SIZE,\r\n          height: MEDIA_SIZE,\r\n          middleware,\r\n          loadPromises\r\n        });\r\n        setMedia = true;\r\n      } else if(document?.type === 'gif' && document.video_thumbs) {\r\n        setMedia = true;\r\n        await wrapVideo({\r\n          doc: document,\r\n          container: mediaEl,\r\n          boxWidth: MEDIA_SIZE,\r\n          boxHeight: MEDIA_SIZE,\r\n          lazyLoadQueue,\r\n          noPlayButton: true,\r\n          noInfo: true,\r\n          middleware,\r\n          loadPromises,\r\n          withoutPreloader: true,\r\n          videoSize: document.video_thumbs[0],\r\n          group: CHAT_ANIMATION_GROUP\r\n        });\r\n      } else {\r\n        const m = photo || document;\r\n        isRound = document?.type === 'round';\r\n\r\n        try {\r\n          await wrapPhoto({\r\n            photo: m,\r\n            container: mediaEl,\r\n            boxWidth: MEDIA_SIZE,\r\n            boxHeight: MEDIA_SIZE,\r\n            size: choosePhotoSize(m, MEDIA_SIZE, MEDIA_SIZE),\r\n            middleware,\r\n            lazyLoadQueue,\r\n            noBlur: true,\r\n            withoutPreloader: true,\r\n            loadPromises\r\n          });\r\n          setMedia = true;\r\n        } catch(err) {\r\n\r\n        }\r\n      }\r\n    }\r\n  } else {\r\n    if(message) {\r\n      subtitleEl.textContent = '';\r\n      subtitleEl.append(await wrapMessageForReply(message));\r\n    } else {\r\n      if(typeof(subtitle) === 'string') {\r\n        subtitle = limitSymbols(subtitle, 140);\r\n        subtitle = wrapEmojiText(subtitle);\r\n      }\r\n\r\n      replaceContent(subtitleEl, subtitle || '');\r\n    }\r\n  }\r\n\r\n  Promise.all(loadPromises).then(() => {\r\n    if(middleware && !middleware()) return;\r\n    mediaChildren.forEach((child) => child.remove());\r\n\r\n    if(mediaEl) {\r\n      mediaEl.classList.toggle('is-round', isRound);\r\n    }\r\n  });\r\n\r\n  return setMedia;\r\n}\r\n\r\nexport default class ReplyContainer extends DivAndCaption<(title: string | HTMLElement | DocumentFragment, subtitle: string | HTMLElement | DocumentFragment, message?: any) => Promise<void>> {\r\n  private mediaEl: HTMLElement;\r\n\r\n  constructor(protected className: string) {\r\n    super(className, async(title, subtitle = '', message?) => {\r\n      if(!this.mediaEl) {\r\n        this.mediaEl = document.createElement('div');\r\n        this.mediaEl.classList.add(this.className + '-media');\r\n      }\r\n\r\n      const isMediaSet = await wrapReplyDivAndCaption({\r\n        title,\r\n        titleEl: this.title,\r\n        subtitle,\r\n        subtitleEl: this.subtitle,\r\n        mediaEl: this.mediaEl,\r\n        message\r\n      });\r\n\r\n      this.container.classList.toggle('is-media', isMediaSet);\r\n      if(isMediaSet) {\r\n        this.content.prepend(this.mediaEl);\r\n      } else {\r\n        this.mediaEl.remove();\r\n      }\r\n    });\r\n  }\r\n}\r\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport type {AppMessagesManager, MessagesStorageKey} from '../../lib/appManagers/appMessagesManager';\nimport type ChatBubbles from './bubbles';\nimport type ChatInput from './input';\nimport type Chat from './chat';\nimport IS_TOUCH_SUPPORTED from '../../environment/touchSupport';\nimport Button from '../button';\nimport ButtonIcon from '../buttonIcon';\nimport CheckboxField from '../checkboxField';\nimport PopupDeleteMessages from '../popups/deleteMessages';\nimport PopupForward from '../popups/forward';\nimport SetTransition from '../singleTransition';\nimport ListenerSetter from '../../helpers/listenerSetter';\nimport PopupSendNow from '../popups/sendNow';\nimport appNavigationController, {NavigationItem} from '../appNavigationController';\nimport {IS_MOBILE_SAFARI} from '../../environment/userAgent';\nimport I18n, {i18n, _i18n} from '../../lib/langPack';\nimport findUpClassName from '../../helpers/dom/findUpClassName';\nimport blurActiveElement from '../../helpers/dom/blurActiveElement';\nimport cancelEvent from '../../helpers/dom/cancelEvent';\nimport cancelSelection from '../../helpers/dom/cancelSelection';\nimport getSelectedText from '../../helpers/dom/getSelectedText';\nimport replaceContent from '../../helpers/dom/replaceContent';\nimport AppSearchSuper from '../appSearchSuper.';\nimport isInDOM from '../../helpers/dom/isInDOM';\nimport {randomLong} from '../../helpers/random';\nimport {attachClickEvent, AttachClickOptions} from '../../helpers/dom/clickEvent';\nimport findUpAsChild from '../../helpers/dom/findUpAsChild';\nimport EventListenerBase from '../../helpers/eventListenerBase';\nimport safeAssign from '../../helpers/object/safeAssign';\nimport {AppManagers} from '../../lib/appManagers/managers';\nimport {attachContextMenuListener} from '../../helpers/dom/attachContextMenuListener';\nimport filterUnique from '../../helpers/array/filterUnique';\nimport appImManager from '../../lib/appManagers/appImManager';\n\nconst accumulateMapSet = (map: Map<any, Set<number>>) => {\n  return [...map.values()].reduce((acc, v) => acc + v.size, 0);\n};\n\n// const MIN_CLICK_MOVE = 32; // minimum bubble height\n\nclass AppSelection extends EventListenerBase<{\n  toggle: (isSelecting: boolean) => void\n}> {\n  public selectedMids: Map<PeerId, Set<number>> = new Map();\n  public isSelecting = false;\n\n  public selectedText: string;\n\n  protected listenerSetter: ListenerSetter;\n  protected isScheduled: boolean;\n  protected listenElement: HTMLElement;\n\n  protected onToggleSelection: (forwards: boolean, animate: boolean) => void | Promise<void>;\n  protected onUpdateContainer: (cantForward: boolean, cantDelete: boolean, cantSend: boolean) => void;\n  protected onCancelSelection: () => void;\n  protected toggleByMid: (peerId: PeerId, mid: number) => void;\n  protected toggleByElement: (bubble: HTMLElement) => void;\n\n  protected navigationType: NavigationItem['type'];\n\n  protected getElementFromTarget: (target: HTMLElement) => HTMLElement;\n  protected verifyTarget: (e: MouseEvent, target: HTMLElement) => boolean;\n  protected verifyMouseMoveTarget: (e: MouseEvent, element: HTMLElement, selecting: boolean) => boolean;\n  protected verifyTouchLongPress: () => boolean;\n  protected targetLookupClassName: string;\n  protected lookupBetweenParentClassName: string;\n  protected lookupBetweenElementsQuery: string;\n\n  protected doNotAnimate: boolean;\n  protected managers: AppManagers;\n\n  constructor(options: {\n    managers: AppManagers,\n    getElementFromTarget: AppSelection['getElementFromTarget'],\n    verifyTarget?: AppSelection['verifyTarget'],\n    verifyMouseMoveTarget?: AppSelection['verifyMouseMoveTarget'],\n    verifyTouchLongPress?: AppSelection['verifyTouchLongPress'],\n    targetLookupClassName: string,\n    lookupBetweenParentClassName: string,\n    lookupBetweenElementsQuery: string,\n    isScheduled?: AppSelection['isScheduled']\n  }) {\n    super(false);\n\n    safeAssign(this, options);\n\n    this.navigationType = 'multiselect-' + randomLong() as any;\n  }\n\n  public attachListeners(listenElement: HTMLElement, listenerSetter: ListenerSetter) {\n    if(this.listenElement) {\n      this.listenerSetter.removeAll();\n    }\n\n    this.listenElement = listenElement;\n    this.listenerSetter = listenerSetter;\n\n    if(!listenElement) {\n      return;\n    }\n\n    if(IS_TOUCH_SUPPORTED) {\n      listenerSetter.add(listenElement)('touchend', () => {\n        if(!this.isSelecting) return;\n        this.selectedText = getSelectedText();\n      });\n\n      attachContextMenuListener(listenElement, (e) => {\n        if(this.isSelecting || (this.verifyTouchLongPress && !this.verifyTouchLongPress())) return;\n\n        // * these two lines will fix instant text selection on iOS Safari\n        document.body.classList.add('no-select'); // * need no-select on body because chat-input transforms in channels\n        listenElement.addEventListener('touchend', (e) => {\n          cancelEvent(e); // ! this one will fix propagation to document loader button, etc\n          document.body.classList.remove('no-select');\n\n          // this.chat.bubbles.onBubblesClick(e);\n        }, {once: true, capture: true});\n\n        cancelSelection();\n        // cancelEvent(e as any);\n        const element = this.getElementFromTarget(e.target as HTMLElement);\n        if(element) {\n          this.toggleByElement(element);\n        }\n      }, listenerSetter);\n\n      return;\n    }\n\n    listenerSetter.add(listenElement)('mousedown', this.onMouseDown);\n  }\n\n  private onMouseDown = (e: MouseEvent) => {\n    // console.log('selection mousedown', e);\n    const element = findUpClassName(e.target, this.targetLookupClassName);\n    if(e.button !== 0) {\n      return;\n    }\n\n    if(this.verifyTarget && !this.verifyTarget(e, element)) {\n      return;\n    }\n\n    const seen: AppSelection['selectedMids'] = new Map();\n    let selecting: boolean;\n\n    /* let good = false;\n    const {x, y} = e; */\n\n    /* const bubbles = appImManager.bubbles;\n    for(const mid in bubbles) {\n      const bubble = bubbles[mid];\n      bubble.addEventListener('mouseover', () => {\n        console.log('mouseover');\n      }, {once: true});\n    } */\n\n    let firstTarget = element;\n\n    const processElement = (element: HTMLElement, checkBetween = true) => {\n      const mid = +element.dataset.mid;\n      if(!mid || !element.dataset.peerId) return;\n      const peerId = element.dataset.peerId.toPeerId();\n\n      if(!isInDOM(firstTarget)) {\n        firstTarget = element;\n      }\n\n      let seenSet = seen.get(peerId);\n      if(!seenSet) {\n        seen.set(peerId, seenSet = new Set());\n      }\n\n      if(seenSet.has(mid)) {\n        return;\n      }\n\n      const isSelected = this.isMidSelected(peerId, mid);\n      if(selecting === undefined) {\n        // bubblesContainer.classList.add('no-select');\n        selecting = !isSelected;\n      }\n\n      seenSet.add(mid);\n\n      if((selecting && !isSelected) || (!selecting && isSelected)) {\n        const seenLength = accumulateMapSet(seen);\n        if(this.toggleByElement && checkBetween) {\n          if(seenLength < 2) {\n            if(findUpAsChild(element, firstTarget)) {\n              firstTarget = element;\n            }\n          }\n\n          const elementsBetween = this.getElementsBetween(firstTarget, element);\n          // console.log(elementsBetween);\n          if(elementsBetween.length) {\n            elementsBetween.forEach((element) => {\n              processElement(element, false);\n            });\n          }\n        }\n\n        if(!this.selectedMids.size) {\n          if(seenLength === 2 && this.toggleByMid) {\n            for(const [peerId, mids] of seen) {\n              for(const mid of mids) {\n                this.toggleByMid(peerId, mid);\n              }\n            }\n          }\n        } else if(this.toggleByElement) {\n          this.toggleByElement(element);\n        }\n      }\n    };\n\n    // const foundTargets: Map<HTMLElement, true> = new Map();\n    let canceledSelection = false;\n    const onMouseMove = (e: MouseEvent) => {\n      if(!canceledSelection) {\n        cancelSelection();\n        canceledSelection = true;\n      }\n      /* if(!good) {\n        if(Math.abs(e.x - x) > MIN_CLICK_MOVE || Math.abs(e.y - y) > MIN_CLICK_MOVE) {\n          good = true;\n        } else {\n          return;\n        }\n      } */\n\n      /* if(foundTargets.has(e.target as HTMLElement)) return;\n      foundTargets.set(e.target as HTMLElement, true); */\n      const element = this.getElementFromTarget(e.target as HTMLElement);\n      if(!element) {\n        // console.error('found no bubble', e);\n        return;\n      }\n\n      if(this.verifyMouseMoveTarget && !this.verifyMouseMoveTarget(e, element, selecting)) {\n        this.listenerSetter.removeManual(this.listenElement, 'mousemove', onMouseMove);\n        this.listenerSetter.removeManual(document, 'mouseup', onMouseUp, documentListenerOptions);\n        return;\n      }\n\n      processElement(element);\n    };\n\n    const onMouseUp = (e: MouseEvent) => {\n      if(seen.size) {\n        attachClickEvent(window, cancelEvent, {capture: true, once: true, passive: false});\n      }\n\n      this.listenerSetter.removeManual(this.listenElement, 'mousemove', onMouseMove);\n      // bubblesContainer.classList.remove('no-select');\n\n      // ! CANCEL USER SELECTION !\n      cancelSelection();\n    };\n\n    const documentListenerOptions = {once: true};\n    this.listenerSetter.add(this.listenElement)('mousemove', onMouseMove);\n    this.listenerSetter.add(document)('mouseup', onMouseUp, documentListenerOptions);\n  };\n\n  private getElementsBetween = (first: HTMLElement, last: HTMLElement) => {\n    if(first === last) {\n      return [];\n    }\n\n    const firstRect = first.getBoundingClientRect();\n    const lastRect = last.getBoundingClientRect();\n    const difference = (firstRect.top - lastRect.top) || (firstRect.left - lastRect.left);\n    const isHigher = difference < 0;\n\n    const parent = findUpClassName(first, this.lookupBetweenParentClassName);\n    if(!parent) {\n      return [];\n    }\n\n    const elements = Array.from(parent.querySelectorAll(this.lookupBetweenElementsQuery)) as HTMLElement[];\n    let firstIndex = elements.indexOf(first);\n    let lastIndex = elements.indexOf(last);\n\n    if(!isHigher) {\n      [lastIndex, firstIndex] = [firstIndex, lastIndex];\n    }\n\n    const slice = elements.slice(firstIndex + 1, lastIndex);\n\n    // console.log('getElementsBetween', first, last, slice, firstIndex, lastIndex, isHigher);\n\n    return slice;\n  };\n\n  protected isElementShouldBeSelected(element: HTMLElement) {\n    return this.isMidSelected(element.dataset.peerId.toPeerId(), +element.dataset.mid);\n  }\n\n  protected appendCheckbox(element: HTMLElement, checkboxField: CheckboxField) {\n    element.prepend(checkboxField.label);\n  }\n\n  public toggleElementCheckbox(element: HTMLElement, show: boolean) {\n    const hasCheckbox = !!this.getCheckboxInputFromElement(element);\n    if(show) {\n      if(hasCheckbox) {\n        return false;\n      }\n\n      const checkboxField = new CheckboxField({\n        name: element.dataset.mid,\n        round: true\n      });\n\n      // * if it is a render of new message\n      if(this.isSelecting) { // ! avoid breaking animation on start\n        if(this.isElementShouldBeSelected(element)) {\n          checkboxField.input.checked = true;\n          element.classList.add('is-selected');\n        }\n      }\n\n      this.appendCheckbox(element, checkboxField);\n    } else if(hasCheckbox) {\n      this.getCheckboxInputFromElement(element).parentElement.remove();\n      SetTransition(element, 'is-selected', false, 200);\n    }\n\n    return true;\n  }\n\n  protected getCheckboxInputFromElement(element: HTMLElement): HTMLInputElement {\n    return element.firstElementChild?.tagName === 'LABEL' &&\n      element.firstElementChild.firstElementChild as HTMLInputElement;\n  }\n\n  protected async updateContainer(forceSelection = false) {\n    const size = this.selectedMids.size;\n    if(!size && !forceSelection) return;\n\n    let cantForward = !size,\n      cantDelete = !size;\n    const cantSend = !size;\n    for(const [peerId, mids] of this.selectedMids) {\n      const storageKey: MessagesStorageKey = `${peerId}_${this.isScheduled ? 'scheduled' : 'history'}`;\n      const r = await this.managers.appMessagesManager.cantForwardDeleteMids(storageKey, Array.from(mids));\n      cantForward = r.cantForward;\n      cantDelete = r.cantDelete;\n\n      if(cantForward && cantDelete) break;\n    }\n\n    this.onUpdateContainer?.(cantForward, cantDelete, cantSend);\n  }\n\n  public toggleSelection(toggleCheckboxes = true, forceSelection = false) {\n    const wasSelecting = this.isSelecting;\n    const size = this.selectedMids.size;\n    this.isSelecting = !!size || forceSelection;\n\n    if(wasSelecting === this.isSelecting) return false;\n\n    this.dispatchEvent('toggle', this.isSelecting);\n\n    // const bubblesContainer = this.bubbles.bubblesContainer;\n    // bubblesContainer.classList.toggle('is-selecting', !!size);\n\n    /* if(bubblesContainer.classList.contains('is-chat-input-hidden')) {\n      const scrollable = this.appImManager.scrollable;\n      if(scrollable.isScrolledDown) {\n        scrollable.scrollTo(scrollable.scrollHeight, 'top', true, true, 200);\n      }\n    } */\n\n    if(!IS_TOUCH_SUPPORTED) {\n      this.listenElement.classList.toggle('no-select', this.isSelecting);\n\n      if(wasSelecting) {\n        // ! CANCEL USER SELECTION !\n        cancelSelection();\n      }\n    }/*  else {\n      if(!wasSelecting) {\n        bubblesContainer.classList.add('no-select');\n        setTimeout(() => {\n          cancelSelection();\n          bubblesContainer.classList.remove('no-select');\n          cancelSelection();\n        }, 100);\n      }\n    } */\n\n    blurActiveElement();\n\n    const forwards = !!size || forceSelection;\n    const toggleResult = this.onToggleSelection?.(forwards, !this.doNotAnimate);\n\n    if(!IS_MOBILE_SAFARI) {\n      if(forwards) {\n        appNavigationController.pushItem({\n          type: this.navigationType,\n          onPop: () => {\n            this.cancelSelection();\n          }\n        });\n      } else {\n        appNavigationController.removeByType(this.navigationType);\n      }\n    }\n\n    if(forceSelection) {\n      (toggleResult || Promise.resolve()).then(() => this.updateContainer(forceSelection));\n    }\n\n    return true;\n  }\n\n  public cancelSelection = async(doNotAnimate?: boolean) => {\n    if(doNotAnimate) this.doNotAnimate = true;\n    this.onCancelSelection && await this.onCancelSelection();\n    this.selectedMids.clear();\n    this.toggleSelection();\n    cancelSelection();\n    if(doNotAnimate) this.doNotAnimate = undefined;\n  };\n\n  public cleanup() {\n    this.doNotAnimate = true;\n    this.selectedMids.clear();\n    this.toggleSelection(false);\n    this.doNotAnimate = undefined;\n  }\n\n  protected updateElementSelection(element: HTMLElement, isSelected: boolean) {\n    this.toggleElementCheckbox(element, true);\n    const input = this.getCheckboxInputFromElement(element);\n    input.checked = isSelected;\n\n    this.toggleSelection();\n    this.updateContainer();\n    SetTransition(element, 'is-selected', isSelected, 200);\n  }\n\n  public isMidSelected(peerId: PeerId, mid: number) {\n    const set = this.selectedMids.get(peerId);\n    return set?.has(mid);\n  }\n\n  public length() {\n    return accumulateMapSet(this.selectedMids);\n  }\n\n  protected toggleMid(peerId: PeerId, mid: number, unselect?: boolean) {\n    let set = this.selectedMids.get(peerId);\n    if(unselect || (unselect === undefined && set?.has(mid))) {\n      if(set) {\n        set.delete(mid);\n\n        if(!set.size) {\n          this.selectedMids.delete(peerId);\n        }\n      }\n    } else {\n      // const diff = rootScope.config.forwarded_count_max - this.length() - 1;\n      // if(diff < 0) {\n      //   toast(I18n.format('Chat.Selection.LimitToast', true));\n      //   return false;\n      //   /* const it = this.selectedMids.values();\n      //   do {\n      //     const mid = it.next().value;\n      //     const mounted = this.appImManager.getMountedBubble(mid);\n      //     if(mounted) {\n      //       this.toggleByBubble(mounted.bubble);\n      //     } else {\n      //       const mids = this.appMessagesManager.getMidsByMid(mid);\n      //       for(const mid of mids) {\n      //         this.selectedMids.delete(mid);\n      //       }\n      //     }\n      //   } while(this.selectedMids.size > MAX_SELECTION_LENGTH); */\n      // }\n\n      if(!set) {\n        set = new Set();\n        this.selectedMids.set(peerId, set);\n      }\n\n      set.add(mid);\n    }\n\n    return true;\n  }\n\n  /**\n   * ! Call this method only to handle deleted messages\n   */\n  public deleteSelectedMids(peerId: PeerId, mids: number[]) {\n    const set = this.selectedMids.get(peerId);\n    if(!set) {\n      return;\n    }\n\n    mids.forEach((mid) => {\n      set.delete(mid);\n    });\n\n    if(!set.size) {\n      this.selectedMids.delete(peerId);\n    }\n\n    this.updateContainer();\n    this.toggleSelection();\n  }\n}\n\nexport class SearchSelection extends AppSelection {\n  protected selectionContainer: HTMLElement;\n  protected selectionCountEl: HTMLElement;\n  public selectionForwardBtn: HTMLElement;\n  public selectionDeleteBtn: HTMLElement;\n  public selectionGotoBtn: HTMLElement;\n\n  private isPrivate: boolean;\n\n  constructor(private searchSuper: AppSearchSuper, managers: AppManagers, listenerSetter: ListenerSetter) {\n    super({\n      managers,\n      verifyTarget: (e, target) => !!target && this.isSelecting,\n      getElementFromTarget: (target) => findUpClassName(target, 'search-super-item'),\n      targetLookupClassName: 'search-super-item',\n      lookupBetweenParentClassName: 'tabs-tab',\n      lookupBetweenElementsQuery: '.search-super-item'\n    });\n\n    this.isPrivate = !searchSuper.showSender;\n    this.attachListeners(searchSuper.container, listenerSetter);\n  }\n\n  /* public appendCheckbox(element: HTMLElement, checkboxField: CheckboxField) {\n    checkboxField.label.classList.add('bubble-select-checkbox');\n\n    if(element.classList.contains('document') || element.tagName === 'AUDIO-ELEMENT') {\n      element.querySelector('.document, audio-element').append(checkboxField.label);\n    } else {\n      super.appendCheckbox(bubble, checkboxField);\n    }\n  } */\n\n  public toggleSelection(toggleCheckboxes = true, forceSelection = false) {\n    const ret = super.toggleSelection(toggleCheckboxes, forceSelection);\n\n    if(ret && toggleCheckboxes) {\n      const elements = Array.from(this.searchSuper.tabsContainer.querySelectorAll('.search-super-item')) as HTMLElement[];\n      elements.forEach((element) => {\n        this.toggleElementCheckbox(element, this.isSelecting);\n      });\n    }\n\n    return ret;\n  }\n\n  public toggleByElement = (element: HTMLElement) => {\n    const mid = +element.dataset.mid;\n    const peerId = element.dataset.peerId.toPeerId();\n\n    if(!this.toggleMid(peerId, mid)) {\n      return;\n    }\n\n    this.updateElementSelection(element, this.isMidSelected(peerId, mid));\n  };\n\n  public toggleByMid = (peerId: PeerId, mid: number) => {\n    const element = this.searchSuper.mediaTab.contentTab.querySelector(`.search-super-item[data-peer-id=\"${peerId}\"][data-mid=\"${mid}\"]`) as HTMLElement;\n    this.toggleByElement(element);\n  };\n\n  protected onUpdateContainer = (cantForward: boolean, cantDelete: boolean, cantSend: boolean) => {\n    const length = this.length();\n    replaceContent(this.selectionCountEl, i18n('messages', [length]));\n    this.selectionGotoBtn.classList.toggle('hide', length !== 1);\n    this.selectionForwardBtn.classList.toggle('hide', cantForward);\n    this.selectionDeleteBtn && this.selectionDeleteBtn.classList.toggle('hide', cantDelete);\n  };\n\n  protected onToggleSelection = (forwards: boolean, animate: boolean) => {\n    SetTransition(this.searchSuper.navScrollableContainer, 'is-selecting', forwards, animate ? 200 : 0, () => {\n      if(!this.isSelecting) {\n        this.selectionContainer.remove();\n        this.selectionContainer =\n          this.selectionForwardBtn =\n          this.selectionDeleteBtn =\n          null;\n        this.selectedText = undefined;\n      }\n    });\n\n    SetTransition(this.searchSuper.container, 'is-selecting', forwards, 200);\n\n    if(this.isSelecting) {\n      if(!this.selectionContainer) {\n        const BASE_CLASS = 'search-super-selection';\n        this.selectionContainer = document.createElement('div');\n        this.selectionContainer.classList.add(BASE_CLASS + '-container');\n\n        const btnCancel = ButtonIcon(`close ${BASE_CLASS}-cancel`, {noRipple: true});\n        attachClickEvent(btnCancel, () => this.cancelSelection(), {listenerSetter: this.listenerSetter, once: true});\n\n        this.selectionCountEl = document.createElement('div');\n        this.selectionCountEl.classList.add(BASE_CLASS + '-count');\n\n        this.selectionGotoBtn = ButtonIcon(`message ${BASE_CLASS}-goto`);\n\n        const attachClickOptions: AttachClickOptions = {listenerSetter: this.listenerSetter};\n        attachClickEvent(this.selectionGotoBtn, () => {\n          const peerId = [...this.selectedMids.keys()][0];\n          const mid = [...this.selectedMids.get(peerId)][0];\n          this.cancelSelection();\n\n          appImManager.setInnerPeer({peerId, lastMsgId: mid});\n        }, attachClickOptions);\n\n        this.selectionForwardBtn = ButtonIcon(`forward ${BASE_CLASS}-forward`);\n        attachClickEvent(this.selectionForwardBtn, () => {\n          const obj: {[fromPeerId: PeerId]: number[]} = {};\n          for(const [fromPeerId, mids] of this.selectedMids) {\n            obj[fromPeerId] = Array.from(mids).sort((a, b) => a - b);\n          }\n\n          new PopupForward(obj, () => {\n            this.cancelSelection();\n          });\n        }, attachClickOptions);\n\n        if(this.isPrivate) {\n          this.selectionDeleteBtn = ButtonIcon(`delete danger ${BASE_CLASS}-delete`);\n          attachClickEvent(this.selectionDeleteBtn, () => {\n            const peerId = [...this.selectedMids.keys()][0];\n            new PopupDeleteMessages(peerId, [...this.selectedMids.get(peerId)], 'chat', () => {\n              this.cancelSelection();\n            });\n          }, attachClickOptions);\n        }\n\n        this.selectionContainer.append(...[\n          btnCancel,\n          this.selectionCountEl,\n          this.selectionGotoBtn,\n          this.selectionForwardBtn,\n          this.selectionDeleteBtn\n        ].filter(Boolean));\n\n        const transitionElement = this.selectionContainer;\n        transitionElement.style.opacity = '0';\n        this.searchSuper.navScrollableContainer.append(transitionElement);\n\n        void transitionElement.offsetLeft; // reflow\n        transitionElement.style.opacity = '';\n      }\n    }\n  };\n}\n\nexport default class ChatSelection extends AppSelection {\n  protected selectionInputWrapper: HTMLElement;\n  protected selectionContainer: HTMLElement;\n  protected selectionCountEl: HTMLElement;\n  public selectionSendNowBtn: HTMLElement;\n  public selectionForwardBtn: HTMLElement;\n  public selectionDeleteBtn: HTMLElement;\n  private selectionLeft: HTMLDivElement;\n  private selectionRight: HTMLDivElement;\n\n  constructor(\n    private chat: Chat,\n    private bubbles: ChatBubbles,\n    private input: ChatInput,\n    managers: AppManagers\n  ) {\n    super({\n      managers,\n      getElementFromTarget: (target) => findUpClassName(target, 'grouped-item') || findUpClassName(target, 'bubble'),\n      verifyTarget: (e, target) => {\n        // LEFT BUTTON\n        //     ,      target  .bubble\n        const bad = !this.selectedMids.size &&\n          !(e.target as HTMLElement).classList.contains('bubble') &&\n          !(e.target as HTMLElement).classList.contains('document-selection') &&\n          target;\n\n        return !bad;\n      },\n      verifyMouseMoveTarget: (e, element, selecting) => {\n        const bad = e.target !== element &&\n          !(e.target as HTMLElement).classList.contains('document-selection') &&\n          selecting === undefined &&\n          !this.selectedMids.size;\n        return !bad;\n      },\n      verifyTouchLongPress: () => !this.chat.input.recording,\n      targetLookupClassName: 'bubble',\n      lookupBetweenParentClassName: 'bubbles-inner',\n      lookupBetweenElementsQuery: '.bubble:not(.is-multiple-documents), .grouped-item',\n      isScheduled: chat.type === 'scheduled'\n    });\n  }\n\n  public appendCheckbox(bubble: HTMLElement, checkboxField: CheckboxField) {\n    checkboxField.label.classList.add('bubble-select-checkbox');\n\n    if(bubble.classList.contains('document-container')) {\n      bubble.querySelector('.document, audio-element').append(checkboxField.label);\n    } else {\n      super.appendCheckbox(bubble, checkboxField);\n    }\n  }\n\n  public toggleSelection(toggleCheckboxes = true, forceSelection = false) {\n    const ret = super.toggleSelection(toggleCheckboxes, forceSelection);\n\n    if(ret && toggleCheckboxes) {\n      for(const mid in this.bubbles.bubbles) {\n        if(this.bubbles.skippedMids.has(+mid)) {\n          continue;\n        }\n\n        const bubble = this.bubbles.bubbles[mid];\n        this.toggleElementCheckbox(bubble, this.isSelecting);\n      }\n    }\n\n    return ret;\n  }\n\n  public toggleElementCheckbox(bubble: HTMLElement, show: boolean) {\n    if(!this.canSelectBubble(bubble)) return;\n\n    const ret = super.toggleElementCheckbox(bubble, show);\n    if(ret) {\n      const isGrouped = bubble.classList.contains('is-grouped');\n      if(isGrouped) {\n        this.bubbles.getBubbleGroupedItems(bubble).forEach((item) => this.toggleElementCheckbox(item, show));\n      }\n    }\n\n    return ret;\n  }\n\n  public toggleByElement = (bubble: HTMLElement): Promise<void> => {\n    if(!this.canSelectBubble(bubble)) return;\n\n    const mid = +bubble.dataset.mid;\n\n    const isGrouped = bubble.classList.contains('is-grouped');\n    if(isGrouped) {\n      if(!this.isGroupedBubbleSelected(bubble)) {\n        const set = this.selectedMids.get(this.chat.peerId);\n        if(set) {\n          // const mids = await this.chat.getMidsByMid(mid);\n          const mids = this.getMidsFromGroupContainer(bubble);\n          mids.forEach((mid) => set.delete(mid));\n        }\n      }\n\n      /* const promises =  */this.bubbles.getBubbleGroupedItems(bubble).map(this.toggleByElement);\n      // await Promise.all(promises);\n      return;\n    }\n\n    if(!this.toggleMid(this.chat.peerId, mid)) {\n      return;\n    }\n\n    const isGroupedItem = bubble.classList.contains('grouped-item');\n    if(isGroupedItem) {\n      const groupContainer = findUpClassName(bubble, 'bubble');\n      const isGroupedSelected = this.isGroupedBubbleSelected(groupContainer);\n      const isGroupedMidsSelected = this.isGroupedMidsSelected(groupContainer);\n\n      const willChange = isGroupedMidsSelected || isGroupedSelected;\n      if(willChange) {\n        this.updateElementSelection(groupContainer, isGroupedMidsSelected);\n      }\n    }\n\n    this.updateElementSelection(bubble, this.isMidSelected(this.chat.peerId, mid));\n  };\n\n  protected toggleByMid = async(peerId: PeerId, mid: number) => {\n    const mounted = await this.bubbles.getMountedBubble(mid);\n    if(mounted) {\n      this.toggleByElement(mounted.bubble);\n    }\n  };\n\n  public isElementShouldBeSelected(element: HTMLElement) {\n    const isGrouped = element.classList.contains('is-grouped');\n    return super.isElementShouldBeSelected(element) && (!isGrouped || this.isGroupedMidsSelected(element));\n  }\n\n  protected isGroupedBubbleSelected(bubble: HTMLElement) {\n    const groupedCheckboxInput = this.getCheckboxInputFromElement(bubble);\n    return groupedCheckboxInput?.checked;\n  }\n\n  protected getMidsFromGroupContainer(groupContainer: HTMLElement) {\n    const elements = this.chat.bubbles.getBubbleGroupedItems(groupContainer);\n    if(!elements.length) {\n      elements.push(groupContainer);\n    }\n\n    return elements.map((element) => +element.dataset.mid);\n  }\n\n  protected isGroupedMidsSelected(groupContainer: HTMLElement) {\n    const mids = this.getMidsFromGroupContainer(groupContainer);\n    const selectedMids = mids.filter((mid) => this.isMidSelected(this.chat.peerId, mid));\n    return mids.length === selectedMids.length;\n  }\n\n  protected getCheckboxInputFromElement(bubble: HTMLElement) {\n    /* let perf = performance.now();\n    let checkbox = bubble.firstElementChild.tagName === 'LABEL' && bubble.firstElementChild.firstElementChild as HTMLInputElement;\n    console.log('getCheckboxInputFromBubble firstElementChild time:', performance.now() - perf);\n\n    perf = performance.now();\n    checkbox = bubble.querySelector('label input');\n    console.log('getCheckboxInputFromBubble querySelector time:', performance.now() - perf); */\n    /* let perf = performance.now();\n    let contains = bubble.classList.contains('document-container');\n    console.log('getCheckboxInputFromBubble classList time:', performance.now() - perf);\n\n    perf = performance.now();\n    contains = bubble.className.includes('document-container');\n    console.log('getCheckboxInputFromBubble className time:', performance.now() - perf); */\n\n    return bubble.classList.contains('document-container') ?\n      bubble.querySelector('label input') as HTMLInputElement :\n      super.getCheckboxInputFromElement(bubble);\n  }\n\n  public canSelectBubble(bubble: HTMLElement) {\n    return !bubble.classList.contains('service') &&\n      !bubble.classList.contains('is-outgoing') &&\n      !bubble.classList.contains('is-error') &&\n      !bubble.classList.contains('bubble-first') &&\n      !bubble.classList.contains('avoid-selection');\n  }\n\n  protected onToggleSelection = async(forwards: boolean, animate: boolean) => {\n    const {needTranslateX, widthFrom, widthTo} = await this.chat.input.center(animate);\n\n    SetTransition(this.listenElement, 'is-selecting', forwards, animate ? 200 : 0, () => {\n      if(!this.isSelecting) {\n        this.selectionInputWrapper.remove();\n        this.selectionInputWrapper =\n          this.selectionContainer =\n          this.selectionSendNowBtn =\n          this.selectionForwardBtn =\n          this.selectionDeleteBtn =\n          this.selectionLeft =\n          this.selectionRight =\n          null;\n        this.selectedText = undefined;\n      }\n\n      /* fastRaf(() => {\n        this.bubbles.onScroll();\n      }); */\n    });\n\n    // const chatInput = this.appImManager.chatInput;\n\n    const translateButtonsX = widthFrom < widthTo ? undefined : needTranslateX * 2;\n    if(this.isSelecting) {\n      if(!this.selectionContainer) {\n        this.selectionInputWrapper = document.createElement('div');\n        this.selectionInputWrapper.classList.add('chat-input-wrapper', 'selection-wrapper');\n\n        // const background = document.createElement('div');\n        // background.classList.add('chat-input-wrapper-background');\n\n        this.selectionContainer = document.createElement('div');\n        this.selectionContainer.classList.add('selection-container');\n\n        const attachClickOptions: AttachClickOptions = {listenerSetter: this.listenerSetter};\n        const btnCancel = ButtonIcon('close', {noRipple: true});\n        attachClickEvent(btnCancel, () => this.cancelSelection(), {once: true, listenerSetter: this.listenerSetter});\n\n        this.selectionCountEl = document.createElement('div');\n        this.selectionCountEl.classList.add('selection-container-count');\n\n        if(this.chat.type === 'scheduled') {\n          this.selectionSendNowBtn = Button('btn-primary btn-transparent btn-short text-bold selection-container-send', {icon: 'send2'});\n          this.selectionSendNowBtn.append(i18n('MessageScheduleSend'));\n          attachClickEvent(this.selectionSendNowBtn, () => {\n            new PopupSendNow(this.chat.peerId, [...this.selectedMids.get(this.chat.peerId)], () => {\n              this.cancelSelection();\n            });\n          }, attachClickOptions);\n        } else {\n          this.selectionForwardBtn = Button('btn-primary btn-transparent text-bold selection-container-forward', {icon: 'forward'});\n          this.selectionForwardBtn.append(i18n('Forward'));\n          attachClickEvent(this.selectionForwardBtn, () => {\n            const obj: {[fromPeerId: PeerId]: number[]} = {};\n            for(const [fromPeerId, mids] of this.selectedMids) {\n              obj[fromPeerId] = Array.from(mids).sort((a, b) => a - b);\n            }\n\n            new PopupForward(obj, () => {\n              this.cancelSelection();\n            });\n          }, attachClickOptions);\n        }\n\n        this.selectionDeleteBtn = Button('btn-primary btn-transparent danger text-bold selection-container-delete', {icon: 'delete'});\n        this.selectionDeleteBtn.append(i18n('Delete'));\n        attachClickEvent(this.selectionDeleteBtn, () => {\n          new PopupDeleteMessages(this.chat.peerId, [...this.selectedMids.get(this.chat.peerId)], this.chat.type, () => {\n            this.cancelSelection();\n          });\n        }, attachClickOptions);\n\n        const left = this.selectionLeft = document.createElement('div');\n        left.classList.add('selection-container-left');\n        left.append(btnCancel, this.selectionCountEl);\n\n        const right = this.selectionRight = document.createElement('div');\n        right.classList.add('selection-container-right');\n        right.append(...[\n          this.selectionSendNowBtn,\n          this.selectionForwardBtn,\n          this.selectionDeleteBtn\n        ].filter(Boolean))\n\n        if(translateButtonsX !== undefined) {\n          left.style.transform = `translateX(${-translateButtonsX}px)`;\n          right.style.transform = `translateX(${translateButtonsX}px)`;\n        }\n\n        this.selectionContainer.append(left, right);\n\n        // background.style.opacity = '0';\n        this.selectionInputWrapper.style.opacity = '0';\n        this.selectionInputWrapper.append(/* background,  */this.selectionContainer);\n        this.input.inputContainer.append(this.selectionInputWrapper);\n\n        void this.selectionInputWrapper.offsetLeft; // reflow\n        // background.style.opacity = '';\n        this.selectionInputWrapper.style.opacity = '';\n        left.style.transform = '';\n        right.style.transform = '';\n      }\n    } else if(this.selectionLeft && translateButtonsX !== undefined) {\n      this.selectionLeft.style.transform = `translateX(-${translateButtonsX}px)`;\n      this.selectionRight.style.transform = `translateX(${translateButtonsX}px)`;\n    }\n  };\n\n  protected onUpdateContainer = (cantForward: boolean, cantDelete: boolean, cantSend: boolean) => {\n    replaceContent(this.selectionCountEl, i18n('messages', [this.length()]));\n    this.selectionSendNowBtn && this.selectionSendNowBtn.toggleAttribute('disabled', cantSend);\n    this.selectionForwardBtn && this.selectionForwardBtn.toggleAttribute('disabled', cantForward);\n    this.selectionDeleteBtn && this.selectionDeleteBtn.toggleAttribute('disabled', cantDelete);\n  };\n\n  protected onCancelSelection = async() => {\n    return;\n    const promises: Promise<HTMLElement>[] = [];\n    for(const [peerId, mids] of this.selectedMids) {\n      for(const mid of mids) {\n        promises.push(this.bubbles.getMountedBubble(mid).then((m) => m?.bubble));\n      }\n    }\n\n    const bubbles = filterUnique((await Promise.all(promises)).filter(Boolean));\n    bubbles.forEach((bubble) => {\n      this.toggleByElement(bubble);\n    });\n  };\n}\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nexport default function getSelectedText(): string {\r\n  if(window.getSelection) {\r\n    return window.getSelection().toString();\r\n    // @ts-ignore\r\n  } else if(document.selection) {\r\n    // @ts-ignore\r\n    return document.selection.createRange().text;\r\n  }\r\n\r\n  return '';\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport type ListenerSetter from '../helpers/listenerSetter';\r\nimport ripple from './ripple';\r\nimport {LangPackKey, _i18n} from '../lib/langPack';\r\nimport getDeepProperty from '../helpers/object/getDeepProperty';\r\nimport rootScope from '../lib/rootScope';\r\nimport apiManagerProxy from '../lib/mtproto/mtprotoworker';\r\n\r\nexport type CheckboxFieldOptions = {\r\n  text?: LangPackKey,\r\n  textArgs?: any[],\r\n  name?: string,\r\n  round?: boolean,\r\n  toggle?: boolean,\r\n  stateKey?: string,\r\n  stateValues?: any[],\r\n  disabled?: boolean,\r\n  checked?: boolean,\r\n  restriction?: boolean,\r\n  withRipple?: boolean,\r\n  withHover?: boolean,\r\n  listenerSetter?: ListenerSetter\r\n};\r\nexport default class CheckboxField {\r\n  public input: HTMLInputElement;\r\n  public label: HTMLLabelElement;\r\n  public span: HTMLSpanElement;\r\n\r\n  constructor(options: CheckboxFieldOptions = {}) {\r\n    const label = this.label = document.createElement('label');\r\n    label.classList.add('checkbox-field');\r\n\r\n    if(options.restriction) {\r\n      label.classList.add('checkbox-field-restriction');\r\n    }\r\n\r\n    if(options.round) {\r\n      label.classList.add('checkbox-field-round');\r\n    }\r\n\r\n    if(options.disabled) {\r\n      this.toggleDisability(true);\r\n    }\r\n\r\n    const input = this.input = document.createElement('input');\r\n    input.classList.add('checkbox-field-input');\r\n    input.type = 'checkbox';\r\n    if(options.name) {\r\n      input.id = 'input-' + options.name;\r\n    }\r\n\r\n    if(options.checked) {\r\n      input.checked = true;\r\n    }\r\n\r\n    if(options.stateKey) {\r\n      let loaded = false;\r\n      const onChange = () => {\r\n        if(!loaded) {\r\n          return;\r\n        }\r\n\r\n        let value: any;\r\n        if(options.stateValues) {\r\n          value = options.stateValues[input.checked ? 1 : 0];\r\n        } else {\r\n          value = input.checked;\r\n        }\r\n\r\n        rootScope.managers.appStateManager.setByKey(options.stateKey, value);\r\n      };\r\n\r\n      apiManagerProxy.getState().then((state) => {\r\n        loaded = true;\r\n        const stateValue = getDeepProperty(state, options.stateKey);\r\n        let checked: boolean;\r\n        if(options.stateValues) {\r\n          checked = options.stateValues.indexOf(stateValue) === 1;\r\n        } else {\r\n          checked = stateValue;\r\n        }\r\n\r\n        this.setValueSilently(checked);\r\n      });\r\n\r\n      if(options.listenerSetter) options.listenerSetter.add(input)('change', onChange);\r\n      else input.addEventListener('change', onChange);\r\n    }\r\n\r\n    let span: HTMLSpanElement;\r\n    if(options.text) {\r\n      span = this.span = document.createElement('span');\r\n      span.classList.add('checkbox-caption');\r\n      _i18n(span, options.text, options.textArgs);\r\n    } else {\r\n      label.classList.add('checkbox-without-caption');\r\n    }\r\n\r\n    label.append(input);\r\n\r\n    if(options.toggle) {\r\n      label.classList.add('checkbox-field-toggle');\r\n\r\n      const toggle = document.createElement('div');\r\n      toggle.classList.add('checkbox-toggle');\r\n      label.append(toggle);\r\n    } else {\r\n      const box = document.createElement('div');\r\n      box.classList.add('checkbox-box');\r\n\r\n      const checkSvg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');\r\n      checkSvg.classList.add('checkbox-box-check');\r\n      checkSvg.setAttributeNS(null, 'viewBox', '0 0 24 24');\r\n      const use = document.createElementNS('http://www.w3.org/2000/svg', 'use');\r\n      use.setAttributeNS(null, 'href', '#check');\r\n      use.setAttributeNS(null, 'x', '-1');\r\n      checkSvg.append(use);\r\n\r\n      const bg = document.createElement('div');\r\n      bg.classList.add('checkbox-box-background');\r\n\r\n      const border = document.createElement('div');\r\n      border.classList.add('checkbox-box-border');\r\n\r\n      box.append(border, bg, checkSvg);\r\n\r\n      label.append(box);\r\n    }\r\n\r\n    if(span) {\r\n      label.append(span);\r\n    }\r\n\r\n    if(options.withRipple) {\r\n      label.classList.add('checkbox-ripple', 'hover-effect');\r\n      ripple(label, undefined, undefined, true);\r\n      // label.prepend(input);\r\n    } else if(options.withHover) {\r\n      label.classList.add('hover-effect');\r\n    }\r\n  }\r\n\r\n  get checked() {\r\n    return this.input.checked;\r\n  }\r\n\r\n  set checked(checked: boolean) {\r\n    /* if(this.checked === checked) {\r\n      return;\r\n    } */\r\n\r\n    this.setValueSilently(checked);\r\n\r\n    const event = new Event('change', {bubbles: true, cancelable: true});\r\n    this.input.dispatchEvent(event);\r\n  }\r\n\r\n  public setValueSilently(checked: boolean) {\r\n    this.input.checked = checked;\r\n  }\r\n\r\n  public toggleDisability(disable: boolean) {\r\n    this.label.classList.toggle('checkbox-disabled', disable);\r\n    return () => this.toggleDisability(!disable);\r\n  }\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport InputField, {InputFieldOptions} from './inputField';\r\n\r\nexport default class CodeInputField extends InputField {\r\n  constructor(options: InputFieldOptions & {\r\n    length: number,\r\n    onFill: (code: string) => void\r\n  }) {\r\n    super({\r\n      plainText: true,\r\n      ...options\r\n    });\r\n\r\n    const input = this.input as HTMLInputElement;\r\n    input.type = 'tel';\r\n    input.setAttribute('required', '');\r\n    input.autocomplete = 'off';\r\n\r\n    let lastLength = 0;\r\n    this.input.addEventListener('input', (e) => {\r\n      this.input.classList.remove('error');\r\n      this.setLabel();\r\n\r\n      const value = this.value.replace(/\\D/g, '').slice(0, options.length);\r\n      this.setValueSilently(value);\r\n\r\n      const length = this.value.length;\r\n      if(length === options.length) { // submit code\r\n        options.onFill(this.value);\r\n      } else if(length === lastLength) {\r\n        return;\r\n      }\r\n\r\n      lastLength = length;\r\n    });\r\n  }\r\n}\r\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport {addCancelButton} from './popups';\nimport PopupPeer, {PopupPeerOptions} from './popups/peer';\n\n// type PopupConfirmationOptions = Pick<PopupPeerOptions, 'titleLangKey'>;\nexport type PopupConfirmationOptions = PopupPeerOptions & {\n  button: PopupPeerOptions['buttons'][0],\n  checkbox?: PopupPeerOptions['checkboxes'][0]\n};\n\nexport default function confirmationPopup(options: PopupConfirmationOptions) {\n  return new Promise<boolean | void>((resolve, reject) => {\n    const {button, checkbox} = options;\n    button.callback = (set) => {\n      resolve(set ? !!set.size : undefined);\n    };\n\n    const buttons = addCancelButton(options.buttons || [button]);\n    const cancelButton = buttons.find((button) => button.isCancel);\n    cancelButton.callback = () => {\n      reject();\n    };\n\n    options.buttons = buttons;\n    options.checkboxes ??= checkbox && [checkbox];\n\n    new PopupPeer('popup-confirmation', options).show();\n  });\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport IS_EMOJI_SUPPORTED from '../environment/emojiSupport';\nimport cancelEvent from '../helpers/dom/cancelEvent';\nimport simulateEvent from '../helpers/dom/dispatchEvent';\nimport findUpClassName from '../helpers/dom/findUpClassName';\nimport findUpTag from '../helpers/dom/findUpTag';\nimport replaceContent from '../helpers/dom/replaceContent';\nimport setInnerHTML from '../helpers/dom/setInnerHTML';\nimport fastSmoothScroll from '../helpers/fastSmoothScroll';\nimport {randomLong} from '../helpers/random';\nimport {HelpCountry, HelpCountryCode} from '../layer';\nimport I18n, {i18n} from '../lib/langPack';\nimport wrapEmojiText from '../lib/richTextProcessor/wrapEmojiText';\nimport rootScope from '../lib/rootScope';\nimport {getCountryEmoji} from '../vendor/emoji';\nimport InputField, {InputFieldOptions} from './inputField';\nimport Scrollable from './scrollable';\n\nlet countries: HelpCountry.helpCountry[];\nconst setCountries = () => {\n  countries = I18n.countriesList\n  .filter((country) => !country.pFlags?.hidden)\n  .sort((a, b) => (a.name || a.default_name).localeCompare(b.name || b.default_name));\n};\n\nlet init = () => {\n  setCountries();\n  rootScope.addEventListener('language_change', () => {\n    setCountries();\n  });\n};\n\nexport default class CountryInputField extends InputField {\n  private lastCountrySelected: HelpCountry;\n  private lastCountryCodeSelected: HelpCountryCode;\n\n  private hideTimeout: number;\n  private selectWrapper: HTMLElement;\n\n  private liMap: Map<string, HTMLLIElement[]>;\n\n  constructor(public options: InputFieldOptions & {\n    onCountryChange?: (country: HelpCountry.helpCountry, code: HelpCountryCode.helpCountryCode) => void,\n    noPhoneCodes?: boolean\n  } = {}) {\n    super({\n      label: 'Country',\n      name: randomLong(),\n      ...options\n    });\n\n    if(init) {\n      init();\n      init = undefined;\n    }\n\n    this.liMap = new Map();\n\n    this.container.classList.add('input-select');\n\n    const selectWrapper = this.selectWrapper = document.createElement('div');\n    selectWrapper.classList.add('select-wrapper', 'z-depth-3', 'hide');\n\n    const arrowDown = document.createElement('span');\n    arrowDown.classList.add('arrow', 'arrow-down');\n    this.container.append(arrowDown);\n\n    const selectList = document.createElement('ul');\n    selectWrapper.appendChild(selectList);\n\n    const scroll = new Scrollable(selectWrapper);\n\n    let initSelect = () => {\n      initSelect = null;\n\n      countries.forEach((c) => {\n        const emoji = getCountryEmoji(c.iso2);\n\n        const liArr: Array<HTMLLIElement> = [];\n        for(let i = 0, length = Math.min(c.country_codes.length, options.noPhoneCodes ? 1 : Infinity); i < length; ++i) {\n          const countryCode = c.country_codes[i];\n          const li = document.createElement('li');\n\n          const wrapped = wrapEmojiText(emoji);\n          if(IS_EMOJI_SUPPORTED) {\n            const spanEmoji = document.createElement('span');\n            setInnerHTML(spanEmoji, wrapped);\n            li.append(spanEmoji);\n          } else {\n            setInnerHTML(li, wrapped);\n          }\n\n          const el = i18n(c.default_name as any);\n          el.dataset.defaultName = c.default_name;\n          li.append(el);\n\n          if(!options.noPhoneCodes) {\n            const span = document.createElement('span');\n            span.classList.add('phone-code');\n            span.innerText = '+' + countryCode.country_code;\n            li.appendChild(span);\n          }\n\n          liArr.push(li);\n          selectList.append(li);\n        }\n\n        this.liMap.set(c.iso2, liArr);\n      });\n\n      selectList.addEventListener('mousedown', (e) => {\n        if(e.button !== 0) { // other buttons but left shall not pass\n          return;\n        }\n\n        const target = findUpTag(e.target, 'LI')\n        this.selectCountryByTarget(target);\n        // console.log('clicked', e, countryName, phoneCode);\n      });\n\n      this.container.appendChild(selectWrapper);\n    };\n\n    initSelect();\n\n    this.input.addEventListener('focus', (e) => {\n      if(initSelect) {\n        initSelect();\n      } else {\n        countries.forEach((c) => {\n          this.liMap.get(c.iso2).forEach((li) => li.style.display = '');\n        });\n      }\n\n      clearTimeout(this.hideTimeout);\n      this.hideTimeout = undefined;\n\n      selectWrapper.classList.remove('hide');\n      void selectWrapper.offsetWidth; // reflow\n      selectWrapper.classList.add('active');\n\n      this.select();\n\n      fastSmoothScroll({\n        // container: page.pageEl.parentElement.parentElement,\n        container: findUpClassName(this.container, 'scrollable-y'),\n        element: this.input,\n        position: 'start',\n        margin: 4\n      });\n\n      setTimeout(() => {\n        if(!mouseDownHandlerAttached) {\n          document.addEventListener('mousedown', onMouseDown, {capture: true});\n          mouseDownHandlerAttached = true;\n        }\n      }, 0);\n    });\n\n    let mouseDownHandlerAttached = false;\n    const onMouseDown = (e: MouseEvent) => {\n      if(findUpClassName(e.target, 'input-select')) {\n        return;\n      }\n      if(e.target === this.input) {\n        return;\n      }\n\n      this.hidePicker();\n      document.removeEventListener('mousedown', onMouseDown, {capture: true});\n      mouseDownHandlerAttached = false;\n    };\n\n    /* false && this.input.addEventListener('blur', function(this: typeof this.input, e) {\n      hidePicker();\n\n      e.cancelBubble = true;\n    }, {capture: true}); */\n\n    const onKeyPress = (e: KeyboardEvent) => {\n      const key = e.key;\n      if(e.ctrlKey || key === 'Control') return false;\n\n      // let i = new RegExp('^' + this.value, 'i');\n      const _value = this.value.toLowerCase();\n      const matches: HelpCountry[] = [];\n      countries.forEach((c) => {\n        const names = [\n          c.name,\n          c.default_name,\n          c.iso2\n        ];\n\n        names.filter(Boolean).forEach((name) => {\n          const abbr = name.split(' ').filter((word) => /\\w/.test(word)).map((word) => word[0]).join('');\n          if(abbr.length > 1) {\n            names.push(abbr);\n          }\n        });\n\n        const good = !!names.filter(Boolean).find((str) => str.toLowerCase().indexOf(_value) !== -1)/*  === 0 */;// i.test(c.name);\n\n        this.liMap.get(c.iso2).forEach((li) => li.style.display = good ? '' : 'none');\n        if(good) matches.push(c);\n      });\n\n      //           \n      /* if(matches.length === 1 && matches[0].li.length === 1) {\n        if(matches[0].name === lastCountrySelected) return false;\n        //console.log('clicking', matches[0]);\n\n        var clickEvent = document.createEvent('MouseEvents');\n        clickEvent.initEvent('mousedown', true, true);\n        matches[0].li[0].dispatchEvent(clickEvent);\n        return false;\n      } else  */if(matches.length === 0) {\n        countries.forEach((c) => {\n          this.liMap.get(c.iso2).forEach((li) => li.style.display = '');\n        });\n      } else if(matches.length === 1 && key === 'Enter') {\n        cancelEvent(e);\n        this.selectCountryByTarget(this.liMap.get(matches[0].iso2)[0]);\n      }\n    };\n\n    this.input.addEventListener('keyup', onKeyPress);\n    this.input.addEventListener('keydown', (e) => {\n      if(e.key === 'Enter') {\n        onKeyPress(e);\n      }\n    });\n\n    arrowDown.addEventListener('mousedown', (e) => {\n      if(this.input.matches(':focus')) {\n        this.hidePicker();\n        this.input.blur();\n      } else {\n        e.cancelBubble = true;\n        e.preventDefault();\n        this.input.focus();\n      }\n    });\n  }\n\n  public getSelected() {\n    return {country: this.lastCountrySelected, code: this.lastCountryCodeSelected};\n  }\n\n  public hidePicker = () => {\n    if(this.hideTimeout !== undefined) return;\n    this.selectWrapper.classList.remove('active');\n    this.hideTimeout = window.setTimeout(() => {\n      this.selectWrapper.classList.add('hide');\n      this.hideTimeout = undefined;\n    }, 200);\n  }\n\n  public selectCountryByTarget = (target: HTMLElement) => {\n    const defaultName = target.querySelector<HTMLElement>('[data-default-name]').dataset.defaultName;\n    const phoneCodeEl = target.querySelector<HTMLElement>('.phone-code');\n    const phoneCode = phoneCodeEl?.innerText;\n    const countryCode = phoneCode && phoneCode.replace(/\\D/g, '');\n\n    replaceContent(this.input, i18n(defaultName as any));\n    simulateEvent(this.input, 'input');\n    this.lastCountrySelected = countries.find((c) => c.default_name === defaultName);\n    this.lastCountryCodeSelected = countryCode && this.lastCountrySelected.country_codes.find((_countryCode) => _countryCode.country_code === countryCode);\n\n    this.options.onCountryChange?.(this.lastCountrySelected, this.lastCountryCodeSelected);\n    this.hidePicker();\n  }\n\n  public selectCountryByIso2(iso2: string) {\n    this.selectCountryByTarget(this.liMap.get(iso2)[0]);\n  }\n\n  public override(country: HelpCountry, code: HelpCountryCode, countryName?: string) {\n    replaceContent(this.input, country ? i18n(country.default_name as any) : countryName);\n    this.lastCountrySelected = country;\n    this.lastCountryCodeSelected = code;\n    this.options.onCountryChange?.(this.lastCountrySelected, this.lastCountryCodeSelected);\n  }\n}\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nexport default class DivAndCaption<T> {\r\n  public container: HTMLElement;\r\n  public border: HTMLElement;\r\n  public content: HTMLElement;\r\n  public title: HTMLElement;\r\n  public subtitle: HTMLElement;\r\n\r\n  constructor(protected className: string, public fill?: T) {\r\n    this.container = document.createElement('div');\r\n    this.container.className = className;\r\n\r\n    this.border = document.createElement('div');\r\n    this.border.classList.add(className + '-border');\r\n\r\n    this.content = document.createElement('div');\r\n    this.content.classList.add(className + '-content');\r\n\r\n    this.title = document.createElement('div');\r\n    this.title.classList.add(className + '-title');\r\n    this.title.setAttribute('dir', 'auto');\r\n\r\n    this.subtitle = document.createElement('div');\r\n    this.subtitle.classList.add(className + '-subtitle');\r\n    this.subtitle.setAttribute('dir', 'auto');\r\n\r\n    this.content.append(this.title, this.subtitle);\r\n    this.container.append(this.border, this.content);\r\n  }\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport {InputFile} from '../layer';\r\nimport AvatarEdit from './avatarEdit';\r\nimport AvatarElement from './avatar';\r\nimport InputField from './inputField';\r\nimport ListenerSetter from '../helpers/listenerSetter';\r\nimport ButtonCorner from './buttonCorner';\r\nimport safeAssign from '../helpers/object/safeAssign';\r\n\r\nexport default class EditPeer {\r\n  public nextBtn: HTMLButtonElement;\r\n\r\n  public uploadAvatar: () => Promise<InputFile>;\r\n  public avatarEdit: AvatarEdit;\r\n  public avatarElem: AvatarElement;\r\n\r\n  private inputFields: InputField[];\r\n  private listenerSetter: ListenerSetter;\r\n\r\n  private peerId: PeerId;\r\n\r\n  private _disabled = false;\r\n  private avatarSize = 120;\r\n\r\n  constructor(options: {\r\n    peerId?: EditPeer['peerId'],\r\n    inputFields: EditPeer['inputFields'],\r\n    listenerSetter: ListenerSetter,\r\n    doNotEditAvatar?: boolean,\r\n    withoutAvatar?: boolean,\r\n    nextBtn?: HTMLButtonElement,\r\n    avatarSize?: number\r\n  }) {\r\n    safeAssign(this, options);\r\n\r\n    if(!this.nextBtn) {\r\n      this.nextBtn = ButtonCorner({icon: 'check'});\r\n    } else if(!this.nextBtn.classList.contains('btn-corner')) {\r\n      this.handleChange = () => {\r\n        this.nextBtn.toggleAttribute('disabled', !this.isChanged() || this.disabled);\r\n      };\r\n    }\r\n\r\n    if(!options.withoutAvatar) {\r\n      this.avatarElem = document.createElement('avatar-element') as AvatarElement;\r\n      this.avatarElem.classList.add('avatar-placeholder', 'avatar-' + this.avatarSize);\r\n      this.avatarElem.updateWithOptions({peerId: this.peerId});\r\n\r\n      if(!options.doNotEditAvatar) {\r\n        this.avatarEdit = new AvatarEdit((_upload) => {\r\n          this.uploadAvatar = _upload;\r\n          this.handleChange();\r\n          this.avatarElem.remove();\r\n        });\r\n\r\n        this.avatarEdit.container.append(this.avatarElem);\r\n      }\r\n    }\r\n\r\n    this.inputFields.forEach((inputField) => {\r\n      this.listenerSetter.add(inputField.input)('input', this.handleChange);\r\n    });\r\n\r\n    this.handleChange();\r\n  }\r\n\r\n  public get disabled() {\r\n    return this._disabled;\r\n  }\r\n\r\n  public set disabled(value) {\r\n    this._disabled = value;\r\n    this.inputFields.forEach((inputField) => inputField.input.toggleAttribute('disabled', value));\r\n    this.handleChange();\r\n  }\r\n\r\n  public lockWithPromise(promise: Promise<any>, unlockOnSuccess = false) {\r\n    this.disabled = true;\r\n    promise.then(() => {\r\n      if(unlockOnSuccess) {\r\n        this.disabled = false;\r\n      }\r\n    }, () => {\r\n      this.disabled = false;\r\n    });\r\n  }\r\n\r\n  public isChanged = () => {\r\n    if(this.uploadAvatar) {\r\n      return true;\r\n    }\r\n\r\n    let changedLength = 0, requiredLength = 0, requiredValidLength = 0;\r\n    this.inputFields.forEach((inputField) => {\r\n      if(inputField.isValid()) {\r\n        if(inputField.isChanged()) {\r\n          ++changedLength;\r\n        }\r\n\r\n        if(inputField.required) {\r\n          ++requiredValidLength;\r\n        }\r\n      }\r\n\r\n      if(inputField.required) {\r\n        ++requiredLength;\r\n      }\r\n    });\r\n\r\n    return requiredLength === requiredValidLength && changedLength > 0;\r\n  };\r\n\r\n  public handleChange = () => {\r\n    this.nextBtn.classList.toggle('is-visible', this.isChanged());\r\n  };\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport emoticonsDropdown, {EmoticonsDropdown, EmoticonsTab, EMOTICONSSTICKERGROUP} from '..';\r\nimport GifsMasonry from '../../gifsMasonry';\r\nimport Scrollable from '../../scrollable';\r\nimport {putPreloader} from '../../putPreloader';\r\nimport {AppManagers} from '../../../lib/appManagers/managers';\r\nimport {attachClickEvent} from '../../../helpers/dom/clickEvent';\r\n\r\nexport default class GifsTab implements EmoticonsTab {\r\n  private content: HTMLElement;\r\n\r\n  constructor(private managers: AppManagers) {\r\n\r\n  }\r\n\r\n  init() {\r\n    this.content = document.getElementById('content-gifs');\r\n    const gifsContainer = this.content.firstElementChild as HTMLDivElement;\r\n    attachClickEvent(gifsContainer, EmoticonsDropdown.onMediaClick);\r\n\r\n    const scroll = new Scrollable(this.content, 'GIFS');\r\n    const masonry = new GifsMasonry(gifsContainer, EMOTICONSSTICKERGROUP, scroll);\r\n    const preloader = putPreloader(this.content, true);\r\n\r\n    this.managers.appDocsManager.getGifs().then((docs) => {\r\n      docs.forEach((doc) => {\r\n        masonry.add(doc);\r\n      });\r\n\r\n      preloader.remove();\r\n    });\r\n\r\n    emoticonsDropdown.addLazyLoadQueueRepeat(masonry.lazyLoadQueue, masonry.processInvisibleDiv);\r\n\r\n    this.init = null;\r\n  }\r\n\r\n  onClose() {\r\n\r\n  }\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport {SliderSuperTab} from '../../slider';\r\nimport InputSearch from '../../inputSearch';\r\nimport animationIntersector, {AnimationItemGroup} from '../../animationIntersector';\r\nimport appSidebarRight from '..';\r\nimport {AppInlineBotsManager} from '../../../lib/appManagers/appInlineBotsManager';\r\nimport GifsMasonry from '../../gifsMasonry';\r\nimport appImManager from '../../../lib/appManagers/appImManager';\r\nimport type {MyDocument} from '../../../lib/appManagers/appDocsManager';\r\nimport mediaSizes from '../../../helpers/mediaSizes';\r\nimport findUpClassName from '../../../helpers/dom/findUpClassName';\r\nimport {attachClickEvent} from '../../../helpers/dom/clickEvent';\r\nimport {NULL_PEER_ID} from '../../../lib/mtproto/mtproto_config';\r\n\r\nconst ANIMATIONGROUP: AnimationItemGroup = 'GIFS-SEARCH';\r\n\r\nexport default class AppGifsTab extends SliderSuperTab {\r\n  private inputSearch: InputSearch;\r\n  private gifsDiv: HTMLDivElement;\r\n\r\n  private nextOffset = '';\r\n  private loadedAll = false;\r\n\r\n  private gifBotPeerId: PeerId;\r\n  private masonry: GifsMasonry;\r\n\r\n  private searchPromise: ReturnType<AppInlineBotsManager['getInlineResults']>;\r\n\r\n  protected init() {\r\n    this.container.id = 'search-gifs-container';\r\n\r\n    this.inputSearch = new InputSearch('SearchGifsTitle', (value) => {\r\n      this.reset();\r\n      this.search(value);\r\n    });\r\n\r\n    this.title.replaceWith(this.inputSearch.container);\r\n\r\n    this.gifsDiv = document.createElement('div');\r\n    this.gifsDiv.classList.add('gifs-masonry');\r\n    attachClickEvent(this.gifsDiv, this.onGifsClick, {listenerSetter: this.listenerSetter});\r\n\r\n    this.scrollable.append(this.gifsDiv);\r\n\r\n    this.masonry = new GifsMasonry(this.gifsDiv, ANIMATIONGROUP, this.scrollable);\r\n    // this.backBtn.parentElement.append(this.inputSearch.container);\r\n  }\r\n\r\n  private onGifsClick = async(e: MouseEvent | TouchEvent) => {\r\n    const target = findUpClassName(e.target, 'gif');\r\n    if(!target) return;\r\n\r\n    const fileId = target.dataset.docId;\r\n    if(await appImManager.chat.input.sendMessageWithDocument(fileId)) {\r\n      if(mediaSizes.isMobile) {\r\n        appSidebarRight.onCloseBtnClick();\r\n      }\r\n    } else {\r\n      console.warn('got no doc by id:', fileId);\r\n    }\r\n  };\r\n\r\n  public onClose() {\r\n    this.scrollable.onScrolledBottom = () => {};\r\n  }\r\n\r\n  public onCloseAfterTimeout() {\r\n    this.reset();\r\n    this.gifsDiv.innerHTML = '';\r\n    animationIntersector.checkAnimations(undefined, ANIMATIONGROUP);\r\n    this.inputSearch.remove();\r\n    return super.onCloseAfterTimeout();\r\n  }\r\n\r\n  private reset() {\r\n    this.searchPromise = null;\r\n    this.nextOffset = '';\r\n    this.loadedAll = false;\r\n    this.masonry.clear();\r\n  }\r\n\r\n  public open() {\r\n    const ret = super.open();\r\n    appSidebarRight.toggleSidebar(true).then(() => {\r\n      this.search('', true);\r\n\r\n      this.scrollable.onScrolledBottom = () => {\r\n        this.search(this.inputSearch.value, false);\r\n      };\r\n    });\r\n    return ret;\r\n  }\r\n\r\n  public async search(query: string, newSearch = true) {\r\n    if(this.searchPromise || this.loadedAll) return;\r\n\r\n    if(!this.gifBotPeerId) {\r\n      this.gifBotPeerId = (await this.managers.appUsersManager.resolveUsername('gif')).id.toPeerId(false);\r\n    }\r\n\r\n    try {\r\n      this.searchPromise = this.managers.appInlineBotsManager.getInlineResults(NULL_PEER_ID, this.gifBotPeerId, query, this.nextOffset);\r\n      const {results, next_offset} = await this.searchPromise;\r\n\r\n      if(this.inputSearch.value !== query) {\r\n        return;\r\n      }\r\n\r\n      this.searchPromise = null;\r\n      this.nextOffset = next_offset;\r\n      if(newSearch) {\r\n        this.gifsDiv.innerHTML = '';\r\n      }\r\n\r\n      if(results.length) {\r\n        results.forEach((result) => {\r\n          if(result._ === 'botInlineMediaResult' && result.document) {\r\n            this.masonry.add(result.document as MyDocument);\r\n          }\r\n        });\r\n      } else {\r\n        this.loadedAll = true;\r\n      }\r\n\r\n      this.scrollable.onScroll();\r\n    } catch(err) {\r\n      this.searchPromise = null;\r\n      console.error('gifs loading error:', err);\r\n      throw err;\r\n    }\r\n  }\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport {SliderSuperTab} from '../../slider';\r\nimport InputSearch from '../../inputSearch';\r\nimport LazyLoadQueue from '../../lazyLoadQueue';\r\nimport appImManager from '../../../lib/appManagers/appImManager';\r\nimport PopupStickers from '../../popups/stickers';\r\nimport animationIntersector from '../../animationIntersector';\r\nimport {wrapSticker} from '../../wrappers';\r\nimport appSidebarRight from '..';\r\nimport {StickerSet, StickerSetCovered} from '../../../layer';\r\nimport {i18n} from '../../../lib/langPack';\r\nimport findUpClassName from '../../../helpers/dom/findUpClassName';\r\nimport {attachClickEvent} from '../../../helpers/dom/clickEvent';\r\nimport forEachReverse from '../../../helpers/array/forEachReverse';\r\nimport setInnerHTML from '../../../helpers/dom/setInnerHTML';\r\nimport wrapEmojiText from '../../../lib/richTextProcessor/wrapEmojiText';\r\nimport attachStickerViewerListeners from '../../stickerViewer';\r\n\r\nexport default class AppStickersTab extends SliderSuperTab {\r\n  private inputSearch: InputSearch;\r\n  private setsDiv: HTMLDivElement;\r\n  private lazyLoadQueue: LazyLoadQueue;\r\n\r\n  protected init() {\r\n    this.container.id = 'stickers-container';\r\n    this.container.classList.add('chatlist-container');\r\n\r\n    this.lazyLoadQueue = new LazyLoadQueue();\r\n\r\n    this.inputSearch = new InputSearch('StickersTab.SearchPlaceholder', (value) => {\r\n      this.search(value);\r\n    });\r\n\r\n    this.title.replaceWith(this.inputSearch.container);\r\n\r\n    this.setsDiv = document.createElement('div');\r\n    this.setsDiv.classList.add('sticker-sets');\r\n    this.scrollable.append(this.setsDiv);\r\n\r\n    attachStickerViewerListeners({listenTo: this.setsDiv, listenerSetter: this.listenerSetter});\r\n\r\n    attachClickEvent(this.setsDiv, (e) => {\r\n      const sticker = findUpClassName(e.target, 'sticker-set-sticker');\r\n      if(sticker) {\r\n        const docId = sticker.dataset.docId;\r\n        appImManager.chat.input.sendMessageWithDocument(docId);\r\n        return;\r\n      }\r\n\r\n      const target = findUpClassName(e.target, 'sticker-set');\r\n      if(!target) return;\r\n\r\n      const id = target.dataset.stickerSet as string;\r\n      const access_hash = target.dataset.access_hash as string;\r\n\r\n      const button = findUpClassName(e.target, 'sticker-set-button') as HTMLElement;\r\n      if(button) {\r\n        e.preventDefault();\r\n        e.cancelBubble = true;\r\n\r\n        button.setAttribute('disabled', 'true');\r\n\r\n        this.managers.appStickersManager.getStickerSet({id, access_hash}).then((full) => {\r\n          this.managers.appStickersManager.toggleStickerSet(full.set).then((changed) => {\r\n            if(changed) {\r\n              button.textContent = '';\r\n              button.append(i18n(full.set.installed_date ? 'Stickers.SearchAdded' : 'Stickers.SearchAdd'));\r\n              button.classList.toggle('gray', !!full.set.installed_date);\r\n            }\r\n          }).finally(() => {\r\n            // button.style.width = set.installed_date ? '68px' : '52px';\r\n            button.removeAttribute('disabled');\r\n          });\r\n        });\r\n      } else {\r\n        this.managers.appStickersManager.getStickerSet({id, access_hash}).then((full) => {\r\n          new PopupStickers(full.set).show();\r\n        });\r\n      }\r\n    }, {listenerSetter: this.listenerSetter});\r\n  }\r\n\r\n  public onCloseAfterTimeout() {\r\n    this.setsDiv.innerHTML = '';\r\n    animationIntersector.checkAnimations(undefined, 'STICKERS-SEARCH');\r\n    return super.onCloseAfterTimeout();\r\n  }\r\n\r\n  public renderSet(set: StickerSet.stickerSet) {\r\n    // console.log('renderSet:', set);\r\n    const div = document.createElement('div');\r\n    div.classList.add('sticker-set');\r\n\r\n    const header = document.createElement('div');\r\n    header.classList.add('sticker-set-header');\r\n\r\n    const details = document.createElement('div');\r\n    details.classList.add('sticker-set-details');\r\n    details.innerHTML = `<div class=\"sticker-set-name\"></div>`;\r\n\r\n    setInnerHTML(details.firstElementChild, wrapEmojiText(set.title));\r\n\r\n    const countDiv = document.createElement('div');\r\n    countDiv.classList.add('sticker-set-count');\r\n    countDiv.append(i18n('Stickers', [set.count]));\r\n    details.append(countDiv);\r\n\r\n    const button = document.createElement('button');\r\n    button.classList.add('btn-primary', 'btn-color-primary', 'sticker-set-button');\r\n    button.append(i18n(set.installed_date ? 'Stickers.SearchAdded' : 'Stickers.SearchAdd'));\r\n    // button.style.width = set.installed_date ? '68px' : '52px';\r\n\r\n    if(set.installed_date) {\r\n      button.classList.add('gray');\r\n    }\r\n\r\n    // ripple(button);\r\n\r\n    header.append(details, button);\r\n\r\n    const stickersDiv = document.createElement('div');\r\n    stickersDiv.classList.add('sticker-set-stickers');\r\n\r\n    const count = Math.min(5, set.count);\r\n    for(let i = 0; i < count; ++i) {\r\n      const stickerDiv = document.createElement('div');\r\n      stickerDiv.classList.add('sticker-set-sticker');\r\n\r\n      stickersDiv.append(stickerDiv);\r\n    }\r\n\r\n    this.managers.appStickersManager.getStickerSet(set).then((set) => {\r\n      // console.log('renderSet got set:', set);\r\n\r\n      for(let i = 0; i < count; ++i) {\r\n        const div = stickersDiv.children[i] as HTMLDivElement;\r\n        const doc = set.documents[i];\r\n        if(doc._ === 'documentEmpty') {\r\n          continue;\r\n        }\r\n\r\n        wrapSticker({\r\n          doc,\r\n          div,\r\n          lazyLoadQueue: this.lazyLoadQueue,\r\n          group: 'STICKERS-SEARCH',\r\n          /* play: false,\r\n          loop: false, */\r\n          play: true,\r\n          loop: true,\r\n          width: 68,\r\n          height: 68,\r\n          withLock: true\r\n        });\r\n      }\r\n    });\r\n\r\n    /* const onMouseOver = () => {\r\n      const animations: AnimationItem['animation'][] = [];\r\n      for(let i = 0; i < count; ++i) {\r\n        const stickerDiv = stickersDiv.children[i] as HTMLElement;\r\n        const animationItem = animationIntersector.getAnimation(stickerDiv);\r\n        if(!animationItem) continue;\r\n\r\n        const animation = animationItem.animation;\r\n\r\n        animations.push(animation);\r\n        animation.loop = true;\r\n        animation.play();\r\n      }\r\n\r\n      div.addEventListener('mouseout', () => {\r\n        animations.forEach((animation) => {\r\n          animation.loop = false;\r\n        });\r\n\r\n        div.addEventListener('mouseover', onMouseOver, {once: true});\r\n      }, {once: true});\r\n    };\r\n\r\n    div.addEventListener('mouseover', onMouseOver, {once: true}); */\r\n\r\n    div.dataset.stickerSet = '' + set.id;\r\n    div.dataset.access_hash = '' + set.access_hash;\r\n    div.dataset.title = set.title;\r\n\r\n    div.append(header, stickersDiv);\r\n\r\n    this.setsDiv.append(div);\r\n  }\r\n\r\n  public open() {\r\n    const ret = super.open();\r\n    appSidebarRight.toggleSidebar(true).then(() => {\r\n      this.renderFeatured();\r\n    });\r\n\r\n    return ret;\r\n  }\r\n\r\n  public renderFeatured() {\r\n    return this.managers.appStickersManager.getFeaturedStickers().then((coveredSets) => {\r\n      if(this.inputSearch.value) {\r\n        return;\r\n      }\r\n\r\n      coveredSets = this.filterRendered('', coveredSets);\r\n      coveredSets.forEach((set) => {\r\n        this.renderSet(set.set);\r\n      });\r\n    });\r\n  }\r\n\r\n  private filterRendered(query: string, coveredSets: StickerSetCovered[]) {\r\n    coveredSets = coveredSets.slice();\r\n\r\n    const children = Array.from(this.setsDiv.children) as HTMLElement[];\r\n    forEachReverse(children, el => {\r\n      const id = el.dataset.stickerSet;\r\n      const index = coveredSets.findIndex((covered) => covered.set.id === id);\r\n\r\n      if(index !== -1) {\r\n        coveredSets.splice(index, 1);\r\n      } else if(!query || !el.dataset.title.toLowerCase().includes(query.toLowerCase())) {\r\n        el.remove();\r\n      }\r\n    });\r\n\r\n    animationIntersector.checkAnimations(undefined, 'STICKERS-SEARCH');\r\n\r\n    return coveredSets;\r\n  }\r\n\r\n  public search(query: string) {\r\n    if(!query) {\r\n      return this.renderFeatured();\r\n    }\r\n\r\n    return this.managers.appStickersManager.searchStickerSets(query, false).then((coveredSets) => {\r\n      if(this.inputSearch.value !== query) {\r\n        return;\r\n      }\r\n\r\n      // console.log('search result:', coveredSets);\r\n\r\n      coveredSets = this.filterRendered(query, coveredSets);\r\n      coveredSets.forEach((set) => {\r\n        this.renderSet(set.set);\r\n      });\r\n    });\r\n  }\r\n}\r\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport IS_TOUCH_SUPPORTED from '../../environment/touchSupport';\nimport appImManager from '../../lib/appManagers/appImManager';\nimport rootScope from '../../lib/rootScope';\nimport animationIntersector, {AnimationItemGroup} from '../animationIntersector';\nimport {horizontalMenu} from '../horizontalMenu';\nimport LazyLoadQueue from '../lazyLoadQueue';\nimport Scrollable, {ScrollableX} from '../scrollable';\nimport appSidebarRight from '../sidebarRight';\nimport StickyIntersector from '../stickyIntersector';\nimport EmojiTab from './tabs/emoji';\nimport GifsTab from './tabs/gifs';\nimport StickersTab from './tabs/stickers';\nimport {MOUNT_CLASS_TO} from '../../config/debug';\nimport AppGifsTab from '../sidebarRight/tabs/gifs';\nimport AppStickersTab from '../sidebarRight/tabs/stickers';\nimport findUpClassName from '../../helpers/dom/findUpClassName';\nimport findUpTag from '../../helpers/dom/findUpTag';\nimport blurActiveElement from '../../helpers/dom/blurActiveElement';\nimport whichChild from '../../helpers/dom/whichChild';\nimport cancelEvent from '../../helpers/dom/cancelEvent';\nimport DropdownHover from '../../helpers/dropdownHover';\nimport pause from '../../helpers/schedulers/pause';\nimport {IS_APPLE_MOBILE} from '../../environment/userAgent';\nimport {AppManagers} from '../../lib/appManagers/managers';\nimport type LazyLoadQueueIntersector from '../lazyLoadQueueIntersector';\nimport {simulateClickEvent} from '../../helpers/dom/clickEvent';\nimport overlayCounter from '../../helpers/overlayCounter';\n\nexport const EMOTICONSSTICKERGROUP: AnimationItemGroup = 'emoticons-dropdown';\n\nexport interface EmoticonsTab {\n  init: () => void,\n  onCloseAfterTimeout?: () => void\n}\n\nexport class EmoticonsDropdown extends DropdownHover {\n  public static lazyLoadQueue = new LazyLoadQueue();\n\n  private emojiTab: EmojiTab;\n  public stickersTab: StickersTab;\n  private gifsTab: GifsTab;\n\n  private container: HTMLElement;\n  private tabsEl: HTMLElement;\n  private tabId = -1;\n\n  private tabs: {[id: number]: EmoticonsTab};\n\n  private searchButton: HTMLElement;\n  private deleteBtn: HTMLElement;\n\n  private selectTab: ReturnType<typeof horizontalMenu>;\n\n  private savedRange: Range;\n  private managers: AppManagers;\n\n  constructor() {\n    super({\n      element: document.getElementById('emoji-dropdown') as HTMLDivElement\n    });\n\n    this.addEventListener('open', async() => {\n      if(IS_TOUCH_SUPPORTED) {\n        // appImManager.chat.input.saveScroll();\n        if(blurActiveElement()) {\n          await pause(100);\n        }\n      }\n\n      if(this.element.parentElement !== appImManager.chat.input.chatInput) {\n        appImManager.chat.input.chatInput.append(this.element);\n      }\n\n      this.savedRange = this.getGoodRange();\n\n      EmoticonsDropdown.lazyLoadQueue.lock();\n      // EmoticonsDropdown.lazyLoadQueue.unlock();\n      animationIntersector.lockIntersectionGroup(EMOTICONSSTICKERGROUP);\n    });\n\n    this.addEventListener('opened', () => {\n      animationIntersector.unlockIntersectionGroup(EMOTICONSSTICKERGROUP);\n      EmoticonsDropdown.lazyLoadQueue.unlock();\n      EmoticonsDropdown.lazyLoadQueue.refresh();\n\n      // this.container.classList.remove('disable-hover');\n    });\n\n    this.addEventListener('close', () => {\n      EmoticonsDropdown.lazyLoadQueue.lock();\n      // EmoticonsDropdown.lazyLoadQueue.lock();\n\n      //      \n      animationIntersector.lockIntersectionGroup(EMOTICONSSTICKERGROUP);\n      animationIntersector.checkAnimations(true, EMOTICONSSTICKERGROUP);\n    });\n\n    this.addEventListener('closed', () => {\n      //    visible,      \n      animationIntersector.unlockIntersectionGroup(EMOTICONSSTICKERGROUP);\n      EmoticonsDropdown.lazyLoadQueue.unlock();\n      EmoticonsDropdown.lazyLoadQueue.refresh();\n\n      // this.container.classList.remove('disable-hover');\n\n      this.savedRange = undefined;\n    });\n  }\n\n  protected init() {\n    this.managers = rootScope.managers;\n    this.emojiTab = new EmojiTab(this.managers);\n    this.stickersTab = new StickersTab(this.managers);\n    this.gifsTab = new GifsTab(this.managers);\n\n    this.tabs = {\n      0: this.emojiTab,\n      1: this.stickersTab,\n      2: this.gifsTab\n    };\n\n    this.container = this.element.querySelector('.emoji-container .tabs-container') as HTMLDivElement;\n    this.tabsEl = this.element.querySelector('.emoji-tabs') as HTMLUListElement;\n    this.selectTab = horizontalMenu(this.tabsEl, this.container, this.onSelectTabClick, () => {\n      const tab = this.tabs[this.tabId];\n      if(tab.init) {\n        tab.init();\n      }\n\n      tab.onCloseAfterTimeout && tab.onCloseAfterTimeout();\n      animationIntersector.checkAnimations(false, EMOTICONSSTICKERGROUP);\n    });\n\n    this.searchButton = this.element.querySelector('.emoji-tabs-search');\n    this.searchButton.addEventListener('click', () => {\n      if(this.tabId === 1) {\n        if(!appSidebarRight.isTabExists(AppStickersTab)) {\n          appSidebarRight.createTab(AppStickersTab).open();\n        }\n      } else {\n        if(!appSidebarRight.isTabExists(AppGifsTab)) {\n          appSidebarRight.createTab(AppGifsTab).open();\n        }\n      }\n    });\n\n    this.deleteBtn = this.element.querySelector('.emoji-tabs-delete');\n    this.deleteBtn.addEventListener('click', (e) => {\n      const input = appImManager.chat.input.messageInput;\n      if((input.lastChild as any)?.tagName) {\n        input.lastElementChild.remove();\n      } else if(input.lastChild) {\n        if(!input.lastChild.textContent.length) {\n          input.lastChild.remove();\n        } else {\n          input.lastChild.textContent = input.lastChild.textContent.slice(0, -1);\n        }\n      }\n\n      const event = new Event('input', {bubbles: true, cancelable: true});\n      appImManager.chat.input.messageInput.dispatchEvent(event);\n      // appSidebarRight.stickersTab.init();\n\n      cancelEvent(e);\n    });\n\n    const HIDE_EMOJI_TAB = IS_APPLE_MOBILE;\n\n    const INIT_TAB_ID = HIDE_EMOJI_TAB ? 1 : 0;\n\n    if(HIDE_EMOJI_TAB) {\n      (this.tabsEl.children[1] as HTMLElement).classList.add('hide');\n    }\n\n    simulateClickEvent(this.tabsEl.children[INIT_TAB_ID + 1] as HTMLElement); // set emoji tab\n    if(this.tabs[INIT_TAB_ID].init) {\n      this.tabs[INIT_TAB_ID].init(); // onTransitionEnd  , ..    \n    }\n\n    if(!IS_TOUCH_SUPPORTED) {\n      let lastMouseMoveEvent: MouseEvent, mouseMoveEventAttached = false;\n      const onMouseMove = (e: MouseEvent) => {\n        lastMouseMoveEvent = e;\n      };\n      overlayCounter.addEventListener('change', (isActive) => {\n        if(isActive) {\n          if(!mouseMoveEventAttached) {\n            document.body.addEventListener('mousemove', onMouseMove);\n            mouseMoveEventAttached = true;\n          }\n        } else if(mouseMoveEventAttached) {\n          document.body.removeEventListener('mousemove', onMouseMove);\n          if(lastMouseMoveEvent) {\n            this.onMouseOut(lastMouseMoveEvent);\n          }\n        }\n      });\n    }\n\n    appImManager.addEventListener('peer_changed', this.checkRights);\n    this.checkRights();\n\n    return super.init();\n  }\n\n  public getElement() {\n    return this.element;\n  }\n\n  private onSelectTabClick = (id: number) => {\n    if(this.tabId === id) {\n      return;\n    }\n\n    animationIntersector.checkAnimations(true, EMOTICONSSTICKERGROUP);\n\n    this.tabId = id;\n    this.searchButton.classList.toggle('hide', this.tabId === 0);\n    this.deleteBtn.classList.toggle('hide', this.tabId !== 0);\n  };\n\n  private checkRights = async() => {\n    const {peerId, threadId} = appImManager.chat;\n    const children = this.tabsEl.children;\n    const tabsElements = Array.from(children) as HTMLElement[];\n\n    const [canSendStickers, canSendGifs] = await Promise.all([\n      this.managers.appMessagesManager.canSendToPeer(peerId, threadId, 'send_stickers'),\n      this.managers.appMessagesManager.canSendToPeer(peerId, threadId, 'send_gifs')\n    ]);\n\n    tabsElements[2].toggleAttribute('disabled', !canSendStickers);\n    tabsElements[3].toggleAttribute('disabled', !canSendGifs);\n\n    const active = this.tabsEl.querySelector('.active');\n    if(active && whichChild(active) !== 1 && (!canSendStickers || !canSendGifs)) {\n      this.selectTab(0, false);\n    }\n  };\n\n  public static menuOnClick = (menu: HTMLElement, scroll: Scrollable, menuScroll?: ScrollableX, prevId = 0) => {\n    let jumpedTo = -1;\n\n    const setActive = (id: number) => {\n      if(id === prevId) {\n        return false;\n      }\n\n      menu.children[prevId].classList.remove('active');\n      menu.children[id].classList.add('active');\n      prevId = id;\n\n      return true;\n    };\n\n    const stickyIntersector = new StickyIntersector(scroll.container, (stuck, target) => {\n      // console.log('sticky scrollTOp', stuck, target, scroll.container.scrollTop);\n\n      if(Math.abs(jumpedTo - scroll.container.scrollTop) <= 1) {\n        return;\n      } else {\n        jumpedTo = -1;\n      }\n\n      const which = whichChild(target);\n      if(!stuck && which) { // * due to stickyIntersector\n        return;\n      }\n\n      setActive(which);\n\n      if(menuScroll) {\n        menuScroll.scrollIntoViewNew({\n          element: menu.children[which] as HTMLElement,\n          position: 'center',\n          axis: 'x'\n        });\n      }\n    });\n\n    menu.addEventListener('click', (e) => {\n      let target = e.target as HTMLElement;\n      target = findUpClassName(target, 'menu-horizontal-div-item');\n\n      if(!target) {\n        return;\n      }\n\n      const which = whichChild(target);\n\n      /* if(menuScroll) {\n        menuScroll.scrollIntoView(target, false, 0);\n      } */\n\n      if(!setActive(which)) {\n        return;\n      }\n\n      const element = (scroll.splitUp || scroll.container).children[which] as HTMLElement;\n      const offsetTop = element.offsetTop + 1; // * due to stickyIntersector\n\n      scroll.container.scrollTop = jumpedTo = offsetTop;\n\n      // console.log('set scrollTop:', offsetTop);\n    });\n\n    return {stickyIntersector, setActive};\n  };\n\n  public static onMediaClick = async(e: {target: EventTarget | Element}, clearDraft = false, silent?: boolean) => {\n    let target = e.target as HTMLElement;\n    target = findUpTag(target, 'DIV');\n\n    if(!target) return false;\n\n    const docId = target.dataset.docId;\n    if(!docId) return false;\n\n    return this.sendDocId(docId, clearDraft, silent);\n  };\n\n  public static async sendDocId(docId: DocId, clearDraft?: boolean, silent?: boolean) {\n    if(await appImManager.chat.input.sendMessageWithDocument(docId, undefined, clearDraft, silent)) {\n      /* dropdown.classList.remove('active');\n      toggleEl.classList.remove('active'); */\n      if(emoticonsDropdown.container) {\n        emoticonsDropdown.forceClose = true;\n        // emoticonsDropdown.container.classList.add('disable-hover');\n        emoticonsDropdown.toggle(false);\n      }\n\n      return true;\n    } else {\n      console.warn('got no doc by id:', docId);\n      return false;\n    }\n  }\n\n  public addLazyLoadQueueRepeat(lazyLoadQueue: LazyLoadQueueIntersector, processInvisibleDiv: (div: HTMLElement) => void) {\n    this.addEventListener('close', () => {\n      lazyLoadQueue.lock();\n    });\n\n    this.addEventListener('closed', () => {\n      const divs = lazyLoadQueue.intersector.getVisible();\n\n      for(const div of divs) {\n        processInvisibleDiv(div);\n      }\n\n      lazyLoadQueue.intersector.clearVisible();\n    });\n\n    this.addEventListener('opened', () => {\n      lazyLoadQueue.unlockAndRefresh();\n    });\n  }\n\n  public getSavedRange() {\n    return this.getGoodRange() || this.savedRange;\n  }\n\n  private getGoodRange() {\n    const sel = document.getSelection();\n    if(sel.rangeCount && document.activeElement === appImManager.chat.input.messageInput) {\n      return sel.getRangeAt(0);\n    }\n  }\n}\n\nconst emoticonsDropdown = new EmoticonsDropdown();\nMOUNT_CLASS_TO.emoticonsDropdown = emoticonsDropdown;\nexport default emoticonsDropdown;\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport emoticonsDropdown, {EmoticonsDropdown, EmoticonsTab} from '..';\nimport cancelEvent from '../../../helpers/dom/cancelEvent';\nimport findUpClassName from '../../../helpers/dom/findUpClassName';\nimport {fastRaf} from '../../../helpers/schedulers';\nimport pause from '../../../helpers/schedulers/pause';\nimport appImManager from '../../../lib/appManagers/appImManager';\nimport {i18n, LangPackKey} from '../../../lib/langPack';\nimport rootScope from '../../../lib/rootScope';\nimport {emojiFromCodePoints} from '../../../vendor/emoji';\nimport {putPreloader} from '../../putPreloader';\nimport Scrollable from '../../scrollable';\nimport StickyIntersector from '../../stickyIntersector';\nimport IS_EMOJI_SUPPORTED from '../../../environment/emojiSupport';\nimport IS_TOUCH_SUPPORTED from '../../../environment/touchSupport';\nimport blurActiveElement from '../../../helpers/dom/blurActiveElement';\nimport Emoji from '../../../config/emoji';\nimport {AppManagers} from '../../../lib/appManagers/managers';\nimport fixEmoji from '../../../lib/richTextProcessor/fixEmoji';\nimport wrapEmojiText from '../../../lib/richTextProcessor/wrapEmojiText';\nimport wrapSingleEmoji from '../../../lib/richTextProcessor/wrapSingleEmoji';\nimport {attachClickEvent} from '../../../helpers/dom/clickEvent';\n\nconst loadedURLs: Set<string> = new Set();\nexport function appendEmoji(emoji: string, container: HTMLElement, prepend = false, unify = false) {\n  // const emoji = details.unified;\n  // const emoji = (details.unified as string).split('-')\n  // .reduce((prev, curr) => prev + String.fromCodePoint(parseInt(curr, 16)), '');\n\n  const spanEmoji = document.createElement('span');\n  spanEmoji.classList.add('super-emoji');\n\n  let kek: DocumentFragment;\n  if(unify && !IS_EMOJI_SUPPORTED) {\n    kek = wrapSingleEmoji(emoji);\n  } else {\n    emoji = fixEmoji(emoji);\n    kek = wrapEmojiText(emoji);\n  }\n\n  /* if(!kek.includes('emoji')) {\n    console.log(emoji, kek, spanEmoji, emoji.length, new TextEncoder().encode(emoji), emojiUnicode(emoji));\n    return;\n  } */\n\n  // console.log(kek);\n\n  spanEmoji.append(kek);\n\n  if(spanEmoji.children.length > 1) {\n    const first = spanEmoji.firstElementChild;\n    spanEmoji.innerHTML = '';\n    spanEmoji.append(first);\n  }\n\n  if(spanEmoji.firstElementChild?.tagName === 'IMG') {\n    const image = spanEmoji.firstElementChild as HTMLImageElement;\n\n    const url = image.src;\n    if(!loadedURLs.has(url)) {\n      image.setAttribute('loading', 'lazy');\n      const placeholder = document.createElement('span');\n      placeholder.classList.add('emoji-placeholder');\n\n      if(rootScope.settings.animationsEnabled) {\n        image.style.opacity = '0';\n        placeholder.style.opacity = '1';\n      }\n\n      image.addEventListener('load', () => {\n        fastRaf(() => {\n          if(rootScope.settings.animationsEnabled) {\n            image.style.opacity = '';\n            placeholder.style.opacity = '';\n          }\n\n          spanEmoji.classList.remove('empty');\n\n          loadedURLs.add(url);\n        });\n      }, {once: true});\n\n      spanEmoji.append(placeholder);\n    }\n  }\n\n  // spanEmoji = spanEmoji.firstElementChild as HTMLSpanElement;\n  // spanEmoji.setAttribute('emoji', emoji);\n  if(prepend) container.prepend(spanEmoji);\n  else container.appendChild(spanEmoji);\n}\n\nexport function getEmojiFromElement(element: HTMLElement) {\n  if(!findUpClassName(element, 'super-emoji')) return '';\n\n  if(element.nodeType === 3) return element.nodeValue;\n  if(element.tagName === 'SPAN' && !element.classList.contains('emoji') && element.firstElementChild) {\n    element = element.firstElementChild as HTMLElement;\n  }\n\n  return element.getAttribute('alt') || element.innerText;\n}\n\nexport default class EmojiTab implements EmoticonsTab {\n  private content: HTMLElement;\n\n  private recentItemsDiv: HTMLElement;\n\n  private scroll: Scrollable;\n  private stickyIntersector: StickyIntersector;\n  private menu: HTMLElement;\n\n  private closeScrollTop = 0;\n  private setMenuActive: (id: number) => boolean;\n\n  constructor(private managers: AppManagers) {\n\n  }\n\n  init() {\n    this.content = document.getElementById('content-emoji') as HTMLDivElement;\n\n    const categories: LangPackKey[] = [\n      'Emoji.SmilesAndPeople',\n      'Emoji.AnimalsAndNature',\n      'Emoji.FoodAndDrink',\n      'Emoji.TravelAndPlaces',\n      'Emoji.ActivityAndSport',\n      'Emoji.Objects',\n      /* 'Emoji.Symbols',  */\n      'Emoji.Flags',\n      'Skin Tones' as any\n    ];\n    const divs: {\n      [category in LangPackKey]?: HTMLDivElement\n    } = {};\n\n    const sorted: Map<LangPackKey, string[]> = new Map([\n      [\n        'Emoji.Recent',\n        []\n      ]\n    ]);\n\n    for(const emoji in Emoji) {\n      const details = Emoji[emoji];\n      const i = '' + details;\n      const category = categories[+i[0] - 1];\n      if(!category) continue; // maybe it's skin tones\n\n      let s = sorted.get(category);\n      if(!s) {\n        s = [];\n        sorted.set(category, s);\n      }\n\n      s[+i.slice(1) || 0] = emoji;\n    }\n\n    // console.log('emoticons sorted:', sorted);\n\n    // Object.keys(sorted).forEach((c) => sorted[c].sort((a, b) => a - b));\n\n    sorted.delete(categories.pop());\n\n    // console.time('emojiParse');\n    sorted.forEach((emojis, category) => {\n      const div = document.createElement('div');\n      div.classList.add('emoji-category');\n\n      const titleDiv = document.createElement('div');\n      titleDiv.classList.add('category-title');\n      titleDiv.append(i18n(category));\n\n      const itemsDiv = document.createElement('div');\n      itemsDiv.classList.add('super-emojis');\n\n      div.append(titleDiv, itemsDiv);\n\n      emojis.forEach((unified) => {\n        /* if(emojiUnicode(emoji) === '1f481-200d-2642') {\n          console.log('append emoji', emoji, emojiUnicode(emoji));\n        } */\n\n        const emoji = emojiFromCodePoints(unified);\n        // if(emoji.includes('')) {\n        // console.log('toCodePoints', toCodePoints(emoji));\n        // emoji = emoji.replace(/(\\u200d[\\u2640\\u2642\\u2695])(?!\\ufe0f)/, '\\ufe0f$1');\n        // const zwjIndex = emoji.indexOf('\\u200d');\n        // if(zwjIndex !== -1 && !emoji.includes('\\ufe0f')) {\n        //   /* if(zwjIndex !== (emoji.length - 1)) {\n        //     emoji = emoji.replace(/(\\u200d)/g, '\\ufe0f$1');\n        //   } */\n\n        //   emoji += '\\ufe0f';\n        //   //emoji += '\\ufe0f';\n        // }\n\n        // debugger;\n        // }\n\n        appendEmoji(emoji/* .replace(/[\\ufe0f\\u2640\\u2642\\u2695]/g, '') */, itemsDiv, false/* , false */);\n\n        /* if(category === 'Smileys & Emotion') {\n          console.log('appended emoji', emoji, itemsDiv.children[itemsDiv.childElementCount - 1].innerHTML, emojiUnicode(emoji));\n        } */\n      });\n\n      divs[category] = div;\n    });\n\n    // console.timeEnd('emojiParse');\n\n    const menu = this.menu = this.content.previousElementSibling as HTMLElement;\n    const emojiScroll = this.scroll = new Scrollable(this.content, 'EMOJI');\n\n    // emojiScroll.setVirtualContainer(emojiScroll.container);\n\n    const preloader = putPreloader(this.content, true);\n\n    Promise.all([\n      pause(200),\n      this.managers.appEmojiManager.getRecentEmojis().then((recent) => {\n        const hasRecent = !!recent.length;\n        const activeId = hasRecent ? 0 : 1;\n        this.menu.children[0].classList.toggle('hide', !hasRecent);\n        this.menu.children[activeId].classList.add('active');\n        const m = EmoticonsDropdown.menuOnClick(menu, emojiScroll, undefined, activeId);\n        this.stickyIntersector = m.stickyIntersector;\n        this.setMenuActive = m.setActive;\n        return recent;\n      })\n    ]).then(([_, recent]) => {\n      preloader.remove();\n\n      this.recentItemsDiv = divs['Emoji.Recent'].querySelector('.super-emojis');\n      for(const emoji of recent) {\n        appendEmoji(emoji, this.recentItemsDiv);\n      }\n\n      this.recentItemsDiv.parentElement.classList.toggle('hide', !this.recentItemsDiv.childElementCount);\n\n      categories.unshift('Emoji.Recent');\n      categories.map((category) => {\n        const div = divs[category];\n\n        if(!div) {\n          console.error('no div by category:', category);\n        }\n\n        emojiScroll.container.append(div);\n        this.stickyIntersector.observeStickyHeaderChanges(div);\n        return div;\n      });\n    });\n\n    attachClickEvent(this.content, this.onContentClick);\n    this.init = null;\n\n    rootScope.addEventListener('emoji_recent', (emoji) => {\n      const children = Array.from(this.recentItemsDiv.children) as HTMLElement[];\n      for(let i = 0, length = children.length; i < length; ++i) {\n        const el = children[i];\n        const _emoji = fixEmoji(getEmojiFromElement(el));\n        if(emoji === _emoji) {\n          if(i === 0) {\n            return;\n          }\n\n          el.remove();\n        }\n      }\n\n      appendEmoji(emoji, this.recentItemsDiv, true);\n      this.recentItemsDiv.parentElement.classList.remove('hide');\n      this.menu.children[0].classList.remove('hide');\n\n      if(!this.closeScrollTop) {\n        this.setMenuActive(0);\n      }\n    });\n\n    emoticonsDropdown.addEventListener('close', () => {\n      this.closeScrollTop = this.scroll.scrollTop;\n    });\n  }\n\n  onContentClick = (e: MouseEvent) => {\n    cancelEvent(e);\n\n    const emoji = getEmojiFromElement(e.target as HTMLElement);\n    if(!emoji) {\n      return;\n    }\n\n    appImManager.chat.input.onEmojiSelected(emoji, false);\n    if(IS_TOUCH_SUPPORTED) {\n      blurActiveElement();\n    }\n  };\n\n  onClose() {\n\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport getEmojiEntityFromEmoji from './getEmojiEntityFromEmoji';\nimport wrapRichText from './wrapRichText';\n\nexport default function wrapSingleEmoji(emoji: string) {\n  return wrapRichText(emoji, {\n    entities: [getEmojiEntityFromEmoji(emoji)]\n  });\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport findAndSpliceAll from '../helpers/array/findAndSpliceAll';\nimport LazyLoadQueueIntersector, {LazyLoadElement} from './lazyLoadQueueIntersector';\nimport VisibilityIntersector, {OnVisibilityChange} from './visibilityIntersector';\n\nexport default class LazyLoadQueueRepeat extends LazyLoadQueueIntersector {\n  private _queue: Map<HTMLElement, LazyLoadElement> = new Map();\n\n  constructor(parallelLimit?: number, protected onVisibilityChange?: OnVisibilityChange, options?: IntersectionObserverInit) {\n    super(parallelLimit);\n\n    this.intersector = new VisibilityIntersector((item) => {\n      const {target, visible} = item;\n      const spliced = findAndSpliceAll(this.queue, (i) => i.div === target);\n      if(visible) {\n        const items = spliced.length ? spliced : [this._queue.get(target)];\n        items.forEach((item) => {\n          this.queue.unshift(item || this._queue.get(target));\n        });\n      }\n\n      this.onVisibilityChange && this.onVisibilityChange(item);\n      this.setProcessQueueTimeout();\n    }, options);\n  }\n\n  public clear() {\n    super.clear();\n    this._queue.clear();\n  }\n\n  /* public async processItem(item: LazyLoadElement) {\n    //await super.processItem(item);\n    await LazyLoadQueueBase.prototype.processItem.call(this, item);\n\n    if(this.lazyLoadMedia.length) {\n      this.processQueue();\n    }\n  } */\n\n  public observe(el: LazyLoadElement) {\n    this._queue.set(el.div, el);\n    this.intersector.observe(el.div);\n  }\n}\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport emoticonsDropdown, {EmoticonsDropdown, EMOTICONSSTICKERGROUP, EmoticonsTab} from '..';\r\nimport findUpClassName from '../../../helpers/dom/findUpClassName';\r\nimport mediaSizes from '../../../helpers/mediaSizes';\r\nimport {MessagesAllStickers, StickerSet} from '../../../layer';\r\nimport {MyDocument} from '../../../lib/appManagers/appDocsManager';\r\nimport {AppManagers} from '../../../lib/appManagers/managers';\r\nimport {i18n, LangPackKey} from '../../../lib/langPack';\r\nimport wrapEmojiText from '../../../lib/richTextProcessor/wrapEmojiText';\r\nimport rootScope from '../../../lib/rootScope';\r\nimport animationIntersector, {AnimationItemGroup} from '../../animationIntersector';\r\nimport LazyLoadQueue from '../../lazyLoadQueue';\r\nimport LazyLoadQueueRepeat from '../../lazyLoadQueueRepeat';\r\nimport {putPreloader} from '../../putPreloader';\r\nimport PopupStickers from '../../popups/stickers';\r\nimport Scrollable, {ScrollableX} from '../../scrollable';\r\nimport StickyIntersector from '../../stickyIntersector';\r\nimport {wrapSticker, wrapStickerSetThumb} from '../../wrappers';\r\nimport findAndSplice from '../../../helpers/array/findAndSplice';\r\nimport {attachClickEvent} from '../../../helpers/dom/clickEvent';\r\nimport positionElementByIndex from '../../../helpers/dom/positionElementByIndex';\r\nimport noop from '../../../helpers/noop';\r\nimport ButtonIcon from '../../buttonIcon';\r\nimport confirmationPopup from '../../confirmationPopup';\r\nimport VisibilityIntersector, {OnVisibilityChange} from '../../visibilityIntersector';\r\nimport createStickersContextMenu from '../../../helpers/dom/createStickersContextMenu';\r\nimport findUpAsChild from '../../../helpers/dom/findUpAsChild';\r\nimport forEachReverse from '../../../helpers/array/forEachReverse';\r\nimport {MTAppConfig} from '../../../lib/mtproto/appConfig';\r\nimport attachStickerViewerListeners from '../../stickerViewer';\r\nimport ListenerSetter from '../../../helpers/listenerSetter';\r\n\r\nexport class SuperStickerRenderer {\r\n  public lazyLoadQueue: LazyLoadQueueRepeat;\r\n  private animated: Set<HTMLElement> = new Set();\r\n\r\n  constructor(\r\n    private regularLazyLoadQueue: LazyLoadQueue,\r\n    private group: AnimationItemGroup,\r\n    private managers: AppManagers,\r\n    private options?: IntersectionObserverInit\r\n  ) {\r\n    this.lazyLoadQueue = new LazyLoadQueueRepeat(undefined, ({target, visible}) => {\r\n      if(!visible) {\r\n        this.processInvisible(target);\r\n      }\r\n    }, options);\r\n  }\r\n\r\n  public clear() {\r\n    this.lazyLoadQueue.clear();\r\n  }\r\n\r\n  public renderSticker(doc: MyDocument, element?: HTMLElement, loadPromises?: Promise<any>[]) {\r\n    if(!element) {\r\n      element = document.createElement('div');\r\n      element.classList.add('grid-item', 'super-sticker');\r\n      element.dataset.docId = '' + doc.id;\r\n\r\n      if(doc.animated) {\r\n        this.observeAnimated(element);\r\n      }\r\n    }\r\n\r\n    // * This will wrap only a thumb\r\n    /* !doc.animated &&  */wrapSticker({\r\n      doc,\r\n      div: element,\r\n      lazyLoadQueue: this.regularLazyLoadQueue,\r\n      group: this.group,\r\n      onlyThumb: doc.animated,\r\n      loadPromises\r\n    });\r\n\r\n    return element;\r\n  }\r\n\r\n  public observeAnimated(element: HTMLElement) {\r\n    this.animated.add(element);\r\n    this.lazyLoadQueue.observe({\r\n      div: element,\r\n      load: this.processVisible\r\n    });\r\n  }\r\n\r\n  public unobserveAnimated(element: HTMLElement) {\r\n    this.animated.delete(element);\r\n    this.lazyLoadQueue.unobserve(element);\r\n  }\r\n\r\n  private checkAnimationContainer = (element: HTMLElement, visible: boolean) => {\r\n    // console.error('checkAnimationContainer', div, visible);\r\n    const players = animationIntersector.getAnimations(element);\r\n    players.forEach((player) => {\r\n      if(!visible) {\r\n        animationIntersector.checkAnimation(player, true, true);\r\n      } else {\r\n        animationIntersector.checkAnimation(player, false);\r\n      }\r\n    });\r\n  };\r\n\r\n  private processVisible = async(element: HTMLElement) => {\r\n    const docId = element.dataset.docId;\r\n    const doc = await this.managers.appDocsManager.getDoc(docId);\r\n\r\n    const size = mediaSizes.active.esgSticker.width;\r\n\r\n    // console.log('processVisibleDiv:', div);\r\n\r\n    const promise = wrapSticker({\r\n      doc,\r\n      div: element,\r\n      width: size,\r\n      height: size,\r\n      lazyLoadQueue: null,\r\n      group: this.group,\r\n      onlyThumb: false,\r\n      play: true,\r\n      loop: true,\r\n      withLock: true\r\n    }).then(({render}) => render);\r\n\r\n    promise.then(() => {\r\n      // clearTimeout(timeout);\r\n      this.checkAnimationContainer(element, this.lazyLoadQueue.intersector.isVisible(element));\r\n    });\r\n\r\n    /* let timeout = window.setTimeout(() => {\r\n      console.error('processVisibleDiv timeout', div, doc);\r\n    }, 1e3); */\r\n\r\n    return promise;\r\n  };\r\n\r\n  public processInvisible = async(element: HTMLElement) => {\r\n    const docId = element.dataset.docId;\r\n    const doc = await this.managers.appDocsManager.getDoc(docId);\r\n\r\n    // console.log('STICKER INvisible:', /* div,  */docId);\r\n\r\n    this.checkAnimationContainer(element, false);\r\n\r\n    element.textContent = '';\r\n    this.renderSticker(doc, element as HTMLDivElement);\r\n  };\r\n}\r\n\r\ntype StickersTabCategory = {\r\n  elements: {\r\n    container: HTMLElement,\r\n    title: HTMLElement,\r\n    items: HTMLElement,\r\n    menuTab: HTMLElement,\r\n    menuTabPadding: HTMLElement\r\n  },\r\n  set: StickerSet.stickerSet,\r\n  items: {\r\n    document: MyDocument,\r\n    element: HTMLElement\r\n  }[],\r\n  mounted?: boolean,\r\n  id: string,\r\n  limit?: number\r\n};\r\n\r\nexport default class StickersTab implements EmoticonsTab {\r\n  private content: HTMLElement;\r\n\r\n  private categories: {[id: string]: StickersTabCategory};\r\n  private categoriesMap: Map<HTMLElement, StickersTabCategory>;\r\n  private categoriesIntersector: VisibilityIntersector;\r\n  private localCategories: StickersTabCategory[];\r\n\r\n  private scroll: Scrollable;\r\n  private menu: HTMLElement;\r\n  private mounted = false;\r\n  private stickyIntersector: StickyIntersector;\r\n  private superStickerRenderer: SuperStickerRenderer;\r\n\r\n  constructor(private managers: AppManagers) {\r\n    this.categories = {};\r\n    this.categoriesMap = new Map();\r\n    this.localCategories = [];\r\n  }\r\n\r\n  private setFavedLimit(appConfig: MTAppConfig) {\r\n    const limit = rootScope.premium ? appConfig.stickers_faved_limit_premium : appConfig.stickers_faved_limit_default;\r\n    const category = this.categories['faved'];\r\n    category.limit = limit;\r\n  }\r\n\r\n  private createCategory(stickerSet: StickerSet.stickerSet, _title: HTMLElement | DocumentFragment) {\r\n    const container = document.createElement('div');\r\n    container.classList.add('emoji-category', 'hide');\r\n\r\n    const items = document.createElement('div');\r\n    items.classList.add('category-items', 'super-stickers');\r\n\r\n    const title = document.createElement('div');\r\n    title.classList.add('category-title');\r\n    title.append(_title);\r\n\r\n    const menuTab = ButtonIcon(undefined, {noRipple: true});\r\n    menuTab.classList.add('menu-horizontal-div-item');\r\n\r\n    const menuTabPadding = document.createElement('div');\r\n    menuTabPadding.classList.add('menu-horizontal-div-item-padding');\r\n\r\n    menuTab.append(menuTabPadding);\r\n\r\n    const category: StickersTabCategory = {\r\n      elements: {\r\n        container,\r\n        title,\r\n        items,\r\n        menuTab,\r\n        menuTabPadding\r\n      },\r\n      set: stickerSet,\r\n      items: [],\r\n      id: '' + stickerSet.id\r\n    };\r\n\r\n    container.append(title, items);\r\n\r\n    this.categories[stickerSet.id] = category;\r\n    this.categoriesMap.set(container, category);\r\n\r\n    this.categoriesIntersector.observe(container);\r\n    this.stickyIntersector.observeStickyHeaderChanges(container);\r\n\r\n    return category;\r\n  }\r\n\r\n  private categoryAppendStickers(\r\n    category: StickersTabCategory,\r\n    promise: Promise<MyDocument[]>\r\n  ) {\r\n    const {container} = category.elements;\r\n\r\n    promise.then((documents) => {\r\n      const isVisible = this.isCategoryVisible(category);\r\n\r\n      documents.forEach((document) => {\r\n        const element = this.superStickerRenderer.renderSticker(document);\r\n        category.items.push({document, element});\r\n\r\n        if(isVisible) {\r\n          category.elements.items.append(element);\r\n        }\r\n      });\r\n\r\n      this.setCategoryItemsHeight(category);\r\n      container.classList.remove('hide');\r\n    });\r\n  }\r\n\r\n  private isCategoryVisible(category: StickersTabCategory) {\r\n    return this.categoriesIntersector.getVisible().includes(category.elements.container);\r\n  }\r\n\r\n  private setCategoryItemsHeight(category: StickersTabCategory) {\r\n    const containerWidth = this.content.getBoundingClientRect().width - 10;\r\n    const stickerSize = mediaSizes.active.esgSticker.width;\r\n\r\n    const itemsPerRow = Math.floor(containerWidth / stickerSize);\r\n    const rows = Math.ceil(category.items.length / itemsPerRow);\r\n    const height = rows * stickerSize;\r\n\r\n    category.elements.items.style.minHeight = height + 'px';\r\n  }\r\n\r\n  private async renderStickerSet(set: StickerSet.stickerSet, prepend = false) {\r\n    const category = this.createCategory(set, wrapEmojiText(set.title));\r\n    const {menuTab, menuTabPadding, container} = category.elements;\r\n\r\n    const pos = prepend ? this.localCategories.filter((category) => category.mounted).length : 0xFFFF;\r\n    positionElementByIndex(menuTab, this.menu, pos);\r\n\r\n    const promise = this.managers.appStickersManager.getStickerSet(set);\r\n    this.categoryAppendStickers(\r\n      category,\r\n      promise.then((stickerSet) => stickerSet.documents as MyDocument[])\r\n    );\r\n    // const stickerSet = await promise;\r\n\r\n    positionElementByIndex(container, this.scroll.container, pos, -1);\r\n\r\n    wrapStickerSetThumb({\r\n      set,\r\n      container: menuTabPadding,\r\n      group: EMOTICONSSTICKERGROUP,\r\n      lazyLoadQueue: EmoticonsDropdown.lazyLoadQueue,\r\n      width: 32,\r\n      height: 32,\r\n      autoplay: false\r\n    });\r\n  }\r\n\r\n  public init() {\r\n    this.content = document.getElementById('content-stickers');\r\n    const menuWrapper = this.content.previousElementSibling as HTMLDivElement;\r\n    this.menu = menuWrapper.firstElementChild as HTMLUListElement;\r\n\r\n    const menuScroll = new ScrollableX(menuWrapper);\r\n\r\n    this.scroll = new Scrollable(this.content, 'STICKERS');\r\n    this.scroll.onAdditionalScroll = () => {\r\n      setTyping();\r\n    };\r\n\r\n    /* stickersDiv.addEventListener('mouseover', (e) => {\r\n      let target = e.target as HTMLElement;\r\n\r\n      if(target.tagName === 'CANVAS') { // turn on sticker\r\n        let animation = lottieLoader.getAnimation(target.parentElement, EMOTICONSSTICKERGROUP);\r\n\r\n        if(animation) {\r\n          // @ts-ignore\r\n          if(animation.currentFrame === animation.totalFrames - 1) {\r\n            animation.goToAndPlay(0, true);\r\n          } else {\r\n            animation.play();\r\n          }\r\n        }\r\n      }\r\n    }); */\r\n\r\n    const onCategoryVisibility: OnVisibilityChange = ({target, visible, entry}) => {\r\n      const category = this.categoriesMap.get(target);\r\n      // console.log('roll the windows up', category, target, visible, entry);\r\n      if(!visible) {\r\n        category.elements.items.textContent = '';\r\n      } else {\r\n        category.elements.items.append(...category.items.map(({element}) => element));\r\n      }\r\n    };\r\n\r\n    const intersectionOptions: IntersectionObserverInit = {root: emoticonsDropdown.getElement()};\r\n    this.categoriesIntersector = new VisibilityIntersector(onCategoryVisibility, intersectionOptions);\r\n\r\n    const clearCategoryItems = (category: StickersTabCategory) => {\r\n      category.elements.items.textContent = '';\r\n      category.items.forEach(({element}) => this.superStickerRenderer.unobserveAnimated(element));\r\n      category.items.length = 0;\r\n    };\r\n\r\n    this.scroll.container.addEventListener('click', (e) => {\r\n      const target = e.target as HTMLElement;\r\n      if(findUpClassName(target, 'category-title')) {\r\n        const container = findUpClassName(target, 'emoji-category');\r\n        const category = this.categoriesMap.get(container);\r\n        if(category.set.id === 'recent') {\r\n          return;\r\n        }\r\n\r\n        new PopupStickers({id: category.set.id, access_hash: category.set.access_hash}).show();\r\n        return;\r\n      }\r\n\r\n      EmoticonsDropdown.onMediaClick(e);\r\n    });\r\n\r\n    const setTyping = (cancel = false) => {\r\n      rootScope.dispatchEvent('choosing_sticker', !cancel);\r\n    };\r\n\r\n    emoticonsDropdown.addEventListener('closed', () => {\r\n      setTyping(true);\r\n    });\r\n\r\n    emoticonsDropdown.addEventListener('opened', () => {\r\n      setTyping();\r\n    });\r\n\r\n    const {stickyIntersector, setActive} = EmoticonsDropdown.menuOnClick(this.menu, this.scroll, menuScroll);\r\n    this.stickyIntersector = stickyIntersector;\r\n\r\n    const preloader = putPreloader(this.content, true);\r\n\r\n    const createLocalCategory = (id: string, title: LangPackKey, icon?: string) => {\r\n      const category = this.createCategory({id} as any, i18n(title));\r\n      this.localCategories.push(category);\r\n      category.elements.title.classList.add('disable-hover');\r\n      icon && category.elements.menuTab.classList.add('tgico-' + icon);\r\n      category.elements.menuTabPadding.remove();\r\n      this.toggleLocalCategory(category, false);\r\n      return category;\r\n    };\r\n\r\n    const onCategoryStickers = (category: StickersTabCategory, stickers: MyDocument[]) => {\r\n      // if(category.id === 'faved' && category.limit && category.limit < stickers.length) {\r\n      //   category.limit = stickers.length;\r\n      // }\r\n\r\n      if(category.limit) {\r\n        stickers = stickers.slice(0, category.limit);\r\n      }\r\n\r\n      const ids = new Set(stickers.map((doc) => doc.id));\r\n      forEachReverse(category.items, (item) => {\r\n        if(!ids.has(item.document.id)) {\r\n          this.deleteSticker(category, item.document, true);\r\n        }\r\n      });\r\n\r\n      this.toggleLocalCategory(category, !!stickers.length);\r\n      forEachReverse(stickers, (doc, idx) => {\r\n        this.unshiftSticker(category, doc, true, idx);\r\n      });\r\n      this.spliceExceed(category);\r\n      category.elements.container.classList.remove('hide');\r\n    };\r\n\r\n    const favedCategory = createLocalCategory('faved', 'FavoriteStickers', 'saved');\r\n    favedCategory.elements.menuTab.classList.add('active');\r\n\r\n    const recentCategory = createLocalCategory('recent', 'Stickers.Recent', 'recent');\r\n    recentCategory.limit = 20;\r\n    // recentCategory.elements.menuTab.classList.add('active');\r\n\r\n    const clearButton = ButtonIcon('close', {noRipple: true});\r\n    recentCategory.elements.title.append(clearButton);\r\n    attachClickEvent(clearButton, () => {\r\n      confirmationPopup({\r\n        titleLangKey: 'ClearRecentStickersAlertTitle',\r\n        descriptionLangKey: 'ClearRecentStickersAlertMessage',\r\n        button: {\r\n          langKey: 'Clear'\r\n        }\r\n      }).then(() => {\r\n        this.managers.appStickersManager.clearRecentStickers();\r\n      }, noop);\r\n    });\r\n\r\n    const premiumCategory = createLocalCategory('premium', 'PremiumStickersShort');\r\n    const s = document.createElement('span');\r\n    s.classList.add('tgico-star', 'color-premium');\r\n    premiumCategory.elements.menuTab.append(s);\r\n\r\n    const promises = [\r\n      Promise.all([\r\n        this.managers.apiManager.getAppConfig(),\r\n        this.managers.appStickersManager.getFavedStickersStickers()\r\n      ]).then(([appConfig, stickers]) => {\r\n        this.setFavedLimit(appConfig);\r\n        onCategoryStickers(favedCategory, stickers);\r\n      }),\r\n\r\n      this.managers.appStickersManager.getRecentStickersStickers().then((stickers) => {\r\n        onCategoryStickers(recentCategory, stickers);\r\n      }),\r\n\r\n      this.managers.appStickersManager.getAllStickers().then((res) => {\r\n        for(const set of (res as MessagesAllStickers.messagesAllStickers).sets) {\r\n          this.renderStickerSet(set);\r\n        }\r\n      }),\r\n\r\n      this.managers.appStickersManager.getPremiumStickers().then((stickers) => {\r\n        const length = stickers.length;\r\n        this.toggleLocalCategory(premiumCategory, rootScope.premium && !!length);\r\n        this.categoryAppendStickers(premiumCategory, Promise.resolve(stickers));\r\n\r\n        rootScope.addEventListener('premium_toggle', (isPremium) => {\r\n          this.toggleLocalCategory(this.categories['premium'], isPremium && !!length);\r\n        });\r\n      })\r\n    ];\r\n\r\n    Promise.race(promises).finally(() => {\r\n      preloader.remove();\r\n    });\r\n\r\n    Promise.all(promises).finally(() => {\r\n      this.mounted = true;\r\n      setTyping();\r\n      setActive(0);\r\n    });\r\n\r\n    this.superStickerRenderer = new SuperStickerRenderer(EmoticonsDropdown.lazyLoadQueue, EMOTICONSSTICKERGROUP, this.managers, intersectionOptions);\r\n\r\n    const rendererLazyLoadQueue = this.superStickerRenderer.lazyLoadQueue;\r\n    emoticonsDropdown.addLazyLoadQueueRepeat(rendererLazyLoadQueue, this.superStickerRenderer.processInvisible);\r\n\r\n    // emoticonsDropdown.addEventListener('close', () => {\r\n    //   this.categoriesIntersector.lock();\r\n    // });\r\n\r\n    // emoticonsDropdown.addEventListener('closed', () => {\r\n    //   for(const [container] of this.categoriesMap) {\r\n    //     onCategoryVisibility(container, false);\r\n    //   }\r\n    // });\r\n\r\n    // emoticonsDropdown.addEventListener('opened', () => {\r\n    //   this.categoriesIntersector.unlockAndRefresh();\r\n    // });\r\n\r\n    // setInterval(() => {\r\n    //   // @ts-ignore\r\n    //   const players = Object.values(lottieLoader.players).filter((p) => p.width >= 80);\r\n\r\n    //   console.log(\r\n    //     'STICKERS RENDERED IN PANEL:',\r\n    //     players.length,\r\n    //     players.filter((p) => !p.paused).length,\r\n    //     rendererLazyLoadQueue.intersector.getVisible().length\r\n    //   );\r\n    // }, .25e3);\r\n\r\n    rootScope.addEventListener('stickers_installed', (set) => {\r\n      if(!this.categories[set.id] && this.mounted) {\r\n        this.renderStickerSet(set, true);\r\n      }\r\n    });\r\n\r\n    rootScope.addEventListener('stickers_deleted', ({id}) => {\r\n      const category = this.categories[id];\r\n      if(category && this.mounted) {\r\n        category.elements.container.remove();\r\n        category.elements.menuTab.remove();\r\n        this.categoriesIntersector.unobserve(category.elements.container);\r\n        clearCategoryItems(category);\r\n        delete this.categories[id];\r\n        this.categoriesMap.delete(category.elements.container);\r\n      }\r\n    });\r\n\r\n    rootScope.addEventListener('sticker_updated', ({type, document, faved}) => {\r\n      // if(type === 'faved') {\r\n      //   return;\r\n      // }\r\n\r\n      const category = this.categories[type === 'faved' ? 'faved' : 'recent'];\r\n      if(category) {\r\n        if(faved) {\r\n          this.unshiftSticker(category, document);\r\n        } else {\r\n          this.deleteSticker(category, document);\r\n        }\r\n      }\r\n    });\r\n\r\n    rootScope.addEventListener('stickers_updated', ({type, stickers}) => {\r\n      if(this.mounted) {\r\n        const category = this.categories[type === 'faved' ? 'faved' : 'recent'];\r\n        onCategoryStickers(category, stickers);\r\n      }\r\n    });\r\n\r\n    rootScope.addEventListener('app_config', (appConfig) => {\r\n      this.setFavedLimit(appConfig);\r\n    });\r\n\r\n    const resizeCategories = () => {\r\n      for(const [container, category] of this.categoriesMap) {\r\n        this.setCategoryItemsHeight(category);\r\n      }\r\n    };\r\n\r\n    mediaSizes.addEventListener('resize', resizeCategories);\r\n\r\n    emoticonsDropdown.addEventListener('opened', resizeCategories);\r\n\r\n    attachStickerViewerListeners({listenTo: this.content, listenerSetter: new ListenerSetter()});\r\n\r\n    createStickersContextMenu({\r\n      listenTo: this.content,\r\n      verifyRecent: (target) => !!findUpAsChild(target, this.categories['recent'].elements.items),\r\n      onOpen: () => {\r\n        emoticonsDropdown.setIgnoreMouseOut(true);\r\n      },\r\n      onClose: () => {\r\n        emoticonsDropdown.setIgnoreMouseOut(false);\r\n      }\r\n    });\r\n\r\n    this.init = null;\r\n  }\r\n\r\n  private toggleLocalCategory(category: StickersTabCategory, visible: boolean) {\r\n    if(!visible) {\r\n      category.elements.menuTab.remove();\r\n      category.elements.container.remove();\r\n    } else {\r\n      let idx = this.localCategories.indexOf(category);\r\n      const notMounted = this.localCategories.slice(0, idx).filter((category) => !category.mounted);\r\n      idx -= notMounted.length;\r\n      positionElementByIndex(category.elements.menuTab, this.menu, idx);\r\n      positionElementByIndex(category.elements.container, this.scroll.container, idx);\r\n    }\r\n\r\n    category.mounted = visible;\r\n    // category.elements.container.classList.toggle('hide', !visible);\r\n  }\r\n\r\n  private onLocalCategoryUpdate(category: StickersTabCategory) {\r\n    this.setCategoryItemsHeight(category);\r\n    this.toggleLocalCategory(category, !!category.items.length);\r\n  }\r\n\r\n  public deleteSticker(category: StickersTabCategory, doc: MyDocument, batch?: boolean) {\r\n    const item = findAndSplice(category.items, (item) => item.document.id === doc.id);\r\n    if(item) {\r\n      item.element.remove();\r\n\r\n      if(!batch) {\r\n        this.onLocalCategoryUpdate(category);\r\n      }\r\n    }\r\n  }\r\n\r\n  private spliceExceed(category: StickersTabCategory) {\r\n    const {items, limit} = category;\r\n    items.splice(limit, items.length - limit).forEach(({element}) => {\r\n      element.remove();\r\n    });\r\n\r\n    this.onLocalCategoryUpdate(category);\r\n  }\r\n\r\n  public unshiftSticker(category: StickersTabCategory, doc: MyDocument, batch?: boolean, idx?: number) {\r\n    if(idx !== undefined) {\r\n      const i = category.items[idx];\r\n      if(i && i.document.id === doc.id) {\r\n        return;\r\n      }\r\n    }\r\n\r\n    let item = findAndSplice(category.items, (item) => item.document.id === doc.id);\r\n    if(!item) {\r\n      item = {\r\n        element: this.superStickerRenderer.renderSticker(doc),\r\n        document: doc\r\n      };\r\n    }\r\n\r\n    category.items.unshift(item);\r\n    category.elements.items.prepend(item.element);\r\n\r\n    if(!batch) {\r\n      this.spliceExceed(category);\r\n    }\r\n  }\r\n\r\n  public unshiftRecentSticker(doc: MyDocument) {\r\n    this.managers.appStickersManager.saveRecentSticker(doc.id);\r\n  }\r\n\r\n  public deleteRecentSticker(doc: MyDocument) {\r\n    this.managers.appStickersManager.saveRecentSticker(doc.id, true);\r\n  }\r\n\r\n  onClose() {\r\n\r\n  }\r\n}\r\n","import {_i18n} from '../lib/langPack';\n\nexport default function generateFakeIcon(isScam?: boolean) {\n  const span = document.createElement('span');\n  span.classList.add('badge-fake');\n  _i18n(span, isScam ? 'ScamMessage' : 'FakeMessage');\n  return span;\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport findAndSpliceAll from '../helpers/array/findAndSpliceAll';\nimport LazyLoadQueueIntersector from './lazyLoadQueueIntersector';\nimport VisibilityIntersector, {OnVisibilityChange} from './visibilityIntersector';\n\nexport default class LazyLoadQueueRepeat2 extends LazyLoadQueueIntersector {\n  constructor(parallelLimit?: number, protected onVisibilityChange?: OnVisibilityChange) {\n    super(parallelLimit);\n\n    this.intersector = new VisibilityIntersector((item) => {\n      const {target, visible} = item;\n      const spliced = findAndSpliceAll(this.queue, (i) => i.div === target);\n      if(visible && spliced.length) {\n        spliced.forEach((item) => {\n          this.queue.unshift(item);\n        });\n      }\n\n      this.onVisibilityChange && this.onVisibilityChange(item);\n      this.setProcessQueueTimeout();\n    });\n  }\n\n  public observe(el: HTMLElement) {\n    this.intersector.observe(el);\n  }\n}\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport type {MyDocument} from '../lib/appManagers/appDocsManager';\r\nimport {wrapVideo} from './wrappers';\r\nimport animationIntersector, {AnimationItemGroup} from './animationIntersector';\r\nimport Scrollable from './scrollable';\r\nimport deferredPromise, {CancellablePromise} from '../helpers/cancellablePromise';\r\nimport calcImageInBox from '../helpers/calcImageInBox';\r\nimport {doubleRaf} from '../helpers/schedulers';\r\nimport {AppManagers} from '../lib/appManagers/managers';\r\nimport rootScope from '../lib/rootScope';\r\nimport LazyLoadQueueRepeat2 from './lazyLoadQueueRepeat2';\r\n\r\nconst width = 400;\r\nconst maxSingleWidth = width - 100;\r\nconst height = 100;\r\n\r\nexport default class GifsMasonry {\r\n  public lazyLoadQueue: LazyLoadQueueRepeat2;\r\n  private scrollPromise: CancellablePromise<void> = Promise.resolve();\r\n  private timeout: number = 0;\r\n  private managers: AppManagers;\r\n\r\n  constructor(\r\n    private element: HTMLElement,\r\n    private group: AnimationItemGroup,\r\n    private scrollable: Scrollable,\r\n    attach = true\r\n  ) {\r\n    this.managers = rootScope.managers;\r\n\r\n    this.lazyLoadQueue = new LazyLoadQueueRepeat2(undefined, ({target, visible}) => {\r\n      if(visible) {\r\n        this.processVisibleDiv(target);\r\n      } else {\r\n        this.processInvisibleDiv(target);\r\n      }\r\n    });\r\n\r\n    /* setInterval(() => {\r\n      // @ts-ignore\r\n      const players = animationIntersector.byGroups[group];\r\n\r\n      if(players) {\r\n        console.log(`GIFS RENDERED IN ${group}:`, players.length, players.filter((p) => !p.animation.paused).length, this.lazyLoadQueue.intersector.getVisible().length);\r\n      }\r\n    }, .25e3); */\r\n\r\n    if(attach) {\r\n      this.attach();\r\n    }\r\n  }\r\n\r\n  private onScroll = () => {\r\n    if(this.timeout) {\r\n      clearTimeout(this.timeout);\r\n    } else {\r\n      this.scrollPromise = deferredPromise<void>();\r\n      // animationIntersector.checkAnimations(true, group);\r\n    }\r\n\r\n    this.timeout = window.setTimeout(() => {\r\n      this.timeout = 0;\r\n      this.scrollPromise.resolve();\r\n      // animationIntersector.checkAnimations(false, group);\r\n    }, 150);\r\n  };\r\n\r\n  public attach() {\r\n    this.scrollable.container.addEventListener('scroll', this.onScroll);\r\n  }\r\n\r\n  public detach() {\r\n    this.clear();\r\n    this.scrollable.container.removeEventListener('scroll', this.onScroll);\r\n  }\r\n\r\n  public clear() {\r\n    this.lazyLoadQueue.clear();\r\n  }\r\n\r\n  private processVisibleDiv(div: HTMLElement) {\r\n    const video = div.querySelector('video');\r\n    if(video) {\r\n      return;\r\n    }\r\n\r\n    const load = () => {\r\n      const docId = div.dataset.docId;\r\n      const promise = Promise.all([this.managers.appDocsManager.getDoc(docId), this.scrollPromise]).then(async([doc]) => {\r\n        const res = await wrapVideo({\r\n          doc,\r\n          container: div as HTMLDivElement,\r\n          lazyLoadQueue: null,\r\n          // lazyLoadQueue: EmoticonsDropdown.lazyLoadQueue,\r\n          group: this.group,\r\n          noInfo: true,\r\n          noPreview: true\r\n        });\r\n\r\n        const promise = res.loadPromise;\r\n        promise.finally(() => {\r\n          const video = div.querySelector('video');\r\n          const thumb = div.querySelector('img, canvas');\r\n\r\n          // div.style.opacity = '';\r\n          thumb && thumb.classList.add('hide');\r\n\r\n          if(video && !video.parentElement) {\r\n            setTimeout(() => {\r\n              video.src = '';\r\n              video.load();\r\n              const animations = animationIntersector.getAnimations(video);\r\n              animations.forEach((item) => {\r\n                animationIntersector.checkAnimation(item, true, true);\r\n              });\r\n            }, 0);\r\n          }\r\n\r\n          // clearTimeout(timeout);\r\n          if(!this.lazyLoadQueue.intersector.isVisible(div)) {\r\n            this.processInvisibleDiv(div);\r\n          }\r\n        });\r\n\r\n        return promise;\r\n      });\r\n\r\n      /* let timeout = window.setTimeout(() => {\r\n        console.error('processVisibleDiv timeout', div, doc);\r\n      }, 1e3); */\r\n\r\n      return promise;\r\n    };\r\n\r\n    // return load();\r\n\r\n    this.lazyLoadQueue.push({div, load});\r\n  }\r\n\r\n  public processInvisibleDiv = (div: HTMLElement) => {\r\n    return this.scrollPromise.then(async() => {\r\n      // return;\r\n\r\n      if(this.lazyLoadQueue.intersector.isVisible(div)) {\r\n        return;\r\n      }\r\n\r\n      const video = div.querySelector('video');\r\n      const thumb = div.querySelector('img, canvas');\r\n\r\n      if(thumb) {\r\n        thumb.classList.remove('hide');\r\n\r\n        await doubleRaf();\r\n      }\r\n\r\n      if(this.lazyLoadQueue.intersector.isVisible(div)) {\r\n        return;\r\n      }\r\n\r\n      if(video) {\r\n        video.remove();\r\n        video.src = '';\r\n        video.load();\r\n        const animations = animationIntersector.getAnimations(video);\r\n        animations.forEach((item) => {\r\n          animationIntersector.checkAnimation(item, true, true);\r\n        });\r\n      }\r\n    });\r\n  };\r\n\r\n  public add(doc: MyDocument, appendTo = this.element) {\r\n    let gifWidth = doc.w;\r\n    let gifHeight = doc.h;\r\n    if(gifHeight < height) {\r\n      gifWidth = height / gifHeight * gifWidth;\r\n      gifHeight = height;\r\n    }\r\n\r\n    const willUseWidth = Math.min(maxSingleWidth, width, gifWidth);\r\n    const size = calcImageInBox(gifWidth, gifHeight, willUseWidth, height);\r\n\r\n    const div = document.createElement('div');\r\n    div.classList.add('gif'/* , 'fade-in-transition' */);\r\n    div.style.width = size.width + 'px';\r\n    // div.style.opacity = '0';\r\n    // div.style.height = h + 'px';\r\n    div.dataset.docId = '' + doc.id;\r\n\r\n    appendTo.append(div);\r\n\r\n    this.lazyLoadQueue.observe(div);\r\n\r\n    // let preloader = new ProgressivePreloader(div);\r\n\r\n    wrapVideo({\r\n      doc,\r\n      container: div as HTMLDivElement,\r\n      lazyLoadQueue: null,\r\n      noInfo: true,\r\n      onlyPreview: true\r\n    });\r\n  }\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport {TransitionSlider} from './transition';\r\nimport {ScrollableX} from './scrollable';\r\nimport rootScope from '../lib/rootScope';\r\nimport {fastRaf} from '../helpers/schedulers';\r\nimport {FocusDirection} from '../helpers/fastSmoothScroll';\r\nimport findUpAsChild from '../helpers/dom/findUpAsChild';\r\nimport whichChild from '../helpers/dom/whichChild';\r\nimport ListenerSetter from '../helpers/listenerSetter';\r\nimport {attachClickEvent} from '../helpers/dom/clickEvent';\r\n\r\nexport function horizontalMenu(\r\n  tabs: HTMLElement,\r\n  content: HTMLElement,\r\n  onClick?: (id: number, tabContent: HTMLDivElement, animate: boolean) => void | boolean | Promise<void | boolean>,\r\n  onTransitionEnd?: () => void,\r\n  transitionTime = 250,\r\n  scrollableX?: ScrollableX,\r\n  listenerSetter?: ListenerSetter\r\n) {\r\n  const selectTab = TransitionSlider(content, tabs || content.dataset.animation === 'tabs' ? 'tabs' : 'navigation', transitionTime, onTransitionEnd, undefined, listenerSetter);\r\n\r\n  if(!tabs) {\r\n    return selectTab;\r\n  }\r\n\r\n  const proxy = new Proxy(selectTab, {\r\n    apply: (target, that, args) => {\r\n      const id = +args[0];\r\n      const animate = args[1] !== undefined ? args[1] : true;\r\n\r\n      const el = (tabs.querySelector(`[data-tab=\"${id}\"]`) || tabs.children[id]) as HTMLElement;\r\n      selectTarget(el, id, animate);\r\n    }\r\n  });\r\n\r\n  const selectTarget = async(target: HTMLElement, id: number, animate = true) => {\r\n    const tabContent = content.children[id] as HTMLDivElement;\r\n\r\n    if(onClick) {\r\n      const result1 = onClick(id, tabContent, animate);\r\n      const canChange = result1 instanceof Promise ? await result1 : result1;\r\n      if(canChange !== undefined && !canChange) {\r\n        return;\r\n      }\r\n    }\r\n\r\n    if(scrollableX) {\r\n      scrollableX.scrollIntoViewNew({\r\n        element: target.parentElement.children[id] as HTMLElement,\r\n        position: 'center',\r\n        forceDirection: animate ? undefined : FocusDirection.Static,\r\n        forceDuration: transitionTime,\r\n        axis: 'x'\r\n      });\r\n    }\r\n\r\n    if(!rootScope.settings.animationsEnabled) {\r\n      animate = false;\r\n    }\r\n\r\n    const prevId = selectTab.prevId();\r\n    if(target.classList.contains('active') || id === prevId) {\r\n      return false;\r\n    }\r\n\r\n    const mutateCallback = animate ? fastRaf : (cb: () => void) => cb();\r\n\r\n    const prev = tabs.querySelector(tagName.toLowerCase() + '.active') as HTMLElement;\r\n    if(prev) {\r\n      mutateCallback(() => {\r\n        prev.classList.remove('active');\r\n      });\r\n    }\r\n\r\n    // a great stripe from Jolly Cobra\r\n    if(useStripe && prevId !== -1 && animate) {\r\n      mutateCallback(() => {\r\n        const indicator = target.querySelector('i')!;\r\n        const currentIndicator = target.parentElement.children[prevId].querySelector('i')!;\r\n\r\n        currentIndicator.classList.remove('animate');\r\n        indicator.classList.remove('animate');\r\n\r\n        // We move and resize our indicator so it repeats the position and size of the previous one.\r\n        const shiftLeft = currentIndicator.parentElement.parentElement.offsetLeft - indicator.parentElement.parentElement.offsetLeft;\r\n        const scaleFactor = currentIndicator.clientWidth / indicator.clientWidth;\r\n        indicator.style.transform = `translate3d(${shiftLeft}px, 0, 0) scale3d(${scaleFactor}, 1, 1)`;\r\n\r\n        // console.log(`translate3d(${shiftLeft}px, 0, 0) scale3d(${scaleFactor}, 1, 1)`);\r\n\r\n        fastRaf(() => {\r\n          // Now we remove the transform to let it animate to its own position and size.\r\n          indicator.classList.add('animate');\r\n          indicator.style.transform = 'none';\r\n        });\r\n      });\r\n    }\r\n\r\n    mutateCallback(() => {\r\n      target.classList.add('active');\r\n    });\r\n\r\n    selectTab(id, animate);\r\n  };\r\n\r\n  const useStripe = !tabs.classList.contains('no-stripe');\r\n\r\n  // const tagName = tabs.classList.contains('menu-horizontal-div') ? 'BUTTON' : 'LI';\r\n  const tagName = tabs.firstElementChild.tagName;\r\n  attachClickEvent(tabs, (e) => {\r\n    let target = e.target as HTMLElement;\r\n\r\n    target = findUpAsChild(target, tabs);\r\n\r\n    // console.log('tabs click:', target);\r\n\r\n    if(!target) return false;\r\n\r\n    let id: number;\r\n    if(target.dataset.tab) {\r\n      id = +target.dataset.tab;\r\n      if(id === -1) {\r\n        return false;\r\n      }\r\n    } else {\r\n      id = whichChild(target);\r\n    }\r\n\r\n    selectTarget(target, id);\r\n  }, {listenerSetter});\r\n\r\n  return proxy;\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport cancelEvent from '../helpers/dom/cancelEvent';\r\nimport simulateEvent from '../helpers/dom/dispatchEvent';\r\nimport documentFragmentToHTML from '../helpers/dom/documentFragmentToHTML';\r\nimport findUpAttribute from '../helpers/dom/findUpAttribute';\r\nimport getRichValue from '../helpers/dom/getRichValue';\r\nimport isInputEmpty from '../helpers/dom/isInputEmpty';\r\nimport selectElementContents from '../helpers/dom/selectElementContents';\r\nimport setInnerHTML from '../helpers/dom/setInnerHTML';\r\nimport {MessageEntity} from '../layer';\r\nimport {i18n, LangPackKey, _i18n} from '../lib/langPack';\r\nimport mergeEntities from '../lib/richTextProcessor/mergeEntities';\r\nimport parseEntities from '../lib/richTextProcessor/parseEntities';\r\nimport wrapDraftText from '../lib/richTextProcessor/wrapDraftText';\r\n\r\nlet init = () => {\r\n  document.addEventListener('paste', (e) => {\r\n    const input = findUpAttribute(e.target, 'contenteditable=\"true\"');\r\n    if(!input) {\r\n      return;\r\n    }\r\n\r\n    const noLinebreaks = !!input.dataset.noLinebreaks;\r\n    e.preventDefault();\r\n    let text: string, entities: MessageEntity[];\r\n\r\n    // @ts-ignore\r\n    let plainText: string = (e.originalEvent || e).clipboardData.getData('text/plain');\r\n    let usePlainText = true;\r\n\r\n    // @ts-ignore\r\n    let html: string = (e.originalEvent || e).clipboardData.getData('text/html');\r\n\r\n    const filterEntity = (e: MessageEntity) => e._ === 'messageEntityEmoji' || (e._ === 'messageEntityLinebreak' && !noLinebreaks);\r\n    if(noLinebreaks) {\r\n      const regExp = /[\\r\\n]/g;\r\n      plainText = plainText.replace(regExp, '');\r\n      html = html.replace(regExp, '');\r\n    }\r\n\r\n    if(html.trim()) {\r\n      html = html.replace(/<style([\\s\\S]*)<\\/style>/, '');\r\n      html = html.replace(/<!--([\\s\\S]*)-->/, '');\r\n\r\n      const match = html.match(/<body>([\\s\\S]*)<\\/body>/);\r\n      if(match) {\r\n        html = match[1].trim();\r\n      }\r\n\r\n      const span: HTMLElement = document.createElement('span');\r\n      span.innerHTML = html;\r\n\r\n      let curChild = span.firstChild;\r\n      while(curChild) { // * fix whitespace between elements like <p>asd</p>\\n<p>zxc</p>\r\n        const nextSibling = curChild.nextSibling;\r\n        if(curChild.nodeType === 3) {\r\n          if(!curChild.nodeValue.trim()) {\r\n            curChild.remove();\r\n          }\r\n        }\r\n\r\n        curChild = nextSibling;\r\n      }\r\n\r\n      const richValue = getRichValue(span, true);\r\n      if(richValue.value.replace(/\\s/g, '').length === plainText.replace(/\\s/g, '').length) {\r\n        text = richValue.value;\r\n        entities = richValue.entities;\r\n        usePlainText = false;\r\n\r\n        let entities2 = parseEntities(text);\r\n        entities2 = entities2.filter(filterEntity);\r\n        mergeEntities(entities, entities2);\r\n      }\r\n    }\r\n\r\n    if(usePlainText) {\r\n      text = plainText;\r\n      entities = parseEntities(text);\r\n      entities = entities.filter(filterEntity);\r\n    }\r\n\r\n    const fragment = wrapDraftText(text, {entities});\r\n    text = documentFragmentToHTML(fragment);\r\n\r\n    window.document.execCommand('insertHTML', false, text);\r\n  });\r\n\r\n  init = null;\r\n};\r\n\r\n// ! it doesn't respect symbols other than strongs\r\n/* const checkAndSetRTL = (input: HTMLElement) => {\r\n  //const isEmpty = isInputEmpty(input);\r\n  //console.log('input', isEmpty);\r\n\r\n  //const char = [...getRichValue(input)][0];\r\n  const char = (input instanceof HTMLInputElement ? input.value : input.innerText)[0];\r\n  let direction = 'ltr';\r\n  if(char && checkRTL(char)) {\r\n    direction = 'rtl';\r\n  }\r\n\r\n  //console.log('RTL', direction, char);\r\n\r\n  input.style.direction = direction;\r\n}; */\r\n\r\nexport enum InputState {\r\n  Neutral = 0,\r\n  Valid = 1,\r\n  Error = 2\r\n};\r\n\r\nexport type InputFieldOptions = {\r\n  placeholder?: LangPackKey,\r\n  label?: LangPackKey,\r\n  labelOptions?: any[],\r\n  labelText?: string | DocumentFragment,\r\n  name?: string,\r\n  maxLength?: number,\r\n  showLengthOn?: number,\r\n  plainText?: true,\r\n  required?: boolean,\r\n  canBeEdited?: boolean,\r\n  validate?: () => boolean,\r\n  inputMode?: 'tel' | 'numeric',\r\n  withLinebreaks?: boolean,\r\n  autocomplete?: string\r\n};\r\n\r\nexport default class InputField {\r\n  public container: HTMLElement;\r\n  public input: HTMLElement;\r\n  public label: HTMLLabelElement;\r\n\r\n  public originalValue: string;\r\n\r\n  public required: boolean;\r\n  public validate: () => boolean;\r\n\r\n  constructor(public options: InputFieldOptions = {}) {\r\n    this.container = document.createElement('div');\r\n    this.container.classList.add('input-field');\r\n\r\n    this.required = options.required;\r\n    this.validate = options.validate;\r\n\r\n    if(options.maxLength !== undefined && options.showLengthOn === undefined) {\r\n      options.showLengthOn = Math.min(40, Math.round(options.maxLength / 3));\r\n    }\r\n\r\n    const {placeholder, maxLength, showLengthOn, name, plainText, canBeEdited = true, autocomplete} = options;\r\n    const label = options.label || options.labelText;\r\n\r\n    const onInputCallbacks: Array<() => void> = [];\r\n    let input: HTMLElement;\r\n    if(!plainText) {\r\n      if(init) {\r\n        init();\r\n      }\r\n\r\n      this.container.innerHTML = `\r\n      <div contenteditable=\"${String(!!canBeEdited)}\" class=\"input-field-input\"></div>\r\n      `;\r\n\r\n      input = this.container.firstElementChild as HTMLElement;\r\n      // const observer = new MutationObserver(() => {\r\n      //   //checkAndSetRTL(input);\r\n\r\n      //   if(processInput) {\r\n      //     processInput();\r\n      //   }\r\n      // });\r\n\r\n      onInputCallbacks.push(() => {\r\n        // * because if delete all characters there will br left\r\n        if(isInputEmpty(input)) {\r\n          input.textContent = '';\r\n        }\r\n      });\r\n\r\n      // ! childList for paste first symbol\r\n      // observer.observe(input, {characterData: true, childList: true, subtree: true});\r\n    } else {\r\n      this.container.innerHTML = `\r\n      <input type=\"text\" ${name ? `name=\"${name}\"` : ''} autocomplete=\"${autocomplete ?? 'off'}\" ${label ? 'required=\"\"' : ''} class=\"input-field-input\">\r\n      `;\r\n\r\n      input = this.container.firstElementChild as HTMLElement;\r\n      // input.addEventListener('input', () => checkAndSetRTL(input));\r\n    }\r\n\r\n    input.setAttribute('dir', 'auto');\r\n\r\n    if(options.inputMode) {\r\n      input.inputMode = options.inputMode;\r\n    }\r\n\r\n    if(placeholder) {\r\n      _i18n(input, placeholder, undefined, 'placeholder');\r\n    }\r\n\r\n    if(label || placeholder) {\r\n      const border = document.createElement('div');\r\n      border.classList.add('input-field-border');\r\n      this.container.append(border);\r\n    }\r\n\r\n    if(label) {\r\n      this.label = document.createElement('label');\r\n      this.setLabel();\r\n      this.container.append(this.label);\r\n    }\r\n\r\n    if(maxLength) {\r\n      const labelEl = this.container.lastElementChild as HTMLLabelElement;\r\n      let showingLength = false;\r\n\r\n      const onInput = () => {\r\n        const wasError = input.classList.contains('error');\r\n        // * https://stackoverflow.com/a/54369605 #2 to count emoji as 1 symbol\r\n        const inputLength = plainText ? (input as HTMLInputElement).value.length : [...getRichValue(input, false).value].length;\r\n        const diff = maxLength - inputLength;\r\n        const isError = diff < 0;\r\n        input.classList.toggle('error', isError);\r\n\r\n        // this.onLengthChange && this.onLengthChange(inputLength, isError);\r\n\r\n        if(isError || diff <= showLengthOn) {\r\n          this.setLabel();\r\n          labelEl.append(` (${maxLength - inputLength})`);\r\n          if(!showingLength) showingLength = true;\r\n        } else if((wasError && !isError) || showingLength) {\r\n          this.setLabel();\r\n          showingLength = false;\r\n        }\r\n      };\r\n\r\n      onInputCallbacks.push(onInput);\r\n    }\r\n\r\n    const noLinebreaks = !options.withLinebreaks;\r\n    if(noLinebreaks && !plainText) {\r\n      input.dataset.noLinebreaks = '1';\r\n      input.addEventListener('keypress', (e) => {\r\n        if(e.key === 'Enter') {\r\n          e.preventDefault();\r\n          return false;\r\n        }\r\n      });\r\n    }\r\n\r\n    if(onInputCallbacks.length) {\r\n      input.addEventListener('input', () => {\r\n        onInputCallbacks.forEach((callback) => callback());\r\n      });\r\n    }\r\n\r\n    this.input = input;\r\n  }\r\n\r\n  public select() {\r\n    if(!this.value) { // * avoid selecting whole empty field on iOS devices\r\n      return;\r\n    }\r\n\r\n    if(this.options.plainText) {\r\n      (this.input as HTMLInputElement).select(); // * select text\r\n    } else {\r\n      selectElementContents(this.input);\r\n    }\r\n  }\r\n\r\n  public setLabel() {\r\n    this.label.textContent = '';\r\n    if(this.options.labelText) {\r\n      setInnerHTML(this.label, this.options.labelText);\r\n    } else {\r\n      this.label.append(i18n(this.options.label, this.options.labelOptions));\r\n    }\r\n  }\r\n\r\n  get value() {\r\n    return this.options.plainText ? (this.input as HTMLInputElement).value : getRichValue(this.input, false).value;\r\n    // return getRichValue(this.input);\r\n  }\r\n\r\n  set value(value: string) {\r\n    this.setValueSilently(value, true);\r\n\r\n    simulateEvent(this.input, 'input');\r\n  }\r\n\r\n  public setValueSilently(value: string, fromSet?: boolean) {\r\n    if(this.options.plainText) {\r\n      (this.input as HTMLInputElement).value = value;\r\n    } else {\r\n      this.input.innerHTML = value;\r\n    }\r\n  }\r\n\r\n  public isChanged() {\r\n    return this.value !== this.originalValue;\r\n  }\r\n\r\n  public isValid() {\r\n    return !this.input.classList.contains('error') &&\r\n      (!this.validate || this.validate()) &&\r\n      (!this.required || !isInputEmpty(this.input));\r\n  }\r\n\r\n  public isValidToChange() {\r\n    return this.isValid() && this.isChanged();\r\n  }\r\n\r\n  public setDraftValue(value = '', silent?: boolean) {\r\n    if(!this.options.plainText) {\r\n      value = documentFragmentToHTML(wrapDraftText(value));\r\n    }\r\n\r\n    if(silent) {\r\n      this.setValueSilently(value, false);\r\n    } else {\r\n      this.value = value;\r\n    }\r\n  }\r\n\r\n  public setOriginalValue(value: InputField['originalValue'] = '', silent?: boolean) {\r\n    this.originalValue = value;\r\n    this.setDraftValue(value, silent);\r\n  }\r\n\r\n  public setState(state: InputState, label?: LangPackKey) {\r\n    if(label) {\r\n      this.label.textContent = '';\r\n      this.label.append(i18n(label, this.options.labelOptions));\r\n    } else {\r\n      this.setLabel();\r\n    }\r\n\r\n    this.input.classList.toggle('error', !!(state & InputState.Error));\r\n    this.input.classList.toggle('valid', !!(state & InputState.Valid));\r\n  }\r\n\r\n  public setError(label?: LangPackKey) {\r\n    this.setState(InputState.Error, label);\r\n  }\r\n}\r\n","// https://stackoverflow.com/a/6150060\nexport default function selectElementContents(el: HTMLElement) {\n  const range = document.createRange();\n  range.selectNodeContents(el);\n  const sel = window.getSelection();\n  sel.removeAllRanges();\n  sel.addRange(range);\n}\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\n// import { getRichValue } from \"../helpers/dom\";\r\nimport {LangPackKey} from '../lib/langPack';\r\nimport InputField from './inputField';\r\n\r\nexport default class InputSearch {\r\n  public container: HTMLElement;\r\n  public input: HTMLElement;\r\n  public inputField: InputField;\r\n  public clearBtn: HTMLElement;\r\n\r\n  public prevValue = '';\r\n  public timeout = 0;\r\n  public onChange: (value: string) => void;\r\n  public onClear: () => void;\r\n\r\n  constructor(placeholder: LangPackKey, onChange?: (value: string) => void) {\r\n    this.inputField = new InputField({\r\n      placeholder,\r\n      plainText: true\r\n    });\r\n\r\n    this.container = this.inputField.container;\r\n    this.container.classList.remove('input-field');\r\n    this.container.classList.add('input-search');\r\n\r\n    this.onChange = onChange;\r\n\r\n    this.input = this.inputField.input;\r\n    this.input.classList.add('input-search-input');\r\n\r\n    const searchIcon = document.createElement('i');\r\n    searchIcon.classList.add('tgico', 'tgico-search');\r\n\r\n    this.clearBtn = document.createElement('i');\r\n    this.clearBtn.classList.add('tgico', 'btn-icon', 'tgico-close');\r\n\r\n    this.input.addEventListener('input', this.onInput);\r\n    this.clearBtn.addEventListener('click', this.onClearClick);\r\n\r\n    this.container.append(searchIcon, this.clearBtn);\r\n  }\r\n\r\n  onInput = () => {\r\n    if(!this.onChange) return;\r\n\r\n    const value = this.value;\r\n\r\n    // this.input.classList.toggle('is-empty', !value.trim());\r\n\r\n    if(value !== this.prevValue) {\r\n      this.prevValue = value;\r\n      clearTimeout(this.timeout);\r\n      this.timeout = window.setTimeout(() => {\r\n        this.onChange(value);\r\n      }, 200);\r\n    }\r\n  };\r\n\r\n  onClearClick = () => {\r\n    this.value = '';\r\n    this.onChange && this.onChange('');\r\n    this.onClear && this.onClear();\r\n  };\r\n\r\n  get value() {\r\n    return this.inputField.value;\r\n  }\r\n\r\n  set value(value: string) {\r\n    this.prevValue = value;\r\n    clearTimeout(this.timeout);\r\n    this.inputField.value = value;\r\n  }\r\n\r\n  public remove() {\r\n    clearTimeout(this.timeout);\r\n    this.input.removeEventListener('input', this.onInput);\r\n    this.clearBtn.removeEventListener('click', this.onClearClick);\r\n  }\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport VisibilityIntersector, {OnVisibilityChangeItem} from './visibilityIntersector';\r\nimport findAndSpliceAll from '../helpers/array/findAndSpliceAll';\r\nimport findAndSplice from '../helpers/array/findAndSplice';\r\nimport LazyLoadQueueIntersector, {LazyLoadElement} from './lazyLoadQueueIntersector';\r\n\r\nexport default class LazyLoadQueue extends LazyLoadQueueIntersector {\r\n  constructor(parallelLimit?: number) {\r\n    super(parallelLimit);\r\n\r\n    this.intersector = new VisibilityIntersector(this.onVisibilityChange);\r\n  }\r\n\r\n  private onVisibilityChange = ({target, visible}: OnVisibilityChangeItem) => {\r\n    if(visible) {\r\n      /* if(DEBUG) {\r\n        this.log('isIntersecting', target);\r\n      } */\r\n\r\n      // need for set element first if scrolled\r\n      findAndSpliceAll(this.queue, (i) => i.div === target).forEach((item) => {\r\n        item.wasSeen = true;\r\n        this.queue.unshift(item);\r\n        // this.processQueue(item);\r\n      });\r\n\r\n      this.setProcessQueueTimeout();\r\n    }\r\n  };\r\n\r\n  protected getItem() {\r\n    return findAndSplice(this.queue, item => item.wasSeen);\r\n  }\r\n\r\n  public async processItem(item: LazyLoadElement) {\r\n    await super.processItem(item);\r\n    this.intersector.unobserve(item.div);\r\n  }\r\n\r\n  protected addElement(method: 'push' | 'unshift', el: LazyLoadElement) {\r\n    const inserted = super.addElement(method, el);\r\n\r\n    if(!inserted) return false;\r\n\r\n    this.intersector.observe(el.div);\r\n    /* if(el.wasSeen) {\r\n      this.processQueue(el);\r\n    } else  */if(!el.hasOwnProperty('wasSeen')) {\r\n      el.wasSeen = false;\r\n    }\r\n\r\n    return true;\r\n  }\r\n}\r\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport findAndSpliceAll from '../helpers/array/findAndSpliceAll';\nimport LazyLoadQueueBase, {LazyLoadElementBase} from './lazyLoadQueueBase';\nimport VisibilityIntersector from './visibilityIntersector';\n\nexport type LazyLoadElement = Omit<LazyLoadElementBase, 'load'> & {\n  load: (target?: HTMLElement) => Promise<any>,\n  div: HTMLElement\n  wasSeen?: boolean,\n};\n\nexport default class LazyLoadQueueIntersector extends LazyLoadQueueBase {\n  protected queue: Array<LazyLoadElement> = [];\n  protected inProcess: Set<LazyLoadElement> = new Set();\n\n  public intersector: VisibilityIntersector;\n  protected intersectorTimeout: number;\n\n  constructor(parallelLimit?: number) {\n    super(parallelLimit);\n  }\n\n  public lock() {\n    super.lock();\n    this.intersector.lock();\n  }\n\n  public unlock() {\n    super.unlock();\n    this.intersector.unlock();\n  }\n\n  public unlockAndRefresh() {\n    super.unlock();\n    this.intersector.unlockAndRefresh();\n  }\n\n  public clear() {\n    super.clear();\n    this.intersector.disconnect();\n  }\n\n  public refresh() {\n    this.intersector.refresh();\n  }\n\n  protected loadItem(item: LazyLoadElement) {\n    return item.load(item.div);\n  }\n\n  protected addElement(method: 'push' | 'unshift', el: LazyLoadElement) {\n    const item = this.queue.find((i) => i.div === el.div && i.load === el.load);\n    if(item) {\n      return false;\n    } else {\n      for(const item of this.inProcess) {\n        if(item.div === el.div && item.load === el.load) {\n          return false;\n        }\n      }\n    }\n\n    this.queue[method](el);\n    return true;\n  }\n\n  protected setProcessQueueTimeout() {\n    if(!this.intersectorTimeout) {\n      this.intersectorTimeout = window.setTimeout(() => {\n        this.intersectorTimeout = 0;\n        this.processQueue();\n      }, 0);\n    }\n  }\n\n  public push(el: LazyLoadElement) {\n    super.push(el);\n  }\n\n  public unshift(el: LazyLoadElement) {\n    super.unshift(el);\n  }\n\n  public unobserve(el: HTMLElement) {\n    findAndSpliceAll(this.queue, (i) => i.div === el);\n\n    this.intersector.unobserve(el);\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport {GrabEvent} from '../helpers/dom/attachGrabListeners';\nimport appMediaPlaybackController from './appMediaPlaybackController';\nimport RangeSelector from './rangeSelector';\n\nexport default class MediaProgressLine extends RangeSelector {\n  protected filledLoad: HTMLDivElement;\n\n  protected progressRAF = 0;\n\n  protected media: HTMLMediaElement;\n  protected streamable: boolean;\n\n  constructor(media?: HTMLAudioElement | HTMLVideoElement, streamable?: boolean, withTransition?: boolean, useTransform?: boolean) {\n    super({\n      step: 1000 / 60 / 1000,\n      min: 0,\n      max: 1,\n      withTransition,\n      useTransform\n    }, 0);\n\n    if(media) {\n      this.setMedia(media, streamable);\n    }\n  }\n\n  public setMedia(media: HTMLMediaElement, streamable = false) {\n    if(this.media) {\n      this.removeListeners();\n    }\n\n    if(streamable && !this.filledLoad) {\n      this.filledLoad = document.createElement('div');\n      this.filledLoad.classList.add('progress-line__filled', 'progress-line__loaded');\n      this.container.prepend(this.filledLoad);\n      // this.setLoadProgress();\n    } else if(this.filledLoad) {\n      this.filledLoad.classList.toggle('hide', !streamable);\n    }\n\n    this.media = media;\n    this.streamable = streamable;\n    if(!media.paused || media.currentTime > 0) {\n      this.onPlay();\n    }\n\n    let wasPlaying = false;\n    this.setSeekMax();\n    this.setListeners();\n    this.setHandlers({\n      onMouseDown: () => {\n        wasPlaying = !this.media.paused;\n        wasPlaying && this.media.pause();\n      },\n\n      onMouseUp: (e) => {\n        // cancelEvent(e.event);\n        wasPlaying && this.media.play();\n      }\n    });\n  }\n\n  protected onLoadedData = () => {\n    this.max = this.media.duration;\n    this.seek.setAttribute('max', '' + this.max);\n  };\n\n  protected onEnded = () => {\n    this.setProgress();\n  };\n\n  protected onPlay = () => {\n    const r = () => {\n      this.setProgress();\n\n      this.progressRAF = this.media.paused ? 0 : window.requestAnimationFrame(r);\n    };\n\n    if(this.progressRAF) {\n      window.cancelAnimationFrame(this.progressRAF);\n    }\n\n    if(this.streamable) {\n      this.setLoadProgress();\n    }\n\n    this.progressRAF = window.requestAnimationFrame(r);\n  };\n\n  protected onTimeUpdate = () => {\n    if(this.media.paused) {\n      this.setProgress();\n\n      if(this.streamable) {\n        this.setLoadProgress();\n      }\n    }\n  };\n\n  protected onProgress = (e: Event) => {\n    this.setLoadProgress();\n  };\n\n  protected scrub(e: GrabEvent) {\n    const scrubTime = super.scrub(e);\n    this.media.currentTime = scrubTime;\n    return scrubTime;\n  }\n\n  protected setLoadProgress() {\n    if(appMediaPlaybackController.isSafariBuffering(this.media)) return;\n    const buf = this.media.buffered;\n    const numRanges = buf.length;\n\n    const currentTime = this.media.currentTime;\n    let nearestStart = 0, end = 0;\n    for(let i = 0; i < numRanges; ++i) {\n      const start = buf.start(i);\n      if(currentTime >= start && start >= nearestStart) {\n        nearestStart = start;\n        end = buf.end(i);\n      }\n\n      // console.log('onProgress range:', i, buf.start(i), buf.end(i), this.media);\n    }\n\n    // console.log('onProgress correct range:', nearestStart, end, this.media);\n\n    const percents = this.media.duration ? end / this.media.duration : 0;\n    this.filledLoad.style.width = (percents * 100) + '%';\n    // this.filledLoad.style.transform = 'scaleX(' + percents + ')';\n  }\n\n  protected setSeekMax() {\n    this.max = this.media.duration || 0;\n    if(this.max > 0) {\n      this.onLoadedData();\n    } else {\n      this.media.addEventListener('loadeddata', this.onLoadedData);\n    }\n  }\n\n  public setProgress() {\n    if(appMediaPlaybackController.isSafariBuffering(this.media)) return;\n    const currentTime = this.media.currentTime;\n\n    super.setProgress(currentTime);\n  }\n\n  public setListeners() {\n    super.setListeners();\n    this.media.addEventListener('ended', this.onEnded);\n    this.media.addEventListener('play', this.onPlay);\n    this.media.addEventListener('timeupdate', this.onTimeUpdate);\n    this.streamable && this.media.addEventListener('progress', this.onProgress);\n  }\n\n  public removeListeners() {\n    super.removeListeners();\n\n    if(this.media) {\n      this.media.removeEventListener('loadeddata', this.onLoadedData);\n      this.media.removeEventListener('ended', this.onEnded);\n      this.media.removeEventListener('play', this.onPlay);\n      this.media.removeEventListener('timeupdate', this.onTimeUpdate);\n      this.streamable && this.media.removeEventListener('progress', this.onProgress);\n    }\n\n    if(this.progressRAF) {\n      window.cancelAnimationFrame(this.progressRAF);\n      this.progressRAF = 0;\n    }\n  }\n}\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport {FontFamily, FontSize, FontWeight} from '../config/font';\r\nimport getTextWidth from '../helpers/canvas/getTextWidth';\r\nimport mediaSizes from '../helpers/mediaSizes';\r\nimport clamp from '../helpers/number/clamp';\r\nimport {fastRaf} from '../helpers/schedulers';\r\n\r\n// Thanks to https://stackoverflow.com/a/49349813\r\n\r\n/**\r\n * Attibute modifier to create middle ellipsis\r\n * When the attribute value is left blank the ellipsis will be in the middle\r\n * When positive the attribute value will be used as a percentage\r\n * When negative the attribute value will be used as character index counted from the end\r\n * @example\r\n *   <div data-middle-ellipsis>A Javascript solution to middle ellipsis</div>\r\n *   <div data-middle-ellipsis=\"20\">A Javascript solution to middle ellipsis</div>\r\n *   <div data-middle-ellipsis=\"-3\">A Javascript solution to middle ellipsis</div>\r\n */\r\nconst ellipsis = '';\r\nconst map: Map<HTMLElement, {\r\n  text: string,\r\n  textLength: number,\r\n  from: number,\r\n  multiplier: number,\r\n  font: string,\r\n  textWidth: number,\r\n  elementWidth: number\r\n}> = new Map();\r\n\r\nconst testQueue: Set<HTMLElement> = new Set();\r\nconst fontSize = '16px';\r\nlet pendingTest = false;\r\n\r\nfunction setTestQueue() {\r\n  if(pendingTest) {\r\n    return;\r\n  }\r\n\r\n  pendingTest = true;\r\n  fastRaf(() => {\r\n    pendingTest = false;\r\n    testQueueElements();\r\n  });\r\n}\r\n\r\nfunction testQueueElements() {\r\n  testQueue.forEach(testElement);\r\n  testQueue.clear();\r\n}\r\n\r\nwindow.addEventListener('resize', () => {\r\n  for(const [key] of map) {\r\n    testQueue.add(key);\r\n  }\r\n\r\n  setTestQueue();\r\n}, {capture: true, passive: true});\r\n\r\nfunction getElementWidth(element: HTMLElement) {\r\n  const type = element.dataset.sizeType;\r\n  if(type) {\r\n    const mediaSize = mediaSizes.active;\r\n    // @ts-ignore\r\n    const size: MediaSize = mediaSize[type];\r\n    return size.width;\r\n  }\r\n\r\n  return element.getBoundingClientRect().width;\r\n}\r\n\r\nfunction testElement(element: HTMLElement) {\r\n  // const perf = performance.now();\r\n  // do not recalculate variables a second time\r\n  let mapped = map.get(element);\r\n  const firstTime = !mapped;\r\n\r\n  let {text, textLength, from, multiplier, font, textWidth, elementWidth} = mapped || {};\r\n  // console.log('[MEE] testElement got mapped', mapped);\r\n\r\n  if(firstTime) {\r\n    text = element.textContent;\r\n    textLength = text.length;\r\n    from = /* parseFloat(element.getAttribute(attributeName)) ||  */50;\r\n    multiplier = from > 0 && from / 100;\r\n\r\n    // const perf = performance.now();\r\n    font = `${element.dataset.fontWeight || FontWeight} ${FontSize} ${FontFamily}`;\r\n    /* const computedStyle = window.getComputedStyle(elm, null);\r\n    font = `${computedStyle.getPropertyValue('font-weight')} ${computedStyle.getPropertyValue('font-size')} ${computedStyle.getPropertyValue('font-family')}`; */\r\n    // console.log('testMiddleEllipsis get computed style:', performance.now() - perf, font);\r\n\r\n    textWidth = getTextWidth(text, font);\r\n    // const perf = performance.now();\r\n    elementWidth = getElementWidth(element);\r\n    // console.log('testMiddleEllipsis get offsetWidth:', performance.now() - perf, font);\r\n    mapped = {text, textLength, from, multiplier, font, textWidth, elementWidth};\r\n    map.set(element, mapped);\r\n\r\n    // console.log('[MEE] testElement map set', element);\r\n  }\r\n\r\n  const newElementWidth = getElementWidth(element);\r\n  const widthChanged = firstTime || elementWidth !== newElementWidth;\r\n  !firstTime && widthChanged && (mapped.elementWidth = elementWidth = newElementWidth);\r\n\r\n  if(widthChanged) {\r\n    if(textWidth > elementWidth) {\r\n      element.setAttribute('title', text);\r\n      let smallerText = text;\r\n      let smallerWidth = elementWidth;\r\n      while(smallerText.length > 3) {\r\n        const smallerTextLength = smallerText.length;\r\n        const half = multiplier &&\r\n          clamp(multiplier * smallerTextLength << 0, 1, smallerTextLength - 2) ||\r\n          Math.max(smallerTextLength + from - 1, 1);\r\n        const half1 = smallerText.substr(0, half).replace(/\\s*$/, '');\r\n        const half2 = smallerText.substr(half + 1).replace(/^\\s*/, '');\r\n        smallerText = half1 + half2;\r\n        smallerWidth = getTextWidth(smallerText + ellipsis, font);\r\n        if(smallerWidth < elementWidth) {\r\n          element.textContent = half1 + ellipsis + half2;\r\n          break;\r\n        }\r\n      }\r\n\r\n      // * set new width after cutting text\r\n      mapped.elementWidth = getElementWidth(element);\r\n      // mapped.textWidth = smallerWidth;\r\n    } else {\r\n      element.removeAttribute('title');\r\n    }\r\n  }\r\n\r\n  // console.log('testMiddleEllipsis for element:', elm, performance.now() - perf);\r\n}\r\n\r\nexport class MiddleEllipsisElement extends HTMLElement {\r\n  connectedCallback() {\r\n    // console.log('[MEE]: connectedCallback before', map.has(this), testQueue.has(this), map.size, this.textContent, map);\r\n\r\n    map.set(this, null);\r\n    if(this.dataset.sizeType) {\r\n      testElement(this);\r\n    } else {\r\n      testQueue.add(this);\r\n      setTestQueue();\r\n    }\r\n    // testElement(this);\r\n\r\n    // console.log('[MEE]: connectedCallback after', map.has(this), map.size, testQueue.has(this), testQueue.size);\r\n  }\r\n\r\n  disconnectedCallback() {\r\n    const deleted = map.delete(this);\r\n    testQueue.delete(this);\r\n    // console.log('[MEE]: disconnectedCallback', deleted, map.has(this), map.size, this.textContent, map);\r\n  }\r\n}\r\n\r\ncustomElements.define('middle-ellipsis-element', MiddleEllipsisElement);\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport lottieLoader, {LottieLoader} from '../../lib/rlottie/lottieLoader';\r\nimport RLottiePlayer from '../../lib/rlottie/rlottiePlayer';\r\nimport PasswordInputField from '../passwordInputField';\r\n\r\nexport default class PasswordMonkey {\r\n  public container: HTMLElement;\r\n  public animation: RLottiePlayer;\r\n  public needFrame = 0;\r\n  protected loadPromise: ReturnType<LottieLoader['waitForFirstFrame']>;\r\n\r\n  constructor(protected passwordInputField: PasswordInputField, protected size: number) {\r\n    this.container = document.createElement('div');\r\n    this.container.classList.add('media-sticker-wrapper');\r\n  }\r\n\r\n  public load() {\r\n    if(this.loadPromise) return this.loadPromise;\r\n    return this.loadPromise = lottieLoader.loadAnimationAsAsset({\r\n      container: this.container,\r\n      loop: false,\r\n      autoplay: false,\r\n      width: this.size,\r\n      height: this.size,\r\n      noCache: true\r\n    // }, 'assets/img/TwoFactorSetupMonkeyClose.tgs').then((_animation) => {\r\n    }, 'TwoFactorSetupMonkeyPeek').then((_animation) => {\r\n      // return;\r\n      this.animation = _animation;\r\n      this.animation.addEventListener('enterFrame', currentFrame => {\r\n        // console.log('enterFrame', currentFrame, this.needFrame);\r\n\r\n        if((this.animation.direction === 1 && currentFrame >= this.needFrame) ||\r\n          (this.animation.direction === -1 && currentFrame <= this.needFrame)) {\r\n          this.animation.setSpeed(1);\r\n          this.animation.pause();\r\n        }\r\n      });\r\n\r\n      this.passwordInputField.onVisibilityClickAdditional = () => {\r\n        if(this.passwordInputField.passwordVisible) {\r\n          this.animation.setDirection(1);\r\n          this.animation.curFrame = 0;\r\n          this.needFrame = 16;\r\n          this.animation.play();\r\n        } else {\r\n          this.animation.setDirection(-1);\r\n          this.animation.curFrame = 16;\r\n          this.needFrame = 0;\r\n          this.animation.play();\r\n        }\r\n      };\r\n\r\n      return lottieLoader.waitForFirstFrame(_animation);\r\n    });\r\n  }\r\n\r\n  public remove() {\r\n    if(this.animation) {\r\n      this.animation.remove();\r\n    }\r\n  }\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport InputField from '../inputField';\r\nimport lottieLoader from '../../lib/rlottie/lottieLoader';\r\nimport RLottiePlayer from '../../lib/rlottie/rlottiePlayer';\r\n\r\nexport default class TrackingMonkey {\r\n  public container: HTMLElement;\r\n\r\n  protected max = 45;\r\n  protected needFrame = 0;\r\n\r\n  protected animation: RLottiePlayer;\r\n  protected idleAnimation: RLottiePlayer;\r\n\r\n  protected loadPromise: Promise<any>;\r\n\r\n  constructor(protected inputField: InputField, protected size: number) {\r\n    this.container = document.createElement('div');\r\n    this.container.classList.add('media-sticker-wrapper');\r\n\r\n    const input = inputField.input;\r\n\r\n    input.addEventListener('blur', () => {\r\n      this.playAnimation(0);\r\n    });\r\n\r\n    input.addEventListener('input', (e) => {\r\n      this.playAnimation(inputField.value.length);\r\n    });\r\n\r\n    /* codeInput.addEventListener('focus', () => {\r\n      playAnimation(Math.max(codeInput.value.length, 1));\r\n    }); */\r\n  }\r\n\r\n  // 1st symbol = frame 15\r\n  // end symbol = frame 165\r\n  public playAnimation(length: number) {\r\n    if(!this.animation) return;\r\n\r\n    length = Math.min(length, 30);\r\n    let frame: number;\r\n    if(length) {\r\n      frame = Math.round(Math.min(this.max, length) * (165 / this.max) + 11.33);\r\n\r\n      if(this.idleAnimation) {\r\n        this.idleAnimation.stop(true);\r\n        this.idleAnimation.canvas[0].style.display = 'none';\r\n      }\r\n\r\n      this.animation.canvas[0].style.display = '';\r\n    } else {\r\n      /* const cb = (frameNo: number) => {\r\n        if(frameNo <= 1) { */\r\n      /* idleAnimation.play();\r\n          idleAnimation.canvas.style.display = '';\r\n          animation.canvas.style.display = 'none'; */\r\n      /*     animation.removeListener('enterFrame', cb);\r\n        }\r\n      };\r\n      animation.addListener('enterFrame', cb); */\r\n\r\n      frame = 0;\r\n    }\r\n    // animation.playSegments([1, 2]);\r\n\r\n    const direction = this.needFrame > frame ? -1 : 1;\r\n    // console.log('keydown', length, frame, direction);\r\n\r\n    this.animation.setDirection(direction);\r\n    if(this.needFrame !== 0 && frame === 0) {\r\n      this.animation.setSpeed(7);\r\n    }\r\n    /* let diff = Math.abs(needFrame - frame * direction);\r\n    if((diff / 20) > 1) animation.setSpeed(diff / 20 | 0); */\r\n    this.needFrame = frame;\r\n\r\n    this.animation.play();\r\n\r\n    /* animation.goToAndStop(15, true); */\r\n    // animation.goToAndStop(length / max * );\r\n  }\r\n\r\n  public load() {\r\n    if(this.loadPromise) return this.loadPromise;\r\n    return this.loadPromise = Promise.all([\r\n      lottieLoader.loadAnimationAsAsset({\r\n        container: this.container,\r\n        loop: true,\r\n        autoplay: true,\r\n        width: this.size,\r\n        height: this.size\r\n      }, 'TwoFactorSetupMonkeyIdle').then((animation) => {\r\n        this.idleAnimation = animation;\r\n\r\n        // ! animationIntersector will stop animation instantly\r\n        if(!this.inputField.value.length) {\r\n          animation.play();\r\n        }\r\n\r\n        return lottieLoader.waitForFirstFrame(animation);\r\n      }),\r\n\r\n      lottieLoader.loadAnimationAsAsset({\r\n        container: this.container,\r\n        loop: false,\r\n        autoplay: false,\r\n        width: this.size,\r\n        height: this.size\r\n      }, 'TwoFactorSetupMonkeyTracking').then((_animation) => {\r\n        this.animation = _animation;\r\n\r\n        if(!this.inputField.value.length) {\r\n          this.animation.canvas[0].style.display = 'none';\r\n        }\r\n\r\n        this.animation.addEventListener('enterFrame', currentFrame => {\r\n          // console.log('enterFrame', currentFrame, needFrame);\r\n          // let currentFrame = Math.round(e.currentTime);\r\n\r\n          if((this.animation.direction === 1 && currentFrame >= this.needFrame) ||\r\n            (this.animation.direction === -1 && currentFrame <= this.needFrame)) {\r\n            this.animation.setSpeed(1);\r\n            this.animation.pause();\r\n          }\r\n\r\n          if(currentFrame === 0 && this.needFrame === 0) {\r\n            // animation.curFrame = 0;\r\n\r\n            if(this.idleAnimation) {\r\n              this.idleAnimation.canvas[0].style.display = '';\r\n              this.idleAnimation.play();\r\n              this.animation.canvas[0].style.display = 'none';\r\n            }\r\n          }\r\n        });\r\n        // console.log(animation.getDuration(), animation.getDuration(true));\r\n\r\n        return lottieLoader.waitForFirstFrame(_animation);\r\n      })\r\n    ]);\r\n  }\r\n\r\n  public remove() {\r\n    if(this.animation) this.animation.remove();\r\n    if(this.idleAnimation) this.idleAnimation.remove();\r\n  }\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\n// import { IS_MOBILE_SAFARI, IS_SAFARI } from \"../environment/userAgent\";\r\nimport cancelEvent from '../helpers/dom/cancelEvent';\r\nimport InputField, {InputFieldOptions} from './inputField';\r\n\r\nexport default class PasswordInputField extends InputField {\r\n  public passwordVisible = false;\r\n  public toggleVisible: HTMLElement;\r\n  public onVisibilityClickAdditional: () => void;\r\n\r\n  constructor(options: InputFieldOptions = {}) {\r\n    super({\r\n      plainText: true,\r\n      ...options\r\n    });\r\n\r\n    const input = this.input as HTMLInputElement;\r\n    input.type = 'password';\r\n    input.setAttribute('required', '');\r\n    input.name = 'notsearch_password';\r\n    input.autocomplete = 'off';\r\n\r\n    /* if(IS_SAFARI && !IS_MOBILE_SAFARI) {\r\n      input.setAttribute('readonly', '');\r\n      input.addEventListener('focus', () => {\r\n        input.removeAttribute('readonly');\r\n      }, {once: true});\r\n    } */\r\n\r\n    // * https://stackoverflow.com/a/35949954/6758968\r\n    const stealthy = document.createElement('input');\r\n    stealthy.classList.add('stealthy');\r\n    stealthy.tabIndex = -1;\r\n    stealthy.type = 'password';\r\n    input.parentElement.prepend(stealthy);\r\n    input.parentElement.insertBefore(stealthy.cloneNode(), input.nextSibling);\r\n\r\n    const toggleVisible = this.toggleVisible = document.createElement('span');\r\n    toggleVisible.classList.add('toggle-visible', 'tgico');\r\n\r\n    this.container.classList.add('input-field-password');\r\n    this.container.append(toggleVisible);\r\n\r\n    toggleVisible.addEventListener('click', this.onVisibilityClick);\r\n    toggleVisible.addEventListener('touchend', this.onVisibilityClick);\r\n  }\r\n\r\n  public onVisibilityClick = (e: Event) => {\r\n    cancelEvent(e);\r\n    this.passwordVisible = !this.passwordVisible;\r\n\r\n    this.toggleVisible.classList.toggle('eye-hidden', this.passwordVisible);\r\n    (this.input as HTMLInputElement).type = this.passwordVisible ? 'text' : 'password';\r\n    this.onVisibilityClickAdditional && this.onVisibilityClickAdditional();\r\n  };\r\n}\r\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport IS_PARALLAX_SUPPORTED from '../environment/parallaxSupport';\nimport IS_TOUCH_SUPPORTED from '../environment/touchSupport';\nimport findAndSplice from '../helpers/array/findAndSplice';\nimport cancelEvent from '../helpers/dom/cancelEvent';\nimport {attachClickEvent} from '../helpers/dom/clickEvent';\nimport filterChatPhotosMessages from '../helpers/filterChatPhotosMessages';\nimport ListenerSetter from '../helpers/listenerSetter';\nimport ListLoader from '../helpers/listLoader';\nimport {fastRaf} from '../helpers/schedulers';\nimport {Message, ChatFull, MessageAction, Photo} from '../layer';\nimport type {AppMessagesManager} from '../lib/appManagers/appMessagesManager';\nimport {AppManagers} from '../lib/appManagers/managers';\nimport choosePhotoSize from '../lib/appManagers/utils/photos/choosePhotoSize';\nimport {openAvatarViewer} from './avatar';\nimport {putAvatar} from './putPhoto';\nimport Scrollable from './scrollable';\nimport SwipeHandler from './swipeHandler';\nimport {wrapPhoto} from './wrappers';\n\nconst LOAD_NEAREST = 3;\n\nexport default class PeerProfileAvatars {\n  private static BASE_CLASS = 'profile-avatars';\n  private static SCALE = IS_PARALLAX_SUPPORTED ? 2 : 1;\n  private static TRANSLATE_TEMPLATE = IS_PARALLAX_SUPPORTED ? `translate3d({x}, 0, -1px) scale(${PeerProfileAvatars.SCALE})` : 'translate({x}, 0)';\n  public container: HTMLElement;\n  public avatars: HTMLElement;\n  public gradient: HTMLElement;\n  public info: HTMLElement;\n  public arrowPrevious: HTMLElement;\n  public arrowNext: HTMLElement;\n  private tabs: HTMLDivElement;\n  private listLoader: ListLoader<Photo.photo['id'] | Message.messageService, Photo.photo['id'] | Message.messageService>;\n  private peerId: PeerId;\n  private intersectionObserver: IntersectionObserver;\n  private loadCallbacks: Map<Element, () => void>;\n  private listenerSetter: ListenerSetter;\n  private swipeHandler: SwipeHandler;\n\n  constructor(\n    public scrollable: Scrollable,\n    private managers: AppManagers\n  ) {\n    this.container = document.createElement('div');\n    this.container.classList.add(PeerProfileAvatars.BASE_CLASS + '-container');\n\n    this.avatars = document.createElement('div');\n    this.avatars.classList.add(PeerProfileAvatars.BASE_CLASS + '-avatars');\n\n    this.gradient = document.createElement('div');\n    this.gradient.classList.add(PeerProfileAvatars.BASE_CLASS + '-gradient');\n\n    this.info = document.createElement('div');\n    this.info.classList.add(PeerProfileAvatars.BASE_CLASS + '-info');\n\n    this.tabs = document.createElement('div');\n    this.tabs.classList.add(PeerProfileAvatars.BASE_CLASS + '-tabs');\n\n    this.arrowPrevious = document.createElement('div');\n    this.arrowPrevious.classList.add(PeerProfileAvatars.BASE_CLASS + '-arrow', 'tgico-avatarprevious');\n\n    /* const previousIcon = document.createElement('i');\n    previousIcon.classList.add(PeerProfileAvatars.BASE_CLASS + '-arrow-icon', 'tgico-previous');\n    this.arrowBack.append(previousIcon); */\n\n    this.arrowNext = document.createElement('div');\n    this.arrowNext.classList.add(PeerProfileAvatars.BASE_CLASS + '-arrow', PeerProfileAvatars.BASE_CLASS + '-arrow-next', 'tgico-avatarnext');\n\n    /* const nextIcon = document.createElement('i');\n    nextIcon.classList.add(PeerProfileAvatars.BASE_CLASS + '-arrow-icon', 'tgico-next');\n    this.arrowNext.append(nextIcon); */\n\n    this.container.append(this.avatars, this.gradient, this.info, this.tabs, this.arrowPrevious, this.arrowNext);\n\n    this.loadCallbacks = new Map();\n    this.listenerSetter = new ListenerSetter();\n\n    const checkScrollTop = () => {\n      if(this.scrollable.scrollTop !== 0) {\n        this.scrollable.scrollIntoViewNew({\n          element: this.scrollable.container.firstElementChild as HTMLElement,\n          position: 'start'\n        });\n        return false;\n      }\n\n      return true;\n    };\n\n    const SWITCH_ZONE = 1 / 3;\n    let cancel = false;\n    let freeze = false;\n    attachClickEvent(this.container, async(_e) => {\n      if(freeze) {\n        cancelEvent(_e);\n        return;\n      }\n\n      if(cancel) {\n        cancel = false;\n        return;\n      }\n\n      if(!checkScrollTop()) {\n        return;\n      }\n\n      const rect = this.container.getBoundingClientRect();\n\n      // const e = (_e as TouchEvent).touches ? (_e as TouchEvent).touches[0] : _e as MouseEvent;\n      const e = _e;\n      const x = e.pageX;\n\n      const clickX = x - rect.left;\n      if((!this.listLoader.previous.length && !this.listLoader.next.length) ||\n        (clickX > (rect.width * SWITCH_ZONE) && clickX < (rect.width - rect.width * SWITCH_ZONE))) {\n        const peerId = this.peerId;\n\n        const targets: {element: HTMLElement, item: Photo.photo['id'] | Message.messageService}[] = [];\n        this.listLoader.previous.concat(this.listLoader.current, this.listLoader.next).forEach((item, idx) => {\n          targets.push({\n            element: /* null */this.avatars.children[idx] as HTMLElement,\n            item\n          });\n        });\n\n        const prevTargets = targets.slice(0, this.listLoader.previous.length);\n        const nextTargets = targets.slice(this.listLoader.previous.length + 1);\n\n        const target = this.avatars.children[this.listLoader.previous.length] as HTMLElement;\n        freeze = true;\n        openAvatarViewer(target, peerId, () => peerId === this.peerId, this.listLoader.current, prevTargets, nextTargets);\n        freeze = false;\n      } else {\n        const centerX = rect.right - (rect.width / 2);\n        const toRight = x > centerX;\n\n        // this.avatars.classList.remove('no-transition');\n        // fastRaf(() => {\n        this.avatars.classList.add('no-transition');\n        void this.avatars.offsetLeft; // reflow\n\n        let distance: number;\n        if(this.listLoader.index === 0 && !toRight) distance = this.listLoader.count - 1;\n        else if(this.listLoader.index === (this.listLoader.count - 1) && toRight) distance = -(this.listLoader.count - 1);\n        else distance = toRight ? 1 : -1;\n        this.listLoader.go(distance);\n\n        fastRaf(() => {\n          this.avatars.classList.remove('no-transition');\n        });\n        // });\n      }\n    }, {listenerSetter: this.listenerSetter});\n\n    const cancelNextClick = () => {\n      cancel = true;\n      document.body.addEventListener(IS_TOUCH_SUPPORTED ? 'touchend' : 'click', (e) => {\n        cancel = false;\n      }, {once: true});\n    };\n\n    let width = 0, x = 0, lastDiffX = 0, /* lastIndex = 0, */ minX = 0;\n    const swipeHandler = this.swipeHandler = new SwipeHandler({\n      element: this.avatars,\n      onSwipe: (xDiff, yDiff) => {\n        lastDiffX = xDiff;\n        let lastX = x + xDiff * -PeerProfileAvatars.SCALE;\n        if(lastX > 0) lastX = 0;\n        else if(lastX < minX) lastX = minX;\n\n        this.avatars.style.transform = PeerProfileAvatars.TRANSLATE_TEMPLATE.replace('{x}', lastX + 'px');\n        // console.log(xDiff, yDiff);\n        return false;\n      },\n      verifyTouchTarget: (e) => {\n        if(!checkScrollTop()) {\n          cancelNextClick();\n          cancelEvent(e);\n          return false;\n        } else if(this.container.classList.contains('is-single') || freeze) {\n          return false;\n        }\n\n        return true;\n      },\n      onFirstSwipe: () => {\n        const rect = this.avatars.getBoundingClientRect();\n        width = rect.width;\n        minX = -width * (this.tabs.childElementCount - 1);\n\n        /* lastIndex = whichChild(this.tabs.querySelector('.active'));\n        x = -width * lastIndex; */\n        x = rect.left - this.container.getBoundingClientRect().left;\n\n        this.avatars.style.transform = PeerProfileAvatars.TRANSLATE_TEMPLATE.replace('{x}', x + 'px');\n\n        this.container.classList.add('is-swiping');\n        this.avatars.classList.add('no-transition');\n        void this.avatars.offsetLeft; // reflow\n      },\n      onReset: () => {\n        const addIndex = Math.ceil(Math.abs(lastDiffX) / (width / PeerProfileAvatars.SCALE)) * (lastDiffX >= 0 ? 1 : -1);\n        cancelNextClick();\n\n        // console.log(addIndex);\n\n        this.avatars.classList.remove('no-transition');\n        fastRaf(() => {\n          this.listLoader.go(addIndex);\n          this.container.classList.remove('is-swiping');\n        });\n      }\n    });\n\n    this.intersectionObserver = new IntersectionObserver((entries) => {\n      entries.forEach((entry) => {\n        if(!entry.isIntersecting) {\n          return;\n        }\n\n        this.loadNearestToTarget(entry.target);\n      });\n    });\n\n    /* this.listenerSetter.add(rootScope)('avatar_update', (peerId) => {\n      if(this.peerId === peerId) {\n        const photo = appPeersManager.getPeerPhoto(peerId);\n        if(photo) {\n          const id = photo.photo_id;\n          const previous = this.listLoader.previous;\n          for(let i = 0; i < previous.length; ++i) {\n            if(previous[i] === id)\n          }\n          this.listLoader.previous.forEach((_id, idx, arr) => {});\n        }\n      }\n    }); */\n  }\n\n  public async setPeer(peerId: PeerId) {\n    this.peerId = peerId;\n\n    const photo = await this.managers.appPeersManager.getPeerPhoto(peerId);\n    if(!photo) {\n      return;\n    }\n\n    const listLoader: PeerProfileAvatars['listLoader'] = this.listLoader = new ListLoader({\n      loadCount: 50,\n      loadMore: (anchor, older, loadCount) => {\n        if(!older) return Promise.resolve({count: undefined, items: []});\n\n        if(peerId.isUser()) {\n          const maxId: Photo.photo['id'] = anchor as any;\n          return this.managers.appPhotosManager.getUserPhotos(peerId, maxId, loadCount).then((value) => {\n            return {\n              count: value.count,\n              items: value.photos\n            };\n          });\n        } else {\n          const promises: [Promise<ChatFull> | ChatFull, ReturnType<AppMessagesManager['getSearch']>] = [] as any;\n          if(!listLoader.current) {\n            promises.push(this.managers.appProfileManager.getChatFull(peerId.toChatId()));\n          }\n\n          promises.push(this.managers.appMessagesManager.getSearch({\n            peerId,\n            maxId: Number.MAX_SAFE_INTEGER,\n            inputFilter: {\n              _: 'inputMessagesFilterChatPhotos'\n            },\n            limit: loadCount,\n            backLimit: 0\n          }));\n\n          return Promise.all(promises).then(async(result) => {\n            const value = result.pop() as typeof result[1];\n\n            filterChatPhotosMessages(value);\n\n            if(!listLoader.current) {\n              const chatFull = result[0];\n              const message = findAndSplice(value.history, (message) => {\n                return ((message as Message.messageService).action as MessageAction.messageActionChannelEditPhoto).photo.id === chatFull.chat_photo.id;\n              }) as Message.messageService;\n\n              listLoader.current = message || await this.managers.appMessagesManager.generateFakeAvatarMessage(this.peerId, chatFull.chat_photo);\n            }\n\n            // console.log('avatars loaded:', value);\n            return {\n              count: value.count,\n              items: value.history\n            };\n          });\n        }\n      },\n      processItem: this.processItem,\n      onJump: (item, older) => {\n        const id = this.listLoader.index;\n        // const nextId = Math.max(0, id);\n        const x = 100 * PeerProfileAvatars.SCALE * id;\n        this.avatars.style.transform = PeerProfileAvatars.TRANSLATE_TEMPLATE.replace('{x}', `-${x}%`);\n\n        const activeTab = this.tabs.querySelector('.active');\n        if(activeTab) activeTab.classList.remove('active');\n\n        const tab = this.tabs.children[id] as HTMLElement;\n        tab.classList.add('active');\n\n        this.loadNearestToTarget(this.avatars.children[id]);\n      }\n    });\n\n    if(photo._ === 'userProfilePhoto') {\n      listLoader.current = photo.photo_id;\n    }\n\n    await this.processItem(listLoader.current);\n\n    // listLoader.loaded\n    listLoader.load(true);\n  }\n\n  public addTab() {\n    const tab = document.createElement('div');\n    tab.classList.add(PeerProfileAvatars.BASE_CLASS + '-tab');\n    this.tabs.append(tab);\n\n    if(this.tabs.childElementCount === 1) {\n      tab.classList.add('active');\n    }\n\n    this.container.classList.toggle('is-single', this.tabs.childElementCount <= 1);\n  }\n\n  public processItem = async(photoId: Photo.photo['id'] | Message.messageService) => {\n    const avatar = document.createElement('div');\n    avatar.classList.add(PeerProfileAvatars.BASE_CLASS + '-avatar', 'media-container', 'hide');\n\n    this.avatars.append(avatar);\n\n    let photo: Photo.photo;\n    if(photoId) {\n      photo = typeof(photoId) !== 'object' ?\n        await this.managers.appPhotosManager.getPhoto(photoId) :\n        (photoId.action as MessageAction.messageActionChannelEditPhoto).photo as Photo.photo;\n    }\n\n    const img = new Image();\n    img.classList.add('avatar-photo');\n    img.draggable = false;\n\n    const loadCallback = async() => {\n      if(photo) {\n        const res = await wrapPhoto({\n          container: avatar,\n          photo,\n          size: choosePhotoSize(photo, 420, 420, false),\n          withoutPreloader: true\n        });\n\n        [res.images.thumb, res.images.full].filter(Boolean).forEach((img) => {\n          img.classList.add('avatar-photo');\n        });\n      } else {\n        const photo = await this.managers.appPeersManager.getPeerPhoto(this.peerId);\n        await putAvatar(avatar, this.peerId, photo, 'photo_big', img);\n      }\n\n      avatar.classList.remove('hide');\n    };\n\n    if(this.avatars.childElementCount <= LOAD_NEAREST) {\n      await loadCallback();\n    } else {\n      this.intersectionObserver.observe(avatar);\n      this.loadCallbacks.set(avatar, loadCallback);\n    }\n\n    this.addTab();\n\n    return photoId;\n  };\n\n  private loadNearestToTarget(target: Element) {\n    const children = Array.from(target.parentElement.children);\n    const idx = children.indexOf(target);\n    const slice = children.slice(Math.max(0, idx - LOAD_NEAREST), Math.min(children.length, idx + LOAD_NEAREST));\n\n    slice.forEach((target) => {\n      const callback = this.loadCallbacks.get(target);\n      if(callback) {\n        callback();\n        this.loadCallbacks.delete(target);\n        this.intersectionObserver.unobserve(target);\n      }\n    });\n  }\n\n  public cleanup() {\n    this.listenerSetter.removeAll();\n    this.swipeHandler.removeListeners();\n    this.intersectionObserver?.disconnect();\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport IS_PARALLAX_SUPPORTED from '../environment/parallaxSupport';\nimport {copyTextToClipboard} from '../helpers/clipboard';\nimport replaceContent from '../helpers/dom/replaceContent';\nimport setInnerHTML from '../helpers/dom/setInnerHTML';\nimport ListenerSetter from '../helpers/listenerSetter';\nimport {fastRaf} from '../helpers/schedulers';\nimport {Chat, ChatFull, User, UserFull} from '../layer';\nimport type {Channel} from '../lib/appManagers/appChatsManager';\nimport appImManager from '../lib/appManagers/appImManager';\nimport {AppManagers} from '../lib/appManagers/managers';\nimport I18n from '../lib/langPack';\nimport wrapRichText from '../lib/richTextProcessor/wrapRichText';\nimport rootScope from '../lib/rootScope';\nimport AvatarElement from './avatar';\nimport CheckboxField from './checkboxField';\nimport PeerProfileAvatars from './peerProfileAvatars';\nimport Row from './row';\nimport Scrollable from './scrollable';\nimport {SettingSection, generateDelimiter} from './sidebarLeft';\nimport {toast} from './toast';\nimport formatUserPhone from './wrappers/formatUserPhone';\nimport wrapPeerTitle from './wrappers/peerTitle';\n\nconst setText = (text: Parameters<typeof setInnerHTML>[1], row: Row) => {\n  // fastRaf(() => {\n  setInnerHTML(row.title, text || '');\n  row.container.style.display = text ? '' : 'none';\n  // });\n};\n\nexport default class PeerProfile {\n  public element: HTMLElement;\n  private avatars: PeerProfileAvatars;\n  private avatar: AvatarElement;\n  private section: SettingSection;\n  private name: HTMLDivElement;\n  private subtitle: HTMLDivElement;\n  private bio: Row;\n  private username: Row;\n  private phone: Row;\n  private notifications: Row;\n  private location: Row;\n  private link: Row;\n\n  private cleaned: boolean;\n  private setMoreDetailsTimeout: number;\n  private setPeerStatusInterval: number;\n\n  private peerId: PeerId;\n  private threadId: number;\n\n  constructor(\n    private managers: AppManagers,\n    public scrollable: Scrollable,\n    private listenerSetter?: ListenerSetter,\n    private isDialog = true\n  ) {\n    if(!IS_PARALLAX_SUPPORTED) {\n      this.scrollable.container.classList.add('no-parallax');\n    }\n\n    if(!listenerSetter) {\n      this.listenerSetter = new ListenerSetter();\n    }\n  }\n\n  public init() {\n    this.init = null;\n\n\n    this.element = document.createElement('div');\n    this.element.classList.add('profile-content');\n\n    this.section = new SettingSection({\n      noDelimiter: true\n    });\n\n    this.avatar = new AvatarElement();\n    this.avatar.classList.add('profile-avatar', 'avatar-120');\n    this.avatar.isDialog = this.isDialog;\n    this.avatar.attachClickEvent();\n\n    this.name = document.createElement('div');\n    this.name.classList.add('profile-name');\n\n    this.subtitle = document.createElement('div');\n    this.subtitle.classList.add('profile-subtitle');\n\n    this.bio = new Row({\n      title: ' ',\n      subtitleLangKey: 'UserBio',\n      icon: 'info',\n      clickable: async(e) => {\n        if((e.target as HTMLElement).tagName === 'A') {\n          return;\n        }\n\n        const full = await this.managers.appProfileManager.getProfileByPeerId(this.peerId);\n        copyTextToClipboard(full.about);\n        toast(I18n.format('BioCopied', true));\n      },\n      listenerSetter: this.listenerSetter\n    });\n\n    this.bio.title.classList.add('pre-wrap');\n\n    this.username = new Row({\n      title: ' ',\n      subtitleLangKey: 'Username',\n      icon: 'username',\n      clickable: async() => {\n        const peer: Channel | User.user = await this.managers.appPeersManager.getPeer(this.peerId);\n        copyTextToClipboard('@' + peer.username);\n        toast(I18n.format('UsernameCopied', true));\n      },\n      listenerSetter: this.listenerSetter\n    });\n\n    this.phone = new Row({\n      title: ' ',\n      subtitleLangKey: 'Phone',\n      icon: 'phone',\n      clickable: async() => {\n        const peer: User = await this.managers.appUsersManager.getUser(this.peerId);\n        copyTextToClipboard('+' + peer.phone);\n        toast(I18n.format('PhoneCopied', true));\n      },\n      listenerSetter: this.listenerSetter\n    });\n\n    this.link = new Row({\n      title: ' ',\n      subtitleLangKey: 'SetUrlPlaceholder',\n      icon: 'link',\n      clickable: () => {\n        copyTextToClipboard(this.link.title.textContent);\n        // Promise.resolve(appProfileManager.getChatFull(this.peerId.toChatId())).then((chatFull) => {\n        // copyTextToClipboard(chatFull.exported_invite.link);\n        toast(I18n.format('LinkCopied', true));\n        // });\n      },\n      listenerSetter: this.listenerSetter\n    });\n\n    this.location = new Row({\n      title: ' ',\n      subtitleLangKey: 'ChatLocation',\n      icon: 'location'\n    });\n\n    this.section.content.append(\n      this.phone.container,\n      this.username.container,\n      this.location.container,\n      this.bio.container,\n      this.link.container\n    );\n\n    const {listenerSetter} = this;\n    if(this.isDialog) {\n      this.notifications = new Row({\n        checkboxField: new CheckboxField({toggle: true}),\n        titleLangKey: 'Notifications',\n        icon: 'unmute',\n        listenerSetter: this.listenerSetter\n      });\n\n      listenerSetter.add(this.notifications.checkboxField.input)('change', (e) => {\n        if(!e.isTrusted) {\n          return;\n        }\n\n        // let checked = this.notificationsCheckbox.checked;\n        this.managers.appMessagesManager.togglePeerMute(this.peerId);\n      });\n\n      listenerSetter.add(rootScope)('dialog_notify_settings', async(dialog) => {\n        if(this.peerId === dialog.peerId) {\n          const muted = await this.managers.appNotificationsManager.isPeerLocalMuted(this.peerId, false);\n          this.notifications.checkboxField.checked = !muted;\n        }\n      });\n\n      this.section.content.append(this.notifications.container);\n    }\n\n    this.element.append(this.section.container);\n\n    if(IS_PARALLAX_SUPPORTED) {\n      this.element.append(generateDelimiter());\n    }\n\n    listenerSetter.add(rootScope)('peer_typings', ({peerId}) => {\n      if(this.peerId === peerId) {\n        this.setPeerStatus();\n      }\n    });\n\n    listenerSetter.add(rootScope)('peer_bio_edit', (peerId) => {\n      if(peerId === this.peerId) {\n        this.setMoreDetails(true);\n      }\n    });\n\n    listenerSetter.add(rootScope)('peer_title_edit', (peerId) => {\n      if(peerId === this.peerId) {\n        this.fillUsername();\n      }\n    });\n\n    listenerSetter.add(rootScope)('user_update', (userId) => {\n      if(this.peerId === userId.toPeerId()) {\n        this.setPeerStatus();\n      }\n    });\n\n    listenerSetter.add(rootScope)('contacts_update', async(userId) => {\n      if(this.peerId === userId.toPeerId()) {\n        const user = await this.managers.appUsersManager.getUser(userId);\n        if(!user.pFlags.self || !this.isDialog) {\n          this.fillUserPhone();\n        }\n      }\n    });\n\n    listenerSetter.add(rootScope)('avatar_update', (peerId) => {\n      if(this.peerId === peerId) {\n        // const photo = appPeersManager.getPeerPhoto(peerId);\n        // if(!photo && this.avatars) {\n        this.setAvatar();\n        // }\n      }\n    });\n\n    this.setPeerStatusInterval = window.setInterval(this.setPeerStatus, 60e3);\n  }\n\n  private setPeerStatus = (needClear = false) => {\n    const peerId = this.peerId;\n    this.element.classList.toggle('is-me', peerId === rootScope.myId);\n    if(!peerId || (rootScope.myId === peerId && this.isDialog)) return;\n\n    return appImManager.setPeerStatus(\n      peerId,\n      this.subtitle,\n      needClear,\n      true,\n      () => peerId === this.peerId,\n      !this.isDialog\n    ).then((callback) => {\n      if(callback) {\n        callback();\n      }\n    });\n  };\n\n  public cleanupHTML() {\n    [\n      this.bio,\n      this.phone,\n      this.username,\n      this.location,\n      this.link\n    ].forEach((row) => {\n      row.container.style.display = 'none';\n    });\n\n    if(this.notifications) {\n      this.notifications.container.style.display = '';\n      this.notifications.checkboxField.checked = true;\n    }\n\n    this.clearSetMoreDetailsTimeout();\n  }\n\n  private canBeDetailed() {\n    return this.peerId !== rootScope.myId || !this.isDialog;\n  }\n\n  private async setAvatar() {\n    if(this.canBeDetailed()) {\n      const photo = await this.managers.appPeersManager.getPeerPhoto(this.peerId);\n\n      if(photo) {\n        const oldAvatars = this.avatars;\n        this.avatars = new PeerProfileAvatars(this.scrollable, this.managers);\n        await this.avatars.setPeer(this.peerId);\n        this.avatars.info.append(this.name, this.subtitle);\n\n        this.avatar.remove();\n\n        if(oldAvatars) oldAvatars.container.replaceWith(this.avatars.container);\n        else this.element.prepend(this.avatars.container);\n\n        if(IS_PARALLAX_SUPPORTED) {\n          this.scrollable.container.classList.add('parallax');\n        }\n\n        return;\n      }\n    }\n\n    if(IS_PARALLAX_SUPPORTED) {\n      this.scrollable.container.classList.remove('parallax');\n    }\n\n    if(this.avatars) {\n      this.avatars.container.remove();\n      this.avatars.cleanup();\n      this.avatars = undefined;\n    }\n\n    await this.avatar.updateWithOptions({peerId: this.peerId});\n\n    this.section.content.prepend(this.avatar, this.name, this.subtitle);\n  }\n\n  private async fillUsername() {\n    const {peerId} = this;\n    if(peerId.isUser() && this.canBeDetailed()) {\n      const username = await this.managers.appPeersManager.getPeerUsername(peerId);\n      return setText(username, this.username);\n    }\n  }\n\n  private async fillUserPhone() {\n    const {peerId} = this;\n    if(peerId.isUser() && this.canBeDetailed()) {\n      const user = await this.managers.appUsersManager.getUser(peerId);\n      return setText(user.phone ? formatUserPhone(user.phone) : undefined, this.phone);\n    }\n  }\n\n  private async fillNotifications() {\n    const notificationsRow = this.notifications;\n    if(!notificationsRow) {\n      return;\n    }\n\n    if(this.canBeDetailed()) {\n      const muted = await this.managers.appNotificationsManager.isPeerLocalMuted(this.peerId, false);\n      notificationsRow.checkboxField.checked = !muted;\n    } else {\n      fastRaf(() => {\n        notificationsRow.container.style.display = 'none';\n      });\n    }\n  }\n\n  private async fillRows() {\n    const peerId = this.peerId;\n\n    await Promise.all([\n      this.fillUsername(),\n      this.fillUserPhone(),\n      this.fillNotifications(),\n      this.setMoreDetails(),\n      (async() => {\n        const [element/* , icons */] = await Promise.all([\n          wrapPeerTitle({\n            peerId,\n            dialog: this.isDialog,\n            withIcons: true\n          })\n\n          // generateTitleIcons(peerId)\n        ]);\n        replaceContent(this.name, element);\n        // this.name.append(...icons);\n      })(),\n      this.setPeerStatus(true)\n    ]);\n  }\n\n  public async fillProfileElements() {\n    if(!this.cleaned) return;\n    this.cleaned = false;\n\n    this.cleanupHTML();\n    await Promise.all([\n      this.setAvatar(),\n      this.fillRows()\n    ]);\n  }\n\n  private async _setMoreDetails(peerId: PeerId, peerFull: ChatFull | UserFull) {\n    // if(peerFull.about) {\n    setText(peerFull.about ? wrapRichText(peerFull.about) : undefined, this.bio);\n    // }\n\n    if(!peerId.isUser()) {\n      const chat: Chat.channel = await this.managers.appChatsManager.getChat(peerId.toChatId());\n      if(chat.username) {\n        setText('https://t.me/' + chat.username, this.link);\n      } else {\n        const exportedInvite = (peerFull as ChatFull.channelFull).exported_invite;\n        if(exportedInvite?._ === 'chatInviteExported') {\n          setText(exportedInvite.link, this.link);\n        }\n      }\n    }\n\n    const location = (peerFull as ChatFull.channelFull).location;\n    if(location?._ == 'channelLocation') {\n      setText(location.address, this.location);\n    }\n\n    this.setMoreDetailsTimeout = window.setTimeout(() => this.setMoreDetails(true), 60e3);\n  }\n\n  private async setMoreDetails(override?: true) {\n    this.clearSetMoreDetailsTimeout();\n\n    const peerId = this.peerId;\n    const threadId = this.threadId;\n\n    if(!peerId || await this.managers.appPeersManager.isRestricted(peerId) || !this.canBeDetailed()) {\n      return;\n    }\n\n    const result = await this.managers.acknowledged.appProfileManager.getProfileByPeerId(peerId, override);\n    const setPromise = result.result.then(async(peerFull) => {\n      if(this.peerId !== peerId || this.threadId !== threadId || await this.managers.appPeersManager.isRestricted(peerId)) {\n        // this.log.warn('peer changed');\n        return;\n      }\n\n      await this._setMoreDetails(peerId, peerFull);\n    });\n\n    if(result.cached) {\n      await setPromise;\n    }\n  }\n\n  public setPeer(peerId: PeerId, threadId = 0) {\n    if(this.peerId === peerId && this.threadId === threadId) return;\n\n    if(this.init) {\n      this.init();\n    }\n\n    this.peerId = peerId;\n    this.threadId = threadId;\n\n    this.cleaned = true;\n  }\n\n  public clearSetMoreDetailsTimeout() {\n    if(this.setMoreDetailsTimeout !== undefined) {\n      clearTimeout(this.setMoreDetailsTimeout);\n      this.setMoreDetailsTimeout = undefined;\n    }\n  }\n\n  public destroy() {\n    this.clearSetMoreDetailsTimeout();\n    clearInterval(this.setPeerStatusInterval);\n    this.avatars?.cleanup();\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport {Chat, User} from '../layer';\nimport rootScope from '../lib/rootScope';\nimport generateFakeIcon from './generateFakeIcon';\nimport generatePremiumIcon from './generatePremiumIcon';\nimport generateVerifiedIcon from './generateVerifiedIcon';\n\nexport default async function generateTitleIcons(peerId: PeerId) {\n  const elements: Element[] = [];\n  const peer: Chat | User = await rootScope.managers.appPeersManager.getPeer(peerId);\n  if((peer as Chat.channel).pFlags.verified) {\n    elements.push(generateVerifiedIcon());\n  }\n\n  if((peer as Chat.channel).pFlags.fake || (peer as User.user).pFlags.scam) {\n    elements.push(generateFakeIcon((peer as User.user).pFlags.scam));\n  }\n\n  if((peer as User.user).pFlags.premium) {\n    elements.push(generatePremiumIcon());\n  }\n\n  return elements;\n}\n","export default function generateVerifiedIcon() {\n  const span = document.createElement('span');\n  span.classList.add('verified-icon', 'tgico');\n\n  const size = 26; // 24\n  const svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');\n  svg.setAttributeNS(null, 'viewBox', `0 0 ${size} ${size}`);\n  svg.setAttributeNS(null, 'width', `${size}`);\n  svg.setAttributeNS(null, 'height', `${size}`);\n  svg.classList.add('verified-icon-svg');\n\n  const use = document.createElementNS('http://www.w3.org/2000/svg', 'use');\n  use.setAttributeNS(null, 'href', '#verified-icon-background');\n  use.classList.add('verified-icon-background');\n\n  const use2 = document.createElementNS('http://www.w3.org/2000/svg', 'use');\n  use2.setAttributeNS(null, 'href', '#verified-icon-check');\n  use2.classList.add('verified-icon-check');\n\n  // svg.append(use, use2);\n  svg.append(use2, use);\n\n  span.append(svg);\n\n  return span;\n  // const span = document.createElement('span');\n  // span.classList.add('verified-icon', 'tgico-verified_filled');\n  // return span;\n}\n","export default function generatePremiumIcon() {\n  const span = document.createElement('span');\n  span.classList.add('premium-icon', 'tgico-star');\n  return span;\n}\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport rootScope from '../lib/rootScope';\r\nimport {i18n} from '../lib/langPack';\r\nimport replaceContent from '../helpers/dom/replaceContent';\r\nimport {NULL_PEER_ID} from '../lib/mtproto/mtproto_config';\r\nimport limitSymbols from '../helpers/string/limitSymbols';\r\nimport setInnerHTML from '../helpers/dom/setInnerHTML';\r\nimport {AppManagers} from '../lib/appManagers/managers';\r\nimport wrapEmojiText from '../lib/richTextProcessor/wrapEmojiText';\r\nimport getPeerTitle from './wrappers/getPeerTitle';\r\nimport generateTitleIcons from './generateTitleIcons';\r\n\r\nexport type PeerTitleOptions = {\r\n  peerId?: PeerId,\r\n  fromName?: string,\r\n  plainText?: boolean,\r\n  onlyFirstName?: boolean,\r\n  dialog?: boolean,\r\n  limitSymbols?: number,\r\n  managers?: AppManagers,\r\n  withIcons?: boolean\r\n};\r\n\r\nconst weakMap: WeakMap<HTMLElement, PeerTitle> = new WeakMap();\r\n\r\nrootScope.addEventListener('peer_title_edit', (peerId) => {\r\n  const elements = Array.from(document.querySelectorAll(`.peer-title[data-peer-id=\"${peerId}\"]`)) as HTMLElement[];\r\n  elements.forEach((element) => {\r\n    const peerTitle = weakMap.get(element);\r\n    // console.log('in the summer silence i was doing nothing', peerTitle, peerId);\r\n\r\n    if(peerTitle) {\r\n      peerTitle.update();\r\n    }\r\n  });\r\n});\r\n\r\nexport default class PeerTitle {\r\n  public element: HTMLElement;\r\n  public peerId: PeerId;\r\n  private fromName: string;\r\n  private plainText = false;\r\n  private onlyFirstName = false;\r\n  private dialog = false;\r\n  private limitSymbols: number;\r\n  private managers: AppManagers;\r\n  private hasInner: boolean;\r\n  private withIcons: boolean;\r\n\r\n  constructor(options?: PeerTitleOptions) {\r\n    this.element = document.createElement('span');\r\n    this.element.classList.add('peer-title');\r\n    this.element.setAttribute('dir', 'auto');\r\n\r\n    if(options) {\r\n      this.update(options);\r\n    }\r\n\r\n    weakMap.set(this.element, this);\r\n  }\r\n\r\n  public setOptions(options?: PeerTitleOptions) {\r\n    if(!options) {\r\n      return;\r\n    }\r\n\r\n    for(const i in options) {\r\n      // @ts-ignore\r\n      const value = options[i];\r\n\r\n      if(typeof(value) !== 'object') {\r\n        // @ts-ignore\r\n        this.element.dataset[i] = value ? '' + (typeof(value) === 'boolean' ? +value : value) : '0';\r\n      }\r\n\r\n      // @ts-ignore\r\n      this[i] = value;\r\n    }\r\n  }\r\n\r\n  public async update(options?: PeerTitleOptions) {\r\n    this.setOptions(options);\r\n\r\n    let fromName = this.fromName;\r\n    if(fromName !== undefined) {\r\n      if(this.limitSymbols !== undefined) {\r\n        fromName = limitSymbols(fromName, this.limitSymbols, this.limitSymbols);\r\n      }\r\n\r\n      setInnerHTML(this.element, wrapEmojiText(fromName));\r\n      return;\r\n    }\r\n\r\n    this.peerId ??= NULL_PEER_ID;\r\n\r\n    let hasInner: boolean;\r\n    if(this.peerId !== rootScope.myId || !this.dialog) {\r\n      const managers = this.managers ?? rootScope.managers;\r\n      const [title, icons] = await Promise.all([\r\n        getPeerTitle(this.peerId, this.plainText, this.onlyFirstName, this.limitSymbols, managers),\r\n        this.withIcons && generateTitleIcons(this.peerId)\r\n      ]);\r\n\r\n      if(icons?.length) {\r\n        const inner = document.createElement('span');\r\n        inner.classList.add('peer-title-inner');\r\n        hasInner = true;\r\n        setInnerHTML(inner, title);\r\n\r\n        const fragment = document.createDocumentFragment();\r\n        fragment.append(inner, ...icons);\r\n        setInnerHTML(this.element, fragment);\r\n      } else {\r\n        setInnerHTML(this.element, title);\r\n      }\r\n    } else {\r\n      replaceContent(this.element, i18n(this.onlyFirstName ? 'Saved' : 'SavedMessages'));\r\n    }\r\n\r\n    if(this.hasInner !== hasInner) {\r\n      this.hasInner = hasInner;\r\n      this.element.classList.toggle('with-icons', hasInner);\r\n    }\r\n  }\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport type {AppDownloadManager} from '../../lib/appManagers/appDownloadManager';\r\nimport resizeableImage from '../../lib/cropper';\r\nimport PopupElement from '.';\r\nimport {_i18n} from '../../lib/langPack';\r\nimport {attachClickEvent} from '../../helpers/dom/clickEvent';\r\nimport readBlobAsDataURL from '../../helpers/blob/readBlobAsDataURL';\r\nimport rootScope from '../../lib/rootScope';\r\nimport appDownloadManager from '../../lib/appManagers/appDownloadManager';\r\n\r\nexport default class PopupAvatar extends PopupElement {\r\n  private cropContainer: HTMLElement;\r\n  private input: HTMLInputElement;\r\n  private h6: HTMLElement;\r\n\r\n  private image = new Image();\r\n\r\n  private canvas: HTMLCanvasElement;\r\n  private blob: Blob;\r\n  private cropper = {\r\n    crop: () => {},\r\n    removeHandlers: () => {}\r\n  };\r\n\r\n  private onCrop: (upload: () => ReturnType<AppDownloadManager['upload']>) => void;\r\n\r\n  constructor() {\r\n    super('popup-avatar', {closable: true, withConfirm: true});\r\n\r\n    this.h6 = document.createElement('h6');\r\n    _i18n(this.h6, 'Popup.Avatar.Title');\r\n\r\n    this.btnClose.classList.remove('btn-icon');\r\n\r\n    this.header.append(this.h6);\r\n\r\n    this.cropContainer = document.createElement('div');\r\n    this.cropContainer.classList.add('crop');\r\n    this.cropContainer.append(this.image);\r\n\r\n    this.input = document.createElement('input');\r\n    this.input.type = 'file';\r\n    this.input.style.display = 'none';\r\n    this.listenerSetter.add(this.input)('change', (e: any) => {\r\n      const file = e.target.files[0];\r\n      if(!file) {\r\n        return;\r\n      }\r\n\r\n      readBlobAsDataURL(file).then((contents) => {\r\n        this.image = new Image();\r\n        this.cropContainer.append(this.image);\r\n        this.image.src = contents;\r\n\r\n        this.image.onload = () => {\r\n          /* let {w, h} = calcImageInBox(this.image.naturalWidth, this.image.naturalHeight, 460, 554);\r\n          cropContainer.style.width = w + 'px';\r\n          cropContainer.style.height = h + 'px'; */\r\n          this.show();\r\n\r\n          this.cropper = resizeableImage(this.image, this.canvas);\r\n          this.input.value = '';\r\n        };\r\n      });\r\n    }, false);\r\n\r\n    this.btnConfirm.className = 'btn-primary btn-color-primary btn-circle btn-crop btn-icon tgico-check z-depth-1';\r\n    attachClickEvent(this.btnConfirm, () => {\r\n      this.cropper.crop();\r\n      this.hide();\r\n\r\n      this.canvas.toBlob((blob) => {\r\n        this.blob = blob; // save blob to send after reg\r\n        this.darkenCanvas();\r\n        this.resolve();\r\n      }, 'image/jpeg', 1);\r\n    }, {listenerSetter: this.listenerSetter});\r\n\r\n    this.container.append(this.cropContainer, this.btnConfirm, this.input);\r\n\r\n    this.addEventListener('closeAfterTimeout', () => {\r\n      this.cropper.removeHandlers();\r\n      if(this.image) {\r\n        this.image.remove();\r\n      }\r\n    });\r\n  }\r\n\r\n  private resolve() {\r\n    this.onCrop(() => {\r\n      return appDownloadManager.upload(this.blob);\r\n    });\r\n  }\r\n\r\n  public open(postCanvas: HTMLCanvasElement, onCrop: PopupAvatar['onCrop']) {\r\n    this.canvas = postCanvas;\r\n    this.onCrop = onCrop;\r\n\r\n    this.input.click();\r\n  }\r\n\r\n  public darkenCanvas() {\r\n    const ctx = this.canvas.getContext('2d');\r\n    ctx.fillStyle = 'rgba(0, 0, 0, 0.3)';\r\n    ctx.fillRect(0, 0, this.canvas.width, this.canvas.height);\r\n  }\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nfunction resizeableImage(originalImage: HTMLImageElement, canvas?: HTMLCanvasElement) {\r\n  let cropComponent: HTMLDivElement,\r\n    container: HTMLDivElement,\r\n    cropImage: HTMLImageElement,\r\n    event_state: Partial<{\r\n      mouse_x: number,\r\n      mouse_y: number,\r\n      container_width: number,\r\n      container_height: number,\r\n      container_left: number,\r\n      container_top: number\r\n    }> = {},\r\n    keyZoomValue = 4.0,\r\n    MINWIDTH = 50,\r\n    MINHEIGHT = 50,\r\n    CROPWIDTH = 200,\r\n    CROPHEIGHT = 200,\r\n    cropLeft = 0,\r\n    cropTop = 0,\r\n    cropWidth = 0,\r\n    cropHeight = 0,\r\n    scaledRatio = 0;\r\n\r\n  if(originalImage.complete) init();\r\n  else originalImage.onload = init;\r\n\r\n  function removeHandlers() {\r\n    container.removeEventListener('mousedown', startMoving);\r\n    container.removeEventListener('touchstart', startMoving);\r\n    container.removeEventListener('wheel', resizing);\r\n\r\n    document.removeEventListener('mouseup', endMoving);\r\n    document.removeEventListener('touchend', endMoving);\r\n    document.removeEventListener('mousemove', moving);\r\n    document.removeEventListener('touchmove', moving);\r\n    document.removeEventListener('keypress', keyHandler);\r\n\r\n    cropComponent.remove();\r\n    container.remove();\r\n    cropImage.remove();\r\n  }\r\n\r\n  function addHandlers() {\r\n    container.addEventListener('mousedown', startMoving, false);\r\n    container.addEventListener('touchstart', startMoving, false);\r\n    container.addEventListener('wheel', resizing, false);\r\n\r\n    document.addEventListener('keypress', keyHandler, false);\r\n    // document.querySelector('.btn-crop').addEventListener('click', openCropCanvasImg);\r\n  }\r\n\r\n  function init() {\r\n    originalImage.classList.add('crop-blur');\r\n    originalImage.draggable = false;\r\n\r\n    cropImage = new Image();\r\n    cropImage.src = originalImage.src;\r\n    cropImage.draggable = false;\r\n    cropImage.classList.add('crop-overlay-image');\r\n\r\n    if(!canvas) {\r\n      canvas = document.createElement('canvas');\r\n    }\r\n\r\n    cropComponent = document.createElement('div');\r\n    cropComponent.classList.add('crop-component');\r\n\r\n    container = document.createElement('div');\r\n    container.classList.add('crop-overlay');\r\n\r\n    const overlayColor = document.createElement('div');\r\n    overlayColor.classList.add('crop-overlay-color');\r\n\r\n    cropComponent.appendChild(container);\r\n    const wrapper = originalImage.parentNode as HTMLElement;\r\n    wrapper.appendChild(cropComponent);\r\n    cropComponent.appendChild(cropImage);\r\n    cropComponent.appendChild(originalImage);\r\n    cropComponent.appendChild(overlayColor);\r\n    container.appendChild(cropImage);\r\n\r\n    cropImage.style.maxWidth = originalImage.width + 'px';\r\n\r\n    scaledRatio = originalImage.naturalWidth / originalImage.offsetWidth;\r\n\r\n    const left = originalImage.offsetWidth / 2 - CROPWIDTH / 2;\r\n    const top = originalImage.offsetHeight / 2 - CROPHEIGHT / 2;\r\n\r\n    updateCropSize(CROPWIDTH, CROPHEIGHT);\r\n    updateCropImage(left, top);\r\n    updateContainer(left, top);\r\n    addHandlers();\r\n    // crop();\r\n  }\r\n\r\n  function updateCropSize(width: number, height: number) {\r\n    cropWidth = width * scaledRatio;\r\n    cropHeight = height * scaledRatio;\r\n\r\n    container.style.width = width + 'px';\r\n    container.style.height = height + 'px';\r\n  }\r\n\r\n  function updateCropImage(left: number, top: number) {\r\n    cropTop = top * scaledRatio;\r\n    cropLeft = left * scaledRatio;\r\n\r\n    cropImage.style.top = -top + 'px';\r\n    cropImage.style.left = -left + 'px';\r\n  }\r\n\r\n  function updateContainer(left: number, top: number) {\r\n    container.style.top = top + 'px';\r\n    container.style.left = left + 'px';\r\n  }\r\n\r\n  // Save the initial event details and container state\r\n  function saveEventState(e: any) {\r\n    event_state.container_width = container.offsetWidth;\r\n    event_state.container_height = container.offsetHeight;\r\n\r\n    event_state.container_left = container.offsetLeft;\r\n    event_state.container_top = container.offsetTop;\r\n\r\n    event_state.mouse_x = (e.clientX || e.pageX || e.touches && e.touches[0].clientX) + window.scrollX;\r\n    event_state.mouse_y = (e.clientY || e.pageY || e.touches && e.touches[0].clientY) + window.scrollY;\r\n  }\r\n\r\n  function imgZoom(zoom: number) {\r\n    zoom = zoom * Math.PI * 2\r\n    let newWidth = Math.floor(container.clientWidth + zoom),\r\n      newHeight = Math.floor(container.clientHeight + zoom),\r\n      w = cropImage.clientWidth,\r\n      h = cropImage.clientHeight,\r\n      left: number,\r\n      top: number,\r\n      right: number,\r\n      bottom: number;\r\n\r\n    if(newWidth < MINWIDTH) {\r\n      return;\r\n    } else if(newWidth > w) {\r\n      return;\r\n    }\r\n\r\n    left = container.offsetLeft - (zoom / 2);\r\n    top = container.offsetTop - (zoom / 2);\r\n    right = left + newWidth;\r\n    bottom = top + newHeight;\r\n\r\n    if(left < 0) left = 0;\r\n    if(top < 0) top = 0;\r\n\r\n    if(right > w) return;\r\n    if(bottom > h) return;\r\n\r\n    updateCropSize(newWidth, newWidth);\r\n    updateCropImage(left, top);\r\n    updateContainer(left, top);\r\n    // crop();\r\n  }\r\n\r\n  function keyHandler(e: KeyboardEvent) {\r\n    e.preventDefault();\r\n\r\n    switch(String.fromCharCode(e.charCode)) {\r\n      case '+':\r\n        imgZoom(keyZoomValue);\r\n        break;\r\n      case '-':\r\n        imgZoom(-keyZoomValue);\r\n        break;\r\n    }\r\n  }\r\n\r\n  function resizing(e: any) {\r\n    e.preventDefault();\r\n    imgZoom(e.deltaY > 0 ? 1 : -1);\r\n  }\r\n\r\n  function startMoving(e: MouseEvent | TouchEvent) {\r\n    e.preventDefault();\r\n    e.stopPropagation();\r\n\r\n    saveEventState(e);\r\n\r\n    document.addEventListener('mousemove', moving);\r\n    document.addEventListener('touchmove', moving);\r\n    document.addEventListener('mouseup', endMoving);\r\n    document.addEventListener('touchend', endMoving);\r\n  }\r\n\r\n  function endMoving(e: MouseEvent | TouchEvent) {\r\n    e.preventDefault();\r\n\r\n    document.removeEventListener('mouseup', endMoving);\r\n    document.removeEventListener('touchend', endMoving);\r\n    document.removeEventListener('mousemove', moving);\r\n    document.removeEventListener('touchmove', moving);\r\n  }\r\n\r\n  function moving(e: any) {\r\n    let currentTouch = {x: 0, y: 0},\r\n      left: number,\r\n      top: number,\r\n      w: number,\r\n      h: number;\r\n\r\n    e.preventDefault();\r\n    e.stopPropagation();\r\n\r\n    currentTouch.x = e.pageX || e.touches && e.touches[0].pageX;\r\n    currentTouch.y = e.pageY || e.touches && e.touches[0].pageY;\r\n\r\n    left = currentTouch.x - (event_state.mouse_x - event_state.container_left);\r\n    top = currentTouch.y - (event_state.mouse_y - event_state.container_top);\r\n    w = container.offsetWidth;\r\n    h = container.offsetHeight;\r\n\r\n    if(left < 0) left = 0;\r\n    else if(left > cropImage.offsetWidth - w) left = cropImage.offsetWidth - w;\r\n\r\n    if(top < 0) top = 0;\r\n    else if(top > cropImage.offsetHeight - h) top = cropImage.offsetHeight - h;\r\n\r\n    updateCropImage(left, top);\r\n    updateContainer(left, top);\r\n    // crop();\r\n  }\r\n\r\n  function crop() {\r\n    canvas.width = cropWidth;\r\n    canvas.height = cropHeight;\r\n\r\n    const ctx = canvas.getContext('2d');\r\n    ctx.drawImage(originalImage,\r\n      cropLeft, cropTop,\r\n      cropWidth, cropHeight,\r\n      0, 0,\r\n      cropWidth, cropHeight\r\n    );\r\n  }\r\n\r\n  return {crop, removeHandlers};\r\n}\r\n\r\nexport default resizeableImage;\r\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport PopupElement from '.';\nimport type {PeerType} from '../../lib/appManagers/appPeersManager';\nimport {LangPackKey} from '../../lib/langPack';\nimport PeerTitle from '../peerTitle';\nimport PopupPeer, {PopupPeerButtonCallbackCheckboxes, PopupPeerOptions} from './peer';\n\nexport default class PopupDeleteDialog {\n  constructor(\n    private peerId: PeerId,\n    // actionType: 'leave' | 'delete',\n    private peerType?: PeerType,\n    private onSelect?: (promise: Promise<any>) => void\n  ) {\n    this.construct();\n  }\n\n  private async construct() {\n    let {peerId, peerType, onSelect} = this;\n    const peerTitleElement = new PeerTitle({peerId}).element;\n\n    const managers = PopupElement.MANAGERS;\n    if(peerType === undefined) {\n      peerType = await managers.appPeersManager.getDialogType(peerId);\n    }\n\n    /* const callbackFlush = (checked: PopupPeerButtonCallbackCheckboxes) => {\n      const promise = appMessagesManager.flushHistory(peerId, checkboxes ? !checked[checkboxes[0].text] : undefined);\n      onSelect && onSelect(promise);\n    }; */\n\n    const callbackLeave = (checked: PopupPeerButtonCallbackCheckboxes, flush = checkboxes && !!checked.size) => {\n      let promise = managers.appChatsManager.leave(peerId.toChatId());\n\n      if(flush) {\n        promise = promise.finally(() => {\n          return managers.appMessagesManager.flushHistory(peerId);\n        }) as any;\n      }\n\n      onSelect && onSelect(promise);\n    };\n\n    const callbackDelete = (checked: PopupPeerButtonCallbackCheckboxes) => {\n      let promise: Promise<any>;\n\n      if(peerId.isUser()) {\n        promise = managers.appMessagesManager.flushHistory(peerId, false, checkboxes ? !!checked.size : undefined);\n      } else {\n        if(checked.size) {\n          promise = managers.appChatsManager.delete(peerId.toChatId());\n        } else {\n          return callbackLeave(checked);\n        }\n      }\n\n      onSelect && onSelect(promise);\n    };\n\n    let title: LangPackKey, description: LangPackKey, descriptionArgs: any[], buttons: PopupPeerOptions['buttons'], checkboxes: PopupPeerOptions['checkboxes'];\n    switch(peerType) {\n      case 'channel': {\n        if(/* actionType === 'delete' &&  */await managers.appChatsManager.hasRights(peerId.toChatId(), 'delete_chat')) {\n          title = 'ChannelDeleteMenu';\n          description = 'AreYouSureDeleteAndExitChannel';\n          buttons = [{\n            langKey: 'ChannelDeleteMenu',\n            isDanger: true,\n            callback: callbackDelete\n          }];\n\n          checkboxes = [{\n            text: 'DeleteChannelForAll'\n          }];\n        } else {\n          title = 'LeaveChannelMenu';\n          description = 'ChannelLeaveAlertWithName';\n          descriptionArgs = [peerTitleElement];\n          buttons = [{\n            langKey: 'LeaveChannel',\n            isDanger: true,\n            callback: callbackLeave\n          }];\n        }\n\n        break;\n      }\n\n      /* case 'megagroup': {\n        title = 'Leave Group?';\n        description = `Are you sure you want to leave this group?`;\n        buttons = [{\n          text: 'LEAVE ' + peerTitleElement,\n          isDanger: true,\n          callback: callbackLeave\n        }];\n\n        break;\n      } */\n\n      case 'chat': {\n        title = 'DeleteChatUser';\n        description = 'AreYouSureDeleteThisChatWithUser';\n        descriptionArgs = [peerTitleElement];\n\n        buttons = [{\n          langKey: 'DeleteChatUser',\n          isDanger: true,\n          callback: callbackDelete\n        }];\n\n        checkboxes = [{\n          text: 'DeleteMessagesOptionAlso',\n          textArgs: [\n            new PeerTitle({peerId}).element\n          ]\n        }];\n\n        break;\n      }\n\n      case 'saved': {\n        title = 'DeleteChatUser';\n        description = 'AreYouSureDeleteThisChatSavedMessages';\n        buttons = [{\n          langKey: 'DeleteChatUser',\n          isDanger: true,\n          callback: callbackDelete\n        }];\n\n        break;\n      }\n\n      case 'megagroup':\n      case 'group': {\n        if(/* actionType === 'delete' &&  */await managers.appChatsManager.hasRights(peerId.toChatId(), 'delete_chat')) {\n          title = 'DeleteMegaMenu';\n          description = 'AreYouSureDeleteAndExit';\n          buttons = [{\n            langKey: 'DeleteMegaMenu',\n            isDanger: true,\n            callback: callbackDelete\n          }];\n\n          checkboxes = [{\n            text: 'DeleteChat.DeleteGroupForAll'\n          }];\n        } else {\n          title = 'LeaveMegaMenu';\n          description = 'AreYouSureDeleteAndExitName';\n          descriptionArgs = [peerTitleElement];\n          buttons = [{\n            langKey: 'DeleteChatUser',\n            isDanger: true,\n            callback: (checkboxes) => callbackLeave(checkboxes, true)\n          }];\n        }\n\n        break;\n      }\n    }\n\n    new PopupPeer('popup-delete-chat', {\n      peerId,\n      titleLangKey: title,\n      descriptionLangKey: description,\n      descriptionLangArgs: descriptionArgs,\n      buttons,\n      checkboxes\n    }).show();\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport rootScope from '../../lib/rootScope';\nimport PopupElement, {addCancelButton} from '.';\nimport PopupPeer, {PopupPeerButtonCallbackCheckboxes, PopupPeerOptions} from './peer';\nimport {ChatType} from '../chat/chat';\nimport {i18n, LangPackKey} from '../../lib/langPack';\nimport PeerTitle from '../peerTitle';\nimport hasRights from '../../lib/appManagers/utils/chats/hasRights';\nimport filterAsync from '../../helpers/array/filterAsync';\n\nexport default class PopupDeleteMessages {\n  constructor(private peerId: PeerId, private mids: number[], private type: ChatType, private onConfirm?: () => void) {\n    this.construct();\n  }\n\n  private async construct() {\n    let {peerId, mids, type, onConfirm} = this;\n\n    const peerTitleElement = new PeerTitle({peerId}).element;\n\n    const managers = PopupElement.MANAGERS;\n\n    mids = mids.slice();\n    const callback = (checked: PopupPeerButtonCallbackCheckboxes, revoke?: boolean) => {\n      onConfirm && onConfirm();\n      if(type === 'scheduled') {\n        managers.appMessagesManager.deleteScheduledMessages(peerId, mids);\n      } else {\n        managers.appMessagesManager.deleteMessages(peerId, mids, !!checked.size || revoke);\n      }\n    };\n\n    const buttons: PopupPeerOptions['buttons'] = [{\n      langKey: 'Delete',\n      isDanger: true,\n      callback\n    }];\n    const checkboxes: PopupPeerOptions['checkboxes'] = [];\n    let title: LangPackKey, titleArgs: any[], description: LangPackKey, descriptionArgs: any[];\n    if(mids.length === 1) {\n      title = 'DeleteSingleMessagesTitle';\n    } else {\n      title = 'DeleteMessagesTitle';\n      titleArgs = [i18n('messages', [mids.length])];\n    }\n\n    if(await managers.appPeersManager.isMegagroup(peerId)) {\n      description = mids.length === 1 ? 'AreYouSureDeleteSingleMessageMega' : 'AreYouSureDeleteFewMessagesMega';\n    } else {\n      description = mids.length === 1 ? 'AreYouSureDeleteSingleMessage' : 'AreYouSureDeleteFewMessages';\n    }\n\n    if(peerId === rootScope.myId || type === 'scheduled') {\n\n    } else {\n      if(peerId.isUser()) {\n        checkboxes.push({\n          text: 'DeleteMessagesOptionAlso',\n          textArgs: [peerTitleElement]\n        });\n      } else {\n        const chat = await managers.appChatsManager.getChat(peerId.toChatId());\n\n        const _hasRights = hasRights(chat, 'delete_messages');\n        if(chat._ === 'chat') {\n          const canRevoke = _hasRights ? mids.slice() : await filterAsync(mids, async(mid) => {\n            const message = await managers.appMessagesManager.getMessageByPeer(peerId, mid);\n            return message.fromId === rootScope.myId;\n          });\n\n          if(canRevoke.length) {\n            if(canRevoke.length === mids.length) {\n              checkboxes.push({\n                text: 'DeleteForAll'\n              });\n            } else {\n              checkboxes.push({\n                text: 'DeleteMessagesOption'\n              });\n\n              description = 'DeleteMessagesTextGroup';\n              descriptionArgs = [i18n('messages', [canRevoke.length])];\n              // description = `You can also delete the ${canRevoke.length} message${canRevoke.length > 1 ? 's' : ''} you sent from the inboxes of other group members by pressing \"${buttonText}\".`;\n            }\n          }\n        } else {\n          buttons[0].callback = (checked) => callback(checked, true);\n        }\n      }\n    }\n\n    addCancelButton(buttons);\n\n    const popup = new PopupPeer('popup-delete-chat', {\n      peerId,\n      titleLangKey: title,\n      titleLangArgs: titleArgs,\n      descriptionLangKey: description,\n      descriptionLangArgs: descriptionArgs,\n      buttons,\n      checkboxes\n    });\n\n    popup.show();\n  }\n}\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport appImManager from '../../lib/appManagers/appImManager';\r\nimport PopupPickUser from './pickUser';\r\n\r\nexport default class PopupForward extends PopupPickUser {\r\n  constructor(\r\n    peerIdMids: {[fromPeerId: PeerId]: number[]},\r\n    onSelect?: (peerId: PeerId) => Promise<void> | void,\r\n    overrideOnSelect = false\r\n  ) {\r\n    super({\r\n      peerTypes: ['dialogs', 'contacts'],\r\n      onSelect: overrideOnSelect ? onSelect : async(peerId) => {\r\n        if(onSelect) {\r\n          const res = onSelect(peerId);\r\n          if(res instanceof Promise) {\r\n            await res;\r\n          }\r\n        }\r\n\r\n        appImManager.setInnerPeer({peerId});\r\n        appImManager.chat.input.initMessagesForward(peerIdMids);\r\n      },\r\n      placeholder: 'ShareModal.Search.ForwardPlaceholder',\r\n      chatRightsAction: 'send_messages',\r\n      selfPresence: 'ChatYourSelf'\r\n    });\r\n  }\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport ripple from '../ripple';\r\nimport animationIntersector from '../animationIntersector';\r\nimport appNavigationController, {NavigationItem} from '../appNavigationController';\r\nimport {i18n, LangPackKey, _i18n} from '../../lib/langPack';\r\nimport findUpClassName from '../../helpers/dom/findUpClassName';\r\nimport blurActiveElement from '../../helpers/dom/blurActiveElement';\r\nimport ListenerSetter from '../../helpers/listenerSetter';\r\nimport {attachClickEvent, simulateClickEvent} from '../../helpers/dom/clickEvent';\r\nimport isSendShortcutPressed from '../../helpers/dom/isSendShortcutPressed';\r\nimport cancelEvent from '../../helpers/dom/cancelEvent';\r\nimport EventListenerBase, {EventListenerListeners} from '../../helpers/eventListenerBase';\r\nimport {addFullScreenListener, getFullScreenElement} from '../../helpers/dom/fullScreen';\r\nimport indexOfAndSplice from '../../helpers/array/indexOfAndSplice';\r\nimport {AppManagers} from '../../lib/appManagers/managers';\r\nimport overlayCounter from '../../helpers/overlayCounter';\r\nimport Scrollable from '../scrollable';\r\nimport {getMiddleware, MiddlewareHelper} from '../../helpers/middleware';\r\n\r\nexport type PopupButton = {\r\n  text?: string,\r\n  callback?: () => void,\r\n  langKey?: LangPackKey,\r\n  langArgs?: any[],\r\n  isDanger?: true,\r\n  isCancel?: true,\r\n  element?: HTMLButtonElement\r\n};\r\n\r\nexport type PopupOptions = Partial<{\r\n  closable: boolean,\r\n  overlayClosable: boolean,\r\n  withConfirm: LangPackKey | boolean,\r\n  body: boolean,\r\n  confirmShortcutIsSendShortcut: boolean,\r\n  withoutOverlay: boolean,\r\n  scrollable: boolean,\r\n  buttons: Array<PopupButton>,\r\n  title: boolean | LangPackKey\r\n}>;\r\n\r\nexport interface PopupElementConstructable<T extends PopupElement = any> {\r\n  new(...args: any[]): T;\r\n}\r\n\r\nconst DEFAULT_APPEND_TO = document.body;\r\nlet appendPopupTo = DEFAULT_APPEND_TO;\r\n\r\nconst onFullScreenChange = () => {\r\n  appendPopupTo = getFullScreenElement() || DEFAULT_APPEND_TO;\r\n  PopupElement.reAppend();\r\n};\r\n\r\naddFullScreenListener(DEFAULT_APPEND_TO, onFullScreenChange);\r\n\r\ntype PopupListeners = {\r\n  close: () => void,\r\n  closeAfterTimeout: () => void\r\n};\r\n\r\nexport default class PopupElement<T extends EventListenerListeners = {}> extends EventListenerBase<PopupListeners & T> {\r\n  private static POPUPS: PopupElement<any>[] = [];\r\n  public static MANAGERS: AppManagers;\r\n\r\n  protected element = document.createElement('div');\r\n  protected container = document.createElement('div');\r\n  protected header = document.createElement('div');\r\n  protected title = document.createElement('div');\r\n  protected btnClose: HTMLElement;\r\n  protected btnConfirm: HTMLButtonElement;\r\n  protected body: HTMLElement;\r\n  protected buttonsEl: HTMLElement;\r\n\r\n  protected onEscape: () => boolean = () => true;\r\n\r\n  protected navigationItem: NavigationItem;\r\n\r\n  protected listenerSetter: ListenerSetter;\r\n\r\n  protected confirmShortcutIsSendShortcut: boolean;\r\n  protected btnConfirmOnEnter: HTMLElement;\r\n\r\n  protected withoutOverlay: boolean;\r\n\r\n  protected managers: AppManagers;\r\n\r\n  protected scrollable: Scrollable;\r\n\r\n  protected buttons: Array<PopupButton>;\r\n\r\n  protected middlewareHelper: MiddlewareHelper;\r\n\r\n  constructor(className: string, options: PopupOptions = {}) {\r\n    super(false);\r\n    this.element.classList.add('popup');\r\n    this.element.className = 'popup' + (className ? ' ' + className : '');\r\n    this.container.classList.add('popup-container', 'z-depth-1');\r\n\r\n    this.header.classList.add('popup-header');\r\n\r\n    if(options.title) {\r\n      this.title.classList.add('popup-title');\r\n      if(typeof(options.title) === 'string') {\r\n        _i18n(this.title, options.title);\r\n      }\r\n\r\n      this.header.append(this.title);\r\n    }\r\n\r\n    this.middlewareHelper = getMiddleware();\r\n    this.listenerSetter = new ListenerSetter();\r\n    this.managers = PopupElement.MANAGERS;\r\n\r\n    this.confirmShortcutIsSendShortcut = options.confirmShortcutIsSendShortcut;\r\n\r\n    if(options.closable) {\r\n      this.btnClose = document.createElement('span');\r\n      this.btnClose.classList.add('btn-icon', 'popup-close', 'tgico-close');\r\n      // ripple(this.closeBtn);\r\n      this.header.prepend(this.btnClose);\r\n\r\n      attachClickEvent(this.btnClose, this.hide, {listenerSetter: this.listenerSetter, once: true});\r\n    }\r\n\r\n    this.withoutOverlay = options.withoutOverlay;\r\n    if(this.withoutOverlay) {\r\n      this.element.classList.add('no-overlay');\r\n    }\r\n\r\n    if(options.overlayClosable) {\r\n      attachClickEvent(this.element, (e: MouseEvent) => {\r\n        if(!findUpClassName(e.target, 'popup-container')) {\r\n          this.hide();\r\n        }\r\n      }, {listenerSetter: this.listenerSetter});\r\n    }\r\n\r\n    if(options.withConfirm) {\r\n      this.btnConfirm = document.createElement('button');\r\n      this.btnConfirm.classList.add('btn-primary', 'btn-color-primary');\r\n      if(options.withConfirm !== true) {\r\n        this.btnConfirm.append(i18n(options.withConfirm));\r\n      }\r\n      this.header.append(this.btnConfirm);\r\n      ripple(this.btnConfirm);\r\n    }\r\n\r\n    this.container.append(this.header);\r\n    if(options.body) {\r\n      this.body = document.createElement('div');\r\n      this.body.classList.add('popup-body');\r\n      this.container.append(this.body);\r\n    }\r\n\r\n    if(options.scrollable) {\r\n      const scrollable = this.scrollable = new Scrollable(this.body);\r\n      scrollable.onAdditionalScroll = () => {\r\n        scrollable.container.classList.toggle('scrolled-top', !scrollable.scrollTop);\r\n        scrollable.container.classList.toggle('scrolled-bottom', scrollable.isScrolledDown);\r\n      };\r\n\r\n      scrollable.container.classList.add('scrolled-top', 'scrolled-bottom', 'scrollable-y-bordered');\r\n\r\n      if(!this.body) {\r\n        this.container.insertBefore(scrollable.container, this.header.nextSibling);\r\n      }\r\n    }\r\n\r\n    let btnConfirmOnEnter = this.btnConfirm;\r\n    const buttons = this.buttons = options.buttons;\r\n    if(buttons?.length) {\r\n      const buttonsDiv = this.buttonsEl = document.createElement('div');\r\n      buttonsDiv.classList.add('popup-buttons');\r\n\r\n      const buttonsElements = buttons.map((b) => {\r\n        const button = document.createElement('button');\r\n        button.className = 'btn' + (b.isDanger ? ' danger' : ' primary');\r\n\r\n        ripple(button);\r\n\r\n        if(b.text) {\r\n          button.innerHTML =  b.text;\r\n        } else {\r\n          button.append(i18n(b.langKey, b.langArgs));\r\n        }\r\n\r\n        attachClickEvent(button, () => {\r\n          b.callback && b.callback();\r\n          this.destroy();\r\n        }, {listenerSetter: this.listenerSetter, once: true});\r\n\r\n        return b.element = button;\r\n      });\r\n\r\n      if(!btnConfirmOnEnter && buttons.length === 2) {\r\n        const button = buttons.find((button) => !button.isCancel);\r\n        if(button) {\r\n          btnConfirmOnEnter = button.element;\r\n        }\r\n      }\r\n\r\n      buttonsDiv.append(...buttonsElements);\r\n      this.container.append(buttonsDiv);\r\n    }\r\n\r\n    this.btnConfirmOnEnter = btnConfirmOnEnter;\r\n\r\n    this.element.append(this.container);\r\n\r\n    PopupElement.POPUPS.push(this);\r\n  }\r\n\r\n  protected onContentUpdate() {\r\n    if(this.scrollable) {\r\n      this.scrollable.onAdditionalScroll();\r\n    }\r\n  }\r\n\r\n  public show() {\r\n    this.navigationItem = {\r\n      type: 'popup',\r\n      onPop: () => this.destroy(),\r\n      onEscape: this.onEscape\r\n    };\r\n\r\n    appNavigationController.pushItem(this.navigationItem);\r\n\r\n    blurActiveElement(); // * hide mobile keyboard\r\n    appendPopupTo.append(this.element);\r\n    void this.element.offsetWidth; // reflow\r\n    this.element.classList.add('active');\r\n\r\n    this.onContentUpdate();\r\n\r\n    if(!this.withoutOverlay) {\r\n      overlayCounter.isOverlayActive = true;\r\n      animationIntersector.checkAnimations(true);\r\n    }\r\n\r\n    // cannot add event instantly because keydown propagation will fire it\r\n    // if(this.btnConfirmOnEnter) {\r\n    setTimeout(() => {\r\n      if(!this.element.classList.contains('active')) {\r\n        return;\r\n      }\r\n\r\n      this.listenerSetter.add(document.body)('keydown', (e) => {\r\n        if(PopupElement.POPUPS[PopupElement.POPUPS.length - 1] !== this) {\r\n          return;\r\n        }\r\n\r\n        if(this.confirmShortcutIsSendShortcut ? isSendShortcutPressed(e) : e.key === 'Enter') {\r\n          simulateClickEvent(this.btnConfirmOnEnter);\r\n          cancelEvent(e);\r\n        }\r\n      });\r\n    }, 0);\r\n    // }\r\n  }\r\n\r\n  public hide = () => {\r\n    appNavigationController.backByItem(this.navigationItem);\r\n  };\r\n\r\n  protected destroy() {\r\n    this.dispatchEvent<PopupListeners>('close');\r\n    this.element.classList.add('hiding');\r\n    this.element.classList.remove('active');\r\n    this.listenerSetter.removeAll();\r\n    this.middlewareHelper.destroy();\r\n\r\n    if(!this.withoutOverlay) {\r\n      overlayCounter.isOverlayActive = false;\r\n    }\r\n\r\n    appNavigationController.removeItem(this.navigationItem);\r\n    this.navigationItem = undefined;\r\n\r\n    indexOfAndSplice(PopupElement.POPUPS, this);\r\n\r\n    // ! calm\r\n    onFullScreenChange();\r\n\r\n    setTimeout(() => {\r\n      this.element.remove();\r\n      this.dispatchEvent<PopupListeners>('closeAfterTimeout');\r\n      this.cleanup();\r\n\r\n      if(!this.withoutOverlay) {\r\n        animationIntersector.checkAnimations(false);\r\n      }\r\n    }, 150);\r\n  }\r\n\r\n  public static reAppend() {\r\n    this.POPUPS.forEach((popup) => {\r\n      const {element, container} = popup;\r\n      const parentElement = element.parentElement;\r\n      if(parentElement && parentElement !== appendPopupTo && appendPopupTo !== container) {\r\n        appendPopupTo.append(element);\r\n      }\r\n    });\r\n  }\r\n\r\n  public static getPopups<T extends PopupElement>(popupConstructor: PopupElementConstructable<T>) {\r\n    return this.POPUPS.filter((element) => element instanceof popupConstructor) as T[];\r\n  }\r\n\r\n  public static createPopup<T extends PopupElement, A extends Array<any>>(ctor: {new(...args: A): T}, ...args: A) {\r\n    const popup = new ctor(...args);\r\n    return popup;\r\n  }\r\n}\r\n\r\nexport const addCancelButton = (buttons: PopupButton[]) => {\r\n  const button = buttons.find((b) => b.isCancel);\r\n  if(!button) {\r\n    buttons.push({\r\n      langKey: 'Cancel',\r\n      isCancel: true\r\n    });\r\n  }\r\n\r\n  return buttons;\r\n};\r\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport tsNow from '../../helpers/tsNow';\nimport {LangPackKey} from '../../lib/langPack';\nimport {MUTE_UNTIL} from '../../lib/mtproto/mtproto_config';\nimport RadioField from '../radioField';\nimport Row, {RadioFormFromRows} from '../row';\nimport PopupPeer from './peer';\n\nconst ONE_HOUR = 3600;\nconst times: {time: number, langKey: LangPackKey}[] = [{\n  time: ONE_HOUR,\n  langKey: 'ChatList.Mute.1Hour'\n}, {\n  time: ONE_HOUR * 4,\n  langKey: 'ChatList.Mute.4Hours'\n}, {\n  time: ONE_HOUR * 8,\n  langKey: 'ChatList.Mute.8Hours'\n}, {\n  time: ONE_HOUR * 24,\n  langKey: 'ChatList.Mute.1Day'\n}, {\n  time: ONE_HOUR * 24 * 3,\n  langKey: 'ChatList.Mute.3Days'\n}, {\n  time: -1,\n  langKey: 'ChatList.Mute.Forever'\n}];\n\nexport default class PopupMute extends PopupPeer {\n  constructor(peerId: PeerId) {\n    super('popup-mute', {\n      peerId,\n      titleLangKey: 'Notifications',\n      buttons: [{\n        langKey: 'ChatList.Context.Mute',\n        callback: () => {\n          this.managers.appMessagesManager.mutePeer(peerId, time === -1 ? MUTE_UNTIL : tsNow(true) + time);\n        }\n      }],\n      body: true\n    });\n\n    const name = 'mute-time';\n    const rows = times.map((time) => {\n      const row = new Row({\n        radioField: new RadioField({\n          langKey: time.langKey,\n          name,\n          value: '' + time.time\n        })\n      });\n\n      return row;\n    });\n\n    let time: number;\n    const radioForm = RadioFormFromRows(rows, (value) => {\n      time = +value;\n    });\n\n    this.body.append(radioForm);\n\n    rows[rows.length - 1].radioField.checked = true;\n\n    this.show();\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport AvatarElement from '../avatar';\nimport PopupElement, {addCancelButton, PopupButton, PopupOptions} from '.';\nimport {i18n, LangPackKey} from '../../lib/langPack';\nimport CheckboxField, {CheckboxFieldOptions} from '../checkboxField';\nimport setInnerHTML from '../../helpers/dom/setInnerHTML';\n\nexport type PopupPeerButton = Omit<PopupButton, 'callback'> & Partial<{callback: PopupPeerButtonCallback}>;\nexport type PopupPeerButtonCallbackCheckboxes = Set<LangPackKey>;\nexport type PopupPeerButtonCallback = (checkboxes?: PopupPeerButtonCallbackCheckboxes) => void;\nexport type PopupPeerCheckboxOptions = CheckboxFieldOptions & {checkboxField?: CheckboxField};\n\nexport type PopupPeerOptions = Omit<PopupOptions, 'buttons' | 'title'> & Partial<{\n  peerId: PeerId,\n  title: string | HTMLElement,\n  titleLangKey: LangPackKey,\n  titleLangArgs: any[],\n  noTitle: boolean,\n  description: string | DocumentFragment,\n  descriptionLangKey: LangPackKey,\n  descriptionLangArgs: any[],\n  buttons: Array<PopupPeerButton>,\n  checkboxes: Array<PopupPeerCheckboxOptions>\n}>;\nexport default class PopupPeer extends PopupElement {\n  protected description: HTMLParagraphElement;\n\n  constructor(private className: string, options: PopupPeerOptions = {}) {\n    super('popup-peer' + (className ? ' ' + className : ''), {\n      overlayClosable: true,\n      ...options,\n      title: true,\n      buttons: options.buttons && addCancelButton(options.buttons)\n    });\n\n    if(options.peerId) {\n      const avatarEl = new AvatarElement();\n      avatarEl.classList.add('avatar-32');\n      avatarEl.updateWithOptions({\n        isDialog: true,\n        peerId: options.peerId\n      });\n      this.header.prepend(avatarEl);\n    }\n\n    if(!options.noTitle) {\n      if(options.titleLangKey || !options.title) this.title.append(i18n(options.titleLangKey || 'AppName', options.titleLangArgs));\n      else if(options.title instanceof HTMLElement) {\n        this.title.append(options.title);\n      } else this.title.innerText = options.title || '';\n    }\n\n    const fragment = document.createDocumentFragment();\n\n    if(options.descriptionLangKey || options.description) {\n      const p = this.description = document.createElement('p');\n      p.classList.add('popup-description');\n      if(options.descriptionLangKey) p.append(i18n(options.descriptionLangKey, options.descriptionLangArgs));\n      else if(options.description) setInnerHTML(p, options.description);\n\n      fragment.append(p);\n    }\n\n    if(options.checkboxes) {\n      this.container.classList.add('have-checkbox');\n\n      options.checkboxes.forEach((o) => {\n        o.withRipple = true;\n        const checkboxField = new CheckboxField(o);\n        o.checkboxField = checkboxField;\n        fragment.append(checkboxField.label);\n      });\n\n      options.buttons.forEach((button) => {\n        if(button.callback) {\n          const original = button.callback;\n          button.callback = () => {\n            const c: Set<LangPackKey> = new Set();\n            options.checkboxes.forEach((o) => {\n              if(o.checkboxField.checked) {\n                c.add(o.text);\n              }\n            });\n            original(c);\n          };\n        }\n      });\n    }\n\n    this.container.insertBefore(fragment, this.header.nextElementSibling);\n  }\n}\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport IS_TOUCH_SUPPORTED from '../../environment/touchSupport';\r\nimport AppSelectPeers from '../appSelectPeers';\r\nimport PopupElement from '.';\r\nimport {LangPackKey, _i18n} from '../../lib/langPack';\r\n\r\nexport default class PopupPickUser extends PopupElement {\r\n  protected selector: AppSelectPeers;\r\n\r\n  constructor(options: {\r\n    peerTypes: AppSelectPeers['peerType'],\r\n    onSelect?: (peerId: PeerId) => Promise<void> | void,\r\n    placeholder: LangPackKey,\r\n    chatRightsAction?: AppSelectPeers['chatRightsAction'],\r\n    peerId?: number,\r\n    selfPresence?: LangPackKey\r\n  }) {\r\n    super('popup-forward', {closable: true, overlayClosable: true, body: true, title: true});\r\n\r\n    this.selector = new AppSelectPeers({\r\n      appendTo: this.body,\r\n      onChange: async() => {\r\n        const selected = this.selector.getSelected();\r\n        const peerId = selected[selected.length - 1].toPeerId();\r\n\r\n        if(options.onSelect) {\r\n          const res = options.onSelect(peerId);\r\n          if(res instanceof Promise) {\r\n            try {\r\n              await res;\r\n            } catch(err) {\r\n              return;\r\n            }\r\n          }\r\n        }\r\n\r\n        this.selector = null;\r\n        this.hide();\r\n      },\r\n      peerType: options.peerTypes,\r\n      onFirstRender: () => {\r\n        this.show();\r\n        this.selector.checkForTriggers(); // ! due to zero height before mounting\r\n\r\n        if(!IS_TOUCH_SUPPORTED) {\r\n          this.selector.input.focus();\r\n        }\r\n      },\r\n      chatRightsAction: options.chatRightsAction,\r\n      multiSelect: false,\r\n      rippleEnabled: false,\r\n      avatarSize: 46,\r\n      peerId: options.peerId,\r\n      placeholder: options.placeholder,\r\n      selfPresence: options.selfPresence,\r\n      managers: this.managers\r\n    });\r\n\r\n    // this.scrollable = new Scrollable(this.body);\r\n\r\n    this.title.append(this.selector.input);\r\n  }\r\n}\r\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport PopupPeer from './peer';\n\nexport default class PopupSendNow extends PopupPeer {\n  constructor(peerId: PeerId, mids: number[], onConfirm?: () => void) {\n    super('popup-delete-chat', {\n      title: `Send Message${mids.length > 1 ? 's' : ''} Now`,\n      description: mids.length > 1 ? 'Send ' + mids.length + ' messages now?' : 'Send message now?',\n      buttons: [{\n        langKey: 'Send',\n        callback: () => {\n          onConfirm && onConfirm();\n          this.managers.appMessagesManager.sendScheduledMessages(peerId, mids);\n        }\n      }]\n    });\n\n    this.show();\n  }\n}\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport PopupElement from '.';\r\nimport type {AppStickersManager} from '../../lib/appManagers/appStickersManager';\r\nimport {wrapSticker} from '../wrappers';\r\nimport LazyLoadQueue from '../lazyLoadQueue';\r\nimport {putPreloader} from '../putPreloader';\r\nimport animationIntersector, {AnimationItemGroup} from '../animationIntersector';\r\nimport appImManager from '../../lib/appManagers/appImManager';\r\nimport mediaSizes from '../../helpers/mediaSizes';\r\nimport {i18n} from '../../lib/langPack';\r\nimport Button from '../button';\r\nimport findUpClassName from '../../helpers/dom/findUpClassName';\r\nimport toggleDisability from '../../helpers/dom/toggleDisability';\r\nimport {attachClickEvent} from '../../helpers/dom/clickEvent';\r\nimport {toastNew} from '../toast';\r\nimport setInnerHTML from '../../helpers/dom/setInnerHTML';\r\nimport wrapEmojiText from '../../lib/richTextProcessor/wrapEmojiText';\r\nimport createStickersContextMenu from '../../helpers/dom/createStickersContextMenu';\r\nimport attachStickerViewerListeners from '../stickerViewer';\r\nimport wrapRichText from '../../lib/richTextProcessor/wrapRichText';\r\nimport {Document, MessageEntity, StickerSet} from '../../layer';\r\nimport Row from '../row';\r\nimport replaceContent from '../../helpers/dom/replaceContent';\r\nimport rootScope from '../../lib/rootScope';\r\n\r\nconst ANIMATION_GROUP: AnimationItemGroup = 'STICKERS-POPUP';\r\n\r\nexport default class PopupStickers extends PopupElement {\r\n  private stickersFooter: HTMLElement;\r\n  private appendTo: HTMLElement;\r\n  private updateAdded: {[setId: Long]: (added: boolean) => void};\r\n  private sets: StickerSet.stickerSet[];\r\n  private button: HTMLElement;\r\n\r\n  constructor(\r\n    private stickerSetInput: Parameters<AppStickersManager['getStickerSet']>[0] | Parameters<AppStickersManager['getStickerSet']>[0][],\r\n    private isEmojis?: boolean\r\n  ) {\r\n    super('popup-stickers', {closable: true, overlayClosable: true, body: true, scrollable: true, title: true});\r\n\r\n    this.title.append(i18n('Loading'));\r\n    this.updateAdded = {};\r\n\r\n    this.addEventListener('close', () => {\r\n      animationIntersector.setOnlyOnePlayableGroup();\r\n    });\r\n\r\n    this.appendTo = this.scrollable.container;\r\n\r\n    this.appendTo.classList.add('is-loading');\r\n    putPreloader(this.appendTo, true);\r\n\r\n    this.stickersFooter = document.createElement('div');\r\n    this.stickersFooter.classList.add('sticker-set-footer');\r\n\r\n    const btn = Button('btn-primary btn-primary-transparent disable-hover', {noRipple: true, text: 'Loading'});\r\n    this.stickersFooter.append(btn);\r\n\r\n    this.body.append(this.stickersFooter);\r\n\r\n    attachStickerViewerListeners({listenTo: this.appendTo, listenerSetter: this.listenerSetter});\r\n\r\n    const onStickerSetUpdate = (set: StickerSet.stickerSet) => {\r\n      const idx = this.sets.findIndex((_set) => _set.id === set.id);\r\n      if(idx === -1) {\r\n        return;\r\n      }\r\n\r\n      this.sets[idx] = set;\r\n      const updateAdded = this.updateAdded[set.id];\r\n      updateAdded?.(!!set.installed_date);\r\n      this.updateButton();\r\n    };\r\n\r\n    this.listenerSetter.add(rootScope)('stickers_installed', onStickerSetUpdate);\r\n    this.listenerSetter.add(rootScope)('stickers_deleted', onStickerSetUpdate);\r\n\r\n    this.loadStickerSet();\r\n  }\r\n\r\n  private createStickerSetElements(set?: StickerSet.stickerSet) {\r\n    const container = document.createElement('div');\r\n    container.classList.add('sticker-set');\r\n\r\n    let headerRow: Row, updateAdded: (added: boolean) => void;\r\n    if(set) {\r\n      headerRow = new Row({\r\n        title: wrapEmojiText(set.title),\r\n        subtitle: i18n(set.pFlags.emojis ? 'EmojiCount' : 'Stickers', [set.count]),\r\n        buttonRight: true\r\n      });\r\n\r\n      updateAdded = (added) => {\r\n        replaceContent(headerRow.buttonRight, i18n(added ? 'Stickers.SearchAdded' : 'Stickers.SearchAdd'));\r\n        headerRow.buttonRight.classList.toggle('active', added);\r\n      };\r\n\r\n      updateAdded(!!set.installed_date);\r\n\r\n      container.append(headerRow.container);\r\n    }\r\n\r\n    const itemsContainer = document.createElement('div');\r\n    itemsContainer.classList.add('sticker-set-stickers');\r\n\r\n    container.append(itemsContainer);\r\n\r\n    return {container, headerRow, updateAdded, itemsContainer};\r\n  }\r\n\r\n  private onStickersClick = async(e: MouseEvent) => {\r\n    const target = findUpClassName(e.target, 'sticker-set-sticker');\r\n    if(!target) return;\r\n\r\n    const docId = target.dataset.docId;\r\n    if(await appImManager.chat.input.sendMessageWithDocument(docId)) {\r\n      this.hide();\r\n    }\r\n  };\r\n\r\n  private async loadStickerSet() {\r\n    const middleware = this.middlewareHelper.get();\r\n    const inputs = Array.isArray(this.stickerSetInput) ? this.stickerSetInput : [this.stickerSetInput];\r\n    const setsPromises = inputs.map((input) => this.managers.appStickersManager.getStickerSet(input));\r\n    let sets = await Promise.all(setsPromises);\r\n    if(!middleware()) return;\r\n    let firstSet = sets[0];\r\n    if(sets.length === 1 && !firstSet) {\r\n      toastNew({langPackKey: this.isEmojis ? 'AddEmojiNotFound' : 'StickerSet.DontExist'});\r\n      this.hide();\r\n      return;\r\n    }\r\n\r\n    sets = sets.filter(Boolean);\r\n    firstSet = sets[0];\r\n\r\n    this.sets = sets.map((set) => set.set);\r\n\r\n    const isEmojis = this.isEmojis ??= !!firstSet.set.pFlags.emojis;\r\n\r\n    if(!isEmojis) {\r\n      attachClickEvent(this.appendTo, this.onStickersClick, {listenerSetter: this.listenerSetter});\r\n\r\n      const {destroy} = createStickersContextMenu({\r\n        listenTo: this.appendTo,\r\n        isStickerPack: true,\r\n        onSend: () => this.hide()\r\n      });\r\n\r\n      this.addEventListener('close', destroy);\r\n    }\r\n\r\n    animationIntersector.setOnlyOnePlayableGroup(ANIMATION_GROUP);\r\n\r\n    const lazyLoadQueue = new LazyLoadQueue();\r\n    const loadPromises: Promise<any>[] = [];\r\n\r\n    const containersPromises = sets.map(async(set) => {\r\n      const {container, itemsContainer, headerRow, updateAdded} = this.createStickerSetElements(sets.length > 1 ? set.set : undefined);\r\n\r\n      if(headerRow) {\r\n        attachClickEvent(headerRow.buttonRight, () => {\r\n          this.managers.appStickersManager.toggleStickerSet(set.set);\r\n        }, {listenerSetter: this.listenerSetter});\r\n      }\r\n\r\n      this.updateAdded[set.set.id] = updateAdded;\r\n\r\n      let divs: (HTMLElement | DocumentFragment)[];\r\n\r\n      const docs = set.documents.filter((doc) => doc?._ === 'document') as Document.document[];\r\n      if(isEmojis) {\r\n        let text = '';\r\n        const entities: MessageEntity[] = [];\r\n        docs.forEach((doc) => {\r\n          entities.push({\r\n            _: 'messageEntityCustomEmoji',\r\n            offset: text.length,\r\n            length: doc.stickerEmojiRaw.length,\r\n            document_id: doc.id\r\n          });\r\n\r\n          text += doc.stickerEmojiRaw;\r\n        });\r\n\r\n        const wrapped = wrapRichText(text, {\r\n          entities,\r\n          loadPromises,\r\n          animationGroup: ANIMATION_GROUP,\r\n          customEmojiSize: mediaSizes.active.esgCustomEmoji,\r\n          middleware\r\n          // lazyLoadQueue\r\n        });\r\n\r\n        divs = [wrapped];\r\n\r\n        itemsContainer.classList.add('is-emojis');\r\n      } else {\r\n        divs = await Promise.all(docs.map(async(doc) => {\r\n          const div = document.createElement('div');\r\n          div.classList.add('sticker-set-sticker');\r\n\r\n          const size = mediaSizes.active.esgSticker.width;\r\n\r\n          await wrapSticker({\r\n            doc,\r\n            div,\r\n            lazyLoadQueue,\r\n            group: ANIMATION_GROUP,\r\n            play: true,\r\n            loop: true,\r\n            width: size,\r\n            height: size,\r\n            withLock: true,\r\n            loadPromises,\r\n            middleware\r\n          });\r\n\r\n          return div;\r\n        }));\r\n      }\r\n\r\n      itemsContainer.append(...divs.filter(Boolean));\r\n\r\n      return container;\r\n    });\r\n\r\n    const containers = await Promise.all(containersPromises);\r\n    await Promise.all(loadPromises);\r\n\r\n    const button = this.button = Button('', {noRipple: true});\r\n\r\n    this.updateButton();\r\n\r\n    attachClickEvent(button, () => {\r\n      const toggle = toggleDisability([button], true);\r\n\r\n      this.managers.appStickersManager.toggleStickerSets(sets.map((set) => set.set)).then(() => {\r\n        this.hide();\r\n      }).catch(() => {\r\n        toggle();\r\n      });\r\n    }, {listenerSetter: this.listenerSetter});\r\n\r\n    if(sets.length === 1) {\r\n      setInnerHTML(this.title, wrapEmojiText(firstSet.set.title));\r\n    } else {\r\n      setInnerHTML(this.title, i18n('Emoji'));\r\n    }\r\n\r\n    this.stickersFooter.textContent = '';\r\n    this.stickersFooter.append(button);\r\n\r\n    this.appendTo.classList.remove('is-loading');\r\n    this.appendTo.textContent = '';\r\n    this.appendTo.append(...containers);\r\n\r\n    this.scrollable.onAdditionalScroll();\r\n  }\r\n\r\n  private updateButton() {\r\n    const {sets, isEmojis} = this;\r\n    let isAdd: boolean, buttonAppend: HTMLElement;\r\n    if(sets.length === 1) {\r\n      const firstSet = sets[0];\r\n      buttonAppend = i18n(isEmojis ? 'EmojiCount' : 'Stickers', [firstSet.count]);\r\n      isAdd = !firstSet.installed_date;\r\n    } else {\r\n      const installed = sets.filter((set) => set.installed_date);\r\n      let count: number;\r\n      if(sets.length === installed.length) {\r\n        isAdd = false;\r\n        count = sets.length;\r\n      } else {\r\n        isAdd = true;\r\n        count = sets.length - installed.length;\r\n      }\r\n\r\n      buttonAppend = i18n('EmojiPackCount', [count]);\r\n    }\r\n\r\n    this.button.className = isAdd ? 'btn-primary btn-color-primary' : 'btn-primary btn-primary-transparent danger';\r\n    replaceContent(this.button, i18n(isAdd ? 'AddStickersCount' : 'RemoveStickersCount', [buttonAppend]));\r\n  }\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport {CancellablePromise} from '../helpers/cancellablePromise';\r\nimport SetTransition from './singleTransition';\r\nimport {fastRaf} from '../helpers/schedulers';\r\nimport cancelEvent from '../helpers/dom/cancelEvent';\r\nimport {attachClickEvent} from '../helpers/dom/clickEvent';\r\nimport isInDOM from '../helpers/dom/isInDOM';\r\nimport safeAssign from '../helpers/object/safeAssign';\r\n\r\nconst TRANSITION_TIME = 200;\r\n\r\nexport default class ProgressivePreloader {\r\n  public preloader: HTMLDivElement;\r\n  public circle: SVGCircleElement;\r\n  private cancelSvg: SVGSVGElement;\r\n  private downloadSvg: HTMLElement;\r\n\r\n  private tempId = 0;\r\n  public detached = true;\r\n\r\n  public promise: CancellablePromise<any> = null;\r\n\r\n  public isUpload = false;\r\n  private cancelable = true;\r\n  private streamable = false;\r\n  private tryAgainOnFail = true;\r\n  private attachMethod: 'append' | 'prepend' = 'append';\r\n\r\n  public loadFunc: (e?: Event) => any;\r\n\r\n  public totalLength: number;\r\n\r\n  constructor(options?: Partial<{\r\n    isUpload: ProgressivePreloader['isUpload'],\r\n    cancelable: ProgressivePreloader['cancelable'],\r\n    streamable: ProgressivePreloader['streamable'],\r\n    tryAgainOnFail: ProgressivePreloader['tryAgainOnFail'],\r\n    attachMethod: ProgressivePreloader['attachMethod']\r\n  }>) {\r\n    if(options) {\r\n      safeAssign(this, options);\r\n    }\r\n\r\n    if(this.isUpload) {\r\n      this.tryAgainOnFail = false;\r\n    }\r\n  }\r\n\r\n  public constructContainer(options: Partial<{\r\n    color: 'transparent',\r\n    bold: boolean\r\n  }> = {}) {\r\n    if(!this.preloader) {\r\n      this.preloader = document.createElement('div');\r\n      this.preloader.classList.add('preloader-container');\r\n\r\n      if(options.color) {\r\n        this.preloader.classList.add('preloader-' + options.color);\r\n      }\r\n\r\n      if(options.bold) {\r\n        this.preloader.classList.add('preloader-bold');\r\n      }\r\n\r\n      if(this.streamable) {\r\n        this.preloader.classList.add('preloader-streamable');\r\n      }\r\n    }\r\n  }\r\n\r\n  public constructDownloadIcon() {\r\n    this.constructContainer();\r\n  }\r\n\r\n  public construct() {\r\n    this.construct = null;\r\n\r\n    this.constructContainer();\r\n\r\n    this.preloader.innerHTML = `\r\n    <div class=\"you-spin-me-round\">\r\n    <svg xmlns=\"http://www.w3.org/2000/svg\" class=\"preloader-circular\" viewBox=\"${this.streamable ? '25 25 50 50' : '27 27 54 54'}\">\r\n    <circle class=\"preloader-path-new\" cx=\"${this.streamable ? '50' : '54'}\" cy=\"${this.streamable ? '50' : '54'}\" r=\"${this.streamable ? 19 : 24}\" fill=\"none\" stroke-miterlimit=\"10\"/>\r\n    </svg>\r\n    </div>`;\r\n\r\n    if(this.streamable) {\r\n      this.totalLength = 118.61124420166016;\r\n    } else {\r\n      this.totalLength = 149.82473754882812;\r\n    }\r\n\r\n    if(this.cancelable) {\r\n      this.preloader.innerHTML += `\r\n      <svg xmlns=\"http://www.w3.org/2000/svg\" class=\"preloader-close\" viewBox=\"0 0 24 24\">\r\n        <g fill=\"none\" fill-rule=\"evenodd\">\r\n          <polygon points=\"0 0 24 0 24 24 0 24\"/>\r\n          <path fill=\"#000\" fill-rule=\"nonzero\" d=\"M5.20970461,5.38710056 L5.29289322,5.29289322 C5.65337718,4.93240926 6.22060824,4.90467972 6.61289944,5.20970461 L6.70710678,5.29289322 L12,10.585 L17.2928932,5.29289322 C17.6834175,4.90236893 18.3165825,4.90236893 18.7071068,5.29289322 C19.0976311,5.68341751 19.0976311,6.31658249 18.7071068,6.70710678 L13.415,12 L18.7071068,17.2928932 C19.0675907,17.6533772 19.0953203,18.2206082 18.7902954,18.6128994 L18.7071068,18.7071068 C18.3466228,19.0675907 17.7793918,19.0953203 17.3871006,18.7902954 L17.2928932,18.7071068 L12,13.415 L6.70710678,18.7071068 C6.31658249,19.0976311 5.68341751,19.0976311 5.29289322,18.7071068 C4.90236893,18.3165825 4.90236893,17.6834175 5.29289322,17.2928932 L10.585,12 L5.29289322,6.70710678 C4.93240926,6.34662282 4.90467972,5.77939176 5.20970461,5.38710056 L5.29289322,5.29289322 L5.20970461,5.38710056 Z\"/>\r\n        </g>\r\n      </svg>\r\n      <svg xmlns=\"http://www.w3.org/2000/svg\" class=\"preloader-download\" viewBox=\"0 0 24 24\">\r\n        <g fill=\"none\" fill-rule=\"evenodd\">\r\n          <polygon points=\"0 0 24 0 24 24 0 24\"/>\r\n          <path fill=\"#000\" fill-rule=\"nonzero\" d=\"M5,19 L19,19 C19.5522847,19 20,19.4477153 20,20 C20,20.5128358 19.6139598,20.9355072 19.1166211,20.9932723 L19,21 L5,21 C4.44771525,21 4,20.5522847 4,20 C4,19.4871642 4.38604019,19.0644928 4.88337887,19.0067277 L5,19 L19,19 L5,19 Z M11.8833789,3.00672773 L12,3 C12.5128358,3 12.9355072,3.38604019 12.9932723,3.88337887 L13,4 L13,13.585 L16.2928932,10.2928932 C16.6533772,9.93240926 17.2206082,9.90467972 17.6128994,10.2097046 L17.7071068,10.2928932 C18.0675907,10.6533772 18.0953203,11.2206082 17.7902954,11.6128994 L17.7071068,11.7071068 L12.7071068,16.7071068 C12.3466228,17.0675907 11.7793918,17.0953203 11.3871006,16.7902954 L11.2928932,16.7071068 L6.29289322,11.7071068 C5.90236893,11.3165825 5.90236893,10.6834175 6.29289322,10.2928932 C6.65337718,9.93240926 7.22060824,9.90467972 7.61289944,10.2097046 L7.70710678,10.2928932 L11,13.585 L11,4 C11,3.48716416 11.3860402,3.06449284 11.8833789,3.00672773 L12,3 L11.8833789,3.00672773 Z\"/>\r\n        </g>\r\n      </svg>`;\r\n\r\n      this.downloadSvg = this.preloader.lastElementChild as HTMLElement;\r\n      this.cancelSvg = this.downloadSvg.previousElementSibling as any;\r\n    } else {\r\n      this.preloader.classList.add('preloader-swing');\r\n    }\r\n\r\n    this.circle = this.preloader.firstElementChild.firstElementChild.firstElementChild as SVGCircleElement;\r\n\r\n    if(this.cancelable) {\r\n      attachClickEvent(this.preloader, this.onClick);\r\n    }\r\n  }\r\n\r\n  public onClick = (e?: Event) => {\r\n    if(e) {\r\n      cancelEvent(e);\r\n    }\r\n\r\n    if(this.preloader.classList.contains('manual')) {\r\n      if(this.loadFunc) {\r\n        this.loadFunc(e);\r\n      }\r\n    } else {\r\n      if(this.promise && this.promise.cancel) {\r\n        this.promise.cancel();\r\n      }\r\n    }\r\n  };\r\n\r\n  public setDownloadFunction(func: ProgressivePreloader['loadFunc']) {\r\n    this.loadFunc = func;\r\n  }\r\n\r\n  public setManual() {\r\n    this.preloader.classList.add('manual');\r\n    this.setProgress(0);\r\n  }\r\n\r\n  public attachPromise(promise: CancellablePromise<any>) {\r\n    if(this.isUpload && this.promise) return;\r\n\r\n    this.promise = promise;\r\n\r\n    const tempId = --this.tempId;\r\n    const startTime = Date.now();\r\n\r\n    const onEnd = (err: Error) => {\r\n      promise.notify = promise.notifyAll = null;\r\n\r\n      if(tempId !== this.tempId) {\r\n        return;\r\n      }\r\n\r\n      const elapsedTime = Date.now() - startTime;\r\n\r\n      // console.log('[PP]: end', this.detached, performance.now());\r\n\r\n      if(!err && this.cancelable) {\r\n        this.setProgress(100);\r\n\r\n        const delay = TRANSITION_TIME * 0.75;\r\n\r\n        if(elapsedTime < delay) {\r\n          this.detach();\r\n        } else {\r\n          setTimeout(() => { // * wait for transition complete\r\n            if(tempId === this.tempId) {\r\n              this.detach();\r\n            }\r\n          }, delay);\r\n        }\r\n      } else {\r\n        if(this.tryAgainOnFail) {\r\n          this.attach(this.preloader.parentElement);\r\n          fastRaf(() => {\r\n            this.setManual();\r\n          });\r\n        } else {\r\n          this.detach();\r\n        }\r\n      }\r\n\r\n      this.promise = promise = null;\r\n    };\r\n\r\n    promise\r\n    .then(() => onEnd(null))\r\n    .catch((err) => onEnd(err));\r\n\r\n    if(promise.addNotifyListener) {\r\n      promise.addNotifyListener((details: {done: number, total: number}) => {\r\n        /* if(details.done >= details.total) {\r\n          onEnd();\r\n        } */\r\n\r\n        if(tempId !== this.tempId) return;\r\n\r\n        // console.log('preloader download', promise, details);\r\n        const percents = details.done / details.total * 100;\r\n        this.setProgress(percents);\r\n      });\r\n    }\r\n  }\r\n\r\n  public attach(elem: Element, reset = false, promise?: CancellablePromise<any>) {\r\n    if(this.construct) {\r\n      this.construct();\r\n    }\r\n\r\n    if(this.preloader.parentElement) {\r\n      this.preloader.classList.remove('manual');\r\n    }\r\n\r\n    this.detached = false;\r\n\r\n    if(promise/*  && false */) {\r\n      this.attachPromise(promise);\r\n    }\r\n\r\n    let useRafs = 0;\r\n    if(this.detached || this.preloader.parentElement !== elem) {\r\n      useRafs = isInDOM(this.preloader) ? 1 : 2;\r\n      if(this.preloader.parentElement !== elem) {\r\n        elem[this.attachMethod](this.preloader);\r\n      }\r\n    }\r\n\r\n    SetTransition(this.preloader, 'is-visible', true, TRANSITION_TIME, undefined, useRafs);\r\n\r\n    if(this.cancelable && reset) {\r\n      this.setProgress(0);\r\n    }\r\n  }\r\n\r\n  public detach() {\r\n    if(this.detached) {\r\n      return;\r\n    }\r\n    // return;\r\n\r\n    this.detached = true;\r\n\r\n    // return;\r\n\r\n    if(this.preloader?.parentElement) {\r\n      /* setTimeout(() =>  */// fastRaf(() => {\r\n      /* if(!this.detached) return;\r\n        this.detached = true; */\r\n\r\n      // fastRaf(() => {\r\n      // console.log('[PP]: detach after rAF', this.detached, performance.now());\r\n\r\n      // if(!this.detached || !this.preloader.parentElement) {\r\n      //   return;\r\n      // }\r\n\r\n      SetTransition(this.preloader, 'is-visible', false, TRANSITION_TIME, () => {\r\n        this.preloader.remove();\r\n      }, 1);\r\n      // });\r\n      // })/* , 5e3) */;\r\n    }\r\n  }\r\n\r\n  public setProgress(percents: number) {\r\n    if(!this.totalLength && !isInDOM(this.circle)) {\r\n      return;\r\n    }\r\n\r\n    if(percents === 0) {\r\n      this.circle.style.strokeDasharray = '';\r\n      return;\r\n    }\r\n\r\n    try {\r\n      if(!this.totalLength) {\r\n        this.totalLength = this.circle.getTotalLength();\r\n      }\r\n\r\n      // console.log('setProgress', (percents / 100 * totalLength));\r\n      this.circle.style.strokeDasharray = '' + Math.max(5, percents / 100 * this.totalLength) + ', ' + this.totalLength;\r\n    } catch(err) {}\r\n  }\r\n}\r\n","/*\r\nThis file is part of Telegram Desktop,\r\nthe official desktop application for the Telegram messaging service.\r\nFor license and copyright information please follow this link:\r\nhttps://github.com/telegramdesktop/tdesktop/blob/master/LEGAL\r\n*/\r\n\r\nimport accumulate from '../helpers/array/accumulate';\r\nimport clamp from '../helpers/number/clamp';\r\n\r\ntype Size = {w: number, h: number};\r\nexport type GroupMediaLayout = {\r\n  geometry: {\r\n    x: number,\r\n    y: number,\r\n    width: number,\r\n    height: number\r\n  },\r\n  sides: number\r\n};\r\ntype Attempt = {\r\n  lineCounts: number[],\r\n  heights: number[]\r\n};\r\nexport const RectPart = {\r\n  None: 0,\r\n  Top: 1,\r\n  Right: 2,\r\n  Bottom: 4,\r\n  Left: 8\r\n};\r\n\r\n// https://github.com/telegramdesktop/tdesktop/blob/4669c07dc5335cbf4795bbbe5b0ab7c007b9aee2/Telegram/SourceFiles/ui/grouped_layout.cpp\r\nexport class Layouter {\r\n  private count: number;\r\n  private ratios: number[];\r\n  private proportions: string;\r\n  private averageRatio: number;\r\n  private maxSizeRatio: number;\r\n\r\n  constructor(private sizes: Size[], private maxWidth: number, private minWidth: number, private spacing: number, private maxHeight = maxWidth) {\r\n    this.count = sizes.length;\r\n    this.ratios = Layouter.countRatios(sizes);\r\n    this.proportions = Layouter.countProportions(this.ratios);\r\n    this.averageRatio = accumulate(this.ratios, 1) / this.count; // warn\r\n    this.maxSizeRatio = maxWidth / this.maxHeight;\r\n  }\r\n\r\n  public layout(): GroupMediaLayout[] {\r\n    if(!this.count) return [];\r\n    // else if(this.count === 1) return this.layoutOne();\r\n\r\n    if(this.count >= 5 || this.ratios.find((r) => r > 2)) {\r\n      return new ComplexLayouter(this.ratios, this.averageRatio, this.maxWidth, this.minWidth, this.spacing).layout();\r\n    }\r\n\r\n    if(this.count === 2) return this.layoutTwo();\r\n    else if(this.count === 3) return this.layoutThree();\r\n    return this.layoutFour();\r\n  }\r\n\r\n  private layoutTwo(): ReturnType<Layouter['layout']> {\r\n    if((this.proportions === 'ww') &&\r\n      (this.averageRatio > 1.4 * this.maxSizeRatio) &&\r\n      (this.ratios[1] - this.ratios[0] < 0.2)) {\r\n      return this.layoutTwoTopBottom();\r\n    } else if(this.proportions === 'ww' || this.proportions === 'qq') {\r\n      return this.layoutTwoLeftRightEqual();\r\n    }\r\n    return this.layoutTwoLeftRight();\r\n  }\r\n\r\n  private layoutThree(): ReturnType<Layouter['layout']> {\r\n    // console.log('layoutThree:', this);\r\n    if(this.proportions[0] === 'n') {\r\n      return this.layoutThreeLeftAndOther();\r\n    }\r\n    return this.layoutThreeTopAndOther();\r\n  }\r\n\r\n  private layoutFour(): ReturnType<Layouter['layout']> {\r\n    if(this.proportions[0] === 'w') {\r\n      return this.layoutFourTopAndOther();\r\n    }\r\n    return this.layoutFourLeftAndOther();\r\n  }\r\n\r\n  private layoutTwoTopBottom(): ReturnType<Layouter['layout']> {\r\n    const width = this.maxWidth;\r\n    const height = Math.round(Math.min(\r\n      width / this.ratios[0],\r\n      Math.min(\r\n        width / this.ratios[1],\r\n        (this.maxHeight - this.spacing) / 2)));\r\n\r\n    return [\r\n      {\r\n        geometry: {x: 0, y: 0, width, height},\r\n        sides: RectPart.Left | RectPart.Top | RectPart.Right\r\n      },\r\n      {\r\n        geometry: {x: 0, y: height + this.spacing, width, height},\r\n        sides: RectPart.Left | RectPart.Bottom | RectPart.Right\r\n      }\r\n    ];\r\n  }\r\n\r\n  private layoutTwoLeftRightEqual(): ReturnType<Layouter['layout']> {\r\n    const width = (this.maxWidth - this.spacing) / 2;\r\n    const height = Math.round(Math.min(\r\n      width / this.ratios[0],\r\n      Math.min(width / this.ratios[1], this.maxHeight * 1)));\r\n\r\n    return [\r\n      {\r\n        geometry: {x: 0, y: 0, width, height},\r\n        sides: RectPart.Top | RectPart.Left | RectPart.Bottom\r\n      },\r\n      {\r\n        geometry: {x: width + this.spacing, y: 0, width, height},\r\n        sides: RectPart.Top | RectPart.Right | RectPart.Bottom\r\n      }\r\n    ];\r\n  }\r\n\r\n  private layoutTwoLeftRight(): ReturnType<Layouter['layout']> {\r\n    const minimalWidth = Math.round(this.minWidth * 1.5);\r\n    const secondWidth = Math.min(\r\n      Math.round(Math.max(\r\n        0.4 * (this.maxWidth - this.spacing),\r\n        (this.maxWidth - this.spacing) / this.ratios[0] /\r\n          (1 / this.ratios[0] + 1 / this.ratios[1]))),\r\n      this.maxWidth - this.spacing - minimalWidth);\r\n    const firstWidth = this.maxWidth -\r\n      secondWidth -\r\n      this.spacing;\r\n    const height = Math.min(\r\n      this.maxHeight,\r\n      Math.round(Math.min(\r\n        firstWidth / this.ratios[0],\r\n        secondWidth / this.ratios[1])));\r\n\r\n    return [\r\n      {\r\n        geometry: {x: 0, y: 0, width: firstWidth, height},\r\n        sides: RectPart.Top | RectPart.Left | RectPart.Bottom\r\n      },\r\n      {\r\n        geometry: {x: firstWidth + this.spacing, y: 0, width: secondWidth, height},\r\n        sides: RectPart.Top | RectPart.Right | RectPart.Bottom\r\n      }\r\n    ];\r\n  }\r\n\r\n  private layoutThreeLeftAndOther(): ReturnType<Layouter['layout']> {\r\n    const firstHeight = this.maxHeight;\r\n    const thirdHeight = Math.round(Math.min(\r\n      (this.maxHeight - this.spacing) / 2.,\r\n      (this.ratios[1] * (this.maxWidth - this.spacing) /\r\n        (this.ratios[2] + this.ratios[1]))));\r\n    const secondHeight = firstHeight -\r\n      thirdHeight -\r\n      this.spacing;\r\n    const rightWidth = Math.max(\r\n      this.minWidth,\r\n      Math.round(Math.min(\r\n        (this.maxWidth - this.spacing) / 2.,\r\n        Math.min(\r\n          thirdHeight * this.ratios[2],\r\n          secondHeight * this.ratios[1]))));\r\n    const leftWidth = Math.min(\r\n      Math.round(firstHeight * this.ratios[0]),\r\n      this.maxWidth - this.spacing - rightWidth);\r\n\r\n    return [\r\n      {\r\n        geometry: {x: 0, y: 0, width: leftWidth, height: firstHeight},\r\n        sides: RectPart.Top | RectPart.Left | RectPart.Bottom\r\n      },\r\n      {\r\n        geometry: {x: leftWidth + this.spacing, y: 0, width: rightWidth, height: secondHeight},\r\n        sides: RectPart.Top | RectPart.Right\r\n      },\r\n      {\r\n        geometry: {x: leftWidth + this.spacing, y: secondHeight + this.spacing, width: rightWidth, height: thirdHeight},\r\n        sides: RectPart.Bottom | RectPart.Right\r\n      }\r\n    ];\r\n  }\r\n\r\n  private layoutThreeTopAndOther(): ReturnType<Layouter['layout']> {\r\n    const firstWidth = this.maxWidth;\r\n    const firstHeight = Math.round(Math.min(\r\n      firstWidth / this.ratios[0],\r\n      (this.maxHeight - this.spacing) * 0.66));\r\n    const secondWidth = (this.maxWidth - this.spacing) / 2;\r\n    const secondHeight = Math.min(\r\n      this.maxHeight - firstHeight - this.spacing,\r\n      Math.round(Math.min(\r\n        secondWidth / this.ratios[1],\r\n        secondWidth / this.ratios[2])));\r\n    const thirdWidth = firstWidth - secondWidth - this.spacing;\r\n\r\n    return [\r\n      {\r\n        geometry: {x: 0, y: 0, width: firstWidth, height: firstHeight},\r\n        sides: RectPart.Left | RectPart.Top | RectPart.Right\r\n      },\r\n      {\r\n        geometry: {x: 0, y: firstHeight + this.spacing, width: secondWidth, height: secondHeight},\r\n        sides: RectPart.Bottom | RectPart.Left\r\n      },\r\n      {\r\n        geometry: {x: secondWidth + this.spacing, y: firstHeight + this.spacing, width: thirdWidth, height: secondHeight},\r\n        sides: RectPart.Bottom | RectPart.Right\r\n      }\r\n    ];\r\n  }\r\n\r\n  private layoutFourTopAndOther(): ReturnType<Layouter['layout']> {\r\n    const w = this.maxWidth;\r\n    const h0 = Math.round(Math.min(\r\n      w / this.ratios[0],\r\n      (this.maxHeight - this.spacing) * 0.66));\r\n    const h = Math.round(\r\n      (this.maxWidth - 2 * this.spacing) /\r\n        (this.ratios[1] + this.ratios[2] + this.ratios[3]));\r\n    const w0 = Math.max(\r\n      this.minWidth,\r\n      Math.round(Math.min(\r\n        (this.maxWidth - 2 * this.spacing) * 0.4,\r\n        h * this.ratios[1])));\r\n    const w2 = Math.round(Math.max(\r\n      Math.max(\r\n        this.minWidth * 1.,\r\n        (this.maxWidth - 2 * this.spacing) * 0.33),\r\n      h * this.ratios[3]));\r\n    const w1 = w - w0 - w2 - 2 * this.spacing;\r\n    const h1 = Math.min(\r\n      this.maxHeight - h0 - this.spacing,\r\n      h);\r\n\r\n    return [\r\n      {\r\n        geometry: {x: 0, y: 0, width: w, height: h0},\r\n        sides: RectPart.Left | RectPart.Top | RectPart.Right\r\n      },\r\n      {\r\n        geometry: {x: 0, y: h0 + this.spacing, width: w0, height: h1},\r\n        sides: RectPart.Bottom | RectPart.Left\r\n      },\r\n      {\r\n        geometry: {x: w0 + this.spacing, y: h0 + this.spacing, width: w1, height: h1},\r\n        sides: RectPart.Bottom\r\n      },\r\n      {\r\n        geometry: {x: w0 + this.spacing + w1 + this.spacing, y: h0 + this.spacing, width: w2, height: h1},\r\n        sides: RectPart.Right | RectPart.Bottom\r\n      }\r\n    ];\r\n  }\r\n\r\n  private layoutFourLeftAndOther(): ReturnType<Layouter['layout']> {\r\n    const h = this.maxHeight;\r\n    const w0 = Math.round(Math.min(\r\n      h * this.ratios[0],\r\n      (this.maxWidth - this.spacing) * 0.6));\r\n\r\n    const w = Math.round(\r\n      (this.maxHeight - 2 * this.spacing) /\r\n        (1. / this.ratios[1] + 1. / this.ratios[2] + 1. / this.ratios[3])\r\n    );\r\n    const h0 = Math.round(w / this.ratios[1]);\r\n    const h1 = Math.round(w / this.ratios[2]);\r\n    const h2 = h - h0 - h1 - 2 * this.spacing;\r\n    const w1 = Math.max(\r\n      this.minWidth,\r\n      Math.min(this.maxWidth - w0 - this.spacing, w));\r\n\r\n    return [\r\n      {\r\n        geometry: {x: 0, y: 0, width: w0, height: h},\r\n        sides: RectPart.Top | RectPart.Left | RectPart.Bottom\r\n      },\r\n      {\r\n        geometry: {x: w0 + this.spacing, y: 0, width: w1, height: h0},\r\n        sides: RectPart.Top | RectPart.Right\r\n      },\r\n      {\r\n        geometry: {x: w0 + this.spacing, y: h0 + this.spacing, width: w1, height: h1},\r\n        sides: RectPart.Right\r\n      },\r\n      {\r\n        geometry: {x: w0 + this.spacing, y: h0 + h1 + 2 * this.spacing, width: w1, height: h2},\r\n        sides: RectPart.Bottom | RectPart.Right\r\n      }\r\n    ];\r\n  }\r\n\r\n  private static countRatios(sizes: Size[]) {\r\n    return sizes.map((size) => size.w / size.h);\r\n  }\r\n\r\n  private static countProportions(ratios: number[]) {\r\n    return ratios.map((ratio) => (ratio > 1.2) ? 'w' : (ratio < 0.8) ? 'n' : 'q').join('');\r\n  }\r\n}\r\n\r\nclass ComplexLayouter {\r\n  private ratios: number[];\r\n  private count: number;\r\n\r\n  constructor(ratios: number[], private averageRatio: number, private maxWidth: number, private minWidth: number, private spacing: number, private maxHeight = maxWidth * 4 / 3) {\r\n    this.ratios = ComplexLayouter.cropRatios(ratios, averageRatio);\r\n    this.count = ratios.length;\r\n  }\r\n\r\n  private static cropRatios(ratios: number[], averageRatio: number) {\r\n    const kMaxRatio = 2.75;\r\n    const kMinRatio = 0.6667;\r\n    return ratios.map((ratio) => {\r\n      return averageRatio > 1.1 ?\r\n        clamp(ratio, 1., kMaxRatio) :\r\n        clamp(ratio, kMinRatio, 1.);\r\n    });\r\n  }\r\n\r\n  public layout(): GroupMediaLayout[] {\r\n    const result = new Array<GroupMediaLayout>(this.count);\r\n\r\n    const attempts: Attempt[] = [];\r\n    const multiHeight = (offset: number, count: number) => {\r\n      const ratios = this.ratios.slice(offset, offset + count); // warn\r\n      const sum = accumulate(ratios, 0);\r\n      return (this.maxWidth - (count - 1) * this.spacing) / sum;\r\n    };\r\n    const pushAttempt = (lineCounts: number[]) => {\r\n      const heights: number[] = [];\r\n      let offset = 0;\r\n      for(const count of lineCounts) {\r\n        heights.push(multiHeight(offset, count));\r\n        offset += count;\r\n      }\r\n      attempts.push({lineCounts, heights}); // warn\r\n    };\r\n\r\n    for(let first = 1; first !== this.count; ++first) {\r\n      const second = this.count - first;\r\n      if(first > 3 || second > 3) {\r\n        continue;\r\n      }\r\n      pushAttempt([first, second]);\r\n    }\r\n    for(let first = 1; first !== this.count - 1; ++first) {\r\n      for(let second = 1; second !== this.count - first; ++second) {\r\n        const third = this.count - first - second;\r\n        if((first > 3) ||\r\n          (second > ((this.averageRatio < 0.85) ? 4 : 3)) ||\r\n          (third > 3)) {\r\n          continue;\r\n        }\r\n        pushAttempt([first, second, third]);\r\n      }\r\n    }\r\n    for(let first = 1; first !== this.count - 1; ++first) {\r\n      for(let second = 1; second !== this.count - first; ++second) {\r\n        for(let third = 1; third !== this.count - first - second; ++third) {\r\n          const fourth = this.count - first - second - third;\r\n          if(first > 3 || second > 3 || third > 3 || fourth > 3) {\r\n            continue;\r\n          }\r\n          pushAttempt([first, second, third, fourth]);\r\n        }\r\n      }\r\n    }\r\n\r\n    let optimalAttempt: Attempt = null;\r\n    let optimalDiff = 0;\r\n    for(const attempt of attempts) {\r\n      const {heights, lineCounts: counts} = attempt;\r\n      const lineCount = counts.length;\r\n      const totalHeight = accumulate(heights, 0) +\r\n        this.spacing * (lineCount - 1);\r\n      const minLineHeight = Math.min(...heights);\r\n      const maxLineHeight = Math.max(...heights);\r\n      const bad1 = (minLineHeight < this.minWidth) ? 1.5 : 1;\r\n      const bad2 = (() => {\r\n        for(let line = 1; line !== lineCount; ++line) {\r\n          if(counts[line - 1] > counts[line]) {\r\n            return 1.5;\r\n          }\r\n        }\r\n        return 1.;\r\n      })();\r\n      const diff = Math.abs(totalHeight - this.maxHeight) * bad1 * bad2;\r\n      if(!optimalAttempt || diff < optimalDiff) {\r\n        optimalAttempt = attempt;\r\n        optimalDiff = diff;\r\n      }\r\n    }\r\n\r\n    const optimalCounts = optimalAttempt.lineCounts;\r\n    const optimalHeights = optimalAttempt.heights;\r\n    const rowCount = optimalCounts.length;\r\n\r\n    let index = 0;\r\n    let y = 0;\r\n    for(let row = 0; row !== rowCount; ++row) {\r\n      const colCount = optimalCounts[row];\r\n      const lineHeight = optimalHeights[row];\r\n      const height = Math.round(lineHeight);\r\n\r\n      let x = 0;\r\n      for(let col = 0; col !== colCount; ++col) {\r\n        const sides = RectPart.None |\r\n          (row === 0 ? RectPart.Top : RectPart.None) |\r\n          (row === rowCount - 1 ? RectPart.Bottom : RectPart.None) |\r\n          (col === 0 ? RectPart.Left : RectPart.None) |\r\n          (col === colCount - 1 ? RectPart.Right : RectPart.None);\r\n\r\n        const ratio = this.ratios[index];\r\n        const width = (col === colCount - 1) ?\r\n          (this.maxWidth - x) :\r\n          Math.round(ratio * lineHeight);\r\n        result[index] = {\r\n          geometry: {x, y, width, height},\r\n          sides\r\n        };\r\n\r\n        x += width + this.spacing;\r\n        ++index;\r\n      }\r\n      y += height + this.spacing;\r\n    }\r\n\r\n    return result;\r\n  }\r\n}\r\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport {Layouter, RectPart} from './groupedLayout';\n\nexport default function prepareAlbum(options: {\n  container: HTMLElement,\n  items: {w: number, h: number}[],\n  maxWidth: number,\n  minWidth: number,\n  spacing: number,\n  maxHeight?: number,\n  forMedia?: true\n}) {\n  const layouter = new Layouter(options.items, options.maxWidth, options.minWidth, options.spacing, options.maxHeight);\n  const layout = layouter.layout();\n\n  const widthItem = layout.find((item) => item.sides & RectPart.Right);\n  const width = widthItem.geometry.width + widthItem.geometry.x;\n\n  const heightItem = layout.find((item) => item.sides & RectPart.Bottom);\n  const height = heightItem.geometry.height + heightItem.geometry.y;\n\n  const container = options.container;\n  container.style.width = width + 'px';\n  container.style.height = height + 'px';\n  const children = container.children;\n\n  layout.forEach(({geometry, sides}, idx) => {\n    let div: HTMLElement;\n    div = children[idx] as HTMLElement;\n    if(!div) {\n      div = document.createElement('div');\n      container.append(div);\n    }\n\n    div.classList.add('album-item', 'grouped-item');\n\n    div.style.width = (geometry.width / width * 100) + '%';\n    div.style.height = (geometry.height / height * 100) + '%';\n    div.style.top = (geometry.y / height * 100) + '%';\n    div.style.left = (geometry.x / width * 100) + '%';\n\n    if(sides & RectPart.Left && sides & RectPart.Top) {\n      div.style.borderTopLeftRadius = 'inherit';\n    }\n\n    if(sides & RectPart.Left && sides & RectPart.Bottom) {\n      div.style.borderBottomLeftRadius = 'inherit';\n    }\n\n    if(sides & RectPart.Right && sides & RectPart.Top) {\n      div.style.borderTopRightRadius = 'inherit';\n    }\n\n    if(sides & RectPart.Right && sides & RectPart.Bottom) {\n      div.style.borderBottomRightRadius = 'inherit';\n    }\n\n    if(options.forMedia) {\n      const mediaDiv = document.createElement('div');\n      mediaDiv.classList.add('album-item-media');\n\n      div.append(mediaDiv);\n    }\n\n    // @ts-ignore\n    // div.style.backgroundColor = '#' + Math.floor(Math.random() * (2 ** 24 - 1)).toString(16).padStart(6, '0');\n  });\n\n  /* if(options.forMedia) {\n    layout.forEach((_, i) => {\n      const mediaDiv = document.createElement('div');\n      mediaDiv.classList.add('album-item-media');\n\n      options.container.children[i].append(mediaDiv);\n    });\n  } */\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport getPreviewURLFromBytes from '../helpers/bytes/getPreviewURLFromBytes';\nimport {renderImageFromUrlPromise} from '../helpers/dom/renderImageFromUrl';\nimport replaceContent from '../helpers/dom/replaceContent';\nimport setInnerHTML from '../helpers/dom/setInnerHTML';\nimport {recordPromise} from '../helpers/recordPromise';\nimport sequentialDom from '../helpers/sequentialDom';\nimport {UserProfilePhoto, ChatPhoto} from '../layer';\nimport type {PeerPhotoSize} from '../lib/appManagers/appAvatarsManager';\nimport getPeerColorById from '../lib/appManagers/utils/peers/getPeerColorById';\nimport {NULL_PEER_ID, REPLIES_PEER_ID} from '../lib/mtproto/mtproto_config';\nimport getAbbreviation from '../lib/richTextProcessor/getAbbreviation';\nimport rootScope from '../lib/rootScope';\nimport getPeerInitials from './wrappers/getPeerInitials';\n\nexport async function putAvatar(\n  div: HTMLElement,\n  peerId: PeerId,\n  photo: UserProfilePhoto.userProfilePhoto | ChatPhoto.chatPhoto,\n  size: PeerPhotoSize,\n  img = new Image(),\n  onlyThumb = false\n) {\n  const r = await rootScope.managers.acknowledged.appAvatarsManager.loadAvatar(peerId, photo, size);\n  const loadPromise = r.result;\n  const cached = r.cached;\n\n  img.classList.add('avatar-photo');\n\n  let renderThumbPromise: Promise<void>;\n  let callback: () => void;\n  let thumbImage: HTMLImageElement;\n  if(cached) {\n    //   misc.ts: renderImageFromUrl\n    callback = () => {\n      replaceContent(div, img);\n      div.dataset.color = '';\n    };\n  } else {\n    const animate = rootScope.settings.animationsEnabled;\n    if(animate) {\n      img.classList.add('fade-in');\n    }\n\n    let isFullLoaded = false;\n    if(size === 'photo_big') { // let's load small photo first\n      const res = await putAvatar(div, peerId, photo, 'photo_small');\n      renderThumbPromise = res.loadPromise;\n      thumbImage = res.thumbImage;\n    } else if(photo.stripped_thumb) {\n      thumbImage = new Image();\n      div.classList.add('avatar-relative');\n      thumbImage.classList.add('avatar-photo', 'avatar-photo-thumbnail');\n      const url = getPreviewURLFromBytes(photo.stripped_thumb);\n      renderThumbPromise = renderImageFromUrlPromise(thumbImage, url).then(() => {\n        if(isFullLoaded) {\n          return;\n        }\n\n        replaceContent(div, thumbImage);\n      });\n    }\n\n    callback = () => {\n      isFullLoaded = true;\n\n      if(thumbImage) {\n        div.append(img);\n      } else {\n        replaceContent(div, img);\n      }\n\n      setTimeout(() => {\n        if(div.childElementCount) {\n          sequentialDom.mutateElement(img, () => {\n            div.dataset.color = '';\n\n            if(animate) {\n              img.classList.remove('fade-in');\n            }\n\n            if(thumbImage) {\n              thumbImage.remove();\n            }\n          });\n        }\n      }, animate ? 200 : 0);\n    };\n  }\n\n  const renderPromise = loadPromise\n  .then((url) => renderImageFromUrlPromise(img, url/* , !cached */))\n  .then(callback);\n\n  await (renderThumbPromise || renderPromise);\n\n  return {\n    cached,\n    loadPromise: renderThumbPromise || renderPromise,\n    thumbImage\n  };\n}\n\nfunction set(\n  div: HTMLElement,\n  innerHTML: Parameters<typeof setInnerHTML>[1],\n  color: string,\n  icon: string\n) {\n  setInnerHTML(div, innerHTML);\n  div.dataset.color = color;\n  div.classList.remove('tgico-saved', 'tgico-deletedaccount', 'tgico-reply_filled');\n  icon && div.classList.add(icon);\n}\n\n// peerId === peerId || title\nexport default async function putPhoto(\n  div: HTMLElement,\n  peerId: PeerId,\n  isDialog = false,\n  title = '',\n  onlyThumb = false,\n  isBig?: boolean\n) {\n  const myId = rootScope.myId;\n\n  if(peerId === myId && isDialog) {\n    set(div, '', '', 'tgico-saved');\n    return;\n  }\n\n  const managers = rootScope.managers;\n\n  if(peerId !== NULL_PEER_ID && peerId.isUser()) {\n    const user = await managers.appUsersManager.getUser(peerId);\n    if(user && user.pFlags && user.pFlags.deleted) {\n      set(div, '', getPeerColorById(peerId), 'tgico-deletedaccount');\n      return;\n    }\n  }\n\n  const size: PeerPhotoSize = isBig ? 'photo_big' : 'photo_small';\n  const photo = await managers.appPeersManager.getPeerPhoto(peerId);\n  const avatarAvailable = !!photo;\n  const avatarRendered = !!div.firstElementChild && !(div.firstElementChild as HTMLElement).classList.contains('emoji');\n  if(!avatarAvailable || !avatarRendered || !(await managers.appAvatarsManager.isAvatarCached(peerId, size))) {\n    let color = '';\n    if(peerId && (peerId !== myId || !isDialog)) {\n      color = getPeerColorById(peerId);\n    }\n\n    if(peerId === REPLIES_PEER_ID) {\n      set(div, '', color, 'tgico-reply_filled');\n      return;\n    }\n\n    const abbr = await (title ? getAbbreviation(title) : getPeerInitials(peerId, managers));\n    set(div, abbr, color, '');\n    // return Promise.resolve(true);\n  }\n\n  if(avatarAvailable/*  && false */) {\n    const promise = putAvatar(div, peerId, photo, size, undefined, onlyThumb);\n    // recordPromise(promise, 'putAvatar-' + peerId);\n    return promise;\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport {Chat, User} from '../../layer';\nimport getAbbreviation from '../../lib/richTextProcessor/getAbbreviation';\nimport rootScope from '../../lib/rootScope';\n\nexport default async function getPeerInitials(peerId: PeerId, managers = rootScope.managers) {\n  const peer: Chat | User = await managers.appPeersManager.getPeer(peerId);\n  return getAbbreviation(\n    (peer as Chat.chat).title ?? [(peer as User.user).first_name, (peer as User.user).last_name].filter(Boolean).join(' ')\n  );\n}\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport {MOUNT_CLASS_TO} from '../config/debug';\r\n\r\nexport function putPreloader(elem: Element, returnDiv = false): HTMLElement {\r\n  const html = `\r\n  <svg xmlns=\"http://www.w3.org/2000/svg\" class=\"preloader-circular\" viewBox=\"25 25 50 50\">\r\n  <circle class=\"preloader-path\" cx=\"50\" cy=\"50\" r=\"20\" fill=\"none\" stroke-miterlimit=\"10\"/>\r\n  </svg>`;\r\n\r\n  if(returnDiv) {\r\n    const div = document.createElement('div');\r\n    div.classList.add('preloader');\r\n    div.innerHTML = html;\r\n\r\n    if(elem) {\r\n      elem.appendChild(div);\r\n    }\r\n\r\n    return div;\r\n  }\r\n\r\n  elem.insertAdjacentHTML('beforeend', html);\r\n  return elem.lastElementChild as HTMLElement;\r\n}\r\n\r\nMOUNT_CLASS_TO.putPreloader = putPreloader;\r\n\r\nexport function setButtonLoader(elem: HTMLButtonElement, icon = 'check') {\r\n  elem.classList.remove('tgico-' + icon);\r\n  elem.disabled = true;\r\n  putPreloader(elem);\r\n\r\n  return () => {\r\n    elem.innerHTML = '';\r\n    elem.classList.add('tgico-' + icon);\r\n    elem.removeAttribute('disabled');\r\n  };\r\n}\r\n\r\n/* export function parseMenuButtonsTo(to: {[name: string]: HTMLElement}, elements: HTMLCollection | NodeListOf<HTMLElement>) {\r\n  Array.from(elements).forEach((el) => {\r\n    const match = el.className.match(/(?:^|\\s)menu-(.+?)(?:$|\\s)/);\r\n    if(!match) return;\r\n    to[match[1]] = el as HTMLElement;\r\n  });\r\n} */\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport getDeepProperty from '../helpers/object/getDeepProperty';\r\nimport {LangPackKey, _i18n} from '../lib/langPack';\r\nimport apiManagerProxy from '../lib/mtproto/mtprotoworker';\r\nimport rootScope from '../lib/rootScope';\r\n\r\nexport default class RadioField {\r\n  public input: HTMLInputElement;\r\n  public label: HTMLLabelElement;\r\n  public main: HTMLElement;\r\n\r\n  constructor(options: {\r\n    text?: string,\r\n    langKey?: LangPackKey,\r\n    name: string,\r\n    value?: string,\r\n    stateKey?: string,\r\n    alignRight?: boolean\r\n  }) {\r\n    const label = this.label = document.createElement('label');\r\n    label.classList.add('radio-field');\r\n\r\n    if(options.alignRight) {\r\n      label.classList.add('radio-field-right');\r\n    }\r\n\r\n    const input = this.input = document.createElement('input');\r\n    input.type = 'radio';\r\n    /* input.id =  */input.name = 'input-radio-' + options.name;\r\n\r\n    if(options.value) {\r\n      input.value = options.value;\r\n\r\n      if(options.stateKey) {\r\n        apiManagerProxy.getState().then((state) => {\r\n          input.checked = getDeepProperty(state, options.stateKey) === options.value;\r\n        });\r\n\r\n        input.addEventListener('change', () => {\r\n          rootScope.managers.appStateManager.setByKey(options.stateKey, options.value);\r\n        });\r\n      }\r\n    }\r\n\r\n    const main = this.main = document.createElement('div');\r\n    main.classList.add('radio-field-main');\r\n\r\n    if(options.text) {\r\n      main.innerHTML = options.text;\r\n      /* const caption = document.createElement('div');\r\n      caption.classList.add('radio-field-main-caption');\r\n      caption.innerHTML = text;\r\n\r\n      if(subtitle) {\r\n        label.classList.add('radio-field-with-subtitle');\r\n        caption.insertAdjacentHTML('beforeend', `<div class=\"radio-field-main-subtitle\">${subtitle}</div>`);\r\n      }\r\n\r\n      main.append(caption); */\r\n    } else if(options.langKey) {\r\n      _i18n(main, options.langKey);\r\n    }\r\n\r\n    label.append(input, main);\r\n  }\r\n\r\n  get checked() {\r\n    return this.input.checked;\r\n  }\r\n\r\n  set checked(checked: boolean) {\r\n    this.setValueSilently(checked);\r\n\r\n    const event = new Event('change', {bubbles: true, cancelable: true});\r\n    this.input.dispatchEvent(event);\r\n  }\r\n\r\n  public setValueSilently(checked: boolean) {\r\n    this.input.checked = checked;\r\n  }\r\n};\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nexport default function RadioForm(radios: {container: HTMLElement, input: HTMLInputElement}[], onChange: (value: string, event: Event) => void) {\r\n  const form = document.createElement('form');\r\n\r\n  radios.forEach((r) => {\r\n    const {container, input} = r;\r\n    form.append(container);\r\n    input.addEventListener('change', (e) => {\r\n      if(input.checked) {\r\n        onChange(input.value, e);\r\n      }\r\n    });\r\n  });\r\n\r\n  return form;\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport attachGrabListeners, {GrabEvent} from '../helpers/dom/attachGrabListeners';\r\nimport clamp from '../helpers/number/clamp';\r\nimport safeAssign from '../helpers/object/safeAssign';\r\n\r\nexport default class RangeSelector {\r\n  public container: HTMLDivElement;\r\n  protected filled: HTMLDivElement;\r\n  protected seek: HTMLInputElement;\r\n\r\n  public mousedown = false;\r\n  protected rect: DOMRect;\r\n  protected _removeListeners: () => void;\r\n\r\n  private events: Partial<{\r\n    // onMouseMove: ProgressLine['onMouseMove'],\r\n    onMouseDown: RangeSelector['onMouseDown'],\r\n    onMouseUp: RangeSelector['onMouseUp'],\r\n    onScrub: (value: number) => void\r\n  }> = {};\r\n\r\n  protected decimals: number;\r\n\r\n  protected step: number;\r\n  protected min: number;\r\n  protected max: number;\r\n  protected withTransition = false;\r\n  protected useTransform = false;\r\n  protected vertical = false;\r\n\r\n  constructor(\r\n    options: {\r\n      step: RangeSelector['step'],\r\n      min: RangeSelector['min'],\r\n      max: RangeSelector['max'],\r\n      withTransition?: RangeSelector['withTransition'],\r\n      useTransform?: RangeSelector['useTransform'],\r\n      vertical?: RangeSelector['vertical']\r\n    },\r\n    value = 0\r\n  ) {\r\n    safeAssign(this, options);\r\n\r\n    this.container = document.createElement('div');\r\n    this.container.classList.add('progress-line');\r\n\r\n    // there is no sense in using transition with transform, because it is updating every frame\r\n    if(this.useTransform) {\r\n      this.container.classList.add('use-transform');\r\n    } else if(this.withTransition) {\r\n      this.container.classList.add('with-transition');\r\n    }\r\n\r\n    this.filled = document.createElement('div');\r\n    this.filled.classList.add('progress-line__filled');\r\n\r\n    const seek = this.seek = document.createElement('input');\r\n    seek.classList.add('progress-line__seek');\r\n    // seek.setAttribute('max', '0');\r\n    seek.type = 'range';\r\n    seek.step = '' + this.step;\r\n    seek.min = '' + this.min;\r\n    seek.max = '' + this.max;\r\n    seek.value = '' + value;\r\n\r\n    if(value) {\r\n      this.setProgress(value);\r\n    }\r\n\r\n    const stepStr = '' + this.step;\r\n    const index = stepStr.indexOf('.');\r\n    this.decimals = index === -1 ? 0 : stepStr.length - index - 1;\r\n\r\n    // this.setListeners();\r\n\r\n    this.container.append(this.filled, seek);\r\n  }\r\n\r\n  get value() {\r\n    return +this.seek.value;\r\n  }\r\n\r\n  public setHandlers(events: RangeSelector['events']) {\r\n    this.events = events;\r\n  }\r\n\r\n  protected onMouseMove = (event: GrabEvent) => {\r\n    this.scrub(event);\r\n  };\r\n\r\n  protected onMouseDown = (event: GrabEvent) => {\r\n    this.rect = this.container.getBoundingClientRect();\r\n    this.mousedown = true;\r\n    this.scrub(event);\r\n    this.container.classList.add('is-focused');\r\n    this.events?.onMouseDown && this.events.onMouseDown(event);\r\n  };\r\n\r\n  protected onMouseUp = (event: GrabEvent) => {\r\n    this.mousedown = false;\r\n    this.container.classList.remove('is-focused');\r\n    this.events?.onMouseUp && this.events.onMouseUp(event);\r\n  };\r\n\r\n  public setListeners() {\r\n    this.seek.addEventListener('input', this.onInput);\r\n    this._removeListeners = attachGrabListeners(this.container, this.onMouseDown, this.onMouseMove, this.onMouseUp);\r\n  }\r\n\r\n  public onInput = () => {\r\n    const value = +this.seek.value;\r\n    this.setFilled(value);\r\n    this.events?.onScrub && this.events.onScrub(value);\r\n  };\r\n\r\n  public setProgress(value: number) {\r\n    this.seek.value = '' + value;\r\n    this.setFilled(+this.seek.value); // clamp\r\n  }\r\n\r\n  public addProgress(value: number) {\r\n    this.seek.value = '' + (+this.seek.value + value);\r\n    this.setFilled(+this.seek.value); // clamp\r\n  }\r\n\r\n  public setFilled(value: number) {\r\n    let percents = (value - this.min) / (this.max - this.min);\r\n    percents = clamp(percents, 0, 1);\r\n\r\n    // using scaleX and width even with vertical because it will be rotated\r\n    if(this.useTransform) {\r\n      this.filled.style.transform = `scaleX(${percents})`;\r\n    } else {\r\n      this.filled.style.width = (percents * 100) + '%';\r\n    }\r\n  }\r\n\r\n  protected scrub(event: GrabEvent) {\r\n    const rectMax = this.vertical ? this.rect.height : this.rect.width;\r\n    const offsetAxisValue = clamp(this.vertical ? -(event.y - this.rect.bottom) : event.x - this.rect.left, 0, rectMax);\r\n\r\n    let value = this.min + (offsetAxisValue / rectMax * (this.max - this.min));\r\n\r\n    if((value - this.min) < ((this.max - this.min) / 2)) {\r\n      value -= this.step / 10;\r\n    }\r\n\r\n    value = +value.toFixed(this.decimals);\r\n    value = clamp(value, this.min, this.max);\r\n\r\n    // this.seek.value = '' + value;\r\n    // this.onInput();\r\n\r\n    this.setProgress(value);\r\n    this.events?.onScrub && this.events.onScrub(value);\r\n\r\n    return value;\r\n  }\r\n\r\n  public removeListeners() {\r\n    if(this._removeListeners) {\r\n      this._removeListeners();\r\n      this._removeListeners = null;\r\n    }\r\n\r\n    this.seek.removeEventListener('input', this.onInput);\r\n\r\n    this.events = {};\r\n  }\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport findUpClassName from '../helpers/dom/findUpClassName';\r\nimport sequentialDom from '../helpers/sequentialDom';\r\nimport IS_TOUCH_SUPPORTED from '../environment/touchSupport';\r\nimport rootScope from '../lib/rootScope';\r\nimport findUpAsChild from '../helpers/dom/findUpAsChild';\r\n\r\nlet rippleClickId = 0;\r\nexport default function ripple(\r\n  elem: HTMLElement,\r\n  callback: (id: number) => Promise<boolean | void> = () => Promise.resolve(),\r\n  onEnd: (id: number) => void = null,\r\n  prepend = false,\r\n  attachListenerTo = elem\r\n) {\r\n  // return;\r\n  if(elem.querySelector('.c-ripple')) return;\r\n  elem.classList.add('rp');\r\n\r\n  const r = document.createElement('div');\r\n  r.classList.add('c-ripple');\r\n\r\n  const isSquare = elem.classList.contains('rp-square');\r\n  if(isSquare) {\r\n    r.classList.add('is-square');\r\n  }\r\n\r\n  elem[prepend ? 'prepend' : 'append'](r);\r\n\r\n  let handler: () => void;\r\n  // let animationEndPromise: Promise<number>;\r\n  const drawRipple = (clientX: number, clientY: number) => {\r\n    const startTime = Date.now();\r\n    const elem = document.createElement('div');\r\n\r\n    const clickId = rippleClickId++;\r\n\r\n    // console.log('ripple drawRipple');\r\n\r\n    const duration = +window.getComputedStyle(r).getPropertyValue('--ripple-duration').replace('s', '') * 1000;\r\n    // console.log('ripple duration', duration);\r\n\r\n    handler = () => {\r\n    // handler = () => animationEndPromise.then((duration) => {\r\n      // console.log('ripple animation was:', duration);\r\n\r\n      // const duration = isSquare || mediaSizes.isMobile ? 200 : 700;\r\n      // return;\r\n      const elapsedTime = Date.now() - startTime;\r\n      const cb = () => {\r\n        // console.log('ripple elapsedTime total pre-remove:', Date.now() - startTime);\r\n        sequentialDom.mutate(() => {\r\n          elem.remove();\r\n        });\r\n\r\n        if(onEnd) onEnd(clickId);\r\n      };\r\n      if(elapsedTime < duration) {\r\n        const delay = Math.max(duration - elapsedTime, duration / 2);\r\n        setTimeout(() => elem.classList.add('hiding'), Math.max(delay - duration / 2, 0));\r\n\r\n        setTimeout(cb, delay);\r\n      } else {\r\n        elem.classList.add('hiding');\r\n        setTimeout(cb, duration / 2);\r\n      }\r\n\r\n      if(!IS_TOUCH_SUPPORTED) {\r\n        window.removeEventListener('contextmenu', handler);\r\n      }\r\n\r\n      handler = null;\r\n      touchStartFired = false;\r\n    };\r\n    // });\r\n\r\n    callback && callback(clickId);\r\n\r\n    /* callback().then((bad) => {\r\n      if(bad) {\r\n        span.remove();\r\n        return;\r\n      } */\r\n\r\n    // console.log('ripple after promise', Date.now() - startTime);\r\n    // console.log('ripple tooSlow:', tooSlow);\r\n    /* if(tooSlow) {\r\n        span.remove();\r\n        return;\r\n      } */\r\n\r\n    window.requestAnimationFrame(() => {\r\n      const rect = r.getBoundingClientRect();\r\n      elem.classList.add('c-ripple__circle');\r\n\r\n      const clickX = clientX - rect.left;\r\n      const clickY = clientY - rect.top;\r\n\r\n      const radius = Math.sqrt((Math.abs(clickY - rect.height / 2) + rect.height / 2) ** 2 + (Math.abs(clickX - rect.width / 2) + rect.width / 2) ** 2);\r\n      const size = radius;\r\n\r\n      // center of circle\r\n      const x = clickX - size / 2;\r\n      const y = clickY - size / 2;\r\n\r\n      // console.log('ripple click', offsetFromCenter, size, clickX, clickY);\r\n\r\n      elem.style.width = elem.style.height = size + 'px';\r\n      elem.style.left = x + 'px';\r\n      elem.style.top = y + 'px';\r\n\r\n      //     \r\n      /* animationEndPromise = new Promise((resolve) => {\r\n          span.addEventListener('animationend', () => {\r\n            // 713 -> 700\r\n            resolve(((Date.now() - startTime) / 100 | 0) * 100);\r\n          }, {once: true});\r\n        }); */\r\n\r\n      //             \r\n      /* span.style.display = 'none';\r\n        r.append(span);\r\n        duration = +window.getComputedStyle(span).getPropertyValue('animation-duration').replace('s', '') * 1000;\r\n        span.style.display = ''; */\r\n\r\n      r.append(elem);\r\n\r\n      // r.classList.add('active');\r\n      // handler();\r\n    });\r\n    // });\r\n  };\r\n\r\n  const isRippleUnneeded = (e: Event) => e.target !== elem && (\r\n    ['BUTTON', 'A'].includes((e.target as HTMLElement).tagName) ||\r\n      findUpClassName(e.target as HTMLElement, 'c-ripple') !== r\r\n  ) && (\r\n    attachListenerTo === elem ||\r\n      !findUpAsChild(e.target as HTMLElement, attachListenerTo)\r\n  );\r\n\r\n  // TODO: rename this variable\r\n  let touchStartFired = false;\r\n  if(IS_TOUCH_SUPPORTED) {\r\n    const touchEnd = () => {\r\n      handler && handler();\r\n    };\r\n\r\n    attachListenerTo.addEventListener('touchstart', (e) => {\r\n      if(!rootScope.settings.animationsEnabled) {\r\n        return;\r\n      }\r\n\r\n      // console.log('ripple touchstart', e);\r\n      if(e.touches.length > 1 || touchStartFired || isRippleUnneeded(e)) {\r\n        return;\r\n      }\r\n\r\n      // console.log('touchstart', e);\r\n      touchStartFired = true;\r\n\r\n      const {clientX, clientY} = e.touches[0];\r\n      drawRipple(clientX, clientY);\r\n      attachListenerTo.addEventListener('touchend', touchEnd, {once: true});\r\n\r\n      window.addEventListener('touchmove', (e) => {\r\n        e.cancelBubble = true;\r\n        e.stopPropagation();\r\n        touchEnd();\r\n        attachListenerTo.removeEventListener('touchend', touchEnd);\r\n      }, {once: true});\r\n    }, {passive: true});\r\n  } else {\r\n    attachListenerTo.addEventListener('mousedown', (e) => {\r\n      if(![0, 2].includes(e.button)) { // only left and right buttons\r\n        return;\r\n      }\r\n\r\n      if(!rootScope.settings.animationsEnabled) {\r\n        return;\r\n      }\r\n      // console.log('ripple mousedown', e, e.target, findUpClassName(e.target as HTMLElement, 'c-ripple') === r);\r\n\r\n      if(attachListenerTo.dataset.ripple === '0' || isRippleUnneeded(e)) {\r\n        return;\r\n      } else if(touchStartFired) {\r\n        touchStartFired = false;\r\n        return;\r\n      }\r\n\r\n      const {clientX, clientY} = e;\r\n      drawRipple(clientX, clientY);\r\n      window.addEventListener('mouseup', handler, {once: true, passive: true});\r\n      window.addEventListener('contextmenu', handler, {once: true, passive: true});\r\n    }, {passive: true});\r\n  }\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport CheckboxField from './checkboxField';\r\nimport RadioField from './radioField';\r\nimport ripple from './ripple';\r\nimport {SliderSuperTab} from './slider';\r\nimport RadioForm from './radioForm';\r\nimport {i18n, LangPackKey} from '../lib/langPack';\r\nimport replaceContent from '../helpers/dom/replaceContent';\r\nimport setInnerHTML from '../helpers/dom/setInnerHTML';\r\nimport {attachClickEvent} from '../helpers/dom/clickEvent';\r\nimport ListenerSetter from '../helpers/listenerSetter';\r\nimport Button from './button';\r\n\r\nexport default class Row {\r\n  public container: HTMLElement;\r\n  public title: HTMLDivElement;\r\n  public titleRight: HTMLElement;\r\n  public subtitle: HTMLElement;\r\n  public media: HTMLElement;\r\n\r\n  public checkboxField: CheckboxField;\r\n  public radioField: RadioField;\r\n\r\n  public freezed = false;\r\n\r\n  public buttonRight: HTMLElement;\r\n\r\n  constructor(options: Partial<{\r\n    icon: string,\r\n    subtitle: string | HTMLElement | DocumentFragment,\r\n    subtitleLangKey: LangPackKey,\r\n    subtitleLangArgs: any[],\r\n    radioField: Row['radioField'],\r\n    checkboxField: Row['checkboxField'],\r\n    noCheckboxSubtitle: boolean,\r\n    title: string | HTMLElement | DocumentFragment,\r\n    titleLangKey: LangPackKey,\r\n    titleRight: string | HTMLElement,\r\n    titleRightSecondary: string | HTMLElement,\r\n    clickable: boolean | ((e: Event) => void),\r\n    navigationTab: SliderSuperTab,\r\n    havePadding: boolean,\r\n    noRipple: boolean,\r\n    noWrap: boolean,\r\n    listenerSetter: ListenerSetter,\r\n    buttonRight?: HTMLElement | boolean,\r\n    buttonRightLangKey: LangPackKey\r\n  }> = {}) {\r\n    this.container = document.createElement(options.radioField || options.checkboxField ? 'label' : 'div');\r\n    this.container.classList.add('row');\r\n\r\n    this.subtitle = document.createElement('div');\r\n    this.subtitle.classList.add('row-subtitle');\r\n    this.subtitle.setAttribute('dir', 'auto');\r\n    if(options.subtitle) {\r\n      if(typeof(options.subtitle) === 'string') {\r\n        setInnerHTML(this.subtitle, options.subtitle);\r\n      } else {\r\n        this.subtitle.append(options.subtitle);\r\n      }\r\n    } else if(options.subtitleLangKey) {\r\n      this.subtitle.append(i18n(options.subtitleLangKey, options.subtitleLangArgs));\r\n    }\r\n    this.container.append(this.subtitle);\r\n\r\n    let havePadding = !!options.havePadding;\r\n    if(options.radioField || options.checkboxField) {\r\n      if(options.radioField) {\r\n        this.radioField = options.radioField;\r\n        this.container.append(this.radioField.label);\r\n        havePadding = true;\r\n      }\r\n\r\n      if(options.checkboxField) {\r\n        this.checkboxField = options.checkboxField;\r\n\r\n        const isToggle = options.checkboxField.label.classList.contains('checkbox-field-toggle');\r\n        if(isToggle) {\r\n          this.container.classList.add('row-with-toggle');\r\n          options.titleRight = this.checkboxField.label;\r\n        } else {\r\n          havePadding = true;\r\n          this.container.append(this.checkboxField.label);\r\n        }\r\n\r\n        if(!options.noCheckboxSubtitle && !isToggle) {\r\n          const onChange = () => {\r\n            replaceContent(this.subtitle, i18n(this.checkboxField.input.checked ? 'Checkbox.Enabled' : 'Checkbox.Disabled'));\r\n          };\r\n\r\n          if(options.listenerSetter) options.listenerSetter.add(this.checkboxField.input)('change', onChange);\r\n          else this.checkboxField.input.addEventListener('change', onChange);\r\n        }\r\n      }\r\n\r\n      const i = options.radioField || options.checkboxField;\r\n      i.label.classList.add('disable-hover');\r\n    }\r\n\r\n    if(options.title || options.titleLangKey) {\r\n      let c: HTMLElement;\r\n      const titleRight = options.titleRight || options.titleRightSecondary;\r\n      if(titleRight) {\r\n        c = document.createElement('div');\r\n        c.classList.add('row-title-row');\r\n        this.container.append(c);\r\n      } else {\r\n        c = this.container;\r\n      }\r\n\r\n      this.title = document.createElement('div');\r\n      this.title.classList.add('row-title');\r\n      this.title.setAttribute('dir', 'auto');\r\n      if(options.noWrap) this.title.classList.add('no-wrap');\r\n      if(options.title) {\r\n        if(typeof(options.title) === 'string') {\r\n          this.title.innerHTML = options.title;\r\n        } else {\r\n          this.title.append(options.title);\r\n        }\r\n      } else {\r\n        this.title.append(i18n(options.titleLangKey));\r\n      }\r\n      c.append(this.title);\r\n\r\n      if(titleRight) {\r\n        const titleRightEl = this.titleRight = document.createElement('div');\r\n        titleRightEl.classList.add('row-title', 'row-title-right');\r\n\r\n        if(options.titleRightSecondary) {\r\n          titleRightEl.classList.add('row-title-right-secondary');\r\n        }\r\n\r\n        if(typeof(titleRight) === 'string') {\r\n          titleRightEl.innerHTML = titleRight;\r\n        } else {\r\n          titleRightEl.append(titleRight);\r\n        }\r\n\r\n        c.append(titleRightEl);\r\n      }\r\n    }\r\n\r\n    if(options.icon) {\r\n      havePadding = true;\r\n      this.title.classList.add('tgico', 'tgico-' + options.icon);\r\n      this.container.classList.add('row-with-icon');\r\n    }\r\n\r\n    if(havePadding) {\r\n      this.container.classList.add('row-with-padding');\r\n    }\r\n\r\n    if(options.navigationTab) {\r\n      options.clickable = () => options.navigationTab.open();\r\n    }\r\n\r\n    if(options.clickable || options.radioField || options.checkboxField) {\r\n      if(typeof(options.clickable) === 'function') {\r\n        attachClickEvent(this.container, (e) => {\r\n          if(this.freezed) return;\r\n          (options.clickable as any)(e);\r\n        }, {listenerSetter: options.listenerSetter});\r\n      }\r\n\r\n      this.container.classList.add('row-clickable', 'hover-effect');\r\n\r\n      if(!options.noRipple) {\r\n        ripple(this.container, undefined, undefined, true);\r\n      }\r\n\r\n      /* if(options.radioField || options.checkboxField) {\r\n        this.container.prepend(this.container.lastElementChild);\r\n      } */\r\n    }\r\n\r\n    if(options.buttonRight || options.buttonRightLangKey) {\r\n      this.buttonRight = options.buttonRight instanceof HTMLElement ?\r\n        options.buttonRight :\r\n        Button('btn-primary btn-color-primary', {text: options.buttonRightLangKey});\r\n      this.container.append(this.buttonRight);\r\n    }\r\n  }\r\n\r\n  public createMedia(size?: 'small') {\r\n    this.container.classList.add('row-with-padding');\r\n\r\n    const media = this.media = document.createElement('div');\r\n    media.classList.add('row-media');\r\n\r\n    if(size) {\r\n      media.classList.add('row-media-' + size);\r\n    }\r\n\r\n    this.container.append(media);\r\n\r\n    return media;\r\n  }\r\n}\r\n\r\nexport const RadioFormFromRows = (rows: Row[], onChange: (value: string) => void) => {\r\n  return RadioForm(rows.map((r) => ({container: r.container, input: r.radioField.input})), onChange);\r\n};\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport IS_TOUCH_SUPPORTED from '../environment/touchSupport';\r\nimport {logger, LogTypes} from '../lib/logger';\r\nimport fastSmoothScroll, {ScrollOptions} from '../helpers/fastSmoothScroll';\r\nimport useHeavyAnimationCheck from '../hooks/useHeavyAnimationCheck';\r\nimport cancelEvent from '../helpers/dom/cancelEvent';\r\nimport {IS_ANDROID} from '../environment/userAgent';\r\n/*\r\nvar el = $0;\r\nvar height = 0;\r\nvar checkUp = false;\r\n\r\ndo {\r\n  height += el.scrollHeight;\r\n} while(el = (checkUp ? el.previousElementSibling : el.nextElementSibling));\r\nconsole.log(height);\r\n*/\r\n\r\n/*\r\nArray.from($0.querySelectorAll('.bubble-content')).forEach((_el) => {\r\n  //_el.style.display = '';\r\n  //return;\r\n\r\n  let el = _el.parentElement;\r\n  let height = el.scrollHeight;\r\n  let width = el.scrollWidth;\r\n  el.style.width = width + 'px';\r\n  el.style.height = height + 'px';\r\n  _el.style.display = 'none';\r\n});\r\n*/\r\n\r\n/* const scrollables: Map<HTMLElement, Scrollable> = new Map();\r\nconst scrollsIntersector = new IntersectionObserver((entries) => {\r\n  for(let entry of entries) {\r\n    const scrollable = scrollables.get(entry.target as HTMLElement);\r\n\r\n    if(entry.isIntersecting) {\r\n      scrollable.isVisible = true;\r\n    } else {\r\n      scrollable.isVisible = false;\r\n\r\n      if(!isInDOM(entry.target)) {\r\n        scrollsIntersector.unobserve(scrollable.container);\r\n        scrollables.delete(scrollable.container);\r\n      }\r\n    }\r\n  }\r\n}); */\r\n\r\nconst SCROLL_THROTTLE = IS_ANDROID ? 200 : 24;\r\n\r\nexport class ScrollableBase {\r\n  protected log: ReturnType<typeof logger>;\r\n\r\n  public splitUp: HTMLElement;\r\n  public onScrollMeasure: number = 0;\r\n\r\n  public lastScrollPosition: number = 0;\r\n  public lastScrollDirection: number = 0;\r\n\r\n  public onAdditionalScroll: () => void;\r\n  public onScrolledTop: () => void;\r\n  public onScrolledBottom: () => void;\r\n\r\n  public isHeavyAnimationInProgress = false;\r\n  protected needCheckAfterAnimation = false;\r\n\r\n  public checkForTriggers?: () => void;\r\n\r\n  public scrollProperty: 'scrollTop' | 'scrollLeft';\r\n\r\n  protected removeHeavyAnimationListener: () => void;\r\n  protected addedScrollListener: boolean;\r\n\r\n  constructor(public el: HTMLElement, logPrefix = '', public container: HTMLElement = document.createElement('div')) {\r\n    this.container.classList.add('scrollable');\r\n\r\n    this.log = logger('SCROLL' + (logPrefix ? '-' + logPrefix : ''), LogTypes.Error);\r\n\r\n    if(el) {\r\n      Array.from(el.children).forEach((c) => this.container.append(c));\r\n\r\n      el.append(this.container);\r\n    }\r\n    // this.onScroll();\r\n  }\r\n\r\n  public addScrollListener() {\r\n    if(this.addedScrollListener) {\r\n      return;\r\n    }\r\n\r\n    this.addedScrollListener = true;\r\n    this.container.addEventListener('scroll', this.onScroll, {passive: true, capture: true});\r\n  }\r\n\r\n  public removeScrollListener() {\r\n    if(!this.addedScrollListener) {\r\n      return;\r\n    }\r\n\r\n    this.addedScrollListener = false;\r\n    this.container.removeEventListener('scroll', this.onScroll, {capture: true});\r\n  }\r\n\r\n  public setListeners() {\r\n    if(this.removeHeavyAnimationListener) {\r\n      return;\r\n    }\r\n\r\n    window.addEventListener('resize', this.onScroll, {passive: true});\r\n    this.addScrollListener();\r\n\r\n    this.removeHeavyAnimationListener = useHeavyAnimationCheck(() => {\r\n      this.isHeavyAnimationInProgress = true;\r\n\r\n      if(this.onScrollMeasure) {\r\n        this.cancelMeasure();\r\n        this.needCheckAfterAnimation = true;\r\n      }\r\n    }, () => {\r\n      this.isHeavyAnimationInProgress = false;\r\n\r\n      if(this.needCheckAfterAnimation) {\r\n        this.onScroll();\r\n        this.needCheckAfterAnimation = false;\r\n      }\r\n    });\r\n  }\r\n\r\n  public removeListeners() {\r\n    if(!this.removeHeavyAnimationListener) {\r\n      return;\r\n    }\r\n\r\n    window.removeEventListener('resize', this.onScroll);\r\n    this.removeScrollListener();\r\n\r\n    this.removeHeavyAnimationListener();\r\n    this.removeHeavyAnimationListener = undefined;\r\n  }\r\n\r\n  public destroy() {\r\n    this.removeListeners();\r\n    this.onAdditionalScroll = undefined;\r\n    this.onScrolledTop = undefined;\r\n    this.onScrolledBottom = undefined;\r\n  }\r\n\r\n  public append(element: HTMLElement) {\r\n    this.container.append(element);\r\n  }\r\n\r\n  public scrollIntoViewNew(options: Omit<ScrollOptions, 'container'>) {\r\n    // return Promise.resolve();\r\n    // this.removeListeners();\r\n    return fastSmoothScroll({\r\n      ...options,\r\n      container: this.container\r\n    });/* .finally(() => {\r\n      this.setListeners();\r\n    }); */\r\n  }\r\n\r\n  public onScroll = () => {\r\n    // if(this.debug) {\r\n    // this.log('onScroll call', this.onScrollMeasure);\r\n    // }\r\n\r\n    // return;\r\n\r\n    if(this.isHeavyAnimationInProgress) {\r\n      this.cancelMeasure();\r\n      this.needCheckAfterAnimation = true;\r\n      return;\r\n    }\r\n\r\n    // if(this.onScrollMeasure || ((this.scrollLocked || (!this.onScrolledTop && !this.onScrolledBottom)) && !this.splitUp && !this.onAdditionalScroll)) return;\r\n    if((!this.onScrolledTop && !this.onScrolledBottom) && !this.splitUp && !this.onAdditionalScroll) return;\r\n    if(this.onScrollMeasure) return;\r\n    // if(this.onScrollMeasure) window.cancelAnimationFrame(this.onScrollMeasure);\r\n    // this.onScrollMeasure = window.requestAnimationFrame(() => {\r\n    this.onScrollMeasure = window.setTimeout(() => {\r\n      this.onScrollMeasure = 0;\r\n\r\n      const scrollPosition = this.container[this.scrollProperty];\r\n      this.lastScrollDirection = this.lastScrollPosition === scrollPosition ? 0 : (this.lastScrollPosition < scrollPosition ? 1 : -1); // * 1 - bottom, -1 - top\r\n      this.lastScrollPosition = scrollPosition;\r\n\r\n      // lastScrollDirection check is useless here, every callback should decide on its own\r\n      if(this.onAdditionalScroll/*  && this.lastScrollDirection !== 0 */) {\r\n        this.onAdditionalScroll();\r\n      }\r\n\r\n      if(this.checkForTriggers) {\r\n        this.checkForTriggers();\r\n      }\r\n    // });\r\n    }, SCROLL_THROTTLE);\r\n  };\r\n\r\n  public cancelMeasure() {\r\n    if(this.onScrollMeasure) {\r\n      // window.cancelAnimationFrame(this.onScrollMeasure);\r\n      clearTimeout(this.onScrollMeasure);\r\n      this.onScrollMeasure = 0;\r\n    }\r\n  }\r\n}\r\n\r\nexport type SliceSides = 'top' | 'bottom';\r\nexport type SliceSidesContainer = {[k in SliceSides]: boolean};\r\n\r\nexport default class Scrollable extends ScrollableBase {\r\n  public padding: HTMLElement;\r\n\r\n  public loadedAll: SliceSidesContainer = {top: true, bottom: false};\r\n\r\n  constructor(el: HTMLElement, logPrefix = '', public onScrollOffset = 300, withPaddingContainer?: boolean) {\r\n    super(el, logPrefix);\r\n\r\n    /* if(withPaddingContainer) {\r\n      this.padding = document.createElement('div');\r\n      this.padding.classList.add('scrollable-padding');\r\n      Array.from(this.container.children).forEach((c) => this.padding.append(c));\r\n      this.container.append(this.padding);\r\n    } */\r\n\r\n    this.container.classList.add('scrollable-y');\r\n    this.setListeners();\r\n    this.scrollProperty = 'scrollTop';\r\n  }\r\n\r\n  public setVirtualContainer(el?: HTMLElement) {\r\n    this.splitUp = el;\r\n    this.log('setVirtualContainer:', el, this);\r\n  }\r\n\r\n  public checkForTriggers = () => {\r\n    if((!this.onScrolledTop && !this.onScrolledBottom)) return;\r\n\r\n    if(this.isHeavyAnimationInProgress) {\r\n      this.onScroll();\r\n      return;\r\n    }\r\n\r\n    const scrollHeight = this.container.scrollHeight;\r\n    if(!scrollHeight) { //         \r\n      return;\r\n    }\r\n\r\n    const clientHeight = this.container.clientHeight;\r\n    const maxScrollTop = scrollHeight - clientHeight;\r\n    const scrollTop = this.lastScrollPosition;\r\n\r\n    // this.log('checkForTriggers:', scrollTop, maxScrollTop);\r\n\r\n    if(this.onScrolledTop && scrollTop <= this.onScrollOffset && this.lastScrollDirection <= 0/* && direction === -1 */) {\r\n      this.onScrolledTop();\r\n    }\r\n\r\n    if(this.onScrolledBottom && (maxScrollTop - scrollTop) <= this.onScrollOffset && this.lastScrollDirection >= 0/* && direction === 1 */) {\r\n      this.onScrolledBottom();\r\n    }\r\n  };\r\n\r\n  public prepend(...elements: (HTMLElement | DocumentFragment)[]) {\r\n    (this.splitUp || this.padding || this.container).prepend(...elements);\r\n  }\r\n\r\n  public append(...elements: (HTMLElement | DocumentFragment)[]) {\r\n    (this.splitUp || this.padding || this.container).append(...elements);\r\n  }\r\n\r\n  public getDistanceToEnd() {\r\n    return this.scrollHeight - Math.round(this.scrollTop + this.container.offsetHeight);\r\n  }\r\n\r\n  get isScrolledDown() {\r\n    return this.getDistanceToEnd() <= 1;\r\n  }\r\n\r\n  set scrollTop(y: number) {\r\n    this.container.scrollTop = y;\r\n  }\r\n\r\n  get scrollTop() {\r\n    // this.log.trace('get scrollTop');\r\n    return this.container.scrollTop;\r\n  }\r\n\r\n  public setScrollTopSilently(value: number) {\r\n    this.lastScrollPosition = value;\r\n    this.ignoreNextScrollEvent();\r\n\r\n    this.scrollTop = value;\r\n  }\r\n\r\n  public ignoreNextScrollEvent() {\r\n    if(this.removeHeavyAnimationListener) {\r\n      this.removeScrollListener();\r\n      this.container.addEventListener('scroll', (e) => {\r\n        cancelEvent(e);\r\n        this.addScrollListener();\r\n      }, {capture: true, passive: false, once: true});\r\n    }\r\n  }\r\n\r\n  get scrollHeight() {\r\n    return this.container.scrollHeight;\r\n  }\r\n}\r\n\r\nexport class ScrollableX extends ScrollableBase {\r\n  constructor(el: HTMLElement, logPrefix = '', public onScrollOffset = 300, public splitCount = 15, public container: HTMLElement = document.createElement('div')) {\r\n    super(el, logPrefix, container);\r\n\r\n    this.container.classList.add('scrollable-x');\r\n\r\n    if(!IS_TOUCH_SUPPORTED) {\r\n      const scrollHorizontally = (e: any) => {\r\n        if(!e.deltaX && this.container.scrollWidth > this.container.clientWidth) {\r\n          this.container.scrollLeft += e.deltaY / 4;\r\n          cancelEvent(e);\r\n        }\r\n      };\r\n\r\n      this.container.addEventListener('wheel', scrollHorizontally, {passive: false});\r\n    }\r\n\r\n    this.scrollProperty = 'scrollLeft';\r\n  }\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport appSidebarLeft, {SettingSection} from '..';\r\nimport {InputFile} from '../../../layer';\r\nimport appDialogsManager from '../../../lib/appManagers/appDialogsManager';\r\nimport InputField from '../../inputField';\r\nimport {SliderSuperTab} from '../../slider';\r\nimport AvatarEdit from '../../avatarEdit';\r\nimport I18n from '../../../lib/langPack';\r\nimport ButtonCorner from '../../buttonCorner';\r\nimport getUserStatusString from '../../wrappers/getUserStatusString';\r\nimport appImManager from '../../../lib/appManagers/appImManager';\r\nimport {attachClickEvent} from '../../../helpers/dom/clickEvent';\r\n\r\ninterface OpenStreetMapInterface {\r\n  place_id?: number;\r\n  license?: string;\r\n  osm_type?: string;\r\n  osm_id?: number;\r\n  lat?: string;\r\n  lon?: string;\r\n  display_name: string;\r\n  address?: object;\r\n  boundingbox?: object;\r\n}\r\n\r\nexport default class AppNewGroupTab extends SliderSuperTab {\r\n  private avatarEdit: AvatarEdit;\r\n  private uploadAvatar: () => Promise<InputFile> = null;\r\n  private peerIds: PeerId[];\r\n  private isGeoChat: boolean = false;\r\n  private nextBtn: HTMLButtonElement;\r\n  private groupNameInputField: InputField;\r\n  private list: HTMLUListElement;\r\n  private groupLocationInputField: InputField;\r\n  private userLocationCoords: {lat: number, long: number};\r\n  private userLocationAddress: string;\r\n\r\n  protected init() {\r\n    this.container.classList.add('new-group-container');\r\n    this.setTitle('NewGroup');\r\n\r\n    this.avatarEdit = new AvatarEdit((_upload) => {\r\n      this.uploadAvatar = _upload;\r\n    });\r\n\r\n    const section = new SettingSection({});\r\n\r\n    const inputWrapper = document.createElement('div');\r\n    inputWrapper.classList.add('input-wrapper');\r\n\r\n    this.groupNameInputField = new InputField({\r\n      label: 'CreateGroup.NameHolder',\r\n      maxLength: 128\r\n    });\r\n\r\n    this.groupLocationInputField = new InputField({\r\n      label: 'ChatLocation',\r\n      name: 'location',\r\n      canBeEdited: false\r\n    });\r\n\r\n    inputWrapper.append(\r\n      this.groupNameInputField.container,\r\n      this.groupLocationInputField.container\r\n    );\r\n\r\n    this.listenerSetter.add(this.groupNameInputField.input)('input', () => {\r\n      const value = this.groupNameInputField.value;\r\n      let valueCheck = !!value.length && !this.groupNameInputField.input.classList.contains('error');\r\n      if(this.isGeoChat) valueCheck = valueCheck && !!this.userLocationCoords && !!this.userLocationAddress;\r\n      this.nextBtn.classList.toggle('is-visible', !!valueCheck);\r\n    });\r\n\r\n    this.nextBtn = ButtonCorner({icon: 'arrow_next'});\r\n\r\n    attachClickEvent(this.nextBtn, () => {\r\n      const title = this.groupNameInputField.value;\r\n\r\n      let promise: Promise<ChatId>;\r\n      if(this.isGeoChat) {\r\n        if(!this.userLocationAddress || !this.userLocationCoords) return;\r\n        promise = this.managers.appChatsManager.createChannel({\r\n          title,\r\n          about: '',\r\n          geo_point: {\r\n            _: 'inputGeoPoint',\r\n            ...this.userLocationCoords\r\n          },\r\n          address: this.userLocationAddress,\r\n          megagroup: true\r\n        }).then((chatId) => {\r\n          if(this.uploadAvatar) {\r\n            this.uploadAvatar().then((inputFile) => {\r\n              this.managers.appChatsManager.editPhoto(chatId, inputFile);\r\n            });\r\n          }\r\n\r\n          if(this.peerIds.length) {\r\n            this.managers.appChatsManager.inviteToChannel(chatId, this.peerIds);\r\n          }\r\n\r\n          return chatId;\r\n        });\r\n      } else {\r\n        this.nextBtn.disabled = true;\r\n        promise = this.managers.appChatsManager.createChat(title, this.peerIds.map((peerId) => peerId.toUserId())).then((chatId) => {\r\n          if(this.uploadAvatar) {\r\n            this.uploadAvatar().then((inputFile) => {\r\n              this.managers.appChatsManager.editPhoto(chatId, inputFile);\r\n            });\r\n          }\r\n\r\n          return chatId;\r\n        });\r\n      }\r\n\r\n      if(!promise) {\r\n        return;\r\n      }\r\n\r\n      promise.then((chatId) => {\r\n        appSidebarLeft.removeTabFromHistory(this);\r\n        appSidebarLeft.selectTab(0);\r\n\r\n        appImManager.setInnerPeer({peerId: chatId.toPeerId(true)});\r\n      });\r\n    }, {listenerSetter: this.listenerSetter});\r\n\r\n    const chatsSection = new SettingSection({\r\n      name: 'Members',\r\n      nameArgs: [this.peerIds.length]\r\n    });\r\n\r\n    const list = this.list = appDialogsManager.createChatList({\r\n      new: true\r\n    });\r\n\r\n    chatsSection.content.append(list);\r\n\r\n    section.content.append(this.avatarEdit.container, inputWrapper);\r\n\r\n    this.content.append(this.nextBtn);\r\n    this.scrollable.append(section.container, chatsSection.container);\r\n  }\r\n\r\n  public onCloseAfterTimeout() {\r\n    this.avatarEdit.clear();\r\n    this.uploadAvatar = null;\r\n    this.groupNameInputField.value = '';\r\n    this.groupLocationInputField.container.classList.add('hide');\r\n    this.nextBtn.disabled = false;\r\n  }\r\n\r\n  public open(peerIds: PeerId[], isGeoChat: boolean = false) {\r\n    this.isGeoChat = isGeoChat;\r\n    this.peerIds = peerIds;\r\n    const result = super.open();\r\n    result.then(() => {\r\n      if(isGeoChat) {\r\n        this.setTitle('NearbyCreateGroup');\r\n        this.groupLocationInputField.container.classList.remove('hide');\r\n        this.groupLocationInputField.setValueSilently(I18n.format('Loading', true));\r\n        this.startLocating();\r\n      } else {\r\n        this.groupLocationInputField.container.classList.add('hide');\r\n      }\r\n\r\n      return Promise.all(this.peerIds.map(async(userId) => {\r\n        const {dom} = appDialogsManager.addDialogNew({\r\n          peerId: userId,\r\n          container: this.list,\r\n          rippleEnabled: false,\r\n          avatarSize: 48\r\n        });\r\n\r\n        dom.lastMessageSpan.append(getUserStatusString(await this.managers.appUsersManager.getUser(userId)));\r\n      }));\r\n    });\r\n\r\n    return result;\r\n  }\r\n\r\n  private startLocating() {\r\n    navigator.geolocation.getCurrentPosition((location) => {\r\n      this.userLocationCoords = {\r\n        lat: location.coords.latitude,\r\n        long: location.coords.longitude\r\n      };\r\n\r\n      let uri = 'https://nominatim.openstreetmap.org/reverse';\r\n      uri += '?lat='+location.coords.latitude;\r\n      uri += '&lon='+location.coords.longitude;\r\n      uri += '&format=json';\r\n      uri += '&addressdetails=1';\r\n      uri += '&accept-language=en';\r\n      fetch(uri)\r\n      .then((response) => response.json())\r\n      .then((response: OpenStreetMapInterface) => {\r\n        this.userLocationAddress = response.display_name;\r\n        this.groupLocationInputField.setValueSilently(response.display_name);\r\n      });\r\n    }, (error) => {\r\n      if(error instanceof GeolocationPositionError) {\r\n        this.groupLocationInputField.setValueSilently('Location permission denied. Please retry later.');\r\n      } else {\r\n        this.groupLocationInputField.setValueSilently('An error has occurred. Please retry later.');\r\n      }\r\n    });\r\n  }\r\n}\r\n","enum PrivacyType {\n  Everybody = 2,\n  Contacts = 1,\n  Nobody = 0\n}\n\nexport default PrivacyType;\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport {PrivacyRule} from '../../../../layer';\nimport PrivacyType from './privacyType';\n\nexport default function getPrivacyRulesDetails(rules: PrivacyRule[]) {\n  const types: PrivacyType[] = [];\n\n  type peers = {users: UserId[], chats: ChatId[]};\n  const allowPeers: peers = {users: [], chats: []}, disallowPeers: peers = {users: [], chats: []};\n  rules.forEach((rule) => {\n    switch(rule._) {\n      case 'privacyValueAllowAll':\n        types.push(2);\n        break;\n      case 'privacyValueDisallowAll':\n        types.push(0);\n        break;\n      case 'privacyValueAllowContacts':\n        types.push(1);\n        break;\n      /* case 'privacyValueDisallowContacts':\n        types.push('Except My Contacts');\n        break; */\n      case 'privacyValueAllowChatParticipants':\n        allowPeers.chats.push(...rule.chats);\n        break;\n      case 'privacyValueAllowUsers':\n        allowPeers.users.push(...rule.users);\n        break;\n      case 'privacyValueDisallowChatParticipants':\n        disallowPeers.chats.push(...rule.chats);\n        break;\n      case 'privacyValueDisallowUsers':\n        disallowPeers.users.push(...rule.users);\n        break;\n    }\n  });\n\n  return {type: types[0], disallowPeers, allowPeers};\n}\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport replaceContent from '../helpers/dom/replaceContent';\r\nimport {randomLong} from '../helpers/random';\r\nimport {InputPrivacyKey, InputPrivacyRule} from '../layer';\r\nimport {AppManagers} from '../lib/appManagers/managers';\r\nimport getPrivacyRulesDetails from '../lib/appManagers/utils/privacy/getPrivacyRulesDetails';\r\nimport PrivacyType from '../lib/appManagers/utils/privacy/privacyType';\r\nimport {i18n, join, LangPackKey, _i18n} from '../lib/langPack';\r\nimport RadioField from './radioField';\r\nimport Row, {RadioFormFromRows} from './row';\r\nimport Scrollable from './scrollable';\r\nimport {SettingSection, generateSection} from './sidebarLeft';\r\nimport AppAddMembersTab from './sidebarLeft/tabs/addMembers';\r\nimport {SliderSuperTabEventable} from './sliderTab';\r\n\r\nexport type PrivacySectionStr = LangPackKey | '' | HTMLElement;\r\nexport default class PrivacySection {\r\n  public radioRows: Map<PrivacyType, Row>;\r\n  public radioSection: SettingSection;\r\n  public exceptions: Map<keyof PrivacySection['peerIds'], {\r\n    titleLangKey: LangPackKey,\r\n    key: keyof PrivacySection['peerIds'],\r\n    row: Row,\r\n    icon: string,\r\n    subtitleLangKey: LangPackKey,\r\n    clickable: true\r\n  }>;\r\n  public peerIds: {\r\n    disallow?: PeerId[],\r\n    allow?: PeerId[]\r\n  };\r\n  public type: PrivacyType;\r\n\r\n  constructor(public options: {\r\n    tab: SliderSuperTabEventable,\r\n    title: LangPackKey,\r\n    inputKey: InputPrivacyKey['_'],\r\n    captions?: [PrivacySectionStr, PrivacySectionStr, PrivacySectionStr],\r\n    appendTo?: Scrollable,\r\n    noExceptions?: boolean,\r\n    onRadioChange?: (value: number) => any,\r\n    skipTypes?: PrivacyType[],\r\n    exceptionTexts?: [LangPackKey, LangPackKey],\r\n    managers: AppManagers\r\n  }) {\r\n    if(options.captions) {\r\n      options.captions.reverse();\r\n    }\r\n\r\n    const managers = options.managers;\r\n\r\n    this.radioSection = new SettingSection({name: options.title, caption: true});\r\n\r\n    this.radioRows = new Map();\r\n\r\n    let r: Array<{type: PrivacyType, langKey: LangPackKey}> = [{\r\n      type: PrivacyType.Everybody,\r\n      langKey: 'PrivacySettingsController.Everbody'\r\n    }, {\r\n      type: PrivacyType.Contacts,\r\n      langKey: 'PrivacySettingsController.MyContacts'\r\n    }, {\r\n      type: PrivacyType.Nobody,\r\n      langKey: 'PrivacySettingsController.Nobody'\r\n    }];\r\n\r\n    if(options.skipTypes) {\r\n      r = r.filter((r) => !options.skipTypes.includes(r.type));\r\n    }\r\n\r\n    const random = randomLong();\r\n    r.forEach(({type, langKey}) => {\r\n      const row = new Row({\r\n        radioField: new RadioField({\r\n          langKey,\r\n          name: random,\r\n          value: '' + type\r\n        })\r\n      });\r\n\r\n      this.radioRows.set(type, row);\r\n    });\r\n\r\n    const form = RadioFormFromRows([...this.radioRows.values()], this.onRadioChange);\r\n\r\n    this.radioSection.content.append(form);\r\n    if(options.appendTo) {\r\n      options.appendTo.append(this.radioSection.container);\r\n    }\r\n\r\n    if(!options.noExceptions) {\r\n      const container = generateSection(options.appendTo, 'PrivacyExceptions', 'PrivacySettingsController.PeerInfo');\r\n\r\n      this.exceptions = new Map([[\r\n        'disallow',\r\n        {\r\n          titleLangKey: options.exceptionTexts[0],\r\n          key: 'disallow',\r\n          row: null,\r\n          icon: 'deleteuser',\r\n          subtitleLangKey: 'PrivacySettingsController.AddUsers',\r\n          clickable: true\r\n        }\r\n      ], [\r\n        'allow',\r\n        {\r\n          titleLangKey: options.exceptionTexts[1],\r\n          key: 'allow',\r\n          row: null,\r\n          icon: 'adduser',\r\n          subtitleLangKey: 'PrivacySettingsController.AddUsers',\r\n          clickable: true\r\n        }\r\n      ]]);\r\n\r\n      this.exceptions.forEach((exception) => {\r\n        exception.row = new Row(exception);\r\n\r\n        exception.row.container.addEventListener('click', () => {\r\n          promise.then(() => {\r\n            const _peerIds = this.peerIds[exception.key];\r\n            options.tab.slider.createTab(AppAddMembersTab).open({\r\n              type: 'privacy',\r\n              skippable: true,\r\n              title: exception.titleLangKey,\r\n              placeholder: 'PrivacyModal.Search.Placeholder',\r\n              takeOut: (newPeerIds) => {\r\n                _peerIds.length = 0;\r\n                _peerIds.push(...newPeerIds);\r\n                exception.row.subtitle.innerHTML = '';\r\n                exception.row.subtitle.append(...this.generateStr(this.splitPeersByType(newPeerIds)));\r\n              },\r\n              selectedPeerIds: _peerIds\r\n            });\r\n          });\r\n        });\r\n\r\n        container.append(exception.row.container);\r\n      });\r\n    }\r\n\r\n    /* setTimeout(() => {\r\n      this.setRadio(PrivacyType.Contacts);\r\n    }, 0); */\r\n\r\n    const promise = managers.appPrivacyManager.getPrivacy(options.inputKey).then((rules) => {\r\n      const details = getPrivacyRulesDetails(rules);\r\n      this.setRadio(details.type);\r\n\r\n      if(this.exceptions) {\r\n        this.peerIds = {};\r\n        ['allow' as const, 'disallow' as const].forEach((k) => {\r\n          const arr = [];\r\n          const from = k === 'allow' ? details.allowPeers : details.disallowPeers;\r\n          arr.push(...from.users.map((id) => id.toPeerId()));\r\n          arr.push(...from.chats.map((id) => id.toPeerId(true)));\r\n          this.peerIds[k] = arr;\r\n          const s = this.exceptions.get(k).row.subtitle;\r\n          s.innerHTML = '';\r\n          s.append(...this.generateStr(from));\r\n        });\r\n      }\r\n\r\n      options.tab.eventListener.addEventListener('destroy', async() => {\r\n        const rules: InputPrivacyRule[] = [];\r\n\r\n        switch(this.type) {\r\n          case PrivacyType.Everybody:\r\n            rules.push({_: 'inputPrivacyValueAllowAll'});\r\n            break;\r\n          case PrivacyType.Contacts:\r\n            rules.push({_: 'inputPrivacyValueAllowContacts'});\r\n            break;\r\n          case PrivacyType.Nobody:\r\n            rules.push({_: 'inputPrivacyValueDisallowAll'});\r\n            break;\r\n        }\r\n\r\n        if(this.exceptions) {\r\n          const a = ([\r\n            ['allow',     'inputPrivacyValueAllowChatParticipants',     'inputPrivacyValueAllowUsers'],\r\n            ['disallow',  'inputPrivacyValueDisallowChatParticipants',  'inputPrivacyValueDisallowUsers']\r\n          ] as Array<[\r\n            'allow' | 'disallow',\r\n            'inputPrivacyValueAllowChatParticipants' | 'inputPrivacyValueDisallowChatParticipants',\r\n            'inputPrivacyValueAllowUsers' | 'inputPrivacyValueDisallowUsers'\r\n          ]>);\r\n          for(const [k, chatKey, usersKey] of a) {\r\n            if(this.exceptions.get(k).row.container.classList.contains('hide')) {\r\n              continue;\r\n            }\r\n\r\n            const _peerIds = this.peerIds[k];\r\n            if(_peerIds) {\r\n              const splitted = this.splitPeersByType(_peerIds);\r\n              if(splitted.chats.length) {\r\n                rules.push({_: chatKey, chats: splitted.chats});\r\n              }\r\n\r\n              if(splitted.users.length) {\r\n                rules.push({\r\n                  _: usersKey,\r\n                  users: await Promise.all(splitted.users.map((id) => managers.appUsersManager.getUserInput(id)))\r\n                });\r\n              }\r\n            }\r\n          }\r\n        }\r\n\r\n        managers.appPrivacyManager.setPrivacy(options.inputKey, rules);\r\n      }, {once: true});\r\n    });\r\n  }\r\n\r\n  private onRadioChange = (value: string | PrivacySection['type']) => {\r\n    value = +value as PrivacySection['type'];\r\n    this.type = value;\r\n\r\n    const caption = this.options.captions[this.type];\r\n    const captionElement = this.radioSection.caption;\r\n    if(!caption) {\r\n      captionElement.innerHTML = '';\r\n    } else if(caption instanceof HTMLElement) {\r\n      replaceContent(captionElement, caption);\r\n    } else {\r\n      _i18n(captionElement, caption);\r\n    }\r\n    captionElement.classList.toggle('hide', !caption);\r\n\r\n    if(this.exceptions) {\r\n      this.exceptions.get('allow').row.container.classList.toggle('hide', this.type === PrivacyType.Everybody);\r\n      this.exceptions.get('disallow').row.container.classList.toggle('hide', this.type === PrivacyType.Nobody);\r\n    }\r\n\r\n    this.options.onRadioChange && this.options.onRadioChange(value);\r\n  };\r\n\r\n  public setRadio(type: PrivacySection['type']) {\r\n    const row = this.radioRows.get(type);\r\n    this.onRadioChange(type);\r\n    row.radioField.input.checked = true;\r\n  }\r\n\r\n  private splitPeersByType(peerIds: PeerId[]) {\r\n    const peers = {users: [] as UserId[], chats: [] as ChatId[]};\r\n    peerIds.forEach((peerId) => {\r\n      peers[peerId.isAnyChat() ? 'chats' : 'users'].push(peerId.isAnyChat() ? peerId.toChatId() : peerId);\r\n    });\r\n\r\n    return peers;\r\n  }\r\n\r\n  private generateStr(peers: {users: UserId[], chats: ChatId[]}) {\r\n    if(!peers.users.length && !peers.chats.length) {\r\n      return [i18n('PrivacySettingsController.AddUsers')];\r\n    }\r\n\r\n    return join([\r\n      peers.users.length ? i18n('Users', [peers.users.length]) : null,\r\n      peers.chats.length ? i18n('Chats', [peers.chats.length]) : null\r\n    ].filter(Boolean), false);\r\n  }\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport {SliderSuperTabEventable} from '../../../sliderTab';\r\nimport PrivacySection from '../../../privacySection';\r\nimport {i18n, LangPackKey} from '../../../../lib/langPack';\r\nimport anchorCopy from '../../../../helpers/dom/anchorCopy';\r\nimport PrivacyType from '../../../../lib/appManagers/utils/privacy/privacyType';\r\n\r\nexport default class AppPrivacyPhoneNumberTab extends SliderSuperTabEventable {\r\n  protected async init() {\r\n    this.header.classList.add('with-border');\r\n    this.container.classList.add('privacy-tab', 'privacy-phone-number');\r\n    this.setTitle('PrivacyPhone');\r\n\r\n    const formatted = '+' + (await this.managers.appUsersManager.getSelf()).phone;\r\n    const captionEl = document.createElement('div');\r\n    captionEl.append(\r\n      i18n('PrivacyPhoneInfo'),\r\n      document.createElement('br'),\r\n      document.createElement('br'),\r\n      i18n('PrivacyPhoneInfo4'),\r\n      document.createElement('br'),\r\n      anchorCopy({\r\n        mePath: formatted\r\n      })\r\n    );\r\n\r\n    const phoneSection = new PrivacySection({\r\n      tab: this,\r\n      title: 'PrivacyPhoneTitle',\r\n      inputKey: 'inputPrivacyKeyPhoneNumber',\r\n      captions: [captionEl, captionEl, ''],\r\n      exceptionTexts: ['PrivacySettingsController.NeverShare', 'PrivacySettingsController.AlwaysShare'],\r\n      appendTo: this.scrollable,\r\n      onRadioChange: (type) => {\r\n        s.setRadio(PrivacyType.Everybody);\r\n        s.radioSection.container.classList.toggle('hide', type !== PrivacyType.Nobody);\r\n      },\r\n      managers: this.managers\r\n    });\r\n\r\n    const sCaption: LangPackKey = 'PrivacyPhoneInfo3';\r\n    const s = new PrivacySection({\r\n      tab: this,\r\n      title: 'PrivacyPhoneTitle2',\r\n      inputKey: 'inputPrivacyKeyAddedByPhone',\r\n      captions: [sCaption, sCaption, ''],\r\n      noExceptions: true,\r\n      skipTypes: [PrivacyType.Nobody],\r\n      managers: this.managers\r\n    });\r\n\r\n    this.scrollable.container.insertBefore(s.radioSection.container, phoneSection.radioSection.container.nextSibling);\r\n  }\r\n}\r\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport {toastNew} from '../../components/toast';\nimport {copyTextToClipboard} from '../clipboard';\nimport cancelEvent from './cancelEvent';\nimport {attachClickEvent} from './clickEvent';\n\nexport default function anchorCopy(options: Partial<{\n  // href: string,\n  mePath: string\n}> = {}) {\n  const anchor = document.createElement('a');\n  anchor.classList.add('anchor-copy');\n\n  if(options.mePath) {\n    const href = 'https://t.me/' + options.mePath;\n    anchor.href = anchor.innerText = href;\n  }\n\n  attachClickEvent(anchor, (e) => {\n    cancelEvent(e);\n    copyTextToClipboard(anchor.href);\n    toastNew({langPackKey: 'LinkCopied'});\n  });\n\n  return anchor;\n}\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport {SettingSection} from '../..';\r\nimport {attachClickEvent} from '../../../../helpers/dom/clickEvent';\r\nimport Button from '../../../button';\r\nimport {SliderSuperTab} from '../../../slider';\r\nimport wrapStickerEmoji from '../../../wrappers/stickerEmoji';\r\nimport AppSettingsTab from '../settings';\r\n\r\nexport default class AppTwoStepVerificationSetTab extends SliderSuperTab {\r\n  protected init() {\r\n    this.container.classList.add('two-step-verification', 'two-step-verification-set');\r\n    this.setTitle('TwoStepVerificationPasswordSet');\r\n\r\n    const section = new SettingSection({\r\n      captionOld: 'TwoStepVerificationPasswordSetInfo',\r\n      noDelimiter: true\r\n    });\r\n\r\n    const emoji = '';\r\n    const stickerContainer = document.createElement('div');\r\n\r\n    wrapStickerEmoji({\r\n      emoji,\r\n      div: stickerContainer,\r\n      width: 160,\r\n      height: 160\r\n    });\r\n\r\n    section.content.append(stickerContainer);\r\n\r\n    const inputContent = section.generateContentElement();\r\n\r\n    const inputWrapper = document.createElement('div');\r\n    inputWrapper.classList.add('input-wrapper');\r\n\r\n    const btnReturn = Button('btn-primary btn-color-primary', {text: 'TwoStepVerificationPasswordReturnSettings'});\r\n\r\n    attachClickEvent(btnReturn, (e) => {\r\n      this.close();\r\n    });\r\n\r\n    this.slider.sliceTabsUntilTab(AppSettingsTab, this);\r\n\r\n    inputWrapper.append(btnReturn);\r\n\r\n    inputContent.append(inputWrapper);\r\n\r\n    this.scrollable.container.append(section.container);\r\n  }\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport {IS_MOBILE_SAFARI} from '../../environment/userAgent';\r\n\r\nexport function canFocus(isFirstInput: boolean) {\r\n  return !IS_MOBILE_SAFARI || !isFirstInput;\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport {SettingSection} from '../..';\r\nimport {AccountPassword} from '../../../../layer';\r\nimport Button from '../../../button';\r\nimport {SliderSuperTab} from '../../../slider';\r\nimport AppTwoStepVerificationSetTab from './passwordSet';\r\nimport CodeInputField from '../../../codeInputField';\r\nimport AppTwoStepVerificationEmailTab from './email';\r\nimport {putPreloader} from '../../../putPreloader';\r\nimport {i18n, _i18n} from '../../../../lib/langPack';\r\nimport {canFocus} from '../../../../helpers/dom/canFocus';\r\nimport {attachClickEvent} from '../../../../helpers/dom/clickEvent';\r\nimport replaceContent from '../../../../helpers/dom/replaceContent';\r\nimport toggleDisability from '../../../../helpers/dom/toggleDisability';\r\nimport wrapStickerEmoji from '../../../wrappers/stickerEmoji';\r\n\r\nexport default class AppTwoStepVerificationEmailConfirmationTab extends SliderSuperTab {\r\n  public codeInputField: CodeInputField;\r\n  public state: AccountPassword;\r\n  public email: string;\r\n  public length: number;\r\n  public isFirst = false;\r\n\r\n  protected init() {\r\n    this.container.classList.add('two-step-verification', 'two-step-verification-email-confirmation');\r\n    this.setTitle('TwoStepAuth.RecoveryTitle');\r\n\r\n    const section = new SettingSection({\r\n      captionOld: true,\r\n      noDelimiter: true\r\n    });\r\n\r\n    _i18n(section.caption, 'TwoStepAuth.ConfirmEmailCodeDesc', [this.email]);\r\n\r\n    const emoji = '';\r\n    const stickerContainer = document.createElement('div');\r\n\r\n    wrapStickerEmoji({\r\n      div: stickerContainer,\r\n      width: 160,\r\n      height: 160,\r\n      emoji\r\n    });\r\n\r\n    section.content.append(stickerContainer);\r\n\r\n    const inputContent = section.generateContentElement();\r\n\r\n    const inputWrapper = document.createElement('div');\r\n    inputWrapper.classList.add('input-wrapper');\r\n\r\n    const inputField = this.codeInputField = new CodeInputField({\r\n      name: 'recovery-email-code',\r\n      label: 'TwoStepAuth.RecoveryCode',\r\n      length: this.length,\r\n      onFill: (code) => {\r\n        freeze(true);\r\n\r\n        this.managers.passwordManager.confirmPasswordEmail('' + code)\r\n        .then((value) => {\r\n          if(!value) {\r\n\r\n          }\r\n\r\n          goNext();\r\n        })\r\n        .catch((err) => {\r\n          switch(err.type) {\r\n            case 'CODE_INVALID':\r\n              inputField.input.classList.add('error');\r\n              replaceContent(inputField.label, i18n('TwoStepAuth.RecoveryCodeInvalid'));\r\n              break;\r\n\r\n            case 'EMAIL_HASH_EXPIRED':\r\n              inputField.input.classList.add('error');\r\n              replaceContent(inputField.label, i18n('TwoStepAuth.RecoveryCodeExpired'));\r\n              break;\r\n\r\n            default:\r\n              console.error('confirm error', err);\r\n              break;\r\n          }\r\n\r\n          freeze(false);\r\n        });\r\n      }\r\n    });\r\n\r\n    const btnChange = Button('btn-primary btn-primary-transparent primary', {text: 'TwoStepAuth.EmailCodeChangeEmail'});\r\n    const btnResend = Button('btn-primary btn-secondary btn-primary-transparent primary', {text: 'ResendCode'});\r\n\r\n    const goNext = () => {\r\n      this.slider.createTab(AppTwoStepVerificationSetTab).open();\r\n    };\r\n\r\n    const freeze = (disable: boolean) => {\r\n      toggleDisability([inputField.input, btnChange, btnResend], disable);\r\n    };\r\n\r\n    attachClickEvent(btnChange, (e) => {\r\n      freeze(true);\r\n      this.managers.passwordManager.cancelPasswordEmail().then((value) => {\r\n        this.slider.sliceTabsUntilTab(AppTwoStepVerificationEmailTab, this);\r\n        this.close();\r\n      }, () => {\r\n        freeze(false);\r\n      });\r\n    });\r\n\r\n    attachClickEvent(btnResend, (e) => {\r\n      freeze(true);\r\n      const d = putPreloader(btnResend);\r\n      this.managers.passwordManager.resendPasswordEmail().then((value) => {\r\n        d.remove();\r\n        freeze(false);\r\n      });\r\n    });\r\n\r\n    inputWrapper.append(inputField.container, btnChange, btnResend);\r\n\r\n    inputContent.append(inputWrapper);\r\n\r\n    this.scrollable.container.append(section.container);\r\n  }\r\n\r\n  onOpenAfterTimeout() {\r\n    if(!canFocus(this.isFirst)) return;\r\n    this.codeInputField.input.focus();\r\n  }\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport {SettingSection} from '../..';\r\nimport {AccountPassword} from '../../../../layer';\r\nimport Button from '../../../button';\r\nimport {SliderSuperTab} from '../../../slider';\r\nimport InputField from '../../../inputField';\r\nimport {putPreloader} from '../../../putPreloader';\r\nimport AppTwoStepVerificationSetTab from './passwordSet';\r\nimport AppTwoStepVerificationEmailConfirmationTab from './emailConfirmation';\r\nimport PopupPeer from '../../../popups/peer';\r\nimport cancelEvent from '../../../../helpers/dom/cancelEvent';\r\nimport {canFocus} from '../../../../helpers/dom/canFocus';\r\nimport {attachClickEvent} from '../../../../helpers/dom/clickEvent';\r\nimport matchEmail from '../../../../lib/richTextProcessor/matchEmail';\r\nimport wrapStickerEmoji from '../../../wrappers/stickerEmoji';\r\n\r\nexport default class AppTwoStepVerificationEmailTab extends SliderSuperTab {\r\n  public inputField: InputField;\r\n  public state: AccountPassword;\r\n  public plainPassword: string;\r\n  public newPassword: string;\r\n  public hint: string;\r\n  public isFirst = false;\r\n\r\n  protected init() {\r\n    this.container.classList.add('two-step-verification', 'two-step-verification-email');\r\n    this.setTitle('RecoveryEmailTitle');\r\n\r\n    const section = new SettingSection({\r\n      captionOld: true,\r\n      noDelimiter: true\r\n    });\r\n\r\n    const emoji = '';\r\n    const stickerContainer = document.createElement('div');\r\n\r\n    wrapStickerEmoji({\r\n      div: stickerContainer,\r\n      width: 160,\r\n      height: 160,\r\n      emoji\r\n    });\r\n\r\n    section.content.append(stickerContainer);\r\n\r\n    const inputContent = section.generateContentElement();\r\n\r\n    const inputWrapper = document.createElement('div');\r\n    inputWrapper.classList.add('input-wrapper');\r\n\r\n    const inputField = this.inputField = new InputField({\r\n      name: 'recovery-email',\r\n      label: 'RecoveryEmail',\r\n      plainText: true\r\n    });\r\n\r\n    inputField.input.addEventListener('keypress', (e) => {\r\n      if(e.key === 'Enter') {\r\n        cancelEvent(e);\r\n        return onContinueClick();\r\n      }\r\n    });\r\n\r\n    inputField.input.addEventListener('input', (e) => {\r\n      inputField.input.classList.remove('error');\r\n    });\r\n\r\n    const btnContinue = Button('btn-primary btn-color-primary', {text: 'Continue'});\r\n    const btnSkip = Button('btn-primary btn-secondary btn-primary-transparent primary', {text: 'YourEmailSkip'});\r\n\r\n    const goNext = () => {\r\n      this.slider.createTab(AppTwoStepVerificationSetTab).open();\r\n    };\r\n\r\n    const onContinueClick = () => {\r\n      const email = inputField.value.trim();\r\n      const match = matchEmail(email);\r\n      if(!match || match[0].length !== email.length) {\r\n        inputField.input.classList.add('error');\r\n        return;\r\n      }\r\n\r\n      toggleButtons(true);\r\n      const d = putPreloader(btnContinue);\r\n\r\n      this.managers.passwordManager.updateSettings({\r\n        hint: this.hint,\r\n        currentPassword: this.plainPassword,\r\n        newPassword: this.newPassword,\r\n        email\r\n      }).then((value) => {\r\n        goNext();\r\n      }, (err) => {\r\n        if(err.type.includes('EMAIL_UNCONFIRMED')) {\r\n          const symbols = +err.type.match(/^EMAIL_UNCONFIRMED_(\\d+)/)[1];\r\n\r\n          const tab = this.slider.createTab(AppTwoStepVerificationEmailConfirmationTab);\r\n          tab.state = this.state;\r\n          tab.email = email;\r\n          tab.length = symbols;\r\n          tab.open();\r\n        } else {\r\n          console.log('password set error', err);\r\n        }\r\n\r\n        toggleButtons(false);\r\n        d.remove();\r\n      });\r\n    };\r\n    attachClickEvent(btnContinue, onContinueClick);\r\n\r\n    const toggleButtons = (freeze: boolean) => {\r\n      if(freeze) {\r\n        btnContinue.setAttribute('disabled', 'true');\r\n        btnSkip.setAttribute('disabled', 'true');\r\n      } else {\r\n        btnContinue.removeAttribute('disabled');\r\n        btnSkip.removeAttribute('disabled');\r\n      }\r\n    };\r\n\r\n    attachClickEvent(btnSkip, (e) => {\r\n      const popup = new PopupPeer('popup-skip-email', {\r\n        buttons: [{\r\n          langKey: 'Cancel',\r\n          isCancel: true\r\n        }, {\r\n          langKey: 'YourEmailSkip',\r\n          callback: () => {\r\n            // inputContent.classList.add('sidebar-left-section-disabled');\r\n            toggleButtons(true);\r\n            putPreloader(btnSkip);\r\n            this.managers.passwordManager.updateSettings({\r\n              hint: this.hint,\r\n              currentPassword: this.plainPassword,\r\n              newPassword: this.newPassword,\r\n              email: ''\r\n            }).then(() => {\r\n              goNext();\r\n            }, (err) => {\r\n              toggleButtons(false);\r\n            });\r\n          },\r\n          isDanger: true\r\n        }],\r\n        titleLangKey: 'YourEmailSkipWarning',\r\n        descriptionLangKey: 'YourEmailSkipWarningText'\r\n      });\r\n\r\n      popup.show();\r\n    });\r\n\r\n    inputWrapper.append(inputField.container, btnContinue, btnSkip);\r\n\r\n    inputContent.append(inputWrapper);\r\n\r\n    this.scrollable.container.append(section.container);\r\n  }\r\n\r\n  onOpenAfterTimeout() {\r\n    if(!canFocus(this.isFirst)) return;\r\n    this.inputField.input.focus();\r\n  }\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport {SettingSection} from '../..';\r\nimport {AccountPassword} from '../../../../layer';\r\nimport Button from '../../../button';\r\nimport {SliderSuperTab} from '../../../slider';\r\nimport InputField from '../../../inputField';\r\nimport AppTwoStepVerificationEmailTab from './email';\r\nimport {toast} from '../../../toast';\r\nimport I18n from '../../../../lib/langPack';\r\nimport cancelEvent from '../../../../helpers/dom/cancelEvent';\r\nimport {attachClickEvent} from '../../../../helpers/dom/clickEvent';\r\nimport wrapStickerEmoji from '../../../wrappers/stickerEmoji';\r\n\r\nexport default class AppTwoStepVerificationHintTab extends SliderSuperTab {\r\n  public inputField: InputField;\r\n  public state: AccountPassword;\r\n  public plainPassword: string;\r\n  public newPassword: string;\r\n\r\n  protected init() {\r\n    this.container.classList.add('two-step-verification', 'two-step-verification-hint');\r\n    this.setTitle('TwoStepAuth.SetupHintTitle');\r\n\r\n    const section = new SettingSection({\r\n      noDelimiter: true\r\n    });\r\n\r\n    const emoji = '';\r\n    const stickerContainer = document.createElement('div');\r\n    wrapStickerEmoji({\r\n      div: stickerContainer,\r\n      width: 160,\r\n      height: 160,\r\n      emoji\r\n    });\r\n\r\n    section.content.append(stickerContainer);\r\n\r\n    const inputWrapper = document.createElement('div');\r\n    inputWrapper.classList.add('input-wrapper');\r\n\r\n    const inputField = this.inputField = new InputField({\r\n      name: 'hint',\r\n      label: 'TwoStepAuth.SetupHintPlaceholder'\r\n    });\r\n\r\n    inputField.input.addEventListener('keypress', (e) => {\r\n      if(e.key === 'Enter') {\r\n        cancelEvent(e);\r\n        return inputField.value ? onContinueClick() : onSkipClick();\r\n      }\r\n    });\r\n\r\n    const goNext = (e?: Event, saveHint?: boolean) => {\r\n      if(e) {\r\n        cancelEvent(e);\r\n      }\r\n\r\n      const hint = saveHint ? inputField.value : undefined;\r\n      if(hint && this.newPassword === hint) {\r\n        toast(I18n.format('PasswordAsHintError', true));\r\n        return;\r\n      }\r\n\r\n      const tab = this.slider.createTab(AppTwoStepVerificationEmailTab);\r\n      tab.state = this.state;\r\n      tab.plainPassword = this.plainPassword;\r\n      tab.newPassword = this.newPassword;\r\n      tab.hint = hint;\r\n\r\n      tab.open();\r\n    };\r\n\r\n    const btnContinue = Button('btn-primary btn-color-primary', {text: 'Continue'});\r\n    const btnSkip = Button('btn-primary btn-secondary btn-primary-transparent primary', {text: 'YourEmailSkip'});\r\n\r\n    const onContinueClick = (e?: Event) => goNext(e, true);\r\n    const onSkipClick = (e?: Event) => goNext(e, false);\r\n    attachClickEvent(btnContinue, onContinueClick);\r\n    attachClickEvent(btnSkip, onSkipClick);\r\n\r\n    inputWrapper.append(inputField.container, btnContinue, btnSkip);\r\n\r\n    section.content.append(inputWrapper);\r\n\r\n    this.scrollable.container.append(section.container);\r\n  }\r\n\r\n  onOpenAfterTimeout() {\r\n    this.inputField.input.focus();\r\n  }\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport {SettingSection} from '../..';\r\nimport {AccountPassword} from '../../../../layer';\r\nimport Button from '../../../button';\r\nimport PasswordInputField from '../../../passwordInputField';\r\nimport {SliderSuperTab} from '../../../slider';\r\nimport TrackingMonkey from '../../../monkeys/tracking';\r\nimport AppTwoStepVerificationHintTab from './hint';\r\nimport {InputState} from '../../../inputField';\r\nimport cancelEvent from '../../../../helpers/dom/cancelEvent';\r\nimport {attachClickEvent} from '../../../../helpers/dom/clickEvent';\r\n\r\nexport default class AppTwoStepVerificationReEnterPasswordTab extends SliderSuperTab {\r\n  public state: AccountPassword;\r\n  public passwordInputField: PasswordInputField;\r\n  public plainPassword: string;\r\n  public newPassword: string;\r\n\r\n  protected init() {\r\n    this.container.classList.add('two-step-verification', 'two-step-verification-enter-password', 'two-step-verification-re-enter-password');\r\n    this.setTitle('PleaseReEnterPassword');\r\n\r\n    const section = new SettingSection({\r\n      noDelimiter: true\r\n    });\r\n\r\n    const inputWrapper = document.createElement('div');\r\n    inputWrapper.classList.add('input-wrapper');\r\n\r\n    const passwordInputField = this.passwordInputField = new PasswordInputField({\r\n      name: 're-enter-password',\r\n      label: 'PleaseReEnterPassword'\r\n    });\r\n\r\n    const monkey = new TrackingMonkey(passwordInputField, 157);\r\n\r\n    const btnContinue = Button('btn-primary btn-color-primary', {text: 'Continue'});\r\n\r\n    inputWrapper.append(passwordInputField.container, btnContinue);\r\n    section.content.append(monkey.container, inputWrapper);\r\n\r\n    this.scrollable.container.append(section.container);\r\n\r\n    passwordInputField.input.addEventListener('keypress', (e) => {\r\n      if(passwordInputField.input.classList.contains('error')) {\r\n        passwordInputField.setState(InputState.Neutral);\r\n      }\r\n\r\n      if(e.key === 'Enter') {\r\n        return onContinueClick();\r\n      }\r\n    });\r\n\r\n    const verifyInput = () => {\r\n      if(this.newPassword !== passwordInputField.value) {\r\n        passwordInputField.setError();\r\n        return false;\r\n      }\r\n\r\n      return true;\r\n    };\r\n\r\n    const onContinueClick = (e?: Event) => {\r\n      if(e) {\r\n        cancelEvent(e);\r\n      }\r\n\r\n      if(!verifyInput()) return;\r\n\r\n      const tab = this.slider.createTab(AppTwoStepVerificationHintTab);\r\n      tab.state = this.state;\r\n      tab.plainPassword = this.plainPassword;\r\n      tab.newPassword = this.newPassword;\r\n      tab.open();\r\n    };\r\n    attachClickEvent(btnContinue, onContinueClick);\r\n\r\n    return monkey.load();\r\n  }\r\n\r\n  onOpenAfterTimeout() {\r\n    this.passwordInputField.input.focus();\r\n  }\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport AppTwoStepVerificationTab from '.';\r\nimport {SettingSection} from '../..';\r\nimport cancelEvent from '../../../../helpers/dom/cancelEvent';\r\nimport {canFocus} from '../../../../helpers/dom/canFocus';\r\nimport {attachClickEvent} from '../../../../helpers/dom/clickEvent';\r\nimport replaceContent from '../../../../helpers/dom/replaceContent';\r\nimport setInnerHTML from '../../../../helpers/dom/setInnerHTML';\r\nimport {AccountPassword} from '../../../../layer';\r\nimport I18n, {i18n} from '../../../../lib/langPack';\r\nimport wrapEmojiText from '../../../../lib/richTextProcessor/wrapEmojiText';\r\nimport Button from '../../../button';\r\nimport {putPreloader} from '../../../putPreloader';\r\nimport PasswordMonkey from '../../../monkeys/password';\r\nimport PasswordInputField from '../../../passwordInputField';\r\nimport {SliderSuperTab} from '../../../slider';\r\nimport AppTwoStepVerificationReEnterPasswordTab from './reEnterPassword';\r\n\r\nexport default class AppTwoStepVerificationEnterPasswordTab extends SliderSuperTab {\r\n  public state: AccountPassword;\r\n  public passwordInputField: PasswordInputField;\r\n  public plainPassword: string;\r\n  public isFirst = true;\r\n\r\n  protected init() {\r\n    const isNew = !this.state.pFlags.has_password || this.plainPassword;\r\n    this.container.classList.add('two-step-verification', 'two-step-verification-enter-password');\r\n    this.setTitle(isNew ? 'PleaseEnterFirstPassword' : 'PleaseEnterCurrentPassword');\r\n\r\n    const section = new SettingSection({\r\n      noDelimiter: true\r\n    });\r\n\r\n    const inputWrapper = document.createElement('div');\r\n    inputWrapper.classList.add('input-wrapper');\r\n\r\n    const passwordInputField = this.passwordInputField = new PasswordInputField({\r\n      name: 'enter-password',\r\n      label: isNew ? 'PleaseEnterFirstPassword' : (this.state.hint ? undefined : 'LoginPassword'),\r\n      labelText: !isNew && this.state.hint ? wrapEmojiText(this.state.hint) : undefined\r\n    });\r\n\r\n    const monkey = new PasswordMonkey(passwordInputField, 157);\r\n\r\n    const btnContinue = Button('btn-primary btn-color-primary');\r\n    const textEl = new I18n.IntlElement({key: 'Continue'});\r\n\r\n    btnContinue.append(textEl.element);\r\n\r\n    inputWrapper.append(passwordInputField.container, btnContinue);\r\n    section.content.append(monkey.container, inputWrapper);\r\n\r\n    this.scrollable.container.append(section.container);\r\n\r\n    passwordInputField.input.addEventListener('keypress', (e) => {\r\n      if(passwordInputField.input.classList.contains('error')) {\r\n        passwordInputField.input.classList.remove('error');\r\n        textEl.key = 'Continue';\r\n        textEl.update();\r\n      }\r\n\r\n      if(e.key === 'Enter') {\r\n        return onContinueClick();\r\n      }\r\n    });\r\n\r\n    const verifyInput = () => {\r\n      if(!passwordInputField.value.length) {\r\n        passwordInputField.input.classList.add('error');\r\n        return false;\r\n      }\r\n\r\n      return true;\r\n    };\r\n\r\n    let onContinueClick: (e?: Event) => void;\r\n    if(!isNew) {\r\n      let getStateInterval: number;\r\n\r\n      const getState = () => {\r\n        // * just to check session relevance\r\n        if(!getStateInterval) {\r\n          getStateInterval = window.setInterval(getState, 10e3);\r\n        }\r\n\r\n        return this.managers.passwordManager.getState().then((_state) => {\r\n          this.state = _state;\r\n\r\n          if(this.state.hint) {\r\n            setInnerHTML(passwordInputField.label, wrapEmojiText(this.state.hint));\r\n          } else {\r\n            replaceContent(passwordInputField.label, i18n('LoginPassword'));\r\n          }\r\n        });\r\n      };\r\n\r\n      const submit = (e?: Event) => {\r\n        if(!verifyInput()) {\r\n          cancelEvent(e);\r\n          return;\r\n        }\r\n\r\n        btnContinue.setAttribute('disabled', 'true');\r\n        textEl.key = 'PleaseWait';\r\n        textEl.update();\r\n        const preloader = putPreloader(btnContinue);\r\n\r\n        const plainPassword = passwordInputField.value;\r\n        this.managers.passwordManager.check(passwordInputField.value, this.state).then((auth) => {\r\n          console.log(auth);\r\n\r\n          if(auth._ === 'auth.authorization') {\r\n            clearInterval(getStateInterval);\r\n            if(monkey) monkey.remove();\r\n            const tab = this.slider.createTab(AppTwoStepVerificationTab);\r\n            tab.state = this.state;\r\n            tab.plainPassword = plainPassword;\r\n            tab.open();\r\n            this.slider.removeTabFromHistory(this);\r\n          }\r\n        }, (err) => {\r\n          btnContinue.removeAttribute('disabled');\r\n          passwordInputField.input.classList.add('error');\r\n\r\n          switch(err.type) {\r\n            default:\r\n              // btnContinue.innerText = err.type;\r\n              textEl.key = 'PASSWORD_HASH_INVALID';\r\n              textEl.update();\r\n              preloader.remove();\r\n              passwordInputField.select();\r\n              break;\r\n          }\r\n\r\n          getState();\r\n        });\r\n      };\r\n\r\n      onContinueClick = submit;\r\n\r\n      getState();\r\n    } else {\r\n      onContinueClick = (e) => {\r\n        if(e) {\r\n          cancelEvent(e);\r\n        }\r\n\r\n        if(!verifyInput()) return;\r\n\r\n        const tab = this.slider.createTab(AppTwoStepVerificationReEnterPasswordTab);\r\n        tab.state = this.state;\r\n        tab.newPassword = passwordInputField.value;\r\n        tab.plainPassword = this.plainPassword;\r\n        tab.open();\r\n      };\r\n    }\r\n\r\n    attachClickEvent(btnContinue, onContinueClick);\r\n\r\n    return monkey.load();\r\n  }\r\n\r\n  onOpenAfterTimeout() {\r\n    if(!canFocus(this.isFirst)) return;\r\n    this.passwordInputField.input.focus();\r\n  }\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport {SettingSection} from '../..';\r\nimport {attachClickEvent} from '../../../../helpers/dom/clickEvent';\r\nimport {AccountPassword} from '../../../../layer';\r\nimport {_i18n} from '../../../../lib/langPack';\r\nimport Button from '../../../button';\r\nimport PopupPeer from '../../../popups/peer';\r\nimport {SliderSuperTab} from '../../../slider';\r\nimport wrapStickerEmoji from '../../../wrappers/stickerEmoji';\r\nimport AppSettingsTab from '../settings';\r\nimport AppTwoStepVerificationEmailTab from './email';\r\nimport AppTwoStepVerificationEnterPasswordTab from './enterPassword';\r\n\r\nexport default class AppTwoStepVerificationTab extends SliderSuperTab {\r\n  public state: AccountPassword;\r\n  public plainPassword: string;\r\n\r\n  protected init() {\r\n    this.container.classList.add('two-step-verification', 'two-step-verification-main');\r\n    this.setTitle('TwoStepVerificationTitle');\r\n\r\n    const section = new SettingSection({\r\n      captionOld: true,\r\n      noDelimiter: true\r\n    });\r\n\r\n    const emoji = '';\r\n    const stickerContainer = document.createElement('div');\r\n\r\n    wrapStickerEmoji({\r\n      div: stickerContainer,\r\n      width: 168,\r\n      height: 168,\r\n      emoji\r\n    });\r\n\r\n    section.content.append(stickerContainer);\r\n\r\n    const c = section.generateContentElement();\r\n    if(this.state.pFlags.has_password) {\r\n      _i18n(section.caption, 'TwoStepAuth.GenericHelp');\r\n\r\n      const btnChangePassword = Button('btn-primary btn-transparent', {icon: 'edit', text: 'TwoStepAuth.ChangePassword'});\r\n      const btnDisablePassword = Button('btn-primary btn-transparent', {icon: 'passwordoff', text: 'TwoStepAuth.RemovePassword'});\r\n      const btnSetRecoveryEmail = Button('btn-primary btn-transparent', {icon: 'email', text: this.state.pFlags.has_recovery ? 'TwoStepAuth.ChangeEmail' : 'TwoStepAuth.SetupEmail'});\r\n\r\n      attachClickEvent(btnChangePassword, () => {\r\n        const tab = this.slider.createTab(AppTwoStepVerificationEnterPasswordTab);\r\n        tab.state = this.state;\r\n        tab.plainPassword = this.plainPassword;\r\n        tab.open();\r\n      });\r\n\r\n      attachClickEvent(btnDisablePassword, () => {\r\n        const popup = new PopupPeer('popup-disable-password', {\r\n          buttons: [{\r\n            langKey: 'Disable',\r\n            callback: () => {\r\n              this.managers.passwordManager.updateSettings({currentPassword: this.plainPassword}).then(() => {\r\n                this.slider.sliceTabsUntilTab(AppSettingsTab, this);\r\n                this.close();\r\n              });\r\n            },\r\n            isDanger: true\r\n          }],\r\n          titleLangKey: 'TurnPasswordOffQuestionTitle',\r\n          descriptionLangKey: 'TurnPasswordOffQuestion'\r\n        });\r\n\r\n        popup.show();\r\n      });\r\n\r\n      attachClickEvent(btnSetRecoveryEmail, () => {\r\n        const tab = this.slider.createTab(AppTwoStepVerificationEmailTab);\r\n        tab.state = this.state;\r\n        tab.hint = this.state.hint;\r\n        tab.plainPassword = this.plainPassword;\r\n        tab.newPassword = this.plainPassword;\r\n        tab.isFirst = true;\r\n        tab.open();\r\n      });\r\n\r\n      c.append(btnChangePassword, btnDisablePassword, btnSetRecoveryEmail);\r\n    } else {\r\n      _i18n(section.caption, 'TwoStepAuth.SetPasswordHelp');\r\n\r\n      const inputWrapper = document.createElement('div');\r\n      inputWrapper.classList.add('input-wrapper');\r\n\r\n      const btnSetPassword = Button('btn-primary btn-color-primary', {text: 'TwoStepVerificationSetPassword'});\r\n\r\n      inputWrapper.append(btnSetPassword);\r\n      c.append(inputWrapper);\r\n\r\n      attachClickEvent(btnSetPassword, (e) => {\r\n        const tab = this.slider.createTab(AppTwoStepVerificationEnterPasswordTab);\r\n        tab.state = this.state;\r\n        tab.open();\r\n      });\r\n    }\r\n\r\n    this.scrollable.container.append(section.container);\r\n  }\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport {SliderSuperTabEventable} from '../../../sliderTab';\r\nimport PrivacySection from '../../../privacySection';\r\nimport {LangPackKey} from '../../../../lib/langPack';\r\n\r\nexport default class AppPrivacyLastSeenTab extends SliderSuperTabEventable {\r\n  protected init() {\r\n    this.header.classList.add('with-border');\r\n    this.container.classList.add('privacy-tab', 'privacy-last-seen');\r\n    this.setTitle('PrivacyLastSeen');\r\n\r\n    const caption: LangPackKey = 'PrivacySettingsController.LastSeenDescription';\r\n    new PrivacySection({\r\n      tab: this,\r\n      title: 'LastSeenTitle',\r\n      inputKey: 'inputPrivacyKeyStatusTimestamp',\r\n      captions: [caption, caption, caption],\r\n      exceptionTexts: ['PrivacySettingsController.NeverShare', 'PrivacySettingsController.AlwaysShare'],\r\n      appendTo: this.scrollable,\r\n      managers: this.managers\r\n    });\r\n  }\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport {SliderSuperTabEventable} from '../../../sliderTab';\r\nimport PrivacySection from '../../../privacySection';\r\nimport {LangPackKey} from '../../../../lib/langPack';\r\nimport PrivacyType from '../../../../lib/appManagers/utils/privacy/privacyType';\r\n\r\nexport default class AppPrivacyProfilePhotoTab extends SliderSuperTabEventable {\r\n  protected init() {\r\n    this.header.classList.add('with-border');\r\n    this.container.classList.add('privacy-tab', 'privacy-profile-photo');\r\n    this.setTitle('PrivacyProfilePhoto');\r\n\r\n    const caption: LangPackKey = 'PrivacySettingsController.ProfilePhoto.CustomHelp';\r\n    new PrivacySection({\r\n      tab: this,\r\n      title: 'PrivacyProfilePhotoTitle',\r\n      inputKey: 'inputPrivacyKeyProfilePhoto',\r\n      captions: [caption, caption, caption],\r\n      exceptionTexts: ['PrivacySettingsController.NeverShare', 'PrivacySettingsController.AlwaysShare'],\r\n      appendTo: this.scrollable,\r\n      skipTypes: [PrivacyType.Nobody],\r\n      managers: this.managers\r\n    });\r\n  }\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport {SliderSuperTabEventable} from '../../../sliderTab';\r\nimport PrivacySection from '../../../privacySection';\r\nimport {LangPackKey} from '../../../../lib/langPack';\r\n\r\nexport default class AppPrivacyForwardMessagesTab extends SliderSuperTabEventable {\r\n  protected init() {\r\n    this.header.classList.add('with-border');\r\n    this.container.classList.add('privacy-tab', 'privacy-forward-messages');\r\n    this.setTitle('PrivacySettings.Forwards');\r\n\r\n    const caption: LangPackKey = 'PrivacySettingsController.Forwards.CustomHelp';\r\n    new PrivacySection({\r\n      tab: this,\r\n      title: 'PrivacyForwardsTitle',\r\n      inputKey: 'inputPrivacyKeyForwards',\r\n      captions: [caption, caption, caption],\r\n      exceptionTexts: ['PrivacySettingsController.NeverAllow', 'PrivacySettingsController.AlwaysAllow'],\r\n      appendTo: this.scrollable,\r\n      managers: this.managers\r\n    });\r\n  }\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport {SliderSuperTabEventable} from '../../../sliderTab';\r\nimport PrivacySection from '../../../privacySection';\r\nimport {LangPackKey} from '../../../../lib/langPack';\r\nimport PrivacyType from '../../../../lib/appManagers/utils/privacy/privacyType';\r\n\r\nexport default class AppPrivacyAddToGroupsTab extends SliderSuperTabEventable {\r\n  protected init() {\r\n    this.header.classList.add('with-border');\r\n    this.container.classList.add('privacy-tab', 'privacy-add-to-groups');\r\n    this.setTitle('PrivacySettings.Groups');\r\n\r\n    const caption: LangPackKey = 'PrivacySettingsController.GroupDescription';\r\n    new PrivacySection({\r\n      tab: this,\r\n      title: 'WhoCanAddMe',\r\n      inputKey: 'inputPrivacyKeyChatInvite',\r\n      captions: [caption, caption, caption],\r\n      exceptionTexts: ['PrivacySettingsController.NeverAllow', 'PrivacySettingsController.AlwaysAllow'],\r\n      appendTo: this.scrollable,\r\n      skipTypes: [PrivacyType.Nobody],\r\n      managers: this.managers\r\n    });\r\n  }\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport {SliderSuperTabEventable} from '../../../sliderTab';\r\nimport PrivacySection from '../../../privacySection';\r\nimport {LangPackKey} from '../../../../lib/langPack';\r\n\r\nexport default class AppPrivacyCallsTab extends SliderSuperTabEventable {\r\n  protected init() {\r\n    this.header.classList.add('with-border');\r\n    this.container.classList.add('privacy-tab', 'privacy-calls');\r\n    this.setTitle('PrivacySettings.VoiceCalls');\r\n\r\n    const caption: LangPackKey = 'PrivacySettingsController.PhoneCallDescription';\r\n    new PrivacySection({\r\n      tab: this,\r\n      title: 'WhoCanCallMe',\r\n      inputKey: 'inputPrivacyKeyPhoneCall',\r\n      captions: [caption, caption, caption],\r\n      exceptionTexts: ['PrivacySettingsController.NeverAllow', 'PrivacySettingsController.AlwaysAllow'],\r\n      appendTo: this.scrollable,\r\n      managers: this.managers\r\n    });\r\n\r\n    {\r\n      const caption: LangPackKey = 'PrivacySettingsController.P2p.Desc';\r\n      new PrivacySection({\r\n        tab: this,\r\n        title: 'PrivacyP2PHeader',\r\n        inputKey: 'inputPrivacyKeyPhoneP2P',\r\n        captions: [caption, caption, caption],\r\n        exceptionTexts: ['PrivacySettingsController.NeverAllow', 'PrivacySettingsController.AlwaysAllow'],\r\n        appendTo: this.scrollable,\r\n        managers: this.managers\r\n      });\r\n    }\r\n  }\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport {SettingSection} from '..';\r\nimport Button from '../../button';\r\nimport Row from '../../row';\r\nimport {Authorization} from '../../../layer';\r\nimport {formatDateAccordingToTodayNew} from '../../../helpers/date';\r\nimport ButtonMenu from '../../buttonMenu';\r\nimport {toast} from '../../toast';\r\nimport I18n from '../../../lib/langPack';\r\nimport PopupPeer from '../../popups/peer';\r\nimport findUpClassName from '../../../helpers/dom/findUpClassName';\r\nimport {attachClickEvent} from '../../../helpers/dom/clickEvent';\r\nimport toggleDisability from '../../../helpers/dom/toggleDisability';\r\nimport {SliderSuperTabEventable} from '../../sliderTab';\r\nimport findAndSplice from '../../../helpers/array/findAndSplice';\r\nimport {attachContextMenuListener} from '../../../helpers/dom/attachContextMenuListener';\r\nimport positionMenu from '../../../helpers/positionMenu';\r\nimport contextMenuController from '../../../helpers/contextMenuController';\r\n\r\nexport default class AppActiveSessionsTab extends SliderSuperTabEventable {\r\n  public authorizations: Authorization.authorization[];\r\n  private menuElement: HTMLElement;\r\n\r\n  protected init() {\r\n    this.header.classList.add('with-border');\r\n    this.container.classList.add('active-sessions-container');\r\n    this.setTitle('SessionsTitle');\r\n\r\n    const Session = (auth: Authorization.authorization) => {\r\n      const row = new Row({\r\n        title: [auth.app_name, auth.app_version].join(' '),\r\n        subtitle: [auth.ip, auth.country].join(' - '),\r\n        clickable: true,\r\n        titleRight: auth.pFlags.current ? undefined : formatDateAccordingToTodayNew(new Date(Math.max(auth.date_active, auth.date_created) * 1000))\r\n      });\r\n\r\n      row.container.dataset.hash = '' + auth.hash;\r\n\r\n      const midtitle = document.createElement('div');\r\n      midtitle.classList.add('row-midtitle');\r\n      midtitle.innerHTML = [auth.device_model, auth.system_version || auth.platform].filter(Boolean).join(', ');\r\n\r\n      row.subtitle.parentElement.insertBefore(midtitle, row.subtitle);\r\n\r\n      return row;\r\n    };\r\n\r\n    const authorizations = this.authorizations.slice();\r\n\r\n    {\r\n      const section = new SettingSection({\r\n        name: 'CurrentSession',\r\n        caption: 'ClearOtherSessionsHelp'\r\n      });\r\n\r\n      const auth = findAndSplice(authorizations, auth => auth.pFlags.current);\r\n      const session = Session(auth);\r\n\r\n      section.content.append(session.container);\r\n\r\n      if(authorizations.length) {\r\n        const btnTerminate = Button('btn-primary btn-transparent danger', {icon: 'stop', text: 'TerminateAllSessions'});\r\n        attachClickEvent(btnTerminate, (e) => {\r\n          new PopupPeer('revoke-session', {\r\n            buttons: [{\r\n              langKey: 'Terminate',\r\n              isDanger: true,\r\n              callback: () => {\r\n                const toggle = toggleDisability([btnTerminate], true);\r\n                this.managers.apiManager.invokeApi('auth.resetAuthorizations').then((value) => {\r\n                  // toggleDisability([btnTerminate], false);\r\n                  btnTerminate.remove();\r\n                  otherSection.container.remove();\r\n                }, onError).finally(() => {\r\n                  toggle();\r\n                });\r\n              }\r\n            }],\r\n            titleLangKey: 'AreYouSureSessionsTitle',\r\n            descriptionLangKey: 'AreYouSureSessions'\r\n          }).show();\r\n        });\r\n\r\n        section.content.append(btnTerminate);\r\n      }\r\n\r\n      this.scrollable.append(section.container);\r\n    }\r\n\r\n    if(!authorizations.length) {\r\n      return;\r\n    }\r\n\r\n    const otherSection = new SettingSection({\r\n      name: 'OtherSessions',\r\n      caption: 'SessionsListInfo'\r\n    });\r\n\r\n    authorizations.forEach((auth) => {\r\n      otherSection.content.append(Session(auth).container);\r\n    });\r\n\r\n    this.scrollable.append(otherSection.container);\r\n\r\n    const onError = (err: any) => {\r\n      if(err.type === 'FRESH_RESET_AUTHORISATION_FORBIDDEN') {\r\n        toast(I18n.format('RecentSessions.Error.FreshReset', true));\r\n      }\r\n    };\r\n\r\n    let target: HTMLElement;\r\n    const onTerminateClick = () => {\r\n      const hash = target.dataset.hash;\r\n\r\n      new PopupPeer('revoke-session', {\r\n        buttons: [{\r\n          langKey: 'Terminate',\r\n          isDanger: true,\r\n          callback: () => {\r\n            this.managers.apiManager.invokeApi('account.resetAuthorization', {hash})\r\n            .then((value) => {\r\n              if(value) {\r\n                target.remove();\r\n              }\r\n            }, onError);\r\n          }\r\n        }],\r\n        titleLangKey: 'AreYouSureSessionTitle',\r\n        descriptionLangKey: 'TerminateSessionText'\r\n      }).show();\r\n    };\r\n\r\n    const element = this.menuElement = ButtonMenu([{\r\n      icon: 'stop',\r\n      text: 'Terminate',\r\n      onClick: onTerminateClick\r\n    }]);\r\n    element.id = 'active-sessions-contextmenu';\r\n    element.classList.add('contextmenu');\r\n\r\n    document.getElementById('page-chats').append(element);\r\n\r\n    attachContextMenuListener(this.scrollable.container, (e) => {\r\n      target = findUpClassName(e.target, 'row');\r\n      if(!target || target.dataset.hash === '0') {\r\n        return;\r\n      }\r\n\r\n      if(e instanceof MouseEvent) e.preventDefault();\r\n      // smth\r\n      if(e instanceof MouseEvent) e.cancelBubble = true;\r\n\r\n      positionMenu(e, element);\r\n      contextMenuController.openBtnMenu(element);\r\n    });\r\n\r\n    attachClickEvent(this.scrollable.container, (e) => {\r\n      target = findUpClassName(e.target, 'row');\r\n      if(!target || target.dataset.hash === '0') {\r\n        return;\r\n      }\r\n\r\n      onTerminateClick();\r\n    });\r\n  }\r\n\r\n  onCloseAfterTimeout() {\r\n    if(this.menuElement) {\r\n      this.menuElement.remove();\r\n    }\r\n\r\n    return super.onCloseAfterTimeout();\r\n  }\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport {SliderSuperTab} from '../../slider';\r\nimport {SettingSection} from '..';\r\nimport ButtonMenu from '../../buttonMenu';\r\nimport appDialogsManager, {DIALOG_LIST_ELEMENT_TAG} from '../../../lib/appManagers/appDialogsManager';\r\nimport PopupPickUser from '../../popups/pickUser';\r\nimport rootScope from '../../../lib/rootScope';\r\nimport findUpTag from '../../../helpers/dom/findUpTag';\r\nimport ButtonCorner from '../../buttonCorner';\r\nimport {attachClickEvent} from '../../../helpers/dom/clickEvent';\r\nimport formatUserPhone from '../../wrappers/formatUserPhone';\r\nimport getUserStatusString from '../../wrappers/getUserStatusString';\r\nimport {attachContextMenuListener} from '../../../helpers/dom/attachContextMenuListener';\r\nimport positionMenu from '../../../helpers/positionMenu';\r\nimport contextMenuController from '../../../helpers/contextMenuController';\r\n\r\nexport default class AppBlockedUsersTab extends SliderSuperTab {\r\n  public peerIds: PeerId[];\r\n  private menuElement: HTMLElement;\r\n\r\n  protected init() {\r\n    this.header.classList.add('with-border');\r\n    this.container.classList.add('blocked-users-container');\r\n    this.setTitle('BlockedUsers');\r\n\r\n    const section = new SettingSection({\r\n      caption: 'BlockedUsersInfo'\r\n    });\r\n\r\n    section.caption.parentElement.prepend(section.caption);\r\n\r\n    this.scrollable.append(section.container);\r\n\r\n    const btnAdd = ButtonCorner({icon: 'add', className: 'is-visible'});\r\n    this.content.append(btnAdd);\r\n\r\n    attachClickEvent(btnAdd, (e) => {\r\n      new PopupPickUser({\r\n        peerTypes: ['contacts'],\r\n        placeholder: 'BlockModal.Search.Placeholder',\r\n        onSelect: (peerId) => {\r\n          // console.log('block', peerId);\r\n          this.managers.appUsersManager.toggleBlock(peerId, true);\r\n        }\r\n      });\r\n    }, {listenerSetter: this.listenerSetter});\r\n\r\n    const list = appDialogsManager.createChatList();\r\n    this.scrollable.container.classList.add('chatlist-container');\r\n    section.content.append(list);\r\n\r\n    const add = async(peerId: PeerId, append: boolean) => {\r\n      const {dom} = appDialogsManager.addDialogNew({\r\n        peerId: peerId,\r\n        container: list,\r\n        rippleEnabled: true,\r\n        avatarSize: 48,\r\n        append\r\n      });\r\n\r\n      const user = await this.managers.appUsersManager.getUser(peerId);\r\n      if(user.pFlags.bot) {\r\n        dom.lastMessageSpan.append('@' + user.username);\r\n      } else {\r\n        if(user.phone) dom.lastMessageSpan.innerHTML = formatUserPhone(user.phone);\r\n        else dom.lastMessageSpan.append(user.username ? '@' + user.username : getUserStatusString(user));\r\n      }\r\n\r\n      // dom.titleSpan.innerHTML = 'Raaid El Syed';\r\n      // dom.lastMessageSpan.innerHTML = '+1 234 567891';\r\n    };\r\n\r\n    for(const peerId of this.peerIds) {\r\n      add(peerId, true);\r\n    }\r\n\r\n    let target: HTMLElement;\r\n    const onUnblock = () => {\r\n      const peerId = target.dataset.peerId.toPeerId();\r\n      this.managers.appUsersManager.toggleBlock(peerId, false);\r\n    };\r\n\r\n    const element = this.menuElement = ButtonMenu([{\r\n      icon: 'lockoff',\r\n      text: 'Unblock',\r\n      onClick: onUnblock,\r\n      options: {listenerSetter: this.listenerSetter}\r\n    }]);\r\n    element.id = 'blocked-users-contextmenu';\r\n    element.classList.add('contextmenu');\r\n\r\n    document.getElementById('page-chats').append(element);\r\n\r\n    attachContextMenuListener(this.scrollable.container, (e) => {\r\n      target = findUpTag(e.target, DIALOG_LIST_ELEMENT_TAG);\r\n      if(!target) {\r\n        return;\r\n      }\r\n\r\n      if(e instanceof MouseEvent) e.preventDefault();\r\n      // smth\r\n      if(e instanceof MouseEvent) e.cancelBubble = true;\r\n\r\n      positionMenu(e, element);\r\n      contextMenuController.openBtnMenu(element);\r\n    }, this.listenerSetter);\r\n\r\n    this.listenerSetter.add(rootScope)('peer_block', (update) => {\r\n      const {peerId, blocked} = update;\r\n      const li = list.querySelector(`[data-peer-id=\"${peerId}\"]`);\r\n      if(blocked) {\r\n        if(!li) {\r\n          add(peerId, false);\r\n        }\r\n      } else {\r\n        if(li) {\r\n          li.remove();\r\n        }\r\n      }\r\n    });\r\n\r\n    const LOAD_COUNT = 50;\r\n    let loading = false;\r\n    this.scrollable.onScrolledBottom = () => {\r\n      if(loading) {\r\n        return;\r\n      }\r\n\r\n      loading = true;\r\n      this.managers.appUsersManager.getBlocked(list.childElementCount, LOAD_COUNT).then((res) => {\r\n        for(const peerId of res.peerIds) {\r\n          add(peerId, true);\r\n        }\r\n\r\n        if(res.peerIds.length < LOAD_COUNT || list.childElementCount === res.count) {\r\n          this.scrollable.onScrolledBottom = null;\r\n        }\r\n\r\n        this.scrollable.checkForTriggers();\r\n      }).finally(() => {\r\n        loading = false;\r\n      });\r\n    };\r\n  }\r\n\r\n  onOpenAfterTimeout() {\r\n    this.scrollable.onScroll();\r\n  }\r\n\r\n  onCloseAfterTimeout() {\r\n    if(this.menuElement) {\r\n      this.menuElement.remove();\r\n    }\r\n\r\n    return super.onCloseAfterTimeout();\r\n  }\r\n}\r\n","export default function convertKeyToInputKey(key: string) {\n  key = key[0].toUpperCase() + key.slice(1);\n  key = 'input' + key;\n  return key;\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport {SliderSuperTabEventable} from '../../../sliderTab';\nimport PrivacySection from '../../../privacySection';\nimport {LangPackKey} from '../../../../lib/langPack';\n\nexport default class AppPrivacyVoicesTab extends SliderSuperTabEventable {\n  protected init() {\n    this.header.classList.add('with-border');\n    this.container.classList.add('privacy-tab', 'privacy-voices');\n    this.setTitle('PrivacyVoiceMessages');\n\n    const caption: LangPackKey = 'PrivacyVoiceMessagesInfo';\n    new PrivacySection({\n      tab: this,\n      title: 'PrivacyVoiceMessagesTitle',\n      inputKey: 'inputPrivacyKeyVoiceMessages',\n      captions: [caption, caption, caption],\n      exceptionTexts: ['PrivacySettingsController.NeverAllow', 'PrivacySettingsController.AlwaysAllow'],\n      appendTo: this.scrollable,\n      managers: this.managers\n    });\n  }\n}\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport {SliderSuperTabEventable} from '../../sliderTab';\r\nimport {SettingSection} from '..';\r\nimport Row from '../../row';\r\nimport {AccountPassword, Authorization, InputPrivacyKey, Updates} from '../../../layer';\r\nimport AppPrivacyPhoneNumberTab from './privacy/phoneNumber';\r\nimport AppTwoStepVerificationTab from './2fa';\r\nimport AppTwoStepVerificationEnterPasswordTab from './2fa/enterPassword';\r\nimport AppTwoStepVerificationEmailConfirmationTab from './2fa/emailConfirmation';\r\nimport AppPrivacyLastSeenTab from './privacy/lastSeen';\r\nimport AppPrivacyProfilePhotoTab from './privacy/profilePhoto';\r\nimport AppPrivacyForwardMessagesTab from './privacy/forwardMessages';\r\nimport AppPrivacyAddToGroupsTab from './privacy/addToGroups';\r\nimport AppPrivacyCallsTab from './privacy/calls';\r\nimport AppActiveSessionsTab from './activeSessions';\r\nimport AppBlockedUsersTab from './blockedUsers';\r\nimport rootScope from '../../../lib/rootScope';\r\nimport {i18n, LangPackKey, _i18n} from '../../../lib/langPack';\r\nimport replaceContent from '../../../helpers/dom/replaceContent';\r\nimport CheckboxField from '../../checkboxField';\r\nimport PopupPeer from '../../popups/peer';\r\nimport Button from '../../button';\r\nimport toggleDisability from '../../../helpers/dom/toggleDisability';\r\nimport convertKeyToInputKey from '../../../helpers/string/convertKeyToInputKey';\r\nimport getPrivacyRulesDetails from '../../../lib/appManagers/utils/privacy/getPrivacyRulesDetails';\r\nimport PrivacyType from '../../../lib/appManagers/utils/privacy/privacyType';\r\nimport confirmationPopup, {PopupConfirmationOptions} from '../../confirmationPopup';\r\nimport noop from '../../../helpers/noop';\r\nimport {toastNew} from '../../toast';\r\nimport AppPrivacyVoicesTab from './privacy/voices';\r\n\r\nexport default class AppPrivacyAndSecurityTab extends SliderSuperTabEventable {\r\n  private activeSessionsRow: Row;\r\n  private authorizations: Authorization.authorization[];\r\n\r\n  protected init() {\r\n    this.header.classList.add('with-border');\r\n    this.container.classList.add('dont-u-dare-block-me');\r\n    this.setTitle('PrivacySettings');\r\n\r\n    const SUBTITLE: LangPackKey = 'Loading';\r\n\r\n    {\r\n      const section = new SettingSection({noDelimiter: true, caption: 'SessionsInfo'});\r\n\r\n      let blockedPeerIds: PeerId[];\r\n      const blockedUsersRow = new Row({\r\n        icon: 'deleteuser',\r\n        titleLangKey: 'BlockedUsers',\r\n        subtitleLangKey: SUBTITLE,\r\n        clickable: () => {\r\n          const tab = this.slider.createTab(AppBlockedUsersTab);\r\n          tab.peerIds = blockedPeerIds;\r\n          tab.open();\r\n        },\r\n        listenerSetter: this.listenerSetter\r\n      });\r\n      blockedUsersRow.freezed = true;\r\n\r\n      let passwordState: AccountPassword;\r\n      const twoFactorRowOptions = {\r\n        icon: 'lock',\r\n        titleLangKey: 'TwoStepVerification' as LangPackKey,\r\n        subtitleLangKey: SUBTITLE,\r\n        clickable: (e: Event) => {\r\n          let tab: AppTwoStepVerificationTab | AppTwoStepVerificationEnterPasswordTab | AppTwoStepVerificationEmailConfirmationTab;\r\n          if(passwordState.pFlags.has_password) {\r\n            tab = this.slider.createTab(AppTwoStepVerificationEnterPasswordTab);\r\n          } else if(passwordState.email_unconfirmed_pattern) {\r\n            tab = this.slider.createTab(AppTwoStepVerificationEmailConfirmationTab);\r\n            tab.email = passwordState.email_unconfirmed_pattern;\r\n            tab.length = 6;\r\n            tab.isFirst = true;\r\n            this.managers.passwordManager.resendPasswordEmail();\r\n          } else {\r\n            tab = this.slider.createTab(AppTwoStepVerificationTab);\r\n          }\r\n\r\n          tab.state = passwordState;\r\n          tab.open();\r\n        },\r\n        listenerSetter: this.listenerSetter\r\n      };\r\n\r\n      const twoFactorRow = new Row(twoFactorRowOptions);\r\n      twoFactorRow.freezed = true;\r\n\r\n      const activeSessionsRow = this.activeSessionsRow = new Row({\r\n        icon: 'activesessions',\r\n        titleLangKey: 'SessionsTitle',\r\n        subtitleLangKey: SUBTITLE,\r\n        clickable: () => {\r\n          const tab = this.slider.createTab(AppActiveSessionsTab);\r\n          tab.authorizations = this.authorizations;\r\n          tab.eventListener.addEventListener('destroy', () => {\r\n            this.updateActiveSessions();\r\n          }, {once: true});\r\n          tab.open();\r\n        },\r\n        listenerSetter: this.listenerSetter\r\n      });\r\n      activeSessionsRow.freezed = true;\r\n\r\n      section.content.append(blockedUsersRow.container, twoFactorRow.container, activeSessionsRow.container);\r\n      this.scrollable.append(section.container);\r\n\r\n      const setBlockedCount = (count: number) => {\r\n        if(count) {\r\n          replaceContent(blockedUsersRow.subtitle, i18n('PrivacySettingsController.UserCount', [count]));\r\n        } else {\r\n          replaceContent(blockedUsersRow.subtitle, i18n('BlockedEmpty', [count]));\r\n        }\r\n      };\r\n\r\n      this.listenerSetter.add(rootScope)('peer_block', () => {\r\n        /* const {blocked, peerId} = update;\r\n        if(!blocked) blockedPeerIds.findAndSplice((p) => p === peerId);\r\n        else blockedPeerIds.unshift(peerId);\r\n        blockedCount += blocked ? 1 : -1;\r\n        setBlockedCount(blockedCount); */\r\n        updateBlocked();\r\n      });\r\n\r\n      const updateBlocked = () => {\r\n        this.managers.appUsersManager.getBlocked().then((res) => {\r\n          blockedUsersRow.freezed = false;\r\n          setBlockedCount(res.count);\r\n          blockedPeerIds = res.peerIds;\r\n        });\r\n      };\r\n\r\n      updateBlocked();\r\n\r\n      this.managers.passwordManager.getState().then((state) => {\r\n        passwordState = state;\r\n        replaceContent(twoFactorRow.subtitle, i18n(state.pFlags.has_password ? 'PrivacyAndSecurity.Item.On' : 'PrivacyAndSecurity.Item.Off'));\r\n        twoFactorRow.freezed = false;\r\n\r\n        // console.log('password state', state);\r\n      });\r\n\r\n      this.updateActiveSessions();\r\n    }\r\n\r\n    {\r\n      const section = new SettingSection({name: 'PrivacyTitle', caption: 'GroupsAndChannelsHelp'});\r\n\r\n      section.content.classList.add('privacy-navigation-container');\r\n\r\n      const rowsByKeys: Partial<{\r\n        [key in InputPrivacyKey['_']]: Row\r\n      }> = {};\r\n\r\n      const numberVisibilityRow = rowsByKeys['inputPrivacyKeyPhoneNumber'] = new Row({\r\n        titleLangKey: 'PrivacyPhoneTitle',\r\n        subtitleLangKey: SUBTITLE,\r\n        clickable: () => {\r\n          this.slider.createTab(AppPrivacyPhoneNumberTab).open();\r\n        },\r\n        listenerSetter: this.listenerSetter\r\n      });\r\n\r\n      const lastSeenTimeRow = rowsByKeys['inputPrivacyKeyStatusTimestamp'] = new Row({\r\n        titleLangKey: 'LastSeenTitle',\r\n        subtitleLangKey: SUBTITLE,\r\n        clickable: () => {\r\n          this.slider.createTab(AppPrivacyLastSeenTab).open();\r\n        },\r\n        listenerSetter: this.listenerSetter\r\n      });\r\n\r\n      const photoVisibilityRow = rowsByKeys['inputPrivacyKeyProfilePhoto'] = new Row({\r\n        titleLangKey: 'PrivacyProfilePhotoTitle',\r\n        subtitleLangKey: SUBTITLE,\r\n        clickable: () => {\r\n          this.slider.createTab(AppPrivacyProfilePhotoTab).open();\r\n        },\r\n        listenerSetter: this.listenerSetter\r\n      });\r\n\r\n      const callRow = rowsByKeys['inputPrivacyKeyPhoneCall'] = new Row({\r\n        titleLangKey: 'WhoCanCallMe',\r\n        subtitleLangKey: SUBTITLE,\r\n        clickable: () => {\r\n          this.slider.createTab(AppPrivacyCallsTab).open();\r\n        },\r\n        listenerSetter: this.listenerSetter\r\n      });\r\n\r\n      const linkAccountRow = rowsByKeys['inputPrivacyKeyForwards'] = new Row({\r\n        titleLangKey: 'PrivacyForwardsTitle',\r\n        subtitleLangKey: SUBTITLE,\r\n        clickable: () => {\r\n          this.slider.createTab(AppPrivacyForwardMessagesTab).open();\r\n        },\r\n        listenerSetter: this.listenerSetter\r\n      });\r\n\r\n      const groupChatsAddRow = rowsByKeys['inputPrivacyKeyChatInvite'] = new Row({\r\n        titleLangKey: 'WhoCanAddMe',\r\n        subtitleLangKey: SUBTITLE,\r\n        clickable: () => {\r\n          this.slider.createTab(AppPrivacyAddToGroupsTab).open();\r\n        },\r\n        listenerSetter: this.listenerSetter\r\n      });\r\n\r\n      const voicesRow = rowsByKeys['inputPrivacyKeyVoiceMessages'] = new Row({\r\n        titleLangKey: 'PrivacyVoiceMessagesTitle',\r\n        subtitleLangKey: SUBTITLE,\r\n        clickable: () => {\r\n          if(!rootScope.premium) {\r\n            toastNew({langPackKey: 'PrivacyVoiceMessagesPremiumOnly'});\r\n          } else {\r\n            this.slider.createTab(AppPrivacyVoicesTab).open();\r\n          }\r\n        },\r\n        listenerSetter: this.listenerSetter\r\n      });\r\n\r\n      const updatePrivacyRow = (key: InputPrivacyKey['_']) => {\r\n        const row = rowsByKeys[key];\r\n        if(!row) {\r\n          return;\r\n        }\r\n\r\n        this.managers.appPrivacyManager.getPrivacy(key).then((rules) => {\r\n          const details = getPrivacyRulesDetails(rules);\r\n          const langKey = details.type === PrivacyType.Everybody ? 'PrivacySettingsController.Everbody' : (details.type === PrivacyType.Contacts ? 'PrivacySettingsController.MyContacts' : 'PrivacySettingsController.Nobody');\r\n          const disallowLength = details.disallowPeers.users.length + details.disallowPeers.chats.length;\r\n          const allowLength = details.allowPeers.users.length + details.allowPeers.chats.length;\r\n\r\n          row.subtitle.innerHTML = '';\r\n          const s = i18n(langKey);\r\n          row.subtitle.append(s);\r\n          if(disallowLength || allowLength) {\r\n            row.subtitle.append(` (${[-disallowLength, allowLength ? '+' + allowLength : 0].filter(Boolean).join(', ')})`);\r\n          }\r\n        });\r\n      };\r\n\r\n      section.content.append(\r\n        numberVisibilityRow.container,\r\n        lastSeenTimeRow.container,\r\n        photoVisibilityRow.container,\r\n        callRow.container,\r\n        linkAccountRow.container,\r\n        groupChatsAddRow.container,\r\n        voicesRow.container\r\n      );\r\n      this.scrollable.append(section.container);\r\n\r\n      for(const key in rowsByKeys) {\r\n        updatePrivacyRow(key as keyof typeof rowsByKeys);\r\n      }\r\n\r\n      rootScope.addEventListener('privacy_update', (update) => {\r\n        updatePrivacyRow(convertKeyToInputKey(update.key._) as any);\r\n      });\r\n    }\r\n\r\n    const promises: Promise<any>[] = [];\r\n\r\n    {\r\n      const section = new SettingSection({name: 'NewChatsFromNonContacts', caption: 'ArchiveAndMuteInfo'});\r\n\r\n      const checkboxField = new CheckboxField({text: 'ArchiveAndMute'});\r\n      const row = new Row({\r\n        checkboxField,\r\n        noCheckboxSubtitle: true\r\n      });\r\n\r\n      section.content.append(row.container);\r\n\r\n      let enabled: boolean, destroyed: boolean;\r\n      this.eventListener.addEventListener('destroy', () => {\r\n        destroyed = true;\r\n        if(enabled === undefined) return;\r\n        this.managers.appPrivacyManager.setGlobalPrivacySettings({\r\n          _: 'globalPrivacySettings',\r\n          archive_and_mute_new_noncontact_peers: checkboxField.checked\r\n        });\r\n      }, {once: true});\r\n\r\n      const promise = Promise.all([\r\n        this.managers.apiManager.getAppConfig(),\r\n        this.managers.appPrivacyManager.getGlobalPrivacySettings()\r\n      ]).then(([appConfig, settings]) => {\r\n        if(destroyed) {\r\n          return;\r\n        }\r\n\r\n        const onPremiumToggle = (isPremium: boolean) => {\r\n          section.container.classList.toggle('hide', !isPremium && !appConfig.autoarchive_setting_available);\r\n        };\r\n\r\n        this.listenerSetter.add(rootScope)('premium_toggle', onPremiumToggle);\r\n        onPremiumToggle(rootScope.premium);\r\n\r\n        enabled = settings.archive_and_mute_new_noncontact_peers;\r\n\r\n        checkboxField.setValueSilently(enabled);\r\n      });\r\n\r\n      promises.push(promise);\r\n\r\n      this.scrollable.append(section.container);\r\n    }\r\n\r\n    {\r\n      const section = new SettingSection({name: 'Privacy.SensitiveContent', caption: 'PrivacyAndSecurity.SensitiveDesc'});\r\n      section.container.classList.add('hide');\r\n\r\n      const checkboxField = new CheckboxField({text: 'PrivacyAndSecurity.SensitiveText'});\r\n      const row = new Row({\r\n        checkboxField,\r\n        noCheckboxSubtitle: true\r\n      });\r\n\r\n      section.content.append(row.container);\r\n\r\n      let enabled: boolean;\r\n      this.eventListener.addEventListener('destroy', () => {\r\n        if(enabled === undefined) return;\r\n        const _enabled = row.checkboxField.checked;\r\n        const isChanged = _enabled !== enabled;\r\n        if(!isChanged) {\r\n          return;\r\n        }\r\n\r\n        this.managers.apiManager.invokeApi('account.setContentSettings', {\r\n          sensitive_enabled: _enabled\r\n        });\r\n      }, {once: true});\r\n\r\n      const promise = this.managers.apiManager.invokeApi('account.getContentSettings').then((settings) => {\r\n        if(!settings.pFlags.sensitive_can_change) {\r\n          return;\r\n        }\r\n\r\n        enabled = !!settings.pFlags.sensitive_enabled;\r\n        checkboxField.setValueSilently(enabled);\r\n        section.container.classList.remove('hide');\r\n      });\r\n\r\n      promises.push(promise);\r\n\r\n      this.scrollable.append(section.container);\r\n    }\r\n\r\n    {\r\n      const section = new SettingSection({name: 'PrivacyPayments', caption: 'PrivacyPaymentsClearInfo'});\r\n\r\n      const onClearClick = () => {\r\n        const options: PopupConfirmationOptions = {\r\n          titleLangKey: 'PrivacyPaymentsClearAlertTitle',\r\n          descriptionLangKey: 'PrivacyPaymentsClearAlertText',\r\n          button: {\r\n            langKey: 'Clear'\r\n          },\r\n          checkboxes: [{\r\n            text: 'PrivacyClearShipping',\r\n            checked: true\r\n          }, {\r\n            text: 'PrivacyClearPayment',\r\n            checked: true\r\n          }]\r\n        };\r\n\r\n        confirmationPopup(options).then(() => {\r\n          const [info, payment] = options.checkboxes.map((c) => c.checkboxField.checked);\r\n          const toggle = toggleDisability([clearButton], true);\r\n          this.managers.appPaymentsManager.clearSavedInfo(info, payment).then(() => {\r\n            if(!info && !payment) {\r\n              return;\r\n            }\r\n\r\n            toggle();\r\n            toastNew({\r\n              langPackKey: info && payment ? 'PrivacyPaymentsPaymentShippingCleared' : (info ? 'PrivacyPaymentsShippingInfoCleared' : 'PrivacyPaymentsPaymentInfoCleared')\r\n            });\r\n          });\r\n        }, noop);\r\n      };\r\n\r\n      const clearButton = Button('btn-primary btn-transparent', {icon: 'delete', text: 'PrivacyPaymentsClear'});\r\n      this.listenerSetter.add(clearButton)('click', onClearClick);\r\n      section.content.append(clearButton);\r\n\r\n      this.scrollable.append(section.container);\r\n    }\r\n\r\n    {\r\n      const section = new SettingSection({name: 'FilterChats'});\r\n\r\n      const onDeleteClick = () => {\r\n        const popup = new PopupPeer('popup-delete-drafts', {\r\n          buttons: [{\r\n            langKey: 'Delete',\r\n            callback: () => {\r\n              const toggle = toggleDisability([deleteButton], true);\r\n              this.managers.appDraftsManager.clearAllDrafts().then(() => {\r\n                toggle();\r\n              });\r\n            },\r\n            isDanger: true\r\n          }],\r\n          titleLangKey: 'AreYouSureClearDraftsTitle',\r\n          descriptionLangKey: 'AreYouSureClearDrafts'\r\n        });\r\n\r\n        popup.show();\r\n      };\r\n\r\n      const deleteButton = Button('btn-primary btn-transparent', {icon: 'delete', text: 'PrivacyDeleteCloudDrafts'});\r\n      this.listenerSetter.add(deleteButton)('click', onDeleteClick);\r\n      section.content.append(deleteButton);\r\n\r\n      /* promises.push(apiManager.invokeApi('messages.getAllDrafts').then((drafts) => {\r\n        const draftsRow = new Row({\r\n          titleLangKey: 'PrivacyDeleteCloudDrafts',\r\n          subtitleLangKey: 'Drafts',\r\n          subtitleLangArgs: [(drafts as Updates.updates).updates.length],\r\n          icon: 'delete',\r\n          clickable: onDeleteClick\r\n        });\r\n\r\n        section.content.append(draftsRow.container);\r\n      })); */\r\n\r\n      this.scrollable.append(section.container);\r\n    }\r\n\r\n    return Promise.all(promises);\r\n  }\r\n\r\n  public updateActiveSessions() {\r\n    this.managers.apiManager.invokeApi('account.getAuthorizations').then((auths) => {\r\n      this.activeSessionsRow.freezed = false;\r\n      this.authorizations = auths.authorizations;\r\n      _i18n(this.activeSessionsRow.subtitle, 'Privacy.Devices', [this.authorizations.length]);\r\n      // console.log('auths', auths);\r\n    });\r\n  }\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport renderImageFromUrl from './dom/renderImageFromUrl';\r\n\r\nexport function averageColorFromCanvas(canvas: HTMLCanvasElement) {\r\n  const context = canvas.getContext('2d');\r\n\r\n  const pixel = new Array(4).fill(0);\r\n  const pixels = context.getImageData(0, 0, canvas.width, canvas.height).data;\r\n  const pixelsLength = pixels.length / 4;\r\n  for(let i = 0; i < pixels.length; i += 4) {\r\n    // const alphaPixel = pixels[i + 3];\r\n    pixel[0] += pixels[i]/*  * (alphaPixel / 255) */;\r\n    pixel[1] += pixels[i + 1]/*  * (alphaPixel / 255) */;\r\n    pixel[2] += pixels[i + 2]/*  * (alphaPixel / 255) */;\r\n    pixel[3] += pixels[i + 3];\r\n  }\r\n\r\n  const outPixel = new Uint8ClampedArray(4);\r\n  outPixel[0] = pixel[0] / pixelsLength;\r\n  outPixel[1] = pixel[1] / pixelsLength;\r\n  outPixel[2] = pixel[2] / pixelsLength;\r\n  outPixel[3] = pixel[3] / pixelsLength;\r\n  // outPixel[3] = 255;\r\n  return outPixel;\r\n}\r\n\r\nexport function averageColorFromImageSource(imageSource: CanvasImageSource, width: number, height: number) {\r\n  const canvas = document.createElement('canvas');\r\n  const ratio = width / height;\r\n  const DIMENSIONS = 50;\r\n  if(ratio === 1) {\r\n    canvas.width = DIMENSIONS;\r\n    canvas.height = canvas.width / ratio;\r\n  } else if(ratio > 1) {\r\n    canvas.height = DIMENSIONS;\r\n    canvas.width = canvas.height / ratio;\r\n  } else {\r\n    canvas.width = canvas.height = DIMENSIONS;\r\n  }\r\n\r\n  const context = canvas.getContext('2d');\r\n  context.drawImage(imageSource, 0, 0, width, height, 0, 0, canvas.width, canvas.height);\r\n  return averageColorFromCanvas(canvas);\r\n}\r\n\r\nexport function averageColor(imageUrl: string) {\r\n  const img = document.createElement('img');\r\n  return new Promise<Uint8ClampedArray>((resolve) => {\r\n    renderImageFromUrl(img, imageUrl, () => {\r\n      resolve(averageColorFromImageSource(img, img.naturalWidth, img.naturalHeight));\r\n    });\r\n  });\r\n};\r\n","import {rgbaToHsla} from './color';\r\n\r\n// * https://github.com/TelegramMessenger/Telegram-iOS/blob/3d062fff78cc6b287c74e6171f855a3500c0156d/submodules/TelegramPresentationData/Sources/PresentationData.swift#L453\r\nexport default function highlightningColor(rgba: [number, number, number, number?]) {\r\n  let {h, s, l} = rgbaToHsla(rgba[0], rgba[1], rgba[2]);\r\n  if(s > 0) {\r\n    s = Math.min(100, s + 5 + 0.1 * (100 - s));\r\n  }\r\n  l = Math.max(0, l * .65);\r\n\r\n  const hsla = `hsla(${h}, ${s}%, ${l}%, .4)`;\r\n  return hsla;\r\n}\r\n","import {ColorHsla, ColorRgba, hexaToHsla, hslaToRgba, rgbaToHexa as rgbaToHexa, rgbaToHsla} from '../helpers/color';\r\nimport attachGrabListeners from '../helpers/dom/attachGrabListeners';\r\nimport clamp from '../helpers/number/clamp';\r\nimport InputField, {InputState} from './inputField';\r\n\r\nexport type ColorPickerColor = {\r\n  hsl: string;\r\n  rgb: string;\r\n  hex: string;\r\n  hsla: string;\r\n  rgba: string;\r\n  hexa: string;\r\n  rgbaArray: ColorRgba;\r\n};\r\n\r\nexport default class ColorPicker {\r\n  private static BASE_CLASS = 'color-picker';\r\n  public container: HTMLElement;\r\n\r\n  private boxRect: DOMRect;\r\n  // private boxDraggerRect: DOMRect;\r\n  private hueRect: DOMRect;\r\n  // private hueDraggerRect: DOMRect;\r\n\r\n  private hue = 0;\r\n  private saturation = 100;\r\n  private lightness = 50;\r\n  private alpha = 1;\r\n  private elements: {\r\n    box: SVGSVGElement,\r\n    boxDragger: SVGSVGElement,\r\n    sliders: HTMLElement,\r\n    hue: SVGSVGElement,\r\n    hueDragger: SVGSVGElement,\r\n    saturation: SVGLinearGradientElement,\r\n  } = {} as any;\r\n  private hexInputField: InputField;\r\n  private rgbInputField: InputField;\r\n  public onChange: (color: ReturnType<ColorPicker['getCurrentColor']>) => void;\r\n\r\n  constructor() {\r\n    this.container = document.createElement('div');\r\n    this.container.classList.add(ColorPicker.BASE_CLASS);\r\n\r\n    const html = `\r\n      <svg class=\"${ColorPicker.BASE_CLASS + '-box'}\" viewBox=\"0 0 380 198\">\r\n        <defs>\r\n          <linearGradient id=\"color-picker-saturation\" x1=\"0%\" y1=\"0%\" x2=\"100%\" y2=\"0%\">\r\n            <stop offset=\"0%\" stop-color=\"#fff\"></stop>\r\n            <stop offset=\"100%\" stop-color=\"hsl(0,100%,50%)\"></stop>\r\n          </linearGradient>\r\n          <linearGradient id=\"color-picker-brightness\" x1=\"0%\" y1=\"0%\" x2=\"0%\" y2=\"100%\">\r\n            <stop offset=\"0%\" stop-color=\"rgba(0,0,0,0)\"></stop>\r\n            <stop offset=\"100%\" stop-color=\"#000\"></stop>\r\n          </linearGradient>\r\n          <pattern id=\"color-picker-pattern\" width=\"100%\" height=\"100%\">\r\n            <rect x=\"0\" y=\"0\" width=\"100%\" height=\"100%\" fill=\"url(#color-picker-saturation)\"></rect>\r\n            <rect x=\"0\" y=\"0\" width=\"100%\" height=\"100%\" fill=\"url(#color-picker-brightness)\"></rect>\r\n          </pattern>\r\n        </defs>\r\n        <rect rx=\"10\" ry=\"10\" x=\"0\" y=\"0\" width=\"380\" height=\"198\" fill=\"url(#color-picker-pattern)\"></rect>\r\n        <svg class=\"${ColorPicker.BASE_CLASS + '-dragger'} ${ColorPicker.BASE_CLASS + '-box-dragger'}\" x=\"0\" y=\"0\">\r\n          <circle r=\"11\" fill=\"inherit\" stroke=\"#fff\" stroke-width=\"2\"></circle>\r\n        </svg>\r\n      </svg>\r\n      <div class=\"${ColorPicker.BASE_CLASS + '-sliders'}\">\r\n        <svg class=\"${ColorPicker.BASE_CLASS + '-color-slider'}\" viewBox=\"0 0 380 24\">\r\n          <defs>\r\n            <linearGradient id=\"hue\" x1=\"100%\" y1=\"0%\" x2=\"0%\" y2=\"0%\">\r\n              <stop offset=\"0%\" stop-color=\"#f00\"></stop>\r\n              <stop offset=\"16.666%\" stop-color=\"#f0f\"></stop>\r\n              <stop offset=\"33.333%\" stop-color=\"#00f\"></stop>\r\n              <stop offset=\"50%\" stop-color=\"#0ff\"></stop>\r\n              <stop offset=\"66.666%\" stop-color=\"#0f0\"></stop>\r\n              <stop offset=\"83.333%\" stop-color=\"#ff0\"></stop>\r\n              <stop offset=\"100%\" stop-color=\"#f00\"></stop>\r\n            </linearGradient>\r\n          </defs>\r\n          <rect rx=\"4\" ry=\"4\" x=\"0\" y=\"9\" width=\"380\" height=\"8\" fill=\"url(#hue)\"></rect>\r\n          <svg class=\"${ColorPicker.BASE_CLASS + '-dragger'} ${ColorPicker.BASE_CLASS + '-color-slider-dragger'}\" x=\"0\" y=\"13\">\r\n            <circle r=\"11\" fill=\"inherit\" stroke=\"#fff\" stroke-width=\"2\"></circle>\r\n          </svg>\r\n        </svg>\r\n      </div>\r\n    `;\r\n\r\n    this.container.innerHTML = html;\r\n\r\n    this.elements.box = this.container.firstElementChild as any;\r\n    this.elements.boxDragger = this.elements.box.lastElementChild as any;\r\n    this.elements.saturation = this.elements.box.firstElementChild.firstElementChild as any;\r\n\r\n    this.elements.sliders = this.elements.box.nextElementSibling as any;\r\n\r\n    this.elements.hue = this.elements.sliders.firstElementChild as any;\r\n    this.elements.hueDragger = this.elements.hue.lastElementChild as any;\r\n\r\n    this.hexInputField = new InputField({plainText: true, label: 'Appearance.Color.Hex'});\r\n    this.rgbInputField = new InputField({plainText: true, label: 'Appearance.Color.RGB'});\r\n\r\n    const inputs = document.createElement('div');\r\n    inputs.className = ColorPicker.BASE_CLASS + '-inputs';\r\n    inputs.append(this.hexInputField.container, this.rgbInputField.container);\r\n    this.container.append(inputs);\r\n\r\n    this.hexInputField.input.addEventListener('input', () => {\r\n      let value = this.hexInputField.value.replace(/#/g, '').slice(0, 6);\r\n\r\n      const match = value.match(/([a-fA-F\\d]+)/);\r\n      const valid = match && match[0].length === value.length && [/* 3, 4,  */6].includes(value.length);\r\n      this.hexInputField.setState(valid ? InputState.Neutral : InputState.Error);\r\n\r\n      value = '#' + value;\r\n      this.hexInputField.setValueSilently(value);\r\n\r\n      if(valid) {\r\n        this.setColor(value, false, true);\r\n      }\r\n    });\r\n\r\n    // patched https://stackoverflow.com/a/34029238/6758968\r\n    const rgbRegExp = /^(?:rgb)?\\(?([01]?\\d\\d?|2[0-4]\\d|25[0-5])(?:\\W+)([01]?\\d\\d?|2[0-4]\\d|25[0-5])\\W+(?:([01]?\\d\\d?|2[0-4]\\d|25[0-5])\\)?)$/;\r\n    this.rgbInputField.input.addEventListener('input', () => {\r\n      const match = this.rgbInputField.value.match(rgbRegExp);\r\n      this.rgbInputField.setState(match ? InputState.Neutral : InputState.Error);\r\n\r\n      if(match) {\r\n        this.setColor(rgbaToHsla(+match[1], +match[2], +match[3]), true, false);\r\n      }\r\n    });\r\n\r\n    this.attachBoxListeners();\r\n    this.attachHueListeners();\r\n  }\r\n\r\n  private onGrabStart = () => {\r\n    document.documentElement.style.cursor = this.elements.boxDragger.style.cursor = 'grabbing';\r\n  };\r\n\r\n  private onGrabEnd = () => {\r\n    document.documentElement.style.cursor = this.elements.boxDragger.style.cursor = '';\r\n  };\r\n\r\n  private attachBoxListeners() {\r\n    attachGrabListeners(this.elements.box as any, () => {\r\n      this.onGrabStart();\r\n      this.boxRect = this.elements.box.getBoundingClientRect();\r\n      // this.boxDraggerRect = this.elements.boxDragger.getBoundingClientRect();\r\n    }, (pos) => {\r\n      this.saturationHandler(pos.x, pos.y);\r\n    }, () => {\r\n      this.onGrabEnd();\r\n    });\r\n  }\r\n\r\n  private attachHueListeners() {\r\n    attachGrabListeners(this.elements.hue as any, () => {\r\n      this.onGrabStart();\r\n      this.hueRect = this.elements.hue.getBoundingClientRect();\r\n      // this.hueDraggerRect = this.elements.hueDragger.getBoundingClientRect();\r\n    }, (pos) => {\r\n      this.hueHandler(pos.x);\r\n    }, () => {\r\n      this.onGrabEnd();\r\n    });\r\n  }\r\n\r\n  public setColor(color: ColorHsla | string, updateHexInput = true, updateRgbInput = true) {\r\n    if(color === undefined) { // * set to red\r\n      color = {\r\n        h: 0,\r\n        s: 100,\r\n        l: 50,\r\n        a: 1\r\n      };\r\n    } else if(typeof(color) === 'string') {\r\n      if(color[0] === '#') {\r\n        color = hexaToHsla(color);\r\n      } else {\r\n        const rgb = color.match(/[.?\\d]+/g);\r\n        color = rgbaToHsla(+rgb[0], +rgb[1], +rgb[2], rgb[3] === undefined ? 1 : +rgb[3]);\r\n      }\r\n    }\r\n\r\n    // Set box\r\n    this.boxRect = this.elements.box.getBoundingClientRect();\r\n\r\n    const boxX = this.boxRect.width / 100 * color.s;\r\n    const percentY = 100 - (color.l / (100 - color.s / 2)) * 100;\r\n    const boxY = this.boxRect.height / 100 * percentY;\r\n\r\n    this.saturationHandler(this.boxRect.left + boxX, this.boxRect.top + boxY, false);\r\n\r\n    // Set hue\r\n    this.hueRect = this.elements.hue.getBoundingClientRect();\r\n\r\n    const percentHue = color.h / 360;\r\n    const hueX = this.hueRect.left + this.hueRect.width * percentHue;\r\n\r\n    this.hueHandler(hueX, false);\r\n\r\n    // Set values\r\n    this.hue = color.h;\r\n    this.saturation = color.s;\r\n    this.lightness = color.l;\r\n    this.alpha = color.a;\r\n\r\n    this.updatePicker(updateHexInput, updateRgbInput);\r\n  };\r\n\r\n  public getCurrentColor(): ColorPickerColor {\r\n    const rgbaArray = hslaToRgba(this.hue, this.saturation, this.lightness, this.alpha);\r\n    const hexa = rgbaToHexa(rgbaArray);\r\n    const hex = hexa.slice(0, -2);\r\n\r\n    return {\r\n      hsl: `hsl(${this.hue}, ${this.saturation}%, ${this.lightness}%)`,\r\n      rgb: `rgb(${rgbaArray[0]}, ${rgbaArray[1]}, ${rgbaArray[2]})`,\r\n      hex: hex,\r\n      hsla: `hsla(${this.hue}, ${this.saturation}%, ${this.lightness}%, ${this.alpha})`,\r\n      rgba: `rgba(${rgbaArray[0]}, ${rgbaArray[1]}, ${rgbaArray[2]}, ${rgbaArray[3]})`,\r\n      hexa: hexa,\r\n      rgbaArray: rgbaArray\r\n    };\r\n  }\r\n\r\n  public updatePicker(updateHexInput = true, updateRgbInput = true) {\r\n    const color = this.getCurrentColor();\r\n    this.elements.boxDragger.setAttributeNS(null, 'fill', color.hex);\r\n\r\n    if(updateHexInput) {\r\n      this.hexInputField.setValueSilently(color.hex);\r\n      this.hexInputField.setState(InputState.Neutral);\r\n    }\r\n\r\n    if(updateRgbInput) {\r\n      this.rgbInputField.setValueSilently(color.rgbaArray.slice(0, -1).join(', '));\r\n      this.rgbInputField.setState(InputState.Neutral);\r\n    }\r\n\r\n    if(this.onChange) {\r\n      this.onChange(color);\r\n    }\r\n  }\r\n\r\n  private hueHandler(pageX: number, update = true) {\r\n    const eventX = clamp(pageX - this.hueRect.left, 0, this.hueRect.width);\r\n\r\n    const percents = eventX / this.hueRect.width;\r\n    this.hue = Math.round(360 * percents);\r\n\r\n    const hsla = `hsla(${this.hue}, 100%, 50%, ${this.alpha})`;\r\n\r\n    this.elements.hueDragger.setAttributeNS(null, 'x', (percents * 100) + '%');\r\n    this.elements.hueDragger.setAttributeNS(null, 'fill', hsla);\r\n\r\n    this.elements.saturation.lastElementChild.setAttributeNS(null, 'stop-color', hsla);\r\n\r\n    if(update) {\r\n      this.updatePicker();\r\n    }\r\n  }\r\n\r\n  private saturationHandler(pageX: number, pageY: number, update = true) {\r\n    const maxX = this.boxRect.width;\r\n    const maxY = this.boxRect.height;\r\n\r\n    const eventX = clamp(pageX - this.boxRect.left, 0, maxX);\r\n    const eventY = clamp(pageY - this.boxRect.top, 0, maxY);\r\n\r\n    const posX = eventX / maxX * 100;\r\n    const posY = eventY / maxY * 100;\r\n\r\n    const boxDragger = this.elements.boxDragger;\r\n    boxDragger.setAttributeNS(null, 'x', posX + '%');\r\n    boxDragger.setAttributeNS(null, 'y', posY + '%');\r\n\r\n    const saturation = clamp(posX, 0, 100);\r\n\r\n    const lightnessX = 100 - saturation / 2;\r\n    const lightnessY = 100 - clamp(posY, 0, 100);\r\n\r\n    const lightness = clamp(lightnessY / 100 * lightnessX, 0, 100);\r\n\r\n    this.saturation = saturation;\r\n    this.lightness = lightness;\r\n\r\n    if(update) {\r\n      this.updatePicker();\r\n    }\r\n  };\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport {SettingSection} from '..';\r\nimport {Theme} from '../../../config/state';\r\nimport {hexaToRgba} from '../../../helpers/color';\r\nimport {attachClickEvent} from '../../../helpers/dom/clickEvent';\r\nimport findUpClassName from '../../../helpers/dom/findUpClassName';\r\nimport highlightningColor from '../../../helpers/highlightningColor';\r\nimport throttle from '../../../helpers/schedulers/throttle';\r\nimport themeController from '../../../helpers/themeController';\r\nimport appImManager from '../../../lib/appManagers/appImManager';\r\nimport rootScope from '../../../lib/rootScope';\r\nimport ColorPicker, {ColorPickerColor} from '../../colorPicker';\r\nimport {SliderSuperTab} from '../../slider';\r\n\r\nexport default class AppBackgroundColorTab extends SliderSuperTab {\r\n  private colorPicker: ColorPicker;\r\n  private grid: HTMLElement;\r\n  private applyColor: (hex: string, updateColorPicker?: boolean) => void;\r\n  private theme: Theme;\r\n\r\n  init() {\r\n    this.header.classList.add('with-border');\r\n    this.container.classList.add('background-container', 'background-color-container');\r\n    this.setTitle('SetColor');\r\n\r\n    this.theme = themeController.getTheme();\r\n\r\n    const section = new SettingSection({});\r\n    this.colorPicker = new ColorPicker();\r\n\r\n    section.content.append(this.colorPicker.container);\r\n\r\n    this.scrollable.append(section.container);\r\n\r\n    const gridSection = new SettingSection({});\r\n\r\n    const grid = this.grid = document.createElement('div');\r\n    grid.classList.add('grid');\r\n\r\n    const colors = [\r\n      '#E6EBEE',\r\n      '#B2CEE1',\r\n      '#008DD0',\r\n      '#C6E7CB',\r\n      '#C4E1A6',\r\n      '#60B16E',\r\n      '#CCD0AF',\r\n      '#A6A997',\r\n      '#7A7072',\r\n      '#FDD7AF',\r\n      '#FDB76E',\r\n      '#DD8851'\r\n    ];\r\n\r\n    colors.forEach((color) => {\r\n      const item = document.createElement('div');\r\n      item.classList.add('grid-item');\r\n      item.dataset.color = color.toLowerCase();\r\n\r\n      // * need for transform scale\r\n      const media = document.createElement('div');\r\n      media.classList.add('grid-item-media');\r\n      media.style.backgroundColor = color;\r\n\r\n      item.append(media);\r\n      grid.append(item);\r\n    });\r\n\r\n    attachClickEvent(grid, (e) => {\r\n      const target = findUpClassName(e.target, 'grid-item');\r\n      if(!target || target.classList.contains('active')) {\r\n        return;\r\n      }\r\n\r\n      const color = target.dataset.color;\r\n      if(!color) {\r\n        return;\r\n      }\r\n\r\n      this.applyColor(color);\r\n    }, {listenerSetter: this.listenerSetter});\r\n\r\n    gridSection.content.append(grid);\r\n    this.scrollable.append(gridSection.container);\r\n\r\n    this.applyColor = throttle(this._applyColor, 16, true);\r\n  }\r\n\r\n  private setActive() {\r\n    const active = this.grid.querySelector('.active');\r\n    const background = this.theme.background;\r\n    const target = background.color ? this.grid.querySelector(`.grid-item[data-color=\"${background.color}\"]`) : null;\r\n    if(active === target) {\r\n      return;\r\n    }\r\n\r\n    if(active) {\r\n      active.classList.remove('active');\r\n    }\r\n\r\n    if(target) {\r\n      target.classList.add('active');\r\n    }\r\n  }\r\n\r\n  private _applyColor = (hex: string, updateColorPicker = true) => {\r\n    if(updateColorPicker) {\r\n      this.colorPicker.setColor(hex);\r\n    } else {\r\n      const rgba = hexaToRgba(hex);\r\n      const background = this.theme.background;\r\n      const hsla = highlightningColor(rgba);\r\n\r\n      background.id = '2';\r\n      background.intensity = 0;\r\n      background.slug = '';\r\n      background.color = hex.toLowerCase();\r\n      background.highlightningColor = hsla;\r\n      this.managers.appStateManager.pushToState('settings', rootScope.settings);\r\n\r\n      appImManager.applyCurrentTheme(undefined, undefined, true);\r\n      this.setActive();\r\n    }\r\n  };\r\n\r\n  private onColorChange = (color: ColorPickerColor) => {\r\n    this.applyColor(color.hex, false);\r\n  };\r\n\r\n  onOpen() {\r\n    setTimeout(() => {\r\n      const background = this.theme.background;\r\n\r\n      const color = (background.color || '').split(',')[0];\r\n      const isColored = !!color && !background.slug;\r\n\r\n      // * set active if type is color\r\n      if(isColored) {\r\n        this.colorPicker.onChange = this.onColorChange;\r\n      }\r\n\r\n      this.colorPicker.setColor(color || '#cccccc');\r\n\r\n      if(!isColored) {\r\n        this.colorPicker.onChange = this.onColorChange;\r\n      }\r\n    }, 0);\r\n  }\r\n\r\n  onCloseAfterTimeout() {\r\n    this.colorPicker.onChange = undefined;\r\n    this.colorPicker = undefined;\r\n\r\n    return super.onCloseAfterTimeout();\r\n  }\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport {generateSection} from '..';\r\nimport {averageColor, averageColorFromCanvas} from '../../../helpers/averageColor';\r\nimport blur from '../../../helpers/blur';\r\nimport deferredPromise, {CancellablePromise} from '../../../helpers/cancellablePromise';\r\nimport {attachClickEvent} from '../../../helpers/dom/clickEvent';\r\nimport findUpClassName from '../../../helpers/dom/findUpClassName';\r\nimport highlightningColor from '../../../helpers/highlightningColor';\r\nimport copy from '../../../helpers/object/copy';\r\nimport sequentialDom from '../../../helpers/sequentialDom';\r\nimport ChatBackgroundGradientRenderer from '../../chat/gradientRenderer';\r\nimport {Document, PhotoSize, WallPaper} from '../../../layer';\r\nimport {MyDocument} from '../../../lib/appManagers/appDocsManager';\r\nimport appDownloadManager, {AppDownloadManager, DownloadBlob} from '../../../lib/appManagers/appDownloadManager';\r\nimport appImManager from '../../../lib/appManagers/appImManager';\r\nimport rootScope from '../../../lib/rootScope';\r\nimport Button from '../../button';\r\nimport CheckboxField from '../../checkboxField';\r\nimport ProgressivePreloader from '../../preloader';\r\nimport {SliderSuperTab} from '../../slider';\r\nimport {wrapPhoto} from '../../wrappers';\r\nimport AppBackgroundColorTab from './backgroundColor';\r\nimport choosePhotoSize from '../../../lib/appManagers/utils/photos/choosePhotoSize';\r\nimport {STATE_INIT, Theme} from '../../../config/state';\r\nimport themeController from '../../../helpers/themeController';\r\nimport requestFile from '../../../helpers/files/requestFile';\r\nimport {renderImageFromUrlPromise} from '../../../helpers/dom/renderImageFromUrl';\r\nimport scaleMediaElement from '../../../helpers/canvas/scaleMediaElement';\r\nimport {MediaSize} from '../../../helpers/mediaSize';\r\n\r\nexport default class AppBackgroundTab extends SliderSuperTab {\r\n  private grid: HTMLElement;\r\n  private tempId = 0;\r\n  private clicked: Set<DocId> = new Set();\r\n  private blurCheckboxField: CheckboxField;\r\n\r\n  private wallPapersByElement: Map<HTMLElement, WallPaper> = new Map();\r\n  private elementsByKey: Map<string, HTMLElement> = new Map();\r\n\r\n  private get theme() {\r\n    return themeController.getTheme();\r\n  }\r\n\r\n  init() {\r\n    this.header.classList.add('with-border');\r\n    this.container.classList.add('background-container', 'background-image-container');\r\n    this.setTitle('ChatBackground');\r\n\r\n    {\r\n      const container = generateSection(this.scrollable);\r\n\r\n      const uploadButton = Button('btn-primary btn-transparent', {icon: 'cameraadd', text: 'ChatBackground.UploadWallpaper'});\r\n      const colorButton = Button('btn-primary btn-transparent', {icon: 'colorize', text: 'SetColor'});\r\n      const resetButton = Button('btn-primary btn-transparent', {icon: 'favourites', text: 'Appearance.Reset'});\r\n\r\n      attachClickEvent(uploadButton, this.onUploadClick, {listenerSetter: this.listenerSetter});\r\n\r\n      attachClickEvent(colorButton, () => {\r\n        this.slider.createTab(AppBackgroundColorTab).open();\r\n      }, {listenerSetter: this.listenerSetter});\r\n\r\n      attachClickEvent(resetButton, this.onResetClick, {listenerSetter: this.listenerSetter});\r\n\r\n      const blurCheckboxField = this.blurCheckboxField = new CheckboxField({\r\n        text: 'ChatBackground.Blur',\r\n        name: 'blur',\r\n        checked: this.theme.background.blur,\r\n        withRipple: true\r\n      });\r\n\r\n      this.listenerSetter.add(blurCheckboxField.input)('change', async() => {\r\n        this.theme.background.blur = blurCheckboxField.input.checked;\r\n        await this.managers.appStateManager.pushToState('settings', rootScope.settings);\r\n\r\n        // * wait for animation end\r\n        setTimeout(() => {\r\n          const active = grid.querySelector('.active') as HTMLElement;\r\n          if(!active) return;\r\n\r\n          const wallpaper = this.wallPapersByElement.get(active);\r\n          if((wallpaper as WallPaper.wallPaper).pFlags.pattern || wallpaper._ === 'wallPaperNoFile') {\r\n            return;\r\n          }\r\n\r\n          this.setBackgroundDocument(wallpaper);\r\n        }, 100);\r\n      });\r\n\r\n      container.append(uploadButton, colorButton, resetButton, blurCheckboxField.label);\r\n    }\r\n\r\n    rootScope.addEventListener('background_change', this.setActive);\r\n\r\n    this.managers.appDocsManager.getWallPapers().then((wallPapers) => {\r\n      wallPapers.forEach((wallPaper) => {\r\n        this.addWallPaper(wallPaper);\r\n      });\r\n    });\r\n\r\n    const gridContainer = generateSection(this.scrollable);\r\n    const grid = this.grid = document.createElement('div');\r\n    grid.classList.add('grid');\r\n    attachClickEvent(grid, this.onGridClick, {listenerSetter: this.listenerSetter});\r\n    gridContainer.append(grid);\r\n  }\r\n\r\n  private onUploadClick = () => {\r\n    requestFile('image/x-png,image/png,image/jpeg').then(async(file) => {\r\n      if(file.name.endsWith('.png')) {\r\n        const img = document.createElement('img');\r\n        const url = URL.createObjectURL(file);\r\n        await renderImageFromUrlPromise(img, url, false);\r\n        const mimeType = 'image/jpeg';\r\n        const {blob} = await scaleMediaElement({media: img, size: new MediaSize(img.naturalWidth, img.naturalHeight), mimeType});\r\n        file = new File([blob], file.name.replace(/\\.png$/, '.jpg'), {type: mimeType});\r\n      }\r\n\r\n      const wallPaper = await this.managers.appDocsManager.prepareWallPaperUpload(file);\r\n      const uploadPromise = this.managers.appDocsManager.uploadWallPaper(wallPaper.id);\r\n      const uploadDeferred: CancellablePromise<any> = appDownloadManager.getNewDeferredForUpload(file.name, uploadPromise);\r\n\r\n      const deferred = deferredPromise<void>();\r\n      deferred.addNotifyListener = uploadDeferred.addNotifyListener;\r\n      deferred.cancel = uploadDeferred.cancel;\r\n\r\n      uploadDeferred.then((wallPaper) => {\r\n        this.clicked.delete(key);\r\n        this.elementsByKey.delete(key);\r\n        this.wallPapersByElement.set(container, wallPaper);\r\n        const newKey = this.getWallPaperKey(wallPaper);\r\n        this.elementsByKey.set(newKey, container);\r\n\r\n        this.setBackgroundDocument(wallPaper).then(deferred.resolve, deferred.reject);\r\n      }, deferred.reject);\r\n\r\n      const key = this.getWallPaperKey(wallPaper);\r\n      deferred.catch(() => {\r\n        container.remove();\r\n      });\r\n\r\n      const preloader = new ProgressivePreloader({\r\n        isUpload: true,\r\n        cancelable: true,\r\n        tryAgainOnFail: false\r\n      });\r\n\r\n      const container = this.addWallPaper(wallPaper, false);\r\n      this.clicked.add(key);\r\n\r\n      preloader.attach(container, false, deferred);\r\n    });\r\n  };\r\n\r\n  private onResetClick = () => {\r\n    const defaultTheme = STATE_INIT.settings.themes.find((t) => t.name === this.theme.name);\r\n    if(defaultTheme) {\r\n      ++this.tempId;\r\n      this.theme.background = copy(defaultTheme.background);\r\n      this.managers.appStateManager.pushToState('settings', rootScope.settings);\r\n      appImManager.applyCurrentTheme(undefined, undefined, true);\r\n      this.blurCheckboxField.setValueSilently(this.theme.background.blur);\r\n    }\r\n  };\r\n\r\n  private getColorsFromWallPaper(wallPaper: WallPaper) {\r\n    return wallPaper.settings ? [\r\n      wallPaper.settings.background_color,\r\n      wallPaper.settings.second_background_color,\r\n      wallPaper.settings.third_background_color,\r\n      wallPaper.settings.fourth_background_color\r\n    ].filter(Boolean).map((color) => '#' + color.toString(16)).join(',') : '';\r\n  }\r\n\r\n  private getWallPaperKey(wallPaper: WallPaper) {\r\n    return '' + wallPaper.id;\r\n  }\r\n\r\n  private getWallPaperKeyFromTheme(theme: Theme) {\r\n    return '' + theme.background.id;\r\n  }\r\n\r\n  private addWallPaper(wallPaper: WallPaper, append = true) {\r\n    const colors = this.getColorsFromWallPaper(wallPaper);\r\n    const hasFile = wallPaper._ === 'wallPaper';\r\n    if((hasFile && wallPaper.pFlags.pattern && !colors)/*  ||\r\n      (wallpaper.document as MyDocument).mime_type.indexOf('application/') === 0 */) {\r\n      return;\r\n    }\r\n\r\n    const isDark = !!wallPaper.pFlags.dark;\r\n\r\n    const doc = hasFile ? wallPaper.document as Document.document : undefined;\r\n\r\n    const container = document.createElement('div');\r\n    container.classList.add('grid-item');\r\n\r\n    container.dataset.id = '' + wallPaper.id;\r\n\r\n    const key = this.getWallPaperKey(wallPaper);\r\n    this.wallPapersByElement.set(container, wallPaper);\r\n    this.elementsByKey.set(key, container);\r\n\r\n    const media = document.createElement('div');\r\n    media.classList.add('grid-item-media');\r\n\r\n    let wrapped: ReturnType<typeof wrapPhoto>, size: ReturnType<typeof choosePhotoSize>;\r\n    if(hasFile) {\r\n      size = choosePhotoSize(doc, 200, 200);\r\n      wrapped = wrapPhoto({\r\n        photo: doc,\r\n        message: null,\r\n        container: media,\r\n        withoutPreloader: true,\r\n        size: size,\r\n        noFadeIn: wallPaper.pFlags.pattern\r\n      });\r\n\r\n      if(wallPaper.pFlags.pattern) {\r\n        media.classList.add('is-pattern');\r\n      }\r\n\r\n      wrapped.then(async({loadPromises, images}) => {\r\n        await loadPromises.thumb || loadPromises.full;\r\n        return images;\r\n      }).then((images) => {\r\n        if(wallPaper.pFlags.pattern) {\r\n          if(isDark) {\r\n            images.full.style.display = 'none';\r\n            if(images.thumb) {\r\n              images.thumb.style.display = 'none';\r\n            }\r\n          } else if(wallPaper.settings?.intensity) {\r\n            images.full.style.opacity = '' + Math.abs(wallPaper.settings.intensity) / 100;\r\n          }\r\n        }\r\n\r\n        sequentialDom.mutate(() => {\r\n          container.append(media);\r\n        });\r\n      });\r\n    } else {\r\n      container.append(media);\r\n    }\r\n\r\n    if(wallPaper.settings && wallPaper.settings.background_color !== undefined) {\r\n      const {canvas} = ChatBackgroundGradientRenderer.create(colors);\r\n      canvas.classList.add('background-colors-canvas');\r\n\r\n      if(isDark && hasFile) {\r\n        wrapped.then(({loadPromises}) => {\r\n          loadPromises.full.then(async() => {\r\n            const cacheContext = await this.managers.thumbsStorage.getCacheContext(doc, size.type);\r\n            canvas.style.webkitMaskImage = `url(${cacheContext.url})`;\r\n            canvas.style.opacity = '' + (wallPaper.pFlags.dark ? 100 + wallPaper.settings.intensity : wallPaper.settings.intensity) / 100;\r\n            media.append(canvas);\r\n          });\r\n        });\r\n      } else {\r\n        media.append(canvas);\r\n      }\r\n    }\r\n\r\n    if(this.getWallPaperKeyFromTheme(this.theme) === key) {\r\n      container.classList.add('active');\r\n    }\r\n\r\n    this.grid[append ? 'append' : 'prepend'](container);\r\n\r\n    return container;\r\n  }\r\n\r\n  private onGridClick = (e: MouseEvent | TouchEvent) => {\r\n    const target = findUpClassName(e.target, 'grid-item') as HTMLElement;\r\n    if(!target) return;\r\n\r\n    const wallpaper = this.wallPapersByElement.get(target);\r\n    if(wallpaper._ === 'wallPaperNoFile') {\r\n      this.setBackgroundDocument(wallpaper);\r\n      return;\r\n    }\r\n\r\n    const key = this.getWallPaperKey(wallpaper);\r\n    if(this.clicked.has(key)) return;\r\n    this.clicked.add(key);\r\n\r\n    const doc = wallpaper.document as MyDocument;\r\n    const preloader = new ProgressivePreloader({\r\n      cancelable: true,\r\n      tryAgainOnFail: false\r\n    });\r\n\r\n    const load = async() => {\r\n      const promise = this.setBackgroundDocument(wallpaper);\r\n      const cacheContext = await this.managers.thumbsStorage.getCacheContext(doc);\r\n      if(!cacheContext.url || this.theme.background.blur) {\r\n        preloader.attach(target, true, promise);\r\n      }\r\n    };\r\n\r\n    preloader.construct();\r\n\r\n    attachClickEvent(target, (e) => {\r\n      if(preloader.preloader.parentElement) {\r\n        preloader.onClick(e);\r\n        preloader.detach();\r\n      } else {\r\n        load();\r\n      }\r\n    }, {listenerSetter: this.listenerSetter});\r\n\r\n    load();\r\n\r\n    // console.log(doc);\r\n  };\r\n\r\n  private saveToCache = (slug: string, url: string) => {\r\n    fetch(url).then((response) => {\r\n      appImManager.cacheStorage.save('backgrounds/' + slug, response);\r\n    });\r\n  };\r\n\r\n  private setBackgroundDocument = (wallPaper: WallPaper) => {\r\n    const _tempId = ++this.tempId;\r\n    const middleware = () => _tempId === this.tempId;\r\n\r\n    const doc = (wallPaper as WallPaper.wallPaper).document as MyDocument;\r\n    const deferred = deferredPromise<void>();\r\n    let download: Promise<void> | ReturnType<AppDownloadManager['downloadMediaURL']>;\r\n    if(doc) {\r\n      download = appDownloadManager.downloadMediaURL({media: doc, queueId: appImManager.chat.bubbles ? appImManager.chat.bubbles.lazyLoadQueue.queueId : 0});\r\n      deferred.addNotifyListener = download.addNotifyListener;\r\n      deferred.cancel = download.cancel;\r\n    } else {\r\n      download = Promise.resolve();\r\n    }\r\n\r\n    download.then(async() => {\r\n      if(!middleware()) {\r\n        deferred.resolve();\r\n        return;\r\n      }\r\n\r\n      const background = this.theme.background;\r\n      const onReady = (url?: string) => {\r\n        // const perf = performance.now();\r\n        let getPixelPromise: Promise<Uint8ClampedArray>;\r\n        if(url && !this.theme.background.color) {\r\n          getPixelPromise = averageColor(url);\r\n        } else {\r\n          const {canvas} = ChatBackgroundGradientRenderer.create(this.getColorsFromWallPaper(wallPaper));\r\n          getPixelPromise = Promise.resolve(averageColorFromCanvas(canvas));\r\n        }\r\n\r\n        getPixelPromise.then((pixel) => {\r\n          if(!middleware()) {\r\n            deferred.resolve();\r\n            return;\r\n          }\r\n\r\n          const hsla = highlightningColor(Array.from(pixel) as any);\r\n          // const hsla = 'rgba(0, 0, 0, 0.3)';\r\n          // console.log(doc, hsla, performance.now() - perf);\r\n\r\n          const slug = (wallPaper as WallPaper.wallPaper).slug ?? '';\r\n          background.id = wallPaper.id;\r\n          background.intensity = wallPaper.settings?.intensity ?? 0;\r\n          background.color = this.getColorsFromWallPaper(wallPaper);\r\n          background.slug = slug;\r\n          background.highlightningColor = hsla;\r\n          this.managers.appStateManager.pushToState('settings', rootScope.settings);\r\n\r\n          if(slug) {\r\n            this.saveToCache(slug, url);\r\n          }\r\n\r\n          appImManager.applyCurrentTheme(slug, url, true).then(deferred.resolve);\r\n        });\r\n      };\r\n\r\n      if(!doc) {\r\n        onReady();\r\n        return;\r\n      }\r\n\r\n      const cacheContext = await this.managers.thumbsStorage.getCacheContext(doc);\r\n      if(background.blur) {\r\n        setTimeout(() => {\r\n          const {canvas, promise} = blur(cacheContext.url, 12, 4)\r\n          promise.then(() => {\r\n            if(!middleware()) {\r\n              deferred.resolve();\r\n              return;\r\n            }\r\n\r\n            onReady(canvas.toDataURL());\r\n          });\r\n        }, 200);\r\n      } else {\r\n        onReady(cacheContext.url);\r\n      }\r\n    });\r\n\r\n    return deferred;\r\n  };\r\n\r\n  private setActive = () => {\r\n    const active = this.grid.querySelector('.active');\r\n    const target = this.elementsByKey.get(this.getWallPaperKeyFromTheme(this.theme));\r\n    if(active === target) {\r\n      return;\r\n    }\r\n\r\n    if(active) {\r\n      active.classList.remove('active');\r\n    }\r\n\r\n    if(target) {\r\n      target.classList.add('active');\r\n    }\r\n  };\r\n}\r\n","export default function requestFile(accept?: string) {\n  const input = document.createElement('input');\n  input.type = 'file';\n  input.style.display = 'none';\n\n  if(accept) {\n    input.accept = accept;\n  }\n\n  document.body.append(input);\n\n  const promise = new Promise<File>((resolve, reject) => {\n    input.addEventListener('change', (e: any) => {\n      const file: File = e.target.files[0];\n      if(!file) {\n        reject('NO_FILE_SELECTED');\n        return;\n      }\n\n      resolve(file);\n    }, {once: true});\n  }).finally(() => {\n    input.remove();\n  });\n\n  input.click();\n\n  return promise;\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport {SettingSection} from '..';\nimport RadioField from '../../radioField';\nimport Row, {RadioFormFromRows} from '../../row';\nimport SliderSuperTab from '../../sliderTab';\nimport {wrapStickerToRow} from '../../wrappers';\n\nexport default class AppQuickReactionTab extends SliderSuperTab {\n  protected init() {\n    this.header.classList.add('with-border');\n    this.setTitle('DoubleTapSetting');\n    this.container.classList.add('quick-reaction-container');\n\n    return Promise.all([\n      this.managers.appReactionsManager.getQuickReaction(),\n      this.managers.appReactionsManager.getAvailableReactions()\n    ]).then(([quickReaction, availableReactions]) => {\n      availableReactions = availableReactions.filter((reaction) => !reaction.pFlags.inactive);\n\n      const section = new SettingSection();\n\n      const name = 'quick-reaction';\n      const rows = availableReactions.map((availableReaction) => {\n        const radioField = new RadioField({\n          name,\n          text: availableReaction.title,\n          value: availableReaction.reaction,\n          alignRight: true\n        });\n\n        const row = new Row({\n          radioField,\n          havePadding: true\n        });\n\n        radioField.main.classList.add('quick-reaction-title');\n\n        wrapStickerToRow({\n          row,\n          doc: availableReaction.static_icon,\n          size: 'small'\n        });\n\n        if(availableReaction.reaction === quickReaction.reaction) {\n          radioField.setValueSilently(true);\n        }\n\n        return row;\n      });\n\n      const form = RadioFormFromRows(rows, (value) => {\n        this.managers.appReactionsManager.setDefaultReaction(value);\n      });\n\n      section.content.append(form);\n      this.scrollable.append(section.container);\n    });\n  }\n}\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport {generateSection, SettingSection} from '..';\r\nimport RangeSelector from '../../rangeSelector';\r\nimport Button from '../../button';\r\nimport CheckboxField from '../../checkboxField';\r\nimport RadioField from '../../radioField';\r\nimport rootScope from '../../../lib/rootScope';\r\nimport {IS_APPLE} from '../../../environment/userAgent';\r\nimport Row from '../../row';\r\nimport AppBackgroundTab from './background';\r\nimport {LangPackKey, _i18n} from '../../../lib/langPack';\r\nimport {attachClickEvent} from '../../../helpers/dom/clickEvent';\r\nimport assumeType from '../../../helpers/assumeType';\r\nimport {MessagesAllStickers, StickerSet} from '../../../layer';\r\nimport {wrapStickerSetThumb, wrapStickerToRow} from '../../wrappers';\r\nimport LazyLoadQueue from '../../lazyLoadQueue';\r\nimport PopupStickers from '../../popups/stickers';\r\nimport eachMinute from '../../../helpers/eachMinute';\r\nimport {SliderSuperTabEventable} from '../../sliderTab';\r\nimport IS_GEOLOCATION_SUPPORTED from '../../../environment/geolocationSupport';\r\nimport AppQuickReactionTab from './quickReaction';\r\nimport wrapEmojiText from '../../../lib/richTextProcessor/wrapEmojiText';\r\nimport {State} from '../../../config/state';\r\n\r\nexport class RangeSettingSelector {\r\n  public container: HTMLDivElement;\r\n  public valueContainer: HTMLElement;\r\n  private range: RangeSelector;\r\n\r\n  public onChange: (value: number) => void;\r\n\r\n  constructor(\r\n    name: LangPackKey,\r\n    step: number,\r\n    initialValue: number,\r\n    minValue: number,\r\n    maxValue: number,\r\n    writeValue = true\r\n  ) {\r\n    const BASE_CLASS = 'range-setting-selector';\r\n    this.container = document.createElement('div');\r\n    this.container.classList.add(BASE_CLASS);\r\n\r\n    const details = document.createElement('div');\r\n    details.classList.add(BASE_CLASS + '-details');\r\n\r\n    const nameDiv = document.createElement('div');\r\n    nameDiv.classList.add(BASE_CLASS + '-name');\r\n    _i18n(nameDiv, name);\r\n\r\n    const valueDiv = this.valueContainer = document.createElement('div');\r\n    valueDiv.classList.add(BASE_CLASS + '-value');\r\n\r\n    if(writeValue) {\r\n      valueDiv.innerHTML = '' + initialValue;\r\n    }\r\n\r\n    details.append(nameDiv, valueDiv);\r\n\r\n    this.range = new RangeSelector({\r\n      step,\r\n      min: minValue,\r\n      max: maxValue\r\n    }, initialValue);\r\n    this.range.setListeners();\r\n    this.range.setHandlers({\r\n      onScrub: value => {\r\n        if(this.onChange) {\r\n          this.onChange(value);\r\n        }\r\n\r\n        if(writeValue) {\r\n          // console.log('font size scrub:', value);\r\n          valueDiv.innerText = '' + value;\r\n        }\r\n      }\r\n    });\r\n\r\n    this.container.append(details, this.range.container);\r\n  }\r\n}\r\n\r\nexport default class AppGeneralSettingsTab extends SliderSuperTabEventable {\r\n  init() {\r\n    this.header.classList.add('with-border');\r\n    this.container.classList.add('general-settings-container');\r\n    this.setTitle('General');\r\n\r\n    const section = generateSection.bind(null, this.scrollable);\r\n\r\n    {\r\n      const container = section('Settings');\r\n\r\n      const range = new RangeSettingSelector('TextSize', 1, rootScope.settings.messagesTextSize, 12, 20);\r\n      range.onChange = (value) => {\r\n        rootScope.managers.appStateManager.setByKey('settings.messagesTextSize', value);\r\n      };\r\n\r\n      const chatBackgroundButton = Button('btn-primary btn-transparent', {icon: 'image', text: 'ChatBackground'});\r\n\r\n      attachClickEvent(chatBackgroundButton, () => {\r\n        this.slider.createTab(AppBackgroundTab).open();\r\n      });\r\n\r\n      const animationsCheckboxField = new CheckboxField({\r\n        text: 'EnableAnimations',\r\n        name: 'animations',\r\n        stateKey: 'settings.animationsEnabled',\r\n        withRipple: true,\r\n        listenerSetter: this.listenerSetter\r\n      });\r\n\r\n      container.append(range.container, chatBackgroundButton, animationsCheckboxField.label);\r\n    }\r\n\r\n    {\r\n      const container = section('General.Keyboard');\r\n\r\n      const form = document.createElement('form');\r\n\r\n      const name = 'send-shortcut';\r\n      const stateKey = 'settings.sendShortcut';\r\n\r\n      const enterRow = new Row({\r\n        radioField: new RadioField({\r\n          langKey: 'General.SendShortcut.Enter',\r\n          name,\r\n          value: 'enter',\r\n          stateKey\r\n        }),\r\n        subtitleLangKey: 'General.SendShortcut.NewLine.ShiftEnter'\r\n      });\r\n\r\n      const ctrlEnterRow = new Row({\r\n        radioField: new RadioField({\r\n          name,\r\n          value: 'ctrlEnter',\r\n          stateKey\r\n        }),\r\n        subtitleLangKey: 'General.SendShortcut.NewLine.Enter'\r\n      });\r\n      _i18n(ctrlEnterRow.radioField.main, 'General.SendShortcut.CtrlEnter', [IS_APPLE ? '' : 'Ctrl']);\r\n\r\n      form.append(enterRow.container, ctrlEnterRow.container);\r\n      container.append(form);\r\n    }\r\n\r\n    if(IS_GEOLOCATION_SUPPORTED) {\r\n      const container = section('DistanceUnitsTitle');\r\n\r\n      const form = document.createElement('form');\r\n\r\n      const name = 'distance-unit';\r\n      const stateKey = 'settings.distanceUnit';\r\n\r\n      const kilometersRow = new Row({\r\n        radioField: new RadioField({\r\n          langKey: 'DistanceUnitsKilometers',\r\n          name,\r\n          value: 'kilometers',\r\n          stateKey\r\n        })\r\n      });\r\n\r\n      const milesRow = new Row({\r\n        radioField: new RadioField({\r\n          langKey: 'DistanceUnitsMiles',\r\n          name,\r\n          value: 'miles',\r\n          stateKey\r\n        })\r\n      });\r\n\r\n      form.append(kilometersRow.container, milesRow.container);\r\n      container.append(form);\r\n    }\r\n\r\n    {\r\n      const container = section('General.TimeFormat');\r\n\r\n      const form = document.createElement('form');\r\n\r\n      const name = 'time-format';\r\n      const stateKey = 'settings.timeFormat';\r\n\r\n      const formats: [State['settings']['timeFormat'], LangPackKey][] = [\r\n        ['h12', 'General.TimeFormat.h12'],\r\n        ['h23', 'General.TimeFormat.h23']\r\n      ];\r\n\r\n      const rows = formats.map(([format, langPackKey]) => {\r\n        const row = new Row({\r\n          radioField: new RadioField({\r\n            langKey: langPackKey,\r\n            name,\r\n            value: format,\r\n            stateKey\r\n          })\r\n        });\r\n\r\n        return row;\r\n      });\r\n\r\n      const cancel = eachMinute(() => {\r\n        const date = new Date();\r\n\r\n        formats.forEach(([format], idx) => {\r\n          const str = date.toLocaleTimeString('en-us-u-hc-' + format, {\r\n            hour: '2-digit',\r\n            minute: '2-digit'\r\n          });\r\n\r\n          rows[idx].subtitle.textContent = str;\r\n        });\r\n      });\r\n\r\n      this.eventListener.addEventListener('destroy', cancel);\r\n\r\n      form.append(...rows.map((row) => row.container));\r\n      container.append(form);\r\n    }\r\n\r\n    {\r\n      const container = section('Emoji');\r\n\r\n      const suggestCheckboxField = new CheckboxField({\r\n        text: 'GeneralSettings.EmojiPrediction',\r\n        name: 'suggest-emoji',\r\n        stateKey: 'settings.emoji.suggest',\r\n        withRipple: true,\r\n        listenerSetter: this.listenerSetter\r\n      });\r\n      const bigCheckboxField = new CheckboxField({\r\n        text: 'GeneralSettings.BigEmoji',\r\n        name: 'emoji-big',\r\n        stateKey: 'settings.emoji.big',\r\n        withRipple: true,\r\n        listenerSetter: this.listenerSetter\r\n      });\r\n\r\n      container.append(suggestCheckboxField.label, bigCheckboxField.label);\r\n    }\r\n\r\n    {\r\n      const section = new SettingSection({name: 'Telegram.InstalledStickerPacksController', caption: 'StickersBotInfo'});\r\n\r\n      const reactionsRow = new Row({\r\n        titleLangKey: 'DoubleTapSetting',\r\n        havePadding: true,\r\n        clickable: () => {\r\n          this.slider.createTab(AppQuickReactionTab).open();\r\n        },\r\n        listenerSetter: this.listenerSetter\r\n      });\r\n\r\n      const renderQuickReaction = () => {\r\n        Promise.resolve(this.managers.appReactionsManager.getQuickReaction()).then((reaction) => {\r\n          wrapStickerToRow({\r\n            row: reactionsRow,\r\n            doc: reaction.static_icon,\r\n            size: 'small'\r\n          });\r\n        });\r\n      };\r\n\r\n      renderQuickReaction();\r\n\r\n      this.listenerSetter.add(rootScope)('quick_reaction', renderQuickReaction);\r\n\r\n      const suggestCheckboxField = new CheckboxField({\r\n        text: 'Stickers.SuggestStickers',\r\n        name: 'suggest',\r\n        stateKey: 'settings.stickers.suggest',\r\n        withRipple: true,\r\n        listenerSetter: this.listenerSetter\r\n      });\r\n      const loopCheckboxField = new CheckboxField({\r\n        text: 'InstalledStickers.LoopAnimated',\r\n        name: 'loop',\r\n        stateKey: 'settings.stickers.loop',\r\n        withRipple: true,\r\n        listenerSetter: this.listenerSetter\r\n      });\r\n\r\n      const stickerSets: {[id: string]: Row} = {};\r\n\r\n      const stickersContent = section.generateContentElement();\r\n\r\n      const lazyLoadQueue = new LazyLoadQueue();\r\n      const renderStickerSet = (stickerSet: StickerSet.stickerSet, method: 'append' | 'prepend' = 'append') => {\r\n        const row = new Row({\r\n          title: wrapEmojiText(stickerSet.title),\r\n          subtitleLangKey: 'Stickers',\r\n          subtitleLangArgs: [stickerSet.count],\r\n          havePadding: true,\r\n          clickable: () => {\r\n            new PopupStickers({id: stickerSet.id, access_hash: stickerSet.access_hash}).show();\r\n          },\r\n          listenerSetter: this.listenerSetter\r\n        });\r\n\r\n        stickerSets[stickerSet.id] = row;\r\n\r\n        const div = document.createElement('div');\r\n        div.classList.add('row-media');\r\n\r\n        wrapStickerSetThumb({\r\n          set: stickerSet,\r\n          container: div,\r\n          group: 'GENERAL-SETTINGS',\r\n          lazyLoadQueue,\r\n          width: 48,\r\n          height: 48,\r\n          autoplay: true\r\n        });\r\n\r\n        row.container.append(div);\r\n\r\n        stickersContent[method](row.container);\r\n      };\r\n\r\n      this.managers.appStickersManager.getAllStickers().then((allStickers) => {\r\n        assumeType<MessagesAllStickers.messagesAllStickers>(allStickers);\r\n        for(const stickerSet of allStickers.sets) {\r\n          renderStickerSet(stickerSet);\r\n        }\r\n      });\r\n\r\n      this.listenerSetter.add(rootScope)('stickers_installed', (set) => {\r\n        if(!stickerSets[set.id]) {\r\n          renderStickerSet(set, 'prepend');\r\n        }\r\n      });\r\n\r\n      this.listenerSetter.add(rootScope)('stickers_deleted', (set) => {\r\n        if(stickerSets[set.id]) {\r\n          stickerSets[set.id].container.remove();\r\n          delete stickerSets[set.id];\r\n        }\r\n      });\r\n\r\n      section.content.append(reactionsRow.container, suggestCheckboxField.label, loopCheckboxField.label);\r\n      this.scrollable.append(section.container);\r\n    }\r\n  }\r\n\r\n  onOpen() {\r\n    if(this.init) {\r\n      this.init();\r\n      this.init = null;\r\n    }\r\n  }\r\n}\r\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport eachTimeout from './eachTimeout';\n\n// It's better to use timeout instead of interval, because interval can be corrupted\nexport default function eachMinute(callback: () => any, runFirst = true) {\n  return eachTimeout(callback, () => (60 - new Date().getSeconds()) * 1000, runFirst);\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport ctx from '../environment/ctx';\nimport noop from './noop';\n\n// It's better to use timeout instead of interval, because interval can be corrupted\nexport default function eachTimeout(callback: () => any, getNextTimeout: () => number, runFirst = true) {\n  const cancel = () => {\n    clearTimeout(timeout);\n  };\n\n  // replace callback to run noop and restore after\n  const _callback = callback;\n  if(!runFirst) {\n    callback = noop;\n  }\n\n  let timeout: number;\n  (function run() {\n    callback();\n    timeout = ctx.setTimeout(run, getNextTimeout());\n  })();\n\n  callback = _callback;\n\n  return cancel;\n}\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport InputField from '../../inputField';\r\nimport {SliderSuperTab} from '../../slider';\r\nimport EditPeer from '../../editPeer';\r\nimport {UsernameInputField} from '../../usernameInputField';\r\nimport {i18n, i18n_} from '../../../lib/langPack';\r\nimport {attachClickEvent} from '../../../helpers/dom/clickEvent';\r\nimport rootScope from '../../../lib/rootScope';\r\nimport {generateSection, SettingSection} from '..';\r\n\r\n// TODO:         - (    ,    ,      )\r\n\r\nexport default class AppEditProfileTab extends SliderSuperTab {\r\n  private firstNameInputField: InputField;\r\n  private lastNameInputField: InputField;\r\n  private bioInputField: InputField;\r\n  private usernameInputField: InputField;\r\n\r\n  private profileUrlContainer: HTMLDivElement;\r\n  private profileUrlAnchor: HTMLAnchorElement;\r\n\r\n  private editPeer: EditPeer;\r\n\r\n  protected async init() {\r\n    this.container.classList.add('edit-profile-container');\r\n    this.setTitle('EditAccount.Title');\r\n\r\n    const inputFields: InputField[] = [];\r\n\r\n    {\r\n      const section = generateSection(this.scrollable, undefined, 'Bio.Description');\r\n      const inputWrapper = document.createElement('div');\r\n      inputWrapper.classList.add('input-wrapper');\r\n\r\n      const appConfig = await this.managers.apiManager.getAppConfig();\r\n      this.firstNameInputField = new InputField({\r\n        label: 'EditProfile.FirstNameLabel',\r\n        name: 'first-name',\r\n        maxLength: 70\r\n      });\r\n      this.lastNameInputField = new InputField({\r\n        label: 'Login.Register.LastName.Placeholder',\r\n        name: 'last-name',\r\n        maxLength: 64\r\n      });\r\n      this.bioInputField = new InputField({\r\n        label: 'EditProfile.BioLabel',\r\n        name: 'bio',\r\n        maxLength: rootScope.premium ? appConfig.about_length_limit_premium : appConfig.about_length_limit_default\r\n      });\r\n\r\n      inputWrapper.append(this.firstNameInputField.container, this.lastNameInputField.container, this.bioInputField.container);\r\n\r\n      const caption = document.createElement('div');\r\n      caption.classList.add('caption');\r\n      i18n_({element: caption, key: 'Bio.Description'});\r\n\r\n      inputFields.push(this.firstNameInputField, this.lastNameInputField, this.bioInputField);\r\n\r\n      this.editPeer = new EditPeer({\r\n        peerId: rootScope.myId,\r\n        inputFields,\r\n        listenerSetter: this.listenerSetter\r\n      });\r\n\r\n      this.content.append(this.editPeer.nextBtn);\r\n\r\n      section.append(this.editPeer.avatarEdit.container, inputWrapper);\r\n    }\r\n\r\n    {\r\n      const section = new SettingSection({\r\n        name: 'EditAccount.Username',\r\n        caption: true\r\n      });\r\n\r\n      const inputWrapper = document.createElement('div');\r\n      inputWrapper.classList.add('input-wrapper');\r\n\r\n      this.usernameInputField = new UsernameInputField({\r\n        label: 'EditProfile.Username.Label',\r\n        name: 'username',\r\n        plainText: true,\r\n        listenerSetter: this.listenerSetter,\r\n        onChange: () => {\r\n          this.editPeer.handleChange();\r\n          this.setProfileUrl();\r\n        },\r\n        availableText: 'EditProfile.Username.Available',\r\n        takenText: 'EditProfile.Username.Taken',\r\n        invalidText: 'EditProfile.Username.Invalid'\r\n      }, this.managers);\r\n\r\n      inputWrapper.append(this.usernameInputField.container);\r\n\r\n      const caption = section.caption;\r\n      caption.append(i18n('UsernameSettings.ChangeDescription'));\r\n      caption.append(document.createElement('br'), document.createElement('br'));\r\n\r\n      const profileUrlContainer = this.profileUrlContainer = document.createElement('div');\r\n      profileUrlContainer.classList.add('profile-url-container');\r\n\r\n      const profileUrlAnchor = this.profileUrlAnchor = document.createElement('a');\r\n      profileUrlAnchor.classList.add('profile-url');\r\n      profileUrlAnchor.href = '#';\r\n      profileUrlAnchor.target = '_blank';\r\n\r\n      profileUrlContainer.append(i18n('UsernameHelpLink', [profileUrlAnchor]));\r\n\r\n      caption.append(profileUrlContainer);\r\n\r\n      inputFields.push(this.usernameInputField);\r\n      section.content.append(inputWrapper);\r\n      this.scrollable.append(section.container);\r\n    }\r\n\r\n    attachClickEvent(this.editPeer.nextBtn, () => {\r\n      this.editPeer.nextBtn.disabled = true;\r\n\r\n      const promises: Promise<any>[] = [];\r\n\r\n      promises.push(this.managers.appProfileManager.updateProfile(this.firstNameInputField.value, this.lastNameInputField.value, this.bioInputField.value).then(() => {\r\n        this.close();\r\n      }, (err) => {\r\n        console.error('updateProfile error:', err);\r\n      }));\r\n\r\n      if(this.editPeer.uploadAvatar) {\r\n        promises.push(this.editPeer.uploadAvatar().then((inputFile) => {\r\n          return this.managers.appProfileManager.uploadProfilePhoto(inputFile);\r\n        }));\r\n      }\r\n\r\n      if(this.usernameInputField.isValidToChange()) {\r\n        promises.push(this.managers.appUsersManager.updateUsername(this.usernameInputField.value));\r\n      }\r\n\r\n      Promise.race(promises).finally(() => {\r\n        this.editPeer.nextBtn.removeAttribute('disabled');\r\n      });\r\n    }, {listenerSetter: this.listenerSetter});\r\n\r\n    const user = await this.managers.appUsersManager.getSelf();\r\n\r\n    const userFull = await this.managers.appProfileManager.getProfile(user.id, true);\r\n\r\n    this.firstNameInputField.setOriginalValue(user.first_name, true);\r\n    this.lastNameInputField.setOriginalValue(user.last_name, true);\r\n    this.bioInputField.setOriginalValue(userFull.about, true);\r\n    this.usernameInputField.setOriginalValue(user.username, true);\r\n\r\n    this.setProfileUrl();\r\n    this.editPeer.handleChange();\r\n  }\r\n\r\n  private setProfileUrl() {\r\n    if(this.usernameInputField.input.classList.contains('error') || !this.usernameInputField.value.length) {\r\n      this.profileUrlContainer.style.display = 'none';\r\n    } else {\r\n      this.profileUrlContainer.style.display = '';\r\n      const url = 'https://t.me/' + this.usernameInputField.value;\r\n      this.profileUrlAnchor.innerText = url;\r\n      this.profileUrlAnchor.href = url;\r\n    }\r\n  }\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport {SettingSection} from '..';\r\nimport Row from '../../row';\r\nimport CheckboxField from '../../checkboxField';\r\nimport {InputNotifyPeer, Update} from '../../../layer';\r\nimport {SliderSuperTabEventable} from '../../sliderTab';\r\nimport rootScope from '../../../lib/rootScope';\r\nimport {LangPackKey} from '../../../lib/langPack';\r\nimport copy from '../../../helpers/object/copy';\r\nimport convertKeyToInputKey from '../../../helpers/string/convertKeyToInputKey';\r\nimport {MUTE_UNTIL} from '../../../lib/mtproto/mtproto_config';\r\nimport apiManagerProxy from '../../../lib/mtproto/mtprotoworker';\r\n\r\ntype InputNotifyKey = Exclude<InputNotifyPeer['_'], 'inputNotifyPeer'>;\r\n\r\nexport default class AppNotificationsTab extends SliderSuperTabEventable {\r\n  protected init() {\r\n    this.header.classList.add('with-border');\r\n    this.container.classList.add('notifications-container', 'with-border');\r\n    this.setTitle('Telegram.NotificationSettingsViewController');\r\n\r\n    const NotifySection = (options: {\r\n      name: LangPackKey,\r\n      typeText: LangPackKey,\r\n      inputKey: InputNotifyKey,\r\n    }) => {\r\n      const section = new SettingSection({\r\n        name: options.name\r\n      });\r\n\r\n      const enabledRow = new Row({\r\n        checkboxField: new CheckboxField({text: options.typeText, checked: true}),\r\n        subtitleLangKey: 'Loading',\r\n        listenerSetter: this.listenerSetter\r\n      });\r\n\r\n      const previewEnabledRow = new Row({\r\n        checkboxField: new CheckboxField({text: 'MessagePreview', checked: true}),\r\n        subtitleLangKey: 'Loading',\r\n        listenerSetter: this.listenerSetter\r\n      });\r\n\r\n      section.content.append(enabledRow.container, previewEnabledRow.container);\r\n\r\n      this.scrollable.append(section.container);\r\n\r\n      const inputNotifyPeer = {_: options.inputKey};\r\n      const ret = this.managers.appNotificationsManager.getNotifySettings(inputNotifyPeer);\r\n      (ret instanceof Promise ? ret : Promise.resolve(ret)).then((notifySettings) => {\r\n        const applySettings = async() => {\r\n          const muted = await this.managers.appNotificationsManager.isMuted(notifySettings);\r\n          enabledRow.checkboxField.checked = !muted;\r\n          previewEnabledRow.checkboxField.checked = notifySettings.show_previews;\r\n\r\n          return muted;\r\n        };\r\n\r\n        applySettings();\r\n\r\n        this.eventListener.addEventListener('destroy', async() => {\r\n          const mute = !enabledRow.checkboxField.checked;\r\n          const showPreviews = previewEnabledRow.checkboxField.checked;\r\n\r\n          if(mute === (await this.managers.appNotificationsManager.isMuted(notifySettings)) && showPreviews === notifySettings.show_previews) {\r\n            return;\r\n          }\r\n\r\n          const inputSettings: any = copy(notifySettings);\r\n          inputSettings._ = 'inputPeerNotifySettings';\r\n          inputSettings.mute_until = mute ? MUTE_UNTIL : 0;\r\n          inputSettings.show_previews = showPreviews;\r\n\r\n          this.managers.appNotificationsManager.updateNotifySettings(inputNotifyPeer, inputSettings);\r\n        }, {once: true});\r\n\r\n        this.listenerSetter.add(rootScope)('notify_settings', (update: Update.updateNotifySettings) => {\r\n          const inputKey = convertKeyToInputKey(update.peer._) as any;\r\n          if(options.inputKey === inputKey) {\r\n            notifySettings = update.notify_settings;\r\n            applySettings();\r\n          }\r\n        });\r\n      });\r\n    };\r\n\r\n    NotifySection({\r\n      name: 'NotificationsPrivateChats',\r\n      typeText: 'NotificationsForPrivateChats',\r\n      inputKey: 'inputNotifyUsers'\r\n    });\r\n\r\n    NotifySection({\r\n      name: 'NotificationsGroups',\r\n      typeText: 'NotificationsForGroups',\r\n      inputKey: 'inputNotifyChats'\r\n    });\r\n\r\n    NotifySection({\r\n      name: 'NotificationsChannels',\r\n      typeText: 'NotificationsForChannels',\r\n      inputKey: 'inputNotifyBroadcasts'\r\n    });\r\n\r\n    {\r\n      const section = new SettingSection({\r\n        name: 'NotificationsOther'\r\n      });\r\n\r\n      const contactsSignUpRow = new Row({\r\n        checkboxField: new CheckboxField({text: 'ContactJoined', checked: true}),\r\n        subtitleLangKey: 'Loading',\r\n        listenerSetter: this.listenerSetter\r\n      });\r\n\r\n      const soundRow = new Row({\r\n        checkboxField: new CheckboxField({text: 'Notifications.Sound', checked: true, stateKey: 'settings.notifications.sound', listenerSetter: this.listenerSetter}),\r\n        subtitleLangKey: 'Loading',\r\n        listenerSetter: this.listenerSetter\r\n      });\r\n\r\n      apiManagerProxy.getState().then((state) => {\r\n        soundRow.checkboxField.checked = state.settings.notifications.sound;\r\n      });\r\n\r\n      section.content.append(contactsSignUpRow.container, soundRow.container);\r\n\r\n      this.scrollable.append(section.container);\r\n\r\n      this.managers.appNotificationsManager.getContactSignUpNotification().then((enabled) => {\r\n        contactsSignUpRow.checkboxField.checked = enabled;\r\n\r\n        this.eventListener.addEventListener('destroy', () => {\r\n          const _enabled = contactsSignUpRow.checkboxField.checked;\r\n          if(enabled !== _enabled) {\r\n            this.managers.appNotificationsManager.setContactSignUpNotification(!_enabled);\r\n          }\r\n        }, {once: true});\r\n      });\r\n    }\r\n  }\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport {SettingSection} from '..';\r\nimport {randomLong} from '../../../helpers/random';\r\nimport I18n from '../../../lib/langPack';\r\nimport RadioField from '../../radioField';\r\nimport Row, {RadioFormFromRows} from '../../row';\r\nimport {SliderSuperTab} from '../../slider'\r\n\r\nexport default class AppLanguageTab extends SliderSuperTab {\r\n  protected async init() {\r\n    this.header.classList.add('with-border');\r\n    this.container.classList.add('language-container');\r\n    this.setTitle('Telegram.LanguageViewController');\r\n\r\n    const section = new SettingSection({});\r\n\r\n    const radioRows: Map<string, Row> = new Map();\r\n\r\n    const promise = Promise.all([\r\n      this.managers.apiManager.invokeApiCacheable('langpack.getLanguages', {\r\n        lang_pack: 'web'\r\n      }),\r\n      this.managers.apiManager.invokeApiCacheable('langpack.getLanguages', {\r\n        lang_pack: 'macos'\r\n      }),\r\n    ]).then(([languages1, languages2]) => {\r\n      const rendered: Set<string> = new Set();\r\n      const webLangCodes = languages1.map((language) => language.lang_code);\r\n\r\n      const random = randomLong();\r\n      languages1.concat(languages2).forEach((language) => {\r\n        if(rendered.has(language.lang_code)) return;\r\n        rendered.add(language.lang_code);\r\n\r\n        const row = new Row({\r\n          radioField: new RadioField({\r\n            text: language.name,\r\n            name: random,\r\n            value: language.lang_code\r\n          }),\r\n          subtitle: language.native_name\r\n        });\r\n\r\n        radioRows.set(language.lang_code, row);\r\n      });\r\n\r\n      const form = RadioFormFromRows([...radioRows.values()], (value) => {\r\n        I18n.getLangPack(value, webLangCodes.includes(value));\r\n      });\r\n\r\n      I18n.getCacheLangPack().then((langPack) => {\r\n        const row = radioRows.get(langPack.lang_code);\r\n        if(!row) {\r\n          console.error('no row', row, langPack);\r\n          return;\r\n        }\r\n\r\n        row.radioField.setValueSilently(true);\r\n      });\r\n\r\n      section.content.append(form);\r\n    });\r\n\r\n    this.scrollable.append(section.container);\r\n\r\n    return promise;\r\n  }\r\n}\r\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport type ListenerSetter from '../../../../helpers/listenerSetter';\nimport {SettingSection} from '../..';\nimport {LangPackKey} from '../../../../lib/langPack';\nimport CheckboxField from '../../../checkboxField';\nimport {SliderSuperTabEventable} from '../../../sliderTab';\n\nexport function autoDownloadPeerTypeSection(type: 'photo' | 'video' | 'file', title: LangPackKey, listenerSetter: ListenerSetter) {\n  const section = new SettingSection({name: title});\n\n  const key = 'settings.autoDownload.' + type + '.';\n  const contactsCheckboxField = new CheckboxField({\n    text: 'AutodownloadContacts',\n    name: 'contacts',\n    stateKey: key + 'contacts',\n    withRipple: true,\n    listenerSetter\n  });\n  const privateCheckboxField = new CheckboxField({\n    text: 'AutodownloadPrivateChats',\n    name: 'private',\n    stateKey: key + 'private',\n    withRipple: true,\n    listenerSetter\n  });\n  const groupsCheckboxField = new CheckboxField({\n    text: 'AutodownloadGroupChats',\n    name: 'groups',\n    stateKey: key + 'groups',\n    withRipple: true,\n    listenerSetter\n  });\n  const channelsCheckboxField = new CheckboxField({\n    text: 'AutodownloadChannels',\n    name: 'channels',\n    stateKey: key + 'channels',\n    withRipple: true,\n    listenerSetter\n  });\n\n  section.content.append(\n    contactsCheckboxField.label,\n    privateCheckboxField.label,\n    groupsCheckboxField.label,\n    channelsCheckboxField.label\n  );\n\n  return section;\n}\n\nexport default class AppAutoDownloadPhotoTab extends SliderSuperTabEventable {\n  protected init() {\n    this.header.classList.add('with-border');\n    this.setTitle('AutoDownloadPhotos');\n\n    const section = autoDownloadPeerTypeSection('photo', 'AutoDownloadPhotosTitle', this.listenerSetter);\n    this.scrollable.append(section.container);\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport formatBytes from '../../../../helpers/formatBytes';\nimport debounce from '../../../../helpers/schedulers/debounce';\nimport I18n from '../../../../lib/langPack';\nimport rootScope from '../../../../lib/rootScope';\nimport {SliderSuperTabEventable} from '../../../sliderTab';\nimport {RangeSettingSelector} from '../generalSettings';\nimport {autoDownloadPeerTypeSection} from './photo';\n\nexport default class AppAutoDownloadFileTab extends SliderSuperTabEventable {\n  protected init() {\n    this.header.classList.add('with-border');\n    this.setTitle('AutoDownloadFiles');\n\n    const debouncedSave = debounce((sizeMax: number) => {\n      this.managers.appStateManager.setByKey('settings.autoDownloadNew.file_size_max', sizeMax);\n    }, 200, false, true);\n\n    const section = autoDownloadPeerTypeSection('file', 'AutoDownloadFilesTitle', this.listenerSetter);\n\n    const MIN = 512 * 1024;\n    // const MAX = 2 * 1024 * 1024 * 1024;\n    const MAX = 20 * 1024 * 1024;\n    const MAX_RANGE = MAX - MIN;\n\n    const sizeMax = rootScope.settings.autoDownloadNew.file_size_max;\n    const value = Math.sqrt(Math.sqrt((sizeMax - MIN) / MAX_RANGE));\n    const upTo = new I18n.IntlElement({\n      key: 'AutodownloadSizeLimitUpTo',\n      args: [formatBytes(sizeMax)]\n    });\n    const range = new RangeSettingSelector('AutoDownloadMaxFileSize', 0.01, value, 0, 1, false);\n    range.onChange = (value) => {\n      const sizeMax = (value ** 4 * MAX_RANGE + MIN) | 0;\n\n      upTo.compareAndUpdate({args: [formatBytes(sizeMax)]});\n\n      debouncedSave(sizeMax);\n    };\n\n    range.valueContainer.append(upTo.element);\n\n    section.content.append(range.container);\n\n    this.scrollable.append(section.container);\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport {SliderSuperTabEventable} from '../../../sliderTab';\nimport {autoDownloadPeerTypeSection} from './photo';\n\nexport default class AppAutoDownloadVideoTab extends SliderSuperTabEventable {\n  protected init() {\n    this.header.classList.add('with-border');\n    this.setTitle('AutoDownloadVideos');\n\n    const section = autoDownloadPeerTypeSection('video', 'AutoDownloadVideosTitle', this.listenerSetter);\n    this.scrollable.append(section.container);\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport {AutoDownloadPeerTypeSettings, STATE_INIT} from '../../../config/state';\nimport {SettingSection} from '..';\nimport {attachClickEvent} from '../../../helpers/dom/clickEvent';\nimport replaceContent from '../../../helpers/dom/replaceContent';\nimport toggleDisability from '../../../helpers/dom/toggleDisability';\nimport formatBytes from '../../../helpers/formatBytes';\nimport copy from '../../../helpers/object/copy';\nimport deepEqual from '../../../helpers/object/deepEqual';\nimport {FormatterArguments, i18n, join, LangPackKey} from '../../../lib/langPack';\nimport rootScope from '../../../lib/rootScope';\nimport Button from '../../button';\nimport CheckboxField from '../../checkboxField';\nimport confirmationPopup from '../../confirmationPopup';\nimport Row from '../../row';\nimport {SliderSuperTabEventable, SliderSuperTabEventableConstructable} from '../../sliderTab';\nimport AppAutoDownloadFileTab from './autoDownload/file';\nimport AppAutoDownloadPhotoTab from './autoDownload/photo';\nimport AppAutoDownloadVideoTab from './autoDownload/video';\nimport apiManagerProxy from '../../../lib/mtproto/mtprotoworker';\n\nconst AUTO_DOWNLOAD_FOR_KEYS: {[k in keyof AutoDownloadPeerTypeSettings]: LangPackKey} = {\n  contacts: 'AutoDownloadContacts',\n  private: 'AutoDownloadPm',\n  groups: 'AutoDownloadGroups',\n  channels: 'AutoDownloadChannels'\n};\n\nexport default class AppDataAndStorageTab extends SliderSuperTabEventable {\n  protected async init() {\n    this.header.classList.add('with-border');\n    this.setTitle('DataSettings');\n\n    {\n      const section = new SettingSection({name: 'AutomaticMediaDownload', caption: 'AutoDownloadAudioInfo'});\n\n      const state = await apiManagerProxy.getState();\n\n      const autoCheckboxField = new CheckboxField({\n        text: 'AutoDownloadMedia',\n        name: 'auto',\n        checked: !state.settings.autoDownloadNew.pFlags.disabled,\n        withRipple: true\n      });\n\n      const onChange = () => {\n        toggleDisability([resetButton],\n          deepEqual(state.settings.autoDownload, STATE_INIT.settings.autoDownload) &&\n          deepEqual(state.settings.autoDownloadNew, STATE_INIT.settings.autoDownloadNew));\n      };\n\n      const setSubtitles = () => {\n        this.setAutoDownloadSubtitle(photoRow, state.settings.autoDownload.photo /* state.settings.autoDownloadNew.photo_size_max */);\n        this.setAutoDownloadSubtitle(videoRow, state.settings.autoDownload.video/* , state.settings.autoDownloadNew.video_size_max */);\n        this.setAutoDownloadSubtitle(fileRow, state.settings.autoDownload.file, state.settings.autoDownloadNew.file_size_max);\n      };\n\n      const openTab = (tabConstructor: SliderSuperTabEventableConstructable) => {\n        const tab = this.slider.createTab(tabConstructor);\n        tab.open();\n\n        this.listenerSetter.add(tab.eventListener)('destroy', () => {\n          setSubtitles();\n          onChange();\n        }, {once: true});\n      };\n\n      const photoRow = new Row({\n        titleLangKey: 'AutoDownloadPhotos',\n        subtitle: '',\n        clickable: () => {\n          openTab(AppAutoDownloadPhotoTab);\n        },\n        listenerSetter: this.listenerSetter\n      });\n\n      const videoRow = new Row({\n        titleLangKey: 'AutoDownloadVideos',\n        subtitle: '',\n        clickable: () => {\n          openTab(AppAutoDownloadVideoTab);\n        },\n        listenerSetter: this.listenerSetter\n      });\n\n      const fileRow = new Row({\n        titleLangKey: 'AutoDownloadFiles',\n        subtitle: '',\n        clickable: () => {\n          openTab(AppAutoDownloadFileTab);\n        },\n        listenerSetter: this.listenerSetter\n      });\n\n      const resetButton = Button('btn-primary btn-transparent primary', {icon: 'delete', text: 'ResetAutomaticMediaDownload'});\n      attachClickEvent(resetButton, () => {\n        confirmationPopup({\n          titleLangKey: 'ResetAutomaticMediaDownloadAlertTitle',\n          descriptionLangKey: 'ResetAutomaticMediaDownloadAlert',\n          button: {\n            langKey: 'Reset'\n          }\n        }).then(() => {\n          const settings = rootScope.settings;\n          settings.autoDownloadNew = copy(STATE_INIT.settings.autoDownloadNew);\n          settings.autoDownload = copy(STATE_INIT.settings.autoDownload);\n          state.settings = settings;\n          this.managers.appStateManager.setByKey('settings', settings);\n\n          setSubtitles();\n          autoCheckboxField.checked = !state.settings.autoDownloadNew.pFlags.disabled;\n        });\n      });\n\n      const onDisabledChange = () => {\n        const disabled = !autoCheckboxField.checked;\n\n        const settings = rootScope.settings;\n        if(disabled) {\n          settings.autoDownloadNew.pFlags.disabled = true;\n        } else {\n          delete settings.autoDownloadNew.pFlags.disabled;\n        }\n\n        [photoRow, videoRow, fileRow].forEach((row) => {\n          row.container.classList.toggle('is-disabled', disabled);\n        });\n\n        this.managers.appStateManager.setByKey('settings', settings);\n\n        onChange();\n      };\n\n      autoCheckboxField.input.addEventListener('change', onDisabledChange);\n      onDisabledChange();\n      setSubtitles();\n\n      section.content.append(\n        autoCheckboxField.label,\n        photoRow.container,\n        videoRow.container,\n        fileRow.container,\n        resetButton\n      );\n\n      this.scrollable.append(section.container);\n    }\n\n    {\n      const section = new SettingSection({name: 'AutoplayMedia'});\n\n      const gifsCheckboxField = new CheckboxField({\n        text: 'AutoplayGIF',\n        name: 'gifs',\n        stateKey: 'settings.autoPlay.gifs',\n        withRipple: true,\n        listenerSetter: this.listenerSetter\n      });\n      const videosCheckboxField = new CheckboxField({\n        text: 'AutoplayVideo',\n        name: 'videos',\n        stateKey: 'settings.autoPlay.videos',\n        withRipple: true,\n        listenerSetter: this.listenerSetter\n      });\n\n      section.content.append(gifsCheckboxField.label, videosCheckboxField.label);\n\n      this.scrollable.append(section.container);\n    }\n  }\n\n  private setAutoDownloadSubtitle(row: Row, settings: AutoDownloadPeerTypeSettings, sizeMax?: number) {\n    let key: LangPackKey;\n    const args: FormatterArguments = [];\n\n    const peerKeys = Object.keys(settings) as (keyof typeof AUTO_DOWNLOAD_FOR_KEYS)[];\n    const enabledKeys = peerKeys.map((key) => settings[key] ? AUTO_DOWNLOAD_FOR_KEYS[key] : undefined).filter(Boolean);\n    if(!enabledKeys.length || sizeMax === 0) {\n      key = 'AutoDownloadOff';\n    } else {\n      const isAll = enabledKeys.length === peerKeys.length;\n      if(sizeMax !== undefined) {\n        key = isAll ? 'AutoDownloadUpToOnAllChats' : 'AutoDownloadOnUpToFor';\n        args.push(formatBytes(sizeMax));\n      } else {\n        key = isAll ? 'AutoDownloadOnAllChats' : 'AutoDownloadOnFor';\n      }\n\n      if(!isAll) {\n        const fragment = document.createElement('span');\n        fragment.append(...join(enabledKeys.map((key) => i18n(key)), true, false));\n        args.push(fragment);\n      }\n    }\n\n    replaceContent(row.subtitle, i18n(key, args));\n  }\n}\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport {SliderSuperTab} from '../../slider';\r\nimport ButtonMenuToggle from '../../buttonMenuToggle';\r\nimport Button from '../../button';\r\nimport AppPrivacyAndSecurityTab from './privacyAndSecurity';\r\nimport AppGeneralSettingsTab from './generalSettings';\r\nimport AppEditProfileTab from './editProfile';\r\nimport AppChatFoldersTab from './chatFolders';\r\nimport AppNotificationsTab from './notifications';\r\nimport AppLanguageTab from './language';\r\nimport lottieLoader from '../../../lib/rlottie/lottieLoader';\r\nimport PopupPeer from '../../popups/peer';\r\nimport AppDataAndStorageTab from './dataAndStorage';\r\nimport ButtonIcon from '../../buttonIcon';\r\nimport PeerProfile from '../../peerProfile';\r\nimport rootScope from '../../../lib/rootScope';\r\nimport {SettingSection} from '..';\r\nimport Row from '../../row';\r\nimport AppActiveSessionsTab from './activeSessions';\r\nimport {i18n, LangPackKey} from '../../../lib/langPack';\r\nimport {SliderSuperTabConstructable} from '../../sliderTab';\r\nimport PopupAvatar from '../../popups/avatar';\r\nimport {AccountAuthorizations, Authorization} from '../../../layer';\r\nimport PopupElement from '../../popups';\r\nimport {attachClickEvent} from '../../../helpers/dom/clickEvent';\r\n// import AppMediaViewer from \"../../appMediaViewerNew\";\r\n\r\nexport default class AppSettingsTab extends SliderSuperTab {\r\n  private buttons: {\r\n    edit: HTMLButtonElement,\r\n    folders: HTMLButtonElement,\r\n    general: HTMLButtonElement,\r\n    notifications: HTMLButtonElement,\r\n    storage: HTMLButtonElement,\r\n    privacy: HTMLButtonElement,\r\n  } = {} as any;\r\n  private profile: PeerProfile;\r\n\r\n  private languageRow: Row;\r\n  private devicesRow: Row;\r\n\r\n  private authorizations: Authorization.authorization[];\r\n  private getAuthorizationsPromise: Promise<AccountAuthorizations.accountAuthorizations>;\r\n\r\n  protected async init() {\r\n    this.container.classList.add('settings-container');\r\n    this.setTitle('Settings');\r\n\r\n    const btnMenu = ButtonMenuToggle({listenerSetter: this.listenerSetter}, 'bottom-left', [{\r\n      icon: 'logout',\r\n      text: 'EditAccount.Logout',\r\n      onClick: () => {\r\n        new PopupPeer('logout', {\r\n          titleLangKey: 'LogOut',\r\n          descriptionLangKey: 'LogOut.Description',\r\n          buttons: [{\r\n            langKey: 'LogOut',\r\n            callback: () => {\r\n              this.managers.apiManager.logOut();\r\n            },\r\n            isDanger: true\r\n          }]\r\n        }).show();\r\n      }\r\n    }]);\r\n\r\n    this.buttons.edit = ButtonIcon('edit');\r\n\r\n    this.header.append(this.buttons.edit, btnMenu);\r\n\r\n    this.profile = new PeerProfile(this.managers, this.scrollable, this.listenerSetter, false);\r\n    this.profile.init();\r\n    this.profile.setPeer(rootScope.myId);\r\n    const fillPromise = this.profile.fillProfileElements();\r\n\r\n    const changeAvatarBtn = Button('btn-circle btn-corner z-depth-1 profile-change-avatar', {icon: 'cameraadd'});\r\n    attachClickEvent(changeAvatarBtn, () => {\r\n      const canvas = document.createElement('canvas');\r\n      PopupElement.createPopup(PopupAvatar).open(canvas, (upload) => {\r\n        upload().then((inputFile) => {\r\n          return this.managers.appProfileManager.uploadProfilePhoto(inputFile);\r\n        });\r\n      });\r\n    }, {listenerSetter: this.listenerSetter});\r\n    this.profile.element.lastElementChild.firstElementChild.append(changeAvatarBtn);\r\n\r\n    const updateChangeAvatarBtn = async() => {\r\n      const user = await this.managers.appUsersManager.getSelf();\r\n      changeAvatarBtn.classList.toggle('hide', user.photo?._ !== 'userProfilePhoto');\r\n    };\r\n\r\n    updateChangeAvatarBtn();\r\n    this.listenerSetter.add(rootScope)('avatar_update', (peerId) => {\r\n      if(rootScope.myId === peerId) {\r\n        updateChangeAvatarBtn();\r\n      }\r\n    });\r\n\r\n    /* const div = document.createElement('div');\r\n    //div.style.cssText = 'border-radius: 8px; overflow: hidden; width: 396px; height: 264px; flex: 0 0 auto; position: relative; margin: 10rem 0 10rem auto;';\r\n    //div.style.width = '135px';\r\n    //div.style.height = '100px';\r\n    div.style.cssText = 'border-radius: 8px; overflow: hidden; width: 396px; height: 264px; flex: 0 0 auto; position: relative; margin: 10rem auto 10rem 0;';\r\n    div.style.width = '135px';\r\n    div.style.height = '100px';\r\n\r\n    const img = document.createElement('img');\r\n    img.src = 'assets/img/pepe.jpg';\r\n    img.classList.add('media-photo');\r\n    img.style.cssText = 'max-width: 100%;max-height: 100%;';\r\n\r\n    div.append(img);\r\n\r\n    div.addEventListener('click', () => {\r\n      new AppMediaViewer().setSearchContext({peerId: 61004386, inputFilter: 'inputMessagesFilterPhotos'}).openMedia({\r\n        _: 'message',\r\n        mid: 1,\r\n        peerId: 61004386,\r\n        fromId: 61004386,\r\n        message: '',\r\n        media: {\r\n          _: 'messageMediaPhoto',\r\n          photo: {\r\n            _: 'photo',\r\n            url: img.src,\r\n            downloaded: 111,\r\n            sizes: [{\r\n              _: 'photoSize',\r\n              type: 'x',\r\n              w: 618,\r\n              h: 412\r\n            }]\r\n          }\r\n        },\r\n        date: Date.now() / 1000 | 0\r\n      }, img);\r\n    });\r\n\r\n    this.scrollable.append(div); */\r\n\r\n    const buttonsDiv = document.createElement('div');\r\n    buttonsDiv.classList.add('profile-buttons');\r\n\r\n    const b: [string, LangPackKey, SliderSuperTabConstructable][] = [\r\n      ['unmute', 'AccountSettings.Notifications', AppNotificationsTab],\r\n      ['data', 'DataSettings', AppDataAndStorageTab],\r\n      ['lock', 'AccountSettings.PrivacyAndSecurity', AppPrivacyAndSecurityTab],\r\n      ['settings', 'Telegram.GeneralSettingsViewController', AppGeneralSettingsTab],\r\n      ['folder', 'AccountSettings.Filters', AppChatFoldersTab]\r\n    ];\r\n\r\n    const rows = b.map(([icon, langPackKey, tabConstructor]) => {\r\n      return new Row({\r\n        titleLangKey: langPackKey,\r\n        icon,\r\n        clickable: () => {\r\n          this.slider.createTab(tabConstructor).open();\r\n          // new tabConstructor(this.slider, true).open();\r\n        },\r\n        listenerSetter: this.listenerSetter\r\n      });\r\n    });\r\n\r\n    rows.push(\r\n      this.devicesRow = new Row({\r\n        titleLangKey: 'Devices',\r\n        titleRightSecondary: ' ',\r\n        icon: 'activesessions',\r\n        clickable: async() => {\r\n          if(!this.authorizations) {\r\n            await this.updateActiveSessions();\r\n          }\r\n\r\n          const tab = this.slider.createTab(AppActiveSessionsTab);\r\n          tab.authorizations = this.authorizations;\r\n          tab.eventListener.addEventListener('destroy', () => {\r\n            this.authorizations = undefined;\r\n            this.updateActiveSessions(true);\r\n          }, {once: true});\r\n          tab.open();\r\n        },\r\n        listenerSetter: this.listenerSetter\r\n      }),\r\n\r\n      this.languageRow = new Row({\r\n        titleLangKey: 'AccountSettings.Language',\r\n        titleRightSecondary: i18n('LanguageName'),\r\n        icon: 'language',\r\n        clickable: () => {\r\n          this.slider.createTab(AppLanguageTab).open();\r\n        },\r\n        listenerSetter: this.listenerSetter\r\n      })\r\n    );\r\n\r\n    buttonsDiv.append(...rows.map((row) => row.container));\r\n\r\n    // const profileSection = new SettingSection({fullWidth: true, noPaddingTop: true});\r\n    // profileSection.content.append(this.profile.element);\r\n\r\n    const buttonsSection = new SettingSection();\r\n    buttonsSection.content.append(buttonsDiv);\r\n\r\n    this.scrollable.append(this.profile.element/* profileSection.container */, buttonsSection.container);\r\n\r\n    attachClickEvent(this.buttons.edit, () => {\r\n      const tab = this.slider.createTab(AppEditProfileTab);\r\n      tab.open();\r\n    }, {listenerSetter: this.listenerSetter});\r\n\r\n    lottieLoader.loadLottieWorkers();\r\n\r\n    this.updateActiveSessions();\r\n\r\n    await fillPromise;\r\n  }\r\n\r\n  private getAuthorizations(overwrite?: boolean) {\r\n    if(this.getAuthorizationsPromise && !overwrite) return this.getAuthorizationsPromise;\r\n\r\n    const promise = this.getAuthorizationsPromise = this.managers.apiManager.invokeApi('account.getAuthorizations')\r\n    .finally(() => {\r\n      if(this.getAuthorizationsPromise === promise) {\r\n        this.getAuthorizationsPromise = undefined;\r\n      }\r\n    });\r\n\r\n    return promise;\r\n  }\r\n\r\n  public updateActiveSessions(overwrite?: boolean) {\r\n    return this.getAuthorizations(overwrite).then((auths) => {\r\n      this.authorizations = auths.authorizations;\r\n      this.devicesRow.titleRight.textContent = '' + this.authorizations.length;\r\n    });\r\n  }\r\n\r\n  public onCloseAfterTimeout() {\r\n    this.profile.destroy();\r\n    return super.onCloseAfterTimeout();\r\n  }\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport appSidebarLeft, {SettingSection} from '..';\r\nimport {InputFile} from '../../../layer';\r\nimport InputField from '../../inputField';\r\nimport {SliderSuperTab} from '../../slider';\r\nimport AvatarEdit from '../../avatarEdit';\r\nimport AppAddMembersTab from './addMembers';\r\nimport {_i18n} from '../../../lib/langPack';\r\nimport ButtonCorner from '../../buttonCorner';\r\nimport appImManager from '../../../lib/appManagers/appImManager';\r\nimport {attachClickEvent} from '../../../helpers/dom/clickEvent';\r\n\r\nexport default class AppNewChannelTab extends SliderSuperTab {\r\n  private uploadAvatar: () => Promise<InputFile> = null;\r\n\r\n  private channelNameInputField: InputField;\r\n  private channelDescriptionInputField: InputField;\r\n  private nextBtn: HTMLButtonElement;\r\n  private avatarEdit: AvatarEdit;\r\n\r\n  protected init() {\r\n    this.container.classList.add('new-channel-container');\r\n    this.setTitle('NewChannel');\r\n\r\n    this.avatarEdit = new AvatarEdit((_upload) => {\r\n      this.uploadAvatar = _upload;\r\n    });\r\n\r\n    const section = new SettingSection({\r\n      caption: 'Channel.DescriptionHolderDescrpiton'\r\n    });\r\n\r\n    const inputWrapper = document.createElement('div');\r\n    inputWrapper.classList.add('input-wrapper');\r\n\r\n    this.channelNameInputField = new InputField({\r\n      label: 'EnterChannelName',\r\n      maxLength: 128\r\n    });\r\n\r\n    this.channelDescriptionInputField = new InputField({\r\n      label: 'DescriptionOptionalPlaceholder',\r\n      maxLength: 255\r\n    });\r\n\r\n    inputWrapper.append(this.channelNameInputField.container, this.channelDescriptionInputField.container);\r\n\r\n    const onLengthChange = () => {\r\n      this.nextBtn.classList.toggle('is-visible', !!this.channelNameInputField.value.length &&\r\n        !this.channelNameInputField.input.classList.contains('error') &&\r\n        !this.channelDescriptionInputField.input.classList.contains('error'));\r\n    };\r\n\r\n    this.channelNameInputField.input.addEventListener('input', onLengthChange);\r\n    this.channelDescriptionInputField.input.addEventListener('input', onLengthChange);\r\n\r\n    this.nextBtn = ButtonCorner({icon: 'arrow_next'});\r\n\r\n    attachClickEvent(this.nextBtn, () => {\r\n      const title = this.channelNameInputField.value;\r\n      const about = this.channelDescriptionInputField.value;\r\n\r\n      this.nextBtn.disabled = true;\r\n      this.managers.appChatsManager.createChannel({\r\n        title,\r\n        about,\r\n        broadcast: true\r\n      }).then((channelId) => {\r\n        if(this.uploadAvatar) {\r\n          this.uploadAvatar().then((inputFile) => {\r\n            this.managers.appChatsManager.editPhoto(channelId, inputFile);\r\n          });\r\n        }\r\n\r\n        appImManager.setInnerPeer({peerId: channelId.toPeerId(true)});\r\n\r\n        appSidebarLeft.removeTabFromHistory(this);\r\n        this.slider.createTab(AppAddMembersTab).open({\r\n          type: 'channel',\r\n          skippable: true,\r\n          title: 'GroupAddMembers',\r\n          placeholder: 'SendMessageTo',\r\n          takeOut: (peerIds) => {\r\n            return this.managers.appChatsManager.inviteToChannel(channelId, peerIds);\r\n          }\r\n        });\r\n      });\r\n    }, {listenerSetter: this.listenerSetter});\r\n\r\n    this.content.append(this.nextBtn);\r\n    section.content.append(this.avatarEdit.container, inputWrapper);\r\n    this.scrollable.append(section.container);\r\n  }\r\n\r\n  public onCloseAfterTimeout() {\r\n    this.avatarEdit.clear();\r\n    this.uploadAvatar = null;\r\n    this.channelNameInputField.value = '';\r\n    this.channelDescriptionInputField.value = '';\r\n    this.nextBtn.disabled = false;\r\n    return super.onCloseAfterTimeout();\r\n  }\r\n}\r\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport InputField from '../inputField';\nimport PopupElement from '.';\nimport {attachClickEvent} from '../../helpers/dom/clickEvent';\nimport EditPeer from '../editPeer';\nimport {_i18n} from '../../lib/langPack';\nimport TelInputField from '../telInputField';\nimport {formatPhoneNumber} from '../../helpers/formatPhoneNumber';\nimport {toastNew} from '../toast';\n\nexport default class PopupCreateContact extends PopupElement {\n  constructor() {\n    super('popup-create-contact popup-send-photo popup-new-media', {closable: true, withConfirm: 'Add', title: 'AddContactTitle'});\n    this.construct();\n  }\n\n  private async construct() {\n    attachClickEvent(this.btnConfirm, () => {\n      const promise = this.managers.appUsersManager.importContact(nameInputField.value, lastNameInputField.value, telInputField.value);\n\n      promise.then(() => {\n        this.hide();\n      }, (err) => {\n        if(err.type === 'NO_USER') {\n          toastNew({langPackKey: 'Contacts.PhoneNumber.NotRegistred'});\n          editPeer.disabled = false;\n        }\n      });\n\n      editPeer.lockWithPromise(promise);\n    }, {listenerSetter: this.listenerSetter});\n\n    const inputFields: InputField[] = [];\n    const div = document.createElement('div');\n    div.classList.add('name-fields');\n    const nameInputField = new InputField({\n      label: 'FirstName',\n      name: 'create-contact-name',\n      maxLength: 70,\n      required: true\n    });\n    const lastNameInputField = new InputField({\n      label: 'LastName',\n      name: 'create-contact-lastname',\n      maxLength: 70\n    });\n    const telInputField = new TelInputField({required: true});\n    inputFields.push(nameInputField, lastNameInputField, telInputField);\n\n    const onInput = () => {\n      const name = nameInputField.value + ' ' + lastNameInputField.value;\n      // const abbr = getAbbreviation(name);\n      editPeer.avatarElem.peerTitle = name;\n      editPeer.avatarElem.update();\n    };\n\n    this.listenerSetter.add(nameInputField.input)('input', onInput);\n    this.listenerSetter.add(lastNameInputField.input)('input', onInput);\n\n    telInputField.validate = () => {\n      return !!telInputField.value.match(/\\d/);\n    };\n\n    const user = await this.managers.appUsersManager.getSelf();\n    const formatted = formatPhoneNumber(user.phone);\n    if(formatted.code) {\n      telInputField.value = '+' + formatted.code.country_code;\n    }\n\n    const editPeer = new EditPeer({\n      inputFields,\n      listenerSetter: this.listenerSetter,\n      doNotEditAvatar: true,\n      nextBtn: this.btnConfirm,\n      avatarSize: 100\n    });\n\n    div.append(nameInputField.container, lastNameInputField.container, editPeer.avatarElem);\n    this.container.append(div, telInputField.container);\n\n    this.show();\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport {SliderSuperTab} from '../../slider';\nimport appDialogsManager from '../../../lib/appManagers/appDialogsManager';\nimport InputSearch from '../../inputSearch';\nimport {IS_MOBILE} from '../../../environment/userAgent';\nimport {canFocus} from '../../../helpers/dom/canFocus';\nimport windowSize from '../../../helpers/windowSize';\nimport ButtonCorner from '../../buttonCorner';\nimport {attachClickEvent} from '../../../helpers/dom/clickEvent';\nimport PopupCreateContact from '../../popups/createContact';\nimport SortedUserList from '../../sortedUserList';\nimport {getMiddleware} from '../../../helpers/middleware';\nimport replaceContent from '../../../helpers/dom/replaceContent';\nimport rootScope from '../../../lib/rootScope';\nimport PopupElement from '../../popups';\n\n// TODO:    ,      \n\nexport default class AppContactsTab extends SliderSuperTab {\n  private inputSearch: InputSearch;\n  private middleware: ReturnType<typeof getMiddleware>;\n  private sortedUserList: SortedUserList;\n\n  protected init() {\n    this.container.id = 'contacts-container';\n\n    // this.list = appDialogsManager.createChatList(/* {avatarSize: 48, handheldsSize: 66} */);\n\n    const btnAdd = ButtonCorner({icon: 'add', className: 'is-visible'});\n    this.content.append(btnAdd);\n\n    attachClickEvent(btnAdd, () => {\n      PopupElement.createPopup(PopupCreateContact);\n    }, {listenerSetter: this.listenerSetter});\n\n    this.inputSearch = new InputSearch('Search', (value) => {\n      this.openContacts(value);\n    });\n\n    this.listenerSetter.add(rootScope)('contacts_update', async(userId) => {\n      const isContact = await this.managers.appUsersManager.isContact(userId);\n      const peerId = userId.toPeerId();\n      if(isContact) this.sortedUserList.add(peerId);\n      else this.sortedUserList.delete(peerId);\n    });\n\n    this.title.replaceWith(this.inputSearch.container);\n\n    this.middleware = getMiddleware();\n\n    // preload contacts\n    // appUsersManager.getContacts();\n  }\n\n  protected createList() {\n    const sortedUserList = new SortedUserList({\n      managers: this.managers\n    });\n    const list = sortedUserList.list;\n    list.id = 'contacts';\n    list.classList.add('contacts-container');\n    appDialogsManager.setListClickListener(list, () => {\n      this.close();\n    }, undefined, true);\n    return sortedUserList;\n  }\n\n  protected onClose() {\n    this.middleware.clean();\n    /* // need to clear, and left 1 page for smooth slide\n    let pageCount = appPhotosManager.windowH / 72 * 1.25 | 0;\n    (Array.from(this.list.children) as HTMLElement[]).slice(pageCount).forEach((el) => el.remove()); */\n  }\n\n  protected onOpenAfterTimeout() {\n    if(IS_MOBILE || !canFocus(true)) return;\n    this.inputSearch.input.focus();\n  }\n\n  public openContacts(query?: string) {\n    if(this.init) {\n      this.init();\n      this.init = null;\n    }\n\n    this.middleware.clean();\n    const middleware = this.middleware.get();\n    this.scrollable.onScrolledBottom = null;\n    this.scrollable.container.textContent = '';\n\n    this.managers.appUsersManager.getContactsPeerIds(query, undefined, 'online').then((contacts) => {\n      if(!middleware()) {\n        return;\n      }\n\n      const sortedUserList = this.sortedUserList = this.createList();\n\n      let renderPage = () => {\n        const pageCount = windowSize.height / 72 * 1.25 | 0;\n        const arr = contacts.splice(0, pageCount); //  splice!\n\n        arr.forEach((peerId) => {\n          sortedUserList.add(peerId);\n        });\n\n        if(!contacts.length) {\n          renderPage = undefined;\n          this.scrollable.onScrolledBottom = null;\n        }\n      };\n\n      renderPage();\n      this.scrollable.onScrolledBottom = () => {\n        if(renderPage) {\n          renderPage();\n        } else {\n          this.scrollable.onScrolledBottom = null;\n        }\n      };\n\n      replaceContent(this.scrollable.container, sortedUserList.list);\n    });\n  }\n\n  public open() {\n    this.openContacts();\n    return super.open();\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport appDialogsManager from '../../../lib/appManagers/appDialogsManager';\nimport {SliderSuperTab} from '../../slider';\nimport {FOLDER_ID_ARCHIVE, REAL_FOLDER_ID} from '../../../lib/mtproto/mtproto_config';\n\nexport default class AppArchivedTab extends SliderSuperTab {\n  private static filterId: REAL_FOLDER_ID = FOLDER_ID_ARCHIVE;\n  private wasFilterId: number;\n\n  protected init() {\n    this.wasFilterId = appDialogsManager.filterId;\n\n    this.container.id = 'chats-archived-container';\n    this.setTitle('ArchivedChats');\n\n    if(!appDialogsManager.sortedLists[AppArchivedTab.filterId]) {\n      const chatList = appDialogsManager.createChatList();\n      const scrollable = appDialogsManager.generateScrollable(chatList, {\n        title: undefined,\n        id: AppArchivedTab.filterId,\n        localId: FOLDER_ID_ARCHIVE\n      });\n      scrollable.container.append(chatList);\n      appDialogsManager.setListClickListener(chatList, null, true);\n      // appDialogsManager.setListClickListener(archivedChatList, null, true); // * to test peer changing\n    }\n\n    const scrollable = appDialogsManager.scrollables[AppArchivedTab.filterId];\n    this.scrollable.container.replaceWith(scrollable.container);\n    // ! DO NOT UNCOMMENT NEXT LINE - chats will stop loading on scroll after closing the tab\n    // this.scrollable = scrollable;\n    return appDialogsManager.setFilterIdAndChangeTab(AppArchivedTab.filterId).then(({cached, renderPromise}) => {\n      if(cached) {\n        return renderPromise;\n      }\n    });\n  }\n\n  // ,   ,         ...\n  onOpenAfterTimeout() {\n    appDialogsManager.sortedLists[this.wasFilterId].clear();\n  }\n\n  onClose() {\n    appDialogsManager.setFilterIdAndChangeTab(this.wasFilterId);\n  }\n\n  onCloseAfterTimeout() {\n    appDialogsManager.sortedLists[AppArchivedTab.filterId].clear();\n    return super.onCloseAfterTimeout();\n  }\n}\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport {SliderSuperTab} from '../../slider';\r\nimport ButtonCorner from '../../buttonCorner';\r\nimport AppNewGroupTab from './newGroup';\r\nimport {toast} from '../../toast';\r\nimport {ButtonMenuItemOptions} from '../../buttonMenu';\r\nimport {i18n, join, _i18n} from '../../../lib/langPack';\r\nimport rootScope from '../../../lib/rootScope';\r\nimport {wrapSticker} from '../../wrappers';\r\nimport SortedUserList from '../../sortedUserList';\r\nimport {PeerLocated, Update, Updates} from '../../../layer';\r\nimport {SettingChatListSection} from '..';\r\nimport appDialogsManager from '../../../lib/appManagers/appDialogsManager';\r\nimport {attachClickEvent} from '../../../helpers/dom/clickEvent';\r\nimport confirmationPopup from '../../confirmationPopup';\r\nimport getPeerId from '../../../lib/appManagers/utils/peers/getPeerId';\r\nimport type LazyLoadQueue from '../../lazyLoadQueue';\r\n\r\nexport default class AppPeopleNearbyTab extends SliderSuperTab {\r\n  private latestLocationSaved: {latitude: number, longitude: number, accuracy: number};\r\n  private isLocationWatched: boolean = false;\r\n  private errorCategory: HTMLElement;\r\n  private retryBtn: HTMLButtonElement;\r\n  private btnOptions: HTMLButtonElement;\r\n  private menuButtons: (ButtonMenuItemOptions & {verify?: () => boolean})[];\r\n\r\n  protected lazyLoadQueue: LazyLoadQueue;\r\n  protected peopleSection: SettingChatListSection;\r\n  protected chatsSection: SettingChatListSection;\r\n\r\n  protected locatedPeers: Map<PeerId, PeerLocated.peerLocated>;\r\n\r\n  // protected async init() {\r\n  //   this.container.classList.add('people-nearby-container');\r\n  //   this.setTitle('PeopleNearby');\r\n\r\n  //   this.errorCategory = document.createElement('div');\r\n  //   this.errorCategory.classList.add('text', 'hide', 'nearby-error');\r\n\r\n  //   this.retryBtn = ButtonCorner({icon: 'check'});\r\n\r\n  //   const emoji = '';\r\n  //   const doc = await this.managers.appStickersManager.getAnimatedEmojiSticker(emoji);\r\n  //   const stickerContainer = document.createElement('div');\r\n  //   stickerContainer.classList.add('sticker-container');\r\n\r\n  //   if(doc) {\r\n  //     wrapSticker({\r\n  //       doc,\r\n  //       div: stickerContainer,\r\n  //       loop: false,\r\n  //       play: true,\r\n  //       width: 86,\r\n  //       height: 86,\r\n  //       emoji,\r\n  //       needUpscale: true\r\n  //     }).then(() => {\r\n  //       // this.animation = player;\r\n  //     });\r\n  //   } else {\r\n  //     stickerContainer.classList.add('media-sticker-wrapper');\r\n  //   }\r\n\r\n  //   const caption = document.createElement('div');\r\n  //   caption.classList.add('caption');\r\n  //   _i18n(caption, 'PeopleNearbyInfo2');\r\n\r\n  //   this.locatedPeers = new Map();\r\n\r\n  //   const m = () => {\r\n  //     const sortedUserList = new SortedUserList({\r\n  //       avatarSize: 42,\r\n  //       createChatListOptions: {\r\n  //         dialogSize: 48,\r\n  //         new: true\r\n  //       },\r\n  //       autonomous: false,\r\n  //       onUpdate: (element) => {\r\n  //         const peer = this.locatedPeers.get(element.id);\r\n  //         const elements: HTMLElement[] = [\r\n  //           this.parseDistance(peer.distance)\r\n  //         ];\r\n\r\n  //         if(!element.id.isUser()) {\r\n  //           elements.push(this.managers.appProfileManager.getChatMembersString(element.id.toChatId()));\r\n  //         }\r\n\r\n  //         element.dom.lastMessageSpan.textContent = '';\r\n  //         element.dom.lastMessageSpan.append(...join(elements, false));\r\n  //       },\r\n  //       getIndex: (element) => {\r\n  //         const peer = this.locatedPeers.get(element.id);\r\n  //         return 0x7FFFFFFF - peer.distance;\r\n  //       },\r\n  //       appUsersManager: this.managers.appUsersManager\r\n  //     });\r\n\r\n  //     appDialogsManager.setListClickListener(sortedUserList.list, undefined, undefined, false);\r\n\r\n  //     return sortedUserList;\r\n  //   };\r\n\r\n  //   const peopleSection = this.peopleSection = new SettingChatListSection({\r\n  //     name: 'PeopleNearbyHeader',\r\n  //     sortedList: m()\r\n  //   });\r\n\r\n  //   const chatsSection = this.chatsSection = new SettingChatListSection({\r\n  //     name: 'ChatsNearbyHeader',\r\n  //     sortedList: m()\r\n  //   });\r\n\r\n  //   const btnMakeVisible = peopleSection.makeButton({\r\n  //     text: 'MakeMyselfVisible',\r\n  //     icon: 'location'\r\n  //   });\r\n\r\n  //   const btnMakeInvisible = peopleSection.makeButton({\r\n  //     text: 'StopShowingMe',\r\n  //     icon: 'location'\r\n  //   });\r\n\r\n  //   const btnCreateGroup = chatsSection.makeButton({\r\n  //     text: 'NearbyCreateGroup',\r\n  //     icon: 'newgroup'\r\n  //   });\r\n\r\n  //   attachClickEvent(btnMakeVisible, () => {\r\n  //     confirmationPopup({\r\n  //       titleLangKey: 'MakeMyselfVisibleTitle',\r\n  //       descriptionLangKey: 'MakeMyselfVisibleInfo',\r\n  //       button: {\r\n  //         langKey: 'OK'\r\n  //       }\r\n  //     }).then(() => {\r\n  //       this.startWatching();\r\n  //     });\r\n  //   }, {listenerSetter: this.listenerSetter});\r\n\r\n  //   attachClickEvent(btnMakeInvisible, () => {\r\n  //     this.stopWatching();\r\n  //   }, {listenerSetter: this.listenerSetter});\r\n\r\n  //   attachClickEvent(btnCreateGroup, () => {\r\n  //     this.slider.createTab(AppNewGroupTab).open([], true);\r\n  //   }, {listenerSetter: this.listenerSetter});\r\n\r\n  //   btnMakeVisible.classList.add('primary');\r\n  //   btnMakeInvisible.classList.add('danger');\r\n  //   btnCreateGroup.classList.add('primary');\r\n\r\n  //   this.content.append(this.retryBtn);\r\n  //   this.scrollable.append(\r\n  //     stickerContainer,\r\n  //     caption,\r\n  //     peopleSection.container,\r\n  //     chatsSection.container,\r\n  //     this.errorCategory\r\n  //   );\r\n  // }\r\n\r\n  private parseDistance(distance: number) {\r\n    if(rootScope.settings.distanceUnit === 'miles') {\r\n      if(distance > 1609.34) {\r\n        return i18n('MilesAway', [Math.round(distance / 1609)]);\r\n      } else {\r\n        return i18n('FootsAway', [Math.round(distance * 3.281)]);\r\n      }\r\n    } else {\r\n      if(distance >= 1000) {\r\n        return i18n('KMetersAway2', [distance / 1000]);\r\n      } else {\r\n        return i18n('MetersAway2', [distance]);\r\n      }\r\n    }\r\n  }\r\n\r\n  public open() {\r\n    const result = super.open();\r\n    result.then(() => {\r\n      this.retryBtn.classList.remove('is-visible');\r\n      navigator.geolocation.getCurrentPosition((location) => {\r\n        this.latestLocationSaved = {\r\n          latitude: location.coords.latitude,\r\n          longitude: location.coords.longitude,\r\n          accuracy: location.coords.accuracy\r\n        };\r\n\r\n        console.log(this.latestLocationSaved);\r\n\r\n        this.managers.appUsersManager.getLocated(\r\n          location.coords.latitude,\r\n          location.coords.longitude,\r\n          location.coords.accuracy\r\n        ).then((response) => {\r\n          const update = (response as Updates.updates).updates[0] as Update.updatePeerLocated;\r\n          const peers = update.peers as PeerLocated.peerLocated[];\r\n          const orderedPeers = peers.sort((a, b) => a.distance - b.distance);\r\n          const groupsCounter = peers.filter((e) => e.peer._ == 'peerChannel').length;\r\n          const usersCounter = peers.filter((e) => e.peer._ != 'peerChannel').length;\r\n          orderedPeers?.forEach((peer) => {\r\n            const peerId = getPeerId(peer.peer);\r\n            const section = peerId.isUser() ? this.peopleSection : this.chatsSection;\r\n            this.locatedPeers.set(peerId, peer);\r\n            section.sortedList.add(peerId);\r\n          });\r\n\r\n          this.errorCategory.classList.toggle('hide', !!(usersCounter || groupsCounter));\r\n          this.errorCategory.innerHTML = 'No groups or channels found around you.';\r\n        });\r\n      }, (error) => {\r\n        this.errorCategory.classList.remove('hide');\r\n        this.retryBtn.classList.add('is-visible');\r\n        this.retryBtn.addEventListener('click', this.open);\r\n        if(error instanceof GeolocationPositionError) {\r\n          this.errorCategory.innerHTML = 'Location permission denied. Click below to retry.';\r\n        } else {\r\n          this.errorCategory.innerHTML = 'An error has occurred. Please retry later clicking the button below.';\r\n        }\r\n      });\r\n    });\r\n\r\n    return result;\r\n  }\r\n\r\n  private startWatching() {\r\n    if(!this.latestLocationSaved || this.isLocationWatched) return;\r\n    this.isLocationWatched = true;\r\n\r\n    toast('Your position is now being shared. Do not close the page or it will be suspended.');\r\n\r\n    this.managers.appUsersManager.getLocated(\r\n      this.latestLocationSaved.latitude,\r\n      this.latestLocationSaved.longitude,\r\n      this.latestLocationSaved.accuracy,\r\n      true, // background parameter\r\n      0x7fffffff // self_expires parameter\r\n    );\r\n\r\n    navigator.geolocation.watchPosition((result) => {\r\n      const isLongitudeDifferent = result.coords.longitude !== this.latestLocationSaved.longitude;\r\n      const isLatitudeDifferent = result.coords.latitude !== this.latestLocationSaved.latitude;\r\n      const distanceCheck = this.calculateDistance(\r\n        result.coords.latitude, result.coords.longitude,\r\n        this.latestLocationSaved.latitude, this.latestLocationSaved.longitude\r\n      ) > 100;\r\n\r\n      if((isLatitudeDifferent || isLongitudeDifferent) && distanceCheck) {\r\n        this.managers.appUsersManager.getLocated(\r\n          result.coords.latitude,\r\n          result.coords.longitude,\r\n          result.coords.accuracy,\r\n          true, // background parameter\r\n          0x7fffffff // self_expires parameter\r\n        );\r\n        this.latestLocationSaved = {\r\n          latitude: result.coords.latitude,\r\n          longitude: result.coords.longitude,\r\n          accuracy: result.coords.accuracy\r\n        }\r\n      }\r\n    });\r\n  }\r\n\r\n  private stopWatching() {\r\n    if(!this.isLocationWatched) return;\r\n    this.isLocationWatched = false;\r\n    toast('The sharing of your position has been stopped. You will no longer be visible to other users.');\r\n    this.managers.appUsersManager.getLocated(\r\n      0, // latitude parameter\r\n      0, // longitude parameter\r\n      0, // accuracy parameter\r\n      false, // background parameter\r\n      0 // self_expires parameter\r\n    );\r\n  }\r\n\r\n  private calculateDistance(lat1: number, long1: number, lat2: number, long2: number) {\r\n    const p = 0.017453292519943295; // Math.PI/180\r\n    return (\r\n      12742 * Math.asin(\r\n        Math.sqrt(\r\n          (0.5 - Math.cos((lat2 - lat1) * p)) +\r\n          (\r\n            Math.cos(lat1 * p) * Math.cos(lat2 * p) *\r\n            (1 - Math.cos((long2 - long1) * p)/2)\r\n          )\r\n        )\r\n      )\r\n    );\r\n  }\r\n}\r\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport appImManager from '../../lib/appManagers/appImManager';\nimport rootScope from '../../lib/rootScope';\nimport {SearchGroup} from '../appSearch';\nimport '../avatar';\nimport Scrollable, {ScrollableX} from '../scrollable';\nimport InputSearch from '../inputSearch';\nimport SidebarSlider from '../slider';\nimport {TransitionSlider} from '../transition';\nimport AppNewGroupTab from './tabs/newGroup';\nimport AppSearchSuper from '../appSearchSuper.';\nimport {DateData, fillTipDates} from '../../helpers/date';\nimport {MOUNT_CLASS_TO} from '../../config/debug';\nimport AppSettingsTab from './tabs/settings';\nimport AppNewChannelTab from './tabs/newChannel';\nimport AppContactsTab from './tabs/contacts';\nimport AppArchivedTab from './tabs/archivedTab';\nimport AppAddMembersTab from './tabs/addMembers';\nimport I18n, {FormatterArguments, i18n, i18n_, LangPackKey} from '../../lib/langPack';\nimport AppPeopleNearbyTab from './tabs/peopleNearby';\nimport {ButtonMenuItemOptions} from '../buttonMenu';\nimport CheckboxField from '../checkboxField';\nimport {IS_MOBILE_SAFARI} from '../../environment/userAgent';\nimport appNavigationController, {NavigationItem} from '../appNavigationController';\nimport findUpClassName from '../../helpers/dom/findUpClassName';\nimport findUpTag from '../../helpers/dom/findUpTag';\nimport PeerTitle from '../peerTitle';\nimport App from '../../config/app';\nimport ButtonMenuToggle from '../buttonMenuToggle';\nimport replaceContent from '../../helpers/dom/replaceContent';\nimport sessionStorage from '../../lib/sessionStorage';\nimport {attachClickEvent, CLICK_EVENT_NAME, simulateClickEvent} from '../../helpers/dom/clickEvent';\nimport ButtonIcon from '../buttonIcon';\nimport confirmationPopup from '../confirmationPopup';\nimport IS_GEOLOCATION_SUPPORTED from '../../environment/geolocationSupport';\nimport type SortedUserList from '../sortedUserList';\nimport Button, {ButtonOptions} from '../button';\nimport noop from '../../helpers/noop';\nimport ripple from '../ripple';\nimport indexOfAndSplice from '../../helpers/array/indexOfAndSplice';\nimport formatNumber from '../../helpers/number/formatNumber';\nimport AvatarElement from '../avatar';\nimport {AppManagers} from '../../lib/appManagers/managers';\nimport themeController from '../../helpers/themeController';\nimport contextMenuController from '../../helpers/contextMenuController';\nimport {DIALOG_LIST_ELEMENT_TAG} from '../../lib/appManagers/appDialogsManager';\nimport apiManagerProxy from '../../lib/mtproto/mtprotoworker';\n\nexport const LEFT_COLUMN_ACTIVE_CLASSNAME = 'is-left-column-shown';\n\nexport class AppSidebarLeft extends SidebarSlider {\n  private toolsBtn: HTMLElement;\n  private backBtn: HTMLButtonElement;\n  // private searchInput = document.getElementById('global-search') as HTMLInputElement;\n  private inputSearch: InputSearch;\n\n  public archivedCount: HTMLSpanElement;\n\n  private newBtnMenu: HTMLElement;\n\n  // private log = logger('SL');\n\n  private searchGroups: {[k in 'contacts' | 'globalContacts' | 'messages' | 'people' | 'recent']: SearchGroup} = {} as any;\n  private searchSuper: AppSearchSuper;\n\n  private updateBtn: HTMLElement;\n  private hasUpdate: boolean;\n\n  constructor() {\n    super({\n      sidebarEl: document.getElementById('column-left') as HTMLDivElement,\n      navigationType: 'left'\n    });\n  }\n\n  construct(managers: AppManagers) {\n    this.managers = managers;\n    // this._selectTab(0); // make first tab as default\n\n    this.inputSearch = new InputSearch('Search');\n    const sidebarHeader = this.sidebarEl.querySelector('.item-main .sidebar-header');\n    sidebarHeader.append(this.inputSearch.container);\n\n    const onNewGroupClick = () => {\n      this.createTab(AppAddMembersTab).open({\n        type: 'chat',\n        skippable: false,\n        takeOut: (peerIds) => {\n          this.createTab(AppNewGroupTab).open(peerIds);\n        },\n        title: 'GroupAddMembers',\n        placeholder: 'SendMessageTo'\n      });\n    };\n\n    const onContactsClick = () => {\n      this.createTab(AppContactsTab).open();\n    };\n\n    // this.toolsBtn = this.sidebarEl.querySelector('.sidebar-tools-button') as HTMLButtonElement;\n    this.backBtn = this.sidebarEl.querySelector('.sidebar-back-button') as HTMLButtonElement;\n\n    const btnArchive: typeof menuButtons[0] = {\n      icon: 'archive',\n      text: 'ArchivedChats',\n      onClick: () => {\n        this.createTab(AppArchivedTab).open();\n      },\n      verify: async() => {\n        const folder = await this.managers.dialogsStorage.getFolderDialogs(1, false);\n        return !!folder.length || !(await this.managers.dialogsStorage.isDialogsLoaded(1));\n      }\n    };\n\n    const themeCheckboxField = new CheckboxField({\n      toggle: true,\n      checked: themeController.getTheme().name === 'night'\n    });\n    themeCheckboxField.input.addEventListener('change', async() => {\n      await this.managers.appStateManager.setByKey('settings.theme', themeCheckboxField.input.checked ? 'night' : 'day');\n      rootScope.dispatchEvent('theme_change');\n    });\n\n    rootScope.addEventListener('theme_change', () => {\n      themeCheckboxField.setValueSilently(themeController.getTheme().name === 'night');\n    });\n\n    const menuButtons: (ButtonMenuItemOptions & {verify?: () => boolean | Promise<boolean>})[] = [{\n      icon: 'saved',\n      text: 'SavedMessages',\n      onClick: () => {\n        setTimeout(() => { // menu doesn't close if no timeout (lol)\n          appImManager.setPeer({\n            peerId: appImManager.myId\n          });\n        }, 0);\n      }\n    }, btnArchive, {\n      icon: 'user',\n      text: 'Contacts',\n      onClick: onContactsClick\n    }, IS_GEOLOCATION_SUPPORTED ? {\n      icon: 'group',\n      text: 'PeopleNearby',\n      onClick: () => {\n        this.createTab(AppPeopleNearbyTab).open();\n      }\n    } : undefined, {\n      icon: 'settings',\n      text: 'Settings',\n      onClick: () => {\n        this.createTab(AppSettingsTab).open();\n      }\n    }, {\n      icon: 'darkmode',\n      text: 'DarkMode',\n      onClick: () => {\n\n      },\n      checkboxField: themeCheckboxField\n    }, {\n      icon: 'animations',\n      text: 'Animations',\n      onClick: () => {\n\n      },\n      checkboxField: new CheckboxField({\n        toggle: true,\n        checked: true,\n        stateKey: 'settings.animationsEnabled'\n      })\n    }, {\n      icon: 'help',\n      text: 'TelegramFeatures',\n      onClick: () => {\n        const url = I18n.format('TelegramFeaturesUrl', true);\n        appImManager.openUrl(url);\n      }\n    }, {\n      icon: 'bug',\n      text: 'ReportBug',\n      onClick: () => {\n        const a = document.createElement('a');\n        a.target = '_blank';\n        a.href = 'https://bugs.telegram.org/?tag_ids=40&sort=time';\n        document.body.append(a);\n        a.click();\n        setTimeout(() => {\n          a.remove();\n        }, 0);\n      }\n    }, {\n      icon: 'char z',\n      text: 'ChatList.Menu.SwitchTo.Z',\n      onClick: () => {\n        Promise.all([\n          sessionStorage.set({kz_version: 'Z'}),\n          sessionStorage.delete('tgme_sync')\n        ]).then(() => {\n          location.href = 'https://web.telegram.org/z/';\n        });\n      },\n      verify: () => App.isMainDomain\n    }, {\n      icon: 'char w',\n      text: 'ChatList.Menu.SwitchTo.Webogram',\n      onClick: () => {\n        sessionStorage.delete('tgme_sync').then(() => {\n          location.href = 'https://web.telegram.org/?legacy=1';\n        });\n      },\n      verify: () => App.isMainDomain\n    }];\n\n    const filteredButtons = menuButtons.filter(Boolean);\n\n    this.toolsBtn = ButtonMenuToggle({}, 'bottom-right', filteredButtons, async(e) => {\n      await Promise.all(filteredButtons.map(async(button) => {\n        if(button.verify) {\n          button.element.classList.toggle('hide', !(await button.verify()));\n        }\n      }));\n    });\n    this.toolsBtn.classList.remove('tgico-more');\n    this.toolsBtn.classList.add('sidebar-tools-button', 'is-visible');\n\n    this.backBtn.parentElement.insertBefore(this.toolsBtn, this.backBtn);\n\n    const btnMenu = this.toolsBtn.querySelector('.btn-menu') as HTMLElement;\n\n    const btnMenuFooter = document.createElement('a');\n    btnMenuFooter.href = 'https://github.com/morethanwords/tweb/blob/master/CHANGELOG.md';\n    btnMenuFooter.target = '_blank';\n    btnMenuFooter.rel = 'noopener noreferrer';\n    btnMenuFooter.classList.add('btn-menu-footer');\n    btnMenuFooter.addEventListener(CLICK_EVENT_NAME, (e) => {\n      e.stopPropagation();\n      contextMenuController.close();\n    });\n    const t = document.createElement('span');\n    t.classList.add('btn-menu-footer-text');\n    t.innerHTML = 'Telegram Web' + App.suffix + ' '/* ' alpha ' */ + App.versionFull;\n    btnMenuFooter.append(t);\n    btnMenu.classList.add('has-footer');\n    btnMenu.append(btnMenuFooter);\n\n    this.newBtnMenu = ButtonMenuToggle({}, 'top-left', [{\n      icon: 'newchannel',\n      text: 'NewChannel',\n      onClick: () => {\n        this.createTab(AppNewChannelTab).open();\n      }\n    }, {\n      icon: 'newgroup',\n      text: 'NewGroup',\n      onClick: onNewGroupClick\n    }, {\n      icon: 'newprivate',\n      text: 'NewPrivateChat',\n      onClick: onContactsClick\n    }]);\n    this.newBtnMenu.className = 'btn-circle rp btn-corner z-depth-1 btn-menu-toggle animated-button-icon';\n    this.newBtnMenu.insertAdjacentHTML('afterbegin', `\n    <span class=\"tgico tgico-newchat_filled\"></span>\n    <span class=\"tgico tgico-close\"></span>\n    `);\n    this.newBtnMenu.id = 'new-menu';\n    sidebarHeader.nextElementSibling.append(this.newBtnMenu);\n\n    this.updateBtn = document.createElement('div');\n    // this.updateBtn.classList.add('btn-update');\n    this.updateBtn.className = 'btn-circle rp btn-corner z-depth-1 btn-update is-hidden';\n    ripple(this.updateBtn);\n    this.updateBtn.append(i18n('Update'));\n    // const weave = new TopbarWeave();\n    // const weaveContainer = weave.render('btn-update-weave');\n    // this.updateBtn.prepend(weaveContainer);\n\n    attachClickEvent(this.updateBtn, () => {\n      if(this.updateBtn.classList.contains('is-hidden')) {\n        return;\n      }\n\n      location.reload();\n    });\n\n    sidebarHeader.nextElementSibling.append(this.updateBtn);\n\n    // setTimeout(() => {\n    //   weave.componentDidMount();\n    //   weave.setCurrentState(GROUP_CALL_STATE.MUTED, true);\n    //   weave.setAmplitude(0);\n    //   weave.handleBlur();\n    // }, 1e3);\n\n    this.inputSearch.input.addEventListener('focus', () => this.initSearch(), {once: true});\n\n    // parseMenuButtonsTo(this.newButtons, this.newBtnMenu.firstElementChild.children);\n\n    this.archivedCount = document.createElement('span');\n    this.archivedCount.className = 'archived-count badge badge-24 badge-gray';\n\n    btnArchive.element.append(this.archivedCount);\n\n    rootScope.addEventListener('folder_unread', (folder) => {\n      if(folder.id === 1) {\n        // const count = folder.unreadMessagesCount;\n        const count = folder.unreadPeerIds.size;\n        this.archivedCount.innerText = '' + formatNumber(count, 1);\n        this.archivedCount.classList.toggle('hide', !count);\n      }\n    });\n\n    this.managers.appUsersManager.getTopPeers('correspondents');\n\n    // Focus search input by pressing Escape\n    const navigationItem: NavigationItem = {\n      type: 'global-search-focus',\n      onPop: () => {\n        setTimeout(() => {\n          this.inputSearch.input.focus();\n        }, 0);\n\n        return false;\n      },\n      noHistory: true\n    };\n    appNavigationController.pushItem(navigationItem);\n\n    apiManagerProxy.getState().then((state) => {\n      const CHECK_UPDATE_INTERVAL = 1800e3;\n      const checkUpdateInterval = setInterval(() => {\n        fetch('version', {cache: 'no-cache'})\n        .then((res) => (res.status === 200 && res.ok && res.text()) || Promise.reject())\n        .then((text) => {\n          if(text !== App.versionFull) {\n            this.hasUpdate = true;\n            clearInterval(checkUpdateInterval);\n\n            if(!this.newBtnMenu.classList.contains('is-hidden')) {\n              this.updateBtn.classList.remove('is-hidden');\n            }\n          }\n        })\n        .catch(noop);\n      }, CHECK_UPDATE_INTERVAL);\n    });\n  }\n\n  private initSearch() {\n    const searchContainer = this.sidebarEl.querySelector('#search-container') as HTMLDivElement;\n\n    const scrollable = new Scrollable(searchContainer);\n\n    const close = () => {\n      // setTimeout(() => {\n      simulateClickEvent(this.backBtn);\n      // }, 0);\n    };\n\n    this.searchGroups = {\n      contacts: new SearchGroup('SearchAllChatsShort', 'contacts', undefined, undefined, undefined, undefined, close),\n      globalContacts: new SearchGroup('GlobalSearch', 'contacts', undefined, undefined, undefined, undefined, close),\n      messages: new SearchGroup('SearchMessages', 'messages'),\n      people: new SearchGroup(false, 'contacts', true, 'search-group-people', true, false, close, true),\n      recent: new SearchGroup('Recent', 'contacts', true, 'search-group-recent', true, true, close)\n    };\n\n    const searchSuper = this.searchSuper = new AppSearchSuper({\n      mediaTabs: [{\n        inputFilter: 'inputMessagesFilterEmpty',\n        name: 'FilterChats',\n        type: 'chats'\n      }, {\n        inputFilter: 'inputMessagesFilterPhotoVideo',\n        name: 'SharedMediaTab2',\n        type: 'media'\n      }, {\n        inputFilter: 'inputMessagesFilterUrl',\n        name: 'SharedLinksTab2',\n        type: 'links'\n      }, {\n        inputFilter: 'inputMessagesFilterDocument',\n        name: 'SharedFilesTab2',\n        type: 'files'\n      }, {\n        inputFilter: 'inputMessagesFilterMusic',\n        name: 'SharedMusicTab2',\n        type: 'music'\n      }, {\n        inputFilter: 'inputMessagesFilterRoundVoice',\n        name: 'SharedVoiceTab2',\n        type: 'voice'\n      }],\n      scrollable,\n      searchGroups: this.searchGroups,\n      asChatList: true,\n      hideEmptyTabs: false,\n      showSender: true,\n      managers: this.managers\n    });\n\n    searchContainer.prepend(searchSuper.nav.parentElement.parentElement);\n    scrollable.container.append(searchSuper.container);\n\n    const resetSearch = () => {\n      searchSuper.setQuery({\n        peerId: ''.toPeerId(),\n        folderId: 0\n      });\n      searchSuper.selectTab(0);\n      searchSuper.load(true);\n    };\n\n    resetSearch();\n\n    const pickedElements: HTMLElement[] = [];\n    let selectedPeerId: PeerId = ''.toPeerId();\n    let selectedMinDate = 0;\n    let selectedMaxDate = 0;\n    const updatePicked = () => {\n      // (this.inputSearch.input as HTMLInputElement).placeholder = pickedElements.length ? 'Search' : 'Telegram Search';\n      this.inputSearch.container.classList.toggle('is-picked-twice', pickedElements.length === 2);\n      this.inputSearch.container.classList.toggle('is-picked', !!pickedElements.length);\n\n      if(pickedElements.length) {\n        this.inputSearch.input.style.setProperty('--paddingLeft', (pickedElements[pickedElements.length - 1].getBoundingClientRect().right - this.inputSearch.input.getBoundingClientRect().left) + 'px');\n      } else {\n        this.inputSearch.input.style.removeProperty('--paddingLeft');\n      }\n    };\n\n    const helper = document.createElement('div');\n    helper.classList.add('search-helper');\n    helper.addEventListener('click', (e) => {\n      const target = findUpClassName(e.target, 'selector-user');\n      if(!target) {\n        return;\n      }\n\n      const key = target.dataset.key;\n      if(key.indexOf('date_') === 0) {\n        const [_, minDate, maxDate] = key.split('_');\n        selectedMinDate = +minDate;\n        selectedMaxDate = +maxDate;\n      } else {\n        selectedPeerId = key.toPeerId();\n      }\n\n      target.addEventListener('click', () => {\n        unselectEntity(target);\n      });\n\n      this.inputSearch.container.append(target);\n      this.inputSearch.onChange(this.inputSearch.value = '');\n      pickedElements.push(target);\n      updatePicked();\n    });\n\n    searchSuper.nav.parentElement.append(helper);\n\n    const renderEntity = (key: PeerId | string, title?: string | HTMLElement) => {\n      const div = document.createElement('div');\n      div.classList.add('selector-user'/* , 'scale-in' */);\n\n      const avatarEl = new AvatarElement();\n      avatarEl.classList.add('selector-user-avatar', 'tgico', 'avatar-30');\n      avatarEl.isDialog = true;\n\n      div.dataset.key = '' + key;\n      if(key.isPeerId()) {\n        if(title === undefined) {\n          title = new PeerTitle({peerId: key.toPeerId()}).element;\n        }\n\n        avatarEl.updateWithOptions({peerId: key as PeerId});\n      } else {\n        avatarEl.classList.add('tgico-calendarfilter');\n      }\n\n      if(title) {\n        if(typeof(title) === 'string') {\n          div.innerHTML = title;\n        } else {\n          replaceContent(div, title);\n          div.append(title);\n        }\n      }\n\n      div.insertAdjacentElement('afterbegin', avatarEl);\n\n      return div;\n    };\n\n    const unselectEntity = (target: HTMLElement) => {\n      const key = target.dataset.key;\n      if(key.indexOf('date_') === 0) {\n        selectedMinDate = selectedMaxDate = 0;\n      } else {\n        selectedPeerId = ''.toPeerId();\n      }\n\n      target.remove();\n      indexOfAndSplice(pickedElements, target);\n\n      setTimeout(() => {\n        updatePicked();\n        this.inputSearch.onChange(this.inputSearch.value);\n      }, 0);\n    };\n\n    this.inputSearch.onClear = () => {\n      pickedElements.forEach((el) => {\n        unselectEntity(el);\n      });\n    };\n\n    this.inputSearch.onChange = (value) => {\n      searchSuper.cleanupHTML();\n      searchSuper.setQuery({\n        peerId: selectedPeerId,\n        folderId: selectedPeerId ? undefined : 0,\n        query: value,\n        minDate: selectedMinDate,\n        maxDate: selectedMaxDate\n      });\n      searchSuper.load(true);\n\n      helper.innerHTML = '';\n      searchSuper.nav.classList.remove('hide');\n      if(!value) {\n      }\n\n      if(!selectedPeerId && value.trim()) {\n        const middleware = searchSuper.middleware.get();\n        Promise.all([\n          // appMessagesManager.getConversationsAll(value).then((dialogs) => dialogs.map((d) => d.peerId)),\n          this.managers.appMessagesManager.getConversations(value).then(({dialogs}) => dialogs.map((d) => d.peerId)),\n          this.managers.appUsersManager.getContactsPeerIds(value, true)\n        ]).then((results) => {\n          if(!middleware()) return;\n          const peerIds = new Set(results[0].concat(results[1]));\n\n          peerIds.forEach((peerId) => {\n            helper.append(renderEntity(peerId));\n          });\n\n          searchSuper.nav.classList.toggle('hide', !!helper.innerHTML);\n          // console.log('got peerIds by value:', value, [...peerIds]);\n        });\n      }\n\n      if(!selectedMinDate && value.trim()) {\n        const dates: DateData[] = [];\n        fillTipDates(value, dates);\n        dates.forEach((dateData) => {\n          helper.append(renderEntity('date_' + dateData.minDate + '_' + dateData.maxDate, dateData.title));\n        });\n\n        searchSuper.nav.classList.toggle('hide', !!helper.innerHTML);\n      }\n    };\n\n    searchSuper.tabs.inputMessagesFilterEmpty.addEventListener('mousedown', (e) => {\n      const target = findUpTag(e.target, DIALOG_LIST_ELEMENT_TAG) as HTMLElement;\n      if(!target) {\n        return;\n      }\n\n      const searchGroup = findUpClassName(target, 'search-group');\n      if(!searchGroup || searchGroup.classList.contains('search-group-recent') || searchGroup.classList.contains('search-group-people')) {\n        return;\n      }\n\n      const peerId = target.getAttribute('data-peer-id').toPeerId();\n      this.managers.appUsersManager.pushRecentSearch(peerId);\n    }, {capture: true});\n\n    const peopleContainer = document.createElement('div');\n    peopleContainer.classList.add('search-group-scrollable');\n    peopleContainer.append(this.searchGroups.people.list);\n    this.searchGroups.people.container.append(peopleContainer);\n    const peopleScrollable = new ScrollableX(peopleContainer);\n\n    let first = true;\n    let hideNewBtnMenuTimeout: number;\n    // const transition = Transition.bind(null, searchContainer.parentElement, 150);\n    const transition = TransitionSlider(searchContainer.parentElement, 'zoom-fade', 150, (id) => {\n      if(hideNewBtnMenuTimeout) clearTimeout(hideNewBtnMenuTimeout);\n\n      if(id === 0 && !first) {\n        searchSuper.selectTab(0, false);\n        this.inputSearch.onClearClick();\n        hideNewBtnMenuTimeout = window.setTimeout(() => {\n          hideNewBtnMenuTimeout = 0;\n          this.newBtnMenu.classList.remove('is-hidden');\n          this.hasUpdate && this.updateBtn.classList.remove('is-hidden');\n        }, 150);\n      }\n\n      first = false;\n    });\n\n    transition(0);\n\n    const activeClassName = 'is-visible';\n    const onFocus = () => {\n      this.toolsBtn.classList.remove(activeClassName);\n      this.backBtn.classList.add(activeClassName);\n      this.newBtnMenu.classList.add('is-hidden');\n      this.updateBtn.classList.add('is-hidden');\n      this.toolsBtn.parentElement.firstElementChild.classList.toggle('state-back', true);\n\n      const navigationType: NavigationItem['type'] = 'global-search';\n      if(!IS_MOBILE_SAFARI && !appNavigationController.findItemByType(navigationType)) {\n        appNavigationController.pushItem({\n          onPop: () => {\n            close();\n          },\n          type: navigationType\n        });\n      }\n\n      transition(1);\n    };\n\n    this.inputSearch.input.addEventListener('focus', onFocus);\n    onFocus();\n\n    attachClickEvent(this.backBtn, (e) => {\n      this.toolsBtn.classList.add(activeClassName);\n      this.backBtn.classList.remove(activeClassName);\n      this.toolsBtn.parentElement.firstElementChild.classList.toggle('state-back', false);\n\n      appNavigationController.removeByType('global-search');\n\n      transition(0);\n    });\n\n    const clearRecentSearchBtn = ButtonIcon('close');\n    this.searchGroups.recent.nameEl.append(clearRecentSearchBtn);\n    clearRecentSearchBtn.addEventListener('click', () => {\n      confirmationPopup({\n        descriptionLangKey: 'Search.Confirm.ClearHistory',\n        button: {\n          langKey: 'ClearButton',\n          isDanger: true\n        }\n      }).then(() => {\n        return this.managers.appUsersManager.clearRecentSearch().then(() => {\n          this.searchGroups.recent.clear();\n        });\n      });\n    });\n  }\n}\n\nexport type SettingSectionOptions = {\n  name?: LangPackKey,\n  nameArgs?: FormatterArguments,\n  caption?: LangPackKey | true,\n  captionArgs?: FormatterArguments,\n  captionOld?: SettingSectionOptions['caption'],\n  noDelimiter?: boolean,\n  fakeGradientDelimiter?: boolean,\n  noShadow?: boolean,\n  // fullWidth?: boolean,\n  // noPaddingTop?: boolean\n};\n\nconst className = 'sidebar-left-section';\nexport class SettingSection {\n  public container: HTMLElement;\n  public innerContainer: HTMLElement;\n  public content: HTMLElement;\n  public title: HTMLElement;\n  public caption: HTMLElement;\n\n  private fullWidth: boolean;\n\n  constructor(options: SettingSectionOptions = {}) {\n    const container = this.container = document.createElement('div');\n    container.classList.add(className + '-container');\n\n    const innerContainer = this.innerContainer = document.createElement('div');\n    innerContainer.classList.add(className);\n\n    if(options.noShadow) {\n      innerContainer.classList.add('no-shadow');\n    }\n\n    if(options.fakeGradientDelimiter) {\n      innerContainer.append(generateDelimiter());\n      innerContainer.classList.add('with-fake-delimiter');\n    } else if(!options.noDelimiter) {\n      const hr = document.createElement('hr');\n      innerContainer.append(hr);\n    } else {\n      innerContainer.classList.add('no-delimiter');\n    }\n\n    // if(options.fullWidth) {\n    //   this.fullWidth = true;\n    // }\n\n    // if(options.noPaddingTop) {\n    //   innerContainer.classList.add('no-padding-top');\n    // }\n\n    const content = this.content = this.generateContentElement();\n\n    if(options.name) {\n      const title = this.title = document.createElement('div');\n      title.classList.add('sidebar-left-h2', className + '-name');\n      i18n_({element: title, key: options.name, args: options.nameArgs});\n      content.append(title);\n    }\n\n    container.append(innerContainer);\n\n    const caption = options.caption ?? options.captionOld;\n    if(caption) {\n      const el = this.caption = this.generateContentElement();\n      el.classList.add(className + '-caption');\n\n      if(!options.captionOld) {\n        container.append(el);\n      }\n\n      if(caption !== true) {\n        i18n_({element: el, key: caption, args: options.captionArgs});\n      }\n    }\n  }\n\n  public generateContentElement() {\n    const content = document.createElement('div');\n    content.classList.add(className + '-content');\n\n    // if(this.fullWidth) {\n    //   content.classList.add('full-width');\n    // }\n\n    this.innerContainer.append(content);\n    return content;\n  }\n}\n\nexport const generateSection = (appendTo: Scrollable, name?: LangPackKey, caption?: LangPackKey) => {\n  const section = new SettingSection({name, caption});\n  appendTo.append(section.container);\n  return section.content;\n};\n\nexport const generateDelimiter = () => {\n  const delimiter = document.createElement('div');\n  delimiter.classList.add('gradient-delimiter');\n  return delimiter;\n};\n\nexport class SettingChatListSection extends SettingSection {\n  public sortedList: SortedUserList;\n\n  constructor(options: SettingSectionOptions & {sortedList: SortedUserList}) {\n    super(options);\n\n    this.sortedList = options.sortedList;\n\n    this.content.append(this.sortedList.list);\n  }\n\n  public makeButton(options: ButtonOptions) {\n    const button = Button('folder-category-button btn btn-primary btn-transparent', options);\n    if(this.title) this.content.insertBefore(button, this.title.nextSibling);\n    else this.content.prepend(button);\n    return button;\n  }\n}\n\nconst appSidebarLeft = new AppSidebarLeft();\nMOUNT_CLASS_TO.appSidebarLeft = appSidebarLeft;\nexport default appSidebarLeft;\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport {SliderSuperTab} from '../../slider';\r\nimport AppSelectPeers from '../../appSelectPeers';\r\nimport {setButtonLoader} from '../../putPreloader';\r\nimport {LangPackKey, _i18n} from '../../../lib/langPack';\r\nimport ButtonCorner from '../../buttonCorner';\r\n\r\nexport default class AppAddMembersTab extends SliderSuperTab {\r\n  private nextBtn: HTMLButtonElement;\r\n  private selector: AppSelectPeers;\r\n  private peerType: 'channel' | 'chat' | 'privacy';\r\n  private takeOut: (peerIds: PeerId[]) => Promise<any> | false | void;\r\n  private skippable: boolean;\r\n\r\n  protected init() {\r\n    this.container.classList.add('add-members-container');\r\n    this.nextBtn = ButtonCorner({icon: 'arrow_next'});\r\n    this.content.append(this.nextBtn);\r\n    this.scrollable.container.remove();\r\n\r\n    this.nextBtn.addEventListener('click', () => {\r\n      const peerIds = this.selector.getSelected().map((sel) => sel.toPeerId());\r\n\r\n      if(this.skippable) {\r\n        this.takeOut(peerIds);\r\n        this.close();\r\n      } else {\r\n        const promise = this.takeOut(peerIds);\r\n\r\n        if(promise instanceof Promise) {\r\n          this.attachToPromise(promise);\r\n        } else if(promise === undefined) {\r\n          this.close();\r\n        }\r\n      }\r\n    });\r\n  }\r\n\r\n  public attachToPromise(promise: Promise<any>) {\r\n    const removeLoader = setButtonLoader(this.nextBtn, 'arrow_next');\r\n\r\n    promise.then(() => {\r\n      this.close();\r\n    }, () => {\r\n      removeLoader();\r\n    });\r\n  }\r\n\r\n  public open(options: {\r\n    title: LangPackKey,\r\n    placeholder: LangPackKey,\r\n    type: AppAddMembersTab['peerType'],\r\n    takeOut?: AppAddMembersTab['takeOut'],\r\n    skippable: boolean,\r\n    selectedPeerIds?: PeerId[]\r\n  }) {\r\n    const ret = super.open();\r\n\r\n    this.setTitle(options.title);\r\n    this.peerType = options.type;\r\n    this.takeOut = options.takeOut;\r\n    this.skippable = options.skippable;\r\n\r\n    const isPrivacy = this.peerType === 'privacy';\r\n    this.selector = new AppSelectPeers({\r\n      appendTo: this.content,\r\n      onChange: this.skippable ? null : (length) => {\r\n        this.nextBtn.classList.toggle('is-visible', !!length);\r\n      },\r\n      peerType: [isPrivacy ? 'dialogs' : 'contacts'],\r\n      placeholder: options.placeholder,\r\n      exceptSelf: isPrivacy,\r\n      filterPeerTypeBy: isPrivacy ? ['isAnyGroup', 'isUser'] : undefined,\r\n      managers: this.managers\r\n    });\r\n\r\n    if(options.selectedPeerIds) {\r\n      this.selector.addInitial(options.selectedPeerIds);\r\n    }\r\n\r\n    this.nextBtn.classList.add('tgico-arrow_next');\r\n    this.nextBtn.innerHTML = '';\r\n    this.nextBtn.disabled = false;\r\n    this.nextBtn.classList.toggle('is-visible', this.skippable);\r\n\r\n    return ret;\r\n  }\r\n}\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport type {MyDialogFilter} from '../../../lib/storages/filters';\r\nimport type {DialogFilterSuggested} from '../../../layer';\r\nimport type _rootScope from '../../../lib/rootScope';\r\nimport {SliderSuperTab} from '../../slider';\r\nimport lottieLoader, {LottieLoader} from '../../../lib/rlottie/lottieLoader';\r\nimport {toast} from '../../toast';\r\nimport Button from '../../button';\r\nimport rootScope from '../../../lib/rootScope';\r\nimport AppEditFolderTab from './editFolder';\r\nimport Row from '../../row';\r\nimport {SettingSection} from '..';\r\nimport {i18n, i18n_, LangPackKey, join} from '../../../lib/langPack';\r\nimport cancelEvent from '../../../helpers/dom/cancelEvent';\r\nimport {attachClickEvent} from '../../../helpers/dom/clickEvent';\r\nimport positionElementByIndex from '../../../helpers/dom/positionElementByIndex';\r\nimport RLottiePlayer from '../../../lib/rlottie/rlottiePlayer';\r\nimport wrapEmojiText from '../../../lib/richTextProcessor/wrapEmojiText';\r\nimport {FOLDER_ID_ALL, FOLDER_ID_ARCHIVE, REAL_FOLDERS} from '../../../lib/mtproto/mtproto_config';\r\nimport replaceContent from '../../../helpers/dom/replaceContent';\r\n\r\nexport default class AppChatFoldersTab extends SliderSuperTab {\r\n  private createFolderBtn: HTMLElement;\r\n  private foldersSection: SettingSection;\r\n  private suggestedSection: SettingSection;\r\n  private stickerContainer: HTMLElement;\r\n  private animation: RLottiePlayer;\r\n\r\n  private filtersRendered: {[filterId: number]: Row} = {};\r\n  private loadAnimationPromise: ReturnType<LottieLoader['waitForFirstFrame']>;\r\n\r\n  private async renderFolder(\r\n    dialogFilter: DialogFilterSuggested | MyDialogFilter,\r\n    container?: HTMLElement,\r\n    row?: Row,\r\n    append?: boolean\r\n  ) {\r\n    let filter: MyDialogFilter;\r\n    let description = '';\r\n    const d: HTMLElement[] = [];\r\n    if(dialogFilter._ === 'dialogFilterSuggested') {\r\n      filter = dialogFilter.filter as MyDialogFilter;\r\n      description = dialogFilter.description;\r\n    } else {\r\n      filter = dialogFilter;\r\n\r\n      const enabledFilters = Object.keys(filter.pFlags).length;\r\n      /* (['include_peers', 'exclude_peers'] as ['include_peers', 'exclude_peers']).forEach((key) => {\r\n        enabledFilters += +!!filter[key].length;\r\n      }); */\r\n\r\n      if(enabledFilters === 1) {\r\n        const pFlags = filter.pFlags;\r\n        let k: LangPackKey;\r\n        if(pFlags.contacts) k = 'FilterAllContacts';\r\n        else if(pFlags.non_contacts) k = 'FilterAllNonContacts';\r\n        else if(pFlags.groups) k = 'FilterAllGroups';\r\n        else if(pFlags.broadcasts) k = 'FilterAllChannels';\r\n        else if(pFlags.bots) k = 'FilterAllBots';\r\n\r\n        if(k) {\r\n          d.push(i18n(k));\r\n        }\r\n      }\r\n\r\n      if(!d.length) {\r\n        const folder = await this.managers.dialogsStorage.getFolderDialogs(filter.id);\r\n        let chats = 0, channels = 0, groups = 0;\r\n        await Promise.all(folder.map(async(dialog) => {\r\n          if(await this.managers.appPeersManager.isAnyGroup(dialog.peerId)) groups++;\r\n          else if(await this.managers.appPeersManager.isBroadcast(dialog.peerId)) channels++;\r\n          else chats++;\r\n        }));\r\n\r\n        if(chats) d.push(i18n('Chats', [chats]));\r\n        if(channels) d.push(i18n('Channels', [channels]));\r\n        if(groups) d.push(i18n('Groups', [groups]));\r\n      }\r\n    }\r\n\r\n    if(!row) {\r\n      row = new Row({\r\n        title: filter.id === FOLDER_ID_ALL ? i18n('FilterAllChats') : wrapEmojiText(filter.title),\r\n        subtitle: description,\r\n        clickable: filter.id !== FOLDER_ID_ALL,\r\n        buttonRightLangKey: dialogFilter._ === 'dialogFilterSuggested' ? 'Add' : undefined\r\n      });\r\n\r\n      if(d.length) {\r\n        row.subtitle.append(...join(d));\r\n      }\r\n\r\n      if(dialogFilter._ === 'dialogFilter') {\r\n        const filterId = filter.id;\r\n        if(!this.filtersRendered[filter.id] && filter.id !== FOLDER_ID_ALL) {\r\n          attachClickEvent(row.container, async() => {\r\n            this.slider.createTab(AppEditFolderTab).open(await this.managers.filtersStorage.getFilter(filterId));\r\n          }, {listenerSetter: this.listenerSetter});\r\n        }\r\n\r\n        this.filtersRendered[filter.id] = row;\r\n      }\r\n    } else {\r\n      if(filter.id !== FOLDER_ID_ALL) {\r\n        replaceContent(row.title, wrapEmojiText(filter.title));\r\n      }\r\n\r\n      row.subtitle.textContent = '';\r\n      row.subtitle.append(...join(d));\r\n    }\r\n\r\n    const div = row.container;\r\n\r\n    if(append) {\r\n      const localId = (filter as MyDialogFilter).localId;\r\n      if(localId !== undefined) {\r\n        // ! header will be at 0 index\r\n        positionElementByIndex(div, div.parentElement || container, localId);\r\n      } else if(container) {\r\n        container.append(div);\r\n      }\r\n    }\r\n\r\n    return row;\r\n  }\r\n\r\n  protected async init() {\r\n    this.container.classList.add('chat-folders-container');\r\n    this.setTitle('ChatList.Filter.List.Title');\r\n\r\n    this.scrollable.container.classList.add('chat-folders');\r\n\r\n    this.stickerContainer = document.createElement('div');\r\n    this.stickerContainer.classList.add('sticker-container');\r\n\r\n    const caption = document.createElement('div');\r\n    caption.classList.add('caption');\r\n    i18n_({element: caption, key: 'ChatList.Filter.Header'});\r\n\r\n    this.createFolderBtn = Button('btn-primary btn-color-primary btn-control tgico', {\r\n      text: 'ChatList.Filter.NewTitle',\r\n      icon: 'add'\r\n    });\r\n\r\n    this.foldersSection = new SettingSection({\r\n      name: 'Filters'\r\n    });\r\n    this.foldersSection.container.style.display = 'none';\r\n\r\n    this.suggestedSection = new SettingSection({\r\n      name: 'FilterRecommended'\r\n    });\r\n    this.suggestedSection.container.style.display = 'none';\r\n\r\n    this.scrollable.append(this.stickerContainer, caption, this.createFolderBtn, this.foldersSection.container, this.suggestedSection.container);\r\n\r\n    attachClickEvent(this.createFolderBtn, async() => {\r\n      if(!(await this.canCreateFolder())) {\r\n        toast('Sorry, you can\\'t create more folders.');\r\n      } else {\r\n        this.slider.createTab(AppEditFolderTab).open();\r\n      }\r\n    }, {listenerSetter: this.listenerSetter});\r\n\r\n    const onFiltersContainerUpdate = () => {\r\n      this.foldersSection.container.style.display = Object.keys(this.filtersRendered).length ? '' : 'none';\r\n    };\r\n\r\n    this.managers.filtersStorage.getDialogFilters().then(async(filters) => {\r\n      for(const filter of filters) {\r\n        if(filter.id === FOLDER_ID_ARCHIVE) {\r\n          continue;\r\n        }\r\n\r\n        await this.renderFolder(filter, this.foldersSection.content, undefined, true);\r\n      }\r\n\r\n      this.toggleAllChats();\r\n\r\n      onFiltersContainerUpdate();\r\n    });\r\n\r\n    this.listenerSetter.add(rootScope)('filter_update', async(filter) => {\r\n      const filterRendered = this.filtersRendered[filter.id];\r\n      if(filterRendered) {\r\n        await this.renderFolder(filter, null, filterRendered);\r\n      } else if(filter.id !== FOLDER_ID_ARCHIVE) {\r\n        await this.renderFolder(filter, this.foldersSection.content, undefined, true);\r\n      }\r\n\r\n      onFiltersContainerUpdate();\r\n\r\n      this.getSuggestedFilters();\r\n    });\r\n\r\n    this.listenerSetter.add(rootScope)('filter_delete', (filter) => {\r\n      const filterRendered = this.filtersRendered[filter.id];\r\n      if(filterRendered) {\r\n        /* for(const suggested of this.suggestedFilters) {\r\n          if(deepEqual(suggested.filter, filter)) {\r\n\r\n          }\r\n        } */\r\n        this.getSuggestedFilters();\r\n\r\n        filterRendered.container.remove();\r\n        delete this.filtersRendered[filter.id];\r\n      }\r\n\r\n      onFiltersContainerUpdate();\r\n    });\r\n\r\n    this.listenerSetter.add(rootScope)('filter_order', (order) => {\r\n      order.filter((filterId) => !!this.filtersRendered[filterId]).forEach((filterId, idx) => {\r\n        const filterRendered = this.filtersRendered[filterId];\r\n        const container = filterRendered.container;\r\n        positionElementByIndex(container, container.parentElement, idx + 1); // ! + 1 due to header\r\n      });\r\n    });\r\n\r\n    this.listenerSetter.add(rootScope)('premium_toggle', () => {\r\n      this.toggleAllChats();\r\n    });\r\n\r\n    this.loadAnimationPromise = lottieLoader.loadAnimationAsAsset({\r\n      container: this.stickerContainer,\r\n      loop: false,\r\n      autoplay: false,\r\n      width: 86,\r\n      height: 86\r\n    }, 'Folders_1').then((player) => {\r\n      this.animation = player;\r\n\r\n      return lottieLoader.waitForFirstFrame(player);\r\n    });\r\n\r\n    this.getSuggestedFilters()\r\n\r\n    /* return Promise.all([\r\n      this.loadAnimationPromise\r\n    ]); */\r\n    return this.loadAnimationPromise;\r\n  }\r\n\r\n  onOpenAfterTimeout() {\r\n    this.loadAnimationPromise.then(() => {\r\n      this.animation.autoplay = true;\r\n      this.animation.play();\r\n    });\r\n  }\r\n\r\n  private toggleAllChats() {\r\n    const filterRendered = this.filtersRendered[FOLDER_ID_ALL];\r\n    filterRendered.container.classList.toggle('hide', !rootScope.premium);\r\n  }\r\n\r\n  private async canCreateFolder() {\r\n    const [appConfig, filters] = await Promise.all([\r\n      this.managers.apiManager.getAppConfig(),\r\n      this.managers.filtersStorage.getDialogFilters()\r\n    ]);\r\n\r\n    const filtersLength = filters.filter((filter) => !REAL_FOLDERS.has(filter.id)).length;\r\n    return filtersLength < (rootScope.premium ? appConfig.dialog_filters_limit_premium : appConfig.dialog_filters_limit_default);\r\n  }\r\n\r\n  private getSuggestedFilters() {\r\n    return this.managers.filtersStorage.getSuggestedDialogsFilters().then(async(suggestedFilters) => {\r\n      this.suggestedSection.container.style.display = suggestedFilters.length ? '' : 'none';\r\n      Array.from(this.suggestedSection.content.children).slice(1).forEach((el) => el.remove());\r\n\r\n      for(const filter of suggestedFilters) {\r\n        const row = await this.renderFolder(filter);\r\n        this.suggestedSection.content.append(row.container);\r\n\r\n        const button = row.buttonRight;\r\n        attachClickEvent(button, async(e) => {\r\n          cancelEvent(e);\r\n\r\n          if(!(await this.canCreateFolder())) {\r\n            toast('Sorry, you can\\'t create more folders.');\r\n            return;\r\n          }\r\n\r\n          button.setAttribute('disabled', 'true');\r\n\r\n          const f = filter.filter as MyDialogFilter;\r\n          f.includePeerIds = [];\r\n          f.excludePeerIds = [];\r\n          f.pinnedPeerIds = [];\r\n\r\n          this.managers.filtersStorage.createDialogFilter(f, true).then((bool) => {\r\n            if(bool) {\r\n              row.container.remove();\r\n            }\r\n          }).finally(() => {\r\n            button.removeAttribute('disabled');\r\n          });\r\n        }, {listenerSetter: this.listenerSetter});\r\n      }\r\n    });\r\n  }\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport {SliderSuperTab} from '../../slider';\r\nimport AppSelectPeers from '../../appSelectPeers';\r\nimport appDialogsManager from '../../../lib/appManagers/appDialogsManager';\r\nimport {MyDialogFilter as DialogFilter} from '../../../lib/storages/filters';\r\nimport ButtonIcon from '../../buttonIcon';\r\nimport CheckboxField from '../../checkboxField';\r\nimport Button from '../../button';\r\nimport AppEditFolderTab from './editFolder';\r\nimport I18n, {i18n, LangPackKey, _i18n, join} from '../../../lib/langPack';\r\nimport {SettingSection} from '..';\r\nimport {toast} from '../../toast';\r\nimport copy from '../../../helpers/object/copy';\r\nimport forEachReverse from '../../../helpers/array/forEachReverse';\r\nimport setInnerHTML from '../../../helpers/dom/setInnerHTML';\r\nimport wrapEmojiText from '../../../lib/richTextProcessor/wrapEmojiText';\r\nimport {REAL_FOLDERS} from '../../../lib/mtproto/mtproto_config';\r\nimport rootScope from '../../../lib/rootScope';\r\nimport {MTAppConfig} from '../../../lib/mtproto/appConfig';\r\nimport {attachClickEvent, simulateClickEvent} from '../../../helpers/dom/clickEvent';\r\n\r\nexport default class AppIncludedChatsTab extends SliderSuperTab {\r\n  private editFolderTab: AppEditFolderTab;\r\n  private confirmBtn: HTMLElement;\r\n\r\n  private selector: AppSelectPeers;\r\n  private type: 'included' | 'excluded';\r\n  private filter: DialogFilter;\r\n  private originalFilter: DialogFilter;\r\n\r\n  private dialogsByFilters: Map<DialogFilter, Set<PeerId>>;\r\n  private limit: number;\r\n\r\n  protected init() {\r\n    this.content.remove();\r\n    this.container.classList.add('included-chatlist-container');\r\n    this.confirmBtn = ButtonIcon('check btn-confirm blue', {noRipple: true});\r\n    this.confirmBtn.style.display = 'none';\r\n\r\n    this.header.append(this.confirmBtn);\r\n\r\n    attachClickEvent(this.confirmBtn, async() => {\r\n      const selected = this.selector.getSelected();\r\n\r\n      // this.filter.pFlags = {};\r\n\r\n      if(this.type === 'included') {\r\n        for(const key in this.filter.pFlags) {\r\n          if(key.indexOf('exclude_') === 0) {\r\n            continue;\r\n          }\r\n\r\n          // @ts-ignore\r\n          delete this.filter.pFlags[key];\r\n        }\r\n      } else {\r\n        for(const key in this.filter.pFlags) {\r\n          if(key.indexOf('exclude_') !== 0) {\r\n            continue;\r\n          }\r\n\r\n          // @ts-ignore\r\n          delete this.filter.pFlags[key];\r\n        }\r\n      }\r\n\r\n      const peerIds: PeerId[] = [];\r\n      for(const key of selected) {\r\n        if(key.isPeerId()) {\r\n          peerIds.push(key.toPeerId());\r\n        } else {\r\n          // @ts-ignore\r\n          this.filter.pFlags[key] = true;\r\n        }\r\n      }\r\n\r\n      let cmp: (peerId: PeerId) => boolean;\r\n      if(this.type === 'included') {\r\n        cmp = (peerId) => peerIds.includes(peerId);\r\n      } else {\r\n        cmp = (peerId) => !peerIds.includes(peerId);\r\n      }\r\n\r\n      forEachReverse(this.filter.pinnedPeerIds, (peerId, idx) => {\r\n        if(!cmp(peerId)) {\r\n          this.filter.pinnedPeerIds.splice(idx, 1);\r\n          this.filter.pinned_peers.splice(idx, 1);\r\n        }\r\n      });\r\n\r\n      const other = this.type === 'included' ? 'excludePeerIds' : 'includePeerIds';\r\n      const otherLegacy = this.type === 'included' ? 'exclude_peers' : 'include_peers';\r\n      forEachReverse(this.filter[other], (peerId, idx) => {\r\n        if(peerIds.includes(peerId)) {\r\n          this.filter[other].splice(idx, 1);\r\n          this.filter[otherLegacy].splice(idx, 1);\r\n        }\r\n      });\r\n\r\n      this.filter[this.type === 'included' ? 'includePeerIds' : 'excludePeerIds'] = peerIds;\r\n      this.filter[this.type === 'included' ? 'include_peers' : 'exclude_peers'] = await Promise.all(peerIds.map((peerId) => this.managers.appPeersManager.getInputPeerById(peerId)));\r\n      // this.filter.pinned_peers = this.filter.pinned_peers.filter((peerId) => this.filter.include_peers.includes(peerId));\r\n\r\n      this.editFolderTab.setFilter(this.filter, false);\r\n      this.close();\r\n    }, {listenerSetter: this.listenerSetter});\r\n\r\n    const onAppConfig = (appConfig: MTAppConfig) => {\r\n      this.limit = rootScope.premium ? appConfig.dialog_filters_chats_limit_premium : appConfig.dialog_filters_chats_limit_default;\r\n    };\r\n\r\n    this.listenerSetter.add(rootScope)('app_config', onAppConfig);\r\n\r\n    this.dialogsByFilters = new Map();\r\n    return Promise.all([\r\n      this.managers.filtersStorage.getDialogFilters().then(async(filters) => {\r\n        await Promise.all(filters.filter((filter) => !REAL_FOLDERS.has(filter.id)).map(async(filter) => {\r\n          const dialogs = await this.managers.dialogsStorage.getFolderDialogs(filter.id);\r\n          const peerIds = dialogs.map((d) => d.peerId);\r\n          this.dialogsByFilters.set(filter, new Set(peerIds));\r\n        }));\r\n      }),\r\n\r\n      this.managers.apiManager.getAppConfig().then((appConfig) => {\r\n        onAppConfig(appConfig);\r\n      })\r\n    ]);\r\n  }\r\n\r\n  checkbox(selected?: boolean) {\r\n    const checkboxField = new CheckboxField({\r\n      round: true\r\n    });\r\n    if(selected) {\r\n      checkboxField.input.checked = selected;\r\n    }\r\n\r\n    return checkboxField.label;\r\n  }\r\n\r\n  renderResults = async(peerIds: PeerId[]) => {\r\n    // const other = this.type === 'included' ? this.filter.exclude_peers : this.filter.include_peers;\r\n\r\n    await this.managers.appUsersManager.getContacts();\r\n    peerIds.forEach((peerId) => {\r\n      // if(other.includes(peerId)) return;\r\n\r\n      const {dom} = appDialogsManager.addDialogNew({\r\n        peerId: peerId,\r\n        container: this.selector.scrollable,\r\n        rippleEnabled: true,\r\n        avatarSize: 46\r\n      });\r\n\r\n      const selected = this.selector.selected.has(peerId);\r\n      dom.containerEl.append(this.checkbox(selected));\r\n      // if(selected) dom.listEl.classList.add('active');\r\n\r\n      const foundInFilters: HTMLElement[] = [];\r\n      this.dialogsByFilters.forEach((dialogs, filter) => {\r\n        if(dialogs.has(peerId)) {\r\n          const span = document.createElement('span');\r\n          setInnerHTML(span, wrapEmojiText(filter.title));\r\n          foundInFilters.push(span);\r\n        }\r\n      });\r\n\r\n      const joined = join(foundInFilters, false);\r\n      joined.forEach((el) => {\r\n        dom.lastMessageSpan.append(el);\r\n      });\r\n    });\r\n  };\r\n\r\n  onOpen() {\r\n    if(this.init) {\r\n      this.init();\r\n      this.init = null;\r\n    }\r\n\r\n    this.confirmBtn.style.display = this.type === 'excluded' ? '' : 'none';\r\n    this.setTitle(this.type === 'included' ? 'FilterAlwaysShow' : 'FilterNeverShow');\r\n\r\n    const filter = this.filter;\r\n\r\n    const categoriesSection = new SettingSection({\r\n      noDelimiter: true,\r\n      name: 'FilterChatTypes'\r\n    });\r\n\r\n    categoriesSection.container.classList.add('folder-categories');\r\n\r\n    let details: {[flag: string]: {ico: string, text: LangPackKey}};\r\n    if(this.type === 'excluded') {\r\n      details = {\r\n        exclude_muted: {ico: 'mute', text: 'ChatList.Filter.MutedChats'},\r\n        exclude_archived: {ico: 'archive', text: 'ChatList.Filter.Archive'},\r\n        exclude_read: {ico: 'readchats', text: 'ChatList.Filter.ReadChats'}\r\n      };\r\n    } else {\r\n      details = {\r\n        contacts: {ico: 'newprivate', text: 'ChatList.Filter.Contacts'},\r\n        non_contacts: {ico: 'noncontacts', text: 'ChatList.Filter.NonContacts'},\r\n        groups: {ico: 'group', text: 'ChatList.Filter.Groups'},\r\n        broadcasts: {ico: 'newchannel', text: 'ChatList.Filter.Channels'},\r\n        bots: {ico: 'bots', text: 'ChatList.Filter.Bots'}\r\n      };\r\n    }\r\n\r\n    const f = document.createDocumentFragment();\r\n    for(const key in details) {\r\n      const button = Button('btn-primary btn-transparent folder-category-button', {icon: details[key].ico, text: details[key].text});\r\n      button.dataset.peerId = key;\r\n      button.append(this.checkbox());\r\n      f.append(button);\r\n    }\r\n    categoriesSection.content.append(f);\r\n\r\n    // ///////////////\r\n\r\n    const selectedPeers = (this.type === 'included' ? filter.includePeerIds : filter.excludePeerIds).slice();\r\n\r\n    this.selector = new AppSelectPeers({\r\n      appendTo: this.container,\r\n      onChange: this.onSelectChange,\r\n      peerType: ['dialogs'],\r\n      renderResultsFunc: this.renderResults,\r\n      placeholder: 'Search',\r\n      sectionNameLangPackKey: 'FilterChats',\r\n      managers: this.managers\r\n    });\r\n    this.selector.selected = new Set(selectedPeers);\r\n\r\n    let addedInitial = false;\r\n    const _add = this.selector.add.bind(this.selector);\r\n    this.selector.add = (peerId, title, scroll) => {\r\n      if(this.selector.selected.size >= this.limit && addedInitial && !details[peerId]) {\r\n        const el: HTMLInputElement = this.selector.list.querySelector(`[data-peer-id=\"${peerId}\"] [type=\"checkbox\"]`);\r\n        if(el) {\r\n          setTimeout(() => {\r\n            el.checked = false;\r\n          }, 0);\r\n        }\r\n\r\n        const str = I18n.format(this.type === 'excluded' ? 'ChatList.Filter.Exclude.LimitReached': 'ChatList.Filter.Include.LimitReached', true);\r\n        toast(str);\r\n        return;\r\n      }\r\n\r\n      const div = _add(peerId, details[peerId] ? i18n(details[peerId].text) : undefined, scroll);\r\n      if(details[peerId]) {\r\n        div.querySelector('avatar-element').classList.add('tgico-' + details[peerId].ico);\r\n      }\r\n      return div;\r\n    };\r\n\r\n    this.selector.scrollable.container.append(categoriesSection.container, this.selector.scrollable.container.lastElementChild);\r\n\r\n    this.selector.addInitial(selectedPeers);\r\n    addedInitial = true;\r\n\r\n    for(const flag in filter.pFlags) {\r\n      // @ts-ignore\r\n      if(details.hasOwnProperty(flag) && !!filter.pFlags[flag]) {\r\n        simulateClickEvent(categoriesSection.content.querySelector(`[data-peer-id=\"${flag}\"]`) as HTMLElement);\r\n      }\r\n    }\r\n  }\r\n\r\n  onSelectChange = (length: number) => {\r\n    // const changed = !deepEqual(this.filter, this.originalFilter);\r\n    if(this.type === 'included') {\r\n      this.confirmBtn.style.display = length ? '' : 'none';\r\n    }\r\n  };\r\n\r\n  onCloseAfterTimeout() {\r\n    if(this.selector) {\r\n      this.selector.container.remove();\r\n      this.selector = null;\r\n    }\r\n\r\n    return super.onCloseAfterTimeout();\r\n  }\r\n\r\n  /**\r\n   * Do not ignore arguments!\r\n   */\r\n  public open(filter?: DialogFilter, type?: 'included' | 'excluded', editFolderTab?: AppIncludedChatsTab['editFolderTab']) {\r\n    this.originalFilter = filter;\r\n    this.filter = copy(this.originalFilter);\r\n    this.type = type;\r\n    this.editFolderTab = editFolderTab;\r\n\r\n    return super.open();\r\n  }\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport appDialogsManager from '../../../lib/appManagers/appDialogsManager';\r\nimport {MyDialogFilter as DialogFilter} from '../../../lib/storages/filters';\r\nimport lottieLoader, {LottieLoader} from '../../../lib/rlottie/lottieLoader';\r\nimport {SliderSuperTab} from '../../slider';\r\nimport {toast} from '../../toast';\r\nimport InputField from '../../inputField';\r\nimport ButtonIcon from '../../buttonIcon';\r\nimport ButtonMenuToggle from '../../buttonMenuToggle';\r\nimport {ButtonMenuItemOptions} from '../../buttonMenu';\r\nimport Button from '../../button';\r\nimport AppIncludedChatsTab from './includedChats';\r\nimport {i18n, LangPackKey} from '../../../lib/langPack';\r\nimport {SettingSection} from '..';\r\nimport PopupPeer from '../../popups/peer';\r\nimport RLottiePlayer from '../../../lib/rlottie/rlottiePlayer';\r\nimport copy from '../../../helpers/object/copy';\r\nimport deepEqual from '../../../helpers/object/deepEqual';\r\nimport documentFragmentToHTML from '../../../helpers/dom/documentFragmentToHTML';\r\nimport wrapDraftText from '../../../lib/richTextProcessor/wrapDraftText';\r\nimport filterAsync from '../../../helpers/array/filterAsync';\r\nimport {attachClickEvent} from '../../../helpers/dom/clickEvent';\r\n\r\nconst MAX_FOLDER_NAME_LENGTH = 12;\r\n\r\nexport default class AppEditFolderTab extends SliderSuperTab {\r\n  private caption: HTMLElement;\r\n  private stickerContainer: HTMLElement;\r\n\r\n  private confirmBtn: HTMLElement;\r\n  private menuBtn: HTMLElement;\r\n  private nameInputField: InputField;\r\n\r\n  private includePeerIds: SettingSection;\r\n  private excludePeerIds: SettingSection;\r\n  private flags: {[k in 'contacts' | 'non_contacts' | 'groups' | 'broadcasts' | 'bots' | 'exclude_muted' | 'exclude_archived' | 'exclude_read']: HTMLElement} = {} as any;\r\n\r\n  private animation: RLottiePlayer;\r\n  private filter: DialogFilter;\r\n  private originalFilter: DialogFilter;\r\n\r\n  private type: 'edit' | 'create';\r\n  private loadAnimationPromise: ReturnType<LottieLoader['waitForFirstFrame']>;\r\n\r\n  protected init() {\r\n    this.container.classList.add('edit-folder-container');\r\n    this.caption = document.createElement('div');\r\n    this.caption.classList.add('caption');\r\n    this.caption.append(i18n('FilterIncludeExcludeInfo'));\r\n    this.stickerContainer = document.createElement('div');\r\n    this.stickerContainer.classList.add('sticker-container');\r\n\r\n    this.confirmBtn = ButtonIcon('check btn-confirm hide blue');\r\n    const deleteFolderButton: ButtonMenuItemOptions = {\r\n      icon: 'delete danger',\r\n      text: 'FilterMenuDelete',\r\n      onClick: () => {\r\n        new PopupPeer('filter-delete', {\r\n          titleLangKey: 'ChatList.Filter.Confirm.Remove.Header',\r\n          descriptionLangKey: 'ChatList.Filter.Confirm.Remove.Text',\r\n          buttons: [{\r\n            langKey: 'Delete',\r\n            callback: () => {\r\n              deleteFolderButton.element.setAttribute('disabled', 'true');\r\n              this.managers.filtersStorage.updateDialogFilter(this.filter, true).then((bool) => {\r\n                if(bool) {\r\n                  this.close();\r\n                }\r\n              }).finally(() => {\r\n                deleteFolderButton.element.removeAttribute('disabled');\r\n              });\r\n            },\r\n            isDanger: true\r\n          }]\r\n        }).show();\r\n      }\r\n    };\r\n    this.menuBtn = ButtonMenuToggle({listenerSetter: this.listenerSetter}, 'bottom-left', [deleteFolderButton]);\r\n    this.menuBtn.classList.add('hide');\r\n\r\n    this.header.append(this.confirmBtn, this.menuBtn);\r\n\r\n    const inputSection = new SettingSection({});\r\n\r\n    const inputWrapper = document.createElement('div');\r\n    inputWrapper.classList.add('input-wrapper');\r\n\r\n    this.nameInputField = new InputField({\r\n      label: 'FilterNameHint',\r\n      maxLength: MAX_FOLDER_NAME_LENGTH\r\n    });\r\n\r\n    inputWrapper.append(this.nameInputField.container);\r\n    inputSection.content.append(inputWrapper);\r\n\r\n    const generateList = (className: string, h2Text: LangPackKey, buttons: {icon: string, name?: string, withRipple?: true, text: LangPackKey}[], to: any) => {\r\n      const section = new SettingSection({\r\n        name: h2Text,\r\n        noDelimiter: true\r\n      });\r\n\r\n      section.container.classList.add('folder-list', className);\r\n\r\n      const categories = section.generateContentElement();\r\n      categories.classList.add('folder-categories');\r\n\r\n      buttons.forEach((o) => {\r\n        const button = Button('folder-category-button btn btn-primary btn-transparent', {\r\n          icon: o.icon,\r\n          text: o.text,\r\n          noRipple: o.withRipple ? undefined : true\r\n        });\r\n\r\n        if(o.name) {\r\n          to[o.name] = button;\r\n        }\r\n\r\n        categories.append(button);\r\n      });\r\n\r\n      return section;\r\n    };\r\n\r\n    this.includePeerIds = generateList('folder-list-included', 'FilterInclude', [{\r\n      icon: 'add primary',\r\n      text: 'ChatList.Filter.Include.AddChat',\r\n      withRipple: true\r\n    }, {\r\n      text: 'ChatList.Filter.Contacts',\r\n      icon: 'newprivate',\r\n      name: 'contacts'\r\n    }, {\r\n      text: 'ChatList.Filter.NonContacts',\r\n      icon: 'noncontacts',\r\n      name: 'non_contacts'\r\n    }, {\r\n      text: 'ChatList.Filter.Groups',\r\n      icon: 'group',\r\n      name: 'groups'\r\n    }, {\r\n      text: 'ChatList.Filter.Channels',\r\n      icon: 'channel',\r\n      name: 'broadcasts'\r\n    }, {\r\n      text: 'ChatList.Filter.Bots',\r\n      icon: 'bots',\r\n      name: 'bots'\r\n    }], this.flags);\r\n\r\n    this.excludePeerIds = generateList('folder-list-excluded', 'FilterExclude', [{\r\n      icon: 'minus primary',\r\n      text: 'ChatList.Filter.Exclude.AddChat',\r\n      withRipple: true\r\n    }, {\r\n      text: 'ChatList.Filter.MutedChats',\r\n      icon: 'mute',\r\n      name: 'exclude_muted'\r\n    }, {\r\n      text: 'ChatList.Filter.Archive',\r\n      icon: 'archive',\r\n      name: 'exclude_archived'\r\n    }, {\r\n      text: 'ChatList.Filter.ReadChats',\r\n      icon: 'readchats',\r\n      name: 'exclude_read'\r\n    }], this.flags);\r\n\r\n    this.scrollable.append(this.stickerContainer, this.caption, inputSection.container, this.includePeerIds.container, this.excludePeerIds.container);\r\n\r\n    const includedFlagsContainer = this.includePeerIds.container.querySelector('.folder-categories');\r\n    const excludedFlagsContainer = this.excludePeerIds.container.querySelector('.folder-categories');\r\n\r\n    attachClickEvent(includedFlagsContainer.querySelector('.btn') as HTMLElement, () => {\r\n      this.slider.createTab(AppIncludedChatsTab).open(this.filter, 'included', this);\r\n    }, {listenerSetter: this.listenerSetter});\r\n\r\n    attachClickEvent(excludedFlagsContainer.querySelector('.btn') as HTMLElement, () => {\r\n      this.slider.createTab(AppIncludedChatsTab).open(this.filter, 'excluded', this);\r\n    }, {listenerSetter: this.listenerSetter});\r\n\r\n    attachClickEvent(this.confirmBtn, () => {\r\n      if(this.nameInputField.input.classList.contains('error')) {\r\n        return;\r\n      }\r\n\r\n      if(!this.nameInputField.value.trim()) {\r\n        this.nameInputField.input.classList.add('error');\r\n        return;\r\n      }\r\n\r\n      let include = (Array.from(includedFlagsContainer.children) as HTMLElement[]).slice(1).reduce((acc, el) => acc + +!el.style.display, 0);\r\n      include += this.filter.include_peers.length;\r\n\r\n      if(!include) {\r\n        toast('Please choose at least one chat for this folder.');\r\n        return;\r\n      }\r\n\r\n      this.confirmBtn.setAttribute('disabled', 'true');\r\n\r\n      let promise: Promise<boolean>;\r\n      if(!this.filter.id) {\r\n        promise = this.managers.filtersStorage.createDialogFilter(this.filter);\r\n      } else {\r\n        promise = this.managers.filtersStorage.updateDialogFilter(this.filter);\r\n      }\r\n\r\n      promise.then((bool) => {\r\n        if(bool) {\r\n          this.close();\r\n        }\r\n      }).catch((err) => {\r\n        if(err.type === 'DIALOG_FILTERS_TOO_MUCH') {\r\n          toast('Sorry, you can\\'t create more folders.');\r\n        } else {\r\n          console.error('updateDialogFilter error:', err);\r\n        }\r\n      }).finally(() => {\r\n        this.confirmBtn.removeAttribute('disabled');\r\n      });\r\n    }, {listenerSetter: this.listenerSetter});\r\n\r\n    this.listenerSetter.add(this.nameInputField.input)('input', () => {\r\n      this.filter.title = this.nameInputField.value;\r\n      this.editCheckForChange();\r\n    });\r\n\r\n    const reloadMissingPromises: Promise<any>[] = this.type === 'edit' ? [\r\n      this.managers.filtersStorage.reloadMissingPeerIds(this.filter.id, 'pinned_peers'),\r\n      this.managers.filtersStorage.reloadMissingPeerIds(this.filter.id, 'include_peers'),\r\n      this.managers.filtersStorage.reloadMissingPeerIds(this.filter.id, 'exclude_peers')\r\n    ] : [];\r\n\r\n    return Promise.all([\r\n      this.loadAnimationPromise = lottieLoader.loadAnimationAsAsset({\r\n        container: this.stickerContainer,\r\n        loop: false,\r\n        autoplay: false,\r\n        width: 86,\r\n        height: 86\r\n      }, 'Folders_2').then((player) => {\r\n        this.animation = player;\r\n\r\n        return lottieLoader.waitForFirstFrame(player);\r\n      }),\r\n\r\n      ...reloadMissingPromises\r\n    ]);\r\n  }\r\n\r\n  onOpenAfterTimeout() {\r\n    this.loadAnimationPromise.then(() => {\r\n      this.animation.autoplay = true;\r\n      this.animation.play();\r\n    });\r\n  }\r\n\r\n  private onCreateOpen() {\r\n    // this.caption.style.display = '';\r\n    this.setTitle('FilterNew');\r\n    this.menuBtn.classList.add('hide');\r\n    this.confirmBtn.classList.remove('hide');\r\n    this.nameInputField.value = '';\r\n\r\n    for(const flag in this.flags) {\r\n      // @ts-ignore\r\n      this.flags[flag].style.display = 'none';\r\n    }\r\n  }\r\n\r\n  private onEditOpen() {\r\n    // this.caption.style.display = 'none';\r\n    this.setTitle(this.type === 'create' ? 'FilterNew' : 'FilterHeaderEdit');\r\n\r\n    if(this.type === 'edit') {\r\n      this.menuBtn.classList.remove('hide');\r\n      this.confirmBtn.classList.add('hide');\r\n    }\r\n\r\n    const filter = this.filter;\r\n    this.nameInputField.value = documentFragmentToHTML(wrapDraftText(filter.title));\r\n\r\n    for(const flag in this.flags) {\r\n      this.flags[flag as keyof AppEditFolderTab['flags']].style.display = !!filter.pFlags[flag as keyof AppEditFolderTab['flags']] ? '' : 'none';\r\n    }\r\n\r\n    (['includePeerIds' as const, 'excludePeerIds' as const]).forEach(async(key) => {\r\n      const section = this[key];\r\n      const ul = appDialogsManager.createChatList({ignoreClick: true});\r\n\r\n      let peers = filter[key];\r\n\r\n      // filter peers where we're kicked\r\n      const hasPeer = async(peerId: PeerId) => {\r\n        return !!(await this.managers.appMessagesManager.getDialogOnly(peerId)) || (peerId.isUser() ? (await this.managers.appUsersManager.getUser(peerId.toUserId()))._ === 'user' : false);\r\n      };\r\n\r\n      const filtered = await filterAsync(peers, (peerId) => hasPeer(peerId));\r\n      peers.length = 0;\r\n      peers.push(...filtered);\r\n\r\n      peers = peers.slice();\r\n\r\n      const renderMore = async(_length: number) => {\r\n        for(let i = 0, length = Math.min(peers.length, _length); i < length; ++i) {\r\n          const peerId = peers.shift();\r\n          if(peerId.isUser() ? false : !(await this.managers.appMessagesManager.getDialogOnly(peerId))) {\r\n            continue;\r\n          }\r\n\r\n          const {dom} = appDialogsManager.addDialogNew({\r\n            peerId: peerId,\r\n            container: ul,\r\n            rippleEnabled: false,\r\n            meAsSaved: true,\r\n            avatarSize: 32\r\n          });\r\n          dom.lastMessageSpan.parentElement.remove();\r\n        }\r\n\r\n        if(peers.length) {\r\n          showMore.lastElementChild.replaceWith(i18n('FilterShowMoreChats', [peers.length]));\r\n        } else if(showMore) {\r\n          showMore.remove();\r\n        }\r\n      };\r\n\r\n      section.generateContentElement().append(ul);\r\n\r\n      let showMore: HTMLElement;\r\n      if(peers.length) {\r\n        const content = section.generateContentElement();\r\n        showMore = Button('folder-category-button btn btn-primary btn-transparent', {icon: 'down'});\r\n        showMore.classList.add('load-more', 'rp-overflow');\r\n        attachClickEvent(showMore, () => renderMore(20), {listenerSetter: this.listenerSetter});\r\n        showMore.append(i18n('FilterShowMoreChats', [peers.length]));\r\n\r\n        content.append(showMore);\r\n      }\r\n\r\n      renderMore(4);\r\n    });\r\n  }\r\n\r\n  editCheckForChange() {\r\n    if(this.type === 'edit') {\r\n      const changed = !deepEqual(this.originalFilter, this.filter);\r\n      this.confirmBtn.classList.toggle('hide', !changed);\r\n      this.menuBtn.classList.toggle('hide', changed);\r\n    }\r\n  };\r\n\r\n  setFilter(filter: DialogFilter, firstTime: boolean) {\r\n    if(this.container) {\r\n      // cleanup\r\n      Array.from(this.container.querySelectorAll('ul, .load-more')).forEach((el) => el.remove());\r\n    }\r\n\r\n    if(firstTime) {\r\n      this.originalFilter = filter;\r\n      this.filter = copy(filter);\r\n    } else {\r\n      this.filter = filter;\r\n      this.onEditOpen();\r\n      this.editCheckForChange();\r\n    }\r\n  }\r\n\r\n  public open(filter?: DialogFilter) {\r\n    if(filter === undefined) {\r\n      this.setFilter({\r\n        _: 'dialogFilter',\r\n        id: 0,\r\n        title: '',\r\n        pFlags: {},\r\n        pinned_peers: [],\r\n        include_peers: [],\r\n        exclude_peers: [],\r\n        pinnedPeerIds: [],\r\n        includePeerIds: [],\r\n        excludePeerIds: []\r\n      }, true);\r\n      this.type = 'create';\r\n    } else {\r\n      this.setFilter(filter, true);\r\n      this.type = 'edit';\r\n    }\r\n\r\n    return super.open().then(() => {\r\n      if(this.type === 'edit') {\r\n        this.setFilter(this.originalFilter, true);\r\n        this.onEditOpen();\r\n      } else {\r\n        this.onCreateOpen();\r\n      }\r\n    });\r\n  }\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport appImManager from '../../lib/appManagers/appImManager';\r\nimport SidebarSlider from '../slider';\r\nimport mediaSizes, {ScreenSize} from '../../helpers/mediaSizes';\r\nimport AppSharedMediaTab from './tabs/sharedMedia';\r\nimport {MOUNT_CLASS_TO} from '../../config/debug';\r\nimport {AppManagers} from '../../lib/appManagers/managers';\r\n\r\nexport const RIGHT_COLUMN_ACTIVE_CLASSNAME = 'is-right-column-shown';\r\n\r\nexport class AppSidebarRight extends SidebarSlider {\r\n  private isColumnProportionSet = false;\r\n  private sharedMediaTab: AppSharedMediaTab;\r\n\r\n  constructor() {\r\n    super({\r\n      sidebarEl: document.getElementById('column-right') as HTMLElement,\r\n      canHideFirst: true,\r\n      navigationType: 'right'\r\n    });\r\n  }\r\n\r\n  construct(managers: AppManagers) {\r\n    this.managers = managers;\r\n\r\n    mediaSizes.addEventListener('changeScreen', (from, to) => {\r\n      if(to === ScreenSize.medium && from !== ScreenSize.mobile) {\r\n        this.toggleSidebar(false);\r\n      }\r\n    });\r\n\r\n    mediaSizes.addEventListener('resize', () => {\r\n      this.setColumnProportion();\r\n    });\r\n  }\r\n\r\n  public createSharedMediaTab() {\r\n    const tab = this.createTab(AppSharedMediaTab, true);\r\n    tab.slider = this;\r\n    // this.tabsContainer.prepend(tab.container);\r\n    return tab;\r\n  }\r\n\r\n  public replaceSharedMediaTab(tab?: AppSharedMediaTab) {\r\n    const previousTab = this.sharedMediaTab;\r\n    if(previousTab) {\r\n      const idx = this.historyTabIds.indexOf(previousTab);\r\n\r\n      if(this._selectTab.getFrom() === previousTab.container) {\r\n        this._selectTab.setFrom(tab.container);\r\n      }\r\n\r\n      if(tab) {\r\n        if(idx !== -1) {\r\n          this.historyTabIds[idx] = tab;\r\n        }\r\n\r\n        const wasActive = previousTab.container.classList.contains('active');\r\n        if(wasActive) {\r\n          tab.container.classList.add('active');\r\n        }\r\n\r\n        previousTab.container.replaceWith(tab.container);\r\n      } else {\r\n        if(idx !== -1) {\r\n          this.historyTabIds.splice(idx, 1);\r\n        }\r\n\r\n        previousTab.container.remove();\r\n      }\r\n    } else {\r\n      this.tabsContainer.prepend(tab.container);\r\n    }\r\n\r\n    this.sharedMediaTab = tab;\r\n  }\r\n\r\n  public onCloseTab(id: number, animate: boolean, isNavigation?: boolean) {\r\n    if(!this.historyTabIds.length) {\r\n      this.toggleSidebar(false, animate);\r\n    }\r\n\r\n    super.onCloseTab(id, animate, isNavigation);\r\n  }\r\n\r\n  private setColumnProportion() {\r\n    const proportion = this.sidebarEl.scrollWidth / this.sidebarEl.previousElementSibling.scrollWidth;\r\n    document.documentElement.style.setProperty('--right-column-proportion', '' + proportion);\r\n  }\r\n\r\n  public toggleSidebar(enable?: boolean, animate?: boolean) {\r\n    const active = document.body.classList.contains(RIGHT_COLUMN_ACTIVE_CLASSNAME);\r\n    let willChange: boolean;\r\n    if(enable !== undefined) {\r\n      if(enable) {\r\n        if(!active) {\r\n          willChange = true;\r\n        }\r\n      } else if(active) {\r\n        willChange = true;\r\n      }\r\n    } else {\r\n      willChange = true;\r\n    }\r\n\r\n    if(!willChange) return Promise.resolve();\r\n\r\n    if(!active && !this.historyTabIds.length) {\r\n      this.sharedMediaTab.open();\r\n    }\r\n\r\n    if(!this.isColumnProportionSet) {\r\n      this.setColumnProportion();\r\n      this.isColumnProportionSet = true;\r\n    }\r\n\r\n    const animationPromise = appImManager.selectTab(active ? 1 : 2, animate);\r\n    document.body.classList.toggle(RIGHT_COLUMN_ACTIVE_CLASSNAME, enable);\r\n    return animationPromise;\r\n\r\n    /* return new Promise((resolve, reject) => {\r\n      const hidden: {element: HTMLDivElement, height: number}[] = [];\r\n      const observer = new IntersectionObserver((entries) => {\r\n        for(const entry of entries) {\r\n          const bubble = entry.target as HTMLDivElement;\r\n          if(!entry.isIntersecting) {\r\n            hidden.push({element: bubble, height: bubble.scrollHeight});\r\n          }\r\n        }\r\n\r\n        for(const item of hidden) {\r\n          item.element.style.minHeight = item.height + 'px';\r\n          (item.element.firstElementChild as HTMLElement).style.display = 'none';\r\n          item.element.style.width = '1px';\r\n        }\r\n\r\n        //console.log('hidden', hidden);\r\n        observer.disconnect();\r\n\r\n        set();\r\n\r\n        setTimeout(() => {\r\n          for(const item of hidden) {\r\n            item.element.style.minHeight = '';\r\n            item.element.style.width = '';\r\n            (item.element.firstElementChild as HTMLElement).style.display = '';\r\n          }\r\n\r\n          resolve();\r\n        }, 200);\r\n      });\r\n\r\n      const length = Object.keys(appImManager.bubbles).length;\r\n      if(length) {\r\n        for(const i in appImManager.bubbles) {\r\n          observer.observe(appImManager.bubbles[i]);\r\n        }\r\n      } else {\r\n        set();\r\n        setTimeout(resolve, 200);\r\n      }\r\n    }); */\r\n  }\r\n}\r\n\r\nconst appSidebarRight = new AppSidebarRight();\r\nMOUNT_CLASS_TO.appSidebarRight = appSidebarRight;\r\nexport default appSidebarRight;\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport {SliderSuperTab} from '../../slider'\r\nimport InputField from '../../inputField';\r\nimport EditPeer from '../../editPeer';\r\nimport {SettingSection} from '../../sidebarLeft';\r\nimport Row from '../../row';\r\nimport CheckboxField from '../../checkboxField';\r\nimport Button from '../../button';\r\nimport PeerTitle from '../../peerTitle';\r\nimport rootScope from '../../../lib/rootScope';\r\nimport PopupPeer from '../../popups/peer';\r\nimport {addCancelButton} from '../../popups';\r\nimport {i18n} from '../../../lib/langPack';\r\nimport {attachClickEvent} from '../../../helpers/dom/clickEvent';\r\nimport toggleDisability from '../../../helpers/dom/toggleDisability';\r\nimport getPeerId from '../../../lib/appManagers/utils/peers/getPeerId';\r\nimport formatUserPhone from '../../wrappers/formatUserPhone';\r\n\r\nexport default class AppEditContactTab extends SliderSuperTab {\r\n  private nameInputField: InputField;\r\n  private lastNameInputField: InputField;\r\n  private editPeer: EditPeer;\r\n  public peerId: PeerId;\r\n\r\n  protected async init() {\r\n    this.container.classList.add('edit-peer-container', 'edit-contact-container');\r\n    const isNew = !(await this.managers.appUsersManager.isContact(this.peerId.toUserId()));\r\n    this.setTitle(isNew ? 'AddContactTitle' : 'Edit');\r\n\r\n    {\r\n      const section = new SettingSection({noDelimiter: true});\r\n      const inputFields: InputField[] = [];\r\n\r\n      const inputWrapper = document.createElement('div');\r\n      inputWrapper.classList.add('input-wrapper');\r\n\r\n      this.nameInputField = new InputField({\r\n        label: 'FirstName',\r\n        name: 'contact-name',\r\n        maxLength: 70,\r\n        required: true\r\n      });\r\n      this.lastNameInputField = new InputField({\r\n        label: 'LastName',\r\n        name: 'contact-lastname',\r\n        maxLength: 70\r\n      });\r\n\r\n      if(this.peerId) {\r\n        const user = await this.managers.appUsersManager.getUser(this.peerId);\r\n\r\n        if(isNew) {\r\n          this.nameInputField.setDraftValue(user.first_name);\r\n          this.lastNameInputField.setDraftValue(user.last_name);\r\n        } else {\r\n          this.nameInputField.setOriginalValue(user.first_name);\r\n          this.lastNameInputField.setOriginalValue(user.last_name);\r\n        }\r\n      }\r\n\r\n      inputWrapper.append(this.nameInputField.container, this.lastNameInputField.container);\r\n      inputFields.push(this.nameInputField, this.lastNameInputField);\r\n\r\n      this.editPeer = new EditPeer({\r\n        peerId: this.peerId,\r\n        inputFields,\r\n        listenerSetter: this.listenerSetter,\r\n        doNotEditAvatar: true\r\n      });\r\n      this.content.append(this.editPeer.nextBtn);\r\n\r\n      if(this.peerId) {\r\n        const div = document.createElement('div');\r\n        div.classList.add('avatar-edit');\r\n        div.append(this.editPeer.avatarElem);\r\n\r\n        const notificationsCheckboxField = new CheckboxField({\r\n          text: 'Notifications'\r\n        });\r\n\r\n        notificationsCheckboxField.input.addEventListener('change', (e) => {\r\n          if(!e.isTrusted) {\r\n            return;\r\n          }\r\n\r\n          this.managers.appMessagesManager.togglePeerMute(this.peerId);\r\n        });\r\n\r\n        this.listenerSetter.add(rootScope)('notify_settings', async(update) => {\r\n          if(update.peer._ !== 'notifyPeer') return;\r\n          const peerId = getPeerId(update.peer.peer);\r\n          if(this.peerId === peerId) {\r\n            const enabled = !(await this.managers.appNotificationsManager.isMuted(update.notify_settings));\r\n            if(enabled !== notificationsCheckboxField.checked) {\r\n              notificationsCheckboxField.checked = enabled;\r\n            }\r\n          }\r\n        });\r\n\r\n        const profileNameDiv = document.createElement('div');\r\n        profileNameDiv.classList.add('profile-name');\r\n        profileNameDiv.append(new PeerTitle({\r\n          peerId: this.peerId\r\n        }).element);\r\n        // profileNameDiv.innerHTML = 'Karen Stanford';\r\n\r\n        const profileSubtitleDiv = document.createElement('div');\r\n        profileSubtitleDiv.classList.add('profile-subtitle');\r\n        profileSubtitleDiv.append(i18n('EditContact.OriginalName'));\r\n\r\n        section.content.append(div, profileNameDiv, profileSubtitleDiv, inputWrapper);\r\n\r\n        if(!isNew) {\r\n          const notificationsRow = new Row({\r\n            checkboxField: notificationsCheckboxField,\r\n            listenerSetter: this.listenerSetter\r\n          });\r\n\r\n          const enabled = !(await this.managers.appNotificationsManager.isPeerLocalMuted(this.peerId, false));\r\n          notificationsCheckboxField.checked = enabled;\r\n\r\n          section.content.append(notificationsRow.container);\r\n        } else {\r\n          const user = await this.managers.appUsersManager.getUser(this.peerId);\r\n\r\n          const phoneRow = new Row({\r\n            icon: 'phone',\r\n            titleLangKey: user.phone ? undefined : 'MobileHidden',\r\n            title: user.phone ? formatUserPhone(user.phone)  : undefined,\r\n            subtitleLangKey: user.phone ? 'Phone' : 'MobileHiddenExceptionInfo',\r\n            subtitleLangArgs: user.phone ? undefined : [new PeerTitle({peerId: this.peerId}).element]\r\n          });\r\n\r\n          section.content.append(phoneRow.container);\r\n        }\r\n      } else {\r\n        section.content.append(inputWrapper);\r\n      }\r\n\r\n      this.scrollable.append(section.container);\r\n\r\n      attachClickEvent(this.editPeer.nextBtn, async() => {\r\n        this.editPeer.nextBtn.disabled = true;\r\n\r\n        this.managers.appUsersManager.addContact(\r\n          this.peerId,\r\n          this.nameInputField.value,\r\n          this.lastNameInputField.value,\r\n          (await this.managers.appUsersManager.getUser(this.peerId)).phone\r\n        ).finally(() => {\r\n          this.editPeer.nextBtn.removeAttribute('disabled');\r\n          this.close();\r\n        });\r\n      }, {listenerSetter: this.listenerSetter});\r\n    }\r\n\r\n    if(!isNew) {\r\n      const section = new SettingSection({\r\n\r\n      });\r\n\r\n      const btnDelete = Button('btn-primary btn-transparent danger', {icon: 'delete', text: 'PeerInfo.DeleteContact'});\r\n\r\n      attachClickEvent(btnDelete, () => {\r\n        new PopupPeer('popup-delete-contact', {\r\n          peerId: this.peerId,\r\n          titleLangKey: 'DeleteContact',\r\n          descriptionLangKey: 'AreYouSureDeleteContact',\r\n          buttons: addCancelButton([{\r\n            langKey: 'Delete',\r\n            callback: () => {\r\n              const toggle = toggleDisability([btnDelete], true);\r\n\r\n              this.managers.appUsersManager.deleteContacts([this.peerId]).then(() => {\r\n                this.close();\r\n              }, () => {\r\n                toggle();\r\n              });\r\n            },\r\n            isDanger: true\r\n          }])\r\n        }).show();\r\n      }, {listenerSetter: this.listenerSetter});\r\n\r\n      section.content.append(btnDelete);\r\n\r\n      this.scrollable.append(section.container);\r\n    }\r\n  }\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport {copyTextToClipboard} from '../../../helpers/clipboard';\r\nimport {randomLong} from '../../../helpers/random';\r\nimport {Chat, ChatFull, ExportedChatInvite} from '../../../layer';\r\nimport Button from '../../button';\r\nimport {setButtonLoader} from '../../putPreloader';\r\nimport RadioField from '../../radioField';\r\nimport Row, {RadioFormFromRows} from '../../row';\r\nimport {SettingSection} from '../../sidebarLeft';\r\nimport {toast} from '../../toast';\r\nimport {UsernameInputField} from '../../usernameInputField';\r\nimport {SliderSuperTabEventable} from '../../sliderTab';\r\nimport I18n from '../../../lib/langPack';\r\nimport PopupPeer from '../../popups/peer';\r\nimport ButtonCorner from '../../buttonCorner';\r\nimport {attachClickEvent} from '../../../helpers/dom/clickEvent';\r\nimport toggleDisability from '../../../helpers/dom/toggleDisability';\r\nimport CheckboxField from '../../checkboxField';\r\nimport rootScope from '../../../lib/rootScope';\r\n\r\nexport default class AppChatTypeTab extends SliderSuperTabEventable {\r\n  public chatId: ChatId;\r\n  public chatFull: ChatFull;\r\n\r\n  protected async init() {\r\n    this.container.classList.add('edit-peer-container', 'group-type-container');\r\n\r\n    const isBroadcast = await this.managers.appChatsManager.isBroadcast(this.chatId);\r\n\r\n    this.setTitle(isBroadcast ? 'ChannelType' : 'GroupType');\r\n\r\n    const section = new SettingSection({\r\n      name: isBroadcast ? 'ChannelType' : 'GroupType'\r\n    });\r\n\r\n    const random = randomLong();\r\n    const privateRow = new Row({\r\n      radioField: new RadioField({\r\n        langKey: isBroadcast ? 'ChannelPrivate' : 'MegaPrivate',\r\n        name: random,\r\n        value: 'private'\r\n      }),\r\n      subtitleLangKey: isBroadcast ? 'ChannelPrivateInfo' : 'MegaPrivateInfo'\r\n    });\r\n    const publicRow = new Row({\r\n      radioField: new RadioField({\r\n        langKey: isBroadcast ? 'ChannelPublic' : 'MegaPublic',\r\n        name: random,\r\n        value: 'public'\r\n      }),\r\n      subtitleLangKey: isBroadcast ? 'ChannelPublicInfo' : 'MegaPublicInfo'\r\n    });\r\n    const form = RadioFormFromRows([privateRow, publicRow], (value) => {\r\n      const a = [privateSection, publicSection];\r\n      if(value === 'public') a.reverse();\r\n\r\n      a[0].container.classList.remove('hide');\r\n      a[1].container.classList.add('hide');\r\n\r\n      onChange();\r\n    });\r\n\r\n    const chat: Chat = await this.managers.appChatsManager.getChat(this.chatId);\r\n\r\n    section.content.append(form);\r\n\r\n    const privateSection = new SettingSection({});\r\n\r\n    // let revoked = false;\r\n    const linkRow = new Row({\r\n      title: (this.chatFull.exported_invite as ExportedChatInvite.chatInviteExported).link,\r\n      subtitleLangKey: isBroadcast ? 'ChannelPrivateLinkHelp' : 'MegaPrivateLinkHelp',\r\n      clickable: () => {\r\n        copyTextToClipboard((this.chatFull.exported_invite as ExportedChatInvite.chatInviteExported).link);\r\n        toast(I18n.format('LinkCopied', true));\r\n      },\r\n      listenerSetter: this.listenerSetter\r\n    });\r\n\r\n    const btnRevoke = Button('btn-primary btn-transparent danger', {icon: 'delete', text: 'RevokeLink'});\r\n\r\n    attachClickEvent(btnRevoke, () => {\r\n      new PopupPeer('revoke-link', {\r\n        buttons: [{\r\n          langKey: 'RevokeButton',\r\n          callback: () => {\r\n            const toggle = toggleDisability([btnRevoke], true);\r\n\r\n            this.managers.appProfileManager.getChatInviteLink(this.chatId, true).then((link) => {\r\n              toggle();\r\n              linkRow.title.innerHTML = link;\r\n              // revoked = true;\r\n              // onChange();\r\n            });\r\n          }\r\n        }],\r\n        titleLangKey: 'RevokeLink',\r\n        descriptionLangKey: 'RevokeAlert'\r\n      }).show();\r\n    }, {listenerSetter: this.listenerSetter});\r\n\r\n    privateSection.content.append(linkRow.container, btnRevoke);\r\n\r\n    const publicSection = new SettingSection({\r\n      caption: isBroadcast ? 'Channel.UsernameAboutChannel' : 'Channel.UsernameAboutGroup',\r\n      noDelimiter: true\r\n    });\r\n\r\n    const inputWrapper = document.createElement('div');\r\n    inputWrapper.classList.add('input-wrapper');\r\n\r\n    const placeholder = 't.me/';\r\n\r\n    const onChange = () => {\r\n      const changed = (privateRow.radioField.checked && (originalValue !== placeholder/*  || revoked */)) ||\r\n        (linkInputField.isValidToChange() && linkInputField.input.classList.contains('valid'));\r\n      applyBtn.classList.toggle('is-visible', changed);\r\n    };\r\n\r\n    const linkInputField = new UsernameInputField({\r\n      label: 'SetUrlPlaceholder',\r\n      name: 'group-public-link',\r\n      plainText: true,\r\n      listenerSetter: this.listenerSetter,\r\n      availableText: 'Link.Available',\r\n      invalidText: 'Link.Invalid',\r\n      takenText: 'Link.Taken',\r\n      onChange: onChange,\r\n      peerId: this.chatId.toPeerId(true),\r\n      head: placeholder\r\n    }, this.managers);\r\n\r\n    const originalValue = placeholder + ((chat as Chat.channel).username || '');\r\n\r\n    inputWrapper.append(linkInputField.container)\r\n    publicSection.content.append(inputWrapper);\r\n\r\n    const applyBtn = ButtonCorner({icon: 'check', className: 'is-visible'});\r\n    this.content.append(applyBtn);\r\n\r\n    attachClickEvent(applyBtn, () => {\r\n      /* const unsetLoader =  */setButtonLoader(applyBtn);\r\n      const username = publicRow.radioField.checked ? linkInputField.getValue() : '';\r\n      this.managers.appChatsManager.migrateChat(this.chatId).then((channelId) => {\r\n        return this.managers.appChatsManager.updateUsername(channelId, username);\r\n      }).then(() => {\r\n        // unsetLoader();\r\n        this.close();\r\n      });\r\n    }, {listenerSetter: this.listenerSetter});\r\n\r\n    (originalValue !== placeholder ? publicRow : privateRow).radioField.checked = true;\r\n    linkInputField.setOriginalValue(originalValue);\r\n\r\n    this.scrollable.append(section.container, privateSection.container, publicSection.container);\r\n\r\n    {\r\n      const section = new SettingSection({\r\n        name: 'SavingContentTitle',\r\n        caption: isBroadcast ? 'RestrictSavingContentInfoChannel' : 'RestrictSavingContentInfoGroup'\r\n      });\r\n\r\n      const checkboxField = new CheckboxField({\r\n        text: 'RestrictSavingContent',\r\n        withRipple: true\r\n      });\r\n\r\n      this.listenerSetter.add(checkboxField.input)('change', () => {\r\n        const toggle = checkboxField.toggleDisability(true);\r\n        this.managers.appChatsManager.toggleNoForwards(this.chatId, checkboxField.checked).then(() => {\r\n          toggle();\r\n        });\r\n      });\r\n\r\n      const onChatUpdate = () => {\r\n        checkboxField.setValueSilently(!!(chat as Chat.channel).pFlags.noforwards);\r\n      };\r\n\r\n      this.listenerSetter.add(rootScope)('chat_update', (chatId) => {\r\n        if(this.chatId === chatId) {\r\n          onChatUpdate();\r\n        }\r\n      });\r\n\r\n      onChatUpdate();\r\n\r\n      section.content.append(checkboxField.label);\r\n\r\n      this.scrollable.append(section.container);\r\n    }\r\n  }\r\n}\r\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport {attachClickEvent} from '../../../helpers/dom/clickEvent';\nimport toggleDisability from '../../../helpers/dom/toggleDisability';\nimport deepEqual from '../../../helpers/object/deepEqual';\nimport {ChannelParticipant} from '../../../layer';\nimport appDialogsManager from '../../../lib/appManagers/appDialogsManager';\nimport Button from '../../button';\nimport {SettingSection} from '../../sidebarLeft';\nimport {SliderSuperTabEventable} from '../../sliderTab';\nimport getUserStatusString from '../../wrappers/getUserStatusString';\nimport {ChatPermissions} from './groupPermissions';\n\nexport default class AppUserPermissionsTab extends SliderSuperTabEventable {\n  public participant: ChannelParticipant;\n  public chatId: ChatId;\n  public userId: UserId;\n\n  protected async init() {\n    this.container.classList.add('edit-peer-container', 'user-permissions-container');\n    this.setTitle('UserRestrictions');\n\n    let destroyListener: () => void;\n\n    {\n      const section = new SettingSection({\n        name: 'UserRestrictionsCanDo'\n      });\n\n      const div = document.createElement('div');\n      div.classList.add('chatlist-container');\n      section.content.insertBefore(div, section.title);\n\n      const list = appDialogsManager.createChatList({new: true});\n      div.append(list);\n\n      const {dom} = appDialogsManager.addDialogNew({\n        peerId: this.userId.toPeerId(false),\n        container: list,\n        rippleEnabled: true,\n        avatarSize: 48\n      });\n\n      dom.lastMessageSpan.append(getUserStatusString(await this.managers.appUsersManager.getUser(this.userId)));\n\n      const p = new ChatPermissions({\n        chatId: this.chatId,\n        listenerSetter: this.listenerSetter,\n        appendTo: section.content,\n        participant: this.participant._ === 'channelParticipantBanned' ? this.participant : undefined\n      }, this.managers);\n\n      destroyListener = () => {\n        // appChatsManager.editChatDefaultBannedRights(this.chatId, p.takeOut());\n        const rights = p.takeOut();\n        if(this.participant._ === 'channelParticipantBanned' && deepEqual(this.participant.banned_rights.pFlags, rights.pFlags)) {\n          return;\n        }\n\n        this.managers.appChatsManager.editBanned(this.chatId, this.participant, rights);\n      };\n\n      this.eventListener.addEventListener('destroy', destroyListener, {once: true});\n\n      this.scrollable.append(section.container);\n    }\n\n    {\n      const section = new SettingSection({});\n\n      if(this.participant._ === 'channelParticipantBanned') {\n        const btnDeleteException = Button('btn-primary btn-transparent danger', {icon: 'delete', text: 'GroupPermission.Delete'});\n\n        attachClickEvent(btnDeleteException, () => {\n          const toggle = toggleDisability([btnDeleteException], true);\n          this.managers.appChatsManager.clearChannelParticipantBannedRights(this.chatId, this.participant).then(() => {\n            this.eventListener.removeEventListener('destroy', destroyListener);\n            this.close();\n          }, () => {\n            toggle();\n          });\n        }, {listenerSetter: this.listenerSetter});\n\n        section.content.append(btnDeleteException);\n      }\n\n      const btnDelete = Button('btn-primary btn-transparent danger', {icon: 'deleteuser', text: 'UserRestrictionsBlock'});\n\n      attachClickEvent(btnDelete, () => {\n        const toggle = toggleDisability([btnDelete], true);\n        this.managers.appChatsManager.kickFromChannel(this.chatId, this.participant).then(() => {\n          this.eventListener.removeEventListener('destroy', destroyListener);\n          this.close();\n        });\n        /* new PopupPeer('popup-group-kick-user', {\n          peerId: -this.chatId,\n          title: 'Ban User?',\n          description: `Are you sure you want to ban <b>${appPeersManager.getPeerTitle(this.userId)}</b>`,\n          buttons: addCancelButton([{\n            text: 'BAN',\n            callback: () => {\n              const toggle = toggleDisability([btnDelete], true);\n\n              appChatsManager.kickFromChannel(this.chatId, this.participant).then(() => {\n                this.eventListener.removeEventListener('destroy', destroyListener);\n                this.close();\n              }, () => {\n                toggle();\n              });\n            },\n            isDanger: true\n          }])\n        }).show(); */\n      }, {listenerSetter: this.listenerSetter});\n\n      section.content.append(btnDelete);\n\n      this.scrollable.append(section.container);\n    }\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport {attachClickEvent} from '../../../helpers/dom/clickEvent';\nimport findUpTag from '../../../helpers/dom/findUpTag';\nimport replaceContent from '../../../helpers/dom/replaceContent';\nimport ListenerSetter from '../../../helpers/listenerSetter';\nimport ScrollableLoader from '../../../helpers/scrollableLoader';\nimport {ChannelParticipant, Chat, ChatBannedRights, Update} from '../../../layer';\nimport {ChatRights} from '../../../lib/appManagers/appChatsManager';\nimport appDialogsManager, {DIALOG_LIST_ELEMENT_TAG} from '../../../lib/appManagers/appDialogsManager';\nimport {AppManagers} from '../../../lib/appManagers/managers';\nimport combineParticipantBannedRights from '../../../lib/appManagers/utils/chats/combineParticipantBannedRights';\nimport hasRights from '../../../lib/appManagers/utils/chats/hasRights';\nimport getPeerId from '../../../lib/appManagers/utils/peers/getPeerId';\nimport I18n, {i18n, join, LangPackKey} from '../../../lib/langPack';\nimport rootScope from '../../../lib/rootScope';\nimport CheckboxField from '../../checkboxField';\nimport PopupPickUser from '../../popups/pickUser';\nimport Row from '../../row';\nimport {SettingSection} from '../../sidebarLeft';\nimport {SliderSuperTabEventable} from '../../sliderTab';\nimport {toast} from '../../toast';\nimport AppUserPermissionsTab from './userPermissions';\n\nexport class ChatPermissions {\n  public v: Array<{\n    flags: ChatRights[],\n    text: LangPackKey,\n    exceptionText: LangPackKey,\n    checkboxField?: CheckboxField,\n  }>;\n  private toggleWith: Partial<{[chatRight in ChatRights]: ChatRights[]}>;\n\n  constructor(private options: {\n    chatId: ChatId,\n    listenerSetter: ListenerSetter,\n    appendTo: HTMLElement,\n    participant?: ChannelParticipant.channelParticipantBanned\n  }, private managers: AppManagers) {\n    this.construct();\n  }\n\n  public async construct() {\n    this.v = [\n      {flags: ['send_messages'], text: 'UserRestrictionsSend', exceptionText: 'UserRestrictionsNoSend'},\n      {flags: ['send_media'], text: 'UserRestrictionsSendMedia', exceptionText: 'UserRestrictionsNoSendMedia'},\n      {flags: ['send_stickers', 'send_gifs'], text: 'UserRestrictionsSendStickers', exceptionText: 'UserRestrictionsNoSendStickers'},\n      {flags: ['send_polls'], text: 'UserRestrictionsSendPolls', exceptionText: 'UserRestrictionsNoSendPolls'},\n      {flags: ['embed_links'], text: 'UserRestrictionsEmbedLinks', exceptionText: 'UserRestrictionsNoEmbedLinks'},\n      {flags: ['invite_users'], text: 'UserRestrictionsInviteUsers', exceptionText: 'UserRestrictionsNoInviteUsers'},\n      {flags: ['pin_messages'], text: 'UserRestrictionsPinMessages', exceptionText: 'UserRestrictionsNoPinMessages'},\n      {flags: ['change_info'], text: 'UserRestrictionsChangeInfo', exceptionText: 'UserRestrictionsNoChangeInfo'}\n    ];\n\n    this.toggleWith = {\n      'send_messages': ['send_media', 'send_stickers', 'send_polls', 'embed_links']\n    };\n\n    const options = this.options;\n    const chat: Chat.chat | Chat.channel = await this.managers.appChatsManager.getChat(options.chatId);\n    const defaultBannedRights = chat.default_banned_rights;\n    const rights = options.participant ? combineParticipantBannedRights(chat as Chat.channel, options.participant.banned_rights) : defaultBannedRights;\n\n    const restrictionText: LangPackKey = options.participant ? 'UserRestrictionsDisabled' : 'EditCantEditPermissionsPublic';\n    for(const info of this.v) {\n      const mainFlag = info.flags[0];\n      info.checkboxField = new CheckboxField({\n        text: info.text,\n        checked: hasRights(chat, mainFlag, rights),\n        restriction: true,\n        withRipple: true\n      });\n\n      if((\n        options.participant &&\n          defaultBannedRights.pFlags[mainFlag as keyof typeof defaultBannedRights['pFlags']]\n      ) || (\n        (chat as Chat.channel).username &&\n          (\n            info.flags.includes('pin_messages') ||\n            info.flags.includes('change_info')\n          )\n      )\n      ) {\n        info.checkboxField.input.disabled = true;\n\n        /* options.listenerSetter.add(info.checkboxField.input)('change', (e) => {\n          if(!e.isTrusted) {\n            return;\n          }\n\n          cancelEvent(e);\n          toast('This option is disabled for all members in Group Permissions.');\n          info.checkboxField.checked = false;\n        }); */\n\n        attachClickEvent(info.checkboxField.label, (e) => {\n          toast(I18n.format(restrictionText, true));\n        }, {listenerSetter: options.listenerSetter});\n      }\n\n      if(this.toggleWith[mainFlag]) {\n        options.listenerSetter.add(info.checkboxField.input)('change', () => {\n          if(!info.checkboxField.checked) {\n            const other = this.v.filter((i) => this.toggleWith[mainFlag].includes(i.flags[0]));\n            other.forEach((info) => {\n              info.checkboxField.checked = false;\n            });\n          }\n        });\n      }\n\n      options.appendTo.append(info.checkboxField.label);\n    }\n  }\n\n  public takeOut() {\n    const rights: ChatBannedRights = {\n      _: 'chatBannedRights',\n      until_date: 0x7FFFFFFF,\n      pFlags: {}\n    };\n\n    for(const info of this.v) {\n      const banned = !info.checkboxField.checked;\n      if(banned) {\n        info.flags.forEach((flag) => {\n          // @ts-ignore\n          rights.pFlags[flag] = true;\n        });\n      }\n    }\n\n    return rights;\n  }\n}\n\nexport default class AppGroupPermissionsTab extends SliderSuperTabEventable {\n  public chatId: ChatId;\n\n  protected async init() {\n    this.container.classList.add('edit-peer-container', 'group-permissions-container');\n    this.setTitle('ChannelPermissions');\n\n    let chatPermissions: ChatPermissions;\n    {\n      const section = new SettingSection({\n        name: 'ChannelPermissionsHeader'\n      });\n\n      chatPermissions = new ChatPermissions({\n        chatId: this.chatId,\n        listenerSetter: this.listenerSetter,\n        appendTo: section.content\n      }, this.managers);\n\n      this.eventListener.addEventListener('destroy', () => {\n        this.managers.appChatsManager.editChatDefaultBannedRights(this.chatId, chatPermissions.takeOut());\n      }, {once: true});\n\n      this.scrollable.append(section.container);\n    }\n\n    {\n      const section = new SettingSection({\n        name: 'PrivacyExceptions'\n      });\n\n      const addExceptionRow = new Row({\n        titleLangKey: 'ChannelAddException',\n        subtitleLangKey: 'Loading',\n        icon: 'adduser',\n        clickable: () => {\n          new PopupPickUser({\n            peerTypes: ['channelParticipants'],\n            onSelect: (peerId) => {\n              setTimeout(() => {\n                openPermissions(peerId);\n              }, 0);\n            },\n            placeholder: 'ExceptionModal.Search.Placeholder',\n            peerId: -this.chatId\n          });\n        },\n        listenerSetter: this.listenerSetter\n      });\n\n      const openPermissions = async(peerId: PeerId) => {\n        let participant: AppUserPermissionsTab['participant'];\n        try {\n          participant = await this.managers.appProfileManager.getChannelParticipant(this.chatId, peerId) as any;\n        } catch(err) {\n          toast('User is no longer participant');\n          return;\n        }\n\n        const tab = this.slider.createTab(AppUserPermissionsTab);\n        tab.participant = participant;\n        tab.chatId = this.chatId;\n        tab.userId = peerId;\n        tab.open();\n      };\n\n      section.content.append(addExceptionRow.container);\n\n      /* const removedUsersRow = new Row({\n        titleLangKey: 'ChannelBlockedUsers',\n        subtitleLangKey: 'NoBlockedUsers',\n        icon: 'deleteuser',\n        clickable: true\n      });\n\n      section.content.append(removedUsersRow.container); */\n\n      const c = section.generateContentElement();\n      c.classList.add('chatlist-container');\n\n      const list = appDialogsManager.createChatList({new: true});\n      c.append(list);\n\n      attachClickEvent(list, (e) => {\n        const target = findUpTag(e.target, DIALOG_LIST_ELEMENT_TAG);\n        if(!target) return;\n\n        const peerId = target.dataset.peerId.toPeerId();\n        openPermissions(peerId);\n      }, {listenerSetter: this.listenerSetter});\n\n      const setSubtitle = async(li: Element, participant: ChannelParticipant.channelParticipantBanned) => {\n        const bannedRights = participant.banned_rights;// appChatsManager.combineParticipantBannedRights(this.chatId, participant.banned_rights);\n        const defaultBannedRights = ((await this.managers.appChatsManager.getChat(this.chatId)) as Chat.channel).default_banned_rights;\n        // const combinedRights = appChatsManager.combineParticipantBannedRights(this.chatId, bannedRights);\n\n        const cantWhat: LangPackKey[] = []/* , canWhat: LangPackKey[] = [] */;\n        chatPermissions.v.forEach((info) => {\n          const mainFlag = info.flags[0];\n          // @ts-ignore\n          if(bannedRights.pFlags[mainFlag] && !defaultBannedRights.pFlags[mainFlag]) {\n            cantWhat.push(info.exceptionText);\n          // @ts-ignore\n          }/*  else if(!combinedRights.pFlags[mainFlag]) {\n            canWhat.push(info.exceptionText);\n          } */\n        });\n\n        const el = li.querySelector('.user-last-message') as HTMLElement;\n\n        if(cantWhat.length) {\n          el.innerHTML = '';\n          el.append(...join(cantWhat.map((t) => i18n(t)), false));\n        }/*  else if(canWhat.length) {\n          str = 'Can ' + canWhat.join(canWhat.length === 2 ? ' and ' : ', ');\n        } */\n\n        el.classList.toggle('hide', !cantWhat.length);\n      };\n\n      const add = (participant: ChannelParticipant.channelParticipantBanned, append: boolean) => {\n        const {dom} = appDialogsManager.addDialogNew({\n          peerId: getPeerId(participant.peer),\n          container: list,\n          rippleEnabled: true,\n          avatarSize: 48,\n          append\n        });\n\n        setSubtitle(dom.listEl, participant);\n\n        // dom.titleSpan.innerHTML = 'Chinaza Akachi';\n        // dom.lastMessageSpan.innerHTML = 'Can Add Users and Pin Messages';\n      };\n\n      // this.listenerSetter.add(rootScope)('updateChannelParticipant', (update: Update.updateChannelParticipant) => {\n      //   const needAdd = update.new_participant?._ === 'channelParticipantBanned' && !update.new_participant.banned_rights.pFlags.view_messages;\n      //   const li = list.querySelector(`[data-peer-id=\"${update.user_id}\"]`);\n      //   if(needAdd) {\n      //     if(!li) {\n      //       add(update.new_participant as ChannelParticipant.channelParticipantBanned, false);\n      //     } else {\n      //       setSubtitle(li, update.new_participant as ChannelParticipant.channelParticipantBanned);\n      //     }\n\n      //     if(update.prev_participant?._ !== 'channelParticipantBanned') {\n      //       ++exceptionsCount;\n      //     }\n      //   } else {\n      //     if(li) {\n      //       li.remove();\n      //     }\n\n      //     if(update.prev_participant?._ === 'channelParticipantBanned') {\n      //       --exceptionsCount;\n      //     }\n      //   }\n\n      //   setLength();\n      // });\n\n      const setLength = () => {\n        replaceContent(addExceptionRow.subtitle, i18n(exceptionsCount ? 'Permissions.ExceptionsCount' : 'Permissions.NoExceptions', [exceptionsCount]));\n      };\n\n      let exceptionsCount = 0;\n      let loader: ScrollableLoader;\n      const setLoader = () => {\n        const LOAD_COUNT = 50;\n        loader = new ScrollableLoader({\n          scrollable: this.scrollable,\n          getPromise: () => {\n            return this.managers.appProfileManager.getChannelParticipants(this.chatId, {_: 'channelParticipantsBanned', q: ''}, LOAD_COUNT, list.childElementCount).then((res) => {\n              for(const participant of res.participants) {\n                add(participant as ChannelParticipant.channelParticipantBanned, true);\n              }\n\n              exceptionsCount = res.count;\n              setLength();\n\n              return res.participants.length < LOAD_COUNT || res.count === list.childElementCount;\n            });\n          }\n        });\n\n        return loader.load();\n      };\n\n      this.scrollable.append(section.container);\n\n      if(await this.managers.appChatsManager.isChannel(this.chatId)) {\n        await setLoader();\n      } else {\n        setLength();\n\n        this.listenerSetter.add(rootScope)('dialog_migrate', ({migrateFrom, migrateTo}) => {\n          if(this.chatId === migrateFrom) {\n            this.chatId = migrateTo;\n            setLoader();\n          }\n        });\n      }\n    }\n  }\n\n  onOpenAfterTimeout() {\n    this.scrollable.onScroll();\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport copy from '../../../../helpers/object/copy';\nimport {ChatBannedRights, Chat} from '../../../../layer';\n\nexport default function combineParticipantBannedRights(chat: Chat.channel, rights: ChatBannedRights) {\n  if(chat.default_banned_rights) {\n    rights = copy(rights);\n    const defaultRights = chat.default_banned_rights.pFlags;\n    for(const i in defaultRights) {\n      // @ts-ignore\n      rights.pFlags[i] = defaultRights[i];\n    }\n  }\n\n  return rights;\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport debounce from '../../../helpers/schedulers/debounce';\nimport CheckboxField from '../../checkboxField';\nimport Row from '../../row';\nimport {SettingSection} from '../../sidebarLeft';\nimport {SliderSuperTabEventable} from '../../sliderTab';\nimport {wrapStickerToRow} from '../../wrappers';\n\nexport default class AppChatReactionsTab extends SliderSuperTabEventable {\n  public chatId: ChatId;\n\n  protected async init() {\n    this.setTitle('Reactions');\n\n    const availableReactions = await this.managers.appReactionsManager.getActiveAvailableReactions();\n    const chatFull = await this.managers.appProfileManager.getChatFull(this.chatId);\n    let originalReactions = chatFull.available_reactions ?? [];\n    const enabledReactions = new Set(originalReactions);\n\n    const toggleSection = new SettingSection({\n      caption: await this.managers.appChatsManager.isBroadcast(this.chatId) ? 'EnableReactionsChannelInfo' : 'EnableReactionsGroupInfo'\n    });\n\n    const toggleCheckboxField = new CheckboxField({toggle: true, checked: !!enabledReactions.size});\n    const toggleRow = new Row({\n      checkboxField: toggleCheckboxField,\n      titleLangKey: 'EnableReactions',\n      listenerSetter: this.listenerSetter\n    });\n\n    toggleSection.content.append(toggleRow.container);\n\n    const reactionsSection = new SettingSection({\n      name: 'AvailableReactions'\n    });\n\n    const checkboxFields = availableReactions.map((availableReaction) => {\n      const checkboxField = new CheckboxField({\n        toggle: true,\n        checked: enabledReactions.has(availableReaction.reaction)\n      });\n\n      this.listenerSetter.add(checkboxField.input)('change', () => {\n        if(checkboxField.checked) {\n          enabledReactions.add(availableReaction.reaction);\n\n          if(!toggleCheckboxField.checked) {\n            toggleCheckboxField.setValueSilently(true);\n          }\n        } else {\n          enabledReactions.delete(availableReaction.reaction);\n\n          if(!enabledReactions.size && toggleCheckboxField.checked) {\n            toggleCheckboxField.setValueSilently(false);\n          }\n        }\n\n        saveReactionsDebounced();\n      });\n\n      const row = new Row({\n        checkboxField,\n        title: availableReaction.title,\n        havePadding: true,\n        listenerSetter: this.listenerSetter\n      });\n\n      wrapStickerToRow({\n        row,\n        doc: availableReaction.static_icon,\n        size: 'small'\n      });\n\n      reactionsSection.content.append(row.container);\n\n      return checkboxField;\n    });\n\n    this.listenerSetter.add(toggleRow.checkboxField.input)('change', () => {\n      if(!toggleCheckboxField.checked) {\n        checkboxFields.forEach((checkboxField) => checkboxField.checked = false);\n        saveReactionsDebounced();\n      } else if(checkboxFields.every((checkboxField) => !checkboxField.checked)) {\n        checkboxFields.forEach((checkboxField) => checkboxField.checked = true);\n        saveReactionsDebounced();\n      }\n    });\n\n    const saveReactions = async() => {\n      const newReactions = Array.from(enabledReactions);\n      if([...newReactions].sort().join() === [...originalReactions].sort().join()) {\n        return;\n      }\n\n      const chatFull = await this.managers.appProfileManager.getCachedFullChat(this.chatId);\n      if(chatFull) {\n        chatFull.available_reactions = newReactions;\n      }\n\n      this.managers.appChatsManager.setChatAvailableReactions(this.chatId, newReactions);\n      originalReactions = newReactions;\n    };\n\n    const saveReactionsDebounced = debounce(saveReactions, 3000, false, true);\n\n    this.eventListener.addEventListener('destroy', saveReactions, {once: true});\n\n    this.scrollable.append(toggleSection.container, reactionsSection.container);\n  }\n}\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport {SliderSuperTab} from '../../slider'\r\nimport InputField from '../../inputField';\r\nimport EditPeer from '../../editPeer';\r\nimport {SettingSection} from '../../sidebarLeft';\r\nimport Row from '../../row';\r\nimport Button from '../../button';\r\nimport {ChatRights} from '../../../lib/appManagers/appChatsManager';\r\nimport {Chat, ChatFull} from '../../../layer';\r\nimport AppChatTypeTab from './chatType';\r\nimport rootScope from '../../../lib/rootScope';\r\nimport AppGroupPermissionsTab from './groupPermissions';\r\nimport {i18n, LangPackKey} from '../../../lib/langPack';\r\nimport PopupDeleteDialog from '../../popups/deleteDialog';\r\nimport {attachClickEvent} from '../../../helpers/dom/clickEvent';\r\nimport toggleDisability from '../../../helpers/dom/toggleDisability';\r\nimport CheckboxField from '../../checkboxField';\r\nimport AppChatReactionsTab from './chatReactions';\r\nimport hasRights from '../../../lib/appManagers/utils/chats/hasRights';\r\n\r\nexport default class AppEditChatTab extends SliderSuperTab {\r\n  private chatNameInputField: InputField;\r\n  private descriptionInputField: InputField;\r\n  private editPeer: EditPeer;\r\n  private tempId: number;\r\n  public chatId: ChatId;\r\n\r\n  protected async _init() {\r\n    // * cleanup prev\r\n    this.listenerSetter.removeAll();\r\n    this.scrollable.container.innerHTML = '';\r\n    this.tempId ??= 0;\r\n    const tempId = ++this.tempId;\r\n\r\n    this.container.classList.add('edit-peer-container', 'edit-group-container');\r\n    this.setTitle('Edit');\r\n\r\n    let chatFull = await this.managers.appProfileManager.getChatFull(this.chatId, true);\r\n\r\n    const chat: Chat.chat | Chat.channel = await this.managers.appChatsManager.getChat(this.chatId);\r\n    const isBroadcast = await this.managers.appChatsManager.isBroadcast(this.chatId);\r\n    const isChannel = await this.managers.appChatsManager.isChannel(this.chatId);\r\n\r\n    const chatUpdateListeners: (() => void)[] = [];\r\n    const addChatUpdateListener = (callback: () => void) => {\r\n      chatUpdateListeners.push(callback);\r\n    };\r\n\r\n    this.listenerSetter.add(rootScope)('chat_update', (chatId) => {\r\n      if(this.chatId === chatId) {\r\n        chatUpdateListeners.forEach((callback) => callback());\r\n      }\r\n    });\r\n\r\n    this.listenerSetter.add(rootScope)('chat_full_update', async(chatId) => {\r\n      if(this.chatId === chatId) {\r\n        chatFull = await this.managers.appProfileManager.getCachedFullChat(chatId) || chatFull;\r\n      }\r\n    });\r\n\r\n    const peerId = this.chatId.toPeerId(true);\r\n    const canChangeType = await this.managers.appChatsManager.hasRights(this.chatId, 'change_type');\r\n    const canChangePermissions = await this.managers.appChatsManager.hasRights(this.chatId, 'change_permissions');\r\n\r\n    {\r\n      const section = new SettingSection({noDelimiter: true});\r\n      const inputFields: InputField[] = [];\r\n\r\n      const inputWrapper = document.createElement('div');\r\n      inputWrapper.classList.add('input-wrapper');\r\n\r\n      this.chatNameInputField = new InputField({\r\n        label: isBroadcast ? 'EnterChannelName' : 'CreateGroup.NameHolder',\r\n        name: 'chat-name',\r\n        maxLength: 255,\r\n        required: true\r\n      });\r\n      this.descriptionInputField = new InputField({\r\n        label: 'DescriptionPlaceholder',\r\n        name: 'chat-description',\r\n        maxLength: 255\r\n      });\r\n\r\n      this.chatNameInputField.setOriginalValue(chat.title);\r\n      this.descriptionInputField.setOriginalValue(chatFull.about);\r\n\r\n      inputWrapper.append(this.chatNameInputField.container, this.descriptionInputField.container);\r\n\r\n      inputFields.push(this.chatNameInputField, this.descriptionInputField);\r\n\r\n      this.editPeer = new EditPeer({\r\n        peerId,\r\n        inputFields,\r\n        listenerSetter: this.listenerSetter\r\n      });\r\n      this.content.append(this.editPeer.nextBtn);\r\n\r\n      section.content.append(this.editPeer.avatarEdit.container, inputWrapper);\r\n\r\n      if(canChangeType) {\r\n        const chatTypeRow = new Row({\r\n          titleLangKey: isBroadcast ? 'ChannelType' : 'GroupType',\r\n          clickable: () => {\r\n            const tab = this.slider.createTab(AppChatTypeTab);\r\n            tab.chatId = this.chatId;\r\n            tab.chatFull = chatFull;\r\n            tab.open();\r\n\r\n            this.listenerSetter.add(tab.eventListener)('destroy', setChatTypeSubtitle);\r\n          },\r\n          icon: 'lock',\r\n          listenerSetter: this.listenerSetter\r\n        });\r\n\r\n        const setChatTypeSubtitle = () => {\r\n          chatTypeRow.subtitle.textContent = '';\r\n\r\n          let key: LangPackKey;\r\n          if(isBroadcast) {\r\n            key = (chat as Chat.channel).username ? 'TypePublic' : 'TypePrivate';\r\n          } else {\r\n            key = (chat as Chat.channel).username ? 'TypePublicGroup' : 'TypePrivateGroup';\r\n          }\r\n\r\n          chatTypeRow.subtitle.append(i18n(key));\r\n        };\r\n\r\n        setChatTypeSubtitle();\r\n        section.content.append(chatTypeRow.container);\r\n      }\r\n\r\n      if(canChangeType || canChangePermissions) {\r\n        const reactionsRow = new Row({\r\n          titleLangKey: 'Reactions',\r\n          icon: 'reactions',\r\n          clickable: () => {\r\n            const tab = this.slider.createTab(AppChatReactionsTab);\r\n            tab.chatId = this.chatId;\r\n            tab.open().then(() => {\r\n              if(this.tempId !== tempId) {\r\n                return;\r\n              }\r\n\r\n              this.listenerSetter.add(tab.eventListener)('destroy', setReactionsLength);\r\n            });\r\n          },\r\n          listenerSetter: this.listenerSetter\r\n        });\r\n\r\n        const availableReactions = await this.managers.appReactionsManager.getAvailableReactions();\r\n        const availableReactionsLength = availableReactions.filter((availableReaction) => !availableReaction.pFlags.inactive).length;\r\n        const setReactionsLength = () => {\r\n          const reactions = chatFull.available_reactions ?? [];\r\n          reactionsRow.subtitle.innerHTML = reactions.length + '/' + availableReactionsLength;\r\n        };\r\n\r\n        setReactionsLength();\r\n\r\n        section.content.append(reactionsRow.container);\r\n      }\r\n\r\n      if(canChangePermissions && !isBroadcast) {\r\n        const flags = [\r\n          'send_messages',\r\n          'send_media',\r\n          'send_stickers',\r\n          'send_polls',\r\n          'embed_links',\r\n          'invite_users',\r\n          'pin_messages',\r\n          'change_info'\r\n        ] as ChatRights[];\r\n\r\n        const permissionsRow = new Row({\r\n          titleLangKey: 'ChannelPermissions',\r\n          clickable: () => {\r\n            const tab = this.slider.createTab(AppGroupPermissionsTab);\r\n            tab.chatId = this.chatId;\r\n            tab.open();\r\n          },\r\n          icon: 'permissions',\r\n          listenerSetter: this.listenerSetter\r\n        });\r\n\r\n        const setPermissionsLength = async() => {\r\n          const chat = await this.managers.appChatsManager.getChatTyped(this.chatId);\r\n          permissionsRow.subtitle.innerHTML = flags.reduce((acc, f) => acc + +hasRights(chat, f, (chat as Chat.chat).default_banned_rights), 0) + '/' + flags.length;\r\n        };\r\n\r\n        setPermissionsLength();\r\n        section.content.append(permissionsRow.container);\r\n\r\n        this.listenerSetter.add(rootScope)('chat_update', (chatId) => {\r\n          if(this.chatId === chatId) {\r\n            setPermissionsLength();\r\n          }\r\n        });\r\n      }\r\n\r\n      /* const administratorsRow = new Row({\r\n        titleLangKey: 'PeerInfo.Administrators',\r\n        subtitle: '' + ((chatFull as ChatFull.channelFull).admins_count || 1),\r\n        icon: 'admin',\r\n        clickable: true\r\n      });\r\n\r\n      section.content.append(administratorsRow.container); */\r\n\r\n      this.scrollable.append(section.container);\r\n\r\n      attachClickEvent(this.editPeer.nextBtn, () => {\r\n        this.editPeer.nextBtn.disabled = true;\r\n\r\n        const promises: Promise<any>[] = [];\r\n\r\n        const id = this.chatId;\r\n        if(this.chatNameInputField.isValidToChange()) {\r\n          promises.push(this.managers.appChatsManager.editTitle(id, this.chatNameInputField.value));\r\n        }\r\n\r\n        if(this.descriptionInputField.isValidToChange()) {\r\n          promises.push(this.managers.appChatsManager.editAbout(id, this.descriptionInputField.value));\r\n        }\r\n\r\n        if(this.editPeer.uploadAvatar) {\r\n          promises.push(this.editPeer.uploadAvatar().then((inputFile) => {\r\n            return this.managers.appChatsManager.editPhoto(id, inputFile);\r\n          }));\r\n        }\r\n\r\n        Promise.race(promises).finally(() => {\r\n          this.editPeer.nextBtn.removeAttribute('disabled');\r\n          this.close();\r\n        });\r\n      }, {listenerSetter: this.listenerSetter});\r\n\r\n\r\n      /* if(appChatsManager.hasRights(-this.peerId, 'change_info')) {\r\n        const discussionRow = new Row({\r\n          titleLangKey: 'PeerInfo.Discussion',\r\n          subtitleLangKey: 'PeerInfo.Discussion.Add',\r\n          clickable: true,\r\n          icon: 'message'\r\n        });\r\n\r\n        section.content.append(discussionRow.container);\r\n      }\r\n\r\n      const administratorsRow = new Row({\r\n        titleLangKey: 'PeerInfo.Administrators',\r\n        subtitle: '' + chatFull.admins_count,\r\n        icon: 'admin',\r\n        clickable: true\r\n      });\r\n\r\n      section.content.append(administratorsRow.container); */\r\n\r\n      if(isBroadcast && await this.managers.appChatsManager.hasRights(this.chatId, 'change_info')) {\r\n        const signMessagesCheckboxField = new CheckboxField({\r\n          text: 'PeerInfo.SignMessages',\r\n          checked: !!(chat as Chat.channel).pFlags.signatures,\r\n          withRipple: true\r\n        });\r\n\r\n        this.listenerSetter.add(signMessagesCheckboxField.input)('change', () => {\r\n          const toggle = signMessagesCheckboxField.toggleDisability(true);\r\n          this.managers.appChatsManager.toggleSignatures(this.chatId, signMessagesCheckboxField.checked).then(() => {\r\n            toggle();\r\n          });\r\n        });\r\n\r\n        addChatUpdateListener(() => {\r\n          signMessagesCheckboxField.setValueSilently(!!(chat as Chat.channel).pFlags.signatures);\r\n        });\r\n\r\n        section.content.append(signMessagesCheckboxField.label);\r\n      }\r\n    }\r\n\r\n    if(!isBroadcast) {\r\n      const section = new SettingSection({\r\n\r\n      });\r\n\r\n      /* const membersRow = new Row({\r\n        titleLangKey: isBroadcast ? 'PeerInfo.Subscribers' : 'GroupMembers',\r\n        icon: 'newgroup',\r\n        clickable: true\r\n      });\r\n\r\n      membersRow.subtitle.append(i18n('Subscribers', [numberThousandSplitter(335356)]));\r\n\r\n      section.content.append(membersRow.container); */\r\n\r\n      if(!isBroadcast && canChangeType) {\r\n        const showChatHistoryCheckboxField = new CheckboxField({\r\n          text: 'ChatHistory',\r\n          withRipple: true\r\n        });\r\n\r\n        this.listenerSetter.add(showChatHistoryCheckboxField.input)('change', () => {\r\n          const toggle = showChatHistoryCheckboxField.toggleDisability(true);\r\n          this.managers.appChatsManager.togglePreHistoryHidden(this.chatId, !showChatHistoryCheckboxField.checked).then(() => {\r\n            toggle();\r\n          });\r\n        });\r\n\r\n        // ! it won't be updated because chatFull will be old\r\n        const onChatUpdate = () => {\r\n          showChatHistoryCheckboxField.setValueSilently(isChannel && !(chatFull as ChatFull.channelFull).pFlags.hidden_prehistory);\r\n        };\r\n\r\n        onChatUpdate();\r\n        addChatUpdateListener(onChatUpdate);\r\n\r\n        section.content.append(showChatHistoryCheckboxField.label);\r\n      }\r\n\r\n      if(section.content.childElementCount) {\r\n        this.scrollable.append(section.container);\r\n      }\r\n    }\r\n\r\n    if(await this.managers.appChatsManager.hasRights(this.chatId, 'delete_chat')) {\r\n      const section = new SettingSection({});\r\n\r\n      const btnDelete = Button('btn-primary btn-transparent danger', {icon: 'delete', text: isBroadcast ? 'PeerInfo.DeleteChannel' : 'DeleteAndExitButton'});\r\n\r\n      attachClickEvent(btnDelete, () => {\r\n        new PopupDeleteDialog(peerId/* , 'delete' */, undefined, (promise) => {\r\n          const toggle = toggleDisability([btnDelete], true);\r\n          promise.then(() => {\r\n            this.close();\r\n          }, () => {\r\n            toggle();\r\n          });\r\n        });\r\n      }, {listenerSetter: this.listenerSetter});\r\n\r\n      section.content.append(btnDelete);\r\n\r\n      this.scrollable.append(section.container);\r\n    }\r\n\r\n    if(!isChannel) {\r\n      // ! this one will fire earlier than tab's closeAfterTimeout (destroy) event and listeners will be erased, so destroy won't fire\r\n      this.listenerSetter.add(rootScope)('dialog_migrate', ({migrateFrom, migrateTo}) => {\r\n        if(peerId === migrateFrom) {\r\n          this.chatId = migrateTo.toChatId();\r\n          this._init();\r\n        }\r\n      });\r\n    }\r\n  }\r\n\r\n  protected init() {\r\n    return this._init();\r\n  }\r\n}\r\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport rootScope from '../../../lib/rootScope';\nimport AppSearchSuper, {SearchSuperType} from '../../appSearchSuper.';\nimport SidebarSlider, {SliderSuperTab} from '../../slider';\nimport {TransitionSlider} from '../../transition';\nimport AppEditChatTab from './editChat';\nimport PeerTitle from '../../peerTitle';\nimport AppEditContactTab from './editContact';\nimport Button from '../../button';\nimport ButtonIcon from '../../buttonIcon';\nimport {i18n, LangPackKey} from '../../../lib/langPack';\nimport {toastNew} from '../../toast';\nimport AppAddMembersTab from '../../sidebarLeft/tabs/addMembers';\nimport PopupPickUser from '../../popups/pickUser';\nimport PopupPeer, {PopupPeerButtonCallbackCheckboxes, PopupPeerCheckboxOptions} from '../../popups/peer';\nimport ButtonCorner from '../../buttonCorner';\nimport {attachClickEvent} from '../../../helpers/dom/clickEvent';\nimport PeerProfile from '../../peerProfile';\nimport {Message} from '../../../layer';\n\nconst historiesStorage: {\n  [peerId: PeerId]: Partial<{\n    [type in SearchSuperType]: {mid: number, peerId: PeerId}[]\n  }>\n} = {};\n\n// TODO:    \nexport default class AppSharedMediaTab extends SliderSuperTab {\n  private editBtn: HTMLElement;\n\n  private peerId: PeerId;\n  private threadId = 0;\n\n  private searchSuper: AppSearchSuper;\n\n  private profile: PeerProfile;\n  private peerChanged: boolean;\n\n  constructor(slider: SidebarSlider) {\n    super(slider, false);\n  }\n\n  public init() {\n    // const perf = performance.now();\n\n    this.container.classList.add('shared-media-container', 'profile-container');\n\n    // * header\n    const newCloseBtn = Button('btn-icon sidebar-close-button', {noRipple: true});\n    this.closeBtn.replaceWith(newCloseBtn);\n    this.closeBtn = newCloseBtn;\n\n    const animatedCloseIcon = document.createElement('div');\n    animatedCloseIcon.classList.add('animated-close-icon');\n    newCloseBtn.append(animatedCloseIcon);\n\n    const transitionContainer = document.createElement('div');\n    transitionContainer.className = 'transition slide-fade';\n\n    const transitionFirstItem = document.createElement('div');\n    transitionFirstItem.classList.add('transition-item');\n\n    this.title.append(i18n('Profile'));\n    this.editBtn = ButtonIcon('edit');\n    // const moreBtn = ButtonIcon('more');\n\n    transitionFirstItem.append(this.title, this.editBtn/* , moreBtn */);\n\n    const transitionLastItem = document.createElement('div');\n    transitionLastItem.classList.add('transition-item');\n\n    const secondTitle: HTMLElement = this.title.cloneNode() as any;\n    secondTitle.append(i18n('PeerInfo.SharedMedia'));\n\n    transitionLastItem.append(secondTitle);\n\n    transitionContainer.append(transitionFirstItem, transitionLastItem);\n\n    this.header.append(transitionContainer);\n\n    // * body\n\n    this.profile = new PeerProfile(this.managers, this.scrollable, this.listenerSetter);\n    this.profile.init();\n\n    this.scrollable.append(this.profile.element);\n\n    const HEADER_HEIGHT = 56;\n    this.scrollable.onAdditionalScroll = () => {\n      const rect = this.searchSuper.nav.getBoundingClientRect();\n      if(!rect.width) return;\n\n      const top = rect.top - 1;\n      setIsSharedMedia(top <= HEADER_HEIGHT);\n    };\n\n    const setIsSharedMedia = (isSharedMedia: boolean) => {\n      animatedCloseIcon.classList.toggle('state-back', isSharedMedia);\n      this.searchSuper.container.classList.toggle('is-full-viewport', isSharedMedia);\n      transition(+isSharedMedia);\n\n      if(!isSharedMedia) {\n        this.searchSuper.cleanScrollPositions();\n      }\n    };\n\n    const transition = TransitionSlider(transitionContainer, 'slide-fade', 400, null, false);\n\n    transition(0);\n\n    attachClickEvent(this.closeBtn, (e) => {\n      if(this.closeBtn.firstElementChild.classList.contains('state-back')) {\n        this.scrollable.scrollIntoViewNew({\n          element: this.scrollable.container.firstElementChild as HTMLElement,\n          position: 'start'\n        });\n        transition(0);\n        animatedCloseIcon.classList.remove('state-back');\n      } else if(!this.scrollable.isHeavyAnimationInProgress) {\n        this.slider.onCloseBtnClick();\n      }\n    }, {listenerSetter: this.listenerSetter});\n\n    attachClickEvent(this.editBtn, (e) => {\n      let tab: AppEditChatTab | AppEditContactTab;\n      if(this.peerId.isAnyChat()) {\n        tab = this.slider.createTab(AppEditChatTab);\n      } else {\n        tab = this.slider.createTab(AppEditContactTab);\n      }\n\n      if(tab) {\n        if(tab instanceof AppEditChatTab) {\n          tab.chatId = this.peerId.toChatId();\n        } else {\n          tab.peerId = this.peerId;\n        }\n\n        tab.open();\n      }\n    }, {listenerSetter: this.listenerSetter});\n\n    this.listenerSetter.add(rootScope)('contacts_update', (userId) => {\n      if(this.peerId === userId) {\n        this.toggleEditBtn();\n      }\n    });\n\n    this.listenerSetter.add(rootScope)('chat_update', (chatId) => {\n      if(this.peerId === chatId.toPeerId(true)) {\n        this.toggleEditBtn();\n      }\n    });\n\n    this.listenerSetter.add(rootScope)('history_multiappend', (message) => {\n      this.renderNewMessages(message);\n    });\n\n    this.listenerSetter.add(rootScope)('history_delete', ({peerId, msgs}) => {\n      this.deleteDeletedMessages(peerId, Array.from(msgs));\n    });\n\n    // Calls when message successfully sent and we have an id\n    this.listenerSetter.add(rootScope)('message_sent', ({message}) => {\n      this.renderNewMessages(message);\n    });\n\n    // this.container.prepend(this.closeBtn.parentElement);\n\n    this.searchSuper = new AppSearchSuper({\n      mediaTabs: [{\n        inputFilter: 'inputMessagesFilterEmpty',\n        name: 'PeerMedia.Members',\n        type: 'members'\n      }, {\n        inputFilter: 'inputMessagesFilterPhotoVideo',\n        name: 'SharedMediaTab2',\n        type: 'media'\n      }, {\n        inputFilter: 'inputMessagesFilterDocument',\n        name: 'SharedFilesTab2',\n        type: 'files'\n      }, {\n        inputFilter: 'inputMessagesFilterUrl',\n        name: 'SharedLinksTab2',\n        type: 'links'\n      }, {\n        inputFilter: 'inputMessagesFilterMusic',\n        name: 'SharedMusicTab2',\n        type: 'music'\n      }, {\n        inputFilter: 'inputMessagesFilterRoundVoice',\n        name: 'SharedVoiceTab2',\n        type: 'voice'\n      }],\n      scrollable: this.scrollable,\n      onChangeTab: (mediaTab) => {\n        const timeout = mediaTab.type === 'members' && rootScope.settings.animationsEnabled ? 250 : 0;\n        setTimeout(() => {\n          btnAddMembers.classList.toggle('is-hidden', mediaTab.type !== 'members');\n        }, timeout);\n      },\n      managers: this.managers\n    });\n\n    this.searchSuper.scrollStartCallback = () => {\n      setIsSharedMedia(true);\n    };\n\n    this.profile.element.append(this.searchSuper.container);\n\n    const btnAddMembers = ButtonCorner({icon: 'addmember_filled'});\n    this.content.append(btnAddMembers);\n\n    attachClickEvent(btnAddMembers, async() => {\n      const peerId = this.peerId;\n      const id = this.peerId.toChatId();\n      const isChannel = await this.managers.appChatsManager.isChannel(id);\n\n      const showConfirmation = (peerIds: PeerId[], callback: (checked: PopupPeerButtonCallbackCheckboxes) => void) => {\n        let titleLangKey: LangPackKey, titleLangArgs: any[],\n          descriptionLangKey: LangPackKey, descriptionLangArgs: any[],\n          checkboxes: PopupPeerCheckboxOptions[];\n\n        if(peerIds.length > 1) {\n          titleLangKey = 'AddMembersAlertTitle';\n          titleLangArgs = [i18n('Members', [peerIds.length])];\n          descriptionLangKey = 'AddMembersAlertCountText';\n          descriptionLangArgs = peerIds.map((peerId) => {\n            const b = document.createElement('b');\n            b.append(new PeerTitle({peerId}).element);\n            return b;\n          });\n\n          if(!isChannel) {\n            checkboxes = [{\n              text: 'AddMembersForwardMessages',\n              checked: true\n            }];\n          }\n        } else {\n          titleLangKey = 'AddOneMemberAlertTitle';\n          descriptionLangKey = 'AddMembersAlertNamesText';\n          const b = document.createElement('b');\n          b.append(new PeerTitle({\n            peerId: peerIds[0]\n          }).element);\n          descriptionLangArgs = [b];\n\n          if(!isChannel) {\n            checkboxes = [{\n              text: 'AddOneMemberForwardMessages',\n              textArgs: [new PeerTitle({peerId: peerIds[0]}).element],\n              checked: true\n            }];\n          }\n        }\n\n        descriptionLangArgs.push(new PeerTitle({\n          peerId\n        }).element);\n\n        new PopupPeer('popup-add-members', {\n          peerId,\n          titleLangKey,\n          descriptionLangKey,\n          descriptionLangArgs,\n          buttons: [{\n            langKey: 'Add',\n            callback\n          }],\n          checkboxes\n        }).show();\n      };\n\n      const onError = (err: any) => {\n        if(err.type === 'USER_PRIVACY_RESTRICTED') {\n          toastNew({langPackKey: 'InviteToGroupError'});\n        }\n      };\n\n      if(isChannel) {\n        const tab = this.slider.createTab(AppAddMembersTab);\n        tab.open({\n          type: 'channel',\n          skippable: false,\n          takeOut: (peerIds) => {\n            showConfirmation(peerIds, () => {\n              const promise = this.managers.appChatsManager.inviteToChannel(id, peerIds);\n              promise.catch(onError);\n              tab.attachToPromise(promise);\n            });\n\n            return false;\n          },\n          title: 'GroupAddMembers',\n          placeholder: 'SendMessageTo'\n        });\n      } else {\n        new PopupPickUser({\n          peerTypes: ['contacts'],\n          placeholder: 'Search',\n          onSelect: (peerId) => {\n            setTimeout(() => {\n              showConfirmation([peerId], (checked) => {\n                this.managers.appChatsManager.addChatUser(id, peerId, checked.size ? undefined : 0)\n                .catch(onError);\n              });\n            }, 0);\n          }\n        });\n      }\n    }, {listenerSetter: this.listenerSetter});\n\n    // console.log('construct shared media time:', performance.now() - perf);\n  }\n\n  public async renderNewMessages(message: Message.message | Message.messageService) {\n    if(this.init) return; // * not inited yet\n\n    const {peerId} = message;\n    if(!historiesStorage[peerId]) return;\n\n    for(const mediaTab of this.searchSuper.mediaTabs) {\n      const inputFilter = mediaTab.inputFilter;\n      const history = historiesStorage[peerId][inputFilter];\n      if(!history) {\n        continue;\n      }\n\n      const filtered = this.searchSuper.filterMessagesByType([message], inputFilter).filter((message) => !history.find((m) => m.mid === message.mid && m.peerId === message.peerId));\n      if(filtered.length) {\n        history.unshift(...filtered.map((message) => ({mid: message.mid, peerId: message.peerId})));\n\n        if(this.peerId === peerId && this.searchSuper.usedFromHistory[inputFilter] !== -1) {\n          this.searchSuper.usedFromHistory[inputFilter] += filtered.length;\n          this.searchSuper.performSearchResult(filtered, mediaTab, false);\n        }\n      }\n    }\n  }\n\n  public deleteDeletedMessages(peerId: PeerId, mids: number[]) {\n    if(this.init) return; // * not inited yet\n\n    if(!historiesStorage[peerId]) return;\n\n    for(const mid of mids) {\n      for(const type of this.searchSuper.mediaTabs) {\n        const inputFilter = type.inputFilter;\n\n        const history = historiesStorage[peerId][inputFilter];\n        if(!history) continue;\n\n        const idx = history.findIndex((m) => m.mid === mid);\n        if(idx === -1) {\n          continue;\n        }\n\n        history.splice(idx, 1);\n\n        if(this.peerId === peerId) {\n          const container = this.searchSuper.tabs[inputFilter];\n          const div = container.querySelector(`[data-mid=\"${mid}\"][data-peer-id=\"${peerId}\"]`) as HTMLElement;\n          if(div) {\n            if(this.searchSuper.selection.isSelecting) {\n              this.searchSuper.selection.toggleByElement(div);\n            }\n\n            div.remove();\n          }\n\n          if(this.searchSuper.usedFromHistory[inputFilter] >= (idx + 1)) {\n            --this.searchSuper.usedFromHistory[inputFilter];\n          }\n        }\n\n        // can have element in different tabs somehow\n        // break;\n      }\n    }\n\n    this.scrollable.onScroll();\n  }\n\n  public async cleanupHTML() {\n    // const perf = performance.now();\n    this.profile.cleanupHTML();\n    this.editBtn.classList.add('hide');\n    this.searchSuper.cleanupHTML(true);\n    this.container.classList.toggle('can-add-members', await this.searchSuper.canViewMembers() && await this.managers.appChatsManager.hasRights(this.peerId.toChatId(), 'invite_users'));\n    // console.log('cleanupHTML shared media time:', performance.now() - perf);\n  }\n\n  public setLoadMutex(promise: Promise<any>) {\n    this.searchSuper.loadMutex = promise;\n  }\n\n  public setPeer(peerId: PeerId, threadId = 0) {\n    if(this.peerId === peerId && this.threadId === threadId) return false;\n\n    this.peerId = peerId;\n    this.threadId = threadId;\n    this.peerChanged = true;\n\n    if(this.init) {\n      this.init();\n      this.init = null;\n    }\n\n    this.searchSuper.setQuery({\n      peerId,\n      // threadId,\n      historyStorage: historiesStorage[peerId] ??= {}\n    });\n\n    this.profile.setPeer(peerId, threadId);\n\n    return true;\n  }\n\n  public async fillProfileElements() {\n    if(!this.peerChanged) {\n      return;\n    }\n\n    this.peerChanged = false;\n    await this.cleanupHTML();\n    await this.toggleEditBtn();\n    await this.profile.fillProfileElements();\n  }\n\n  private async toggleEditBtn() {\n    let show: boolean;\n    if(this.peerId.isUser()) {\n      show = this.peerId !== rootScope.myId && await this.managers.appUsersManager.isContact(this.peerId.toUserId());\n    } else {\n      show = await this.managers.appChatsManager.hasRights(this.peerId.toChatId(), 'change_info');\n    }\n\n    this.editBtn.classList.toggle('hide', !show);\n  }\n\n  public loadSidebarMedia(single: boolean, justLoad?: boolean) {\n    this.searchSuper.load(single, justLoad);\n  }\n\n  onOpenAfterTimeout() {\n    this.scrollable.onScroll();\n  }\n\n  public destroy() {\n    this.destroyable = true;\n    this.onCloseAfterTimeout();\n    this.profile.destroy();\n    this.searchSuper.destroy();\n  }\n}\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport rootScope from '../lib/rootScope';\r\n\r\nconst SetTransition = (\r\n  element: HTMLElement,\r\n  className: string,\r\n  forwards: boolean,\r\n  duration: number,\r\n  onTransitionEnd?: () => void,\r\n  useRafs?: number,\r\n  onTransitionStart?: () => void\r\n) => {\r\n  const {timeout, raf} = element.dataset;\r\n  if(timeout !== undefined) {\r\n    clearTimeout(+timeout);\r\n  }\r\n\r\n  // useRafs = undefined;\r\n  // duration = 0;\r\n\r\n  if(raf !== undefined) {\r\n    window.cancelAnimationFrame(+raf);\r\n    if(!useRafs) {\r\n      delete element.dataset.raf;\r\n    }\r\n  }\r\n\r\n  // if(forwards && className && element.classList.contains(className) && !element.classList.contains('animating')) {\r\n  //   return;\r\n  // }\r\n\r\n  if(useRafs && rootScope.settings.animationsEnabled && duration) {\r\n    element.dataset.raf = '' + window.requestAnimationFrame(() => {\r\n      delete element.dataset.raf;\r\n      SetTransition(element, className, forwards, duration, onTransitionEnd, useRafs - 1, onTransitionStart);\r\n    });\r\n\r\n    return;\r\n  }\r\n\r\n  if(forwards && className) {\r\n    element.classList.add(className);\r\n  }\r\n\r\n  const afterTimeout = () => {\r\n    delete element.dataset.timeout;\r\n    if(!forwards && className) {\r\n      element.classList.remove('backwards', className);\r\n    }\r\n\r\n    element.classList.remove('animating');\r\n\r\n    onTransitionEnd?.();\r\n  };\r\n\r\n  onTransitionStart?.();\r\n  if(!rootScope.settings.animationsEnabled || !duration) {\r\n    element.classList.remove('animating', 'backwards');\r\n    afterTimeout();\r\n    return;\r\n  }\r\n\r\n  element.classList.add('animating');\r\n\r\n  element.classList.toggle('backwards', !forwards);\r\n  element.dataset.timeout = '' + setTimeout(afterTimeout, duration);\r\n};\r\n\r\nexport default SetTransition;\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport {horizontalMenu} from './horizontalMenu';\r\nimport {TransitionSlider} from './transition';\r\nimport appNavigationController, {NavigationItem} from './appNavigationController';\r\nimport SliderSuperTab, {SliderSuperTabConstructable, SliderTab} from './sliderTab';\r\nimport {attachClickEvent} from '../helpers/dom/clickEvent';\r\nimport indexOfAndSplice from '../helpers/array/indexOfAndSplice';\r\nimport safeAssign from '../helpers/object/safeAssign';\r\nimport {AppManagers} from '../lib/appManagers/managers';\r\n\r\nconst TRANSITION_TIME = 250;\r\n\r\nexport type {SliderTab};\r\nexport {SliderSuperTab};\r\n\r\nexport default class SidebarSlider {\r\n  protected _selectTab: ReturnType<typeof horizontalMenu>;\r\n  public historyTabIds: (number | SliderSuperTab)[] = []; // * key is any, since right sidebar is ugly nowz\r\n  public tabsContainer: HTMLElement;\r\n  public sidebarEl: HTMLElement;\r\n  public tabs: Map<any, SliderTab>; // * key is any, since right sidebar is ugly now\r\n  private canHideFirst = false;\r\n  private navigationType: NavigationItem['type'];\r\n  protected managers: AppManagers;\r\n\r\n  constructor(options: {\r\n    sidebarEl: SidebarSlider['sidebarEl'],\r\n    tabs?: SidebarSlider['tabs'],\r\n    canHideFirst?: SidebarSlider['canHideFirst'],\r\n    navigationType: SidebarSlider['navigationType']\r\n  }) {\r\n    safeAssign(this, options);\r\n\r\n    if(!this.tabs) {\r\n      this.tabs = new Map();\r\n    }\r\n\r\n    this.tabsContainer = this.sidebarEl.querySelector('.sidebar-slider');\r\n    this._selectTab = TransitionSlider(this.tabsContainer, 'navigation', TRANSITION_TIME);\r\n    if(!this.canHideFirst) {\r\n      this._selectTab(0);\r\n    }\r\n\r\n    Array.from(this.sidebarEl.querySelectorAll('.sidebar-close-button') as any as HTMLElement[]).forEach((el) => {\r\n      attachClickEvent(el, this.onCloseBtnClick);\r\n    });\r\n  }\r\n\r\n  public onCloseBtnClick = () => {\r\n    const item = appNavigationController.findItemByType(this.navigationType);\r\n    if(item) {\r\n      appNavigationController.back(this.navigationType);\r\n    } else if(this.historyTabIds.length) {\r\n      this.closeTab(this.historyTabIds[this.historyTabIds.length - 1]);\r\n    }\r\n    // this.closeTab();\r\n  };\r\n\r\n  public closeTab = (id?: number | SliderSuperTab, animate?: boolean, isNavigation?: boolean) => {\r\n    if(id !== undefined && this.historyTabIds[this.historyTabIds.length - 1] !== id) {\r\n      return false;\r\n    }\r\n\r\n    // console.log('sidebar-close-button click:', this.historyTabIDs);\r\n    const closingId = this.historyTabIds.pop(); // pop current\r\n    this.onCloseTab(closingId, animate, isNavigation);\r\n\r\n    const tab = this.historyTabIds[this.historyTabIds.length - 1];\r\n    this._selectTab(tab !== undefined ? (tab instanceof SliderSuperTab ? tab.container : tab) : (this.canHideFirst ? -1 : 0), animate);\r\n    return true;\r\n  };\r\n\r\n  public selectTab(id: number | SliderSuperTab): boolean {\r\n    /* if(id instanceof SliderSuperTab) {\r\n      id = id.id;\r\n    } */\r\n\r\n    if(this.historyTabIds[this.historyTabIds.length - 1] === id) {\r\n      return false;\r\n    }\r\n\r\n    const tab: SliderTab = id instanceof SliderSuperTab ? id : this.tabs.get(id);\r\n    if(tab) {\r\n      if(tab.onOpen) {\r\n        tab.onOpen();\r\n      }\r\n\r\n      if(tab.onOpenAfterTimeout) {\r\n        setTimeout(() => {\r\n          tab.onOpenAfterTimeout();\r\n        }, TRANSITION_TIME);\r\n      }\r\n    }\r\n\r\n    // if(!this.canHideFirst || this.historyTabIds.length) {\r\n    appNavigationController.pushItem({\r\n      type: this.navigationType,\r\n      onPop: (canAnimate) => {\r\n        this.closeTab(undefined, canAnimate, true);\r\n        return true;\r\n      }\r\n    });\r\n    // }\r\n\r\n    this.historyTabIds.push(id);\r\n    this._selectTab(id instanceof SliderSuperTab ? id.container : id);\r\n    return true;\r\n  }\r\n\r\n  public removeTabFromHistory(id: number | SliderSuperTab) {\r\n    indexOfAndSplice(this.historyTabIds, id);\r\n    this.onCloseTab(id, undefined);\r\n  }\r\n\r\n  public sliceTabsUntilTab(tabConstructor: SliderSuperTabConstructable, preserveTab: SliderSuperTab) {\r\n    for(let i = this.historyTabIds.length - 1; i >= 0; --i) {\r\n      const tab = this.historyTabIds[i];\r\n      if(tab === preserveTab) continue;\r\n      else if(tab instanceof tabConstructor) {\r\n        break;\r\n      }\r\n\r\n      this.removeTabFromHistory(tab);\r\n      // appNavigationController.removeByType(this.navigationType, true);\r\n    }\r\n  }\r\n\r\n  public getTab<T extends SliderSuperTab>(tabConstructor: SliderSuperTabConstructable<T>) {\r\n    return this.historyTabIds.find((t) => t instanceof tabConstructor) as T;\r\n  }\r\n\r\n  public isTabExists(tabConstructor: SliderSuperTabConstructable) {\r\n    return !!this.getTab(tabConstructor);\r\n  }\r\n\r\n  protected onCloseTab(id: number | SliderSuperTab, animate: boolean, isNavigation?: boolean) {\r\n    if(!isNavigation) {\r\n      appNavigationController.removeByType(this.navigationType, true);\r\n    }\r\n\r\n    const tab: SliderTab = id instanceof SliderSuperTab ? id : this.tabs.get(id);\r\n    if(tab) {\r\n      if(tab.onClose) {\r\n        tab.onClose();\r\n      }\r\n\r\n      if(tab.onCloseAfterTimeout) {\r\n        setTimeout(() => {\r\n          tab.onCloseAfterTimeout();\r\n        }, TRANSITION_TIME + 30);\r\n      }\r\n    }\r\n  }\r\n\r\n  public addTab(tab: SliderSuperTab) {\r\n    if(!tab.container.parentElement) {\r\n      this.tabsContainer.append(tab.container);\r\n\r\n      if(tab.closeBtn) {\r\n        tab.closeBtn.addEventListener('click', this.onCloseBtnClick);\r\n      }\r\n    }\r\n  }\r\n\r\n  public createTab<T extends SliderSuperTab>(ctor: SliderSuperTabConstructable<T>, doNotAppend?: boolean) {\r\n    const tab = new ctor(doNotAppend ? undefined : this, true);\r\n    tab.managers = this.managers;\r\n    return tab;\r\n  }\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport EventListenerBase from '../helpers/eventListenerBase';\r\nimport ListenerSetter from '../helpers/listenerSetter';\r\nimport {AppManagers} from '../lib/appManagers/managers';\r\nimport {i18n, LangPackKey} from '../lib/langPack';\r\nimport ButtonIcon from './buttonIcon';\r\nimport Scrollable from './scrollable';\r\nimport SidebarSlider from './slider';\r\n\r\nexport interface SliderTab {\r\n  onOpen?: () => void,\r\n  onOpenAfterTimeout?: () => void,\r\n  onClose?: () => void,\r\n  onCloseAfterTimeout?: () => void\r\n}\r\n\r\nexport interface SliderSuperTabConstructable<T extends SliderSuperTab = any> {\r\n  new(slider: SidebarSlider, destroyable: boolean): T;\r\n}\r\n\r\nexport interface SliderSuperTabEventableConstructable {\r\n  new(slider: SidebarSlider, destroyable: boolean): SliderSuperTabEventable;\r\n}\r\n\r\nexport default class SliderSuperTab implements SliderTab {\r\n  public container: HTMLElement;\r\n\r\n  public header: HTMLElement;\r\n  public closeBtn: HTMLElement;\r\n  public title: HTMLElement;\r\n\r\n  public content: HTMLElement;\r\n  public scrollable: Scrollable;\r\n\r\n  public slider: SidebarSlider;\r\n  public destroyable: boolean;\r\n  public listenerSetter: ListenerSetter;\r\n\r\n  public managers: AppManagers;\r\n\r\n  constructor(slider: SidebarSlider, destroyable?: boolean) {\r\n    this._constructor(slider, destroyable);\r\n  }\r\n\r\n  public _constructor(slider: SidebarSlider, destroyable = true): any {\r\n    this.slider = slider;\r\n    this.destroyable = destroyable;\r\n\r\n    this.container = document.createElement('div');\r\n    this.container.classList.add('tabs-tab', 'sidebar-slider-item');\r\n\r\n    // * Header\r\n    this.header = document.createElement('div');\r\n    this.header.classList.add('sidebar-header');\r\n\r\n    this.closeBtn = ButtonIcon('left sidebar-close-button', {noRipple: true});\r\n    this.title = document.createElement('div');\r\n    this.title.classList.add('sidebar-header__title');\r\n    this.header.append(this.closeBtn, this.title);\r\n\r\n    // * Content\r\n    this.content = document.createElement('div');\r\n    this.content.classList.add('sidebar-content');\r\n\r\n    this.scrollable = new Scrollable(this.content, undefined, undefined, true);\r\n\r\n    this.container.append(this.header, this.content);\r\n\r\n    if(this.slider) {\r\n      this.slider.addTab(this);\r\n    }\r\n\r\n    this.listenerSetter = new ListenerSetter();\r\n  }\r\n\r\n  public close() {\r\n    return this.slider.closeTab(this);\r\n  }\r\n\r\n  public async open(...args: any[]) {\r\n    if(this.init) {\r\n      try {\r\n        const result = this.init();\r\n        this.init = null;\r\n\r\n        if(result instanceof Promise) {\r\n          await result;\r\n        }\r\n      } catch(err) {\r\n        console.error('open tab error', err);\r\n      }\r\n    }\r\n\r\n    this.slider.selectTab(this);\r\n  }\r\n\r\n  protected init(): Promise<any> | any {\r\n\r\n  }\r\n\r\n  public onCloseAfterTimeout() {\r\n    if(this.destroyable) { // ! WARNING,            !\r\n      this.slider.tabs.delete(this);\r\n      this.container.remove();\r\n      this.scrollable.destroy();\r\n      this.listenerSetter?.removeAll();\r\n    }\r\n  }\r\n\r\n  protected setTitle(key: LangPackKey) {\r\n    this.title.innerHTML = '';\r\n    this.title.append(i18n(key));\r\n  }\r\n}\r\n\r\nexport class SliderSuperTabEventable extends SliderSuperTab {\r\n  public eventListener: EventListenerBase<{\r\n    destroy: () => void\r\n  }>;\r\n\r\n  constructor(slider: SidebarSlider) {\r\n    super(slider);\r\n    this.eventListener = new EventListenerBase();\r\n  }\r\n\r\n  onCloseAfterTimeout() {\r\n    this.eventListener.dispatchEvent('destroy');\r\n    this.eventListener.cleanup();\r\n    return super.onCloseAfterTimeout();\r\n  }\r\n}\r\n\r\n/* // @ts-ignore\r\ninterface SliderSuperEventsTab extends SliderSuperTab, EventListenerBase<{}> {\r\n  superConstructor: (...args: any[]) => any;\r\n}\r\nclass SliderSuperEventsTab implements SliderSuperEventsTab {\r\n  constructor(slider: SidebarSlider) {\r\n    this.superConstructor([slider, true]);\r\n  }\r\n}\r\napplyMixins(SliderSuperEventsTab, [SliderSuperTab, EventListenerBase]);\r\n\r\n(window as any).lol = SliderSuperEventsTab\r\n\r\nexport {SliderSuperEventsTab}; */\r\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport appDialogsManager, {AppDialogsManager, DialogDom} from '../lib/appManagers/appDialogsManager';\nimport {getHeavyAnimationPromise} from '../hooks/useHeavyAnimationCheck';\nimport isInDOM from '../helpers/dom/isInDOM';\nimport positionElementByIndex from '../helpers/dom/positionElementByIndex';\nimport replaceContent from '../helpers/dom/replaceContent';\nimport {fastRaf} from '../helpers/schedulers';\nimport SortedList, {SortedElementBase} from '../helpers/sortedList';\nimport safeAssign from '../helpers/object/safeAssign';\nimport {AppManagers} from '../lib/appManagers/managers';\nimport getUserStatusString from './wrappers/getUserStatusString';\nimport type LazyLoadQueue from './lazyLoadQueue';\n\ninterface SortedUser extends SortedElementBase {\n  dom: DialogDom\n}\n\nexport default class SortedUserList extends SortedList<SortedUser> {\n  protected static SORT_INTERVAL = 30e3;\n  public list: HTMLUListElement;\n\n  protected lazyLoadQueue: LazyLoadQueue;\n  protected avatarSize = 48;\n  protected rippleEnabled = true;\n  protected autonomous = true;\n  protected createChatListOptions: Parameters<AppDialogsManager['createChatList']>[0];\n  protected onListLengthChange: () => void;\n  protected getIndex: (element: SortedUser) => number;\n  protected onUpdate: (element: SortedUser) => void;\n  protected managers: AppManagers;\n\n  constructor(options: Partial<{\n    lazyLoadQueue: SortedUserList['lazyLoadQueue'],\n    avatarSize: SortedUserList['avatarSize'],\n    rippleEnabled: SortedUserList['rippleEnabled'],\n    createChatListOptions: SortedUserList['createChatListOptions'],\n    autonomous: SortedUserList['autonomous'],\n    onListLengthChange: SortedUserList['onListLengthChange'],\n    getIndex: SortedUserList['getIndex'],\n    onUpdate: SortedUserList['onUpdate']\n  }> & {\n    managers: SortedUserList['managers']\n  }) {\n    super({\n      getIndex: options.getIndex || ((element) => this.managers.appUsersManager.getUserStatusForSort(element.id)),\n      onDelete: (element) => {\n        element.dom.listEl.remove();\n        this.onListLengthChange && this.onListLengthChange();\n      },\n      onUpdate: options.onUpdate || (async(element) => {\n        const status = getUserStatusString(await this.managers.appUsersManager.getUser(element.id));\n        replaceContent(element.dom.lastMessageSpan, status);\n      }),\n      onSort: (element, idx) => {\n        const willChangeLength = element.dom.listEl.parentElement !== this.list;\n        positionElementByIndex(element.dom.listEl, this.list, idx);\n\n        if(willChangeLength && this.onListLengthChange) {\n          this.onListLengthChange();\n        }\n      },\n      onElementCreate: (base) => {\n        const {dom} = appDialogsManager.addDialogNew({\n          peerId: base.id,\n          container: false,\n          avatarSize: this.avatarSize,\n          autonomous: this.autonomous,\n          meAsSaved: false,\n          rippleEnabled: this.rippleEnabled,\n          lazyLoadQueue: this.lazyLoadQueue\n        });\n\n        (base as SortedUser).dom = dom;\n        return base as SortedUser;\n      },\n      updateElementWith: fastRaf,\n      updateListWith: async(callback) => {\n        if(!isInDOM(this.list)) {\n          return callback(false);\n        }\n\n        await getHeavyAnimationPromise();\n\n        if(!isInDOM(this.list)) {\n          return callback(false);\n        }\n\n        callback(true);\n      }\n    });\n\n    safeAssign(this, options);\n\n    this.list = appDialogsManager.createChatList(this.createChatListOptions);\n\n    let timeout: number;\n    const doTimeout = () => {\n      timeout = window.setTimeout(() => {\n        this.updateList((good) => {\n          if(good) {\n            doTimeout();\n          }\n        });\n      }, SortedUserList.SORT_INTERVAL);\n    };\n\n    doTimeout();\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport AvatarElement from './avatar';\nimport type LazyLoadQueue from './lazyLoadQueue';\n\nconst CLASS_NAME = 'stacked-avatars';\nconst AVATAR_CLASS_NAME = CLASS_NAME + '-avatar';\nconst AVATAR_CONTAINER_CLASS_NAME = AVATAR_CLASS_NAME + '-container';\n\nexport default class StackedAvatars {\n  public container: HTMLElement;\n  private lazyLoadQueue: LazyLoadQueue;\n  private avatarSize: number;\n\n  constructor(options: {\n    lazyLoadQueue?: StackedAvatars['lazyLoadQueue'],\n    avatarSize: StackedAvatars['avatarSize']\n  }) {\n    this.lazyLoadQueue = options.lazyLoadQueue;\n    this.avatarSize = options.avatarSize;\n\n    this.container = document.createElement('div');\n    this.container.classList.add(CLASS_NAME);\n\n    this.container.style.setProperty('--avatar-size', options.avatarSize + 'px');\n  }\n  /**\n   * MACOS, ANDROID -  \n   * WINDOWS DESKTOP - \n   *       ,       , !\n   */\n  public render(peerIds: PeerId[], loadPromises?: Promise<any>[]) {\n    const children = this.container.children;\n    peerIds = peerIds.slice().reverse();\n    if(peerIds.length > 3) {\n      peerIds = peerIds.slice(-3);\n    }\n\n    peerIds.forEach((peerId, idx) => {\n      let avatarContainer = children[idx] as HTMLElement;\n      if(!avatarContainer) {\n        avatarContainer = document.createElement('div');\n        avatarContainer.classList.add(AVATAR_CONTAINER_CLASS_NAME);\n      }\n\n      let avatarElem = avatarContainer.firstElementChild as AvatarElement;\n      if(!avatarElem) {\n        avatarElem = new AvatarElement();\n        avatarElem.classList.add('avatar-' + this.avatarSize, AVATAR_CLASS_NAME);\n        avatarElem.updateOptions({\n          isDialog: false,\n          loadPromises\n        });\n      }\n\n      avatarElem.updateWithOptions({\n        lazyLoadQueue: this.lazyLoadQueue,\n        peerId: peerId\n      });\n\n      if(!avatarElem.parentNode) {\n        avatarContainer.append(avatarElem);\n      }\n\n      if(!avatarContainer.parentNode) {\n        this.container.append(avatarContainer);\n      }\n    });\n\n    // if were 3 and became 2\n    (Array.from(children) as HTMLElement[]).slice(peerIds.length).forEach((el) => el.remove());\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport IS_TOUCH_SUPPORTED from '../environment/touchSupport';\nimport cancelEvent from '../helpers/dom/cancelEvent';\nimport {simulateClickEvent, attachClickEvent} from '../helpers/dom/clickEvent';\nimport findUpAsChild from '../helpers/dom/findUpAsChild';\nimport findUpClassName from '../helpers/dom/findUpClassName';\nimport getVisibleRect from '../helpers/dom/getVisibleRect';\nimport ListenerSetter from '../helpers/listenerSetter';\nimport {makeMediaSize} from '../helpers/mediaSize';\nimport {getMiddleware, Middleware} from '../helpers/middleware';\nimport {doubleRaf} from '../helpers/schedulers';\nimport pause from '../helpers/schedulers/pause';\nimport windowSize from '../helpers/windowSize';\nimport {MyDocument} from '../lib/appManagers/appDocsManager';\nimport getStickerEffectThumb from '../lib/appManagers/utils/stickers/getStickerEffectThumb';\nimport wrapEmojiText from '../lib/richTextProcessor/wrapEmojiText';\nimport lottieLoader from '../lib/rlottie/lottieLoader';\nimport RLottiePlayer from '../lib/rlottie/rlottiePlayer';\nimport rootScope from '../lib/rootScope';\nimport animationIntersector, {AnimationItemGroup} from './animationIntersector';\nimport SetTransition from './singleTransition';\nimport {wrapSticker} from './wrappers';\nimport {STICKER_EFFECT_MULTIPLIER} from './wrappers/sticker';\n\nlet hasViewer = false;\nexport default function attachStickerViewerListeners({listenTo, listenerSetter, selector}: {\n  listenerSetter: ListenerSetter,\n  listenTo: HTMLElement,\n  selector?: string\n}) {\n  if(IS_TOUCH_SUPPORTED) {\n    return;\n  }\n\n  const findTarget = (e: MouseEvent, checkForParent?: boolean) => {\n    const s = selector || `.media-sticker-wrapper`;\n    const el = (e.target as HTMLElement).closest(s) as HTMLElement;\n    return el && (!checkForParent || findUpAsChild(el, listenTo)) ? el : undefined;\n  };\n\n  const managers = rootScope.managers;\n\n  listenerSetter.add(listenTo)('mousedown', (e) => {\n    if(hasViewer || e.buttons > 1 || e.button !== 0) return;\n    let mediaContainer = findTarget(e);\n    if(!mediaContainer) {\n      return;\n    }\n\n    // const img: HTMLImageElement = mediaContainer.querySelector('img.media-sticker');\n\n    const docId = mediaContainer.dataset.docId;\n    if(!docId) {\n      return;\n    }\n\n    const className = 'sticker-viewer';\n    const group: AnimationItemGroup = 'STICKER-VIEWER';\n    const openDuration = 200;\n    const switchDuration = 200;\n    const previousGroup = animationIntersector.getOnlyOnePlayableGroup();\n    const _middleware = getMiddleware();\n    let container: HTMLElement, previousTransformer: HTMLElement;\n\n    const doThatSticker = async({mediaContainer, doc, middleware, lockGroups, isSwitching}: {\n      mediaContainer: HTMLElement,\n      doc: MyDocument,\n      middleware: Middleware,\n      lockGroups?: boolean,\n      isSwitching?: boolean\n    }) => {\n      const effectThumb = getStickerEffectThumb(doc);\n      const mediaRect: DOMRect = mediaContainer.getBoundingClientRect();\n      const s = makeMediaSize(doc.w, doc.h);\n      const size = effectThumb ? 280 : 360;\n      const boxSize = makeMediaSize(size, size);\n      const fitted = mediaRect.width === mediaRect.height ? boxSize : s.aspectFitted(boxSize);\n\n      const bubble = findUpClassName(mediaContainer, 'bubble');\n      const isOut = bubble ? bubble.classList.contains('is-out') : true;\n\n      const transformer = document.createElement('div');\n      transformer.classList.add(className + '-transformer');\n\n      const stickerContainer = document.createElement('div');\n      stickerContainer.classList.add(className + '-sticker');\n      /* transformer.style.width =  */stickerContainer.style.width = fitted.width + 'px';\n      /* transformer.style.height =  */stickerContainer.style.height = fitted.height + 'px';\n\n      const stickerEmoji = document.createElement('div');\n      stickerEmoji.classList.add(className + '-emoji');\n      stickerEmoji.append(wrapEmojiText(doc.stickerEmojiRaw));\n\n      if(effectThumb) {\n        const margin = (size * STICKER_EFFECT_MULTIPLIER - size) / 3 * (isOut ? 1 : -1);\n        transformer.classList.add('has-effect');\n        // const property = `--margin-${isOut ? 'right' : 'left'}`;\n        // stickerContainer.style.setProperty(property, `${margin * 2}px`);\n        transformer.style.setProperty('--translateX', `${margin}px`);\n        stickerEmoji.style.setProperty('--translateX', `${-margin}px`);\n      }\n\n      const overflowElement = findUpClassName(mediaContainer, 'scrollable');\n      const visibleRect = getVisibleRect(mediaContainer, overflowElement, true, mediaRect);\n      if(visibleRect.overflow.vertical || visibleRect.overflow.horizontal) {\n        stickerContainer.classList.add('is-overflow');\n      }\n\n      // if(img) {\n      //   const ratio = img.naturalWidth / img.naturalHeight;\n      //   if((mediaRect.width / mediaRect.height).toFixed(1) !== ratio.toFixed(1)) {\n\n      //     mediaRect = mediaRect.toJSON();\n      //   }\n      // }\n\n      const rect = mediaContainer.getBoundingClientRect();\n      const scaleX = rect.width / fitted.width;\n      const scaleY = rect.height / fitted.height;\n      const transformX = rect.left - (windowSize.width - rect.width) / 2;\n      const transformY = rect.top - (windowSize.height - rect.height) / 2;\n      transformer.style.transform = `translate(${transformX}px, ${transformY}px) scale(${scaleX}, ${scaleY})`;\n      if(isSwitching) transformer.classList.add('is-switching');\n      transformer.append(stickerContainer, stickerEmoji);\n      container.append(transformer);\n\n      const o = await wrapSticker({\n        doc,\n        div: stickerContainer,\n        group,\n        width: fitted.width,\n        height: fitted.height,\n        play: false,\n        loop: true,\n        middleware,\n        managers,\n        needFadeIn: false,\n        isOut,\n        withThumb: false,\n        relativeEffect: true,\n        loopEffect: true\n      }).then(({render}) => render);\n      if(!middleware()) return;\n\n      if(!container.parentElement) {\n        document.body.append(container);\n      }\n\n      const player = Array.isArray(o) ? o[0] : o;\n\n      const firstFramePromise = player instanceof RLottiePlayer ?\n        new Promise<void>((resolve) => player.addEventListener('firstFrame', resolve, {once: true})) :\n        Promise.resolve();\n      await Promise.all([firstFramePromise, doubleRaf()]);\n      await pause(0); // ! need it because firstFrame will be called just from the loop\n      if(!middleware()) return;\n\n      if(lockGroups) {\n        animationIntersector.setOnlyOnePlayableGroup(group);\n        animationIntersector.checkAnimations(true);\n      }\n\n      if(player instanceof RLottiePlayer) {\n        const prevPlayer = lottieLoader.getAnimation(mediaContainer);\n        player.curFrame = prevPlayer.curFrame;\n        player.play();\n        await new Promise<void>((resolve) => {\n          let i = 0;\n          const c = () => {\n            if(++i === 2) {\n              resolve();\n              player.removeEventListener('enterFrame', c);\n            }\n          };\n\n          player.addEventListener('enterFrame', c);\n        });\n        if(!middleware()) return;\n        player.pause();\n      } else if(player instanceof HTMLVideoElement) {\n        player.currentTime = (mediaContainer.querySelector('video') as HTMLVideoElement).currentTime;\n      }\n\n      return {\n        ready: () => {\n          if(player instanceof RLottiePlayer || player instanceof HTMLVideoElement) {\n            player.play();\n          }\n\n          if(effectThumb) {\n            simulateClickEvent(stickerContainer);\n          }\n        },\n        transformer\n      };\n    };\n\n    const timeout = window.setTimeout(async() => {\n      document.removeEventListener('mousemove', onMousePreMove);\n\n      container = document.createElement('div');\n      container.classList.add(className);\n      hasViewer = true;\n\n      const middleware = _middleware.get();\n      const doc = await managers.appDocsManager.getDoc(docId);\n      if(!middleware()) return;\n\n      let result: Awaited<ReturnType<typeof doThatSticker>>;\n      try {\n        result = await doThatSticker({\n          doc,\n          mediaContainer,\n          middleware,\n          lockGroups: true\n        });\n        if(!result) return;\n      } catch(err) {\n        return;\n      }\n\n      const {ready, transformer} = result;\n\n      previousTransformer = transformer;\n\n      SetTransition(container, 'is-visible', true, openDuration, () => {\n        if(!middleware()) return;\n        ready();\n      });\n\n      document.addEventListener('mousemove', onMouseMove);\n    }, 125);\n\n    const onMouseMove = async(e: MouseEvent) => {\n      const newMediaContainer = findTarget(e, true);\n      if(!newMediaContainer || mediaContainer === newMediaContainer) {\n        return;\n      }\n\n      const docId = newMediaContainer.dataset.docId;\n      if(!docId) {\n        return;\n      }\n\n      mediaContainer = newMediaContainer;\n      _middleware.clean();\n      const middleware = _middleware.get();\n\n      const doc = await managers.appDocsManager.getDoc(docId);\n      if(!middleware()) return;\n\n      let r: Awaited<ReturnType<typeof doThatSticker>>;\n      try {\n        r = await doThatSticker({\n          doc,\n          mediaContainer,\n          middleware,\n          isSwitching: true\n        });\n        if(!r) return;\n      } catch(err) {\n        return;\n      }\n\n      const {ready, transformer} = r;\n\n      const _previousTransformer = previousTransformer;\n      SetTransition(_previousTransformer, 'is-switching', true, switchDuration, () => {\n        _previousTransformer.remove();\n      });\n\n      previousTransformer = transformer;\n\n      SetTransition(transformer, 'is-switching', false, switchDuration, () => {\n        if(!middleware()) return;\n        ready();\n      });\n    };\n\n    const onMousePreMove = (e: MouseEvent) => {\n      if(!findUpAsChild(e.target as HTMLElement, mediaContainer)) {\n        onMouseUp();\n      }\n    };\n\n    const onMouseUp = () => {\n      clearTimeout(timeout);\n      _middleware.clean();\n\n      if(container) {\n        SetTransition(container, 'is-visible', false, openDuration, () => {\n          container.remove();\n          animationIntersector.setOnlyOnePlayableGroup(previousGroup);\n          animationIntersector.checkAnimations(false);\n          hasViewer = false;\n        });\n\n        attachClickEvent(document.body, cancelEvent, {capture: true, once: true});\n      }\n\n      document.removeEventListener('mousemove', onMousePreMove);\n      document.removeEventListener('mousemove', onMouseMove);\n      document.removeEventListener('mouseup', onMouseUp, {capture: true});\n    };\n\n    document.addEventListener('mousemove', onMousePreMove);\n    document.addEventListener('mouseup', onMouseUp, {once: true, capture: true});\n  });\n}\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nexport default class StickyIntersector {\r\n  private headersObserver: IntersectionObserver;\r\n  private elementsObserver: IntersectionObserver;\r\n\r\n  constructor(private container: HTMLElement, private handler: (stuck: boolean, target: HTMLElement) => void) {\r\n    this.observeHeaders();\r\n    this.observeElements();\r\n  }\r\n\r\n  /**\r\n   * Sets up an intersection observer to notify when elements with the class\r\n   * `.sticky_sentinel--top` become visible/invisible at the top of the container.\r\n   * @param {!Element} container\r\n   */\r\n  private observeHeaders() {\r\n    this.headersObserver = new IntersectionObserver((entries) => {\r\n      for(const entry of entries) {\r\n        const targetInfo = entry.boundingClientRect;\r\n        const stickyTarget = entry.target.parentElement;\r\n        const rootBoundsInfo = entry.rootBounds;\r\n\r\n        // Started sticking.\r\n        if(targetInfo.bottom < rootBoundsInfo.top) {\r\n          this.handler(true, stickyTarget);\r\n        }\r\n\r\n        // Stopped sticking.\r\n        if(targetInfo.bottom >= rootBoundsInfo.top &&\r\n            targetInfo.bottom < rootBoundsInfo.bottom) {\r\n          this.handler(false, stickyTarget);\r\n        }\r\n      }\r\n    }, {threshold: 0, root: this.container});\r\n  }\r\n\r\n  private observeElements() {\r\n    this.elementsObserver = new IntersectionObserver((entries) => {\r\n      const entry = entries\r\n      .filter((entry) => entry.boundingClientRect.top < entry.rootBounds.top)\r\n      .sort((a, b) => a.boundingClientRect.top - b.boundingClientRect.top)[0];\r\n      if(!entry) return;\r\n\r\n      const container = entry.isIntersecting ? entry.target : entry.target.nextElementSibling;\r\n      this.handler(true, container as HTMLElement);\r\n    }, {root: this.container});\r\n  }\r\n\r\n  /**\r\n   * @param {!Element} container\r\n   * @param {string} className\r\n   */\r\n  private addSentinel(container: HTMLElement, className: string) {\r\n    const sentinel = document.createElement('div');\r\n    sentinel.classList.add('sticky_sentinel', className);\r\n    return container.appendChild(sentinel);\r\n  }\r\n\r\n  /**\r\n   * Notifies when elements w/ the `sticky` class begin to stick or stop sticking.\r\n   * Note: the elements should be children of `container`.\r\n   * @param {!Element} container\r\n   */\r\n  public observeStickyHeaderChanges(element: HTMLElement) {\r\n    const headerSentinel = this.addSentinel(element, 'sticky_sentinel--top');\r\n    this.headersObserver.observe(headerSentinel);\r\n\r\n    this.elementsObserver.observe(element);\r\n  }\r\n\r\n  public disconnect() {\r\n    this.headersObserver.disconnect();\r\n    this.elementsObserver.disconnect();\r\n  }\r\n\r\n  public unobserve(element: HTMLElement, headerSentinel: HTMLElement) {\r\n    this.elementsObserver.unobserve(element);\r\n    this.headersObserver.unobserve(headerSentinel);\r\n  }\r\n}\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport cancelEvent from '../helpers/dom/cancelEvent';\r\nimport IS_TOUCH_SUPPORTED from '../environment/touchSupport';\r\nimport safeAssign from '../helpers/object/safeAssign';\r\nimport contextMenuController from '../helpers/contextMenuController';\r\n\r\nconst getEvent = (e: TouchEvent | MouseEvent) => {\r\n  return (e as TouchEvent).touches ? (e as TouchEvent).touches[0] : e as MouseEvent;\r\n};\r\n\r\nconst attachGlobalListenerTo = window;\r\n\r\nlet RESET_GLOBAL = false;\r\ncontextMenuController.addEventListener('toggle', (visible) => {\r\n  RESET_GLOBAL = visible;\r\n});\r\n\r\nexport type SwipeHandlerOptions = {\r\n  element: SwipeHandler['element'],\r\n  onSwipe: SwipeHandler['onSwipe'],\r\n  verifyTouchTarget?: SwipeHandler['verifyTouchTarget'],\r\n  onFirstSwipe?: SwipeHandler['onFirstSwipe'],\r\n  onReset?: SwipeHandler['onReset'],\r\n  cursor?: SwipeHandler['cursor'],\r\n  cancelEvent?: SwipeHandler['cancelEvent'],\r\n  listenerOptions?: SwipeHandler['listenerOptions']\r\n};\r\n\r\nexport default class SwipeHandler {\r\n  private element: HTMLElement;\r\n  private onSwipe: (xDiff: number, yDiff: number, e: TouchEvent | MouseEvent) => boolean | void;\r\n  private verifyTouchTarget: (evt: TouchEvent | MouseEvent) => boolean | Promise<boolean>;\r\n  private onFirstSwipe: () => void;\r\n  private onReset: () => void;\r\n  private cursor: 'grabbing' | 'move' | 'row-resize' | 'col-resize' | 'nesw-resize' | 'nwse-resize' | 'ne-resize' | 'se-resize' | 'sw-resize' | 'nw-resize' | 'n-resize' | 'e-resize' | 's-resize' | 'w-resize' | '' = 'grabbing';\r\n  private cancelEvent = true;\r\n  private listenerOptions: boolean | AddEventListenerOptions = false;\r\n  private setCursorTo: HTMLElement;\r\n\r\n  private hadMove = false;\r\n  private xDown: number = null;\r\n  private yDown: number = null;\r\n\r\n  constructor(options: SwipeHandlerOptions) {\r\n    safeAssign(this, options);\r\n\r\n    this.setCursorTo = this.element;\r\n\r\n    this.setListeners();\r\n  }\r\n\r\n  public setListeners() {\r\n    if(!IS_TOUCH_SUPPORTED) {\r\n      this.element.addEventListener('mousedown', this.handleStart, this.listenerOptions);\r\n      attachGlobalListenerTo.addEventListener('mouseup', this.reset);\r\n    } else {\r\n      this.element.addEventListener('touchstart', this.handleStart, this.listenerOptions);\r\n      attachGlobalListenerTo.addEventListener('touchend', this.reset);\r\n    }\r\n  }\r\n\r\n  public removeListeners() {\r\n    if(!IS_TOUCH_SUPPORTED) {\r\n      this.element.removeEventListener('mousedown', this.handleStart, this.listenerOptions);\r\n      attachGlobalListenerTo.removeEventListener('mouseup', this.reset);\r\n    } else {\r\n      this.element.removeEventListener('touchstart', this.handleStart, this.listenerOptions);\r\n      attachGlobalListenerTo.removeEventListener('touchend', this.reset);\r\n    }\r\n  }\r\n\r\n  public setCursor(cursor: SwipeHandler['cursor']) {\r\n    this.cursor = cursor;\r\n\r\n    if(!IS_TOUCH_SUPPORTED && this.hadMove) {\r\n      this.setCursorTo.style.setProperty('cursor', this.cursor, 'important');\r\n    }\r\n  }\r\n\r\n  reset = (e?: Event) => {\r\n    /* if(e) {\r\n      cancelEvent(e);\r\n    } */\r\n\r\n    if(IS_TOUCH_SUPPORTED) {\r\n      attachGlobalListenerTo.removeEventListener('touchmove', this.handleMove, {capture: true});\r\n    } else {\r\n      attachGlobalListenerTo.removeEventListener('mousemove', this.handleMove);\r\n      this.setCursorTo.style.cursor = '';\r\n    }\r\n\r\n    if(this.onReset && this.hadMove) {\r\n      this.onReset();\r\n    }\r\n\r\n    this.xDown = this.yDown = null;\r\n    this.hadMove = false;\r\n  };\r\n\r\n  handleStart = async(_e: TouchEvent | MouseEvent) => {\r\n    const e = getEvent(_e);\r\n    if(this.verifyTouchTarget && !(await this.verifyTouchTarget(_e))) {\r\n      return this.reset();\r\n    }\r\n\r\n    this.xDown = e.clientX;\r\n    this.yDown = e.clientY;\r\n\r\n    if(IS_TOUCH_SUPPORTED) {\r\n      attachGlobalListenerTo.addEventListener('touchmove', this.handleMove, {passive: false, capture: true});\r\n    } else {\r\n      attachGlobalListenerTo.addEventListener('mousemove', this.handleMove, false);\r\n    }\r\n  };\r\n\r\n  handleMove = (_e: TouchEvent | MouseEvent) => {\r\n    if(this.xDown === null || this.yDown === null || RESET_GLOBAL) {\r\n      this.reset();\r\n      return;\r\n    }\r\n\r\n    if(this.cancelEvent) {\r\n      cancelEvent(_e);\r\n    }\r\n\r\n    const e = getEvent(_e);\r\n    const xUp = e.clientX;\r\n    const yUp = e.clientY;\r\n\r\n    const xDiff = this.xDown - xUp;\r\n    const yDiff = this.yDown - yUp;\r\n\r\n    if(!this.hadMove) {\r\n      if(!xDiff && !yDiff) {\r\n        return;\r\n      }\r\n\r\n      this.hadMove = true;\r\n\r\n      if(!IS_TOUCH_SUPPORTED) {\r\n        this.setCursorTo.style.setProperty('cursor', this.cursor, 'important');\r\n      }\r\n\r\n      if(this.onFirstSwipe) {\r\n        this.onFirstSwipe();\r\n      }\r\n    }\r\n\r\n    // if(Math.abs(xDiff) > Math.abs(yDiff)) { /*most significant*/\r\n    //   if(xDiff > 0) { /* left swipe */\r\n\r\n    //   } else { /* right swipe */\r\n\r\n    //   }\r\n    // } else {\r\n    //   if(yDiff > 0) { /* up swipe */\r\n\r\n    //   } else { /* down swipe */\r\n\r\n    //   }\r\n    // }\r\n\r\n    /* reset values */\r\n    const onSwipeResult = this.onSwipe(xDiff, yDiff, _e);\r\n    if(onSwipeResult !== undefined && onSwipeResult) {\r\n      this.reset();\r\n    }\r\n  };\r\n}\r\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport placeCaretAtEnd from '../helpers/dom/placeCaretAtEnd';\nimport {formatPhoneNumber} from '../helpers/formatPhoneNumber';\nimport {IS_APPLE, IS_ANDROID, IS_APPLE_MOBILE} from '../environment/userAgent';\nimport {HelpCountry, HelpCountryCode} from '../layer';\nimport InputField, {InputFieldOptions} from './inputField';\n\nexport default class TelInputField extends InputField {\n  private pasted = false;\n  public lastValue = '';\n\n  constructor(options: InputFieldOptions & {\n    onInput?: (formatted: ReturnType<typeof formatPhoneNumber>) => void\n  } = {}) {\n    super({\n      label: 'Contacts.PhoneNumber.Placeholder',\n      // plainText: true,\n      name: 'phone',\n      ...options\n    });\n\n    this.container.classList.add('input-field-phone');\n\n    const telEl = this.input;\n    if(telEl instanceof HTMLInputElement) {\n      telEl.type = 'tel';\n      telEl.autocomplete = 'rr55RandomRR55';\n    } else {\n      telEl.inputMode = 'decimal';\n\n      const pixelRatio = window.devicePixelRatio;\n      if(pixelRatio > 1) {\n        let letterSpacing: number;\n        if(IS_APPLE) {\n          letterSpacing = pixelRatio * -.16;\n        } else if(IS_ANDROID) {\n          letterSpacing = 0;\n        }\n\n        telEl.style.setProperty('--letter-spacing', letterSpacing + 'px');\n      }\n\n      const originalFunc = this.setValueSilently.bind(this);\n      this.setValueSilently = (value) => {\n        originalFunc(value);\n        placeCaretAtEnd(this.input, true);\n      };\n    }\n\n    telEl.addEventListener('input', () => {\n      // console.log('input', this.value);\n      telEl.classList.remove('error');\n\n      const value = this.value;\n      const diff = Math.abs(value.length - this.lastValue.length);\n      if(diff > 1 && !this.pasted && IS_APPLE_MOBILE) {\n        this.setValueSilently(this.lastValue + value);\n      }\n\n      this.pasted = false;\n\n      this.setLabel();\n\n      let formattedPhoneNumber: ReturnType<typeof formatPhoneNumber>;\n      let formatted: string, country: HelpCountry, countryCode: HelpCountryCode, leftPattern = '';\n      if(this.value.replace(/\\++/, '+') === '+') {\n        this.setValueSilently('+');\n      } else {\n        formattedPhoneNumber = formatPhoneNumber(this.value);\n        formatted = formattedPhoneNumber.formatted;\n        country = formattedPhoneNumber.country;\n        leftPattern = formattedPhoneNumber.leftPattern;\n        countryCode = formattedPhoneNumber.code;\n        this.setValueSilently(this.lastValue = formatted ? '+' + formatted : '');\n      }\n\n      telEl.dataset.leftPattern = leftPattern/* .replace(/X/g, '0') */;\n\n      // console.log(formatted, country);\n\n      options.onInput && options.onInput(formattedPhoneNumber);\n    });\n\n    telEl.addEventListener('paste', () => {\n      this.pasted = true;\n      // console.log('paste', telEl.value);\n    });\n\n    /* telEl.addEventListener('change', (e) => {\n      console.log('change', telEl.value);\n    }); */\n\n    telEl.addEventListener('keypress', (e) => {\n      // console.log('keypress', this.value);\n      const key = e.key;\n      if(/\\D/.test(key) && !(e.metaKey || e.ctrlKey) && key !== 'Backspace' && !(key === '+' && e.shiftKey/*  && !this.value */)) {\n        e.preventDefault();\n        return false;\n      }\n    });\n\n    /* telEl.addEventListener('focus', function(this: typeof telEl, e) {\n      this.removeAttribute('readonly'); // fix autocomplete\n    });*/\n  }\n}\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport replaceContent from '../helpers/dom/replaceContent';\r\nimport OverlayClickHandler from '../helpers/overlayClickHandler';\r\nimport {FormatterArguments, i18n, LangPackKey} from '../lib/langPack';\r\n\r\nconst toastEl = document.createElement('div');\r\ntoastEl.classList.add('toast');\r\nlet timeout: number;\r\n\r\nconst x = new OverlayClickHandler('toast');\r\nx.addEventListener('toggle', (open) => {\r\n  if(!open) {\r\n    hideToast();\r\n  }\r\n});\r\n\r\nexport function hideToast() {\r\n  x.close();\r\n\r\n  toastEl.classList.remove('is-visible');\r\n  timeout && clearTimeout(+timeout);\r\n\r\n  timeout = window.setTimeout(() => {\r\n    toastEl.remove();\r\n    timeout = undefined;\r\n  }, 200);\r\n}\r\n\r\nexport function toast(content: string | Node, onClose?: () => void) {\r\n  x.close();\r\n\r\n  replaceContent(toastEl, content);\r\n\r\n  if(!toastEl.parentElement) {\r\n    document.body.append(toastEl);\r\n    void toastEl.offsetLeft; // reflow\r\n  }\r\n\r\n  toastEl.classList.add('is-visible');\r\n\r\n  timeout && clearTimeout(+timeout);\r\n  x.open(toastEl);\r\n\r\n  timeout = window.setTimeout(hideToast, 3000);\r\n\r\n  if(onClose) {\r\n    x.addEventListener('toggle', onClose, {once: true});\r\n  }\r\n}\r\n\r\nexport function toastNew(options: Partial<{\r\n  langPackKey: LangPackKey,\r\n  langPackArguments: FormatterArguments,\r\n  onClose: () => void\r\n}>) {\r\n  toast(i18n(options.langPackKey, options.langPackArguments), options.onClose);\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport rootScope from '../lib/rootScope';\r\nimport deferredPromise, {CancellablePromise} from '../helpers/cancellablePromise';\r\nimport {dispatchHeavyAnimationEvent} from '../hooks/useHeavyAnimationCheck';\r\nimport whichChild from '../helpers/dom/whichChild';\r\nimport cancelEvent from '../helpers/dom/cancelEvent';\r\nimport ListenerSetter from '../helpers/listenerSetter';\r\n\r\nfunction slideNavigation(tabContent: HTMLElement, prevTabContent: HTMLElement, toRight: boolean) {\r\n  const width = prevTabContent.getBoundingClientRect().width;\r\n  const elements = [tabContent, prevTabContent];\r\n  if(toRight) elements.reverse();\r\n  elements[0].style.filter = `brightness(80%)`;\r\n  elements[0].style.transform = `translate3d(${-width * .25}px, 0, 0)`;\r\n  elements[1].style.transform = `translate3d(${width}px, 0, 0)`;\r\n\r\n  tabContent.classList.add('active');\r\n  void tabContent.offsetWidth; // reflow\r\n\r\n  tabContent.style.transform = '';\r\n  tabContent.style.filter = '';\r\n\r\n  return () => {\r\n    prevTabContent.style.transform = prevTabContent.style.filter = '';\r\n  };\r\n}\r\n\r\nfunction slideTabs(tabContent: HTMLElement, prevTabContent: HTMLElement, toRight: boolean) {\r\n  // Jolly Cobra's // Workaround for scrollable content flickering during animation.\r\n  // const scrollableContainer = findUpClassName(tabContent, 'scrollable-y');\r\n  // if(scrollableContainer && scrollableContainer.style.overflowY !== 'hidden') {\r\n  //   // const scrollBarWidth = scrollableContainer.offsetWidth - scrollableContainer.clientWidth;\r\n  //   scrollableContainer.style.overflowY = 'hidden';\r\n  //   // scrollableContainer.style.paddingRight = `${scrollBarWidth}px`;\r\n  //   // this.container.classList.add('sliding');\r\n  // }\r\n\r\n  // window.requestAnimationFrame(() => {\r\n  const width = prevTabContent.getBoundingClientRect().width;\r\n  /* tabContent.style.setProperty('--width', width + 'px');\r\n    prevTabContent.style.setProperty('--width', width + 'px');\r\n\r\n    tabContent.classList.add('active'); */\r\n  // void tabContent.offsetWidth; // reflow\r\n  const elements = [tabContent, prevTabContent];\r\n  if(toRight) elements.reverse();\r\n  elements[0].style.transform = `translate3d(${-width}px, 0, 0)`;\r\n  elements[1].style.transform = `translate3d(${width}px, 0, 0)`;\r\n\r\n  tabContent.classList.add('active');\r\n  void tabContent.offsetWidth; // reflow\r\n\r\n  tabContent.style.transform = '';\r\n  // });\r\n\r\n  return () => {\r\n    prevTabContent.style.transform = '';\r\n\r\n    // if(scrollableContainer) {\r\n    //   // Jolly Cobra's // Workaround for scrollable content flickering during animation.\r\n    //   if(isSafari) { // ! safari doesn't respect sticky header, so it flicks when overflow is changing\r\n    //     scrollableContainer.style.display = 'none';\r\n    //   }\r\n\r\n    //   scrollableContainer.style.overflowY = '';\r\n\r\n    //   if(isSafari) {\r\n    //     void scrollableContainer.offsetLeft; // reflow\r\n    //     scrollableContainer.style.display = '';\r\n    //   }\r\n\r\n    //   // scrollableContainer.style.paddingRight = '0';\r\n    //   // this.container.classList.remove('sliding');\r\n    // }\r\n  };\r\n}\r\n\r\nexport const TransitionSlider = (\r\n  content: HTMLElement,\r\n  type: 'tabs' | 'navigation' | 'zoom-fade' | 'slide-fade' | 'none'/*  | 'counter' */,\r\n  transitionTime: number,\r\n  onTransitionEnd?: (id: number) => void,\r\n  isHeavy = true,\r\n  listenerSetter?: ListenerSetter\r\n) => {\r\n  let animationFunction: TransitionFunction = null;\r\n\r\n  switch(type) {\r\n    case 'tabs':\r\n      animationFunction = slideTabs;\r\n      break;\r\n    case 'navigation':\r\n      animationFunction = slideNavigation;\r\n      break;\r\n    /* default:\r\n      break; */\r\n  }\r\n\r\n  content.dataset.animation = type;\r\n\r\n  return Transition(content, animationFunction, transitionTime, onTransitionEnd, isHeavy, undefined, undefined, listenerSetter);\r\n};\r\n\r\ntype TransitionFunction = (tabContent: HTMLElement, prevTabContent: HTMLElement, toRight: boolean) => void | (() => void);\r\n\r\nconst Transition = (\r\n  content: HTMLElement,\r\n  animationFunction: TransitionFunction,\r\n  transitionTime: number,\r\n  onTransitionEnd?: (id: number) => void,\r\n  isHeavy = true,\r\n  once = false,\r\n  withAnimationListener = true,\r\n  listenerSetter?: ListenerSetter\r\n) => {\r\n  const onTransitionEndCallbacks: Map<HTMLElement, Function> = new Map();\r\n  let animationDeferred: CancellablePromise<void>;\r\n  // let animationStarted = 0;\r\n  let from: HTMLElement = null;\r\n\r\n  if(withAnimationListener) {\r\n    const listenerName = animationFunction ? 'transitionend' : 'animationend';\r\n\r\n    const onEndEvent = (e: TransitionEvent | AnimationEvent) => {\r\n      cancelEvent(e);\r\n\r\n      if((e.target as HTMLElement).parentElement !== content) {\r\n        return;\r\n      }\r\n\r\n      // console.log('Transition: transitionend', /* content, */ e, selectTab.prevId, performance.now() - animationStarted);\r\n\r\n      const callback = onTransitionEndCallbacks.get(e.target as HTMLElement);\r\n      callback?.();\r\n\r\n      if(e.target !== from) {\r\n        return;\r\n      }\r\n\r\n      if(!animationDeferred && isHeavy) return;\r\n\r\n      if(animationDeferred) {\r\n        animationDeferred.resolve();\r\n        animationDeferred = undefined;\r\n      }\r\n\r\n      if(onTransitionEnd) {\r\n        onTransitionEnd(selectTab.prevId());\r\n      }\r\n\r\n      content.classList.remove('animating', 'backwards', 'disable-hover');\r\n\r\n      if(once) {\r\n        if(listenerSetter) listenerSetter.removeManual(content, listenerName, onEndEvent);\r\n        else content.removeEventListener(listenerName, onEndEvent/* , {capture: false} */);\r\n        from = animationDeferred = undefined;\r\n        onTransitionEndCallbacks.clear();\r\n      }\r\n    };\r\n\r\n    // TODO: check for transition type (transform, etc) using by animationFunction\r\n    if(listenerSetter) listenerSetter.add(content)(listenerName, onEndEvent);\r\n    else content.addEventListener(listenerName, onEndEvent/* , {passive: true, capture: false} */);\r\n  }\r\n\r\n  function selectTab(id: number | HTMLElement, animate = true, overrideFrom?: typeof from) {\r\n    if(overrideFrom) {\r\n      from = overrideFrom;\r\n    }\r\n\r\n    if(id instanceof HTMLElement) {\r\n      id = whichChild(id);\r\n    }\r\n\r\n    const prevId = selectTab.prevId();\r\n    if(id === prevId) return false;\r\n\r\n    // console.log('selectTab id:', id);\r\n\r\n    const to = content.children[id] as HTMLElement;\r\n\r\n    if(!rootScope.settings.animationsEnabled || prevId === -1) {\r\n      animate = false;\r\n    }\r\n\r\n    if(!withAnimationListener) {\r\n      const timeout = content.dataset.timeout;\r\n      if(timeout !== undefined) {\r\n        clearTimeout(+timeout);\r\n      }\r\n\r\n      delete content.dataset.timeout;\r\n    }\r\n\r\n    if(!animate) {\r\n      if(from) from.classList.remove('active', 'to', 'from');\r\n      else if(to) { // fix instant opening back from closed slider (e.g. instant closening and opening right sidebar)\r\n        const callback = onTransitionEndCallbacks.get(to);\r\n        callback?.();\r\n      }\r\n\r\n      if(to) {\r\n        to.classList.remove('to', 'from');\r\n        to.classList.add('active');\r\n      }\r\n\r\n      content.classList.remove('animating', 'backwards', 'disable-hover');\r\n\r\n      from = to;\r\n\r\n      if(onTransitionEnd) onTransitionEnd(id);\r\n      return;\r\n    }\r\n\r\n    if(!withAnimationListener) {\r\n      content.dataset.timeout = '' + window.setTimeout(() => {\r\n        to.classList.remove('to');\r\n        from && from.classList.remove('from');\r\n        content.classList.remove('animating', 'backwards', 'disable-hover');\r\n        delete content.dataset.timeout;\r\n      }, transitionTime);\r\n    }\r\n\r\n    if(from) {\r\n      from.classList.remove('to');\r\n      from.classList.add('from');\r\n    }\r\n\r\n    content.classList.add('animating'/* , 'disable-hover' */);\r\n    const toRight = prevId < id;\r\n    content.classList.toggle('backwards', !toRight);\r\n\r\n    let onTransitionEndCallback: ReturnType<TransitionFunction>;\r\n    if(!to) {\r\n      // prevTabContent.classList.remove('active');\r\n    } else {\r\n      if(animationFunction) {\r\n        onTransitionEndCallback = animationFunction(to, from, toRight);\r\n      } else {\r\n        to.classList.add('active');\r\n      }\r\n\r\n      to.classList.remove('from');\r\n      to.classList.add('to');\r\n    }\r\n\r\n    if(to) {\r\n      onTransitionEndCallbacks.set(to, () => {\r\n        to.classList.remove('to');\r\n        onTransitionEndCallbacks.delete(to);\r\n      });\r\n    }\r\n\r\n    if(from/*  && false */) {\r\n      let timeout: number;\r\n      const _from = from;\r\n      const callback = () => {\r\n        clearTimeout(timeout);\r\n        _from.classList.remove('active', 'from');\r\n\r\n        if(onTransitionEndCallback) {\r\n          onTransitionEndCallback?.();\r\n        }\r\n\r\n        onTransitionEndCallbacks.delete(_from);\r\n      };\r\n\r\n      if(to) {\r\n        timeout = window.setTimeout(callback, transitionTime + 100); // something happened to container\r\n        onTransitionEndCallbacks.set(_from, callback);\r\n      } else {\r\n        timeout = window.setTimeout(callback, transitionTime);\r\n        onTransitionEndCallbacks.set(_from, () => {\r\n          clearTimeout(timeout);\r\n          onTransitionEndCallbacks.delete(_from);\r\n        });\r\n      }\r\n\r\n      if(isHeavy) {\r\n        if(!animationDeferred) {\r\n          animationDeferred = deferredPromise<void>();\r\n          // animationStarted = performance.now();\r\n        }\r\n\r\n        dispatchHeavyAnimationEvent(animationDeferred, transitionTime * 2);\r\n      }\r\n    }\r\n\r\n    from = to;\r\n  }\r\n\r\n  // selectTab.prevId = -1;\r\n  selectTab.prevId = () => from ? whichChild(from) : -1;\r\n  selectTab.getFrom = () => from;\r\n  selectTab.setFrom = (_from: HTMLElement) => from = _from;\r\n\r\n  return selectTab;\r\n};\r\n\r\nexport default Transition;\r\n","export default function isUsernameValid(username: string) {\n  return ((username.length >= 5 && username.length <= 32) || !username.length) && /^[a-zA-Z0-9_]*$/.test(username);\n}\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport ListenerSetter from '../helpers/listenerSetter';\r\nimport debounce from '../helpers/schedulers/debounce';\r\nimport {LangPackKey} from '../lib/langPack';\r\nimport InputField, {InputFieldOptions, InputState} from './inputField';\r\nimport isUsernameValid from '../lib/richTextProcessor/isUsernameValid';\r\nimport {AppManagers} from '../lib/appManagers/managers';\r\n\r\nexport class UsernameInputField extends InputField {\r\n  private checkUsernamePromise: Promise<any>;\r\n  private checkUsernameDebounced: (username: string) => void;\r\n  public options: InputFieldOptions & {\r\n    peerId?: PeerId,\r\n    listenerSetter: ListenerSetter,\r\n    onChange?: () => void,\r\n    invalidText: LangPackKey,\r\n    takenText: LangPackKey,\r\n    availableText: LangPackKey,\r\n    head?: string\r\n  };\r\n\r\n  constructor(\r\n    options: UsernameInputField['options'],\r\n    private managers: AppManagers\r\n  ) {\r\n    super(options);\r\n\r\n    this.checkUsernameDebounced = debounce(this.checkUsername.bind(this), 150, false, true);\r\n\r\n    options.listenerSetter.add(this.input)('input', () => {\r\n      const value = this.getValue();\r\n\r\n      // console.log('userNameInput:', value);\r\n      if(value === this.originalValue || !value.length) {\r\n        this.setState(InputState.Neutral);\r\n        this.options.onChange && this.options.onChange();\r\n        return;\r\n      } else if(!isUsernameValid(value)) { // does not check the last underscore\r\n        this.setError(this.options.invalidText);\r\n      } else {\r\n        this.setState(InputState.Neutral);\r\n      }\r\n\r\n      if(this.input.classList.contains('error')) {\r\n        this.options.onChange && this.options.onChange();\r\n        return;\r\n      }\r\n\r\n      this.checkUsernameDebounced(value);\r\n    });\r\n  }\r\n\r\n  public getValue() {\r\n    let value = this.value;\r\n    if(this.options.head) {\r\n      value = value.slice(this.options.head.length);\r\n      this.setValueSilently(this.options.head + value);\r\n    }\r\n\r\n    return value;\r\n  }\r\n\r\n  private checkUsername(username: string) {\r\n    if(this.checkUsernamePromise) return;\r\n\r\n    if(this.options.peerId) {\r\n      this.checkUsernamePromise = this.managers.appChatsManager.checkUsername(this.options.peerId.toChatId(), username);\r\n    } else {\r\n      this.checkUsernamePromise = this.managers.appUsersManager.checkUsername(username);\r\n    }\r\n\r\n    this.checkUsernamePromise.then((available) => {\r\n      if(this.getValue() !== username) return;\r\n\r\n      if(available) {\r\n        this.setState(InputState.Valid, this.options.availableText);\r\n      } else {\r\n        this.setError(this.options.takenText);\r\n      }\r\n    }, (err) => {\r\n      if(this.getValue() !== username) return;\r\n\r\n      switch(err.type) {\r\n        case 'USERNAME_INVALID': {\r\n          this.setError(this.options.invalidText);\r\n          break;\r\n        }\r\n      }\r\n    }).then(() => {\r\n      this.checkUsernamePromise = undefined;\r\n      this.options.onChange && this.options.onChange();\r\n\r\n      const value = this.getValue();\r\n      if(value !== username && this.isValidToChange() && isUsernameValid(value)) {\r\n        this.checkUsername(value);\r\n      }\r\n    });\r\n  };\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\ntype TargetType = HTMLElement;\r\nexport type OnVisibilityChangeItem = {target: TargetType, visible: boolean, entry: IntersectionObserverEntry};\r\nexport type OnVisibilityChange = (item: OnVisibilityChangeItem) => void;\r\n\r\nexport default class VisibilityIntersector {\r\n  private observer: IntersectionObserver;\r\n  private items: Map<TargetType, boolean> = new Map();\r\n  private locked = false;\r\n\r\n  constructor(onVisibilityChange: OnVisibilityChange, options?: IntersectionObserverInit) {\r\n    this.observer = new IntersectionObserver((entries) => {\r\n      if(this.locked) {\r\n        return;\r\n      }\r\n\r\n      const changed: OnVisibilityChangeItem[] = [];\r\n\r\n      entries.forEach((entry) => {\r\n        const target = entry.target as TargetType;\r\n\r\n        if(this.items.get(target) === entry.isIntersecting) {\r\n          return;\r\n        } else {\r\n          this.items.set(target, entry.isIntersecting);\r\n        }\r\n\r\n        /* if(entry.isIntersecting) {\r\n          console.log('ooo', entry);\r\n        } */\r\n\r\n        /* if(this.locked) {\r\n          return;\r\n        } */\r\n\r\n        const change: typeof changed[0] = {target, visible: entry.isIntersecting, entry};\r\n\r\n        // ! order will be incorrect so can't use it\r\n        // changed[entry.isIntersecting ? 'unshift' : 'push'](change);\r\n        changed.push(change);\r\n\r\n        // onVisibilityChange(target, entry.isIntersecting);\r\n      });\r\n\r\n      changed.forEach((item) => {\r\n        onVisibilityChange(item);\r\n      });\r\n    }, options);\r\n  }\r\n\r\n  public getVisible() {\r\n    const items: TargetType[] = [];\r\n    this.items.forEach((value, key) => {\r\n      if(value) {\r\n        items.push(key);\r\n      }\r\n    });\r\n\r\n    return items;\r\n  }\r\n\r\n  public clearVisible() {\r\n    const visible = this.getVisible();\r\n    for(const target of visible) {\r\n      this.items.set(target, false);\r\n    }\r\n  }\r\n\r\n  public isVisible(target: TargetType) {\r\n    return this.items.get(target);\r\n  }\r\n\r\n  public disconnect() {\r\n    this.observer.disconnect();\r\n    this.items.clear();\r\n  }\r\n\r\n  public refresh() {\r\n    this.observer.disconnect();\r\n\r\n    // window.requestAnimationFrame(() => {\r\n    const targets = [...this.items.keys()];\r\n    for(const target of targets) {\r\n      // this.items.set(target, false);\r\n      this.observer.observe(target);\r\n    }\r\n    // });\r\n  }\r\n\r\n  public refreshVisible() {\r\n    const visible = this.getVisible();\r\n    for(const target of visible) {\r\n      this.observer.unobserve(target);\r\n    }\r\n\r\n    for(const target of visible) {\r\n      this.observer.observe(target);\r\n    }\r\n  }\r\n\r\n  public observe(target: TargetType) {\r\n    this.items.set(target, false);\r\n    this.observer.observe(target);\r\n  }\r\n\r\n  public unobserve(target: TargetType) {\r\n    this.observer.unobserve(target);\r\n    this.items.delete(target);\r\n  }\r\n\r\n  public unlock() {\r\n    this.locked = false;\r\n  }\r\n\r\n  public unlockAndRefresh() {\r\n    this.unlock();\r\n    this.refresh();\r\n  }\r\n\r\n  public lock() {\r\n    this.locked = true;\r\n  }\r\n}\r\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport cancelEvent from '../helpers/dom/cancelEvent';\nimport {attachClickEvent} from '../helpers/dom/clickEvent';\nimport ListenerSetter from '../helpers/listenerSetter';\nimport rootScope from '../lib/rootScope';\nimport appMediaPlaybackController from './appMediaPlaybackController';\nimport RangeSelector from './rangeSelector';\n\nexport default class VolumeSelector extends RangeSelector {\n  private static ICONS = ['volume_off', 'volume_mute', 'volume_down', 'volume_up'];\n  public btn: HTMLElement;\n  protected icon: HTMLSpanElement;\n\n  constructor(protected listenerSetter: ListenerSetter, protected vertical = false) {\n    super({\n      step: 0.01,\n      min: 0,\n      max: 1,\n      vertical\n    }, 1);\n\n    this.setListeners();\n    this.setHandlers({\n      onScrub: currentTime => {\n        const value = Math.max(Math.min(currentTime, 1), 0);\n\n        // console.log('volume scrub:', currentTime, value);\n\n        appMediaPlaybackController.muted = false;\n        appMediaPlaybackController.volume = value;\n      }\n\n      /* onMouseUp: (e) => {\n        cancelEvent(e.event);\n      } */\n    });\n\n    const className = 'player-volume';\n    const btn = this.btn = document.createElement('div');\n    btn.classList.add('btn-icon', className);\n    const icon = this.icon = document.createElement('span');\n    icon.classList.add(className + '__icon');\n\n    btn.append(icon, this.container);\n\n    attachClickEvent(icon, this.onMuteClick, {listenerSetter: this.listenerSetter});\n    this.listenerSetter.add(appMediaPlaybackController)('playbackParams', this.setVolume);\n\n    this.setVolume();\n  }\n\n  private onMuteClick = (e?: Event) => {\n    e && cancelEvent(e);\n    appMediaPlaybackController.muted = !appMediaPlaybackController.muted;\n  };\n\n  public setVolume = () => {\n    // const volume = video.volume;\n    const {volume, muted} = appMediaPlaybackController;\n    let d: string;\n    let iconIndex: number;\n    if(!volume || muted) {\n      iconIndex = 0;\n    } else if(volume > .5) {\n      iconIndex = 3;\n    } else if(volume > 0 && volume < .25) {\n      iconIndex = 1;\n    } else {\n      iconIndex = 2;\n    }\n\n    VolumeSelector.ICONS.forEach((icon) => this.icon.classList.remove('tgico-' + icon));\n    this.icon.classList.add('tgico-' + VolumeSelector.ICONS[iconIndex]);\n\n    if(!this.mousedown) {\n      this.setProgress(muted ? 0 : volume);\n    }\n  };\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport renderMediaWithFadeIn from '../../helpers/dom/renderMediaWithFadeIn';\nimport mediaSizes from '../../helpers/mediaSizes';\nimport {Message, PhotoSize, VideoSize, WebDocument} from '../../layer';\nimport {MyDocument} from '../../lib/appManagers/appDocsManager';\nimport {MyPhoto} from '../../lib/appManagers/appPhotosManager';\nimport rootScope from '../../lib/rootScope';\nimport LazyLoadQueue from '../lazyLoadQueue';\nimport ProgressivePreloader from '../preloader';\nimport blur from '../../helpers/blur';\nimport {AppManagers} from '../../lib/appManagers/managers';\nimport getStrippedThumbIfNeeded from '../../helpers/getStrippedThumbIfNeeded';\nimport setAttachmentSize from '../../helpers/setAttachmentSize';\nimport choosePhotoSize from '../../lib/appManagers/utils/photos/choosePhotoSize';\nimport type {ThumbCache} from '../../lib/storages/thumbs';\nimport appDownloadManager from '../../lib/appManagers/appDownloadManager';\nimport isWebDocument from '../../lib/appManagers/utils/webDocs/isWebDocument';\nimport createVideo from '../../helpers/dom/createVideo';\nimport noop from '../../helpers/noop';\nimport {THUMB_TYPE_FULL} from '../../lib/mtproto/mtproto_config';\nimport {Middleware} from '../../helpers/middleware';\n\nexport default async function wrapPhoto({photo, message, container, boxWidth, boxHeight, withTail, isOut, lazyLoadQueue, middleware, size, withoutPreloader, loadPromises, autoDownloadSize, noBlur, noThumb, noFadeIn, blurAfter, managers = rootScope.managers}: {\n  photo: MyPhoto | MyDocument | WebDocument,\n  message?: Message.message | Message.messageService,\n  container: HTMLElement,\n  boxWidth?: number,\n  boxHeight?: number,\n  withTail?: boolean,\n  isOut?: boolean,\n  lazyLoadQueue?: LazyLoadQueue,\n  middleware?: Middleware,\n  size?: PhotoSize | VideoSize,\n  withoutPreloader?: boolean,\n  loadPromises?: Promise<any>[],\n  autoDownloadSize?: number,\n  noBlur?: boolean,\n  noThumb?: boolean,\n  noFadeIn?: boolean,\n  blurAfter?: boolean,\n  managers?: AppManagers,\n}) {\n  const ret = {\n    loadPromises: {\n      thumb: Promise.resolve() as Promise<any>,\n      full: Promise.resolve() as Promise<any>\n    },\n    images: {\n      thumb: null as HTMLImageElement | HTMLCanvasElement,\n      full: null as HTMLVideoElement | HTMLImageElement\n    },\n    preloader: null as ProgressivePreloader,\n    aspecter: null as HTMLElement\n  };\n\n  const isDocument = photo._ === 'document';\n  const isWebDoc = isWebDocument(photo);\n  if(!((photo as MyPhoto).sizes || (photo as MyDocument).thumbs) && !isWebDoc) {\n    if(boxWidth && boxHeight && !size && isDocument) {\n      setAttachmentSize(photo, container, boxWidth, boxHeight, undefined, message);\n    }\n\n    return ret;\n  }\n\n  let noAutoDownload = autoDownloadSize === 0;\n\n  if(!size) {\n    if(boxWidth === undefined) boxWidth = mediaSizes.active.regular.width;\n    if(boxHeight === undefined) boxHeight = mediaSizes.active.regular.height;\n  }\n\n  container.classList.add('media-container');\n  let aspecter = container;\n\n  let isFit = true;\n  let loadThumbPromise: Promise<any> = Promise.resolve();\n  let thumbImage: HTMLImageElement | HTMLCanvasElement;\n  // let image: HTMLImageElement;\n  let cacheContext: ThumbCache;\n  const isGif = isDocument && photo.mime_type === 'image/gif' && !size;\n  // if(withTail) {\n  //   image = wrapMediaWithTail(photo, message, container, boxWidth, boxHeight, isOut);\n  // } else {\n\n  if(boxWidth && boxHeight && !size) { // !album\n    const set = setAttachmentSize(photo, container, boxWidth, boxHeight, undefined, message, undefined, isGif ? {\n      _: 'photoSize',\n      w: photo.w,\n      h: photo.h,\n      size: photo.size,\n      type: THUMB_TYPE_FULL\n    } : undefined);\n    size = set.photoSize;\n    isFit = set.isFit;\n    cacheContext = await managers.thumbsStorage.getCacheContext(photo, size.type);\n\n    if(!isFit && !isWebDoc) {\n      aspecter = document.createElement('div');\n      aspecter.classList.add('media-container-aspecter');\n      aspecter.style.width = set.size.width + 'px';\n      aspecter.style.height = set.size.height + 'px';\n\n      const gotThumb = getStrippedThumbIfNeeded(photo, cacheContext, !noBlur, true);\n      if(gotThumb) {\n        loadThumbPromise = gotThumb.loadPromise;\n        const thumbImage = gotThumb.image; // local scope\n        thumbImage.classList.add('media-photo');\n        container.append(thumbImage);\n      } else {\n        const res = await wrapPhoto({\n          container,\n          message,\n          photo,\n          boxWidth: 0,\n          boxHeight: 0,\n          size,\n          lazyLoadQueue,\n          isOut,\n          loadPromises,\n          middleware,\n          withoutPreloader,\n          withTail,\n          autoDownloadSize,\n          noBlur,\n          noThumb: true,\n          blurAfter: true,\n          managers\n          // noFadeIn: true\n        });\n        const thumbImage = res.images.full;\n        thumbImage.classList.add('media-photo', 'thumbnail');\n        // container.append(thumbImage);\n      }\n\n      container.classList.add('media-container-fitted');\n      container.append(aspecter);\n    }\n  } else {\n    if(!size) {\n      size = choosePhotoSize(photo, boxWidth, boxHeight, true);\n    }\n\n    cacheContext = await managers.thumbsStorage.getCacheContext(photo, size?.type);\n  }\n\n  if(!noThumb && !isWebDoc) {\n    const gotThumb = getStrippedThumbIfNeeded(photo, cacheContext, !noBlur);\n    if(gotThumb) {\n      loadThumbPromise = Promise.all([loadThumbPromise, gotThumb.loadPromise]);\n      ret.loadPromises.thumb = ret.loadPromises.full = loadThumbPromise;\n      thumbImage = ret.images.thumb = gotThumb.image;\n      thumbImage.classList.add('media-photo');\n      aspecter.append(thumbImage);\n    }\n  }\n  // }\n\n  if(size?._ === 'photoSizeEmpty' && isDocument) {\n    return ret;\n  }\n\n  let media: HTMLVideoElement | HTMLImageElement;\n  if(size?._ === 'videoSize') {\n    media = ret.images.full = createVideo();\n    media.autoplay = true;\n    media.loop = true;\n    media.muted = true;\n    media.classList.add('media-photo');\n  } else {\n    media = ret.images.full = new Image();\n    media.classList.add('media-photo');\n  }\n\n  // console.log('wrapPhoto downloaded:', photo, photo.downloaded, container);\n\n  const needFadeIn = (thumbImage || !cacheContext.downloaded) && rootScope.settings.animationsEnabled && !noFadeIn;\n\n  let preloader: ProgressivePreloader;\n  const uploadingFileName = (message as Message.message)?.uploadingFileName;\n  if(!withoutPreloader) {\n    if(!cacheContext.downloaded || uploadingFileName) {\n      preloader = new ProgressivePreloader({\n        attachMethod: 'prepend',\n        isUpload: !!uploadingFileName\n      });\n    }\n\n    if(uploadingFileName) { // means upload\n      preloader.attachPromise(appDownloadManager.getUpload(uploadingFileName));\n      preloader.attach(container);\n      noAutoDownload = undefined;\n    }\n  }\n\n\n  const getDownloadPromise = () => {\n    // const promise = isGif && !size ?\n    //   managers.appDocsManager.downloadDoc(photo, /* undefined,  */lazyLoadQueue?.queueId) :\n    //   managers.appPhotosManager.preloadPhoto(photo, size, lazyLoadQueue?.queueId, noAutoDownload);\n    const haveToDownload = isGif && !size;\n    const promise = appDownloadManager.downloadMediaURL({\n      media: photo,\n      thumb: size,\n      queueId: lazyLoadQueue?.queueId,\n      onlyCache: haveToDownload ? undefined : noAutoDownload\n    });\n\n    return promise;\n  };\n\n  const renderOnLoad = (url: string) => {\n    return renderMediaWithFadeIn(container, media, url, needFadeIn, aspecter, thumbImage);\n  };\n\n  const onLoad = async(url: string) => {\n    if(middleware && !middleware()) return;\n\n    if(blurAfter) {\n      const result = blur(url, 12);\n      return result.promise.then(() => {\n        // image = result.canvas;\n        return renderOnLoad(result.canvas.toDataURL());\n      });\n    }\n\n    return renderOnLoad(url);\n  };\n\n  let loadPromise: Promise<any>;\n  const canAttachPreloader = (\n    (size as PhotoSize.photoSize).w >= 150 &&\n    (size as PhotoSize.photoSize).h >= 150\n  ) || noAutoDownload;\n  const load = async() => {\n    if(noAutoDownload && !withoutPreloader && preloader) {\n      preloader.construct();\n      preloader.setManual();\n    }\n\n    const promise = getDownloadPromise();\n    const cacheContext = await managers.thumbsStorage.getCacheContext(photo, size?.type);\n    if(\n      preloader &&\n      !cacheContext.downloaded &&\n      !withoutPreloader &&\n      canAttachPreloader\n    ) {\n      preloader.attach(container, false, promise);\n    }\n\n    noAutoDownload = undefined;\n\n    const renderPromise = promise.then(onLoad);\n    renderPromise.catch(noop);\n    return {download: promise, render: renderPromise};\n  };\n\n  if(preloader) {\n    preloader.setDownloadFunction(load);\n  }\n\n  if(cacheContext.downloaded) {\n    loadThumbPromise = loadPromise = (await load()).render;\n  } else {\n    if(!lazyLoadQueue) loadPromise = (await load()).render;\n    /* else if(noAutoDownload) {\n      preloader.construct();\n      preloader.setManual();\n      preloader.attach(container);\n    } */ else lazyLoadQueue.push({div: container, load: () => load().then(({download}) => download)});\n  }\n\n  if(loadPromises && loadThumbPromise) {\n    loadPromises.push(loadThumbPromise);\n  }\n\n  // const perf = performance.now();\n  await loadThumbPromise;\n  ret.loadPromises.thumb = loadThumbPromise;\n  ret.loadPromises.full = loadPromise || Promise.resolve();\n  ret.preloader = preloader;\n  ret.aspecter = aspecter;\n\n  // const elapsedTime = performance.now() - perf;\n  // if(elapsedTime > 4) {\n  //   console.log('wrapping photo thumb time', elapsedTime, photo, size);\n  // }\n\n  return ret;\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport {IS_SAFARI} from '../../environment/userAgent';\nimport {animateSingle} from '../../helpers/animation';\nimport {ChatAutoDownloadSettings} from '../../helpers/autoDownload';\nimport deferredPromise from '../../helpers/cancellablePromise';\nimport cancelEvent from '../../helpers/dom/cancelEvent';\nimport {attachClickEvent} from '../../helpers/dom/clickEvent';\nimport createVideo from '../../helpers/dom/createVideo';\nimport isInDOM from '../../helpers/dom/isInDOM';\nimport renderImageFromUrl from '../../helpers/dom/renderImageFromUrl';\nimport getStrippedThumbIfNeeded from '../../helpers/getStrippedThumbIfNeeded';\nimport mediaSizes, {ScreenSize} from '../../helpers/mediaSizes';\nimport {Middleware} from '../../helpers/middleware';\nimport noop from '../../helpers/noop';\nimport onMediaLoad from '../../helpers/onMediaLoad';\nimport {fastRaf} from '../../helpers/schedulers';\nimport throttle from '../../helpers/schedulers/throttle';\nimport sequentialDom from '../../helpers/sequentialDom';\nimport toHHMMSS from '../../helpers/string/toHHMMSS';\nimport {Message, PhotoSize, VideoSize} from '../../layer';\nimport {MyDocument} from '../../lib/appManagers/appDocsManager';\nimport appDownloadManager from '../../lib/appManagers/appDownloadManager';\nimport appImManager from '../../lib/appManagers/appImManager';\nimport {AppManagers} from '../../lib/appManagers/managers';\nimport {NULL_PEER_ID} from '../../lib/mtproto/mtproto_config';\nimport rootScope from '../../lib/rootScope';\nimport {ThumbCache} from '../../lib/storages/thumbs';\nimport animationIntersector, {AnimationItemGroup} from '../animationIntersector';\nimport appMediaPlaybackController, {MediaSearchContext} from '../appMediaPlaybackController';\nimport {findMediaTargets} from '../audio';\nimport LazyLoadQueue from '../lazyLoadQueue';\nimport ProgressivePreloader from '../preloader';\nimport wrapPhoto from './photo';\n\nconst MAX_VIDEO_AUTOPLAY_SIZE = 50 * 1024 * 1024; // 50 MB\n\nlet roundVideoCircumference = 0;\nmediaSizes.addEventListener('changeScreen', (from, to) => {\n  if(to === ScreenSize.mobile || from === ScreenSize.mobile) {\n    const elements = Array.from(document.querySelectorAll('.media-round .progress-ring')) as SVGSVGElement[];\n    const width = mediaSizes.active.round.width;\n    const halfSize = width / 2;\n    const radius = halfSize - 7;\n    roundVideoCircumference = 2 * Math.PI * radius;\n    elements.forEach((element) => {\n      element.setAttributeNS(null, 'width', '' + width);\n      element.setAttributeNS(null, 'height', '' + width);\n\n      const circle = element.firstElementChild as SVGCircleElement;\n      circle.setAttributeNS(null, 'cx', '' + halfSize);\n      circle.setAttributeNS(null, 'cy', '' + halfSize);\n      circle.setAttributeNS(null, 'r', '' + radius);\n\n      circle.style.strokeDasharray = roundVideoCircumference + ' ' + roundVideoCircumference;\n      circle.style.strokeDashoffset = '' + roundVideoCircumference;\n    });\n  }\n});\n\nexport default async function wrapVideo({doc, container, message, boxWidth, boxHeight, withTail, isOut, middleware, lazyLoadQueue, noInfo, group, onlyPreview, noPreview, withoutPreloader, loadPromises, noPlayButton, photoSize, videoSize, searchContext, autoDownload, managers = rootScope.managers}: {\n  doc: MyDocument,\n  container?: HTMLElement,\n  message?: Message.message,\n  boxWidth?: number,\n  boxHeight?: number,\n  withTail?: boolean,\n  isOut?: boolean,\n  middleware?: Middleware,\n  lazyLoadQueue?: LazyLoadQueue,\n  noInfo?: boolean,\n  noPlayButton?: boolean,\n  group?: AnimationItemGroup,\n  onlyPreview?: boolean,\n  noPreview?: boolean,\n  withoutPreloader?: boolean,\n  loadPromises?: Promise<any>[],\n  autoDownload?: ChatAutoDownloadSettings,\n  photoSize?: PhotoSize,\n  videoSize?: VideoSize,\n  searchContext?: MediaSearchContext,\n  managers?: AppManagers\n}) {\n  const autoDownloadSize = autoDownload?.video;\n  let noAutoDownload = autoDownloadSize === 0;\n  const isAlbumItem = !(boxWidth && boxHeight);\n  const canAutoplay = /* doc.sticker ||  */(\n    (\n      doc.type !== 'video' || (\n        doc.size <= MAX_VIDEO_AUTOPLAY_SIZE &&\n        !isAlbumItem\n      )\n    ) && (doc.type === 'gif' ? rootScope.settings.autoPlay.gifs : rootScope.settings.autoPlay.videos)\n  );\n  let spanTime: HTMLElement, spanPlay: HTMLElement;\n\n  if(!noInfo) {\n    spanTime = document.createElement('span');\n    spanTime.classList.add('video-time');\n    container.append(spanTime);\n\n    let needPlayButton = false;\n    if(doc.type !== 'gif') {\n      spanTime.innerText = toHHMMSS(doc.duration, false);\n\n      if(!noPlayButton && doc.type !== 'round') {\n        if(canAutoplay && !noAutoDownload) {\n          spanTime.classList.add('tgico', 'can-autoplay');\n        } else {\n          needPlayButton = true;\n        }\n      }\n    } else {\n      spanTime.innerText = 'GIF';\n\n      if(!canAutoplay && !noPlayButton) {\n        needPlayButton = true;\n        noAutoDownload = undefined;\n      }\n    }\n\n    if(needPlayButton) {\n      spanPlay = document.createElement('span');\n      spanPlay.classList.add('video-play', 'tgico-largeplay', 'btn-circle', 'position-center');\n      container.append(spanPlay);\n    }\n  }\n\n  const res: {\n    thumb?: typeof photoRes,\n    loadPromise: Promise<any>\n  } = {} as any;\n\n  if(doc.mime_type === 'image/gif') {\n    const photoRes = await wrapPhoto({\n      photo: doc,\n      message,\n      container,\n      boxWidth,\n      boxHeight,\n      withTail,\n      isOut,\n      lazyLoadQueue,\n      middleware,\n      withoutPreloader,\n      loadPromises,\n      autoDownloadSize,\n      size: photoSize,\n      managers\n    });\n\n    res.thumb = photoRes;\n    res.loadPromise = photoRes.loadPromises.full;\n    return res;\n  }\n\n  /* const video = doc.type === 'round' ? appMediaPlaybackController.addMedia(doc, message.mid) as HTMLVideoElement : document.createElement('video');\n  if(video.parentElement) {\n    video.remove();\n  } */\n\n  let preloader: ProgressivePreloader; // it must be here, otherwise will get error before initialization in round onPlay\n\n  const video = createVideo();\n  video.classList.add('media-video');\n  video.muted = true;\n  if(doc.type === 'round') {\n    const divRound = document.createElement('div');\n    divRound.classList.add('media-round', 'z-depth-1');\n    divRound.dataset.mid = '' + message.mid;\n    divRound.dataset.peerId = '' + message.peerId;\n    (divRound as any).message = message;\n\n    const size = mediaSizes.active.round;\n    const halfSize = size.width / 2;\n    const strokeWidth = 3.5;\n    const radius = halfSize - (strokeWidth * 2);\n    divRound.innerHTML = `<svg class=\"progress-ring\" width=\"${size.width}\" height=\"${size.width}\" style=\"transform: rotate(-90deg);\">\n      <circle class=\"progress-ring__circle\" stroke=\"white\" stroke-opacity=\"0.3\" stroke-width=\"${strokeWidth}\" cx=\"${halfSize}\" cy=\"${halfSize}\" r=\"${radius}\" fill=\"transparent\"/>\n    </svg>`;\n\n    const circle = divRound.firstElementChild.firstElementChild as SVGCircleElement;\n    if(!roundVideoCircumference) {\n      roundVideoCircumference = 2 * Math.PI * radius;\n    }\n    circle.style.strokeDasharray = roundVideoCircumference + ' ' + roundVideoCircumference;\n    circle.style.strokeDashoffset = '' + roundVideoCircumference;\n\n    spanTime.classList.add('tgico');\n\n    const isUnread = message.pFlags.media_unread;\n    if(isUnread) {\n      divRound.classList.add('is-unread');\n    }\n\n    const canvas = document.createElement('canvas');\n    canvas.width = canvas.height = doc.w/*  * window.devicePixelRatio */;\n\n    divRound.prepend(canvas, spanTime);\n    divRound.append(video);\n    container.append(divRound);\n\n    const ctx = canvas.getContext('2d');\n    /* ctx.beginPath();\n    ctx.arc(canvas.width / 2, canvas.height / 2, canvas.width / 2, 0, Math.PI * 2);\n    ctx.clip(); */\n\n    const onLoad = () => {\n      const message: Message.message = (divRound as any).message;\n      const globalVideo = appMediaPlaybackController.addMedia(message, !noAutoDownload) as HTMLVideoElement;\n      const clear = () => {\n        (appImManager.chat.setPeerPromise || Promise.resolve()).finally(() => {\n          if(isInDOM(globalVideo)) {\n            return;\n          }\n\n          globalVideo.removeEventListener('play', onPlay);\n          globalVideo.removeEventListener('timeupdate', throttledTimeUpdate);\n          globalVideo.removeEventListener('pause', onPaused);\n          globalVideo.removeEventListener('ended', onEnded);\n        });\n      };\n\n      const onFrame = () => {\n        ctx.drawImage(globalVideo, 0, 0);\n\n        const offset = roundVideoCircumference - globalVideo.currentTime / globalVideo.duration * roundVideoCircumference;\n        circle.style.strokeDashoffset = '' + offset;\n\n        return !globalVideo.paused;\n      };\n\n      const onTimeUpdate = () => {\n        if(!globalVideo.duration) {\n          return;\n        }\n\n        if(!isInDOM(globalVideo)) {\n          clear();\n          return;\n        }\n\n        if(globalVideo.paused) {\n          onFrame();\n        }\n\n        spanTime.innerText = toHHMMSS(globalVideo.duration - globalVideo.currentTime, false);\n      };\n\n      const throttledTimeUpdate = throttle(() => {\n        fastRaf(onTimeUpdate);\n      }, 1000, false);\n\n      const onPlay = () => {\n        video.classList.add('hide');\n        divRound.classList.remove('is-paused');\n        animateSingle(onFrame, canvas);\n\n        if(preloader && preloader.preloader && preloader.preloader.classList.contains('manual')) {\n          preloader.onClick();\n        }\n      };\n\n      const onPaused = () => {\n        if(!isInDOM(globalVideo)) {\n          clear();\n          return;\n        }\n\n        divRound.classList.add('is-paused');\n      };\n\n      const onEnded = () => {\n        video.classList.remove('hide');\n        divRound.classList.add('is-paused');\n\n        video.currentTime = 0;\n        spanTime.innerText = toHHMMSS(globalVideo.duration, false);\n\n        if(globalVideo.currentTime) {\n          globalVideo.currentTime = 0;\n        }\n      };\n\n      globalVideo.addEventListener('play', onPlay);\n      globalVideo.addEventListener('timeupdate', throttledTimeUpdate);\n      globalVideo.addEventListener('pause', onPaused);\n      globalVideo.addEventListener('ended', onEnded);\n\n      attachClickEvent(canvas, (e) => {\n        cancelEvent(e);\n\n        // ! \n        if(preloader && !preloader.detached) {\n          preloader.onClick();\n        }\n\n        // ! can't use it here. on Safari iOS video won't start.\n        /* if(globalVideo.readyState < 2) {\n          return;\n        } */\n\n        if(globalVideo.paused) {\n          const hadSearchContext = !!searchContext;\n          if(appMediaPlaybackController.setSearchContext(searchContext || {\n            peerId: NULL_PEER_ID,\n            inputFilter: {_: 'inputMessagesFilterEmpty'},\n            useSearch: false\n          })) {\n            const [prev, next] = !hadSearchContext ? [] : findMediaTargets(divRound, message.mid/* , searchContext.useSearch */);\n            appMediaPlaybackController.setTargets({peerId: message.peerId, mid: message.mid}, prev, next);\n          }\n\n          globalVideo.play();\n        } else {\n          globalVideo.pause();\n        }\n      });\n\n      if(globalVideo.paused) {\n        if(globalVideo.duration && globalVideo.currentTime !== globalVideo.duration && globalVideo.currentTime > 0) {\n          onFrame();\n          onTimeUpdate();\n          video.classList.add('hide');\n        } else {\n          onPaused();\n        }\n      } else {\n        onPlay();\n      }\n    };\n\n    if(message.pFlags.is_outgoing) {\n      (divRound as any).onLoad = onLoad;\n      divRound.dataset.isOutgoing = '1';\n    } else {\n      onLoad();\n    }\n  } else {\n    video.autoplay = true; //  safari\n  }\n\n  let photoRes: Awaited<ReturnType<typeof wrapPhoto>>;\n  if(message) {\n    photoRes = await wrapPhoto({\n      photo: doc,\n      message,\n      container,\n      boxWidth,\n      boxHeight,\n      withTail,\n      isOut,\n      lazyLoadQueue,\n      middleware,\n      withoutPreloader: true,\n      loadPromises,\n      autoDownloadSize: autoDownload?.photo,\n      size: photoSize,\n      managers\n    });\n\n    res.thumb = photoRes;\n\n    if((!canAutoplay && doc.type !== 'gif') || onlyPreview) {\n      res.loadPromise = photoRes.loadPromises.full;\n      return res;\n    }\n\n    if(withTail) {\n      const foreignObject = (photoRes.images.thumb || photoRes.images.full).parentElement;\n      video.width = +foreignObject.getAttributeNS(null, 'width');\n      video.height = +foreignObject.getAttributeNS(null, 'height');\n      foreignObject.append(video);\n    }\n  } else if(!noPreview) { // * gifs masonry\n    const gotThumb = getStrippedThumbIfNeeded(doc, {} as ThumbCache, true);\n    if(gotThumb) {\n      const thumbImage = gotThumb.image;\n      thumbImage.classList.add('media-poster');\n      container.append(thumbImage);\n      res.thumb = {\n        loadPromises: {\n          thumb: gotThumb.loadPromise,\n          full: Promise.resolve()\n        },\n        images: {\n          thumb: thumbImage,\n          full: null\n        },\n        preloader: null,\n        aspecter: null\n      };\n\n      loadPromises?.push(gotThumb.loadPromise);\n      res.loadPromise = gotThumb.loadPromise;\n    }\n  }\n\n  if(onlyPreview) {\n    return res;\n  }\n\n  if(!video.parentElement && container) {\n    (photoRes?.aspecter || container).append(video);\n  }\n\n  let cacheContext: ThumbCache;\n  const getCacheContext = async() => {\n    return cacheContext = await managers.thumbsStorage.getCacheContext(doc, videoSize?.type);\n  };\n\n  await getCacheContext();\n\n  const uploadFileName = message?.uploadingFileName;\n  if(uploadFileName) { // means upload\n    preloader = new ProgressivePreloader({\n      attachMethod: 'prepend',\n      isUpload: true\n    });\n    preloader.attachPromise(appDownloadManager.getUpload(uploadFileName));\n    preloader.attach(container, false);\n    noAutoDownload = undefined;\n  } else if(!cacheContext.downloaded && !doc.supportsStreaming && !withoutPreloader) {\n    preloader = new ProgressivePreloader({\n      attachMethod: 'prepend'\n    });\n  } else if(doc.supportsStreaming) {\n    preloader = new ProgressivePreloader({\n      cancelable: false,\n      attachMethod: 'prepend'\n    });\n  }\n\n  const renderDeferred = deferredPromise<void>();\n  video.addEventListener('error', (e) => {\n    if(video.error.code !== 4) {\n      console.error('Error ' + video.error.code + '; details: ' + video.error.message);\n    }\n\n    if(preloader && !uploadFileName) {\n      preloader.detach();\n    }\n\n    if(!renderDeferred.isFulfilled) {\n      renderDeferred.resolve();\n    }\n  }, {once: true});\n\n  if(doc.type === 'video') {\n    const onTimeUpdate = () => {\n      if(!video.duration) {\n        return;\n      }\n\n      spanTime.innerText = toHHMMSS(video.duration - video.currentTime, false);\n    };\n\n    const throttledTimeUpdate = throttle(() => {\n      fastRaf(onTimeUpdate);\n    }, 1e3, false);\n\n    video.addEventListener('timeupdate', throttledTimeUpdate);\n\n    if(spanPlay) {\n      video.addEventListener('timeupdate', () => {\n        sequentialDom.mutateElement(spanPlay, () => {\n          spanPlay.remove();\n        });\n      }, {once: true});\n    }\n  }\n\n  video.muted = true;\n  video.loop = true;\n  // video.play();\n  video.autoplay = true;\n\n  let loadPhotoThumbFunc = noAutoDownload && photoRes?.preloader?.loadFunc;\n  const load = async() => {\n    if(preloader && noAutoDownload && !withoutPreloader) {\n      preloader.construct();\n      preloader.setManual();\n    }\n\n    await getCacheContext();\n    let loadPromise: Promise<any> = Promise.resolve();\n    if((preloader && !uploadFileName) || withoutPreloader) {\n      if(!cacheContext.downloaded && !doc.supportsStreaming) {\n        const promise = loadPromise = appDownloadManager.downloadMediaURL({\n          media: doc,\n          queueId: lazyLoadQueue?.queueId,\n          onlyCache: noAutoDownload,\n          thumb: videoSize\n        });\n\n        if(preloader) {\n          preloader.attach(container, false, promise);\n        }\n      } else if(doc.supportsStreaming) {\n        if(noAutoDownload) {\n          loadPromise = Promise.reject();\n        } else if(!cacheContext.downloaded && preloader) { // * check for uploading video\n          preloader.attach(container, false, null);\n          video.addEventListener(IS_SAFARI ? 'timeupdate' : 'canplay', () => {\n            preloader.detach();\n          }, {once: true});\n        }\n      }\n    }\n\n    if(!noAutoDownload && loadPhotoThumbFunc) {\n      loadPhotoThumbFunc();\n      loadPhotoThumbFunc = null;\n    }\n\n    noAutoDownload = undefined;\n\n    loadPromise.then(async() => {\n      if(middleware && !middleware()) {\n        renderDeferred.resolve();\n        return;\n      }\n\n      if(doc.type === 'round') {\n        appMediaPlaybackController.resolveWaitingForLoadMedia(message.peerId, message.mid, message.pFlags.is_scheduled);\n      }\n\n      await getCacheContext();\n\n      onMediaLoad(video).then(() => {\n        if(group) {\n          animationIntersector.addAnimation(video, group);\n        }\n\n        if(preloader && !uploadFileName) {\n          preloader.detach();\n        }\n\n        renderDeferred.resolve();\n      });\n\n      renderImageFromUrl(video, cacheContext.url);\n    }, noop);\n\n    return {download: loadPromise, render: renderDeferred};\n  };\n\n  if(preloader && !uploadFileName) {\n    preloader.setDownloadFunction(load);\n  }\n\n  /* if(doc.size >= 20e6 && !doc.downloaded) {\n    let downloadDiv = document.createElement('div');\n    downloadDiv.classList.add('download');\n\n    let span = document.createElement('span');\n    span.classList.add('btn-circle', 'tgico-download');\n    downloadDiv.append(span);\n\n    downloadDiv.addEventListener('click', () => {\n      downloadDiv.remove();\n      loadVideo();\n    });\n\n    container.prepend(downloadDiv);\n\n    return;\n  } */\n\n  if(doc.type === 'gif' && !canAutoplay) {\n    attachClickEvent(container, (e) => {\n      cancelEvent(e);\n      spanPlay.remove();\n      load();\n    }, {capture: true, once: true});\n  } else {\n    res.loadPromise = !lazyLoadQueue ?\n      (await load()).render :\n      (lazyLoadQueue.push({div: container, load: () => load().then(({render}) => render)}), Promise.resolve());\n  }\n\n  if(res.thumb) {\n    await res.thumb.loadPromises.thumb;\n  }\n\n  return res;\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport {ChatAutoDownloadSettings} from '../../helpers/autoDownload';\nimport mediaSizes from '../../helpers/mediaSizes';\nimport {Middleware} from '../../helpers/middleware';\nimport {Message, PhotoSize} from '../../layer';\nimport {AppManagers} from '../../lib/appManagers/managers';\nimport getMediaFromMessage from '../../lib/appManagers/utils/messages/getMediaFromMessage';\nimport choosePhotoSize from '../../lib/appManagers/utils/photos/choosePhotoSize';\nimport rootScope from '../../lib/rootScope';\nimport Chat from '../chat/chat';\nimport LazyLoadQueue from '../lazyLoadQueue';\nimport prepareAlbum from '../prepareAlbum';\nimport wrapPhoto from './photo';\nimport wrapVideo from './video';\n\nexport default function wrapAlbum({messages, attachmentDiv, middleware, uploading, lazyLoadQueue, isOut, chat, loadPromises, autoDownload, managers = rootScope.managers}: {\n  messages: Message.message[],\n  attachmentDiv: HTMLElement,\n  middleware?: Middleware,\n  lazyLoadQueue?: LazyLoadQueue,\n  uploading?: boolean,\n  isOut: boolean,\n  chat: Chat,\n  loadPromises?: Promise<any>[],\n  autoDownload?: ChatAutoDownloadSettings,\n  managers?: AppManagers\n}) {\n  const items: {size: PhotoSize.photoSize, media: any, message: any}[] = [];\n\n  // !lowest msgID will be the FIRST in album\n  for(const message of messages) {\n    const media = getMediaFromMessage(message);\n\n    const size: any = media._ === 'photo' ? choosePhotoSize(media, 480, 480) : {w: media.w, h: media.h};\n    items.push({size, media, message});\n  }\n\n  /* // * pending\n  if(storage[0] < 0) {\n    items.reverse();\n  } */\n\n  prepareAlbum({\n    container: attachmentDiv,\n    items: items.map((i) => ({w: i.size.w, h: i.size.h})),\n    maxWidth: mediaSizes.active.album.width,\n    minWidth: 100,\n    spacing: 2,\n    forMedia: true\n  });\n\n  items.forEach((item, idx) => {\n    const {size, media, message} = item;\n\n    const div = attachmentDiv.children[idx] as HTMLElement;\n    div.dataset.mid = '' + message.mid;\n    div.dataset.peerId = '' + message.peerId;\n    const mediaDiv = div.firstElementChild as HTMLElement;\n    const isPhoto = media._ === 'photo';\n    let thumbPromise: Promise<any>;\n    if(isPhoto) {\n      thumbPromise = wrapPhoto({\n        photo: media,\n        message,\n        container: mediaDiv,\n        boxWidth: 0,\n        boxHeight: 0,\n        isOut,\n        lazyLoadQueue,\n        middleware,\n        size,\n        loadPromises,\n        autoDownloadSize: autoDownload.photo,\n        managers\n      });\n    } else {\n      thumbPromise = wrapVideo({\n        doc: message.media.document,\n        container: mediaDiv,\n        message,\n        boxWidth: 0,\n        boxHeight: 0,\n        withTail: false,\n        isOut,\n        lazyLoadQueue,\n        middleware,\n        loadPromises,\n        autoDownload,\n        managers\n      });\n    }\n\n    if(thumbPromise && loadPromises) {\n      loadPromises.push(thumbPromise);\n    }\n  });\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport MEDIA_MIME_TYPES_SUPPORTED from '../../environment/mediaMimeTypesSupport';\nimport {CancellablePromise} from '../../helpers/cancellablePromise';\nimport {clearBadCharsAndTrim} from '../../helpers/cleanSearchText';\nimport {formatFullSentTime} from '../../helpers/date';\nimport {simulateClickEvent, attachClickEvent} from '../../helpers/dom/clickEvent';\nimport replaceContent from '../../helpers/dom/replaceContent';\nimport formatBytes from '../../helpers/formatBytes';\nimport {MediaSizeType} from '../../helpers/mediaSizes';\nimport noop from '../../helpers/noop';\nimport {Message, MessageMedia, WebPage} from '../../layer';\nimport {MyDocument} from '../../lib/appManagers/appDocsManager';\nimport appDownloadManager, {Progress} from '../../lib/appManagers/appDownloadManager';\nimport appImManager from '../../lib/appManagers/appImManager';\nimport {AppManagers} from '../../lib/appManagers/managers';\nimport getDownloadMediaDetails from '../../lib/appManagers/utils/download/getDownloadMediaDetails';\nimport choosePhotoSize from '../../lib/appManagers/utils/photos/choosePhotoSize';\nimport {joinElementsWith} from '../../lib/langPack';\nimport {MAX_FILE_SAVE_SIZE} from '../../lib/mtproto/mtproto_config';\nimport wrapPlainText from '../../lib/richTextProcessor/wrapPlainText';\nimport rootScope from '../../lib/rootScope';\nimport type {ThumbCache} from '../../lib/storages/thumbs';\nimport {MediaSearchContext} from '../appMediaPlaybackController';\nimport AudioElement from '../audio';\nimport LazyLoadQueue from '../lazyLoadQueue';\nimport {MiddleEllipsisElement} from '../middleEllipsis';\nimport ProgressivePreloader from '../preloader';\nimport wrapPhoto from './photo';\nimport wrapSenderToPeer from './senderToPeer';\nimport wrapSentTime from './sentTime';\n\nrootScope.addEventListener('document_downloading', (docId) => {\n  const elements = Array.from(document.querySelectorAll(`.document[data-doc-id=\"${docId}\"]`)) as HTMLElement[];\n  elements.forEach((element) => {\n    if(element.querySelector('.preloader-container.manual')) {\n      simulateClickEvent(element);\n    }\n  });\n});\n\nexport default async function wrapDocument({message, withTime, fontWeight, voiceAsMusic, showSender, searchContext, loadPromises, autoDownloadSize, lazyLoadQueue, sizeType, managers = rootScope.managers, cacheContext}: {\n  message: Message.message,\n  withTime?: boolean,\n  fontWeight?: number,\n  voiceAsMusic?: boolean,\n  showSender?: boolean,\n  searchContext?: MediaSearchContext,\n  loadPromises?: Promise<any>[],\n  autoDownloadSize?: number,\n  lazyLoadQueue?: LazyLoadQueue,\n  sizeType?: MediaSizeType,\n  managers?: AppManagers,\n  cacheContext?: ThumbCache\n}): Promise<HTMLElement> {\n  if(!fontWeight) fontWeight = 500;\n  if(!sizeType) sizeType = '' as any;\n  const noAutoDownload = autoDownloadSize === 0;\n\n  const doc = ((message.media as MessageMedia.messageMediaDocument).document || ((message.media as MessageMedia.messageMediaWebPage).webpage as WebPage.webPage).document) as MyDocument;\n  const uploadFileName = message?.uploadingFileName;\n  if(doc.type === 'audio' || doc.type === 'voice' || doc.type === 'round') {\n    const audioElement = new AudioElement();\n    audioElement.withTime = withTime;\n    audioElement.message = message;\n    audioElement.noAutoDownload = noAutoDownload;\n    audioElement.lazyLoadQueue = lazyLoadQueue;\n    audioElement.loadPromises = loadPromises;\n\n    if(voiceAsMusic) audioElement.voiceAsMusic = voiceAsMusic;\n    if(searchContext) audioElement.searchContext = searchContext;\n    if(showSender) audioElement.showSender = showSender;\n\n    audioElement.dataset.fontWeight = '' + fontWeight;\n    audioElement.dataset.sizeType = sizeType;\n    await audioElement.render();\n    return audioElement;\n  }\n\n  const extSplitted = doc.file_name ? doc.file_name.split('.') : '';\n  let ext = '';\n  ext = extSplitted.length > 1 && Array.isArray(extSplitted) ?\n    clearBadCharsAndTrim(extSplitted.pop().split(' ', 1)[0].toLowerCase()) :\n    'file';\n\n  const docDiv = document.createElement('div');\n  docDiv.classList.add('document', `ext-${ext}`);\n  docDiv.dataset.docId = '' + doc.id;\n  (docDiv as any).doc = doc;\n\n  // return docDiv;\n\n  const icoDiv = document.createElement('div');\n  icoDiv.classList.add('document-ico');\n  let icoTextEl: HTMLElement;\n\n  const hadContext = !!cacheContext;\n  const getCacheContext = () => {\n    return hadContext ? cacheContext : managers.thumbsStorage.getCacheContext(doc);\n  };\n\n  cacheContext = await getCacheContext();\n  let hasThumb = false;\n  if((doc.thumbs?.length || (message.pFlags.is_outgoing && cacheContext.url && doc.type === 'photo'))/*  && doc.mime_type !== 'image/gif' */) {\n    docDiv.classList.add('document-with-thumb');\n    hasThumb = true;\n\n    const imgs: (HTMLImageElement | HTMLCanvasElement | HTMLVideoElement)[] = [];\n    // ! WARNING, use thumbs for check when thumb will be generated for media\n    if(message.pFlags.is_outgoing && ['photo', 'video'].includes(doc.type)) {\n      icoDiv.innerHTML = `<img src=\"${cacheContext.url}\">`;\n      imgs.push(icoDiv.firstElementChild as HTMLImageElement);\n    } else {\n      const perf = performance.now();\n      const wrapped = await wrapPhoto({\n        photo: doc,\n        message: null,\n        container: icoDiv,\n        boxWidth: 54,\n        boxHeight: 54,\n        loadPromises,\n        withoutPreloader: true,\n        lazyLoadQueue,\n        size: choosePhotoSize(doc, 54, 54, true),\n        managers\n      });\n      // console.log('was wrapping photo', performance.now() - perf);\n      icoDiv.style.width = icoDiv.style.height = '';\n      if(wrapped.images.thumb) imgs.push(wrapped.images.thumb);\n      if(wrapped.images.full) imgs.push(wrapped.images.full);\n    }\n\n    imgs.forEach((img) => img.classList.add('document-thumb'));\n  } else {\n    icoTextEl = document.createElement('span');\n    icoTextEl.classList.add('document-ico-text');\n    icoTextEl.innerText = ext;\n    icoDiv.append(icoTextEl);\n  }\n\n  // let fileName = stringMiddleOverflow(doc.file_name || 'Unknown.file', 26);\n  const fileName = doc.file_name ? wrapPlainText(doc.file_name) : 'Unknown.file';\n  const descriptionEl = document.createElement('div');\n  descriptionEl.classList.add('document-description');\n  const bytesContainer = document.createElement('span');\n  const bytesEl = formatBytes(doc.size);\n  const bytesJoiner = ' / ';\n\n  const descriptionParts: (HTMLElement | string | DocumentFragment)[] = [bytesEl];\n\n  if(withTime) {\n    descriptionParts.push(formatFullSentTime(message.date));\n  }\n\n  if(showSender) {\n    descriptionParts.push(await wrapSenderToPeer(message));\n  }\n\n  if(!withTime && !showSender) {\n    const b = document.createElement('span');\n    const bytesMaxEl = formatBytes(doc.size);\n    b.append(bytesJoiner, bytesMaxEl);\n    b.style.visibility = 'hidden';\n    descriptionParts.push(b);\n  }\n\n  docDiv.innerHTML = `\n  ${(cacheContext.downloaded && !uploadFileName) || !message.mid || !hasThumb ? '' : `<div class=\"document-download\"></div>`}\n  <div class=\"document-name\"></div>\n  <div class=\"document-size\"></div>\n  `;\n\n  const nameDiv = docDiv.querySelector('.document-name') as HTMLElement;\n  const middleEllipsisEl = new MiddleEllipsisElement();\n  middleEllipsisEl.dataset.fontWeight = '' + fontWeight;\n  middleEllipsisEl.dataset.sizeType = sizeType;\n  middleEllipsisEl.textContent = fileName;\n  // setInnerHTML(middleEllipsisEl, fileName);\n\n  // * new media popup\n  if(!message.mid) {\n    docDiv.classList.add('downloaded');\n  }\n\n  nameDiv.append(middleEllipsisEl);\n\n  if(showSender) {\n    nameDiv.append(wrapSentTime(message));\n  }\n\n  const sizeDiv = docDiv.querySelector('.document-size') as HTMLElement;\n  bytesContainer.append(...joinElementsWith(descriptionParts, '  '));\n  sizeDiv.append(bytesContainer);\n\n  docDiv.prepend(icoDiv);\n\n  if(!uploadFileName && message.pFlags.is_outgoing && !message.mid) {\n    return docDiv;\n  }\n\n  let downloadDiv: HTMLElement, preloader: ProgressivePreloader = null;\n  const onLoad = () => {\n    docDiv.classList.remove('downloading');\n\n    if(/* !hasThumb ||  */(doc.size > MAX_FILE_SAVE_SIZE && !uploadFileName)) {\n      preloader.setManual();\n      preloader.attach(downloadDiv);\n      preloader.preloader.classList.add('manual');\n      preloader.setDownloadFunction(load);\n      return;\n    }\n\n    if(doc.size <= MAX_FILE_SAVE_SIZE) {\n      docDiv.classList.add('downloaded');\n    }\n\n    if(downloadDiv) {\n      if(downloadDiv !== icoDiv) {\n        const _downloadDiv = downloadDiv;\n        setTimeout(() => {\n          _downloadDiv.remove();\n        }, 200);\n      }\n\n      downloadDiv = null;\n    }\n\n    if(preloader) {\n      preloader = null;\n    }\n  };\n\n  const addByteProgress = (promise: CancellablePromise<any>) => {\n    docDiv.classList.add('downloading');\n\n    const sizeContainer = document.createElement('span');\n    const _bytesContainer = formatBytes(doc.size);\n    sizeContainer.style.position = 'absolute';\n    sizeContainer.style.left = '0';\n    promise.then(onLoad, noop).finally(() => {\n      // sizeContainer.replaceWith(bytesContainer);\n      bytesContainer.style.visibility = '';\n      sizeContainer.remove();\n      // b && b.classList.remove('hide');\n    });\n\n    // b && b.classList.add('hide');\n\n    const format = (bytes: number) => formatBytes(bytes);\n    let d = format(0);\n    bytesContainer.style.visibility = 'hidden';\n    // bytesContainer.replaceWith(sizeContainer);\n    sizeContainer.append(d, bytesJoiner, _bytesContainer);\n    bytesContainer.parentElement.append(sizeContainer);\n    promise.addNotifyListener((progress: Progress) => {\n      const _d = format(progress.done);\n      d.replaceWith(_d);\n      d = _d;\n    });\n  };\n\n  // ! DO NOT USE ASYNC/AWAIT HERE ! SAFARI WON'T LET DOWNLOAD THE FILE BECAUSE OF ASYNC\n  const load = (e?: Event) => {\n    const save = !e || e.isTrusted;\n    const doc = (docDiv as any).doc;\n    // const doc = await managers.appDocsManager.getDoc(docDiv.dataset.docId);\n    let download: CancellablePromise<any>;\n    const queueId = appImManager.chat.bubbles ? appImManager.chat.bubbles.lazyLoadQueue.queueId : undefined;\n    if(!save) {\n      download = appDownloadManager.downloadToDisc({media: doc, queueId}, true);\n    } else if(doc.type === 'pdf') {\n      const canOpenAfter = /* managers.appDocsManager.downloading.has(doc.id) ||  */!preloader || preloader.detached;\n      download = appDownloadManager.downloadMediaURL({media: doc, queueId});\n      if(canOpenAfter) {\n        download.then(() => {\n          setTimeout(async() => { // wait for preloader animation end\n            const url = (await getCacheContext()).url;\n            window.open(url);\n          }, rootScope.settings.animationsEnabled ? 250 : 0);\n        });\n      }\n    } else if(MEDIA_MIME_TYPES_SUPPORTED.has(doc.mime_type) && doc.thumbs?.length) {\n      download = appDownloadManager.downloadMediaURL({media: doc, queueId});\n    } else {\n      download = appDownloadManager.downloadToDisc({media: doc, queueId});\n    }\n\n    download.catch(() => {\n      docDiv.classList.remove('downloading');\n    });\n\n    if(downloadDiv) {\n      preloader.attach(downloadDiv, true, download);\n      addByteProgress(download);\n    }\n  };\n\n  const {fileName: downloadFileName} = getDownloadMediaDetails({media: doc, downloadId: '1'});\n  if(await managers.apiFileManager.isDownloading(downloadFileName)) {\n    downloadDiv = docDiv.querySelector('.document-download') || icoDiv;\n    const promise = appDownloadManager.downloadToDisc({media: doc}, true);\n\n    preloader = new ProgressivePreloader();\n    preloader.attach(downloadDiv, false, promise);\n    preloader.setDownloadFunction(load);\n    addByteProgress(promise);\n  } else if(!cacheContext.downloaded || uploadFileName) {\n    downloadDiv = docDiv.querySelector('.document-download') || icoDiv;\n    preloader = new ProgressivePreloader({\n      isUpload: !!uploadFileName\n    });\n\n    if(!uploadFileName) {\n      preloader.construct();\n      preloader.setManual();\n      preloader.attach(downloadDiv);\n      preloader.setDownloadFunction(load);\n\n      if(autoDownloadSize !== undefined && autoDownloadSize >= doc.size) {\n        simulateClickEvent(preloader.preloader);\n      }\n    } else {\n      const uploadPromise = appDownloadManager.getUpload(uploadFileName);\n      preloader.attachPromise(uploadPromise);\n      preloader.attach(downloadDiv);\n      addByteProgress(uploadPromise);\n    }\n  }\n\n  attachClickEvent(docDiv, (e) => {\n    if(preloader) {\n      preloader.onClick(e);\n    } else {\n      load(e);\n    }\n  });\n\n  return docDiv;\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport setInnerHTML from '../../helpers/dom/setInnerHTML';\nimport {MediaSizeType} from '../../helpers/mediaSizes';\nimport {Message} from '../../layer';\nimport {AppManagers} from '../../lib/appManagers/managers';\nimport wrapRichText from '../../lib/richTextProcessor/wrapRichText';\nimport {MediaSearchContext} from '../appMediaPlaybackController';\nimport Chat from '../chat/chat';\nimport LazyLoadQueue from '../lazyLoadQueue';\nimport wrapDocument from './document';\n\nexport default async function wrapGroupedDocuments({albumMustBeRenderedFull, message, bubble, messageDiv, chat, loadPromises, autoDownloadSize, lazyLoadQueue, searchContext, useSearch, sizeType, managers}: {\n  albumMustBeRenderedFull: boolean,\n  message: any,\n  messageDiv: HTMLElement,\n  bubble: HTMLElement,\n  uploading?: boolean,\n  chat: Chat,\n  loadPromises?: Promise<any>[],\n  autoDownloadSize?: number,\n  lazyLoadQueue?: LazyLoadQueue,\n  searchContext?: MediaSearchContext,\n  useSearch?: boolean,\n  sizeType?: MediaSizeType,\n  managers?: AppManagers\n}) {\n  let nameContainer: HTMLElement;\n  const mids = albumMustBeRenderedFull ? await chat.getMidsByMid(message.mid) : [message.mid];\n  /* if(isPending) {\n    mids.reverse();\n  } */\n\n  const promises = mids.map(async(mid, idx) => {\n    const message = (await chat.getMessage(mid)) as Message.message;\n    const div = await wrapDocument({\n      message,\n      loadPromises,\n      autoDownloadSize,\n      lazyLoadQueue,\n      searchContext,\n      sizeType,\n      managers\n    });\n\n    const container = document.createElement('div');\n    container.classList.add('document-container');\n    container.dataset.mid = '' + mid;\n    container.dataset.peerId = '' + message.peerId;\n\n    const wrapper = document.createElement('div');\n    wrapper.classList.add('document-wrapper');\n\n    if(message.message) {\n      const messageDiv = document.createElement('div');\n      messageDiv.classList.add('document-message');\n\n      const richText = wrapRichText(message.message, {\n        entities: message.totalEntities\n      });\n\n      setInnerHTML(messageDiv, richText);\n      wrapper.append(messageDiv);\n    }\n\n    if(mids.length > 1) {\n      const selection = document.createElement('div');\n      selection.classList.add('document-selection');\n      container.append(selection);\n\n      container.classList.add('grouped-item');\n\n      if(idx === 0) {\n        nameContainer = wrapper;\n      }\n    }\n\n    wrapper.append(div);\n    container.append(wrapper);\n    return container;\n  });\n\n  const containers = await Promise.all(promises);\n  messageDiv.append(...containers);\n\n  if(mids.length > 1) {\n    bubble.classList.add('is-multiple-documents', 'is-grouped');\n  }\n\n  return nameContainer;\n}\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport {SliderSuperTab} from '../../slider';\r\nimport appSidebarRight from '..';\r\nimport {roundPercents} from '../../poll';\r\nimport appDialogsManager from '../../../lib/appManagers/appDialogsManager';\r\nimport ripple from '../../ripple';\r\nimport {i18n} from '../../../lib/langPack';\r\nimport setInnerHTML from '../../../helpers/dom/setInnerHTML';\r\nimport wrapEmojiText from '../../../lib/richTextProcessor/wrapEmojiText';\r\n\r\nexport default class AppPollResultsTab extends SliderSuperTab {\r\n  private resultsDiv: HTMLElement;\r\n\r\n  protected init() {\r\n    this.container.id = 'poll-results-container';\r\n    this.container.classList.add('chatlist-container');\r\n\r\n    this.resultsDiv = document.createElement('div');\r\n    this.resultsDiv.classList.add('poll-results');\r\n    this.scrollable.append(this.resultsDiv);\r\n  }\r\n\r\n  public async open(message: any) {\r\n    const ret = super.open();\r\n    const poll = await this.managers.appPollsManager.getPoll(message.media.poll.id);\r\n\r\n    this.setTitle(poll.poll.pFlags.quiz ? 'PollResults.Title.Quiz' : 'PollResults.Title.Poll');\r\n\r\n    const title = document.createElement('h3');\r\n    setInnerHTML(title, wrapEmojiText(poll.poll.question));\r\n\r\n    const percents = poll.results.results.map((v) => v.voters / poll.results.total_voters * 100);\r\n    roundPercents(percents);\r\n\r\n    const fragment = document.createDocumentFragment();\r\n    poll.results.results.forEach((result, idx) => {\r\n      if(!result.voters) return;\r\n\r\n      const hr = document.createElement('hr');\r\n\r\n      const answer = poll.poll.answers[idx];\r\n\r\n      // Head\r\n      const answerEl = document.createElement('div');\r\n      answerEl.classList.add('poll-results-answer');\r\n\r\n      const answerTitle = document.createElement('div');\r\n      setInnerHTML(answerTitle, wrapEmojiText(answer.text));\r\n\r\n      const answerPercents = document.createElement('div');\r\n      answerPercents.innerText = Math.round(percents[idx]) + '%';\r\n\r\n      answerEl.append(answerTitle, answerPercents);\r\n\r\n      // Humans\r\n      const list = appDialogsManager.createChatList();\r\n      list.classList.add('poll-results-voters');\r\n\r\n      appDialogsManager.setListClickListener(list, () => {\r\n        appSidebarRight.onCloseBtnClick();\r\n      }, undefined, true);\r\n\r\n      list.style.minHeight = Math.min(result.voters, 4) * 50 + 'px';\r\n\r\n      fragment.append(hr, answerEl, list);\r\n\r\n      let offset: string, limit = 4, loading = false, left = result.voters - 4;\r\n      const load = () => {\r\n        if(loading) return;\r\n        loading = true;\r\n\r\n        this.managers.appPollsManager.getVotes(message, answer.option, offset, limit).then((votesList) => {\r\n          votesList.votes.forEach((vote) => {\r\n            const {dom} = appDialogsManager.addDialogNew({\r\n              peerId: vote.user_id.toPeerId(false),\r\n              container: list,\r\n              rippleEnabled: false,\r\n              meAsSaved: false,\r\n              avatarSize: 32\r\n            });\r\n            dom.lastMessageSpan.parentElement.remove();\r\n          });\r\n\r\n          if(offset) {\r\n            left -= votesList.votes.length;\r\n            (showMore.lastElementChild as HTMLElement).replaceWith(i18n('PollResults.LoadMore', [Math.min(20, left)]));\r\n          }\r\n\r\n          offset = votesList.next_offset;\r\n          limit = 20;\r\n\r\n          if(!left || !votesList.votes.length) {\r\n            showMore.remove();\r\n          }\r\n        }).finally(() => {\r\n          loading = false;\r\n        });\r\n      };\r\n\r\n      load();\r\n\r\n      if(left <= 0) return;\r\n\r\n      const showMore = document.createElement('div');\r\n      showMore.classList.add('poll-results-more', 'show-more', 'rp-overflow');\r\n      showMore.addEventListener('click', load);\r\n      ripple(showMore);\r\n      const down = document.createElement('div');\r\n      down.classList.add('tgico-down');\r\n      showMore.append(down, i18n('PollResults.LoadMore', [Math.min(20, left)]));\r\n\r\n      fragment.append(showMore);\r\n    });\r\n\r\n    this.resultsDiv.append(title, fragment);\r\n\r\n    appSidebarRight.toggleSidebar(true).then(() => {\r\n      /* appPollsManager.getVotes(mid).then((votes) => {\r\n        console.log('gOt VotEs', votes);\r\n      }); */\r\n    });\r\n\r\n    return ret;\r\n  }\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport mediaSizes from '../helpers/mediaSizes';\r\nimport IS_TOUCH_SUPPORTED from '../environment/touchSupport';\r\nimport appImManager from '../lib/appManagers/appImManager';\r\nimport rootScope from '../lib/rootScope';\r\nimport ripple from './ripple';\r\nimport appSidebarRight from './sidebarRight';\r\nimport AppPollResultsTab from './sidebarRight/tabs/pollResults';\r\nimport {FormatterArguments, i18n, LangPackKey} from '../lib/langPack';\r\nimport {fastRaf} from '../helpers/schedulers';\r\nimport SetTransition from './singleTransition';\r\nimport findUpClassName from '../helpers/dom/findUpClassName';\r\nimport cancelEvent from '../helpers/dom/cancelEvent';\r\nimport {attachClickEvent, detachClickEvent, simulateClickEvent} from '../helpers/dom/clickEvent';\r\nimport replaceContent from '../helpers/dom/replaceContent';\r\nimport windowSize from '../helpers/windowSize';\r\nimport {Message, MessageMedia, Poll, PollResults} from '../layer';\r\nimport toHHMMSS from '../helpers/string/toHHMMSS';\r\nimport StackedAvatars from './stackedAvatars';\r\nimport setInnerHTML from '../helpers/dom/setInnerHTML';\r\nimport {AppManagers} from '../lib/appManagers/managers';\r\nimport wrapEmojiText from '../lib/richTextProcessor/wrapEmojiText';\r\nimport wrapRichText from '../lib/richTextProcessor/wrapRichText';\r\n\r\nlet lineTotalLength = 0;\r\nconst tailLength = 9;\r\nconst times = 10;\r\nconst fullTime = 340;\r\nconst oneTime = fullTime / times;\r\n\r\nexport const roundPercents = (percents: number[]) => {\r\n  // console.log('roundPercents before percents:', percents);\r\n\r\n  const sum = percents.reduce((acc, p) => acc + Math.round(p), 0);\r\n  if(sum > 100) {\r\n    const diff = sum - 100;\r\n    const length = percents.length;\r\n    for(let i = 0; i < diff; ++i) {\r\n      let minIndex = -1, minRemainder = 1;\r\n      for(let k = 0; k < length; ++k) {\r\n        const remainder = percents[k] % 1;\r\n        if(remainder >= 0.5 && remainder < minRemainder) {\r\n          minRemainder = remainder;\r\n          minIndex = k;\r\n        }\r\n      }\r\n\r\n      if(minIndex === -1) {\r\n        // throw new Error('lol chto');\r\n        return;\r\n      }\r\n\r\n      percents[minIndex] -= minRemainder;\r\n    }\r\n  } else if(sum < 100) {\r\n    const diff = 100 - sum;\r\n    const length = percents.length;\r\n    for(let i = 0; i < diff; ++i) {\r\n      let minIndex = -1, maxRemainder = 0;\r\n      for(let k = 0; k < length; ++k) {\r\n        const remainder = percents[k] % 1;\r\n        if(remainder < 0.5 && remainder > maxRemainder) {\r\n          maxRemainder = remainder;\r\n          minIndex = k;\r\n        }\r\n      }\r\n\r\n      if(minIndex === -1) {\r\n        // throw new Error('lol chto');\r\n        return;\r\n      }\r\n\r\n      percents[minIndex] += 1 - maxRemainder;\r\n    }\r\n  }\r\n\r\n  // console.log('roundPercents after percents:', percents);\r\n};\r\n\r\n/* const connectedPolls: {id: string, element: PollElement}[] = [];\r\nrootScope.on('poll_update', (e) => {\r\n  const {poll, results} = e as {poll: Poll, results: PollResults};\r\n\r\n  //console.log('poll_update', poll, results);\r\n  for(const connected of connectedPolls) {\r\n    if(connected.id === poll.id) {\r\n      const pollElement = connected.element;\r\n      pollElement.isClosed = !!poll.pFlags.closed;\r\n      pollElement.performResults(results, poll.chosenIndexes);\r\n    }\r\n  }\r\n}); */\r\n\r\nrootScope.addEventListener('poll_update', ({poll, results}) => {\r\n  const pollElements = Array.from(document.querySelectorAll(`poll-element[poll-id=\"${poll.id}\"]`)) as PollElement[];\r\n  pollElements.forEach((pollElement) => {\r\n    // console.log('poll_update', poll, results);\r\n    pollElement.isClosed = !!poll.pFlags.closed;\r\n    pollElement.performResults(results, poll.chosenIndexes);\r\n  });\r\n});\r\n\r\nmediaSizes.addEventListener('resize', () => {\r\n  PollElement.setMaxLength();\r\n  PollElement.resizePolls();\r\n});\r\n\r\nmediaSizes.addEventListener('changeScreen', () => {\r\n  PollElement.setMaxLength();\r\n});\r\n\r\nconst hideQuizHint = (element: HTMLElement, onHide: () => void, timeout: number) => {\r\n  element.classList.remove('active');\r\n\r\n  clearTimeout(timeout);\r\n  setTimeout(() => {\r\n    onHide();\r\n    element.remove();\r\n\r\n    if(prevQuizHint === element && prevQuizHintOnHide === onHide && prevQuizHintTimeout === timeout) {\r\n      prevQuizHint = prevQuizHintOnHide = null;\r\n      prevQuizHintTimeout = 0;\r\n    }\r\n  }, 200);\r\n};\r\n\r\nlet prevQuizHint: HTMLElement, prevQuizHintOnHide: () => void, prevQuizHintTimeout: number;\r\nlet isListenerSet = false;\r\nconst setQuizHint = (solution: string, solution_entities: any[], onHide: () => void) => {\r\n  if(prevQuizHint) {\r\n    hideQuizHint(prevQuizHint, prevQuizHintOnHide, prevQuizHintTimeout);\r\n  }\r\n\r\n  const element = document.createElement('div');\r\n  element.classList.add('quiz-hint');\r\n\r\n  const container = document.createElement('div');\r\n  container.classList.add('container', 'tgico');\r\n\r\n  const textEl = document.createElement('div');\r\n  textEl.classList.add('text');\r\n\r\n  container.append(textEl);\r\n  element.append(container);\r\n\r\n  setInnerHTML(textEl, wrapRichText(solution, {entities: solution_entities}));\r\n  appImManager.chat.bubbles.container.append(element);\r\n\r\n  void element.offsetLeft; // reflow\r\n  element.classList.add('active');\r\n\r\n  prevQuizHint = element;\r\n  prevQuizHintOnHide = onHide;\r\n  prevQuizHintTimeout = window.setTimeout(() => {\r\n    hideQuizHint(element, onHide, prevQuizHintTimeout);\r\n  }, IS_TOUCH_SUPPORTED ? 5000 : 7000);\r\n\r\n  if(!isListenerSet) {\r\n    isListenerSet = true;\r\n    appImManager.addEventListener('peer_changed', () => {\r\n      if(prevQuizHint) {\r\n        hideQuizHint(prevQuizHint, prevQuizHintOnHide, prevQuizHintTimeout);\r\n      }\r\n    });\r\n  }\r\n};\r\n\r\nexport default class PollElement extends HTMLElement {\r\n  public static MAX_OFFSET = -46.5;\r\n  public static MAX_LENGTH = 0;\r\n  public svgLines: SVGSVGElement[];\r\n  private numberDivs: HTMLDivElement[];\r\n  private answerDivs: HTMLDivElement[];\r\n  private descDiv: HTMLElement;\r\n  private typeDiv: HTMLElement;\r\n  private avatarsDiv: HTMLElement;\r\n  private viewResults: HTMLElement;\r\n  private votersCountDiv: HTMLDivElement;\r\n\r\n  // private maxLength: number;\r\n  // private maxLengths: number[];\r\n  private maxPercents: number[];\r\n\r\n  public isClosed = false;\r\n  private isQuiz = false;\r\n  private isRetracted = false;\r\n  private isPublic = false;\r\n  private isMultiple = false;\r\n  private chosenIndexes: number[] = [];\r\n  private percents: number[];\r\n\r\n  public message: Message.message;\r\n  public managers: AppManagers;\r\n\r\n  private quizInterval: number;\r\n  private quizTimer: SVGSVGElement;\r\n\r\n  private sendVoteBtn: HTMLElement;\r\n  private chosingIndexes: number[] = [];\r\n\r\n  private sendVotePromise: Promise<void>;\r\n  private sentVote = false;\r\n\r\n  public static setMaxLength() {\r\n    const width = windowSize.width <= 360 ? windowSize.width - 120 : mediaSizes.active.poll.width;\r\n    this.MAX_LENGTH = width + tailLength + this.MAX_OFFSET + -13.7; // 13 - position left\r\n  }\r\n\r\n  public static resizePolls() {\r\n    if(!this.MAX_LENGTH) return;\r\n    const pollElements = Array.from(document.querySelectorAll('poll-element.is-voted')) as PollElement[];\r\n    pollElements.forEach((pollElement) => {\r\n      pollElement.svgLines.forEach((svg, idx) => {\r\n        // void svg.getBoundingClientRect(); // reflow\r\n        pollElement.setLineProgress(idx, 1);\r\n      });\r\n    });\r\n  }\r\n\r\n  public async render() {\r\n    //         \r\n    // (   ,    /)\r\n\r\n    if(!lineTotalLength) {\r\n      lineTotalLength = (document.getElementById('poll-line') as any as SVGPathElement).getTotalLength();\r\n      // console.log('line total length:', lineTotalLength);\r\n      PollElement.setMaxLength();\r\n    }\r\n\r\n    // const {poll, results} = this.managers.appPollsManager.getPoll(pollId);\r\n    const {poll, results} = this.message.media as MessageMedia.messageMediaPoll;\r\n\r\n    /* const timestamp = Date.now() / 1000 | 0;\r\n    if(timestamp < this.message.date) { */\r\n    if(this.message.pFlags.is_scheduled) {\r\n      this.classList.add('disable-hover');\r\n    }\r\n\r\n    // console.log('pollElement poll:', poll, results);\r\n\r\n    let descKey: LangPackKey;\r\n    if(poll.pFlags) {\r\n      this.isPublic = !!poll.pFlags.public_voters;\r\n      this.isQuiz = !!poll.pFlags.quiz;\r\n      this.isClosed = !!poll.pFlags.closed;\r\n      this.isMultiple = !!poll.pFlags.multiple_choice;\r\n\r\n      if(this.isClosed) {\r\n        descKey = 'Chat.Poll.Type.Closed';\r\n        this.classList.add('is-closed');\r\n      } else if(this.isQuiz) {\r\n        descKey = this.isPublic ? 'Chat.Poll.Type.Quiz' : 'Chat.Poll.Type.AnonymousQuiz';\r\n      } else {\r\n        descKey = this.isPublic ? 'Chat.Poll.Type.Public' : 'Chat.Poll.Type.Anonymous';\r\n      }\r\n    }\r\n\r\n    this.classList.toggle('is-multiple', this.isMultiple);\r\n\r\n    const multipleSelect = this.isMultiple ? '<span class=\"poll-answer-selected tgico-check\"></span>' : '';\r\n    const votes = poll.answers.map((answer, idx) => {\r\n      return `\r\n        <div class=\"poll-answer\" data-index=\"${idx}\">\r\n          <div class=\"circle-hover\">\r\n            <div class=\"animation-ring\"></div>\r\n            <svg class=\"progress-ring\">\r\n              <circle class=\"progress-ring__circle\" cx=\"13\" cy=\"13\" r=\"9\"></circle>\r\n            </svg>\r\n            ${multipleSelect}\r\n          </div>\r\n          <div class=\"poll-answer-percents\"></div>\r\n          <div class=\"poll-answer-text\"></div>\r\n          <svg version=\"1.1\" class=\"poll-line\" style=\"display: none;\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" viewBox=\"0 0 485.9 35\" xml:space=\"preserve\">\r\n            <use href=\"#poll-line\"></use>\r\n          </svg>\r\n          <span class=\"poll-answer-selected tgico\"></span>\r\n        </div>\r\n      `;\r\n    }).join('');\r\n\r\n    this.innerHTML = `\r\n      <div class=\"poll-title\"></div>\r\n      <div class=\"poll-desc\">\r\n        <div class=\"poll-type\"></div>\r\n        <div class=\"poll-avatars\"></div>\r\n      </div>\r\n      ${votes}`;\r\n\r\n    setInnerHTML(this.firstElementChild, wrapEmojiText(poll.question));\r\n\r\n    Array.from(this.querySelectorAll('.poll-answer-text')).forEach((el, idx) => {\r\n      setInnerHTML(el, wrapEmojiText(poll.answers[idx].text));\r\n    });\r\n\r\n    this.descDiv = this.firstElementChild.nextElementSibling as HTMLElement;\r\n    this.typeDiv = this.descDiv.firstElementChild as HTMLElement;\r\n    this.avatarsDiv = this.descDiv.lastElementChild as HTMLElement;\r\n\r\n    if(descKey) {\r\n      this.typeDiv.append(i18n(descKey));\r\n    }\r\n\r\n    if(this.isQuiz) {\r\n      this.classList.add('is-quiz');\r\n\r\n      if(poll.close_period && poll.close_date) {\r\n        const timeLeftDiv = document.createElement('div');\r\n        timeLeftDiv.classList.add('poll-time');\r\n        this.descDiv.append(timeLeftDiv);\r\n\r\n        const svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');\r\n        // svg.setAttributeNS(null, 'viewBox', '0 0 15 15');\r\n        svg.classList.add('poll-quiz-timer');\r\n\r\n        this.quizTimer = svg;\r\n\r\n        const strokeWidth = 2;\r\n        const radius = 7;\r\n        const circumference = 2 * Math.PI * radius;\r\n\r\n        const circle = document.createElementNS('http://www.w3.org/2000/svg', 'circle');\r\n        circle.classList.add('poll-quiz-timer-circle');\r\n        circle.setAttributeNS(null, 'cx', '16');\r\n        circle.setAttributeNS(null, 'cy', '16');\r\n        circle.setAttributeNS(null, 'r', '' + radius);\r\n        circle.setAttributeNS(null, 'stroke-width', '' + strokeWidth);\r\n\r\n        svg.append(circle);\r\n        this.descDiv.append(svg);\r\n\r\n        const period = poll.close_period * 1000;\r\n        const closeTime = (poll.close_date - await rootScope.managers.timeManager.getServerTimeOffset()) * 1000;\r\n\r\n        // console.log('closeTime:', poll.close_date, serverTimeManager.serverTimeOffset, Date.now() / 1000 | 0);\r\n\r\n        // let time = Date.now();\r\n        // let percents = (closeTime - time) / period;\r\n\r\n        // timeLeftDiv.innerHTML = String((closeTime - time) / 1000 + 1 | 0).toHHMMSS();\r\n\r\n        // // @ts-ignore\r\n        // circle.style.strokeDashoffset = circumference + percents * circumference;\r\n        // circle.style.strokeDasharray = ${circumference} ${circumference};\r\n\r\n        this.quizInterval = window.setInterval(() => {\r\n          const time = Date.now();\r\n          const percents = (closeTime - time) / period;\r\n          const timeLeft = (closeTime - time) / 1000 + 1 | 0;\r\n          timeLeftDiv.innerHTML = toHHMMSS(timeLeft);\r\n\r\n          if(timeLeft <= 5) {\r\n            timeLeftDiv.style.color = '#ee545c';\r\n            circle.style.stroke = '#ee545c';\r\n          }\r\n          // timeLeftDiv.style.visibility = 'visible';\r\n\r\n          // @ts-ignore\r\n          circle.style.strokeDashoffset = circumference + percents * circumference;\r\n          circle.style.strokeDasharray = `${circumference} ${circumference}`;\r\n\r\n          if(time >= closeTime) {\r\n            clearInterval(this.quizInterval);\r\n            timeLeftDiv.innerHTML = '';\r\n            // @ts-ignore\r\n            circle.style.strokeDashoffset = circumference;\r\n            this.quizInterval = 0;\r\n\r\n            setTimeout(() => {\r\n              //      \r\n              this.managers.appPollsManager.getResults(this.message);\r\n            }, 3e3);\r\n          }\r\n        }, 1e3);\r\n      }\r\n    }\r\n\r\n    this.answerDivs = Array.from(this.querySelectorAll('.poll-answer')) as HTMLDivElement[];\r\n    this.svgLines = Array.from(this.querySelectorAll('.poll-line')) as SVGSVGElement[];\r\n    this.numberDivs = Array.from(this.querySelectorAll('.poll-answer-percents')) as HTMLDivElement[];\r\n\r\n    const footerDiv = document.createElement('div');\r\n    footerDiv.classList.add('poll-footer');\r\n\r\n    this.viewResults = document.createElement('div');\r\n    this.viewResults.className = 'poll-footer-button poll-view-results hide';\r\n    this.viewResults.append(i18n('Chat.Poll.ViewResults'));\r\n\r\n    this.votersCountDiv = document.createElement('div');\r\n    this.votersCountDiv.className = 'poll-votes-count';\r\n\r\n    footerDiv.append(this.viewResults, this.votersCountDiv);\r\n    this.append(footerDiv);\r\n\r\n    this.viewResults.addEventListener('click', (e) => {\r\n      cancelEvent(e);\r\n\r\n      if(!appSidebarRight.isTabExists(AppPollResultsTab)) {\r\n        appSidebarRight.createTab(AppPollResultsTab).open(this.message);\r\n      }\r\n    });\r\n    ripple(this.viewResults);\r\n\r\n    if(this.isMultiple) {\r\n      this.sendVoteBtn = document.createElement('div');\r\n      this.sendVoteBtn.classList.add('poll-footer-button', 'poll-send-vote');\r\n      this.sendVoteBtn.append(i18n('Chat.Poll.SubmitVote'));\r\n      ripple(this.sendVoteBtn);\r\n\r\n      if(!poll.chosenIndexes.length) {\r\n        this.votersCountDiv.classList.add('hide');\r\n      }\r\n\r\n      attachClickEvent(this.sendVoteBtn, (e) => {\r\n        cancelEvent(e);\r\n        /* const indexes = this.answerDivs.filter((el) => el.classList.contains('is-chosing')).map((el) => +el.dataset.index);\r\n        if(indexes.length) {\r\n\r\n        } */\r\n        if(this.chosingIndexes.length) {\r\n          this.sendVotes(this.chosingIndexes).then(() => {\r\n            this.chosingIndexes.length = 0;\r\n            this.answerDivs.forEach((el) => {\r\n              el.classList.remove('is-chosing');\r\n            });\r\n          });\r\n        }\r\n      });\r\n\r\n      footerDiv.append(this.sendVoteBtn);\r\n    }\r\n\r\n    // const width = this.getBoundingClientRect().width;\r\n    // const width = mediaSizes.active.poll.width;\r\n    // this.maxLength = width + tailLength + this.maxOffset + -13.7; // 13 - position left\r\n\r\n    const canVote = !(poll.chosenIndexes.length || this.isClosed);\r\n    if(!canVote || this.isPublic) {\r\n      this.performResults(results, poll.chosenIndexes, false);\r\n    }\r\n\r\n    if(canVote) {\r\n      this.setVotersCount(results);\r\n      attachClickEvent(this, this.clickHandler);\r\n    }\r\n  }\r\n\r\n  initQuizHint(results: PollResults) {\r\n    if(results.solution && results.solution_entities) {\r\n      const toggleHint = document.createElement('div');\r\n      toggleHint.classList.add('tgico-tip', 'poll-hint');\r\n      this.descDiv.append(toggleHint);\r\n\r\n      // let active = false;\r\n      attachClickEvent(toggleHint, (e) => {\r\n        cancelEvent(e);\r\n\r\n        // active = true;\r\n        toggleHint.classList.add('active');\r\n        setQuizHint(results.solution, results.solution_entities, () => {\r\n          // active = false;\r\n          toggleHint.classList.remove('active');\r\n        });\r\n      });\r\n\r\n      if(this.sentVote) {\r\n        const correctResult = results.results.find((r) => r.pFlags.correct);\r\n        if(correctResult && !correctResult.pFlags.chosen) {\r\n          simulateClickEvent(toggleHint);\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  clickHandler(e: Event) {\r\n    const target = findUpClassName(e.target, 'poll-answer') as HTMLElement;\r\n    if(!target) {\r\n      return;\r\n    }\r\n\r\n    cancelEvent(e);\r\n    const answerIndex = +target.dataset.index;\r\n    if(this.isMultiple) {\r\n      target.classList.toggle('is-chosing');\r\n\r\n      const foundIndex = this.chosingIndexes.indexOf(answerIndex);\r\n      if(foundIndex !== -1) {\r\n        this.chosingIndexes.splice(foundIndex, 1);\r\n      } else {\r\n        this.chosingIndexes.push(answerIndex);\r\n      }\r\n    } else {\r\n      this.sendVotes([answerIndex]);\r\n    }\r\n\r\n    /* target.classList.add('is-voting');\r\n    setTimeout(() => { // simulate\r\n      this.setResults([100, 0], answerIndex);\r\n      target.classList.remove('is-voting');\r\n    }, 1000); */\r\n  }\r\n\r\n  sendVotes(indexes: number[]) {\r\n    if(this.sendVotePromise) return this.sendVotePromise;\r\n\r\n    const targets = this.answerDivs.filter((_, idx) => indexes.includes(idx));\r\n    targets.forEach((target) => {\r\n      target.classList.add('is-voting');\r\n    });\r\n\r\n    this.classList.add('disable-hover');\r\n    this.sentVote = true;\r\n    return this.sendVotePromise = this.managers.appPollsManager.sendVote(this.message, indexes).then(() => {\r\n      targets.forEach((target) => {\r\n        target.classList.remove('is-voting');\r\n      });\r\n\r\n      this.classList.remove('disable-hover');\r\n    }).catch(() => {\r\n      this.sentVote = false;\r\n    }).finally(() => {\r\n      this.sendVotePromise = null;\r\n    });\r\n  }\r\n\r\n  performResults(results: PollResults, chosenIndexes: number[], animate = true) {\r\n    if(!rootScope.settings.animationsEnabled) {\r\n      animate = false;\r\n    }\r\n\r\n    if(this.isQuiz && (results.results?.length || this.isClosed)) {\r\n      this.answerDivs.forEach((el, idx) => {\r\n        el.classList.toggle('is-correct', !!results.results[idx].pFlags.correct);\r\n      });\r\n\r\n      if(this.initQuizHint) {\r\n        this.initQuizHint(results);\r\n        this.initQuizHint = null;\r\n      }\r\n\r\n      if(this.quizInterval) {\r\n        clearInterval(this.quizInterval);\r\n        this.quizInterval = 0;\r\n      }\r\n\r\n      if(this.quizTimer?.parentElement) {\r\n        this.quizTimer.remove();\r\n      }\r\n\r\n      const timeEl = this.descDiv.querySelector('.poll-time');\r\n      if(timeEl) {\r\n        timeEl.remove();\r\n      }\r\n    }\r\n\r\n    if(this.isClosed) {\r\n      this.classList.add('is-closed');\r\n      replaceContent(this.typeDiv, i18n('Chat.Poll.Type.Closed'));\r\n    }\r\n\r\n    // set chosen\r\n    if(this.chosenIndexes.length !== chosenIndexes.length || this.isClosed) { // if we voted\r\n      this.isRetracted = this.chosenIndexes.length && !chosenIndexes.length;\r\n      this.chosenIndexes = chosenIndexes.slice();\r\n\r\n      if(this.isRetracted) {\r\n        attachClickEvent(this, this.clickHandler);\r\n      } else {\r\n        detachClickEvent(this, this.clickHandler);\r\n      }\r\n    }\r\n\r\n    // is need update\r\n    if(this.chosenIndexes.length || this.isRetracted || this.isClosed) {\r\n      const percents = results.results.map((v) => results.total_voters ? v.voters / results.total_voters * 100 : 0);\r\n\r\n      this.classList.toggle('no-transition', !animate);\r\n      if(animate) {\r\n        SetTransition(this, '', !this.isRetracted, 340);\r\n      }\r\n\r\n      fastRaf(() => {\r\n        this.setResults(this.isRetracted ? this.percents : percents, this.chosenIndexes, animate);\r\n        this.percents = percents;\r\n        this.isRetracted = false;\r\n      });\r\n    }\r\n\r\n    this.setVotersCount(results);\r\n\r\n    if(this.isPublic) {\r\n      if(!this.isMultiple) {\r\n        this.viewResults.classList.toggle('hide', !results.total_voters || !this.chosenIndexes.length);\r\n        this.votersCountDiv.classList.toggle('hide', !!this.chosenIndexes.length);\r\n      }\r\n\r\n      const peerIds = (results.recent_voters || []).map((userId) => userId.toPeerId());\r\n      const stackedAvatars = new StackedAvatars({avatarSize: 16});\r\n      stackedAvatars.render(peerIds);\r\n      replaceContent(this.avatarsDiv, stackedAvatars.container);\r\n    }\r\n\r\n    if(this.isMultiple) {\r\n      const isVoted = !!this.chosenIndexes.length;\r\n\r\n      const hideSendVoteBtn = this.isClosed || isVoted;\r\n      const hideViewResultsBtn = !this.isPublic || !results.total_voters || (!isVoted && !this.isClosed);\r\n      this.sendVoteBtn.classList.toggle('hide', hideSendVoteBtn);\r\n      this.viewResults.classList.toggle('hide', hideViewResultsBtn);\r\n      this.votersCountDiv.classList.toggle('hide', !hideSendVoteBtn || !hideViewResultsBtn);\r\n    }\r\n  }\r\n\r\n  setResults(percents: number[], chosenIndexes: number[], animate: boolean) {\r\n    this.svgLines.forEach((svg) => svg.style.display = '');\r\n\r\n    this.answerDivs.forEach((el, idx) => {\r\n      el.classList.toggle('is-chosen', chosenIndexes.includes(idx));\r\n    });\r\n\r\n    const maxValue = Math.max(...percents);\r\n    // this.maxLengths = percents.map((p) => p / maxValue * this.maxLength);\r\n    this.maxPercents = percents.map((p) => p / maxValue);\r\n\r\n    // line\r\n    if(this.isRetracted) {\r\n      this.svgLines.forEach((svg, idx) => {\r\n        this.setLineProgress(idx, -1);\r\n      });\r\n    } else {\r\n      const cb = () => {\r\n        this.svgLines.forEach((svg, idx) => {\r\n          // void svg.getBoundingClientRect(); // reflow\r\n          this.setLineProgress(idx, 1);\r\n        });\r\n      };\r\n\r\n      animate ? fastRaf(cb) : cb();\r\n    }\r\n\r\n    percents = percents.slice();\r\n    roundPercents(percents);\r\n    let getPercentValue: (percents: number, index: number) => number;\r\n    const iterate = (i: number) => {\r\n      percents.forEach((percents, idx) => {\r\n        const value = getPercentValue(percents, i);\r\n        this.numberDivs[idx].innerText = value + '%';\r\n      });\r\n    };\r\n    // numbers\r\n    if(this.isRetracted) {\r\n      getPercentValue = (percents, index) => Math.round(percents / times * index);\r\n\r\n      if(animate) {\r\n        for(let i = (times - 1), k = 0; i >= 0; --i, ++k) {\r\n          setTimeout(() => {\r\n            iterate(i);\r\n          }, oneTime * k);\r\n        }\r\n      } else {\r\n        iterate(0);\r\n      }\r\n    } else {\r\n      getPercentValue = (percents, index) => Math.round(percents / times * (index + 1));\r\n\r\n      if(animate) {\r\n        for(let i = 0; i < times; ++i) {\r\n          setTimeout(() => {\r\n            iterate(i);\r\n          }, oneTime * i);\r\n        }\r\n      } else {\r\n        iterate(times - 1);\r\n      }\r\n    }\r\n\r\n    if(this.isRetracted) {\r\n      if(animate) {\r\n        this.classList.add('is-retracting');\r\n      }\r\n\r\n      this.classList.remove('is-voted');\r\n      const cb = () => {\r\n        this.svgLines.forEach((svg) => svg.style.display = 'none');\r\n      };\r\n\r\n      if(animate) {\r\n        setTimeout(() => {\r\n          this.classList.remove('is-retracting');\r\n          cb();\r\n        }, fullTime);\r\n      } else {\r\n        cb();\r\n      }\r\n    } else {\r\n      this.classList.add('is-voted');\r\n    }\r\n  }\r\n\r\n  setVotersCount(results: PollResults) {\r\n    const votersCount = results.total_voters || 0;\r\n    let key: LangPackKey;\r\n    const args: FormatterArguments = [votersCount];\r\n    if(this.isClosed) {\r\n      if(this.isQuiz) key = votersCount ? 'Chat.Quiz.TotalVotes' : 'Chat.Quiz.TotalVotesResultEmpty';\r\n      else key = votersCount ? 'Chat.Poll.TotalVotes1' : 'Chat.Poll.TotalVotesResultEmpty';\r\n    } else {\r\n      if(this.isQuiz) key = votersCount ? 'Chat.Quiz.TotalVotes' : 'Chat.Quiz.TotalVotesEmpty';\r\n      else key = votersCount ? 'Chat.Poll.TotalVotes1' : 'Chat.Poll.TotalVotesEmpty';\r\n    }\r\n\r\n    replaceContent(this.votersCountDiv, i18n(key, args));\r\n  }\r\n\r\n  setLineProgress(index: number, multiplier: number) {\r\n    const svg = this.svgLines[index];\r\n\r\n    if(multiplier === -1) {\r\n      svg.style.strokeDasharray = '';\r\n      svg.style.strokeDashoffset = '';\r\n    } else {\r\n      // svg.style.strokeDasharray = (multiplier * this.maxLengths[index]) + ', 485.9';\r\n      svg.style.strokeDasharray = (multiplier * this.maxPercents[index] * PollElement.MAX_LENGTH) + ', 485.9';\r\n      // svg.style.strokeDasharray = (multiplier * this.maxPercents[index] * 100) + '%, 485.9';\r\n      svg.style.strokeDashoffset = '' + multiplier * PollElement.MAX_OFFSET;\r\n    }\r\n  }\r\n\r\n  //         \r\n}\r\n\r\ncustomElements.define('poll-element', PollElement);\r\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport {AppManagers} from '../../lib/appManagers/managers';\nimport rootScope from '../../lib/rootScope';\nimport PollElement from '../poll';\n\nexport default function wrapPoll(message: any, managers: AppManagers = rootScope.managers) {\n  const elem = new PollElement();\n  elem.message = message;\n  elem.managers = managers;\n  elem.setAttribute('peer-id', '' + message.peerId);\n  elem.setAttribute('poll-id', message.media.poll.id);\n  elem.setAttribute('message-id', '' + message.mid);\n  elem.render();\n  return elem;\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport {hexToRgb} from '../../helpers/color';\nimport {Message} from '../../layer';\nimport getPeerColorById from '../../lib/appManagers/utils/peers/getPeerColorById';\nimport ReplyContainer from '../chat/replyContainer';\n\nexport default function wrapReply(\n  title: Parameters<ReplyContainer['fill']>[0],\n  subtitle: Parameters<ReplyContainer['fill']>[1],\n  message?: Message.message | Message.messageService,\n  setColorPeerId?: PeerId\n) {\n  const replyContainer = new ReplyContainer('reply');\n  const fillPromise = replyContainer.fill(title, subtitle, message);\n\n  if(setColorPeerId) {\n    const hex = getPeerColorById(setColorPeerId, false);\n    const [r, g, b] = hexToRgb(hex);\n    replyContainer.container.style.setProperty('--override-color', `${r}, ${g}, ${b}`);\n    replyContainer.container.classList.add('is-overriding-color');\n    // replyContainer.border.style.backgroundColor = hex;\n    // replyContainer.title.style.color = hex;\n  }\n\n  return {container: replyContainer.container, fillPromise};\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport createVideo from '../../helpers/dom/createVideo';\nimport renderImageFromUrl from '../../helpers/dom/renderImageFromUrl';\nimport {StickerSet} from '../../layer';\nimport appDownloadManager from '../../lib/appManagers/appDownloadManager';\nimport {AppManagers} from '../../lib/appManagers/managers';\nimport lottieLoader from '../../lib/rlottie/lottieLoader';\nimport rootScope from '../../lib/rootScope';\nimport animationIntersector, {AnimationItemGroup} from '../animationIntersector';\nimport LazyLoadQueue from '../lazyLoadQueue';\nimport wrapSticker from './sticker';\n\nexport default async function wrapStickerSetThumb({set, lazyLoadQueue, container, group, autoplay, width, height, managers = rootScope.managers}: {\n  set: StickerSet.stickerSet,\n  lazyLoadQueue: LazyLoadQueue,\n  container: HTMLElement,\n  group: AnimationItemGroup,\n  autoplay: boolean,\n  width: number,\n  height: number,\n  managers?: AppManagers\n}) {\n  if(set.thumbs?.length) {\n    container.classList.add('media-sticker-wrapper');\n    lazyLoadQueue.push({\n      div: container,\n      load: async() => {\n        const downloadOptions = await managers.appStickersManager.getStickerSetThumbDownloadOptions(set);\n        const promise = appDownloadManager.download(downloadOptions);\n\n        if(set.pFlags.animated && !set.pFlags.videos) {\n          return promise\n          .then((blob) => {\n            lottieLoader.loadAnimationWorker({\n              container,\n              loop: true,\n              autoplay,\n              animationData: blob,\n              width,\n              height,\n              needUpscale: true,\n              name: 'setThumb' + set.id\n            }, group);\n          });\n        } else {\n          let media: HTMLElement;\n          if(set.pFlags.videos) {\n            media = createVideo();\n            (media as HTMLVideoElement).autoplay = true;\n            (media as HTMLVideoElement).muted = true;\n            (media as HTMLVideoElement).loop = true;\n          } else {\n            media = new Image();\n          }\n\n          media.classList.add('media-sticker');\n\n          return promise.then((blob) => {\n            renderImageFromUrl(media, URL.createObjectURL(blob), () => {\n              container.append(media);\n\n              if(set.pFlags.videos) {\n                animationIntersector.addAnimation(media as HTMLVideoElement, group);\n              }\n            });\n          });\n        }\n      }\n    });\n\n    return;\n  }\n\n  const promise = managers.appStickersManager.getStickerSet(set);\n  const stickerSet = await promise;\n  if(stickerSet.documents[0]._ !== 'documentEmpty') { // as thumb will be used first sticker\n    wrapSticker({\n      doc: stickerSet.documents[0],\n      div: container,\n      group: group,\n      lazyLoadQueue,\n      managers,\n      width,\n      height\n    }); // kostil\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport {MyDocument} from '../../lib/appManagers/appDocsManager';\nimport {AppManagers} from '../../lib/appManagers/managers';\nimport Row from '../row';\nimport wrapSticker from './sticker';\n\nexport default function wrapStickerToRow({doc, row, size, managers}: {\n  doc: MyDocument,\n  row: Row,\n  size?: 'small' | 'large',\n  managers?: AppManagers\n}) {\n  const previousMedia = row.media;\n  const media = row.createMedia('small');\n\n  if(previousMedia) {\n    media.classList.add('hide');\n  }\n\n  const loadPromises: Promise<any>[] = previousMedia ? [] : undefined;\n\n  const _size = size === 'small' ? 32 : 48;\n  const result = wrapSticker({\n    div: media,\n    doc: doc,\n    width: _size,\n    height: _size,\n    loadPromises,\n    managers\n  }).then(({render}) => render);\n\n  loadPromises && Promise.all(loadPromises).then(() => {\n    media.classList.remove('hide');\n    previousMedia.remove();\n  });\n\n  return result;\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport {formatPhoneNumber} from '../../helpers/formatPhoneNumber';\n\nexport default function formatUserPhone(phone: string) {\n  return '+' + formatPhoneNumber(phone).formatted;\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport numberThousandSplitter from '../../helpers/number/numberThousandSplitter';\nimport {Chat, ChatParticipants} from '../../layer';\nimport {i18n, LangPackKey} from '../../lib/langPack';\nimport rootScope from '../../lib/rootScope';\n\nexport default async function getChatMembersString(chatId: ChatId, managers = rootScope.managers) {\n  const chat: Chat = await managers.appChatsManager.getChat(chatId);\n  if(chat._ === 'chatForbidden') {\n    return i18n('YouWereKicked');\n  }\n\n  const chatFull = await managers.appProfileManager.getCachedFullChat(chatId);\n  let count: number;\n  if(chatFull) {\n    if(chatFull._ === 'channelFull') {\n      count = chatFull.participants_count;\n    } else {\n      count = (chatFull.participants as ChatParticipants.chatParticipants).participants?.length;\n    }\n  } else {\n    count = (chat as Chat.chat).participants_count || (chat as any).participants?.participants.length;\n  }\n\n  const isBroadcast = (chat as Chat.channel).pFlags.broadcast;\n  count = count || 1;\n\n  const key: LangPackKey = isBroadcast ? 'Peer.Status.Subscribers' : 'Peer.Status.Member';\n  return i18n(key, [numberThousandSplitter(count)]);\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport limitSymbols from '../../helpers/string/limitSymbols';\nimport {Chat} from '../../layer';\nimport {AppManagers} from '../../lib/appManagers/managers';\nimport I18n from '../../lib/langPack';\nimport wrapEmojiText from '../../lib/richTextProcessor/wrapEmojiText';\nimport rootScope from '../../lib/rootScope';\n\nexport default async function getPeerTitle(peerId: PeerId, plainText: true, onlyFirstName?: boolean, _limitSymbols?: number, managers?: AppManagers): Promise<string>;\nexport default async function getPeerTitle(peerId: PeerId, plainText?: false, onlyFirstName?: boolean, _limitSymbols?: number, managers?: AppManagers): Promise<DocumentFragment>;\nexport default async function getPeerTitle(peerId: PeerId, plainText: boolean, onlyFirstName?: boolean, _limitSymbols?: number, managers?: AppManagers): Promise<DocumentFragment | string>;\nexport default async function getPeerTitle(peerId: PeerId, plainText = false, onlyFirstName = false, _limitSymbols?: number, managers: AppManagers = rootScope.managers): Promise<DocumentFragment | string> {\n  if(!peerId) {\n    peerId = rootScope.myId;\n  }\n\n  let title = '';\n  if(peerId.isUser()) {\n    const user = await managers.appUsersManager.getUser(peerId.toUserId());\n    if(user.first_name) title += user.first_name;\n    if(user.last_name && (!onlyFirstName || !title)) title += ' ' + user.last_name;\n\n    if(!title) title = user.pFlags.deleted ? I18n.format(onlyFirstName ? 'Deleted' : 'HiddenName', true) : user.username;\n    else title = title.trim();\n  } else {\n    const chat: Chat.chat = await managers.appChatsManager.getChat(peerId.toChatId());\n    title = chat.title;\n\n    if(onlyFirstName) {\n      title = title.split(' ')[0];\n    }\n  }\n\n  if(_limitSymbols !== undefined) {\n    title = limitSymbols(title, _limitSymbols, _limitSymbols);\n  }\n\n  return plainText ? title : wrapEmojiText(title);\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport {formatFullSentTimeRaw} from '../../helpers/date';\nimport {User} from '../../layer';\nimport {LangPackKey, i18n} from '../../lib/langPack';\nimport {REPLIES_PEER_ID, SERVICE_PEER_ID} from '../../lib/mtproto/mtproto_config';\n\nexport default function getUserStatusString(user: User.user): HTMLElement {\n  if(!user) {\n    return document.createElement('span');\n  }\n\n  let key: LangPackKey;\n  let args: any[];\n\n  switch(user.id) {\n    case REPLIES_PEER_ID.toUserId():\n      key = 'Peer.RepliesNotifications';\n      break;\n    case SERVICE_PEER_ID.toUserId():\n      key = 'Peer.ServiceNotifications';\n      break;\n    default: {\n      if(user.pFlags.bot) {\n        key = 'Bot';\n        break;\n      }\n\n      if(user.pFlags.support) {\n        key = 'SupportStatus';\n        break;\n      }\n\n      switch(user.status?._) {\n        case 'userStatusRecently': {\n          key = 'Lately';\n          break;\n        }\n\n        case 'userStatusLastWeek': {\n          key = 'WithinAWeek';\n          break;\n        }\n\n        case 'userStatusLastMonth': {\n          key = 'WithinAMonth';\n          break;\n        }\n\n        case 'userStatusOffline': {\n          const date = user.status.was_online;\n          const today = new Date();\n          const now = today.getTime() / 1000 | 0;\n\n          const diff = now - date;\n          if(diff < 60) {\n            key = 'Peer.Status.justNow';\n          } else if(diff < 3600) {\n            key = 'Peer.Status.minAgo';\n            const c = diff / 60 | 0;\n            args = [c];\n          } else if(diff < 86400 && today.getDate() === new Date(date * 1000).getDate()) {\n            key = 'LastSeen.HoursAgo';\n            const c = diff / 3600 | 0;\n            args = [c];\n          } else {\n            key = 'Peer.Status.LastSeenAt';\n            const {dateEl, timeEl} = formatFullSentTimeRaw(date);\n            args = [dateEl, timeEl];\n          }\n\n          break;\n        }\n\n        case 'userStatusOnline': {\n          key = 'Online';\n          break;\n        }\n\n        default: {\n          key = 'ALongTimeAgo';\n          break;\n        }\n      }\n\n      break;\n    }\n  }\n\n  return i18n(key, args);\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport {Message, MessageAction} from '../../layer';\nimport wrapUrl from '../../lib/richTextProcessor/wrapUrl';\n\nexport default function wrapJoinVoiceChatAnchor(message: Message.messageService) {\n  const action = message.action as MessageAction.messageActionInviteToGroupCall;\n  const {onclick, url} = wrapUrl(`tg://voicechat?chat_id=${message.peerId.toChatId()}&id=${action.call.id}&access_hash=${action.call.access_hash}`);\n  if(!onclick) {\n    return document.createElement('span');\n  }\n\n  const a = document.createElement('a');\n  a.href = url;\n  a.setAttribute('onclick', onclick + '(this)');\n\n  return a;\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport indexOfAndSplice from '../../helpers/array/indexOfAndSplice';\nimport {formatTime} from '../../helpers/date';\nimport htmlToSpan from '../../helpers/dom/htmlToSpan';\nimport setInnerHTML from '../../helpers/dom/setInnerHTML';\nimport formatCallDuration from '../../helpers/formatCallDuration';\nimport paymentsWrapCurrencyAmount from '../../helpers/paymentsWrapCurrencyAmount';\nimport {Message, MessageAction} from '../../layer';\nimport {MyMessage} from '../../lib/appManagers/appMessagesManager';\nimport getPeerId from '../../lib/appManagers/utils/peers/getPeerId';\nimport I18n, {FormatterArgument, FormatterArguments, i18n, join, langPack, LangPackKey, _i18n} from '../../lib/langPack';\nimport wrapEmojiText from '../../lib/richTextProcessor/wrapEmojiText';\nimport wrapPlainText from '../../lib/richTextProcessor/wrapPlainText';\nimport wrapRichText from '../../lib/richTextProcessor/wrapRichText';\nimport rootScope from '../../lib/rootScope';\nimport PeerTitle from '../peerTitle';\nimport getPeerTitle from './getPeerTitle';\nimport wrapJoinVoiceChatAnchor from './joinVoiceChatAnchor';\nimport wrapMessageForReply from './messageForReply';\n\nasync function wrapLinkToMessage(message: Message.message | Message.messageService, plain?: boolean) {\n  const a = document.createElement('i');\n  a.dataset.savedFrom = message.peerId + '_' + message.mid;\n  a.dir = 'auto';\n  a.append(await wrapMessageForReply(message, undefined, undefined, plain as any));\n  return a;\n}\n\nexport default async function wrapMessageActionTextNewUnsafe(message: MyMessage, plain?: boolean) {\n  const element: HTMLElement = plain ? undefined : document.createElement('span');\n  const action = 'action' in message && message.action;\n\n  // this.log('message action:', action);\n\n  if((action as MessageAction.messageActionCustomAction).message) {\n    const unsafeMessage = (action as MessageAction.messageActionCustomAction).message;\n    if(plain) {\n      return wrapPlainText(unsafeMessage);\n    } else {\n      setInnerHTML(element, wrapRichText(unsafeMessage, {noLinebreaks: true}));\n      return element;\n    }\n  } else {\n    let _ = action._;\n    // let suffix = '';\n    let langPackKey: LangPackKey;\n    let args: Array<FormatterArgument | Promise<FormatterArgument>>;\n\n    const managers = rootScope.managers;\n\n    const getNameDivHTML = async(peerId: PeerId, plain: boolean) => {\n      return plain ? getPeerTitle(peerId, plain) : (new PeerTitle({peerId})).element;\n    };\n\n    switch(action._) {\n      case 'messageActionPhoneCall': {\n        _ += '.' + (action as any).type;\n\n        args = [formatCallDuration(action.duration, plain)];\n        break;\n      }\n\n      case 'messageActionGroupCall': {\n        _ += '.' + (action as any).type;\n\n        args = [];\n        if(!_.endsWith('You') && !message.pFlags.post) {\n          args.push(getNameDivHTML(message.fromId, plain));\n        }\n\n        if(action.duration !== undefined) {\n          args.push(formatCallDuration(action.duration, plain));\n        } else {\n          args.push(wrapJoinVoiceChatAnchor(message as any));\n        }\n\n        break;\n      }\n\n      case 'messageActionInviteToGroupCall': {\n        const peerIds = [message.fromId, action.users[0].toPeerId()];\n        let a = 'Chat.Service.VoiceChatInvitation';\n        const myId = rootScope.myId;\n        if(peerIds[0] === myId) a += 'ByYou';\n        else if(peerIds[1] === myId) a += 'ForYou';\n        indexOfAndSplice(peerIds, myId);\n\n        langPackKey = a as LangPackKey;\n        args = peerIds.map((peerId) => getNameDivHTML(peerId, plain));\n        args.push(wrapJoinVoiceChatAnchor(message as any));\n        break;\n      }\n\n      case 'messageActionGroupCallScheduled': {\n        const today = new Date();\n        const date = new Date(action.schedule_date * 1000);\n        const daysToStart = (date.getTime() - today.getTime()) / 86400e3;\n        const tomorrowDate = new Date(today);\n        tomorrowDate.setDate(tomorrowDate.getDate() + 1);\n\n        const isBroadcast = await managers.appPeersManager.isBroadcast(message.peerId);\n        langPackKey = isBroadcast ? 'ChatList.Service.VoiceChatScheduled.Channel' : 'ChatList.Service.VoiceChatScheduled';\n        args = [];\n        const myId = rootScope.myId;\n        if(message.fromId === myId) {\n          langPackKey += 'You';\n        } else if(!isBroadcast) {\n          args.push(getNameDivHTML(message.fromId, plain));\n        }\n\n        let k: LangPackKey;\n        const _args: FormatterArguments = [];\n        if(daysToStart < 1 && date.getDate() === today.getDate()) {\n          k = 'TodayAtFormattedWithToday';\n        } else if(daysToStart < 2 && date.getDate() === tomorrowDate.getDate()) {\n          k = 'Time.TomorrowAt';\n        } else {\n          k = 'formatDateAtTime';\n          _args.push(new I18n.IntlDateElement({\n            date,\n            options: {\n              day: '2-digit',\n              month: '2-digit',\n              year: '2-digit'\n            }\n          }).element);\n        }\n\n        _args.push(formatTime(date));\n        const t = i18n(k, _args);\n        args.push(t);\n\n        break;\n      }\n\n      case 'messageActionChatCreate': {\n        const myId = rootScope.myId;\n        if(message.fromId === myId) {\n          _ += 'You';\n        } else {\n          args = [getNameDivHTML(message.fromId, plain)];\n        }\n\n        break;\n      }\n\n      case 'messageActionPinMessage': {\n        const peerId = message.peerId;\n        const pinnedMessage = await managers.appMessagesManager.getMessageByPeer(peerId, message.reply_to_mid);\n\n        args = [\n          getNameDivHTML(message.fromId, plain)\n        ];\n\n        if(!pinnedMessage/*  || true */) {\n          langPackKey = 'ActionPinnedNoText';\n\n          if(message.reply_to_mid) { // refresh original message\n            managers.appMessagesManager.fetchMessageReplyTo(message);\n          }\n        } else {\n          args.push(wrapLinkToMessage(pinnedMessage, plain));\n        }\n\n        break;\n      }\n\n      case 'messageActionChatJoinedByRequest': {\n        const isBroadcast = await managers.appPeersManager.isBroadcast(message.peerId);\n        if(message.pFlags.out) {\n          langPackKey = isBroadcast ? 'RequestToJoinChannelApproved' : 'RequestToJoinGroupApproved';\n        } else {\n          langPackKey = isBroadcast ? 'ChatService.UserJoinedChannelByRequest' : 'ChatService.UserJoinedGroupByRequest';\n          args = [getNameDivHTML(message.fromId, plain)];\n        }\n        break;\n      }\n\n      case 'messageActionContactSignUp':\n      case 'messageActionChatReturn':\n      case 'messageActionChatLeave':\n      case 'messageActionChatJoined':\n      case 'messageActionChatEditPhoto':\n      case 'messageActionChatDeletePhoto':\n      case 'messageActionChatEditVideo':\n      case 'messageActionChatJoinedByLink':\n      case 'messageActionChannelEditVideo':\n      case 'messageActionChannelDeletePhoto': {\n        args = [getNameDivHTML(message.fromId, plain)];\n        break;\n      }\n\n      case 'messageActionChannelEditTitle':\n      case 'messageActionChatEditTitle': {\n        args = [];\n        if(action._ === 'messageActionChatEditTitle') {\n          args.push(getNameDivHTML(message.fromId, plain));\n        }\n\n        args.push(plain ? action.title : htmlToSpan(wrapEmojiText(action.title)));\n        break;\n      }\n\n      case 'messageActionChatDeleteUser':\n      case 'messageActionChatAddUsers':\n      case 'messageActionChatAddUser': {\n        const users = (action as MessageAction.messageActionChatAddUser).users ||\n          [(action as MessageAction.messageActionChatDeleteUser).user_id];\n\n        args = [getNameDivHTML(message.fromId, plain)];\n\n        if(users.length > 1) {\n          const joined = join(\n            await Promise.all(users.map((userId: UserId) => getNameDivHTML(userId.toPeerId(), plain))),\n            false,\n            plain\n          );\n\n          if(plain) {\n            args.push(...joined);\n          } else {\n            const fragment = document.createElement('span');\n            fragment.append(...joined);\n            args.push(fragment);\n          }\n        } else {\n          args.push(getNameDivHTML(users[0].toPeerId(), plain));\n        }\n\n        break;\n      }\n\n      case 'messageActionBotAllowed': {\n        const anchorHTML = wrapRichText(action.domain, {\n          entities: [{\n            _: 'messageEntityUrl',\n            length: action.domain.length,\n            offset: 0\n          }]\n        });\n\n        const node = htmlToSpan(anchorHTML);\n\n        args = [node];\n        break;\n      }\n\n      case 'messageActionPaymentSent': {\n        const isRecurringInit = action.pFlags.recurring_init;\n        const isRecurringUsed = action.pFlags.recurring_used;\n        langPackKey = isRecurringUsed ? 'Chat.Service.PaymentSentRecurringUsedNoTitle' : (isRecurringInit ? 'Chat.Service.PaymentSentRecurringInitNoTitle' : 'Chat.Service.PaymentSent1NoTitle');\n        const price = paymentsWrapCurrencyAmount(action.total_amount, action.currency);\n        args = [price, getNameDivHTML(message.peerId, plain)];\n\n        if(message.reply_to_mid) {\n          const invoiceMessage = await managers.appMessagesManager.getMessageByPeer(\n            message.reply_to?.reply_to_peer_id ? getPeerId(message.reply_to.reply_to_peer_id) : message.peerId,\n            message.reply_to_mid\n          );\n\n          if(!invoiceMessage) {\n            managers.appMessagesManager.fetchMessageReplyTo(message);\n          } else {\n            langPackKey = isRecurringUsed ? 'Chat.Service.PaymentSentRecurringUsed' : (isRecurringInit ? 'Chat.Service.PaymentSentRecurringInit' : 'Chat.Service.PaymentSent1');\n            args.push(wrapLinkToMessage(invoiceMessage, plain).then((el) => {\n              el.classList.add('is-receipt-link');\n              return el;\n            }));\n          }\n        }\n\n        break;\n      }\n\n      default:\n        langPackKey = (langPack[_] || `[${action._}]`) as any;\n        break;\n    }\n\n    if(!langPackKey) {\n      langPackKey = langPack[_];\n      if(langPackKey === undefined) {\n        langPackKey = '[' + _ + ']' as any;\n      }\n    }\n\n    const waited = args && await Promise.all(args);\n\n    if(plain) {\n      return I18n.format(langPackKey, true, waited);\n    } else {\n      return _i18n(element, langPackKey, waited);\n    }\n\n    // str = !langPackKey || langPackKey[0].toUpperCase() === langPackKey[0] ? langPackKey : getNameDivHTML(message.fromId) + langPackKey + (suffix ? ' ' : '');\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport {MyMessage} from '../../lib/appManagers/appMessagesManager';\nimport wrapMessageActionTextNewUnsafe from './messageActionTextNewUnsafe';\n\nexport default async function wrapMessageActionTextNew(message: MyMessage, plain: true): Promise<string>;\nexport default async function wrapMessageActionTextNew(message: MyMessage, plain?: false): Promise<HTMLElement>;\nexport default async function wrapMessageActionTextNew(message: MyMessage, plain: boolean): Promise<HTMLElement | string>;\nexport default async function wrapMessageActionTextNew(message: MyMessage, plain?: boolean): Promise<HTMLElement | string> {\n  try {\n    return await wrapMessageActionTextNewUnsafe(message, plain);\n  } catch(err) {\n    console.error('wrapMessageActionTextNewUnsafe error:', err);\n    return plain ? '' : document.createElement('span');\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport assumeType from '../../helpers/assumeType';\nimport htmlToDocumentFragment from '../../helpers/dom/htmlToDocumentFragment';\nimport {getRestrictionReason} from '../../helpers/restrictions';\nimport escapeRegExp from '../../helpers/string/escapeRegExp';\nimport limitSymbols from '../../helpers/string/limitSymbols';\nimport {Message, DocumentAttribute} from '../../layer';\nimport {MyDocument} from '../../lib/appManagers/appDocsManager';\nimport {MyDraftMessage} from '../../lib/appManagers/appDraftsManager';\nimport {MyMessage} from '../../lib/appManagers/appMessagesManager';\nimport isMessageRestricted from '../../lib/appManagers/utils/messages/isMessageRestricted';\nimport I18n, {LangPackKey, i18n, UNSUPPORTED_LANG_PACK_KEY} from '../../lib/langPack';\nimport sortEntities from '../../lib/richTextProcessor/sortEntities';\nimport wrapEmojiText from '../../lib/richTextProcessor/wrapEmojiText';\nimport wrapPlainText from '../../lib/richTextProcessor/wrapPlainText';\nimport wrapRichText from '../../lib/richTextProcessor/wrapRichText';\nimport rootScope from '../../lib/rootScope';\nimport wrapMessageActionTextNew from './messageActionTextNew';\n\nexport default async function wrapMessageForReply(message: MyMessage | MyDraftMessage, text: string, usingMids: number[], plain: true, highlightWord?: string, withoutMediaType?: boolean): Promise<string>;\nexport default async function wrapMessageForReply(message: MyMessage | MyDraftMessage, text?: string, usingMids?: number[], plain?: false, highlightWord?: string, withoutMediaType?: boolean): Promise<DocumentFragment>;\nexport default async function wrapMessageForReply(message: MyMessage | MyDraftMessage, text: string = (message as Message.message).message, usingMids?: number[], plain?: boolean, highlightWord?: string, withoutMediaType?: boolean): Promise<DocumentFragment | string> {\n  const parts: (Node | string)[] = [];\n\n  let hasAlbumKey = false;\n  const addPart = (langKey: LangPackKey, part?: string | HTMLElement | DocumentFragment) => {\n    if(langKey) {\n      if(part === undefined && hasAlbumKey) {\n        return;\n      }\n\n      part = plain ? I18n.format(langKey, true) : i18n(langKey);\n    }\n\n    if(plain) {\n      parts.push(part);\n    } else {\n      const el = document.createElement('i');\n      if(typeof(part) === 'string') el.innerHTML = part;\n      else el.append(part);\n      parts.push(el);\n    }\n  };\n\n  const managers = rootScope.managers;\n  const appMessagesManager = managers.appMessagesManager;\n\n  const isRestricted = isMessageRestricted(message as any);\n\n  let entities = (message as Message.message).totalEntities;\n  if((message as Message.message).media && !isRestricted) {\n    assumeType<Message.message>(message);\n    let usingFullAlbum = true;\n    if(message.grouped_id) {\n      if(usingMids) {\n        const mids = await appMessagesManager.getMidsByMessage(message);\n        if(usingMids.length === mids.length) {\n          for(const mid of mids) {\n            if(!usingMids.includes(mid)) {\n              usingFullAlbum = false;\n              break;\n            }\n          }\n        } else {\n          usingFullAlbum = false;\n        }\n      }\n\n      if(usingFullAlbum) {\n        const albumText = await appMessagesManager.getAlbumText(message.grouped_id);\n        text = albumText.message;\n        entities = albumText.totalEntities;\n\n        if(!withoutMediaType) {\n          addPart('AttachAlbum');\n          hasAlbumKey = true;\n        }\n      }\n    } else {\n      usingFullAlbum = false;\n    }\n\n    if((!usingFullAlbum && !withoutMediaType) || !text) {\n      const media = message.media;\n      switch(media._) {\n        case 'messageMediaPhoto':\n          addPart('AttachPhoto');\n          break;\n        case 'messageMediaDice':\n          addPart(undefined, plain ? media.emoticon : wrapEmojiText(media.emoticon));\n          break;\n        case 'messageMediaVenue': {\n          text = media.title;\n          addPart('AttachLocation');\n          break;\n        }\n        case 'messageMediaGeo':\n          addPart('AttachLocation');\n          break;\n        case 'messageMediaGeoLive':\n          addPart('AttachLiveLocation');\n          break;\n        case 'messageMediaPoll':\n          const f = '' + ' ' + (media.poll.question || 'poll');\n          addPart(undefined, plain ? f : wrapEmojiText(f));\n          break;\n        case 'messageMediaContact':\n          addPart('AttachContact');\n          break;\n        case 'messageMediaGame': {\n          const f = '' + ' ' + media.game.title;\n          addPart(undefined, plain ? f : wrapEmojiText(f));\n          break;\n        }\n        case 'messageMediaDocument': {\n          const document = media.document as MyDocument;\n\n          if(document.type === 'video') {\n            addPart('AttachVideo');\n          } else if(document.type === 'voice') {\n            addPart('AttachAudio');\n          } else if(document.type === 'gif') {\n            addPart('AttachGif');\n          } else if(document.type === 'round') {\n            addPart('AttachRound');\n          } else if(document.type === 'sticker') {\n            const i = parts.length;\n            if(document.stickerEmojiRaw) {\n              const f = document.stickerEmojiRaw + ' ';\n              addPart(undefined, plain ? f : wrapEmojiText(f));\n            }\n\n            addPart('AttachSticker');\n\n            // will combine two parts into one\n            const p = parts.splice(i, 2);\n            if(plain) parts.push((p[0] as string) + (p[1] as string));\n            else {\n              const span = window.document.createElement('span');\n              span.append(...p);\n              parts.push(span);\n            }\n\n            text = '';\n          } else if(document.type === 'audio') {\n            const attribute = document.attributes.find((attribute) => attribute._ === 'documentAttributeAudio' && (attribute.title || attribute.performer)) as DocumentAttribute.documentAttributeAudio;\n            const f = '' + ' ' + (attribute ? [attribute.title, attribute.performer].filter(Boolean).join(' - ') : document.file_name);\n            addPart(undefined, plain ? f : wrapEmojiText(f));\n          } else {\n            addPart(undefined, plain ? document.file_name : wrapEmojiText(document.file_name));\n          }\n\n          break;\n        }\n\n        case 'messageMediaInvoice': {\n          addPart(undefined, plain ? media.title : wrapEmojiText(media.title));\n          break;\n        }\n\n        case 'messageMediaUnsupported': {\n          addPart(UNSUPPORTED_LANG_PACK_KEY);\n          break;\n        }\n\n        default:\n          // messageText += media._;\n          // /////appMessagesManager.log.warn('Got unknown media type!', message);\n          break;\n      }\n    }\n\n    const length = parts.length;\n    for(let i = 1; i < length; i += 2) {\n      parts.splice(i, 0, ', ');\n    }\n\n    if(text && length) {\n      parts.push(', ');\n    }\n  }\n\n  if((message as Message.messageService).action) {\n    const actionWrapped = await wrapMessageActionTextNew((message as Message.messageService), plain);\n    if(actionWrapped) {\n      addPart(undefined, actionWrapped);\n    }\n  }\n\n  if(isRestricted) {\n    text = getRestrictionReason((message as Message.message).restriction_reason).text;\n    entities = [];\n  }\n\n  if(text) {\n    text = limitSymbols(text, 100);\n\n    if(!entities) {\n      entities = [];\n    }\n\n    if(plain) {\n      parts.push(wrapPlainText(text, entities));\n    } else {\n      // let entities = parseEntities(text.replace(/\\n/g, ' '));\n\n      if(highlightWord) {\n        highlightWord = highlightWord.trim();\n        let found = false;\n        let match: any;\n        const regExp = new RegExp(escapeRegExp(highlightWord), 'gi');\n        entities = entities.slice(); // fix leaving highlight entity\n        while((match = regExp.exec(text)) !== null) {\n          entities.push({_: 'messageEntityHighlight', length: highlightWord.length, offset: match.index});\n          found = true;\n        }\n\n        if(found) {\n          sortEntities(entities);\n        }\n      }\n\n      const messageWrapped = wrapRichText(text, {\n        noLinebreaks: true,\n        entities,\n        noLinks: true,\n        noTextFormat: true\n      });\n\n      parts.push(htmlToDocumentFragment(messageWrapped));\n    }\n  }\n\n  if(plain) {\n    return parts.join('');\n  } else {\n    const fragment = document.createDocumentFragment();\n    fragment.append(...parts);\n    return fragment;\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport PeerTitle, {PeerTitleOptions} from '../peerTitle';\n\nexport default async function wrapPeerTitle(options: PeerTitleOptions) {\n  const peerTitle = new PeerTitle();\n  await peerTitle.update(options);\n  return peerTitle.element;\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport {MyMessage} from '../../lib/appManagers/appMessagesManager';\nimport getMessageSenderPeerIdOrName from '../../lib/appManagers/utils/messages/getMessageSenderPeerIdOrName';\nimport {i18n} from '../../lib/langPack';\nimport rootScope from '../../lib/rootScope';\nimport PeerTitle from '../peerTitle';\n\nexport default async function wrapSenderToPeer(message: MyMessage) {\n  const senderTitle: HTMLElement = document.createElement('span');\n  senderTitle.classList.add('sender-title');\n\n  const fromMe = message.fromId === rootScope.myId && message.peerId !== rootScope.myId;\n  senderTitle.append(\n    fromMe ?\n      i18n('FromYou') :\n      new PeerTitle({\n        ...getMessageSenderPeerIdOrName(message),\n        dialog: message.peerId === rootScope.myId\n      }).element\n  );\n\n  if(await rootScope.managers.appPeersManager.isAnyGroup(message.peerId) || fromMe) {\n    const peerTitle = new PeerTitle({peerId: message.peerId}).element;\n    senderTitle.append('  ', peerTitle);\n  }\n\n  return senderTitle;\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport {formatDateAccordingToTodayNew} from '../../helpers/date';\nimport {MyMessage} from '../../lib/appManagers/appMessagesManager';\n\nexport default function wrapSentTime(message: MyMessage) {\n  const el: HTMLElement = document.createElement('span');\n  el.classList.add('sent-time');\n  el.append(formatDateAccordingToTodayNew(new Date(message.date * 1000)));\n\n  return el;\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport IS_WEBP_SUPPORTED from '../../environment/webpSupport';\nimport assumeType from '../../helpers/assumeType';\nimport getPathFromBytes from '../../helpers/bytes/getPathFromBytes';\nimport deferredPromise from '../../helpers/cancellablePromise';\nimport computeLockColor from '../../helpers/computeLockColor';\nimport cancelEvent from '../../helpers/dom/cancelEvent';\nimport {attachClickEvent} from '../../helpers/dom/clickEvent';\nimport createVideo from '../../helpers/dom/createVideo';\nimport findUpClassName from '../../helpers/dom/findUpClassName';\nimport renderImageFromUrl, {renderImageFromUrlPromise} from '../../helpers/dom/renderImageFromUrl';\nimport getImageFromStrippedThumb from '../../helpers/getImageFromStrippedThumb';\nimport getPreviewURLFromThumb from '../../helpers/getPreviewURLFromThumb';\nimport makeError from '../../helpers/makeError';\nimport {makeMediaSize} from '../../helpers/mediaSize';\nimport mediaSizes from '../../helpers/mediaSizes';\nimport {Middleware} from '../../helpers/middleware';\nimport onMediaLoad from '../../helpers/onMediaLoad';\nimport {isSavingLottiePreview, saveLottiePreview} from '../../helpers/saveLottiePreview';\nimport throttle from '../../helpers/schedulers/throttle';\nimport sequentialDom from '../../helpers/sequentialDom';\nimport {PhotoSize, VideoSize} from '../../layer';\nimport {MyDocument} from '../../lib/appManagers/appDocsManager';\nimport appDownloadManager from '../../lib/appManagers/appDownloadManager';\nimport appImManager from '../../lib/appManagers/appImManager';\nimport {AppManagers} from '../../lib/appManagers/managers';\nimport getServerMessageId from '../../lib/appManagers/utils/messageId/getServerMessageId';\nimport choosePhotoSize from '../../lib/appManagers/utils/photos/choosePhotoSize';\nimport getStickerEffectThumb from '../../lib/appManagers/utils/stickers/getStickerEffectThumb';\nimport lottieLoader from '../../lib/rlottie/lottieLoader';\nimport rootScope from '../../lib/rootScope';\nimport type {ThumbCache} from '../../lib/storages/thumbs';\nimport webpWorkerController from '../../lib/webp/webpWorkerController';\nimport {Awaited, SendMessageEmojiInteractionData} from '../../types';\nimport {getEmojiToneIndex} from '../../vendor/emoji';\nimport animationIntersector, {AnimationItemGroup} from '../animationIntersector';\nimport LazyLoadQueue from '../lazyLoadQueue';\nimport PopupStickers from '../popups/stickers';\nimport {hideToast, toastNew} from '../toast';\nimport wrapStickerAnimation from './stickerAnimation';\n\n// https://github.com/telegramdesktop/tdesktop/blob/master/Telegram/SourceFiles/history/view/media/history_view_sticker.cpp#L40\nexport const STICKER_EFFECT_MULTIPLIER = 1 + 0.245 * 2;\nconst EMOJI_EFFECT_MULTIPLIER = 3;\n\nconst locksUrls: {[docId: string]: string} = {};\n\nexport default async function wrapSticker({doc, div, middleware, loadStickerMiddleware, lazyLoadQueue, exportLoad, group, play, onlyThumb, emoji, width, height, withThumb, loop, loadPromises, needFadeIn, needUpscale, skipRatio, static: asStatic, managers = rootScope.managers, fullThumb, isOut, noPremium, withLock, relativeEffect, loopEffect, isCustomEmoji}: {\n  doc: MyDocument,\n  div: HTMLElement | HTMLElement[],\n  middleware?: Middleware,\n  loadStickerMiddleware?: Middleware,\n  lazyLoadQueue?: LazyLoadQueue,\n  exportLoad?: boolean,\n  group?: AnimationItemGroup,\n  play?: boolean,\n  onlyThumb?: boolean,\n  emoji?: string,\n  width?: number,\n  height?: number,\n  withThumb?: boolean,\n  loop?: boolean,\n  loadPromises?: Promise<any>[],\n  needFadeIn?: boolean,\n  needUpscale?: boolean,\n  skipRatio?: number,\n  static?: boolean,\n  managers?: AppManagers,\n  fullThumb?: PhotoSize | VideoSize,\n  isOut?: boolean,\n  noPremium?: boolean,\n  withLock?: boolean,\n  relativeEffect?: boolean,\n  loopEffect?: boolean,\n  isCustomEmoji?: boolean\n}) {\n  div = Array.isArray(div) ? div : [div];\n\n  if(isCustomEmoji) {\n    emoji = doc.stickerEmojiRaw;\n  }\n\n  const stickerType = doc.sticker;\n  if(stickerType === 1) {\n    asStatic = true;\n  }\n\n  if(!width && !height) {\n    const sizes = mediaSizes.active;\n    const boxSize = emoji ? sizes.emojiSticker : (doc.animated ? sizes.animatedSticker : sizes.staticSticker);\n    const size = makeMediaSize(doc.w, doc.h).aspectFitted(boxSize);\n    width = size.width;\n    height = size.height;\n  }\n\n  if(stickerType === 2) {\n    // LottieLoader.loadLottie();\n    lottieLoader.loadLottieWorkers();\n  }\n\n  div.forEach((div) => {\n    div.dataset.docId = '' + doc.id;\n    if(emoji) {\n      div.dataset.stickerEmoji = emoji;\n    }\n\n    div.classList.add('media-sticker-wrapper');\n  });\n\n  /* if(stickerType === 3) {\n    const videoRes = wrapVideo({\n      doc,\n      boxWidth: width,\n      boxHeight: height,\n      container: div,\n      group,\n      lazyLoadQueue,\n      middleware,\n      withoutPreloader: true,\n      loadPromises,\n      noPlayButton: true,\n      noInfo: true\n    });\n\n    if(videoRes.thumb) {\n      if(videoRes.thumb.images.thumb) {\n        videoRes.thumb.images.thumb.classList.add('media-sticker', 'thumbnail');\n      }\n\n      if(videoRes.thumb.images.full) {\n        videoRes.thumb.images.full.classList.add('media-sticker');\n      }\n    }\n\n    return videoRes.loadPromise;\n  } */\n\n  // console.log('wrap sticker', doc, div, onlyThumb);\n\n  let cacheContext: ThumbCache;\n  const getCacheContext = async(type: string = cacheContext?.type) => {\n    return cacheContext = await managers.thumbsStorage.getCacheContext(doc, type);\n  };\n\n  const isAnimated = !asStatic && (stickerType === 2 || stickerType === 3);\n\n  const effectThumb = getStickerEffectThumb(doc);\n  if(isOut !== undefined && effectThumb && !isOut) {\n    div.forEach((div) => div.classList.add('reflect-x'));\n  }\n\n  const willHaveLock = effectThumb && withLock;\n  if(willHaveLock) {\n    const lockUrl = locksUrls[doc.id];\n    div.forEach((div) => {\n      div.classList.add('is-premium-sticker', 'tgico-premium_lock');\n      lockUrl && div.style.setProperty('--lock-url', `url(${lockUrl})`);\n    });\n  }\n\n  if(asStatic && stickerType !== 1) {\n    const thumb = choosePhotoSize(doc, width, height, false) as PhotoSize.photoSize;\n    await getCacheContext(thumb.type);\n  } else {\n    await getCacheContext(fullThumb?.type);\n  }\n\n  const toneIndex = emoji && !isCustomEmoji ? getEmojiToneIndex(emoji) : -1;\n  const downloaded = cacheContext.downloaded && !needFadeIn;\n\n  const isThumbNeededForType = isAnimated;\n  const lottieCachedThumb = stickerType === 2 || stickerType === 3 ? await managers.appDocsManager.getLottieCachedThumb(doc.id, toneIndex) : undefined;\n\n  const ret = {render: undefined as typeof loadPromise, load: undefined as typeof load};\n  let loadThumbPromise = deferredPromise<void>();\n  let haveThumbCached = false;\n  if((\n    doc.thumbs?.length ||\n      lottieCachedThumb\n  ) &&\n    !div[0].firstElementChild && (\n    !downloaded ||\n      isThumbNeededForType ||\n      onlyThumb\n  ) && withThumb !== false/*  && doc.thumbs[0]._ !== 'photoSizeEmpty' */\n  ) {\n    let thumb = lottieCachedThumb || doc.thumbs[0];\n\n    // console.log('wrap sticker', thumb, div);\n\n    const afterRender = (div: HTMLElement, thumbImage: HTMLElement) => {\n      if(!div.childElementCount) {\n        thumbImage.classList.add('media-sticker', 'thumbnail');\n\n        sequentialDom.mutateElement(div, () => {\n          div.append(thumbImage);\n          loadThumbPromise.resolve();\n        });\n      }\n    };\n\n    if('url' in thumb) {\n      haveThumbCached = true;\n      div.forEach((div) => {\n        const thumbImage = new Image();\n        renderImageFromUrl(thumbImage, (thumb as any).url, () => afterRender(div, thumbImage));\n      });\n    } else if('bytes' in thumb) {\n      if(thumb._ === 'photoPathSize') {\n        if(!thumb.bytes.length) {\n          thumb = doc.thumbs.find((t) => (t as PhotoSize.photoStrippedSize).bytes?.length) || thumb;\n        }\n\n        const d = getPathFromBytes((thumb as PhotoSize.photoStrippedSize).bytes);\n        const ns = 'http://www.w3.org/2000/svg';\n        const svg = document.createElementNS(ns, 'svg');\n        svg.classList.add('rlottie-vector', 'media-sticker', 'thumbnail');\n        svg.setAttributeNS(null, 'viewBox', `0 0 ${doc.w || 512} ${doc.h || 512}`);\n\n        // const defs = document.createElementNS(ns, 'defs');\n        // const linearGradient = document.createElementNS(ns, 'linearGradient');\n        // linearGradient.setAttributeNS(null, 'id', 'g');\n        // linearGradient.setAttributeNS(null, 'x1', '-300%');\n        // linearGradient.setAttributeNS(null, 'x2', '-200%');\n        // linearGradient.setAttributeNS(null, 'y1', '0');\n        // linearGradient.setAttributeNS(null, 'y2', '0');\n        // const stops = [\n        //   ['-10%', '.1'],\n        //   ['30%', '.07'],\n        //   ['70%', '.07'],\n        //   ['110%', '.1']\n        // ].map(([offset, stopOpacity]) => {\n        //   const stop = document.createElementNS(ns, 'stop');\n        //   stop.setAttributeNS(null, 'offset', offset);\n        //   stop.setAttributeNS(null, 'stop-opacity', stopOpacity);\n        //   return stop;\n        // });\n        // const animates = [\n        //   ['-300%', '1200%'],\n        //   ['-200%', '1300%']\n        // ].map(([from, to], idx) => {\n        //   const animate = document.createElementNS(ns, 'animate');\n        //   animate.setAttributeNS(null, 'attributeName', 'x' + (idx + 1));\n        //   animate.setAttributeNS(null, 'from', from);\n        //   animate.setAttributeNS(null, 'to', to);\n        //   animate.setAttributeNS(null, 'dur', '3s');\n        //   animate.setAttributeNS(null, 'repeatCount', 'indefinite');\n        //   return animate;\n        // });\n        // linearGradient.append(...stops, ...animates);\n        // defs.append(linearGradient);\n        // svg.append(defs);\n\n        const path = document.createElementNS(ns, 'path');\n        path.setAttributeNS(null, 'd', d);\n        if(rootScope.settings.animationsEnabled && !isCustomEmoji) path.setAttributeNS(null, 'fill', 'url(#g)');\n        svg.append(path);\n        div.forEach((div, idx) => div.append(idx > 0 ? svg.cloneNode(true) : svg));\n        haveThumbCached = true;\n        loadThumbPromise.resolve();\n      } else if(toneIndex <= 0) {\n        const r = () => {\n          (div as HTMLElement[]).forEach((div) => {\n            const thumbImage = new Image();\n            const url = getPreviewURLFromThumb(doc, thumb as PhotoSize.photoStrippedSize, true);\n            renderImageFromUrl(thumbImage, url, () => afterRender(div, thumbImage));\n          });\n        };\n\n        if((IS_WEBP_SUPPORTED || doc.pFlags.stickerThumbConverted || cacheContext.url)/*  && false */) {\n          haveThumbCached = true;\n          r();\n        } else {\n          haveThumbCached = true;\n          webpWorkerController.convert('main-' + doc.id, thumb.bytes).then((bytes) => {\n            managers.appDocsManager.saveWebPConvertedStrippedThumb(doc.id, bytes);\n            (thumb as PhotoSize.photoStrippedSize).bytes = bytes;\n            doc.pFlags.stickerThumbConverted = true;\n\n            if((middleware && !middleware()) || (div as HTMLElement[])[0].childElementCount) {\n              loadThumbPromise.resolve();\n              return;\n            }\n\n            r();\n          }).catch(() => loadThumbPromise.resolve());\n        }\n      }\n    } else if(((stickerType === 2 && toneIndex <= 0) || stickerType === 3) && (withThumb || onlyThumb)) {\n      const load = async() => {\n        if((div as HTMLElement[])[0].childElementCount || (middleware && !middleware())) {\n          loadThumbPromise.resolve();\n          return;\n        }\n\n        const r = (div: HTMLElement, thumbImage: HTMLElement, rendered?: boolean) => {\n          if(div.childElementCount || (middleware && !middleware())) {\n            loadThumbPromise.resolve();\n            return;\n          }\n\n          if(rendered) afterRender(div, thumbImage);\n          else renderImageFromUrl(thumbImage, cacheContext.url, () => afterRender(div, thumbImage));\n        };\n\n        await getCacheContext();\n        (div as HTMLElement[]).forEach((div) => {\n          if(cacheContext.url) {\n            r(div, new Image());\n          } else if('bytes' in thumb) {\n            const res = getImageFromStrippedThumb(doc, thumb as PhotoSize.photoStrippedSize, true);\n            res.loadPromise.then(() => r(div, res.image, true));\n\n            // return managers.appDocsManager.getThumbURL(doc, thumb as PhotoSize.photoStrippedSize).promise.then(r);\n          } else {\n            appDownloadManager.downloadMediaURL({\n              media: doc,\n              thumb: thumb as PhotoSize\n            }).then(async() => {\n              await getCacheContext();\n              return r(div, new Image());\n            });\n          }\n        });\n      };\n\n      if(lazyLoadQueue && onlyThumb) {\n        lazyLoadQueue.push({div: div[0], load});\n        loadThumbPromise.resolve();\n        return ret;\n      } else {\n        load();\n\n        if((thumb as any).url) {\n          haveThumbCached = true;\n        }\n      }\n    }\n  }\n\n  if(loadPromises && haveThumbCached) {\n    loadPromises.push(loadThumbPromise);\n  }\n\n  if(onlyThumb/*  || true */) { // for sticker panel\n    return ret;\n  }\n\n  const middlewareError = makeError('MIDDLEWARE');\n  const load = async() => {\n    if(middleware && !middleware()) {\n      throw middlewareError;\n    }\n\n    if(stickerType === 2 && !asStatic) {\n      return appDownloadManager.downloadMedia({media: doc, queueId: lazyLoadQueue?.queueId, thumb: fullThumb})\n      .then(async(blob) => {\n        if(middleware && !middleware()) {\n          throw middlewareError;\n        }\n\n        const animation = await lottieLoader.loadAnimationWorker({\n          container: (div as HTMLElement[])[0],\n          loop: loop && (!emoji || isCustomEmoji),\n          autoplay: play,\n          animationData: blob,\n          width,\n          height,\n          name: 'doc' + doc.id,\n          needUpscale,\n          skipRatio,\n          toneIndex,\n          sync: isCustomEmoji\n        }, group, loadStickerMiddleware ?? middleware);\n\n        // const deferred = deferredPromise<void>();\n\n        const setLockColor = willHaveLock ? () => {\n          const lockUrl = locksUrls[doc.id] ??= computeLockColor(animation.canvas[0]);\n          (div as HTMLElement[]).forEach((div) => div.style.setProperty('--lock-url', `url(${lockUrl})`));\n        } : undefined;\n\n        const onFirstFrame = (container: HTMLElement, canvas: HTMLCanvasElement) => {\n          const element = container.firstElementChild;\n          if(needFadeIn !== false) {\n            needFadeIn = (needFadeIn || !element || element.tagName === 'svg') && rootScope.settings.animationsEnabled;\n          }\n\n          const cb = () => {\n            if(element && element !== canvas && element.tagName !== 'DIV') {\n              element.remove();\n            }\n          };\n\n          if(!needFadeIn) {\n            if(element) {\n              sequentialDom.mutate(cb);\n            }\n          } else {\n            sequentialDom.mutate(() => {\n              canvas && canvas.classList.add('fade-in');\n              if(element) {\n                element.classList.add('fade-out');\n              }\n\n              (canvas || element).addEventListener('animationend', () => {\n                sequentialDom.mutate(() => {\n                  canvas && canvas.classList.remove('fade-in');\n                  cb();\n                });\n              }, {once: true});\n            });\n          }\n        };\n\n        animation.addEventListener('firstFrame', () => {\n          const canvas = animation.canvas[0];\n          if(withThumb !== false) {\n            saveLottiePreview(doc, canvas, toneIndex);\n          }\n\n          if(willHaveLock) {\n            setLockColor();\n          }\n\n          if(!isCustomEmoji) {\n            (div as HTMLElement[]).forEach((container, idx) => {\n              onFirstFrame(container, animation.canvas[idx]);\n            });\n          }\n        }, {once: true});\n\n        if(emoji) {\n          managers.appStickersManager.preloadAnimatedEmojiStickerAnimation(emoji);\n        }\n\n        return animation;\n\n        // return deferred;\n        // await new Promise((resolve) => setTimeout(resolve, 5e3));\n      });\n    } else if(asStatic || stickerType === 3) {\n      const isSingleVideo = isAnimated && false;\n      const d = isSingleVideo ? (div as HTMLElement[]).slice(0, 1) : div as HTMLElement[];\n      const media: HTMLElement[] = d.map(() => {\n        let media: HTMLElement;\n        if(asStatic) {\n          media = new Image();\n        } else {\n          const video = media = createVideo();\n          video.muted = true;\n          if(play) video.autoplay = true;\n          if(loop) video.loop = true;\n        }\n\n        media.classList.add('media-sticker');\n        return media;\n      });\n\n      const thumbImage = (div as HTMLElement[]).map((div, idx) => (div.firstElementChild as HTMLElement) !== media[idx] && div.firstElementChild) as HTMLElement[];\n      if(needFadeIn !== false) {\n        needFadeIn = (needFadeIn || !downloaded || (asStatic ? thumbImage[0] : (!thumbImage[0] || thumbImage[0].tagName === 'svg'))) && rootScope.settings.animationsEnabled;\n      }\n\n      if(needFadeIn) {\n        media.forEach((media) => media.classList.add('fade-in'));\n      }\n\n      return new Promise<HTMLVideoElement[] | HTMLImageElement[]>(async(resolve, reject) => {\n        const r = async() => {\n          if(middleware && !middleware()) {\n            reject(middlewareError);\n            return;\n          }\n\n          const mediaLength = media.length;\n          const loaded: HTMLElement[] = [];\n          const onLoad = (div: HTMLElement, media: HTMLElement, thumbImage: HTMLElement) => {\n            sequentialDom.mutateElement(div, () => {\n              if(middleware && !middleware()) {\n                reject(middlewareError);\n                return;\n              }\n\n              if(!media) {\n                if(!isSingleVideo || !isAnimated) {\n                  thumbImage?.remove();\n                }\n\n                return;\n              }\n\n              if(media as HTMLVideoElement && !isSavingLottiePreview(doc, toneIndex)) {\n                // const perf = performance.now();\n                assumeType<HTMLVideoElement>(media);\n                const canvas = document.createElement('canvas');\n                canvas.width = width * window.devicePixelRatio;\n                canvas.height = height * window.devicePixelRatio;\n                const ctx = canvas.getContext('2d');\n                ctx.drawImage(media, 0, 0, canvas.width, canvas.height);\n                saveLottiePreview(doc, canvas, toneIndex);\n                // console.log('perf', performance.now() - perf);\n              }\n\n              if(isSingleVideo) {\n                resolve(media as any);\n                return;\n              }\n\n              div.append(media);\n\n              if(needFadeIn) {\n                thumbImage && thumbImage.classList.add('fade-out');\n                media.addEventListener('animationend', () => {\n                  media.classList.remove('fade-in');\n                  thumbImage?.remove();\n                }, {once: true});\n              } else {\n                thumbImage?.remove();\n              }\n\n              if(isAnimated) {\n                animationIntersector.addAnimation(media as HTMLVideoElement, group);\n              }\n\n              if(loaded.push(media) === mediaLength) {\n                resolve(loaded as any);\n              }\n            });\n          };\n\n          await getCacheContext();\n          let lastPromise: Promise<any>;\n          (div as HTMLElement[]).forEach((div, idx) => {\n            const _media = media[idx];\n            const cb = () => onLoad(div, _media, thumbImage[idx]);\n            if(_media) lastPromise = renderImageFromUrlPromise(_media, cacheContext.url);\n            lastPromise.then(cb);\n          });\n        };\n\n        await getCacheContext();\n        if(cacheContext.url) r();\n        else {\n          let promise: Promise<any>;\n          if(stickerType !== 1 && asStatic) {\n            const thumb = choosePhotoSize(doc, width, height, false) as PhotoSize.photoSize;\n            // promise = managers.appDocsManager.getThumbURL(doc, thumb).promise\n            promise = appDownloadManager.downloadMediaURL({media: doc, thumb, queueId: lazyLoadQueue?.queueId});\n          } else {\n            promise = appDownloadManager.downloadMediaURL({media: doc, queueId: lazyLoadQueue?.queueId});\n          }\n\n          promise.then(r, reject);\n        }\n      });\n    }\n  };\n\n  if(exportLoad && (!downloaded || isAnimated)) {\n    ret.load = load;\n    return ret;\n  }\n\n  const loadPromise: Promise<Awaited<ReturnType<typeof load>> | void> = lazyLoadQueue && (!downloaded || isAnimated) ?\n    (lazyLoadQueue.push({div: div[0], load}), Promise.resolve()) :\n    load();\n\n  if(downloaded && (asStatic/*  || stickerType === 3 */)) {\n    loadThumbPromise = loadPromise as any;\n    if(loadPromises) {\n      loadPromises.push(loadThumbPromise);\n    }\n  }\n\n  if(stickerType === 2 && effectThumb && isOut !== undefined && !noPremium) {\n    attachStickerEffectHandler({\n      container: div[0],\n      doc,\n      managers,\n      middleware,\n      isOut,\n      width,\n      loadPromise,\n      relativeEffect,\n      loopEffect\n    });\n  }\n\n  ret.render = loadPromise as any;\n  return ret;\n}\n\nfunction attachStickerEffectHandler({container, doc, managers, middleware, isOut, width, loadPromise, relativeEffect, loopEffect}: {\n  container: HTMLElement,\n  doc: MyDocument,\n  managers: AppManagers,\n  middleware: Middleware,\n  isOut: boolean,\n  width: number,\n  loadPromise: Promise<any>,\n  relativeEffect?: boolean,\n  loopEffect?: boolean\n}) {\n  managers.appStickersManager.preloadSticker(doc.id, true);\n\n  let playing = false;\n  attachClickEvent(container, async(e) => {\n    cancelEvent(e);\n    if(playing) {\n      const a = document.createElement('a');\n      a.onclick = () => {\n        hideToast();\n        new PopupStickers(doc.stickerSetInput).show();\n      };\n\n      toastNew({\n        langPackKey: 'Sticker.Premium.Click.Info',\n        langPackArguments: [a]\n      });\n\n      return;\n    }\n\n    playing = true;\n\n    await loadPromise;\n    const {animationDiv, stickerPromise} = wrapStickerAnimation({\n      doc,\n      middleware,\n      side: isOut ? 'right' : 'left',\n      size: width * STICKER_EFFECT_MULTIPLIER,\n      target: container,\n      play: true,\n      fullThumb: getStickerEffectThumb(doc),\n      relativeEffect,\n      loopEffect\n    });\n\n    if(isOut !== undefined && !isOut/*  && !relativeEffect */) {\n      animationDiv.classList.add('reflect-x');\n    }\n\n    stickerPromise.then((player) => {\n      player.addEventListener('destroy', () => {\n        playing = false;\n      });\n    });\n  });\n}\n\nexport async function onEmojiStickerClick({event, container, managers, peerId, middleware}: {\n  event: Event,\n  container: HTMLElement,\n  managers: AppManagers,\n  peerId: PeerId,\n  middleware: Middleware\n}) {\n  if(!peerId.isUser()) {\n    return;\n  }\n\n  cancelEvent(event);\n\n  const bubble = findUpClassName(container, 'bubble');\n  const emoji = container.dataset.stickerEmoji;\n  const data: SendMessageEmojiInteractionData = (container as any).emojiData ??= {\n    a: [],\n    v: 1\n  };\n\n  const sendInteractionThrottled: () => void = (container as any).sendInteractionThrottled = throttle(() => {\n    const length = data.a.length;\n    if(!length) {\n      return;\n    }\n\n    const firstTime = data.a[0].t;\n\n    data.a.forEach((a) => {\n      a.t = (a.t - firstTime) / 1000;\n    });\n\n    const bubble = findUpClassName(container, 'bubble');\n    managers.appMessagesManager.setTyping(appImManager.chat.peerId, {\n      _: 'sendMessageEmojiInteraction',\n      msg_id: getServerMessageId(+bubble.dataset.mid),\n      emoticon: emoji,\n      interaction: {\n        _: 'dataJSON',\n        data: JSON.stringify(data)\n      }\n    }, true);\n\n    data.a.length = 0;\n  }, 1000, false);\n\n  const animation = !container.classList.contains('custom-emoji') ? lottieLoader.getAnimation(container) : undefined;\n  if(animation?.paused) {\n    const doc = await managers.appStickersManager.getAnimatedEmojiSoundDocument(emoji);\n    if(doc) {\n      const audio = document.createElement('audio');\n      audio.style.display = 'none';\n      container.parentElement.append(audio);\n\n      try {\n        const url = await appDownloadManager.downloadMediaURL({media: doc});\n\n        audio.src = url;\n        audio.play();\n        await onMediaLoad(audio, undefined, true);\n\n        audio.addEventListener('ended', () => {\n          audio.src = '';\n          audio.remove();\n        }, {once: true});\n      } catch(err) {\n\n      }\n    }\n\n    animation.autoplay = true;\n    animation.restart();\n  }\n\n  const doc = await managers.appStickersManager.getAnimatedEmojiSticker(emoji, true);\n  if(!doc) {\n    return;\n  }\n\n  const isOut = bubble ? bubble.classList.contains('is-out') : undefined;\n  const {animationDiv} = wrapStickerAnimation({\n    doc,\n    middleware,\n    side: isOut ? 'right' : 'left',\n    size: 360,\n    target: container,\n    play: true,\n    withRandomOffset: true\n  });\n\n  if(isOut !== undefined && !isOut) {\n    animationDiv.classList.add('reflect-x');\n  }\n\n  // using a trick here: simulated event from interlocutor's interaction won't fire ours\n  if(event.isTrusted) {\n    data.a.push({\n      i: 1,\n      t: Date.now()\n    });\n\n    sendInteractionThrottled();\n  }\n  // });\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\n/**\n  * https://core.telegram.org/api/files#vector-thumbnails\n  */\nexport default function getPathFromBytes(bytes: Uint8Array) {\n  const lookup = 'AACAAAAHAAALMAAAQASTAVAAAZaacaaaahaaalmaaaqastava.az0123456789-,';\n\n  let path = 'M';\n  for(let i = 0, length = bytes.length; i < length; ++i) {\n    const num = bytes[i];\n\n    if(num >= (128 + 64)) {\n      path += lookup[num - 128 - 64];\n    } else {\n      if(num >= 128) {\n        path += ',';\n      } else if(num >= 64) {\n        path += '-';\n      }\n      path += '' + (num & 63);\n    }\n  }\n  path += 'z';\n\n  return path;\n}\n","// https://github.com/telegramdesktop/tdesktop/blob/543bfab24a76402992421063f1e6444f347d31fe/Telegram/SourceFiles/boxes/sticker_set_box.cpp#L75\nexport default function computeLockColor(canvas: HTMLCanvasElement) {\n  const context = canvas.getContext('2d');\n  const size = 20 * (canvas.dpr ?? 1);\n  const width = size;\n  const height = size;\n  const skipx = (canvas.width - width) / 2;\n  const margin = 0/*  * (canvas.dpr ?? 1) */;\n  const skipy = canvas.height - height - margin;\n  const imageData = context.getImageData(skipx, skipy, width, height).data;\n  let sr = 0, sg = 0, sb = 0, sa = 0;\n  for(let i = 0; i < imageData.length; i += 4) {\n    sr += imageData[i];\n    sg += imageData[i + 1];\n    sb += imageData[i + 2];\n    sa += imageData[i + 3];\n  }\n\n  const outCanvas = document.createElement('canvas');\n  outCanvas.width = size;\n  outCanvas.height = size;\n  const outContext = outCanvas.getContext('2d');\n  const color = new Uint8ClampedArray([sr * 255 / sa, sg * 255 / sa, sb * 255 / sa, 255]);\n  const rgba = `rgba(${color[0]}, ${color[1]}, ${color[2]}, ${color[3]})`;\n  outContext.fillStyle = rgba;\n  outContext.fillRect(0, 0, outCanvas.width, outCanvas.height);\n  outContext.fillStyle = `rgba(112, 117, 121, 0.3)`;\n  outContext.fillRect(0, 0, outCanvas.width, outCanvas.height);\n  // document.querySelector('.popup-title').append(c);\n  return outCanvas.toDataURL('image/jpeg');\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport IS_VIBRATE_SUPPORTED from '../../environment/vibrateSupport';\nimport assumeType from '../../helpers/assumeType';\nimport isInDOM from '../../helpers/dom/isInDOM';\nimport makeError from '../../helpers/makeError';\nimport {getMiddleware, Middleware} from '../../helpers/middleware';\nimport throttleWithRaf from '../../helpers/schedulers/throttleWithRaf';\nimport windowSize from '../../helpers/windowSize';\nimport {PhotoSize, VideoSize} from '../../layer';\nimport {MyDocument} from '../../lib/appManagers/appDocsManager';\nimport appImManager from '../../lib/appManagers/appImManager';\nimport {AppManagers} from '../../lib/appManagers/managers';\nimport RLottiePlayer from '../../lib/rlottie/rlottiePlayer';\nimport wrapSticker from './sticker';\n\nexport default function wrapStickerAnimation({\n  size,\n  doc,\n  middleware,\n  target,\n  side,\n  skipRatio,\n  play,\n  managers,\n  fullThumb,\n  withRandomOffset,\n  relativeEffect,\n  loopEffect\n}: {\n  size: number,\n  doc: MyDocument,\n  middleware?: Middleware,\n  target: HTMLElement,\n  side: 'left' | 'center' | 'right',\n  skipRatio?: number,\n  play: boolean,\n  managers?: AppManagers,\n  fullThumb?: PhotoSize | VideoSize,\n  withRandomOffset?: boolean,\n  relativeEffect?: boolean,\n  loopEffect?: boolean\n}) {\n  const animationDiv = document.createElement('div');\n  animationDiv.classList.add('emoji-animation');\n\n  // const size = 280;\n  animationDiv.style.width = size + 'px';\n  animationDiv.style.height = size + 'px';\n\n  let animation: RLottiePlayer;\n  const unmountAnimation = () => {\n    middlewareHelper.clean();\n    animation?.remove();\n    animationDiv.remove();\n    appImManager.chat.bubbles.scrollable.container.removeEventListener('scroll', onScroll);\n  };\n\n  const middlewareHelper = middleware?.create() ?? getMiddleware();\n  middleware = middlewareHelper.get();\n\n  const stickerPromise = wrapSticker({\n    div: animationDiv,\n    doc,\n    middleware,\n    withThumb: false,\n    needFadeIn: false,\n    loop: !!loopEffect,\n    width: size,\n    height: size,\n    play,\n    group: 'none',\n    skipRatio,\n    managers,\n    fullThumb\n  }).then(({render}) => render).then((_animation) => {\n    assumeType<RLottiePlayer>(_animation);\n    if(!middleware()) {\n      _animation.remove();\n      throw makeError('MIDDLEWARE');\n    }\n\n    animation = _animation;\n    animation.addEventListener('enterFrame', (frameNo) => {\n      if((!loopEffect && frameNo === animation.maxFrame) || !isInDOM(target)) {\n        unmountAnimation();\n      }\n    });\n\n    if(IS_VIBRATE_SUPPORTED) {\n      animation.addEventListener('firstFrame', () => {\n        navigator.vibrate(100);\n      }, {once: true});\n    }\n\n    return animation;\n  });\n\n  const generateRandomSigned = (max: number) => {\n    const r = Math.random() * max * 2;\n    return r > max ? -r % max : r;\n  };\n\n  const randomOffsetX = withRandomOffset ? generateRandomSigned(16) : 0;\n  const randomOffsetY = withRandomOffset ? generateRandomSigned(4) : 0;\n  const setPosition = () => {\n    if(!isInDOM(target)) {\n      unmountAnimation();\n      return;\n    }\n\n    const rect = target.getBoundingClientRect();\n\n    const factor = rect.width / 200;\n    const stableOffsetX = side === 'center' ? 0 : 16 * (side === 'right' ? 1 : -1) * factor;\n    // const stableOffsetY = side === 'center' ? 0 : -50 * factor;\n    const stableOffsetY = side === 'center' ? 0 : 0 * factor;\n\n    const rectX = side === 'right' ? rect.right : rect.left;\n    const rectY = rect.top;\n\n    const addOffsetX = (side === 'center' ? (rect.width - size) / 2 : (side === 'right' ? -size : 0)) + stableOffsetX + randomOffsetX;\n    const addOffsetY = (side === 'center' || true ? (rect.height - size) / 2 : 0) + stableOffsetY + randomOffsetY;\n    const x = rectX + addOffsetX;\n    const y = rectY + addOffsetY;\n\n    if(y <= -size || y >= windowSize.height) {\n      unmountAnimation();\n      return;\n    }\n\n    if(relativeEffect) {\n      if(side !== 'center') animationDiv.style[side] = Math.abs(stableOffsetX) * -1 + 'px';\n      else animationDiv.style.left = addOffsetX + 'px';\n      animationDiv.style.top = addOffsetY + 'px';\n    } else {\n      animationDiv.style.top = y + 'px';\n      animationDiv.style.left = x + 'px';\n    }\n  };\n\n  const onScroll = throttleWithRaf(setPosition);\n  appImManager.chat.bubbles.scrollable.container.addEventListener('scroll', onScroll);\n\n  setPosition();\n\n  if(relativeEffect) {\n    animationDiv.classList.add('is-relative');\n    target.parentElement.append(animationDiv);\n  } else {\n    appImManager.emojiAnimationContainer.append(animationDiv);\n  }\n\n  return {animationDiv, stickerPromise};\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport {AppManagers} from '../../lib/appManagers/managers';\nimport rootScope from '../../lib/rootScope';\nimport wrapSticker from './sticker'\n\nexport default async function wrapStickerEmoji({emoji, div, width, height, managers = rootScope.managers}: {\n  emoji: string,\n  div: HTMLElement,\n  managers?: AppManagers,\n  width: number,\n  height: number\n}) {\n  const doc = await managers.appStickersManager.getAnimatedEmojiSticker(emoji);\n  if(!doc) {\n    div.classList.add('media-sticker-wrapper');\n    throw new Error('no sticker');\n  }\n\n  return wrapSticker({\n    doc,\n    div,\n    emoji,\n    width,\n    height,\n    loop: false,\n    play: true\n  });\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport limitSymbols from '../../helpers/string/limitSymbols';\nimport {WebPage} from '../../layer';\nimport wrapRichText from '../../lib/richTextProcessor/wrapRichText';\n\nexport default function wrapWebPageDescription(webPage: WebPage.webPage) {\n  const shortDescriptionText = limitSymbols(webPage.description || '', 150, 180);\n  // const siteName = webPage.site_name;\n  // let contextHashtag = '';\n  // if(siteName === 'GitHub') {\n  //   const matches = apiWebPage.url.match(/(https?:\\/\\/github\\.com\\/[^\\/]+\\/[^\\/]+)/);\n  //   if(matches) {\n  //     contextHashtag = matches[0] + '/issues/{1}';\n  //   }\n  // }\n  return wrapRichText(shortDescriptionText/* , {\n    contextSite: siteName || 'external',\n    contextHashtag: contextHashtag\n  } */);\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport limitSymbols from '../../helpers/string/limitSymbols';\nimport {WebPage} from '../../layer';\nimport wrapRichText from '../../lib/richTextProcessor/wrapRichText';\n\nexport default function wrapWebPageTitle(webPage: WebPage.webPage) {\n  let shortTitle = webPage.title || webPage.author || webPage.site_name || '';\n  shortTitle = limitSymbols(shortTitle, 80, 100);\n  return wrapRichText(shortTitle, {noLinks: true, noLinebreaks: true});\n}\n","// Taken from https://core.telegram.org/bots/payments/currencies.json\nexport type Currency = {\n  code: string,\n  title: string,\n  symbol: string,\n  native: string,\n  thousands_sep: string,\n  decimal_sep: string,\n  symbol_left: boolean,\n  space_between: boolean,\n  exp: number,\n  min_amount: string | number,\n  max_amount: string | number\n};\n\nconst Currencies: {[currency: string]: Currency} = {'AED':{'code':'AED', 'title':'United Arab Emirates Dirham', 'symbol':'AED', 'native':'..', 'thousands_sep':',', 'decimal_sep':'.', 'symbol_left':true, 'space_between':true, 'exp':2, 'min_amount':'367', 'max_amount':'3672990'}, 'AFN':{'code':'AFN', 'title':'Afghan Afghani', 'symbol':'AFN', 'native':'', 'thousands_sep':',', 'decimal_sep':'.', 'symbol_left':true, 'space_between':false, 'exp':2, 'min_amount':'8893', 'max_amount':'88930176'}, 'ALL':{'code':'ALL', 'title':'Albanian Lek', 'symbol':'ALL', 'native':'Lek', 'thousands_sep':'.', 'decimal_sep':',', 'symbol_left':false, 'space_between':false, 'exp':2, 'min_amount':'11408', 'max_amount':'114088432'}, 'AMD':{'code':'AMD', 'title':'Armenian Dram', 'symbol':'AMD', 'native':'.', 'thousands_sep':',', 'decimal_sep':'.', 'symbol_left':false, 'space_between':true, 'exp':2, 'min_amount':'41129', 'max_amount':'411293180'}, 'ARS':{'code':'ARS', 'title':'Argentine Peso', 'symbol':'ARS', 'native':'$', 'thousands_sep':'.', 'decimal_sep':',', 'symbol_left':true, 'space_between':true, 'exp':2, 'min_amount':'12503', 'max_amount':'125036607'}, 'AUD':{'code':'AUD', 'title':'Australian Dollar', 'symbol':'AU$', 'native':'$', 'thousands_sep':',', 'decimal_sep':'.', 'symbol_left':true, 'space_between':false, 'exp':2, 'min_amount':'145', 'max_amount':'1451625'}, 'AZN':{'code':'AZN', 'title':'Azerbaijani Manat', 'symbol':'AZN', 'native':'.', 'thousands_sep':' ', 'decimal_sep':',', 'symbol_left':false, 'space_between':true, 'exp':2, 'min_amount':'171', 'max_amount':'1711164'}, 'BAM':{'code':'BAM', 'title':'Bosnia & Herzegovina Convertible Mark', 'symbol':'BAM', 'native':'KM', 'thousands_sep':'.', 'decimal_sep':',', 'symbol_left':false, 'space_between':true, 'exp':2, 'min_amount':'187', 'max_amount':'1873042'}, 'BDT':{'code':'BDT', 'title':'Bangladeshi Taka', 'symbol':'BDT', 'native':'', 'thousands_sep':',', 'decimal_sep':'.', 'symbol_left':true, 'space_between':true, 'exp':2, 'min_amount':'9415', 'max_amount':'94154281'}, 'BGN':{'code':'BGN', 'title':'Bulgarian Lev', 'symbol':'BGN', 'native':'.', 'thousands_sep':' ', 'decimal_sep':',', 'symbol_left':false, 'space_between':true, 'exp':2, 'min_amount':'186', 'max_amount':'1869710'}, 'BND':{'code':'BND', 'title':'Brunei Dollar', 'symbol':'BND', 'native':'$', 'thousands_sep':'.', 'decimal_sep':',', 'symbol_left':true, 'space_between':false, 'exp':2, 'min_amount':'139', 'max_amount':'1399458'}, 'BOB':{'code':'BOB', 'title':'Bolivian Boliviano', 'symbol':'BOB', 'native':'Bs', 'thousands_sep':'.', 'decimal_sep':',', 'symbol_left':true, 'space_between':true, 'exp':2, 'min_amount':'692', 'max_amount':'6926834'}, 'BRL':{'code':'BRL', 'title':'Brazilian Real', 'symbol':'R$', 'native':'R$', 'thousands_sep':'.', 'decimal_sep':',', 'symbol_left':true, 'space_between':true, 'exp':2, 'min_amount':'518', 'max_amount':'5182986'}, 'CAD':{'code':'CAD', 'title':'Canadian Dollar', 'symbol':'CA$', 'native':'$', 'thousands_sep':',', 'decimal_sep':'.', 'symbol_left':true, 'space_between':false, 'exp':2, 'min_amount':'129', 'max_amount':'1290450'}, 'CHF':{'code':'CHF', 'title':'Swiss Franc', 'symbol':'CHF', 'native':'CHF', 'thousands_sep':'\\'', 'decimal_sep':'.', 'symbol_left':false, 'space_between':true, 'exp':2, 'min_amount':'95', 'max_amount':'954630'}, 'CLP':{'code':'CLP', 'title':'Chilean Peso', 'symbol':'CLP', 'native':'$', 'thousands_sep':'.', 'decimal_sep':',', 'symbol_left':true, 'space_between':true, 'exp':0, 'min_amount':'926', 'max_amount':'9268013'}, 'CNY':{'code':'CNY', 'title':'Chinese Renminbi Yuan', 'symbol':'CN', 'native':'CN', 'thousands_sep':',', 'decimal_sep':'.', 'symbol_left':true, 'space_between':false, 'exp':2, 'min_amount':'669', 'max_amount':'6692902'}, 'COP':{'code':'COP', 'title':'Colombian Peso', 'symbol':'COP', 'native':'$', 'thousands_sep':'.', 'decimal_sep':',', 'symbol_left':true, 'space_between':true, 'exp':2, 'min_amount':'410927', 'max_amount':'4109270000'}, 'CRC':{'code':'CRC', 'title':'Costa Rican Coln', 'symbol':'CRC', 'native':'', 'thousands_sep':'.', 'decimal_sep':',', 'symbol_left':true, 'space_between':false, 'exp':2, 'min_amount':'69166', 'max_amount':'691668622'}, 'CZK':{'code':'CZK', 'title':'Czech Koruna', 'symbol':'CZK', 'native':'K', 'thousands_sep':' ', 'decimal_sep':',', 'symbol_left':false, 'space_between':true, 'exp':2, 'min_amount':'2367', 'max_amount':'23674601'}, 'DKK':{'code':'DKK', 'title':'Danish Krone', 'symbol':'DKK', 'native':'kr', 'thousands_sep':'', 'decimal_sep':',', 'symbol_left':false, 'space_between':true, 'exp':2, 'min_amount':'712', 'max_amount':'7120540'}, 'DOP':{'code':'DOP', 'title':'Dominican Peso', 'symbol':'DOP', 'native':'$', 'thousands_sep':',', 'decimal_sep':'.', 'symbol_left':true, 'space_between':false, 'exp':2, 'min_amount':'5497', 'max_amount':'54971796'}, 'DZD':{'code':'DZD', 'title':'Algerian Dinar', 'symbol':'DZD', 'native':'..', 'thousands_sep':',', 'decimal_sep':'.', 'symbol_left':true, 'space_between':true, 'exp':2, 'min_amount':'14655', 'max_amount':'146557782'}, 'EGP':{'code':'EGP', 'title':'Egyptian Pound', 'symbol':'EGP', 'native':'..', 'thousands_sep':',', 'decimal_sep':'.', 'symbol_left':true, 'space_between':true, 'exp':2, 'min_amount':'1879', 'max_amount':'18794601'}, 'EUR':{'code':'EUR', 'title':'Euro', 'symbol':'', 'native':'', 'thousands_sep':' ', 'decimal_sep':',', 'symbol_left':false, 'space_between':true, 'exp':2, 'min_amount':'95', 'max_amount':'957150'}, 'GBP':{'code':'GBP', 'title':'British Pound', 'symbol':'', 'native':'', 'thousands_sep':',', 'decimal_sep':'.', 'symbol_left':true, 'space_between':false, 'exp':2, 'min_amount':'82', 'max_amount':'822531'}, 'GEL':{'code':'GEL', 'title':'Georgian Lari', 'symbol':'GEL', 'native':'GEL', 'thousands_sep':' ', 'decimal_sep':',', 'symbol_left':false, 'space_between':true, 'exp':2, 'min_amount':'293', 'max_amount':'2939866'}, 'GTQ':{'code':'GTQ', 'title':'Guatemalan Quetzal', 'symbol':'GTQ', 'native':'Q', 'thousands_sep':',', 'decimal_sep':'.', 'symbol_left':true, 'space_between':false, 'exp':2, 'min_amount':'781', 'max_amount':'7811180'}, 'HKD':{'code':'HKD', 'title':'Hong Kong Dollar', 'symbol':'HK$', 'native':'$', 'thousands_sep':',', 'decimal_sep':'.', 'symbol_left':true, 'space_between':false, 'exp':2, 'min_amount':'784', 'max_amount':'7845675'}, 'HNL':{'code':'HNL', 'title':'Honduran Lempira', 'symbol':'HNL', 'native':'L', 'thousands_sep':',', 'decimal_sep':'.', 'symbol_left':true, 'space_between':true, 'exp':2, 'min_amount':'2476', 'max_amount':'24763692'}, 'HRK':{'code':'HRK', 'title':'Croatian Kuna', 'symbol':'HRK', 'native':'kn', 'thousands_sep':'.', 'decimal_sep':',', 'symbol_left':false, 'space_between':true, 'exp':2, 'min_amount':'721', 'max_amount':'7210988'}, 'HUF':{'code':'HUF', 'title':'Hungarian Forint', 'symbol':'HUF', 'native':'Ft', 'thousands_sep':' ', 'decimal_sep':',', 'symbol_left':false, 'space_between':true, 'exp':2, 'min_amount':'37819', 'max_amount':'378197939'}, 'IDR':{'code':'IDR', 'title':'Indonesian Rupiah', 'symbol':'IDR', 'native':'Rp', 'thousands_sep':'.', 'decimal_sep':',', 'symbol_left':true, 'space_between':false, 'exp':2, 'min_amount':'1490695', 'max_amount':'14906950000'}, 'ILS':{'code':'ILS', 'title':'Israeli New Sheqel', 'symbol':'', 'native':'', 'thousands_sep':',', 'decimal_sep':'.', 'symbol_left':true, 'space_between':true, 'exp':2, 'min_amount':'348', 'max_amount':'3480155'}, 'INR':{'code':'INR', 'title':'Indian Rupee', 'symbol':'', 'native':'', 'thousands_sep':',', 'decimal_sep':'.', 'symbol_left':true, 'space_between':false, 'exp':2, 'min_amount':'7894', 'max_amount':'78945050'}, 'ISK':{'code':'ISK', 'title':'Icelandic Krna', 'symbol':'ISK', 'native':'kr', 'thousands_sep':'.', 'decimal_sep':',', 'symbol_left':false, 'space_between':true, 'exp':0, 'min_amount':'133', 'max_amount':'1336303'}, 'JMD':{'code':'JMD', 'title':'Jamaican Dollar', 'symbol':'JMD', 'native':'$', 'thousands_sep':',', 'decimal_sep':'.', 'symbol_left':true, 'space_between':false, 'exp':2, 'min_amount':'15175', 'max_amount':'151753529'}, 'JPY':{'code':'JPY', 'title':'Japanese Yen', 'symbol':'', 'native':'', 'thousands_sep':',', 'decimal_sep':'.', 'symbol_left':true, 'space_between':false, 'exp':0, 'min_amount':'136', 'max_amount':'1362010'}, 'KES':{'code':'KES', 'title':'Kenyan Shilling', 'symbol':'KES', 'native':'Ksh', 'thousands_sep':',', 'decimal_sep':'.', 'symbol_left':true, 'space_between':false, 'exp':2, 'min_amount':'11787', 'max_amount':'117879251'}, 'KGS':{'code':'KGS', 'title':'Kyrgyzstani Som', 'symbol':'KGS', 'native':'KGS', 'thousands_sep':' ', 'decimal_sep':'-', 'symbol_left':false, 'space_between':true, 'exp':2, 'min_amount':'7950', 'max_amount':'79509472'}, 'KRW':{'code':'KRW', 'title':'South Korean Won', 'symbol':'', 'native':'', 'thousands_sep':',', 'decimal_sep':'.', 'symbol_left':true, 'space_between':false, 'exp':0, 'min_amount':'1297', 'max_amount':'12971249'}, 'KZT':{'code':'KZT', 'title':'Kazakhstani Tenge', 'symbol':'KZT', 'native':'', 'thousands_sep':' ', 'decimal_sep':'-', 'symbol_left':true, 'space_between':false, 'exp':2, 'min_amount':'47177', 'max_amount':'471777437'}, 'LBP':{'code':'LBP', 'title':'Lebanese Pound', 'symbol':'LBP', 'native':'..', 'thousands_sep':',', 'decimal_sep':'.', 'symbol_left':true, 'space_between':true, 'exp':2, 'min_amount':'152338', 'max_amount':'1523381760'}, 'LKR':{'code':'LKR', 'title':'Sri Lankan Rupee', 'symbol':'LKR', 'native':'.', 'thousands_sep':',', 'decimal_sep':'.', 'symbol_left':true, 'space_between':true, 'exp':2, 'min_amount':'36271', 'max_amount':'362713465'}, 'MAD':{'code':'MAD', 'title':'Moroccan Dirham', 'symbol':'MAD', 'native':'..', 'thousands_sep':',', 'decimal_sep':'.', 'symbol_left':true, 'space_between':true, 'exp':2, 'min_amount':'1018', 'max_amount':'10188182'}, 'MDL':{'code':'MDL', 'title':'Moldovan Leu', 'symbol':'MDL', 'native':'MDL', 'thousands_sep':',', 'decimal_sep':'.', 'symbol_left':false, 'space_between':true, 'exp':2, 'min_amount':'1928', 'max_amount':'19284237'}, 'MNT':{'code':'MNT', 'title':'Mongolian Tgrg', 'symbol':'MNT', 'native':'MNT', 'thousands_sep':' ', 'decimal_sep':',', 'symbol_left':true, 'space_between':false, 'exp':2, 'min_amount':'312408', 'max_amount':'3124087599'}, 'MUR':{'code':'MUR', 'title':'Mauritian Rupee', 'symbol':'MUR', 'native':'MUR', 'thousands_sep':',', 'decimal_sep':'.', 'symbol_left':true, 'space_between':false, 'exp':2, 'min_amount':'4614', 'max_amount':'46144273'}, 'MVR':{'code':'MVR', 'title':'Maldivian Rufiyaa', 'symbol':'MVR', 'native':'MVR', 'thousands_sep':',', 'decimal_sep':'.', 'symbol_left':false, 'space_between':true, 'exp':2, 'min_amount':'1534', 'max_amount':'15349670'}, 'MXN':{'code':'MXN', 'title':'Mexican Peso', 'symbol':'MX$', 'native':'$', 'thousands_sep':',', 'decimal_sep':'.', 'symbol_left':true, 'space_between':false, 'exp':2, 'min_amount':'2015', 'max_amount':'20158770'}, 'MYR':{'code':'MYR', 'title':'Malaysian Ringgit', 'symbol':'MYR', 'native':'RM', 'thousands_sep':',', 'decimal_sep':'.', 'symbol_left':true, 'space_between':false, 'exp':2, 'min_amount':'440', 'max_amount':'4406499'}, 'MZN':{'code':'MZN', 'title':'Mozambican Metical', 'symbol':'MZN', 'native':'MTn', 'thousands_sep':',', 'decimal_sep':'.', 'symbol_left':true, 'space_between':false, 'exp':2, 'min_amount':'6383', 'max_amount':'63830365'}, 'NGN':{'code':'NGN', 'title':'Nigerian Naira', 'symbol':'NGN', 'native':'', 'thousands_sep':',', 'decimal_sep':'.', 'symbol_left':true, 'space_between':false, 'exp':2, 'min_amount':'41513', 'max_amount':'415132815'}, 'NIO':{'code':'NIO', 'title':'Nicaraguan Crdoba', 'symbol':'NIO', 'native':'C$', 'thousands_sep':',', 'decimal_sep':'.', 'symbol_left':true, 'space_between':true, 'exp':2, 'min_amount':'3612', 'max_amount':'36125609'}, 'NOK':{'code':'NOK', 'title':'Norwegian Krone', 'symbol':'NOK', 'native':'kr', 'thousands_sep':' ', 'decimal_sep':',', 'symbol_left':true, 'space_between':true, 'exp':2, 'min_amount':'990', 'max_amount':'9902585'}, 'NPR':{'code':'NPR', 'title':'Nepalese Rupee', 'symbol':'NPR', 'native':'', 'thousands_sep':',', 'decimal_sep':'.', 'symbol_left':true, 'space_between':false, 'exp':2, 'min_amount':'12731', 'max_amount':'127318435'}, 'NZD':{'code':'NZD', 'title':'New Zealand Dollar', 'symbol':'NZ$', 'native':'$', 'thousands_sep':',', 'decimal_sep':'.', 'symbol_left':true, 'space_between':false, 'exp':2, 'min_amount':'160', 'max_amount':'1603695'}, 'PAB':{'code':'PAB', 'title':'Panamanian Balboa', 'symbol':'PAB', 'native':'B\\/.', 'thousands_sep':',', 'decimal_sep':'.', 'symbol_left':true, 'space_between':true, 'exp':2, 'min_amount':'100', 'max_amount':'1007566'}, 'PEN':{'code':'PEN', 'title':'Peruvian Nuevo Sol', 'symbol':'PEN', 'native':'S\\/.', 'thousands_sep':',', 'decimal_sep':'.', 'symbol_left':true, 'space_between':true, 'exp':2, 'min_amount':'381', 'max_amount':'3818809'}, 'PHP':{'code':'PHP', 'title':'Philippine Peso', 'symbol':'PHP', 'native':'', 'thousands_sep':',', 'decimal_sep':'.', 'symbol_left':true, 'space_between':false, 'exp':2, 'min_amount':'5499', 'max_amount':'54994501'}, 'PKR':{'code':'PKR', 'title':'Pakistani Rupee', 'symbol':'PKR', 'native':'', 'thousands_sep':',', 'decimal_sep':'.', 'symbol_left':true, 'space_between':false, 'exp':2, 'min_amount':'20651', 'max_amount':'206515440'}, 'PLN':{'code':'PLN', 'title':'Polish Zoty', 'symbol':'PLN', 'native':'z', 'thousands_sep':' ', 'decimal_sep':',', 'symbol_left':false, 'space_between':true, 'exp':2, 'min_amount':'446', 'max_amount':'4466920'}, 'PYG':{'code':'PYG', 'title':'Paraguayan Guaran', 'symbol':'PYG', 'native':'', 'thousands_sep':'.', 'decimal_sep':',', 'symbol_left':true, 'space_between':true, 'exp':0, 'min_amount':'6909', 'max_amount':'69095662'}, 'QAR':{'code':'QAR', 'title':'Qatari Riyal', 'symbol':'QAR', 'native':'..', 'thousands_sep':',', 'decimal_sep':'.', 'symbol_left':true, 'space_between':true, 'exp':2, 'min_amount':'364', 'max_amount':'3640988'}, 'RON':{'code':'RON', 'title':'Romanian Leu', 'symbol':'RON', 'native':'RON', 'thousands_sep':'.', 'decimal_sep':',', 'symbol_left':false, 'space_between':true, 'exp':2, 'min_amount':'473', 'max_amount':'4736501'}, 'RSD':{'code':'RSD', 'title':'Serbian Dinar', 'symbol':'RSD', 'native':'.', 'thousands_sep':'.', 'decimal_sep':',', 'symbol_left':false, 'space_between':true, 'exp':2, 'min_amount':'11252', 'max_amount':'112520089'}, 'RUB':{'code':'RUB', 'title':'Russian Ruble', 'symbol':'RUB', 'native':'.', 'thousands_sep':' ', 'decimal_sep':',', 'symbol_left':false, 'space_between':true, 'exp':2, 'min_amount':'5282', 'max_amount':'52825030'}, 'SAR':{'code':'SAR', 'title':'Saudi Riyal', 'symbol':'SAR', 'native':'..', 'thousands_sep':',', 'decimal_sep':'.', 'symbol_left':true, 'space_between':true, 'exp':2, 'min_amount':'375', 'max_amount':'3752099'}, 'SEK':{'code':'SEK', 'title':'Swedish Krona', 'symbol':'SEK', 'native':'kr', 'thousands_sep':'.', 'decimal_sep':',', 'symbol_left':false, 'space_between':true, 'exp':2, 'min_amount':'1022', 'max_amount':'10224070'}, 'SGD':{'code':'SGD', 'title':'Singapore Dollar', 'symbol':'SGD', 'native':'$', 'thousands_sep':',', 'decimal_sep':'.', 'symbol_left':true, 'space_between':false, 'exp':2, 'min_amount':'139', 'max_amount':'1390698'}, 'THB':{'code':'THB', 'title':'Thai Baht', 'symbol':'', 'native':'', 'thousands_sep':',', 'decimal_sep':'.', 'symbol_left':true, 'space_between':false, 'exp':2, 'min_amount':'3529', 'max_amount':'35290499'}, 'TJS':{'code':'TJS', 'title':'Tajikistani Somoni', 'symbol':'TJS', 'native':'TJS', 'thousands_sep':' ', 'decimal_sep':';', 'symbol_left':false, 'space_between':true, 'exp':2, 'min_amount':'977', 'max_amount':'9773409'}, 'TRY':{'code':'TRY', 'title':'Turkish Lira', 'symbol':'TRY', 'native':'TL', 'thousands_sep':'.', 'decimal_sep':',', 'symbol_left':false, 'space_between':true, 'exp':2, 'min_amount':'1667', 'max_amount':'16673549'}, 'TTD':{'code':'TTD', 'title':'Trinidad and Tobago Dollar', 'symbol':'TTD', 'native':'$', 'thousands_sep':',', 'decimal_sep':'.', 'symbol_left':true, 'space_between':false, 'exp':2, 'min_amount':'684', 'max_amount':'6847347'}, 'TWD':{'code':'TWD', 'title':'New Taiwan Dollar', 'symbol':'NT$', 'native':'NT$', 'thousands_sep':',', 'decimal_sep':'.', 'symbol_left':true, 'space_between':false, 'exp':2, 'min_amount':'2973', 'max_amount':'29735499'}, 'TZS':{'code':'TZS', 'title':'Tanzanian Shilling', 'symbol':'TZS', 'native':'TSh', 'thousands_sep':',', 'decimal_sep':'.', 'symbol_left':true, 'space_between':false, 'exp':2, 'min_amount':'233200', 'max_amount':'2332000087'}, 'UAH':{'code':'UAH', 'title':'Ukrainian Hryvnia', 'symbol':'UAH', 'native':'', 'thousands_sep':' ', 'decimal_sep':',', 'symbol_left':false, 'space_between':false, 'exp':2, 'min_amount':'2974', 'max_amount':'29741945'}, 'UGX':{'code':'UGX', 'title':'Ugandan Shilling', 'symbol':'UGX', 'native':'USh', 'thousands_sep':',', 'decimal_sep':'.', 'symbol_left':true, 'space_between':false, 'exp':0, 'min_amount':'3788', 'max_amount':'37883728'}, 'USD':{'code':'USD', 'title':'United States Dollar', 'symbol':'$', 'native':'$', 'thousands_sep':',', 'decimal_sep':'.', 'symbol_left':true, 'space_between':false, 'exp':2, 'min_amount':'100', 'max_amount':1000000}, 'UYU':{'code':'UYU', 'title':'Uruguayan Peso', 'symbol':'UYU', 'native':'$', 'thousands_sep':'.', 'decimal_sep':',', 'symbol_left':true, 'space_between':true, 'exp':2, 'min_amount':'3979', 'max_amount':'39794286'}, 'UZS':{'code':'UZS', 'title':'Uzbekistani Som', 'symbol':'UZS', 'native':'UZS', 'thousands_sep':' ', 'decimal_sep':',', 'symbol_left':false, 'space_between':true, 'exp':2, 'min_amount':'1094209', 'max_amount':'10942099215'}, 'VND':{'code':'VND', 'title':'Vietnamese ng', 'symbol':'', 'native':'', 'thousands_sep':'.', 'decimal_sep':',', 'symbol_left':false, 'space_between':true, 'exp':0, 'min_amount':'23270', 'max_amount':'232700000'}, 'YER':{'code':'YER', 'title':'Yemeni Rial', 'symbol':'YER', 'native':'..', 'thousands_sep':',', 'decimal_sep':'.', 'symbol_left':true, 'space_between':true, 'exp':2, 'min_amount':'25024', 'max_amount':'250249914'}, 'ZAR':{'code':'ZAR', 'title':'South African Rand', 'symbol':'ZAR', 'native':'R', 'thousands_sep':',', 'decimal_sep':'.', 'symbol_left':true, 'space_between':true, 'exp':2, 'min_amount':'1624', 'max_amount':'16246189'}};\n\nexport default Currencies;\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport type {EMOJI_VERSION} from '../environment/emojiVersionsSupport';\n\nexport const EmojiVersions: {[version in EMOJI_VERSION]: {[emoji: string]: number}} = {'14':{'1f6dd':4867, '1f6de':4916, '1f6df':4923, '1f7f0':62832, '1f979':183, '1f9cc':1557, '1fa7b':61332, '1fa7c':61330, '1faa9':51093, '1faaa':61364, '1faab':61189, '1faac':51085, '1fab7':2651, '1fab8':2631, '1fab9':2672, '1faba':2673, '1fac3':1520, '1fac4':1521, '1fac5':1505, '1fad7':3793, '1fad8':3707, '1fad9':3804, '1fae0':111, '1fae1':136, '1fae2':132, '1fae3':133, '1fae4':174, '1fae5':142, '1fae6':1385, '1fae7':61353, '1faf0':1341, '1faf1':1332, '1faf2':1333, '1faf3':1334, '1faf4':1335, '1faf5':1351, '1faf6':1360, '1faf1-1f3fb-200d-1faf2-1f3fc':0, '1faf1-1f3fb-200d-1faf2-1f3fd':0, '1faf1-1f3fb-200d-1faf2-1f3fe':0, '1faf1-1f3fb-200d-1faf2-1f3ff':0, '1faf1-1f3fc-200d-1faf2-1f3fb':0, '1faf1-1f3fc-200d-1faf2-1f3fd':0, '1faf1-1f3fc-200d-1faf2-1f3fe':0, '1faf1-1f3fc-200d-1faf2-1f3ff':0, '1faf1-1f3fd-200d-1faf2-1f3fb':0, '1faf1-1f3fd-200d-1faf2-1f3fc':0, '1faf1-1f3fd-200d-1faf2-1f3fe':0, '1faf1-1f3fd-200d-1faf2-1f3ff':0, '1faf1-1f3fe-200d-1faf2-1f3fb':0, '1faf1-1f3fe-200d-1faf2-1f3fc':0, '1faf1-1f3fe-200d-1faf2-1f3fd':0, '1faf1-1f3fe-200d-1faf2-1f3ff':0, '1faf1-1f3ff-200d-1faf2-1f3fb':0, '1faf1-1f3ff-200d-1faf2-1f3fc':0, '1faf1-1f3ff-200d-1faf2-1f3fd':0, '1faf1-1f3ff-200d-1faf2-1f3fe':0, '1fac3-1f3fb':0, '1fac3-1f3fc':0, '1fac3-1f3fd':0, '1fac3-1f3fe':0, '1fac3-1f3ff':0, '1fac4-1f3fb':0, '1fac4-1f3fc':0, '1fac4-1f3fd':0, '1fac4-1f3fe':0, '1fac4-1f3ff':0, '1fac5-1f3fb':0, '1fac5-1f3fc':0, '1fac5-1f3fd':0, '1fac5-1f3fe':0, '1fac5-1f3ff':0, '1faf0-1f3fb':0, '1faf0-1f3fc':0, '1faf0-1f3fd':0, '1faf0-1f3fe':0, '1faf0-1f3ff':0, '1faf1-1f3fb':0, '1faf1-1f3fc':0, '1faf1-1f3fd':0, '1faf1-1f3fe':0, '1faf1-1f3ff':0, '1faf2-1f3fb':0, '1faf2-1f3fc':0, '1faf2-1f3fd':0, '1faf2-1f3fe':0, '1faf2-1f3ff':0, '1faf3-1f3fb':0, '1faf3-1f3fc':0, '1faf3-1f3fd':0, '1faf3-1f3fe':0, '1faf3-1f3ff':0, '1faf4-1f3fb':0, '1faf4-1f3fc':0, '1faf4-1f3fd':0, '1faf4-1f3fe':0, '1faf4-1f3ff':0, '1faf5-1f3fb':0, '1faf5-1f3fc':0, '1faf5-1f3fd':0, '1faf5-1f3fe':0, '1faf5-1f3ff':0, '1faf6-1f3fb':0, '1faf6-1f3fc':0, '1faf6-1f3fd':0, '1faf6-1f3fe':0, '1faf6-1f3ff':0}, '':{'2049':62835, '2122':62863, '2139':62888, '2194':62764, '2195':62763, '2196':62762, '2197':62756, '2198':62758, '2199':62760, '2328':61194, '2600':4990, '2601':4998, '2602':41013, '2603':41018, '2604':41020, '2611':62851, '2614':41014, '2615':3781, '2618':2667, '2620':1106, '2622':62753, '2623':62754, '2626':62783, '2638':62780, '2639':177, '2648':62788, '2649':62789, '2650':62796, '2651':62797, '2652':62798, '2653':62799, '2660':51095, '2663':51098, '2665':51096, '2666':51097, '2668':4865, '2692':61297, '2693':4922, '2694':61300, '2696':61311, '2697':61319, '2699':61309, '2702':61284, '2705':62850, '2708':4931, '2709':61245, '2712':61259, '2714':62852, '2716':62828, '2721':62779, '2728':51029, '2733':62858, '2734':62859, '2744':41017, '2747':62860, '2753':62836, '2754':62837, '2755':62838, '2757':62839, '2763':1137, '2764':1141, '2795':62829, '2796':62830, '2797':62831, '2934':62767, '2935':62768, '3030':62840, '3297':62912, '3299':62913, '0023-20e3':62864, '002a-20e3':62865, '0030-20e3':62866, '0031-20e3':62867, '0032-20e3':62868, '0033-20e3':62869, '0034-20e3':62870, '0035-20e3':62871, '0036-20e3':62872, '0037-20e3':62873, '0038-20e3':62874, '0039-20e3':62875, '00a9':62861, '00ae':62862, '1f004':51101, '1f0cf':51100, '1f170':62882, '1f171':62884, '1f17e':62893, '1f17f':62895, '1f18e':62883, '1f191':62885, '1f192':62886, '1f193':62887, '1f194':62889, '1f195':62891, '1f196':62892, '1f197':62894, '1f198':62896, '1f199':62897, '1f19a':62898, '1f1e6-1f1e8':71594, '1f1e6-1f1e9':71595, '1f1e6-1f1ea':71596, '1f1e6-1f1eb':71597, '1f1e6-1f1ec':71598, '1f1e6-1f1ee':71599, '1f1e6-1f1f1':71600, '1f1e6-1f1f2':71601, '1f1e6-1f1f4':71602, '1f1e6-1f1f6':71603, '1f1e6-1f1f7':71604, '1f1e6-1f1f8':71605, '1f1e6-1f1f9':71606, '1f1e6-1f1fa':71607, '1f1e6-1f1fc':71608, '1f1e6-1f1fd':71609, '1f1e6-1f1ff':71610, '1f1e7-1f1e6':71611, '1f1e7-1f1e7':71612, '1f1e7-1f1e9':71613, '1f1e7-1f1ea':71614, '1f1e7-1f1eb':71615, '1f1e7-1f1ec':71616, '1f1e7-1f1ed':71617, '1f1e7-1f1ee':71618, '1f1e7-1f1ef':71619, '1f1e7-1f1f1':71620, '1f1e7-1f1f2':71621, '1f1e7-1f1f3':71622, '1f1e7-1f1f4':71623, '1f1e7-1f1f6':71624, '1f1e7-1f1f7':71625, '1f1e7-1f1f8':71626, '1f1e7-1f1f9':71627, '1f1e7-1f1fb':71628, '1f1e7-1f1fc':71629, '1f1e7-1f1fe':71630, '1f1e7-1f1ff':71631, '1f1e8-1f1e6':71632, '1f1e8-1f1e8':71633, '1f1e8-1f1e9':71634, '1f1e8-1f1eb':71635, '1f1e8-1f1ec':71636, '1f1e8-1f1ed':71637, '1f1e8-1f1ee':71638, '1f1e8-1f1f0':71639, '1f1e8-1f1f1':71640, '1f1e8-1f1f2':71641, '1f1e8-1f1f3':71642, '1f1e8-1f1f4':71643, '1f1e8-1f1f5':71644, '1f1e8-1f1f7':71645, '1f1e8-1f1fa':71646, '1f1e8-1f1fb':71647, '1f1e8-1f1fc':71648, '1f1e8-1f1fd':71649, '1f1e8-1f1fe':71650, '1f1e8-1f1ff':71651, '1f1e9-1f1ea':71652, '1f1e9-1f1ec':71653, '1f1e9-1f1ef':71654, '1f1e9-1f1f0':71655, '1f1e9-1f1f2':71656, '1f1e9-1f1f4':71657, '1f1e9-1f1ff':71658, '1f1ea-1f1e6':71659, '1f1ea-1f1e8':71660, '1f1ea-1f1ea':71661, '1f1ea-1f1ec':71662, '1f1ea-1f1ed':71663, '1f1ea-1f1f7':71664, '1f1ea-1f1f8':71665, '1f1ea-1f1f9':71666, '1f1ea-1f1fa':71667, '1f1eb-1f1ee':71668, '1f1eb-1f1ef':71669, '1f1eb-1f1f0':71670, '1f1eb-1f1f2':71671, '1f1eb-1f1f4':71672, '1f1eb-1f1f7':71673, '1f1ec-1f1e6':71674, '1f1ec-1f1e7':71675, '1f1ec-1f1e9':71676, '1f1ec-1f1ea':71677, '1f1ec-1f1eb':71678, '1f1ec-1f1ec':71679, '1f1ec-1f1ed':71680, '1f1ec-1f1ee':71681, '1f1ec-1f1f1':71682, '1f1ec-1f1f2':71683, '1f1ec-1f1f3':71684, '1f1ec-1f1f5':71685, '1f1ec-1f1f6':71686, '1f1ec-1f1f7':71687, '1f1ec-1f1f8':71688, '1f1ec-1f1f9':71689, '1f1ec-1f1fa':71690, '1f1ec-1f1fc':71691, '1f1ec-1f1fe':71692, '1f1ed-1f1f0':71693, '1f1ed-1f1f2':71694, '1f1ed-1f1f3':71695, '1f1ed-1f1f7':71696, '1f1ed-1f1f9':71697, '1f1ed-1f1fa':71698, '1f1ee-1f1e8':71699, '1f1ee-1f1e9':71700, '1f1ee-1f1ea':71701, '1f1ee-1f1f1':71702, '1f1ee-1f1f2':71703, '1f1ee-1f1f3':71704, '1f1ee-1f1f4':71705, '1f1ee-1f1f6':71706, '1f1ee-1f1f7':71707, '1f1ee-1f1f8':71708, '1f1ee-1f1f9':71709, '1f1ef-1f1ea':71710, '1f1ef-1f1f2':71711, '1f1ef-1f1f4':71712, '1f1ef-1f1f5':71713, '1f1f0-1f1ea':71714, '1f1f0-1f1ec':71715, '1f1f0-1f1ed':71716, '1f1f0-1f1ee':71717, '1f1f0-1f1f2':71718, '1f1f0-1f1f3':71719, '1f1f0-1f1f5':71720, '1f1f0-1f1f7':71721, '1f1f0-1f1fc':71722, '1f1f0-1f1fe':71723, '1f1f0-1f1ff':71724, '1f1f1-1f1e6':71725, '1f1f1-1f1e7':71726, '1f1f1-1f1e8':71727, '1f1f1-1f1ee':71728, '1f1f1-1f1f0':71729, '1f1f1-1f1f7':71730, '1f1f1-1f1f8':71731, '1f1f1-1f1f9':71732, '1f1f1-1f1fa':71733, '1f1f1-1f1fb':71734, '1f1f1-1f1fe':71735, '1f1f2-1f1e6':71736, '1f1f2-1f1e8':71737, '1f1f2-1f1e9':71738, '1f1f2-1f1ea':71739, '1f1f2-1f1eb':71740, '1f1f2-1f1ec':71741, '1f1f2-1f1ed':71742, '1f1f2-1f1f0':71743, '1f1f2-1f1f1':71744, '1f1f2-1f1f2':71745, '1f1f2-1f1f3':71746, '1f1f2-1f1f4':71747, '1f1f2-1f1f5':71748, '1f1f2-1f1f6':71749, '1f1f2-1f1f7':71750, '1f1f2-1f1f8':71751, '1f1f2-1f1f9':71752, '1f1f2-1f1fa':71753, '1f1f2-1f1fb':71754, '1f1f2-1f1fc':71755, '1f1f2-1f1fd':71756, '1f1f2-1f1fe':71757, '1f1f2-1f1ff':71758, '1f1f3-1f1e6':71759, '1f1f3-1f1e8':71760, '1f1f3-1f1ea':71761, '1f1f3-1f1eb':71762, '1f1f3-1f1ec':71763, '1f1f3-1f1ee':71764, '1f1f3-1f1f1':71765, '1f1f3-1f1f4':71766, '1f1f3-1f1f5':71767, '1f1f3-1f1f7':71768, '1f1f3-1f1fa':71769, '1f1f3-1f1ff':71770, '1f1f4-1f1f2':71771, '1f1f5-1f1e6':71772, '1f1f5-1f1ea':71773, '1f1f5-1f1eb':71774, '1f1f5-1f1ec':71775, '1f1f5-1f1ed':71776, '1f1f5-1f1f0':71777, '1f1f5-1f1f1':71778, '1f1f5-1f1f2':71779, '1f1f5-1f1f3':71780, '1f1f5-1f1f7':71781, '1f1f5-1f1f8':71782, '1f1f5-1f1f9':71783, '1f1f5-1f1fc':71784, '1f1f5-1f1fe':71785, '1f1f6-1f1e6':71786, '1f1f7-1f1ea':71787, '1f1f7-1f1f4':71788, '1f1f7-1f1f8':71789, '1f1f7-1f1fa':71790, '1f1f7-1f1fc':71791, '1f1f8-1f1e6':71792, '1f1f8-1f1e7':71793, '1f1f8-1f1e8':71794, '1f1f8-1f1e9':71795, '1f1f8-1f1ea':71796, '1f1f8-1f1ec':71797, '1f1f8-1f1ed':71798, '1f1f8-1f1ee':71799, '1f1f8-1f1ef':71800, '1f1f8-1f1f0':71801, '1f1f8-1f1f1':71802, '1f1f8-1f1f2':71803, '1f1f8-1f1f3':71804, '1f1f8-1f1f4':71805, '1f1f8-1f1f7':71806, '1f1f8-1f1f8':71807, '1f1f8-1f1f9':71808, '1f1f8-1f1fb':71809, '1f1f8-1f1fd':71810, '1f1f8-1f1fe':71811, '1f1f8-1f1ff':71812, '1f1f9-1f1e6':71813, '1f1f9-1f1e8':71814, '1f1f9-1f1e9':71815, '1f1f9-1f1eb':71816, '1f1f9-1f1ec':71817, '1f1f9-1f1ed':71818, '1f1f9-1f1ef':71819, '1f1f9-1f1f0':71820, '1f1f9-1f1f1':71821, '1f1f9-1f1f2':71822, '1f1f9-1f1f3':71823, '1f1f9-1f1f4':71824, '1f1f9-1f1f7':71825, '1f1f9-1f1f9':71826, '1f1f9-1f1fb':71827, '1f1f9-1f1fc':71828, '1f1f9-1f1ff':71829, '1f1fa-1f1e6':71830, '1f1fa-1f1ec':71831, '1f1fa-1f1f2':71832, '1f1fa-1f1f3':71833, '1f1fa-1f1f8':71834, '1f1fa-1f1fe':71835, '1f1fa-1f1ff':71836, '1f1fb-1f1e6':71837, '1f1fb-1f1e8':71838, '1f1fb-1f1ea':71839, '1f1fb-1f1ec':71840, '1f1fb-1f1ee':71841, '1f1fb-1f1f3':71842, '1f1fb-1f1fa':71843, '1f1fc-1f1eb':71844, '1f1fc-1f1f8':71845, '1f1fd-1f1f0':71846, '1f1fe-1f1ea':71847, '1f1fe-1f1f9':71848, '1f1ff-1f1e6':71849, '1f1ff-1f1f2':71850, '1f1ff-1f1fc':71851, '1f201':62899, '1f202':62900, '1f21a':62906, '1f22f':62903, '1f232':62907, '1f233':62911, '1f234':62910, '1f235':62915, '1f236':62902, '1f237':62901, '1f238':62909, '1f239':62905, '1f23a':62914, '1f250':62904, '1f251':62908, '1f300':41010, '1f301':4857, '1f302':41012, '1f303':4858, '1f304':4860, '1f305':4861, '1f306':4862, '1f307':4863, '1f308':41011, '1f309':4864, '1f30a':41023, '1f30b':4815, '1f30c':4997, '1f30d':4806, '1f30e':4807, '1f30f':4808, '1f310':4809, '1f311':4977, '1f312':4978, '1f313':4979, '1f314':4980, '1f315':4981, '1f316':4982, '1f317':4983, '1f318':4984, '1f319':4985, '1f31a':4986, '1f31b':4987, '1f31c':4988, '1f31d':4991, '1f31e':4992, '1f31f':4995, '1f320':4996, '1f321':4989, '1f324':41001, '1f325':41002, '1f326':41003, '1f327':41004, '1f328':41005, '1f329':41006, '1f32a':41007, '1f32b':41008, '1f32c':41009, '1f32d':3725, '1f32e':3727, '1f32f':3728, '1f330':3708, '1f331':2659, '1f332':2661, '1f333':2662, '1f334':2663, '1f335':2664, '1f336':3698, '1f337':2658, '1f338':2649, '1f339':2653, '1f33a':2655, '1f33b':2656, '1f33c':2657, '1f33d':3697, '1f33e':2665, '1f33f':2666, '1f340':2668, '1f341':2669, '1f342':2670, '1f343':2671, '1f344':3705, '1f345':3690, '1f346':3694, '1f347':3674, '1f348':3675, '1f349':3676, '1f34a':3677, '1f34b':3678, '1f34c':3679, '1f34d':3680, '1f34e':3682, '1f34f':3683, '1f350':3684, '1f351':3685, '1f352':3686, '1f353':3687, '1f354':3722, '1f355':3724, '1f356':3718, '1f357':3719, '1f358':3744, '1f359':3745, '1f35a':3746, '1f35b':3747, '1f35c':3748, '1f35d':3749, '1f35e':3709, '1f35f':3723, '1f360':3750, '1f361':3756, '1f362':3751, '1f363':3752, '1f364':3753, '1f365':3754, '1f366':3765, '1f367':3766, '1f368':3767, '1f369':3768, '1f36a':3769, '1f36b':3774, '1f36c':3775, '1f36d':3776, '1f36e':3777, '1f36f':3778, '1f370':3771, '1f371':3743, '1f372':3735, '1f373':3733, '1f374':3801, '1f375':3783, '1f376':3784, '1f377':3786, '1f378':3787, '1f379':3788, '1f37a':3789, '1f37b':3790, '1f37c':3779, '1f37d':3800, '1f37e':3785, '1f37f':3739, '1f380':51040, '1f381':51041, '1f382':3770, '1f383':51024, '1f384':51025, '1f385':1527, '1f386':51026, '1f387':51027, '1f388':51030, '1f389':51031, '1f38a':51032, '1f38b':51033, '1f38c':71588, '1f38d':51034, '1f38e':51035, '1f38f':51036, '1f390':51037, '1f391':51038, '1f392':61134, '1f393':61147, '1f396':51045, '1f397':51042, '1f399':61167, '1f39a':61168, '1f39b':61169, '1f39e':61203, '1f39f':51043, '1f3a0':4866, '1f3a1':4868, '1f3a2':4869, '1f3a3':51072, '1f3a4':61170, '1f3a5':61202, '1f3a6':62819, '1f3a7':61171, '1f3a8':51105, '1f3a9':61146, '1f3aa':4871, '1f3ab':51044, '1f3ac':61205, '1f3ad':51103, '1f3ae':51086, '1f3af':51078, '1f3b0':51088, '1f3b1':51081, '1f3b2':51089, '1f3b3':51060, '1f3b4':51102, '1f3b5':61165, '1f3b6':61166, '1f3b7':61173, '1f3b8':61175, '1f3b9':61176, '1f3ba':61177, '1f3bb':61178, '1f3bc':61164, '1f3bd':51074, '1f3be':51058, '1f3bf':51075, '1f3c0':51054, '1f3c1':71586, '1f3c2':1600, '1f3c3-200d-2640':1584, '1f3c3-200d-2642':1583, '1f3c3':1582, '1f3c4-200d-2640':1606, '1f3c4-200d-2642':1605, '1f3c4':1604, '1f3c5':51047, '1f3c6':51046, '1f3c7':1598, '1f3c8':51056, '1f3c9':51057, '1f3ca-200d-2640':1612, '1f3ca-200d-2642':1611, '1f3ca':1610, '1f3cb-200d-2640':1618, '1f3cb-200d-2642':1617, '1f3cb':1616, '1f3cc-200d-2640':1603, '1f3cc-200d-2642':1602, '1f3cc':1601, '1f3cd':4902, '1f3ce':4901, '1f3cf':51061, '1f3d0':51055, '1f3d1':51062, '1f3d2':51063, '1f3d3':51065, '1f3d4':4813, '1f3d5':4817, '1f3d6':4818, '1f3d7':4824, '1f3d8':4829, '1f3d9':4859, '1f3da':4830, '1f3db':4823, '1f3dc':4819, '1f3dd':4820, '1f3de':4821, '1f3df':4822, '1f3e0':4831, '1f3e1':4832, '1f3e2':4833, '1f3e3':4834, '1f3e4':4835, '1f3e5':4836, '1f3e6':4837, '1f3e7':62729, '1f3e8':4838, '1f3e9':4839, '1f3ea':4840, '1f3eb':4841, '1f3ec':4842, '1f3ed':4843, '1f3ee':61216, '1f3ef':4844, '1f3f0':4845, '1f3f3-200d-1f308':71591, '1f3f3-200d-26a7':71592, '1f3f3':71590, '1f3f4-200d-2620':71593, '1f3f4-e0067-e0062-e0065-e006e-e0067-e007f':71852, '1f3f4-e0067-e0062-e0073-e0063-e0074-e007f':71853, '1f3f4-e0067-e0062-e0077-e006c-e0073-e007f':71854, '1f3f4':71589, '1f3f5':2652, '1f3f7':61234, '1f3f8':51066, '1f3f9':61303, '1f3fa':3805, '1f3fb':9525, '1f3fc':9526, '1f3fd':9527, '1f3fe':9528, '1f3ff':9529, '1f400':2576, '1f401':2575, '1f402':2556, '1f403':2557, '1f404':2558, '1f405':2547, '1f406':2548, '1f407':2579, '1f408-200d-2b1b':2544, '1f408':2543, '1f409':2618, '1f40a':2613, '1f40b':2622, '1f40c':2632, '1f40d':2616, '1f40e':2550, '1f40f':2563, '1f410':2565, '1f411':2564, '1f412':2531, '1f413':2596, '1f414':2595, '1f415-200d-1f9ba':2537, '1f415':2535, '1f416':2560, '1f417':2561, '1f418':2570, '1f419':2629, '1f41a':2630, '1f41b':2634, '1f41c':2635, '1f41d':2636, '1f41e':2638, '1f41f':2625, '1f420':2626, '1f421':2627, '1f422':2614, '1f423':2597, '1f424':2598, '1f425':2599, '1f426':2600, '1f427':2601, '1f428':2586, '1f429':2538, '1f42a':2566, '1f42b':2567, '1f42c':2623, '1f42d':2574, '1f42e':2555, '1f42f':2546, '1f430':2578, '1f431':2542, '1f432':2617, '1f433':2621, '1f434':2549, '1f435':2530, '1f436':2534, '1f437':2559, '1f438':2612, '1f439':2577, '1f43a':2539, '1f43b-200d-2744':2585, '1f43b':2584, '1f43c':2587, '1f43d':2562, '1f43e':2593, '1f43f':2580, '1f440':1381, '1f441-200d-1f5e8':1159, '1f441':1382, '1f442':1373, '1f443':1375, '1f444':1384, '1f445':1383, '1f446':1347, '1f447':1349, '1f448':1345, '1f449':1346, '1f44a':1355, '1f44b':1327, '1f44c':1336, '1f44d':1352, '1f44e':1353, '1f44f':1358, '1f450':1361, '1f451':61144, '1f452':61145, '1f453':61110, '1f454':61115, '1f455':61116, '1f456':61117, '1f457':61122, '1f458':61123, '1f459':61128, '1f45a':61129, '1f45b':61130, '1f45c':61131, '1f45d':61132, '1f45e':61136, '1f45f':61137, '1f460':61140, '1f461':61141, '1f462':61143, '1f463':1687, '1f464':1684, '1f465':1685, '1f466':1388, '1f467':1389, '1f468-200d-1f33e':1457, '1f468-200d-1f373':1460, '1f468-200d-1f37c':1524, '1f468-200d-1f393':1448, '1f468-200d-1f3a4':1478, '1f468-200d-1f3a8':1481, '1f468-200d-1f3eb':1451, '1f468-200d-1f3ed':1466, '1f468-200d-1f466-200d-1f466':1674, '1f468-200d-1f466':1673, '1f468-200d-1f467-200d-1f466':1676, '1f468-200d-1f467-200d-1f467':1677, '1f468-200d-1f467':1675, '1f468-200d-1f468-200d-1f466':1663, '1f468-200d-1f468-200d-1f466-200d-1f466':1666, '1f468-200d-1f468-200d-1f467':1664, '1f468-200d-1f468-200d-1f467-200d-1f466':1665, '1f468-200d-1f468-200d-1f467-200d-1f467':1667, '1f468-200d-1f469-200d-1f466':1658, '1f468-200d-1f469-200d-1f466-200d-1f466':1661, '1f468-200d-1f469-200d-1f467':1659, '1f468-200d-1f469-200d-1f467-200d-1f466':1660, '1f468-200d-1f469-200d-1f467-200d-1f467':1662, '1f468-200d-1f4bb':1475, '1f468-200d-1f4bc':1469, '1f468-200d-1f527':1463, '1f468-200d-1f52c':1472, '1f468-200d-1f680':1487, '1f468-200d-1f692':1490, '1f468-200d-1f9af':1574, '1f468-200d-1f9b0':1396, '1f468-200d-1f9b1':1397, '1f468-200d-1f9b2':1399, '1f468-200d-1f9b3':1398, '1f468-200d-1f9bc':1577, '1f468-200d-1f9bd':1580, '1f468-200d-2695':1445, '1f468-200d-2696':1454, '1f468-200d-2708':1484, '1f468-200d-2764-200d-1f468':1655, '1f468-200d-2764-200d-1f48b-200d-1f468':1651, '1f468':1392, '1f469-200d-1f33e':1458, '1f469-200d-1f373':1461, '1f469-200d-1f37c':1523, '1f469-200d-1f393':1449, '1f469-200d-1f3a4':1479, '1f469-200d-1f3a8':1482, '1f469-200d-1f3eb':1452, '1f469-200d-1f3ed':1467, '1f469-200d-1f466-200d-1f466':1679, '1f469-200d-1f466':1678, '1f469-200d-1f467-200d-1f466':1681, '1f469-200d-1f467-200d-1f467':1682, '1f469-200d-1f467':1680, '1f469-200d-1f469-200d-1f466':1668, '1f469-200d-1f469-200d-1f466-200d-1f466':1671, '1f469-200d-1f469-200d-1f467':1669, '1f469-200d-1f469-200d-1f467-200d-1f466':1670, '1f469-200d-1f469-200d-1f467-200d-1f467':1672, '1f469-200d-1f4bb':1476, '1f469-200d-1f4bc':1470, '1f469-200d-1f527':1464, '1f469-200d-1f52c':1473, '1f469-200d-1f680':1488, '1f469-200d-1f692':1491, '1f469-200d-1f9af':1575, '1f469-200d-1f9b0':1401, '1f469-200d-1f9b1':1403, '1f469-200d-1f9b2':1407, '1f469-200d-1f9b3':1405, '1f469-200d-1f9bc':1578, '1f469-200d-1f9bd':1581, '1f469-200d-2695':1446, '1f469-200d-2696':1455, '1f469-200d-2708':1485, '1f469-200d-2764-200d-1f468':1654, '1f469-200d-2764-200d-1f469':1656, '1f469-200d-2764-200d-1f48b-200d-1f468':1650, '1f469-200d-2764-200d-1f48b-200d-1f469':1652, '1f469':1400, '1f46a':1657, '1f46b':1647, '1f46c':1648, '1f46d':1646, '1f46e-200d-2640':1494, '1f46e-200d-2642':1493, '1f46e':1492, '1f46f-200d-2640':1590, '1f46f-200d-2642':1589, '1f46f':1588, '1f470-200d-2640':1518, '1f470-200d-2642':1517, '1f470':1516, '1f471-200d-2640':1409, '1f471-200d-2642':1410, '1f471':1391, '1f472':1511, '1f473-200d-2640':1510, '1f473-200d-2642':1509, '1f473':1508, '1f474':1412, '1f475':1413, '1f476':1386, '1f477-200d-2640':1504, '1f477-200d-2642':1503, '1f477':1502, '1f478':1507, '1f479':1109, '1f47a':1110, '1f47b':1111, '1f47c':1526, '1f47d':1112, '1f47e':1113, '1f47f':1104, '1f480':1105, '1f481-200d-2640':1428, '1f481-200d-2642':1427, '1f481':1426, '1f482-200d-2640':1500, '1f482-200d-2642':1499, '1f482':1498, '1f483':1585, '1f484':61152, '1f485':1366, '1f486-200d-2640':1560, '1f486-200d-2642':1559, '1f486':1558, '1f487-200d-2640':1563, '1f487-200d-2642':1562, '1f487':1561, '1f488':4870, '1f489':61326, '1f48a':61328, '1f48b':1127, '1f48c':1128, '1f48d':61153, '1f48e':61154, '1f48f':1649, '1f490':2648, '1f491':1653, '1f492':4846, '1f493':1133, '1f494':1138, '1f495':1135, '1f496':1131, '1f497':1132, '1f498':1129, '1f499':1145, '1f49a':1144, '1f49b':1143, '1f49c':1146, '1f49d':1130, '1f49e':1134, '1f49f':1136, '1f4a0':62946, '1f4a1':61214, '1f4a2':1151, '1f4a3':1157, '1f4a4':1163, '1f4a5':1152, '1f4a6':1154, '1f4a7':41022, '1f4a8':1155, '1f4a9':1107, '1f4aa':1368, '1f4ab':1153, '1f4ac':1158, '1f4ad':1162, '1f4ae':2650, '1f4af':1150, '1f4b0':61235, '1f4b1':62841, '1f4b2':62842, '1f4b3':61242, '1f4b4':61237, '1f4b5':61238, '1f4b6':61239, '1f4b7':61240, '1f4b8':61241, '1f4b9':61244, '1f4ba':4936, '1f4bb':61191, '1f4bc':61265, '1f4bd':61197, '1f4be':61198, '1f4bf':61199, '1f4c0':61200, '1f4c1':61266, '1f4c2':61267, '1f4c3':61227, '1f4c4':61229, '1f4c5':61269, '1f4c6':61270, '1f4c7':61273, '1f4c8':61274, '1f4c9':61275, '1f4ca':61276, '1f4cb':61277, '1f4cc':61278, '1f4cd':61279, '1f4ce':61280, '1f4cf':61282, '1f4d0':61283, '1f4d1':61232, '1f4d2':61226, '1f4d3':61225, '1f4d4':61218, '1f4d5':61219, '1f4d6':61220, '1f4d7':61221, '1f4d8':61222, '1f4d9':61223, '1f4da':61224, '1f4db':62847, '1f4dc':61228, '1f4dd':61264, '1f4de':61185, '1f4df':61186, '1f4e0':61187, '1f4e1':61325, '1f4e2':61159, '1f4e3':61160, '1f4e4':61249, '1f4e5':61250, '1f4e6':61251, '1f4e7':61246, '1f4e8':61247, '1f4e9':61248, '1f4ea':61253, '1f4eb':61252, '1f4ec':61254, '1f4ed':61255, '1f4ee':61256, '1f4ef':61161, '1f4f0':61230, '1f4f1':61182, '1f4f2':61183, '1f4f3':62823, '1f4f4':62824, '1f4f5':62751, '1f4f6':62822, '1f4f7':61207, '1f4f8':61208, '1f4f9':61209, '1f4fa':61206, '1f4fb':61172, '1f4fc':61210, '1f4fd':61204, '1f4ff':61151, '1f500':62801, '1f501':62802, '1f502':62803, '1f503':62769, '1f504':62770, '1f505':62820, '1f506':62821, '1f507':61155, '1f508':61156, '1f509':61157, '1f50a':61158, '1f50b':61188, '1f50c':61190, '1f50d':61211, '1f50e':61212, '1f50f':61290, '1f510':61291, '1f511':61292, '1f512':61288, '1f513':61289, '1f514':61162, '1f515':61163, '1f516':61233, '1f517':61313, '1f518':62947, '1f519':62771, '1f51a':62772, '1f51b':62773, '1f51c':62774, '1f51d':62775, '1f51e':62752, '1f51f':62876, '1f520':62877, '1f521':62878, '1f522':62879, '1f523':62880, '1f524':62881, '1f525':41021, '1f526':61215, '1f527':61306, '1f528':61294, '1f529':61308, '1f52a':3803, '1f52b':61301, '1f52c':61323, '1f52d':61324, '1f52e':51082, '1f52f':62787, '1f530':62848, '1f531':62846, '1f532':62949, '1f533':62948, '1f534':62916, '1f535':62920, '1f536':62940, '1f537':62941, '1f538':62942, '1f539':62943, '1f53a':62944, '1f53b':62945, '1f53c':62811, '1f53d':62813, '1f549':62778, '1f54a':2602, '1f54b':4854, '1f54c':4850, '1f54d':4852, '1f54e':62786, '1f550':4955, '1f551':4957, '1f552':4959, '1f553':4961, '1f554':4963, '1f555':4965, '1f556':4967, '1f557':4969, '1f558':4971, '1f559':4973, '1f55a':4975, '1f55b':4953, '1f55c':4956, '1f55d':4958, '1f55e':4960, '1f55f':4962, '1f560':4964, '1f561':4966, '1f562':4968, '1f563':4970, '1f564':4972, '1f565':4974, '1f566':4976, '1f567':4954, '1f56f':61213, '1f570':4952, '1f573':1156, '1f574':1587, '1f575-200d-2640':1497, '1f575-200d-2642':1496, '1f575':1495, '1f576':61111, '1f577':2641, '1f578':2642, '1f579':51087, '1f57a':1586, '1f587':61281, '1f58a':61261, '1f58b':61260, '1f58c':61262, '1f58d':61263, '1f590':1329, '1f595':1348, '1f596':1331, '1f5a4':1148, '1f5a5':61192, '1f5a8':61193, '1f5b1':61195, '1f5b2':61196, '1f5bc':51104, '1f5c2':61268, '1f5c3':61285, '1f5c4':61286, '1f5d1':61287, '1f5d2':61271, '1f5d3':61272, '1f5dc':61310, '1f5dd':61293, '1f5de':61231, '1f5e1':61299, '1f5e3':1683, '1f5e8':1160, '1f5ef':1161, '1f5f3':61257, '1f5fa':4810, '1f5fb':4816, '1f5fc':4847, '1f5fd':4848, '1f5fe':4811, '1f5ff':61362, '1f600':11, '1f601':14, '1f602':18, '1f603':12, '1f604':13, '1f605':16, '1f606':15, '1f607':114, '1f608':1103, '1f609':112, '1f60a':113, '1f60b':124, '1f60c':150, '1f60d':116, '1f60e':170, '1f60f':144, '1f610':139, '1f611':140, '1f612':145, '1f613':195, '1f614':151, '1f615':173, '1f616':192, '1f617':119, '1f618':118, '1f619':122, '1f61a':121, '1f61b':125, '1f61c':126, '1f61d':128, '1f61e':194, '1f61f':175, '1f620':1101, '1f621':1100, '1f622':189, '1f623':193, '1f624':199, '1f625':188, '1f626':184, '1f627':185, '1f628':186, '1f629':196, '1f62a':152, '1f62b':197, '1f62c':147, '1f62d':190, '1f62e-200d-1f4a8':148, '1f62e':178, '1f62f':179, '1f630':187, '1f631':191, '1f632':180, '1f633':181, '1f634':154, '1f635-200d-1f4ab':165, '1f635':164, '1f636-200d-1f32b':143, '1f636':141, '1f637':155, '1f638':1116, '1f639':1117, '1f63a':1115, '1f63b':1118, '1f63c':1119, '1f63d':1120, '1f63e':1123, '1f63f':1122, '1f640':1121, '1f641':176, '1f642':19, '1f643':110, '1f644':146, '1f645-200d-2640':1422, '1f645-200d-2642':1421, '1f645':1420, '1f646-200d-2640':1425, '1f646-200d-2642':1424, '1f646':1423, '1f647-200d-2640':1437, '1f647-200d-2642':1436, '1f647':1435, '1f648':1124, '1f649':1125, '1f64a':1126, '1f64b-200d-2640':1431, '1f64b-200d-2642':1430, '1f64b':1429, '1f64c':1359, '1f64d-200d-2640':1416, '1f64d-200d-2642':1415, '1f64d':1414, '1f64e-200d-2640':1419, '1f64e-200d-2642':1418, '1f64e':1417, '1f64f':1364, '1f680':4942, '1f681':4937, '1f682':4872, '1f683':4873, '1f684':4874, '1f685':4875, '1f686':4876, '1f687':4877, '1f688':4878, '1f689':4879, '1f68a':4880, '1f68b':4883, '1f68c':4884, '1f68d':4885, '1f68e':4886, '1f68f':4911, '1f690':4887, '1f691':4888, '1f692':4889, '1f693':4890, '1f694':4891, '1f695':4892, '1f696':4893, '1f697':4894, '1f698':4895, '1f699':4896, '1f69a':4898, '1f69b':4899, '1f69c':4900, '1f69d':4881, '1f69e':4882, '1f69f':4938, '1f6a0':4939, '1f6a1':4940, '1f6a2':4930, '1f6a3-200d-2640':1609, '1f6a3-200d-2642':1608, '1f6a3':1607, '1f6a4':4926, '1f6a5':4918, '1f6a6':4919, '1f6a7':4921, '1f6a8':4917, '1f6a9':71587, '1f6aa':61333, '1f6ab':62745, '1f6ac':61358, '1f6ad':62747, '1f6ae':62730, '1f6af':62748, '1f6b0':62731, '1f6b1':62749, '1f6b2':4907, '1f6b3':62746, '1f6b4-200d-2640':1621, '1f6b4-200d-2642':1620, '1f6b4':1619, '1f6b5-200d-2640':1624, '1f6b5-200d-2642':1623, '1f6b5':1622, '1f6b6-200d-2640':1566, '1f6b6-200d-2642':1565, '1f6b6':1564, '1f6b7':62750, '1f6b8':62743, '1f6b9':62733, '1f6ba':62734, '1f6bb':62735, '1f6bc':62736, '1f6bd':61340, '1f6be':62737, '1f6bf':61342, '1f6c0':1643, '1f6c1':61343, '1f6c2':62738, '1f6c3':62739, '1f6c4':62740, '1f6c5':62741, '1f6cb':61338, '1f6cc':1644, '1f6cd':61133, '1f6ce':4944, '1f6cf':61337, '1f6d0':62776, '1f6d1':4920, '1f6d2':61357, '1f6d5':4851, '1f6d6':4828, '1f6d7':61334, '1f6e0':61298, '1f6e1':61304, '1f6e2':4914, '1f6e3':4912, '1f6e4':4913, '1f6e5':4929, '1f6e9':4932, '1f6eb':4933, '1f6ec':4934, '1f6f0':4941, '1f6f3':4927, '1f6f4':4908, '1f6f5':4903, '1f6f6':4925, '1f6f7':51076, '1f6f8':4943, '1f6f9':4909, '1f6fa':4906, '1f6fb':4897, '1f6fc':4910, '1f7e0':62917, '1f7e1':62918, '1f7e2':62919, '1f7e3':62921, '1f7e4':62922, '1f7e5':62925, '1f7e6':62929, '1f7e7':62926, '1f7e8':62927, '1f7e9':62928, '1f7ea':62930, '1f7eb':62931, '1f90c':1337, '1f90d':1149, '1f90e':1147, '1f90f':1338, '1f910':137, '1f911':129, '1f912':156, '1f913':171, '1f914':135, '1f915':157, '1f916':1114, '1f917':130, '1f918':1343, '1f919':1344, '1f91a':1328, '1f91b':1356, '1f91c':1357, '1f91d':1363, '1f91e':1340, '1f91f':1342, '1f920':167, '1f921':1108, '1f922':158, '1f923':17, '1f924':153, '1f925':149, '1f926-200d-2640':1440, '1f926-200d-2642':1439, '1f926':1438, '1f927':160, '1f928':138, '1f929':117, '1f92a':127, '1f92b':134, '1f92c':1102, '1f92d':131, '1f92e':159, '1f92f':166, '1f930':1519, '1f931':1522, '1f932':1362, '1f933':1367, '1f934':1506, '1f935-200d-2640':1515, '1f935-200d-2642':1514, '1f935':1513, '1f936':1528, '1f937-200d-2640':1443, '1f937-200d-2642':1442, '1f937':1441, '1f938-200d-2640':1627, '1f938-200d-2642':1626, '1f938':1625, '1f939-200d-2640':1639, '1f939-200d-2642':1638, '1f939':1637, '1f93a':1597, '1f93c-200d-2640':1630, '1f93c-200d-2642':1629, '1f93c':1628, '1f93d-200d-2640':1633, '1f93d-200d-2642':1632, '1f93d':1631, '1f93e-200d-2640':1636, '1f93e-200d-2642':1635, '1f93e':1634, '1f93f':51073, '1f940':2654, '1f941':61180, '1f942':3791, '1f943':3792, '1f944':3802, '1f945':51069, '1f947':51048, '1f948':51049, '1f949':51050, '1f94a':51067, '1f94b':51068, '1f94c':51077, '1f94d':51064, '1f94e':51053, '1f94f':51059, '1f950':3710, '1f951':3693, '1f952':3700, '1f953':3721, '1f954':3695, '1f955':3696, '1f956':3711, '1f957':3738, '1f958':3734, '1f959':3730, '1f95a':3732, '1f95b':3780, '1f95c':3706, '1f95d':3689, '1f95e':3715, '1f95f':3757, '1f960':3758, '1f961':3759, '1f962':3799, '1f963':3737, '1f964':3794, '1f965':3692, '1f966':3702, '1f967':3773, '1f968':3713, '1f969':3720, '1f96a':3726, '1f96b':3742, '1f96c':3701, '1f96d':3681, '1f96e':3755, '1f96f':3714, '1f970':115, '1f971':198, '1f972':123, '1f973':168, '1f974':163, '1f975':161, '1f976':162, '1f977':1501, '1f978':169, '1f97a':182, '1f97b':61124, '1f97c':61113, '1f97d':61112, '1f97e':61138, '1f97f':61139, '1f980':3760, '1f981':2545, '1f982':2643, '1f983':2594, '1f984':2551, '1f985':2603, '1f986':2604, '1f987':2583, '1f988':2628, '1f989':2606, '1f98a':2540, '1f98b':2633, '1f98c':2553, '1f98d':2532, '1f98e':2615, '1f98f':2572, '1f990':3762, '1f991':3763, '1f992':2569, '1f993':2552, '1f994':2582, '1f995':2619, '1f996':2620, '1f997':2639, '1f998':2591, '1f999':2568, '1f99a':2610, '1f99b':2573, '1f99c':2611, '1f99d':2541, '1f99e':3761, '1f99f':2644, '1f9a0':2647, '1f9a1':2592, '1f9a2':2605, '1f9a3':2571, '1f9a4':2607, '1f9a5':2588, '1f9a6':2589, '1f9a7':2533, '1f9a8':2590, '1f9a9':2609, '1f9aa':3764, '1f9ab':2581, '1f9ac':2554, '1f9ad':2624, '1f9ae':2536, '1f9af':61312, '1f9b4':1380, '1f9b5':1371, '1f9b6':1372, '1f9b7':1379, '1f9b8-200d-2640':1532, '1f9b8-200d-2642':1531, '1f9b8':1530, '1f9b9-200d-2640':1535, '1f9b9-200d-2642':1534, '1f9b9':1533, '1f9ba':61114, '1f9bb':1374, '1f9bc':4905, '1f9bd':4904, '1f9be':1369, '1f9bf':1370, '1f9c0':3717, '1f9c1':3772, '1f9c2':3741, '1f9c3':3796, '1f9c4':3703, '1f9c5':3704, '1f9c6':3731, '1f9c7':3716, '1f9c8':3740, '1f9c9':3797, '1f9ca':3798, '1f9cb':3795, '1f9cd-200d-2640':1569, '1f9cd-200d-2642':1568, '1f9cd':1567, '1f9ce-200d-2640':1572, '1f9ce-200d-2642':1571, '1f9ce':1570, '1f9cf-200d-2640':1434, '1f9cf-200d-2642':1433, '1f9cf':1432, '1f9d0':172, '1f9d1-200d-1f33e':1456, '1f9d1-200d-1f373':1459, '1f9d1-200d-1f37c':1525, '1f9d1-200d-1f384':1529, '1f9d1-200d-1f393':1447, '1f9d1-200d-1f3a4':1477, '1f9d1-200d-1f3a8':1480, '1f9d1-200d-1f3eb':1450, '1f9d1-200d-1f3ed':1465, '1f9d1-200d-1f4bb':1474, '1f9d1-200d-1f4bc':1468, '1f9d1-200d-1f527':1462, '1f9d1-200d-1f52c':1471, '1f9d1-200d-1f680':1486, '1f9d1-200d-1f692':1489, '1f9d1-200d-1f91d-200d-1f9d1':1645, '1f9d1-200d-1f9af':1573, '1f9d1-200d-1f9b0':1402, '1f9d1-200d-1f9b1':1404, '1f9d1-200d-1f9b2':1408, '1f9d1-200d-1f9b3':1406, '1f9d1-200d-1f9bc':1576, '1f9d1-200d-1f9bd':1579, '1f9d1-200d-2695':1444, '1f9d1-200d-2696':1453, '1f9d1-200d-2708':1483, '1f9d1':1390, '1f9d2':1387, '1f9d3':1411, '1f9d4-200d-2640':1395, '1f9d4-200d-2642':1394, '1f9d4':1393, '1f9d5':1512, '1f9d6-200d-2640':1593, '1f9d6-200d-2642':1592, '1f9d6':1591, '1f9d7-200d-2640':1596, '1f9d7-200d-2642':1595, '1f9d7':1594, '1f9d8-200d-2640':1642, '1f9d8-200d-2642':1641, '1f9d8':1640, '1f9d9-200d-2640':1538, '1f9d9-200d-2642':1537, '1f9d9':1536, '1f9da-200d-2640':1541, '1f9da-200d-2642':1540, '1f9da':1539, '1f9db-200d-2640':1544, '1f9db-200d-2642':1543, '1f9db':1542, '1f9dc-200d-2640':1547, '1f9dc-200d-2642':1546, '1f9dc':1545, '1f9dd-200d-2640':1550, '1f9dd-200d-2642':1549, '1f9dd':1548, '1f9de-200d-2640':1553, '1f9de-200d-2642':1552, '1f9de':1551, '1f9df-200d-2640':1556, '1f9df-200d-2642':1555, '1f9df':1554, '1f9e0':1376, '1f9e1':1142, '1f9e2':61148, '1f9e3':61118, '1f9e4':61119, '1f9e5':61120, '1f9e6':61121, '1f9e7':51039, '1f9e8':51028, '1f9e9':51090, '1f9ea':61320, '1f9eb':61321, '1f9ec':61322, '1f9ed':4812, '1f9ee':61201, '1f9ef':61356, '1f9f0':61316, '1f9f1':4825, '1f9f2':61317, '1f9f3':4945, '1f9f4':61346, '1f9f5':51106, '1f9f6':51108, '1f9f7':61347, '1f9f8':51091, '1f9f9':61348, '1f9fa':61349, '1f9fb':61350, '1f9fc':61352, '1f9fd':61355, '1f9fe':61243, '1f9ff':51084, '1fa70':61142, '1fa71':61125, '1fa72':61126, '1fa73':61127, '1fa74':61135, '1fa78':61327, '1fa79':61329, '1fa7a':61331, '1fa80':51079, '1fa81':51080, '1fa82':4935, '1fa83':61302, '1fa84':51083, '1fa85':51092, '1fa86':51094, '1fa90':4993, '1fa91':61339, '1fa92':61345, '1fa93':61295, '1fa94':61217, '1fa95':61179, '1fa96':61149, '1fa97':61174, '1fa98':61181, '1fa99':61236, '1fa9a':61305, '1fa9b':61307, '1fa9c':61318, '1fa9d':61315, '1fa9e':61335, '1fa9f':61336, '1faa0':61341, '1faa1':51107, '1faa2':51109, '1faa3':61351, '1faa4':61344, '1faa5':61354, '1faa6':61360, '1faa7':61363, '1faa8':4826, '1fab0':2645, '1fab1':2646, '1fab2':2637, '1fab3':2640, '1fab4':2660, '1fab5':4827, '1fab6':2608, '1fac0':1377, '1fac1':1378, '1fac2':1686, '1fad0':3688, '1fad1':3699, '1fad2':3691, '1fad3':3712, '1fad4':3729, '1fad5':3736, '1fad6':3782, '203c':62834, '21a9':62765, '21aa':62766, '231a':4948, '231b':4946, '23cf':62818, '23e9':62805, '23ea':62809, '23eb':62812, '23ec':62814, '23ed':62806, '23ee':62810, '23ef':62807, '23f0':4949, '23f1':4950, '23f2':4951, '23f3':4947, '23f8':62815, '23f9':62816, '23fa':62817, '24c2':62890, '25aa':62938, '25ab':62939, '25b6':62804, '25c0':62808, '25fb':62935, '25fc':62934, '25fd':62937, '25fe':62936, '260e':61184, '261d':1350, '262a':62784, '262e':62785, '262f':62781, '263a':120, '264a':62790, '264b':62791, '264c':62792, '264d':62793, '264e':62794, '264f':62795, '265f':51099, '267b':62844, '267e':62833, '267f':62732, '269b':62777, '269c':62845, '26a0':62742, '26a1':41016, '26a7':62827, '26aa':62924, '26ab':62923, '26b0':61359, '26b1':61361, '26bd':51051, '26be':51052, '26c4':41019, '26c5':4999, '26c8':41000, '26ce':62800, '26cf':61296, '26d1':61150, '26d3':61314, '26d4':62744, '26e9':4853, '26ea':4849, '26f0':4814, '26f1':41015, '26f2':4855, '26f3':51070, '26f4':4928, '26f5':4924, '26f7':1599, '26f8':51071, '26f9-200d-2640':1615, '26f9-200d-2642':1614, '26f9':1613, '26fa':4856, '26fd':4915, '270a':1354, '270b':1330, '270c':1339, '270d':1365, '270f':61258, '271d':62782, '274c':62853, '274e':62854, '2764-200d-1f525':1139, '2764-200d-1fa79':1140, '27a1':62757, '27b0':62855, '27bf':62856, '2b05':62761, '2b06':62755, '2b07':62759, '2b1b':62932, '2b1c':62933, '2b50':4994, '2b55':62849, '303d':62857, '1f385-1f3fb':0, '1f385-1f3fc':0, '1f385-1f3fd':0, '1f385-1f3fe':0, '1f385-1f3ff':0, '1f3c2-1f3fb':0, '1f3c2-1f3fc':0, '1f3c2-1f3fd':0, '1f3c2-1f3fe':0, '1f3c2-1f3ff':0, '1f3c3-1f3fb-200d-2640':0, '1f3c3-1f3fc-200d-2640':0, '1f3c3-1f3fd-200d-2640':0, '1f3c3-1f3fe-200d-2640':0, '1f3c3-1f3ff-200d-2640':0, '1f3c3-1f3fb-200d-2642':0, '1f3c3-1f3fc-200d-2642':0, '1f3c3-1f3fd-200d-2642':0, '1f3c3-1f3fe-200d-2642':0, '1f3c3-1f3ff-200d-2642':0, '1f3c3-1f3fb':0, '1f3c3-1f3fc':0, '1f3c3-1f3fd':0, '1f3c3-1f3fe':0, '1f3c3-1f3ff':0, '1f3c4-1f3fb-200d-2640':0, '1f3c4-1f3fc-200d-2640':0, '1f3c4-1f3fd-200d-2640':0, '1f3c4-1f3fe-200d-2640':0, '1f3c4-1f3ff-200d-2640':0, '1f3c4-1f3fb-200d-2642':0, '1f3c4-1f3fc-200d-2642':0, '1f3c4-1f3fd-200d-2642':0, '1f3c4-1f3fe-200d-2642':0, '1f3c4-1f3ff-200d-2642':0, '1f3c4-1f3fb':0, '1f3c4-1f3fc':0, '1f3c4-1f3fd':0, '1f3c4-1f3fe':0, '1f3c4-1f3ff':0, '1f3c7-1f3fb':0, '1f3c7-1f3fc':0, '1f3c7-1f3fd':0, '1f3c7-1f3fe':0, '1f3c7-1f3ff':0, '1f3ca-1f3fb-200d-2640':0, '1f3ca-1f3fc-200d-2640':0, '1f3ca-1f3fd-200d-2640':0, '1f3ca-1f3fe-200d-2640':0, '1f3ca-1f3ff-200d-2640':0, '1f3ca-1f3fb-200d-2642':0, '1f3ca-1f3fc-200d-2642':0, '1f3ca-1f3fd-200d-2642':0, '1f3ca-1f3fe-200d-2642':0, '1f3ca-1f3ff-200d-2642':0, '1f3ca-1f3fb':0, '1f3ca-1f3fc':0, '1f3ca-1f3fd':0, '1f3ca-1f3fe':0, '1f3ca-1f3ff':0, '1f3cb-1f3fb-200d-2640':0, '1f3cb-1f3fc-200d-2640':0, '1f3cb-1f3fd-200d-2640':0, '1f3cb-1f3fe-200d-2640':0, '1f3cb-1f3ff-200d-2640':0, '1f3cb-1f3fb-200d-2642':0, '1f3cb-1f3fc-200d-2642':0, '1f3cb-1f3fd-200d-2642':0, '1f3cb-1f3fe-200d-2642':0, '1f3cb-1f3ff-200d-2642':0, '1f3cb-1f3fb':0, '1f3cb-1f3fc':0, '1f3cb-1f3fd':0, '1f3cb-1f3fe':0, '1f3cb-1f3ff':0, '1f3cc-1f3fb-200d-2640':0, '1f3cc-1f3fc-200d-2640':0, '1f3cc-1f3fd-200d-2640':0, '1f3cc-1f3fe-200d-2640':0, '1f3cc-1f3ff-200d-2640':0, '1f3cc-1f3fb-200d-2642':0, '1f3cc-1f3fc-200d-2642':0, '1f3cc-1f3fd-200d-2642':0, '1f3cc-1f3fe-200d-2642':0, '1f3cc-1f3ff-200d-2642':0, '1f3cc-1f3fb':0, '1f3cc-1f3fc':0, '1f3cc-1f3fd':0, '1f3cc-1f3fe':0, '1f3cc-1f3ff':0, '1f442-1f3fb':0, '1f442-1f3fc':0, '1f442-1f3fd':0, '1f442-1f3fe':0, '1f442-1f3ff':0, '1f443-1f3fb':0, '1f443-1f3fc':0, '1f443-1f3fd':0, '1f443-1f3fe':0, '1f443-1f3ff':0, '1f446-1f3fb':0, '1f446-1f3fc':0, '1f446-1f3fd':0, '1f446-1f3fe':0, '1f446-1f3ff':0, '1f447-1f3fb':0, '1f447-1f3fc':0, '1f447-1f3fd':0, '1f447-1f3fe':0, '1f447-1f3ff':0, '1f448-1f3fb':0, '1f448-1f3fc':0, '1f448-1f3fd':0, '1f448-1f3fe':0, '1f448-1f3ff':0, '1f449-1f3fb':0, '1f449-1f3fc':0, '1f449-1f3fd':0, '1f449-1f3fe':0, '1f449-1f3ff':0, '1f44a-1f3fb':0, '1f44a-1f3fc':0, '1f44a-1f3fd':0, '1f44a-1f3fe':0, '1f44a-1f3ff':0, '1f44b-1f3fb':0, '1f44b-1f3fc':0, '1f44b-1f3fd':0, '1f44b-1f3fe':0, '1f44b-1f3ff':0, '1f44c-1f3fb':0, '1f44c-1f3fc':0, '1f44c-1f3fd':0, '1f44c-1f3fe':0, '1f44c-1f3ff':0, '1f44d-1f3fb':0, '1f44d-1f3fc':0, '1f44d-1f3fd':0, '1f44d-1f3fe':0, '1f44d-1f3ff':0, '1f44e-1f3fb':0, '1f44e-1f3fc':0, '1f44e-1f3fd':0, '1f44e-1f3fe':0, '1f44e-1f3ff':0, '1f44f-1f3fb':0, '1f44f-1f3fc':0, '1f44f-1f3fd':0, '1f44f-1f3fe':0, '1f44f-1f3ff':0, '1f450-1f3fb':0, '1f450-1f3fc':0, '1f450-1f3fd':0, '1f450-1f3fe':0, '1f450-1f3ff':0, '1f466-1f3fb':0, '1f466-1f3fc':0, '1f466-1f3fd':0, '1f466-1f3fe':0, '1f466-1f3ff':0, '1f467-1f3fb':0, '1f467-1f3fc':0, '1f467-1f3fd':0, '1f467-1f3fe':0, '1f467-1f3ff':0, '1f468-1f3fb-200d-1f33e':0, '1f468-1f3fc-200d-1f33e':0, '1f468-1f3fd-200d-1f33e':0, '1f468-1f3fe-200d-1f33e':0, '1f468-1f3ff-200d-1f33e':0, '1f468-1f3fb-200d-1f373':0, '1f468-1f3fc-200d-1f373':0, '1f468-1f3fd-200d-1f373':0, '1f468-1f3fe-200d-1f373':0, '1f468-1f3ff-200d-1f373':0, '1f468-1f3fb-200d-1f37c':0, '1f468-1f3fc-200d-1f37c':0, '1f468-1f3fd-200d-1f37c':0, '1f468-1f3fe-200d-1f37c':0, '1f468-1f3ff-200d-1f37c':0, '1f468-1f3fb-200d-1f393':0, '1f468-1f3fc-200d-1f393':0, '1f468-1f3fd-200d-1f393':0, '1f468-1f3fe-200d-1f393':0, '1f468-1f3ff-200d-1f393':0, '1f468-1f3fb-200d-1f3a4':0, '1f468-1f3fc-200d-1f3a4':0, '1f468-1f3fd-200d-1f3a4':0, '1f468-1f3fe-200d-1f3a4':0, '1f468-1f3ff-200d-1f3a4':0, '1f468-1f3fb-200d-1f3a8':0, '1f468-1f3fc-200d-1f3a8':0, '1f468-1f3fd-200d-1f3a8':0, '1f468-1f3fe-200d-1f3a8':0, '1f468-1f3ff-200d-1f3a8':0, '1f468-1f3fb-200d-1f3eb':0, '1f468-1f3fc-200d-1f3eb':0, '1f468-1f3fd-200d-1f3eb':0, '1f468-1f3fe-200d-1f3eb':0, '1f468-1f3ff-200d-1f3eb':0, '1f468-1f3fb-200d-1f3ed':0, '1f468-1f3fc-200d-1f3ed':0, '1f468-1f3fd-200d-1f3ed':0, '1f468-1f3fe-200d-1f3ed':0, '1f468-1f3ff-200d-1f3ed':0, '1f468-1f3fb-200d-1f4bb':0, '1f468-1f3fc-200d-1f4bb':0, '1f468-1f3fd-200d-1f4bb':0, '1f468-1f3fe-200d-1f4bb':0, '1f468-1f3ff-200d-1f4bb':0, '1f468-1f3fb-200d-1f4bc':0, '1f468-1f3fc-200d-1f4bc':0, '1f468-1f3fd-200d-1f4bc':0, '1f468-1f3fe-200d-1f4bc':0, '1f468-1f3ff-200d-1f4bc':0, '1f468-1f3fb-200d-1f527':0, '1f468-1f3fc-200d-1f527':0, '1f468-1f3fd-200d-1f527':0, '1f468-1f3fe-200d-1f527':0, '1f468-1f3ff-200d-1f527':0, '1f468-1f3fb-200d-1f52c':0, '1f468-1f3fc-200d-1f52c':0, '1f468-1f3fd-200d-1f52c':0, '1f468-1f3fe-200d-1f52c':0, '1f468-1f3ff-200d-1f52c':0, '1f468-1f3fb-200d-1f680':0, '1f468-1f3fc-200d-1f680':0, '1f468-1f3fd-200d-1f680':0, '1f468-1f3fe-200d-1f680':0, '1f468-1f3ff-200d-1f680':0, '1f468-1f3fb-200d-1f692':0, '1f468-1f3fc-200d-1f692':0, '1f468-1f3fd-200d-1f692':0, '1f468-1f3fe-200d-1f692':0, '1f468-1f3ff-200d-1f692':0, '1f468-1f3fb-200d-1f9af':0, '1f468-1f3fc-200d-1f9af':0, '1f468-1f3fd-200d-1f9af':0, '1f468-1f3fe-200d-1f9af':0, '1f468-1f3ff-200d-1f9af':0, '1f468-1f3fb-200d-1f9b0':0, '1f468-1f3fc-200d-1f9b0':0, '1f468-1f3fd-200d-1f9b0':0, '1f468-1f3fe-200d-1f9b0':0, '1f468-1f3ff-200d-1f9b0':0, '1f468-1f3fb-200d-1f9b1':0, '1f468-1f3fc-200d-1f9b1':0, '1f468-1f3fd-200d-1f9b1':0, '1f468-1f3fe-200d-1f9b1':0, '1f468-1f3ff-200d-1f9b1':0, '1f468-1f3fb-200d-1f9b2':0, '1f468-1f3fc-200d-1f9b2':0, '1f468-1f3fd-200d-1f9b2':0, '1f468-1f3fe-200d-1f9b2':0, '1f468-1f3ff-200d-1f9b2':0, '1f468-1f3fb-200d-1f9b3':0, '1f468-1f3fc-200d-1f9b3':0, '1f468-1f3fd-200d-1f9b3':0, '1f468-1f3fe-200d-1f9b3':0, '1f468-1f3ff-200d-1f9b3':0, '1f468-1f3fb-200d-1f9bc':0, '1f468-1f3fc-200d-1f9bc':0, '1f468-1f3fd-200d-1f9bc':0, '1f468-1f3fe-200d-1f9bc':0, '1f468-1f3ff-200d-1f9bc':0, '1f468-1f3fb-200d-1f9bd':0, '1f468-1f3fc-200d-1f9bd':0, '1f468-1f3fd-200d-1f9bd':0, '1f468-1f3fe-200d-1f9bd':0, '1f468-1f3ff-200d-1f9bd':0, '1f468-1f3fb-200d-2695':0, '1f468-1f3fc-200d-2695':0, '1f468-1f3fd-200d-2695':0, '1f468-1f3fe-200d-2695':0, '1f468-1f3ff-200d-2695':0, '1f468-1f3fb-200d-2696':0, '1f468-1f3fc-200d-2696':0, '1f468-1f3fd-200d-2696':0, '1f468-1f3fe-200d-2696':0, '1f468-1f3ff-200d-2696':0, '1f468-1f3fb-200d-2708':0, '1f468-1f3fc-200d-2708':0, '1f468-1f3fd-200d-2708':0, '1f468-1f3fe-200d-2708':0, '1f468-1f3ff-200d-2708':0, '1f468-1f3fb-200d-2764-200d-1f468-1f3fb':0, '1f468-1f3fb-200d-2764-200d-1f468-1f3fc':0, '1f468-1f3fb-200d-2764-200d-1f468-1f3fd':0, '1f468-1f3fb-200d-2764-200d-1f468-1f3fe':0, '1f468-1f3fb-200d-2764-200d-1f468-1f3ff':0, '1f468-1f3fc-200d-2764-200d-1f468-1f3fb':0, '1f468-1f3fc-200d-2764-200d-1f468-1f3fc':0, '1f468-1f3fc-200d-2764-200d-1f468-1f3fd':0, '1f468-1f3fc-200d-2764-200d-1f468-1f3fe':0, '1f468-1f3fc-200d-2764-200d-1f468-1f3ff':0, '1f468-1f3fd-200d-2764-200d-1f468-1f3fb':0, '1f468-1f3fd-200d-2764-200d-1f468-1f3fc':0, '1f468-1f3fd-200d-2764-200d-1f468-1f3fd':0, '1f468-1f3fd-200d-2764-200d-1f468-1f3fe':0, '1f468-1f3fd-200d-2764-200d-1f468-1f3ff':0, '1f468-1f3fe-200d-2764-200d-1f468-1f3fb':0, '1f468-1f3fe-200d-2764-200d-1f468-1f3fc':0, '1f468-1f3fe-200d-2764-200d-1f468-1f3fd':0, '1f468-1f3fe-200d-2764-200d-1f468-1f3fe':0, '1f468-1f3fe-200d-2764-200d-1f468-1f3ff':0, '1f468-1f3ff-200d-2764-200d-1f468-1f3fb':0, '1f468-1f3ff-200d-2764-200d-1f468-1f3fc':0, '1f468-1f3ff-200d-2764-200d-1f468-1f3fd':0, '1f468-1f3ff-200d-2764-200d-1f468-1f3fe':0, '1f468-1f3ff-200d-2764-200d-1f468-1f3ff':0, '1f468-1f3fb-200d-2764-200d-1f48b-200d-1f468-1f3fb':0, '1f468-1f3fb-200d-2764-200d-1f48b-200d-1f468-1f3fc':0, '1f468-1f3fb-200d-2764-200d-1f48b-200d-1f468-1f3fd':0, '1f468-1f3fb-200d-2764-200d-1f48b-200d-1f468-1f3fe':0, '1f468-1f3fb-200d-2764-200d-1f48b-200d-1f468-1f3ff':0, '1f468-1f3fc-200d-2764-200d-1f48b-200d-1f468-1f3fb':0, '1f468-1f3fc-200d-2764-200d-1f48b-200d-1f468-1f3fc':0, '1f468-1f3fc-200d-2764-200d-1f48b-200d-1f468-1f3fd':0, '1f468-1f3fc-200d-2764-200d-1f48b-200d-1f468-1f3fe':0, '1f468-1f3fc-200d-2764-200d-1f48b-200d-1f468-1f3ff':0, '1f468-1f3fd-200d-2764-200d-1f48b-200d-1f468-1f3fb':0, '1f468-1f3fd-200d-2764-200d-1f48b-200d-1f468-1f3fc':0, '1f468-1f3fd-200d-2764-200d-1f48b-200d-1f468-1f3fd':0, '1f468-1f3fd-200d-2764-200d-1f48b-200d-1f468-1f3fe':0, '1f468-1f3fd-200d-2764-200d-1f48b-200d-1f468-1f3ff':0, '1f468-1f3fe-200d-2764-200d-1f48b-200d-1f468-1f3fb':0, '1f468-1f3fe-200d-2764-200d-1f48b-200d-1f468-1f3fc':0, '1f468-1f3fe-200d-2764-200d-1f48b-200d-1f468-1f3fd':0, '1f468-1f3fe-200d-2764-200d-1f48b-200d-1f468-1f3fe':0, '1f468-1f3fe-200d-2764-200d-1f48b-200d-1f468-1f3ff':0, '1f468-1f3ff-200d-2764-200d-1f48b-200d-1f468-1f3fb':0, '1f468-1f3ff-200d-2764-200d-1f48b-200d-1f468-1f3fc':0, '1f468-1f3ff-200d-2764-200d-1f48b-200d-1f468-1f3fd':0, '1f468-1f3ff-200d-2764-200d-1f48b-200d-1f468-1f3fe':0, '1f468-1f3ff-200d-2764-200d-1f48b-200d-1f468-1f3ff':0, '1f468-1f3fb':0, '1f468-1f3fc':0, '1f468-1f3fd':0, '1f468-1f3fe':0, '1f468-1f3ff':0, '1f469-1f3fb-200d-1f33e':0, '1f469-1f3fc-200d-1f33e':0, '1f469-1f3fd-200d-1f33e':0, '1f469-1f3fe-200d-1f33e':0, '1f469-1f3ff-200d-1f33e':0, '1f469-1f3fb-200d-1f373':0, '1f469-1f3fc-200d-1f373':0, '1f469-1f3fd-200d-1f373':0, '1f469-1f3fe-200d-1f373':0, '1f469-1f3ff-200d-1f373':0, '1f469-1f3fb-200d-1f37c':0, '1f469-1f3fc-200d-1f37c':0, '1f469-1f3fd-200d-1f37c':0, '1f469-1f3fe-200d-1f37c':0, '1f469-1f3ff-200d-1f37c':0, '1f469-1f3fb-200d-1f393':0, '1f469-1f3fc-200d-1f393':0, '1f469-1f3fd-200d-1f393':0, '1f469-1f3fe-200d-1f393':0, '1f469-1f3ff-200d-1f393':0, '1f469-1f3fb-200d-1f3a4':0, '1f469-1f3fc-200d-1f3a4':0, '1f469-1f3fd-200d-1f3a4':0, '1f469-1f3fe-200d-1f3a4':0, '1f469-1f3ff-200d-1f3a4':0, '1f469-1f3fb-200d-1f3a8':0, '1f469-1f3fc-200d-1f3a8':0, '1f469-1f3fd-200d-1f3a8':0, '1f469-1f3fe-200d-1f3a8':0, '1f469-1f3ff-200d-1f3a8':0, '1f469-1f3fb-200d-1f3eb':0, '1f469-1f3fc-200d-1f3eb':0, '1f469-1f3fd-200d-1f3eb':0, '1f469-1f3fe-200d-1f3eb':0, '1f469-1f3ff-200d-1f3eb':0, '1f469-1f3fb-200d-1f3ed':0, '1f469-1f3fc-200d-1f3ed':0, '1f469-1f3fd-200d-1f3ed':0, '1f469-1f3fe-200d-1f3ed':0, '1f469-1f3ff-200d-1f3ed':0, '1f469-1f3fb-200d-1f4bb':0, '1f469-1f3fc-200d-1f4bb':0, '1f469-1f3fd-200d-1f4bb':0, '1f469-1f3fe-200d-1f4bb':0, '1f469-1f3ff-200d-1f4bb':0, '1f469-1f3fb-200d-1f4bc':0, '1f469-1f3fc-200d-1f4bc':0, '1f469-1f3fd-200d-1f4bc':0, '1f469-1f3fe-200d-1f4bc':0, '1f469-1f3ff-200d-1f4bc':0, '1f469-1f3fb-200d-1f527':0, '1f469-1f3fc-200d-1f527':0, '1f469-1f3fd-200d-1f527':0, '1f469-1f3fe-200d-1f527':0, '1f469-1f3ff-200d-1f527':0, '1f469-1f3fb-200d-1f52c':0, '1f469-1f3fc-200d-1f52c':0, '1f469-1f3fd-200d-1f52c':0, '1f469-1f3fe-200d-1f52c':0, '1f469-1f3ff-200d-1f52c':0, '1f469-1f3fb-200d-1f680':0, '1f469-1f3fc-200d-1f680':0, '1f469-1f3fd-200d-1f680':0, '1f469-1f3fe-200d-1f680':0, '1f469-1f3ff-200d-1f680':0, '1f469-1f3fb-200d-1f692':0, '1f469-1f3fc-200d-1f692':0, '1f469-1f3fd-200d-1f692':0, '1f469-1f3fe-200d-1f692':0, '1f469-1f3ff-200d-1f692':0, '1f469-1f3fb-200d-1f9af':0, '1f469-1f3fc-200d-1f9af':0, '1f469-1f3fd-200d-1f9af':0, '1f469-1f3fe-200d-1f9af':0, '1f469-1f3ff-200d-1f9af':0, '1f469-1f3fb-200d-1f9b0':0, '1f469-1f3fc-200d-1f9b0':0, '1f469-1f3fd-200d-1f9b0':0, '1f469-1f3fe-200d-1f9b0':0, '1f469-1f3ff-200d-1f9b0':0, '1f469-1f3fb-200d-1f9b1':0, '1f469-1f3fc-200d-1f9b1':0, '1f469-1f3fd-200d-1f9b1':0, '1f469-1f3fe-200d-1f9b1':0, '1f469-1f3ff-200d-1f9b1':0, '1f469-1f3fb-200d-1f9b2':0, '1f469-1f3fc-200d-1f9b2':0, '1f469-1f3fd-200d-1f9b2':0, '1f469-1f3fe-200d-1f9b2':0, '1f469-1f3ff-200d-1f9b2':0, '1f469-1f3fb-200d-1f9b3':0, '1f469-1f3fc-200d-1f9b3':0, '1f469-1f3fd-200d-1f9b3':0, '1f469-1f3fe-200d-1f9b3':0, '1f469-1f3ff-200d-1f9b3':0, '1f469-1f3fb-200d-1f9bc':0, '1f469-1f3fc-200d-1f9bc':0, '1f469-1f3fd-200d-1f9bc':0, '1f469-1f3fe-200d-1f9bc':0, '1f469-1f3ff-200d-1f9bc':0, '1f469-1f3fb-200d-1f9bd':0, '1f469-1f3fc-200d-1f9bd':0, '1f469-1f3fd-200d-1f9bd':0, '1f469-1f3fe-200d-1f9bd':0, '1f469-1f3ff-200d-1f9bd':0, '1f469-1f3fb-200d-2695':0, '1f469-1f3fc-200d-2695':0, '1f469-1f3fd-200d-2695':0, '1f469-1f3fe-200d-2695':0, '1f469-1f3ff-200d-2695':0, '1f469-1f3fb-200d-2696':0, '1f469-1f3fc-200d-2696':0, '1f469-1f3fd-200d-2696':0, '1f469-1f3fe-200d-2696':0, '1f469-1f3ff-200d-2696':0, '1f469-1f3fb-200d-2708':0, '1f469-1f3fc-200d-2708':0, '1f469-1f3fd-200d-2708':0, '1f469-1f3fe-200d-2708':0, '1f469-1f3ff-200d-2708':0, '1f469-1f3fb-200d-2764-200d-1f468-1f3fb':0, '1f469-1f3fb-200d-2764-200d-1f468-1f3fc':0, '1f469-1f3fb-200d-2764-200d-1f468-1f3fd':0, '1f469-1f3fb-200d-2764-200d-1f468-1f3fe':0, '1f469-1f3fb-200d-2764-200d-1f468-1f3ff':0, '1f469-1f3fc-200d-2764-200d-1f468-1f3fb':0, '1f469-1f3fc-200d-2764-200d-1f468-1f3fc':0, '1f469-1f3fc-200d-2764-200d-1f468-1f3fd':0, '1f469-1f3fc-200d-2764-200d-1f468-1f3fe':0, '1f469-1f3fc-200d-2764-200d-1f468-1f3ff':0, '1f469-1f3fd-200d-2764-200d-1f468-1f3fb':0, '1f469-1f3fd-200d-2764-200d-1f468-1f3fc':0, '1f469-1f3fd-200d-2764-200d-1f468-1f3fd':0, '1f469-1f3fd-200d-2764-200d-1f468-1f3fe':0, '1f469-1f3fd-200d-2764-200d-1f468-1f3ff':0, '1f469-1f3fe-200d-2764-200d-1f468-1f3fb':0, '1f469-1f3fe-200d-2764-200d-1f468-1f3fc':0, '1f469-1f3fe-200d-2764-200d-1f468-1f3fd':0, '1f469-1f3fe-200d-2764-200d-1f468-1f3fe':0, '1f469-1f3fe-200d-2764-200d-1f468-1f3ff':0, '1f469-1f3ff-200d-2764-200d-1f468-1f3fb':0, '1f469-1f3ff-200d-2764-200d-1f468-1f3fc':0, '1f469-1f3ff-200d-2764-200d-1f468-1f3fd':0, '1f469-1f3ff-200d-2764-200d-1f468-1f3fe':0, '1f469-1f3ff-200d-2764-200d-1f468-1f3ff':0, '1f469-1f3fb-200d-2764-200d-1f469-1f3fb':0, '1f469-1f3fb-200d-2764-200d-1f469-1f3fc':0, '1f469-1f3fb-200d-2764-200d-1f469-1f3fd':0, '1f469-1f3fb-200d-2764-200d-1f469-1f3fe':0, '1f469-1f3fb-200d-2764-200d-1f469-1f3ff':0, '1f469-1f3fc-200d-2764-200d-1f469-1f3fb':0, '1f469-1f3fc-200d-2764-200d-1f469-1f3fc':0, '1f469-1f3fc-200d-2764-200d-1f469-1f3fd':0, '1f469-1f3fc-200d-2764-200d-1f469-1f3fe':0, '1f469-1f3fc-200d-2764-200d-1f469-1f3ff':0, '1f469-1f3fd-200d-2764-200d-1f469-1f3fb':0, '1f469-1f3fd-200d-2764-200d-1f469-1f3fc':0, '1f469-1f3fd-200d-2764-200d-1f469-1f3fd':0, '1f469-1f3fd-200d-2764-200d-1f469-1f3fe':0, '1f469-1f3fd-200d-2764-200d-1f469-1f3ff':0, '1f469-1f3fe-200d-2764-200d-1f469-1f3fb':0, '1f469-1f3fe-200d-2764-200d-1f469-1f3fc':0, '1f469-1f3fe-200d-2764-200d-1f469-1f3fd':0, '1f469-1f3fe-200d-2764-200d-1f469-1f3fe':0, '1f469-1f3fe-200d-2764-200d-1f469-1f3ff':0, '1f469-1f3ff-200d-2764-200d-1f469-1f3fb':0, '1f469-1f3ff-200d-2764-200d-1f469-1f3fc':0, '1f469-1f3ff-200d-2764-200d-1f469-1f3fd':0, '1f469-1f3ff-200d-2764-200d-1f469-1f3fe':0, '1f469-1f3ff-200d-2764-200d-1f469-1f3ff':0, '1f469-1f3fb-200d-2764-200d-1f48b-200d-1f468-1f3fb':0, '1f469-1f3fb-200d-2764-200d-1f48b-200d-1f468-1f3fc':0, '1f469-1f3fb-200d-2764-200d-1f48b-200d-1f468-1f3fd':0, '1f469-1f3fb-200d-2764-200d-1f48b-200d-1f468-1f3fe':0, '1f469-1f3fb-200d-2764-200d-1f48b-200d-1f468-1f3ff':0, '1f469-1f3fc-200d-2764-200d-1f48b-200d-1f468-1f3fb':0, '1f469-1f3fc-200d-2764-200d-1f48b-200d-1f468-1f3fc':0, '1f469-1f3fc-200d-2764-200d-1f48b-200d-1f468-1f3fd':0, '1f469-1f3fc-200d-2764-200d-1f48b-200d-1f468-1f3fe':0, '1f469-1f3fc-200d-2764-200d-1f48b-200d-1f468-1f3ff':0, '1f469-1f3fd-200d-2764-200d-1f48b-200d-1f468-1f3fb':0, '1f469-1f3fd-200d-2764-200d-1f48b-200d-1f468-1f3fc':0, '1f469-1f3fd-200d-2764-200d-1f48b-200d-1f468-1f3fd':0, '1f469-1f3fd-200d-2764-200d-1f48b-200d-1f468-1f3fe':0, '1f469-1f3fd-200d-2764-200d-1f48b-200d-1f468-1f3ff':0, '1f469-1f3fe-200d-2764-200d-1f48b-200d-1f468-1f3fb':0, '1f469-1f3fe-200d-2764-200d-1f48b-200d-1f468-1f3fc':0, '1f469-1f3fe-200d-2764-200d-1f48b-200d-1f468-1f3fd':0, '1f469-1f3fe-200d-2764-200d-1f48b-200d-1f468-1f3fe':0, '1f469-1f3fe-200d-2764-200d-1f48b-200d-1f468-1f3ff':0, '1f469-1f3ff-200d-2764-200d-1f48b-200d-1f468-1f3fb':0, '1f469-1f3ff-200d-2764-200d-1f48b-200d-1f468-1f3fc':0, '1f469-1f3ff-200d-2764-200d-1f48b-200d-1f468-1f3fd':0, '1f469-1f3ff-200d-2764-200d-1f48b-200d-1f468-1f3fe':0, '1f469-1f3ff-200d-2764-200d-1f48b-200d-1f468-1f3ff':0, '1f469-1f3fb-200d-2764-200d-1f48b-200d-1f469-1f3fb':0, '1f469-1f3fb-200d-2764-200d-1f48b-200d-1f469-1f3fc':0, '1f469-1f3fb-200d-2764-200d-1f48b-200d-1f469-1f3fd':0, '1f469-1f3fb-200d-2764-200d-1f48b-200d-1f469-1f3fe':0, '1f469-1f3fb-200d-2764-200d-1f48b-200d-1f469-1f3ff':0, '1f469-1f3fc-200d-2764-200d-1f48b-200d-1f469-1f3fb':0, '1f469-1f3fc-200d-2764-200d-1f48b-200d-1f469-1f3fc':0, '1f469-1f3fc-200d-2764-200d-1f48b-200d-1f469-1f3fd':0, '1f469-1f3fc-200d-2764-200d-1f48b-200d-1f469-1f3fe':0, '1f469-1f3fc-200d-2764-200d-1f48b-200d-1f469-1f3ff':0, '1f469-1f3fd-200d-2764-200d-1f48b-200d-1f469-1f3fb':0, '1f469-1f3fd-200d-2764-200d-1f48b-200d-1f469-1f3fc':0, '1f469-1f3fd-200d-2764-200d-1f48b-200d-1f469-1f3fd':0, '1f469-1f3fd-200d-2764-200d-1f48b-200d-1f469-1f3fe':0, '1f469-1f3fd-200d-2764-200d-1f48b-200d-1f469-1f3ff':0, '1f469-1f3fe-200d-2764-200d-1f48b-200d-1f469-1f3fb':0, '1f469-1f3fe-200d-2764-200d-1f48b-200d-1f469-1f3fc':0, '1f469-1f3fe-200d-2764-200d-1f48b-200d-1f469-1f3fd':0, '1f469-1f3fe-200d-2764-200d-1f48b-200d-1f469-1f3fe':0, '1f469-1f3fe-200d-2764-200d-1f48b-200d-1f469-1f3ff':0, '1f469-1f3ff-200d-2764-200d-1f48b-200d-1f469-1f3fb':0, '1f469-1f3ff-200d-2764-200d-1f48b-200d-1f469-1f3fc':0, '1f469-1f3ff-200d-2764-200d-1f48b-200d-1f469-1f3fd':0, '1f469-1f3ff-200d-2764-200d-1f48b-200d-1f469-1f3fe':0, '1f469-1f3ff-200d-2764-200d-1f48b-200d-1f469-1f3ff':0, '1f469-1f3fb':0, '1f469-1f3fc':0, '1f469-1f3fd':0, '1f469-1f3fe':0, '1f469-1f3ff':0, '1f46b-1f3fb':0, '1f46b-1f3fc':0, '1f46b-1f3fd':0, '1f46b-1f3fe':0, '1f46b-1f3ff':0, '1f469-1f3fb-200d-1f91d-200d-1f468-1f3fc':0, '1f469-1f3fb-200d-1f91d-200d-1f468-1f3fd':0, '1f469-1f3fb-200d-1f91d-200d-1f468-1f3fe':0, '1f469-1f3fb-200d-1f91d-200d-1f468-1f3ff':0, '1f469-1f3fc-200d-1f91d-200d-1f468-1f3fb':0, '1f469-1f3fc-200d-1f91d-200d-1f468-1f3fd':0, '1f469-1f3fc-200d-1f91d-200d-1f468-1f3fe':0, '1f469-1f3fc-200d-1f91d-200d-1f468-1f3ff':0, '1f469-1f3fd-200d-1f91d-200d-1f468-1f3fb':0, '1f469-1f3fd-200d-1f91d-200d-1f468-1f3fc':0, '1f469-1f3fd-200d-1f91d-200d-1f468-1f3fe':0, '1f469-1f3fd-200d-1f91d-200d-1f468-1f3ff':0, '1f469-1f3fe-200d-1f91d-200d-1f468-1f3fb':0, '1f469-1f3fe-200d-1f91d-200d-1f468-1f3fc':0, '1f469-1f3fe-200d-1f91d-200d-1f468-1f3fd':0, '1f469-1f3fe-200d-1f91d-200d-1f468-1f3ff':0, '1f469-1f3ff-200d-1f91d-200d-1f468-1f3fb':0, '1f469-1f3ff-200d-1f91d-200d-1f468-1f3fc':0, '1f469-1f3ff-200d-1f91d-200d-1f468-1f3fd':0, '1f469-1f3ff-200d-1f91d-200d-1f468-1f3fe':0, '1f46c-1f3fb':0, '1f46c-1f3fc':0, '1f46c-1f3fd':0, '1f46c-1f3fe':0, '1f46c-1f3ff':0, '1f468-1f3fb-200d-1f91d-200d-1f468-1f3fc':0, '1f468-1f3fb-200d-1f91d-200d-1f468-1f3fd':0, '1f468-1f3fb-200d-1f91d-200d-1f468-1f3fe':0, '1f468-1f3fb-200d-1f91d-200d-1f468-1f3ff':0, '1f468-1f3fc-200d-1f91d-200d-1f468-1f3fb':0, '1f468-1f3fc-200d-1f91d-200d-1f468-1f3fd':0, '1f468-1f3fc-200d-1f91d-200d-1f468-1f3fe':0, '1f468-1f3fc-200d-1f91d-200d-1f468-1f3ff':0, '1f468-1f3fd-200d-1f91d-200d-1f468-1f3fb':0, '1f468-1f3fd-200d-1f91d-200d-1f468-1f3fc':0, '1f468-1f3fd-200d-1f91d-200d-1f468-1f3fe':0, '1f468-1f3fd-200d-1f91d-200d-1f468-1f3ff':0, '1f468-1f3fe-200d-1f91d-200d-1f468-1f3fb':0, '1f468-1f3fe-200d-1f91d-200d-1f468-1f3fc':0, '1f468-1f3fe-200d-1f91d-200d-1f468-1f3fd':0, '1f468-1f3fe-200d-1f91d-200d-1f468-1f3ff':0, '1f468-1f3ff-200d-1f91d-200d-1f468-1f3fb':0, '1f468-1f3ff-200d-1f91d-200d-1f468-1f3fc':0, '1f468-1f3ff-200d-1f91d-200d-1f468-1f3fd':0, '1f468-1f3ff-200d-1f91d-200d-1f468-1f3fe':0, '1f46d-1f3fb':0, '1f46d-1f3fc':0, '1f46d-1f3fd':0, '1f46d-1f3fe':0, '1f46d-1f3ff':0, '1f469-1f3fb-200d-1f91d-200d-1f469-1f3fc':0, '1f469-1f3fb-200d-1f91d-200d-1f469-1f3fd':0, '1f469-1f3fb-200d-1f91d-200d-1f469-1f3fe':0, '1f469-1f3fb-200d-1f91d-200d-1f469-1f3ff':0, '1f469-1f3fc-200d-1f91d-200d-1f469-1f3fb':0, '1f469-1f3fc-200d-1f91d-200d-1f469-1f3fd':0, '1f469-1f3fc-200d-1f91d-200d-1f469-1f3fe':0, '1f469-1f3fc-200d-1f91d-200d-1f469-1f3ff':0, '1f469-1f3fd-200d-1f91d-200d-1f469-1f3fb':0, '1f469-1f3fd-200d-1f91d-200d-1f469-1f3fc':0, '1f469-1f3fd-200d-1f91d-200d-1f469-1f3fe':0, '1f469-1f3fd-200d-1f91d-200d-1f469-1f3ff':0, '1f469-1f3fe-200d-1f91d-200d-1f469-1f3fb':0, '1f469-1f3fe-200d-1f91d-200d-1f469-1f3fc':0, '1f469-1f3fe-200d-1f91d-200d-1f469-1f3fd':0, '1f469-1f3fe-200d-1f91d-200d-1f469-1f3ff':0, '1f469-1f3ff-200d-1f91d-200d-1f469-1f3fb':0, '1f469-1f3ff-200d-1f91d-200d-1f469-1f3fc':0, '1f469-1f3ff-200d-1f91d-200d-1f469-1f3fd':0, '1f469-1f3ff-200d-1f91d-200d-1f469-1f3fe':0, '1f46e-1f3fb-200d-2640':0, '1f46e-1f3fc-200d-2640':0, '1f46e-1f3fd-200d-2640':0, '1f46e-1f3fe-200d-2640':0, '1f46e-1f3ff-200d-2640':0, '1f46e-1f3fb-200d-2642':0, '1f46e-1f3fc-200d-2642':0, '1f46e-1f3fd-200d-2642':0, '1f46e-1f3fe-200d-2642':0, '1f46e-1f3ff-200d-2642':0, '1f46e-1f3fb':0, '1f46e-1f3fc':0, '1f46e-1f3fd':0, '1f46e-1f3fe':0, '1f46e-1f3ff':0, '1f470-1f3fb-200d-2640':0, '1f470-1f3fc-200d-2640':0, '1f470-1f3fd-200d-2640':0, '1f470-1f3fe-200d-2640':0, '1f470-1f3ff-200d-2640':0, '1f470-1f3fb-200d-2642':0, '1f470-1f3fc-200d-2642':0, '1f470-1f3fd-200d-2642':0, '1f470-1f3fe-200d-2642':0, '1f470-1f3ff-200d-2642':0, '1f470-1f3fb':0, '1f470-1f3fc':0, '1f470-1f3fd':0, '1f470-1f3fe':0, '1f470-1f3ff':0, '1f471-1f3fb-200d-2640':0, '1f471-1f3fc-200d-2640':0, '1f471-1f3fd-200d-2640':0, '1f471-1f3fe-200d-2640':0, '1f471-1f3ff-200d-2640':0, '1f471-1f3fb-200d-2642':0, '1f471-1f3fc-200d-2642':0, '1f471-1f3fd-200d-2642':0, '1f471-1f3fe-200d-2642':0, '1f471-1f3ff-200d-2642':0, '1f471-1f3fb':0, '1f471-1f3fc':0, '1f471-1f3fd':0, '1f471-1f3fe':0, '1f471-1f3ff':0, '1f472-1f3fb':0, '1f472-1f3fc':0, '1f472-1f3fd':0, '1f472-1f3fe':0, '1f472-1f3ff':0, '1f473-1f3fb-200d-2640':0, '1f473-1f3fc-200d-2640':0, '1f473-1f3fd-200d-2640':0, '1f473-1f3fe-200d-2640':0, '1f473-1f3ff-200d-2640':0, '1f473-1f3fb-200d-2642':0, '1f473-1f3fc-200d-2642':0, '1f473-1f3fd-200d-2642':0, '1f473-1f3fe-200d-2642':0, '1f473-1f3ff-200d-2642':0, '1f473-1f3fb':0, '1f473-1f3fc':0, '1f473-1f3fd':0, '1f473-1f3fe':0, '1f473-1f3ff':0, '1f474-1f3fb':0, '1f474-1f3fc':0, '1f474-1f3fd':0, '1f474-1f3fe':0, '1f474-1f3ff':0, '1f475-1f3fb':0, '1f475-1f3fc':0, '1f475-1f3fd':0, '1f475-1f3fe':0, '1f475-1f3ff':0, '1f476-1f3fb':0, '1f476-1f3fc':0, '1f476-1f3fd':0, '1f476-1f3fe':0, '1f476-1f3ff':0, '1f477-1f3fb-200d-2640':0, '1f477-1f3fc-200d-2640':0, '1f477-1f3fd-200d-2640':0, '1f477-1f3fe-200d-2640':0, '1f477-1f3ff-200d-2640':0, '1f477-1f3fb-200d-2642':0, '1f477-1f3fc-200d-2642':0, '1f477-1f3fd-200d-2642':0, '1f477-1f3fe-200d-2642':0, '1f477-1f3ff-200d-2642':0, '1f477-1f3fb':0, '1f477-1f3fc':0, '1f477-1f3fd':0, '1f477-1f3fe':0, '1f477-1f3ff':0, '1f478-1f3fb':0, '1f478-1f3fc':0, '1f478-1f3fd':0, '1f478-1f3fe':0, '1f478-1f3ff':0, '1f47c-1f3fb':0, '1f47c-1f3fc':0, '1f47c-1f3fd':0, '1f47c-1f3fe':0, '1f47c-1f3ff':0, '1f481-1f3fb-200d-2640':0, '1f481-1f3fc-200d-2640':0, '1f481-1f3fd-200d-2640':0, '1f481-1f3fe-200d-2640':0, '1f481-1f3ff-200d-2640':0, '1f481-1f3fb-200d-2642':0, '1f481-1f3fc-200d-2642':0, '1f481-1f3fd-200d-2642':0, '1f481-1f3fe-200d-2642':0, '1f481-1f3ff-200d-2642':0, '1f481-1f3fb':0, '1f481-1f3fc':0, '1f481-1f3fd':0, '1f481-1f3fe':0, '1f481-1f3ff':0, '1f482-1f3fb-200d-2640':0, '1f482-1f3fc-200d-2640':0, '1f482-1f3fd-200d-2640':0, '1f482-1f3fe-200d-2640':0, '1f482-1f3ff-200d-2640':0, '1f482-1f3fb-200d-2642':0, '1f482-1f3fc-200d-2642':0, '1f482-1f3fd-200d-2642':0, '1f482-1f3fe-200d-2642':0, '1f482-1f3ff-200d-2642':0, '1f482-1f3fb':0, '1f482-1f3fc':0, '1f482-1f3fd':0, '1f482-1f3fe':0, '1f482-1f3ff':0, '1f483-1f3fb':0, '1f483-1f3fc':0, '1f483-1f3fd':0, '1f483-1f3fe':0, '1f483-1f3ff':0, '1f485-1f3fb':0, '1f485-1f3fc':0, '1f485-1f3fd':0, '1f485-1f3fe':0, '1f485-1f3ff':0, '1f486-1f3fb-200d-2640':0, '1f486-1f3fc-200d-2640':0, '1f486-1f3fd-200d-2640':0, '1f486-1f3fe-200d-2640':0, '1f486-1f3ff-200d-2640':0, '1f486-1f3fb-200d-2642':0, '1f486-1f3fc-200d-2642':0, '1f486-1f3fd-200d-2642':0, '1f486-1f3fe-200d-2642':0, '1f486-1f3ff-200d-2642':0, '1f486-1f3fb':0, '1f486-1f3fc':0, '1f486-1f3fd':0, '1f486-1f3fe':0, '1f486-1f3ff':0, '1f487-1f3fb-200d-2640':0, '1f487-1f3fc-200d-2640':0, '1f487-1f3fd-200d-2640':0, '1f487-1f3fe-200d-2640':0, '1f487-1f3ff-200d-2640':0, '1f487-1f3fb-200d-2642':0, '1f487-1f3fc-200d-2642':0, '1f487-1f3fd-200d-2642':0, '1f487-1f3fe-200d-2642':0, '1f487-1f3ff-200d-2642':0, '1f487-1f3fb':0, '1f487-1f3fc':0, '1f487-1f3fd':0, '1f487-1f3fe':0, '1f487-1f3ff':0, '1f48f-1f3fb':0, '1f48f-1f3fc':0, '1f48f-1f3fd':0, '1f48f-1f3fe':0, '1f48f-1f3ff':0, '1f9d1-1f3fb-200d-2764-200d-1f48b-200d-1f9d1-1f3fc':0, '1f9d1-1f3fb-200d-2764-200d-1f48b-200d-1f9d1-1f3fd':0, '1f9d1-1f3fb-200d-2764-200d-1f48b-200d-1f9d1-1f3fe':0, '1f9d1-1f3fb-200d-2764-200d-1f48b-200d-1f9d1-1f3ff':0, '1f9d1-1f3fc-200d-2764-200d-1f48b-200d-1f9d1-1f3fb':0, '1f9d1-1f3fc-200d-2764-200d-1f48b-200d-1f9d1-1f3fd':0, '1f9d1-1f3fc-200d-2764-200d-1f48b-200d-1f9d1-1f3fe':0, '1f9d1-1f3fc-200d-2764-200d-1f48b-200d-1f9d1-1f3ff':0, '1f9d1-1f3fd-200d-2764-200d-1f48b-200d-1f9d1-1f3fb':0, '1f9d1-1f3fd-200d-2764-200d-1f48b-200d-1f9d1-1f3fc':0, '1f9d1-1f3fd-200d-2764-200d-1f48b-200d-1f9d1-1f3fe':0, '1f9d1-1f3fd-200d-2764-200d-1f48b-200d-1f9d1-1f3ff':0, '1f9d1-1f3fe-200d-2764-200d-1f48b-200d-1f9d1-1f3fb':0, '1f9d1-1f3fe-200d-2764-200d-1f48b-200d-1f9d1-1f3fc':0, '1f9d1-1f3fe-200d-2764-200d-1f48b-200d-1f9d1-1f3fd':0, '1f9d1-1f3fe-200d-2764-200d-1f48b-200d-1f9d1-1f3ff':0, '1f9d1-1f3ff-200d-2764-200d-1f48b-200d-1f9d1-1f3fb':0, '1f9d1-1f3ff-200d-2764-200d-1f48b-200d-1f9d1-1f3fc':0, '1f9d1-1f3ff-200d-2764-200d-1f48b-200d-1f9d1-1f3fd':0, '1f9d1-1f3ff-200d-2764-200d-1f48b-200d-1f9d1-1f3fe':0, '1f491-1f3fb':0, '1f491-1f3fc':0, '1f491-1f3fd':0, '1f491-1f3fe':0, '1f491-1f3ff':0, '1f9d1-1f3fb-200d-2764-200d-1f9d1-1f3fc':0, '1f9d1-1f3fb-200d-2764-200d-1f9d1-1f3fd':0, '1f9d1-1f3fb-200d-2764-200d-1f9d1-1f3fe':0, '1f9d1-1f3fb-200d-2764-200d-1f9d1-1f3ff':0, '1f9d1-1f3fc-200d-2764-200d-1f9d1-1f3fb':0, '1f9d1-1f3fc-200d-2764-200d-1f9d1-1f3fd':0, '1f9d1-1f3fc-200d-2764-200d-1f9d1-1f3fe':0, '1f9d1-1f3fc-200d-2764-200d-1f9d1-1f3ff':0, '1f9d1-1f3fd-200d-2764-200d-1f9d1-1f3fb':0, '1f9d1-1f3fd-200d-2764-200d-1f9d1-1f3fc':0, '1f9d1-1f3fd-200d-2764-200d-1f9d1-1f3fe':0, '1f9d1-1f3fd-200d-2764-200d-1f9d1-1f3ff':0, '1f9d1-1f3fe-200d-2764-200d-1f9d1-1f3fb':0, '1f9d1-1f3fe-200d-2764-200d-1f9d1-1f3fc':0, '1f9d1-1f3fe-200d-2764-200d-1f9d1-1f3fd':0, '1f9d1-1f3fe-200d-2764-200d-1f9d1-1f3ff':0, '1f9d1-1f3ff-200d-2764-200d-1f9d1-1f3fb':0, '1f9d1-1f3ff-200d-2764-200d-1f9d1-1f3fc':0, '1f9d1-1f3ff-200d-2764-200d-1f9d1-1f3fd':0, '1f9d1-1f3ff-200d-2764-200d-1f9d1-1f3fe':0, '1f4aa-1f3fb':0, '1f4aa-1f3fc':0, '1f4aa-1f3fd':0, '1f4aa-1f3fe':0, '1f4aa-1f3ff':0, '1f574-1f3fb':0, '1f574-1f3fc':0, '1f574-1f3fd':0, '1f574-1f3fe':0, '1f574-1f3ff':0, '1f575-1f3fb-200d-2640':0, '1f575-1f3fc-200d-2640':0, '1f575-1f3fd-200d-2640':0, '1f575-1f3fe-200d-2640':0, '1f575-1f3ff-200d-2640':0, '1f575-1f3fb-200d-2642':0, '1f575-1f3fc-200d-2642':0, '1f575-1f3fd-200d-2642':0, '1f575-1f3fe-200d-2642':0, '1f575-1f3ff-200d-2642':0, '1f575-1f3fb':0, '1f575-1f3fc':0, '1f575-1f3fd':0, '1f575-1f3fe':0, '1f575-1f3ff':0, '1f57a-1f3fb':0, '1f57a-1f3fc':0, '1f57a-1f3fd':0, '1f57a-1f3fe':0, '1f57a-1f3ff':0, '1f590-1f3fb':0, '1f590-1f3fc':0, '1f590-1f3fd':0, '1f590-1f3fe':0, '1f590-1f3ff':0, '1f595-1f3fb':0, '1f595-1f3fc':0, '1f595-1f3fd':0, '1f595-1f3fe':0, '1f595-1f3ff':0, '1f596-1f3fb':0, '1f596-1f3fc':0, '1f596-1f3fd':0, '1f596-1f3fe':0, '1f596-1f3ff':0, '1f645-1f3fb-200d-2640':0, '1f645-1f3fc-200d-2640':0, '1f645-1f3fd-200d-2640':0, '1f645-1f3fe-200d-2640':0, '1f645-1f3ff-200d-2640':0, '1f645-1f3fb-200d-2642':0, '1f645-1f3fc-200d-2642':0, '1f645-1f3fd-200d-2642':0, '1f645-1f3fe-200d-2642':0, '1f645-1f3ff-200d-2642':0, '1f645-1f3fb':0, '1f645-1f3fc':0, '1f645-1f3fd':0, '1f645-1f3fe':0, '1f645-1f3ff':0, '1f646-1f3fb-200d-2640':0, '1f646-1f3fc-200d-2640':0, '1f646-1f3fd-200d-2640':0, '1f646-1f3fe-200d-2640':0, '1f646-1f3ff-200d-2640':0, '1f646-1f3fb-200d-2642':0, '1f646-1f3fc-200d-2642':0, '1f646-1f3fd-200d-2642':0, '1f646-1f3fe-200d-2642':0, '1f646-1f3ff-200d-2642':0, '1f646-1f3fb':0, '1f646-1f3fc':0, '1f646-1f3fd':0, '1f646-1f3fe':0, '1f646-1f3ff':0, '1f647-1f3fb-200d-2640':0, '1f647-1f3fc-200d-2640':0, '1f647-1f3fd-200d-2640':0, '1f647-1f3fe-200d-2640':0, '1f647-1f3ff-200d-2640':0, '1f647-1f3fb-200d-2642':0, '1f647-1f3fc-200d-2642':0, '1f647-1f3fd-200d-2642':0, '1f647-1f3fe-200d-2642':0, '1f647-1f3ff-200d-2642':0, '1f647-1f3fb':0, '1f647-1f3fc':0, '1f647-1f3fd':0, '1f647-1f3fe':0, '1f647-1f3ff':0, '1f64b-1f3fb-200d-2640':0, '1f64b-1f3fc-200d-2640':0, '1f64b-1f3fd-200d-2640':0, '1f64b-1f3fe-200d-2640':0, '1f64b-1f3ff-200d-2640':0, '1f64b-1f3fb-200d-2642':0, '1f64b-1f3fc-200d-2642':0, '1f64b-1f3fd-200d-2642':0, '1f64b-1f3fe-200d-2642':0, '1f64b-1f3ff-200d-2642':0, '1f64b-1f3fb':0, '1f64b-1f3fc':0, '1f64b-1f3fd':0, '1f64b-1f3fe':0, '1f64b-1f3ff':0, '1f64c-1f3fb':0, '1f64c-1f3fc':0, '1f64c-1f3fd':0, '1f64c-1f3fe':0, '1f64c-1f3ff':0, '1f64d-1f3fb-200d-2640':0, '1f64d-1f3fc-200d-2640':0, '1f64d-1f3fd-200d-2640':0, '1f64d-1f3fe-200d-2640':0, '1f64d-1f3ff-200d-2640':0, '1f64d-1f3fb-200d-2642':0, '1f64d-1f3fc-200d-2642':0, '1f64d-1f3fd-200d-2642':0, '1f64d-1f3fe-200d-2642':0, '1f64d-1f3ff-200d-2642':0, '1f64d-1f3fb':0, '1f64d-1f3fc':0, '1f64d-1f3fd':0, '1f64d-1f3fe':0, '1f64d-1f3ff':0, '1f64e-1f3fb-200d-2640':0, '1f64e-1f3fc-200d-2640':0, '1f64e-1f3fd-200d-2640':0, '1f64e-1f3fe-200d-2640':0, '1f64e-1f3ff-200d-2640':0, '1f64e-1f3fb-200d-2642':0, '1f64e-1f3fc-200d-2642':0, '1f64e-1f3fd-200d-2642':0, '1f64e-1f3fe-200d-2642':0, '1f64e-1f3ff-200d-2642':0, '1f64e-1f3fb':0, '1f64e-1f3fc':0, '1f64e-1f3fd':0, '1f64e-1f3fe':0, '1f64e-1f3ff':0, '1f64f-1f3fb':0, '1f64f-1f3fc':0, '1f64f-1f3fd':0, '1f64f-1f3fe':0, '1f64f-1f3ff':0, '1f6a3-1f3fb-200d-2640':0, '1f6a3-1f3fc-200d-2640':0, '1f6a3-1f3fd-200d-2640':0, '1f6a3-1f3fe-200d-2640':0, '1f6a3-1f3ff-200d-2640':0, '1f6a3-1f3fb-200d-2642':0, '1f6a3-1f3fc-200d-2642':0, '1f6a3-1f3fd-200d-2642':0, '1f6a3-1f3fe-200d-2642':0, '1f6a3-1f3ff-200d-2642':0, '1f6a3-1f3fb':0, '1f6a3-1f3fc':0, '1f6a3-1f3fd':0, '1f6a3-1f3fe':0, '1f6a3-1f3ff':0, '1f6b4-1f3fb-200d-2640':0, '1f6b4-1f3fc-200d-2640':0, '1f6b4-1f3fd-200d-2640':0, '1f6b4-1f3fe-200d-2640':0, '1f6b4-1f3ff-200d-2640':0, '1f6b4-1f3fb-200d-2642':0, '1f6b4-1f3fc-200d-2642':0, '1f6b4-1f3fd-200d-2642':0, '1f6b4-1f3fe-200d-2642':0, '1f6b4-1f3ff-200d-2642':0, '1f6b4-1f3fb':0, '1f6b4-1f3fc':0, '1f6b4-1f3fd':0, '1f6b4-1f3fe':0, '1f6b4-1f3ff':0, '1f6b5-1f3fb-200d-2640':0, '1f6b5-1f3fc-200d-2640':0, '1f6b5-1f3fd-200d-2640':0, '1f6b5-1f3fe-200d-2640':0, '1f6b5-1f3ff-200d-2640':0, '1f6b5-1f3fb-200d-2642':0, '1f6b5-1f3fc-200d-2642':0, '1f6b5-1f3fd-200d-2642':0, '1f6b5-1f3fe-200d-2642':0, '1f6b5-1f3ff-200d-2642':0, '1f6b5-1f3fb':0, '1f6b5-1f3fc':0, '1f6b5-1f3fd':0, '1f6b5-1f3fe':0, '1f6b5-1f3ff':0, '1f6b6-1f3fb-200d-2640':0, '1f6b6-1f3fc-200d-2640':0, '1f6b6-1f3fd-200d-2640':0, '1f6b6-1f3fe-200d-2640':0, '1f6b6-1f3ff-200d-2640':0, '1f6b6-1f3fb-200d-2642':0, '1f6b6-1f3fc-200d-2642':0, '1f6b6-1f3fd-200d-2642':0, '1f6b6-1f3fe-200d-2642':0, '1f6b6-1f3ff-200d-2642':0, '1f6b6-1f3fb':0, '1f6b6-1f3fc':0, '1f6b6-1f3fd':0, '1f6b6-1f3fe':0, '1f6b6-1f3ff':0, '1f6c0-1f3fb':0, '1f6c0-1f3fc':0, '1f6c0-1f3fd':0, '1f6c0-1f3fe':0, '1f6c0-1f3ff':0, '1f6cc-1f3fb':0, '1f6cc-1f3fc':0, '1f6cc-1f3fd':0, '1f6cc-1f3fe':0, '1f6cc-1f3ff':0, '1f90c-1f3fb':0, '1f90c-1f3fc':0, '1f90c-1f3fd':0, '1f90c-1f3fe':0, '1f90c-1f3ff':0, '1f90f-1f3fb':0, '1f90f-1f3fc':0, '1f90f-1f3fd':0, '1f90f-1f3fe':0, '1f90f-1f3ff':0, '1f918-1f3fb':0, '1f918-1f3fc':0, '1f918-1f3fd':0, '1f918-1f3fe':0, '1f918-1f3ff':0, '1f919-1f3fb':0, '1f919-1f3fc':0, '1f919-1f3fd':0, '1f919-1f3fe':0, '1f919-1f3ff':0, '1f91a-1f3fb':0, '1f91a-1f3fc':0, '1f91a-1f3fd':0, '1f91a-1f3fe':0, '1f91a-1f3ff':0, '1f91b-1f3fb':0, '1f91b-1f3fc':0, '1f91b-1f3fd':0, '1f91b-1f3fe':0, '1f91b-1f3ff':0, '1f91c-1f3fb':0, '1f91c-1f3fc':0, '1f91c-1f3fd':0, '1f91c-1f3fe':0, '1f91c-1f3ff':0, '1f91d-1f3fb':0, '1f91d-1f3fc':0, '1f91d-1f3fd':0, '1f91d-1f3fe':0, '1f91d-1f3ff':0, '1f91e-1f3fb':0, '1f91e-1f3fc':0, '1f91e-1f3fd':0, '1f91e-1f3fe':0, '1f91e-1f3ff':0, '1f91f-1f3fb':0, '1f91f-1f3fc':0, '1f91f-1f3fd':0, '1f91f-1f3fe':0, '1f91f-1f3ff':0, '1f926-1f3fb-200d-2640':0, '1f926-1f3fc-200d-2640':0, '1f926-1f3fd-200d-2640':0, '1f926-1f3fe-200d-2640':0, '1f926-1f3ff-200d-2640':0, '1f926-1f3fb-200d-2642':0, '1f926-1f3fc-200d-2642':0, '1f926-1f3fd-200d-2642':0, '1f926-1f3fe-200d-2642':0, '1f926-1f3ff-200d-2642':0, '1f926-1f3fb':0, '1f926-1f3fc':0, '1f926-1f3fd':0, '1f926-1f3fe':0, '1f926-1f3ff':0, '1f930-1f3fb':0, '1f930-1f3fc':0, '1f930-1f3fd':0, '1f930-1f3fe':0, '1f930-1f3ff':0, '1f931-1f3fb':0, '1f931-1f3fc':0, '1f931-1f3fd':0, '1f931-1f3fe':0, '1f931-1f3ff':0, '1f932-1f3fb':0, '1f932-1f3fc':0, '1f932-1f3fd':0, '1f932-1f3fe':0, '1f932-1f3ff':0, '1f933-1f3fb':0, '1f933-1f3fc':0, '1f933-1f3fd':0, '1f933-1f3fe':0, '1f933-1f3ff':0, '1f934-1f3fb':0, '1f934-1f3fc':0, '1f934-1f3fd':0, '1f934-1f3fe':0, '1f934-1f3ff':0, '1f935-1f3fb-200d-2640':0, '1f935-1f3fc-200d-2640':0, '1f935-1f3fd-200d-2640':0, '1f935-1f3fe-200d-2640':0, '1f935-1f3ff-200d-2640':0, '1f935-1f3fb-200d-2642':0, '1f935-1f3fc-200d-2642':0, '1f935-1f3fd-200d-2642':0, '1f935-1f3fe-200d-2642':0, '1f935-1f3ff-200d-2642':0, '1f935-1f3fb':0, '1f935-1f3fc':0, '1f935-1f3fd':0, '1f935-1f3fe':0, '1f935-1f3ff':0, '1f936-1f3fb':0, '1f936-1f3fc':0, '1f936-1f3fd':0, '1f936-1f3fe':0, '1f936-1f3ff':0, '1f937-1f3fb-200d-2640':0, '1f937-1f3fc-200d-2640':0, '1f937-1f3fd-200d-2640':0, '1f937-1f3fe-200d-2640':0, '1f937-1f3ff-200d-2640':0, '1f937-1f3fb-200d-2642':0, '1f937-1f3fc-200d-2642':0, '1f937-1f3fd-200d-2642':0, '1f937-1f3fe-200d-2642':0, '1f937-1f3ff-200d-2642':0, '1f937-1f3fb':0, '1f937-1f3fc':0, '1f937-1f3fd':0, '1f937-1f3fe':0, '1f937-1f3ff':0, '1f938-1f3fb-200d-2640':0, '1f938-1f3fc-200d-2640':0, '1f938-1f3fd-200d-2640':0, '1f938-1f3fe-200d-2640':0, '1f938-1f3ff-200d-2640':0, '1f938-1f3fb-200d-2642':0, '1f938-1f3fc-200d-2642':0, '1f938-1f3fd-200d-2642':0, '1f938-1f3fe-200d-2642':0, '1f938-1f3ff-200d-2642':0, '1f938-1f3fb':0, '1f938-1f3fc':0, '1f938-1f3fd':0, '1f938-1f3fe':0, '1f938-1f3ff':0, '1f939-1f3fb-200d-2640':0, '1f939-1f3fc-200d-2640':0, '1f939-1f3fd-200d-2640':0, '1f939-1f3fe-200d-2640':0, '1f939-1f3ff-200d-2640':0, '1f939-1f3fb-200d-2642':0, '1f939-1f3fc-200d-2642':0, '1f939-1f3fd-200d-2642':0, '1f939-1f3fe-200d-2642':0, '1f939-1f3ff-200d-2642':0, '1f939-1f3fb':0, '1f939-1f3fc':0, '1f939-1f3fd':0, '1f939-1f3fe':0, '1f939-1f3ff':0, '1f93d-1f3fb-200d-2640':0, '1f93d-1f3fc-200d-2640':0, '1f93d-1f3fd-200d-2640':0, '1f93d-1f3fe-200d-2640':0, '1f93d-1f3ff-200d-2640':0, '1f93d-1f3fb-200d-2642':0, '1f93d-1f3fc-200d-2642':0, '1f93d-1f3fd-200d-2642':0, '1f93d-1f3fe-200d-2642':0, '1f93d-1f3ff-200d-2642':0, '1f93d-1f3fb':0, '1f93d-1f3fc':0, '1f93d-1f3fd':0, '1f93d-1f3fe':0, '1f93d-1f3ff':0, '1f93e-1f3fb-200d-2640':0, '1f93e-1f3fc-200d-2640':0, '1f93e-1f3fd-200d-2640':0, '1f93e-1f3fe-200d-2640':0, '1f93e-1f3ff-200d-2640':0, '1f93e-1f3fb-200d-2642':0, '1f93e-1f3fc-200d-2642':0, '1f93e-1f3fd-200d-2642':0, '1f93e-1f3fe-200d-2642':0, '1f93e-1f3ff-200d-2642':0, '1f93e-1f3fb':0, '1f93e-1f3fc':0, '1f93e-1f3fd':0, '1f93e-1f3fe':0, '1f93e-1f3ff':0, '1f977-1f3fb':0, '1f977-1f3fc':0, '1f977-1f3fd':0, '1f977-1f3fe':0, '1f977-1f3ff':0, '1f9b5-1f3fb':0, '1f9b5-1f3fc':0, '1f9b5-1f3fd':0, '1f9b5-1f3fe':0, '1f9b5-1f3ff':0, '1f9b6-1f3fb':0, '1f9b6-1f3fc':0, '1f9b6-1f3fd':0, '1f9b6-1f3fe':0, '1f9b6-1f3ff':0, '1f9b8-1f3fb-200d-2640':0, '1f9b8-1f3fc-200d-2640':0, '1f9b8-1f3fd-200d-2640':0, '1f9b8-1f3fe-200d-2640':0, '1f9b8-1f3ff-200d-2640':0, '1f9b8-1f3fb-200d-2642':0, '1f9b8-1f3fc-200d-2642':0, '1f9b8-1f3fd-200d-2642':0, '1f9b8-1f3fe-200d-2642':0, '1f9b8-1f3ff-200d-2642':0, '1f9b8-1f3fb':0, '1f9b8-1f3fc':0, '1f9b8-1f3fd':0, '1f9b8-1f3fe':0, '1f9b8-1f3ff':0, '1f9b9-1f3fb-200d-2640':0, '1f9b9-1f3fc-200d-2640':0, '1f9b9-1f3fd-200d-2640':0, '1f9b9-1f3fe-200d-2640':0, '1f9b9-1f3ff-200d-2640':0, '1f9b9-1f3fb-200d-2642':0, '1f9b9-1f3fc-200d-2642':0, '1f9b9-1f3fd-200d-2642':0, '1f9b9-1f3fe-200d-2642':0, '1f9b9-1f3ff-200d-2642':0, '1f9b9-1f3fb':0, '1f9b9-1f3fc':0, '1f9b9-1f3fd':0, '1f9b9-1f3fe':0, '1f9b9-1f3ff':0, '1f9bb-1f3fb':0, '1f9bb-1f3fc':0, '1f9bb-1f3fd':0, '1f9bb-1f3fe':0, '1f9bb-1f3ff':0, '1f9cd-1f3fb-200d-2640':0, '1f9cd-1f3fc-200d-2640':0, '1f9cd-1f3fd-200d-2640':0, '1f9cd-1f3fe-200d-2640':0, '1f9cd-1f3ff-200d-2640':0, '1f9cd-1f3fb-200d-2642':0, '1f9cd-1f3fc-200d-2642':0, '1f9cd-1f3fd-200d-2642':0, '1f9cd-1f3fe-200d-2642':0, '1f9cd-1f3ff-200d-2642':0, '1f9cd-1f3fb':0, '1f9cd-1f3fc':0, '1f9cd-1f3fd':0, '1f9cd-1f3fe':0, '1f9cd-1f3ff':0, '1f9ce-1f3fb-200d-2640':0, '1f9ce-1f3fc-200d-2640':0, '1f9ce-1f3fd-200d-2640':0, '1f9ce-1f3fe-200d-2640':0, '1f9ce-1f3ff-200d-2640':0, '1f9ce-1f3fb-200d-2642':0, '1f9ce-1f3fc-200d-2642':0, '1f9ce-1f3fd-200d-2642':0, '1f9ce-1f3fe-200d-2642':0, '1f9ce-1f3ff-200d-2642':0, '1f9ce-1f3fb':0, '1f9ce-1f3fc':0, '1f9ce-1f3fd':0, '1f9ce-1f3fe':0, '1f9ce-1f3ff':0, '1f9cf-1f3fb-200d-2640':0, '1f9cf-1f3fc-200d-2640':0, '1f9cf-1f3fd-200d-2640':0, '1f9cf-1f3fe-200d-2640':0, '1f9cf-1f3ff-200d-2640':0, '1f9cf-1f3fb-200d-2642':0, '1f9cf-1f3fc-200d-2642':0, '1f9cf-1f3fd-200d-2642':0, '1f9cf-1f3fe-200d-2642':0, '1f9cf-1f3ff-200d-2642':0, '1f9cf-1f3fb':0, '1f9cf-1f3fc':0, '1f9cf-1f3fd':0, '1f9cf-1f3fe':0, '1f9cf-1f3ff':0, '1f9d1-1f3fb-200d-1f33e':0, '1f9d1-1f3fc-200d-1f33e':0, '1f9d1-1f3fd-200d-1f33e':0, '1f9d1-1f3fe-200d-1f33e':0, '1f9d1-1f3ff-200d-1f33e':0, '1f9d1-1f3fb-200d-1f373':0, '1f9d1-1f3fc-200d-1f373':0, '1f9d1-1f3fd-200d-1f373':0, '1f9d1-1f3fe-200d-1f373':0, '1f9d1-1f3ff-200d-1f373':0, '1f9d1-1f3fb-200d-1f37c':0, '1f9d1-1f3fc-200d-1f37c':0, '1f9d1-1f3fd-200d-1f37c':0, '1f9d1-1f3fe-200d-1f37c':0, '1f9d1-1f3ff-200d-1f37c':0, '1f9d1-1f3fb-200d-1f384':0, '1f9d1-1f3fc-200d-1f384':0, '1f9d1-1f3fd-200d-1f384':0, '1f9d1-1f3fe-200d-1f384':0, '1f9d1-1f3ff-200d-1f384':0, '1f9d1-1f3fb-200d-1f393':0, '1f9d1-1f3fc-200d-1f393':0, '1f9d1-1f3fd-200d-1f393':0, '1f9d1-1f3fe-200d-1f393':0, '1f9d1-1f3ff-200d-1f393':0, '1f9d1-1f3fb-200d-1f3a4':0, '1f9d1-1f3fc-200d-1f3a4':0, '1f9d1-1f3fd-200d-1f3a4':0, '1f9d1-1f3fe-200d-1f3a4':0, '1f9d1-1f3ff-200d-1f3a4':0, '1f9d1-1f3fb-200d-1f3a8':0, '1f9d1-1f3fc-200d-1f3a8':0, '1f9d1-1f3fd-200d-1f3a8':0, '1f9d1-1f3fe-200d-1f3a8':0, '1f9d1-1f3ff-200d-1f3a8':0, '1f9d1-1f3fb-200d-1f3eb':0, '1f9d1-1f3fc-200d-1f3eb':0, '1f9d1-1f3fd-200d-1f3eb':0, '1f9d1-1f3fe-200d-1f3eb':0, '1f9d1-1f3ff-200d-1f3eb':0, '1f9d1-1f3fb-200d-1f3ed':0, '1f9d1-1f3fc-200d-1f3ed':0, '1f9d1-1f3fd-200d-1f3ed':0, '1f9d1-1f3fe-200d-1f3ed':0, '1f9d1-1f3ff-200d-1f3ed':0, '1f9d1-1f3fb-200d-1f4bb':0, '1f9d1-1f3fc-200d-1f4bb':0, '1f9d1-1f3fd-200d-1f4bb':0, '1f9d1-1f3fe-200d-1f4bb':0, '1f9d1-1f3ff-200d-1f4bb':0, '1f9d1-1f3fb-200d-1f4bc':0, '1f9d1-1f3fc-200d-1f4bc':0, '1f9d1-1f3fd-200d-1f4bc':0, '1f9d1-1f3fe-200d-1f4bc':0, '1f9d1-1f3ff-200d-1f4bc':0, '1f9d1-1f3fb-200d-1f527':0, '1f9d1-1f3fc-200d-1f527':0, '1f9d1-1f3fd-200d-1f527':0, '1f9d1-1f3fe-200d-1f527':0, '1f9d1-1f3ff-200d-1f527':0, '1f9d1-1f3fb-200d-1f52c':0, '1f9d1-1f3fc-200d-1f52c':0, '1f9d1-1f3fd-200d-1f52c':0, '1f9d1-1f3fe-200d-1f52c':0, '1f9d1-1f3ff-200d-1f52c':0, '1f9d1-1f3fb-200d-1f680':0, '1f9d1-1f3fc-200d-1f680':0, '1f9d1-1f3fd-200d-1f680':0, '1f9d1-1f3fe-200d-1f680':0, '1f9d1-1f3ff-200d-1f680':0, '1f9d1-1f3fb-200d-1f692':0, '1f9d1-1f3fc-200d-1f692':0, '1f9d1-1f3fd-200d-1f692':0, '1f9d1-1f3fe-200d-1f692':0, '1f9d1-1f3ff-200d-1f692':0, '1f9d1-1f3fb-200d-1f91d-200d-1f9d1-1f3fb':0, '1f9d1-1f3fb-200d-1f91d-200d-1f9d1-1f3fc':0, '1f9d1-1f3fb-200d-1f91d-200d-1f9d1-1f3fd':0, '1f9d1-1f3fb-200d-1f91d-200d-1f9d1-1f3fe':0, '1f9d1-1f3fb-200d-1f91d-200d-1f9d1-1f3ff':0, '1f9d1-1f3fc-200d-1f91d-200d-1f9d1-1f3fb':0, '1f9d1-1f3fc-200d-1f91d-200d-1f9d1-1f3fc':0, '1f9d1-1f3fc-200d-1f91d-200d-1f9d1-1f3fd':0, '1f9d1-1f3fc-200d-1f91d-200d-1f9d1-1f3fe':0, '1f9d1-1f3fc-200d-1f91d-200d-1f9d1-1f3ff':0, '1f9d1-1f3fd-200d-1f91d-200d-1f9d1-1f3fb':0, '1f9d1-1f3fd-200d-1f91d-200d-1f9d1-1f3fc':0, '1f9d1-1f3fd-200d-1f91d-200d-1f9d1-1f3fd':0, '1f9d1-1f3fd-200d-1f91d-200d-1f9d1-1f3fe':0, '1f9d1-1f3fd-200d-1f91d-200d-1f9d1-1f3ff':0, '1f9d1-1f3fe-200d-1f91d-200d-1f9d1-1f3fb':0, '1f9d1-1f3fe-200d-1f91d-200d-1f9d1-1f3fc':0, '1f9d1-1f3fe-200d-1f91d-200d-1f9d1-1f3fd':0, '1f9d1-1f3fe-200d-1f91d-200d-1f9d1-1f3fe':0, '1f9d1-1f3fe-200d-1f91d-200d-1f9d1-1f3ff':0, '1f9d1-1f3ff-200d-1f91d-200d-1f9d1-1f3fb':0, '1f9d1-1f3ff-200d-1f91d-200d-1f9d1-1f3fc':0, '1f9d1-1f3ff-200d-1f91d-200d-1f9d1-1f3fd':0, '1f9d1-1f3ff-200d-1f91d-200d-1f9d1-1f3fe':0, '1f9d1-1f3ff-200d-1f91d-200d-1f9d1-1f3ff':0, '1f9d1-1f3fb-200d-1f9af':0, '1f9d1-1f3fc-200d-1f9af':0, '1f9d1-1f3fd-200d-1f9af':0, '1f9d1-1f3fe-200d-1f9af':0, '1f9d1-1f3ff-200d-1f9af':0, '1f9d1-1f3fb-200d-1f9b0':0, '1f9d1-1f3fc-200d-1f9b0':0, '1f9d1-1f3fd-200d-1f9b0':0, '1f9d1-1f3fe-200d-1f9b0':0, '1f9d1-1f3ff-200d-1f9b0':0, '1f9d1-1f3fb-200d-1f9b1':0, '1f9d1-1f3fc-200d-1f9b1':0, '1f9d1-1f3fd-200d-1f9b1':0, '1f9d1-1f3fe-200d-1f9b1':0, '1f9d1-1f3ff-200d-1f9b1':0, '1f9d1-1f3fb-200d-1f9b2':0, '1f9d1-1f3fc-200d-1f9b2':0, '1f9d1-1f3fd-200d-1f9b2':0, '1f9d1-1f3fe-200d-1f9b2':0, '1f9d1-1f3ff-200d-1f9b2':0, '1f9d1-1f3fb-200d-1f9b3':0, '1f9d1-1f3fc-200d-1f9b3':0, '1f9d1-1f3fd-200d-1f9b3':0, '1f9d1-1f3fe-200d-1f9b3':0, '1f9d1-1f3ff-200d-1f9b3':0, '1f9d1-1f3fb-200d-1f9bc':0, '1f9d1-1f3fc-200d-1f9bc':0, '1f9d1-1f3fd-200d-1f9bc':0, '1f9d1-1f3fe-200d-1f9bc':0, '1f9d1-1f3ff-200d-1f9bc':0, '1f9d1-1f3fb-200d-1f9bd':0, '1f9d1-1f3fc-200d-1f9bd':0, '1f9d1-1f3fd-200d-1f9bd':0, '1f9d1-1f3fe-200d-1f9bd':0, '1f9d1-1f3ff-200d-1f9bd':0, '1f9d1-1f3fb-200d-2695':0, '1f9d1-1f3fc-200d-2695':0, '1f9d1-1f3fd-200d-2695':0, '1f9d1-1f3fe-200d-2695':0, '1f9d1-1f3ff-200d-2695':0, '1f9d1-1f3fb-200d-2696':0, '1f9d1-1f3fc-200d-2696':0, '1f9d1-1f3fd-200d-2696':0, '1f9d1-1f3fe-200d-2696':0, '1f9d1-1f3ff-200d-2696':0, '1f9d1-1f3fb-200d-2708':0, '1f9d1-1f3fc-200d-2708':0, '1f9d1-1f3fd-200d-2708':0, '1f9d1-1f3fe-200d-2708':0, '1f9d1-1f3ff-200d-2708':0, '1f9d1-1f3fb':0, '1f9d1-1f3fc':0, '1f9d1-1f3fd':0, '1f9d1-1f3fe':0, '1f9d1-1f3ff':0, '1f9d2-1f3fb':0, '1f9d2-1f3fc':0, '1f9d2-1f3fd':0, '1f9d2-1f3fe':0, '1f9d2-1f3ff':0, '1f9d3-1f3fb':0, '1f9d3-1f3fc':0, '1f9d3-1f3fd':0, '1f9d3-1f3fe':0, '1f9d3-1f3ff':0, '1f9d4-1f3fb-200d-2640':0, '1f9d4-1f3fc-200d-2640':0, '1f9d4-1f3fd-200d-2640':0, '1f9d4-1f3fe-200d-2640':0, '1f9d4-1f3ff-200d-2640':0, '1f9d4-1f3fb-200d-2642':0, '1f9d4-1f3fc-200d-2642':0, '1f9d4-1f3fd-200d-2642':0, '1f9d4-1f3fe-200d-2642':0, '1f9d4-1f3ff-200d-2642':0, '1f9d4-1f3fb':0, '1f9d4-1f3fc':0, '1f9d4-1f3fd':0, '1f9d4-1f3fe':0, '1f9d4-1f3ff':0, '1f9d5-1f3fb':0, '1f9d5-1f3fc':0, '1f9d5-1f3fd':0, '1f9d5-1f3fe':0, '1f9d5-1f3ff':0, '1f9d6-1f3fb-200d-2640':0, '1f9d6-1f3fc-200d-2640':0, '1f9d6-1f3fd-200d-2640':0, '1f9d6-1f3fe-200d-2640':0, '1f9d6-1f3ff-200d-2640':0, '1f9d6-1f3fb-200d-2642':0, '1f9d6-1f3fc-200d-2642':0, '1f9d6-1f3fd-200d-2642':0, '1f9d6-1f3fe-200d-2642':0, '1f9d6-1f3ff-200d-2642':0, '1f9d6-1f3fb':0, '1f9d6-1f3fc':0, '1f9d6-1f3fd':0, '1f9d6-1f3fe':0, '1f9d6-1f3ff':0, '1f9d7-1f3fb-200d-2640':0, '1f9d7-1f3fc-200d-2640':0, '1f9d7-1f3fd-200d-2640':0, '1f9d7-1f3fe-200d-2640':0, '1f9d7-1f3ff-200d-2640':0, '1f9d7-1f3fb-200d-2642':0, '1f9d7-1f3fc-200d-2642':0, '1f9d7-1f3fd-200d-2642':0, '1f9d7-1f3fe-200d-2642':0, '1f9d7-1f3ff-200d-2642':0, '1f9d7-1f3fb':0, '1f9d7-1f3fc':0, '1f9d7-1f3fd':0, '1f9d7-1f3fe':0, '1f9d7-1f3ff':0, '1f9d8-1f3fb-200d-2640':0, '1f9d8-1f3fc-200d-2640':0, '1f9d8-1f3fd-200d-2640':0, '1f9d8-1f3fe-200d-2640':0, '1f9d8-1f3ff-200d-2640':0, '1f9d8-1f3fb-200d-2642':0, '1f9d8-1f3fc-200d-2642':0, '1f9d8-1f3fd-200d-2642':0, '1f9d8-1f3fe-200d-2642':0, '1f9d8-1f3ff-200d-2642':0, '1f9d8-1f3fb':0, '1f9d8-1f3fc':0, '1f9d8-1f3fd':0, '1f9d8-1f3fe':0, '1f9d8-1f3ff':0, '1f9d9-1f3fb-200d-2640':0, '1f9d9-1f3fc-200d-2640':0, '1f9d9-1f3fd-200d-2640':0, '1f9d9-1f3fe-200d-2640':0, '1f9d9-1f3ff-200d-2640':0, '1f9d9-1f3fb-200d-2642':0, '1f9d9-1f3fc-200d-2642':0, '1f9d9-1f3fd-200d-2642':0, '1f9d9-1f3fe-200d-2642':0, '1f9d9-1f3ff-200d-2642':0, '1f9d9-1f3fb':0, '1f9d9-1f3fc':0, '1f9d9-1f3fd':0, '1f9d9-1f3fe':0, '1f9d9-1f3ff':0, '1f9da-1f3fb-200d-2640':0, '1f9da-1f3fc-200d-2640':0, '1f9da-1f3fd-200d-2640':0, '1f9da-1f3fe-200d-2640':0, '1f9da-1f3ff-200d-2640':0, '1f9da-1f3fb-200d-2642':0, '1f9da-1f3fc-200d-2642':0, '1f9da-1f3fd-200d-2642':0, '1f9da-1f3fe-200d-2642':0, '1f9da-1f3ff-200d-2642':0, '1f9da-1f3fb':0, '1f9da-1f3fc':0, '1f9da-1f3fd':0, '1f9da-1f3fe':0, '1f9da-1f3ff':0, '1f9db-1f3fb-200d-2640':0, '1f9db-1f3fc-200d-2640':0, '1f9db-1f3fd-200d-2640':0, '1f9db-1f3fe-200d-2640':0, '1f9db-1f3ff-200d-2640':0, '1f9db-1f3fb-200d-2642':0, '1f9db-1f3fc-200d-2642':0, '1f9db-1f3fd-200d-2642':0, '1f9db-1f3fe-200d-2642':0, '1f9db-1f3ff-200d-2642':0, '1f9db-1f3fb':0, '1f9db-1f3fc':0, '1f9db-1f3fd':0, '1f9db-1f3fe':0, '1f9db-1f3ff':0, '1f9dc-1f3fb-200d-2640':0, '1f9dc-1f3fc-200d-2640':0, '1f9dc-1f3fd-200d-2640':0, '1f9dc-1f3fe-200d-2640':0, '1f9dc-1f3ff-200d-2640':0, '1f9dc-1f3fb-200d-2642':0, '1f9dc-1f3fc-200d-2642':0, '1f9dc-1f3fd-200d-2642':0, '1f9dc-1f3fe-200d-2642':0, '1f9dc-1f3ff-200d-2642':0, '1f9dc-1f3fb':0, '1f9dc-1f3fc':0, '1f9dc-1f3fd':0, '1f9dc-1f3fe':0, '1f9dc-1f3ff':0, '1f9dd-1f3fb-200d-2640':0, '1f9dd-1f3fc-200d-2640':0, '1f9dd-1f3fd-200d-2640':0, '1f9dd-1f3fe-200d-2640':0, '1f9dd-1f3ff-200d-2640':0, '1f9dd-1f3fb-200d-2642':0, '1f9dd-1f3fc-200d-2642':0, '1f9dd-1f3fd-200d-2642':0, '1f9dd-1f3fe-200d-2642':0, '1f9dd-1f3ff-200d-2642':0, '1f9dd-1f3fb':0, '1f9dd-1f3fc':0, '1f9dd-1f3fd':0, '1f9dd-1f3fe':0, '1f9dd-1f3ff':0, '261d-1f3fb':0, '261d-1f3fc':0, '261d-1f3fd':0, '261d-1f3fe':0, '261d-1f3ff':0, '26f9-1f3fb-200d-2640':0, '26f9-1f3fc-200d-2640':0, '26f9-1f3fd-200d-2640':0, '26f9-1f3fe-200d-2640':0, '26f9-1f3ff-200d-2640':0, '26f9-1f3fb-200d-2642':0, '26f9-1f3fc-200d-2642':0, '26f9-1f3fd-200d-2642':0, '26f9-1f3fe-200d-2642':0, '26f9-1f3ff-200d-2642':0, '26f9-1f3fb':0, '26f9-1f3fc':0, '26f9-1f3fd':0, '26f9-1f3fe':0, '26f9-1f3ff':0, '270a-1f3fb':0, '270a-1f3fc':0, '270a-1f3fd':0, '270a-1f3fe':0, '270a-1f3ff':0, '270b-1f3fb':0, '270b-1f3fc':0, '270b-1f3fd':0, '270b-1f3fe':0, '270b-1f3ff':0, '270c-1f3fb':0, '270c-1f3fc':0, '270c-1f3fd':0, '270c-1f3fe':0, '270c-1f3ff':0, '270d-1f3fb':0, '270d-1f3fc':0, '270d-1f3fd':0, '270d-1f3fe':0, '270d-1f3ff':0}};\n\nconst Emoji: {[emoji: string]: number} = EmojiVersions[''];\nfor(const version in EmojiVersions) {\n  if(version) {\n    Object.assign(Emoji, EmojiVersions[version as EMOJI_VERSION]);\n  }\n}\n\nexport default Emoji;\n\n/* Emoji[\"00a9-fe0f\"] = 6362;\nEmoji[\"00ae-fe0f\"] = 6363;\nEmoji[\"2122-fe0f\"] = 6364; */\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nexport const FontFamily = 'Roboto, -apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, Oxygen-Sans, Ubuntu, Cantarell, \"Helvetica Neue\", sans-serif';\nexport const FontSize = '16px';\nexport const FontWeight = '400';\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\n// * Jolly Cobra's animation.ts\r\n\r\nimport {fastRaf} from './schedulers';\r\nimport deferredPromise, {CancellablePromise} from './cancellablePromise';\r\n\r\ninterface AnimationInstance {\r\n  isCancelled: boolean;\r\n  deferred: CancellablePromise<void>\r\n}\r\n\r\ntype AnimationInstanceKey = any;\r\nconst instances: Map<AnimationInstanceKey, AnimationInstance> = new Map();\r\n\r\nexport function createAnimationInstance(key: AnimationInstanceKey) {\r\n  cancelAnimationByKey(key);\r\n\r\n  const instance: AnimationInstance = {\r\n    isCancelled: false,\r\n    deferred: deferredPromise<void>()\r\n  };\r\n\r\n  instances.set(key, instance);\r\n  instance.deferred.then(() => {\r\n    if(getAnimationInstance(key) === instance) {\r\n      instances.delete(key);\r\n    }\r\n  });\r\n\r\n  return instance;\r\n}\r\n\r\nexport function getAnimationInstance(key: AnimationInstanceKey) {\r\n  return instances.get(key);\r\n}\r\n\r\nexport function cancelAnimationByKey(key: AnimationInstanceKey) {\r\n  const instance = getAnimationInstance(key);\r\n  if(instance) {\r\n    instance.isCancelled = true;\r\n    instance.deferred.resolve();\r\n  }\r\n}\r\n\r\nexport function animateSingle(tick: Function, key: AnimationInstanceKey, instance?: AnimationInstance) {\r\n  if(!instance) {\r\n    instance = createAnimationInstance(key);\r\n  }\r\n\r\n  fastRaf(() => {\r\n    if(instance.isCancelled) {\r\n      return;\r\n    }\r\n\r\n    if(tick()) {\r\n      animateSingle(tick, key, instance);\r\n    } else {\r\n      instance.deferred.resolve();\r\n    }\r\n  });\r\n\r\n  return instance.deferred;\r\n}\r\n\r\nexport function animate(tick: Function) {\r\n  fastRaf(() => {\r\n    if(tick()) {\r\n      animate(tick);\r\n    }\r\n  });\r\n}\r\n","export default function accumulate(arr: number[], initialValue: number) {\n  return arr.reduce((acc, value) => acc + value, initialValue);\n}\n","type K = boolean;\nexport default async function filterAsync<T>(arr: T[], callback: (item: T, idx: number, arr: T[]) => Promise<K> | K) {\n  const promises = arr.map(async(item, idx, arr) => {\n    if(await callback(item, idx, arr)) {\n      return item;\n    }\n  });\n\n  return (await Promise.all(promises)).filter(Boolean);\n}\n","export default function findAndSpliceAll<T>(array: Array<T>, verify: (value: T, index: number, arr: typeof array) => boolean) {\n  const out: typeof array = [];\n  let idx = -1;\n  while((idx = array.findIndex(verify)) !== -1) {\n    out.push(array.splice(idx, 1)[0]);\n  }\n\n  return out;\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nconst ASSETS_PATH = 'assets/audio/';\n\nexport default class AudioAssetPlayer<AssetName extends string> {\n  private audio: HTMLAudioElement;\n  private tempId: number;\n  private assetName: AssetName;\n\n  constructor(private assets: AssetName[]) {\n    this.tempId = 0;\n  }\n\n  public playSound(name: AssetName, loop = false) {\n    ++this.tempId;\n    this.assetName = name;\n\n    try {\n      const audio = this.createAudio();\n      audio.autoplay = true;\n      audio.src = ASSETS_PATH + name;\n      audio.loop = loop;\n      audio.play();\n    } catch(e) {\n      console.error('playSound', name, e);\n    }\n  }\n\n  public playSoundIfDifferent(name: AssetName, loop?: boolean) {\n    if(this.assetName !== name) {\n      this.playSound(name, loop);\n    }\n  }\n\n  public createAudio() {\n    let {audio} = this;\n    if(audio) {\n      return audio;\n    }\n\n    audio = this.audio = new Audio();\n    audio.play();\n    return audio;\n  }\n\n  public stopSound() {\n    if(!this.audio) {\n      return;\n    }\n\n    this.audio.pause();\n  }\n\n  public cancelDelayedPlay() {\n    ++this.tempId;\n  }\n\n  public playSoundWithTimeout(name: AssetName, loop: boolean, timeout: number) {\n    // timeout = 0;\n    const tempId = ++this.tempId;\n    setTimeout(() => {\n      if(this.tempId !== tempId) {\n        return;\n      }\n\n      this.playSound(name, loop);\n    }, timeout);\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport readBlobAs from './readBlobAs';\n\nexport default function readBlobAsDataURL(blob: Blob) {\n  return readBlobAs(blob, 'readAsDataURL');\n}\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport deferredPromise, {CancellablePromise} from './cancellablePromise';\r\nimport {getHeavyAnimationPromise} from '../hooks/useHeavyAnimationCheck';\r\nimport {fastRaf} from './schedulers';\r\nimport {ArgumentTypes} from '../types';\r\n\r\ntype HeavyQueue<T extends HeavyQueue<any>> = {\r\n  items: ArgumentTypes<T['process']>[],\r\n  process: (...args: any[]) => ReturnType<T['process']>,\r\n  context: any,\r\n  promise?: CancellablePromise<ReturnType<T['process']>[]>\r\n};\r\nconst heavyQueue: HeavyQueue<any>[] = [];\r\nlet processingQueue = false;\r\n\r\nexport default function addHeavyTask<T extends HeavyQueue<T>>(queue: T, method: 'push' | 'unshift' = 'push') {\r\n  if(!queue.items.length) {\r\n    return Promise.resolve([]) as typeof promise;\r\n  }\r\n\r\n  const promise = queue.promise = deferredPromise();\r\n  heavyQueue[method](queue);\r\n  processHeavyQueue();\r\n\r\n  return promise;\r\n}\r\n\r\nfunction processHeavyQueue() {\r\n  if(!processingQueue) {\r\n    const queue = heavyQueue.shift();\r\n    timedChunk(queue).finally(() => {\r\n      processingQueue = false;\r\n      if(heavyQueue.length) {\r\n        processHeavyQueue();\r\n      }\r\n    });\r\n  }\r\n}\r\n\r\nfunction timedChunk<T extends HeavyQueue<T>>(queue: HeavyQueue<T>) {\r\n  if(!queue.items.length) {\r\n    queue.promise.resolve([] as any);\r\n    return Promise.resolve([]);\r\n  }\r\n\r\n  const todo = queue.items.slice();\r\n  const results: ReturnType<T['process']>[] = [];\r\n\r\n  return new Promise<typeof results>((resolve, reject) => {\r\n    const f = async() => {\r\n      const start = performance.now();\r\n\r\n      do {\r\n        await getHeavyAnimationPromise();\r\n        const possiblePromise = queue.process.apply(queue.context, todo.shift());\r\n        let realResult: typeof results[0];\r\n        // @ts-ignore\r\n        if(possiblePromise instanceof Promise) {\r\n          try {\r\n            realResult = await possiblePromise;\r\n          } catch(err) {\r\n            reject(err);\r\n            return;\r\n          }\r\n        } else {\r\n          realResult = possiblePromise;\r\n        }\r\n\r\n        results.push(realResult);\r\n      } while(todo.length > 0 && (performance.now() - start) < 6);\r\n\r\n      if(todo.length > 0) {\r\n        fastRaf(f);\r\n        // setTimeout(f, 25);\r\n      } else {\r\n        resolve(results);\r\n      }\r\n    };\r\n\r\n    fastRaf(f);\r\n    // setTimeout(f, 25);\r\n  }).then(queue.promise.resolve, queue.promise.reject);\r\n}\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport type fastBlur from '../vendor/fastBlur';\r\nimport addHeavyTask from './heavyQueue';\r\nimport IS_CANVAS_FILTER_SUPPORTED from '../environment/canvasFilterSupport';\r\n\r\nconst RADIUS = 2;\r\nconst ITERATIONS = 2;\r\n\r\nlet requireBlurPromise: Promise<any>;\r\nlet fastBlurFunc: typeof fastBlur;\r\nif(!IS_CANVAS_FILTER_SUPPORTED) {\r\n  requireBlurPromise = import('../vendor/fastBlur').then((m) => {\r\n    fastBlurFunc = m.default;\r\n  });\r\n} else {\r\n  requireBlurPromise = Promise.resolve();\r\n}\r\n\r\nfunction processBlurNext(\r\n  img: HTMLImageElement,\r\n  radius: number,\r\n  iterations: number,\r\n  canvas: HTMLCanvasElement = document.createElement('canvas')\r\n) {\r\n  canvas.width = img.width;\r\n  canvas.height = img.height;\r\n\r\n  const ctx = canvas.getContext('2d', {alpha: false});\r\n  if(IS_CANVAS_FILTER_SUPPORTED) {\r\n    ctx.filter = `blur(${radius}px)`;\r\n    ctx.drawImage(img, -radius * 2, -radius * 2, canvas.width + radius * 4, canvas.height + radius * 4);\r\n  } else {\r\n    ctx.drawImage(img, 0, 0);\r\n    fastBlurFunc(ctx, 0, 0, canvas.width, canvas.height, radius, iterations);\r\n  }\r\n\r\n  return canvas;\r\n}\r\n\r\ntype CacheValue = {canvas: HTMLCanvasElement, promise: Promise<void>};\r\nconst cache: Map<string, CacheValue> = new Map();\r\nconst CACHE_SIZE = 150;\r\n\r\nexport default function blur(dataUri: string, radius: number = RADIUS, iterations: number = ITERATIONS) {\r\n  if(!dataUri) {\r\n    throw 'no dataUri for blur: ' + dataUri;\r\n  }\r\n\r\n  if(cache.size > CACHE_SIZE) {\r\n    cache.clear();\r\n  }\r\n\r\n  const canvas = document.createElement('canvas');\r\n  canvas.className = 'canvas-thumbnail';\r\n\r\n  let cached = cache.get(dataUri);\r\n  if(!cached) {\r\n    const promise: CacheValue['promise'] = new Promise((resolve) => {\r\n      // return resolve(dataUri);\r\n      requireBlurPromise.then(() => {\r\n        const img = new Image();\r\n        img.onload = () => {\r\n          // if(IS_CANVAS_FILTER_SUPPORTED) {\r\n          // resolve(processBlurNext(img, radius, iterations));\r\n          // } else {\r\n          const promise = addHeavyTask({\r\n            items: [[img, radius, iterations, canvas]],\r\n            context: null,\r\n            process: processBlurNext\r\n          }, 'unshift');\r\n\r\n          promise.then(() => {\r\n            resolve();\r\n          });\r\n          // }\r\n        };\r\n        img.src = dataUri;\r\n      });\r\n    });\r\n\r\n    cache.set(dataUri, cached = {\r\n      canvas,\r\n      promise\r\n    });\r\n  } else {\r\n    canvas.width = cached.canvas.width;\r\n    canvas.height = cached.canvas.height;\r\n    cached.promise.then(() => {\r\n      canvas.getContext('2d').drawImage(cached.canvas, 0, 0, canvas.width, canvas.height);\r\n    });\r\n  }\r\n\r\n  return {\r\n    ...cached,\r\n    canvas\r\n  };\r\n}\r\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport {IS_SAFARI} from '../../environment/userAgent';\nimport bytesFromHex from './bytesFromHex';\nimport bytesToDataURL from './bytesToDataURL';\n\nconst JPEG_HEADER = bytesFromHex('ffd8ffe000104a46494600010100000100010000ffdb004300281c1e231e19282321232d2b28303c64413c37373c7b585d4964918099968f808c8aa0b4e6c3a0aadaad8a8cc8ffcbdaeef5ffffff9bc1fffffffaffe6fdfff8ffdb0043012b2d2d3c353c76414176f8a58ca5f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8ffc00011080000000003012200021101031101ffc4001f0000010501010101010100000000000000000102030405060708090a0bffc400b5100002010303020403050504040000017d01020300041105122131410613516107227114328191a1082342b1c11552d1f02433627282090a161718191a25262728292a3435363738393a434445464748494a535455565758595a636465666768696a737475767778797a838485868788898a92939495969798999aa2a3a4a5a6a7a8a9aab2b3b4b5b6b7b8b9bac2c3c4c5c6c7c8c9cad2d3d4d5d6d7d8d9dae1e2e3e4e5e6e7e8e9eaf1f2f3f4f5f6f7f8f9faffc4001f0100030101010101010101010000000000000102030405060708090a0bffc400b51100020102040403040705040400010277000102031104052131061241510761711322328108144291a1b1c109233352f0156272d10a162434e125f11718191a262728292a35363738393a434445464748494a535455565758595a636465666768696a737475767778797a82838485868788898a92939495969798999aa2a3a4a5a6a7a8a9aab2b3b4b5b6b7b8b9bac2c3c4c5c6c7c8c9cad2d3d4d5d6d7d8d9dae2e3e4e5e6e7e8e9eaf2f3f4f5f6f7f8f9faffda000c03010002110311003f00');\nconst JPEG_TAIL = bytesFromHex('ffd9');\n\nexport default function getPreviewURLFromBytes(bytes: Uint8Array | number[], isSticker = false) {\n  let arr: Uint8Array;\n  if(!isSticker) {\n    arr = new Uint8Array(JPEG_HEADER.concat(Array.from(bytes.slice(3)), JPEG_TAIL));\n    arr[164] = bytes[1];\n    arr[166] = bytes[2];\n  } else {\n    arr = bytes instanceof Uint8Array ? bytes : new Uint8Array(bytes);\n  }\n\n  let mimeType: string;\n  if(isSticker) {\n    mimeType = IS_SAFARI ? 'image/png' : 'image/webp';\n  } else {\n    mimeType = 'image/jpeg';\n  }\n\n  return bytesToDataURL(arr, mimeType);\n}\n","export default function bytesToDataURL(bytes: Uint8Array, mimeType: string = 'image/jpeg') {\n  return `data:${mimeType};base64,${btoa(String.fromCharCode(...bytes))}`;\n}\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n *\r\n * Originally from:\r\n * https://github.com/zhukov/webogram\r\n * Copyright (C) 2014 Igor Zhukov <igor.beatle@gmail.com>\r\n * https://github.com/zhukov/webogram/blob/master/LICENSE\r\n */\r\n\r\nimport {MOUNT_CLASS_TO} from '../config/debug';\r\nimport {makeMediaSize} from './mediaSize';\r\n\r\nexport default function calcImageInBox(imageW: number, imageH: number, boxW: number, boxH: number, noZoom = true) {\r\n  if(imageW < boxW && imageH < boxH && noZoom) {\r\n    return makeMediaSize(imageW, imageH);\r\n  }\r\n\r\n  let boxedImageW = boxW;\r\n  let boxedImageH = boxH;\r\n\r\n  if((imageW / imageH) > (boxW / boxH)) {\r\n    boxedImageH = (imageH * boxW / imageW) | 0;\r\n  } else {\r\n    boxedImageW = (imageW * boxH / imageH) | 0;\r\n    if(boxedImageW > boxW) {\r\n      boxedImageH = (boxedImageH * boxW / boxedImageW) | 0;\r\n      boxedImageW = boxW;\r\n    }\r\n  }\r\n\r\n  // if (Config.Navigator.retina) {\r\n  //   imageW = Math.floor(imageW / 2)\r\n  //   imageH = Math.floor(imageH / 2)\r\n  // }\r\n\r\n  if(noZoom && boxedImageW >= imageW && boxedImageH >= imageH) {\r\n    boxedImageW = imageW;\r\n    boxedImageH = imageH;\r\n  }\r\n\r\n  return makeMediaSize(boxedImageW, boxedImageH);\r\n}\r\n\r\nMOUNT_CLASS_TO.calcImageInBox = calcImageInBox;\r\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\n// import { MOUNT_CLASS_TO } from \"../../config/debug\";\n\nlet context: CanvasRenderingContext2D;\n/**\n * Get the text width\n * @param {string} text\n * @param {string} font\n */\nexport default function getTextWidth(text: string, font: string) {\n  // const perf = performance.now();\n  if(!context) {\n    const canvas = document.createElement('canvas');\n    context = canvas.getContext('2d', {alpha: false});\n    context.font = font;\n  }\n\n  // context.font = font;\n  const metrics = context.measureText(text);\n  // console.log('getTextWidth perf:', performance.now() - perf);\n  return metrics.width;\n  // return Math.round(metrics.width);\n}\n\n// MOUNT_CLASS_TO && (MOUNT_CLASS_TO.getTextWidth = getTextWidth);\n","import type {MediaSize} from '../mediaSize';\n\nexport default function scaleMediaElement(options: {\n  media: CanvasImageSource,\n  mediaSize?: MediaSize,\n  boxSize?: MediaSize,\n  quality?: number,\n  mimeType?: 'image/jpeg' | 'image/png',\n  size?: MediaSize\n}): Promise<{blob: Blob, size: MediaSize}> {\n  return new Promise((resolve) => {\n    const canvas = document.createElement('canvas');\n    const size = options.size ?? options.mediaSize.aspectFitted(options.boxSize);\n    canvas.width = size.width * window.devicePixelRatio;\n    canvas.height = size.height * window.devicePixelRatio;\n    const ctx = canvas.getContext('2d');\n    ctx.drawImage(options.media, 0, 0, canvas.width, canvas.height);\n    canvas.toBlob((blob) => {\n      resolve({blob, size});\n    }, options.mimeType ?? 'image/jpeg', options.quality ?? 1);\n  });\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n *\n * Originally from:\n * https://github.com/zhukov/webogram\n * Copyright (C) 2014 Igor Zhukov <igor.beatle@gmail.com>\n * https://github.com/zhukov/webogram/blob/master/LICENSE\n */\n\nimport LatinizeMap from '../config/latinizeMap';\n\nexport const badCharsRe = /[`~!@#$%^&*()\\-_=+\\[\\]\\\\|{}'\";:\\/?.>,<]+/g;\nconst trimRe = /^\\s+|\\s$/g;\n\nconst C2L: {[k: string]: string} = {\n  '': 'q',\n  '': 'w',\n  '': 'e',\n  '': 'r',\n  '': 't',\n  '': 'y',\n  '': 'u',\n  '': 'i',\n  '': 'o',\n  '': 'p',\n  '': '[',\n  '': ']',\n  '': 'a',\n  '': 's',\n  '': 'd',\n  '': 'f',\n  '': 'g',\n  '': 'h',\n  '': 'j',\n  '': 'k',\n  '': 'l',\n  '': ';',\n  '': '\\'',\n  '': 'z',\n  '': 'x',\n  '': 'c',\n  '': 'v',\n  '': 'b',\n  '': 'n',\n  '': 'm',\n  '': ',',\n  '': '.',\n  '.': '/'\n};\n\nexport function clearBadCharsAndTrim(text: string) {\n  return text.replace(badCharsRe, '').replace(trimRe, '');\n}\n\nexport function fixCyrillic(text: string) {\n  return text.toLowerCase().replace(/[\\w-]/g, (ch) => {\n    const latinizeCh = C2L[ch];\n    return latinizeCh ?? ch;\n  });\n}\n\nexport function latinizeString(text: string) {\n  return text.replace(/[^A-Za-z0-9]/g, (ch) => {\n    const latinizeCh = LatinizeMap[ch];\n    return latinizeCh ?? ch;\n  });\n}\n\nexport default function cleanSearchText(text: string, latinize = true) {\n  return processSearchText(text, {\n    clearBadChars: true,\n    latinize,\n    ignoreCase: true\n  });\n}\n\nexport type ProcessSearchTextOptions = Partial<{\n  clearBadChars: boolean,\n  latinize: boolean,\n  ignoreCase: boolean,\n  includeTag: boolean\n}>;\n\nexport function processSearchText(text: string, options: ProcessSearchTextOptions = {}) {\n  const hasTag = options.includeTag && text.charAt(0) === '%';\n  const originalText = text;\n  if(options.clearBadChars) text = clearBadCharsAndTrim(text);\n  if(options.latinize) text = latinizeString(text);\n  if(options.ignoreCase) text = text.toLowerCase();\n  if(hasTag) text = '%' + text;\n  if(options.latinize) text += '\\x01' + fixCyrillic(originalText);\n  return text;\n}\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\n// https://stackoverflow.com/a/30810322\r\nfunction fallbackCopyTextToClipboard(text: string) {\r\n  var textArea = document.createElement('textarea');\r\n  textArea.value = text;\r\n\r\n  // Avoid scrolling to bottom\r\n  textArea.style.top = '0';\r\n  textArea.style.left = '0';\r\n  textArea.style.position = 'fixed';\r\n\r\n  document.body.appendChild(textArea);\r\n  textArea.focus();\r\n  textArea.select();\r\n\r\n  try {\r\n    document.execCommand('copy');\r\n    // const successful = document.execCommand('copy');\r\n    // const msg = successful ? 'successful' : 'unsuccessful';\r\n    // console.log('Fallback: Copying text command was ' + msg);\r\n  } catch(err) {\r\n    // console.error('Fallback: Oops, unable to copy', err);\r\n  }\r\n\r\n  document.body.removeChild(textArea);\r\n}\r\n\r\nexport function copyTextToClipboard(text: string) {\r\n  if(!navigator.clipboard) {\r\n    fallbackCopyTextToClipboard(text);\r\n    return;\r\n  }\r\n\r\n  navigator.clipboard.writeText(text);/* .then(function() {\r\n    console.log('Async: Copying to clipboard was successful!');\r\n  }, function(err) {\r\n    console.error('Async: Could not copy text: ', err);\r\n  }); */\r\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport IS_TOUCH_SUPPORTED from '../environment/touchSupport';\nimport mediaSizes from './mediaSizes';\nimport OverlayClickHandler from './overlayClickHandler';\n\nclass ContextMenuController extends OverlayClickHandler {\n  constructor() {\n    super('menu', true);\n\n    mediaSizes.addEventListener('resize', () => {\n      if(this.element) {\n        this.close();\n      }\n\n      /* if(openedMenu && (openedMenu.style.top || openedMenu.style.left)) {\n        const rect = openedMenu.getBoundingClientRect();\n        const {innerWidth, innerHeight} = window;\n\n        console.log(innerWidth, innerHeight, rect);\n      } */\n    });\n  }\n\n  public isOpened() {\n    return !!this.element;\n  }\n\n  private onMouseMove = (e: MouseEvent) => {\n    const rect = this.element.getBoundingClientRect();\n    const {clientX, clientY} = e;\n\n    const diffX = clientX >= rect.right ? clientX - rect.right : rect.left - clientX;\n    const diffY = clientY >= rect.bottom ? clientY - rect.bottom : rect.top - clientY;\n\n    if(diffX >= 100 || diffY >= 100) {\n      this.close();\n      // openedMenu.parentElement.click();\n    }\n    // console.log('mousemove', diffX, diffY);\n  };\n\n  public close() {\n    if(this.element) {\n      this.element.classList.remove('active');\n      this.element.parentElement.classList.remove('menu-open');\n    }\n\n    super.close();\n\n    if(!IS_TOUCH_SUPPORTED) {\n      window.removeEventListener('mousemove', this.onMouseMove);\n    }\n  }\n\n  public openBtnMenu(element: HTMLElement, onClose?: () => void) {\n    super.open(element);\n\n    this.element.classList.add('active');\n    this.element.parentElement.classList.add('menu-open');\n\n    if(onClose) {\n      this.addEventListener('toggle', onClose, {once: true});\n    }\n\n    if(!IS_TOUCH_SUPPORTED) {\n      window.addEventListener('mousemove', this.onMouseMove);\n    }\n  }\n}\n\nconst contextMenuController = new ContextMenuController();\nexport default contextMenuController;\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport {MOUNT_CLASS_TO} from '../config/debug';\r\nimport I18n, {i18n} from '../lib/langPack';\r\n\r\nexport const months = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'];\r\nexport const days = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];\r\n\r\nexport const ONE_DAY = 86400;\r\n\r\n// https://stackoverflow.com/a/6117889\r\nexport const getWeekNumber = (date: Date) => {\r\n  const d = new Date(Date.UTC(date.getFullYear(), date.getMonth(), date.getDate()));\r\n  const dayNum = d.getUTCDay() || 7;\r\n  d.setUTCDate(d.getUTCDate() + 4 - dayNum);\r\n  const yearStart = new Date(Date.UTC(d.getUTCFullYear(), 0, 1));\r\n  return Math.ceil((((d.getTime() - yearStart.getTime()) / ONE_DAY) + 1) / 7);\r\n};\r\n\r\nexport function formatDateAccordingToTodayNew(time: Date) {\r\n  const today = new Date();\r\n  const now = today.getTime() / 1000 | 0;\r\n  const timestamp = time.getTime() / 1000 | 0;\r\n\r\n  const options: Intl.DateTimeFormatOptions = {};\r\n  if((now - timestamp) < ONE_DAY && today.getDate() === time.getDate()) { // if the same day\r\n    options.hour = options.minute = '2-digit';\r\n  } else if(today.getFullYear() !== time.getFullYear()) { // different year\r\n    options.year = options.day = 'numeric';\r\n    options.month = '2-digit';\r\n  } else if((now - timestamp) < (ONE_DAY * 7) && getWeekNumber(today) === getWeekNumber(time)) { // current week\r\n    options.weekday = 'short';\r\n  } else { // same year\r\n    options.month = 'short';\r\n    options.day = 'numeric';\r\n  }\r\n\r\n  return new I18n.IntlDateElement({\r\n    date: time,\r\n    options\r\n  }).element;\r\n}\r\n\r\nexport function formatFullSentTimeRaw(timestamp: number, options: {\r\n  capitalize?: boolean\r\n} = {}) {\r\n  const date = new Date();\r\n  const time = new Date(timestamp * 1000);\r\n  const now = date.getTime() / 1000;\r\n\r\n  const timeEl = formatTime(time);\r\n\r\n  let dateEl: Node | string;\r\n  if((now - timestamp) < ONE_DAY && date.getDate() === time.getDate()) { // if the same day\r\n    dateEl = i18n(options.capitalize ? 'Date.Today' : 'Peer.Status.Today');\r\n  } else if((now - timestamp) < (ONE_DAY * 2) && (date.getDate() - 1) === time.getDate()) { // yesterday\r\n    dateEl = i18n(options.capitalize ? 'Yesterday' : 'Peer.Status.Yesterday');\r\n\r\n    if(options.capitalize) {\r\n      (dateEl as HTMLElement).style.textTransform = 'capitalize';\r\n    }\r\n  } else if(date.getFullYear() !== time.getFullYear()) { // different year\r\n    dateEl = new I18n.IntlDateElement({\r\n      date: time,\r\n      options: {\r\n        month: 'short',\r\n        day: 'numeric',\r\n        year: 'numeric'\r\n      }\r\n    }).element;\r\n    // dateStr = months[time.getMonth()].slice(0, 3) + ' ' + time.getDate() + ', ' + time.getFullYear();\r\n  } else {\r\n    dateEl = new I18n.IntlDateElement({\r\n      date: time,\r\n      options: {\r\n        month: 'short',\r\n        day: 'numeric'\r\n      }\r\n    }).element;\r\n    // dateStr = months[time.getMonth()].slice(0, 3) + ' ' + time.getDate();\r\n  }\r\n\r\n  return {dateEl, timeEl};\r\n}\r\n\r\nexport function formatFullSentTime(timestamp: number) {\r\n  const {dateEl, timeEl} = formatFullSentTimeRaw(timestamp, {\r\n    capitalize: true\r\n  });\r\n\r\n  const fragment = document.createDocumentFragment();\r\n  fragment.append(dateEl, ' ', i18n('ScheduleController.at'), ' ', timeEl);\r\n  return fragment;\r\n}\r\n\r\nexport function formatTime(date: Date) {\r\n  return new I18n.IntlDateElement({\r\n    date,\r\n    options: {\r\n      hour: '2-digit',\r\n      minute: '2-digit'\r\n    }\r\n  }).element;\r\n}\r\n\r\nMOUNT_CLASS_TO && (MOUNT_CLASS_TO.formatDateAccordingToTodayNew = formatDateAccordingToTodayNew);\r\n\r\nexport const getFullDate = (date: Date, options: Partial<{\r\n  noTime: true,\r\n  noSeconds: true,\r\n  monthAsNumber: true,\r\n  leadingZero: true\r\n}> = {}) => {\r\n  const joiner = options.monthAsNumber ? '.' : ' ';\r\n  const time = ('0' + date.getHours()).slice(-2) + ':' + ('0' + date.getMinutes()).slice(-2) + (options.noSeconds ? '' : ':' + ('0' + date.getSeconds()).slice(-2));\r\n\r\n  return (options.leadingZero ? ('0' + date.getDate()).slice(-2) : date.getDate()) +\r\n    joiner + (options.monthAsNumber ? ('0' + (date.getMonth() + 1)).slice(-2) : months[date.getMonth()]) +\r\n    joiner + date.getFullYear() +\r\n    (options.noTime ? '' : ', ' + time);\r\n};\r\n\r\n// https://github.com/DrKLO/Telegram/blob/d52b2c921abd3c1e8d6368858313ad0cb0468c07/TMessagesProj/src/main/java/org/telegram/ui/Adapters/FiltersView.java\r\nconst minYear = 2013;\r\nconst yearPattern = new RegExp('20[0-9]{1,2}');\r\nconst monthYearOrDayPattern = new RegExp('(\\\\w{3,}) ([0-9]{0,4})', 'i');\r\nconst yearOrDayAndMonthPattern = new RegExp('([0-9]{0,4}) (\\\\w{2,})', 'i');\r\nconst shortDate = new RegExp('^([0-9]{1,4})(\\\\.| |/|\\\\-)([0-9]{1,4})$', 'i');\r\nconst longDate = new RegExp('^([0-9]{1,2})(\\\\.| |/|\\\\-)([0-9]{1,2})(\\\\.| |/|\\\\-)([0-9]{1,4})$', 'i');\r\nconst numberOfDaysEachMonth = [31, 29, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31];\r\nexport type DateData = {\r\n  title: string,\r\n  minDate: number,\r\n  maxDate: number,\r\n};\r\nexport function fillTipDates(query: string, dates: DateData[]) {\r\n  const q = query.trim().toLowerCase();\r\n\r\n  if(q.length < 3) {\r\n    return;\r\n  }\r\n\r\n  if('today'.indexOf(q) === 0) {\r\n    const date = new Date();\r\n    const year = date.getFullYear();\r\n    const month = date.getMonth();\r\n    const day = date.getDate();\r\n    date.setFullYear(year, month, day);\r\n    date.setHours(0, 0, 0);\r\n\r\n    const minDate = date.getTime();\r\n    date.setFullYear(year, month, day + 1);\r\n    date.setHours(0, 0, 0);\r\n\r\n    const maxDate = date.getTime() - 1;\r\n    dates.push({\r\n      title: 'Today',\r\n      minDate,\r\n      maxDate\r\n    });\r\n    return;\r\n  }\r\n\r\n  if('yesterday'.indexOf(q) === 0) {\r\n    const date = new Date();\r\n    const year = date.getFullYear();\r\n    const month = date.getMonth();\r\n    const day = date.getDate();\r\n    date.setFullYear(year, month, day);\r\n    date.setHours(0, 0, 0);\r\n\r\n    const minDate = date.getTime() - 86400000;\r\n    date.setFullYear(year, month, day + 1);\r\n    date.setHours(0, 0, 0);\r\n\r\n    const maxDate = date.getTime() - 86400001;\r\n    dates.push({\r\n      title: 'Yesterday',\r\n      minDate,\r\n      maxDate\r\n    });\r\n    return;\r\n  }\r\n\r\n  const dayOfWeek = getDayOfWeek(q);\r\n  if(dayOfWeek >= 0) {\r\n    const date = new Date();\r\n    const now = date.getTime();\r\n    const currentDay = date.getDay();\r\n    const distance = dayOfWeek - currentDay;\r\n    date.setDate(date.getDate() + distance);\r\n    if(date.getTime() > now) {\r\n      date.setTime(date.getTime() - 604800000);\r\n    }\r\n    const year = date.getFullYear()\r\n    const month = date.getMonth();\r\n    const day = date.getDate();\r\n    date.setFullYear(year, month, day);\r\n    date.setHours(0, 0, 0);\r\n\r\n    const minDate = date.getTime();\r\n    date.setFullYear(year, month, day + 1);\r\n    date.setHours(0, 0, 0);\r\n\r\n    const maxDate = date.getTime() - 1;\r\n    dates.push({\r\n      title: formatWeekLong(minDate),\r\n      minDate,\r\n      maxDate\r\n    });\r\n    return;\r\n  }\r\n\r\n  let matches: any[];\r\n  if((matches = shortDate.exec(q)) !== null) {\r\n    const g1 = matches[1];\r\n    const g2 = matches[3];\r\n    const k = parseInt(g1);\r\n    const k1 = parseInt(g2);\r\n    if(k > 0 && k <= 31) {\r\n      if(k1 >= minYear && k <= 12) {\r\n        const selectedYear = k1;\r\n        const month = k - 1;\r\n        createForMonthYear(dates, month, selectedYear);\r\n        return;\r\n      } else if(k1 <= 12) {\r\n        const day = k - 1;\r\n        const month = k1 - 1;\r\n        createForDayMonth(dates, day, month);\r\n      }\r\n    } else if(k >= minYear && k1 <= 12) {\r\n      const selectedYear = k;\r\n      const month = k1 - 1;\r\n      createForMonthYear(dates, month, selectedYear);\r\n    }\r\n\r\n    return;\r\n  }\r\n\r\n  if((matches = longDate.exec(q)) !== null) {\r\n    const g1 = matches[1];\r\n    const g2 = matches[3];\r\n    const g3 = matches[5];\r\n    if(!matches[2] === matches[4]) {\r\n      return;\r\n    }\r\n\r\n    const day = parseInt(g1);\r\n    const month = parseInt(g2) - 1;\r\n    let year = parseInt(g3);\r\n    if(year >= 10 && year <= 99) {\r\n      year += 2000;\r\n    }\r\n\r\n    const currentYear = new Date().getFullYear();\r\n    if(validDateForMonth(day - 1, month) && year >= minYear && year <= currentYear) {\r\n      const date = new Date();\r\n      date.setFullYear(year, month, day);\r\n      date.setHours(0, 0, 0);\r\n\r\n      const minDate = date.getTime();\r\n      date.setFullYear(year, month, day + 1);\r\n      date.setHours(0, 0, 0);\r\n\r\n      const maxDate = date.getTime() - 1;\r\n      dates.push({\r\n        title: formatterYearMax(minDate),\r\n        minDate,\r\n        maxDate\r\n      });\r\n      return;\r\n    }\r\n\r\n    return;\r\n  }\r\n\r\n  if((matches = yearPattern.exec(q)) !== null) {\r\n    let selectedYear = +q;\r\n    const currentYear = new Date().getFullYear();\r\n    if(selectedYear < minYear) {\r\n      selectedYear = minYear;\r\n      for(let i = currentYear; i >= selectedYear; i--) {\r\n        const date = new Date();\r\n        date.setFullYear(i, 0, 1);\r\n        date.setHours(0, 0, 0);\r\n\r\n        const minDate = date.getTime();\r\n        date.setFullYear(i + 1, 0, 1);\r\n        date.setHours(0, 0, 0);\r\n\r\n        const maxDate = date.getTime() - 1;\r\n        dates.push({\r\n          title: '' + i,\r\n          minDate,\r\n          maxDate\r\n        });\r\n      }\r\n    } else if(selectedYear <= currentYear) {\r\n      const date = new Date();\r\n      date.setFullYear(selectedYear, 0, 1);\r\n      date.setHours(0, 0, 0);\r\n\r\n      const minDate = date.getTime();\r\n      date.setFullYear(selectedYear + 1, 0, 1);\r\n      date.setHours(0, 0, 0);\r\n\r\n      const maxDate = date.getTime() - 1;\r\n      dates.push({\r\n        title: '' + selectedYear,\r\n        minDate,\r\n        maxDate\r\n      });\r\n    }\r\n\r\n    return;\r\n  }\r\n\r\n  if((matches = monthYearOrDayPattern.exec(q)) !== null) {\r\n    const g1 = matches[1];\r\n    const g2 = matches[2];\r\n    const month = getMonth(g1);\r\n    if(month >= 0) {\r\n      const k = +g2;\r\n      if(k > 0 && k <= 31) {\r\n        const day = k - 1;\r\n        createForDayMonth(dates, day, month);\r\n        return;\r\n      } else if(k >= minYear) {\r\n        const selectedYear = k;\r\n        createForMonthYear(dates, month, selectedYear);\r\n        return;\r\n      }\r\n    }\r\n  }\r\n\r\n  if((matches = yearOrDayAndMonthPattern.exec(q)) !== null) {\r\n    const g1 = matches[1];\r\n    const g2 = matches[2];\r\n    const month = getMonth(g2);\r\n    if(month >= 0) {\r\n      const k = +g1;\r\n      if(k > 0 && k <= 31) {\r\n        const day = k - 1;\r\n        createForDayMonth(dates, day, month);\r\n        return;\r\n      } else if(k >= minYear) {\r\n        const selectedYear = k;\r\n        createForMonthYear(dates, month, selectedYear);\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\nfunction createForMonthYear(dates: DateData[], month: number, selectedYear: number) {\r\n  const currentYear = new Date().getFullYear();\r\n  const today = Date.now();\r\n  if(selectedYear >= minYear && selectedYear <= currentYear) {\r\n    const date = new Date();\r\n    date.setFullYear(selectedYear, month, 1);\r\n    date.setHours(0, 0, 0);\r\n    const minDate = date.getTime();\r\n    if(minDate > today) {\r\n      return;\r\n    }\r\n    date.setMonth(date.getMonth() + 1);\r\n    const maxDate = date.getTime() - 1;\r\n\r\n    dates.push({\r\n      title: formatterMonthYear(minDate),\r\n      minDate,\r\n      maxDate\r\n    });\r\n  }\r\n}\r\n\r\nfunction createForDayMonth(dates: DateData[], day: number, month: number) {\r\n  if(validDateForMonth(day, month)) {\r\n    const currentYear = new Date().getFullYear();\r\n    const today = Date.now();\r\n\r\n    for(let i = currentYear; i >= minYear; i--) {\r\n      if(month === 1 && day === 28 && !isLeapYear(i)) {\r\n        continue;\r\n      }\r\n\r\n      const date = new Date();\r\n      date.setFullYear(i, month, day + 1);\r\n      date.setHours(0, 0, 0);\r\n\r\n      const minDate = date.getTime();\r\n      if(minDate > today) {\r\n        continue;\r\n      }\r\n\r\n      date.setFullYear(i, month, day + 2);\r\n      date.setHours(0, 0, 0);\r\n      const maxDate = date.getTime() - 1;\r\n      if(i === currentYear) {\r\n        dates.push({\r\n          title: formatterDayMonth(minDate),\r\n          minDate,\r\n          maxDate\r\n        });\r\n      } else {\r\n        dates.push({\r\n          title: formatterYearMax(minDate),\r\n          minDate,\r\n          maxDate\r\n        });\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\nfunction formatterMonthYear(timestamp: number) {\r\n  const date = new Date(timestamp);\r\n  return months[date.getMonth()].slice(0, 3) + ' ' + date.getFullYear();\r\n}\r\n\r\nfunction formatterDayMonth(timestamp: number) {\r\n  const date = new Date(timestamp);\r\n  return months[date.getMonth()].slice(0, 3) + ' ' + date.getDate();\r\n}\r\n\r\nfunction formatterYearMax(timestamp: number) {\r\n  const date = new Date(timestamp);\r\n  return ('0' + date.getDate()).slice(-2) + '.' + ('0' + (date.getMonth() + 1)).slice(-2) + '.' + date.getFullYear();\r\n}\r\n\r\nfunction formatWeekLong(timestamp: number) {\r\n  const date = new Date(timestamp);\r\n  return days[date.getDay()];\r\n}\r\n\r\nfunction validDateForMonth(day: number, month: number) {\r\n  if(month >= 0 && month < 12) {\r\n    if(day >= 0 && day < numberOfDaysEachMonth[month]) {\r\n      return true;\r\n    }\r\n  }\r\n  return false;\r\n}\r\n\r\nfunction isLeapYear(year: number) {\r\n  return ((year % 4 === 0) && (year % 100 !== 0)) || (year % 400 === 0);\r\n}\r\n\r\nfunction getMonth(q: string) {\r\n  /* String[] months = new String[]{\r\n          LocaleController.getString(\"January\", R.string.January).toLowerCase(),\r\n          LocaleController.getString(\"February\", R.string.February).toLowerCase(),\r\n          LocaleController.getString(\"March\", R.string.March).toLowerCase(),\r\n          LocaleController.getString(\"April\", R.string.April).toLowerCase(),\r\n          LocaleController.getString(\"May\", R.string.May).toLowerCase(),\r\n          LocaleController.getString(\"June\", R.string.June).toLowerCase(),\r\n          LocaleController.getString(\"July\", R.string.July).toLowerCase(),\r\n          LocaleController.getString(\"August\", R.string.August).toLowerCase(),\r\n          LocaleController.getString(\"September\", R.string.September).toLowerCase(),\r\n          LocaleController.getString(\"October\", R.string.October).toLowerCase(),\r\n          LocaleController.getString(\"November\", R.string.November).toLowerCase(),\r\n          LocaleController.getString(\"December\", R.string.December).toLowerCase()\r\n  }; */\r\n\r\n  /* String[] monthsEng = new String[12];\r\n  Calendar c = Calendar.getInstance();\r\n  for (int i = 1; i <= 12; i++) {\r\n      c.set(0, 0, 0, 0, 0, 0);\r\n      c.set(Calendar.MONTH, i);\r\n      monthsEng[i - 1] = c.getDisplayName(Calendar.MONTH, Calendar.LONG, Locale.ENGLISH).toLowerCase();\r\n  } */\r\n\r\n  q = q.toLowerCase();\r\n  for(let i = 0; i < 12; i++) {\r\n    const month = months[i].toLowerCase();\r\n    if(month.indexOf(q) === 0) {\r\n      return i;\r\n    }\r\n  }\r\n  return -1;\r\n}\r\n\r\nfunction getDayOfWeek(q: string) {\r\n  const c = new Date();\r\n  if(q.length <= 3) {\r\n    return -1;\r\n  }\r\n\r\n  for(let i = 0; i < 7; i++) {\r\n    c.setDate(c.getDate() + 1);\r\n\r\n    if(formatWeekLong(c.getTime()).toLowerCase().indexOf(q) === 0) {\r\n      return c.getDay();\r\n    }\r\n  }\r\n  return -1;\r\n}\r\n\r\nMOUNT_CLASS_TO.fillTipDates = fillTipDates;\r\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport IS_TOUCH_SUPPORTED from '../../environment/touchSupport';\nimport {IS_APPLE} from '../../environment/userAgent';\nimport contextMenuController from '../contextMenuController';\nimport ListenerSetter from '../listenerSetter';\nimport cancelEvent from './cancelEvent';\n\nlet _cancelContextMenuOpening = false, _cancelContextMenuOpeningTimeout = 0;\nexport function cancelContextMenuOpening() {\n  if(_cancelContextMenuOpeningTimeout) {\n    clearTimeout(_cancelContextMenuOpeningTimeout);\n  }\n\n  _cancelContextMenuOpeningTimeout = window.setTimeout(() => {\n    _cancelContextMenuOpeningTimeout = 0;\n    _cancelContextMenuOpening = false;\n  }, .4e3);\n\n  _cancelContextMenuOpening = true;\n}\n\nexport function attachContextMenuListener(element: HTMLElement, callback: (e: Touch | MouseEvent) => void, listenerSetter?: ListenerSetter) {\n  const add = listenerSetter ? listenerSetter.add(element) : element.addEventListener.bind(element);\n  const remove = listenerSetter ? listenerSetter.removeManual.bind(listenerSetter, element) : element.removeEventListener.bind(element);\n\n  if(IS_APPLE && IS_TOUCH_SUPPORTED) {\n    let timeout: number;\n\n    const options: EventListenerOptions = {capture: true};\n\n    const onCancel = () => {\n      clearTimeout(timeout);\n      // @ts-ignore\n      remove('touchmove', onCancel, options);\n      // @ts-ignore\n      remove('touchend', onCancel, options);\n      // @ts-ignore\n      remove('touchcancel', onCancel, options);\n    };\n\n    add('touchstart', (e: TouchEvent) => {\n      if(e.touches.length > 1) {\n        onCancel();\n        return;\n      }\n\n      add('touchmove', onCancel, options);\n      add('touchend', onCancel, options);\n      add('touchcancel', onCancel, options);\n\n      timeout = window.setTimeout(() => {\n        if(_cancelContextMenuOpening) {\n          onCancel();\n          return;\n        }\n\n        callback(e.touches[0]);\n        onCancel();\n\n        if(contextMenuController.isOpened()) {\n          element.addEventListener('touchend', cancelEvent, {once: true}); // * fix instant closing\n        }\n      }, .4e3);\n    });\n\n    /* if(!isSafari) {\n      add('contextmenu', (e: any) => {\n        cancelEvent(e);\n      }, {passive: false, capture: true});\n    } */\n  } else {\n    add('contextmenu', IS_TOUCH_SUPPORTED ? (e: any) => {\n      callback(e);\n\n      if(contextMenuController.isOpened()) {\n        element.addEventListener('touchend', cancelEvent, {once: true}); // * fix instant closing\n      }\n    } : callback);\n  }\n}\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nexport type GrabEvent = {x: number, y: number, isTouch?: boolean, event: TouchEvent | MouseEvent};\r\n\r\nexport default function attachGrabListeners(element: HTMLElement,\r\n  onStart: (position: GrabEvent) => void,\r\n  onMove: (position: GrabEvent) => void,\r\n  onEnd?: (position: GrabEvent) => void) {\r\n  // * Mouse\r\n  const onMouseMove = (event: MouseEvent) => {\r\n    onMove({x: event.pageX, y: event.pageY, event});\r\n  };\r\n\r\n  const onMouseUp = (event: MouseEvent) => {\r\n    document.removeEventListener('mousemove', onMouseMove);\r\n    element.addEventListener('mousedown', onMouseDown, {once: true});\r\n    onEnd && onEnd({x: event.pageX, y: event.pageY, event});\r\n  };\r\n\r\n  const onMouseDown = (event: MouseEvent) => {\r\n    if(event.button !== 0) {\r\n      element.addEventListener('mousedown', onMouseDown, {once: true});\r\n      return;\r\n    }\r\n\r\n    onStart({x: event.pageX, y: event.pageY, event});\r\n    onMouseMove(event);\r\n\r\n    document.addEventListener('mousemove', onMouseMove);\r\n    document.addEventListener('mouseup', onMouseUp, {once: true});\r\n  };\r\n\r\n  element.addEventListener('mousedown', onMouseDown, {once: true});\r\n\r\n  // * Touch\r\n  const onTouchMove = (event: TouchEvent) => {\r\n    event.preventDefault();\r\n    onMove({x: event.touches[0].clientX, y: event.touches[0].clientY, isTouch: true, event});\r\n  };\r\n\r\n  const onTouchEnd = (event: TouchEvent) => {\r\n    document.removeEventListener('touchmove', onTouchMove);\r\n    element.addEventListener('touchstart', onTouchStart, {passive: false, once: true});\r\n    onEnd && onEnd({x: event.touches[0].clientX, y: event.touches[0].clientY, isTouch: true, event});\r\n  };\r\n\r\n  const onTouchStart = (event: TouchEvent) => {\r\n    onStart({x: event.touches[0].clientX, y: event.touches[0].clientY, isTouch: true, event});\r\n    onTouchMove(event);\r\n\r\n    document.addEventListener('touchmove', onTouchMove, {passive: false});\r\n    document.addEventListener('touchend', onTouchEnd, {passive: false, once: true});\r\n  };\r\n\r\n  element.addEventListener('touchstart', onTouchStart, {passive: false, once: true});\r\n\r\n  return () => {\r\n    element.removeEventListener('mousedown', onMouseDown);\r\n    document.removeEventListener('mousemove', onMouseMove);\r\n    document.removeEventListener('mouseup', onMouseUp);\r\n\r\n    element.removeEventListener('touchstart', onTouchStart);\r\n    document.removeEventListener('touchmove', onTouchMove);\r\n    document.removeEventListener('touchend', onTouchEnd);\r\n  };\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nexport default function cancelSelection() {\r\n  if(window.getSelection) {\r\n    if(window.getSelection().empty) {  // Chrome\r\n      window.getSelection().empty();\r\n    } else if(window.getSelection().removeAllRanges) {  // Firefox\r\n      window.getSelection().removeAllRanges();\r\n    }\r\n    // @ts-ignore\r\n  } else if(document.selection) {  // IE?\r\n    // @ts-ignore\r\n    document.selection.empty();\r\n  }\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport type ListenerSetter from '../listenerSetter';\r\nimport IS_TOUCH_SUPPORTED from '../../environment/touchSupport';\r\nimport simulateEvent from './dispatchEvent';\r\n\r\nexport const CLICK_EVENT_NAME: 'mousedown' /* | 'touchend' */ | 'click' = (IS_TOUCH_SUPPORTED ? 'mousedown' : 'click') as any;\r\nexport type AttachClickOptions = AddEventListenerOptions & Partial<{listenerSetter: ListenerSetter, touchMouseDown: true}>;\r\nexport function attachClickEvent(elem: HTMLElement | Window, callback: (e: /* TouchEvent |  */MouseEvent) => void, options: AttachClickOptions = {}) {\r\n  const add = options.listenerSetter ? options.listenerSetter.add(elem) : elem.addEventListener.bind(elem);\r\n  // const remove = options.listenerSetter ? options.listenerSetter.removeManual.bind(options.listenerSetter, elem) : elem.removeEventListener.bind(elem);\r\n\r\n  options.touchMouseDown = true;\r\n  /* if(options.touchMouseDown && CLICK_EVENT_NAME === 'touchend') {\r\n    add('mousedown', callback, options);\r\n  } else if(CLICK_EVENT_NAME === 'touchend') {\r\n    const o = {...options, once: true};\r\n\r\n    const onTouchStart = (e: TouchEvent) => {\r\n      const onTouchMove = (e: TouchEvent) => {\r\n        remove('touchmove', onTouchMove, o);\r\n        remove('touchend', onTouchEnd, o);\r\n      };\r\n\r\n      const onTouchEnd = (e: TouchEvent) => {\r\n        remove('touchmove', onTouchMove, o);\r\n        callback(e);\r\n        if(options.once) {\r\n          remove('touchstart', onTouchStart);\r\n        }\r\n      };\r\n\r\n      add('touchend', onTouchEnd, o);\r\n      add('touchmove', onTouchMove, o);\r\n    };\r\n\r\n    add('touchstart', onTouchStart);\r\n  } else {\r\n    add(CLICK_EVENT_NAME, callback, options);\r\n  } */\r\n  add(CLICK_EVENT_NAME, callback, options);\r\n}\r\n\r\nexport function detachClickEvent(elem: HTMLElement | Window, callback: (e: /* TouchEvent |  */MouseEvent) => void, options?: AddEventListenerOptions) {\r\n  // if(CLICK_EVENT_NAME === 'touchend') {\r\n  //   elem.removeEventListener('touchstart', callback, options);\r\n  // } else {\r\n  elem.removeEventListener(CLICK_EVENT_NAME, callback as any, options);\r\n  // }\r\n}\r\n\r\nexport function simulateClickEvent(elem: HTMLElement) {\r\n  simulateEvent(elem, CLICK_EVENT_NAME);\r\n}\r\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport IS_TOUCH_SUPPORTED from '../../environment/touchSupport';\nimport EventListenerBase from '../eventListenerBase';\nimport ListenerSetter from '../listenerSetter';\nimport safeAssign from '../object/safeAssign';\nimport findUpClassName from './findUpClassName';\n\nexport default class ControlsHover extends EventListenerBase<{\n  toggleControls: (show: boolean) => void\n}> {\n  protected hideControlsTimeout: number;\n  protected controlsLocked: boolean;\n\n  protected canHideControls: () => boolean;\n  protected element: HTMLElement;\n  protected listenerSetter: ListenerSetter;\n  protected showOnLeaveToClassName: string;\n  protected ignoreClickClassName: string;\n\n  constructor() {\n    super(false);\n    this.hideControlsTimeout = 0;\n  }\n\n  public setup(options: {\n    element: HTMLElement,\n    listenerSetter: ListenerSetter,\n    canHideControls?: () => boolean,\n    showOnLeaveToClassName?: string,\n    ignoreClickClassName?: string\n  }) {\n    safeAssign(this, options);\n\n    const {listenerSetter, element} = this;\n\n    if(IS_TOUCH_SUPPORTED) {\n      listenerSetter.add(element)('click', (e) => {\n        if(this.ignoreClickClassName && findUpClassName(e.target, this.ignoreClickClassName)) {\n          return;\n        }\n\n        this.toggleControls();\n      });\n\n      /* listenerSetter.add(player)('touchstart', () => {\n        showControls(false);\n      });\n\n      listenerSetter.add(player)('touchend', () => {\n        if(player.classList.contains('is-playing')) {\n          showControls();\n        }\n      }); */\n    } else {\n      listenerSetter.add(element)('mousemove', () => {\n        this.showControls();\n      });\n\n      listenerSetter.add(element)('mouseenter', () => {\n        this.showControls(false);\n      });\n\n      listenerSetter.add(element)('mouseleave', (e) => {\n        if(e.relatedTarget && this.showOnLeaveToClassName && findUpClassName(e.relatedTarget, this.showOnLeaveToClassName)) {\n          this.showControls(false);\n          return;\n        }\n\n        this.hideControls();\n      });\n    }\n  }\n\n  public hideControls = (setHideTimeout = false) => {\n    if(setHideTimeout) {\n      if(!this.hideControlsTimeout) {\n        this.hideControlsTimeout = window.setTimeout(this.hideControls, 3e3);\n      }\n\n      return;\n    }\n\n    clearTimeout(this.hideControlsTimeout);\n    this.hideControlsTimeout = 0;\n\n    const isShown = this.element.classList.contains('show-controls');\n    if(this.controlsLocked !== false) {\n      if((this.canHideControls ? !this.canHideControls() : false) || !isShown || this.controlsLocked) {\n        return;\n      }\n    } else if(!isShown) {\n      return;\n    }\n\n    this.dispatchEvent('toggleControls', false);\n    this.element.classList.remove('show-controls');\n  };\n\n  public showControls = (setHideTimeout = true) => {\n    if(this.hideControlsTimeout) {\n      clearTimeout(this.hideControlsTimeout);\n      this.hideControlsTimeout = 0;\n    } else if(!this.element.classList.contains('show-controls') && this.controlsLocked !== false) {\n      this.dispatchEvent('toggleControls', true);\n      this.element.classList.add('show-controls');\n    }\n\n    if(!setHideTimeout || this.controlsLocked) {\n      return;\n    }\n\n    this.hideControlsTimeout = window.setTimeout(this.hideControls, 3e3);\n  };\n\n  public toggleControls = (show?: boolean) => {\n    const isShown = this.element.classList.contains('show-controls');\n\n    if(show === undefined) {\n      if(isShown) this.hideControls();\n      else this.showControls();\n    } else if(show === isShown) return;\n    else if(show === false) this.hideControls();\n    else this.showControls();\n  };\n\n  public lockControls(visible: boolean) {\n    this.controlsLocked = visible;\n\n    this.element.classList.toggle('disable-hover', visible === false);\n    this.toggleControls(visible);\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport type {MyDocument} from '../../lib/appManagers/appDocsManager';\nimport PopupStickers from '../../components/popups/stickers';\nimport appImManager from '../../lib/appManagers/appImManager';\nimport rootScope from '../../lib/rootScope';\nimport createContextMenu from './createContextMenu';\nimport findUpClassName from './findUpClassName';\nimport emoticonsDropdown, {EmoticonsDropdown} from '../../components/emoticonsDropdown';\n\nexport default function createStickersContextMenu(options: {\n  listenTo: HTMLElement,\n  isStickerPack?: boolean,\n  verifyRecent?: (target: HTMLElement) => boolean,\n  appendTo?: HTMLElement,\n  onOpen?: () => any,\n  onClose?: () => any,\n  onSend?: () => any\n}) {\n  const {listenTo, isStickerPack, verifyRecent, appendTo, onOpen, onClose, onSend} = options;\n  let target: HTMLElement, doc: MyDocument;\n  const verifyFavoriteSticker = async(toAdd: boolean) => {\n    const favedStickers = await rootScope.managers.acknowledged.appStickersManager.getFavedStickersStickers();\n    if(!favedStickers.cached) {\n      return false;\n    }\n\n    const found = (await favedStickers.result).some((_doc) => _doc.id === doc.id);\n    return toAdd ? !found : found;\n  };\n\n  return createContextMenu({\n    listenTo: listenTo,\n    appendTo,\n    findElement: (e) => target = findUpClassName(e.target, 'media-sticker-wrapper'),\n    onOpen: async() => {\n      doc = await rootScope.managers.appDocsManager.getDoc(target.dataset.docId);\n      return onOpen?.();\n    },\n    onClose,\n    buttons: [{\n      icon: 'stickers',\n      text: 'Context.ViewStickerSet',\n      onClick: () => new PopupStickers(doc.stickerSetInput).show(),\n      verify: () => !isStickerPack\n    }, {\n      icon: 'favourites',\n      text: 'AddToFavorites',\n      onClick: () => rootScope.managers.appStickersManager.faveSticker(doc.id, false),\n      verify: () => verifyFavoriteSticker(true)\n    }, {\n      icon: 'favourites',\n      text: 'DeleteFromFavorites',\n      onClick: () => rootScope.managers.appStickersManager.faveSticker(doc.id, true),\n      verify: () => verifyFavoriteSticker(false)\n    }, {\n      icon: 'delete',\n      text: 'DeleteFromRecent',\n      onClick: () => emoticonsDropdown.stickersTab.deleteRecentSticker(doc),\n      verify: () => verifyRecent?.(target) ?? false\n    }, {\n      icon: 'mute',\n      text: 'Chat.Send.WithoutSound',\n      onClick: () => {\n        onSend?.();\n        return EmoticonsDropdown.sendDocId(doc.id, false, true);\n      },\n      verify: () => !!(appImManager.chat.peerId && appImManager.chat.peerId !== rootScope.myId)\n    }, {\n      icon: 'schedule',\n      text: 'Chat.Send.ScheduledMessage',\n      onClick: () => appImManager.chat.input.scheduleSending(() => appImManager.chat.input.sendMessageWithDocument(doc)),\n      verify: () => !!appImManager.chat.peerId\n    }]\n  });\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport ButtonMenu, {ButtonMenuItemOptions} from '../../components/buttonMenu';\nimport filterAsync from '../array/filterAsync';\nimport contextMenuController from '../contextMenuController';\nimport ListenerSetter from '../listenerSetter';\nimport {getMiddleware} from '../middleware';\nimport positionMenu from '../positionMenu';\nimport {attachContextMenuListener} from './attachContextMenuListener';\n\nexport default function createContextMenu<T extends ButtonMenuItemOptions & {verify?: () => boolean | Promise<boolean>}>({\n  buttons,\n  findElement,\n  listenTo,\n  appendTo,\n  filterButtons,\n  onOpen,\n  onClose\n}: {\n  buttons: T[],\n  findElement: (e: MouseEvent) => HTMLElement,\n  listenTo: HTMLElement,\n  appendTo?: HTMLElement,\n  filterButtons?: (buttons: T[]) => Promise<T[]>,\n  onOpen?: (target: HTMLElement) => any,\n  onClose?: () => any\n}) {\n  appendTo ??= document.body;\n\n  const attachListenerSetter = new ListenerSetter();\n  const listenerSetter = new ListenerSetter();\n  const middleware = getMiddleware();\n  let element: HTMLElement;\n\n  attachContextMenuListener(listenTo, (e) => {\n    const target = findElement(e as any);\n    if(!target) {\n      return;\n    }\n\n    let _element = element;\n    if(e instanceof MouseEvent || e.hasOwnProperty('preventDefault')) (e as any).preventDefault();\n    if(_element && _element.classList.contains('active')) {\n      return false;\n    }\n    if(e instanceof MouseEvent || e.hasOwnProperty('cancelBubble')) (e as any).cancelBubble = true;\n\n    const r = async() => {\n      await onOpen?.(target);\n\n      const initResult = await init();\n      if(!initResult) {\n        return;\n      }\n\n      _element = initResult.element;\n      const {cleanup, destroy} = initResult;\n\n      positionMenu(e, _element);\n      contextMenuController.openBtnMenu(_element, () => {\n        onClose?.();\n        cleanup();\n\n        setTimeout(() => {\n          destroy();\n        }, 300);\n      });\n    };\n\n    r();\n  }, attachListenerSetter);\n\n  const cleanup = () => {\n    listenerSetter.removeAll();\n    middleware.clean();\n  };\n\n  const destroy = () => {\n    cleanup();\n    attachListenerSetter.removeAll();\n  };\n\n  const init = async() => {\n    cleanup();\n\n    buttons.forEach((button) => button.element = undefined);\n    const f = filterButtons || ((buttons: T[]) => filterAsync(buttons, (button) => button?.verify?.() ?? true));\n\n    const filteredButtons = await f(buttons);\n    if(!filteredButtons.length) {\n      return;\n    }\n\n    const _element = element = ButtonMenu(filteredButtons, listenerSetter);\n    _element.classList.add('contextmenu');\n\n    appendTo.append(_element);\n\n    return {\n      element: _element,\n      cleanup,\n      destroy: () => {\n        _element.remove();\n      }\n    };\n  };\n\n  return {element, destroy};\n}\n","export default function createVideo(options: {\n  pip?: boolean\n} = {}) {\n  const video = document.createElement('video');\n  if(!options.pip) video.disablePictureInPicture = true;\n  video.setAttribute('playsinline', 'true');\n  return video;\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport rootScope from '../../lib/rootScope';\n\nexport type CustomProperty = string;\n\nexport class CustomProperties {\n  private cache: {[k in CustomProperty]?: string};\n  private computedStyle: CSSStyleDeclaration;\n\n  constructor() {\n    this.cache = {};\n\n    rootScope.addEventListener('theme_change', () => {\n      this.computedStyle = undefined;\n      const cache = this.cache;\n      this.cache = {};\n\n      for(const i in cache) {\n        this.getProperty(i);\n      }\n    });\n  }\n\n  public getProperty(name: CustomProperty) {\n    let value = this.cache[name];\n    if(value) {\n      return value;\n    }\n\n    if(!this.computedStyle) {\n      this.computedStyle = window.getComputedStyle(document.documentElement);\n    }\n\n    value = this.computedStyle.getPropertyValue('--' + name).trim();\n    return this.cache[name] = value;\n  }\n}\n\nconst customProperties = new CustomProperties();\nexport default customProperties;\n","export default function simulateEvent(elem: EventTarget, name: string) {\n  const event = new Event(name, {bubbles: true, cancelable: true});\n  elem.dispatchEvent(event);\n}\n","import encodeEntities from '../string/encodeEntities';\n\nexport default function documentFragmentToHTML(fragment: DocumentFragment) {\n  return Array.from(fragment.childNodes).map((node) => {\n    return node.nodeType === 3 ? encodeEntities(node.textContent) : (node as Element).outerHTML;\n  }).join('');\n}\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nexport default function findUpAsChild(el: HTMLElement, parent: HTMLElement): HTMLElement {\r\n  if(el.parentElement === parent) return el;\r\n\r\n  while(el.parentElement) {\r\n    el = el.parentElement;\r\n    if(el.parentElement === parent) {\r\n      return el;\r\n    }\r\n  }\r\n\r\n  return null;\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nexport default function findUpAttribute(el: any, attribute: string): HTMLElement {\r\n  return el.closest(`[${attribute}]`);\r\n  /* if(el.getAttribute(attribute) !== null) return el; // 03.02.2020\r\n\r\n  while(el.parentElement) {\r\n    el = el.parentElement;\r\n    if(el.getAttribute(attribute) !== null)\r\n      return el;\r\n  }\r\n  return null; */\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nexport default function findUpTag(el: any, tag: string): HTMLElement {\r\n  return el.closest(tag);\r\n  /* if(el.tagName === tag) return el; // 03.02.2020\r\n\r\n  while(el.parentElement) {\r\n    el = el.parentElement;\r\n    if(el.tagName === tag)\r\n      return el;\r\n  }\r\n  return null; */\r\n}\r\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport type ListenerSetter from '../listenerSetter';\n\nexport function requestFullScreen(element: HTMLElement) {\n  if(element.requestFullscreen) {\n    element.requestFullscreen();\n    // @ts-ignore\n  } else if(element.mozRequestFullScreen) {\n    // @ts-ignore\n    element.mozRequestFullScreen(); // Firefox\n    // @ts-ignore\n  } else if(element.webkitRequestFullscreen) {\n    // @ts-ignore\n    element.webkitRequestFullscreen(); // Chrome and Safari\n    // @ts-ignore\n  } else if(element.msRequestFullscreen) {\n    // @ts-ignore\n    element.msRequestFullscreen();\n  }\n}\n\nexport function cancelFullScreen() {\n  // @ts-ignore\n  if(document.cancelFullScreen) {\n    // @ts-ignore\n    document.cancelFullScreen();\n    // @ts-ignore\n  } else if(document.mozCancelFullScreen) {\n    // @ts-ignore\n    document.mozCancelFullScreen();\n    // @ts-ignore\n  } else if(document.webkitCancelFullScreen) {\n    // @ts-ignore\n    document.webkitCancelFullScreen();\n    // @ts-ignore\n  } else if(document.msExitFullscreen) {\n    // @ts-ignore\n    document.msExitFullscreen();\n  }\n}\n\nexport function addFullScreenListener(element: HTMLElement, callback: (e: Event) => any, listenerSetter?: ListenerSetter) {\n  const addListener = listenerSetter ? listenerSetter.add(element) : element.addEventListener.bind(element);\n  'webkitfullscreenchange mozfullscreenchange fullscreenchange MSFullscreenChange'.split(' ').forEach((eventName) => {\n    addListener(eventName, callback, false);\n  });\n}\n\nexport function getFullScreenElement(): HTMLElement {\n  // @ts-ignore\n  return document.fullscreenElement || document.mozFullScreenElement || document.webkitFullscreenElement || document.msFullscreenElement;\n}\n\nexport function isFullScreen() {\n  return !!getFullScreenElement();\n}\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n *\r\n * Originally from:\r\n * https://github.com/zhukov/webogram\r\n * Copyright (C) 2014 Igor Zhukov <igor.beatle@gmail.com>\r\n * https://github.com/zhukov/webogram/blob/master/LICENSE\r\n */\r\n\r\nimport {MessageEntity} from '../../layer';\r\n\r\nexport type MarkdownType = 'bold' | 'italic' | 'underline' | 'strikethrough' | 'monospace' | 'link' | 'mentionName' | 'spoiler';\r\nexport type MarkdownTag = {\r\n  match: string,\r\n  entityName: Extract<MessageEntity['_'], 'messageEntityBold' | 'messageEntityUnderline' | 'messageEntityItalic' | 'messageEntityCode' | 'messageEntityStrike' | 'messageEntityTextUrl' | 'messageEntityMentionName' | 'messageEntitySpoiler'>;\r\n};\r\n\r\n// https://core.telegram.org/bots/api#html-style\r\nexport const markdownTags: {[type in MarkdownType]: MarkdownTag} = {\r\n  bold: {\r\n    match: '[style*=\"bold\"], [style*=\"font-weight: 700\"], [style*=\"font-weight: 600\"], [style*=\"font-weight:700\"], [style*=\"font-weight:600\"], b, strong',\r\n    entityName: 'messageEntityBold'\r\n  },\r\n  underline: {\r\n    match: '[style*=\"underline\"], u, ins',\r\n    entityName: 'messageEntityUnderline'\r\n  },\r\n  italic: {\r\n    match: '[style*=\"italic\"], i, em',\r\n    entityName: 'messageEntityItalic'\r\n  },\r\n  monospace: {\r\n    match: '[style*=\"monospace\"], [face*=\"monospace\"], pre',\r\n    entityName: 'messageEntityCode'\r\n  },\r\n  strikethrough: {\r\n    match: '[style*=\"line-through\"], strike, del, s',\r\n    entityName: 'messageEntityStrike'\r\n  },\r\n  link: {\r\n    match: 'A:not(.follow)',\r\n    entityName: 'messageEntityTextUrl'\r\n  },\r\n  mentionName: {\r\n    match: 'A.follow',\r\n    entityName: 'messageEntityMentionName'\r\n  },\r\n  spoiler: {\r\n    match: '[style*=\"spoiler\"]',\r\n    entityName: 'messageEntitySpoiler'\r\n  }\r\n};\r\n\r\nconst tabulationMatch = '[style*=\"table-cell\"], th, td';\r\n\r\n/* export function getDepth(child: Node, container?: Node) {\r\n  let depth = 0;\r\n\r\n  do {\r\n    if(child === container) {\r\n      return depth;\r\n    }\r\n\r\n    ++depth;\r\n  } while((child = child.parentNode) !== null);\r\n\r\n  return depth;\r\n} */\r\n\r\nconst BLOCK_TAG_NAMES = new Set([\r\n  'DIV',\r\n  'P',\r\n  'BR',\r\n  'LI',\r\n  'SECTION',\r\n  'H6',\r\n  'H5',\r\n  'H4',\r\n  'H3',\r\n  'H2',\r\n  'H1',\r\n  'TR'\r\n]);\r\n\r\nexport default function getRichElementValue(node: HTMLElement, lines: string[], line: string[], selNode?: Node, selOffset?: number, entities?: MessageEntity[], offset = {offset: 0}) {\r\n  if(node.nodeType === 3) { // TEXT\r\n    const nodeValue = node.nodeValue;\r\n\r\n    /* const tabulation = node.parentElement?.closest(tabulationMatch + ', [contenteditable]');\r\n    if(tabulation?.getAttribute('contenteditable') === null) {\r\n      nodeValue += ' ';\r\n      // line.push('\\t');\r\n      // ++offset.offset;\r\n    } */\r\n\r\n    if(selNode === node) {\r\n      line.push(nodeValue.substr(0, selOffset) + '\\x01' + nodeValue.substr(selOffset));\r\n    } else {\r\n      line.push(nodeValue);\r\n    }\r\n\r\n    if(entities && nodeValue.length) {\r\n      if(node.parentNode) {\r\n        const parentElement = node.parentElement;\r\n\r\n        // let closestTag: MarkdownTag, closestElementByTag: Element, closestDepth = Infinity;\r\n        for(const type in markdownTags) {\r\n          const tag = markdownTags[type as MarkdownType];\r\n          const closest = parentElement.closest(tag.match + ', [contenteditable]');\r\n          if(closest?.getAttribute('contenteditable') !== null) {\r\n            /* const depth = getDepth(closest, parentElement.closest('[contenteditable]'));\r\n            if(closestDepth > depth) {\r\n              closestDepth = depth;\r\n              closestTag = tag;\r\n              closestElementByTag = closest;\r\n            } */\r\n            continue;\r\n          }\r\n\r\n          if(tag.entityName === 'messageEntityTextUrl') {\r\n            entities.push({\r\n              _: tag.entityName,\r\n              url: (closest as HTMLAnchorElement).href,\r\n              offset: offset.offset,\r\n              length: nodeValue.length\r\n            });\r\n          } else if(tag.entityName === 'messageEntityMentionName') {\r\n            entities.push({\r\n              _: tag.entityName,\r\n              offset: offset.offset,\r\n              length: nodeValue.length,\r\n              user_id: (closest as HTMLElement).dataset.follow.toUserId()\r\n            });\r\n          } else {\r\n            entities.push({\r\n              _: tag.entityName,\r\n              offset: offset.offset,\r\n              length: nodeValue.length\r\n            });\r\n          }\r\n        }\r\n      }\r\n    }\r\n\r\n    offset.offset += nodeValue.length;\r\n    return;\r\n  }\r\n\r\n  if(node.nodeType !== 1) { // NON-ELEMENT\r\n    return;\r\n  }\r\n\r\n  const isSelected = selNode === node;\r\n  const isBlock = BLOCK_TAG_NAMES.has(node.tagName);\r\n  if(isBlock && line.length) {\r\n    lines.push(line.join(''));\r\n    line.splice(0, line.length);\r\n    ++offset.offset;\r\n  } else if(node instanceof HTMLImageElement) {\r\n    const alt = node.alt;\r\n    if(alt) {\r\n      line.push(alt);\r\n      offset.offset += alt.length;\r\n    }\r\n  }\r\n\r\n  if(isSelected && !selOffset) {\r\n    line.push('\\x01');\r\n  }\r\n\r\n  const isTableCell = node.matches(tabulationMatch);\r\n  const wasEntitiesLength = entities?.length;\r\n\r\n  let curChild = node.firstChild as HTMLElement;\r\n  while(curChild) {\r\n    getRichElementValue(curChild, lines, line, selNode, selOffset, entities, offset);\r\n    curChild = curChild.nextSibling as any;\r\n  }\r\n\r\n  if(isSelected && selOffset) {\r\n    line.push('\\x01');\r\n  }\r\n\r\n  if(isTableCell && node.nextSibling) {\r\n    line.push(' ');\r\n    ++offset.offset;\r\n\r\n    // * combine entities such as url after adding space\r\n    if(wasEntitiesLength !== undefined) {\r\n      for(let i = wasEntitiesLength, length = entities.length; i < length; ++i) {\r\n        ++entities[i].length;\r\n      }\r\n    }\r\n  }\r\n\r\n  const wasLength = line.length;\r\n  if(isBlock && wasLength) {\r\n    lines.push(line.join(''));\r\n    line.splice(0, wasLength);\r\n    ++offset.offset;\r\n  }\r\n\r\n  if(wasLength && node.tagName === 'P' && node.nextSibling) {\r\n    lines.push('');\r\n    ++offset.offset;\r\n  }\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n *\r\n * Originally from:\r\n * https://github.com/zhukov/webogram\r\n * Copyright (C) 2014 Igor Zhukov <igor.beatle@gmail.com>\r\n * https://github.com/zhukov/webogram/blob/master/LICENSE\r\n */\r\n\r\nimport {MOUNT_CLASS_TO} from '../../config/debug';\r\nimport {MessageEntity} from '../../layer';\r\nimport combineSameEntities from '../../lib/richTextProcessor/combineSameEntities';\r\nimport sortEntities from '../../lib/richTextProcessor/sortEntities';\r\nimport getRichElementValue from './getRichElementValue';\r\n\r\nexport default function getRichValue(field: HTMLElement, withEntities = true) {\r\n  const lines: string[] = [];\r\n  const line: string[] = [];\r\n\r\n  const entities: MessageEntity[] = withEntities ? [] : undefined;\r\n  getRichElementValue(field, lines, line, undefined, undefined, entities);\r\n  if(line.length) {\r\n    lines.push(line.join(''));\r\n  }\r\n\r\n  let value = lines.join('\\n');\r\n  value = value.replace(/\\u00A0/g, ' ');\r\n\r\n  if(entities?.length) {\r\n    // ! cannot do that here because have the same check before the sending in RichTextProcessor.parseMarkdown\r\n    /* const entity = entities[entities.length - 1];\r\n    const length = value.length;\r\n    const trimmedLength = value.trimRight().length;\r\n    if(length !== trimmedLength) {\r\n      entity.length -= length - trimmedLength;\r\n    } */\r\n\r\n    combineSameEntities(entities);\r\n    sortEntities(entities);\r\n  }\r\n\r\n  // console.log('getRichValue:', value, entities);\r\n\r\n  return {value, entities};\r\n}\r\n\r\nMOUNT_CLASS_TO.getRichValue = getRichValue;\r\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport getVisibleRect from './getVisibleRect';\n\nexport type ViewportSlicePart = {element: HTMLElement, rect: DOMRect, visibleRect: ReturnType<typeof getVisibleRect>}[];\n\nexport default function getViewportSlice({overflowElement, overflowRect, selector, extraSize, elements}: {\n  overflowElement: HTMLElement,\n  overflowRect?: DOMRectMinified,\n  extraSize?: number,\n  selector?: string,\n  elements?: HTMLElement[]\n}) {\n  // const perf = performance.now();\n  overflowRect ??= overflowElement.getBoundingClientRect();\n  elements ??= Array.from(overflowElement.querySelectorAll<HTMLElement>(selector));\n\n  if(extraSize) {\n    overflowRect = {\n      top: overflowRect.top - extraSize,\n      right: overflowRect.right + extraSize,\n      bottom: overflowRect.bottom + extraSize,\n      left: overflowRect.left - extraSize\n    };\n  }\n\n  const invisibleTop: ViewportSlicePart = [],\n    visible: typeof invisibleTop = [],\n    invisibleBottom: typeof invisibleTop = [];\n  let foundVisible = false;\n  for(const element of elements) {\n    const rect = element.getBoundingClientRect();\n    const visibleRect = getVisibleRect(element, overflowElement, false, rect, overflowRect);\n\n    const isVisible = !!visibleRect;\n    let array: typeof invisibleTop;\n    if(isVisible) {\n      foundVisible = true;\n      array = visible;\n    } else if(foundVisible) {\n      array = invisibleBottom;\n    } else {\n      array = invisibleTop;\n    }\n\n    array.push({\n      element,\n      rect,\n      visibleRect\n    });\n  }\n\n  // if(extraSize && visible.length) {\n  //   const maxTop = visible[0].rect.top;\n  //   const minTop = maxTop - extraSize;\n  //   const minBottom = visible[visible.length - 1].rect.bottom;\n  //   const maxBottom = minBottom + extraSize;\n\n  //   for(let length = invisibleTop.length, i = length - 1; i >= 0; --i) {\n  //     const element = invisibleTop[i];\n  //     if(element.rect.top >= minTop) {\n  //       invisibleTop.splice(i, 1);\n  //       visible.unshift(element);\n  //     }\n  //   }\n\n  //   for(let i = 0, length = invisibleBottom.length; i < length; ++i) {\n  //     const element = invisibleBottom[i];\n  //     if(element.rect.bottom <= maxBottom) {\n  //       invisibleBottom.splice(i--, 1);\n  //       --length;\n  //       visible.push(element);\n  //     }\n  //   }\n  // }\n\n  // console.log('getViewportSlice time:', performance.now() - perf);\n\n  return {invisibleTop, visible, invisibleBottom};\n}\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport windowSize from '../windowSize';\r\n\r\nexport default function getVisibleRect(\r\n  element: HTMLElement,\r\n  overflowElement: HTMLElement,\r\n  lookForSticky?: boolean,\r\n  rect: DOMRectMinified = element.getBoundingClientRect(),\r\n  overflowRect: DOMRectMinified = overflowElement.getBoundingClientRect()\r\n) {\r\n  let {top: overflowTop, right: overflowRight, bottom: overflowBottom, left: overflowLeft} = overflowRect;\r\n\r\n  // * respect sticky headers\r\n  if(lookForSticky) {\r\n    const sticky = overflowElement.querySelector('.sticky');\r\n    if(sticky) {\r\n      const stickyRect = sticky.getBoundingClientRect();\r\n      overflowTop = stickyRect.bottom;\r\n    }\r\n  }\r\n\r\n  if(rect.top >= overflowBottom ||\r\n    rect.bottom <= overflowTop ||\r\n    rect.right <= overflowLeft ||\r\n    rect.left >= overflowRight) {\r\n    return null;\r\n  }\r\n\r\n  const overflow = {\r\n    top: false,\r\n    right: false,\r\n    bottom: false,\r\n    left: false,\r\n    vertical: 0 as 0 | 1 | 2,\r\n    horizontal: 0 as 0 | 1 | 2\r\n  };\r\n\r\n  const windowWidth = windowSize.width;\r\n  const windowHeight = windowSize.height;\r\n\r\n  return {\r\n    rect: {\r\n      top: rect.top < overflowTop && overflowTop !== 0 ? (overflow.top = true, ++overflow.vertical, overflowTop) : rect.top,\r\n      right: rect.right > overflowRight && overflowRight !== windowWidth ? (overflow.right = true, ++overflow.horizontal, overflowRight) : rect.right,\r\n      bottom: rect.bottom > overflowBottom && overflowBottom !== windowHeight ? (overflow.bottom = true, ++overflow.vertical, overflowBottom) : rect.bottom,\r\n      left: rect.left < overflowLeft && overflowLeft !== 0 ? (overflow.left = true, ++overflow.horizontal, overflowLeft) : rect.left\r\n    },\r\n    overflow\r\n  };\r\n}\r\n\r\n(window as any).getVisibleRect = getVisibleRect;\r\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport SwipeHandler, {SwipeHandlerOptions} from '../../components/swipeHandler';\nimport cancelEvent from './cancelEvent';\nimport findUpClassName from './findUpClassName';\nimport isSwipingBackSafari from './isSwipingBackSafari';\n\nexport type SwipeHandlerHorizontalOptions = SwipeHandlerOptions & {\n  // xThreshold?: number\n};\n\nexport default function handleHorizontalSwipe(options: SwipeHandlerHorizontalOptions) {\n  let cancelY = false;\n  return new SwipeHandler({\n    ...options,\n    verifyTouchTarget: (e) => {\n      return !findUpClassName(e.target, 'progress-line') &&\n        !isSwipingBackSafari(e) &&\n        (options.verifyTouchTarget ? options.verifyTouchTarget(e) : true);\n    },\n    onSwipe: (xDiff, yDiff, e) => {\n      if(!cancelY && Math.abs(yDiff) > 20) {\n        return true;\n      }\n\n      if(Math.abs(xDiff) > Math.abs(yDiff)) {\n        cancelEvent(e);\n        cancelY = true;\n      } else if(!cancelY && Math.abs(yDiff) > Math.abs(xDiff)/*  || Math.abs(yDiff) > 20 */) {\n        return true;\n      }\n\n      /* if(!cancelY && options.xThreshold !== undefined && xDiff >= options.xThreshold) {\n        cancelY = true;\n      } */\n\n      return options.onSwipe(xDiff, yDiff, e);\n    },\n    onReset: () => {\n      cancelY = false;\n      options.onReset && options.onReset();\n    },\n    cancelEvent: false // cannot use cancelEvent on Safari iOS because scroll will be canceled too\n  });\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport {cancelContextMenuOpening} from './attachContextMenuListener';\nimport handleHorizontalSwipe, {SwipeHandlerHorizontalOptions} from './handleHorizontalSwipe';\n\nexport default function handleTabSwipe(options: SwipeHandlerHorizontalOptions) {\n  return handleHorizontalSwipe({\n    ...options,\n    onSwipe: (xDiff, yDiff, e) => {\n      if(Math.abs(xDiff) > 50) {\n        options.onSwipe(xDiff, yDiff, e);\n        cancelContextMenuOpening();\n\n        return true;\n      }\n    }\n  });\n}\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nexport default function htmlToDocumentFragment(html: string | DocumentFragment) {\r\n  if(html instanceof DocumentFragment) return html;\r\n  const template = document.createElement('template');\r\n  html = html.trim(); // Never return a text node of whitespace as the result\r\n  template.innerHTML = html;\r\n  return template.content;\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nexport default function htmlToSpan(html: string | DocumentFragment) {\r\n  const span = document.createElement('span');\r\n  if(typeof(html) === 'string') span.innerHTML = html;\r\n  else span.append(html);\r\n  return span;\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n *\r\n * Originally from:\r\n * https://github.com/zhukov/webogram\r\n * Copyright (C) 2014 Igor Zhukov <igor.beatle@gmail.com>\r\n * https://github.com/zhukov/webogram/blob/master/LICENSE\r\n */\r\n\r\n/* export function isInDOM(element: Element, parentNode?: HTMLElement): boolean {\r\n  if(!element) {\r\n    return false;\r\n  }\r\n\r\n  parentNode = parentNode || document.body;\r\n  if(element === parentNode) {\r\n    return true;\r\n  }\r\n  return isInDOM(element.parentNode as HTMLElement, parentNode);\r\n} */\r\nexport default function isInDOM(element: Element): boolean {\r\n  return element?.isConnected;\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport getRichValue from './getRichValue';\r\n\r\nexport default function isInputEmpty(element: HTMLElement) {\r\n  if(element.hasAttribute('contenteditable') || element.tagName !== 'INPUT') {\r\n    /* const value = element.innerText;\r\n\r\n    return !value.trim() && !serializeNodes(Array.from(element.childNodes)).trim(); */\r\n    return !getRichValue(element, false).value.trim();\r\n  } else {\r\n    return !(element as HTMLInputElement).value.trim();\r\n  }\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport rootScope from '../../lib/rootScope';\r\nimport {IS_MOBILE, IS_APPLE} from '../../environment/userAgent';\r\n\r\nexport default function isSendShortcutPressed(e: KeyboardEvent) {\r\n  if(e.key === 'Enter' && !IS_MOBILE && !e.isComposing) {\r\n    /* if(e.ctrlKey || e.metaKey) {\r\n      this.messageInput.innerHTML += '<br>';\r\n      placeCaretAtEnd(this.message)\r\n      return;\r\n    } */\r\n\r\n    if(rootScope.settings.sendShortcut === 'enter') {\r\n      if(e.shiftKey || e.ctrlKey || e.metaKey) {\r\n        return;\r\n      }\r\n\r\n      return true;\r\n    } else {\r\n      const secondaryKey = IS_APPLE ? e.metaKey : e.ctrlKey;\r\n      if(e.shiftKey || (IS_APPLE ? e.ctrlKey : e.metaKey)) {\r\n        return;\r\n      }\r\n\r\n      if(secondaryKey) {\r\n        return true;\r\n      }\r\n    }\r\n  }\r\n\r\n  return false;\r\n}\r\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport {IS_MOBILE_SAFARI} from '../../environment/userAgent';\n\nexport default function isSwipingBackSafari(e: TouchEvent | MouseEvent) {\n  return IS_MOBILE_SAFARI && e instanceof TouchEvent && e.touches[0].clientX < 30;\n}\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n *\r\n * Originally from:\r\n * https://github.com/zhukov/webogram\r\n * Copyright (C) 2014 Igor Zhukov <igor.beatle@gmail.com>\r\n * https://github.com/zhukov/webogram/blob/master/LICENSE\r\n */\r\n\r\nimport IS_TOUCH_SUPPORTED from '../../environment/touchSupport';\r\n\r\nexport default function placeCaretAtEnd(el: HTMLElement, ignoreTouchCheck = false) {\r\n  if(IS_TOUCH_SUPPORTED && (!ignoreTouchCheck || document.activeElement !== el)) {\r\n    return;\r\n  }\r\n\r\n  el.focus();\r\n  if(el instanceof HTMLInputElement) {\r\n    const length = el.value.length;\r\n    el.selectionStart = length;\r\n    el.selectionEnd = length;\r\n  } else if(typeof window.getSelection !== 'undefined' && typeof document.createRange !== 'undefined') {\r\n    var range = document.createRange();\r\n    range.selectNodeContents(el);\r\n    range.collapse(false);\r\n    var sel = window.getSelection();\r\n    sel.removeAllRanges();\r\n    sel.addRange(range);\r\n    // @ts-ignore\r\n  } else if(typeof document.body.createTextRange !== 'undefined') {\r\n    // @ts-ignore\r\n    var textRange = document.body.createTextRange();\r\n    textRange.moveToElementText(el);\r\n    textRange.collapse(false);\r\n    textRange.select();\r\n  }\r\n}\r\n\r\n(window as any).placeCaretAtEnd = placeCaretAtEnd;\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport whichChild from './whichChild';\r\n\r\nexport default function positionElementByIndex(element: HTMLElement, container: HTMLElement, pos: number, prevPos?: number) {\r\n  if(prevPos === undefined) {\r\n    prevPos = element.parentElement === container ? whichChild(element) : -1;\r\n  }\r\n\r\n  if(prevPos === pos) {\r\n    return false;\r\n  } else if(prevPos !== -1 && prevPos < pos) { // was higher\r\n    pos += 1;\r\n  }\r\n\r\n  if(!pos) {\r\n    container.prepend(element);\r\n  } else if(container.childElementCount > pos) {\r\n    container.insertBefore(element, container.children[pos]);\r\n  } else {\r\n    container.append(element);\r\n  }\r\n\r\n  return true;\r\n}\r\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport onMediaLoad from '../onMediaLoad';\n\n// import { getHeavyAnimationPromise } from \"../../hooks/useHeavyAnimationCheck\";\n\nexport const loadedURLs: {[url: string]: boolean} = {};\nconst set = (elem: HTMLElement | HTMLImageElement | SVGImageElement | HTMLVideoElement, url: string) => {\n  if(elem instanceof HTMLImageElement || elem instanceof HTMLVideoElement) elem.src = url;\n  else if(elem instanceof SVGImageElement) elem.setAttributeNS(null, 'href', url);\n  else elem.style.backgroundImage = 'url(' + url + ')';\n};\n\n//    ,      ,    blob',      'load'  .\nexport default function renderImageFromUrl(\n  elem: HTMLElement | HTMLImageElement | SVGImageElement | HTMLVideoElement,\n  url: string,\n  callback?: () => void,\n  useCache = true\n) {\n  if(!url) {\n    console.error('renderImageFromUrl: no url?', elem, url);\n    callback?.();\n    return;\n  }\n\n  const isVideo = elem instanceof HTMLVideoElement;\n  if(((loadedURLs[url]/*  && false */) && useCache) || isVideo) {\n    if(elem) {\n      set(elem, url);\n    }\n\n    if(callback) {\n      if(isVideo) {\n        onMediaLoad(elem).then(callback);\n      } else {\n        callback?.();\n      }\n      // callback && getHeavyAnimationPromise().then(() => callback());\n    }\n  } else {\n    const isImage = elem instanceof HTMLImageElement;\n    const loader = isImage ? elem as HTMLImageElement : new Image();\n    // const loader = new Image();\n    loader.src = url;\n    // let perf = performance.now();\n\n    const onLoad = () => {\n      if(!isImage && elem) {\n        set(elem, url);\n      }\n\n      loadedURLs[url] = true;\n      // console.log('onload:', url, performance.now() - perf);\n      // TODO:      ,       \n      // callback && getHeavyAnimationPromise().then(() => callback());\n      callback?.();\n\n      loader.removeEventListener('error', onError);\n    };\n\n    const onError = (err: ErrorEvent) => {\n      console.error('Render image from url failed:', err, url, loader);\n      loader.removeEventListener('load', onLoad);\n      callback?.();\n    };\n\n    loader.addEventListener('load', onLoad, {once: true});\n    loader.addEventListener('error', onError, {once: true});\n  }\n}\n\nexport function renderImageFromUrlPromise(elem: Parameters<typeof renderImageFromUrl>[0], url: string, useCache?: boolean) {\n  return new Promise<void>((resolve) => {\n    renderImageFromUrl(elem, url, resolve, useCache);\n  });\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport sequentialDom from '../sequentialDom';\nimport {renderImageFromUrlPromise} from './renderImageFromUrl';\n\nexport default function renderMediaWithFadeIn(\n  container: HTMLElement,\n  media: Parameters<typeof renderImageFromUrlPromise>[0],\n  url: string,\n  needFadeIn: boolean,\n  aspecter = container,\n  thumbImage?: HTMLElement\n) {\n  if(needFadeIn) {\n    media.classList.add('fade-in');\n  }\n\n  const promise = renderImageFromUrlPromise(media, url).then(() => {\n    return sequentialDom.mutateElement(container, () => {\n      aspecter.append(media);\n\n      if(needFadeIn) {\n        media.addEventListener('animationend', () => {\n          sequentialDom.mutate(() => {\n            media.classList.remove('fade-in');\n            thumbImage?.remove();\n          });\n        }, {once: true});\n      } else {\n        thumbImage?.remove();\n      }\n    });\n  });\n\n  // recordPromise(promise, 'renderImageWithFadeIn');\n\n  return promise;\n}\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nexport default function replaceContent(elem: HTMLElement, node: string | Node) {\r\n  if(typeof(node) === 'string') {\r\n    elem.innerHTML = node;\r\n    return;\r\n  }\r\n\r\n  // * children.length doesn't count text nodes\r\n  const firstChild = elem.firstChild;\r\n  if(firstChild) {\r\n    if(elem.lastChild === firstChild) {\r\n      firstChild.replaceWith(node);\r\n    } else {\r\n      elem.textContent = '';\r\n      elem.append(node);\r\n    }\r\n  } else {\r\n    elem.append(node);\r\n  }\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nexport default function setInnerHTML(elem: Element, html: string | DocumentFragment | Element) {\r\n  elem.setAttribute('dir', 'auto');\r\n  if(typeof(html) === 'string') {\r\n    if(!html) elem.textContent = '';\r\n    else elem.innerHTML = html;\r\n  } else {\r\n    elem.textContent = '';\r\n    elem.append(html);\r\n  }\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nexport default function toggleDisability(elements: HTMLElement[], disable: boolean): () => void {\r\n  if(disable) {\r\n    elements.forEach((el) => el.setAttribute('disabled', 'true'));\r\n  } else {\r\n    elements.forEach((el) => el.removeAttribute('disabled'));\r\n  }\r\n\r\n  return () => toggleDisability(elements, !disable);\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nexport default function whichChild(elem: Node) {\r\n  if(!elem.parentNode) {\r\n    return -1;\r\n  }\r\n\r\n  let i = 0;\r\n  // @ts-ignore\r\n  while((elem = elem.previousElementSibling) !== null) ++i;\r\n  return i;\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport {attachClickEvent} from './dom/clickEvent';\r\nimport findUpAsChild from './dom/findUpAsChild';\r\nimport EventListenerBase from './eventListenerBase';\r\nimport ListenerSetter from './listenerSetter';\r\nimport IS_TOUCH_SUPPORTED from '../environment/touchSupport';\r\nimport safeAssign from './object/safeAssign';\r\n\r\nconst KEEP_OPEN = false;\r\nconst TOGGLE_TIMEOUT = 200;\r\nconst ANIMATION_DURATION = 200;\r\n\r\nexport default class DropdownHover extends EventListenerBase<{\r\n  open: () => Promise<any> | void,\r\n  opened: () => any,\r\n  close: () => any,\r\n  closed: () => any\r\n}> {\r\n  protected element: HTMLElement;\r\n  protected displayTimeout: number;\r\n  protected forceClose = false;\r\n  protected inited = false;\r\n  protected ignoreMouseOut = false;\r\n\r\n  constructor(options: {\r\n    element: DropdownHover['element']\r\n  }) {\r\n    super(false);\r\n    safeAssign(this, options);\r\n  }\r\n\r\n  public attachButtonListener(button: HTMLElement, listenerSetter: ListenerSetter) {\r\n    let firstTime = true;\r\n    if(IS_TOUCH_SUPPORTED) {\r\n      attachClickEvent(button, () => {\r\n        if(firstTime) {\r\n          firstTime = false;\r\n          this.toggle(true);\r\n        } else {\r\n          this.toggle();\r\n        }\r\n      }, {listenerSetter});\r\n    } else {\r\n      listenerSetter.add(button)('mouseover', (e) => {\r\n        // console.log('onmouseover button');\r\n        if(firstTime) {\r\n          listenerSetter.add(button)('mouseout', (e) => {\r\n            clearTimeout(this.displayTimeout);\r\n            this.onMouseOut(e);\r\n          });\r\n          firstTime = false;\r\n        }\r\n\r\n        clearTimeout(this.displayTimeout);\r\n        this.displayTimeout = window.setTimeout(() => {\r\n          this.toggle(true);\r\n        }, TOGGLE_TIMEOUT);\r\n      });\r\n    }\r\n  }\r\n\r\n  protected onMouseOut = (e: MouseEvent) => {\r\n    if(KEEP_OPEN || !this.isActive()) return;\r\n    clearTimeout(this.displayTimeout);\r\n\r\n    if(this.ignoreMouseOut) {\r\n      return;\r\n    }\r\n\r\n    const toElement = (e as any).toElement as HTMLElement;\r\n    if(toElement && findUpAsChild(toElement, this.element)) {\r\n      return;\r\n    }\r\n\r\n    this.displayTimeout = window.setTimeout(() => {\r\n      this.toggle(false);\r\n    }, TOGGLE_TIMEOUT);\r\n  };\r\n\r\n  protected init() {\r\n    if(!IS_TOUCH_SUPPORTED) {\r\n      this.element.onmouseout = this.onMouseOut;\r\n      this.element.onmouseover = (e) => {\r\n        if(this.forceClose) {\r\n          return;\r\n        }\r\n\r\n        // console.log('onmouseover element');\r\n        clearTimeout(this.displayTimeout);\r\n      };\r\n    }\r\n  }\r\n\r\n  public toggle = async(enable?: boolean) => {\r\n    // if(!this.element) return;\r\n    const willBeActive = (!!this.element.style.display && enable === undefined) || enable;\r\n    if(this.init) {\r\n      if(willBeActive) {\r\n        this.init();\r\n        this.init = null;\r\n      } else {\r\n        return;\r\n      }\r\n    }\r\n\r\n    if(willBeActive === this.isActive()) {\r\n      return;\r\n    }\r\n\r\n    if((this.element.style.display && enable === undefined) || enable) {\r\n      const res = this.dispatchResultableEvent('open');\r\n      await Promise.all(res);\r\n\r\n      this.element.style.display = '';\r\n      void this.element.offsetLeft; // reflow\r\n      this.element.classList.add('active');\r\n\r\n      clearTimeout(this.displayTimeout);\r\n      this.displayTimeout = window.setTimeout(() => {\r\n        this.forceClose = false;\r\n        this.dispatchEvent('opened');\r\n      }, IS_TOUCH_SUPPORTED ? 0 : ANIMATION_DURATION);\r\n\r\n      // ! can't use together with resizeObserver\r\n      /* if(isTouchSupported) {\r\n        const height = this.element.scrollHeight + appImManager.chat.input.inputContainer.scrollHeight - 10;\r\n        console.log('[ESG]: toggle: enable height', height);\r\n        appImManager.chat.bubbles.scrollable.scrollTop += height;\r\n      } */\r\n\r\n      /* if(touchSupport) {\r\n        this.restoreScroll();\r\n      } */\r\n    } else {\r\n      this.dispatchEvent('close');\r\n\r\n      this.element.classList.remove('active');\r\n\r\n      clearTimeout(this.displayTimeout);\r\n      this.displayTimeout = window.setTimeout(() => {\r\n        this.element.style.display = 'none';\r\n        this.forceClose = false;\r\n        this.dispatchEvent('closed');\r\n      }, IS_TOUCH_SUPPORTED ? 0 : ANIMATION_DURATION);\r\n\r\n      /* if(isTouchSupported) {\r\n        const scrollHeight = this.container.scrollHeight;\r\n        if(scrollHeight) {\r\n          const height = this.container.scrollHeight + appImManager.chat.input.inputContainer.scrollHeight - 10;\r\n          appImManager.chat.bubbles.scrollable.scrollTop -= height;\r\n        }\r\n      } */\r\n\r\n      /* if(touchSupport) {\r\n        this.restoreScroll();\r\n      } */\r\n    }\r\n\r\n    // animationIntersector.checkAnimations(false, EMOTICONSSTICKERGROUP);\r\n  };\r\n\r\n  public isActive() {\r\n    return this.element.classList.contains('active');\r\n  }\r\n\r\n  public setIgnoreMouseOut(ignore: boolean) {\r\n    this.ignoreMouseOut = ignore;\r\n  }\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\n// * Jolly Cobra's fastSmoothScroll slightly patched\r\n\r\nimport {dispatchHeavyAnimationEvent} from '../hooks/useHeavyAnimationCheck';\r\nimport {fastRaf, fastRafPromise} from './schedulers';\r\nimport {animateSingle, cancelAnimationByKey} from './animation';\r\nimport rootScope from '../lib/rootScope';\r\nimport isInDOM from './dom/isInDOM';\r\n\r\nconst MIN_JS_DURATION = 250;\r\nconst MAX_JS_DURATION = 600;\r\nconst LONG_TRANSITION_MAX_DISTANCE = 1500;\r\nconst SHORT_TRANSITION_MAX_DISTANCE = 500;\r\n\r\nexport enum FocusDirection {\r\n  Up,\r\n  Down,\r\n  Static,\r\n};\r\n\r\nexport type ScrollGetNormalSizeCallback = (options: {rect: DOMRect}) => number;\r\nexport type ScrollStartCallbackDimensions = {\r\n  scrollSize: number,\r\n  scrollPosition: number,\r\n  distanceToEnd: number,\r\n  path: number,\r\n  duration: number,\r\n  containerRect: DOMRect,\r\n  elementRect: DOMRect,\r\n  getProgress: () => number\r\n};\r\n\r\nexport type ScrollOptions = {\r\n  container: HTMLElement,\r\n  element: HTMLElement,\r\n  position: ScrollLogicalPosition,\r\n  margin?: number,\r\n  maxDistance?: number,\r\n  forceDirection?: FocusDirection,\r\n  forceDuration?: number,\r\n  axis?: 'x' | 'y',\r\n  getNormalSize?: ScrollGetNormalSizeCallback,\r\n  fallbackToElementStartWhenCentering?: HTMLElement,\r\n  startCallback?: (dimensions: ScrollStartCallbackDimensions) => void\r\n};\r\n\r\nexport default function fastSmoothScroll(options: ScrollOptions) {\r\n  if(options.margin === undefined) {\r\n    options.margin = 0;\r\n  }\r\n\r\n  if(options.maxDistance === undefined) {\r\n    options.maxDistance = LONG_TRANSITION_MAX_DISTANCE;\r\n  }\r\n\r\n  if(options.axis === undefined) {\r\n    options.axis = 'y';\r\n  }\r\n  // return;\r\n\r\n  if(!rootScope.settings.animationsEnabled) {\r\n    options.forceDirection = FocusDirection.Static;\r\n  }\r\n\r\n  if(options.forceDirection === FocusDirection.Static) {\r\n    options.forceDuration = 0;\r\n    return scrollWithJs(options);\r\n    /* return Promise.resolve();\r\n\r\n    element.scrollIntoView({ block: position });\r\n\r\n    cancelAnimationByKey(container);\r\n    return Promise.resolve(); */\r\n  }\r\n\r\n  const promise = fastRafPromise().then(() => scrollWithJs(options));\r\n\r\n  return options.axis === 'y' ? dispatchHeavyAnimationEvent(promise) : promise;\r\n}\r\n\r\nfunction scrollWithJs(options: ScrollOptions): Promise<void> {\r\n  const {element, container, getNormalSize, axis, margin, position, forceDirection, maxDistance, forceDuration} = options;\r\n  if(!isInDOM(element)) {\r\n    cancelAnimationByKey(container);\r\n    return Promise.resolve();\r\n  }\r\n\r\n  const rectStartKey = axis === 'y' ? 'top' : 'left';\r\n  const rectEndKey = axis === 'y' ? 'bottom' : 'right';\r\n  const sizeKey = axis === 'y' ? 'height' : 'width';\r\n  const scrollSizeKey = axis === 'y' ? 'scrollHeight' : 'scrollWidth';\r\n  const scrollPositionKey = axis === 'y' ? 'scrollTop' : 'scrollLeft';\r\n\r\n  // const { offsetTop: elementTop, offsetHeight: elementHeight } = element;\r\n  const elementRect = element.getBoundingClientRect();\r\n  const containerRect = container.getBoundingClientRect ? container.getBoundingClientRect() : document.body.getBoundingClientRect();\r\n\r\n  // const transformable = container.firstElementChild as HTMLElement;\r\n\r\n  const elementPosition = elementRect[rectStartKey] - containerRect[rectStartKey];\r\n  const elementSize = element[scrollSizeKey]; // margin is exclusive in DOMRect\r\n\r\n  const containerSize = getNormalSize ? getNormalSize({rect: containerRect}) : containerRect[sizeKey];\r\n\r\n  let scrollPosition = container[scrollPositionKey];\r\n  const scrollSize = container[scrollSizeKey];\r\n  /* const elementPosition = element.offsetTop;\r\n  const elementSize = element.offsetHeight;\r\n\r\n  const scrollPosition = container[scrollPositionKey];\r\n  const scrollSize = container[scrollSizeKey];\r\n  const containerSize = container.offsetHeight; */\r\n\r\n  let path!: number;\r\n\r\n  switch(position) {\r\n    case 'start':\r\n      path = elementPosition - margin;\r\n      break;\r\n    case 'end':\r\n      path = elementRect[rectEndKey] /* + (elementSize - elementRect[sizeKey]) */ - containerRect[rectEndKey] + margin;\r\n      break;\r\n    // 'nearest' is not supported yet\r\n    case 'nearest':\r\n    case 'center':\r\n      if(elementSize < containerSize) {\r\n        path = (elementPosition + elementSize / 2) - (containerSize / 2);\r\n      } else {\r\n        if(options.fallbackToElementStartWhenCentering && options.fallbackToElementStartWhenCentering !== element) {\r\n          options.element = options.fallbackToElementStartWhenCentering;\r\n          options.position = 'start';\r\n          return scrollWithJs(options);\r\n        }\r\n\r\n        path = elementPosition - margin;\r\n      }\r\n\r\n      break;\r\n  }\r\n  /* switch (position) {\r\n    case 'start':\r\n      path = (elementPosition - margin) - scrollPosition;\r\n      break;\r\n    case 'end':\r\n      path = (elementPosition + elementSize + margin) - (scrollPosition + containerSize);\r\n      break;\r\n    // 'nearest' is not supported yet\r\n    case 'nearest':\r\n    case 'center':\r\n      path = elementSize < containerSize\r\n        ? (elementPosition + elementSize / 2) - (scrollPosition + containerSize / 2)\r\n        : (elementPosition - margin) - scrollPosition;\r\n      break;\r\n  } */\r\n\r\n  if(Math.abs(path - (margin || 0)) < 1) {\r\n    cancelAnimationByKey(container);\r\n    return Promise.resolve();\r\n  }\r\n\r\n  if(axis === 'y') {\r\n    if(forceDirection === undefined) {\r\n      if(path > maxDistance) {\r\n        scrollPosition = container.scrollTop += path - maxDistance;\r\n        path = maxDistance;\r\n      } else if(path < -maxDistance) {\r\n        scrollPosition = container.scrollTop += path + maxDistance;\r\n        path = -maxDistance;\r\n      }\r\n    }/*  else if(forceDirection === FocusDirection.Up) { // * not tested yet\r\n      container.scrollTop = offsetTop + container.scrollTop + maxDistance;\r\n    } else if(forceDirection === FocusDirection.Down) { // * not tested yet\r\n      container.scrollTop = Math.max(0, offsetTop + container.scrollTop - maxDistance);\r\n    } */\r\n  }\r\n\r\n  // console.log('scrollWithJs: will scroll path:', path, element);\r\n\r\n  /* let existsTransform = 0;\r\n  const currentTransform = transformable.style.transform;\r\n  if(currentTransform) {\r\n    existsTransform = parseInt(currentTransform.match(/\\((.+?), (.+?), .+\\)/)[2]);\r\n    //path += existsTransform;\r\n  } */\r\n\r\n  if(path < 0) {\r\n    const remainingPath = -scrollPosition;\r\n    path = Math.max(path, remainingPath);\r\n  } else if(path > 0) {\r\n    const remainingPath = scrollSize - (scrollPosition + containerSize);\r\n    path = Math.min(path, remainingPath);\r\n  }\r\n\r\n  const target = container[scrollPositionKey] + path;\r\n  const absPath = Math.abs(path);\r\n  const duration = forceDuration ?? (\r\n    MIN_JS_DURATION + (absPath / LONG_TRANSITION_MAX_DISTANCE) * (MAX_JS_DURATION - MIN_JS_DURATION)\r\n  );\r\n  const startAt = Date.now();\r\n\r\n  /* transformable.classList.add('no-transition');\r\n\r\n  const tickTransform = () => {\r\n    const t = duration ? Math.min((Date.now() - startAt) / duration, 1) : 1;\r\n    const currentPath = path * transition(t);\r\n\r\n    transformable.style.transform = `translate3d(0, ${-currentPath}px, 0)`;\r\n    container.dataset.translate = '' + -currentPath;\r\n\r\n    const willContinue = t < 1;\r\n    if(!willContinue) {\r\n      fastRaf(() => {\r\n        delete container.dataset.transform;\r\n        container.dataset.transform = '';\r\n        transformable.style.transform = '';\r\n        void transformable.offsetLeft; // reflow\r\n        transformable.classList.remove('no-transition');\r\n        void transformable.offsetLeft; // reflow\r\n        container[scrollPositionKey] = Math.round(target);\r\n      });\r\n    }\r\n\r\n    return willContinue;\r\n  };\r\n\r\n  return animateSingle(tickTransform, container); */\r\n\r\n  /* return new Promise((resolve) => {\r\n    fastRaf(() => {\r\n      transformable.style.transform = '';\r\n      transformable.style.transition = '';\r\n\r\n      setTimeout(resolve, duration);\r\n    });\r\n  });\r\n\r\n  const transformableHeight = transformable.scrollHeight;\r\n  //transformable.style.minHeight = `${transformableHeight}px`;\r\n  */\r\n\r\n  const transition = absPath < SHORT_TRANSITION_MAX_DISTANCE ? shortTransition : longTransition;\r\n  const getProgress = () => duration ? Math.min((Date.now() - startAt) / duration, 1) : 1;\r\n  const tick = () => {\r\n    const t = getProgress();\r\n    const value = transition(t);\r\n    const currentPath = path * (1 - value);\r\n    container[scrollPositionKey] = Math.round(target - currentPath);\r\n\r\n    return t < 1;\r\n  };\r\n\r\n  if(!duration || !path) {\r\n    cancelAnimationByKey(container);\r\n    tick();\r\n    return Promise.resolve();\r\n  }\r\n\r\n  /* return new Promise((resolve) => {\r\n    setTimeout(resolve, duration);\r\n  }).then(() => {\r\n    transformable.classList.add('no-transition');\r\n    void transformable.offsetLeft; // reflow\r\n    transformable.style.transform = '';\r\n    transformable.style.transition = '';\r\n    void transformable.offsetLeft; // reflow\r\n    transformable.classList.remove('no-transition');\r\n    void transformable.offsetLeft; // reflow\r\n    fastRaf(() => {\r\n\r\n      container[scrollPositionKey] = Math.round(target);\r\n      //transformable.style.minHeight = ``;\r\n    });\r\n\r\n  }); */\r\n\r\n  if(options.startCallback) {\r\n    const distanceToEnd = scrollSize - Math.round(target + container[axis === 'y' ? 'offsetHeight' : 'offsetWidth']);\r\n    options.startCallback({\r\n      scrollSize,\r\n      scrollPosition,\r\n      distanceToEnd,\r\n      path,\r\n      duration,\r\n      containerRect,\r\n      elementRect,\r\n      getProgress\r\n    });\r\n  }\r\n\r\n  return animateSingle(tick, container);\r\n}\r\n\r\nfunction longTransition(t: number) {\r\n  return 1 - ((1 - t) ** 5);\r\n}\r\n\r\nfunction shortTransition(t: number) {\r\n  return 1 - ((1 - t) ** 3.5);\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport type {InputFileLocation, InputStickerSet, InputWebFileLocation} from '../layer';\r\nimport type {DownloadOptions} from '../lib/mtproto/apiFileManager';\r\n\r\nconst FILENAME_JOINER = '_';\r\n\r\nexport function getFileNameByLocation(location: InputFileLocation | InputWebFileLocation, options?: Partial<{\r\n  fileName: string,\r\n  downloadId: string\r\n}>) {\r\n  const fileName = '';// (options?.fileName || '').split('.');\r\n  const ext = fileName[fileName.length - 1] || '';\r\n\r\n  let str: string;\r\n  switch(location._) {\r\n    case 'inputPhotoFileLocation': {\r\n      str = ['photo', fileName[0], location.id, location.thumb_size].filter(Boolean).join(FILENAME_JOINER);\r\n      break;\r\n    }\r\n\r\n    case 'inputDocumentFileLocation': {\r\n      str = ['document', fileName[0], location.id, location.thumb_size].filter(Boolean).join(FILENAME_JOINER);\r\n      break;\r\n    }\r\n\r\n    case 'inputPeerPhotoFileLocation':\r\n      str = ['peerPhoto', location.photo_id, location.pFlags.big ? 'big' : 'small'].join(FILENAME_JOINER);\r\n      break;\r\n\r\n    case 'inputStickerSetThumb': {\r\n      const id = (location.stickerset as InputStickerSet.inputStickerSetID).id ||\r\n        (location.stickerset as InputStickerSet.inputStickerSetShortName).short_name ||\r\n        (location.stickerset as InputStickerSet.inputStickerSetDice).emoticon ||\r\n        location.stickerset._;\r\n      str = ['stickerSetThumb', id, location.thumb_version].join(FILENAME_JOINER);\r\n      break;\r\n    }\r\n\r\n    case 'inputFileLocation': {\r\n      str = location.volume_id + '_' + location.local_id;\r\n      break;\r\n    }\r\n\r\n    case 'inputWebFileLocation': {\r\n      str = ['webFile', location.url].join(FILENAME_JOINER);\r\n      break;\r\n    }\r\n\r\n    default: {\r\n      console.error('Unrecognized location:', location);\r\n      str = '';\r\n      break;\r\n    }\r\n  }\r\n\r\n  return str + (options?.downloadId ? '_download' : '') + (ext ? '.' + ext : ext);\r\n}\r\n\r\nexport type FileURLType = 'photo' | 'thumb' | 'document' | 'stream' | 'download';\r\nexport function getFileURL(type: FileURLType, options: DownloadOptions) {\r\n  // console.log('getFileURL', location);\r\n  // const perf = performance.now();\r\n  const encoded = encodeURIComponent(JSON.stringify(options));\r\n  // console.log('getFileURL encode:', performance.now() - perf, encoded);\r\n\r\n  return /* '/' +  */type + '/' + encoded;\r\n}\r\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport type {Message, MessageAction} from '../layer';\nimport type {MyMessage} from '../lib/appManagers/appMessagesManager';\nimport forEachReverse from './array/forEachReverse';\n\nexport default function filterChatPhotosMessages(value: {\n  count: number;\n  next_rate: number;\n  offset_id_offset: number;\n  history: MyMessage[];\n}) {\n  forEachReverse(value.history, (message, idx, arr) => {\n    if(!((message as Message.messageService).action as MessageAction.messageActionChatEditPhoto).photo) {\n      arr.splice(idx, 1);\n      if(value.count !== undefined) {\n        --value.count;\n      }\n    }\n  });\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport {i18n, LangPackKey} from '../lib/langPack';\n\nexport default function formatBytes(bytes: number, decimals: number | 'auto' = 'auto') {\n  if(bytes === 0) return i18n('FileSize.B', [0]);\n\n  const strictDecimals = decimals === 'auto';\n\n  const k = 1024;\n  const i = Math.floor(Math.log(bytes) / Math.log(k));\n  const _decimals = decimals === 'auto' ? Math.max(0, i - 1) : decimals;\n\n  const dm = Math.max(0, _decimals);\n  const sizes: LangPackKey[] = ['FileSize.B', 'FileSize.KB', 'FileSize.MB', 'FileSize.GB'];\n\n  const fixed = (bytes / Math.pow(k, i)).toFixed(dm);\n  return i18n(sizes[i], [strictDecimals ? fixed : parseFloat(fixed)]);\n}\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport I18n, {i18n, join, LangPackKey} from '../lib/langPack';\r\nimport formatDuration, {DurationType} from './formatDuration';\r\n\r\nconst CALL_DURATION_LANG_KEYS: {[type in DurationType]: LangPackKey} = {\r\n  s: 'Seconds',\r\n  m: 'Minutes',\r\n  h: 'Hours',\r\n  d: 'Days',\r\n  w: 'Weeks'\r\n};\r\nexport default function formatCallDuration(duration: number, plain?: boolean) {\r\n  const a = formatDuration(duration, 2);\r\n  if(plain) {\r\n    const strings = a.map((d) => I18n.format(CALL_DURATION_LANG_KEYS[d.type], true, [d.duration]));\r\n    return join(strings, false, plain);\r\n  }\r\n\r\n  const elements = a.map((d) => i18n(CALL_DURATION_LANG_KEYS[d.type], [d.duration]));\r\n\r\n  const fragment = document.createElement('span');\r\n  fragment.append(...join(elements, false));\r\n\r\n  return fragment;\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nexport type DurationType = 's' | 'm' | 'h' | 'd' | 'w';\r\nexport default function formatDuration(duration: number, showLast = 2) {\r\n  if(!duration) {\r\n    duration = 1;\r\n  }\r\n\r\n  const d: {duration: number, type: DurationType}[] = [];\r\n  const p = [\r\n    {m: 1, t: 's'},\r\n    {m: 60, t: 'm'},\r\n    {m: 60, t: 'h'},\r\n    {m: 24, t: 'd'},\r\n    {m: 7, t: 'w'}\r\n  ] as Array<{m?: number, t: DurationType}>\r\n  const s = 1;\r\n  let t = s;\r\n  p.forEach((o, idx) => {\r\n    t *= o.m;\r\n\r\n    if(duration < t) {\r\n      return;\r\n    }\r\n\r\n    const modulus = p[idx === (p.length - 1) ? idx : idx + 1].m;\r\n    d.push({\r\n      duration: (duration / t % modulus | 0),\r\n      type: o.t\r\n    });\r\n  });\r\n\r\n  const out = d.slice(-showLast).reverse();\r\n  for(let i = out.length - 1; i >= 0; --i) {\r\n    if(out[i].duration === 0) {\r\n      out.splice(i, 1);\r\n    }\r\n  }\r\n\r\n  return out;\r\n}\r\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport {HelpCountry, HelpCountryCode} from '../layer';\nimport I18n from '../lib/langPack';\n\nlet sortedCountries: HelpCountry[];\ntype PrefixCountry = {country: HelpCountry, code: HelpCountryCode};\nconst prefixes: Map<string, PrefixCountry> = new Map();\nlet maxPrefixLength = 0;\nconst setPrefix = (country: HelpCountry, code: HelpCountryCode, prefix: string = '') => {\n  prefix = code.country_code + prefix;\n  /* if(prefixes.has(prefix)) {\n    console.error('asdasdasd', prefixes.get(prefix), country, code);\n  } */\n  maxPrefixLength = Math.max(maxPrefixLength, prefix.length);\n  prefixes.set(prefix, {country, code});\n};\n\nexport function formatPhoneNumber(originalStr: string): {\n  formatted: string,\n  country: HelpCountry,\n  code: HelpCountryCode,\n  leftPattern: string\n} {\n  originalStr = originalStr || '';\n\n  if(!prefixes.size) {\n    I18n.countriesList.forEach((country) => {\n      country.country_codes.forEach((code) => {\n        if(code.prefixes) {\n          code.prefixes.forEach((prefix) => {\n            setPrefix(country, code, prefix);\n          });\n        } else {\n          setPrefix(country, code);\n        }\n      });\n    });\n  }\n\n  // return {formatted: originalStr, country: undefined as any, leftPattern: ''};\n  let str = originalStr.replace(/\\D/g, '');\n  const phoneCode = str.slice(0, maxPrefixLength);\n\n  // //console.log('str', str, phoneCode);\n  // if(!sortedCountries) {\n  //   sortedCountries = I18n.countriesList.slice().sort((a, b) => b.country_codes[0].country_code.length - a.country_codes[0].country_code.length);\n  // }\n\n  // let country = sortedCountries.find((c) => {\n  //   return c.country_codes.find((c) => phoneCode.indexOf(c.replace(/\\D/g, '')) === 0);\n  // });\n\n  let prefixCountry: PrefixCountry;\n  for(let i = phoneCode.length - 1; i >= 0; --i) { // lookup for country by prefix\n    prefixCountry = prefixes.get(phoneCode.slice(0, i + 1));\n    if(prefixCountry) {\n      break;\n    }\n  }\n\n  if(!prefixCountry) {\n    return {\n      formatted: str,\n      country: undefined,\n      code: undefined,\n      leftPattern: ''\n    };\n  }\n\n  // country = /* PhoneCodesMain[country.phoneCode] ||  */country;\n  const country = prefixCountry.country;\n\n  const patterns = prefixCountry.code.patterns || [];\n  const searchForPattern = str.slice(prefixCountry.code.country_code.length); // splice country code\n  let pattern = '', mostMatchedPatternMatches = 0, mostMatchedPattern = '';\n  for(let i = patterns.length - 1; i >= 0; --i) {\n    pattern = patterns[i];\n\n    const _pattern = pattern.replace(/ /g, '');\n    let patternMatches = 0;\n    for(let k = 0, length = Math.min(searchForPattern.length, _pattern.length); k < length; ++k) {\n      if(searchForPattern[k] === _pattern[k] || _pattern[k] === 'X') {\n        ++patternMatches;\n      } else {\n        patternMatches = 0;\n        break;\n      }\n    }\n\n    if(patternMatches > mostMatchedPatternMatches) {\n      mostMatchedPatternMatches = patternMatches;\n      mostMatchedPattern = pattern;\n    }\n  }\n\n  pattern = mostMatchedPattern || pattern;\n  pattern = pattern.replace(/\\d/g, 'X');\n\n  pattern = prefixCountry.code.country_code + ' ' + pattern;\n  // let pattern = country.pattern || country.phoneCode;\n  pattern.split('').forEach((symbol, idx) => {\n    if(symbol === ' ' && str[idx] !== ' ' && str.length > idx) {\n      str = str.slice(0, idx) + ' ' + str.slice(idx);\n    }\n  });\n\n  /* if(country.pattern) {\n    str = str.slice(0, country.pattern.length);\n  } */\n\n  let leftPattern = pattern && pattern.length > str.length ? pattern.slice(str.length) : '';\n  if(leftPattern) {\n    /* const length = str.length;\n    leftPattern = leftPattern.split('').map((_, idx) => (length + idx).toString().slice(-1)).join(''); */\n    leftPattern = leftPattern.replace(/X/g, '');\n    // leftPattern = leftPattern.replace(/X/g, '0');\n  }\n\n  return {formatted: str, country, code: prefixCountry.code, leftPattern};\n}\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\n// generate a path's arc data parameter\r\n\r\nimport {MOUNT_CLASS_TO} from '../config/debug';\r\n\r\n// http://www.w3.org/TR/SVG/paths.html#PathDataEllipticalArcCommands\r\nfunction arcParameter(rx: number, ry: number, xAxisRotation: number, largeArcFlag: number, sweepFlag: number, x: number, y: number) {\r\n  return [rx, ',', ry, ' ',\r\n    xAxisRotation, ' ',\r\n    largeArcFlag, ',',\r\n    sweepFlag, ' ',\r\n    x, ',', y].join('');\r\n}\r\n\r\nexport default function generatePathData(x: number, y: number, width: number, height: number, tl: number, tr: number, br: number, bl: number) {\r\n  const data: string[] = [];\r\n\r\n  // start point in top-middle of the rectangle\r\n  data.push('M' + (x + width / 2) + ',' + y);\r\n\r\n  // next we go to the right\r\n  data.push('H' + (x + width - tr));\r\n\r\n  if(tr > 0) {\r\n    // now we draw the arc in the top-right corner\r\n    data.push('A' + arcParameter(tr, tr, 0, 0, 1, (x + width), (y + tr)));\r\n  }\r\n\r\n  // next we go down\r\n  data.push('V' + (y + height - br));\r\n\r\n  if(br > 0) {\r\n    // now we draw the arc in the lower-right corner\r\n    data.push('A' + arcParameter(br, br, 0, 0, 1, (x + width - br), (y + height)));\r\n  }\r\n\r\n  // now we go to the left\r\n  data.push('H' + (x + bl));\r\n\r\n  if(bl > 0) {\r\n    // now we draw the arc in the lower-left corner\r\n    data.push('A' + arcParameter(bl, bl, 0, 0, 1, (x + 0), (y + height - bl)));\r\n  }\r\n\r\n  // next we go up\r\n  data.push('V' + (y + tl));\r\n\r\n  if(tl > 0) {\r\n    // now we draw the arc in the top-left corner\r\n    data.push('A' + arcParameter(tl, tl, 0, 0, 1, (x + tl), (y + 0)));\r\n  }\r\n\r\n  // and we close the path\r\n  data.push('Z');\r\n\r\n  return data.join(' ');\r\n}\r\n\r\nMOUNT_CLASS_TO.generatePathData = generatePathData;\r\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport {PhotoSize} from '../layer';\nimport {MyDocument} from '../lib/appManagers/appDocsManager';\nimport {MyPhoto} from '../lib/appManagers/appPhotosManager';\nimport {renderImageFromUrlPromise} from './dom/renderImageFromUrl';\nimport getPreviewURLFromThumb from './getPreviewURLFromThumb';\nimport blur from './blur';\n\nexport default function getImageFromStrippedThumb(photo: MyPhoto | MyDocument, thumb: PhotoSize.photoCachedSize | PhotoSize.photoStrippedSize, useBlur: boolean) {\n  const url = getPreviewURLFromThumb(photo, thumb, false);\n\n  let element: HTMLImageElement | HTMLCanvasElement, loadPromise: Promise<void>;\n  if(!useBlur) {\n    element = new Image();\n    loadPromise = renderImageFromUrlPromise(element, url);\n  } else {\n    const result = blur(url);\n    element = result.canvas;\n    loadPromise = result.promise;\n  }\n\n  element.classList.add('thumbnail');\n\n  return {image: element, loadPromise};\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport type {MyDocument} from '../lib/appManagers/appDocsManager';\nimport type {MyPhoto} from '../lib/appManagers/appPhotosManager';\nimport {PhotoSize} from '../layer';\n// import appDownloadManager from \"../lib/appManagers/appDownloadManager\";\nimport getPreviewURLFromBytes from './bytes/getPreviewURLFromBytes';\n\nexport default function getPreviewURLFromThumb(photo: MyPhoto | MyDocument, thumb: PhotoSize.photoCachedSize | PhotoSize.photoStrippedSize, isSticker = false) {\n  // const cacheContext = appDownloadManager.getCacheContext(photo, thumb.type);\n  // return cacheContext.url || (cacheContext.url = getPreviewURLFromBytes(thumb.bytes, isSticker));\n  return getPreviewURLFromBytes(thumb.bytes, isSticker);\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport type {MyDocument} from '../lib/appManagers/appDocsManager';\nimport type {MyPhoto} from '../lib/appManagers/appPhotosManager';\nimport {THUMB_TYPE_FULL} from '../lib/mtproto/mtproto_config';\nimport type {ThumbCache} from '../lib/storages/thumbs';\nimport getImageFromStrippedThumb from './getImageFromStrippedThumb';\n\nexport default function getStrippedThumbIfNeeded(photo: MyPhoto | MyDocument, cacheContext: ThumbCache, useBlur: boolean, ignoreCache = false) {\n  const isVideo = (['video', 'gif'] as MyDocument['type'][]).includes((photo as MyDocument).type);\n  if(!cacheContext.downloaded || isVideo || ignoreCache) {\n    if(\n      photo._ === 'document' &&\n      cacheContext.downloaded &&\n      !ignoreCache &&\n      (!isVideo || cacheContext.type !== THUMB_TYPE_FULL)\n    ) {\n      return null;\n    }\n\n    const sizes = (photo as MyPhoto).sizes || (photo as MyDocument).thumbs;\n    const thumb = sizes?.length ? sizes.find((size) => size._ === 'photoStrippedSize') : null;\n    if(thumb && ('bytes' in thumb)) {\n      return getImageFromStrippedThumb(photo, thumb as any, useBlur);\n    }\n  }\n\n  return null;\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport forEachReverse from './array/forEachReverse';\nimport safeAssign from './object/safeAssign';\n\nexport type ListLoaderOptions<T extends {}, P extends {}> = {\n  loadMore: ListLoader<T, P>['loadMore'],\n  loadCount?: ListLoader<T, P>['loadCount'],\n  loadWhenLeft?: ListLoader<T, P>['loadWhenLeft'],\n  processItem?: ListLoader<T, P>['processItem'],\n  onJump?: ListLoader<T, P>['onJump'],\n  onLoadedMore?: ListLoader<T, P>['onLoadedMore']\n};\n\nexport type ListLoaderResult<T extends {}> = {count: number, items: any[]};\nexport default class ListLoader<T extends {}, P extends {}> {\n  public current: T;\n  public previous: T[] = [];\n  public next: T[] = [];\n  public count: number;\n  public reverse = false; // reverse means next = higher msgid\n\n  protected loadMore: (anchor: T, older: boolean, loadCount: number) => Promise<ListLoaderResult<T>>;\n  protected processItem: (item: P) => T | Promise<T>;\n  protected loadCount = 50;\n  protected loadWhenLeft = 20;\n\n  public onJump: (item: T, older: boolean) => void;\n  public onLoadedMore: () => void;\n\n  protected loadedAllUp = false;\n  protected loadedAllDown = false;\n  protected loadPromiseUp: Promise<void>;\n  protected loadPromiseDown: Promise<void>;\n\n  constructor(options: ListLoaderOptions<T, P>) {\n    safeAssign(this, options);\n  }\n\n  public setTargets(previous: T[], next: T[], reverse: boolean) {\n    this.previous = previous;\n    this.next = next;\n    this.reverse = reverse;\n  }\n\n  public get index() {\n    return this.count !== undefined ? this.previous.length : -1;\n  }\n\n  /* public filter(callback: (item: T, idx: number, arr: T[]) => boolean) {\n    const filter = (item: T, idx: number, arr: T[]) => {\n      if(!callback(item, idx, arr)) {\n        arr.splice(idx, 1);\n      }\n    };\n\n    forEachReverse(this.previous, filter);\n    forEachReverse(this.next, filter);\n  } */\n\n  public reset(loadedAll = false) {\n    this.current = undefined;\n    this.previous = [];\n    this.next = [];\n    this.setLoaded(true, loadedAll);\n    this.setLoaded(false, loadedAll);\n  }\n\n  public go(length: number, dispatchJump = true) {\n    let items: T[], item: T;\n    if(length > 0) {\n      items = this.next.splice(0, length);\n      item = items.pop();\n      if(!item) {\n        return;\n      }\n\n      if(this.current !== undefined) items.unshift(this.current);\n      this.previous.push(...items);\n    } else {\n      items = this.previous.splice(Math.max(0, this.previous.length + length), -length);\n      item = items.shift();\n      if(!item) {\n        return;\n      }\n\n      if(this.current !== undefined) items.push(this.current);\n      this.next.unshift(...items);\n    }\n\n    if(this.next.length < this.loadWhenLeft) {\n      this.load(!this.reverse);\n    }\n\n    if(this.previous.length < this.loadWhenLeft) {\n      this.load(this.reverse);\n    }\n\n    this.current = item;\n    dispatchJump && this.onJump && this.onJump(item, length > 0);\n    return this.current;\n  }\n\n  protected unsetCurrent(toPrevious: boolean) {\n    if(toPrevious) this.previous.push(this.current);\n    else this.next.unshift(this.current);\n\n    this.current = undefined;\n  }\n\n  public goUnsafe(length: number, dispatchJump?: boolean) {\n    const leftLength = length > 0 ? Math.max(0, length - this.next.length) : Math.min(0, length + this.previous.length);\n    const item = this.go(length, leftLength ? false : dispatchJump);\n\n    /* if(length > 0 ? this.loadedAllUp : this.loadedAllDown) {\n      this.unsetCurrent(length > 0);\n    } */\n\n    return {\n      item: !leftLength ? item : undefined,\n      leftLength\n    };\n  }\n\n  protected setLoaded(down: boolean, value: boolean) {\n    const isChanged = (down ? this.loadedAllDown : this.loadedAllUp) !== value;\n    if(!isChanged) {\n      return false;\n    }\n\n    if(down) this.loadedAllDown = value;\n    else this.loadedAllUp = value;\n\n    if(!value) {\n      if(down) this.loadPromiseDown = null;\n      else this.loadPromiseUp = null;\n    }\n\n    return true;\n  }\n\n  //      reverse  loadMediaPromise\n  public load(older: boolean) {\n    if(older ? this.loadedAllDown : this.loadedAllUp) return Promise.resolve();\n\n    let promise = older ? this.loadPromiseDown : this.loadPromiseUp;\n    if(promise) return promise;\n\n    let anchor: T;\n    if(older) {\n      anchor = this.reverse ? this.previous[0] : this.next[this.next.length - 1];\n    } else {\n      anchor = this.reverse ? this.next[this.next.length - 1] : this.previous[0];\n    }\n\n    anchor ??= this.current;\n    promise = this.loadMore(anchor, older, this.loadCount).then(async(result) => {\n      if((older ? this.loadPromiseDown : this.loadPromiseUp) !== promise) {\n        return;\n      }\n\n      if(result.items.length < this.loadCount) {\n        this.setLoaded(older, true);\n      }\n\n      if(this.count === undefined) {\n        this.count = result.count || result.items.length;\n      }\n\n      const processedArr: (Promise<any> | any)[] = [];\n      const method = older ? result.items.forEach.bind(result.items) : forEachReverse.bind(null, result.items);\n      method((item: any) => {\n        const processed = this.processItem ? this.processItem(item) : item;\n\n        if(!processed) return;\n        processedArr.push(processed);\n      });\n\n      const results = await Promise.all(processedArr);\n      if(older) {\n        if(this.reverse) this.previous.unshift(...results);\n        else this.next.push(...results);\n      } else {\n        if(this.reverse) this.next.push(...results);\n        else this.previous.unshift(...results);\n      }\n\n      this.onLoadedMore && this.onLoadedMore();\n    }, () => {}).then(() => {\n      if(older) this.loadPromiseDown = null;\n      else this.loadPromiseUp = null;\n    });\n\n    if(older) this.loadPromiseDown = promise;\n    else this.loadPromiseUp = promise;\n\n    return promise;\n  }\n}\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport type EventListenerBase from './eventListenerBase';\r\n\r\nexport type Listener = {\r\n  element: ListenerElement,\r\n  event: ListenerEvent,\r\n  callback: ListenerCallback,\r\n  options?: ListenerOptions,\r\n\r\n  onceFired?: true, // will be set only when options.once is set\r\n  onceCallback?: () => void,\r\n};\r\n\r\nexport type ListenerElement = Window | Document | HTMLElement | Element | EventListenerBase<any>;\r\nexport type ListenerEvent = string;\r\nexport type ListenerCallback = Function;\r\nexport type ListenerOptions = AddEventListenerOptions;\r\n\r\n/* const originalAddEventListener = HTMLElement.prototype.addEventListener;\r\nHTMLElement.prototype.addEventListener = function(this, name: string, callback: EventListenerOrEventListenerObject, options: AddEventListenerOptions) {\r\n  console.log('nu zdarova', name);\r\n  originalAddEventListener.call(this, name, callback, options);\r\n\r\n  if(options?.ls) {\r\n    return options.ls.addFromElement(this, name, callback as any, options);\r\n  }\r\n}; */\r\n\r\nexport default class ListenerSetter {\r\n  private listeners: Set<Listener> = new Set();\r\n\r\n  public add<T extends ListenerElement>(element: T): T['addEventListener'] {\r\n    return ((event: string, callback: Function, options: ListenerOptions) => {\r\n      const listener: Listener = {element, event, callback, options};\r\n      this.addManual(listener);\r\n      return listener;\r\n    }) as any;\r\n  }\r\n\r\n  /* public addFromElement<T extends ListenerElement>(element: T, event: ListenerEvent, callback: ListenerCallback, options: ListenerOptions) {\r\n    const listener: Listener = {element, event, callback, options};\r\n    this.addManual(listener);\r\n    return listener;\r\n  } */\r\n\r\n  public addManual(listener: Listener) {\r\n    // @ts-ignore\r\n    listener.element.addEventListener(listener.event, listener.callback, listener.options);\r\n\r\n    if(listener.options?.once) { // remove listener when its called\r\n      listener.onceCallback = () => {\r\n        this.remove(listener);\r\n        listener.onceFired = true;\r\n      };\r\n\r\n      // @ts-ignore\r\n      listener.element.addEventListener(listener.event, listener.onceCallback, listener.options);\r\n    }\r\n\r\n    this.listeners.add(listener);\r\n  }\r\n\r\n  public remove(listener: Listener) {\r\n    if(!listener.onceFired) {\r\n      // @ts-ignore\r\n      listener.element.removeEventListener(listener.event, listener.callback, listener.options);\r\n\r\n      if(listener.onceCallback) {\r\n        // @ts-ignore\r\n        listener.element.removeEventListener(listener.event, listener.onceCallback, listener.options);\r\n      }\r\n    }\r\n\r\n    this.listeners.delete(listener);\r\n  }\r\n\r\n  public removeManual<T extends ListenerElement>(\r\n    element: T,\r\n    event: ListenerEvent,\r\n    callback: ListenerCallback,\r\n    options?: ListenerOptions\r\n  ) {\r\n    let listener: Listener;\r\n    for(const _listener of this.listeners) {\r\n      if(_listener.element === element &&\r\n        _listener.event === event &&\r\n        _listener.callback === callback &&\r\n        _listener.options === options) {\r\n        listener = _listener;\r\n        break;\r\n      }\r\n    }\r\n\r\n    if(listener) {\r\n      this.remove(listener);\r\n    }\r\n  }\r\n\r\n  public removeAll() {\r\n    this.listeners.forEach((listener) => {\r\n      this.remove(listener);\r\n    });\r\n  }\r\n}\r\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport calcImageInBox from './calcImageInBox';\n\nexport class MediaSize {\n  constructor(public width = 0, public height = width) {\n\n  }\n\n  public aspect(boxSize: MediaSize, fitted: boolean) {\n    return calcImageInBox(this.width, this.height, boxSize.width, boxSize.height, fitted);\n  }\n\n  public aspectFitted(boxSize: MediaSize) {\n    return this.aspect(boxSize, true);\n  }\n\n  public aspectCovered(boxSize: MediaSize) {\n    return this.aspect(boxSize, false);\n  }\n}\n\nexport function makeMediaSize(width?: number, height?: number): MediaSize {\n  return new MediaSize(width, height);\n}\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport {MOUNT_CLASS_TO} from '../config/debug';\r\nimport EventListenerBase from './eventListenerBase';\r\nimport {makeMediaSize, MediaSize} from './mediaSize';\r\n\r\ntype MediaTypeSizes = {\r\n  regular: MediaSize,\r\n  webpage: MediaSize,\r\n  album: MediaSize,\r\n  esgSticker: MediaSize,\r\n  animatedSticker: MediaSize,\r\n  staticSticker: MediaSize,\r\n  emojiSticker: MediaSize,\r\n  poll: MediaSize,\r\n  round: MediaSize,\r\n  documentName: MediaSize,\r\n  invoice: MediaSize,\r\n  customEmoji: MediaSize,\r\n  esgCustomEmoji: MediaSize\r\n};\r\n\r\nexport type MediaSizeType = keyof MediaTypeSizes;\r\n\r\nexport enum ScreenSize {\r\n  mobile,\r\n  medium,\r\n  large\r\n}\r\n\r\nconst MOBILE_SIZE = 600;\r\nconst MEDIUM_SIZE = 1275;\r\nconst LARGE_SIZE = 1680;\r\n\r\nclass MediaSizes extends EventListenerBase<{\r\n  changeScreen: (from: ScreenSize, to: ScreenSize) => void,\r\n  resize: () => void\r\n}> {\r\n  private screenSizes: {key: ScreenSize, value: number}[] = [\r\n    {key: ScreenSize.mobile, value: MOBILE_SIZE},\r\n    {key: ScreenSize.medium, value: MEDIUM_SIZE},\r\n    {key: ScreenSize.large, value: LARGE_SIZE}\r\n  ];\r\n\r\n  private sizes: {[k in 'desktop' | 'handhelds']: MediaTypeSizes} = {\r\n    handhelds: {\r\n      regular: makeMediaSize(270, 270),\r\n      webpage: makeMediaSize(270, 200),\r\n      album: makeMediaSize(270, 0),\r\n      esgSticker: makeMediaSize(68, 68),\r\n      animatedSticker: makeMediaSize(180, 180),\r\n      staticSticker: makeMediaSize(180, 180),\r\n      emojiSticker: makeMediaSize(112, 112),\r\n      poll: makeMediaSize(240, 0),\r\n      round: makeMediaSize(200, 200),\r\n      documentName: makeMediaSize(200, 0),\r\n      invoice: makeMediaSize(240, 240),\r\n      customEmoji: makeMediaSize(18, 18),\r\n      esgCustomEmoji: makeMediaSize(32, 32)\r\n    },\r\n    desktop: {\r\n      regular: makeMediaSize(420, 340),\r\n      webpage: makeMediaSize(420, 340),\r\n      album: makeMediaSize(420, 0),\r\n      esgSticker: makeMediaSize(80, 80),\r\n      animatedSticker: makeMediaSize(200, 200),\r\n      staticSticker: makeMediaSize(200, 200),\r\n      emojiSticker: makeMediaSize(112, 112),\r\n      poll: makeMediaSize(330, 0),\r\n      round: makeMediaSize(280, 280),\r\n      documentName: makeMediaSize(240, 0),\r\n      invoice: makeMediaSize(320, 260),\r\n      customEmoji: makeMediaSize(18, 18),\r\n      esgCustomEmoji: makeMediaSize(32, 32)\r\n    }\r\n  };\r\n\r\n  public isMobile = false;\r\n  public active: MediaTypeSizes;\r\n  public activeScreen: ScreenSize;\r\n  private rAF: number;\r\n\r\n  constructor() {\r\n    super();\r\n\r\n    window.addEventListener('resize', () => {\r\n      if(this.rAF) window.cancelAnimationFrame(this.rAF);\r\n      this.rAF = window.requestAnimationFrame(() => {\r\n        this.handleResize();\r\n        this.rAF = 0;\r\n      });\r\n    });\r\n    this.handleResize();\r\n  }\r\n\r\n  private handleResize = () => {\r\n    const innerWidth = window.innerWidth;\r\n    // this.isMobile = innerWidth <= 720;\r\n\r\n    let activeScreen = this.screenSizes[0].key;\r\n    for(let i = this.screenSizes.length - 1; i >= 0; --i) {\r\n      if(this.screenSizes[i].value < innerWidth) {\r\n        activeScreen = (this.screenSizes[i + 1] || this.screenSizes[i]).key;\r\n        break;\r\n      }\r\n    }\r\n\r\n    const wasScreen = this.activeScreen;\r\n    this.activeScreen = activeScreen;\r\n    this.isMobile = this.activeScreen === ScreenSize.mobile;\r\n    this.active = this.isMobile ? this.sizes.handhelds : this.sizes.desktop;\r\n\r\n    // console.time('esg');\r\n    // const computedStyle = window.getComputedStyle(document.documentElement);\r\n    // this.active.esgSticker.width = parseFloat(computedStyle.getPropertyValue('--esg-sticker-size'));\r\n    // console.timeEnd('esg');\r\n\r\n    if(wasScreen !== activeScreen) {\r\n      // console.log('changeScreen', this.activeScreen, activeScreen);\r\n\r\n      if(wasScreen !== undefined) {\r\n        this.dispatchEvent('changeScreen', wasScreen, activeScreen);\r\n      }\r\n    }\r\n\r\n    if(wasScreen !== undefined) {\r\n      this.dispatchEvent('resize');\r\n    }\r\n\r\n    /* if(this.isMobile) {\r\n      for(let i in this.active) {\r\n        // @ts-ignore\r\n        let size = this.active[i];\r\n        size.width = innerWidth\r\n      }\r\n    } */\r\n  };\r\n}\r\n\r\nconst mediaSizes = new MediaSizes();\r\nMOUNT_CLASS_TO.mediaSizes = mediaSizes;\r\nexport default mediaSizes;\r\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nexport default function middlewarePromise(middleware: () => boolean, throwWhat: any = '') {\n  return <T>(promise: T): T => {\n    if(!(promise instanceof Promise)) {\n      if(promise instanceof Error) {\n        throw promise;\n      } else {\n        return promise;\n      }\n    }\n\n    return (promise as any as Promise<any>).then((result) => {\n      if(!middleware()) {\n        throw throwWhat;\n      }\n\n      return result;\n    }) as any;\n  };\n}\n","export default function clamp(v: number, min: number, max: number): number {\n  return v < min ? min : ((v > max) ? max : v);\n}\n","export default function formatNumber(bytes: number, decimals = 2) {\n  if(bytes === 0) return '0';\n\n  const k = 1000;\n  const dm = decimals < 0 ? 0 : decimals;\n  const sizes = ['', 'K', 'M', 'B', 'T'];\n\n  const i = Math.floor(Math.log(bytes) / Math.log(k));\n\n  return parseFloat((bytes / Math.pow(k, i)).toFixed(dm)) + sizes[i];\n}\n","export default function numberThousandSplitter(x: number, joiner = ' ') {\n  const parts = x.toString().split('.');\n  parts[0] = parts[0].replace(/\\B(?=(\\d{3})+(?!\\d))/g, joiner);\n  return parts.join('.');\n}\n","import {IS_APPLE_MOBILE} from '../environment/userAgent';\n\nexport default function onMediaLoad(media: HTMLMediaElement, readyState = media.HAVE_METADATA, useCanplayOnIos?: boolean) {\n  return new Promise<void>((resolve) => {\n    if(media.readyState >= readyState) {\n      resolve();\n      return;\n    }\n\n    media.addEventListener(IS_APPLE_MOBILE && !useCanplayOnIos ? 'loadeddata' : 'canplay', () => resolve(), {once: true});\n  });\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport appNavigationController, {NavigationItem} from '../components/appNavigationController';\nimport IS_TOUCH_SUPPORTED from '../environment/touchSupport';\nimport {IS_MOBILE_SAFARI} from '../environment/userAgent';\nimport cancelEvent from './dom/cancelEvent';\nimport {CLICK_EVENT_NAME} from './dom/clickEvent';\nimport findUpAsChild from './dom/findUpAsChild';\nimport EventListenerBase from './eventListenerBase';\n\nexport default class OverlayClickHandler extends EventListenerBase<{\n  toggle: (open: boolean) => void\n}> {\n  protected element: HTMLElement;\n  protected overlay: HTMLElement;\n  protected listenerOptions: AddEventListenerOptions;\n\n  constructor(\n    protected navigationType: NavigationItem['type'],\n    protected withOverlay?: boolean\n  ) {\n    super(false);\n    this.listenerOptions = withOverlay ? {} : {capture: true};\n  }\n\n  protected onClick = (e: MouseEvent | TouchEvent) => {\n    if(this.element && findUpAsChild(e.target as HTMLElement, this.element)) {\n      return;\n    }\n\n    if(this.listenerOptions?.capture) {\n      cancelEvent(e);\n    }\n\n    this.close();\n  };\n\n  public close() {\n    if(this.element) {\n      this.overlay?.remove();\n      this.element = undefined;\n      this.dispatchEvent('toggle', false);\n    }\n\n    if(!IS_TOUCH_SUPPORTED) {\n      // window.removeEventListener('keydown', onKeyDown, {capture: true});\n      window.removeEventListener('contextmenu', this.onClick, this.listenerOptions);\n    }\n\n    document.removeEventListener(CLICK_EVENT_NAME, this.onClick, this.listenerOptions);\n\n    if(!IS_MOBILE_SAFARI) {\n      appNavigationController.removeByType(this.navigationType);\n    }\n  }\n\n  public open(element: HTMLElement) {\n    this.close();\n\n    if(!IS_MOBILE_SAFARI) {\n      appNavigationController.pushItem({\n        type: this.navigationType,\n        onPop: (canAnimate) => {\n          this.close();\n        }\n      });\n    }\n\n    this.element = element;\n\n    if(!this.overlay && this.withOverlay) {\n      this.overlay = document.createElement('div');\n      this.overlay.classList.add('btn-menu-overlay');\n\n      // ! because this event must be canceled, and can't cancel on menu click (below)\n      this.overlay.addEventListener(CLICK_EVENT_NAME, (e) => {\n        cancelEvent(e);\n        this.onClick(e);\n      });\n    }\n\n    this.overlay && this.element.parentElement.insertBefore(this.overlay, this.element);\n\n    // document.body.classList.add('disable-hover');\n\n    if(!IS_TOUCH_SUPPORTED) {\n      // window.addEventListener('keydown', onKeyDown, {capture: true});\n      window.addEventListener('contextmenu', this.onClick, {...this.listenerOptions, once: true});\n    }\n\n    /* // ! because this event must be canceled, and can't cancel on menu click (below)\n    overlay.addEventListener(CLICK_EVENT_NAME, (e) => {\n      cancelEvent(e);\n      onClick(e);\n    }); */\n\n    // ! safari iOS doesn't handle window click event on overlay, idk why\n    document.addEventListener(CLICK_EVENT_NAME, this.onClick, this.listenerOptions);\n\n    this.dispatchEvent('toggle', true);\n  }\n}\n","import Currencies from '../config/currencies';\n\n// https://stackoverflow.com/a/34141813\nfunction number_format(number: any, decimals: any, dec_point: any, thousands_sep: any): string {\n  // Strip all characters but numerical ones.\n  number = (number + '').replace(/[^0-9+\\-Ee.]/g, '');\n  var n = !isFinite(+number) ? 0 : +number,\n    prec = !isFinite(+decimals) ? 0 : Math.abs(decimals),\n    sep = (typeof thousands_sep === 'undefined') ? ',' : thousands_sep,\n    dec = (typeof dec_point === 'undefined') ? '.' : dec_point,\n    s: any = '',\n    toFixedFix = function(n: number, prec: number) {\n      var k = Math.pow(10, prec);\n      return '' + Math.round(n * k) / k;\n    };\n  // Fix for IE parseFloat(0.55).toFixed(0) = 0;\n  s = (prec ? toFixedFix(n, prec) : '' + Math.round(n)).split('.');\n  if(s[0].length > 3) {\n    s[0] = s[0].replace(/\\B(?=(?:\\d{3})+(?!\\d))/g, sep);\n  }\n  if((s[1] || '').length < prec) {\n    s[1] = s[1] || '';\n    s[1] += new Array(prec - s[1].length + 1).join('0');\n  }\n  return s.join(dec);\n}\n\nexport default function paymentsWrapCurrencyAmount(amount: number | string, currency: string, skipSymbol?: boolean) {\n  amount = +amount;\n\n  const isNegative = amount < 0;\n\n  const currencyData = Currencies[currency];\n  if(!currencyData) {\n    throw new Error('CURRENCY_WRAP_INVALID');\n  }\n\n  const amountExp = amount / Math.pow(10, currencyData.exp);\n\n  let decimals = currencyData.exp;\n  if(currency == 'IRR' && Math.floor(amountExp) == amountExp) {\n    decimals = 0; //      = 0     UI\n  }\n\n  let formatted = number_format(amountExp, decimals, currencyData.decimal_sep, currencyData.thousands_sep);\n  if(skipSymbol) {\n    return formatted;\n  }\n\n  let symbol = currencyData.symbol;\n  if(isNegative && !currencyData.space_between && currencyData.symbol_left) {\n    symbol = '-' + symbol;\n    formatted = formatted.replace('-', '');\n  }\n\n  let out: string;\n  const splitter = currencyData.space_between ? ' ' : '';\n  if(currencyData.symbol_left) {\n    out = symbol + splitter + formatted;\n  } else {\n    out = formatted + splitter + symbol;\n  }\n  return out;\n}\n\n(window as any).p = paymentsWrapCurrencyAmount;\n\n// function paymentsGetCurrencyExp($currency: string) {\n//   if($currency == 'CLF') {\n//     return 4;\n//   }\n//   if(['BHD','IQD','JOD','KWD','LYD','OMR','TND'].includes($currency)) {\n//     return 3;\n//   }\n//   if(['BIF','BYR','CLP','CVE','DJF','GNF','ISK','JPY','KMF','KRW','MGA', 'PYG','RWF','UGX','UYI','VND','VUV','XAF','XOF','XPF'].includes($currency)) {\n//     return 0;\n//   }\n//   if($currency == 'MRO') {\n//     return 1;\n//   }\n//   return 2;\n// }\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport mediaSizes from './mediaSizes';\n\nexport type MenuPositionPadding = {\n  top?: number,\n  right?: number,\n  bottom?: number,\n  left?: number\n};\n\nconst PADDING_TOP = 8;\nconst PADDING_BOTTOM = PADDING_TOP;\nconst PADDING_LEFT = 8;\nconst PADDING_RIGHT = PADDING_LEFT;\nexport default function positionMenu({pageX, pageY}: MouseEvent | Touch, elem: HTMLElement, side?: 'left' | 'right' | 'center', additionalPadding?: MenuPositionPadding) {\n  // let {clientX, clientY} = e;\n\n  // * side mean the OPEN side\n\n  const getScrollWidthFromElement = (Array.from(elem.children) as HTMLElement[]).find((element) => element.classList.contains('btn-menu-item') && !element.classList.contains('hide')) || elem;\n\n  const {scrollWidth: menuWidth} = getScrollWidthFromElement;\n  const {scrollHeight: menuHeight} = elem;\n  // let {innerWidth: windowWidth, innerHeight: windowHeight} = window;\n  const rect = document.body.getBoundingClientRect();\n  const windowWidth = rect.width;\n  const windowHeight = rect.height;\n\n  let paddingTop = PADDING_TOP, paddingRight = PADDING_RIGHT, paddingBottom = PADDING_BOTTOM, paddingLeft = PADDING_LEFT;\n  if(additionalPadding) {\n    if(additionalPadding.top) paddingTop += additionalPadding.top;\n    if(additionalPadding.right) paddingRight += additionalPadding.right;\n    if(additionalPadding.bottom) paddingBottom += additionalPadding.bottom;\n    if(additionalPadding.left) paddingLeft += additionalPadding.left;\n  }\n\n  side = mediaSizes.isMobile ? 'right' : 'left';\n  let verticalSide: 'top' /* | 'bottom' */ | 'center' = 'top';\n\n  const maxTop = windowHeight - menuHeight - paddingBottom;\n  const maxLeft = windowWidth - menuWidth - paddingRight;\n  const minTop = paddingTop;\n  const minLeft = paddingLeft;\n\n  const getSides = () => {\n    return {\n      x: {\n        left: pageX,\n        right: Math.min(maxLeft, pageX - menuWidth)\n      },\n      intermediateX: side === 'right' ? minLeft : maxLeft,\n      // intermediateX: clientX < windowWidth / 2 ? PADDING_LEFT : windowWidth - menuWidth - PADDING_LEFT,\n      y: {\n        top: pageY,\n        bottom: pageY - menuHeight\n      },\n      // intermediateY: verticalSide === 'top' ? paddingTop : windowHeight - menuHeight - paddingTop,\n      // intermediateY: pageY < (windowHeight / 2) ? paddingTop : windowHeight - menuHeight - paddingBottom,\n      intermediateY: maxTop\n    };\n  };\n\n  const sides = getSides();\n\n  const possibleSides = {\n    x: {\n      left: (sides.x.left + menuWidth + paddingRight) <= windowWidth,\n      right: sides.x.right >= paddingLeft\n    },\n    y: {\n      top: (sides.y.top + menuHeight + paddingBottom) <= windowHeight,\n      bottom: (sides.y.bottom - paddingBottom) >= paddingBottom\n    }\n  };\n\n  /* if(side === undefined) {\n    if((clientX + menuWidth + PADDING_LEFT) > windowWidth) {\n      side = 'right';\n    }\n  } */\n\n  {\n    /* const x = sides.x;\n\n    const s = Object.keys(x) as (keyof typeof possibleSides.x)[];\n    if(side) {\n      s.findAndSplice((s) => s === side);\n      s.unshift(side);\n    }\n\n    const possibleSide = s.find((s) => possibleSides.x[s]); */\n    // let left: number;\n    /* if(possibleSide) {\n      left = x[possibleSide];\n      side = possibleSide;\n    } else {\n      left = sides.intermediateX;\n      side = undefined;\n    } */\n    const left = possibleSides.x[side] ? sides.x[side] : (side = 'center', sides.intermediateX);\n\n    elem.style.left = left + 'px';\n  }\n\n  /* if((clientY + menuHeight + PADDING_TOP) > windowHeight) {\n    elem.style.top = clamp(clientY - menuHeight, PADDING_TOP, windowHeight - menuHeight - PADDING_TOP) + 'px';\n    // elem.style.top = (innerHeight - scrollHeight - PADDING_TOP) + 'px';\n    verticalSide = 'bottom';\n  } else {\n    elem.style.top = Math.max(PADDING_TOP, clientY) + 'px';\n    verticalSide = 'top';\n  } */\n\n  {\n    const top = possibleSides.y[verticalSide] ? sides.y[verticalSide] : (verticalSide = 'center', sides.intermediateY);\n\n    elem.style.top = top + 'px';\n  }\n\n  elem.className = elem.className.replace(/(top|center|bottom)-(left|center|right)/g, '');\n  elem.classList.add(\n    // (verticalSide === 'center' ? verticalSide : (verticalSide === 'bottom' ? 'top' : 'bottom')) +\n    (verticalSide === 'center' ? verticalSide : 'bottom') +\n    '-' +\n    (side === 'center' ? side : (side === 'left' ? 'right' : 'left')));\n\n  return {\n    width: menuWidth,\n    height: menuHeight\n  };\n}\n","import {RestrictionReason} from '../layer';\n\nconst platforms = new Set([\n  'all',\n  'web',\n  'webk'\n]);\n\nconst ignore = new Set();\n\nexport function getRestrictionReason(reasons: RestrictionReason[]) {\n  // return reasons[0];\n  return reasons.find((reason) => platforms.has(reason.platform) && !ignore.has(reason.reason));\n}\n\nexport function isRestricted(reasons: RestrictionReason[]) {\n  return !!getRestrictionReason(reasons);\n}\n\nexport function ignoreRestrictionReasons(reasons: string[]) {\n  ignore.clear();\n  reasons.forEach((reason) => {\n    ignore.add(reason);\n  });\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport type {MyDocument} from '../lib/appManagers/appDocsManager';\nimport rootScope from '../lib/rootScope';\n\nconst savingLottiePreview: {[docId: DocId]: {width: number, height: number}} = {};\n\nexport function isSavingLottiePreview(doc: MyDocument, toneIndex: number) {\n  const key = doc.id + '-' + toneIndex;\n  return !!savingLottiePreview[key];\n}\n\nexport async function saveLottiePreview(doc: MyDocument, canvas: HTMLCanvasElement, toneIndex: number) {\n  const key = doc.id + '-' + toneIndex;\n  const {width, height} = canvas;\n  let saving = savingLottiePreview[key];\n  if(saving && saving.width >= width && saving.height >= height) {\n    return;\n  }\n\n  saving = savingLottiePreview[key] = {\n    width,\n    height\n  };\n\n  const thumb = await rootScope.managers.appDocsManager.getLottieCachedThumb(doc.id, toneIndex);\n  if(savingLottiePreview[key] !== saving) {\n    return;\n  }\n\n  if(thumb && thumb.w >= width && thumb.h >= height) {\n    return;\n  }\n\n  const promise = new Promise<Blob>((resolve) => {\n    canvas.toBlob((blob) => resolve(blob));\n  });\n\n  const blob = await promise;\n  if(savingLottiePreview[key] !== saving) {\n    return;\n  }\n\n  // console.log('got lottie preview', doc, blob, URL.createObjectURL(blob));\n\n  rootScope.managers.appDocsManager.saveLottiePreview(doc.id, blob, width, height, toneIndex);\n\n  delete savingLottiePreview[key];\n\n  /* const reader = new FileReader();\n  reader.onloadend = (e) => {\n    const uint8 = new Uint8Array(e.target.result as ArrayBuffer);\n    const thumb: PhotoSize.photoStrippedSize = {\n      _: 'photoStrippedSize',\n      bytes: uint8,\n      type: 'i'\n    };\n\n    doc.stickerSavedThumbWidth = canvas.width;\n    doc.stickerSavedThumbHeight = canvas.width;\n\n    defineNotNumerableProperties(thumb, ['url']);\n    thumb.url = URL.createObjectURL(blob);\n    doc.thumbs.findAndSplice((t) => t._ === thumb._);\n    doc.thumbs.unshift(thumb);\n\n    if(!webpWorkerController.isWebpSupported()) {\n      doc.pFlags.stickerThumbConverted = true;\n    }\n\n    delete this.savingLottiePreview[doc.id];\n  };\n  reader.readAsArrayBuffer(blob); */\n}\n","// * Jolly Cobra's schedulers\n\nimport {AnyToVoidFunction} from '../../types';\nimport {fastRaf} from '../schedulers';\nimport throttleWith from './throttleWith';\n\nexport default function throttleWithRaf<F extends AnyToVoidFunction>(fn: F) {\n  return throttleWith(fastRaf, fn);\n}\n","// * Jolly Cobra's schedulers\n\nimport {AnyToVoidFunction} from '../../types';\n\nexport default function throttleWith<F extends AnyToVoidFunction>(schedulerFn: AnyToVoidFunction, fn: F) {\n  let waiting = false;\n  let args: Parameters<F>;\n\n  return (..._args: Parameters<F>) => {\n    args = _args;\n\n    if(!waiting) {\n      waiting = true;\n\n      schedulerFn(() => {\n        waiting = false;\n        // @ts-ignore\n        fn(...args);\n      });\n    }\n  };\n}\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport Scrollable from '../components/scrollable';\r\nimport safeAssign from './object/safeAssign';\r\n\r\nexport default class ScrollableLoader {\r\n  public loading = false;\r\n  private scrollable: Scrollable;\r\n  private getPromise: () => Promise<boolean>;\r\n  private promise: Promise<any>;\r\n  private loaded = false;\r\n\r\n  constructor(options: {\r\n    scrollable: ScrollableLoader['scrollable'],\r\n    getPromise: ScrollableLoader['getPromise']\r\n  }) {\r\n    safeAssign(this, options);\r\n\r\n    options.scrollable.onScrolledBottom = () => {\r\n      this.load();\r\n    };\r\n  }\r\n\r\n  public load() {\r\n    if(this.loaded) {\r\n      return Promise.resolve();\r\n    }\r\n\r\n    if(this.loading) {\r\n      return this.promise;\r\n    }\r\n\r\n    this.loading = true;\r\n    this.promise = this.getPromise().then((done) => {\r\n      this.loading = false;\r\n      this.promise = undefined;\r\n\r\n      if(done) {\r\n        this.loaded = true;\r\n        this.scrollable.onScrolledBottom = null;\r\n      } else {\r\n        this.scrollable.checkForTriggers();\r\n      }\r\n    }, () => {\r\n      this.promise = undefined;\r\n      this.loading = false;\r\n    });\r\n  }\r\n}\r\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport type {MediaSearchContext} from '../components/appMediaPlaybackController';\nimport type {SearchSuperContext} from '../components/appSearchSuper.';\nimport type {Message} from '../layer';\nimport type {MessagesStorageKey, MyMessage} from '../lib/appManagers/appMessagesManager';\nimport {AppManagers} from '../lib/appManagers/managers';\nimport incrementMessageId from '../lib/appManagers/utils/messageId/incrementMessageId';\nimport rootScope from '../lib/rootScope';\nimport forEachReverse from './array/forEachReverse';\nimport filterChatPhotosMessages from './filterChatPhotosMessages';\nimport ListLoader, {ListLoaderOptions} from './listLoader';\n\nexport default class SearchListLoader<Item extends {mid: number, peerId: PeerId}> extends ListLoader<Item, Message.message> {\n  public searchContext: MediaSearchContext;\n  public onEmptied: () => void;\n\n  private otherSideLoader: SearchListLoader<Item>;\n  private managers: AppManagers;\n\n  constructor(options: Omit<ListLoaderOptions<Item, Message.message>, 'loadMore'> & {\n    onEmptied?: () => void,\n    isInner?: boolean,\n    managers?: AppManagers\n  } = {}) {\n    super({\n      ...options,\n      loadMore: (anchor, older, loadCount) => {\n        const backLimit = older ? 0 : loadCount;\n        let maxId = anchor?.mid;\n\n        if(maxId === undefined) maxId = this.searchContext.maxId;\n        if(!older) maxId = incrementMessageId(maxId, 1);\n\n        return this.managers.appMessagesManager.getSearch({\n          ...this.searchContext,\n          peerId: this.searchContext.peerId || anchor?.peerId,\n          maxId,\n          limit: backLimit ? 0 : loadCount,\n          backLimit\n        }).then((value) => {\n          /* if(DEBUG) {\n            this.log('loaded more media by maxId:', maxId, value, older, this.reverse);\n          } */\n\n          if(this.searchContext.inputFilter._ === 'inputMessagesFilterChatPhotos') {\n            filterChatPhotosMessages(value);\n          }\n\n          if(value.next_rate) {\n            this.searchContext.nextRate = value.next_rate;\n          }\n\n          return {count: value.count, items: value.history};\n        });\n      },\n      processItem: async(message) => {\n        const filtered = await this.filterMids([message.mid]);\n        if(!filtered.length) {\n          return;\n        }\n\n        return options.processItem(message);\n      }\n    });\n\n    this.managers ??= rootScope.managers;\n    rootScope.addEventListener('history_delete', this.onHistoryDelete);\n    rootScope.addEventListener('history_multiappend', this.onHistoryMultiappend);\n    rootScope.addEventListener('message_sent', this.onMessageSent);\n\n    if(!options.isInner) {\n      this.otherSideLoader = new SearchListLoader({\n        ...options,\n        isInner: true\n      });\n\n      // this.otherSideLoader.onLoadedMore = () => {\n\n      // };\n    }\n  }\n\n  protected async filterMids(mids: number[]) {\n    const storageKey: MessagesStorageKey = `${this.searchContext.peerId}_${this.searchContext.isScheduled ? 'scheduled' : 'history'}`;\n    const filtered = (await this.managers.appMessagesManager.filterMessagesByInputFilterFromStorage(this.searchContext.inputFilter._, mids, storageKey, mids.length)) as Message.message[];\n    return filtered;\n  }\n\n  protected onHistoryDelete = ({peerId, msgs}: {peerId: PeerId, msgs: Set<number>}) => {\n    const shouldBeDeleted = (item: Item) => item.peerId === peerId && msgs.has(item.mid);\n    const filter = (item: Item, idx: number, arr: Item[]) => {\n      if(shouldBeDeleted(item)) {\n        arr.splice(idx, 1);\n      }\n    };\n\n    forEachReverse(this.previous, filter);\n    forEachReverse(this.next, filter);\n\n    if(this.current && shouldBeDeleted(this.current)) {\n      this.current = undefined;\n      /* if(this.go(1)) {\n        this.previous.splice(this.previous.length - 1, 1);\n      } else if(this.go(-1)) {\n        this.next.splice(0, 1);\n      } else  */if(this.onEmptied) {\n        this.onEmptied();\n      }\n    }\n  };\n\n  protected onHistoryMultiappend = async(message: Message.message | Message.messageService) => {\n    if(this.searchContext.folderId !== undefined) {\n      return;\n    }\n\n    // because it's reversed\n    if(!this.loadedAllUp || this.loadPromiseUp) {\n      return;\n    }\n\n    if(message.peerId !== this.searchContext.peerId) {\n      return;\n    }\n\n    const filtered = await this.filterMids([message.mid]);\n    const targets = (await Promise.all(filtered.map((message) => this.processItem(message)))).filter(Boolean);\n    if(targets.length) {\n      /* const {previous, current, next} = this;\n      const targets = previous.concat(current, next);\n      const currentIdx = targets.length;\n      const mid = targets[0].mid;\n      let i = 0, length = targets.length;\n      for(; i < length; ++i) {\n        const target = targets[i];\n        if(!target || mid < target.mid) {\n          break;\n        }\n      }\n\n      if(i < currentIdx) previous.push(...targets);\n      else next. */\n\n      if(!this.current) {\n        this.previous.push(...targets);\n      } else {\n        this.next.push(...targets);\n      }\n    }\n  };\n\n  protected onMessageSent = ({message}: {message: MyMessage}) => {\n    this.onHistoryMultiappend(message);\n  };\n\n  public setSearchContext(context: SearchSuperContext) {\n    this.searchContext = context;\n\n    if(this.searchContext.folderId !== undefined) {\n      this.loadedAllUp = true;\n\n      if(this.searchContext.nextRate === undefined) {\n        this.loadedAllDown = true;\n      }\n    }\n\n    if(this.searchContext.inputFilter._ === 'inputMessagesFilterChatPhotos') {\n      this.loadedAllUp = true;\n    }\n\n    if(this.searchContext.useSearch === false) {\n      this.loadedAllDown = this.loadedAllUp = true;\n    }\n\n    if(this.otherSideLoader) {\n      this.otherSideLoader.setSearchContext(context);\n    }\n  }\n\n  public reset() {\n    super.reset();\n    this.searchContext = undefined;\n\n    if(this.otherSideLoader) {\n      this.otherSideLoader.reset();\n    }\n  }\n\n  public getPrevious(withOtherSide?: boolean) {\n    let previous = this.previous;\n\n    if(this.otherSideLoader && withOtherSide) {\n      previous = previous.concat(this.otherSideLoader.previous);\n    }\n\n    return previous;\n  }\n\n  public getNext(withOtherSide?: boolean) {\n    let next = this.next;\n\n    if(this.otherSideLoader && withOtherSide) {\n      next = next.concat(this.otherSideLoader.next);\n    }\n\n    return next;\n  }\n\n  public getCurrent() {\n    return this.current || this.otherSideLoader?.current;\n  }\n\n  private goToOtherEnd(length: number) {\n    if(length > 0) return this.go(-this.previous.length);\n    else return this.go(this.next.length);\n  }\n\n  public goRound(length: number, dispatchJump?: boolean) {\n    let ret: ReturnType<SearchListLoader<Item>['goUnsafe']>;\n\n    if(this.otherSideLoader?.current) {\n      ret = this.otherSideLoader.goUnsafe(length, dispatchJump);\n      if(ret.item) {\n        return ret.item;\n      }\n\n      length = ret.leftLength;\n      if(!(length > 0 ? this.otherSideLoader.next : this.otherSideLoader.previous).length) {\n        const loaded = length > 0 ? this.otherSideLoader.loadedAllUp : this.otherSideLoader.loadedAllDown;\n        if(!loaded) { // do not reset anything until it's loaded\n          return;\n        }\n\n        // if other side is loaded too will start from its begin\n        if((length > 0 && (this.otherSideLoader.searchContext.maxId === 1 || this.otherSideLoader.loadedAllDown)) ||\n          (length < 0 && (this.otherSideLoader.searchContext.maxId === 0 || this.otherSideLoader.loadedAllUp))) {\n          return this.otherSideLoader.goToOtherEnd(length);\n        }\n\n        this.otherSideLoader.unsetCurrent(length > 0);\n      }\n    }\n\n    ret = this.goUnsafe(length, dispatchJump);\n    if(!ret.item) {\n      if(this.loadedAllUp && this.loadedAllDown) { // just use the same loader if the list is too short\n        return this.goToOtherEnd(length);\n      } else if(this.otherSideLoader) {\n        length = ret.leftLength;\n        ret = this.otherSideLoader.goUnsafe(length, dispatchJump);\n\n        if(ret.item) {\n          this.unsetCurrent(length > 0);\n        }\n      }\n    }\n\n    return ret?.item;\n  }\n\n  // public setTargets(previous: Item[], next: Item[], reverse: boolean) {\n  //   super.setTargets(previous, next, reverse);\n  // }\n\n  protected setLoaded(down: boolean, value: boolean) {\n    const changed = super.setLoaded(down, value);\n\n    if(changed &&\n      this.otherSideLoader &&\n      value &&\n      this.searchContext?.useSearch !== false/*  &&\n      (this.reverse ? this.loadedAllUp : this.loadedAllDown) */) {\n      const reverse = this.loadedAllUp;\n      this.otherSideLoader.setSearchContext({\n        ...this.searchContext,\n        maxId: reverse ? 1 : 0\n      });\n\n      // these 'reverse' are different, not a mistake here.\n      this.otherSideLoader.reverse = this.reverse;\n      this.otherSideLoader.setLoaded(reverse, true);\n      this.otherSideLoader.load(!reverse);\n    }\n\n    return changed;\n  }\n\n  public cleanup() {\n    this.reset();\n    rootScope.removeEventListener('history_delete', this.onHistoryDelete);\n    rootScope.removeEventListener('history_multiappend', this.onHistoryMultiappend);\n    rootScope.removeEventListener('message_sent', this.onMessageSent);\n    this.onEmptied = undefined;\n\n    if(this.otherSideLoader) {\n      this.otherSideLoader.cleanup();\n      this.otherSideLoader = undefined;\n    }\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport generateMessageId from './generateMessageId';\nimport getServerMessageId from './getServerMessageId';\n\nexport default function incrementMessageId(messageId: number, increment: number) {\n  return generateMessageId(getServerMessageId(messageId) + increment);\n}\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport {fastRaf} from './schedulers';\r\nimport deferredPromise, {CancellablePromise} from './cancellablePromise';\r\nimport {MOUNT_CLASS_TO} from '../config/debug';\r\nimport isInDOM from './dom/isInDOM';\r\n\r\nclass SequentialDom {\r\n  private promises: Partial<{\r\n    read: CancellablePromise<void>,\r\n    write: CancellablePromise<void>\r\n  }> = {};\r\n  private raf = fastRaf.bind(null);\r\n  private scheduled = false;\r\n\r\n  private do(kind: keyof SequentialDom['promises'], callback?: VoidFunction) {\r\n    let promise = this.promises[kind];\r\n    if(!promise) {\r\n      this.scheduleFlush();\r\n      promise = this.promises[kind] = deferredPromise<void>();\r\n    }\r\n\r\n    if(callback !== undefined) {\r\n      promise.then(() => callback());\r\n    }\r\n\r\n    return promise;\r\n  }\r\n\r\n  public measure(callback?: VoidFunction) {\r\n    return this.do('read', callback);\r\n  }\r\n\r\n  public mutate(callback?: VoidFunction) {\r\n    return this.do('write', callback);\r\n  }\r\n\r\n  /**\r\n   * Will fire instantly if element is not connected\r\n   * @param element\r\n   * @param callback\r\n   */\r\n  public mutateElement(element: HTMLElement, callback?: VoidFunction) {\r\n    const isConnected = isInDOM(element);\r\n    const promise = isConnected ? this.mutate() : Promise.resolve();\r\n\r\n    if(callback !== undefined) {\r\n      if(!isConnected) {\r\n        callback();\r\n      } else {\r\n        promise.then(() => callback());\r\n      }\r\n    }\r\n\r\n    return promise;\r\n  }\r\n\r\n  private scheduleFlush() {\r\n    if(!this.scheduled) {\r\n      this.scheduled = true;\r\n\r\n      this.raf(() => {\r\n        this.promises.read && this.promises.read.resolve();\r\n        this.promises.write && this.promises.write.resolve();\r\n\r\n        this.scheduled = false;\r\n        this.promises = {};\r\n      });\r\n    }\r\n  }\r\n}\r\n\r\nconst sequentialDom = new SequentialDom();\r\nMOUNT_CLASS_TO && (MOUNT_CLASS_TO.sequentialDom = sequentialDom);\r\nexport default sequentialDom;\r\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport {PhotoSize, WebDocument} from '../layer';\nimport {REPLIES_HIDDEN_CHANNEL_ID} from '../lib/mtproto/mtproto_config';\nimport {MyDocument} from '../lib/appManagers/appDocsManager';\nimport {MyPhoto} from '../lib/appManagers/appPhotosManager';\nimport choosePhotoSize from '../lib/appManagers/utils/photos/choosePhotoSize';\nimport {MediaSize, makeMediaSize} from './mediaSize';\nimport isWebDocument from '../lib/appManagers/utils/webDocs/isWebDocument';\n\nexport default function setAttachmentSize(\n  photo: MyPhoto | MyDocument | WebDocument,\n  element: HTMLElement | SVGForeignObjectElement,\n  boxWidth: number,\n  boxHeight: number,\n  noZoom = true,\n  message?: any,\n  pushDocumentSize?: boolean,\n  photoSize?: ReturnType<typeof choosePhotoSize>\n) {\n  const _isWebDocument = isWebDocument(photo);\n  // if(_isWebDocument && pushDocumentSize === undefined) {\n  //   pushDocumentSize = true;\n  // }\n\n  if(!photoSize) {\n    photoSize = choosePhotoSize(photo, boxWidth, boxHeight, undefined, pushDocumentSize);\n  }\n  // console.log('setAttachmentSize', photo, photo.sizes[0].bytes, div);\n\n  let size: MediaSize;\n  const isDocument = photo._ === 'document';\n  if(isDocument || _isWebDocument) {\n    size = makeMediaSize(photo.w || (photoSize as PhotoSize.photoSize).w || 512, photo.h || (photoSize as PhotoSize.photoSize).h || 512);\n  } else {\n    size = makeMediaSize((photoSize as PhotoSize.photoSize).w || 100, (photoSize as PhotoSize.photoSize).h || 100);\n  }\n\n  let boxSize = makeMediaSize(boxWidth, boxHeight);\n\n  boxSize = size = size.aspect(boxSize, noZoom);\n\n  let isFit = true;\n\n  if(!isDocument || ['video', 'gif'].includes(photo.type) || _isWebDocument) {\n    if(boxSize.width < 200 && boxSize.height < 200) { // make at least one side this big\n      boxSize = size = size.aspectCovered(makeMediaSize(200, 200));\n    }\n\n    if(message &&\n      (message.message ||\n        message.reply_to_mid ||\n        message.media.webpage ||\n        (message.replies && message.replies.pFlags.comments && message.replies.channel_id.toChatId() !== REPLIES_HIDDEN_CHANNEL_ID)\n      )\n    ) { // make sure that bubble block is human-readable\n      if(boxSize.width < 320) {\n        boxSize = makeMediaSize(320, boxSize.height);\n        isFit = false;\n      }\n    }\n\n    if(isFit && boxSize.width < 120 && message) { // if image is too narrow\n      boxSize = makeMediaSize(120, boxSize.height);\n      isFit = false;\n    }\n  }\n\n  // if(element instanceof SVGForeignObjectElement) {\n  //   element.setAttributeNS(null, 'width', '' + w);\n  //   element.setAttributeNS(null, 'height', '' + h);\n\n  //   //console.log('set dimensions to svg element:', element, w, h);\n  // } else {\n  element.style.width = boxSize.width + 'px';\n  element.style.height = boxSize.height + 'px';\n  // }\n\n  return {photoSize, size, isFit};\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport insertInDescendSortedArray from './array/insertInDescendSortedArray';\nimport {getMiddleware} from './middleware';\nimport safeAssign from './object/safeAssign';\n\nexport type SortedElementId = PeerId;\nexport type SortedElementBase = {\n  id: SortedElementId,\n  index: number\n};\n\nexport default class SortedList<SortedElement extends SortedElementBase> {\n  protected elements: Map<SortedElementId, SortedElement>;\n  protected sorted: Array<SortedElement>;\n\n  protected getIndex: (element: SortedElement) => PromiseLike<number> | number;\n  protected onDelete: (element: SortedElement) => void;\n  protected onUpdate: (element: SortedElement) => void;\n  protected onSort: (element: SortedElement, idx: number) => void;\n  protected onElementCreate: (base: SortedElementBase, batch: boolean) => SortedElement;\n\n  protected updateElementWith = (callback: () => void) => callback();\n  protected updateListWith = (callback: (canUpdate: boolean | undefined) => void) => callback(true);\n\n  protected middleware = getMiddleware();\n\n  constructor(options: {\n    getIndex: SortedList<SortedElement>['getIndex'],\n    onDelete?: SortedList<SortedElement>['onDelete'],\n    onUpdate?: SortedList<SortedElement>['onUpdate'],\n    onSort?: SortedList<SortedElement>['onSort'],\n    onElementCreate: SortedList<SortedElement>['onElementCreate'],\n\n    updateElementWith?: SortedList<SortedElement>['updateElementWith'],\n    updateListWith?: SortedList<SortedElement>['updateListWith']\n  }) {\n    safeAssign(this, options);\n\n    this.elements = new Map();\n    this.sorted = [];\n  }\n\n  public clear() {\n    this.middleware.clean();\n    this.elements.clear();\n    this.sorted.length = 0;\n  }\n\n  protected _updateList() {\n    this.elements.forEach((element) => {\n      this.update(element.id, true);\n    });\n\n    if(this.onSort) {\n      this.sorted.forEach((element, idx) => {\n        this.onSort(element, idx);\n      });\n    }\n  }\n\n  public updateList(callback: (updated: boolean) => void) {\n    const middleware = this.middleware.get();\n    this.updateListWith((canUpdate) => {\n      if(!middleware() || (canUpdate !== undefined && !canUpdate)) {\n        return callback(false);\n      }\n\n      this._updateList();\n\n      callback(true);\n    });\n  }\n\n  public has(id: SortedElementId) {\n    return this.elements.has(id);\n  }\n\n  public get(id: SortedElementId) {\n    return this.elements.get(id);\n  }\n\n  public getAll() {\n    return this.elements;\n  }\n\n  public add(\n    id: SortedElementId,\n    batch = false,\n    updateElementWith?: SortedList<SortedElement>['updateElementWith'],\n    updateBatch = batch\n  ) {\n    let element = this.get(id);\n    if(element) {\n      return element;\n    }\n\n    const base: SortedElementBase = {\n      id,\n      index: 0\n    };\n\n    element = this.onElementCreate(base, batch);\n    this.elements.set(id, element);\n    this.update(id, updateBatch, element, updateElementWith);\n\n    return element;\n  }\n\n  public delete(id: SortedElementId, noScheduler?: boolean) {\n    const element = this.elements.get(id);\n    if(!element) {\n      return false;\n    }\n\n    this.elements.delete(id);\n\n    const idx = this.sorted.indexOf(element);\n    if(idx !== -1) {\n      this.sorted.splice(idx, 1);\n    }\n\n    if(this.onDelete) {\n      if(noScheduler) {\n        this.onDelete(element);\n      } else {\n        const middleware = this.middleware.get();\n        this.updateElementWith(() => {\n          if(!middleware()) {\n            return;\n          }\n\n          this.onDelete(element);\n        });\n      }\n    }\n\n    return true;\n  }\n\n  public async update(\n    id: SortedElementId,\n    batch = false,\n    element = this.get(id),\n    updateElementWith?: SortedList<SortedElement>['updateElementWith']\n  ) {\n    if(!element) {\n      return;\n    }\n\n    element.index = await this.getIndex(element);\n    this.onUpdate && this.onUpdate(element);\n\n    const idx = insertInDescendSortedArray(this.sorted, element, 'index');\n    if(!batch && this.onSort) {\n      const middleware = this.middleware.get();\n      (updateElementWith || this.updateElementWith)(() => {\n        if(!middleware()) {\n          return;\n        }\n\n        // *             .    \n        this.onSort(element, idx);\n        /* if(this.get(id) === element) {\n          this.onSort(element, this.sorted.indexOf(element));\n        } */\n      });\n    }\n  }\n}\n","export default function encodeEntities(value: string) {\n  return value.replace(/&/g, '&amp;').replace(/[\\uD800-\\uDBFF][\\uDC00-\\uDFFF]/g, (value) => {\n    const hi = value.charCodeAt(0);\n    const low = value.charCodeAt(1);\n    return '&#' + (((hi - 0xD800) * 0x400) + (low - 0xDC00) + 0x10000) + ';';\n  }).replace(/([^\\#-~| |!])/g, (value) => { // non-alphanumeric\n    return '&#' + value.charCodeAt(0) + ';';\n  }).replace(/</g, '&lt;').replace(/>/g, '&gt;');\n}\n","// credits to https://github.com/sindresorhus/escape-string-regexp/blob/master/index.js\nexport default function escapeRegExp(str: string) {\n  return str\n  .replace(/[|\\\\{}()[\\]^$+*?.]/g, '\\\\$&')\n  .replace(/-/g, '\\\\x2d');\n}\n","export default function limitSymbols(str: string, length: number, limitFrom = length + 10) {\n  str = str.trim();\n  if(str.length > limitFrom) {\n    str = str.slice(0, length)/* .replace(/\\s*$/, '') */ + '...';\n  }\n\n  return str;\n}\n","export default function toHHMMSS(str: string | number, leadZero = false) {\n  const sec_num = parseInt(str + '', 10);\n  const hours = Math.floor(sec_num / 3600);\n  let minutes: any = Math.floor((sec_num - (hours * 3600)) / 60);\n  let seconds: any = sec_num - (hours * 3600) - (minutes * 60);\n\n  if(hours) leadZero = true;\n  if(minutes < 10) minutes = leadZero ? '0' + minutes : minutes;\n  if(seconds < 10) seconds = '0' + seconds;\n  return (hours ? /* ('0' + hours).slice(-2) */hours + ':' : '') + minutes + ':' + seconds;\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport {IS_WORKER} from './context';\n\nexport class WindowSize {\n  public width: number;\n  public height: number;\n\n  constructor() {\n    if(IS_WORKER) {\n      return;\n    }\n\n    // @ts-ignore\n    const w: any = 'visualViewport' in window ? window.visualViewport : window;\n    const set = () => {\n      this.width = w.width || w.innerWidth;\n      this.height = w.height || w.innerHeight;\n    };\n    w.addEventListener('resize', set);\n    set();\n  }\n}\n\nconst windowSize = new WindowSize();\nexport default windowSize;\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\n// * Jolly Cobra's useHeavyAnimationCheck.ts, patched\r\n\r\nimport {AnyToVoidFunction} from '../types';\r\nimport ListenerSetter from '../helpers/listenerSetter';\r\nimport deferredPromise, {CancellablePromise} from '../helpers/cancellablePromise';\r\nimport DEBUG from '../config/debug';\r\nimport pause from '../helpers/schedulers/pause';\r\nimport EventListenerBase from '../helpers/eventListenerBase';\r\n\r\nconst eventListener = new EventListenerBase<{\r\n  start: () => void,\r\n  end: () => void\r\n}>();\r\nconst ANIMATION_START_EVENT = 'start';\r\nconst ANIMATION_END_EVENT = 'end';\r\n\r\nlet isAnimating = false;\r\nlet heavyAnimationPromise: CancellablePromise<void> = deferredPromise<void>();\r\nlet promisesInQueue = 0;\r\n\r\nheavyAnimationPromise.resolve();\r\n\r\nconst log = console.log.bind(console.log, '[HEAVY-ANIMATION]:');\r\n\r\nexport function dispatchHeavyAnimationEvent(promise: Promise<any>, timeout?: number) {\r\n  if(!isAnimating) {\r\n    heavyAnimationPromise = deferredPromise<void>();\r\n    eventListener.dispatchEvent(ANIMATION_START_EVENT);\r\n    isAnimating = true;\r\n    DEBUG && log('start');\r\n  }\r\n\r\n  ++promisesInQueue;\r\n  DEBUG && log('attach promise, length:', promisesInQueue, timeout);\r\n\r\n  const promises = [\r\n    timeout !== undefined ? pause(timeout) : undefined,\r\n    promise.finally(() => {})\r\n  ].filter(Boolean);\r\n\r\n  const perf = performance.now();\r\n  const _heavyAnimationPromise = heavyAnimationPromise;\r\n  Promise.race(promises).then(() => {\r\n    if(heavyAnimationPromise !== _heavyAnimationPromise || heavyAnimationPromise.isFulfilled) { // interrupted\r\n      return;\r\n    }\r\n\r\n    --promisesInQueue;\r\n    DEBUG && log('promise end, length:', promisesInQueue, performance.now() - perf);\r\n    if(promisesInQueue <= 0) {\r\n      onHeavyAnimationEnd();\r\n    }\r\n  });\r\n\r\n  return heavyAnimationPromise;\r\n}\r\n\r\nfunction onHeavyAnimationEnd() {\r\n  if(heavyAnimationPromise.isFulfilled) {\r\n    return;\r\n  }\r\n\r\n  isAnimating = false;\r\n  promisesInQueue = 0;\r\n  eventListener.dispatchEvent(ANIMATION_END_EVENT);\r\n  heavyAnimationPromise.resolve();\r\n\r\n  DEBUG && log('end');\r\n}\r\n\r\nexport function interruptHeavyAnimation() {\r\n  onHeavyAnimationEnd();\r\n}\r\n\r\nexport function getHeavyAnimationPromise() {\r\n  return heavyAnimationPromise;\r\n}\r\n\r\nexport default function(\r\n  handleAnimationStart: AnyToVoidFunction,\r\n  handleAnimationEnd: AnyToVoidFunction,\r\n  listenerSetter?: ListenerSetter\r\n) {\r\n  // useEffect(() => {\r\n  if(isAnimating) {\r\n    handleAnimationStart();\r\n  }\r\n\r\n  const add = listenerSetter ? listenerSetter.add(eventListener) : eventListener.addEventListener.bind(eventListener);\r\n  const remove = listenerSetter ? listenerSetter.removeManual.bind(listenerSetter, eventListener) : eventListener.removeEventListener.bind(eventListener);\r\n  add(ANIMATION_START_EVENT, handleAnimationStart);\r\n  add(ANIMATION_END_EVENT, handleAnimationEnd);\r\n\r\n  return () => {\r\n    remove(ANIMATION_END_EVENT, handleAnimationEnd);\r\n    remove(ANIMATION_START_EVENT, handleAnimationStart);\r\n  };\r\n  // }, [handleAnimationEnd, handleAnimationStart]);\r\n}\r\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport appDialogsManager, {DIALOG_LIST_ELEMENT_TAG} from '../lib/appManagers/appDialogsManager';\nimport type {Dialog} from '../lib/appManagers/appMessagesManager';\nimport rootScope from '../lib/rootScope';\nimport ButtonMenu, {ButtonMenuItemOptions} from './buttonMenu';\nimport PopupDeleteDialog from './popups/deleteDialog';\nimport {i18n} from '../lib/langPack';\nimport findUpTag from '../helpers/dom/findUpTag';\nimport PopupPeer from './popups/peer';\nimport AppChatFoldersTab from './sidebarLeft/tabs/chatFolders';\nimport appSidebarLeft from './sidebarLeft';\nimport {toastNew} from './toast';\nimport PopupMute from './popups/mute';\nimport {AppManagers} from '../lib/appManagers/managers';\nimport positionMenu from '../helpers/positionMenu';\nimport contextMenuController from '../helpers/contextMenuController';\n\nexport default class DialogsContextMenu {\n  private element: HTMLElement;\n  private buttons: (ButtonMenuItemOptions & {verify: () => boolean | Promise<boolean>})[];\n\n  private selectedId: PeerId;\n  private filterId: number;\n  private dialog: Dialog;\n\n  constructor(private managers: AppManagers) {\n\n  }\n\n  private init() {\n    this.buttons = [{\n      icon: 'unread',\n      text: 'MarkAsUnread',\n      onClick: this.onUnreadClick,\n      verify: async() => !(await this.managers.appMessagesManager.isDialogUnread(this.dialog))\n    }, {\n      icon: 'readchats',\n      text: 'MarkAsRead',\n      onClick: this.onUnreadClick,\n      verify: () => this.managers.appMessagesManager.isDialogUnread(this.dialog)\n    }, {\n      icon: 'pin',\n      text: 'ChatList.Context.Pin',\n      onClick: this.onPinClick,\n      verify: async() => {\n        const isPinned = this.filterId > 1 ?\n          (await this.managers.appMessagesManager.getFilter(this.filterId)).pinnedPeerIds.includes(this.dialog.peerId) :\n          !!this.dialog.pFlags?.pinned;\n        return !isPinned;\n      }\n    }, {\n      icon: 'unpin',\n      text: 'ChatList.Context.Unpin',\n      onClick: this.onPinClick,\n      verify: async() => {\n        const isPinned = this.filterId > 1 ?\n          (await this.managers.appMessagesManager.getFilter(this.filterId)).pinnedPeerIds.includes(this.dialog.peerId) :\n          !!this.dialog.pFlags?.pinned;\n        return isPinned;\n      }\n    }, {\n      icon: 'mute',\n      text: 'ChatList.Context.Mute',\n      onClick: this.onMuteClick,\n      verify: async() => {\n        return this.selectedId !== rootScope.myId && !(await this.managers.appNotificationsManager.isPeerLocalMuted(this.dialog.peerId));\n      }\n    }, {\n      icon: 'unmute',\n      text: 'ChatList.Context.Unmute',\n      onClick: this.onUnmuteClick,\n      verify: async() => {\n        return this.selectedId !== rootScope.myId && (await this.managers.appNotificationsManager.isPeerLocalMuted(this.dialog.peerId));\n      }\n    }, {\n      icon: 'archive',\n      text: 'Archive',\n      onClick: this.onArchiveClick,\n      verify: () => this.filterId === 0 && this.selectedId !== rootScope.myId\n    }, {\n      icon: 'unarchive',\n      text: 'Unarchive',\n      onClick: this.onArchiveClick,\n      verify: () => this.filterId === 1 && this.selectedId !== rootScope.myId\n    }, {\n      icon: 'delete danger',\n      text: 'Delete',\n      onClick: this.onDeleteClick,\n      verify: () => true\n    }];\n\n    this.element = ButtonMenu(this.buttons);\n    this.element.id = 'dialogs-contextmenu';\n    this.element.classList.add('contextmenu');\n    document.getElementById('page-chats').append(this.element);\n  }\n\n  private onArchiveClick = async() => {\n    const dialog = await this.managers.appMessagesManager.getDialogOnly(this.selectedId);\n    if(dialog) {\n      this.managers.appMessagesManager.editPeerFolders([dialog.peerId], +!dialog.folder_id);\n    }\n  };\n\n  private onPinClick = () => {\n    this.managers.appMessagesManager.toggleDialogPin(this.selectedId, this.filterId).catch(async(err: ApiError) => {\n      if(err.type === 'PINNED_DIALOGS_TOO_MUCH') {\n        if(this.filterId >= 1) {\n          toastNew({langPackKey: 'PinFolderLimitReached'});\n        } else {\n          const config = await this.managers.apiManager.getConfig();\n          new PopupPeer('pinned-dialogs-too-much', {\n            buttons: [{\n              langKey: 'OK',\n              isCancel: true\n            }, {\n              langKey: 'FiltersSetupPinAlert',\n              callback: () => {\n                appSidebarLeft.createTab(AppChatFoldersTab).open();\n              }\n            }],\n            descriptionLangKey: 'PinToTopLimitReached2',\n            descriptionLangArgs: [i18n('Chats', [config.pinned_dialogs_count_max])]\n          }).show();\n        }\n      }\n    });\n  };\n\n  private onUnmuteClick = () => {\n    this.managers.appMessagesManager.togglePeerMute(this.selectedId, false);\n  };\n\n  private onMuteClick = () => {\n    new PopupMute(this.selectedId);\n  };\n\n  private onUnreadClick = async() => {\n    const selectedId = this.selectedId;\n    const dialog = await this.managers.appMessagesManager.getDialogOnly(selectedId);\n    if(!dialog) return;\n\n    if(dialog.unread_count) {\n      this.managers.appMessagesManager.readHistory(selectedId, dialog.top_message);\n      this.managers.appMessagesManager.markDialogUnread(selectedId, true);\n    } else {\n      this.managers.appMessagesManager.markDialogUnread(selectedId);\n    }\n  };\n\n  private onDeleteClick = () => {\n    new PopupDeleteDialog(this.selectedId/* , 'delete' */);\n  };\n\n  onContextMenu = (e: MouseEvent | Touch) => {\n    if(this.init) {\n      this.init();\n      this.init = null;\n    }\n\n    let li: HTMLElement = null;\n\n    try {\n      li = findUpTag(e.target, DIALOG_LIST_ELEMENT_TAG);\n    } catch(e) {}\n\n    if(!li) return;\n\n    if(e instanceof MouseEvent) e.preventDefault();\n    if(this.element.classList.contains('active')) {\n      return false;\n    }\n    if(e instanceof MouseEvent) e.cancelBubble = true;\n\n    const r = async() => {\n      this.filterId = appDialogsManager.filterId;\n      this.selectedId = li.dataset.peerId.toPeerId();\n      this.dialog = await this.managers.appMessagesManager.getDialogOnly(this.selectedId);\n\n      await Promise.all(this.buttons.map(async(button) => {\n        const good = await button.verify();\n\n        button.element.classList.toggle('hide', !good);\n      }));\n\n      // delete button\n      this.buttons[this.buttons.length - 1].element.lastChild.replaceWith(i18n(await this.managers.appPeersManager.getDeleteButtonText(this.selectedId)));\n\n      li.classList.add('menu-open');\n      positionMenu(e, this.element);\n      contextMenuController.openBtnMenu(this.element, () => {\n        li.classList.remove('menu-open');\n        this.selectedId = this.dialog = this.filterId = undefined;\n      });\n    };\n\n    r();\n  };\n}\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport App from '../config/app';\r\nimport DEBUG from '../config/debug';\r\nimport replaceContent from '../helpers/dom/replaceContent';\r\nimport {LangPackKey, i18n} from '../lib/langPack';\r\nimport {logger} from '../lib/logger';\r\nimport rootScope from '../lib/rootScope';\r\nimport Button from './button';\r\nimport ProgressivePreloader from './preloader';\r\nimport SetTransition from './singleTransition';\r\nimport sessionStorage from '../lib/sessionStorage';\r\nimport {ConnectionStatus} from '../lib/mtproto/connectionStatus';\r\nimport cancelEvent from '../helpers/dom/cancelEvent';\r\nimport {attachClickEvent} from '../helpers/dom/clickEvent';\r\nimport {AppManagers} from '../lib/appManagers/managers';\r\nimport singleInstance from '../lib/mtproto/singleInstance';\r\n\r\nexport default class ConnectionStatusComponent {\r\n  public static CHANGE_STATE_DELAY = 1000;\r\n\r\n  private statusContainer: HTMLElement;\r\n  private statusEl: HTMLElement;\r\n  private statusPreloader: ProgressivePreloader;\r\n\r\n  private currentLangPackKey: LangPackKey;\r\n\r\n  private hadConnect = false;\r\n  private retryAt: number;\r\n  private connecting = false;\r\n  private timedOut = false;\r\n  private updating = false;\r\n\r\n  private log: ReturnType<typeof logger>;\r\n\r\n  private setFirstConnectionTimeout: number;\r\n  private setStateTimeout: number;\r\n\r\n  constructor(private managers: AppManagers, chatsContainer: HTMLElement) {\r\n    this.log = logger('CS', undefined, undefined);\r\n\r\n    this.statusContainer = document.createElement('div');\r\n    this.statusContainer.classList.add('connection-status'/* , 'hide' */);\r\n\r\n    this.statusEl = Button('btn-primary bg-warning connection-status-button', {noRipple: true});\r\n    this.statusPreloader = new ProgressivePreloader({cancelable: false});\r\n    this.statusPreloader.constructContainer({color: 'transparent', bold: true});\r\n    this.statusContainer.append(this.statusEl);\r\n\r\n    chatsContainer.prepend(this.statusContainer);\r\n\r\n    rootScope.addEventListener('connection_status_change', (status) => {\r\n      // console.log(status);\r\n\r\n      this.setConnectionStatus();\r\n    });\r\n\r\n    rootScope.addEventListener('state_synchronizing', (channelId) => {\r\n      if(!channelId) {\r\n        this.updating = true;\r\n        DEBUG && this.log('updating', this.updating);\r\n        this.setState();\r\n      }\r\n    });\r\n\r\n    rootScope.addEventListener('state_synchronized', (channelId) => {\r\n      DEBUG && this.log('state_synchronized', channelId);\r\n      if(!channelId) {\r\n        this.updating = false;\r\n        DEBUG && this.log('updating', this.updating);\r\n        this.setState();\r\n      }\r\n    });\r\n\r\n    this.setFirstConnectionTimeout = window.setTimeout(this.setConnectionStatus, ConnectionStatusComponent.CHANGE_STATE_DELAY + 1e3);\r\n\r\n    /* let bool = true;\r\n    document.addEventListener('dblclick', () => {\r\n      const dcId = 2;\r\n      rootScope.dispatchEvent('connection_status_change', {\r\n        dcId: dcId,\r\n        isFileDownload: false,\r\n        isFileNetworker: false,\r\n        isFileUpload: false,\r\n        name: \"NET-\" + dcId,\r\n        status: bool ? (bool = false, ConnectionStatus.Closed) : (bool = true, ConnectionStatus.Connected),\r\n        _: \"networkerStatus\"\r\n      });\r\n    }); */\r\n  }\r\n\r\n  private setConnectionStatus = () => {\r\n    Promise.all([\r\n      sessionStorage.get('dc'),\r\n      rootScope.managers.rootScope.getConnectionStatus()\r\n    ]).then(([baseDcId, connectionStatus]) => {\r\n      if(!baseDcId) {\r\n        baseDcId = App.baseDcId;\r\n      }\r\n\r\n      if(this.setFirstConnectionTimeout) {\r\n        clearTimeout(this.setFirstConnectionTimeout);\r\n        this.setFirstConnectionTimeout = 0;\r\n      }\r\n\r\n      const status = connectionStatus['NET-' + baseDcId];\r\n      const online = status && status.status === ConnectionStatus.Connected;\r\n\r\n      if(this.connecting && online) {\r\n        this.managers.apiUpdatesManager.forceGetDifference();\r\n      }\r\n\r\n      if(online && !this.hadConnect) {\r\n        this.hadConnect = true;\r\n      }\r\n\r\n      this.timedOut = status && status.status === ConnectionStatus.TimedOut;\r\n      this.connecting = !online;\r\n      this.retryAt = status && status.retryAt;\r\n      DEBUG && this.log('connecting', this.connecting);\r\n      this.setState();\r\n    });\r\n  };\r\n\r\n  private setStatusText = (langPackKey: LangPackKey, args?: any[]) => {\r\n    if(this.currentLangPackKey === langPackKey) return;\r\n    this.currentLangPackKey = langPackKey;\r\n    replaceContent(this.statusEl, i18n(langPackKey, args));\r\n    this.statusPreloader.attach(this.statusEl);\r\n  };\r\n\r\n  private getA(langPackKey: LangPackKey, callback: () => void) {\r\n    const a = document.createElement('a');\r\n    a.classList.add('force-reconnect');\r\n    a.append(i18n(langPackKey));\r\n    attachClickEvent(a, (e) => {\r\n      cancelEvent(e);\r\n      callback();\r\n    });\r\n\r\n    return a;\r\n  }\r\n\r\n  private setState = () => {\r\n    if(singleInstance.deactivatedReason) {\r\n      return;\r\n    }\r\n\r\n    const timeout = ConnectionStatusComponent.CHANGE_STATE_DELAY;\r\n    if(this.connecting) {\r\n      if(this.timedOut) {\r\n        const a = this.getA('ConnectionStatus.ForceReconnect', () => this.managers.networkerFactory.forceReconnect());\r\n        this.setStatusText('ConnectionStatus.TimedOut', [a]);\r\n      } else if(this.hadConnect) {\r\n        if(this.retryAt !== undefined) {\r\n          const timerSpan = document.createElement('span');\r\n          const retryAt = this.retryAt;\r\n          const setTime = () => {\r\n            const now = Date.now();\r\n            timerSpan.innerText = '' + Math.round((retryAt - now) / 1000);\r\n            if(now > retryAt) {\r\n              clearInterval(interval);\r\n            }\r\n          };\r\n          const interval = setInterval(setTime, 1e3);\r\n          setTime();\r\n\r\n          const a = this.getA('ConnectionStatus.Reconnect', () => this.managers.networkerFactory.forceReconnectTimeout());\r\n          this.setStatusText('ConnectionStatus.ReconnectIn', [timerSpan, a]);\r\n        } else {\r\n          this.setStatusText('ConnectionStatus.Reconnecting');\r\n        }\r\n      } else {\r\n        this.setStatusText('ConnectionStatus.Waiting');\r\n      }\r\n    } else if(this.updating) {\r\n      this.setStatusText('Updating');\r\n    }\r\n\r\n    DEBUG && this.log('setState', this.connecting || this.updating);\r\n    window.requestAnimationFrame(() => {\r\n      if(this.setStateTimeout) clearTimeout(this.setStateTimeout);\r\n\r\n      const cb = () => {\r\n        SetTransition(this.statusContainer, 'is-shown', this.connecting || this.updating, 200);\r\n        this.setStateTimeout = 0;\r\n        DEBUG && this.log('setState: isShown:', this.connecting || this.updating);\r\n      };\r\n\r\n      this.setStateTimeout = window.setTimeout(cb, timeout);\r\n      // cb();\r\n      /* if(timeout) this.setStateTimeout = window.setTimeout(cb, timeout);\r\n      else cb(); */\r\n    });\r\n  };\r\n}\r\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport {Message} from '../layer';\n/* import findUpClassName from \"../helpers/dom/findUpClassName\";\nimport rootScope from \"../lib/rootScope\";\nimport Transition from \"./transition\"; */\n\nexport enum SENDING_STATUS {\n  Error = -1,\n  Pending,\n  Sent,\n  Read\n}\n\nexport function getSendingStatus(message: Message.message | Message.messageService) {\n  return message.pFlags.is_outgoing ?\n    SENDING_STATUS.Pending : (\n      message.pFlags.unread ?\n      SENDING_STATUS.Sent :\n      SENDING_STATUS.Read\n    );\n}\n\nexport function setSendingStatus(\n  container: HTMLElement,\n  message?: Message.message | Message.messageService,\n  disableAnimationIfRippleFound?: boolean\n) {\n  let className: 'check' | 'checks' | 'sending' | 'sendingerror';\n  if(message?.pFlags.out) {\n    if(message.error) {\n      className = 'sendingerror';\n    } else if(message.pFlags.is_outgoing) {\n      className = 'sending';\n    } else if(message.pFlags.unread) {\n      className = 'check';\n    } else {\n      className = 'checks';\n    }\n  }\n\n  if(!className) {\n    container.textContent = '';\n    return;\n  }\n\n  const iconClassName = 'tgico-' + className;\n  const lastElement = container.lastElementChild as HTMLElement;\n  if(lastElement && lastElement.classList.contains(iconClassName)) {\n    return;\n  }\n\n  const element = document.createElement('i');\n  element.classList.add('sending-status-icon', /* 'transition-item', */ iconClassName);\n  container.append(element);\n\n  if(lastElement) {\n    lastElement.remove();\n  }\n\n  /* if(!lastElement) {\n    element.classList.add('active');\n    return;\n  }\n\n  const select = Transition(container, undefined, 350, () => {\n    lastElement.remove();\n  }, false, true, false);\n\n  let animate = rootScope.settings.animationsEnabled && className !== 'sending' && !lastElement.classList.contains('tgico-sending');\n  if(disableAnimationIfRippleFound && animate) {\n    const parent = findUpClassName(container, 'rp');\n    if(parent.querySelector('.c-ripple__circle') || parent.matches(':hover')) {\n      animate = false;\n    }\n  }\n\n  select(element, animate, lastElement); */\n\n  /* SetTransition(lastElement, 'is-visible', false, 350, () => {\n    // lastElement.remove();\n  }, 2);\n  SetTransition(element, 'is-visible', true, 350, undefined, 2); */\n}\n","// https://spicyyoghurt.com/tools/easing-functions\nexport default function easeInOutSine(t: number, b: number, c: number, d: number) {\n  return t >= d ? b + c : easeInOutSineApply(t / d, c) + b;\n}\n\nexport function easeInOutSineApply(v: number, c: number) {\n  return -c / 2 * (Math.cos(Math.PI * v) - 1);\n}\n","export default function roundRect(\n  ctx: CanvasRenderingContext2D,\n  x: number,\n  y: number,\n  width: number,\n  height: number,\n  radius: {[k in 'tl' | 'tr' | 'br' | 'bl']?: number} | number,\n  fill?: boolean,\n  stroke?: boolean\n) {\n  const dpr = ctx.canvas.dpr;\n  if(dpr) {\n    x *= dpr;\n    y *= dpr;\n    width *= dpr;\n    height *= dpr;\n  }\n\n  if(typeof(radius) === 'number') {\n    if(dpr) radius *= dpr;\n    radius = {tl: radius, tr: radius, br: radius, bl: radius};\n  } else {\n    const defaultRadius = {tl: 0, tr: 0, br: 0, bl: 0};\n    for(const side in defaultRadius) {\n      // @ts-ignore\n      radius[side] = radius[side] ? (dpr ? radius[side] * dpr : radius[side]) : defaultRadius[side];\n    }\n  }\n\n  ctx.beginPath();\n  ctx.moveTo(x + radius.tl, y);\n  ctx.lineTo(x + width - radius.tr, y);\n  ctx.quadraticCurveTo(x + width, y, x + width, y + radius.tr);\n  ctx.lineTo(x + width, y + height - radius.br);\n  ctx.quadraticCurveTo(x + width, y + height, x + width - radius.br, y + height);\n  ctx.lineTo(x + radius.bl, y + height);\n  ctx.quadraticCurveTo(x, y + height, x, y + height - radius.bl);\n  ctx.lineTo(x, y + radius.tl);\n  ctx.quadraticCurveTo(x, y, x + radius.tl, y);\n  ctx.closePath();\n\n  if(fill) {\n    ctx.fill();\n  }\n\n  if(stroke) {\n    ctx.stroke();\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport {animate} from '../helpers/animation';\nimport customProperties from '../helpers/dom/customProperties';\nimport easeInOutSine from '../helpers/easing/easeInOutSine';\nimport mediaSizes from '../helpers/mediaSizes';\nimport roundRect from '../helpers/canvas/roundRect';\n\nconst DPR = window.devicePixelRatio;\nconst SIZE = 20 * DPR;\nconst MARGIN = 2.5 * DPR;\nconst WIDTH = 2 * DPR;\nconst RADIUS = 1 * DPR;\nconst LENGTH = 3;\n\nconst MIN_HEIGHT = 4;\nconst MAX_HEIGHT = 12;\nconst DURATION = 1000;\n\nexport default function groupCallActiveIcon(isActive = false) {\n  const canvas = document.createElement('canvas');\n  canvas.width = canvas.height = SIZE;\n  const context = canvas.getContext('2d');\n\n  const TOTAL_WIDTH = LENGTH * WIDTH + (LENGTH - 1) * MARGIN;\n  const START_X = (SIZE - TOTAL_WIDTH) / 2;\n\n  const startTime = Date.now();\n  let wasMounted = false;\n  // let hadRound = false;\n  const renderFrame = () => {\n    if(!canvas.isConnected) {\n      if(wasMounted) {\n        return false;\n      }\n    } else if(!wasMounted) {\n      wasMounted = canvas.isConnected;\n    }\n\n    const time = Date.now();\n    // if(((time - startTime) / DURATION) >= 1) {\n    //   hadRound = true;\n    // }\n\n    const progress = easeInOutSine((time - startTime) % DURATION, 0, 1, DURATION);\n\n    context.clearRect(0, 0, SIZE, SIZE);\n    context.fillStyle = isActive && !mediaSizes.isMobile ? customProperties.getProperty('primary-color') : '#fff';\n\n    for(let i = 0; i < LENGTH; ++i) {\n      const x = START_X + (i * WIDTH) + (i * MARGIN);\n\n      let itemProgress: number;\n      if(progress >= .5) {\n        itemProgress = i % 2 ? 2 - progress * 2 : (progress - .5) * 2;\n      } else {\n        itemProgress = i % 2 ? progress * 2 : 1 - progress * 2;\n      }\n\n      let height = MIN_HEIGHT + (itemProgress * (MAX_HEIGHT - MIN_HEIGHT));\n      /* if(!hadRound && i === 1) {\n        console.log('call status animation', itemProgress, height, progress, progress >= .5);\n      } */\n\n      height *= DPR;\n      const y = (SIZE - height) / 2;\n\n      roundRect(context, x, y, WIDTH, height, RADIUS, true);\n    }\n\n    return true;\n  };\n\n  return {\n    canvas,\n    startAnimation: () => {\n      animate(renderFrame);\n      renderFrame();\n    },\n    setActive: (active: boolean) => {\n      isActive = active;\n      renderFrame();\n    }\n  };\n}\n","import customProperties from '../dom/customProperties';\nimport clamp from '../number/clamp';\n\nexport default class Shimmer {\n  private canvas: HTMLCanvasElement;\n  private ctx: CanvasRenderingContext2D;\n  private font = '30pt Helvetica';\n  private currTime = Date.now();\n  private diffTime = 0;\n  private spread = 0;\n  private paused = false;\n  private pausedTime = 0;\n  private pauseInterval = 850;\n  private lightSource = 0;\n  private inc = 0.032;\n  private lightSpread = 0.55;\n  private animations = ['slide', 'slide', 'slide', 'slide'];\n  private currentAnimationIndex = 0;\n  private text: string;\n  private fillStyle: CanvasRenderingContext2D['fillStyle'];\n\n  private keepTime() {\n    this.diffTime = Date.now() - this.currTime;\n    this.currTime = Date.now();\n  }\n\n  private cycleAnimation() {\n    ++this.currentAnimationIndex;\n    if(this.currentAnimationIndex >= this.animations.length) {\n      this.currentAnimationIndex = 0;\n    }\n  }\n\n  private animate() {\n    const currentAnimation = this.animations[this.currentAnimationIndex];\n    if(currentAnimation === 'glow') {\n      return this.animateGlow(); // return glow style\n    } else if(currentAnimation === 'slide') {\n      return this.animateSlide(); // return slide gradient\n    } else {\n      console.log('unknown animation type: ' + String(currentAnimation));\n    }\n  }\n\n  private animateGlow() {\n    var glowEnd = 255,\n      rgbStart = 68,\n      r = rgbStart,\n      g = r,\n      b = r,\n      increment = 10,\n      interval = 800;\n\n    return () => {\n      var smartInc = increment * (this.diffTime / (1000 / 60));\n      if(this.paused) {\n        if((Date.now() - this.pausedTime) > interval) {\n          r = rgbStart;\n          this.cycleAnimation()\n          this.paused = false;\n        }\n      } else {\n        r = parseInt('' + (r + smartInc));\n        if(r >= glowEnd) {\n          this.paused = true;\n          this.pausedTime = Date.now()\n        }\n      }\n      return 'rgb('+ r + ',' + r + ',' + r + ')';\n    };\n  }\n\n  private animateSlide(): CanvasGradient {\n    var gradient = this.ctx.createLinearGradient(0, 0, this.canvas.width, 0),\n      smartInc = this.inc * (this.diffTime / (1000 / 60)),\n      lightLeft,\n      lightRight,\n      lightCenter;\n    if(this.paused) {\n      if((Date.now() - this.pausedTime) > this.pauseInterval) {\n        this.lightSource = -0.6;\n        this.cycleAnimation()\n        this.paused = false;\n        return this.animateSlide();\n      }\n    } else {\n      this.lightSource += smartInc;\n      if(this.lightSource > (1 + this.lightSpread)) {\n        this.paused = true;\n        this.pausedTime = Date.now();\n      }\n    }\n    // lighting positions:\n    lightCenter = clamp(this.lightSource, 0, 1);\n    lightLeft = clamp(this.lightSource - this.lightSpread, 0, 1);\n    lightRight = clamp(this.lightSource + this.lightSpread, 0, 1);\n\n    const backgroundColor = customProperties.getProperty('background-color-true');\n    const shimmerColor = customProperties.getProperty('surface-color');\n    gradient.addColorStop(lightLeft, backgroundColor);\n    gradient.addColorStop(lightCenter, shimmerColor);\n    gradient.addColorStop(lightRight, backgroundColor);\n\n    return gradient;\n  }\n\n  public settings(dict: Partial<{\n    canvas: Shimmer['canvas'],\n    fillStyle: Shimmer['fillStyle'],\n    font: Shimmer['font'],\n    lightSpread: Shimmer['lightSpread'],\n    inc: Shimmer['inc'],\n    animations: Shimmer['animations'],\n    text: Shimmer['text']\n  }> = {}) {\n    this.canvas = dict.canvas ?? document.createElement('canvas');\n    this.ctx = this.canvas.getContext('2d');\n    this.font = dict.font ?? this.font;\n    this.lightSpread = dict.lightSpread ?? this.lightSpread;\n    this.inc = dict.inc ?? this.inc;\n    this.animations = dict.animations ?? this.animations;\n    this.text = dict.text ?? this.text;\n    this.fillStyle = dict.fillStyle;\n\n    this.canvas.classList.add('shimmer-canvas');\n  }\n\n  public on() {\n    const {width, height} = this.canvas;\n    // record the time we ran:\n    this.keepTime();\n    // clear and fill the canvas:\n    this.ctx.clearRect(0, 0, width, height);\n\n    if(this.font) {\n      this.ctx.font = this.font;\n    }\n\n    this.ctx.fillStyle = this.animate() as any;\n    this.ctx.fillRect(0, 0, width, height);\n\n    if(this.fillStyle) {\n      this.ctx.fillStyle = this.fillStyle;\n      this.ctx.fillRect(0, 0, width, height);\n    }\n\n    if(this.text) {\n      this.ctx.fillText(this.text, 50, 50);\n    }\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport Scrollable from '../components/scrollable';\nimport rootScope from '../lib/rootScope';\nimport {animate} from './animation';\nimport {drawCircleFromStart} from './canvas/drawCircle';\nimport roundRect from './canvas/roundRect';\nimport Shimmer from './canvas/shimmer';\nimport customProperties from './dom/customProperties';\nimport easeInOutSine from './easing/easeInOutSine';\nimport mediaSizes from './mediaSizes';\n\nexport default class DialogsPlaceholder {\n  private canvas: HTMLCanvasElement;\n  private ctx: CanvasRenderingContext2D;\n  private shimmer: Shimmer;\n  private tempId: number;\n  private detachTime: number;\n\n  private length: number;\n  private dialogHeight: number;\n  private availableLength: number;\n\n  private avatarSize: number;\n  private marginVertical: number;\n  private lineHeight: number;\n  private lineBorderRadius: number;\n  private lineMarginVertical: number;\n  private statusWidth: number;\n  private generatedValues: {\n    firstLineWidth: number,\n    secondLineWidth: number,\n    statusWidth: number\n  }[];\n\n  private getRectFrom: Element;\n  private onRemove: () => void;\n  private blockScrollable: Scrollable;\n\n  constructor() {\n    this.shimmer = new Shimmer();\n    this.tempId = 0;\n    this.canvas = document.createElement('canvas');\n    this.canvas.classList.add('dialogs-placeholder-canvas');\n    this.ctx = this.canvas.getContext('2d');\n\n    this.generatedValues = [];\n    this.avatarSize = 54;\n    this.marginVertical = 9;\n    this.lineHeight = 10;\n    this.lineBorderRadius = 6;\n    this.lineMarginVertical = 8;\n    this.statusWidth = 24;\n  }\n\n  public attach({container, rect, getRectFrom, onRemove, blockScrollable}: {\n    container: HTMLElement,\n    rect?: {width: number, height: number},\n    getRectFrom?: HTMLElement,\n    onRemove?: DialogsPlaceholder['onRemove'],\n    blockScrollable?: DialogsPlaceholder['blockScrollable']\n  }) {\n    const {canvas} = this;\n\n    this.onRemove = onRemove;\n    this.getRectFrom = getRectFrom || container;\n    if(this.blockScrollable = blockScrollable) {\n      blockScrollable.container.style.overflowY = 'hidden';\n    }\n\n    this.updateCanvasSize(rect);\n    this.startAnimation();\n    container.append(canvas);\n  }\n\n  public detach(availableLength: number) {\n    if(this.detachTime) {\n      return;\n    }\n\n    this.availableLength = availableLength;\n    this.detachTime = Date.now();\n\n    if(!rootScope.settings.animationsEnabled) {\n      this.remove();\n    }\n  }\n\n  public remove() {\n    this.stopAnimation();\n\n    if(this.canvas.parentElement) {\n      this.canvas.remove();\n\n      if(this.onRemove) {\n        this.onRemove();\n        this.onRemove = undefined;\n      }\n\n      if(this.blockScrollable) {\n        this.blockScrollable.container.style.overflowY = '';\n        this.blockScrollable = undefined;\n      }\n    }\n  }\n\n  private updateCanvasSize(rect: {width: number, height: number} = this.getRectFrom.getBoundingClientRect()) {\n    const {canvas} = this;\n    const dpr = canvas.dpr = window.devicePixelRatio;\n    canvas.width = rect.width * dpr;\n    canvas.height = rect.height * dpr;\n    canvas.style.width = rect.width + 'px';\n    canvas.style.height = rect.height + 'px';\n  }\n\n  private renderDetachAnimationFrame() {\n    const {\n      canvas,\n      ctx,\n      detachTime,\n      length,\n      availableLength\n    } = this;\n\n    if(!detachTime) {\n      return;\n    } else if(!rootScope.settings.animationsEnabled) {\n      this.remove();\n      return;\n    }\n\n    const {width} = canvas;\n\n    ctx.globalCompositeOperation = 'destination-out';\n\n    // ctx.fillStyle = 'rgba(0, 0, 0, 0)';\n    // ctx.fillRect(0, 0, width, height);\n\n    // const DURATION = 500;\n    // const DELAY = DURATION;\n    const DURATION = 150;\n    const DELAY = 15;\n    const elapsedTime = Date.now() - detachTime;\n    let completed = true;\n    for(let i = 0; i < length; ++i) {\n      const delay = availableLength < length && i >= availableLength ? DELAY * (availableLength - 1) : DELAY * i;\n      const elapsedRowTime = elapsedTime - delay;\n      if(elapsedRowTime <= 0) {\n        completed = false;\n        continue;\n      }\n\n      const progress = easeInOutSine(elapsedRowTime, 0, 1, DURATION);\n\n      ctx.beginPath();\n      ctx.rect(0, this.dialogHeight * i, width, this.dialogHeight);\n      ctx.fillStyle = `rgba(0, 0, 0, ${progress})`;\n      ctx.fill();\n\n      if(progress < 1) {\n        completed = false;\n      }\n    }\n\n    // const totalRadius = Math.sqrt(width ** 2 + height ** 2);\n    // const gradient = ctx.createRadialGradient(\n    //   0, 0, 0,\n    //   0, 0, totalRadius);\n    // gradient.addColorStop(0, 'rgba(0, 0, 0, 1)');\n    // gradient.addColorStop(progress, 'rgba(0, 0, 0, 0)');\n    // gradient.addColorStop(1, 'rgba(0, 0, 0, 0)');\n\n    // const gradient = ctx.createLinearGradient(0, 0, 0, height);\n    // gradient.addColorStop(0, 'rgba(0, 0, 0, 1)');\n    // gradient.addColorStop(progress, 'rgba(0, 0, 0, 0)');\n    // gradient.addColorStop(1, 'rgba(0, 0, 0, 0)');\n\n    // ctx.fillStyle = gradient;\n    // ctx.fillRect(0, 0, width, height);\n\n    ctx.globalCompositeOperation = 'source-over';\n\n    if(completed) {\n      this.remove();\n    }\n  }\n\n  private renderFrame() {\n    this.shimmer.on();\n    this.renderDetachAnimationFrame();\n  }\n\n  private startAnimation() {\n    const {canvas, shimmer} = this;\n    const tempId = ++this.tempId;\n    const pattern = this.createPattern();\n\n    shimmer.settings({\n      canvas,\n      fillStyle: pattern\n    });\n\n    const middleware = () => {\n      return this.tempId === tempId;\n    };\n\n    this.renderFrame();\n    animate(() => {\n      if(!middleware()) {\n        return false;\n      }\n\n      // ! should've removed the loop if animations are disabled\n      if(rootScope.settings.animationsEnabled) {\n        this.renderFrame();\n      }\n\n      // ! tempId can be changed during renderFrame\n      return middleware();\n    });\n\n    rootScope.addEventListener('theme_change', this.onThemeChange);\n    mediaSizes.addEventListener('resize', this.onResize);\n  }\n\n  private stopAnimation() {\n    ++this.tempId;\n    rootScope.removeEventListener('theme_change', this.onThemeChange);\n    mediaSizes.removeEventListener('resize', this.onResize);\n  }\n\n  private onThemeChange = () => {\n    this.stopAnimation();\n    this.startAnimation();\n  };\n\n  private onResize = () => {\n    const {canvas} = this;\n    const {width, height, dpr} = canvas;\n    this.updateCanvasSize();\n    if(canvas.width === width && canvas.height === height && canvas.dpr === dpr) {\n      return;\n    }\n\n    this.stopAnimation();\n    this.startAnimation();\n  };\n\n  private createPattern() {\n    const {canvas, ctx} = this;\n\n    const patternCanvas = document.createElement('canvas');\n    const patternContext = patternCanvas.getContext('2d');\n    const dpr = canvas.dpr;\n    patternCanvas.dpr = dpr;\n    patternCanvas.width = canvas.width;\n    patternCanvas.height = canvas.height;\n\n    patternContext.fillStyle = customProperties.getProperty('surface-color');\n    patternContext.fillRect(0, 0, patternCanvas.width, patternCanvas.height);\n\n    patternContext.fillStyle = '#000';\n    patternContext.globalCompositeOperation = 'destination-out';\n\n    const dialogHeight = this.dialogHeight = (this.avatarSize + this.marginVertical * 2) * dpr;\n    const length = this.length = Math.ceil(canvas.height / dialogHeight);\n    for(let i = 0; i < length; ++i) {\n      this.drawChat(patternContext, i, i * dialogHeight);\n    }\n\n    return ctx.createPattern(patternCanvas, 'no-repeat');\n  }\n\n  private drawChat(ctx: CanvasRenderingContext2D, i: number, y: number) {\n    let generatedValues = this.generatedValues[i];\n    if(!generatedValues) {\n      generatedValues = this.generatedValues[i] = {\n        firstLineWidth: 40 + Math.random() * 100, // 120\n        secondLineWidth: 120 + Math.random() * 130, // 240\n        statusWidth: 24 + Math.random() * 16\n      };\n    }\n\n    const {\n      firstLineWidth,\n      secondLineWidth,\n      statusWidth\n    } = generatedValues;\n\n    const {canvas} = ctx;\n    const {dpr} = canvas;\n    y /= dpr;\n\n    const {\n      avatarSize,\n      marginVertical,\n      lineHeight,\n      lineBorderRadius,\n      lineMarginVertical\n    } = this;\n\n    let marginLeft = 17;\n    drawCircleFromStart(ctx, marginLeft, y + marginVertical, avatarSize / 2, true);\n\n    marginLeft += avatarSize + 10;\n    roundRect(ctx, marginLeft, y + marginVertical + lineMarginVertical, firstLineWidth, lineHeight, lineBorderRadius, true);\n    roundRect(ctx, marginLeft, y + marginVertical + avatarSize - lineHeight - lineMarginVertical, secondLineWidth, lineHeight, lineBorderRadius, true);\n\n    roundRect(ctx, canvas.width / dpr - 24 - statusWidth, y + marginVertical + lineMarginVertical, statusWidth, lineHeight, lineBorderRadius, true);\n  }\n}\n","export default function drawCircle(ctx: CanvasRenderingContext2D, x: number, y: number, radius: number, fill?: boolean, stroke?: boolean) {\n  const dpr = ctx.canvas.dpr;\n  if(dpr) {\n    x *= dpr;\n    y *= dpr;\n    radius *= dpr;\n  }\n\n  ctx.beginPath();\n  ctx.arc(x, y, radius, 0, 2 * Math.PI, false);\n  ctx.closePath();\n\n  if(fill) {\n    ctx.fill();\n  }\n\n  if(stroke) {\n    ctx.stroke();\n  }\n}\n\nexport function drawCircleFromStart(ctx: CanvasRenderingContext2D, x: number, y: number, radius: number, fill?: boolean, stroke?: boolean) {\n  return drawCircle(ctx, x + radius, y + radius, radius, fill, stroke);\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport type {MyDialogFilter as DialogFilter, MyDialogFilter} from '../storages/filters';\nimport type LazyLoadQueue from '../../components/lazyLoadQueue';\nimport type {Dialog, MyMessage} from './appMessagesManager';\nimport type {MyPhoto} from './appPhotosManager';\nimport type {MyDocument} from './appDocsManager';\nimport type {State} from '../../config/state';\nimport AvatarElement from '../../components/avatar';\nimport DialogsContextMenu from '../../components/dialogsContextMenu';\nimport {horizontalMenu} from '../../components/horizontalMenu';\nimport ripple from '../../components/ripple';\nimport Scrollable, {ScrollableX, SliceSides} from '../../components/scrollable';\nimport {formatDateAccordingToTodayNew} from '../../helpers/date';\nimport {IS_MOBILE_SAFARI, IS_SAFARI} from '../../environment/userAgent';\nimport {logger, LogTypes} from '../logger';\nimport rootScope from '../rootScope';\nimport appImManager from './appImManager';\nimport Button from '../../components/button';\nimport SetTransition from '../../components/singleTransition';\nimport {MyDraftMessage} from './appDraftsManager';\nimport DEBUG, {MOUNT_CLASS_TO} from '../../config/debug';\nimport PeerTitle from '../../components/peerTitle';\nimport I18n, {FormatterArguments, i18n, LangPackKey, _i18n} from '../langPack';\nimport findUpTag from '../../helpers/dom/findUpTag';\nimport lottieLoader from '../rlottie/lottieLoader';\nimport {wrapPhoto} from '../../components/wrappers';\nimport AppEditFolderTab from '../../components/sidebarLeft/tabs/editFolder';\nimport appSidebarLeft, {SettingSection} from '../../components/sidebarLeft';\nimport {attachClickEvent} from '../../helpers/dom/clickEvent';\nimport positionElementByIndex from '../../helpers/dom/positionElementByIndex';\nimport replaceContent from '../../helpers/dom/replaceContent';\nimport ConnectionStatusComponent from '../../components/connectionStatus';\nimport {renderImageFromUrlPromise} from '../../helpers/dom/renderImageFromUrl';\nimport {fastRafConventional, fastRafPromise} from '../../helpers/schedulers';\nimport SortedUserList from '../../components/sortedUserList';\nimport IS_TOUCH_SUPPORTED from '../../environment/touchSupport';\nimport handleTabSwipe from '../../helpers/dom/handleTabSwipe';\nimport windowSize from '../../helpers/windowSize';\nimport isInDOM from '../../helpers/dom/isInDOM';\nimport {setSendingStatus} from '../../components/sendingStatus';\nimport SortedList, {SortedElementBase} from '../../helpers/sortedList';\nimport debounce from '../../helpers/schedulers/debounce';\nimport {FOLDER_ID_ALL, FOLDER_ID_ARCHIVE, NULL_PEER_ID, REAL_FOLDERS, REAL_FOLDER_ID} from '../mtproto/mtproto_config';\nimport groupCallActiveIcon from '../../components/groupCallActiveIcon';\nimport {Chat, Message, NotifyPeer} from '../../layer';\nimport IS_GROUP_CALL_SUPPORTED from '../../environment/groupCallSupport';\nimport mediaSizes from '../../helpers/mediaSizes';\nimport appNavigationController, {NavigationItem} from '../../components/appNavigationController';\nimport assumeType from '../../helpers/assumeType';\nimport appMediaPlaybackController from '../../components/appMediaPlaybackController';\nimport setInnerHTML from '../../helpers/dom/setInnerHTML';\nimport {AppManagers} from './managers';\nimport appSidebarRight from '../../components/sidebarRight';\nimport PopupElement from '../../components/popups';\nimport choosePhotoSize from './utils/photos/choosePhotoSize';\nimport wrapEmojiText from '../richTextProcessor/wrapEmojiText';\nimport wrapMessageForReply from '../../components/wrappers/messageForReply';\nimport isMessageRestricted from './utils/messages/isMessageRestricted';\nimport getMediaFromMessage from './utils/messages/getMediaFromMessage';\nimport getMessageSenderPeerIdOrName from './utils/messages/getMessageSenderPeerIdOrName';\nimport wrapStickerEmoji from '../../components/wrappers/stickerEmoji';\nimport getDialogIndexKey from './utils/dialogs/getDialogIndexKey';\nimport getProxiedManagers from './getProxiedManagers';\nimport getDialogIndex from './utils/dialogs/getDialogIndex';\nimport {attachContextMenuListener} from '../../helpers/dom/attachContextMenuListener';\nimport deferredPromise, {CancellablePromise} from '../../helpers/cancellablePromise';\nimport wrapPeerTitle from '../../components/wrappers/peerTitle';\nimport middlewarePromise from '../../helpers/middlewarePromise';\nimport appDownloadManager from './appDownloadManager';\nimport groupCallsController from '../calls/groupCallsController';\nimport callsController from '../calls/callsController';\nimport cancelEvent from '../../helpers/dom/cancelEvent';\nimport noop from '../../helpers/noop';\nimport DialogsPlaceholder from '../../helpers/dialogsPlaceholder';\nimport pause from '../../helpers/schedulers/pause';\nimport apiManagerProxy from '../mtproto/mtprotoworker';\nimport filterAsync from '../../helpers/array/filterAsync';\nimport forEachReverse from '../../helpers/array/forEachReverse';\nimport indexOfAndSplice from '../../helpers/array/indexOfAndSplice';\nimport whichChild from '../../helpers/dom/whichChild';\n\nexport const DIALOG_LIST_ELEMENT_TAG = 'A';\n\nexport type DialogDom = {\n  avatarEl: AvatarElement,\n  captionDiv: HTMLDivElement,\n  titleSpan: HTMLSpanElement,\n  titleSpanContainer: HTMLSpanElement,\n  statusSpan: HTMLSpanElement,\n  lastTimeSpan: HTMLSpanElement,\n  unreadBadge: HTMLElement,\n  callIcon?: ReturnType<typeof groupCallActiveIcon>,\n  mentionsBadge?: HTMLElement,\n  lastMessageSpan: HTMLSpanElement,\n  containerEl: HTMLElement,\n  listEl: HTMLElement,\n  subtitleEl: HTMLElement,\n\n  setLastMessagePromise?: CancellablePromise<void>,\n  setUnreadMessagePromise?: CancellablePromise<void>\n};\n\ninterface SortedDialog extends SortedElementBase {\n  dom: DialogDom,\n  loadPromises?: Promise<any>[]\n}\n\nfunction setPromiseMiddleware<T extends {[smth in K as K]?: CancellablePromise<void>}, K extends keyof T>(obj: T, key: K) {\n  const oldPromise: CancellablePromise<void> = obj[key] as any;\n  if(oldPromise) {\n    oldPromise.reject();\n  }\n\n  // @ts-ignore\n  const deferred = obj[key] = deferredPromise<void>();\n  deferred.catch(() => {}).finally(() => {\n    if((obj[key] as any) === deferred) {\n      delete obj[key];\n    }\n  });\n\n  const middleware = middlewarePromise(() => (obj[key] as any) === deferred);\n  return {deferred, middleware};\n}\n\nclass SortedDialogList extends SortedList<SortedDialog> {\n  constructor(\n    public managers: AppManagers,\n    public list: HTMLUListElement,\n    public indexKey: ReturnType<typeof getDialogIndexKey>,\n    public onListLengthChange?: () => void\n  ) {\n    super({\n      getIndex: (element) => managers.dialogsStorage.getDialogIndex(element.id, this.indexKey),\n      onDelete: (element) => {\n        element.dom.listEl.remove();\n        this.onListLengthChange && this.onListLengthChange();\n      },\n      onSort: (element, idx) => {\n        const willChangeLength = element.dom.listEl.parentElement !== this.list;\n        positionElementByIndex(element.dom.listEl, this.list, idx);\n\n        if(willChangeLength) {\n          this.onListLengthChange && this.onListLengthChange();\n        }\n      },\n      onElementCreate: (base, batch) => {\n        const loadPromises: Promise<any>[] = batch ? [] : undefined;\n\n        const {dom} = appDialogsManager.addListDialog({peerId: base.id, loadPromises, isBatch: batch});\n        (base as SortedDialog).dom = dom;\n\n        if(loadPromises?.length) {\n          (base as SortedDialog).loadPromises = loadPromises;\n          Promise.all(loadPromises).finally(() => {\n            delete (base as SortedDialog).loadPromises;\n          });\n        }\n\n        return base as SortedDialog;\n      },\n      updateElementWith: fastRafConventional\n    });\n  }\n\n  public clear() {\n    this.list.textContent = '';\n    super.clear();\n  }\n}\n\n// const testScroll = false;\n// let testTopSlice = 1;\n\nexport class AppDialogsManager {\n  private chatsContainer = document.getElementById('chatlist-container') as HTMLDivElement;\n\n  private loadDialogsPromise: Promise<{cached: boolean, renderPromise: AppDialogsManager['loadDialogsRenderPromise']}>;\n  private loadDialogsRenderPromise: Promise<void>;\n\n  private scroll: Scrollable = null;\n\n  private log = logger('DIALOGS', LogTypes.Log | LogTypes.Error | LogTypes.Warn | LogTypes.Debug);\n\n  private contextMenu: DialogsContextMenu;\n\n  private sortedList: SortedDialogList;\n  public placeholders: {[filterId: number]: DialogsPlaceholder} = {};\n  public sortedLists: {[filterId: number]: SortedDialogList} = {};\n  public scrollables: {[filterId: number]: Scrollable} = {};\n  public filterId: number;\n  private folders: {[k in 'menu' | 'container' | 'menuScrollContainer']: HTMLElement} = {\n    menu: document.getElementById('folders-tabs'),\n    menuScrollContainer: null,\n    container: document.getElementById('folders-container')\n  };\n  private filtersRendered: {\n    [filterId: string]: {\n      menu: HTMLElement,\n      container: HTMLElement,\n      unread: HTMLElement,\n      title: HTMLElement\n    }\n  } = {};\n  private showFiltersPromise: Promise<void>;\n\n  private sliceTimeout: number;\n\n  private lastActiveElements: Set<HTMLElement> = new Set();\n\n  private offsets: {top: number, bottom: number} = {top: 0, bottom: 0};\n\n  private loadContacts: () => void;\n  private processContact: (peerId: PeerId) => void;\n\n  private indexKey: ReturnType<typeof getDialogIndexKey>;\n\n  private initedListeners = false;\n\n  private onListLengthChange: () => Promise<void>;\n  private loadedDialogsAtLeastOnce = false;\n  private allChatsIntlElement: I18n.IntlElement;\n\n  private emptyDialogsPlaceholderSubtitle: I18n.IntlElement;\n  private updateContactsLengthPromise: Promise<number>;\n\n  private filtersNavigationItem: NavigationItem;\n\n  private managers: AppManagers;\n  private selectTab: ReturnType<typeof horizontalMenu>;\n\n  private doNotRenderChatList: boolean;\n\n  public start() {\n    const managers = this.managers = getProxiedManagers();\n\n    this.contextMenu = new DialogsContextMenu(managers);\n\n    this.folders.menuScrollContainer = this.folders.menu.parentElement;\n\n    this.onListLengthChange = debounce(this._onListLengthChange, 100, false, true);\n\n    const bottomPart = document.createElement('div');\n    bottomPart.classList.add('connection-status-bottom');\n    bottomPart.append(this.folders.container);\n\n    /* if(isTouchSupported && isSafari) {\n      let allowUp: boolean, allowDown: boolean, slideBeginY: number;\n      const container = this.scroll.container;\n      container.addEventListener('touchstart', (event) => {\n        allowUp = container.scrollTop > 0;\n        allowDown = (container.scrollTop < container.scrollHeight - container.clientHeight);\n        // @ts-ignore\n        slideBeginY = event.pageY;\n      });\n\n      container.addEventListener('touchmove', (event: any) => {\n        var up = (event.pageY > slideBeginY);\n        var down = (event.pageY < slideBeginY);\n        slideBeginY = event.pageY;\n        if((up && allowUp) || (down && allowDown)) {\n          event.stopPropagation();\n        } else if(up || down) {\n          event.preventDefault();\n        }\n      });\n    } */\n\n    if(IS_TOUCH_SUPPORTED) {\n      handleTabSwipe({\n        element: this.folders.container,\n        onSwipe: (xDiff) => {\n          const prevId = selectTab.prevId();\n          selectTab(xDiff > 0 ? prevId + 1 : prevId - 1);\n        }\n      });\n    }\n\n    this.allChatsIntlElement = new I18n.IntlElement({\n      key: 'FilterAllChatsShort'\n    });\n\n    /* if(testScroll) {\n      let i = 0;\n      let add = () => {\n        let li = document.createElement('li');\n        li.dataset.id = '' + i;\n        li.id = '' + i;\n        li.innerHTML = `<div class=\"rp\"><avatar-element style=\"background-color: rgb(166, 149, 231); font-size: 0px;\"><img src=\"assets/img/pepe.jpg\"></avatar-element><div class=\"user-caption\"><p><span class=\"user-title\">${i}</span><span><span class=\"message-status\"></span><span class=\"message-time\">18:33</span></span></p><p><span class=\"user-last-message\"><b>-_-_-_-: </b>qweasd</span><span></span></p></div></div>`;\n        i++;\n        this.scroll.append(li);\n      };\n      for(let i = 0; i < 500; ++i) {\n        add();\n      }\n      (window as any).addElement = add;\n    } */\n\n    rootScope.addEventListener('premium_toggle', async(isPremium) => {\n      if(isPremium) {\n        return;\n      }\n\n      const isFolderAvailable = await this.managers.filtersStorage.isFilterIdAvailable(this.filterId);\n      if(!isFolderAvailable) {\n        selectTab(whichChild(this.filtersRendered[FOLDER_ID_ALL].menu), false);\n      }\n    });\n\n    rootScope.addEventListener('state_cleared', () => {\n      const clearCurrent = REAL_FOLDERS.has(this.filterId);\n      // setTimeout(() =>\n      apiManagerProxy.getState().then(async(state) => {\n        this.loadedDialogsAtLeastOnce = false;\n\n        /* const clearPromises: Promise<any>[] = [];\n        for(const name in this.managers.appStateManager.storagesResults) {\n          const results = this.managers.appStateManager.storagesResults[name as keyof AppStateManager['storages']];\n          const storage = this.managers.appStateManager.storages[name as keyof AppStateManager['storages']];\n          results.length = 0;\n          clearPromises.push(storage.clear());\n        } */\n\n        if(clearCurrent) {\n          this.sortedList.clear();\n          this.onTabChange();\n        }\n\n        this.onStateLoaded(state);\n      })// , 5000);\n    });\n\n    this.setFilterId(FOLDER_ID_ALL, FOLDER_ID_ALL);\n    this.addFilter({\n      id: FOLDER_ID_ALL,\n      title: '',\n      localId: FOLDER_ID_ALL\n    });\n\n    const foldersScrollable = new ScrollableX(this.folders.menuScrollContainer);\n    bottomPart.prepend(this.folders.menuScrollContainer);\n    const selectTab = this.selectTab = horizontalMenu(this.folders.menu, this.folders.container, async(id, tabContent) => {\n      /* if(id !== 0) {\n        id += 1;\n      } */\n\n      const _id = id;\n      id = +tabContent.dataset.filterId || FOLDER_ID_ALL;\n\n      const isFilterAvailable = REAL_FOLDERS.has(id) || await this.managers.filtersStorage.isFilterIdAvailable(id);\n      if(!isFilterAvailable) {\n        return false;\n      }\n\n      const wasFilterId = this.filterId;\n      if(!IS_MOBILE_SAFARI) {\n        if(_id) {\n          if(!this.filtersNavigationItem) {\n            this.filtersNavigationItem = {\n              type: 'filters',\n              onPop: () => {\n                selectTab(0);\n                this.filtersNavigationItem = undefined;\n              }\n            };\n\n            appNavigationController.spliceItems(1, 0, this.filtersNavigationItem);\n          }\n        } else if(this.filtersNavigationItem) {\n          appNavigationController.removeItem(this.filtersNavigationItem);\n          this.filtersNavigationItem = undefined;\n        }\n      }\n\n      if(wasFilterId === id) return;\n\n      this.sortedLists[id].clear();\n      const promise = this.setFilterIdAndChangeTab(id).then(({cached, renderPromise}) => {\n        if(cached) {\n          return renderPromise;\n        }\n      });\n\n      if(wasFilterId !== -1) {\n        return promise;\n      }\n    }, () => {\n      for(const folderId in this.sortedLists) {\n        if(+folderId !== this.filterId) {\n          this.sortedLists[folderId].clear();\n          const placeholder = this.placeholders[folderId];\n          if(placeholder) {\n            placeholder.remove();\n          }\n        }\n      }\n    }, undefined, foldersScrollable);\n\n    apiManagerProxy.getState().then((state) => {\n      // * it should've had a better place :(\n      appMediaPlaybackController.setPlaybackParams(state.playbackParams);\n      appMediaPlaybackController.addEventListener('playbackParams', (params) => {\n        this.managers.appStateManager.pushToState('playbackParams', params);\n      });\n\n      return this.onStateLoaded(state);\n    })/* .then(() => {\n      const isLoadedMain = this.managers.appMessagesManager.dialogsStorage.isDialogsLoaded(0);\n      const isLoadedArchive = this.managers.appMessagesManager.dialogsStorage.isDialogsLoaded(1);\n      const wasLoaded = isLoadedMain || isLoadedArchive;\n      const a: Promise<any> = isLoadedMain ? Promise.resolve() : this.managers.appMessagesManager.getConversationsAll('', 0);\n      const b: Promise<any> = isLoadedArchive ? Promise.resolve() : this.managers.appMessagesManager.getConversationsAll('', 1);\n      a.finally(() => {\n        b.then(() => {\n          if(wasLoaded) {\n            (apiUpdatesManager.updatesState.syncLoading || Promise.resolve()).then(() => {\n              this.managers.appMessagesManager.refreshConversations();\n            });\n          }\n        });\n      });\n    }) */;\n\n    mediaSizes.addEventListener('resize', () => {\n      this.changeFiltersAllChatsKey();\n    });\n\n    new ConnectionStatusComponent(this.managers, this.chatsContainer);\n    this.chatsContainer.append(bottomPart);\n\n    setTimeout(() => {\n      lottieLoader.loadLottieWorkers();\n    }, 200);\n\n    PopupElement.MANAGERS = rootScope.managers = managers;\n    appDownloadManager.construct(managers);\n    appSidebarLeft.construct(managers);\n    appSidebarRight.construct(managers);\n    groupCallsController.construct(managers);\n    callsController.construct(managers);\n    appImManager.construct(managers);\n\n    // start\n\n    this.sortedList = this.sortedLists[this.filterId];\n    this.scroll = this.scrollables[this.filterId];\n\n    // selectTab(0, false);\n  }\n\n  public get chatList() {\n    return this.sortedList.list;\n  }\n\n  public setFilterId(filterId: number, localId: MyDialogFilter['localId']) {\n    this.filterId = filterId;\n    this.indexKey = getDialogIndexKey(REAL_FOLDERS.has(filterId) ? filterId as REAL_FOLDER_ID : localId);\n  }\n\n  public async setFilterIdAndChangeTab(filterId: number) {\n    this.filterId = filterId;\n    this.indexKey = await this.managers.dialogsStorage.getDialogIndexKeyByFilterId(filterId);\n    return this.onTabChange();\n  }\n\n  private setOnlineStatus(element: HTMLElement, online: boolean) {\n    const className = 'is-online';\n    const hasClassName = element.classList.contains(className);\n    !hasClassName && online && element.classList.add(className);\n    SetTransition(element, 'is-visible', online, 250, online ? undefined : () => {\n      element.classList.remove(className);\n    }, online && !hasClassName ? 2 : 0);\n  }\n\n  private initListeners() {\n    rootScope.addEventListener('user_update', async(userId) => {\n      // console.log('updating user:', user, dialog);\n\n      const peerId = userId.toPeerId();\n      const dom = this.getDialogDom(peerId);\n      if(dom && peerId !== rootScope.myId && !(await this.managers.appUsersManager.isBot(userId))) {\n        const user = await this.managers.appUsersManager.getUser(userId);\n        const online = user.status?._ === 'userStatusOnline';\n        this.setOnlineStatus(dom.avatarEl, online);\n      }\n    });\n\n    rootScope.addEventListener('chat_update', async(chatId) => {\n      const peerId = chatId.toPeerId(true);\n      const dialog = await this.managers.appMessagesManager.getDialogOnly(peerId);\n      if(dialog) {\n        this.processDialogForCallStatus(dialog);\n      }\n    });\n\n    rootScope.addEventListener('folder_unread', (folder) => {\n      this.setFilterUnreadCount(folder.id);\n    });\n\n    rootScope.addEventListener('contacts_update', (userId) => {\n      this.processContact && this.processContact(userId.toPeerId());\n    });\n\n    rootScope.addEventListener('dialog_flush', ({dialog}) => {\n      if(!dialog) {\n        return;\n      }\n\n      this.setLastMessageN({\n        dialog,\n        setUnread: true\n      });\n      this.validateDialogForFilter(dialog);\n      this.setFiltersUnreadCount();\n    });\n\n    rootScope.addEventListener('dialogs_multiupdate', (dialogs) => {\n      for(const [peerId, dialog] of dialogs) {\n        this.updateDialog(dialog);\n\n        if(this.processContact) {\n          this.processContact(peerId.toPeerId());\n        }\n\n        this.validateDialogForFilter(dialog);\n      }\n    });\n\n    rootScope.addEventListener('dialog_drop', ({peerId}) => {\n      this.deleteDialog(peerId);\n\n      if(this.processContact) {\n        this.processContact(peerId);\n      }\n    });\n\n    rootScope.addEventListener('dialog_unread', ({dialog}) => {\n      if(!dialog) {\n        return;\n      }\n\n      this.setUnreadMessagesN({dialog});\n      this.validateDialogForFilter(dialog);\n    });\n\n    rootScope.addEventListener('dialog_notify_settings', (dialog) => {\n      this.validateDialogForFilter(dialog);\n      this.setUnreadMessagesN({dialog}); //    ,    is-muted\n    });\n\n    rootScope.addEventListener('dialog_draft', ({dialog, drop, peerId}) => {\n      if(drop) {\n        this.sortedList.delete(peerId);\n      } else {\n        this.updateDialog(dialog);\n      }\n\n      if(this.processContact) {\n        this.processContact(peerId);\n      }\n    });\n\n    appImManager.addEventListener('peer_changed', (peerId) => {\n      // const perf = performance.now();\n      for(const element of this.lastActiveElements) {\n        if(element.dataset.peerId.toPeerId() !== peerId) {\n          this.setDialogActive(element, false);\n        }\n      }\n\n      const elements = Array.from(document.querySelectorAll(`[data-autonomous=\"0\"] .chatlist-chat[data-peer-id=\"${peerId}\"]`)) as HTMLElement[];\n      elements.forEach((element) => {\n        this.setDialogActive(element, true);\n      });\n      // this.log('peer_changed total time:', performance.now() - perf);\n    });\n\n    rootScope.addEventListener('filter_update', async(filter) => {\n      if(REAL_FOLDERS.has(filter.id)) {\n        return;\n      }\n\n      if(!this.filtersRendered[filter.id]) {\n        this.addFilter(filter);\n        return;\n      } else if(filter.id === this.filterId) { //     ,    dialogs_multiupdate\n        const dialogs = await this.managers.dialogsStorage.getCachedDialogs(true);\n        await this.validateListForFilter();\n        for(let i = 0, length = dialogs.length; i < length; ++i) {\n          const dialog = dialogs[i];\n          this.updateDialog(dialog);\n        }\n      }\n\n      const elements = this.filtersRendered[filter.id];\n      setInnerHTML(elements.title, wrapEmojiText(filter.title));\n    });\n\n    rootScope.addEventListener('filter_delete', (filter) => {\n      const elements = this.filtersRendered[filter.id];\n      if(!elements) return;\n\n      // set tab\n      // (this.folders.menu.firstElementChild.children[Math.max(0, filter.id - 2)] as HTMLElement).click();\n      elements.container.remove();\n      elements.menu.remove();\n\n      delete this.sortedLists[filter.id];\n      delete this.scrollables[filter.id];\n      delete this.filtersRendered[filter.id];\n\n      this.onFiltersLengthChange();\n\n      if(this.filterId === filter.id) {\n        this.selectTab(0, false);\n      }\n    });\n\n    rootScope.addEventListener('filter_order', async(order) => {\n      order = order.slice();\n      indexOfAndSplice(order, FOLDER_ID_ARCHIVE);\n\n      const containerToAppend = this.folders.menu as HTMLElement;\n      const r = await Promise.all(order.map(async(filterId) => {\n        return {\n          indexKey: await this.managers.dialogsStorage.getDialogIndexKeyByFilterId(filterId),\n          filter: await this.managers.filtersStorage.getFilter(filterId)\n        };\n      }));\n\n      order.forEach((filterId, idx) => {\n        const {indexKey, filter} = r[idx];\n        const renderedFilter = this.filtersRendered[filterId];\n\n        const sortedList = this.sortedLists[filterId];\n        sortedList.indexKey = indexKey;\n\n        positionElementByIndex(renderedFilter.menu, containerToAppend, filter.localId);\n        positionElementByIndex(renderedFilter.container, this.folders.container, filter.localId);\n      });\n\n      this.indexKey = await this.managers.dialogsStorage.getDialogIndexKeyByFilterId(this.filterId);\n\n      /* if(this.filterId) {\n        const tabIndex = order.indexOf(this.filterId) + 1;\n        selectTab.prevId = tabIndex;\n      } */\n    });\n\n    rootScope.addEventListener('peer_typings', async({peerId, typings}) => {\n      const dialog = await this.managers.appMessagesManager.getDialogOnly(peerId);\n      if(!dialog) return;\n\n      if(typings.length) {\n        this.setTyping(dialog);\n      } else {\n        this.unsetTyping(dialog);\n      }\n    });\n  }\n\n  private setDialogActive(listEl: HTMLElement, active: boolean) {\n    // @ts-ignore\n    const dom = listEl.dialogDom as DialogDom;\n    listEl.classList.toggle('active', active);\n    if(active) {\n      this.lastActiveElements.add(listEl);\n    } else {\n      this.lastActiveElements.delete(listEl);\n    }\n\n    if(dom?.callIcon) {\n      dom.callIcon.setActive(active);\n    }\n  }\n\n  private async onStateLoaded(state: State) {\n    const filtersArr = state.filtersArr;\n    const haveFilters = filtersArr.length > REAL_FOLDERS.size;\n    // const filter = filtersArr.find((filter) => filter.id !== FOLDER_ID_ARCHIVE);\n\n    const addFilters = (filters: MyDialogFilter[]) => {\n      for(const filter of filters) {\n        this.addFilter(filter);\n      }\n    };\n\n    let addFiltersPromise: Promise<any>;\n    if(haveFilters) {\n      addFilters(filtersArr);\n    } else {\n      addFiltersPromise = this.managers.filtersStorage.getDialogFilters().then(addFilters);\n    }\n\n    this.doNotRenderChatList = true;\n    const loadDialogsPromise = this.onChatsScroll();\n    await loadDialogsPromise;\n\n    // show the placeholder before the filters, and then will reset to the default tab again\n    if(!haveFilters) {\n      this.selectTab(0, false);\n    }\n\n    addFiltersPromise && await addFiltersPromise;\n    // this.folders.menu.children[0].classList.add('active');\n\n    this.doNotRenderChatList = undefined;\n\n    this.filterId = -1;\n    this.selectTab(0, false);\n\n    if(!this.initedListeners) {\n      this.initListeners();\n      this.initedListeners = true;\n    }\n\n    haveFilters && this.showFiltersPromise && await this.showFiltersPromise;\n\n    this.managers.appNotificationsManager.getNotifyPeerTypeSettings();\n\n    await (await loadDialogsPromise).renderPromise.catch(noop);\n    this.managers.appMessagesManager.fillConversations();\n  }\n\n  /* private getOffset(side: 'top' | 'bottom'): {index: number, pos: number} {\n    if(!this.scroll.loadedAll[side]) {\n      const element = (side === 'top' ? this.chatList.firstElementChild : this.chatList.lastElementChild) as HTMLElement;\n      if(element) {\n        const peerId = element.dataset.peerId;\n        const dialog = this.managers.appMessagesManager.getDialogByPeerId(peerId);\n        return {index: dialog[0].index, pos: dialog[1]};\n      }\n    }\n\n    return {index: 0, pos: -1};\n  } */\n  private getOffsetIndex(side: 'top' | 'bottom') {\n    return {index: this.scroll.loadedAll[side] ? 0 : this.offsets[side]};\n  }\n\n  private isDialogMustBeInViewport(dialog: Dialog) {\n    if(dialog.migratedTo !== undefined || !this.testDialogForFilter(dialog)) return false;\n    // return true;\n    const topOffset = this.getOffsetIndex('top');\n    const bottomOffset = this.getOffsetIndex('bottom');\n\n    if(!topOffset.index && !bottomOffset.index) {\n      return true;\n    }\n\n    const index = getDialogIndex(dialog, this.indexKey);\n    return (!topOffset.index || index <= topOffset.index) && (!bottomOffset.index || index >= bottomOffset.index);\n  }\n\n  private deleteDialog(peerId: PeerId) {\n    this.sortedList.delete(peerId);\n  }\n\n  private updateDialog(dialog: Dialog) {\n    if(this.isDialogMustBeInViewport(dialog)) {\n      if(!this.sortedList.has(dialog.peerId)) {\n        this.sortedList.add(dialog.peerId);\n        return;\n      }\n    } else {\n      this.deleteDialog(dialog.peerId);\n      return;\n    }\n\n    const dom = this.getDialogDom(dialog.peerId);\n    if(dom) {\n      this.setLastMessageN({\n        dialog,\n        dom,\n        setUnread: true\n      });\n      this.sortedList.update(dialog.peerId);\n    }\n  }\n\n  public onTabChange = () => {\n    this.scroll = this.scrollables[this.filterId];\n    this.scroll.loadedAll.top = true;\n    this.scroll.loadedAll.bottom = false;\n    this.offsets.top = this.offsets.bottom = 0;\n    this.loadDialogsRenderPromise = undefined;\n    this.loadDialogsPromise = undefined;\n    this.sortedList = this.sortedLists[this.filterId];\n    return this.onChatsScroll();\n  };\n\n  private async setFilterUnreadCount(filterId: number) {\n    if(filterId === FOLDER_ID_ALL) {\n      return;\n    }\n\n    const unreadSpan = this.filtersRendered[filterId]?.unread;\n    if(!unreadSpan) {\n      return;\n    }\n\n    const {unreadUnmutedCount, unreadCount} = await this.managers.dialogsStorage.getFolderUnreadCount(filterId);\n    unreadSpan.classList.toggle('badge-gray', !unreadUnmutedCount);\n    unreadSpan.innerText = unreadCount ? '' + unreadCount : '';\n  }\n\n  private setFiltersUnreadCount() {\n    for(const filterId in this.filtersRendered) {\n      this.setFilterUnreadCount(+filterId);\n    }\n  }\n\n  /**\n   *     ,    (!)\n   */\n  private async validateListForFilter() {\n    this.sortedList.getAll().forEach(async(element) => {\n      const dialog = await this.managers.appMessagesManager.getDialogOnly(element.id);\n      if(!this.testDialogForFilter(dialog)) {\n        this.deleteDialog(element.id);\n      }\n    });\n  }\n\n  /**\n   *     ,    (!)\n   */\n  private validateDialogForFilter(dialog: Dialog) {\n    if(!this.getDialogDom(dialog.peerId)) {\n      return;\n    }\n\n    if(!this.testDialogForFilter(dialog)) {\n      this.deleteDialog(dialog.peerId);\n    }\n  }\n\n  public testDialogForFilter(dialog: Dialog) {\n    if(\n      !dialog ||\n      (!REAL_FOLDERS.has(this.filterId) ? getDialogIndex(dialog, this.indexKey) === undefined : this.filterId !== dialog.folder_id)\n      // (filter && !(await this.managers.filtersStorage.testDialogForFilter(dialog, filter)))\n    ) {\n      return false;\n    }\n\n    return true;\n  }\n\n  public generateScrollable(list: HTMLUListElement, filter: Parameters<AppDialogsManager['addFilter']>[0]) {\n    const filterId = filter.id;\n    const scrollable = new Scrollable(null, 'CL', 500);\n    scrollable.container.addEventListener('scroll', this.onChatsRegularScroll);\n    scrollable.container.dataset.filterId = '' + filterId;\n    scrollable.onScrolledTop = this.onChatsScrollTop;\n    scrollable.onScrolledBottom = this.onChatsScroll;\n    scrollable.setVirtualContainer(list);\n\n    const sortedDialogList = new SortedDialogList(\n      this.managers,\n      list,\n      getDialogIndexKey(filter.localId),\n      this.onListLengthChange\n    );\n\n    this.scrollables[filterId] = scrollable;\n    this.sortedLists[filterId] = sortedDialogList;\n\n    // list.classList.add('hide');\n    // scrollable.container.style.backgroundColor = '#' + (Math.random() * (16 ** 6 - 1) | 0).toString(16);\n\n    return scrollable;\n  }\n\n  private addFilter(filter: Pick<DialogFilter, 'title' | 'id' | 'localId'>) {\n    if(filter.id === FOLDER_ID_ARCHIVE) {\n      return;\n    }\n\n    const containerToAppend = this.folders.menu as HTMLElement;\n    const renderedFilter = this.filtersRendered[filter.id];\n    if(renderedFilter) {\n      positionElementByIndex(renderedFilter.menu, containerToAppend, filter.localId);\n      positionElementByIndex(renderedFilter.container, this.folders.container, filter.localId);\n      return;\n    }\n\n    const menuTab = document.createElement('div');\n    menuTab.classList.add('menu-horizontal-div-item');\n    const span = document.createElement('span');\n    const titleSpan = document.createElement('span');\n    titleSpan.classList.add('text-super');\n    if(filter.id === FOLDER_ID_ALL) titleSpan.append(this.allChatsIntlElement.element);\n    else setInnerHTML(titleSpan, wrapEmojiText(filter.title));\n    const unreadSpan = document.createElement('div');\n    unreadSpan.classList.add('badge', 'badge-20', 'badge-primary');\n    const i = document.createElement('i');\n    span.append(titleSpan, unreadSpan, i);\n    ripple(menuTab);\n    menuTab.append(span);\n\n    menuTab.dataset.filterId = '' + filter.id;\n\n    positionElementByIndex(menuTab, containerToAppend, filter.localId);\n    // containerToAppend.append(li);\n\n    const ul = this.createChatList();\n    const scrollable = this.generateScrollable(ul, filter);\n\n    scrollable.container.classList.add('tabs-tab', 'chatlist-parts');\n\n    /* const parts = document.createElement('div');\n    parts.classList.add('chatlist-parts'); */\n\n    const top = document.createElement('div');\n    top.classList.add('chatlist-top');\n\n    const bottom = document.createElement('div');\n    bottom.classList.add('chatlist-bottom');\n\n    top.append(ul);\n    scrollable.container.append(top, bottom);\n    /* parts.append(top, bottom);\n    scrollable.container.append(parts); */\n\n    const div = scrollable.container;\n    // this.folders.container.append(div);\n    positionElementByIndex(scrollable.container, this.folders.container, filter.localId);\n\n    this.setListClickListener(ul, null, true);\n\n    this.filtersRendered[filter.id] = {\n      menu: menuTab,\n      container: div,\n      unread: unreadSpan,\n      title: titleSpan\n    };\n\n    this.onFiltersLengthChange();\n  }\n\n  private changeFiltersAllChatsKey() {\n    const scrollable = this.folders.menuScrollContainer.firstElementChild;\n    const key: LangPackKey = scrollable.scrollWidth > scrollable.clientWidth ? 'FilterAllChatsShort' : 'FilterAllChats';\n    this.allChatsIntlElement.compareAndUpdate({key});\n  }\n\n  private onFiltersLengthChange() {\n    if(!this.showFiltersPromise) {\n      this.showFiltersPromise = new Promise<void>((resolve) => {\n        window.setTimeout(() => {\n          const length = Object.keys(this.filtersRendered).length;\n          const show = length > 1;\n          const wasShowing = !this.folders.menuScrollContainer.classList.contains('hide');\n\n          if(show !== wasShowing) {\n            this.folders.menuScrollContainer.classList.toggle('hide', !show);\n            if(show && !wasShowing) {\n              this.setFiltersUnreadCount();\n            }\n\n            this.chatsContainer.classList.toggle('has-filters', show);\n          }\n\n          this.changeFiltersAllChatsKey();\n\n          this.showFiltersPromise = undefined;\n          resolve();\n        }, 0);\n      });\n    }\n\n    return this.showFiltersPromise;\n  }\n\n  private loadDialogs(side: SliceSides) {\n    /* if(testScroll) {\n      return;\n    } */\n\n    this.log.warn('load', side);\n\n    if(this.loadDialogsPromise || this.loadDialogsRenderPromise/*  || 1 === 1 */) return this.loadDialogsPromise;\n    else if(this.scroll.loadedAll[side]) {\n      return Promise.resolve({\n        cached: true,\n        renderPromise: Promise.resolve()\n      });\n    }\n\n    const cachedInfoPromise = deferredPromise<boolean>();\n    const renderPromise = new Promise<void>(async(resolve, reject) => {\n      const {chatList, filterId, indexKey} = this;\n\n      // return;\n\n      // let loadCount = 30/*this.chatsLoadCount */;\n      let loadCount = windowSize.height / 72 * 1.25 | 0;\n      let offsetIndex = 0;\n\n      const doNotRenderChatList = this.doNotRenderChatList; // cache before awaits\n      const {index: currentOffsetIndex} = this.getOffsetIndex(side);\n      if(currentOffsetIndex) {\n        if(side === 'top') {\n          const storage = await this.managers.dialogsStorage.getFolderDialogs(filterId, true);\n          const index = storage.findIndex((dialog) => getDialogIndex(dialog, indexKey) <= currentOffsetIndex);\n          const needIndex = Math.max(0, index - loadCount);\n          loadCount = index - needIndex;\n          offsetIndex = getDialogIndex(storage[needIndex], indexKey) + 1;\n        } else {\n          offsetIndex = currentOffsetIndex;\n        }\n      }\n\n      // let offset = storage[storage.length - 1]?.index || 0;\n\n      let placeholder = this.placeholders[filterId];\n      try {\n        const getConversationsResult = this.managers.acknowledged.appMessagesManager.getConversations('', offsetIndex, loadCount, filterId, true);\n        if(\n          !chatList.childElementCount &&\n          !placeholder &&\n          (\n            !this.loadedDialogsAtLeastOnce ||\n            !(await getConversationsResult).cached\n          )\n        ) {\n          placeholder = this.placeholders[filterId] = new DialogsPlaceholder();\n          const getRectFrom = filterId === FOLDER_ID_ARCHIVE ? this.chatsContainer : this.folders.container;\n          placeholder.attach({\n            container: chatList.parentElement,\n            getRectFrom,\n            onRemove: () => {\n              delete this.placeholders[filterId];\n            },\n            blockScrollable: this.scroll\n          });\n\n          cachedInfoPromise.resolve(false);\n        }\n\n        const a = await getConversationsResult;\n        const result = await a.result;\n        if(this.loadDialogsRenderPromise !== renderPromise || doNotRenderChatList) {\n          reject();\n          cachedInfoPromise.reject();\n          return;\n        }\n\n        cachedInfoPromise.resolve(a.cached);\n\n        // console.timeEnd('getDialogs time');\n\n        // * loaded all\n        // if(!result.dialogs.length || chatList.childElementCount === result.count) {\n        // !result.dialogs.length  ,      getConversations   .\n        // if(chatList.childElementCount === result.count) {\n        if(side === 'bottom') {\n          if(result.isEnd) {\n            this.scroll.loadedAll[side] = true;\n          }\n        } else if(result.isTopEnd) {\n          this.scroll.loadedAll[side] = true;\n        }\n\n        this.loadedDialogsAtLeastOnce = true;\n\n        if(result.dialogs.length) {\n          const dialogs = side === 'top' ? result.dialogs.slice().reverse() : result.dialogs;\n\n          const loadPromises: Promise<any>[] = [];\n\n          const callbacks: (() => void)[] = [];\n          const cccc = (callback: () => void) => {\n            callbacks.push(callback);\n          };\n\n          dialogs.forEach((dialog) => {\n            // :(\n            // const isBuggedDialog = !this.managers.appMessagesManager.getDialogOnly(dialog.peerId);\n            // if(isBuggedDialog) {\n            //   return;\n            // }\n\n            const element = this.sortedList.add(dialog.peerId, true, /* undefined, false,  */cccc, false);\n            if(element.loadPromises) {\n              loadPromises.push(...element.loadPromises);\n            }\n          });\n\n          loadPromises.push(fastRafPromise()); // it is needed here\n          await Promise.all(loadPromises).finally();\n          if(this.loadDialogsRenderPromise !== renderPromise) {\n            reject();\n            cachedInfoPromise.reject();\n            return;\n          }\n\n          callbacks.forEach((callback) => callback());\n        } else {\n          this.onListLengthChange();\n        }\n\n        const offsetDialog = result.dialogs[side === 'top' ? 0 : result.dialogs.length - 1];\n        if(offsetDialog) {\n          this.offsets[side] = getDialogIndex(offsetDialog, indexKey);\n        }\n\n        this.log.debug('getDialogs ' + loadCount + ' dialogs by offset:', offsetIndex, result, chatList.childElementCount);\n\n        setTimeout(() => {\n          this.scroll.onScroll();\n        }, 0);\n      } catch(err) {\n        this.log.error(err);\n      }\n\n      if(placeholder) {\n        // await pause(500);\n        placeholder.detach(chatList.childElementCount);\n      }\n\n      resolve();\n    }).finally(() => {\n      if(this.loadDialogsRenderPromise === renderPromise) {\n        this.loadDialogsRenderPromise = undefined;\n        this.loadDialogsPromise = undefined;\n      }\n    });\n\n    this.loadDialogsRenderPromise = renderPromise;\n    return this.loadDialogsPromise = cachedInfoPromise.then((cached) => ({\n      cached,\n      renderPromise\n    }));\n  }\n\n  private generateEmptyPlaceholder(options: {\n    title: LangPackKey,\n    subtitle?: LangPackKey,\n    subtitleArgs?: FormatterArguments,\n    classNameType: string\n  }) {\n    const BASE_CLASS = 'empty-placeholder';\n    const container = document.createElement('div');\n    container.classList.add(BASE_CLASS, BASE_CLASS + '-' + options.classNameType);\n\n    const header = document.createElement('div');\n    header.classList.add(BASE_CLASS + '-header');\n    _i18n(header, options.title);\n\n    const subtitle = document.createElement('div');\n    subtitle.classList.add(BASE_CLASS + '-subtitle');\n    if(options.subtitle) {\n      _i18n(subtitle, options.subtitle, options.subtitleArgs);\n    }\n\n    container.append(header, subtitle);\n\n    return {container, header, subtitle};\n  }\n\n  private checkIfPlaceholderNeeded() {\n    if(this.filterId === FOLDER_ID_ARCHIVE) {\n      return;\n    }\n\n    const chatList = this.chatList;\n    const part = chatList.parentElement as HTMLElement;\n    let placeholderContainer = (Array.from(part.children) as HTMLElement[]).find((el) => el.matches('.empty-placeholder'));\n    const needPlaceholder = this.scroll.loadedAll.bottom && !chatList.childElementCount/*  || true */;\n    // chatList.style.display = 'none';\n\n    if(needPlaceholder && placeholderContainer) {\n      return;\n    } else if(!needPlaceholder) {\n      if(placeholderContainer) {\n        part.classList.remove('with-placeholder');\n        placeholderContainer.remove();\n      }\n\n      return;\n    }\n\n    let placeholder: ReturnType<AppDialogsManager['generateEmptyPlaceholder']>, type: 'dialogs' | 'folder';\n    if(!this.filterId) {\n      placeholder = this.generateEmptyPlaceholder({\n        title: 'ChatList.Main.EmptyPlaceholder.Title',\n        classNameType: type = 'dialogs'\n      });\n\n      placeholderContainer = placeholder.container;\n\n      const img = document.createElement('img');\n      img.classList.add('empty-placeholder-dialogs-icon');\n\n      this.emptyDialogsPlaceholderSubtitle = new I18n.IntlElement({\n        element: placeholder.subtitle\n      });\n\n      Promise.all([\n        this.updateContactsLength(false),\n        renderImageFromUrlPromise(img, 'assets/img/EmptyChats.svg'),\n        fastRafPromise()\n      ]).then(([usersLength]) => {\n        placeholderContainer.classList.add('visible');\n        part.classList.toggle('has-contacts', !!usersLength);\n      });\n\n      placeholderContainer.prepend(img);\n    } else {\n      placeholder = this.generateEmptyPlaceholder({\n        title: 'FilterNoChatsToDisplay',\n        subtitle: 'FilterNoChatsToDisplayInfo',\n        classNameType: type = 'folder'\n      });\n\n      placeholderContainer = placeholder.container;\n\n      const div = document.createElement('div');\n      const emoji = '';\n      const size = 128;\n      wrapStickerEmoji({\n        div,\n        emoji: emoji,\n        width: size,\n        height: size\n      });\n\n      placeholderContainer.prepend(div);\n\n      const button = Button('btn-primary btn-color-primary btn-control tgico', {\n        text: 'FilterHeaderEdit',\n        icon: 'settings'\n      });\n\n      attachClickEvent(button, async() => {\n        appSidebarLeft.createTab(AppEditFolderTab).open(await this.managers.filtersStorage.getFilter(this.filterId));\n      });\n\n      placeholderContainer.append(button);\n    }\n\n    part.append(placeholderContainer);\n    part.classList.add('with-placeholder');\n    part.dataset.placeholderType = type;\n  }\n\n  private updateContactsLength(updatePartClassName: boolean) {\n    if(this.updateContactsLengthPromise) return this.updateContactsLengthPromise;\n    return this.updateContactsLengthPromise = this.managers.appUsersManager.getContacts().then((users) => {\n      const subtitle = this.emptyDialogsPlaceholderSubtitle;\n      if(subtitle) {\n        let key: LangPackKey, args: FormatterArguments;\n\n        if(users.length/*  && false */) {\n          key = 'ChatList.Main.EmptyPlaceholder.Subtitle';\n          args = [i18n('Contacts.Count', [users.length])];\n        } else {\n          key = 'ChatList.Main.EmptyPlaceholder.SubtitleNoContacts';\n          args = [];\n        }\n\n        subtitle.compareAndUpdate({\n          key,\n          args\n        });\n      }\n\n      if(updatePartClassName) {\n        const chatList = this.chatList;\n        const part = chatList.parentElement as HTMLElement;\n        part.classList.toggle('has-contacts', !!users.length);\n      }\n\n      this.updateContactsLengthPromise = undefined;\n\n      return users.length;\n    });\n  }\n\n  private removeContactsPlaceholder() {\n    const chatList = this.chatList;\n    const parts = chatList.parentElement.parentElement;\n    const bottom = chatList.parentElement.nextElementSibling as HTMLElement;\n    parts.classList.remove('with-contacts');\n    bottom.innerHTML = '';\n    this.loadContacts = undefined;\n    this.processContact = undefined;\n  }\n\n  private _onListLengthChange = () => {\n    if(!this.loadedDialogsAtLeastOnce) {\n      return;\n    }\n\n    this.checkIfPlaceholderNeeded();\n\n    if(this.filterId !== FOLDER_ID_ALL) return;\n\n    const chatList = this.chatList;\n    const count = chatList.childElementCount;\n\n    const parts = chatList.parentElement.parentElement;\n    const bottom = chatList.parentElement.nextElementSibling as HTMLElement;\n    const hasContacts = !!bottom.childElementCount;\n    if(count >= 10) {\n      if(hasContacts) {\n        this.removeContactsPlaceholder();\n      }\n\n      return;\n    } else if(hasContacts) return;\n\n    parts.classList.add('with-contacts');\n\n    const section = new SettingSection({\n      name: 'Contacts',\n      noDelimiter: true,\n      fakeGradientDelimiter: true\n    });\n\n    section.container.classList.add('hide');\n\n    this.managers.appUsersManager.getContactsPeerIds(undefined, undefined, 'online').then((contacts) => {\n      let ready = false;\n      const onListLengthChange = () => {\n        if(ready) {\n          section.container.classList.toggle('hide', !sortedUserList.list.childElementCount);\n        }\n\n        this.updateContactsLength(true);\n      };\n\n      const sortedUserList = new SortedUserList({\n        avatarSize: 42,\n        createChatListOptions: {\n          dialogSize: 48,\n          new: true\n        },\n        autonomous: false,\n        onListLengthChange,\n        managers: this.managers\n      });\n\n      this.loadContacts = () => {\n        const pageCount = windowSize.height / 60 | 0;\n        const promise = filterAsync(contacts.splice(0, pageCount), this.verifyPeerIdForContacts);\n\n        promise.then((arr) => {\n          arr.forEach((peerId) => {\n            sortedUserList.add(peerId);\n          });\n        });\n\n        if(!contacts.length) {\n          this.loadContacts = undefined;\n        }\n      };\n\n      this.loadContacts();\n\n      this.processContact = async(peerId) => {\n        if(peerId.isAnyChat()) {\n          return;\n        }\n\n        const good = await this.verifyPeerIdForContacts(peerId);\n        const added = sortedUserList.has(peerId);\n        if(!added && good) sortedUserList.add(peerId);\n        else if(added && !good) sortedUserList.delete(peerId);\n      };\n\n      const list = sortedUserList.list;\n      list.classList.add('chatlist-new');\n      this.setListClickListener(list);\n      section.content.append(list);\n\n      ready = true;\n      onListLengthChange();\n    });\n\n    bottom.append(section.container);\n  };\n\n  private verifyPeerIdForContacts = async(peerId: PeerId) => {\n    return await this.managers.appPeersManager.isContact(peerId) && !(await this.managers.appMessagesManager.getDialogOnly(peerId));\n  };\n\n  public onChatsRegularScroll = () => {\n    // return;\n\n    if(this.sliceTimeout) clearTimeout(this.sliceTimeout);\n    this.sliceTimeout = window.setTimeout(() => {\n      this.sliceTimeout = undefined;\n\n      if(!this.chatList.childElementCount || this.processContact) {\n        return;\n      }\n\n      /* const observer = new IntersectionObserver((entries) => {\n        const\n      });\n\n      Array.from(this.chatList.children).forEach((el) => {\n        observer.observe(el);\n      }); */\n\n      fastRafConventional(() => {\n        const perf = performance.now();\n\n        const scrollTopWas = this.scroll.scrollTop;\n\n        const firstElementChild = this.chatList.firstElementChild;\n        const rectContainer = this.scroll.container.getBoundingClientRect();\n        const rectTarget = firstElementChild.getBoundingClientRect();\n        const children = Array.from(this.scroll.splitUp.children) as HTMLElement[];\n\n        // const padding = 8;\n        // const offsetTop = this.folders.container.offsetTop;\n        let offsetTop = this.scroll.splitUp.offsetTop;\n        if(offsetTop && scrollTopWas < offsetTop) offsetTop -= scrollTopWas;\n        // const offsetTop = scrollTopWas < padding ? padding - scrollTopWas : 0;\n        const firstY = rectContainer.y + offsetTop;\n        const lastY = rectContainer.y/*  - 8 */; // 8px - .chatlist padding-bottom\n\n        const firstElement = findUpTag(document.elementFromPoint(Math.ceil(rectTarget.x), Math.ceil(firstY + 1)), firstElementChild.tagName) as HTMLElement;\n        const lastElement = findUpTag(document.elementFromPoint(Math.ceil(rectTarget.x), Math.floor(lastY + rectContainer.height - 1)), firstElementChild.tagName) as HTMLElement;\n\n        // alert('got element:' + rect.y);\n\n        if(!firstElement || !lastElement) {\n          return;\n        }\n\n        // alert('got element:' + !!firstElement);\n\n        const firstElementRect = firstElement.getBoundingClientRect();\n        const elementOverflow = firstElementRect.y - firstY;\n\n        const sliced: HTMLElement[] = [];\n        const firstIndex = children.indexOf(firstElement);\n        const lastIndex = children.indexOf(lastElement);\n\n        const saveLength = 10;\n\n        const sliceFromStart = IS_SAFARI ? [] : children.slice(0, Math.max(0, firstIndex - saveLength));\n        const sliceFromEnd = children.slice(lastIndex + saveLength);\n\n        /* if(sliceFromStart.length !== sliceFromEnd.length) {\n        console.log('not equal', sliceFromStart.length, sliceFromEnd.length);\n      }\n\n      if(sliceFromStart.length > sliceFromEnd.length) {\n        const diff = sliceFromStart.length - sliceFromEnd.length;\n        sliceFromStart.splice(0, diff);\n      } else if(sliceFromEnd.length > sliceFromStart.length) {\n        const diff = sliceFromEnd.length - sliceFromStart.length;\n        sliceFromEnd.splice(sliceFromEnd.length - diff, diff);\n      } */\n\n        if(sliceFromStart.length) {\n          this.scroll.loadedAll.top = false;\n        }\n\n        if(sliceFromEnd.length) {\n          this.scroll.loadedAll.bottom = false;\n        }\n\n        sliced.push(...sliceFromStart);\n        sliced.push(...sliceFromEnd);\n\n        sliced.forEach((el) => {\n          const peerId = el.dataset.peerId.toPeerId();\n          this.deleteDialog(peerId);\n        });\n\n        this.setOffsets();\n\n        // this.log('[slicer] elements', firstElement, lastElement, rect, sliced, sliceFromStart.length, sliceFromEnd.length);\n\n        // this.log('[slicer] reset scrollTop', this.scroll.scrollTop, firstElement.offsetTop, firstElementRect.y, rect.y, elementOverflow);\n\n        // alert('left length:' + children.length);\n\n        this.scroll.scrollTop = firstElement.offsetTop - elementOverflow;\n\n        this.log('slice time', performance.now() - perf);\n        /* const firstElementRect = firstElement.getBoundingClientRect();\n      const scrollTop =  */\n\n      // this.scroll.scrollIntoView(firstElement, false);\n      });\n    }, 200);\n  };\n\n  private async setOffsets() {\n    const chatList = this.chatList;\n    const firstDialog = await this.getDialogFromElement(chatList.firstElementChild as HTMLElement);\n    const lastDialog = await this.getDialogFromElement(chatList.lastElementChild as HTMLElement);\n\n    const indexKey = this.indexKey;\n    this.offsets.top = getDialogIndex(firstDialog, indexKey);\n    this.offsets.bottom = getDialogIndex(lastDialog, indexKey);\n  }\n\n  private getDialogFromElement(element: HTMLElement) {\n    return this.managers.appMessagesManager.getDialogOnly(element.dataset.peerId.toPeerId());\n  }\n\n  public onChatsScrollTop = () => {\n    return this.onChatsScroll('top');\n  };\n\n  public onChatsScroll = (side: SliceSides = 'bottom') => {\n    if(this.scroll.loadedAll[side]) {\n      if(this.loadContacts) {\n        this.loadContacts();\n      }\n    }\n\n    this.log('onChatsScroll', side);\n    return this.loadDialogs(side);\n  };\n\n  public setListClickListener(list: HTMLUListElement, onFound?: () => void, withContext = false, autonomous = false, openInner = false) {\n    let lastActiveListElement: HTMLElement;\n\n    const setPeerFunc = (openInner ? appImManager.setInnerPeer : appImManager.setPeer).bind(appImManager);\n\n    list.dataset.autonomous = '' + +autonomous;\n    list.addEventListener('mousedown', (e) => {\n      if(e.button !== 0) return;\n\n      this.log('dialogs click list');\n      const target = e.target as HTMLElement;\n      const elem = findUpTag(target, DIALOG_LIST_ELEMENT_TAG);\n\n      if(!elem) {\n        return;\n      }\n\n      const peerId = elem.dataset.peerId.toPeerId();\n\n      if(e.ctrlKey || e.metaKey) {\n        window.open((elem as HTMLAnchorElement).href || ('#' + peerId), '_blank');\n        cancelEvent(e);\n        return;\n      }\n\n      if(autonomous) {\n        const sameElement = lastActiveListElement === elem;\n        if(lastActiveListElement && !sameElement) {\n          lastActiveListElement.classList.remove('active');\n        }\n\n        if(elem) {\n          elem.classList.add('active');\n          lastActiveListElement = elem;\n          this.lastActiveElements.add(elem);\n        }\n      }\n\n      if(elem) {\n        if(onFound) onFound();\n\n        const lastMsgId = +elem.dataset.mid || undefined;\n\n        setPeerFunc({\n          peerId, lastMsgId\n        });\n      } else {\n        setPeerFunc();\n      }\n    }, {capture: true});\n\n    // cancel link click\n    // ! do not change it to attachClickEvent\n    list.addEventListener('click', (e) => {\n      if(e.button === 0) {\n        cancelEvent(e);\n      }\n    }, {capture: true});\n\n    if(DEBUG) {\n      list.addEventListener('dblclick', (e) => {\n        const li = findUpTag(e.target, DIALOG_LIST_ELEMENT_TAG);\n        if(li) {\n          const peerId = li.dataset.peerId.toPeerId();\n          this.log('debug dialog:', this.managers.appMessagesManager.getDialogByPeerId(peerId));\n        }\n      });\n    }\n\n    if(withContext) {\n      attachContextMenuListener(list, this.contextMenu.onContextMenu);\n    }\n  }\n\n  public createChatList(options: {\n    // avatarSize?: number,\n    // handheldsSize?: number,\n    // size?: number,\n    new?: boolean,\n    dialogSize?: number,\n    ignoreClick?: boolean\n  } = {}) {\n    const list = document.createElement('ul');\n    list.classList.add('chatlist'/* ,\n      'chatlist-avatar-' + (options.avatarSize || 54) *//* , 'chatlist-' + (options.size || 72) */);\n\n    if(options.new) {\n      list.classList.add('chatlist-new');\n    }\n\n    if(options.dialogSize) {\n      list.classList.add('chatlist-' + options.dialogSize);\n    }\n\n    // if(options.ignoreClick) {\n    //   list.classList.add('disable-hover');\n    // }\n\n    /* if(options.handheldsSize) {\n      list.classList.add('chatlist-handhelds-' + options.handheldsSize);\n    } */\n\n    return list;\n  }\n\n  public setLastMessageN(options: {\n    dialog: Dialog,\n    lastMessage?: Message.message | Message.messageService,\n    dom?: DialogDom,\n    highlightWord?: string,\n    isBatch?: boolean,\n    setUnread?: boolean\n  }) {\n    const promise = this.setLastMessage(options.dialog, options.lastMessage, options.dom, options.highlightWord, options.isBatch, options.setUnread);\n    return promise.catch(noop);\n  }\n\n  private async setLastMessage(\n    dialog: Dialog,\n    lastMessage: Message.message | Message.messageService,\n    dom: DialogDom,\n    highlightWord?: string,\n    isBatch = false,\n    setUnread = false\n  ) {\n    if(!dom) {\n      dom = this.getDialogDom(dialog.peerId);\n\n      if(!dom) {\n        return;\n      }\n    }\n\n    const {deferred: promise, middleware} = setPromiseMiddleware(dom, 'setLastMessagePromise');\n\n    let draftMessage: MyDraftMessage;\n    if(!lastMessage) {\n      if(dialog.draft?._ === 'draftMessage') {\n        draftMessage = dialog.draft;\n      }\n\n      lastMessage = dialog.topMessage;\n      if(!lastMessage || lastMessage.mid !== dialog.top_message) {\n        const promise = this.managers.appMessagesManager.getMessageByPeer(dialog.peerId, dialog.top_message);\n        lastMessage = await middleware(promise);\n      }\n    }\n\n    if(setUnread) {\n      this.setUnreadMessagesN({dialog, dom, isBatch, setLastMessagePromise: promise});\n    }\n\n    if(!lastMessage/*  || (lastMessage._ === 'messageService' && !lastMessage.rReply) */) {\n      dom.lastMessageSpan.textContent = '';\n      dom.lastTimeSpan.textContent = '';\n      delete dom.listEl.dataset.mid;\n\n      promise.resolve();\n      return;\n    }\n\n    const peerId = dialog.peerId;\n    const isRestricted = lastMessage && isMessageRestricted(lastMessage as Message.message);\n\n    /* if(!dom.lastMessageSpan.classList.contains('user-typing')) */ {\n      let mediaContainer: HTMLElement;\n      const willPrepend: (Promise<any> | HTMLElement)[] = [];\n      if(lastMessage && !draftMessage && !isRestricted) {\n        const media: MyDocument | MyPhoto = getMediaFromMessage(lastMessage);\n        const videoTypes: Set<MyDocument['type']> = new Set(['video', 'gif', 'round']);\n        if(media && (media._ === 'photo' || videoTypes.has(media.type))) {\n          const size = choosePhotoSize(media, 20, 20);\n\n          if(size._ !== 'photoSizeEmpty') {\n            mediaContainer = document.createElement('div');\n            mediaContainer.classList.add('dialog-subtitle-media');\n\n            if((media as MyDocument).type === 'round') {\n              mediaContainer.classList.add('is-round');\n            }\n\n            willPrepend.push(wrapPhoto({\n              photo: media,\n              message: lastMessage,\n              container: mediaContainer,\n              withoutPreloader: true,\n              size\n            }).then(() => mediaContainer));\n\n            if(videoTypes.has((media as MyDocument).type)) {\n              const playIcon = document.createElement('span');\n              playIcon.classList.add('tgico-play');\n\n              mediaContainer.append(playIcon);\n            }\n          }\n        }\n      }\n\n      /* if(lastMessage.from_id === auth.id) { // You:  */\n      if(draftMessage) {\n        const bold = document.createElement('b');\n        bold.classList.add('danger');\n        bold.append(i18n('Draft'), ': ');\n        willPrepend.unshift(bold);\n      } else if(peerId.isAnyChat() && peerId !== lastMessage.fromId && !(lastMessage as Message.messageService).action) {\n        const senderBold = document.createElement('b');\n\n        if(lastMessage.fromId === rootScope.myId) {\n          senderBold.append(i18n('FromYou'));\n          willPrepend.unshift(senderBold);\n        } else {\n          // str = sender.first_name || sender.last_name || sender.username;\n          const p = middleware(wrapPeerTitle({\n            peerId: lastMessage.fromId,\n            onlyFirstName: true\n          })).then((element) => {\n            senderBold.prepend(element);\n            return senderBold;\n          }, noop);\n\n          willPrepend.unshift(p);\n        }\n\n        senderBold.append(': ');\n        // console.log(sender, senderBold.innerText);\n      }\n\n      const withoutMediaType = !!mediaContainer && !!(lastMessage as Message.message)?.message;\n\n      let fragment: DocumentFragment;\n      if(highlightWord && (lastMessage as Message.message).message) {\n        fragment = await middleware(wrapMessageForReply(lastMessage, undefined, undefined, false, highlightWord, withoutMediaType));\n      } else if(draftMessage) {\n        fragment = await middleware(wrapMessageForReply(draftMessage));\n      } else if(lastMessage) {\n        fragment = await middleware(wrapMessageForReply(lastMessage, undefined, undefined, false, undefined, withoutMediaType));\n      } else { // rare case\n        fragment = document.createDocumentFragment();\n      }\n\n      if(willPrepend.length) {\n        const elements = await middleware(Promise.all(willPrepend));\n        fragment.prepend(...elements);\n      }\n\n      replaceContent(dom.lastMessageSpan, fragment);\n    }\n\n    if(lastMessage || draftMessage/*  && lastMessage._ !== 'draftMessage' */) {\n      const date = draftMessage ? Math.max(draftMessage.date, lastMessage.date || 0) : lastMessage.date;\n      replaceContent(dom.lastTimeSpan, formatDateAccordingToTodayNew(new Date(date * 1000)));\n    } else dom.lastTimeSpan.textContent = '';\n\n    if(setUnread !== null && !setUnread) { // means search\n      dom.listEl.dataset.mid = '' + lastMessage.mid;\n    }\n\n    promise.resolve();\n  }\n\n  private setUnreadMessagesN(options: {\n    dialog: Dialog,\n    dom?: DialogDom,\n    isBatch?: boolean,\n    setLastMessagePromise?: Promise<void>\n  }) {\n    return this.setUnreadMessages(options.dialog, options.dom, options.isBatch, options.setLastMessagePromise).catch(() => {});\n  }\n\n  private async setUnreadMessages(\n    dialog: Dialog,\n    dom = this.getDialogDom(dialog.peerId),\n    isBatch = false,\n    setLastMessagePromise?: Promise<void>\n  ) {\n    if(!dom) {\n      // this.log.error('setUnreadMessages no dom!', dialog);\n      return;\n    }\n\n    const {deferred, middleware} = setPromiseMiddleware(dom, 'setUnreadMessagePromise');\n\n    const isMuted = await middleware(this.managers.appNotificationsManager.isPeerLocalMuted(dialog.peerId, true));\n    const wasMuted = dom.listEl.classList.contains('is-muted');\n\n    let setStatusMessage: MyMessage;\n    if(dialog.draft?._ !== 'draftMessage') {\n      const lastMessage: MyMessage = await middleware(this.managers.appMessagesManager.getMessageByPeer(dialog.peerId, dialog.top_message));\n      if(lastMessage && lastMessage.pFlags.out && lastMessage.peerId !== rootScope.myId) {\n        setStatusMessage = lastMessage;\n      }\n    }\n\n    const filter = await middleware(this.managers.filtersStorage.getFilter(this.filterId));\n    let isPinned: boolean;\n    if(filter) {\n      isPinned = filter.pinnedPeerIds.indexOf(dialog.peerId) !== -1;\n    } else {\n      isPinned = !!dialog.pFlags.pinned;\n    }\n\n    const isDialogUnread = await middleware(this.managers.appMessagesManager.isDialogUnread(dialog));\n    const hasUnreadBadge = isPinned || isDialogUnread;\n    // dom.messageEl.classList.toggle('has-badge', hasBadge);\n\n    // * have to await all promises before modifying something\n\n    if(setLastMessagePromise) {\n      try {\n        await middleware(setLastMessagePromise);\n      } catch(err) {\n        // return;\n      }\n    }\n\n    const transitionDuration = isBatch ? 0 : 200;\n\n    if(isMuted !== wasMuted) {\n      SetTransition(dom.listEl, 'is-muted', isMuted, transitionDuration);\n    }\n\n    setSendingStatus(dom.statusSpan, setStatusMessage, true);\n\n    const isUnreadBadgeMounted = isInDOM(dom.unreadBadge);\n    if(hasUnreadBadge && !isUnreadBadgeMounted) {\n      dom.subtitleEl.append(dom.unreadBadge);\n    }\n\n    const hasMentionsBadge = dialog.unread_mentions_count && (dialog.unread_mentions_count > 1 || dialog.unread_count > 1);\n    const isMentionBadgeMounted = dom.mentionsBadge && isInDOM(dom.mentionsBadge);\n    if(hasMentionsBadge) {\n      if(!dom.mentionsBadge) {\n        dom.mentionsBadge = document.createElement('div');\n        dom.mentionsBadge.className = 'dialog-subtitle-badge badge badge-24 mention mention-badge';\n        dom.mentionsBadge.innerText = '@';\n        dom.subtitleEl.insertBefore(dom.mentionsBadge, dom.lastMessageSpan.nextSibling);\n      }\n    }\n\n    SetTransition(dom.unreadBadge, 'is-visible', hasUnreadBadge, transitionDuration, hasUnreadBadge ? undefined : () => {\n      dom.unreadBadge.remove();\n    }, !isUnreadBadgeMounted ? 2 : 0);\n\n    if(dom.mentionsBadge) {\n      SetTransition(dom.mentionsBadge, 'is-visible', hasMentionsBadge, transitionDuration, hasMentionsBadge ? undefined : () => {\n        dom.mentionsBadge.remove();\n        delete dom.mentionsBadge;\n      }, !isMentionBadgeMounted ? 2 : 0);\n    }\n\n    if(!hasUnreadBadge) {\n      deferred.resolve();\n      return;\n    }\n\n    if(isPinned) {\n      dom.unreadBadge.classList.add('tgico-chatspinned', 'tgico');\n    } else {\n      dom.unreadBadge.classList.remove('tgico-chatspinned', 'tgico');\n    }\n\n    let isUnread = true, isMention = false;\n    if(dialog.unread_mentions_count && dialog.unread_count === 1) {\n      dom.unreadBadge.innerText = '@';\n      isMention = true;\n      // dom.unreadBadge.classList.add('tgico-mention', 'tgico');\n    } else if(isDialogUnread) {\n      // dom.unreadMessagesSpan.innerText = '' + (dialog.unread_count ? formatNumber(dialog.unread_count, 1) : ' ');\n      dom.unreadBadge.innerText = '' + (dialog.unread_count || ' ');\n    } else {\n      dom.unreadBadge.innerText = '';\n      isUnread = false;\n    }\n\n    dom.unreadBadge.classList.toggle('unread', isUnread);\n    dom.unreadBadge.classList.toggle('mention', isMention);\n    deferred.resolve();\n  }\n\n  private getDialogDom(peerId: PeerId) {\n    // return this.doms[peerId];\n    const element = this.sortedList.get(peerId);\n    return element?.dom;\n  }\n\n  private async getDialog(dialog: Dialog | PeerId) {\n    if(typeof(dialog) !== 'object') {\n      const originalDialog = await this.managers.appMessagesManager.getDialogOnly(dialog);\n      if(!originalDialog) {\n        const peerId = dialog || NULL_PEER_ID;\n        return {\n          peerId,\n          peer: await this.managers.appPeersManager.getOutputPeer(peerId),\n          pFlags: {}\n        } as any as Dialog;\n      }\n\n      return originalDialog;\n    }\n\n    return dialog as Dialog;\n  }\n\n  private setCallStatus(dom: DialogDom, visible: boolean) {\n    let {callIcon, listEl} = dom;\n    if(!callIcon && visible) {\n      const {canvas, startAnimation} = dom.callIcon = callIcon = groupCallActiveIcon(listEl.classList.contains('active'));\n      canvas.classList.add('dialog-group-call-icon');\n      listEl.append(canvas);\n      startAnimation();\n    }\n\n    if(!callIcon) {\n      return;\n    }\n\n    SetTransition(dom.callIcon.canvas, 'is-visible', visible, 200, visible ? undefined : () => {\n      dom.callIcon.canvas.remove();\n      dom.callIcon = undefined;\n    }, visible ? 2 : 0);\n  }\n\n  public addListDialog(options: Parameters<AppDialogsManager['addDialogNew']>[0] & {isBatch?: boolean}) {\n    options.autonomous = false;\n\n    const ret = this.addDialogNew(options);\n\n    if(ret) {\n      const promise = this.getDialog(options.peerId).then((dialog) => {\n        const {peerId} = dialog;\n        const promises: Promise<any>[] = [];\n        if(!peerId.isUser()) {\n          promises.push(this.processDialogForCallStatus(dialog, ret.dom));\n        }\n\n        if(peerId !== rootScope.myId && peerId.isUser()) {\n          promises.push(this.managers.appUsersManager.getUser(peerId).then((user) => {\n            if(user.status?._ === 'userStatusOnline') {\n              this.setOnlineStatus(ret.dom.avatarEl, true);\n            }\n          }));\n        }\n\n        promises.push(this.setLastMessageN({\n          dialog,\n          dom: ret.dom,\n          isBatch: options.isBatch,\n          setUnread: true\n        }));\n\n        return Promise.all(promises);\n      });\n\n      if(options.loadPromises) {\n        options.loadPromises.push(promise);\n      }\n    }\n\n    return ret;\n  }\n\n  private async processDialogForCallStatus(dialog: Dialog, dom?: DialogDom) {\n    if(!IS_GROUP_CALL_SUPPORTED) {\n      return;\n    }\n\n    if(!dom) dom = this.getDialogDom(dialog.peerId);\n    if(!dom) return;\n\n    const chat: Chat.chat | Chat.channel = await this.managers.appChatsManager.getChat(dialog.peerId.toChatId());\n    this.setCallStatus(dom, !!(chat.pFlags.call_active && chat.pFlags.call_not_empty));\n  }\n\n  /**\n   * use for rendering search result\n   */\n  public addDialogAndSetLastMessage(options: Omit<Parameters<AppDialogsManager['addDialogNew']>[0], 'dialog'> & {\n    message: MyMessage,\n    peerId: PeerId,\n    query?: string\n  }) {\n    const {peerId, message, query} = options;\n    const ret = this.addDialogNew({\n      ...options,\n      ...getMessageSenderPeerIdOrName(message),\n      peerId\n    });\n\n    this.setLastMessage({_: 'dialog', peerId} as any, message, ret.dom, query);\n\n    if(message.peerId !== peerId) {\n      ret.dom.listEl.dataset.peerId = '' + message.peerId;\n    }\n\n    return ret;\n  }\n\n  public addDialogNew(options: {\n    peerId: Parameters<AppDialogsManager['addDialog']>[0],\n    container?: Parameters<AppDialogsManager['addDialog']>[1],\n    rippleEnabled?: boolean,\n    onlyFirstName?: boolean,\n    meAsSaved?: boolean,\n    append?: boolean,\n    avatarSize?: number,\n    autonomous?: boolean,\n    lazyLoadQueue?: LazyLoadQueue,\n    loadPromises?: Promise<any>[],\n    fromName?: string,\n    noIcons?: boolean\n  }) {\n    return this.addDialog(options.peerId, options.container, options.rippleEnabled, options.onlyFirstName, options.meAsSaved, options.append, options.avatarSize, options.autonomous, options.lazyLoadQueue, options.loadPromises, options.fromName, options.noIcons);\n  }\n\n  public addDialog(\n    peerId: PeerId,\n    container?: HTMLElement | Scrollable | DocumentFragment | false,\n    rippleEnabled = true,\n    onlyFirstName = false,\n    meAsSaved = true,\n    append = true,\n    avatarSize = 54,\n    autonomous = !!container,\n    lazyLoadQueue?: LazyLoadQueue,\n    loadPromises?: Promise<any>[],\n    fromName?: string,\n    noIcons?: boolean\n  ) {\n    // const dialog = await this.getDialog(_dialog);\n    const avatarEl = new AvatarElement();\n    avatarEl.classList.add('dialog-avatar', 'avatar-' + avatarSize);\n    avatarEl.updateWithOptions({\n      loadPromises,\n      lazyLoadQueue,\n      isDialog: !!meAsSaved,\n      peerId,\n      peerTitle: fromName\n    });\n\n    const captionDiv = document.createElement('div');\n    captionDiv.classList.add('user-caption');\n\n    const titleSpanContainer = document.createElement('span');\n    titleSpanContainer.classList.add('user-title');\n\n    const peerTitle = new PeerTitle();\n    const peerTitlePromise = peerTitle.update({\n      peerId,\n      fromName,\n      dialog: meAsSaved,\n      onlyFirstName,\n      plainText: false,\n      withIcons: !noIcons\n    });\n\n    if(loadPromises) {\n      loadPromises.push(peerTitlePromise);\n    }\n\n    titleSpanContainer.append(peerTitle.element);\n    // p.classList.add('')\n\n    //        (  -   )\n    // if(!container) {\n\n    // for muted icon\n    titleSpanContainer.classList.add('tgico'); // *       !container,  \n\n    // const titleIconsPromise = generateTitleIcons(peerId).then((elements) => {\n    //   titleSpanContainer.append(...elements);\n    // });\n\n    // if(loadPromises) {\n    //   loadPromises.push(titleIconsPromise);\n    // }\n    // }\n\n    const span = document.createElement('span');\n    span.classList.add('user-last-message');\n    span.setAttribute('dir', 'auto');\n\n    // captionDiv.append(titleSpan);\n    // captionDiv.append(span);\n\n    const li = document.createElement(DIALOG_LIST_ELEMENT_TAG);\n    li.classList.add('chatlist-chat');\n    if(!autonomous) (li as HTMLAnchorElement).href = '#' + peerId;\n    if(rippleEnabled) {\n      ripple(li);\n    }\n\n    li.append(avatarEl, captionDiv);\n    li.dataset.peerId = '' + peerId;\n\n    const statusSpan = document.createElement('span');\n    statusSpan.classList.add('message-status', 'sending-status'/* , 'transition', 'reveal' */);\n\n    const lastTimeSpan = document.createElement('span');\n    lastTimeSpan.classList.add('message-time');\n\n    const unreadBadge = document.createElement('div');\n    unreadBadge.className = 'dialog-subtitle-badge badge badge-24';\n\n    const titleP = document.createElement('p');\n    titleP.classList.add('dialog-title');\n\n    const rightSpan = document.createElement('span');\n    rightSpan.classList.add('dialog-title-details');\n    rightSpan.append(statusSpan, lastTimeSpan);\n    titleP.append(titleSpanContainer, rightSpan);\n\n    const subtitleEl = document.createElement('p');\n    subtitleEl.classList.add('dialog-subtitle');\n    subtitleEl.append(span);\n\n    captionDiv.append(titleP, subtitleEl);\n\n    const dom: DialogDom = {\n      avatarEl,\n      captionDiv,\n      titleSpan: peerTitle.element,\n      titleSpanContainer,\n      statusSpan,\n      lastTimeSpan,\n      unreadBadge,\n      lastMessageSpan: span,\n      containerEl: li,\n      listEl: li,\n      subtitleEl\n    };\n\n    /* let good = false;\n    for(const folderId in this.chatLists) {\n      if(this.chatLists[folderId] === container) {\n        good = true;\n      }\n    } */\n    if(container) {\n      const method = append ? 'append' : 'prepend';\n      container[method](li);\n    }\n\n    if(!autonomous) {\n      // @ts-ignore\n      li.dialogDom = dom;\n\n      if(appImManager.chat?.peerId === peerId) {\n        this.setDialogActive(li, true);\n      }\n    }\n\n    return {dom};\n  }\n\n  public async setTyping(dialog: Dialog) {\n    const dom = this.getDialogDom(dialog.peerId);\n    if(!dom) {\n      return;\n    }\n\n    const oldTypingElement = dom.lastMessageSpan.querySelector('.peer-typing-container') as HTMLElement;\n    const newTypingElement = await appImManager.getPeerTyping(dialog.peerId, oldTypingElement);\n    if(!oldTypingElement && newTypingElement) {\n      replaceContent(dom.lastMessageSpan, newTypingElement);\n      dom.lastMessageSpan.classList.add('user-typing');\n    }\n  }\n\n  public unsetTyping(dialog: Dialog) {\n    const dom = this.getDialogDom(dialog.peerId);\n    if(!dom) {\n      return;\n    }\n\n    dom.lastMessageSpan.classList.remove('user-typing');\n    this.setLastMessageN({\n      dialog,\n      lastMessage: null,\n      dom,\n      setUnread: null\n    });\n  }\n}\n\nconst appDialogsManager = new AppDialogsManager();\nMOUNT_CLASS_TO.appDialogsManager = appDialogsManager;\nexport default appDialogsManager;\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport type {DownloadMediaOptions, DownloadOptions} from '../mtproto/apiFileManager';\r\nimport type {AppMessagesManager} from './appMessagesManager';\r\nimport type {MyDocument} from './appDocsManager';\r\nimport deferredPromise, {CancellablePromise} from '../../helpers/cancellablePromise';\r\nimport {InputFile, Photo, PhotoSize} from '../../layer';\r\nimport getFileNameForUpload from '../../helpers/getFileNameForUpload';\r\nimport {AppManagers} from './managers';\r\nimport rootScope from '../rootScope';\r\nimport {MOUNT_CLASS_TO} from '../../config/debug';\r\nimport noop from '../../helpers/noop';\r\nimport getDownloadMediaDetails from './utils/download/getDownloadMediaDetails';\r\nimport getDownloadFileNameFromOptions from './utils/download/getDownloadFileNameFromOptions';\r\nimport indexOfAndSplice from '../../helpers/array/indexOfAndSplice';\r\nimport makeError from '../../helpers/makeError';\r\nimport createDownloadAnchor from '../../helpers/dom/createDownloadAnchor';\r\nimport {getFileNameByLocation} from '../../helpers/fileName';\r\nimport getDocumentDownloadOptions from './utils/docs/getDocumentDownloadOptions';\r\nimport getPhotoDownloadOptions from './utils/photos/getPhotoDownloadOptions';\r\nimport apiManagerProxy from '../mtproto/mtprotoworker';\r\n\r\nexport type ResponseMethodBlob = 'blob';\r\nexport type ResponseMethodJson = 'json';\r\nexport type ResponseMethod = ResponseMethodBlob | ResponseMethodJson;\r\n\r\n/* export type DownloadBlob = {promise: Promise<Blob>, controller: AbortController};\r\nexport type DownloadJson = {promise: Promise<any>, controller: AbortController}; */\r\nexport type DownloadBlob = CancellablePromise<Blob>;\r\nexport type DownloadUrl = CancellablePromise<string>;\r\nexport type DownloadJson = CancellablePromise<any>;\r\n// export type Download = DownloadBlob/*  | DownloadJson */;\r\nexport type Download = DownloadBlob | DownloadUrl/*  | DownloadJson */;\r\n\r\nexport type Progress = {done: number, fileName: string, total: number, offset: number};\r\nexport type ProgressCallback = (details: Progress) => void;\r\n\r\ntype DownloadType = 'url' | 'blob' | 'void' | 'disc';\r\n\r\nexport class AppDownloadManager {\r\n  private downloads: {[fileName: string]: {main: Download} & {[type in DownloadType]?: Download}} = {};\r\n  // private downloadsToDisc: {[fileName: string]: Download} = {};\r\n  private progress: {[fileName: string]: Progress} = {};\r\n  // private progressCallbacks: {[fileName: string]: Array<ProgressCallback>} = {};\r\n  private managers: AppManagers;\r\n\r\n  public construct(managers: AppManagers) {\r\n    this.managers = managers;\r\n    rootScope.addEventListener('download_progress', (details) => {\r\n      // const callbacks = this.progressCallbacks[details.fileName];\r\n      // if(callbacks) {\r\n      //   callbacks.forEach((callback) => callback(details));\r\n      // }\r\n\r\n      const download = this.downloads[details.fileName];\r\n      if(download?.main?.notifyAll) {\r\n        this.progress[details.fileName] = details;\r\n        download.main.notifyAll(details);\r\n      }\r\n    });\r\n  }\r\n\r\n  private getNewDeferred<T>(fileName: string, type?: DownloadType) {\r\n    const deferred = deferredPromise<T>();\r\n\r\n    let download = this.downloads[fileName];\r\n    if(!download) {\r\n      download = this.downloads[fileName] = {\r\n        main: deferred as any\r\n      };\r\n\r\n      deferred.cancel = () => {\r\n        const error = makeError('DOWNLOAD_CANCELED');\r\n\r\n        this.managers.apiFileManager.cancelDownload(fileName);\r\n\r\n        deferred.reject(error);\r\n        deferred.cancel = noop;\r\n      };\r\n\r\n      deferred.catch(() => {\r\n        this.clearDownload(fileName, type);\r\n      }).finally(() => {\r\n        delete this.progress[fileName];\r\n        // delete this.progressCallbacks[fileName];\r\n      });\r\n    } else {\r\n      const main = download.main;\r\n      (['cancel', 'addNotifyListener', 'notify', 'notifyAll'] as (keyof CancellablePromise<void>)[]).forEach((key) => {\r\n        if(!main[key]) {\r\n          return;\r\n        }\r\n\r\n        // @ts-ignore\r\n        deferred[key] = main[key].bind(main);\r\n      });\r\n    }\r\n\r\n    const haveToClear = type === 'disc';\r\n    if(haveToClear) {\r\n      deferred.catch(noop).finally(() => {\r\n        this.clearDownload(fileName, type);\r\n      });\r\n    }\r\n\r\n    return download[type] = deferred as any;\r\n  }\r\n\r\n  public getNewDeferredForUpload<T extends Promise<any>>(fileName: string, promise: T) {\r\n    const deferred = this.getNewDeferred<InputFile>(fileName);\r\n    promise.then(deferred.resolve, deferred.reject);\r\n\r\n    deferred.finally(() => {\r\n      this.clearDownload(fileName);\r\n    });\r\n\r\n    return deferred as CancellablePromise<Awaited<T>>;\r\n  }\r\n\r\n  private clearDownload(fileName: string, type?: DownloadType) {\r\n    const downloads = this.downloads[fileName];\r\n    if(!downloads) {\r\n      return;\r\n    }\r\n\r\n    delete downloads[type];\r\n\r\n    const length = Object.keys(downloads).length;\r\n    if(!length || (downloads.main && length === 1)) {\r\n      delete this.downloads[fileName];\r\n    }\r\n  }\r\n\r\n  public getUpload(fileName: string): ReturnType<AppMessagesManager['sendFile']>['promise'] {\r\n    let deferred: CancellablePromise<any> = this.getDownload(fileName);\r\n    if(deferred) {\r\n      return deferred;\r\n    }\r\n\r\n    deferred = this.getNewDeferred(fileName);\r\n    this.managers.appMessagesManager.getUploadPromise(fileName).then(deferred.resolve, deferred.reject);\r\n    return deferred;\r\n  }\r\n\r\n  /* public fakeDownload(fileName: string, value: Blob | string) {\r\n    const deferred = this.getNewDeferred<Blob>(fileName);\r\n    if(typeof(value) === 'string') {\r\n      fetch(value)\r\n      .then((response) => response.blob())\r\n      .then((blob) => deferred.resolve(blob));\r\n    } else {\r\n      deferred.resolve(value);\r\n    }\r\n\r\n    return deferred;\r\n  } */\r\n\r\n  private d(fileName: string, getPromise: () => Promise<any>, type?: DownloadType) {\r\n    let deferred = this.getDownload(fileName, type);\r\n    if(deferred) return deferred;\r\n\r\n    deferred = this.getNewDeferred<Blob>(fileName, type);\r\n    getPromise().then(deferred.resolve, deferred.reject);\r\n    return deferred;\r\n  }\r\n\r\n  public download(options: DownloadOptions): DownloadBlob {\r\n    const fileName = getDownloadFileNameFromOptions(options);\r\n    return this.d(fileName, () => this.managers.apiFileManager.download(options), 'blob') as any;\r\n  }\r\n\r\n  public downloadMedia(options: DownloadMediaOptions, type: DownloadType = 'blob', promiseBefore?: Promise<any>): DownloadBlob {\r\n    const {downloadOptions, fileName} = getDownloadMediaDetails(options);\r\n\r\n    return this.d(fileName, () => {\r\n      let cb: any;\r\n      if(type === 'url') {\r\n        cb = this.managers.apiFileManager.downloadMediaURL;\r\n      } else if(type === 'void'/*  || type === 'disc' */) {\r\n        cb = this.managers.apiFileManager.downloadMediaVoid;\r\n      } else /* if(type === 'blob') */ {\r\n        cb = this.managers.apiFileManager.downloadMedia;\r\n      }\r\n\r\n      if(promiseBefore) {\r\n        return promiseBefore.then(() => cb(options));\r\n      }\r\n\r\n      return cb(options);\r\n    }, type) as any;\r\n  }\r\n\r\n  public downloadMediaURL(options: DownloadMediaOptions): DownloadUrl {\r\n    return this.downloadMedia(options, 'url') as any;\r\n  }\r\n\r\n  public downloadMediaVoid(options: DownloadMediaOptions): DownloadBlob {\r\n    return this.downloadMedia(options, 'void');\r\n  }\r\n\r\n  public upload(file: File | Blob, fileName?: string, promise?: Promise<any>) {\r\n    if(!fileName) {\r\n      fileName = getFileNameForUpload(file);\r\n    }\r\n\r\n    if(!promise) {\r\n      promise = this.managers.apiFileManager.upload({file, fileName});\r\n    }\r\n\r\n    const deferred = this.getNewDeferredForUpload(fileName, promise);\r\n    return deferred as any as CancellablePromise<InputFile>;\r\n  }\r\n\r\n  public getDownload(fileName: string, type?: DownloadType) {\r\n    const d = this.downloads[fileName];\r\n    return d && d[type];\r\n  }\r\n\r\n  // public addProgressCallback(fileName: string, callback: ProgressCallback) {\r\n  //   const progress = this.progress[fileName];\r\n  //   (this.progressCallbacks[fileName] ?? (this.progressCallbacks[fileName] = [])).push(callback);\r\n\r\n  //   if(progress) {\r\n  //     callback(progress);\r\n  //   }\r\n  // }\r\n\r\n  public downloadToDisc(options: DownloadMediaOptions, justAttach?: boolean) {\r\n    const media = options.media;\r\n    const isDocument = media._ === 'document';\r\n    if(!isDocument && !options.thumb) {\r\n      options.thumb = (media as Photo.photo).sizes.slice().pop() as PhotoSize.photoSize;\r\n    }\r\n\r\n    // const {fileName: cacheFileName} = getDownloadMediaDetails(options);\r\n    // if(justAttach) {\r\n    //   const promise = this.downloadsToDisc[cacheFileName];\r\n    //   if(promise) {\r\n    //     return promise;\r\n    //   }\r\n    // }\r\n\r\n    // const {downloadOptions, fileName} = getDownloadMediaDetails(options);\r\n    // if(downloadOptions.size && downloadOptions.size > MAX_FILE_SAVE_SIZE) {\r\n    const id = '' + (Math.random() * 0x7FFFFFFF | 0);\r\n    // const id = 'test';\r\n    const url = `download/${id}`;\r\n    options.downloadId = id;\r\n\r\n    const pingPromise = apiManagerProxy.pingServiceWorkerWithIframe();\r\n\r\n    const promise = this.downloadMedia(options, 'disc', pingPromise);\r\n    // this.downloadsToDisc[cacheFileName] = promise;\r\n\r\n    if(justAttach) {\r\n      return promise;\r\n    }\r\n\r\n    const iframe = document.createElement('iframe');\r\n    iframe.hidden = true;\r\n\r\n    pingPromise.then(() => {\r\n      iframe.src = url;\r\n      document.body.append(iframe);\r\n    });\r\n\r\n    // createDownloadAnchor(url, 'asd.txt');\r\n\r\n    // const events = [\r\n    //   'emptied',\r\n    //   'abort',\r\n    //   'suspend',\r\n    //   'reset',\r\n    //   'error',\r\n    //   'ended',\r\n    //   'load'\r\n    // ].forEach((event) => {\r\n    //   iframe.addEventListener(event, () => alert(event));\r\n    //   iframe.contentWindow.addEventListener(event, () => alert(event));\r\n    // });\r\n\r\n    let element: HTMLElement, hadProgress = false;\r\n    const onProgress = () => {\r\n      if(hadProgress) {\r\n        return;\r\n      }\r\n\r\n      hadProgress = true;\r\n      element = iframe;\r\n\r\n      indexOfAndSplice(promise.listeners, onProgress);\r\n    };\r\n\r\n    promise.addNotifyListener(onProgress);\r\n    promise.then((blob) => {\r\n      if(!blob) {\r\n        return;\r\n      }\r\n\r\n      const url = URL.createObjectURL(blob);\r\n      const downloadOptions = isDocument ?\r\n        getDocumentDownloadOptions(media) :\r\n        getPhotoDownloadOptions(media as any, options.thumb as PhotoSize.photoSize);\r\n      const fileName = (options.media as MyDocument).file_name || getFileNameByLocation(downloadOptions.location);\r\n      createDownloadAnchor(url, downloadOptions.fileName || fileName, () => {\r\n        URL.revokeObjectURL(url);\r\n      });\r\n    }).catch(noop).finally(() => {\r\n      if(!hadProgress) {\r\n        onProgress();\r\n      }\r\n\r\n      setTimeout(() => {\r\n        element?.remove();\r\n      }, 1000);\r\n\r\n      // if(this.downloadsToDisc[cacheFileName] === promise) {\r\n      //   delete this.downloadsToDisc[cacheFileName];\r\n      // }\r\n    });\r\n\r\n    return promise;\r\n  }\r\n}\r\n\r\nconst appDownloadManager = new AppDownloadManager();\r\nMOUNT_CLASS_TO && (MOUNT_CLASS_TO.appDownloadManager = appDownloadManager);\r\nexport default appDownloadManager;\r\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nexport default function createDownloadAnchor(url: string, fileName: string, onRemove?: () => void) {\n  const a = document.createElement('a');\n  a.href = url;\n  a.download = fileName;\n  a.target = '_blank';\n\n  a.style.position = 'absolute';\n  a.style.top = '1px';\n  a.style.left = '1px';\n\n  document.body.append(a);\n\n  try {\n    const clickEvent = document.createEvent('MouseEvents');\n    clickEvent.initMouseEvent('click', true, false, window, 0, 0, 0, 0, 0, false, false, false, false, 0, null);\n    a.dispatchEvent(clickEvent);\n  } catch(e) {\n    console.error('Download click error', e);\n    try {\n      a.click();\n    } catch(e) {\n      window.open(url as string, '_blank');\n    }\n  }\n\n  setTimeout(() => {\n    a.remove();\n    onRemove && onRemove();\n  }, 100);\n}\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport rootScope from '../../lib/rootScope';\r\n// import { generatePathData } from \"../../helpers/dom\";\r\nimport {MyMessage} from '../../lib/appManagers/appMessagesManager';\r\nimport type Chat from './chat';\r\nimport indexOfAndSplice from '../../helpers/array/indexOfAndSplice';\r\nimport insertInDescendSortedArray from '../../helpers/array/insertInDescendSortedArray';\r\nimport positionElementByIndex from '../../helpers/dom/positionElementByIndex';\r\nimport AvatarElement from '../avatar';\r\nimport {Message} from '../../layer';\r\nimport {NULL_PEER_ID, REPLIES_PEER_ID} from '../../lib/mtproto/mtproto_config';\r\nimport {SERVICE_AS_REGULAR, STICKY_OFFSET} from './bubbles';\r\nimport forEachReverse from '../../helpers/array/forEachReverse';\r\nimport partition from '../../helpers/array/partition';\r\n\r\ntype GroupItem = {\r\n  bubble: HTMLElement,\r\n  fromId: PeerId,\r\n  mid: number,\r\n  groupMid?: number,\r\n  timestamp: number,\r\n  dateTimestamp: number,\r\n  mounted: boolean,\r\n  single: boolean,\r\n  group?: BubbleGroup,\r\n  message: Message.message | Message.messageService // use it only to set avatar\r\n};\r\n\r\nclass BubbleGroup {\r\n  container: HTMLElement;\r\n  chat: Chat;\r\n  groups: BubbleGroups;\r\n  items: GroupItem[]; // descend sorted\r\n  avatarContainer: HTMLElement;\r\n  avatarLoadPromise: ReturnType<AvatarElement['updateWithOptions']>;\r\n  avatar: AvatarElement;\r\n  mounted: boolean;\r\n  dateTimestamp: number;\r\n  offset: number;\r\n\r\n  constructor(chat: Chat, groups: BubbleGroups, dateTimestamp: number) {\r\n    this.container = document.createElement('div');\r\n    this.container.classList.add('bubbles-group');\r\n    this.chat = chat;\r\n    this.groups = groups;\r\n    this.items = [];\r\n    this.dateTimestamp = dateTimestamp;\r\n    this.offset = 0;\r\n  }\r\n\r\n  createAvatar(message: Message.message | Message.messageService) {\r\n    if(this.avatarLoadPromise) {\r\n      return this.avatarLoadPromise;\r\n    } else if(message._ === 'messageService') {\r\n      return;\r\n    }\r\n\r\n    this.avatarContainer = document.createElement('div');\r\n    this.avatarContainer.classList.add('bubbles-group-avatar-container');\r\n    ++this.offset;\r\n\r\n    const fwdFrom = message.fwd_from;\r\n    const fwdFromId = message.fwdFromId;\r\n    const isForwardFromChannel = message.from_id && message.from_id._ === 'peerChannel' && message.fromId === fwdFromId;\r\n    const currentPeerId = this.chat.peerId;\r\n    const avatar = this.avatar = new AvatarElement();\r\n    this.avatar.classList.add('bubbles-group-avatar', 'user-avatar', 'avatar-40'/* , 'can-zoom-fade' */);\r\n    const peerId = ((fwdFrom && (currentPeerId === rootScope.myId || currentPeerId === REPLIES_PEER_ID)) || isForwardFromChannel ? fwdFromId : message.fromId) || NULL_PEER_ID;\r\n    const avatarLoadPromise = this.avatar.updateWithOptions({\r\n      lazyLoadQueue: this.chat.bubbles.lazyLoadQueue,\r\n      peerId,\r\n      peerTitle: !fwdFromId && fwdFrom && fwdFrom.from_name ? /* ' FF ' */fwdFrom.from_name : undefined\r\n    });\r\n\r\n    this.avatarLoadPromise = Promise.all([\r\n      avatarLoadPromise,\r\n      peerId && peerId.isUser() ? this.chat.managers.appUsersManager.getUser(peerId.toUserId()) : undefined\r\n    ]).then(([result, user]) => {\r\n      if(user?.pFlags?.premium) {\r\n        avatar.classList.add('is-premium', 'tgico-star');\r\n      }\r\n\r\n      return result;\r\n    });\r\n\r\n    this.avatarContainer.append(this.avatar);\r\n    this.container.append(this.avatarContainer);\r\n\r\n    return this.avatarLoadPromise;\r\n  }\r\n\r\n  get firstTimestamp() {\r\n    return this.firstItem.timestamp;\r\n  }\r\n\r\n  get firstMid() {\r\n    return this.firstItem.mid;\r\n  }\r\n\r\n  get firstItem() {\r\n    return this.items[this.items.length - 1];\r\n  }\r\n\r\n  get lastTimestamp() {\r\n    return this.lastItem.timestamp;\r\n  }\r\n\r\n  get lastMid() {\r\n    return this.lastItem.mid;\r\n  }\r\n\r\n  get lastItem() {\r\n    return this.items[0];\r\n  }\r\n\r\n  updateClassNames() {\r\n    const items = this.items;\r\n    const length = items.length;\r\n    if(!length) {\r\n      return;\r\n    }\r\n\r\n    // const elements = Array.from(this.container.children);\r\n    // if(this.offset) elements.splice(0, this.offset);\r\n\r\n    // const length = elements.length;\r\n    // if(!length) {\r\n    //   return;\r\n    // }\r\n\r\n    const first = items[length - 1].bubble;\r\n\r\n    if(items.length === 1) {\r\n      first.classList.add('is-group-first', 'is-group-last');\r\n      // this.setClipIfNeeded(first);\r\n      return;\r\n    } else {\r\n      first.classList.remove('is-group-last');\r\n      first.classList.add('is-group-first');\r\n      // this.setClipIfNeeded(first, true);\r\n    }\r\n\r\n    for(let i = 1, _length = length - 1; i < _length; ++i) {\r\n      const bubble = items[i].bubble;\r\n      bubble.classList.remove('is-group-last', 'is-group-first');\r\n      // this.setClipIfNeeded(bubble, true);\r\n    }\r\n\r\n    const last = items[0].bubble;\r\n    last.classList.remove('is-group-first');\r\n    last.classList.add('is-group-last');\r\n    // this.setClipIfNeeded(last);\r\n  }\r\n\r\n  insertItem(item: GroupItem) {\r\n    const {items} = this;\r\n    insertInDescendSortedArray(items, item, this.groups.sortGroupItemsKey);\r\n\r\n    item.group = this;\r\n    if(items.length === 1) {\r\n      this.groups.insertGroup(this);\r\n    }\r\n  }\r\n\r\n  removeItem(item: GroupItem) {\r\n    indexOfAndSplice(this.items, item);\r\n\r\n    if(!this.items.length) {\r\n      indexOfAndSplice(this.groups.groups, this);\r\n    }\r\n\r\n    item.group = undefined;\r\n  }\r\n\r\n  mount(updateClassNames?: boolean) {\r\n    if(!this.groups.groups.includes(this) || !this.items.length) { // group can be already removed\r\n      debugger;\r\n\r\n      if(this.mounted) {\r\n        this.onItemUnmount();\r\n      }\r\n\r\n      return;\r\n    }\r\n\r\n    const {offset, items} = this;\r\n    const {length} = items;\r\n    forEachReverse(items, (item, idx) => {\r\n      this.mountItem(item, length - 1 - idx, offset);\r\n    });\r\n\r\n    if(updateClassNames) {\r\n      this.updateClassNames();\r\n    }\r\n\r\n    this.onItemMount();\r\n  }\r\n\r\n  mountItem(item: GroupItem, idx = this.items.indexOf(item), offset = this.offset) {\r\n    if(item.mounted) {\r\n      return;\r\n    }\r\n\r\n    positionElementByIndex(item.bubble, this.container, offset + idx);\r\n    item.mounted = true;\r\n  }\r\n\r\n  unmountItem(item: GroupItem) {\r\n    if(!item.mounted) {\r\n      return;\r\n    }\r\n\r\n    item.bubble.remove();\r\n    item.mounted = false;\r\n    this.onItemUnmount();\r\n  }\r\n\r\n  onItemMount() {\r\n    if(this.mounted) {\r\n      return;\r\n    }\r\n\r\n    const dateContainer = this.chat.bubbles.getDateContainerByTimestamp(this.dateTimestamp / 1000);\r\n    // const idx = this.groups.indexOf(group);\r\n    const dateGroups = this.groups.groups.filter((_group) => _group.dateTimestamp === this.dateTimestamp);\r\n    const dateGroupsLength = dateGroups.length;\r\n    const idx = dateGroups.indexOf(this);\r\n    const unmountedLength = dateGroups.slice(idx + 1).reduce((acc, v) => acc + (v.mounted ? 0 : 1), 0);\r\n    positionElementByIndex(this.container, dateContainer.container, STICKY_OFFSET + dateGroupsLength - 1 - idx - unmountedLength);\r\n    this.mounted = true;\r\n  }\r\n\r\n  onItemUnmount() {\r\n    if(!this.mounted) {\r\n      return;\r\n    }\r\n\r\n    if(!this.items.length) {\r\n      this.container.remove();\r\n      this.chat.bubbles.deleteEmptyDateGroups();\r\n      this.mounted = false;\r\n    } else {\r\n      this.updateClassNames();\r\n    }\r\n  }\r\n}\r\n\r\n// class BubbleGroupItem implements GroupItem {\r\n//   bubble: HTMLElement;\r\n//   fromId: PeerId;\r\n//   mid: number;\r\n//   timestamp: number;\r\n//   dateTimestamp: number;\r\n//   mounted: boolean;\r\n//   single: boolean;\r\n//   group: BubbleGroup;\r\n\r\n//   constructor(details: GroupItem) {\r\n//     Object.assign(this, details);\r\n//   }\r\n// }\r\n\r\nexport default class BubbleGroups {\r\n  public itemsArr: Array<GroupItem> = []; // descend sorted\r\n  private itemsMap: Map<HTMLElement, GroupItem> = new Map();\r\n  public groups: Array<BubbleGroup> = []; // descend sorted\r\n  private newGroupDiff = 121; // * 121 in scheduled messages\r\n  private sortItemsKey: Extract<keyof GroupItem, 'timestamp' | 'mid'>;\r\n  private sortGroupsKey: Extract<keyof BubbleGroup, 'lastMid' | 'lastTimestamp'>;\r\n  public sortGroupItemsKey: Extract<keyof GroupItem, 'groupMid' | 'timestamp'>;\r\n\r\n  constructor(private chat: Chat) {\r\n    this.sortItemsKey = chat.type === 'scheduled' ? 'timestamp' : 'mid';\r\n    this.sortGroupsKey = chat.type === 'scheduled' ? 'lastTimestamp' : 'lastMid';\r\n    this.sortGroupItemsKey = /* chat.type === 'scheduled' ? 'timestamp' :  */'groupMid';\r\n  }\r\n\r\n  removeItem(item: GroupItem) {\r\n    item.group.removeItem(item);\r\n    this.removeItemFromCache(item);\r\n  }\r\n\r\n  removeAndUnmountBubble(bubble: HTMLElement) {\r\n    const item = this.getItemByBubble(bubble);\r\n    if(!item) {\r\n      return;\r\n    }\r\n\r\n    const items = this.itemsArr;\r\n    const index = items.indexOf(item);\r\n    const siblings = this.getSiblingsAtIndex(index, items);\r\n\r\n    const group = item.group;\r\n    this.removeItem(item);\r\n    group.unmountItem(item);\r\n\r\n    const modifiedGroups: Set<BubbleGroup> = new Set();\r\n    modifiedGroups.add(group);\r\n\r\n    const [previousSibling, nextSibling] = siblings;\r\n    if(\r\n      previousSibling &&\r\n      nextSibling &&\r\n      this.canItemsBeGrouped(previousSibling, nextSibling) &&\r\n      previousSibling.group !== nextSibling.group\r\n    ) {\r\n      const group = nextSibling.group;\r\n      this.f(nextSibling.group.items);\r\n      group.onItemUnmount();\r\n      modifiedGroups.add(previousSibling.group);\r\n      this.groupUngrouped();\r\n    }\r\n\r\n    this.mountUnmountGroups(Array.from(modifiedGroups));\r\n  }\r\n\r\n  mountUnmountGroups(groups: BubbleGroup[]) {\r\n    // groups.sort((a, b) => (b.lastItem?.mid ?? 0) - (a.lastItem?.mid ?? 0));\r\n\r\n    const [toMount, toUnmount] = partition(groups, (group) => !!group.items.length);\r\n    toUnmount.forEach((group) => {\r\n      group.onItemUnmount();\r\n    })\r\n\r\n    toMount.forEach((group) => {\r\n      group.mount(true);\r\n    });\r\n\r\n    // toMount.forEach((group) => {\r\n    //   group.updateClassNames();\r\n    // });\r\n  }\r\n\r\n  f(items: GroupItem[], index: number = 0, length = items.length) {\r\n    for(; index < length; ++index) {\r\n      const item = items[index];\r\n      item.mounted = false;\r\n      item.group.removeItem(item);\r\n      --length;\r\n      --index;\r\n    }\r\n  }\r\n\r\n  getItemByBubble(bubble: HTMLElement) {\r\n    return this.itemsMap.get(bubble);\r\n  }\r\n\r\n  getLastGroup() {\r\n    return this.groups[0];\r\n  }\r\n\r\n  changeBubbleMid(bubble: HTMLElement, mid: number) {\r\n    const item = this.getItemByBubble(bubble);\r\n    if(!item) {\r\n      return;\r\n    }\r\n\r\n    item.mid = mid;\r\n\r\n    // indexOfAndSplice(item.group.items, item);\r\n    // // const canChangeGroupMid = !item.group.items.length || item.group.items.every((item) => item.groupMid === item.mid);\r\n    // // if(canChangeGroupMid) item.groupMid = mid;\r\n    // item.group.insertItem(item);\r\n\r\n    indexOfAndSplice(this.itemsArr, item);\r\n    this.insertItemToArray(item, this.itemsArr);\r\n  }\r\n\r\n  changeItemBubble(item: GroupItem, bubble: HTMLElement) {\r\n    this.itemsMap.delete(item.bubble);\r\n    item.bubble = bubble;\r\n    this.itemsMap.set(bubble, item);\r\n  }\r\n\r\n  changeBubbleByBubble(from: HTMLElement, to: HTMLElement) {\r\n    const item = this.getItemByBubble(from);\r\n    if(!item) {\r\n      return;\r\n    }\r\n\r\n    this.changeItemBubble(item, to);\r\n  }\r\n\r\n  canItemsBeGrouped(item1: GroupItem, item2: GroupItem) {\r\n    return item2.fromId === item1.fromId &&\r\n      Math.abs(item2.timestamp - item1.timestamp) <= this.newGroupDiff &&\r\n      item1.dateTimestamp === item2.dateTimestamp &&\r\n      !item1.single &&\r\n      !item2.single;\r\n  }\r\n\r\n  getSiblingsAtIndex(itemIndex: number, items: GroupItem[]) {\r\n    return [items[itemIndex - 1], items[itemIndex + 1]] as const;\r\n  }\r\n\r\n  // findGroupSiblingInSiblings(item: GroupItem, siblings: ReturnType<BubbleGroups['getSiblingsAtIndex']>) {\r\n  //   return siblings.find((sibling) => sibling && this.canItemsBeGrouped(item, sibling));\r\n  // }\r\n\r\n  findGroupSiblingByItem(item: GroupItem, items: GroupItem[]) {\r\n    items = items.slice();\r\n    const idx = this.insertItemToArray(item, items);\r\n    // return this.findGroupSiblingInSiblings(item, this.getSiblingsAtIndex(idx, items));\r\n    return this.findGroupSiblingInItems(item, items, idx);\r\n  }\r\n\r\n  findGroupSiblingInItems(item: GroupItem, items: GroupItem[], index = items.indexOf(item), length = items.length) {\r\n    const previousItem = items[index - 1];\r\n    let siblingGroupedItem: GroupItem;\r\n    if(previousItem?.group && this.canItemsBeGrouped(item, previousItem)) {\r\n      siblingGroupedItem = previousItem;\r\n    } else {\r\n      for(let k = index + 1; k < length; ++k) {\r\n        const nextItem = items[k];\r\n        if(this.canItemsBeGrouped(item, nextItem)) {\r\n          if(nextItem.group) {\r\n            siblingGroupedItem = nextItem;\r\n          }\r\n        } else {\r\n          break;\r\n        }\r\n      }\r\n    }\r\n\r\n    return siblingGroupedItem;\r\n  }\r\n\r\n  addItemToGroup(item: GroupItem, group: BubbleGroup) {\r\n    group.insertItem(item);\r\n    this.addItemToCache(item);\r\n  }\r\n\r\n  insertItemToArray(item: GroupItem, array: GroupItem[]) {\r\n    return insertInDescendSortedArray(array, item, this.sortItemsKey);\r\n  }\r\n\r\n  insertGroup(group: BubbleGroup) {\r\n    return insertInDescendSortedArray(this.groups, group, this.sortGroupsKey);\r\n  }\r\n\r\n  addItemToCache(item: GroupItem) {\r\n    this.insertItemToArray(item, this.itemsArr);\r\n    this.itemsMap.set(item.bubble, item);\r\n  }\r\n\r\n  removeItemFromCache(item: GroupItem) {\r\n    indexOfAndSplice(this.itemsArr, item);\r\n    this.itemsMap.delete(item.bubble);\r\n  }\r\n\r\n  getMessageFromId(message: MyMessage) {\r\n    let fromId = message.viaBotId || message.fromId;\r\n\r\n    // fix for saved messages forward to self\r\n    if(fromId === rootScope.myId && message.peerId === rootScope.myId && (message as Message.message).fwdFromId === fromId) {\r\n      fromId = fromId.toPeerId(true);\r\n    }\r\n\r\n    return fromId;\r\n  }\r\n\r\n  createItem(bubble: HTMLElement, message: MyMessage) {\r\n    const single = !(message._ === 'message' || (message.action && SERVICE_AS_REGULAR.has(message.action._)));\r\n    const {mid, date: timestamp} = message;\r\n    const {dateTimestamp} = this.chat.bubbles.getDateForDateContainer(timestamp);\r\n    const item: GroupItem = {\r\n      mid,\r\n      groupMid: this.chat.type === 'scheduled' ? +`${(timestamp * 1000 - dateTimestamp) / 1000}.${mid}` : mid,\r\n      fromId: this.getMessageFromId(message),\r\n      bubble,\r\n      // timestamp: this.chat.type === 'scheduled' ? +`${(timestamp * 1000 - dateTimestamp) / 1000}.${mid}` : timestamp,\r\n      timestamp,\r\n      dateTimestamp,\r\n      mounted: false,\r\n      single,\r\n      message\r\n    };\r\n\r\n    return item;\r\n  }\r\n\r\n  splitSiblingsOnGrouping(siblings: ReturnType<BubbleGroups['getSiblingsAtIndex']>) {\r\n    const [previousSibling, nextSibling] = siblings;\r\n    const previousGroup = previousSibling?.group;\r\n    const nextGroup = nextSibling?.group;\r\n\r\n    if(!previousGroup) {\r\n      return;\r\n    }\r\n\r\n    // will refresh group\r\n    // if(previousGroup === nextGroup) {\r\n    const items = previousGroup.items;\r\n    const index = items.indexOf(previousSibling) + 1;\r\n    const length = items.length;\r\n    if(index === length) {\r\n      return;\r\n    }\r\n\r\n    const modifiedGroups: BubbleGroup[] = [previousGroup];\r\n    // if(previousGroup !== nextGroup && nextGroup) {\r\n    //   modifiedGroups.push(nextGroup);\r\n    // }\r\n\r\n    this.f(items, index, length);\r\n    return modifiedGroups;\r\n    // }\r\n  }\r\n\r\n  prepareForGrouping(bubble: HTMLElement, message: MyMessage) {\r\n    const foundItem = this.getItemByBubble(bubble);\r\n    if(foundItem) { // should happen only on edit\r\n      // debugger;\r\n      return;\r\n    }\r\n\r\n    const item = this.createItem(bubble, message);\r\n    this.addItemToCache(item);\r\n  }\r\n\r\n  groupUngrouped() {\r\n    const items = this.itemsArr;\r\n    const length = items.length;\r\n    const modifiedGroups: Set<BubbleGroup> = new Set();\r\n    // for(let i = length - 1; i >= 0; --i) {\r\n    for(let i = 0; i < length; ++i) {\r\n      const item = items[i];\r\n      if(item.group) {\r\n        continue;\r\n      }\r\n\r\n      let hadGroup = true;\r\n      const siblings = this.getSiblingsAtIndex(i, items);\r\n      const siblingGroupedItem = this.findGroupSiblingInItems(item, items, i, length);\r\n\r\n      // const foundItem = this.findGroupSiblingInSiblings(item, siblings);\r\n      const foundItem = siblingGroupedItem;\r\n      const group = foundItem?.group ?? (hadGroup = false, new BubbleGroup(this.chat, this, item.dateTimestamp));\r\n\r\n      modifiedGroups.add(group);\r\n      group.insertItem(item);\r\n\r\n      if(!hadGroup) {\r\n        const splittedGroups = this.splitSiblingsOnGrouping(siblings);\r\n        if(splittedGroups) {\r\n          splittedGroups.forEach((group) => modifiedGroups.add(group));\r\n        }\r\n      }\r\n    }\r\n\r\n    return modifiedGroups;\r\n  }\r\n\r\n  // addBubble(bubble: HTMLElement, message: MyMessage, unmountIfFound?: boolean) {\r\n  //   const oldItem = this.getItemByBubble(bubble);\r\n  //   if(unmountIfFound) { // updating position\r\n  //     this.removeAndUnmountBubble(bubble);\r\n  //   } else if(oldItem) { // editing\r\n  //     const group = oldItem.group;\r\n  //     this.changeItemBubble(oldItem, bubble);\r\n  //     oldItem.mounted = false;\r\n\r\n  //     return {item: oldItem, group};\r\n  //   }\r\n\r\n  //   const item = this.createItem(bubble, message);\r\n\r\n  //   const foundItem = this.findSameGroupItem(item, this.itemsArr);\r\n\r\n  //   const group = foundItem?.group ?? new BubbleGroup(this.chat, this, item.dateTimestamp);\r\n  //   this.addItemToGroup(item, group);\r\n\r\n  //   return {item, group};\r\n  // }\r\n\r\n  /* setClipIfNeeded(bubble: HTMLDivElement, remove = false) {\r\n    //console.log('setClipIfNeeded', bubble, remove);\r\n    const className = bubble.className;\r\n    if(className.includes('is-message-empty') && (className.includes('photo') || className.includes('video'))) {\r\n      let container = bubble.querySelector('.bubble__media-container') as SVGSVGElement;\r\n      //console.log('setClipIfNeeded', bubble, remove, container);\r\n      if(!container) return;\r\n\r\n      try {\r\n        Array.from(container.children).forEach((object) => {\r\n          if(object instanceof SVGDefsElement) return;\r\n\r\n          if(remove) {\r\n            object.removeAttributeNS(null, 'clip-path');\r\n          } else {\r\n            let clipId = container.dataset.clipId;\r\n            let path = container.firstElementChild.firstElementChild.lastElementChild as SVGPathElement;\r\n            let width = +object.getAttributeNS(null, 'width');\r\n            let height = +object.getAttributeNS(null, 'height');\r\n            let isOut = className.includes('is-out');\r\n            let isReply = className.includes('is-reply');\r\n            let d = '';\r\n\r\n            //console.log('setClipIfNeeded', object, width, height, isOut);\r\n\r\n            let tr: number, tl: number;\r\n            if(className.includes('forwarded') || isReply) {\r\n              tr = tl = 0;\r\n            } else if(isOut) {\r\n              tr = className.includes('is-group-first') ? 12 : 6;\r\n              tl = 12;\r\n            } else {\r\n              tr = 12;\r\n              tl = className.includes('is-group-first') ? 12 : 6;\r\n            }\r\n\r\n            if(isOut) {\r\n              d = generatePathData(0, 0, width - 9, height, tl, tr, 0, 12);\r\n            } else {\r\n              d = generatePathData(9, 0, width - 9, height, tl, tr, 12, 0);\r\n            }\r\n\r\n            path.setAttributeNS(null, 'd', d);\r\n            object.setAttributeNS(null, 'clip-path', 'url(#' + clipId + ')');\r\n          }\r\n        });\r\n      } catch(err) {}\r\n    }\r\n  } */\r\n\r\n  // updateGroupByMessageId(mid: number) {\r\n  //   const item = this.itemsArr.find((g) => g.mid === mid);\r\n  //   if(item) {\r\n  //     item.group.updateGroup();\r\n  //   }\r\n  // }\r\n\r\n  cleanup() {\r\n    this.itemsArr = [];\r\n    this.groups = [];\r\n    this.itemsMap.clear();\r\n  }\r\n\r\n  // findIncorrentPositions() {\r\n  //   var bubbles = Array.from(this.chat.bubbles.chatInner.querySelectorAll('.bubbles-group .bubble')).reverse();\r\n  //   var items = this.itemsArr;\r\n  //   for(var i = 0, length = items.length; i < length; ++i) {\r\n  //     const item = items[i];\r\n  //     const foundBubble = bubbles[i];\r\n  //     if(item.bubble !== foundBubble) {\r\n  //       console.log('incorrect position', i, item, foundBubble);\r\n  //       // debugger;\r\n  //       // break;\r\n  //     }\r\n  //   }\r\n  // }\r\n}\r\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nexport default function partition<T>(arr: T[], callback: (item: T, idx: number, arr: T[]) => boolean) {\n  const good: T[] = [], bad: T[] = [];\n  for(let i = 0, length = arr.length; i < length; ++i) {\n    const item = arr[i];\n    (callback(item, i, arr) ? good : bad).push(item);\n  }\n\n  return [good, bad];\n}\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport PopupElement, {PopupOptions} from '.';\r\nimport {attachClickEvent} from '../../helpers/dom/clickEvent';\r\nimport mediaSizes from '../../helpers/mediaSizes';\r\nimport I18n, {FormatterArguments, i18n, LangPackKey} from '../../lib/langPack';\r\nimport InputField from '../inputField';\r\n\r\nexport default class PopupDatePicker extends PopupElement {\r\n  protected controlsDiv: HTMLElement;\r\n  protected monthTitle: HTMLElement;\r\n  protected prevBtn: HTMLElement;\r\n  protected nextBtn: HTMLElement;\r\n\r\n  protected monthsContainer: HTMLElement;\r\n  protected month: HTMLElement;\r\n\r\n  protected minMonth: Date;\r\n  protected maxMonth: Date;\r\n  protected minDate: Date;\r\n  protected maxDate: Date;\r\n  protected selectedDate: Date;\r\n  protected selectedMonth: Date;\r\n  protected selectedEl: HTMLElement;\r\n\r\n  protected timeDiv: HTMLDivElement;\r\n  protected hoursInputField: InputField;\r\n  protected minutesInputField: InputField;\r\n\r\n  constructor(initDate: Date, public onPick: (timestamp: number) => void, protected options: Partial<{\r\n    noButtons: true,\r\n    noTitle: true,\r\n    minDate: Date,\r\n    maxDate: Date\r\n    withTime: true,\r\n    showOverflowMonths: true\r\n  }> & PopupOptions = {}) {\r\n    super('popup-date-picker', {\r\n      body: true,\r\n      overlayClosable: true,\r\n      buttons: options.noButtons ? [] : [{\r\n        langKey: 'JumpToDate',\r\n        callback: () => {\r\n          if(this.onPick) {\r\n            this.onPick(this.selectedDate.getTime() / 1000 | 0);\r\n          }\r\n        }\r\n      }, {\r\n        langKey: 'Cancel',\r\n        isCancel: true\r\n      }],\r\n      title: true,\r\n      ...options\r\n    });\r\n\r\n    this.minDate = options.minDate || new Date('2013-08-01T00:00:00');\r\n\r\n    if(initDate < this.minDate) {\r\n      initDate.setFullYear(this.minDate.getFullYear(), this.minDate.getMonth(), this.minDate.getDate());\r\n    }\r\n\r\n    // Controls\r\n    this.controlsDiv = document.createElement('div');\r\n    this.controlsDiv.classList.add('date-picker-controls');\r\n\r\n    this.prevBtn = document.createElement('button');\r\n    this.prevBtn.classList.add('btn-icon', 'tgico-down', 'date-picker-prev');\r\n    attachClickEvent(this.prevBtn, this.onPrevClick, {listenerSetter: this.listenerSetter});\r\n\r\n    this.nextBtn = document.createElement('button');\r\n    this.nextBtn.classList.add('btn-icon', 'tgico-down', 'date-picker-next');\r\n    attachClickEvent(this.nextBtn, this.onNextClick, {listenerSetter: this.listenerSetter});\r\n\r\n    this.monthTitle = document.createElement('div');\r\n    this.monthTitle.classList.add('date-picker-month-title');\r\n\r\n    this.controlsDiv.append(this.prevBtn, this.monthTitle, this.nextBtn);\r\n\r\n    // Month\r\n    this.monthsContainer = document.createElement('div');\r\n    this.monthsContainer.classList.add('date-picker-months');\r\n    attachClickEvent(this.monthsContainer, this.onDateClick, {listenerSetter: this.listenerSetter});\r\n\r\n    this.body.append(this.controlsDiv, this.monthsContainer);\r\n\r\n    // Time inputs\r\n    if(options.withTime) {\r\n      this.timeDiv = document.createElement('div');\r\n      this.timeDiv.classList.add('date-picker-time');\r\n\r\n      const delimiter = document.createElement('div');\r\n      delimiter.classList.add('date-picker-time-delimiter');\r\n      delimiter.append(':');\r\n\r\n      const handleTimeInput = (max: number, inputField: InputField, onInput: (length: number) => void, onOverflow?: (number: number) => void) => {\r\n        const maxString = '' + max;\r\n        this.listenerSetter.add(inputField.input)('input', (e) => {\r\n          let value = inputField.value.replace(/\\D/g, '');\r\n          if(value.length > 2) {\r\n            value = value.slice(0, 2);\r\n          } else {\r\n            if((value.length === 1 && +value[0] > +maxString[0]) || (value.length === 2 && +value > max)) {\r\n              if(value.length === 2 && onOverflow) {\r\n                onOverflow(+value[1]);\r\n              }\r\n\r\n              value = '0' + value[0];\r\n            }\r\n          }\r\n\r\n          inputField.setValueSilently(value);\r\n          onInput(value.length);\r\n        });\r\n      };\r\n\r\n      this.hoursInputField = new InputField({plainText: true});\r\n      this.minutesInputField = new InputField({plainText: true});\r\n\r\n      handleTimeInput(23, this.hoursInputField, (length) => {\r\n        if(length === 2) {\r\n          this.minutesInputField.input.focus();\r\n        }\r\n\r\n        this.setTimeTitle();\r\n      }, (number) => {\r\n        this.minutesInputField.value = (number + this.minutesInputField.value).slice(0, 2);\r\n      });\r\n      handleTimeInput(59, this.minutesInputField, (length) => {\r\n        if(!length) {\r\n          this.hoursInputField.input.focus();\r\n        }\r\n\r\n        this.setTimeTitle();\r\n      });\r\n\r\n      this.selectedDate = initDate;\r\n\r\n      initDate.setMinutes(initDate.getMinutes() + 10);\r\n\r\n      this.hoursInputField.setValueSilently(('0' + initDate.getHours()).slice(-2));\r\n      this.minutesInputField.setValueSilently(('0' + initDate.getMinutes()).slice(-2));\r\n\r\n      initDate.setHours(0, 0, 0, 0);\r\n\r\n      this.timeDiv.append(this.hoursInputField.container, delimiter, this.minutesInputField.container);\r\n\r\n      attachClickEvent(this.btnConfirm, () => {\r\n        if(this.onPick) {\r\n          this.selectedDate.setHours(+this.hoursInputField.value || 0, +this.minutesInputField.value || 0, 0, 0);\r\n          this.onPick(this.selectedDate.getTime() / 1000 | 0);\r\n        }\r\n\r\n        this.hide();\r\n      }, {listenerSetter: this.listenerSetter});\r\n\r\n      this.body.append(this.timeDiv);\r\n\r\n      this.prevBtn.classList.add('primary');\r\n      this.nextBtn.classList.add('primary');\r\n    }\r\n\r\n    const popupCenterer = document.createElement('div');\r\n    popupCenterer.classList.add('popup-centerer');\r\n    popupCenterer.append(this.container);\r\n    this.element.append(popupCenterer);\r\n\r\n    // const passed = (initDate.getTime() - (initDate.getTimezoneOffset() * 60000)) % 86400000;\r\n    // this.selectedDate = this.maxDate = new Date(initDate.getTime() - passed);\r\n    initDate.setHours(0, 0, 0, 0);\r\n    this.selectedDate = initDate;\r\n\r\n    this.maxDate = options.maxDate || new Date();\r\n    this.maxDate.setHours(0, 0, 0, 0);\r\n\r\n    this.selectedMonth = new Date(this.selectedDate);\r\n    this.selectedMonth.setDate(1);\r\n\r\n    this.maxMonth = new Date(this.maxDate);\r\n    this.maxMonth.setDate(1);\r\n\r\n    this.minMonth = new Date(this.minDate);\r\n    this.minMonth.setHours(0, 0, 0, 0);\r\n    this.minMonth.setDate(1);\r\n\r\n    if(this.selectedMonth.getTime() === this.minMonth.getTime()) {\r\n      this.prevBtn.setAttribute('disabled', 'true');\r\n    }\r\n\r\n    if(this.selectedMonth.getTime() === this.maxMonth.getTime()) {\r\n      this.nextBtn.setAttribute('disabled', 'true');\r\n    }\r\n\r\n    if(options.noTitle) {\r\n      this.setTitle = () => {};\r\n    }\r\n\r\n    this.setTimeTitle();\r\n    this.setTitle();\r\n    this.setMonth();\r\n  }\r\n\r\n  onPrevClick = (e: MouseEvent) => {\r\n    this.selectedMonth.setMonth(this.selectedMonth.getMonth() - 1);\r\n    this.setMonth();\r\n\r\n    if(this.selectedMonth.getTime() === this.minMonth.getTime()) {\r\n      this.prevBtn.setAttribute('disabled', 'true');\r\n    }\r\n\r\n    this.nextBtn.removeAttribute('disabled');\r\n  };\r\n\r\n  onNextClick = (e: MouseEvent) => {\r\n    this.selectedMonth.setMonth(this.selectedMonth.getMonth() + 1);\r\n    this.setMonth();\r\n\r\n    if(this.selectedMonth.getTime() === this.maxMonth.getTime()) {\r\n      this.nextBtn.setAttribute('disabled', 'true');\r\n    }\r\n\r\n    this.prevBtn.removeAttribute('disabled');\r\n  };\r\n\r\n  onDateClick = (e: MouseEvent) => {\r\n    // cancelEvent(e);\r\n    const target = e.target as HTMLElement;\r\n\r\n    if(!target.dataset.timestamp) return;\r\n\r\n    if(this.selectedEl) {\r\n      if(this.selectedEl === target) return;\r\n      this.selectedEl.classList.remove('active');\r\n    }\r\n\r\n    this.selectedEl = target;\r\n\r\n    target.classList.add('active');\r\n    const timestamp = +target.dataset.timestamp;\r\n\r\n    this.selectedDate = new Date(timestamp);\r\n\r\n    this.setTitle();\r\n    this.setTimeTitle();\r\n  };\r\n\r\n  public setTimeTitle() {\r\n    if(this.btnConfirm && this.selectedDate) {\r\n      let key: LangPackKey;\r\n      const args: FormatterArguments = [];\r\n      const date = new Date();\r\n      date.setHours(0, 0, 0, 0);\r\n\r\n      const timeOptions: Intl.DateTimeFormatOptions = {\r\n        minute: '2-digit',\r\n        hour: '2-digit'\r\n      };\r\n\r\n      const sendDate = new Date(this.selectedDate.getTime());\r\n      sendDate.setHours(+this.hoursInputField.value, +this.minutesInputField.value);\r\n\r\n      if(this.selectedDate.getTime() === date.getTime()) {\r\n        key = 'Schedule.SendToday';\r\n      }/*  else if(this.selectedDate.getTime() === (date.getTime() + 86400e3)) {\r\n        dayStr = 'Tomorrow';\r\n      } */ else {\r\n        key = 'Schedule.SendDate';\r\n\r\n        const dateOptions: Intl.DateTimeFormatOptions = {\r\n          month: 'short',\r\n          day: 'numeric'\r\n        };\r\n\r\n        if(sendDate.getFullYear() !== date.getFullYear()) {\r\n          dateOptions.year = 'numeric';\r\n        }\r\n\r\n        args.push(new I18n.IntlDateElement({\r\n          date: sendDate,\r\n          options: dateOptions\r\n        }).element);\r\n      }\r\n\r\n      args.push(new I18n.IntlDateElement({\r\n        date: sendDate,\r\n        options: timeOptions\r\n      }).element);\r\n\r\n      this.btnConfirm.firstChild.replaceWith(i18n(key, args));\r\n    }\r\n  }\r\n\r\n  public setTitle() {\r\n    // const splitted = this.selectedDate.toString().split(' ', 3);\r\n    // this.title.innerText = splitted[0] + ', ' + splitted[1] + ' ' + splitted[2];\r\n    this.title.textContent = '';\r\n    this.title.append(new I18n.IntlDateElement({\r\n      date: this.selectedDate,\r\n      options: {\r\n        day: 'numeric',\r\n        month: 'long',\r\n        weekday: 'short'\r\n      }\r\n    }).element);\r\n  }\r\n\r\n  private renderElement(disabled: boolean, innerText: string | HTMLElement = '') {\r\n    const el = document.createElement('button');\r\n    el.classList.add('btn-icon', 'date-picker-month-date');\r\n\r\n    if(disabled) {\r\n      el.setAttribute('disabled', 'true');\r\n    }\r\n\r\n    if(innerText) {\r\n      el.append(innerText);\r\n    }\r\n\r\n    return el;\r\n  }\r\n\r\n  public setMonth() {\r\n    const firstDate = new Date(this.selectedMonth);\r\n\r\n    const options: Intl.DateTimeFormatOptions = {\r\n      year: 'numeric',\r\n      month: this.timeDiv && mediaSizes.isMobile ? 'short' : 'long'\r\n    };\r\n\r\n    this.monthTitle.textContent = '';\r\n    this.monthTitle.append(new I18n.IntlDateElement({date: firstDate, options}).element);\r\n    // this.monthTitle.innerText = (this.timeDiv && mediaSizes.isMobile ? monthName.slice(0, 3) : monthName) + ' ' + this.selectedMonth.getFullYear();\r\n\r\n    if(this.month) {\r\n      this.month.remove();\r\n    }\r\n\r\n    this.month = document.createElement('div');\r\n    this.month.classList.add('date-picker-month');\r\n\r\n    const weekStartDate = new Date();\r\n    const day = weekStartDate.getDay();\r\n    if(day !== 1) {\r\n      weekStartDate.setHours(-24 * (day - 1));\r\n    }\r\n\r\n    for(let i = 0; i < 7; ++i) {\r\n      const el = this.renderElement(true, new I18n.IntlDateElement({date: weekStartDate, options: {weekday: 'narrow'}}).element);\r\n      el.classList.remove('date-picker-month-date');\r\n      el.classList.add('date-picker-month-day');\r\n      this.month.append(el);\r\n      weekStartDate.setDate(weekStartDate.getDate() + 1);\r\n    }\r\n\r\n    // 0 - sunday\r\n    let dayIndex = firstDate.getDay() - 1;\r\n    if(dayIndex === -1) dayIndex = 7 - 1;\r\n\r\n    const clonedDate = new Date(firstDate.getTime());\r\n    clonedDate.setDate(clonedDate.getDate() - dayIndex - 1);\r\n\r\n    // Padding first week\r\n    for(let i = 0; i < dayIndex; ++i) {\r\n      if(this.options.showOverflowMonths) {\r\n        clonedDate.setDate(clonedDate.getDate() + 1);\r\n        this.month.append(this.renderElement(true, '' + clonedDate.getDate()));\r\n      } else {\r\n        this.month.append(this.renderElement(true));\r\n      }\r\n    }\r\n\r\n    do {\r\n      const date = firstDate.getDate();\r\n      const el = this.renderElement(firstDate > this.maxDate || firstDate < this.minDate, '' + date);\r\n      el.dataset.timestamp = '' + firstDate.getTime();\r\n\r\n      if(firstDate.getTime() === this.selectedDate.getTime()) {\r\n        this.selectedEl = el;\r\n        el.classList.add('active');\r\n      }\r\n\r\n      this.month.append(el);\r\n\r\n      firstDate.setDate(date + 1);\r\n    } while(firstDate.getDate() !== 1);\r\n\r\n    const remainder = this.month.childElementCount % 7;\r\n    if(this.options.showOverflowMonths && remainder) {\r\n      for(let i = remainder; i < 7; ++i) {\r\n        this.month.append(this.renderElement(true, '' + firstDate.getDate()));\r\n        firstDate.setDate(firstDate.getDate() + 1);\r\n      }\r\n    }\r\n\r\n    const lines = Math.ceil(this.month.childElementCount / 7);\r\n    this.container.dataset.lines = '' + lines;\r\n\r\n    this.monthsContainer.append(this.month);\r\n  }\r\n}\r\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport callbackify from '../../helpers/callbackify';\nimport formatNumber from '../../helpers/number/formatNumber';\nimport {fastRaf} from '../../helpers/schedulers';\nimport {MessagePeerReaction, ReactionCount} from '../../layer';\nimport {AppManagers} from '../../lib/appManagers/managers';\nimport getPeerId from '../../lib/appManagers/utils/peers/getPeerId';\nimport RLottiePlayer from '../../lib/rlottie/rlottiePlayer';\nimport rootScope from '../../lib/rootScope';\nimport SetTransition from '../singleTransition';\nimport StackedAvatars from '../stackedAvatars';\nimport {wrapSticker, wrapStickerAnimation} from '../wrappers';\nimport {Awaited} from '../../types';\nimport noop from '../../helpers/noop';\n\nconst CLASS_NAME = 'reaction';\nconst TAG_NAME = CLASS_NAME + '-element';\nconst REACTION_INLINE_SIZE = 14;\nconst REACTION_BLOCK_SIZE = 22;\n\nexport const REACTION_DISPLAY_INLINE_COUNTER_AT = 2;\nexport const REACTION_DISPLAY_BLOCK_COUNTER_AT = 4;\n\nexport type ReactionLayoutType = 'block' | 'inline';\n\nexport default class ReactionElement extends HTMLElement {\n  private type: ReactionLayoutType;\n  private counter: HTMLElement;\n  private stickerContainer: HTMLElement;\n  private stackedAvatars: StackedAvatars;\n  private canRenderAvatars: boolean;\n  private _reactionCount: ReactionCount;\n  private wrapStickerPromise: Awaited<ReturnType<typeof wrapSticker>>['render'];\n  private managers: AppManagers;\n\n  constructor() {\n    super();\n    this.classList.add(CLASS_NAME);\n    this.managers = rootScope.managers;\n  }\n\n  public get reactionCount() {\n    return this._reactionCount;\n  }\n\n  public set reactionCount(reactionCount: ReactionCount) {\n    this._reactionCount = reactionCount;\n  }\n\n  public get count() {\n    return this.reactionCount.count;\n  }\n\n  public init(type: ReactionLayoutType) {\n    this.type = type;\n    this.classList.add(CLASS_NAME + '-' + type);\n  }\n\n  public setCanRenderAvatars(canRenderAvatars: boolean) {\n    this.canRenderAvatars = canRenderAvatars;\n  }\n\n  public render(doNotRenderSticker?: boolean) {\n    const hadStickerContainer = !!this.stickerContainer;\n    if(!hadStickerContainer) {\n      this.stickerContainer = document.createElement('div');\n      this.stickerContainer.classList.add(CLASS_NAME + '-sticker');\n      this.append(this.stickerContainer);\n    }\n\n    const reactionCount = this.reactionCount;\n    if(!doNotRenderSticker && !hadStickerContainer) {\n      const availableReaction = this.managers.appReactionsManager.getReaction(reactionCount.reaction);\n      callbackify(availableReaction, (availableReaction) => {\n        if(!availableReaction.center_icon) {\n          this.stickerContainer.classList.add('is-static');\n        }\n\n        if(availableReaction.pFlags.inactive) {\n          this.classList.add('is-inactive');\n        }\n\n        const size = this.type === 'inline' ? REACTION_INLINE_SIZE : REACTION_BLOCK_SIZE;\n        const wrapPromise = this.wrapStickerPromise = wrapSticker({\n          div: this.stickerContainer,\n          doc: availableReaction.center_icon ?? availableReaction.static_icon,\n          width: size,\n          height: size,\n          static: true,\n          managers: this.managers\n        }).then(({render}) => render).finally(() => {\n          if(this.wrapStickerPromise === wrapPromise) {\n            this.wrapStickerPromise = undefined;\n          }\n        });\n      });\n    }\n  }\n\n  public renderCounter() {\n    const reactionCount = this.reactionCount;\n    const displayOn = this.type === 'inline' ? REACTION_DISPLAY_INLINE_COUNTER_AT : REACTION_DISPLAY_BLOCK_COUNTER_AT;\n    if(reactionCount.count >= displayOn || (this.type === 'block' && !this.canRenderAvatars)) {\n      if(!this.counter) {\n        this.counter = document.createElement(this.type === 'inline' ? 'i' : 'span');\n        this.counter.classList.add(CLASS_NAME + '-counter');\n      }\n\n      const formatted = formatNumber(reactionCount.count);\n      if(this.counter.textContent !== formatted) {\n        this.counter.textContent = formatted;\n      }\n\n      if(!this.counter.parentElement) {\n        this.append(this.counter);\n      }\n    } else if(this.counter?.parentElement) {\n      this.counter.remove();\n      this.counter = undefined;\n    }\n  }\n\n  public renderAvatars(recentReactions: MessagePeerReaction[]) {\n    if(this.type === 'inline') {\n      return;\n    }\n\n    if(this.reactionCount.count >= REACTION_DISPLAY_BLOCK_COUNTER_AT || !this.canRenderAvatars) {\n      if(this.stackedAvatars) {\n        this.stackedAvatars.container.remove();\n        this.stackedAvatars = undefined;\n      }\n\n      return;\n    }\n\n    if(!this.stackedAvatars) {\n      this.stackedAvatars = new StackedAvatars({\n        avatarSize: 24\n      });\n\n      this.append(this.stackedAvatars.container);\n    }\n\n    this.stackedAvatars.render(recentReactions.map((reaction) => getPeerId(reaction.peer_id)));\n  }\n\n  public setIsChosen(isChosen = !!this.reactionCount.pFlags.chosen) {\n    if(this.type === 'inline') return;\n    const wasChosen = this.classList.contains('is-chosen') && !this.classList.contains('backwards');\n    if(wasChosen !== isChosen) {\n      SetTransition(this, 'is-chosen', isChosen, this.isConnected ? 300 : 0);\n    }\n  }\n\n  public fireAroundAnimation() {\n    callbackify(this.managers.appReactionsManager.getReaction(this.reactionCount.reaction), (availableReaction) => {\n      const size = this.type === 'inline' ? REACTION_INLINE_SIZE + 14 : REACTION_BLOCK_SIZE + 18;\n      const div = document.createElement('div');\n      div.classList.add(CLASS_NAME + '-sticker-activate');\n\n      Promise.all([\n        wrapSticker({\n          div: div,\n          doc: availableReaction.center_icon,\n          width: size,\n          height: size,\n          withThumb: false,\n          needUpscale: true,\n          play: false,\n          skipRatio: 1,\n          group: 'none',\n          needFadeIn: false,\n          managers: this.managers\n        }).then(({render}) => render as Promise<RLottiePlayer>),\n\n        wrapStickerAnimation({\n          doc: availableReaction.around_animation,\n          size: 80,\n          target: this.stickerContainer,\n          side: 'center',\n          skipRatio: 1,\n          play: false,\n          managers: this.managers\n        }).stickerPromise.catch(noop)\n      ]).then(([iconPlayer, aroundPlayer]) => {\n        const remove = () => {\n          // if(!isInDOM(div)) return;\n          iconPlayer.remove();\n          div.remove();\n          this.stickerContainer.classList.remove('has-animation');\n        };\n\n        if(!aroundPlayer) {\n          remove();\n          return;\n        }\n\n        const removeOnFrame = () => {\n          // if(!isInDOM(div)) return;\n          fastRaf(remove);\n        };\n\n        iconPlayer.addEventListener('enterFrame', (frameNo) => {\n          if(frameNo === iconPlayer.maxFrame) {\n            if(this.wrapStickerPromise) { // wait for fade in animation\n              this.wrapStickerPromise.then(() => {\n                setTimeout(removeOnFrame, 1e3);\n              });\n            } else {\n              removeOnFrame();\n            }\n          }\n        });\n\n        iconPlayer.addEventListener('firstFrame', () => {\n          this.stickerContainer.append(div);\n          this.stickerContainer.classList.add('has-animation');\n          iconPlayer.play();\n          aroundPlayer.play();\n        }, {once: true});\n      });\n    });\n  }\n}\n\ncustomElements.define(TAG_NAME, ReactionElement);\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport forEachReverse from '../../helpers/array/forEachReverse';\nimport positionElementByIndex from '../../helpers/dom/positionElementByIndex';\nimport {Message, ReactionCount} from '../../layer';\nimport appImManager from '../../lib/appManagers/appImManager';\nimport {AppManagers} from '../../lib/appManagers/managers';\nimport rootScope from '../../lib/rootScope';\nimport ReactionElement, {ReactionLayoutType, REACTION_DISPLAY_BLOCK_COUNTER_AT} from './reaction';\n\nconst CLASS_NAME = 'reactions';\nconst TAG_NAME = CLASS_NAME + '-element';\n\nconst REACTIONS_ELEMENTS: Map<string, Set<ReactionsElement>> = new Map();\nexport {REACTIONS_ELEMENTS};\n\nexport default class ReactionsElement extends HTMLElement {\n  private message: Message.message;\n  private key: string;\n  private isPlaceholder: boolean;\n  private type: ReactionLayoutType;\n  private sorted: ReactionElement[];\n  private onConnectCallback: () => void;\n  private managers: AppManagers;\n\n  constructor() {\n    super();\n    this.classList.add(CLASS_NAME);\n    this.sorted = [];\n    this.managers = rootScope.managers;\n  }\n\n  connectedCallback() {\n    let set = REACTIONS_ELEMENTS.get(this.key);\n    if(!set) {\n      REACTIONS_ELEMENTS.set(this.key, set = new Set());\n    }\n\n    set.add(this);\n\n    if(this.onConnectCallback && this.isConnected) {\n      this.onConnectCallback();\n      this.onConnectCallback = undefined;\n    }\n  }\n\n  disconnectedCallback() {\n    const set = REACTIONS_ELEMENTS.get(this.key);\n    set.delete(this);\n    if(!set.size) {\n      REACTIONS_ELEMENTS.delete(this.key);\n    }\n  }\n\n  public getReactionCount(reactionElement: ReactionElement) {\n    return this.sorted[this.sorted.indexOf(reactionElement)].reactionCount;\n  }\n\n  public getMessage() {\n    return this.message;\n  }\n\n  public init(message: Message.message, type: ReactionLayoutType, isPlaceholder?: boolean) {\n    if(this.key !== undefined) {\n      this.disconnectedCallback();\n    }\n\n    this.message = message;\n    this.key = this.message.peerId + '_' + this.message.mid;\n    this.isPlaceholder = isPlaceholder;\n\n    if(this.type !== type) {\n      this.type = type;\n      this.classList.add(CLASS_NAME + '-' + type);\n    }\n\n    this.connectedCallback();\n  }\n\n  public changeMessage(message: Message.message) {\n    return this.init(message, this.type, this.isPlaceholder);\n  }\n\n  public update(message: Message.message, changedResults?: ReactionCount[]) {\n    this.message = message;\n    this.render(changedResults);\n  }\n\n  public render(changedResults?: ReactionCount[]) {\n    const reactions = this.message.reactions;\n    const hasReactions = !!(reactions && reactions.results.length);\n    this.classList.toggle('has-no-reactions', !hasReactions);\n    if(!hasReactions && !this.sorted.length) return;\n\n    const availableReactionsResult = this.managers.appReactionsManager.getAvailableReactions();\n    // callbackify(availableReactionsResult, () => {\n    const counts = hasReactions ? (\n        availableReactionsResult instanceof Promise ?\n          reactions.results :\n          reactions.results.filter((reactionCount) => {\n            return this.managers.appReactionsManager.isReactionActive(reactionCount.reaction);\n          })\n      ) : [];\n\n    forEachReverse(this.sorted, (reactionElement, idx, arr) => {\n      const reaction = reactionElement.reactionCount.reaction;\n      const found = counts.some((reactionCount) => reactionCount.reaction === reaction);\n      if(!found) {\n        arr.splice(idx, 1);\n        reactionElement.remove();\n      }\n    });\n\n    const totalReactions = counts.reduce((acc, c) => acc + c.count, 0);\n    const canRenderAvatars = reactions && !!reactions.pFlags.can_see_list && totalReactions < REACTION_DISPLAY_BLOCK_COUNTER_AT;\n    this.sorted = counts.map((reactionCount, idx) => {\n      const reactionElementIdx = this.sorted.findIndex((reactionElement) => reactionElement.reactionCount.reaction === reactionCount.reaction);\n      let reactionElement = reactionElementIdx !== -1 && this.sorted[reactionElementIdx];\n      if(!reactionElement) {\n        reactionElement = new ReactionElement();\n        reactionElement.init(this.type);\n      }\n\n      positionElementByIndex(reactionElement, this, idx);\n\n      const recentReactions = reactions.recent_reactions ? reactions.recent_reactions.filter((reaction) => reaction.reaction === reactionCount.reaction) : [];\n      reactionElement.reactionCount = {...reactionCount};\n      reactionElement.setCanRenderAvatars(canRenderAvatars);\n      reactionElement.render(this.isPlaceholder);\n      reactionElement.renderCounter();\n      reactionElement.renderAvatars(recentReactions);\n      reactionElement.setIsChosen();\n\n      return reactionElement;\n    });\n\n    // this.sorted.forEach((reactionElement, idx) => {\n    //   /* if(this.type === 'block' && this.childElementCount !== this.sorted.length) { // because of appended time\n    //     idx += 1;\n    //   } */\n\n    //   positionElementByIndex(reactionElement, this, idx);\n    // });\n\n    if(!this.isPlaceholder && changedResults?.length) {\n      if(this.isConnected) {\n        this.handleChangedResults(changedResults);\n      } else {\n        this.onConnectCallback = () => {\n          this.handleChangedResults(changedResults);\n        };\n      }\n    }\n    // });\n\n    // !       ,     \n    if(!this.sorted.length && this.type === 'block') {\n      const parentElement = this.parentElement;\n      this.remove();\n\n      if(parentElement.classList.contains('document-message') && !parentElement.childNodes.length) {\n        parentElement.remove();\n        return;\n      }\n\n      const timeSpan = this.querySelector('.time');\n      if(timeSpan) {\n        parentElement.append(timeSpan);\n      }\n    }\n  }\n\n  private handleChangedResults(changedResults: ReactionCount[]) {\n    // ! temp\n    if(this.message.peerId !== appImManager.chat.peerId) return;\n\n    changedResults.forEach((reactionCount) => {\n      const reactionElement = this.sorted.find((reactionElement) => reactionElement.reactionCount.reaction === reactionCount.reaction);\n      if(reactionElement) {\n        reactionElement.fireAroundAnimation();\n      }\n    });\n  }\n}\n\ncustomElements.define(TAG_NAME, ReactionsElement);\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport {Message} from '../../layer';\r\nimport rootScope from '../../lib/rootScope';\r\nimport ripple from '../ripple';\r\nimport I18n from '../../lib/langPack';\r\nimport replaceContent from '../../helpers/dom/replaceContent';\r\nimport StackedAvatars from '../stackedAvatars';\r\nimport formatNumber from '../../helpers/number/formatNumber';\r\nimport {AppManagers} from '../../lib/appManagers/managers';\r\nimport getPeerId from '../../lib/appManagers/utils/peers/getPeerId';\r\nimport type LazyLoadQueue from '../lazyLoadQueue';\r\n\r\nconst TAG_NAME = 'replies-element';\r\n\r\nrootScope.addEventListener('replies_updated', (message) => {\r\n  (Array.from(document.querySelectorAll(TAG_NAME + `[data-post-key=\"${message.peerId}_${message.mid}\"]`)) as RepliesElement[]).forEach((element) => {\r\n    element.message = message;\r\n    element.render();\r\n  });\r\n});\r\n\r\nexport default class RepliesElement extends HTMLElement {\r\n  public message: Message.message;\r\n  public type: 'footer' | 'beside';\r\n  public loadPromises: Promise<any>[];\r\n  public lazyLoadQueue: LazyLoadQueue;\r\n  public stackedAvatars: StackedAvatars;\r\n  public text: I18n.IntlElement;\r\n  public managers: AppManagers;\r\n\r\n  private updated = false;\r\n\r\n  constructor() {\r\n    super();\r\n    this.managers = rootScope.managers;\r\n  }\r\n\r\n  public init() {\r\n    this.render();\r\n    this.dataset.postKey = this.message.peerId + '_' + this.message.mid;\r\n    this.classList.add('replies', 'replies-' + this.type);\r\n  }\r\n\r\n  public render() {\r\n    const replies = this.message.replies;\r\n\r\n    /* if(this.firstChild) {\r\n      this.innerHTML = '';\r\n    } */\r\n\r\n    if(this.type === 'footer') {\r\n      let leftPart: HTMLElement;\r\n      if(this.firstElementChild) {\r\n        leftPart = this.firstElementChild as HTMLElement;\r\n      }\r\n\r\n      if(replies?.recent_repliers) {\r\n        if(leftPart && !leftPart.classList.contains('replies-footer-avatars')) {\r\n          this.innerHTML = '';\r\n          leftPart = null;\r\n        }\r\n\r\n        if(!this.stackedAvatars) {\r\n          this.stackedAvatars = new StackedAvatars({\r\n            lazyLoadQueue: this.lazyLoadQueue,\r\n            avatarSize: 30\r\n          });\r\n\r\n          this.stackedAvatars.container.classList.add('replies-footer-avatars');\r\n        }\r\n\r\n        leftPart = this.stackedAvatars.container;\r\n\r\n        this.stackedAvatars.render(replies.recent_repliers.map((peer) => getPeerId(peer)), this.loadPromises);\r\n      } else {\r\n        if(leftPart && !leftPart.classList.contains('tgico-comments')) {\r\n          leftPart.remove();\r\n          leftPart = null;\r\n        }\r\n\r\n        if(!leftPart) {\r\n          leftPart = document.createElement('span');\r\n          leftPart.classList.add('tgico-comments');\r\n        }\r\n      }\r\n\r\n      if(!leftPart.parentElement) {\r\n        this.prepend(leftPart);\r\n      }\r\n\r\n      if(!this.text) {\r\n        this.text = new I18n.IntlElement();\r\n      }\r\n\r\n      const text = this.text;\r\n      if(replies) {\r\n        if(replies.replies) {\r\n          text.compareAndUpdate({key: 'Comments', args: [replies.replies]});\r\n        } else {\r\n          text.compareAndUpdate({key: 'LeaveAComment'});\r\n        }\r\n      } else {\r\n        text.compareAndUpdate({key: 'ViewInChat'});\r\n      }\r\n\r\n      if(replies) {\r\n        // const historyStorage = appMessagesManager.getHistoryStorage(replies.channel_id.toPeerId(true));\r\n        let isUnread = false;\r\n        if(replies.replies) {\r\n          if(replies.read_max_id !== undefined && replies.max_id !== undefined) {\r\n            isUnread = replies.read_max_id < replies.max_id;\r\n          }/*  else {\r\n            isUnread = !historyStorage.readMaxId || historyStorage.readMaxId < (replies.max_id || 0);\r\n          } */\r\n        }\r\n        this.classList.toggle('is-unread', isUnread);\r\n      }\r\n\r\n      let textSpan = this.children[1] as HTMLElement;\r\n      if(!textSpan) {\r\n        textSpan = document.createElement('span');\r\n        textSpan.classList.add('replies-footer-text');\r\n\r\n        const iconSpan = document.createElement('span');\r\n        iconSpan.classList.add('tgico-next');\r\n\r\n        const rippleContainer = document.createElement('div');\r\n        ripple(rippleContainer);\r\n\r\n        this.append(textSpan, iconSpan, rippleContainer);\r\n      }\r\n\r\n      replaceContent(textSpan, text.element);\r\n    } else {\r\n      this.classList.add('bubble-beside-button');\r\n      this.innerHTML = `<span class=\"tgico-commentssticker\"></span><span class=\"replies-beside-text\">${replies?.replies ? formatNumber(replies.replies, 0) : ''}</span>`;\r\n    }\r\n\r\n    if(replies && !this.updated && !this.message.pFlags.is_outgoing) {\r\n      this.managers.appMessagesManager.subscribeRepliesThread(this.message.peerId, this.message.mid);\r\n      this.managers.appMessagesManager.updateMessage(this.message.peerId, this.message.mid, 'replies_updated');\r\n      this.updated = true;\r\n    }\r\n\r\n    if(this.loadPromises) {\r\n      this.loadPromises = undefined;\r\n    }\r\n  }\r\n}\r\n\r\ncustomElements.define(TAG_NAME, RepliesElement);\r\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport {formatTime, getFullDate} from '../../helpers/date';\nimport setInnerHTML from '../../helpers/dom/setInnerHTML';\nimport formatNumber from '../../helpers/number/formatNumber';\nimport {Message} from '../../layer';\nimport getPeerId from '../../lib/appManagers/utils/peers/getPeerId';\nimport {i18n, _i18n} from '../../lib/langPack';\nimport wrapEmojiText from '../../lib/richTextProcessor/wrapEmojiText';\nimport rootScope from '../../lib/rootScope';\nimport type LazyLoadQueue from '../lazyLoadQueue';\nimport PeerTitle from '../peerTitle';\nimport {wrapReply} from '../wrappers';\nimport Chat, {ChatType} from './chat';\nimport ReactionsElement from './reactions';\nimport RepliesElement from './replies';\n\nconst NBSP = '&nbsp;';\n\nconst makeEdited = () => {\n  const edited = document.createElement('i');\n  edited.classList.add('edited');\n  _i18n(edited, 'EditedMessage');\n  return edited;\n};\n\nconst makeSponsored = () => i18n('SponsoredMessage');\n\nexport namespace MessageRender {\n  /* export const setText = () => {\n\n  }; */\n\n  export const setTime = (options: {\n    chatType: ChatType,\n    message: Message.message | Message.messageService,\n    reactionsMessage?: Message.message\n  }) => {\n    const {chatType, message} = options;\n    const date = new Date(message.date * 1000);\n    const args: (HTMLElement | string)[] = [];\n\n    let editedSpan: HTMLElement, sponsoredSpan: HTMLElement, reactionsElement: ReactionsElement, reactionsMessage: Message.message;\n\n    const isSponsored = !!(message as Message.message).pFlags.sponsored;\n    const isMessage = !('action' in message) && !isSponsored;\n    let hasReactions: boolean;\n\n    const time: HTMLElement = isSponsored ? undefined : formatTime(date);\n    if(isMessage) {\n      if(message.views) {\n        const postAuthor = message.post_author || message.fwd_from?.post_author;\n\n        const postViewsSpan = document.createElement('span');\n        postViewsSpan.classList.add('post-views');\n        postViewsSpan.innerHTML = formatNumber(message.views, 1);\n\n        const channelViews = document.createElement('i');\n        channelViews.classList.add('tgico-channelviews', 'time-icon');\n\n        args.push(postViewsSpan, channelViews);\n        if(postAuthor) {\n          const span = document.createElement('span');\n          setInnerHTML(span, wrapEmojiText(postAuthor));\n          span.insertAdjacentHTML('beforeend', ',' + NBSP)\n          args.push(span);\n        }\n      }\n\n      if(message.edit_date && chatType !== 'scheduled' && !message.pFlags.edit_hide) {\n        args.unshift(editedSpan = makeEdited());\n      }\n\n      if(chatType !== 'pinned' && message.pFlags.pinned) {\n        const i = document.createElement('i');\n        i.classList.add('tgico-pinnedchat', 'time-icon');\n        args.unshift(i);\n      }\n\n      if(message.peer_id._ === 'peerUser'/*  && message.reactions?.results?.length */) {\n        hasReactions = true;\n\n        reactionsMessage = options.reactionsMessage;\n        reactionsElement = new ReactionsElement();\n        reactionsElement.init(reactionsMessage, 'inline', true);\n        reactionsElement.render();\n        args.unshift(reactionsElement);\n      }\n    } else if(isSponsored) {\n      args.push(sponsoredSpan = makeSponsored());\n    }\n\n    if(time) {\n      args.push(time);\n    }\n\n    let title = isSponsored ? undefined : getFullDate(date);\n    if(isMessage) {\n      title += (message.edit_date && !message.pFlags.edit_hide ? `\\nEdited: ${getFullDate(new Date(message.edit_date * 1000))}` : '') +\n        (message.fwd_from ? `\\nOriginal: ${getFullDate(new Date(message.fwd_from.date * 1000))}` : '');\n    }\n\n    const timeSpan = document.createElement('span');\n    timeSpan.classList.add('time', 'tgico');\n    // if(title) timeSpan.title = title;\n    timeSpan.append(...args);\n\n    const inner = document.createElement('div');\n    inner.classList.add('inner', 'tgico');\n    if(title) inner.title = title;\n\n    let clonedArgs = args;\n    if(editedSpan) {\n      clonedArgs[clonedArgs.indexOf(editedSpan)] = makeEdited();\n    }\n    if(sponsoredSpan) {\n      clonedArgs[clonedArgs.indexOf(sponsoredSpan)] = makeSponsored();\n    }\n    if(reactionsElement) {\n      const _reactionsElement = clonedArgs[clonedArgs.indexOf(reactionsElement)] = new ReactionsElement();\n      _reactionsElement.init(reactionsMessage, 'inline');\n      _reactionsElement.render();\n    }\n    clonedArgs = clonedArgs.map((a) => a instanceof HTMLElement && !a.classList.contains('i18n') && !a.classList.contains('reactions') ? a.cloneNode(true) as HTMLElement : a);\n    if(time) {\n      clonedArgs[clonedArgs.length - 1] = formatTime(date); // clone time\n    }\n    inner.append(...clonedArgs);\n\n    timeSpan.append(inner);\n\n    return timeSpan;\n  };\n\n  export const renderReplies = ({bubble, bubbleContainer, message, messageDiv, loadPromises, lazyLoadQueue}: {\n    bubble: HTMLElement,\n    bubbleContainer: HTMLElement,\n    message: Message.message,\n    messageDiv: HTMLElement,\n    loadPromises?: Promise<any>[],\n    lazyLoadQueue?: LazyLoadQueue\n  }) => {\n    const isFooter = !bubble.classList.contains('sticker') && !bubble.classList.contains('emoji-big') && !bubble.classList.contains('round');\n    const repliesFooter = new RepliesElement();\n    repliesFooter.message = message;\n    repliesFooter.type = isFooter ? 'footer' : 'beside';\n    repliesFooter.loadPromises = loadPromises;\n    repliesFooter.lazyLoadQueue = lazyLoadQueue;\n    repliesFooter.init();\n    bubbleContainer.prepend(repliesFooter);\n    return isFooter;\n  };\n\n  export const setReply = async({chat, bubble, bubbleContainer, message}: {\n    chat: Chat,\n    bubble: HTMLElement,\n    bubbleContainer?: HTMLElement,\n    message: Message.message\n  }) => {\n    const isReplacing = !bubbleContainer;\n    if(isReplacing) {\n      bubbleContainer = bubble.querySelector('.bubble-content');\n    }\n\n    const currentReplyDiv = isReplacing ? bubbleContainer.querySelector('.reply') : null;\n    if(!message.reply_to_mid) {\n      if(currentReplyDiv) {\n        currentReplyDiv.remove();\n      }\n\n      bubble.classList.remove('is-reply');\n      return;\n    }\n\n\n    const replyToPeerId = message.reply_to.reply_to_peer_id ? getPeerId(message.reply_to.reply_to_peer_id) : chat.peerId;\n\n    const originalMessage = await rootScope.managers.appMessagesManager.getMessageByPeer(replyToPeerId, message.reply_to_mid);\n    let originalPeerTitle: string | HTMLElement;\n\n    // ///////this.log('message to render reply', originalMessage, originalPeerTitle, bubble, message);\n\n    let titlePeerId: PeerId;\n    // need to download separately\n    if(!originalMessage) {\n      // ////////this.log('message to render reply empty, need download', message, message.reply_to_mid);\n      rootScope.managers.appMessagesManager.fetchMessageReplyTo(message);\n      chat.bubbles.needUpdate.push({replyToPeerId, replyMid: message.reply_to_mid, mid: message.mid});\n\n      originalPeerTitle = i18n('Loading');\n    } else {\n      const originalMessageFwdFromId = (originalMessage as Message.message).fwdFromId;\n      titlePeerId = message.fwdFromId && message.fwdFromId === originalMessageFwdFromId ? message.fwdFromId : originalMessage.fromId || originalMessageFwdFromId;\n      originalPeerTitle = new PeerTitle({\n        peerId: titlePeerId,\n        dialog: false,\n        onlyFirstName: false,\n        plainText: false\n      }).element;\n    }\n\n    const {container, fillPromise} = wrapReply(originalPeerTitle, undefined, originalMessage, chat.isAnyGroup ? titlePeerId : undefined);\n    await fillPromise;\n    if(currentReplyDiv) {\n      currentReplyDiv.replaceWith(container);\n    } else {\n      bubbleContainer.append(container);\n    }\n    // bubbleContainer.insertBefore(, nameContainer);\n    bubble.classList.add('is-reply');\n  };\n}\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport {MOUNT_CLASS_TO} from '../../config/debug';\r\n\r\nexport function getElementByPoint(container: HTMLElement, verticalSide: 'top' | 'bottom', horizontalSide: 'center' | 'left'): HTMLElement {\r\n  // return null;\r\n  const rect = container.getBoundingClientRect();\r\n  const x = horizontalSide === 'center' ? Math.ceil(rect.left + ((rect.right - rect.left) / 2) + 1) : Math.ceil(rect.left + 1);\r\n  const y = verticalSide === 'bottom' ? Math.floor(rect.top + rect.height - 1) : Math.ceil(rect.top + 1);\r\n  return document.elementFromPoint(x, y) as any;\r\n};\r\n\r\nMOUNT_CLASS_TO.getElementByPoint = getElementByPoint;\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nexport default function reflowScrollableElement(element: HTMLElement) {\r\n  element.style.display = 'none';\r\n  void element.offsetLeft; // reflow\r\n  element.style.display = '';\r\n}\r\n","export const SEND_WHEN_ONLINE_TIMESTAMP = 0x7FFFFFFE;\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nexport enum INTERNAL_LINK_TYPE {\n  MESSAGE,\n  PRIVATE_POST,\n  STICKER_SET,\n  JOIN_CHAT,\n  VOICE_CHAT,\n  USER_PHONE_NUMBER,\n  INVOICE,\n  EMOJI_SET\n};\n\nexport type InternalLink = InternalLink.InternalLinkMessage | InternalLink.InternalLinkPrivatePost | InternalLink.InternalLinkStickerSet | InternalLink.InternalLinkJoinChat | InternalLink.InternalLinkVoiceChat | InternalLink.InternalLinkUserPhoneNumber | InternalLink.InternalLinkInvoice | InternalLink.InternalLinkEmojiSet;\n\nexport namespace InternalLink {\n  export interface InternalLinkMessage {\n    _: INTERNAL_LINK_TYPE.MESSAGE,\n    domain: string,\n    post?: string,\n    comment?: string,\n    start?: string\n  }\n\n  export interface InternalLinkPrivatePost {\n    _: INTERNAL_LINK_TYPE.PRIVATE_POST,\n    channel: string,\n    post: string,\n    thread?: string,\n    comment?: string\n  }\n\n  export interface InternalLinkStickerSet {\n    _: INTERNAL_LINK_TYPE.STICKER_SET,\n    set: string\n  }\n\n  export interface InternalLinkJoinChat {\n    _: INTERNAL_LINK_TYPE.JOIN_CHAT,\n    invite: string\n  }\n\n  /**\n   * LOCAL LINK\n   */\n  export interface InternalLinkVoiceChat {\n    _: INTERNAL_LINK_TYPE.VOICE_CHAT,\n    id: string,\n    access_hash: string,\n    chat_id: string\n  }\n\n  export interface InternalLinkUserPhoneNumber {\n    _: INTERNAL_LINK_TYPE.USER_PHONE_NUMBER,\n    phone: string\n  }\n\n  export interface InternalLinkInvoice {\n    _: INTERNAL_LINK_TYPE.INVOICE,\n    slug: string\n  }\n\n  export interface InternalLinkEmojiSet {\n    _: INTERNAL_LINK_TYPE.EMOJI_SET,\n    set: string\n  }\n}\n\nexport type InternalLinkTypeMap = {\n  [INTERNAL_LINK_TYPE.MESSAGE]: InternalLink.InternalLinkMessage,\n  [INTERNAL_LINK_TYPE.PRIVATE_POST]: InternalLink.InternalLinkPrivatePost,\n  [INTERNAL_LINK_TYPE.STICKER_SET]: InternalLink.InternalLinkStickerSet,\n  [INTERNAL_LINK_TYPE.JOIN_CHAT]: InternalLink.InternalLinkJoinChat,\n  [INTERNAL_LINK_TYPE.VOICE_CHAT]: InternalLink.InternalLinkVoiceChat,\n  [INTERNAL_LINK_TYPE.USER_PHONE_NUMBER]: InternalLink.InternalLinkUserPhoneNumber,\n  [INTERNAL_LINK_TYPE.INVOICE]: InternalLink.InternalLinkInvoice,\n  [INTERNAL_LINK_TYPE.EMOJI_SET]: InternalLink.InternalLinkEmojiSet\n};\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport PopupElement, {addCancelButton} from '.';\r\nimport setInnerHTML from '../../helpers/dom/setInnerHTML';\r\nimport numberThousandSplitter from '../../helpers/number/numberThousandSplitter';\r\nimport {ChatInvite} from '../../layer';\r\nimport appImManager from '../../lib/appManagers/appImManager';\r\nimport {i18n, _i18n} from '../../lib/langPack';\r\nimport {NULL_PEER_ID} from '../../lib/mtproto/mtproto_config';\r\nimport wrapEmojiText from '../../lib/richTextProcessor/wrapEmojiText';\r\nimport AvatarElement from '../avatar';\r\nimport putPhoto from '../putPhoto';\r\nimport {toastNew} from '../toast';\r\nimport {wrapPhoto} from '../wrappers';\r\n\r\n// const FAKE_CHAT_ID = Number.MAX_SAFE_INTEGER - 0x1000;\r\n\r\nexport default class PopupJoinChatInvite extends PopupElement {\r\n  constructor(\r\n    private hash: string,\r\n    private chatInvite: ChatInvite.chatInvite\r\n  ) {\r\n    super('popup-join-chat-invite', {\r\n      closable: true,\r\n      overlayClosable: true,\r\n      body: true,\r\n      buttons: addCancelButton([{\r\n        langKey: chatInvite.pFlags.request_needed ? 'RequestJoin.Button' : (chatInvite.pFlags.broadcast ? 'JoinByPeekChannelTitle' : 'JoinByPeekGroupTitle'),\r\n        callback: () => {\r\n          this.managers.appChatsManager.importChatInvite(hash)\r\n          .then((chatId) => {\r\n            const peerId = chatId.toPeerId(true);\r\n            appImManager.setInnerPeer({peerId});\r\n          }, (error) => {\r\n            if(error.type === 'INVITE_REQUEST_SENT') {\r\n              toastNew({langPackKey: 'RequestToJoinSent'});\r\n            }\r\n          });\r\n        }\r\n      }])\r\n    });\r\n\r\n    this.construct();\r\n  }\r\n\r\n  private async construct() {\r\n    this.header.remove();\r\n    /* const fakeChat: Chat.channel | Chat.chat = {\r\n      _: chatInvite.pFlags.channel ? 'channel' : 'chat',\r\n      id: FAKE_CHAT_ID,\r\n      title: chatInvite.title,\r\n      photo: chatInvite.photo as any,\r\n      date: Date.now() / 1000 | 0,\r\n      version: 0,\r\n      participants_count: chatInvite.participants_count,\r\n      pFlags: chatInvite.pFlags as any\r\n    };\r\n\r\n    appChatsManager.saveApiChat(fakeChat); */\r\n\r\n    const {chatInvite, managers, hash} = this;\r\n\r\n    const avatarElem = new AvatarElement();\r\n    avatarElem.classList.add('avatar-100');\r\n    avatarElem.isDialog = false;\r\n    if(chatInvite.photo._ === 'photo') {\r\n      chatInvite.photo = await managers.appPhotosManager.savePhoto(chatInvite.photo);\r\n      wrapPhoto({\r\n        container: avatarElem,\r\n        message: null,\r\n        photo: chatInvite.photo,\r\n        boxHeight: 100,\r\n        boxWidth: 100,\r\n        withoutPreloader: true\r\n      });\r\n      avatarElem.style.width = avatarElem.style.height = '';\r\n    } else {\r\n      putPhoto(avatarElem, NULL_PEER_ID, false, chatInvite.title);\r\n    }\r\n\r\n    const title = document.createElement('div');\r\n    title.classList.add('chat-title');\r\n    setInnerHTML(title, wrapEmojiText(chatInvite.title));\r\n    // avatarElem.setAttribute('peer', '' + -fakeChat.id);\r\n\r\n    const isBroadcast = chatInvite.pFlags.broadcast;\r\n    const peopleCount = i18n(isBroadcast ? 'Subscribers' : 'Members', [numberThousandSplitter(chatInvite.participants_count)]);\r\n    peopleCount.classList.add('chat-participants-count');\r\n\r\n    this.body.append(avatarElem, title, peopleCount);\r\n\r\n    if(chatInvite.pFlags.request_needed) {\r\n      const caption = document.createElement('div');\r\n      _i18n(caption, isBroadcast ? 'RequestToJoinChannelDescription' : 'RequestToJoinGroupDescription');\r\n      caption.classList.add('chat-participants-count', 'request-caption');\r\n\r\n      this.body.append(caption);\r\n    }\r\n\r\n    this.show();\r\n  }\r\n}\r\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport Scrollable from '../components/scrollable';\nimport {MOUNT_CLASS_TO} from '../config/debug';\nimport {IS_SAFARI} from '../environment/userAgent';\nimport getVisibleRect from './dom/getVisibleRect';\nimport reflowScrollableElement from './dom/reflowScrollableElement';\n\nexport default class ScrollSaver {\n  private scrollHeight: number;\n  private scrollHeightMinusTop: number;\n  private scrollTop: number;\n  private clientHeight: number;\n  private elements: {element: HTMLElement, rect: DOMRect}[];\n\n  /**\n   *\n   * @param scrollable to reset scroll position and direction\n   * @param reverse true means top\n   */\n  constructor(\n    private scrollable: Scrollable,\n    private query: string,\n    private reverse: boolean\n  ) {\n\n  }\n\n  private get container() {\n    return this.scrollable.container;\n  }\n\n  public getSaved() {\n    return {\n      scrollHeight: this.scrollHeight,\n      scrollTop: this.scrollTop,\n      clientHeight: this.clientHeight\n    };\n  }\n\n  public findElements() {\n    if(!this.query) return [];\n\n    const {container} = this;\n    const containerRect = container.getBoundingClientRect();\n    const bubbles = Array.from(container.querySelectorAll(this.query)) as HTMLElement[];\n    const elements: ScrollSaver['elements'] = [];\n    for(const bubble of bubbles) {\n      const elementRect = bubble.getBoundingClientRect();\n      const visibleRect = getVisibleRect(bubble, container, undefined, elementRect, containerRect);\n      if(visibleRect) {\n        elements.push({element: bubble, rect: elementRect});\n        // break; // find first\n      } else if(elements.length) { // find last\n        break;\n      }\n    }\n\n    if(!elements.length) {\n      const bubble = bubbles[0];\n      if(bubble) {\n        elements.push({element: bubble, rect: bubble.getBoundingClientRect()});\n      }\n    }\n\n    return elements;\n  }\n\n  public replaceSaved(from: HTMLElement, to: HTMLElement) {\n    if(!this.elements) {\n      return;\n    }\n\n    const idx = this.elements.findIndex(({element}) => from === element);\n    if(idx !== -1) {\n      this.elements[idx].element = to;\n    }\n  }\n\n  public findAndSetElements() {\n    this.elements = this.findElements();\n  }\n\n  public save() {\n    this.findAndSetElements();\n    // console.warn('scroll save', this.elements);\n    this._save();\n  }\n\n  public _save() {\n    const {scrollTop, scrollHeight, clientHeight} = this.container;\n\n    // previousScrollHeight = scrollHeight;\n    // previousScrollHeight = scrollHeight + padding;\n    this.scrollHeight = scrollHeight;\n    this.scrollTop = scrollTop;\n    this.clientHeight = clientHeight;\n    this.scrollHeightMinusTop = this.reverse ? scrollHeight - scrollTop : scrollTop;\n\n    // this.chatInner.style.paddingTop = padding + 'px';\n    /* if(reverse) {\n      previousScrollHeightMinusTop = this.scrollable.scrollHeight - scrollTop;\n    } else {\n      previousScrollHeightMinusTop = scrollTop;\n    } */\n  }\n\n  private onRestore(useReflow?: boolean) {\n    if(IS_SAFARI && useReflow/*  && !isAppleMobile */) { // * fix blinking and jumping\n      reflowScrollableElement(this.container);\n    }\n  }\n\n  private setScrollTop(newScrollTop: number, useReflow?: boolean) {\n    // touchSupport for safari iOS\n    // isTouchSupported && isApple && (container.container.style.overflow = 'hidden');\n    this.scrollable.setScrollTopSilently(this.scrollTop = newScrollTop);\n    // container.scrollTop = scrollHeight;\n    // isTouchSupported && isApple && (container.container.style.overflow = '');\n\n    this.onRestore(useReflow);\n  }\n\n  public restore(useReflow?: boolean) {\n    const {scrollTop, scrollHeight} = this.scrollable;\n    this.scrollHeight = scrollHeight;\n\n    if(!this.elements.length) { // maybe all messages have been deleted\n      this._restore(useReflow);\n      return;\n    }\n\n    let anchor: ScrollSaver['elements'][0];\n    // for(let i = this.elements.length - 1; i >= 0; --i) {\n    //   const _anchor = this.elements[i];\n    //   if(_anchor.element.parentElement) {\n    //     anchor = _anchor;\n    //     break;\n    //   }\n    // }\n    anchor = this.elements[this.elements.length - 1];\n\n    if(!anchor?.element?.parentElement) { // try to find new anchor\n      this.findAndSetElements();\n      anchor = this.elements[this.elements.length - 1];\n\n      if(!anchor) { // fallback to old method if smth is really strange\n        this._restore(useReflow);\n        return;\n      }\n    }\n\n    const {element, rect} = anchor;\n    const newRect = element.getBoundingClientRect();\n    const diff = newRect.bottom - rect.bottom;\n    this.setScrollTop(scrollTop + diff, useReflow);\n    // if(diff) debugger;\n    // console.warn('scroll restore', rect, diff, newRect);\n  }\n\n  public _restore(useReflow?: boolean) {\n    const {scrollHeightMinusTop: previousScrollHeightMinusTop, scrollable} = this;\n    // if(previousScrollHeightMinusTop === undefined) {\n    //   throw new Error('scroll was not saved');\n    // }\n\n    // const scrollHeight = container.scrollHeight;\n    const scrollHeight = this.scrollHeight;\n    // if(scrollHeight === this.scrollHeight) {\n    //   return;\n    // }\n\n    // this.scrollHeight = scrollHeight;\n\n    /* const scrollHeight = container.scrollHeight;\n    const addedHeight = scrollHeight - previousScrollHeight;\n\n    this.chatInner.style.paddingTop = (10000 - addedHeight) + 'px'; */\n    /* const scrollHeight = scrollHeight;\n    const addedHeight = scrollHeight - previousScrollHeight;\n\n    this.chatInner.style.paddingTop = (padding - addedHeight) + 'px';\n\n    //const newScrollTop = reverse ? scrollHeight - previousScrollHeightMinusTop : previousScrollHeightMinusTop;\n    const newScrollTop = reverse ? scrollHeight - addedHeight - previousScrollHeightMinusTop : previousScrollHeightMinusTop;\n    this.log('performHistoryResult: will set scrollTop',\n    previousScrollHeightMinusTop, scrollHeight,\n    newScrollTop, container.container.clientHeight); */\n    // const newScrollTop = reverse ? scrollHeight - previousScrollHeightMinusTop : previousScrollHeightMinusTop;\n    const newScrollTop = this.reverse ? scrollHeight - previousScrollHeightMinusTop : previousScrollHeightMinusTop;\n\n    /* if(DEBUG) {\n      this.log('performHistoryResult: will set up scrollTop:', newScrollTop, this.isHeavyAnimationInProgress);\n    } */\n\n    this.setScrollTop(newScrollTop, useReflow);\n\n    /* if(DEBUG) {\n      this.log('performHistoryResult: have set up scrollTop:', newScrollTop, container.scrollTop, container.scrollHeight, this.isHeavyAnimationInProgress);\n    } */\n  }\n}\n\nMOUNT_CLASS_TO && (MOUNT_CLASS_TO.ScrollSaver = ScrollSaver);\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nexport type IntersectionTarget = Element;\nexport type IntersectionCallback = (entry: IntersectionObserverEntry) => void;\n\nexport default class SuperIntersectionObserver {\n  private observing: Map<IntersectionTarget, Set<IntersectionCallback>>;\n  private observingQueue: SuperIntersectionObserver['observing'];\n  private observer: IntersectionObserver;\n  private freezedObservingNew: boolean;\n\n  constructor(init?: IntersectionObserverInit) {\n    this.observing = new Map();\n    this.observingQueue = new Map();\n    this.freezedObservingNew = false;\n\n    this.observer = new IntersectionObserver((entries) => {\n      const observing = this.observing;\n      for(let i = 0, length = entries.length; i < length; ++i) {\n        const entry = entries[i];\n        const callbacks = observing.get(entry.target);\n        if(!callbacks) {\n          debugger;\n        }\n\n        for(const callback of callbacks) {\n          try {\n            callback(entry);\n          } catch(err) {\n            console.error('intersection process callback error:', err);\n          }\n        }\n      }\n    }, init);\n  }\n\n  public disconnect() {\n    this.observing.clear();\n    this.observingQueue.clear();\n    this.observer.disconnect();\n  }\n\n  public toggleObservingNew(value: boolean) {\n    if(this.freezedObservingNew === value) {\n      return;\n    }\n\n    this.freezedObservingNew = value;\n\n    const queue = this.observingQueue;\n    if(!value && queue.size) {\n      for(const [target, callbacks] of queue) {\n        for(const callback of callbacks) {\n          this.observe(target, callback);\n        }\n      }\n\n      queue.clear();\n    }\n  }\n\n  public has(target: IntersectionTarget, callback: IntersectionCallback, observing = this.observing) {\n    const callbacks = observing.get(target);\n    return !!(callbacks && callbacks.has(callback));\n  }\n\n  public observe(target: IntersectionTarget, callback: IntersectionCallback) {\n    if(this.freezedObservingNew && this.has(target, callback)) {\n      return;\n    }\n\n    const observing = this.freezedObservingNew ? this.observingQueue : this.observing;\n    let callbacks = observing.get(target);\n    if(callbacks && callbacks.has(callback)) {\n      return;\n    }\n\n    if(!callbacks) {\n      callbacks = new Set();\n      observing.set(target, callbacks);\n\n      if(observing === this.observing) {\n        this.observer.observe(target);\n      }\n    }\n\n    callbacks.add(callback);\n  }\n\n  public unobserve(target: IntersectionTarget, callback: IntersectionCallback) {\n    const observing = this.freezedObservingNew && !this.has(target, callback) ? this.observingQueue : this.observing;\n    const callbacks = observing.get(target);\n    if(!callbacks) {\n      return;\n    }\n\n    callbacks.delete(callback);\n    if(!callbacks.size) {\n      observing.delete(target);\n      this.observer.unobserve(target);\n    }\n  }\n}\n","import type {MyDocument} from '../../appDocsManager';\nimport type {MyMessage} from '../../appMessagesManager';\nimport {Message, MessageMedia} from '../../../../layer';\n\nexport default function isMentionUnread(message: MyMessage) {\n  if(!message) {\n    return false;\n  }\n\n  const doc = ((message as Message.message).media as MessageMedia.messageMediaDocument)?.document as MyDocument;\n  return !!(\n    message.pFlags.media_unread &&\n    message.pFlags.mentioned &&\n    (\n      !doc ||\n      !(['voice', 'round'] as MyDocument['type'][]).includes(doc.type)\n    )\n  );\n}\n","function cacheCallback<A, T>(callback: (str: A) => T) {\n  const stringResults: any = {}, numberResults: any = {};\n  return (value: A): T => {\n    const key = '_' + value;\n    return (typeof(value) === 'string' ? stringResults : numberResults)[key] ??= callback(value);\n  };\n}\n\nexport default cacheCallback;\n","export default function replaceNonNumber(str: string) {\n  return str.replace(/\\D/g, '');\n}\n","import cacheCallback from '../cacheCallback';\nimport replaceNonNumber from '../string/replaceNonNumber';\n\nconst CARD_BRAND_REGEXP: {[brand: string]: RegExp} = {\n  visa: /^4/,\n  mastercard: /^(51|52|53|54|55|222|23|24|25|26|27)/,\n  amex: /^(34|37)/,\n  discover: /^(60|64|65)/,\n  diners: /^(30|38|39)/,\n  diners14: /^(36)/,\n  jcb: /^(35)/,\n  unionpay: /^(62[0-6,8-9]|627[0-6,8-9]|6277[0-7,9]|62778[1-9]|81)/,\n  elo: /^(5067|509|636368|627780)/,\n  mir: /^(220[0-4])/\n};\n\n// * taken from Stripe\nexport const CARD_BRANDS: {[b: string]: {\n  minLength: number,\n  maxLength: number,\n  cvcMaxLength: number,\n  cvcMinLength: number | null\n}} = {\n  visa: {\n    minLength: 16,\n    maxLength: 16,\n    cvcMaxLength: 3,\n    cvcMinLength: null\n  },\n  mastercard: {\n    minLength: 16,\n    maxLength: 16,\n    cvcMaxLength: 3,\n    cvcMinLength: null\n  },\n  amex: {\n    minLength: 15,\n    maxLength: 15,\n    cvcMaxLength: 4,\n    cvcMinLength: 3\n  },\n  unionpay: {\n    minLength: 13,\n    maxLength: 19,\n    cvcMaxLength: 3,\n    cvcMinLength: null\n  },\n  diners: {\n    minLength: 16,\n    maxLength: 16,\n    cvcMaxLength: 3,\n    cvcMinLength: null\n  },\n  diners14: {\n    minLength: 14,\n    maxLength: 14,\n    cvcMaxLength: 3,\n    cvcMinLength: null\n  },\n  discover: {\n    minLength: 16,\n    maxLength: 16,\n    cvcMaxLength: 3,\n    cvcMinLength: null\n  },\n  jcb: {\n    minLength: 16,\n    maxLength: 16,\n    cvcMaxLength: 3,\n    cvcMinLength: null\n  },\n  elo: {\n    minLength: 16,\n    maxLength: 16,\n    cvcMaxLength: 3,\n    cvcMinLength: null\n  },\n  mir: {\n    minLength: 16,\n    maxLength: 16,\n    cvcMaxLength: 3,\n    cvcMinLength: null\n  },\n  unknown: {\n    minLength: 16,\n    maxLength: 16,\n    cvcMaxLength: 4,\n    cvcMinLength: 3\n  }\n};\n\nexport const detectCardBrand = cacheCallback((card: string = '') => {\n  const keys = Object.keys(CARD_BRAND_REGEXP);\n  const sanitizedCard = replaceNonNumber(card);\n  let brand: string;\n  let last = 0;\n  keys.forEach((key) => {\n    const regExp = CARD_BRAND_REGEXP[key];\n    const match = sanitizedCard.match(regExp);\n    if(match) {\n      const result = match[0];\n      if(result && result.length > last) {\n        brand = key;\n        last = result.length;\n      }\n    }\n  });\n\n  return brand || 'unknown';\n});\n\nexport function cardBrandToUnifiedBrand(brand: string) {\n  return brand === 'diners14' ? 'diners' : brand;\n}\n\nexport function detectUnifiedCardBrand(card = '') {\n  const brand = detectCardBrand(card);\n  return cardBrandToUnifiedBrand(brand);\n}\n","export default function createArray<T1>(length: number, fill?: T1, map?: any): T1[] {\n  const arr = new Array<T1>(length);\n  arr.fill(fill);\n  return map ? arr.map(map) : arr;\n}\n","const delta = ''.charCodeAt(0) - '0'.charCodeAt(0);\nconst buggedRegExp = /[-]/g;\n\n// function hasBuggedNumbers(str: string) {\n//   return !!str.match(a);\n// }\n\nfunction getDistanceFromBuggedToNormal(char: string) {\n  return String.fromCharCode(char.charCodeAt(0) - delta);\n}\n\nexport function fixBuggedNumbers(str: string) {\n  return str.replace(buggedRegExp, getDistanceFromBuggedToNormal);\n}\n","import {fixBuggedNumbers} from '../string/buggedNumbers';\nimport replaceNonNumber from '../string/replaceNonNumber';\n\nexport type PatternCharacter = {\n  type: 'optional',\n  result: string,\n  consumed: number\n} | {\n  type: 'required',\n  result: string,\n  consumed: number,\n  partial?: boolean\n} | {\n  type: 'formatting',\n  result: string,\n  consumed: number\n};\n\nexport type PatternFunction = (str: string) => ((str: string) => PatternCharacter)[];\n\nfunction makeOptionalCharacter(result: string, consumed: number): PatternCharacter {\n  return {type: 'optional', result, consumed};\n}\n\nfunction makeRequiredCharacter(result: string, consumed: number, partial?: boolean): PatternCharacter {\n  return {type: 'required', result, consumed, partial};\n}\n\nfunction makeFormattingCharacter(result: string, consumed: number): PatternCharacter {\n  return {type: 'formatting', result, consumed};\n}\n\nfunction wrapCharacterRegExpFactory(regExp: RegExp, optional?: boolean) {\n  return (str: string) => {\n    const _regExp = new RegExp('^'.concat(regExp.source.replace(/^\\^/, '')));\n    const match = str.match(_regExp);\n    const makeCharacter = optional ? makeOptionalCharacter : makeRequiredCharacter;\n    if(match) {\n      const result = match[0];\n      return makeCharacter(result, match.index + result.length);\n    }\n\n    return makeCharacter('', str.length);\n  };\n}\n\nfunction makeCapitalPatternCharacter(str: string) {\n  const char = wrapCharacterRegExpFactory(/\\w/)(str);\n  return char.result ? makeRequiredCharacter(char.result.toUpperCase(), char.consumed) : char;\n}\n\nconst makeMonthDigitPatternCharacter = wrapCharacterRegExpFactory(/1[0-2]|0?[1-9]|0/);\n\nfunction digit(str: string) {\n  return wrapCharacterRegExpFactory(/[0-9]/)(fixBuggedNumbers(str));\n}\n\nconst patternCharacters = {\n  digit,\n  capitalCharacter: makeCapitalPatternCharacter,\n  month: (str: string) => {\n    const char = makeMonthDigitPatternCharacter(fixBuggedNumbers(str));\n    const cleanedResult = replaceNonNumber(char.result);\n    const isPartial = ['0', '1'].includes(char.result) && str.length === 1;\n    if(isPartial || (char.result === '0' && str.length >= 2)) {\n      return makeRequiredCharacter(char.result, str.length, true);\n    }\n\n    return makeRequiredCharacter(cleanedResult.length === 1 ? '0' + cleanedResult : cleanedResult, char.consumed);\n  },\n  formattingCharacter: (str: string) => {\n    return (str1: string) => {\n      const consumed = str === str1[0] ? 1 : 0;\n      return makeFormattingCharacter(str, consumed);\n    }\n  },\n  optionalPattern: (regExp: RegExp) => {\n    return (str: string) => {\n      const char = wrapCharacterRegExpFactory(regExp, true)(str);\n      return char.result ? char : makeOptionalCharacter('', 0);\n    };\n  }\n};\n\nexport default patternCharacters;\n","import {IS_ANDROID} from '../../environment/userAgent';\nimport createArray from '../array/createArray';\nimport cacheCallback from '../cacheCallback';\nimport replaceNonNumber from '../string/replaceNonNumber';\nimport {CARD_BRANDS, detectCardBrand} from './cardBrands';\nimport patternCharacters from './patternCharacters';\n\nconst digit = patternCharacters.digit;\nconst capitalCharacter = patternCharacters.capitalCharacter;\nconst spaceCharacter = patternCharacters.formattingCharacter(' ');\nconst yearOptionalPattern = patternCharacters.optionalPattern(/\\d\\d/);\nconst sixteenPattern = [digit, digit, digit, digit, spaceCharacter, digit, digit, digit, digit, digit, digit, spaceCharacter, digit, digit, digit, digit, digit];\nconst fifteenPattern = [digit, digit, digit, digit, spaceCharacter, digit, digit, digit, digit, digit, digit, spaceCharacter, digit, digit, digit, digit];\n\nconst requiredPostcodes = new Set(['DZ', 'AR', 'AM', 'AU', 'AT', 'AZ', 'PT', 'BD', 'BY', 'BE', 'BA', 'BR', 'BN', 'BG', 'CA', 'IC', 'CN', 'CO', 'HR', 'CY', 'CZ', 'DK', 'EC', 'GB', 'EE', 'FO', 'FI', 'FR', 'GE', 'DE', 'GR', 'GL', 'GU', 'GG', 'NL', 'HU', 'IN', 'ID', 'IL', 'IT', 'JP', 'JE', 'KZ', 'KR', 'FM', 'KG', 'LV', 'LI', 'LT', 'LU', 'MK', 'MG', 'PT', 'MY', 'MH', 'MQ', 'YT', 'MX', 'MN', 'ME', 'NL', 'NZ', 'GB', 'NO', 'PK', 'PH', 'PL', 'FM', 'PT', 'PR', 'RE', 'RU', 'SA', 'SF', 'RS', 'SG', 'SK', 'SI', 'ZA', 'ES', 'LK', 'SX', 'VI', 'VI', 'SE', 'CH', 'TW', 'TJ', 'TH', 'TU', 'TN', 'TR', 'TM', 'VI', 'UA', 'GB', 'US', 'UY', 'UZ', 'VA', 'VN', 'GB', 'FM']);\n\nconst generateFourPattern = cacheCallback((length: number) => {\n  const out: Array<typeof digit | typeof spaceCharacter> = [];\n\n  for(let i = 0, k = 0; i < length;) {\n    if(k === 4) {\n      out.push(spaceCharacter);\n      k = 0;\n    } else {\n      out.push(digit);\n      ++i;\n      ++k;\n    }\n  }\n\n  return out;\n});\n\nfunction generateCardNumberPattern(card: string) {\n  const brand = detectCardBrand(card);\n  if(brand === 'amex') return sixteenPattern;\n  if(brand === 'diners14') return fifteenPattern;\n  const {minLength, maxLength} = CARD_BRANDS[brand];\n  const s = replaceNonNumber(card).length;\n  const d = Math.min(Math.max(minLength, s), maxLength);\n  return generateFourPattern(d);\n}\n\nconst cardFormattingPatterns = {\n  cardNumber: generateCardNumberPattern,\n  cardExpiry: () => [patternCharacters.month, patternCharacters.formattingCharacter('/'), digit, digit, yearOptionalPattern],\n  cardCvc: (card?: string) => cardFormattingPatterns.cardCvcFromBrand(detectCardBrand(card)),\n  cardCvcFromBrand: cacheCallback((brand: string) => {\n    const info = CARD_BRANDS[brand];\n    const {cvcMinLength, cvcMaxLength} = info;\n    const pattern = createArray(cvcMinLength || cvcMaxLength, digit);\n    if(cvcMinLength && cvcMinLength < cvcMaxLength) {\n      const i = cvcMaxLength - cvcMinLength;\n      const h = patternCharacters.optionalPattern(/\\d/);\n      if(i) {\n        pattern.push(...createArray(i, h));\n      }\n    }\n\n    return pattern;\n  }),\n  postalCodeFromCountry: cacheCallback((iso2: string) => {\n    switch(iso2) {\n      case 'US':\n        return createArray(5, digit);\n      case 'CA':\n        return IS_ANDROID ? null : [capitalCharacter, capitalCharacter, capitalCharacter, spaceCharacter, capitalCharacter, capitalCharacter, capitalCharacter];\n      default:\n        const optionalDigits = createArray(10, patternCharacters.optionalPattern(/\\d/));\n        if(requiredPostcodes.has(iso2)) {\n          optionalDigits[0] = digit;\n        }\n        return optionalDigits;\n    }\n  })\n};\n\nexport default cardFormattingPatterns;\n","import accumulate from '../array/accumulate';\nimport {PatternFunction} from './patternCharacters';\n\nfunction accumulateLengths(strs: string[]) {\n  return accumulate(strs.map((str) => str.length), 0);\n}\n\nfunction formatValueByPattern(\n  getPattern: PatternFunction,\n  value: string,\n  options: Partial<{\n    selectionStart: number,\n    selectionEnd: number\n  }> = {},\n  pushRest?: boolean\n) {\n  const pattern = getPattern(value);\n\n  if(!pattern) {\n    return {\n      value: value,\n      selection: null as typeof options,\n      autocorrectComplete: !!value\n    };\n  }\n\n  const length = pattern.length;\n  const c: string[] = [];\n  const s: string[] = [];\n\n  let l = 0;\n  let i = 0;\n  let f = options.selectionStart === 0 ? 0 : null;\n  let d = options.selectionEnd === 0 ? 0 : null;\n  const p = () => {\n    if(f === null && (i + 1) >= options.selectionStart) f = accumulateLengths(c) + (pushRest ? s.length : 0);\n    if(d === null && (i + 1) >= options.selectionEnd) d = accumulateLengths(c) + (pushRest ? s.length : 0);\n  };\n  const m = (e: number) => {\n    if(e > 0) {\n      p();\n      i += e;\n    }\n  };\n\n  for(; l < length;) {\n    const getCharacter = pattern[l];\n    const character = getCharacter(value.slice(i));\n    const {type, result, consumed} = character;\n    if(type === 'required') {\n      if(result) {\n        c.push(...s, result);\n        s.length = 0;\n        ++l;\n\n        if(character.partial) {\n          m(value.length - i);\n          break;\n        }\n\n        m(consumed);\n      } else {\n        if(!consumed) {\n          break;\n        }\n\n        m(1);\n      }\n    } else if(type === 'optional') {\n      if(result) {\n        c.push(...s, result);\n        s.length = 0;\n        m(consumed);\n      }\n\n      ++l;\n    } else if(type === 'formatting') {\n      if(!pushRest && i >= value.length) {\n        break;\n      }\n\n      s.push(result);\n      ++l;\n      m(consumed);\n    }\n  }\n\n  if(pushRest) {\n    c.push(...s);\n  }\n\n  return {\n    value: c.join(''),\n    selection: {\n      selectionStart: f === null || value.length && options.selectionStart === value.length ? accumulateLengths(c) : f,\n      selectionEnd: d === null || value.length && options.selectionEnd === value.length ? accumulateLengths(c) : d\n    },\n    autocorrectComplete: l === length\n  };\n}\n\nexport default formatValueByPattern;\n","import {CARD_BRANDS, detectCardBrand} from './cardBrands';\nimport formatInputValueByPattern from './formatInputValueByPattern';\nimport NBSP from '../string/nbsp';\nimport replaceNonNumber from '../string/replaceNonNumber';\n\nexport type PatternValidationOptions = Partial<{\n  ignoreIncomplete: boolean\n}>;\n\nconst nbspRegExp = new RegExp(NBSP, 'g');\n\nfunction makeValidationError(code?: string) {\n  return code ? {\n    type: 'invalid',\n    code\n  } : null;\n}\n\n// Luhn algorithm\nfunction validateCompleteCardNumber(card: string) {\n  const t = '0'.charCodeAt(0);\n  const n = card.length % 2;\n  let a = 0;\n  for(let i = card.length - 1; i >= 0; --i) {\n    const c = n === (i % 2);\n    let o = card.charCodeAt(i) - t;\n    if(c) o *= 2;\n    if(o > 9) o -= 9;\n    a += o;\n  }\n  return !(a % 10);\n}\n\nfunction validateExpiry(year: number, month: number, options?: PatternValidationOptions) {\n  const date = new Date(Date.now());\n  const _year = year < 100 ? date.getFullYear() % 100 : date.getFullYear();\n  const nextMonth = date.getMonth() + 1;\n\n  if(isNaN(year) || isNaN(month)) {\n    return options?.ignoreIncomplete ? null : 'incomplete';\n  }\n\n  if((year - _year) < 0) {\n    return 'invalid_expiry_year_past';\n  }\n\n  if((year - _year) > 50) {\n    return 'invalid_expiry_year';\n  }\n\n  return !(year - _year) && month < nextMonth ? 'invalid_expiry_month_past' : null;\n}\n\nfunction getCardInfoByNumber(card: string) {\n  const sanitized = replaceNonNumber(card);\n  const brand = detectCardBrand(card);\n  return {\n    sanitized,\n    brand,\n    minLength: CARD_BRANDS[brand].minLength\n  };\n}\n\nfunction makeCardNumberError(str: string, length: number, ignoreIncomplete: boolean) {\n  if(str.length >= length) {\n    return validateCompleteCardNumber(str) || detectCardBrand(str) === 'mir' ? null : makeValidationError('invalid');\n  }\n\n  return ignoreIncomplete ? null : makeValidationError('incomplete');\n}\n\nexport function validateCardNumber(str: string, options: PatternValidationOptions = {}) {\n  const {sanitized, minLength} = getCardInfoByNumber(str);\n  return makeCardNumberError(sanitized, minLength, options.ignoreIncomplete);\n}\n\nexport function validateCardExpiry(str: string, options: PatternValidationOptions = {}) {\n  const sanitized = str.replace(nbspRegExp, '').split(/ ?\\/ ?/);\n  const [monthStr, yearStr = ''] = sanitized;\n  const [month, year] = [monthStr, yearStr].map((str) => +str);\n  const s = yearStr.length === 2 ? year % 100 : year;\n  return yearStr.length < 2 || yearStr.length === 3 ? (options.ignoreIncomplete ? null : makeValidationError('incomplete')) : makeValidationError(validateExpiry(s, month, options));\n}\n\nexport function validateAnyIncomplete(formatted: ReturnType<typeof formatInputValueByPattern>, str: string, options: PatternValidationOptions = {}) {\n  return formatted.meta.autocorrectComplete || options.ignoreIncomplete ? null : makeValidationError('incomplete');\n}\n","const NBSP = '';\nexport default NBSP;\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport PopupElement from '.';\nimport appImManager from '../../lib/appManagers/appImManager';\nimport {TelegramWebviewEventCallback} from '../../types';\n\nconst weakMap: WeakMap<Window, TelegramWebviewEventCallback> = new WeakMap();\nwindow.addEventListener('message', (e) => {\n  const callback = weakMap.get(e.source as Window);\n  if(!callback) {\n    return;\n  }\n\n  callback(JSON.parse(e.data));\n});\n\nexport function createVerificationIframe(url: string, callback: TelegramWebviewEventCallback) {\n  const iframe = document.createElement('iframe');\n  // iframe.title = 'Complete Payment';\n  iframe.allow = 'payment';\n  // iframe.setAttribute('sandbox', 'allow-forms allow-scripts allow-same-origin allow-top-navigation allow-modals');\n  iframe.setAttribute('sandbox', 'allow-forms allow-scripts allow-same-origin allow-modals');\n  iframe.classList.add('payment-verification');\n  iframe.src = url;\n\n  iframe.addEventListener('load', () => {\n    weakMap.set(iframe.contentWindow, callback);\n  }, {once: true});\n\n  return iframe;\n}\n\nexport default class PopupPaymentVerification extends PopupElement<{\n  finish: () => void\n}> {\n  constructor(private url: string) {\n    super('popup-payment popup-payment-verification', {\n      closable: true,\n      overlayClosable: true,\n      body: true,\n      title: 'Checkout.WebConfirmation.Title'\n    });\n\n    this.d();\n  }\n\n  private d() {\n    const iframe = createVerificationIframe(this.url, (event) => {\n      if(event.eventType !== 'web_app_open_tg_link') {\n        return;\n      }\n\n      this.dispatchEvent('finish');\n      this.hide();\n      appImManager.openUrl('https://t.me' + event.eventData.path_full);\n    });\n\n    this.body.append(iframe);\n    this.show();\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport PopupElement from '.';\nimport cardFormattingPatterns from '../../helpers/cards/cardFormattingPatterns';\nimport {detectUnifiedCardBrand} from '../../helpers/cards/cardBrands';\nimport formatInputValueByPattern from '../../helpers/cards/formatInputValueByPattern';\nimport {validateAnyIncomplete, validateCardExpiry, validateCardNumber} from '../../helpers/cards/validateCard';\nimport placeCaretAtEnd from '../../helpers/dom/placeCaretAtEnd';\nimport {renderImageFromUrlPromise} from '../../helpers/dom/renderImageFromUrl';\nimport noop from '../../helpers/noop';\nimport {PaymentsPaymentForm} from '../../layer';\nimport {LangPackKey, _i18n} from '../../lib/langPack';\nimport {TelegramWebviewEvent} from '../../types';\nimport CheckboxField from '../checkboxField';\nimport confirmationPopup from '../confirmationPopup';\nimport CountryInputField from '../countryInputField';\nimport InputField, {InputFieldOptions, InputState} from '../inputField';\nimport Row from '../row';\nimport {SettingSection} from '../sidebarLeft';\nimport {getPaymentBrandIconPath, PaymentButton, PaymentsCredentialsToken} from './payment';\nimport {createVerificationIframe} from './paymentVerification';\n\nexport type PaymentCardDetails = {\n  cardNumber: string;\n  cardholderName: string;\n  expiryFull: string;\n  expiryMonth: string;\n  expiryYear: string;\n  cvc: string;\n  country: string;\n  zip: string;\n  save?: boolean;\n};\n\nexport type PaymentCardDetailsShort = {\n  title: string,\n  save?: boolean;\n  icon?: string;\n};\n\nexport type PaymentCardDetailsResult = PaymentCardDetails | PaymentCardDetailsShort;\n\nexport class InputFieldCorrected extends InputField {\n  private lastKeyDown: string;\n  private lastTransformed: ReturnType<typeof formatInputValueByPattern>;\n\n  constructor(public options: InputFieldOptions & {\n    formatMethod: typeof cardFormattingPatterns['cardNumber'],\n    validateMethod?: typeof validateCardNumber,\n    errorKeys?: {[code: string]: LangPackKey},\n    optional?: boolean,\n    onChange?: (transformed: InputFieldCorrected['lastTransformed']) => void,\n    onKeyDown?: (e: KeyboardEvent) => void\n  }) {\n    super(options);\n\n    // const handleIncomplete = (t?: any) => {\n    //   if(\n    //     (!lastTransformed.value && t) ||\n    //     lastTransformed.meta.autocorrectComplete ||\n    //     lastTransformed.meta.error ||\n    //     optional\n    //   ) {\n    //     return;\n    //   }\n\n\n    // };\n\n    this.input.addEventListener('keydown', this.onKeyDown);\n    this.input.addEventListener('input', this.onInput);\n    this.input.addEventListener('blur', this.onBlur);\n  }\n\n  private onKeyDown = (e: KeyboardEvent) => {\n    this.lastKeyDown = e.key;\n    this.options.onKeyDown?.(e);\n  };\n\n  private onInput = () => {\n    const value = this.value;\n    const deleting = this.lastKeyDown === 'Backspace' && (((this.lastTransformed && this.lastTransformed.value.length) || 0) - value.length) === 1;\n    const result = this.lastTransformed = formatInputValueByPattern({\n      value: value,\n      getPattern: this.options.formatMethod,\n      deleting,\n      input: this.input\n    });\n\n    const transformedValue = result.value;\n    if(transformedValue !== value) {\n      this.setValueSilently(transformedValue);\n\n      if(result.selection) {\n        (this.input as HTMLInputElement).selectionStart = result.selection.selectionStart;\n        (this.input as HTMLInputElement).selectionEnd = result.selection.selectionEnd;\n      }\n    }\n\n    this.validateNew(transformedValue, {ignoreIncomplete: true/* !result.meta.autocorrectComplete */});\n\n    this.options.onChange?.(result);\n  };\n\n  private onBlur = () => {\n    const value = this.lastTransformed?.value;\n    if(value) {\n      this.validateNew(value);\n    }\n  };\n\n  public update() {\n    this.onInput();\n  }\n\n  public validate = () => {\n    return this.validateNew();\n  };\n\n  public validateNew(\n    value = this.lastTransformed?.value ?? '',\n    t: any = {},\n    justReturn?: boolean\n  ) {\n    let result: ReturnType<InputFieldCorrected['options']['validateMethod']>;\n    if(this.options.validateMethod) {\n      result = this.options.validateMethod?.(value, t);\n    } else {\n      result = validateAnyIncomplete(this.lastTransformed, value, t);\n    }\n\n    if(result?.code) {\n      const langPackKey: LangPackKey = this.options.errorKeys?.[result.code];\n      !justReturn && this.setState(InputState.Error, langPackKey);\n      return false;\n    }\n\n    !justReturn && this.setState(InputState.Neutral);\n    return true;\n  }\n}\n\nexport function handleInputFieldsOnChange(inputFields: (CountryInputField | InputField | InputFieldCorrected)[], _onChange: (valid: boolean) => void) {\n  const onChange = () => {\n    const valid = inputFields.every((inputField) => {\n      return 'validateNew' in inputField ? inputField.validateNew(undefined, undefined, true) : inputField.isValid();\n    });\n\n    _onChange(valid);\n  };\n\n  inputFields.forEach((inputField) => {\n    if(inputField instanceof InputFieldCorrected) {\n      const original = inputField.options.onChange;\n      inputField.options.onChange = (...args: any[]) => {\n        // @ts-ignore\n        original?.(...args);\n        onChange();\n      };\n\n      if('update' in inputField) {\n        inputField.update();\n      }\n    } else {\n      inputField.input.addEventListener('input', onChange);\n    }\n  });\n\n  return {validate: onChange};\n}\n\nexport function createCountryZipFields(country?: boolean, zip?: boolean) {\n  let countryInputField: CountryInputField, postcodeInputField: InputFieldCorrected;\n  if(country || zip) {\n    if(country) countryInputField = new CountryInputField({\n      noPhoneCodes: true,\n      onCountryChange: () => {\n        postcodeInputField?.update();\n      },\n      required: true,\n      autocomplete: 'country'\n    });\n    if(zip) postcodeInputField = new InputFieldCorrected({\n      label: 'PaymentShippingZipPlaceholder',\n      plainText: true,\n      inputMode: 'numeric',\n      autocomplete: 'postal-code',\n      formatMethod: (/* ...args */) => {\n        const {country} = countryInputField.getSelected();\n        const iso2 = country?.iso2;\n        return cardFormattingPatterns.postalCodeFromCountry(iso2 && iso2.toUpperCase());\n      }\n    });\n  }\n\n  return {countryInputField, postcodeInputField};\n}\n\nexport type PaymentsNativeProvider = 'stripe' | 'smartglocal';\nexport type PaymentsNativeParams = {\n  need_country?: boolean,\n  need_zip?: boolean,\n  need_cardholder_name?: boolean,\n  publishable_key?: string, // stripe\n  public_token?: string, // smartglocal\n  gpay_params: string,\n};\nconst SUPPORTED_NATIVE_PROVIDERS: Set<PaymentsNativeProvider> = new Set(['stripe', 'smartglocal']);\n\nexport default class PopupPaymentCard extends PopupElement<{\n  finish: (obj: {token: any, card: PaymentCardDetailsResult}) => void\n}> {\n  constructor(private paymentForm: PaymentsPaymentForm, private savedCard?: PaymentCardDetails) {\n    super('popup-payment popup-payment-card', {\n      closable: true,\n      overlayClosable: true,\n      body: true,\n      scrollable: SUPPORTED_NATIVE_PROVIDERS.has(paymentForm.native_provider as PaymentsNativeProvider),\n      title: 'PaymentCardInfo'\n    });\n\n    if(SUPPORTED_NATIVE_PROVIDERS.has(paymentForm.native_provider as PaymentsNativeProvider)) {\n      this.d();\n    } else {\n      const iframe = createVerificationIframe(paymentForm.url, (event) => {\n        if(event.eventType !== 'payment_form_submit') {\n          return;\n        }\n\n        const data = event.eventData;\n\n        const cardOut = {title: data.title, save: false} as any as PaymentCardDetails;\n        this.dispatchEvent('finish', {\n          token: data.credentials,\n          card: cardOut\n        });\n\n        this.hide();\n\n        if(paymentForm.pFlags.can_save_credentials) {\n          confirmationPopup({\n            titleLangKey: 'PaymentCardSavePaymentInformation',\n            descriptionLangKey: 'PaymentCardSavePaymentInformationInfoLine1',\n            button: {\n              langKey: 'Save'\n            }\n          }).then(() => {\n            cardOut.save = true;\n          }, noop);\n        }\n      });\n\n      // putPreloader(this.body, true);\n      this.body.append(iframe);\n      this.show();\n    }\n  }\n\n  private d() {\n    const savedCard = this.savedCard;\n    const cardSection = new SettingSection({name: 'PaymentInfo.Card.Title', noDelimiter: true, noShadow: true});\n\n    const nativeParams: PaymentsNativeParams = JSON.parse(this.paymentForm.native_params.data);\n\n    let lastBrand: string, brandIconTempId = 0, lastBrandImg: HTMLImageElement;\n    const setBrandIcon = (brand: string) => {\n      if(lastBrand === brand) {\n        return;\n      }\n\n      const tempId = ++brandIconTempId;\n      lastBrand = brand;\n\n      const path = getPaymentBrandIconPath(brand);\n      if(!path) {\n        if(lastBrandImg) {\n          lastBrandImg.remove();\n          lastBrandImg = undefined;\n        }\n\n        return;\n      }\n\n      const img = new Image();\n      img.classList.add('input-field-icon');\n      renderImageFromUrlPromise(img, path, false).then(() => {\n        if(brandIconTempId !== tempId) {\n          return;\n        }\n\n        if(lastBrandImg) {\n          lastBrandImg.replaceWith(img);\n        } else {\n          cardInputField.container.append(img);\n        }\n\n        lastBrandImg = img;\n      });\n    };\n    const cardInputField = new InputFieldCorrected({\n      label: 'PaymentCardNumber',\n      plainText: true,\n      inputMode: 'numeric',\n      autocomplete: 'cc-number',\n      formatMethod: cardFormattingPatterns.cardNumber,\n      validateMethod: validateCardNumber,\n      errorKeys: {\n        invalid: 'PaymentCard.Error.Invalid',\n        incomplete: 'PaymentCard.Error.Incomplete'\n      },\n      onChange: (transformed) => {\n        setBrandIcon(detectUnifiedCardBrand(transformed.value));\n        cvcInputField.update(); // format cvc\n      }\n    });\n\n    let nameInputField: InputField;\n    if(nativeParams.need_cardholder_name) nameInputField = new InputField({\n      label: 'Checkout.NewCard.CardholderNamePlaceholder',\n      maxLength: 255,\n      required: true,\n      autocomplete: 'cc-name'\n    });\n\n    const expireInputField = new InputFieldCorrected({\n      label: 'SecureId.Identity.Placeholder.ExpiryDate',\n      plainText: true,\n      inputMode: 'numeric',\n      autocomplete: 'cc-exp',\n      formatMethod: cardFormattingPatterns.cardExpiry,\n      validateMethod: validateCardExpiry\n    });\n\n    const cvcInputField = new InputFieldCorrected({\n      labelText: 'CVC',\n      plainText: true,\n      inputMode: 'numeric',\n      autocomplete: 'cc-csc',\n      formatMethod: () => cardFormattingPatterns.cardCvc(cardInputField.value)\n      // validateMethod: (...args) => _5AH3.a.cardCvc(cardInputField.value)(...args)\n    });\n\n    const switchFocusOrder: (InputFieldCorrected | InputField)[] = [\n      cardInputField,\n      expireInputField,\n      cvcInputField,\n      nameInputField\n    ].filter(Boolean);\n    switchFocusOrder.forEach((inputField) => {\n      const onKeyDown = (e: KeyboardEvent) => {\n        if(!inputField.value && e.key === 'Backspace') {\n          const previousInputField = switchFocusOrder[switchFocusOrder.indexOf(inputField) - 1];\n          if(previousInputField) {\n            // previousInputField.value = previousInputField.value.slice(0, -1);\n            placeCaretAtEnd(previousInputField.input, true);\n          }\n        }\n      };\n\n      if(inputField instanceof InputFieldCorrected) {\n        inputField.options.onKeyDown = onKeyDown;\n\n        const original = inputField.options.onChange;\n        inputField.options.onChange = (transformed) => {\n          original?.(transformed);\n\n          if(document.activeElement === inputField.input && transformed.meta.autocorrectComplete) {\n            for(let i = switchFocusOrder.indexOf(inputField), length = switchFocusOrder.length; i < length; ++i) {\n              const nextInputField = switchFocusOrder[i];\n              if(\n                nextInputField instanceof InputFieldCorrected ?\n                !nextInputField.validateNew(undefined, undefined, true) :\n                !nextInputField.value\n              ) {\n                placeCaretAtEnd(nextInputField.input, true);\n                break;\n              }\n            }\n          }\n        };\n      } else {\n        inputField.input.addEventListener('keydown', onKeyDown);\n      }\n    });\n\n    const inputFieldsRow = document.createElement('div');\n    inputFieldsRow.classList.add('input-fields-row');\n    inputFieldsRow.append(expireInputField.container, cvcInputField.container);\n\n    cardSection.content.append(...[\n      cardInputField.container,\n      inputFieldsRow,\n      nameInputField?.container\n    ].filter(Boolean));\n\n    let billingSection: SettingSection;\n    // let saveCheckboxField: CheckboxField;\n    const {countryInputField, postcodeInputField} = createCountryZipFields(nativeParams.need_country, nativeParams.need_zip);\n    if(nativeParams.need_country || nativeParams.need_zip) {\n      billingSection = new SettingSection({name: 'PaymentInfo.Billing.Title', noDelimiter: true, noShadow: true});\n\n      // const inputFieldsRow2 = inputFieldsRow.cloneNode() as HTMLElement;\n      // inputFieldsRow2.append(countryInputField.container, postcodeInputField.container);\n      // billingSection.content.append(inputFieldsRow2);\n      billingSection.content.append(...[countryInputField, postcodeInputField].filter(Boolean).map((i) => i.container));\n    }\n\n    const canSave = !!this.paymentForm.pFlags.can_save_credentials;\n    const saveCheckboxField = new CheckboxField({\n      text: 'PaymentCardSavePaymentInformation',\n      checked: !!canSave\n    });\n    const saveRow = new Row({\n      checkboxField: saveCheckboxField,\n      subtitleLangKey: canSave ? 'PaymentCardSavePaymentInformationInfoLine1' : 'Checkout.2FA.Text',\n      noCheckboxSubtitle: true\n    });\n\n    if(!canSave) {\n      saveRow.container.classList.add('is-disabled');\n    }\n\n    (billingSection || cardSection).content.append(saveRow.container);\n\n    this.scrollable.append(...[cardSection, billingSection].filter(Boolean).map((s) => s.container));\n\n    const payButton = PaymentButton({\n      key: 'PaymentInfo.Done',\n      onClick: async() => {\n        const data: PaymentCardDetails = {\n          cardNumber: cardInputField.value,\n          expiryFull: expireInputField.value,\n          expiryMonth: expireInputField.value.split('/')[0],\n          expiryYear: expireInputField.value.split('/')[1],\n          cvc: cvcInputField.value,\n\n          cardholderName: nameInputField?.value,\n          country: countryInputField?.value,\n          zip: postcodeInputField?.value,\n\n          save: saveCheckboxField?.checked\n        };\n\n        const nativeProvider: PaymentsNativeProvider = this.paymentForm.native_provider as any;\n        let out: PaymentsCredentialsToken;\n        if(nativeProvider === 'stripe') {\n          const url = new URL('https://api.stripe.com/v1/tokens');\n          url.search = new URLSearchParams({\n            'card[number]': data.cardNumber,\n            'card[exp_month]': data.expiryMonth,\n            'card[exp_year]': data.expiryYear,\n            'card[cvc]': data.cvc,\n            'card[address_zip]': data.zip,\n            'card[address_country]': data.country,\n            'card[name]': data.cardholderName\n          }).toString();\n\n          const response = await fetch(url.toString(), {\n            method: 'POST',\n            credentials: 'same-origin',\n            headers: {\n              'Content-Type': 'application/x-www-form-urlencoded',\n              'Authorization': `Bearer ${nativeParams.publishable_key}`\n            }\n          });\n\n          out = await response.json();\n        } else if(nativeProvider === 'smartglocal') {\n          const params = {\n            card: {\n              number: data.cardNumber.replace(/[^\\d]+/g, ''),\n              expiration_month: data.expiryMonth,\n              expiration_year: data.expiryYear,\n              security_code: data.cvc.replace(/[^\\d]+/g, '')\n            }\n          };\n\n          const url = /* DEBUG_PAYMENT_SMART_GLOCAL */false ?\n            'https://tgb-playground.smart-glocal.com/cds/v1/tokenize/card' :\n            'https://tgb.smart-glocal.com/cds/v1/tokenize/card';\n\n          const response = await fetch(url, {\n            method: 'POST',\n            headers: {\n              'Accept': 'application/json',\n              'Content-Type': 'application/json',\n              'X-PUBLIC-TOKEN': nativeParams.public_token\n            },\n            body: JSON.stringify(params)\n          });\n\n          const json: { // smartglocal\n            data: {\n              info: {\n                card_network: string,\n                card_type: string,\n                masked_card_number: string\n              },\n              token: string\n            },\n            status: 'ok'\n          } = await response.json();\n\n          out = {type: 'card', token: json.data.token}\n        }\n\n        this.dispatchEvent('finish', {token: out, card: data});\n        this.hide();\n      }\n    });\n\n    const inputFields = ([\n      cardInputField,\n      nameInputField,\n      expireInputField,\n      cvcInputField,\n      countryInputField,\n      postcodeInputField\n    ] as const).filter(Boolean);\n    handleInputFieldsOnChange(inputFields, (valid) => {\n      payButton.disabled = !valid;\n      // payButton.classList.toggle('btn-disabled', !valid);\n    });\n\n    if(savedCard) {\n      cardInputField.value = savedCard.cardNumber;\n      expireInputField.value = savedCard.expiryFull;\n      cvcInputField.value = savedCard.cvc;\n      nameInputField && (nameInputField.value = savedCard.cardholderName);\n      countryInputField && (countryInputField.value = savedCard.country);\n      postcodeInputField && (postcodeInputField.value = savedCard.zip);\n    }\n\n    this.body.append(this.btnConfirmOnEnter = payButton);\n\n    this.show();\n\n    if(!cardInputField.validateNew(undefined, undefined, true)) {\n      placeCaretAtEnd(cardInputField.input);\n    }\n  }\n}\n","import formatValueByPattern from './formatValueByPattern';\n\nexport default function formatInputValueByPattern(options: {\n  value: string,\n  getPattern: Parameters<typeof formatValueByPattern>[0],\n  deleting?: boolean,\n  input?: HTMLElement\n}) {\n  const {value: originalValue, getPattern, deleting, input} = options;\n  const pushRest = !deleting && !!originalValue.length;\n  const result = formatValueByPattern(getPattern, originalValue, {\n    selectionStart: input ? (input as HTMLInputElement).selectionStart : 0,\n    selectionEnd: input ? (input as HTMLInputElement).selectionEnd : 0\n  }, pushRest)\n  const {value, selection} = result;\n\n  return {\n    value,\n    meta: {\n      autocorrectComplete: result.autocorrectComplete,\n      empty: !value\n    },\n    selection\n  };\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport PopupElement from '.';\nimport placeCaretAtEnd from '../../helpers/dom/placeCaretAtEnd';\nimport {AccountPassword, AccountTmpPassword} from '../../layer';\nimport {InputState} from '../inputField';\nimport PasswordInputField from '../passwordInputField';\nimport {SettingSection} from '../sidebarLeft';\nimport {PaymentButton} from './payment';\n\nexport default class PopupPaymentCardConfirmation extends PopupElement<{\n  finish: (tmpPassword: AccountTmpPassword) => void\n}> {\n  constructor(card: string, passwordState: AccountPassword) {\n    super('popup-payment popup-payment-card-confirmation', {\n      closable: true,\n      overlayClosable: true,\n      body: true,\n      scrollable: true,\n      title: 'Checkout.PasswordEntry.Title'\n    });\n\n    const section = new SettingSection({noDelimiter: true, noShadow: true, caption: 'Checkout.PasswordEntry.Text', captionArgs: [card]});\n    const passwordInputField = new PasswordInputField({labelText: passwordState.hint});\n    section.content.append(passwordInputField.container);\n    this.scrollable.append(section.container);\n\n    const onInput = () => {\n      payButton.disabled = !passwordInputField.value;\n      passwordInputField.setState(InputState.Neutral);\n    };\n\n    passwordInputField.input.addEventListener('input', onInput);\n\n    const payButton = PaymentButton({\n      key: 'Checkout.PasswordEntry.Pay',\n      onClick: async() => {\n        try {\n          const inputCheckPassword = await this.managers.passwordManager.getInputCheckPassword(passwordInputField.value, passwordState);\n          const tmpPassword = await this.managers.apiManager.invokeApi('account.getTmpPassword', {\n            password: inputCheckPassword,\n            period: 60\n          });\n\n          this.dispatchEvent('finish', tmpPassword);\n          this.hide();\n        } catch(err) {\n          if((err as ApiError).type === 'PASSWORD_HASH_INVALID') {\n            (err as ApiError).handled = true;\n            passwordInputField.setError('PASSWORD_HASH_INVALID');\n          }\n\n          throw err;\n        }\n      }\n    });\n    this.body.append(this.btnConfirmOnEnter = payButton);\n\n    onInput();\n\n    this.show();\n\n    placeCaretAtEnd(passwordInputField.input);\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport PopupElement from '.';\nimport placeCaretAtEnd from '../../helpers/dom/placeCaretAtEnd';\nimport {InputInvoice, PaymentRequestedInfo, PaymentsPaymentForm, PaymentsValidatedRequestedInfo} from '../../layer';\nimport matchEmail from '../../lib/richTextProcessor/matchEmail';\nimport CheckboxField from '../checkboxField';\nimport CountryInputField from '../countryInputField';\nimport InputField from '../inputField';\nimport Row from '../row';\nimport {SettingSection} from '../sidebarLeft';\nimport TelInputField from '../telInputField';\nimport {PaymentButton} from './payment';\nimport {createCountryZipFields, handleInputFieldsOnChange, InputFieldCorrected} from './paymentCard';\n\nexport type PaymentShippingAddress = PaymentRequestedInfo;\n\ntype ShippingFocusField = 'name' | 'email' | 'phone';\n\nexport default class PopupPaymentShipping extends PopupElement<{\n  finish: (o: {shippingAddress: PaymentShippingAddress, requestedInfo: PaymentsValidatedRequestedInfo}) => void\n}> {\n  constructor(\n    private paymentForm: PaymentsPaymentForm,\n    private inputInvoice: InputInvoice,\n    private focus?: ShippingFocusField\n  ) {\n    super('popup-payment popup-payment-shipping', {\n      closable: true,\n      overlayClosable: true,\n      body: true,\n      scrollable: true,\n      title: 'PaymentShippingInfo'\n    });\n\n    this.d();\n  }\n\n  private d() {\n    const paymentForm = this.paymentForm;\n    const invoice = paymentForm.invoice;\n    const savedInfo = this.paymentForm.saved_info;\n\n    let addressSection: SettingSection,\n      address1InputField: InputField,\n      address2InputField: InputField,\n      cityInputField: InputField,\n      stateInputField: InputField,\n      countryInputField: CountryInputField,\n      postcodeInputField: InputFieldCorrected;\n    if(invoice.pFlags.shipping_address_requested) {\n      addressSection = new SettingSection({name: 'PaymentShippingAddress', noDelimiter: true, noShadow: true});\n      address1InputField = new InputField({label: 'PaymentShippingAddress1Placeholder', maxLength: 64, required: true});\n      address2InputField = new InputField({label: 'PaymentShippingAddress2Placeholder', maxLength: 64});\n      cityInputField = new InputField({label: 'PaymentShippingCityPlaceholder', maxLength: 64, required: true});\n      stateInputField = new InputField({label: 'PaymentShippingStatePlaceholder', maxLength: 64});\n      const res = createCountryZipFields(true, true);\n      countryInputField = res.countryInputField;\n      postcodeInputField = res.postcodeInputField;\n\n      addressSection.content.append(...[\n        address1InputField,\n        address2InputField,\n        cityInputField,\n        stateInputField,\n        countryInputField,\n        postcodeInputField\n      ].filter(Boolean).map((inputField) => inputField.container));\n    }\n\n    let receiverSection: SettingSection;\n    let nameInputField: InputField, emailInputField: InputField, telInputField: TelInputField;\n    if([invoice.pFlags.name_requested, invoice.pFlags.email_requested, invoice.pFlags.phone_requested].includes(true)) {\n      receiverSection = new SettingSection({name: 'PaymentShippingReceiver', noDelimiter: true, noShadow: true});\n\n      const validateEmail = () => {\n        const value = emailInputField.value;\n        const match = matchEmail(value);\n        if(!match || match[0].length !== value.length) {\n          return false;\n        }\n\n        return true;\n      };\n\n      const validatePhone = () => {\n        return !!telInputField.value.match(/\\d/);\n      };\n\n      if(invoice.pFlags.name_requested) nameInputField = new InputField({label: 'PaymentShippingName', maxLength: 256, required: true});\n      if(invoice.pFlags.email_requested) emailInputField = new InputField({label: 'PaymentShippingEmailPlaceholder', maxLength: 64, required: true, validate: validateEmail});\n      if(invoice.pFlags.phone_requested) telInputField = new TelInputField({required: true, validate: validatePhone});\n\n      receiverSection.content.append(...[\n        nameInputField,\n        emailInputField,\n        telInputField\n      ].filter(Boolean).map((inputField) => inputField.container));\n    }\n\n    const saveCheckboxField = new CheckboxField({\n      text: 'PaymentShippingSave',\n      checked: true\n    });\n    const saveRow = new Row({\n      checkboxField: saveCheckboxField,\n      subtitleLangKey: 'PaymentShippingSaveInfo',\n      noCheckboxSubtitle: true\n    });\n\n    (receiverSection || addressSection).content.append(saveRow.container);\n\n    this.scrollable.append(...[addressSection, receiverSection].filter(Boolean).map((section) => section.container));\n\n    const payButton = PaymentButton({\n      key: 'PaymentInfo.Done',\n      onClick: async() => {\n        const selectedCountry = countryInputField && countryInputField.getSelected().country;\n        const data: PaymentShippingAddress = {\n          _: 'paymentRequestedInfo',\n          shipping_address: selectedCountry && {\n            _: 'postAddress',\n            street_line1: address1InputField.value,\n            street_line2: address2InputField.value,\n            city: cityInputField.value,\n            state: stateInputField.value,\n            // country: countryInputField.value,\n            country_iso2: selectedCountry?.iso2,\n            post_code: postcodeInputField.value\n          },\n          name: nameInputField?.value,\n          email: emailInputField?.value,\n          phone: telInputField?.value\n        };\n\n        try {\n          const requestedInfo = await this.managers.appPaymentsManager.validateRequestedInfo(this.inputInvoice, data, saveCheckboxField?.checked);\n\n          this.dispatchEvent('finish', {\n            shippingAddress: data,\n            requestedInfo\n          });\n\n          this.hide();\n        } catch(err: any) {\n          const errorMap: {[err: string]: InputField} = {\n            ADDRESS_STREET_LINE1_INVALID: address1InputField,\n            ADDRESS_STREET_LINE2_INVALID: address2InputField,\n            ADDRESS_COUNTRY_INVALID: countryInputField,\n            ADDRESS_CITY_INVALID: cityInputField,\n            ADDRESS_STATE_INVALID: stateInputField,\n            ADDRESS_POSTCODE_INVALID: postcodeInputField,\n\n            REQ_INFO_NAME_INVALID: nameInputField,\n            REQ_INFO_EMAIL_INVALID: emailInputField,\n            REQ_INFO_PHONE_INVALID: telInputField\n          };\n\n          const inputField = errorMap[(err as ApiError).type];\n          if(inputField) {\n            inputField.setError();\n            (err as any).handled = true;\n          }\n\n          throw err;\n        }\n      }\n    });\n    this.body.append(this.btnConfirmOnEnter = payButton);\n\n    if(savedInfo) {\n      const shippingAddress = savedInfo.shipping_address;\n      if(shippingAddress) {\n        address1InputField.value = shippingAddress.street_line1;\n        address2InputField.value = shippingAddress.street_line2;\n        cityInputField.value = shippingAddress.city;\n        stateInputField.value = shippingAddress.state;\n        countryInputField.selectCountryByIso2(shippingAddress.country_iso2);\n        postcodeInputField.value = shippingAddress.post_code;\n      }\n\n      savedInfo.name && nameInputField && (nameInputField.value = savedInfo.name);\n      savedInfo.email && emailInputField && (emailInputField.value = savedInfo.email);\n      savedInfo.phone && telInputField && (telInputField.value = savedInfo.phone);\n    }\n\n    const {validate} = handleInputFieldsOnChange([\n      address1InputField,\n      address2InputField,\n      cityInputField,\n      stateInputField,\n      countryInputField,\n      postcodeInputField,\n      nameInputField,\n      emailInputField,\n      telInputField\n    ].filter(Boolean), (valid) => {\n      payButton.disabled = !valid;\n    });\n\n    validate();\n\n    this.show();\n\n    let focusField: InputField;\n    if(this.focus) {\n      const focusMap: {[field in ShippingFocusField]?: InputField} = {\n        name: nameInputField,\n        email: emailInputField,\n        phone: telInputField\n      };\n\n      focusField = focusMap[this.focus];\n    } else {\n      focusField = address1InputField;\n    }\n\n    if(focusField) {\n      placeCaretAtEnd(focusField.input);\n    }\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport PopupElement from '.';\nimport accumulate from '../../helpers/array/accumulate';\nimport {attachClickEvent} from '../../helpers/dom/clickEvent';\nimport paymentsWrapCurrencyAmount from '../../helpers/paymentsWrapCurrencyAmount';\nimport {PaymentsPaymentForm, PaymentsValidatedRequestedInfo, ShippingOption} from '../../layer';\nimport Button from '../button';\nimport RadioField from '../radioField';\nimport Row, {RadioFormFromRows} from '../row';\nimport {SettingSection} from '../sidebarLeft';\nimport {PaymentButton} from './payment';\n\nexport default class PopupPaymentShippingMethods extends PopupElement<{\n  finish: (shippingOption: ShippingOption) => void\n}> {\n  constructor(\n    private paymentForm: PaymentsPaymentForm,\n    private requestedInfo: PaymentsValidatedRequestedInfo,\n    private shippingOption: ShippingOption\n  ) {\n    super('popup-payment popup-payment-shipping-methods', {\n      closable: true,\n      overlayClosable: true,\n      body: true,\n      scrollable: true,\n      title: 'PaymentShippingMethod'\n    });\n\n    this.d();\n  }\n\n  private d() {\n    const section = new SettingSection({name: 'PaymentCheckoutShippingMethod', noDelimiter: true, noShadow: true});\n\n    const rows = this.requestedInfo.shipping_options.map((shippingOption) => {\n      return new Row({\n        radioField: new RadioField({\n          text: shippingOption.title,\n          name: 'shipping-method',\n          value: shippingOption.id\n        }),\n        subtitle: paymentsWrapCurrencyAmount(\n          accumulate(shippingOption.prices.map(({amount}) => +amount), 0),\n          this.paymentForm.invoice.currency\n        )\n      });\n    });\n\n    let lastShippingId: string;\n    const form = RadioFormFromRows(rows, (value) => {\n      lastShippingId = value;\n    });\n\n    if(this.shippingOption) {\n      rows.find((row) => row.radioField.input.value === this.shippingOption.id).radioField.checked = true;\n    } else {\n      rows[0].radioField.checked = true;\n    }\n\n    section.content.append(form);\n\n    this.scrollable.append(section.container);\n\n    const payButton = PaymentButton({\n      key: 'PaymentInfo.Done',\n      onClick: () => {\n        this.dispatchEvent('finish', this.requestedInfo.shipping_options.find((option) => option.id === lastShippingId));\n        this.hide();\n      }\n    });\n    this.body.append(this.btnConfirmOnEnter = payButton);\n\n    this.show();\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport PopupElement from '.';\nimport Currencies from '../../config/currencies';\nimport {FontFamily, FontSize} from '../../config/font';\nimport accumulate from '../../helpers/array/accumulate';\nimport getTextWidth from '../../helpers/canvas/getTextWidth';\nimport {detectUnifiedCardBrand} from '../../helpers/cards/cardBrands';\nimport {attachClickEvent, simulateClickEvent} from '../../helpers/dom/clickEvent';\nimport findUpAsChild from '../../helpers/dom/findUpAsChild';\nimport findUpClassName from '../../helpers/dom/findUpClassName';\nimport placeCaretAtEnd from '../../helpers/dom/placeCaretAtEnd';\nimport {renderImageFromUrlPromise} from '../../helpers/dom/renderImageFromUrl';\nimport replaceContent from '../../helpers/dom/replaceContent';\nimport setInnerHTML from '../../helpers/dom/setInnerHTML';\nimport toggleDisability from '../../helpers/dom/toggleDisability';\nimport {formatPhoneNumber} from '../../helpers/formatPhoneNumber';\nimport paymentsWrapCurrencyAmount from '../../helpers/paymentsWrapCurrencyAmount';\nimport ScrollSaver from '../../helpers/scrollSaver';\nimport tsNow from '../../helpers/tsNow';\nimport {AccountTmpPassword, InputInvoice, InputPaymentCredentials, LabeledPrice, Message, MessageMedia, PaymentRequestedInfo, PaymentSavedCredentials, PaymentsPaymentForm, PaymentsPaymentReceipt, PaymentsValidatedRequestedInfo, PostAddress, ShippingOption} from '../../layer';\nimport I18n, {i18n, LangPackKey, _i18n} from '../../lib/langPack';\nimport wrapEmojiText from '../../lib/richTextProcessor/wrapEmojiText';\nimport wrapRichText from '../../lib/richTextProcessor/wrapRichText';\nimport rootScope from '../../lib/rootScope';\nimport AvatarElement from '../avatar';\nimport Button from '../button';\nimport CheckboxField from '../checkboxField';\nimport PeerTitle from '../peerTitle';\nimport {putPreloader} from '../putPreloader';\nimport Row from '../row';\nimport {toastNew} from '../toast';\nimport {wrapPhoto} from '../wrappers';\nimport wrapPeerTitle from '../wrappers/peerTitle';\nimport PopupPaymentCard, {PaymentCardDetails, PaymentCardDetailsResult} from './paymentCard';\nimport PopupPaymentCardConfirmation from './paymentCardConfirmation';\nimport PopupPaymentShipping, {PaymentShippingAddress} from './paymentShipping';\nimport PopupPaymentShippingMethods from './paymentShippingMethods';\nimport PopupPaymentVerification from './paymentVerification';\n\nconst iconPath = 'assets/img/';\nconst icons = [\n  'amex',\n  'card',\n  'diners',\n  'discover',\n  'jcb',\n  'mastercard',\n  'visa',\n  'unionpay',\n  'mir',\n  'logo'\n];\n\nexport function getPaymentBrandIconPath(brand: string) {\n  if(!icons.includes(brand)) {\n    return;\n  }\n\n  return `${iconPath}${brand}.svg`;\n}\n\nexport function PaymentButton(options: {\n  onClick: () => Promise<any> | void,\n  key?: LangPackKey,\n  textEl?: I18n.IntlElement\n}) {\n  const textEl = options.textEl ?? new I18n.IntlElement({key: options.key ?? 'PaymentInfo.Done'});\n  const key = textEl.key;\n  const payButton = Button('btn-primary btn-color-primary payment-item-pay');\n  payButton.append(textEl.element);\n  attachClickEvent(payButton, async() => {\n    const result = options.onClick();\n    if(!(result instanceof Promise)) {\n      return;\n    }\n\n    const d = putPreloader(payButton);\n    const toggle = toggleDisability([payButton], true);\n    textEl.compareAndUpdate({key: 'PleaseWait'});\n    try {\n      await result;\n    } catch(err) {\n      if(!(err as any).handled) {\n        console.error('payment button error', err);\n      }\n\n      toggle();\n      textEl.compareAndUpdate({key});\n      d.remove();\n    }\n  });\n  return payButton;\n}\n\nexport type PaymentsCredentialsToken = {type: 'card', token?: string, id?: string};\n\nexport default class PopupPayment extends PopupElement {\n  private tipButtonsMap: Map<number, HTMLElement>;\n\n  constructor(\n    private message: Message.message,\n    private inputInvoice: InputInvoice,\n    private paymentForm?: PaymentsPaymentForm | PaymentsPaymentReceipt\n  ) {\n    super('popup-payment', {\n      closable: true,\n      overlayClosable: true,\n      body: true,\n      scrollable: true,\n      title: true\n    });\n\n    this.tipButtonsMap = new Map();\n    this.d();\n  }\n\n  private async d() {\n    this.element.classList.add('is-loading');\n    this.show();\n\n    let confirmed = false;\n    const onConfirmed = () => {\n      if(confirmed) {\n        return;\n      }\n\n      confirmed = true;\n      if(popupPaymentVerification) {\n        popupPaymentVerification.hide();\n      }\n\n      this.hide();\n    };\n\n    let {paymentForm, message} = this;\n\n    if(message) {\n      this.listenerSetter.add(rootScope)('payment_sent', ({peerId, mid}) => {\n        if(message.peerId === peerId && message.mid === mid) {\n          onConfirmed();\n        }\n      });\n    }\n\n    const mediaInvoice = message?.media as MessageMedia.messageMediaInvoice;\n    const isReceipt = mediaInvoice ? !!mediaInvoice.receipt_msg_id : paymentForm._ === 'payments.paymentReceipt';\n    const isTest = mediaInvoice ? mediaInvoice.pFlags.test : paymentForm.invoice.pFlags.test;\n\n    const photo = mediaInvoice ? mediaInvoice.photo : paymentForm.photo;\n    const title = mediaInvoice ? mediaInvoice.title : paymentForm.title;\n    const description = mediaInvoice ? mediaInvoice.description : paymentForm.description;\n\n    _i18n(this.title, isReceipt ? 'PaymentReceipt' : 'PaymentCheckout');\n    if(isTest) {\n      this.title.append(' (Test)');\n    }\n\n    const className = 'payment-item';\n\n    const itemEl = document.createElement('div');\n    itemEl.classList.add(className);\n\n    const detailsClassName = className + '-details';\n    const details = document.createElement('div');\n    details.classList.add(detailsClassName);\n\n    let photoEl: HTMLElement;\n    if(photo) {\n      photoEl = document.createElement('div');\n      photoEl.classList.add(detailsClassName + '-photo', 'media-container-contain');\n      wrapPhoto({\n        photo: photo,\n        container: photoEl,\n        boxWidth: 100,\n        boxHeight: 100,\n        size: {_: 'photoSizeEmpty', type: ''}\n      });\n      details.append(photoEl);\n    }\n\n    const linesClassName = detailsClassName + '-lines';\n    const linesEl = document.createElement('div');\n    linesEl.classList.add(linesClassName);\n\n    const titleEl = document.createElement('div');\n    titleEl.classList.add(linesClassName + '-title');\n\n    const descriptionEl = document.createElement('div');\n    descriptionEl.classList.add(linesClassName + '-description');\n\n    const botName = document.createElement('div');\n    botName.classList.add(linesClassName + '-bot-name');\n\n    linesEl.append(titleEl, descriptionEl, botName);\n\n    setInnerHTML(titleEl, wrapEmojiText(title));\n    setInnerHTML(descriptionEl, wrapEmojiText(description));\n\n    const peerTitle = new PeerTitle();\n    botName.append(peerTitle.element);\n\n    details.append(linesEl);\n    itemEl.append(details);\n    this.scrollable.append(itemEl);\n\n    const preloaderContainer = document.createElement('div');\n    preloaderContainer.classList.add(className + '-preloader-container');\n    const preloader = putPreloader(preloaderContainer, true);\n    this.scrollable.container.append(preloaderContainer);\n\n    const inputInvoice = this.inputInvoice;\n    if(!paymentForm) {\n      if(isReceipt) paymentForm = await this.managers.appPaymentsManager.getPaymentReceipt(message.peerId, mediaInvoice.receipt_msg_id);\n      else paymentForm = await this.managers.appPaymentsManager.getPaymentForm(inputInvoice);\n      this.paymentForm = paymentForm;\n    }\n\n    let savedInfo = (paymentForm as PaymentsPaymentForm).saved_info || (paymentForm as PaymentsPaymentReceipt).info;\n    const savedCredentials = (paymentForm as PaymentsPaymentForm).saved_credentials?.[0];\n    let [lastRequestedInfo, passwordState, providerPeerTitle] = await Promise.all([\n      !isReceipt && savedInfo && this.managers.appPaymentsManager.validateRequestedInfo(inputInvoice, savedInfo),\n      savedCredentials && this.managers.passwordManager.getState(),\n      wrapPeerTitle({peerId: paymentForm.provider_id.toPeerId()})\n    ]);\n\n    console.log(paymentForm, lastRequestedInfo);\n\n    await peerTitle.update({peerId: paymentForm.bot_id.toPeerId()});\n    preloaderContainer.remove();\n    this.element.classList.remove('is-loading');\n\n    const wrapAmount = (amount: string | number, skipSymbol?: boolean) => {\n      return paymentsWrapCurrencyAmount(amount, currency, skipSymbol);\n    };\n\n    const {invoice} = paymentForm;\n    const currency = invoice.currency;\n\n    const isRecurring = invoice.pFlags.recurring && !isReceipt;\n\n    await peerTitle.update({peerId: paymentForm.bot_id.toPeerId()});\n    const peerTitle2 = isRecurring ? await wrapPeerTitle({peerId: paymentForm.bot_id.toPeerId()}) : undefined;\n    preloaderContainer.remove();\n    this.element.classList.remove('is-loading');\n\n    const makeLabel = () => {\n      const labelEl = document.createElement('div');\n      labelEl.classList.add(pricesClassName + '-price');\n\n      const left = document.createElement('span');\n      const right = document.createElement('span');\n      labelEl.append(left, right);\n      return {label: labelEl, left, right};\n    };\n\n    const pricesClassName = className + '-prices';\n    const prices = document.createElement('div');\n    prices.classList.add(pricesClassName);\n    const makePricesElements = (prices: LabeledPrice[]) => {\n      return prices.map((price) => {\n        const {amount, label} = price;\n\n        const _label = makeLabel();\n        _label.left.textContent = label;\n\n        const wrappedAmount = wrapAmount(amount);\n        _label.right.textContent = wrappedAmount;\n\n        return _label.label;\n      });\n    };\n\n    const pricesElements = makePricesElements(invoice.prices);\n\n    let getTipsAmount = (): number => 0;\n    let shippingAmount = 0;\n\n    const getTotalTotal = () => totalAmount + getTipsAmount() + shippingAmount;\n    const setTotal = () => {\n      const wrapped = wrapAmount(getTotalTotal());\n      totalLabel.right.textContent = wrapped;\n      payI18n.compareAndUpdate({\n        key: 'PaymentCheckoutPay',\n        args: [wrapped]\n      });\n    };\n\n    const payI18n = new I18n.IntlElement();\n\n    const totalLabel = makeLabel();\n    totalLabel.label.classList.add('is-total');\n    _i18n(totalLabel.left, 'PaymentTransactionTotal');\n    const totalAmount = accumulate(invoice.prices.map(({amount}) => +amount), 0);\n\n    const canTip = (invoice.max_tip_amount !== undefined && !isReceipt) || !!(paymentForm as PaymentsPaymentReceipt).tip_amount;\n    if(canTip) {\n      const tipsClassName = className + '-tips';\n\n      const currencyData = Currencies[currency];\n\n      getTipsAmount = () => +getInputValue().replace(/\\D/g, '');\n\n      const getInputValue = () => {\n        // return input.textContent;\n        return input.value;\n      };\n\n      const setInputWidth = () => {\n        const width = getTextWidth(getInputValue(), `500 ${FontSize} ${FontFamily}`);\n        input.style.width = width + 'px';\n      };\n\n      const setInputValue = (amount: string | number) => {\n        amount = Math.min(+amount, +invoice.max_tip_amount);\n        const wrapped = wrapAmount(amount, true);\n\n        input.value = wrapped;\n        // input.textContent = wrapped;\n        if(document.activeElement === input) {\n          placeCaretAtEnd(input);\n        }\n\n        unsetActiveTip && unsetActiveTip();\n        const tipEl = this.tipButtonsMap.get(amount);\n        if(tipEl) {\n          tipEl.classList.add('active');\n        }\n\n        setInputWidth();\n        setTotal();\n      };\n\n      const tipsLabel = makeLabel();\n      _i18n(tipsLabel.left, isReceipt ? 'PaymentTip' : 'PaymentTipOptional');\n      const input = document.createElement('input');\n      input.type = 'tel';\n      // const input: HTMLElement = document.createElement('div');\n      // input.contentEditable = 'true';\n      input.classList.add('input-clear', tipsClassName + '-input');\n      tipsLabel.right.append(input);\n\n      if(!isReceipt) {\n        tipsLabel.label.style.cursor = 'text';\n      } else {\n        tipsLabel.label.classList.add('disable-hover');\n      }\n\n      tipsLabel.label.addEventListener('mousedown', (e) => {\n        if(!findUpAsChild(e.target as HTMLElement, input)) {\n          placeCaretAtEnd(input);\n        }\n      });\n\n      const haveToIgnoreEvents = input instanceof HTMLInputElement ? 1 : 2;\n      const onSelectionChange = () => {\n        if(ignoreNextSelectionChange) {\n          --ignoreNextSelectionChange;\n          return;\n        }\n\n        // setTimeout(() => {\n        ignoreNextSelectionChange = haveToIgnoreEvents;\n        placeCaretAtEnd(input);\n        // }, 0);\n      };\n\n      const onFocus = () => {\n        // cancelEvent(e);\n        setTimeout(() => {\n          ignoreNextSelectionChange = haveToIgnoreEvents;\n          placeCaretAtEnd(input);\n          document.addEventListener('selectionchange', onSelectionChange);\n        }, 0);\n      };\n\n      const onFocusOut = () => {\n        input.addEventListener('focus', onFocus, {once: true});\n        document.removeEventListener('selectionchange', onSelectionChange);\n      };\n\n      let ignoreNextSelectionChange: number;\n      input.addEventListener('focusout', onFocusOut);\n      onFocusOut();\n\n      input.addEventListener('input', () => {\n        setInputValue(getTipsAmount());\n      });\n\n      const s = [currencyData.symbol, currencyData.space_between ? ' ' : ''];\n      if(!currencyData.symbol_left) s.reverse();\n      tipsLabel.right[currencyData.symbol_left ? 'prepend' : 'append'](s.join(''));\n\n      pricesElements.push(tipsLabel.label);\n\n      //\n      let unsetActiveTip: () => void;\n      if(!isReceipt) {\n        const tipsEl = document.createElement('div');\n        tipsEl.classList.add(tipsClassName);\n\n        const tipClassName = tipsClassName + '-tip';\n        const tipButtons = invoice.suggested_tip_amounts.map((tipAmount) => {\n          const button = Button(tipClassName, {noRipple: true});\n          button.textContent = wrapAmount(tipAmount);\n\n          this.tipButtonsMap.set(+tipAmount, button);\n          return button;\n        });\n\n        unsetActiveTip = () => {\n          const prevTipEl = tipsEl.querySelector('.active');\n          if(prevTipEl) {\n            prevTipEl.classList.remove('active');\n          }\n        };\n\n        attachClickEvent(tipsEl, (e) => {\n          const tipEl = findUpClassName(e.target, tipClassName);\n          if(!tipEl) {\n            return;\n          }\n\n          let tipAmount = 0;\n          if(tipEl.classList.contains('active')) {\n            tipEl.classList.remove('active');\n          } else {\n            unsetActiveTip();\n            tipEl.classList.add('active');\n\n            for(const [amount, el] of this.tipButtonsMap) {\n              if(el === tipEl) {\n                tipAmount = amount;\n                break;\n              }\n            }\n          }\n\n          setInputValue(tipAmount);\n        });\n\n        setInputValue(0);\n\n        tipsEl.append(...tipButtons);\n        pricesElements.push(tipsEl);\n      } else {\n        setInputValue((paymentForm as PaymentsPaymentReceipt).tip_amount);\n      }\n    } else {\n      setTotal();\n    }\n\n    pricesElements.push(totalLabel.label);\n\n    prices.append(...pricesElements);\n    itemEl.append(prices);\n\n    // /\n\n    const setRowIcon = async(row: Row, icon?: string) => {\n      const img = document.createElement('img');\n      img.classList.add('media-photo');\n      await renderImageFromUrlPromise(img, getPaymentBrandIconPath(icon));\n      let container = row.media;\n      if(!container) {\n        container = row.createMedia('small');\n        container.classList.add('media-container-cover');\n        container.append(img);\n      } else {\n        replaceContent(container, img);\n      }\n    };\n\n    const createRow = (options: ConstructorParameters<typeof Row>[0]) => {\n      if(options.titleLangKey) {\n        options.subtitleLangKey = options.titleLangKey;\n      }\n\n      options.noWrap = true;\n      const row = new Row(options);\n      row.container.classList.add(className + '-row');\n\n      if(options.titleLangKey) {\n        row.subtitle.classList.add('hide');\n      }\n\n      return row;\n    };\n\n    const setRowTitle = (row: Row, textContent: string) => {\n      row.title.textContent = textContent;\n      if(!textContent) {\n        const e = I18n.weakMap.get(row.subtitle.firstElementChild as HTMLElement) as I18n.IntlElement;\n        row.title.append(i18n(e.key));\n      }\n\n      row.subtitle.classList.toggle('hide', !textContent);\n    };\n\n    const setCardSubtitle = (card: PaymentCardDetailsResult) => {\n      let brand: string;\n      let str: string;\n      let icon: string;\n      if('title' in card) {\n        brand = card.title.split(' ').shift();\n        str = card.title;\n        icon = card.icon;\n      } else {\n        brand = detectUnifiedCardBrand(card.cardNumber);\n        str = brand + ' *' + card.cardNumber.split(' ').pop();\n      }\n\n      methodRow.title.classList.remove('tgico', 'tgico-card_outline');\n      setRowIcon(methodRow, icon || brand.toLowerCase());\n      setRowTitle(methodRow, str);\n    };\n\n    const onMethodClick = () => {\n      new PopupPaymentCard(paymentForm as PaymentsPaymentForm, previousCardDetails as PaymentCardDetails).addEventListener('finish', ({token, card}) => {\n        previousToken = token, previousCardDetails = card;\n\n        setCardSubtitle(card);\n      });\n    };\n\n    let previousCardDetails: PaymentCardDetailsResult, previousToken: PaymentsCredentialsToken;\n    const methodRow = createRow({\n      titleLangKey: 'PaymentCheckoutMethod',\n      clickable: isReceipt ? undefined : onMethodClick,\n      icon: 'card_outline'\n    });\n\n    methodRow.container.classList.add(className + '-method-row');\n\n    if(savedCredentials) {\n      setCardSubtitle(savedCredentials);\n    } else if((paymentForm as PaymentsPaymentReceipt).credentials_title) {\n      setCardSubtitle({title: (paymentForm as PaymentsPaymentReceipt).credentials_title});\n    }\n\n    const providerRow = createRow({\n      title: providerPeerTitle,\n      subtitleLangKey: 'PaymentCheckoutProvider'\n    });\n\n    const providerAvatar = new AvatarElement();\n    providerAvatar.classList.add('avatar-32');\n    providerRow.createMedia('small').append(providerAvatar);\n    /* await */ providerAvatar.updateWithOptions({peerId: paymentForm.provider_id.toPeerId()});\n\n    let shippingAddressRow: Row, shippingNameRow: Row, shippingEmailRow: Row, shippingPhoneRow: Row, shippingMethodRow: Row;\n    let lastShippingOption: ShippingOption, onShippingAddressClick: (focus?: ConstructorParameters<typeof PopupPaymentShipping>[2]) => void, onShippingMethodClick: () => void;\n    const setShippingTitle = invoice.pFlags.shipping_address_requested ? (shippingAddress?: PaymentShippingAddress) => {\n      if(!shippingAddress) {\n        shippingMethodRow.subtitle.classList.add('hide');\n        replaceContent(shippingMethodRow.title, i18n('PaymentShippingAddress'));\n        return;\n      }\n\n      const postAddress = shippingAddress.shipping_address;\n      setRowTitle(shippingAddressRow, [postAddress.city, postAddress.street_line1, postAddress.street_line2].filter(Boolean).join(', '));\n\n      shippingMethodRow.container.classList.toggle('hide', !lastRequestedInfo && !isReceipt);\n    } : undefined;\n\n    const setShippingInfo = (info: PaymentRequestedInfo) => {\n      setShippingTitle && setShippingTitle(info);\n      shippingNameRow && setRowTitle(shippingNameRow, info.name);\n      shippingEmailRow && setRowTitle(shippingEmailRow, info.email);\n      shippingPhoneRow && setRowTitle(shippingPhoneRow, info.phone && ('+' + formatPhoneNumber(info.phone).formatted));\n    };\n\n    if(!isReceipt) {\n      onShippingAddressClick = (focus) => {\n        new PopupPaymentShipping(paymentForm as PaymentsPaymentForm, inputInvoice, focus).addEventListener('finish', ({shippingAddress, requestedInfo}) => {\n          lastRequestedInfo = requestedInfo;\n          savedInfo = (paymentForm as PaymentsPaymentForm).saved_info = shippingAddress;\n          setShippingInfo(shippingAddress);\n        });\n      };\n    }\n\n    if(invoice.pFlags.shipping_address_requested) {\n      const setShippingOption = (shippingOption?: ShippingOption) => {\n        const scrollSaver = new ScrollSaver(this.scrollable, undefined, true);\n        scrollSaver.save();\n        if(lastShippingPricesElements) {\n          lastShippingPricesElements.forEach((node) => node.remove());\n        }\n\n        if(!shippingOption) {\n          shippingAmount = 0;\n\n          setTotal();\n          scrollSaver.restore();\n          this.onContentUpdate();\n          return;\n        }\n\n        lastShippingOption = shippingOption;\n        setRowTitle(shippingMethodRow, shippingOption.title);\n\n        shippingAmount = accumulate(shippingOption.prices.map(({amount}) => +amount), 0);\n        lastShippingPricesElements = makePricesElements(shippingOption.prices);\n        let l = totalLabel.label;\n        if(canTip) {\n          l = l.previousElementSibling as any;\n          if(!isReceipt) {\n            l = l.previousElementSibling as any;\n          }\n        }\n\n        lastShippingPricesElements.forEach((element) => l.parentElement.insertBefore(element, l));\n\n        setTotal();\n        scrollSaver.restore();\n        this.onContentUpdate();\n      };\n\n      shippingAddressRow = createRow({\n        icon: 'location',\n        titleLangKey: 'PaymentShippingAddress',\n        clickable: !isReceipt && onShippingAddressClick.bind(null, undefined)\n      });\n\n      let lastShippingPricesElements: HTMLElement[];\n      shippingMethodRow = createRow({\n        icon: 'shipping',\n        titleLangKey: 'PaymentCheckoutShippingMethod',\n        clickable: !isReceipt && (onShippingMethodClick = () => {\n          new PopupPaymentShippingMethods(paymentForm as PaymentsPaymentForm, lastRequestedInfo, lastShippingOption).addEventListener('finish', (shippingOption) => {\n            setShippingOption(shippingOption);\n          });\n        })\n      });\n\n      shippingMethodRow.container.classList.add('hide');\n\n      const shippingOption = (paymentForm as PaymentsPaymentReceipt).shipping;\n      if(shippingOption) {\n        setShippingOption(shippingOption);\n      }\n    }\n\n    if(invoice.pFlags.name_requested) {\n      shippingNameRow = createRow({\n        icon: 'newprivate',\n        titleLangKey: 'PaymentCheckoutName',\n        clickable: !isReceipt && onShippingAddressClick.bind(null, 'name')\n      });\n    }\n\n    if(invoice.pFlags.email_requested) {\n      shippingEmailRow = createRow({\n        icon: 'mention',\n        titleLangKey: 'PaymentShippingEmailPlaceholder',\n        clickable: !isReceipt && onShippingAddressClick.bind(null, 'email')\n      });\n    }\n\n    if(invoice.pFlags.phone_requested) {\n      shippingPhoneRow = createRow({\n        icon: 'phone',\n        titleLangKey: 'PaymentCheckoutPhoneNumber',\n        clickable: !isReceipt && onShippingAddressClick.bind(null, 'phone')\n      });\n    }\n\n    if(savedInfo) {\n      setShippingInfo(savedInfo);\n    }\n\n    const rows = [\n      methodRow,\n      providerRow,\n      shippingAddressRow,\n      shippingMethodRow,\n      shippingNameRow,\n      shippingEmailRow,\n      shippingPhoneRow\n    ].filter(Boolean);\n\n    const acceptTermsCheckboxField = isRecurring && new CheckboxField({\n      text: 'Payments.Recurrent.Accept',\n      textArgs: [wrapRichText(invoice.recurring_terms_url), peerTitle2]\n    });\n\n    const acceptTermsRow = isRecurring && createRow({\n      checkboxField: acceptTermsCheckboxField,\n      noCheckboxSubtitle: true\n    });\n\n    const recurringElements = isRecurring ? [document.createElement('hr'), acceptTermsRow.container] : [];\n\n    this.scrollable.append(...[\n      document.createElement('hr'),\n      ...rows.map((row) => row.container),\n      ...recurringElements\n    ].filter(Boolean));\n\n    // /\n    let popupPaymentVerification: PopupPaymentVerification, lastTmpPasword: AccountTmpPassword;\n    const onClick = () => {\n      const missingInfo = invoice.pFlags.name_requested && !savedInfo?.name ? 'name' : (invoice.pFlags.email_requested && !savedInfo?.email ? 'email' : (invoice.pFlags.phone_requested && !savedInfo?.phone ? 'phone' : undefined));\n      if(invoice.pFlags.shipping_address_requested) {\n        if(!lastRequestedInfo) {\n          onShippingAddressClick();\n          return;\n        } else if(!lastShippingOption) {\n          onShippingMethodClick();\n          return;\n        }\n      } else if(missingInfo) {\n        onShippingAddressClick(missingInfo);\n        return;\n      }\n\n      if(!previousCardDetails && !lastTmpPasword) {\n        if(!savedCredentials) {\n          onMethodClick();\n          return;\n        }\n\n        Promise.resolve(passwordState ?? this.managers.passwordManager.getState()).then((_passwordState) => {\n          new PopupPaymentCardConfirmation(savedCredentials.title, _passwordState).addEventListener('finish', (tmpPassword) => {\n            passwordState = undefined;\n            lastTmpPasword = tmpPassword;\n            simulateClickEvent(payButton);\n\n            // * reserve 5 seconds\n            const diff = tmpPassword.valid_until - tsNow(true) - 5;\n            setTimeout(() => {\n              if(lastTmpPasword === tmpPassword) {\n                lastTmpPasword = undefined;\n              }\n            }, diff * 1000);\n          });\n        });\n\n        return;\n      }\n\n      return Promise.resolve().then(async() => {\n        const credentials: InputPaymentCredentials = lastTmpPasword ? {\n          _: 'inputPaymentCredentialsSaved',\n          id: savedCredentials.id,\n          tmp_password: lastTmpPasword.tmp_password\n        } : {\n          _: 'inputPaymentCredentials',\n          data: {\n            _: 'dataJSON',\n            data: JSON.stringify(previousToken.token ? previousToken : {type: previousToken.type, id: previousToken.id})\n          },\n          pFlags: {\n            save: previousCardDetails.save || undefined\n          }\n        };\n\n        try {\n          const paymentResult = await this.managers.appPaymentsManager.sendPaymentForm(\n            inputInvoice,\n            (paymentForm as PaymentsPaymentForm).form_id,\n            lastRequestedInfo?.id,\n            lastShippingOption?.id,\n            credentials,\n            getTipsAmount()\n          );\n\n          if(paymentResult._ === 'payments.paymentResult') {\n            onConfirmed();\n          } else {\n            popupPaymentVerification = new PopupPaymentVerification(paymentResult.url);\n            popupPaymentVerification.addEventListener('finish', () => {\n              popupPaymentVerification = undefined;\n\n              onConfirmed();\n            });\n            await new Promise<void>((resolve, reject) => {\n              popupPaymentVerification.addEventListener('close', () => {\n                popupPaymentVerification = undefined;\n                if(confirmed) {\n                  resolve();\n                } else {\n                  const err = new Error('payment not finished');\n                  (err as ApiError).handled = true;\n                  reject(err);\n                }\n              });\n            });\n          }\n        } catch(err) {\n          if((err as ApiError).type === 'BOT_PRECHECKOUT_TIMEOUT') {\n            toastNew({langPackKey: 'Error.AnError'});\n            (err as ApiError).handled = true;\n          } else if((err as ApiError).type === 'TMP_PASSWORD_INVALID') {\n            passwordState = lastTmpPasword = undefined;\n            simulateClickEvent(payButton);\n            (err as ApiError).handled = true;\n          }\n\n          throw err;\n        }\n      });\n    };\n\n    const onChange = () => {\n      payButton.disabled = !!(acceptTermsCheckboxField && !acceptTermsCheckboxField.checked);\n    };\n\n    let payButton: HTMLButtonElement;\n    if(isReceipt) {\n      payButton = PaymentButton({\n        onClick: () => this.hide(),\n        key: 'Done'\n      });\n    } else {\n      payButton = PaymentButton({\n        onClick: onClick,\n        textEl: payI18n\n      });\n    }\n\n    onChange();\n    if(acceptTermsCheckboxField) {\n      acceptTermsCheckboxField.input.addEventListener('change', onChange);\n    }\n\n    this.body.append(this.btnConfirmOnEnter = payButton);\n\n    this.onContentUpdate();\n  }\n}\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport type {AppImManager, ChatSavedPosition} from '../../lib/appManagers/appImManager';\r\nimport type {HistoryResult, MyMessage} from '../../lib/appManagers/appMessagesManager';\r\nimport type {MyDocument} from '../../lib/appManagers/appDocsManager';\r\nimport type Chat from './chat';\r\nimport {CHAT_ANIMATION_GROUP} from '../../lib/appManagers/appImManager';\r\nimport IS_TOUCH_SUPPORTED from '../../environment/touchSupport';\r\nimport {logger} from '../../lib/logger';\r\nimport rootScope from '../../lib/rootScope';\r\nimport BubbleGroups from './bubbleGroups';\r\nimport PopupDatePicker from '../popups/datePicker';\r\nimport PopupForward from '../popups/forward';\r\nimport PopupStickers from '../popups/stickers';\r\nimport ProgressivePreloader from '../preloader';\r\nimport Scrollable, {SliceSides} from '../scrollable';\r\nimport StickyIntersector from '../stickyIntersector';\r\nimport animationIntersector from '../animationIntersector';\r\nimport mediaSizes from '../../helpers/mediaSizes';\r\nimport {IS_ANDROID, IS_APPLE, IS_MOBILE, IS_SAFARI} from '../../environment/userAgent';\r\nimport I18n, {FormatterArguments, i18n, langPack, LangPackKey, UNSUPPORTED_LANG_PACK_KEY, _i18n} from '../../lib/langPack';\r\nimport AvatarElement from '../avatar';\r\nimport ripple from '../ripple';\r\nimport {wrapAlbum, wrapPhoto, wrapVideo, wrapDocument, wrapSticker, wrapPoll, wrapGroupedDocuments, wrapStickerAnimation} from '../wrappers';\r\nimport {MessageRender} from './messageRender';\r\nimport LazyLoadQueue from '../lazyLoadQueue';\r\nimport ListenerSetter from '../../helpers/listenerSetter';\r\nimport PollElement from '../poll';\r\nimport AudioElement from '../audio';\r\nimport {ChatInvite, Document, Message, MessageEntity,  MessageMedia,  MessageReplyHeader, Photo, PhotoSize, ReactionCount, ReplyMarkup, SponsoredMessage, Update, User, WebPage} from '../../layer';\r\nimport {BOT_START_PARAM, NULL_PEER_ID, REPLIES_PEER_ID} from '../../lib/mtproto/mtproto_config';\r\nimport {FocusDirection, ScrollStartCallbackDimensions} from '../../helpers/fastSmoothScroll';\r\nimport useHeavyAnimationCheck, {getHeavyAnimationPromise, dispatchHeavyAnimationEvent, interruptHeavyAnimation} from '../../hooks/useHeavyAnimationCheck';\r\nimport {fastRaf, fastRafPromise} from '../../helpers/schedulers';\r\nimport deferredPromise from '../../helpers/cancellablePromise';\r\nimport RepliesElement from './replies';\r\nimport DEBUG from '../../config/debug';\r\nimport {SliceEnd} from '../../helpers/slicedArray';\r\nimport PeerTitle from '../peerTitle';\r\nimport findUpClassName from '../../helpers/dom/findUpClassName';\r\nimport findUpTag from '../../helpers/dom/findUpTag';\r\nimport {toast, toastNew} from '../toast';\r\nimport {getElementByPoint} from '../../helpers/dom/getElementByPoint';\r\nimport {getMiddleware, Middleware} from '../../helpers/middleware';\r\nimport cancelEvent from '../../helpers/dom/cancelEvent';\r\nimport {attachClickEvent, simulateClickEvent} from '../../helpers/dom/clickEvent';\r\nimport htmlToDocumentFragment from '../../helpers/dom/htmlToDocumentFragment';\r\nimport reflowScrollableElement from '../../helpers/dom/reflowScrollableElement';\r\nimport replaceContent from '../../helpers/dom/replaceContent';\r\nimport setInnerHTML from '../../helpers/dom/setInnerHTML';\r\nimport whichChild from '../../helpers/dom/whichChild';\r\nimport {cancelAnimationByKey} from '../../helpers/animation';\r\nimport assumeType from '../../helpers/assumeType';\r\nimport debounce, {DebounceReturnType} from '../../helpers/schedulers/debounce';\r\nimport {SEND_WHEN_ONLINE_TIMESTAMP} from '../../lib/mtproto/constants';\r\nimport windowSize from '../../helpers/windowSize';\r\nimport {formatPhoneNumber} from '../../helpers/formatPhoneNumber';\r\nimport AppMediaViewer from '../appMediaViewer';\r\nimport SetTransition from '../singleTransition';\r\nimport handleHorizontalSwipe from '../../helpers/dom/handleHorizontalSwipe';\r\nimport findUpAttribute from '../../helpers/dom/findUpAttribute';\r\nimport findUpAsChild from '../../helpers/dom/findUpAsChild';\r\nimport formatCallDuration from '../../helpers/formatCallDuration';\r\nimport IS_CALL_SUPPORTED from '../../environment/callSupport';\r\nimport Button from '../button';\r\nimport {CallType} from '../../lib/calls/types';\r\nimport getVisibleRect from '../../helpers/dom/getVisibleRect';\r\nimport PopupJoinChatInvite from '../popups/joinChatInvite';\r\nimport {InternalLink, INTERNAL_LINK_TYPE} from '../../lib/appManagers/internalLink';\r\nimport ReactionsElement, {REACTIONS_ELEMENTS} from './reactions';\r\nimport type ReactionElement from './reaction';\r\nimport RLottiePlayer from '../../lib/rlottie/rlottiePlayer';\r\nimport pause from '../../helpers/schedulers/pause';\r\nimport ScrollSaver from '../../helpers/scrollSaver';\r\nimport getObjectKeysAndSort from '../../helpers/object/getObjectKeysAndSort';\r\nimport forEachReverse from '../../helpers/array/forEachReverse';\r\nimport formatNumber from '../../helpers/number/formatNumber';\r\nimport getViewportSlice from '../../helpers/dom/getViewportSlice';\r\nimport SuperIntersectionObserver from '../../helpers/dom/superIntersectionObserver';\r\nimport generateFakeIcon from '../generateFakeIcon';\r\nimport copyFromElement from '../../helpers/dom/copyFromElement';\r\nimport PopupElement from '../popups';\r\nimport setAttachmentSize from '../../helpers/setAttachmentSize';\r\nimport wrapWebPageDescription from '../wrappers/webPageDescription';\r\nimport wrapWebPageTitle from '../wrappers/webPageTitle';\r\nimport wrapEmojiText from '../../lib/richTextProcessor/wrapEmojiText';\r\nimport wrapRichText from '../../lib/richTextProcessor/wrapRichText';\r\nimport wrapMessageActionTextNew from '../wrappers/messageActionTextNew';\r\nimport isMentionUnread from '../../lib/appManagers/utils/messages/isMentionUnread';\r\nimport getMediaFromMessage from '../../lib/appManagers/utils/messages/getMediaFromMessage';\r\nimport getPeerColorById from '../../lib/appManagers/utils/peers/getPeerColorById';\r\nimport getPeerId from '../../lib/appManagers/utils/peers/getPeerId';\r\nimport getServerMessageId from '../../lib/appManagers/utils/messageId/getServerMessageId';\r\nimport generateMessageId from '../../lib/appManagers/utils/messageId/generateMessageId';\r\nimport {AppManagers} from '../../lib/appManagers/managers';\r\nimport {Awaited, SendMessageEmojiInteractionData} from '../../types';\r\nimport idleController from '../../helpers/idleController';\r\nimport overlayCounter from '../../helpers/overlayCounter';\r\nimport {cancelContextMenuOpening} from '../../helpers/dom/attachContextMenuListener';\r\nimport contextMenuController from '../../helpers/contextMenuController';\r\nimport {AckedResult} from '../../lib/mtproto/superMessagePort';\r\nimport middlewarePromise from '../../helpers/middlewarePromise';\r\nimport {EmoticonsDropdown} from '../emoticonsDropdown';\r\nimport indexOfAndSplice from '../../helpers/array/indexOfAndSplice';\r\nimport noop from '../../helpers/noop';\r\nimport getAlbumText from '../../lib/appManagers/utils/messages/getAlbumText';\r\nimport paymentsWrapCurrencyAmount from '../../helpers/paymentsWrapCurrencyAmount';\r\nimport PopupPayment from '../popups/payment';\r\nimport isInDOM from '../../helpers/dom/isInDOM';\r\nimport getStickerEffectThumb from '../../lib/appManagers/utils/stickers/getStickerEffectThumb';\r\nimport attachStickerViewerListeners from '../stickerViewer';\r\nimport {makeMediaSize, MediaSize} from '../../helpers/mediaSize';\r\nimport lottieLoader from '../../lib/rlottie/lottieLoader';\r\nimport appDownloadManager from '../../lib/appManagers/appDownloadManager';\r\nimport onMediaLoad from '../../helpers/onMediaLoad';\r\nimport throttle from '../../helpers/schedulers/throttle';\r\nimport {onEmojiStickerClick} from '../wrappers/sticker';\r\n\r\nconst USE_MEDIA_TAILS = false;\r\nconst IGNORE_ACTIONS: Set<Message.messageService['action']['_']> = new Set([\r\n  'messageActionHistoryClear',\r\n  'messageActionChatCreate'/* ,\r\n  'messageActionChannelMigrateFrom' */\r\n]);\r\n\r\nexport const SERVICE_AS_REGULAR: Set<Message.messageService['action']['_']> = new Set();\r\n\r\nif(IS_CALL_SUPPORTED) {\r\n  SERVICE_AS_REGULAR.add('messageActionPhoneCall');\r\n}\r\n\r\nconst TEST_SCROLL_TIMES: number = undefined;\r\nlet TEST_SCROLL = TEST_SCROLL_TIMES;\r\n\r\nlet queueId = 0;\r\n\r\ntype GenerateLocalMessageType<IsService> = IsService extends true ? Message.messageService : Message.message;\r\n\r\nconst SPONSORED_MESSAGE_ID_OFFSET = 1;\r\nexport const STICKY_OFFSET = 3;\r\nconst SCROLLED_DOWN_THRESHOLD = 300;\r\nconst PEER_CHANGED_ERROR = new Error('peer changed');\r\n\r\nconst DO_NOT_SLICE_VIEWPORT = false;\r\nconst DO_NOT_SLICE_VIEWPORT_ON_RENDER = false;\r\nconst DO_NOT_UPDATE_MESSAGE_VIEWS = false;\r\nconst DO_NOT_UPDATE_MESSAGE_REACTIONS = false;\r\nconst DO_NOT_UPDATE_MESSAGE_REPLY = false;\r\n\r\ntype Bubble = {\r\n  bubble: HTMLElement,\r\n  mids: Set<number>,\r\n  groupedId?: string\r\n};\r\n\r\ntype MyHistoryResult = HistoryResult | {history: number[]};\r\n\r\nfunction getMainMidForGrouped(mids: number[]) {\r\n  return Math.max(...mids);\r\n}\r\n\r\nexport default class ChatBubbles {\r\n  public container: HTMLDivElement;\r\n  public chatInner: HTMLDivElement;\r\n  public scrollable: Scrollable;\r\n\r\n  private getHistoryTopPromise: Promise<boolean>;\r\n  private getHistoryBottomPromise: Promise<boolean>;\r\n\r\n  // public messagesCount: number = -1;\r\n\r\n  private unreadOut = new Set<number>();\r\n  public needUpdate: {replyToPeerId: PeerId, replyMid: number, mid: number}[] = []; // if need wrapSingleMessage\r\n\r\n  public bubbles: {[mid: string]: HTMLElement} = {};\r\n  public skippedMids: Set<number> = new Set();\r\n  public bubblesNewByGroupedId: {[groupId: string]: Bubble} = {};\r\n  public bubblesNew: {[mid: string]: Bubble} = {};\r\n  private dateMessages: {[timestamp: number]: {\r\n    div: HTMLElement,\r\n    firstTimestamp: number,\r\n    container: HTMLElement,\r\n    timeout?: number\r\n  }} = {};\r\n\r\n  private scrolledDown = true;\r\n  private isScrollingTimeout = 0;\r\n\r\n  private stickyIntersector: StickyIntersector;\r\n\r\n  private unreaded: Map<HTMLElement, number> = new Map();\r\n  private unreadedSeen: Set<number> = new Set();\r\n  private readPromise: Promise<void>;\r\n\r\n  private bubbleGroups: BubbleGroups;\r\n\r\n  private preloader: ProgressivePreloader = null;\r\n\r\n  public messagesQueuePromise: Promise<void> = null;\r\n  private messagesQueue: ReturnType<ChatBubbles['safeRenderMessage']>[] = [];\r\n  // private messagesQueueOnRender: () => void = null;\r\n  private messagesQueueOnRenderAdditional: () => void = null;\r\n\r\n  private firstUnreadBubble: HTMLElement = null;\r\n  private attachedUnreadBubble: boolean;\r\n\r\n  public lazyLoadQueue: LazyLoadQueue;\r\n\r\n  private middlewareHelper = getMiddleware();\r\n\r\n  private log: ReturnType<typeof logger>;\r\n\r\n  public listenerSetter: ListenerSetter;\r\n\r\n  private replyFollowHistory: number[] = [];\r\n\r\n  private isHeavyAnimationInProgress = false;\r\n  private scrollingToBubble: HTMLElement;\r\n\r\n  private isFirstLoad = true;\r\n  private needReflowScroll: boolean;\r\n\r\n  private fetchNewPromise: Promise<void>;\r\n\r\n  private passEntities: Partial<{\r\n    [_ in MessageEntity['_']]: boolean\r\n  }> = {};\r\n\r\n  private onAnimateLadder: () => Promise<any> | void;\r\n  // private ladderDeferred: CancellablePromise<void>;\r\n  private resolveLadderAnimation: () => Promise<any>;\r\n  private emptyPlaceholderBubble: HTMLElement;\r\n\r\n  private viewsMids: Set<number> = new Set();\r\n  private sendViewCountersDebounced: () => Promise<void>;\r\n\r\n  private isTopPaddingSet = false;\r\n\r\n  private getSponsoredMessagePromise: Promise<void>;\r\n\r\n  private previousStickyDate: HTMLElement;\r\n  private sponsoredMessage: SponsoredMessage.sponsoredMessage;\r\n\r\n  private hoverBubble: HTMLElement;\r\n  private hoverReaction: HTMLElement;\r\n  private sliceViewportDebounced: DebounceReturnType<ChatBubbles['sliceViewport']>;\r\n  private resizeObserver: ResizeObserver;\r\n  private willScrollOnLoad: boolean;\r\n  private observer: SuperIntersectionObserver;\r\n\r\n  private renderingMessages: Set<number> = new Set();\r\n  private setPeerCached: boolean;\r\n  private attachPlaceholderOnRender: () => void;\r\n\r\n  private bubblesToEject: Set<HTMLElement> = new Set();\r\n  private bubblesToReplace: Map<HTMLElement, HTMLElement> = new Map(); // TO -> FROM\r\n  private updatePlaceholderPosition: () => void;\r\n  private setPeerOptions: {lastMsgId: number; topMessage: number;};\r\n\r\n  private setPeerTempId: number = 0;\r\n\r\n  private renderNewPromises: Set<Promise<any>> = new Set();\r\n  private updateGradient: boolean;\r\n\r\n  // private reactions: Map<number, ReactionsElement>;\r\n\r\n  constructor(\r\n    private chat: Chat,\r\n    private managers: AppManagers\r\n  ) {\r\n    this.log = this.chat.log;\r\n    // this.chat.log.error('Bubbles construction');\r\n\r\n    this.listenerSetter = new ListenerSetter();\r\n\r\n    this.constructBubbles();\r\n\r\n    // * constructor end\r\n\r\n    this.bubbleGroups = new BubbleGroups(this.chat);\r\n    this.preloader = new ProgressivePreloader({\r\n      cancelable: false\r\n    });\r\n    this.lazyLoadQueue = new LazyLoadQueue();\r\n    this.lazyLoadQueue.queueId = ++queueId;\r\n\r\n    // this.reactions = new Map();\r\n\r\n    // * events\r\n\r\n    // will call when sent for update pos\r\n    this.listenerSetter.add(rootScope)('history_update', async({storageKey, sequential, message}) => {\r\n      if(this.chat.messagesStorageKey !== storageKey || this.chat.type === 'scheduled') {\r\n        return;\r\n      }\r\n\r\n      const {mid} = message;\r\n      const log = false ? this.log.bindPrefix('history_update-' + mid) : undefined;\r\n      log && log('start');\r\n\r\n      const bubble = this.bubbles[mid];\r\n      if(!bubble) return;\r\n\r\n      if(this.renderNewPromises.size) {\r\n        log && log.error('will await new messages render');\r\n        await Promise.all(Array.from(this.renderNewPromises));\r\n      }\r\n\r\n      if(this.messagesQueuePromise) {\r\n        log && log.error('messages render in process');\r\n        await this.messagesQueuePromise;\r\n      }\r\n\r\n      if(this.bubbles[mid] !== bubble) return;\r\n\r\n      // await getHeavyAnimationPromise();\r\n\r\n      const item = this.bubbleGroups.getItemByBubble(bubble);\r\n      if(!item) { // probably a group item\r\n        log && log.error('no item by bubble', bubble);\r\n        return;\r\n      } else if(item.mid === mid) {\r\n        log && log.warn('wow what', item, mid);\r\n        return;\r\n      }\r\n\r\n      if(sequential) {\r\n        const group = item.group;\r\n        const newItem = this.bubbleGroups.createItem(bubble, message);\r\n        // newItem.mid = item.mid;\r\n        const _items = this.bubbleGroups.itemsArr.slice();\r\n        indexOfAndSplice(_items, item);\r\n        const foundItem = this.bubbleGroups.findGroupSiblingByItem(newItem, _items);\r\n        if(\r\n          group === foundItem?.group ||\r\n          (group === this.bubbleGroups.getLastGroup() && group.items.length === 1 && newItem.dateTimestamp === item.dateTimestamp) ||\r\n          (this.peerId === rootScope.myId && sequential && newItem.dateTimestamp === item.dateTimestamp)\r\n        ) {\r\n          log && log('item has correct position', item);\r\n          this.bubbleGroups.changeBubbleMid(bubble, mid);\r\n          return;\r\n        }\r\n      }\r\n\r\n      // return;\r\n\r\n      // await fastRafPromise();\r\n      // if(this.bubbles[mid] !== bubble) return;\r\n\r\n      // const groupIndex = this.bubbleGroups.groups.indexOf(group);\r\n      this.bubbleGroups.removeAndUnmountBubble(bubble);\r\n      // if(!group.items.length) { // group has collapsed, next message can have higher mid so have to reposition them too\r\n      //   log && log('group has collapsed', item);\r\n\r\n      //   const siblingGroups = this.bubbleGroups.groups.slice(0, groupIndex + 1);\r\n      //   for(let length = siblingGroups.length, i = length - 2; i >= 0; --i) {\r\n      //     const siblingGroup = siblingGroups[i];\r\n      //     const siblingItems = siblingGroup.items;\r\n      //     const nextGroup = siblingGroups[i + 1];\r\n      //     const nextItems = nextGroup.items;\r\n\r\n      //     let _break = false, moved = false;\r\n      //     for(let j = siblingItems.length - 1; j >= 0; --j) {\r\n      //       const siblingItem = siblingItems[j];\r\n      //       const foundItem = this.bubbleGroups.findGroupSiblingByItem(siblingItem, nextItems);\r\n      //       if(!foundItem) {\r\n      //         _break = true;\r\n      //         break;\r\n      //       }\r\n\r\n      //       log('will move item', siblingItem, nextGroup);\r\n      //       this.bubbleGroups.removeAndUnmountBubble(siblingItem.bubble);\r\n      //       this.bubbleGroups.addItemToGroup(siblingItem, nextGroup);\r\n      //       moved = true;\r\n      //     }\r\n\r\n      //     if(moved) {\r\n      //       nextGroup.mount();\r\n      //     }\r\n\r\n      //     if(_break) {\r\n      //       break;\r\n      //     }\r\n      //   }\r\n      // }\r\n\r\n      const {groups} = this.groupBubbles([{bubble, message}]);\r\n      this.bubbleGroups.mountUnmountGroups(groups);\r\n\r\n      if(this.scrollingToBubble) {\r\n        this.scrollToEnd();\r\n      }\r\n\r\n      log && log('end');\r\n\r\n      // this.bubbleGroups.findIncorrentPositions();\r\n    });\r\n\r\n    this.listenerSetter.add(rootScope)('dialog_flush', ({peerId}) => {\r\n      if(this.peerId === peerId) {\r\n        this.deleteMessagesByIds(Object.keys(this.bubbles).map((m) => +m));\r\n      }\r\n    });\r\n\r\n    // Calls when message successfully sent and we have an id\r\n    this.listenerSetter.add(rootScope)('message_sent', async(e) => {\r\n      const {storageKey, tempId, tempMessage, mid, message} = e;\r\n\r\n      // ! can't use peerId to validate here, because id can be the same in 'scheduled' and 'chat' types\r\n      if(this.chat.messagesStorageKey !== storageKey) {\r\n        return;\r\n      }\r\n\r\n      const bubbles = this.bubbles;\r\n      const _bubble = bubbles[tempId];\r\n      if(_bubble) {\r\n        const bubble = bubbles[tempId];\r\n        bubbles[mid] = bubble;\r\n        bubble.dataset.mid = '' + mid;\r\n        delete bubbles[tempId];\r\n\r\n        fastRaf(() => {\r\n          const mid = +bubble.dataset.mid;\r\n          if(bubbles[mid] === bubble && bubble.classList.contains('is-outgoing')) {\r\n            bubble.classList.remove('is-sending', 'is-outgoing');\r\n            bubble.classList.add((this.peerId === rootScope.myId && this.chat.type !== 'scheduled') || !this.unreadOut.has(mid) ? 'is-read' : 'is-sent');\r\n          }\r\n        });\r\n      }\r\n\r\n      if(this.unreadOut.has(tempId)) {\r\n        this.unreadOut.delete(tempId);\r\n        this.unreadOut.add(mid);\r\n      }\r\n\r\n      // * check timing of scheduled message\r\n      if(this.chat.type === 'scheduled') {\r\n        const timestamp = Date.now() / 1000 | 0;\r\n        const maxTimestamp = tempMessage.date - 10;\r\n        if(timestamp >= maxTimestamp) {\r\n          this.deleteMessagesByIds([mid]);\r\n        }\r\n      }\r\n\r\n      if(!_bubble) {\r\n        return;\r\n      }\r\n\r\n      let messages: (Message.message | Message.messageService)[], tempIds: number[];\r\n      const groupedId = (message as Message.message).grouped_id;\r\n      if(groupedId) {\r\n        messages = await this.managers.appMessagesManager.getMessagesByAlbum(groupedId);\r\n        const mids = messages.map(({mid}) => mid);\r\n        if(!mids.length || getMainMidForGrouped(mids) !== mid || bubbles[mid] !== _bubble) {\r\n          return;\r\n        }\r\n\r\n        if(bubbles[mid] !== _bubble) {\r\n          return;\r\n        }\r\n\r\n        tempIds = (Array.from(_bubble.querySelectorAll('.grouped-item')) as HTMLElement[]).map((el) => +el.dataset.mid);\r\n      } else {\r\n        messages = [message];\r\n        tempIds = [tempId];\r\n      }\r\n\r\n      const reactionsElements = Array.from(_bubble.querySelectorAll('reactions-element')) as ReactionsElement[];\r\n      if(reactionsElements.length) {\r\n        reactionsElements.forEach((reactionsElement) => {\r\n          reactionsElement.changeMessage(message as Message.message);\r\n        });\r\n      }\r\n\r\n      (messages as Message.message[]).forEach((message, idx) => {\r\n        if(!message) {\r\n          return;\r\n        }\r\n\r\n        const tempId = tempIds[idx];\r\n        const mid = message.mid;\r\n        const bubble: HTMLElement = _bubble.querySelector(`.document-container[data-mid=\"${mid}\"]`) || _bubble;\r\n\r\n        if(message._ !== 'message') {\r\n          return;\r\n        }\r\n\r\n        if(message.replies) {\r\n          const repliesElement = _bubble.querySelector('replies-element') as RepliesElement;\r\n          if(repliesElement) {\r\n            repliesElement.message = message;\r\n            repliesElement.init();\r\n          }\r\n        }\r\n\r\n        const media = message.media ?? {} as MessageMedia.messageMediaEmpty;\r\n        const doc = (media as MessageMedia.messageMediaDocument).document as Document.document;\r\n        const poll = (media as MessageMedia.messageMediaPoll).poll;\r\n        const webPage = (media as MessageMedia.messageMediaWebPage).webpage as WebPage.webPage;\r\n        if(doc) {\r\n          const div = bubble.querySelector(`.document-container[data-mid=\"${tempId}\"] .document`);\r\n          if(div) {\r\n            const container = findUpClassName(div, 'document-container');\r\n\r\n            if(!tempMessage.media?.document?.thumbs?.length && doc.thumbs?.length) {\r\n              getHeavyAnimationPromise().then(async() => {\r\n                const timeSpan = div.querySelector('.time');\r\n                const newDiv = await wrapDocument({message});\r\n                div.replaceWith(newDiv);\r\n\r\n                if(timeSpan) {\r\n                  newDiv.querySelector('.document').append(timeSpan);\r\n                }\r\n              });\r\n            }\r\n\r\n            if(container) {\r\n              container.dataset.mid = '' + mid;\r\n            }\r\n          }\r\n\r\n          const element = bubble.querySelector(`audio-element[data-mid=\"${tempId}\"], .document[data-doc-id=\"${tempId}\"], .media-round[data-mid=\"${tempId}\"]`) as HTMLElement;\r\n          if(element) {\r\n            if(element instanceof AudioElement || element.classList.contains('media-round')) {\r\n              element.dataset.mid = '' + message.mid;\r\n              delete element.dataset.isOutgoing;\r\n              (element as any).message = message;\r\n              (element as any).onLoad(true);\r\n            } else {\r\n              element.dataset.docId = '' + doc.id;\r\n              (element as any).doc = doc;\r\n            }\r\n          }\r\n        } else if(poll) {\r\n          const pollElement = bubble.querySelector('poll-element') as PollElement;\r\n          if(pollElement) {\r\n            pollElement.message = message;\r\n            pollElement.setAttribute('poll-id', '' + poll.id);\r\n            pollElement.setAttribute('message-id', '' + mid);\r\n          }\r\n        } else if(webPage && !bubble.querySelector('.web')) {\r\n          getHeavyAnimationPromise().then(() => {\r\n            this.safeRenderMessage(message, true, bubble);\r\n            this.scrollToBubbleIfLast(bubble);\r\n          });\r\n        }\r\n\r\n        // set new mids to album items for mediaViewer\r\n        if(groupedId) {\r\n          const item = (bubble.querySelector(`.grouped-item[data-mid=\"${tempId}\"]`) as HTMLElement) || bubble; // * it can be .document-container\r\n          if(item) {\r\n            item.dataset.mid = '' + mid;\r\n          }\r\n        }\r\n      });\r\n    });\r\n\r\n    this.listenerSetter.add(rootScope)('message_edit', async({storageKey, message}) => {\r\n      if(storageKey !== this.chat.messagesStorageKey) return;\r\n\r\n      const bubble = this.bubbles[message.mid];\r\n      if(!bubble) return;\r\n\r\n      await getHeavyAnimationPromise();\r\n      if(this.bubbles[message.mid] !== bubble) return;\r\n\r\n      this.safeRenderMessage(message, true, bubble);\r\n    });\r\n\r\n    this.listenerSetter.add(rootScope)('message_error', async({storageKey, tempId}) => {\r\n      if(storageKey !== this.chat.messagesStorageKey) return;\r\n\r\n      const bubble = this.bubbles[tempId];\r\n      if(!bubble) return;\r\n\r\n      await getHeavyAnimationPromise();\r\n      if(this.bubbles[tempId] !== bubble) return;\r\n\r\n      bubble.classList.remove('is-outgoing');\r\n      bubble.classList.add('is-error');\r\n    });\r\n\r\n    this.listenerSetter.add(rootScope)('album_edit', ({peerId, messages, deletedMids}) => {\r\n      if(peerId !== this.peerId) return;\r\n\r\n      const mids = messages.map(({mid}) => mid);\r\n      const oldMids = mids.concat(Array.from(deletedMids));\r\n      const wasMainMid = getMainMidForGrouped(oldMids);\r\n      const bubble = this.bubbles[wasMainMid];\r\n      if(!bubble) {\r\n        return;\r\n      }\r\n\r\n      const mainMid = getMainMidForGrouped(mids);\r\n      const message = messages.find((message) => message.mid === mainMid);\r\n      this.safeRenderMessage(message, true, bubble);\r\n    });\r\n\r\n    this.listenerSetter.add(rootScope)('peer_title_edit', async(peerId) => {\r\n      if(peerId.isUser()) {\r\n        const middleware = this.getMiddleware();\r\n        const user = await this.managers.appUsersManager.getUser(peerId.toUserId());\r\n        if(!middleware()) return;\r\n\r\n        const isPremium = user?.pFlags?.premium;\r\n        const groups = this.bubbleGroups.groups.filter((group) => group.avatar?.peerId === peerId);\r\n        groups.forEach((group) => {\r\n          group.avatar.classList.toggle('is-premium', isPremium);\r\n          group.avatar.classList.toggle('tgico-star', isPremium);\r\n        });\r\n      }\r\n    });\r\n\r\n    if(this.chat.type !== 'scheduled' && !DO_NOT_UPDATE_MESSAGE_REACTIONS/*  && false */) {\r\n      this.listenerSetter.add(rootScope)('messages_reactions', async(arr) => {\r\n        let scrollSaver: ScrollSaver;\r\n\r\n        const a = arr.map(async({message, changedResults}) => {\r\n          if(this.peerId !== message.peerId) {\r\n            return;\r\n          }\r\n\r\n          const result = await this.getMountedBubble(message.mid, message);\r\n          if(!result) {\r\n            return;\r\n          }\r\n\r\n          return {bubble: result.bubble, message, changedResults};\r\n        });\r\n\r\n        let top: number;\r\n        (await Promise.all(a)).filter(Boolean).forEach(({bubble, message, changedResults}) => {\r\n          if(!scrollSaver) {\r\n            scrollSaver = this.createScrollSaver(false);\r\n            scrollSaver.save();\r\n          }\r\n\r\n          const key = message.peerId + '_' + message.mid;\r\n          const set = REACTIONS_ELEMENTS.get(key);\r\n          if(set) {\r\n            for(const element of set) {\r\n              element.update(message, changedResults);\r\n            }\r\n          } else if(!message.reactions || !message.reactions.results.length) {\r\n            return;\r\n          } else {\r\n            this.appendReactionsElementToBubble(bubble, message, message, changedResults);\r\n          }\r\n        });\r\n\r\n        if(scrollSaver) {\r\n          scrollSaver.restore();\r\n        }\r\n      });\r\n    }\r\n\r\n    !DO_NOT_UPDATE_MESSAGE_REPLY && this.listenerSetter.add(rootScope)('messages_downloaded', async({peerId, mids}) => {\r\n      const middleware = this.getMiddleware();\r\n      await getHeavyAnimationPromise();\r\n      if(!middleware()) return;\r\n\r\n      (mids as number[]).forEach((mid) => {\r\n        const needUpdate = this.needUpdate;\r\n        const filtered: typeof needUpdate[0][] = [];\r\n        forEachReverse(this.needUpdate, (obj, idx) => {\r\n          if(obj.replyMid === mid && obj.replyToPeerId === peerId) {\r\n            this.needUpdate.splice(idx, 1)[0];\r\n            filtered.push(obj);\r\n          }\r\n        });\r\n\r\n        filtered.forEach(async({mid, replyMid, replyToPeerId}) => {\r\n          const bubble = this.bubbles[mid];\r\n          if(!bubble) return;\r\n\r\n          const message = (await this.chat.getMessage(mid)) as Message.message;\r\n\r\n          MessageRender.setReply({\r\n            chat: this.chat,\r\n            bubble,\r\n            message\r\n          });\r\n        });\r\n      });\r\n    });\r\n\r\n    attachStickerViewerListeners({listenTo: this.scrollable.container, listenerSetter: this.listenerSetter, selector: '.attachment.media-sticker-wrapper'});\r\n    attachClickEvent(this.scrollable.container, this.onBubblesClick, {listenerSetter: this.listenerSetter});\r\n    // this.listenerSetter.add(this.bubblesContainer)('click', this.onBubblesClick/* , {capture: true, passive: false} */);\r\n\r\n    this.listenerSetter.add(this.scrollable.container)('mousedown', (e) => {\r\n      if(e.button !== 0) return;\r\n\r\n      const code: HTMLElement = findUpTag(e.target, 'CODE');\r\n      if(code) {\r\n        cancelEvent(e);\r\n        copyFromElement(code);\r\n        toastNew({langPackKey: 'TextCopied'});\r\n        return;\r\n      }\r\n    });\r\n\r\n    /* if(false)  */this.stickyIntersector = new StickyIntersector(this.scrollable.container, (stuck, target) => {\r\n      for(const timestamp in this.dateMessages) {\r\n        const dateMessage = this.dateMessages[timestamp];\r\n        if(dateMessage.container === target) {\r\n          const dateBubble = dateMessage.div;\r\n\r\n          // dateMessage.container.classList.add('has-sticky-dates');\r\n\r\n          // SetTransition(dateBubble, 'kek', stuck, this.previousStickyDate ? 300 : 0);\r\n          // if(this.previousStickyDate) {\r\n          // dateBubble.classList.add('kek');\r\n          // }\r\n\r\n          dateBubble.classList.toggle('is-sticky', stuck);\r\n          if(stuck) {\r\n            this.previousStickyDate = dateBubble;\r\n          }\r\n\r\n          break;\r\n        }\r\n      }\r\n\r\n      if(this.previousStickyDate) {\r\n        // fastRaf(() => {\r\n        // this.bubblesContainer.classList.add('has-sticky-dates');\r\n        // });\r\n      }\r\n    });\r\n\r\n    if(!IS_SAFARI) {\r\n      this.sliceViewportDebounced = debounce(this.sliceViewport.bind(this), 3000, false, true);\r\n    }\r\n\r\n    let middleware: ReturnType<ChatBubbles['getMiddleware']>;\r\n    useHeavyAnimationCheck(() => {\r\n      this.isHeavyAnimationInProgress = true;\r\n      this.lazyLoadQueue.lock();\r\n      middleware = this.getMiddleware();\r\n\r\n      // if(this.sliceViewportDebounced) {\r\n      //   this.sliceViewportDebounced.clearTimeout();\r\n      // }\r\n    }, () => {\r\n      this.isHeavyAnimationInProgress = false;\r\n\r\n      if(middleware && middleware()) {\r\n        this.lazyLoadQueue.unlock();\r\n        this.lazyLoadQueue.refresh();\r\n\r\n        // if(this.sliceViewportDebounced) {\r\n        //   this.sliceViewportDebounced();\r\n        // }\r\n      }\r\n\r\n      middleware = null;\r\n    }, this.listenerSetter);\r\n  }\r\n\r\n  private constructBubbles() {\r\n    const container = this.container = document.createElement('div');\r\n    container.classList.add('bubbles', 'scrolled-down');\r\n\r\n    const chatInner = this.chatInner = document.createElement('div');\r\n    chatInner.classList.add('bubbles-inner');\r\n\r\n    this.setScroll();\r\n\r\n    container.append(this.scrollable.container);\r\n  }\r\n\r\n  public attachContainerListeners() {\r\n    const container = this.container;\r\n\r\n    this.chat.contextMenu.attachTo(container);\r\n    this.chat.selection.attachListeners(container, new ListenerSetter());\r\n\r\n    if(DEBUG) {\r\n      this.listenerSetter.add(container)('dblclick', async(e) => {\r\n        const bubble = findUpClassName(e.target, 'grouped-item') || findUpClassName(e.target, 'bubble');\r\n        if(bubble) {\r\n          const mid = +bubble.dataset.mid\r\n          this.log('debug message:', await this.chat.getMessage(mid));\r\n          this.highlightBubble(bubble);\r\n        }\r\n      });\r\n    }\r\n\r\n    if(this.chat.type !== 'pinned' && this.chat.type !== 'scheduled') {\r\n      if(!IS_MOBILE) {\r\n        this.listenerSetter.add(container)('dblclick', async(e) => {\r\n          if(this.chat.selection.isSelecting ||\r\n            !(await this.chat.canSend())) {\r\n            return;\r\n          }\r\n\r\n          const target = e.target as HTMLElement;\r\n          const bubble = target.classList.contains('bubble') ?\r\n            target :\r\n            (target.classList.contains('document-selection') ? target.parentElement : null);\r\n          if(bubble && !bubble.classList.contains('bubble-first')) {\r\n            const mid = +bubble.dataset.mid;\r\n            const message = await this.chat.getMessage(mid);\r\n            if(message.pFlags.is_outgoing) {\r\n              return;\r\n            }\r\n\r\n            this.chat.input.initMessageReply(mid);\r\n          }\r\n        });\r\n      } else if(IS_TOUCH_SUPPORTED) {\r\n        const className = 'is-gesturing-reply';\r\n        const MAX = 64;\r\n        const replyAfter = MAX * .75;\r\n        let shouldReply = false;\r\n        let target: HTMLElement;\r\n        let icon: HTMLElement;\r\n        handleHorizontalSwipe({\r\n          element: container,\r\n          verifyTouchTarget: async(e) => {\r\n            if(this.chat.selection.isSelecting || !(await this.chat.canSend())) {\r\n              return false;\r\n            }\r\n\r\n            // cancelEvent(e);\r\n            target = findUpClassName(e.target, 'bubble');\r\n            if(target) {\r\n              SetTransition(target, className, true, 250);\r\n              void target.offsetLeft; // reflow\r\n\r\n              if(!icon) {\r\n                icon = document.createElement('span');\r\n                icon.classList.add('tgico-reply_filled', 'bubble-gesture-reply-icon');\r\n              } else {\r\n                icon.classList.remove('is-visible');\r\n                icon.style.opacity = '';\r\n              }\r\n\r\n              target/* .querySelector('.bubble-content') */.append(icon);\r\n            }\r\n\r\n            return !!target;\r\n          },\r\n          onSwipe: (xDiff, yDiff) => {\r\n            shouldReply = xDiff >= replyAfter;\r\n\r\n            if(shouldReply && !icon.classList.contains('is-visible')) {\r\n              icon.classList.add('is-visible');\r\n            }\r\n            icon.style.opacity = '' + Math.min(1, xDiff / replyAfter);\r\n\r\n            const x = -Math.max(0, Math.min(MAX, xDiff));\r\n            target.style.transform = `translateX(${x}px)`;\r\n            cancelContextMenuOpening();\r\n          },\r\n          onReset: () => {\r\n            const _target = target;\r\n            SetTransition(_target, className, false, 250, () => {\r\n              if(icon.parentElement === _target) {\r\n                icon.classList.remove('is-visible');\r\n                icon.remove();\r\n              }\r\n            });\r\n\r\n            fastRaf(() => {\r\n              _target.style.transform = ``;\r\n\r\n              if(shouldReply) {\r\n                const {mid} = _target.dataset;\r\n                this.chat.input.initMessageReply(+mid);\r\n                shouldReply = false;\r\n              }\r\n            });\r\n          },\r\n          listenerOptions: {capture: true}\r\n        });\r\n      }\r\n    }\r\n  }\r\n\r\n  public constructPeerHelpers() {\r\n    // will call when message is sent (only 1)\r\n    this.listenerSetter.add(rootScope)('history_append', async({storageKey, message}) => {\r\n      if(storageKey !== this.chat.messagesStorageKey) return;\r\n\r\n      if(rootScope.settings.animationsEnabled) {\r\n        this.updateGradient = true;\r\n      }\r\n\r\n      if(!this.scrollable.loadedAll.bottom) {\r\n        this.chat.setMessageId();\r\n      } else {\r\n        this.renderNewMessage(message, true);\r\n      }\r\n    });\r\n\r\n    this.listenerSetter.add(rootScope)('history_multiappend', (message) => {\r\n      if(this.peerId !== message.peerId) return;\r\n      this.renderNewMessage(message);\r\n    });\r\n\r\n    this.listenerSetter.add(rootScope)('history_delete', ({peerId, msgs}) => {\r\n      if(peerId === this.peerId) {\r\n        this.deleteMessagesByIds(Array.from(msgs));\r\n      }\r\n    });\r\n\r\n    this.listenerSetter.add(rootScope)('dialog_unread', ({peerId}) => {\r\n      if(peerId === this.peerId) {\r\n        this.chat.input.setUnreadCount();\r\n\r\n        getHeavyAnimationPromise().then(() => {\r\n          this.updateUnreadByDialog();\r\n        });\r\n      }\r\n    });\r\n\r\n    this.listenerSetter.add(rootScope)('dialogs_multiupdate', (dialogs) => {\r\n      if(dialogs.has(this.peerId)) {\r\n        this.chat.input.setUnreadCount();\r\n      }\r\n    });\r\n\r\n    this.listenerSetter.add(rootScope)('dialog_notify_settings', (dialog) => {\r\n      if(this.peerId === dialog.peerId) {\r\n        this.chat.input.setUnreadCount();\r\n      }\r\n    });\r\n\r\n    this.listenerSetter.add(rootScope)('chat_update', async(chatId) => {\r\n      if(this.peerId === chatId.toPeerId(true)) {\r\n        const hadRights = this.chatInner.classList.contains('has-rights');\r\n        const hasRights = await this.chat.canSend();\r\n\r\n        if(hadRights !== hasRights) {\r\n          const callbacks = await Promise.all([\r\n            this.finishPeerChange(),\r\n            this.chat.input.finishPeerChange()\r\n          ]);\r\n\r\n          callbacks.forEach((callback) => callback());\r\n        }\r\n      }\r\n    });\r\n\r\n    this.listenerSetter.add(rootScope)('settings_updated', async({key}) => {\r\n      if(key === 'settings.emoji.big') {\r\n        const middleware = this.getMiddleware();\r\n        const mids = getObjectKeysAndSort(this.bubbles, 'desc');\r\n        const m = mids.map(async(mid) => {\r\n          const bubble = this.bubbles[mid];\r\n          if(bubble.classList.contains('can-have-big-emoji')) {\r\n            return {bubble, message: await this.chat.getMessage(mid)};\r\n          }\r\n        });\r\n\r\n        const awaited = await Promise.all(m);\r\n        if(!middleware()) {\r\n          return;\r\n        }\r\n\r\n        awaited.filter(Boolean).forEach(({bubble, message}) => {\r\n          if(this.bubbles[message.mid] !== bubble) {\r\n            return;\r\n          }\r\n\r\n          this.safeRenderMessage(message, true, bubble);\r\n        });\r\n      }\r\n    });\r\n\r\n    !DO_NOT_UPDATE_MESSAGE_VIEWS && this.listenerSetter.add(rootScope)('messages_views', (arr) => {\r\n      fastRaf(() => {\r\n        let scrollSaver: ScrollSaver;\r\n        for(const {peerId, views, mid} of arr) {\r\n          if(this.peerId !== peerId) continue;\r\n\r\n          const bubble = this.bubbles[mid];\r\n          if(!bubble) continue;\r\n\r\n          const postViewsElements = Array.from(bubble.querySelectorAll('.post-views')) as HTMLElement[];\r\n          if(!postViewsElements.length) continue;\r\n\r\n          const str = formatNumber(views, 1);\r\n          let different = false;\r\n          postViewsElements.forEach((postViews) => {\r\n            if(different || postViews.textContent !== str) {\r\n              if(!scrollSaver) {\r\n                scrollSaver = this.createScrollSaver(true);\r\n                scrollSaver.save();\r\n              }\r\n\r\n              different = true;\r\n              postViews.textContent = str;\r\n            }\r\n          });\r\n        }\r\n\r\n        if(scrollSaver) {\r\n          scrollSaver.restore();\r\n        }\r\n      });\r\n    });\r\n\r\n    this.observer = new SuperIntersectionObserver({root: this.scrollable.container});\r\n\r\n    this.listenerSetter.add(this.chat.appImManager)('chat_changing', ({to}) => {\r\n      const freeze = to !== this.chat;\r\n\r\n      const cb = () => {\r\n        this.observer.toggleObservingNew(freeze);\r\n      };\r\n\r\n      if(!freeze) {\r\n        setTimeout(() => {\r\n          cb();\r\n        }, 400);\r\n      } else {\r\n        cb();\r\n      }\r\n    });\r\n\r\n    this.sendViewCountersDebounced = debounce(() => {\r\n      const mids = [...this.viewsMids];\r\n      this.viewsMids.clear();\r\n\r\n      this.managers.appMessagesManager.incrementMessageViews(this.peerId, mids);\r\n    }, 1000, false, true);\r\n  }\r\n\r\n  private get peerId() {\r\n    return this.chat.peerId;\r\n  }\r\n\r\n  private createScrollSaver(reverse = true) {\r\n    const scrollSaver = new ScrollSaver(this.scrollable, '.bubble:not(.is-date)', reverse);\r\n    return scrollSaver;\r\n  }\r\n\r\n  private unreadedObserverCallback = (entry: IntersectionObserverEntry) => {\r\n    if(entry.isIntersecting) {\r\n      const target = entry.target as HTMLElement;\r\n      const mid = this.unreaded.get(target as HTMLElement);\r\n      this.onUnreadedInViewport(target, mid);\r\n    }\r\n  };\r\n\r\n  private viewsObserverCallback = (entry: IntersectionObserverEntry) => {\r\n    if(entry.isIntersecting) {\r\n      const mid = +(entry.target as HTMLElement).dataset.mid;\r\n      this.observer.unobserve(entry.target, this.viewsObserverCallback);\r\n\r\n      if(mid) {\r\n        this.viewsMids.add(mid);\r\n        this.sendViewCountersDebounced();\r\n      } else {\r\n        const {sponsoredMessage} = this;\r\n        if(sponsoredMessage && sponsoredMessage.random_id) {\r\n          delete sponsoredMessage.random_id;\r\n          this.managers.appChatsManager.viewSponsoredMessage(this.peerId.toChatId(), sponsoredMessage.random_id);\r\n        }\r\n      }\r\n    }\r\n  };\r\n\r\n  private stickerEffectObserverCallback = (entry: IntersectionObserverEntry) => {\r\n    if(entry.isIntersecting) {\r\n      this.observer.unobserve(entry.target, this.stickerEffectObserverCallback);\r\n\r\n      const attachmentDiv: HTMLElement = entry.target.querySelector('.attachment');\r\n      getHeavyAnimationPromise().then(() => {\r\n        if(isInDOM(attachmentDiv)) {\r\n          simulateClickEvent(attachmentDiv);\r\n        }\r\n      });\r\n    }\r\n  };\r\n\r\n  private createResizeObserver() {\r\n    if(!('ResizeObserver' in window) || this.resizeObserver) {\r\n      return;\r\n    }\r\n\r\n    const container = this.scrollable.container;\r\n    let wasHeight = 0/* container.offsetHeight */;\r\n    let resizing = false;\r\n    let skip = false;\r\n    let scrolled = 0;\r\n    let part = 0;\r\n    let rAF = 0;\r\n    // let skipNext = true;\r\n\r\n    const onResizeEnd = () => {\r\n      const height = container.offsetHeight;\r\n      const isScrolledDown = this.scrollable.isScrolledDown;\r\n      if(height !== wasHeight && (!skip || !isScrolledDown)) { // * fix opening keyboard while ESG is active, offsetHeight will change right between 'start' and this first frame\r\n        part += wasHeight - height;\r\n      }\r\n\r\n      /* if(DEBUG) {\r\n        this.log('resize end', scrolled, part, this.scrollable.scrollTop, height, wasHeight, this.scrollable.isScrolledDown);\r\n      } */\r\n\r\n      if(part) {\r\n        this.scrollable.setScrollTopSilently(this.scrollable.scrollTop + Math.round(part));\r\n      }\r\n\r\n      wasHeight = height;\r\n      scrolled = 0;\r\n      rAF = 0;\r\n      part = 0;\r\n      resizing = false;\r\n      skip = false;\r\n    };\r\n\r\n    const setEndRAF = (single: boolean) => {\r\n      if(rAF) window.cancelAnimationFrame(rAF);\r\n      rAF = window.requestAnimationFrame(single ? onResizeEnd : () => {\r\n        rAF = window.requestAnimationFrame(onResizeEnd);\r\n        // this.log('resize after RAF', part);\r\n      });\r\n    };\r\n\r\n    const processEntries: ResizeObserverCallback = (entries) => {\r\n      /* if(skipNext) {\r\n        skipNext = false;\r\n        return;\r\n      } */\r\n\r\n      if(skip) {\r\n        setEndRAF(false);\r\n        return;\r\n      }\r\n\r\n      const entry = entries[0];\r\n      const height = entry.contentRect.height;/* Math.ceil(entry.contentRect.height); */\r\n\r\n      if(!wasHeight) {\r\n        wasHeight = height;\r\n        return;\r\n      }\r\n\r\n      const realDiff = wasHeight - height;\r\n      let diff = realDiff + part;\r\n      const _part = diff % 1;\r\n      diff -= _part;\r\n\r\n      if(!resizing) {\r\n        resizing = true;\r\n\r\n        /* if(DEBUG) {\r\n          this.log('resize start', realDiff, this.scrollable.scrollTop, this.scrollable.container.offsetHeight, this.scrollable.isScrolledDown);\r\n        } */\r\n\r\n        if(realDiff < 0 && this.scrollable.isScrolledDown) {\r\n          // if(isSafari) { // * fix opening keyboard while ESG is active\r\n          part = -realDiff;\r\n          // }\r\n\r\n          skip = true;\r\n          setEndRAF(false);\r\n          return;\r\n        }\r\n      }\r\n\r\n      scrolled += diff;\r\n\r\n      /* if(DEBUG) {\r\n        this.log('resize', wasHeight - height, diff, this.scrollable.container.offsetHeight, this.scrollable.isScrolledDown, height, wasHeight);\r\n      } */\r\n\r\n      if(diff) {\r\n        const needScrollTop = this.scrollable.scrollTop + diff;\r\n        this.scrollable.setScrollTopSilently(needScrollTop);\r\n      }\r\n\r\n      setEndRAF(false);\r\n\r\n      part = _part;\r\n      wasHeight = height;\r\n    };\r\n\r\n    const resizeObserver = this.resizeObserver = new ResizeObserver(processEntries);\r\n    resizeObserver.observe(container);\r\n  }\r\n\r\n  private destroyResizeObserver() {\r\n    const resizeObserver = this.resizeObserver;\r\n    if(!resizeObserver) {\r\n      return;\r\n    }\r\n\r\n    resizeObserver.disconnect();\r\n    this.resizeObserver = undefined;\r\n  }\r\n\r\n  private onBubblesMouseMove = async(e: MouseEvent) => {\r\n    const content = findUpClassName(e.target, 'bubble-content');\r\n    if(content && !this.chat.selection.isSelecting) {\r\n      const bubble = findUpClassName(content, 'bubble');\r\n      if(!this.chat.selection.canSelectBubble(bubble)) {\r\n        this.unhoverPrevious();\r\n        return;\r\n      }\r\n\r\n      let {hoverBubble, hoverReaction} = this;\r\n      if(bubble === hoverBubble) {\r\n        return;\r\n      }\r\n\r\n      this.unhoverPrevious();\r\n\r\n      hoverBubble = this.hoverBubble = bubble;\r\n      hoverReaction = this.hoverReaction;\r\n      // hoverReaction = contentWrapper.querySelector('.bubble-hover-reaction');\r\n      if(!hoverReaction) {\r\n        hoverReaction = this.hoverReaction = document.createElement('div');\r\n        hoverReaction.classList.add('bubble-hover-reaction');\r\n\r\n        const stickerWrapper = document.createElement('div');\r\n        stickerWrapper.classList.add('bubble-hover-reaction-sticker');\r\n        hoverReaction.append(stickerWrapper);\r\n\r\n        content.append(hoverReaction);\r\n\r\n        let message = (await this.chat.getMessage(+bubble.dataset.mid)) as Message.message;\r\n        message = await this.managers.appMessagesManager.getGroupsFirstMessage(message);\r\n\r\n        const middleware = this.getMiddleware(() => this.hoverReaction === hoverReaction);\r\n        Promise.all([\r\n          this.managers.appReactionsManager.getAvailableReactionsByMessage(message),\r\n          pause(400)\r\n        ]).then(([availableReactions]) => {\r\n          const availableReaction = availableReactions[0];\r\n          if(!availableReaction) {\r\n            hoverReaction.remove();\r\n            return;\r\n          }\r\n\r\n          wrapSticker({\r\n            div: stickerWrapper,\r\n            doc: availableReaction.select_animation,\r\n            width: 18,\r\n            height: 18,\r\n            needUpscale: true,\r\n            middleware,\r\n            group: CHAT_ANIMATION_GROUP,\r\n            withThumb: false,\r\n            needFadeIn: false\r\n          }).then(({render}) => render).then((player) => {\r\n            assumeType<RLottiePlayer>(player);\r\n\r\n            player.addEventListener('firstFrame', () => {\r\n              if(!middleware()) {\r\n                // debugger;\r\n                return;\r\n              }\r\n\r\n              hoverReaction.dataset.loaded = '1';\r\n              this.setHoverVisible(hoverReaction, true);\r\n            }, {once: true});\r\n\r\n            attachClickEvent(hoverReaction, (e) => {\r\n              cancelEvent(e); // cancel triggering selection\r\n\r\n              this.managers.appReactionsManager.sendReaction(message, availableReaction.reaction);\r\n              this.unhoverPrevious();\r\n            }, {listenerSetter: this.listenerSetter});\r\n          }, noop);\r\n        });\r\n      } else if(hoverReaction.dataset.loaded) {\r\n        this.setHoverVisible(hoverReaction, true);\r\n      }\r\n    } else {\r\n      this.unhoverPrevious();\r\n    }\r\n  };\r\n\r\n  public setReactionsHoverListeners() {\r\n    this.listenerSetter.add(contextMenuController)('toggle', this.unhoverPrevious);\r\n    this.listenerSetter.add(overlayCounter)('change', this.unhoverPrevious);\r\n    this.listenerSetter.add(this.chat.selection)('toggle', this.unhoverPrevious);\r\n    this.listenerSetter.add(this.container)('mousemove', this.onBubblesMouseMove);\r\n  }\r\n\r\n  private setHoverVisible(hoverReaction: HTMLElement, visible: boolean) {\r\n    SetTransition(hoverReaction, 'is-visible', visible, 200, visible ? undefined : () => {\r\n      hoverReaction.remove();\r\n    }, 2);\r\n  }\r\n\r\n  private unhoverPrevious = () => {\r\n    const {hoverBubble, hoverReaction} = this;\r\n    if(hoverBubble) {\r\n      this.setHoverVisible(hoverReaction, false);\r\n      this.hoverBubble = undefined;\r\n      this.hoverReaction = undefined;\r\n    }\r\n  };\r\n\r\n  public setStickyDateManually() {\r\n    return;\r\n\r\n    const timestamps = Object.keys(this.dateMessages).map((k) => +k).sort((a, b) => b - a);\r\n    let lastVisible: HTMLElement;\r\n\r\n    // if(this.chatInner.classList.contains('is-scrolling')) {\r\n    const {scrollTop} = this.scrollable.container;\r\n    const isOverflown = scrollTop > 0;\r\n    if(isOverflown) {\r\n      for(const timestamp of timestamps) {\r\n        const dateMessage = this.dateMessages[timestamp];\r\n        const visibleRect = getVisibleRect(dateMessage.container, this.scrollable.container);\r\n        if(visibleRect && visibleRect.overflow.top) {\r\n          lastVisible = dateMessage.div;\r\n        } else if(lastVisible) {\r\n          break;\r\n        }\r\n      }\r\n    }\r\n    // }\r\n\r\n    if(lastVisible === this.previousStickyDate) {\r\n      return;\r\n    }\r\n\r\n    if(lastVisible) {\r\n      const needReflow = /* !!this.chat.setPeerPromise ||  */!this.previousStickyDate;\r\n      if(needReflow) {\r\n        lastVisible.classList.add('no-transition');\r\n      }\r\n\r\n      lastVisible.classList.add('is-sticky');\r\n\r\n      if(needReflow) {\r\n        void lastVisible.offsetLeft; // reflow\r\n        lastVisible.classList.remove('no-transition');\r\n      }\r\n    }\r\n\r\n    if(this.previousStickyDate && this.previousStickyDate !== lastVisible) {\r\n      this.previousStickyDate.classList.remove('is-sticky');\r\n    }\r\n\r\n    this.previousStickyDate = lastVisible;\r\n  }\r\n\r\n  public getRenderedLength() {\r\n    return Object.keys(this.bubbles).length - this.skippedMids.size;\r\n  }\r\n\r\n  private onUnreadedInViewport(target: HTMLElement, mid: number) {\r\n    this.unreadedSeen.add(mid);\r\n    this.observer.unobserve(target, this.unreadedObserverCallback);\r\n    this.unreaded.delete(target);\r\n    this.readUnreaded();\r\n  }\r\n\r\n  private readUnreaded() {\r\n    if(this.readPromise) return;\r\n\r\n    const middleware = this.getMiddleware();\r\n    this.readPromise = idleController.getFocusPromise().then(async() => {\r\n      if(!middleware()) return;\r\n      let maxId = Math.max(...Array.from(this.unreadedSeen));\r\n\r\n      // ? if message with maxId is not rendered ?\r\n      if(this.scrollable.loadedAll.bottom) {\r\n        const bubblesMaxId = Math.max(...Object.keys(this.bubbles).map((i) => +i));\r\n        if(maxId >= bubblesMaxId) {\r\n          maxId = Math.max((await this.chat.getHistoryMaxId()) || 0, maxId);\r\n        }\r\n      }\r\n\r\n      this.unreaded.forEach((mid, target) => {\r\n        if(mid <= maxId) {\r\n          this.onUnreadedInViewport(target, mid);\r\n        }\r\n      });\r\n\r\n      const readContents: number[] = [];\r\n      for(const mid of this.unreadedSeen) {\r\n        const message: MyMessage = await this.chat.getMessage(mid);\r\n        if(isMentionUnread(message)) {\r\n          readContents.push(mid);\r\n        }\r\n      }\r\n\r\n      this.managers.appMessagesManager.readMessages(this.peerId, readContents);\r\n\r\n      this.unreadedSeen.clear();\r\n\r\n      if(DEBUG) {\r\n        this.log('will readHistory by maxId:', maxId);\r\n      }\r\n\r\n      // return;\r\n\r\n      return this.managers.appMessagesManager.readHistory(this.peerId, maxId, this.chat.threadId).catch((err: any) => {\r\n        this.log.error('readHistory err:', err);\r\n        this.managers.appMessagesManager.readHistory(this.peerId, maxId, this.chat.threadId);\r\n      }).finally(() => {\r\n        if(!middleware()) return;\r\n        this.readPromise = undefined;\r\n\r\n        if(this.unreadedSeen.size) {\r\n          this.readUnreaded();\r\n        }\r\n      });\r\n    });\r\n  }\r\n\r\n  public constructPinnedHelpers() {\r\n    this.listenerSetter.add(rootScope)('peer_pinned_messages', (e) => {\r\n      const {peerId, mids, pinned} = e;\r\n      if(peerId !== this.peerId) return;\r\n\r\n      if(mids) {\r\n        if(!pinned) {\r\n          this.deleteMessagesByIds(mids);\r\n        }\r\n      }\r\n    });\r\n  }\r\n\r\n  public constructScheduledHelpers() {\r\n    const onUpdate = async() => {\r\n      this.chat.topbar.setTitle((await this.managers.appMessagesManager.getScheduledMessagesStorage(this.peerId)).size);\r\n    };\r\n\r\n    this.listenerSetter.add(rootScope)('scheduled_new', (message) => {\r\n      if(message.peerId !== this.peerId) return;\r\n\r\n      this.renderNewMessage(message);\r\n      onUpdate();\r\n    });\r\n\r\n    this.listenerSetter.add(rootScope)('scheduled_delete', ({peerId, mids}) => {\r\n      if(peerId !== this.peerId) return;\r\n\r\n      this.deleteMessagesByIds(mids);\r\n      onUpdate();\r\n    });\r\n  }\r\n\r\n  public onBubblesClick = async(e: Event) => {\r\n    let target = e.target as HTMLElement;\r\n    let bubble: HTMLElement = null;\r\n    try {\r\n      bubble = findUpClassName(target, 'bubble');\r\n    } catch(err) {}\r\n\r\n    if(!bubble && !this.chat.selection.isSelecting) {\r\n      const avatar = findUpClassName(target, 'user-avatar');\r\n      if(!avatar) {\r\n        return;\r\n      }\r\n\r\n      const peerId = avatar.dataset.peerId.toPeerId();\r\n      if(peerId !== NULL_PEER_ID) {\r\n        this.chat.appImManager.setInnerPeer({peerId});\r\n      } else {\r\n        toast(I18n.format('HidAccount', true));\r\n      }\r\n      return;\r\n    }\r\n\r\n    if(bubble.classList.contains('is-date') && findUpClassName(target, 'bubble-content')) {\r\n      if(bubble.classList.contains('is-sticky') && !this.chatInner.classList.contains('is-scrolling')) {\r\n        return;\r\n      }\r\n\r\n      for(const timestamp in this.dateMessages) {\r\n        const d = this.dateMessages[timestamp];\r\n        if(d.div === bubble) {\r\n          PopupElement.createPopup(PopupDatePicker, new Date(+timestamp), this.onDatePick).show();\r\n          break;\r\n        }\r\n      }\r\n\r\n      return;\r\n    }\r\n\r\n    if(!IS_TOUCH_SUPPORTED && findUpClassName(target, 'time')) {\r\n      this.chat.selection.toggleByElement(bubble);\r\n      return;\r\n    }\r\n\r\n    // ! Trusted - due to audio autoclick\r\n    if(this.chat.selection.isSelecting && e.isTrusted) {\r\n      if(bubble.classList.contains('service') && bubble.dataset.mid === undefined) {\r\n        return;\r\n      }\r\n\r\n      cancelEvent(e);\r\n      // console.log('bubble click', e);\r\n\r\n      if(IS_TOUCH_SUPPORTED && this.chat.selection.selectedText) {\r\n        this.chat.selection.selectedText = undefined;\r\n        return;\r\n      }\r\n\r\n      // this.chatSelection.toggleByBubble(bubble);\r\n      this.chat.selection.toggleByElement(findUpClassName(target, 'grouped-item') || bubble);\r\n      return;\r\n    }\r\n\r\n    const contactDiv: HTMLElement = findUpClassName(target, 'contact');\r\n    if(contactDiv) {\r\n      this.chat.appImManager.setInnerPeer({\r\n        peerId: contactDiv.dataset.peerId.toPeerId()\r\n      });\r\n      return;\r\n    }\r\n\r\n    const callDiv: HTMLElement = findUpClassName(target, 'bubble-call');\r\n    if(callDiv) {\r\n      this.chat.appImManager.callUser(this.peerId.toUserId(), callDiv.dataset.type as any);\r\n      return;\r\n    }\r\n\r\n    const buyButton: HTMLElement = findUpClassName(target, 'is-buy');\r\n    if(buyButton) {\r\n      cancelEvent(e);\r\n\r\n      const message = await this.chat.getMessage(+bubble.dataset.mid);\r\n      if(!message) {\r\n        return;\r\n      }\r\n\r\n      new PopupPayment(\r\n        message as Message.message,\r\n        await this.managers.appPaymentsManager.getInputInvoiceByPeerId(message.peerId, message.mid)\r\n      );\r\n      return;\r\n    }\r\n\r\n    const reactionElement = findUpTag(target, 'REACTION-ELEMENT') as ReactionElement;\r\n    if(reactionElement) {\r\n      cancelEvent(e);\r\n      if(reactionElement.classList.contains('is-inactive')) {\r\n        return;\r\n      }\r\n\r\n      const reactionsElement = reactionElement.parentElement as ReactionsElement;\r\n      const reactionCount = reactionsElement.getReactionCount(reactionElement);\r\n\r\n      const message = reactionsElement.getMessage();\r\n      this.managers.appReactionsManager.sendReaction(message, reactionCount.reaction);\r\n\r\n      return;\r\n    }\r\n\r\n    const stickerEmojiEl = findUpAttribute(target, 'data-sticker-emoji');\r\n    if(stickerEmojiEl) {\r\n      onEmojiStickerClick({\r\n        event: e,\r\n        container: stickerEmojiEl,\r\n        managers: this.managers,\r\n        middleware: this.getMiddleware(),\r\n        peerId: this.peerId\r\n      });\r\n\r\n      return;\r\n    }\r\n\r\n    const commentsDiv: HTMLElement = findUpClassName(target, 'replies');\r\n    if(commentsDiv) {\r\n      const bubbleMid = +bubble.dataset.mid;\r\n      if(this.peerId === REPLIES_PEER_ID) {\r\n        const message = await this.chat.getMessage(bubbleMid) as Message.message;\r\n        const peerId = getPeerId(message.reply_to.reply_to_peer_id);\r\n        const threadId = message.reply_to.reply_to_top_id;\r\n        const lastMsgId = message.fwd_from.saved_from_msg_id;\r\n        this.chat.appImManager.openThread(peerId, lastMsgId, threadId);\r\n      } else {\r\n        const message1 = await this.chat.getMessage(bubbleMid);\r\n        const message = await this.managers.appMessagesManager.getMessageWithReplies(message1 as Message.message);\r\n        const replies = message.replies;\r\n        if(replies) {\r\n          this.managers.appMessagesManager.getDiscussionMessage(this.peerId, message.mid).then((message) => {\r\n            this.chat.appImManager.setInnerPeer({\r\n              peerId: replies.channel_id.toPeerId(true),\r\n              type: 'discussion',\r\n              threadId: (message as MyMessage).mid\r\n            });\r\n          });\r\n        }\r\n      }\r\n\r\n      return;\r\n    }\r\n\r\n    const via = findUpClassName(target, 'is-via');\r\n    if(via) {\r\n      const el = via.querySelector('.peer-title') as HTMLElement;\r\n      if(target === el || findUpAsChild(target, el)) {\r\n        const message = el.innerText + ' ';\r\n        this.managers.appDraftsManager.setDraft(this.peerId, this.chat.threadId, message);\r\n        cancelEvent(e);\r\n\r\n        return;\r\n      }\r\n    }\r\n\r\n    const nameDiv = findUpClassName(target, 'peer-title') || findUpTag(target, 'AVATAR-ELEMENT') || findUpAttribute(target, 'data-saved-from');\r\n    if(nameDiv && nameDiv !== bubble) {\r\n      target = nameDiv || target;\r\n      const peerIdStr = target.dataset.peerId || target.getAttribute('peer') || (target as AvatarElement).peerId;\r\n      const savedFrom = target.dataset.savedFrom;\r\n      if(typeof(peerIdStr) === 'string' || savedFrom) {\r\n        if(savedFrom) {\r\n          const [peerId, mid] = savedFrom.split('_');\r\n          if(target.classList.contains('is-receipt-link')) {\r\n            const message = await this.managers.appMessagesManager.getMessageByPeer(peerId.toPeerId(), +mid);\r\n            if(message) {\r\n              const inputInvoice = await this.managers.appPaymentsManager.getInputInvoiceByPeerId(this.peerId, +bubble.dataset.mid);\r\n              new PopupPayment(message as Message.message, inputInvoice);\r\n            }\r\n          } else {\r\n            this.chat.appImManager.setInnerPeer({\r\n              peerId: peerId.toPeerId(),\r\n              lastMsgId: +mid\r\n            });\r\n          }\r\n        } else {\r\n          const peerId = peerIdStr.toPeerId();\r\n          if(peerId !== NULL_PEER_ID) {\r\n            this.chat.appImManager.setInnerPeer({peerId});\r\n          } else {\r\n            toast(I18n.format('HidAccount', true));\r\n          }\r\n        }\r\n      }\r\n\r\n      return;\r\n    }\r\n\r\n    // this.log('chatInner click:', target);\r\n    // const isVideoComponentElement = target.tagName === 'SPAN' && findUpClassName(target, 'media-container');\r\n    /* if(isVideoComponentElement) {\r\n      const video = target.parentElement.querySelector('video') as HTMLElement;\r\n      if(video) {\r\n        video.click(); // hot-fix for time and play button\r\n        return;\r\n      }\r\n    } */\r\n\r\n    if(bubble.classList.contains('sticker') && target.parentElement.classList.contains('attachment')) {\r\n      const messageId = +bubble.dataset.mid;\r\n      const message = await this.chat.getMessage(messageId);\r\n\r\n      const doc = ((message as Message.message).media as MessageMedia.messageMediaDocument)?.document as Document.document;\r\n\r\n      if(doc?.stickerSetInput) {\r\n        new PopupStickers(doc.stickerSetInput).show();\r\n      }\r\n\r\n      return;\r\n    }\r\n\r\n    const documentDiv = findUpClassName(target, 'document-with-thumb');\r\n    if((target.tagName === 'IMG' && !target.classList.contains('emoji') && !target.classList.contains('document-thumb')) ||\r\n      target.classList.contains('album-item') ||\r\n      // || isVideoComponentElement\r\n      (target.tagName === 'VIDEO' && !bubble.classList.contains('round')) ||\r\n      (documentDiv && !documentDiv.querySelector('.preloader-container')) ||\r\n      target.classList.contains('canvas-thumbnail')) {\r\n      const groupedItem = findUpClassName(target, 'album-item') || findUpClassName(target, 'document-container');\r\n      const preloader = (groupedItem || bubble).querySelector<HTMLElement>('.preloader-container');\r\n      if(preloader) {\r\n        simulateClickEvent(preloader);\r\n        cancelEvent(e);\r\n        return;\r\n      }\r\n\r\n      cancelEvent(e);\r\n      const messageId = +(groupedItem || bubble).dataset.mid;\r\n      const message = await this.chat.getMessage(messageId);\r\n      if(!message) {\r\n        this.log.warn('no message by messageId:', messageId);\r\n        return;\r\n      }\r\n\r\n      const SINGLE_MEDIA_CLASSNAME = 'webpage';\r\n      const isSingleMedia = bubble.classList.contains(SINGLE_MEDIA_CLASSNAME);\r\n\r\n      const f = documentDiv ? (media: any) => {\r\n        return AppMediaViewer.isMediaCompatibleForDocumentViewer(media);\r\n      } : (media: any) => {\r\n        return media._ === 'photo' || ['video', 'gif'].includes(media.type);\r\n      };\r\n\r\n      const targets: {element: HTMLElement, mid: number, peerId: PeerId}[] = [];\r\n      const ids = isSingleMedia ? [messageId] : (await Promise.all(Object.keys(this.bubbles).map((k) => +k).map(async(mid) => {\r\n        /* if(isSingleMedia && !this.bubbles[id].classList.contains(SINGLE_MEDIA_CLASSNAME)) {\r\n          return false;\r\n        }  */\r\n        // if(!this.scrollable.visibleElements.find((e) => e.element === this.bubbles[id])) return false;\r\n\r\n        const message = await this.chat.getMessage(mid);\r\n        const media = getMediaFromMessage(message);\r\n\r\n        return media && f(media) && mid;\r\n      }))).filter(Boolean).sort((a, b) => a - b);\r\n\r\n      ids.forEach((id) => {\r\n        let selector: string;\r\n        if(documentDiv) {\r\n          selector = '.document-container';\r\n        } else {\r\n          const withTail = this.bubbles[id].classList.contains('with-media-tail');\r\n          selector = '.album-item video, .album-item img, .preview video, .preview img, ';\r\n          if(withTail) {\r\n            selector += '.bubble__media-container';\r\n          } else {\r\n            selector += '.attachment video, .attachment img';\r\n          }\r\n        }\r\n\r\n        const elements = Array.from(this.bubbles[id].querySelectorAll(selector)) as HTMLElement[];\r\n        const parents: Set<HTMLElement> = new Set();\r\n        if(documentDiv) {\r\n          elements.forEach((element) => {\r\n            targets.push({\r\n              element: element.querySelector('.document-ico'),\r\n              mid: +element.dataset.mid,\r\n              peerId: this.peerId\r\n            });\r\n          });\r\n        } else {\r\n          const hasAspecter = !!this.bubbles[id].querySelector('.media-container-aspecter');\r\n          elements.forEach((element) => {\r\n            if(hasAspecter && !findUpClassName(element, 'media-container-aspecter')) return;\r\n            const albumItem = findUpClassName(element, 'album-item');\r\n            const parent = albumItem || element.parentElement;\r\n            if(parents.has(parent)) return;\r\n            parents.add(parent);\r\n            targets.push({\r\n              element,\r\n              mid: albumItem ? +albumItem.dataset.mid : id,\r\n              peerId: this.peerId\r\n            });\r\n          });\r\n        }\r\n      });\r\n\r\n      targets.sort((a, b) => a.mid - b.mid);\r\n\r\n      const idx = targets.findIndex((t) => t.mid === messageId);\r\n\r\n      if(DEBUG) {\r\n        this.log('open mediaViewer single with ids:', ids, idx, targets);\r\n      }\r\n\r\n      if(!targets[idx]) {\r\n        this.log('no target for media viewer!', target);\r\n        return;\r\n      }\r\n\r\n      new AppMediaViewer()\r\n      .setSearchContext({\r\n        threadId: this.chat.threadId,\r\n        peerId: this.peerId,\r\n        inputFilter: {_: documentDiv ? 'inputMessagesFilterDocument' : 'inputMessagesFilterPhotoVideo'},\r\n        useSearch: this.chat.type !== 'scheduled' && !isSingleMedia,\r\n        isScheduled: this.chat.type === 'scheduled'\r\n      })\r\n      .openMedia(message, targets[idx].element, 0, true, targets.slice(0, idx), targets.slice(idx + 1));\r\n\r\n      // appMediaViewer.openMedia(message, target as HTMLImageElement);\r\n      return;\r\n    }\r\n\r\n    if(['IMG', 'DIV', 'SPAN'/* , 'A' */].indexOf(target.tagName) === -1) target = findUpTag(target, 'DIV');\r\n\r\n    if(['DIV', 'SPAN'].indexOf(target.tagName) !== -1/*  || target.tagName === 'A' */) {\r\n      if(target.classList.contains('goto-original')) {\r\n        const savedFrom = bubble.dataset.savedFrom;\r\n        const [peerId, mid] = savedFrom.split('_');\r\n        // //this.log('savedFrom', peerId, msgID);\r\n        this.chat.appImManager.setInnerPeer({\r\n          peerId: peerId.toPeerId(),\r\n          lastMsgId: +mid\r\n        });\r\n        return;\r\n      } else if(target.classList.contains('forward')) {\r\n        const mid = +bubble.dataset.mid;\r\n        const message = await this.managers.appMessagesManager.getMessageByPeer(this.peerId, mid);\r\n        new PopupForward({\r\n          [this.peerId]: await this.managers.appMessagesManager.getMidsByMessage(message)\r\n        });\r\n        // appSidebarRight.forwardTab.open([mid]);\r\n        return;\r\n      }\r\n\r\n      let isReplyClick = false;\r\n\r\n      try {\r\n        isReplyClick = !!findUpClassName(e.target, 'reply');\r\n      } catch(err) {}\r\n\r\n      if(isReplyClick && bubble.classList.contains('is-reply')/*  || bubble.classList.contains('forwarded') */) {\r\n        const bubbleMid = +bubble.dataset.mid;\r\n        this.replyFollowHistory.push(bubbleMid);\r\n\r\n        const message = (await this.chat.getMessage(bubbleMid)) as Message.message;\r\n\r\n        const replyToPeerId = message.reply_to.reply_to_peer_id ? getPeerId(message.reply_to.reply_to_peer_id) : this.peerId;\r\n        const replyToMid = message.reply_to.reply_to_msg_id;\r\n\r\n        this.chat.appImManager.setInnerPeer({\r\n          peerId: replyToPeerId,\r\n          lastMsgId: replyToMid,\r\n          type: this.chat.type,\r\n          threadId: this.chat.threadId\r\n        });\r\n\r\n        /* if(this.chat.type === 'discussion') {\r\n          this.chat.appImManager.setMessageId(, originalMessageId);\r\n        } else {\r\n          this.chat.appImManager.setInnerPeer(this.peerId, originalMessageId);\r\n        } */\r\n        // this.chat.setMessageId(, originalMessageId);\r\n      }\r\n    }\r\n\r\n    // console.log('chatInner click', e);\r\n  };\r\n\r\n  public async onGoDownClick() {\r\n    if(!this.replyFollowHistory.length) {\r\n      // this.onScroll(true, undefined, true);\r\n      this.chat.setMessageId(/* , dialog.top_message */);\r\n      // const dialog = this.appMessagesManager.getDialogByPeerId(this.peerId)[0];\r\n\r\n      // if(dialog) {\r\n      //   this.chat.setPeer(this.peerId/* , dialog.top_message */);\r\n      // } else {\r\n      //   this.log('will scroll down 3');\r\n      //   this.scroll.scrollTop = this.scroll.scrollHeight;\r\n      // }\r\n\r\n      return;\r\n    }\r\n\r\n    const middleware = this.getMiddleware();\r\n    const slice = this.replyFollowHistory.slice();\r\n    const messages = await Promise.all(slice.map((mid) => this.chat.getMessage(mid)));\r\n    if(!middleware()) return;\r\n\r\n    slice.forEach((mid, idx) => {\r\n      const message = messages[idx];\r\n\r\n      const bubble = this.bubbles[mid];\r\n      let bad = true;\r\n      if(bubble) {\r\n        const rect = bubble.getBoundingClientRect();\r\n        bad = (windowSize.height / 2) > rect.top;\r\n      } else if(message) {\r\n        bad = false;\r\n      }\r\n\r\n      if(bad) {\r\n        this.replyFollowHistory.splice(this.replyFollowHistory.indexOf(mid), 1);\r\n      }\r\n    });\r\n\r\n    this.replyFollowHistory.sort((a, b) => b - a);\r\n\r\n    const mid = this.replyFollowHistory.pop();\r\n    this.chat.setMessageId(mid);\r\n  }\r\n\r\n  public getBubbleByPoint(verticalSide: 'top' | 'bottom') {\r\n    let element = getElementByPoint(this.scrollable.container, verticalSide, 'center');\r\n    /* if(element) {\r\n      if(element.classList.contains('bubbles-date-group')) {\r\n        const children = Array.from(element.children) as HTMLElement[];\r\n        if(verticalSide === 'top') {\r\n          element = children[this.stickyIntersector ? 2 : 1];\r\n        } else {\r\n          element = children[children.length - 1];\r\n        }\r\n      } else {\r\n        element = findUpClassName(element, 'bubble');\r\n        if(element && element.classList.contains('is-date')) {\r\n          element = element.nextElementSibling as HTMLElement;\r\n        }\r\n      }\r\n    } */\r\n    if(element) element = findUpClassName(element, 'bubble');\r\n\r\n    return element;\r\n  }\r\n\r\n  public async getGroupedBubble(groupId: string) {\r\n    const mids = await this.managers.appMessagesManager.getMidsByAlbum(groupId);\r\n    for(const mid of mids) {\r\n      if(this.bubbles[mid] && !this.skippedMids.has(mid)) {\r\n        // const maxId = Math.max(...mids); // * because in scheduled album can be rendered by lowest mid during sending\r\n        return {\r\n          bubble: this.bubbles[mid],\r\n          mid: mid\r\n          // message: await this.chat.getMessage(maxId) as Message.message\r\n        };\r\n      }\r\n    }\r\n  }\r\n\r\n  public getBubbleGroupedItems(bubble: HTMLElement) {\r\n    return Array.from(bubble.querySelectorAll('.grouped-item')) as HTMLElement[];\r\n  }\r\n\r\n  public async getMountedBubble(mid: number, message?: Message.message | Message.messageService) {\r\n    if(message === undefined) {\r\n      message = await this.chat.getMessage(mid);\r\n    }\r\n\r\n    if(!message) {\r\n      return;\r\n    }\r\n\r\n    const groupedId = (message as Message.message).grouped_id;\r\n    if(groupedId) {\r\n      const a = await this.getGroupedBubble(groupedId);\r\n      if(a) {\r\n        a.bubble = a.bubble.querySelector(`.document-container[data-mid=\"${mid}\"]`) || a.bubble;\r\n        return a;\r\n      }\r\n    }\r\n\r\n    const bubble = this.bubbles[mid];\r\n    if(!bubble) return;\r\n\r\n    return {bubble, mid};\r\n  }\r\n\r\n  private findNextMountedBubbleByMsgId(mid: number, prev?: boolean) {\r\n    const mids = getObjectKeysAndSort(this.bubbles, prev ? 'desc' : 'asc');\r\n\r\n    let filterCallback: (_mid: number) => boolean;\r\n    if(prev) filterCallback = (_mid) => _mid < mid;\r\n    else filterCallback = (_mid) => mid < _mid;\r\n\r\n    const foundMid = mids.find((_mid) => {\r\n      if(!filterCallback(_mid)) return false;\r\n      return !!this.bubbles[_mid]?.parentElement;\r\n    });\r\n\r\n    return this.bubbles[foundMid];\r\n  }\r\n\r\n  public loadMoreHistory(top: boolean, justLoad = false) {\r\n    // this.log('loadMoreHistory', top);\r\n    if(\r\n      !this.peerId ||\r\n      /* TEST_SCROLL || */\r\n      this.chat.setPeerPromise ||\r\n      this.isHeavyAnimationInProgress ||\r\n      (top && (this.getHistoryTopPromise || this.scrollable.loadedAll.top)) ||\r\n      (!top && (this.getHistoryBottomPromise || this.scrollable.loadedAll.bottom))\r\n    ) {\r\n      return;\r\n    }\r\n\r\n    // warning,         (     )\r\n    // some messages can have negative id (such as sponsored message)\r\n    const history = Object.keys(this.bubbles)\r\n    .map((id) => +id)\r\n    .filter((id) => id > 0 && !this.skippedMids.has(id))\r\n    .sort((a, b) => a - b);\r\n\r\n    if(!history.length) {\r\n      history.push(0);\r\n    }\r\n\r\n    if(top) {\r\n      if(DEBUG) {\r\n        this.log('Will load more (up) history by id:', history[0], 'maxId:', history[history.length - 1], justLoad/* , history */);\r\n      }\r\n\r\n      this.getHistory1(history[0], true, undefined, undefined, justLoad);\r\n    } else {\r\n      // let dialog = this.appMessagesManager.getDialogByPeerId(this.peerId)[0];\r\n      // const historyMaxId = await this.chat.getHistoryMaxId();\r\n\r\n      // // if scroll down after search\r\n      // if(history.indexOf(historyMaxId) !== -1) {\r\n      //   this.setLoaded('bottom', true);\r\n      //   return;\r\n      // }\r\n\r\n      if(DEBUG) {\r\n        this.log('Will load more (down) history by id:', history[history.length - 1], justLoad/* , history */);\r\n      }\r\n\r\n      this.getHistory1(history[history.length - 1], false, true, undefined, justLoad);\r\n    }\r\n  }\r\n\r\n  public onScroll = (ignoreHeavyAnimation?: boolean, scrollDimensions?: ScrollStartCallbackDimensions, forceDown?: boolean) => {\r\n    // return;\r\n\r\n    if(this.isHeavyAnimationInProgress) {\r\n      if(this.sliceViewportDebounced) {\r\n        this.sliceViewportDebounced.clearTimeout();\r\n      }\r\n\r\n      // *   ,         ,          \r\n      if(this.scrolledDown && !ignoreHeavyAnimation) {\r\n        return;\r\n      }\r\n    } else {\r\n      if(this.chat.topbar.pinnedMessage) {\r\n        this.chat.topbar.pinnedMessage.setCorrectIndexThrottled(this.scrollable.lastScrollDirection);\r\n      }\r\n\r\n      if(this.sliceViewportDebounced) {\r\n        this.sliceViewportDebounced();\r\n      }\r\n\r\n      this.setStickyDateManually();\r\n    }\r\n\r\n    // lottieLoader.checkAnimations(false, 'chat');\r\n\r\n    if(scrollDimensions && scrollDimensions.distanceToEnd < SCROLLED_DOWN_THRESHOLD && this.scrolledDown) {\r\n      return;\r\n    }\r\n\r\n    const distanceToEnd = forceDown ? 0 : scrollDimensions?.distanceToEnd ?? this.scrollable.getDistanceToEnd();\r\n    if(/* !IS_TOUCH_SUPPORTED &&  */(this.scrollable.lastScrollDirection !== 0 && distanceToEnd > 0) || scrollDimensions || forceDown) {\r\n    // if(/* !IS_TOUCH_SUPPORTED &&  */(this.scrollable.lastScrollDirection !== 0 || scrollDimensions) && distanceToEnd > 0) {\r\n      if(this.isScrollingTimeout) {\r\n        clearTimeout(this.isScrollingTimeout);\r\n      } else if(!this.chatInner.classList.contains('is-scrolling')) {\r\n        this.chatInner.classList.add('is-scrolling');\r\n      }\r\n\r\n      this.isScrollingTimeout = window.setTimeout(() => {\r\n        this.chatInner.classList.remove('is-scrolling');\r\n        this.isScrollingTimeout = 0;\r\n      }, 1350 + (scrollDimensions?.duration ?? 0));\r\n    }\r\n\r\n    if(distanceToEnd < SCROLLED_DOWN_THRESHOLD && (forceDown || this.scrollable.loadedAll.bottom || this.chat.setPeerPromise || !this.peerId)) {\r\n      this.container.classList.add('scrolled-down');\r\n      this.scrolledDown = true;\r\n    } else if(this.container.classList.contains('scrolled-down')) {\r\n      this.container.classList.remove('scrolled-down');\r\n      this.scrolledDown = false;\r\n    }\r\n  };\r\n\r\n  public setScroll() {\r\n    if(this.scrollable) {\r\n      this.destroyScrollable();\r\n    }\r\n\r\n    this.scrollable = new Scrollable(null, 'IM', /* 10300 */300);\r\n    this.setLoaded('top', false, false);\r\n    this.setLoaded('bottom', false, false);\r\n\r\n    this.scrollable.container.append(this.chatInner);\r\n\r\n    /* const getScrollOffset = () => {\r\n      //return Math.round(Math.max(300, appPhotosManager.windowH / 1.5));\r\n      return 300;\r\n    };\r\n\r\n    window.addEventListener('resize', () => {\r\n      this.scrollable.onScrollOffset = getScrollOffset();\r\n    });\r\n\r\n    this.scrollable = new Scrollable(this.bubblesContainer, 'y', 'IM', this.chatInner, getScrollOffset()); */\r\n\r\n    this.scrollable.onAdditionalScroll = this.onScroll;\r\n    this.scrollable.onScrolledTop = () => this.loadMoreHistory(true);\r\n    this.scrollable.onScrolledBottom = () => this.loadMoreHistory(false);\r\n    // this.scrollable.attachSentinels(undefined, 300);\r\n\r\n    if(IS_TOUCH_SUPPORTED && false) {\r\n      this.scrollable.container.addEventListener('touchmove', () => {\r\n        if(this.isScrollingTimeout) {\r\n          clearTimeout(this.isScrollingTimeout);\r\n        } else if(!this.chatInner.classList.contains('is-scrolling')) {\r\n          this.chatInner.classList.add('is-scrolling');\r\n        }\r\n      }, {passive: true});\r\n\r\n      this.scrollable.container.addEventListener('touchend', () => {\r\n        if(!this.chatInner.classList.contains('is-scrolling')) {\r\n          return;\r\n        }\r\n\r\n        if(this.isScrollingTimeout) {\r\n          clearTimeout(this.isScrollingTimeout);\r\n        }\r\n\r\n        this.isScrollingTimeout = window.setTimeout(() => {\r\n          this.chatInner.classList.remove('is-scrolling');\r\n          this.isScrollingTimeout = 0;\r\n        }, 1350);\r\n      }, {passive: true});\r\n    }\r\n  }\r\n\r\n  public async updateUnreadByDialog() {\r\n    const historyStorage = await this.chat.getHistoryStorage();\r\n    const maxId = this.peerId === rootScope.myId ? historyStorage.readMaxId : historyStorage.readOutboxMaxId;\r\n\r\n    // /////this.log('updateUnreadByDialog', maxId, dialog, this.unreadOut);\r\n\r\n    for(const msgId of this.unreadOut) {\r\n      if(msgId > 0 && msgId <= maxId) {\r\n        const bubble = this.bubbles[msgId];\r\n        if(bubble) {\r\n          this.unreadOut.delete(msgId);\r\n\r\n          if(bubble.classList.contains('is-outgoing') || bubble.classList.contains('is-error')) {\r\n            continue;\r\n          }\r\n\r\n          bubble.classList.remove('is-sent', 'is-sending', 'is-outgoing'); // is-sending can be when there are bulk of updates (e.g. sending command to Stickers bot)\r\n          bubble.classList.add('is-read');\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  public deleteMessagesByIds(mids: number[], permanent = true, ignoreOnScroll?: boolean) {\r\n    let deleted = false;\r\n    mids.forEach((mid) => {\r\n      const bubble = this.bubbles[mid];\r\n      if(!bubble) return;\r\n\r\n      bubble.middlewareHelper.destroy();\r\n\r\n      deleted = true;\r\n      /* const mounted = this.getMountedBubble(mid);\r\n      if(!mounted) return; */\r\n\r\n      delete this.bubbles[mid];\r\n      this.skippedMids.delete(mid);\r\n\r\n      if(this.firstUnreadBubble === bubble) {\r\n        this.firstUnreadBubble = null;\r\n      }\r\n\r\n      this.bubbleGroups.removeAndUnmountBubble(bubble);\r\n      if(this.observer) {\r\n        this.observer.unobserve(bubble, this.unreadedObserverCallback);\r\n        this.unreaded.delete(bubble);\r\n\r\n        this.observer.unobserve(bubble, this.viewsObserverCallback);\r\n        this.viewsMids.delete(mid);\r\n\r\n        this.observer.unobserve(bubble, this.stickerEffectObserverCallback);\r\n      }\r\n\r\n      if(this.emptyPlaceholderBubble === bubble) {\r\n        this.emptyPlaceholderBubble = undefined;\r\n      }\r\n\r\n      // this.reactions.delete(mid);\r\n    });\r\n\r\n    if(!deleted) {\r\n      return;\r\n    }\r\n\r\n    this.scrollable.ignoreNextScrollEvent();\r\n    if(permanent && this.chat.selection.isSelecting) {\r\n      this.chat.selection.deleteSelectedMids(this.peerId, mids);\r\n    }\r\n\r\n    animationIntersector.checkAnimations(false, CHAT_ANIMATION_GROUP);\r\n    this.deleteEmptyDateGroups();\r\n\r\n    if(!ignoreOnScroll) {\r\n      this.scrollable.onScroll();\r\n      // this.onScroll();\r\n    }\r\n  }\r\n\r\n  private setTopPadding(middleware = this.getMiddleware()) {\r\n    let isPaddingNeeded = false;\r\n    let setPaddingTo: HTMLElement;\r\n    if(!this.isTopPaddingSet && this.chat.type !== 'scheduled') {\r\n      const {clientHeight, scrollHeight} = this.scrollable.container;\r\n      isPaddingNeeded = clientHeight === scrollHeight;\r\n      /* const firstEl = this.chatInner.firstElementChild as HTMLElement;\r\n      if(this.chatInner.firstElementChild) {\r\n        const visibleRect = getVisibleRect(firstEl, this.scrollable.container);\r\n        isPaddingNeeded = !visibleRect.overflow.top && (visibleRect.rect.top - firstEl.offsetTop) !== this.scrollable.container.getBoundingClientRect().top;\r\n      } else {\r\n        isPaddingNeeded = true;\r\n      } */\r\n\r\n      if(isPaddingNeeded) {\r\n        /* const add = clientHeight - scrollHeight;\r\n        this.chatInner.style.paddingTop = add + 'px';\r\n        this.scrollable.scrollTop += add; */\r\n        setPaddingTo = this.chatInner;\r\n        setPaddingTo.style.paddingTop = clientHeight + 'px';\r\n        this.scrollable.setScrollTopSilently(scrollHeight);\r\n        this.isTopPaddingSet = true;\r\n      }\r\n    }\r\n\r\n    return {\r\n      isPaddingNeeded,\r\n      unsetPadding: isPaddingNeeded ? () => {\r\n        if(middleware() && isPaddingNeeded) {\r\n          setPaddingTo.style.paddingTop = '';\r\n          this.isTopPaddingSet = false;\r\n        }\r\n      } : undefined\r\n    };\r\n  }\r\n\r\n  private renderNewMessage(message: MyMessage, scrolledDown?: boolean) {\r\n    const promise = this._renderNewMessage(message, scrolledDown);\r\n    this.renderNewPromises.add(promise);\r\n    promise.catch(noop).finally(() => {\r\n      this.renderNewPromises.delete(promise);\r\n    });\r\n    return promise;\r\n  }\r\n\r\n  private async _renderNewMessage(message: MyMessage, scrolledDown?: boolean) {\r\n    if(!this.scrollable.loadedAll.bottom) { // seems search active or sliced\r\n      // this.log('renderNewMessagesByIds: seems search is active, skipping render:', mids);\r\n      const setPeerPromise = this.chat.setPeerPromise;\r\n      if(setPeerPromise) {\r\n        const middleware = this.getMiddleware();\r\n        setPeerPromise.then(async() => {\r\n          if(!middleware()) return;\r\n          const newMessage = await this.chat.getMessage(message.mid);\r\n          if(!middleware()) return;\r\n          this.renderNewMessage(newMessage);\r\n        });\r\n      }\r\n\r\n      return;\r\n    }\r\n\r\n    if(this.chat.threadId) {\r\n      const replyTo = message?.reply_to as MessageReplyHeader;\r\n      if(!(replyTo && (replyTo.reply_to_top_id || replyTo.reply_to_msg_id) === this.chat.threadId)) {\r\n        return;\r\n      }\r\n    }\r\n\r\n    if(this.bubbles[message.mid]) {\r\n      return;\r\n    }\r\n    // ! should scroll even without new messages\r\n    /* if(!mids.length) {\r\n      return;\r\n    } */\r\n\r\n    if(!scrolledDown) {\r\n      scrolledDown = this.scrolledDown && (\r\n        !this.scrollingToBubble ||\r\n        this.scrollingToBubble === this.getLastBubble() ||\r\n        this.scrollingToBubble === this.chatInner\r\n      );\r\n    }\r\n\r\n    const middleware = this.getMiddleware();\r\n    const {isPaddingNeeded, unsetPadding} = this.setTopPadding(middleware);\r\n\r\n    const promise = this.performHistoryResult({history: [message]}, false);\r\n    if(scrolledDown) {\r\n      promise.then(() => {\r\n        if(!middleware()) return;\r\n        // this.log('renderNewMessagesByIDs: messagesQueuePromise after', this.scrollable.isScrolledDown);\r\n        // this.scrollable.scrollTo(this.scrollable.scrollHeight, 'top', true, true, 5000);\r\n        // const bubble = this.bubbles[Math.max(...mids)];\r\n\r\n        let bubble: HTMLElement;\r\n        if(this.chat.type === 'scheduled') {\r\n          bubble = this.bubbles[message.mid];\r\n        }\r\n\r\n        const promise = bubble ? this.scrollToBubbleEnd(bubble) : this.scrollToEnd();\r\n        if(isPaddingNeeded) {\r\n          // it will be called only once even if was set multiple times (that won't happen)\r\n          promise.then(unsetPadding);\r\n        }\r\n\r\n        // this.scrollable.scrollIntoViewNew(this.chatInner, 'end');\r\n\r\n        /* setTimeout(() => {\r\n          this.log('messagesQueuePromise afterafter:', this.chatInner.childElementCount, this.scrollable.scrollHeight);\r\n        }, 10); */\r\n      });\r\n    }\r\n\r\n    return promise;\r\n  }\r\n\r\n  public getLastBubble() {\r\n    const group = this.bubbleGroups.getLastGroup();\r\n    return group?.lastItem?.bubble;\r\n  }\r\n\r\n  public scrollToBubble(\r\n    element: HTMLElement,\r\n    position: ScrollLogicalPosition,\r\n    forceDirection?: FocusDirection,\r\n    forceDuration?: number\r\n  ) {\r\n    const bubble = findUpClassName(element, 'bubble');\r\n\r\n    if(!element.parentElement) {\r\n      this.log.error('element is not connected', bubble);\r\n    }\r\n\r\n    let fallbackToElementStartWhenCentering: HTMLElement;\r\n    // * if it's a start, then scroll to start of the group\r\n    if(bubble && position !== 'end') {\r\n      const item = this.bubbleGroups.getItemByBubble(bubble);\r\n      if(item && item.group.firstItem === item && whichChild(item.group.container) === (this.stickyIntersector ? STICKY_OFFSET : 1)) {\r\n        const dateGroup = item.group.container.parentElement;\r\n        // if(whichChild(dateGroup) === 0) {\r\n        fallbackToElementStartWhenCentering = dateGroup;\r\n        // position = 'start';\r\n        // element = dateGroup;\r\n        // }\r\n      }\r\n    }\r\n\r\n    // const isLastBubble = this.getLastBubble() === bubble;\r\n    /* if(isLastBubble) {\r\n      element = this.getLastDateGroup();\r\n    } */\r\n\r\n    const margin = 4; // * 4 = .25rem\r\n    /* if(isLastBubble && this.chat.type === 'chat' && this.bubblesContainer.classList.contains('is-chat-input-hidden')) {\r\n      margin = 20;\r\n    } */\r\n\r\n    const isChangingHeight = (this.chat.input.messageInput && this.chat.input.messageInput.classList.contains('is-changing-height')) || this.chat.container.classList.contains('is-toggling-helper');\r\n    const promise = this.scrollable.scrollIntoViewNew({\r\n      element,\r\n      position,\r\n      margin,\r\n      forceDirection,\r\n      forceDuration,\r\n      axis: 'y',\r\n      getNormalSize: isChangingHeight ? ({rect}) => {\r\n        // return rect.height;\r\n\r\n        let height = windowSize.height;\r\n        // height -= this.chat.topbar.container.getBoundingClientRect().height;\r\n        height -= this.container.offsetTop;\r\n        height -= mediaSizes.isMobile || windowSize.height < 570 ? 58 : 78;\r\n        return height;\r\n\r\n        /* const rowsWrapperHeight = this.chat.input.rowsWrapper.getBoundingClientRect().height;\r\n        const diff = rowsWrapperHeight - 54;\r\n        return rect.height + diff; */\r\n      } : undefined,\r\n      fallbackToElementStartWhenCentering,\r\n      startCallback: (dimensions) => {\r\n        // this.onScroll(true, this.scrolledDown && dimensions.distanceToEnd <= SCROLLED_DOWN_THRESHOLD ? undefined : dimensions);\r\n        this.onScroll(true, dimensions);\r\n\r\n        if(this.updateGradient) {\r\n          const {gradientRenderer} = this.chat;\r\n          gradientRenderer?.toNextPosition(dimensions.getProgress);\r\n          this.updateGradient = undefined;\r\n        }\r\n      }\r\n    });\r\n\r\n    // fix flickering date when opening unread chat and focusing message\r\n    if(forceDirection === FocusDirection.Static) {\r\n      this.scrollable.lastScrollPosition = this.scrollable.scrollTop;\r\n    }\r\n\r\n    return promise;\r\n  }\r\n\r\n  public scrollToEnd() {\r\n    return this.scrollToBubbleEnd(this.chatInner);\r\n  }\r\n\r\n  public async scrollToBubbleEnd(bubble: HTMLElement) {\r\n    /* if(DEBUG) {\r\n      this.log('scrollToNewLastBubble: will scroll into view:', bubble);\r\n    } */\r\n\r\n    if(bubble) {\r\n      this.scrollingToBubble = bubble;\r\n      const middleware = this.getMiddleware();\r\n      await this.scrollToBubble(bubble, 'end', undefined, undefined);\r\n      if(!middleware()) return;\r\n      this.scrollingToBubble = undefined;\r\n    }\r\n  }\r\n\r\n  // ! can't get it by chatInner.lastElementChild because placeholder can be the last...\r\n  // private getLastDateGroup() {\r\n  //   let lastTime = 0, lastElem: HTMLElement;\r\n  //   for(const i in this.dateMessages) {\r\n  //     const dateMessage = this.dateMessages[i];\r\n  //     if(dateMessage.firstTimestamp > lastTime) {\r\n  //       lastElem = dateMessage.container;\r\n  //       lastTime = dateMessage.firstTimestamp;\r\n  //     }\r\n  //   }\r\n\r\n  //   return lastElem;\r\n  // }\r\n\r\n  public async scrollToBubbleIfLast(bubble: HTMLElement) {\r\n    if(this.getLastBubble() === bubble) {\r\n      // return this.scrollToBubbleEnd(bubble);\r\n      return this.scrollToEnd();\r\n    }\r\n  }\r\n\r\n  public highlightBubble(element: HTMLElement) {\r\n    const datasetKey = 'highlightTimeout';\r\n    if(element.dataset[datasetKey]) {\r\n      clearTimeout(+element.dataset[datasetKey]);\r\n      element.classList.remove('is-highlighted');\r\n      void element.offsetWidth; // reflow\r\n    }\r\n\r\n    element.classList.add('is-highlighted');\r\n    element.dataset[datasetKey] = '' + setTimeout(() => {\r\n      element.classList.remove('is-highlighted');\r\n      delete element.dataset[datasetKey];\r\n    }, 2000);\r\n  }\r\n\r\n  private createDateBubble(timestamp: number, date: Date = new Date(timestamp * 1000)) {\r\n    let dateElement: HTMLElement;\r\n\r\n    const today = new Date();\r\n    today.setHours(0, 0, 0, 0);\r\n\r\n    const isScheduled = this.chat.type === 'scheduled';\r\n\r\n    if(today.getTime() === date.getTime()) {\r\n      dateElement = i18n(isScheduled ? 'Chat.Date.ScheduledForToday' : 'Date.Today');\r\n    } else if(isScheduled && timestamp === SEND_WHEN_ONLINE_TIMESTAMP) {\r\n      dateElement = i18n('MessageScheduledUntilOnline');\r\n    } else {\r\n      const options: Intl.DateTimeFormatOptions = {\r\n        day: 'numeric',\r\n        month: 'long'\r\n      };\r\n\r\n      if(date.getFullYear() !== today.getFullYear()) {\r\n        options.year = 'numeric';\r\n      }\r\n\r\n      dateElement = new I18n.IntlDateElement({\r\n        date,\r\n        options\r\n      }).element;\r\n\r\n      if(isScheduled) {\r\n        dateElement = i18n('Chat.Date.ScheduledFor', [dateElement]);\r\n      }\r\n    }\r\n\r\n    const bubble = document.createElement('div');\r\n    bubble.className = 'bubble service is-date';\r\n    const bubbleContent = document.createElement('div');\r\n    bubbleContent.classList.add('bubble-content');\r\n    const serviceMsg = document.createElement('div');\r\n    serviceMsg.classList.add('service-msg');\r\n\r\n    serviceMsg.append(dateElement);\r\n\r\n    bubbleContent.append(serviceMsg);\r\n    bubble.append(bubbleContent);\r\n\r\n    return bubble;\r\n  }\r\n\r\n  public getDateForDateContainer(timestamp: number) {\r\n    const date = new Date(timestamp * 1000);\r\n    date.setHours(0, 0, 0);\r\n    return {date, dateTimestamp: date.getTime()};\r\n  }\r\n\r\n  public getDateContainerByTimestamp(timestamp: number) {\r\n    const {date, dateTimestamp} = this.getDateForDateContainer(timestamp);\r\n    if(!this.dateMessages[dateTimestamp]) {\r\n      const bubble = this.createDateBubble(timestamp, date);\r\n      // bubble.classList.add('is-sticky');\r\n      const fakeBubble = this.createDateBubble(timestamp, date);\r\n      fakeBubble.classList.add('is-fake');\r\n\r\n      const container = document.createElement('section');\r\n      container.className = 'bubbles-date-group';\r\n      container.append(bubble, fakeBubble);\r\n\r\n      this.dateMessages[dateTimestamp] = {\r\n        div: bubble,\r\n        container,\r\n        firstTimestamp: date.getTime()\r\n      };\r\n\r\n      const haveTimestamps = getObjectKeysAndSort(this.dateMessages, 'asc');\r\n      const length = haveTimestamps.length;\r\n      let i = 0, insertBefore: HTMLElement; // there can be 'first bubble' (e.g. bot description) so can't insert by index\r\n      for(; i < haveTimestamps.length; ++i) {\r\n        const t = haveTimestamps[i];\r\n        insertBefore = this.dateMessages[t].container;\r\n        if(dateTimestamp < t) {\r\n          break;\r\n        }\r\n      }\r\n\r\n      if(i === length && insertBefore) {\r\n        insertBefore = insertBefore.nextElementSibling as HTMLElement;\r\n      }\r\n\r\n      if(!insertBefore) {\r\n        this.chatInner.append(container);\r\n      } else {\r\n        this.chatInner.insertBefore(container, insertBefore);\r\n      }\r\n\r\n      if(this.stickyIntersector) {\r\n        this.stickyIntersector.observeStickyHeaderChanges(container);\r\n      }\r\n\r\n      if(this.chatInner.parentElement) {\r\n        this.container.classList.add('has-groups');\r\n      }\r\n    }\r\n\r\n    return this.dateMessages[dateTimestamp];\r\n  }\r\n\r\n  private destroyScrollable() {\r\n    this.scrollable.destroy();\r\n  }\r\n\r\n  public destroy() {\r\n    // this.chat.log.error('Bubbles destroying');\r\n\r\n    this.destroyScrollable();\r\n\r\n    this.listenerSetter.removeAll();\r\n\r\n    this.lazyLoadQueue.clear();\r\n    this.observer && this.observer.disconnect();\r\n    this.stickyIntersector && this.stickyIntersector.disconnect();\r\n\r\n    delete this.lazyLoadQueue;\r\n    this.observer && delete this.observer;\r\n    this.stickyIntersector && delete this.stickyIntersector;\r\n  }\r\n\r\n  public cleanup(bubblesToo = false) {\r\n    this.bubbles = {}; // clean it before so sponsored message won't be deleted faster on peer changing\r\n    // //console.time('appImManager cleanup');\r\n    this.setLoaded('top', false, false);\r\n    this.setLoaded('bottom', false, false);\r\n\r\n    // cancel scroll\r\n    cancelAnimationByKey(this.scrollable.container);\r\n\r\n    // do not wait ending of previous scale animation\r\n    interruptHeavyAnimation();\r\n\r\n    if(TEST_SCROLL !== undefined) {\r\n      TEST_SCROLL = TEST_SCROLL_TIMES;\r\n    }\r\n\r\n    this.skippedMids.clear();\r\n    this.dateMessages = {};\r\n    this.bubbleGroups.cleanup();\r\n    this.unreadOut.clear();\r\n    this.needUpdate.length = 0;\r\n    this.lazyLoadQueue.clear();\r\n    this.renderNewPromises.clear();\r\n\r\n    // clear messages\r\n    if(bubblesToo) {\r\n      this.scrollable.container.textContent = '';\r\n      this.chatInner.textContent = '';\r\n      this.cleanupPlaceholders();\r\n    }\r\n\r\n    this.firstUnreadBubble = null;\r\n    this.attachedUnreadBubble = false;\r\n\r\n    this.messagesQueue.length = 0;\r\n    this.messagesQueuePromise = null;\r\n\r\n    this.getHistoryTopPromise = this.getHistoryBottomPromise = undefined;\r\n    this.fetchNewPromise = undefined;\r\n    this.getSponsoredMessagePromise = undefined;\r\n    this.updateGradient = undefined;\r\n\r\n    if(this.stickyIntersector) {\r\n      this.stickyIntersector.disconnect();\r\n    }\r\n\r\n    if(this.observer) {\r\n      this.observer.disconnect();\r\n\r\n      this.unreaded.clear();\r\n      this.unreadedSeen.clear();\r\n      this.readPromise = undefined;\r\n\r\n      this.viewsMids.clear();\r\n    }\r\n\r\n    this.middlewareHelper.clean();\r\n\r\n    this.onAnimateLadder = undefined;\r\n    this.resolveLadderAnimation = undefined;\r\n    this.attachPlaceholderOnRender = undefined;\r\n    this.emptyPlaceholderBubble = undefined;\r\n    this.sponsoredMessage = undefined;\r\n    this.previousStickyDate = undefined;\r\n\r\n    this.scrollingToBubble = undefined;\r\n    // //console.timeEnd('appImManager cleanup');\r\n\r\n    this.isTopPaddingSet = false;\r\n\r\n    this.renderingMessages.clear();\r\n    this.bubblesToEject.clear();\r\n    this.bubblesToReplace.clear();\r\n\r\n    // this.reactions.clear();\r\n\r\n    if(this.isScrollingTimeout) {\r\n      clearTimeout(this.isScrollingTimeout);\r\n      this.isScrollingTimeout = 0;\r\n    }\r\n\r\n    this.container.classList.remove('has-sticky-dates');\r\n    this.scrollable.cancelMeasure();\r\n  }\r\n\r\n  private cleanupPlaceholders(bubble = this.emptyPlaceholderBubble) {\r\n    if(bubble) {\r\n      bubble.remove();\r\n\r\n      if(this.emptyPlaceholderBubble === bubble) {\r\n        this.emptyPlaceholderBubble = undefined;\r\n      }\r\n    }\r\n  }\r\n\r\n  public async setPeer(samePeer: boolean, peerId: PeerId, lastMsgId?: number, startParam?: string): Promise<{cached?: boolean, promise: Chat['setPeerPromise']}> {\r\n    const tempId = ++this.setPeerTempId;\r\n\r\n    if(!peerId) {\r\n      this.cleanup(true);\r\n      this.preloader.detach();\r\n      return null;\r\n    }\r\n\r\n    const perf = performance.now();\r\n    const log = this.log.bindPrefix('setPeer');\r\n    log.warn('start');\r\n\r\n    const middleware = () => {\r\n      return this.setPeerTempId === tempId;\r\n    };\r\n\r\n    const m = middlewarePromise(middleware, PEER_CHANGED_ERROR);\r\n\r\n    if(!samePeer) {\r\n      await m(this.chat.onChangePeer(m));\r\n    }\r\n\r\n    /* if(samePeer && this.chat.setPeerPromise) {\r\n      return {cached: true, promise: this.chat.setPeerPromise};\r\n    } */\r\n\r\n    const chatType = this.chat.type;\r\n\r\n    if(chatType === 'scheduled' || this.chat.isRestricted) {\r\n      lastMsgId = 0;\r\n    }\r\n\r\n    const historyStorage = await m(this.chat.getHistoryStorage());\r\n    const topMessage = chatType === 'pinned' ? await m(this.managers.appMessagesManager.getPinnedMessagesMaxId(peerId)) : historyStorage.maxId ?? 0;\r\n    const isTarget = lastMsgId !== undefined;\r\n\r\n    // * this one will fix topMessage for null message in history (e.g. channel comments with only 1 comment and it is a topMessage)\r\n    /* if(chatType !== 'pinned' && topMessage && !historyStorage.history.slice.includes(topMessage)) {\r\n      topMessage = 0;\r\n    } */\r\n\r\n    let followingUnread: boolean;\r\n    let readMaxId = 0, savedPosition: ReturnType<AppImManager['getChatSavedPosition']>, overrideAdditionMsgId: number;\r\n    if(!isTarget) {\r\n      if(!samePeer) {\r\n        savedPosition = this.chat.appImManager.getChatSavedPosition(this.chat);\r\n      }\r\n\r\n      if(savedPosition) {\r\n\r\n      } else if(topMessage) {\r\n        readMaxId = await m(this.managers.appMessagesManager.getReadMaxIdIfUnread(peerId, this.chat.threadId));\r\n        const dialog = await m(this.managers.appMessagesManager.getDialogOnly(peerId));\r\n        if(/* dialog.unread_count */readMaxId && !samePeer && (!dialog || dialog.unread_count !== 1)) {\r\n          const foundSlice = historyStorage.history.findSliceOffset(readMaxId);\r\n          if(foundSlice && foundSlice.slice.isEnd(SliceEnd.Bottom)) {\r\n            overrideAdditionMsgId = foundSlice.slice[foundSlice.offset - 25] || foundSlice.slice[0] || readMaxId;\r\n          }\r\n\r\n          followingUnread = !isTarget;\r\n          lastMsgId = readMaxId;\r\n        } else {\r\n          lastMsgId = topMessage;\r\n          // lastMsgID = topMessage;\r\n        }\r\n      }\r\n    }\r\n\r\n    const isJump = lastMsgId !== topMessage/*  && overrideAdditionMsgId === undefined */;\r\n\r\n    if(startParam === undefined && await m(this.chat.isStartButtonNeeded())) {\r\n      startParam = BOT_START_PARAM;\r\n    }\r\n\r\n    if(samePeer) {\r\n      const mounted = await m(this.getMountedBubble(lastMsgId));\r\n      if(mounted) {\r\n        if(isTarget) {\r\n          this.scrollToBubble(mounted.bubble, 'center');\r\n          this.highlightBubble(mounted.bubble);\r\n          this.chat.dispatchEvent('setPeer', lastMsgId, false);\r\n        } else if(topMessage && !isJump) {\r\n          // log('will scroll down', this.scroll.scrollTop, this.scroll.scrollHeight);\r\n          // scrollable.setScrollTopSilently(scrollable.scrollHeight);\r\n          this.scrollToEnd();\r\n          this.chat.dispatchEvent('setPeer', lastMsgId, true);\r\n        }\r\n\r\n        if(startParam !== undefined) {\r\n          this.chat.input.setStartParam(startParam);\r\n        }\r\n\r\n        return null;\r\n      }\r\n    } else {\r\n      if(this.peerId) { // * set new queue id if new peer (setting not from 0)\r\n        this.lazyLoadQueue.queueId = ++queueId;\r\n        this.managers.apiFileManager.setQueueId(this.chat.bubbles.lazyLoadQueue.queueId);\r\n      }\r\n\r\n      this.replyFollowHistory.length = 0;\r\n\r\n      this.passEntities = {\r\n        messageEntityBotCommand: await m(this.managers.appPeersManager.isAnyGroup(peerId)) || this.chat.isBot\r\n      };\r\n    }\r\n\r\n    if(DEBUG) {\r\n      log('setPeer peerId:', peerId, historyStorage, lastMsgId, topMessage);\r\n    }\r\n\r\n    // add last message, bc in getHistory will load < max_id\r\n    const additionMsgId = overrideAdditionMsgId ?? (isJump || chatType === 'scheduled' || this.chat.isRestricted ? 0 : topMessage);\r\n\r\n    let maxBubbleId = 0;\r\n    if(samePeer) {\r\n      const el = this.getBubbleByPoint('bottom'); // ! this may not work if being called when chat is hidden\r\n      // this.chat.log('[PM]: setCorrectIndex: get last element perf:', performance.now() - perf, el);\r\n      if(el) {\r\n        maxBubbleId = +el.dataset.mid;\r\n      }\r\n\r\n      if(maxBubbleId <= 0) {\r\n        maxBubbleId = Math.max(...Object.keys(this.bubbles).map((mid) => +mid));\r\n      }\r\n    } else {\r\n      this.isFirstLoad = true;\r\n      this.destroyResizeObserver();\r\n    }\r\n\r\n    const oldChatInner = this.chatInner;\r\n    const oldPlaceholderBubble = this.emptyPlaceholderBubble;\r\n    this.cleanup();\r\n    const chatInner = this.chatInner = document.createElement('div');\r\n    if(samePeer) {\r\n      chatInner.className = oldChatInner.className;\r\n      chatInner.classList.remove('disable-hover', 'is-scrolling');\r\n    } else {\r\n      chatInner.classList.add('bubbles-inner');\r\n    }\r\n\r\n    this.lazyLoadQueue.lock();\r\n\r\n    // const haveToScrollToBubble = (topMessage && (isJump || samePeer)) || isTarget;\r\n    const haveToScrollToBubble = samePeer || (topMessage && isJump) || isTarget;\r\n    const fromUp = maxBubbleId > 0 && (!lastMsgId || maxBubbleId < lastMsgId || lastMsgId < 0);\r\n    const scrollFromDown = !fromUp && samePeer;\r\n    const scrollFromUp = !scrollFromDown && fromUp/*  && (samePeer || forwardingUnread) */;\r\n    this.willScrollOnLoad = scrollFromDown || scrollFromUp;\r\n\r\n    this.setPeerOptions = {\r\n      lastMsgId,\r\n      topMessage\r\n    };\r\n\r\n    let result: Awaited<ReturnType<ChatBubbles['getHistory']>>;\r\n    if(!savedPosition) {\r\n      result = await m(this.getHistory1(lastMsgId, true, isJump, additionMsgId));\r\n    } else {\r\n      result = {\r\n        promise: getHeavyAnimationPromise().then(() => {\r\n          return this.performHistoryResult({history: savedPosition.mids}, true);\r\n        }) as any,\r\n        cached: true,\r\n        waitPromise: Promise.resolve()\r\n      };\r\n    }\r\n\r\n    this.setPeerCached = result.cached;\r\n\r\n    log.warn('got history');// warning\r\n\r\n    const {promise, cached} = result;\r\n\r\n    if(!cached && !samePeer) {\r\n      await m(this.chat.finishPeerChange(isTarget, isJump, lastMsgId, startParam));\r\n      this.scrollable.container.textContent = '';\r\n      // oldContainer.textContent = '';\r\n      // oldChatInner.remove();\r\n      this.preloader.attach(this.container);\r\n    }\r\n\r\n    /* this.ladderDeferred && this.ladderDeferred.resolve();\r\n    this.ladderDeferred = deferredPromise<void>(); */\r\n\r\n    animationIntersector.lockGroup(CHAT_ANIMATION_GROUP);\r\n    const setPeerPromise = m(promise).then(async() => {\r\n      log.warn('promise fulfilled');\r\n\r\n      const mountedByLastMsgId = haveToScrollToBubble ? await m(lastMsgId ? this.getMountedBubble(lastMsgId) : {bubble: this.getLastBubble()}) : undefined;\r\n      if(cached && !samePeer) {\r\n        log.warn('finishing peer change');\r\n        await m(this.chat.finishPeerChange(isTarget, isJump, lastMsgId, startParam)); // * \r\n        log.warn('finished peer change');\r\n      }\r\n\r\n      this.preloader.detach();\r\n\r\n      if(this.resolveLadderAnimation) {\r\n        this.resolveLadderAnimation();\r\n        this.resolveLadderAnimation = undefined;\r\n      }\r\n\r\n      this.setPeerCached = undefined;\r\n\r\n      // this.ladderDeferred.resolve();\r\n\r\n      const scrollable = this.scrollable;\r\n      scrollable.lastScrollDirection = 0;\r\n      scrollable.lastScrollPosition = 0;\r\n      replaceContent(scrollable.container, chatInner);\r\n      // this.chat.topbar.container.nextElementSibling.replaceWith(container);\r\n\r\n      if(oldPlaceholderBubble) {\r\n        this.cleanupPlaceholders(oldPlaceholderBubble);\r\n      }\r\n\r\n      if(this.attachPlaceholderOnRender) {\r\n        this.attachPlaceholderOnRender();\r\n      }\r\n\r\n      if(!isTarget && this.chat.type === 'chat' && this.chat.topbar.pinnedMessage) {\r\n        this.chat.topbar.pinnedMessage.setCorrectIndex(0);\r\n      }\r\n\r\n      this.container.classList.toggle('has-groups', !!Object.keys(this.dateMessages).length);\r\n\r\n      log.warn('mounted chat', this.chatInner === chatInner, this.chatInner.parentElement, performance.now() - perf);\r\n\r\n      animationIntersector.unlockGroup(CHAT_ANIMATION_GROUP);\r\n      animationIntersector.checkAnimations(false, CHAT_ANIMATION_GROUP/* , true */);\r\n\r\n      // fastRaf(() => {\r\n      this.lazyLoadQueue.unlock();\r\n      // });\r\n\r\n      // if(dialog && lastMsgID && lastMsgID !== topMessage && (this.bubbles[lastMsgID] || this.firstUnreadBubble)) {\r\n      if(savedPosition) {\r\n        scrollable.setScrollTopSilently(savedPosition.top);\r\n        /* const mountedByLastMsgId = this.getMountedBubble(lastMsgId);\r\n        let bubble: HTMLElement = mountedByLastMsgId?.bubble;\r\n        if(!bubble?.parentElement) {\r\n          bubble = this.findNextMountedBubbleByMsgId(lastMsgId);\r\n        }\r\n\r\n        if(bubble) {\r\n          const top = bubble.getBoundingClientRect().top;\r\n          const distance = savedPosition.top - top;\r\n          scrollable.scrollTop += distance;\r\n        } */\r\n      } else if(haveToScrollToBubble) {\r\n        let unsetPadding: () => void;\r\n        if(scrollFromDown) {\r\n          scrollable.setScrollTopSilently(99999);\r\n        } else if(scrollFromUp) {\r\n          const set = this.setTopPadding();\r\n          if(set.isPaddingNeeded) {\r\n            unsetPadding = set.unsetPadding;\r\n          }\r\n\r\n          scrollable.setScrollTopSilently(0);\r\n        }\r\n\r\n        // const mountedByLastMsgId = lastMsgId ? this.getMountedBubble(lastMsgId) : {bubble: this.getLastBubble()};\r\n        let bubble: HTMLElement = (followingUnread && this.firstUnreadBubble) || mountedByLastMsgId?.bubble;\r\n        if(!bubble?.parentElement) {\r\n          bubble = this.findNextMountedBubbleByMsgId(lastMsgId, false) || this.findNextMountedBubbleByMsgId(lastMsgId, true);\r\n        }\r\n\r\n        let promise: Promise<void>;\r\n        // ! sometimes there can be no bubble\r\n        if(bubble) {\r\n          const lastBubble = this.getLastBubble();\r\n          const position: ScrollLogicalPosition = followingUnread ? 'start' : (!isJump && !isTarget && lastBubble === bubble ? 'end' : 'center');\r\n\r\n          if(position === 'end' && lastBubble === bubble && samePeer) {\r\n            promise = this.scrollToEnd();\r\n          } else {\r\n            promise = this.scrollToBubble(bubble, position, !samePeer ? FocusDirection.Static : undefined);\r\n          }\r\n\r\n          if(!followingUnread && isTarget) {\r\n            this.highlightBubble(bubble);\r\n          }\r\n        }\r\n\r\n        if(unsetPadding) {\r\n          (promise || Promise.resolve()).then(() => {\r\n            unsetPadding();\r\n          });\r\n        }\r\n      } else {\r\n        scrollable.setScrollTopSilently(99999);\r\n      }\r\n\r\n      // if(!cached) {\r\n      this.onRenderScrollSet();\r\n      // }\r\n\r\n      this.onScroll();\r\n\r\n      const afterSetPromise = Promise.all([setPeerPromise, getHeavyAnimationPromise()]);\r\n      afterSetPromise.then(() => { // check whether list isn't full\r\n        scrollable.checkForTriggers();\r\n\r\n        // if(cached) {\r\n        // this.onRenderScrollSet();\r\n        // }\r\n      });\r\n\r\n      this.chat.dispatchEvent('setPeer', lastMsgId, !isJump);\r\n\r\n      Promise.all([\r\n        this.setFetchReactionsInterval(afterSetPromise),\r\n        this.setFetchHistoryInterval({\r\n          afterSetPromise,\r\n          lastMsgId,\r\n          samePeer,\r\n          savedPosition,\r\n          topMessage\r\n        })\r\n      ]).then(() => {\r\n        log('scrolledAllDown:', scrollable.loadedAll.bottom);\r\n        // if(!this.unreaded.length && dialog) { // lol\r\n        if(scrollable.loadedAll.bottom && topMessage && !this.unreaded.size) { // lol\r\n          this.onScrolledAllDown();\r\n        }\r\n      });\r\n\r\n      if(chatType === 'chat') {\r\n        const dialog = await m(this.managers.appMessagesManager.getDialogOnly(peerId));\r\n        if(dialog?.pFlags.unread_mark) {\r\n          this.managers.appMessagesManager.markDialogUnread(peerId, true);\r\n        }\r\n      }\r\n\r\n      // this.chatInner.classList.remove('disable-hover', 'is-scrolling'); // warning, performance!\r\n    }).catch((err) => {\r\n      log.error('getHistory promise error:', err);\r\n      if(!middleware()) {\r\n        this.preloader.detach();\r\n      }\r\n\r\n      throw err;\r\n    });\r\n\r\n    return {cached, promise: setPeerPromise};\r\n  }\r\n\r\n  private async setFetchReactionsInterval(afterSetPromise: Promise<any>) {\r\n    const middleware = this.getMiddleware();\r\n    const needReactionsInterval = this.chat.isChannel;\r\n    if(needReactionsInterval) {\r\n      const fetchReactions = async() => {\r\n        if(!middleware()) return;\r\n\r\n        const mids: number[] = [];\r\n        for(const mid in this.bubbles) {\r\n          let message = await this.chat.getMessage(+mid);\r\n          if(message?._ !== 'message') {\r\n            continue;\r\n          }\r\n\r\n          message = await this.managers.appMessagesManager.getGroupsFirstMessage(message);\r\n          mids.push(message.mid);\r\n        }\r\n\r\n        const promise = mids.length ? this.managers.appReactionsManager.getMessagesReactions(this.peerId, mids) : Promise.resolve();\r\n        promise.then(() => {\r\n          setTimeout(fetchReactions, 10e3);\r\n        });\r\n      };\r\n\r\n      Promise.all([afterSetPromise, getHeavyAnimationPromise(), pause(500)]).then(() => {\r\n        fetchReactions();\r\n      });\r\n    }\r\n  }\r\n\r\n  private async setFetchHistoryInterval({\r\n    lastMsgId,\r\n    topMessage,\r\n    afterSetPromise,\r\n    savedPosition,\r\n    samePeer\r\n  }: {\r\n    lastMsgId: number,\r\n    topMessage: number,\r\n    afterSetPromise: Promise<any>,\r\n    savedPosition: ChatSavedPosition,\r\n    samePeer: boolean\r\n  }) {\r\n    const middleware = this.getMiddleware();\r\n    const peerId = this.peerId;\r\n\r\n    const needFetchInterval = await this.managers.appMessagesManager.isFetchIntervalNeeded(peerId);\r\n    const needFetchNew = savedPosition || needFetchInterval;\r\n    if(!needFetchNew) {\r\n      return;\r\n    }\r\n\r\n    await afterSetPromise;\r\n    if(!middleware()) {\r\n      return;\r\n    }\r\n\r\n    this.setLoaded('bottom', false);\r\n    this.scrollable.checkForTriggers();\r\n\r\n    if(!needFetchInterval) {\r\n      return;\r\n    }\r\n\r\n    const f = () => {\r\n      this.fetchNewPromise = new Promise<void>(async(resolve) => {\r\n        if(!middleware() || !(await this.managers.appMessagesManager.isFetchIntervalNeeded(peerId))) {\r\n          resolve();\r\n          return;\r\n        }\r\n\r\n        this.managers.appMessagesManager.getNewHistory(peerId, this.chat.threadId).then((result) => {\r\n          if(!middleware() || !result) {\r\n            resolve();\r\n            return;\r\n          }\r\n\r\n          const {isBottomEnd} = result;\r\n          if(this.scrollable.loadedAll.bottom && this.scrollable.loadedAll.bottom !== isBottomEnd) {\r\n            this.setLoaded('bottom', isBottomEnd);\r\n            this.onScroll();\r\n          }\r\n\r\n          setTimeout(f, 30e3);\r\n          resolve();\r\n        });\r\n      }).finally(() => {\r\n        this.fetchNewPromise = undefined;\r\n      });\r\n    };\r\n\r\n    if(samePeer) {\r\n      setTimeout(f, 30e3);\r\n    } else {\r\n      f();\r\n    }\r\n  }\r\n\r\n  public async onScrolledAllDown() {\r\n    if(this.chat.type === 'chat' || this.chat.type === 'discussion') {\r\n      const historyMaxId = await this.chat.getHistoryMaxId();\r\n      this.managers.appMessagesManager.readHistory(this.peerId, historyMaxId, this.chat.threadId, true);\r\n    }\r\n  }\r\n\r\n  public async finishPeerChange() {\r\n    const [isChannel, canWrite, isAnyGroup] = await Promise.all([\r\n      this.chat.isChannel,\r\n      this.chat.canSend(),\r\n      this.chat.isAnyGroup\r\n    ]);\r\n\r\n    return () => {\r\n      this.chatInner.classList.toggle('has-rights', canWrite);\r\n      this.container.classList.toggle('is-chat-input-hidden', !canWrite);\r\n\r\n      this.chatInner.classList.toggle('is-chat', isAnyGroup);\r\n      this.chatInner.classList.toggle('is-channel', isChannel);\r\n\r\n      this.createResizeObserver();\r\n    };\r\n  }\r\n\r\n  public renderMessagesQueue(options: ChatBubbles['messagesQueue'][0]) {\r\n    this.messagesQueue.push(options);\r\n    return this.setMessagesQueuePromise();\r\n  }\r\n\r\n  public setMessagesQueuePromise() {\r\n    if(!this.messagesQueue.length) return Promise.resolve();\r\n\r\n    if(this.messagesQueuePromise) {\r\n      return this.messagesQueuePromise;\r\n    }\r\n\r\n    const middleware = this.getMiddleware();\r\n    const log = this.log.bindPrefix('queue');\r\n    const possibleError = PEER_CHANGED_ERROR;\r\n    const m = middlewarePromise(middleware, possibleError);\r\n\r\n    const processQueue = async(): Promise<void> => {\r\n      log('start');\r\n\r\n      // if(!this.chat.setPeerPromise) {\r\n      //   await pause(10000000);\r\n      // }\r\n\r\n      const renderQueue = this.messagesQueue.slice();\r\n      this.messagesQueue.length = 0;\r\n\r\n      const renderQueuePromises = renderQueue.map((promise) => {\r\n        const perf = performance.now();\r\n        promise.then((details) => {\r\n          log('render message time', performance.now() - perf, details);\r\n        });\r\n\r\n        return promise;\r\n      });\r\n\r\n      let loadQueue = await m(Promise.all(renderQueuePromises));\r\n      const filterQueue = (queue: typeof loadQueue) => {\r\n        return queue.filter((details) => {\r\n          // message can be deleted during rendering\r\n          return details && this.bubbles[details.bubble.dataset.mid] === details.bubble;\r\n        });\r\n      };\r\n\r\n      loadQueue = filterQueue(loadQueue);\r\n\r\n      log('messages rendered');\r\n\r\n      const reverse = loadQueue[0]?.reverse;\r\n\r\n      const {groups, avatarPromises} = this.groupBubbles(loadQueue.filter((details) => details.updatePosition));\r\n\r\n      // if(groups.length > 2 && loadQueue.length === 1) {\r\n      //   debugger;\r\n      // }\r\n\r\n      const promises = loadQueue.reduce((acc, details) => {\r\n        const perf = performance.now();\r\n\r\n        const promises = details.promises.slice();\r\n        const timePromises = promises.map(async(promise) => (await promise, performance.now() - perf));\r\n        Promise.all(timePromises).then((times) => {\r\n          log.groupCollapsed('media message time', performance.now() - perf, details, times);\r\n          times.forEach((time, idx) => {\r\n            log('media message time', time, idx, promises[idx]);\r\n          });\r\n          log.groupEnd();\r\n        });\r\n\r\n        // if(details.updatePosition) {\r\n        //   if(res) {\r\n        //     groups.add(res.group);\r\n        //     if(details.needAvatar) {\r\n        //       details.promises.push(res.group.createAvatar(details.message));\r\n        //     }\r\n        //   }\r\n        // }\r\n\r\n        acc.push(...details.promises);\r\n        return acc;\r\n      }, [] as Promise<any>[]);\r\n\r\n      promises.push(...avatarPromises);\r\n      // promises.push(pause(200));\r\n\r\n      // *    ,     reply  - ,    \r\n      // *     -     ,       \r\n      // promises.push(getHeavyAnimationPromise());\r\n\r\n      log('media promises to call', promises, loadQueue, this.isHeavyAnimationInProgress);\r\n      await m(Promise.all([...promises, this.setUnreadDelimiter()])); //    \r\n      await m(fastRafPromise()); // have to be the last\r\n      log('media promises end');\r\n\r\n      loadQueue = filterQueue(loadQueue);\r\n\r\n      const {restoreScroll, scrollSaver} = this.prepareToSaveScroll(reverse);\r\n      // if(this.messagesQueueOnRender) {\r\n      // this.messagesQueueOnRender();\r\n      // }\r\n\r\n      if(this.messagesQueueOnRenderAdditional) {\r\n        this.messagesQueueOnRenderAdditional();\r\n      }\r\n\r\n      this.ejectBubbles();\r\n      for(const [bubble, oldBubble] of this.bubblesToReplace) {\r\n        if(scrollSaver) {\r\n          scrollSaver.replaceSaved(oldBubble, bubble);\r\n        }\r\n\r\n        if(!loadQueue.find((details) => details.bubble === bubble)) {\r\n          continue;\r\n        }\r\n\r\n        const item = this.bubbleGroups.getItemByBubble(bubble);\r\n        item.mounted = false;\r\n        if(!groups.includes(item.group)) {\r\n          groups.push(item.group);\r\n        }\r\n\r\n        this.bubblesToReplace.delete(bubble);\r\n      }\r\n\r\n      if(this.chat.selection.isSelecting) {\r\n        loadQueue.forEach(({bubble}) => {\r\n          this.chat.selection.toggleElementCheckbox(bubble, true);\r\n        });\r\n      }\r\n\r\n      loadQueue.forEach(({message, bubble, updatePosition}) => {\r\n        if(message.pFlags.local && updatePosition) {\r\n          this.chatInner[(message as Message.message).pFlags.sponsored ? 'append' : 'prepend'](bubble);\r\n          return;\r\n        }\r\n      });\r\n\r\n      this.bubbleGroups.mountUnmountGroups(groups);\r\n      // this.bubbleGroups.findIncorrentPositions();\r\n\r\n      if(this.updatePlaceholderPosition) {\r\n        this.updatePlaceholderPosition();\r\n      }\r\n\r\n      if(restoreScroll) {\r\n        restoreScroll();\r\n      }\r\n\r\n      // this.setStickyDateManually();\r\n\r\n      if(this.messagesQueue.length) {\r\n        log('have new messages to render');\r\n        return processQueue();\r\n      } else {\r\n        log('end');\r\n      }\r\n    };\r\n\r\n    log('setting pause');\r\n    const promise = this.messagesQueuePromise = m(pause(0)).then(processQueue).finally(() => {\r\n      if(this.messagesQueuePromise === promise) {\r\n        this.messagesQueuePromise = null;\r\n      }\r\n    });\r\n\r\n    return promise;\r\n  }\r\n\r\n  private ejectBubbles() {\r\n    for(const bubble of this.bubblesToEject) {\r\n      bubble.remove();\r\n      // this.bubbleGroups.removeAndUnmountBubble(bubble);\r\n    }\r\n\r\n    this.bubblesToEject.clear();\r\n  }\r\n\r\n  public groupBubbles(items: Array<{\r\n    // Awaited<ReturnType<ChatBubbles['safeRenderMessage']>> &\r\n    bubble: HTMLElement,\r\n    message: Message.message | Message.messageService\r\n  }/*  & {\r\n    unmountIfFound?: boolean\r\n  } */>) {\r\n    let modifiedGroups: typeof groups;\r\n\r\n    if(this.chat.type === 'scheduled') {\r\n      modifiedGroups = new Set();\r\n      items.forEach(({bubble, message}) => {\r\n        const item = this.bubbleGroups.getItemByBubble(bubble);\r\n        const group = item?.group;\r\n        if(group && item.message.date !== message.date) {\r\n          this.bubbleGroups.removeItem(item);\r\n          modifiedGroups.add(group);\r\n        }\r\n      });\r\n    }\r\n\r\n    items.forEach(({bubble, message}) => {\r\n      this.bubbleGroups.prepareForGrouping(bubble, message);\r\n    });\r\n\r\n    const groups = this.bubbleGroups.groupUngrouped();\r\n\r\n    const avatarPromises = Array.from(groups).map((group) => {\r\n      if(group.avatar) return;\r\n      const firstItem = group.firstItem;\r\n      if(firstItem && this.chat.isAvatarNeeded(firstItem.message)) {\r\n        return group.createAvatar(firstItem.message);\r\n      }\r\n    }).filter(Boolean);\r\n\r\n    if(modifiedGroups) {\r\n      for(const group of modifiedGroups) {\r\n        groups.add(group);\r\n      }\r\n    }\r\n\r\n    return {\r\n      groups: [...groups],\r\n      avatarPromises\r\n    };\r\n  }\r\n\r\n  public getMiddleware(additionalCallback?: () => boolean) {\r\n    return this.middlewareHelper.get(additionalCallback);\r\n  }\r\n\r\n  private async safeRenderMessage(\r\n    message: Message.message | Message.messageService,\r\n    reverse?: boolean,\r\n    bubble?: HTMLElement,\r\n    updatePosition = true,\r\n    processResult?: (result: ReturnType<ChatBubbles['renderMessage']>, bubble: HTMLElement) => typeof result\r\n  ) {\r\n    if(!message || this.renderingMessages.has(message.mid) || (this.bubbles[message.mid] && !bubble)) {\r\n      return;\r\n    }\r\n\r\n    const middlewareHelper = this.getMiddleware().create();\r\n    const middleware = middlewareHelper.get();\r\n\r\n    let result: Awaited<ReturnType<ChatBubbles['renderMessage']>> & {updatePosition: typeof updatePosition};\r\n    try {\r\n      this.renderingMessages.add(message.mid);\r\n\r\n      // const groupedId = (message as Message.message).grouped_id;\r\n      const newBubble = document.createElement('div');\r\n      newBubble.middlewareHelper = middlewareHelper;\r\n      newBubble.dataset.mid = '' + message.mid;\r\n      newBubble.dataset.peerId = '' + message.peerId;\r\n      newBubble.dataset.timestamp = '' + message.date;\r\n\r\n      // const bubbleNew: Bubble = this.bubblesNew[message.mid] ??= {\r\n      //   bubble: newBubble,\r\n      //   mids: new Set(),\r\n      //   groupedId\r\n      // };\r\n\r\n      // bubbleNew.mids.add(message.mid);\r\n\r\n      if(bubble) {\r\n        bubble.middlewareHelper.destroy();\r\n        this.skippedMids.delete(message.mid);\r\n\r\n        this.bubblesToEject.add(bubble);\r\n        this.bubblesToReplace.delete(bubble);\r\n        this.bubblesToReplace.set(newBubble, bubble);\r\n        this.bubbleGroups.changeBubbleByBubble(bubble, newBubble);\r\n      }\r\n\r\n      bubble = this.bubbles[message.mid] = newBubble;\r\n      let originalPromise = this.renderMessage(message, reverse, bubble, middleware);\r\n      if(processResult) {\r\n        originalPromise = processResult(originalPromise, bubble);\r\n      }\r\n\r\n      const promise = originalPromise.then((r) => ((r && middleware() ? {...r, updatePosition} : undefined) as typeof result));\r\n\r\n      this.renderMessagesQueue(promise.catch(() => undefined));\r\n\r\n      result = await promise;\r\n      if(!middleware()) {\r\n        return;\r\n      }\r\n\r\n      if(!result) {\r\n        this.skippedMids.add(+message.mid);\r\n      }\r\n    } catch(err) {\r\n      this.log.error('renderMessage error:', err);\r\n    }\r\n\r\n    if(!middleware()) {\r\n      return;\r\n    }\r\n\r\n    this.renderingMessages.delete(message.mid);\r\n    return result;\r\n  }\r\n\r\n  // reverse means top\r\n  private async renderMessage(\r\n    message: Message.message | Message.messageService,\r\n    reverse = false,\r\n    bubble: HTMLElement,\r\n    middleware: Middleware\r\n  ) {\r\n    // if(DEBUG) {\r\n    //   this.log('message to render:', message);\r\n    // }\r\n\r\n    // if(!bubble && this.bubbles[message.mid]) {\r\n    //   return;\r\n    // }\r\n\r\n    // await pause(1000);\r\n\r\n    const isMessage = message._ === 'message';\r\n    const groupedId = isMessage && message.grouped_id;\r\n    let albumMids: number[], reactionsMessage: Message.message;\r\n    const albumMessages = groupedId ? await this.managers.appMessagesManager.getMessagesByAlbum(groupedId) : undefined;\r\n\r\n    const albumMustBeRenderedFull = this.chat.type !== 'pinned';\r\n\r\n    if(groupedId && albumMustBeRenderedFull) { // will render only last album's message\r\n      albumMids = albumMessages.map((message) => message.mid);\r\n      const mainMid = getMainMidForGrouped(albumMids);\r\n      if(message.mid !== mainMid) {\r\n        return;\r\n      }\r\n    }\r\n\r\n    if(isMessage) {\r\n      reactionsMessage = groupedId ? albumMessages[0] : message;\r\n    }\r\n\r\n    // * can't use 'message.pFlags.out' here because this check will be used to define side of message (left-right)\r\n    const our = this.chat.isOurMessage(message);\r\n\r\n    const messageDiv = document.createElement('div');\r\n    messageDiv.classList.add('message', 'spoilers-container');\r\n\r\n    const contentWrapper = document.createElement('div');\r\n    contentWrapper.classList.add('bubble-content-wrapper');\r\n\r\n    const bubbleContainer = document.createElement('div');\r\n    bubbleContainer.classList.add('bubble-content');\r\n\r\n    bubble.classList.add('bubble');\r\n    contentWrapper.append(bubbleContainer);\r\n    bubble.append(contentWrapper);\r\n\r\n    const isInUnread = !our && !message.pFlags.out && (message.pFlags.unread ||\r\n      isMentionUnread(message)/*  ||\r\n      (this.historyStorage.readMaxId !== undefined && this.historyStorage.readMaxId < message.mid) */);\r\n    if(isInUnread && this.observer) {\r\n      // this.log('not our message', message, message.pFlags.unread);\r\n      this.observer.observe(bubble, this.unreadedObserverCallback);\r\n      this.unreaded.set(bubble, message.mid);\r\n    }\r\n\r\n    const loadPromises: Promise<any>[] = [];\r\n    const ret = {\r\n      bubble,\r\n      promises: loadPromises,\r\n      message,\r\n      reverse\r\n    };\r\n\r\n    if(message._ === 'messageService' && (!message.action || !SERVICE_AS_REGULAR.has(message.action._))) {\r\n      const action = message.action;\r\n      if(action) {\r\n        const _ = action._;\r\n        if(IGNORE_ACTIONS.has(_) || (langPack.hasOwnProperty(_) && !langPack[_])) {\r\n          return;\r\n        }\r\n      }\r\n\r\n      bubble.className = 'bubble service';\r\n\r\n      bubbleContainer.innerHTML = '';\r\n      const s = document.createElement('div');\r\n      s.classList.add('service-msg');\r\n      if(action) {\r\n        let promise: Promise<any>;\r\n        if(action._ === 'messageActionChannelMigrateFrom') {\r\n          const peerTitle = new PeerTitle();\r\n          promise = peerTitle.update({peerId: action.chat_id.toPeerId(true)});\r\n          s.append(i18n('ChatMigration.From', [peerTitle.element]));\r\n        } else if(action._ === 'messageActionChatMigrateTo') {\r\n          const peerTitle = new PeerTitle();\r\n          promise = peerTitle.update({peerId: action.channel_id.toPeerId(true)});\r\n          s.append(i18n('ChatMigration.To', [peerTitle.element]));\r\n        } else {\r\n          s.append(await wrapMessageActionTextNew(message));\r\n        }\r\n      }\r\n      bubbleContainer.append(s);\r\n\r\n      if(message.pFlags.is_single) { // * Ignore 'Discussion started'\r\n        bubble.classList.add('is-group-last');\r\n      }\r\n\r\n      return ret;\r\n    }\r\n\r\n    let messageMedia: MessageMedia = isMessage && message.media;\r\n\r\n    let messageMessage: string, totalEntities: MessageEntity[];\r\n    if(isMessage) {\r\n      if((messageMedia as MessageMedia.messageMediaDocument)?.document &&\r\n        !['video', 'gif'].includes(((messageMedia as MessageMedia.messageMediaDocument).document as MyDocument).type)) {\r\n        // * just filter these cases for documents caption\r\n      } else if(groupedId && albumMustBeRenderedFull) {\r\n        const t = getAlbumText(albumMessages);\r\n        messageMessage = t.message;\r\n        // totalEntities = t.entities;\r\n        totalEntities = t.totalEntities;\r\n      } else if(((messageMedia as MessageMedia.messageMediaDocument)?.document as MyDocument)?.type !== 'sticker') {\r\n        messageMessage = message.message;\r\n        // totalEntities = message.entities;\r\n        totalEntities = message.totalEntities;\r\n      }\r\n    } else {\r\n      if(message.action._ === 'messageActionPhoneCall') {\r\n        messageMedia = {\r\n          _: 'messageMediaCall',\r\n          action: message.action\r\n        };\r\n      }\r\n    }\r\n\r\n    let bigEmojis = 0, customEmojiSize: MediaSize;\r\n    if(totalEntities && !messageMedia) {\r\n      const emojiEntities = totalEntities.filter((e) => e._ === 'messageEntityEmoji'/*  || e._ === 'messageEntityCustomEmoji' */);\r\n      const strLength = messageMessage.replace(/\\s/g, '').length;\r\n      const emojiStrLength = emojiEntities.reduce((acc, curr) => acc + curr.length, 0);\r\n\r\n      if(emojiStrLength === strLength /* && emojiEntities.length <= 3 *//*  && totalEntities.length === emojiEntities.length */) {\r\n        bigEmojis = Math.min(4, emojiEntities.length);\r\n\r\n        customEmojiSize = mediaSizes.active.customEmoji;\r\n        const sizes: {[size: number]: number} = {\r\n          1: 96,\r\n          2: 64,\r\n          3: 52,\r\n          4: 36\r\n        };\r\n\r\n        const size = sizes[bigEmojis];\r\n        if(size) {\r\n          customEmojiSize = makeMediaSize(size, size);\r\n          bubble.style.setProperty('--emoji-size', size + 'px');\r\n        }\r\n      }\r\n    }\r\n\r\n    const richText = wrapRichText(messageMessage, {\r\n      entities: totalEntities,\r\n      passEntities: this.passEntities,\r\n      loadPromises,\r\n      lazyLoadQueue: this.lazyLoadQueue,\r\n      customEmojiSize,\r\n      middleware,\r\n      animationGroup: CHAT_ANIMATION_GROUP\r\n    });\r\n\r\n    let canHaveTail = true;\r\n    let isStandaloneMedia = false;\r\n    let needToSetHTML = true;\r\n    if(bigEmojis) {\r\n      if(rootScope.settings.emoji.big) {\r\n        const sticker = bigEmojis === 1 &&\r\n          !totalEntities.find((entity) => entity._ === 'messageEntityCustomEmoji') &&\r\n          await this.managers.appStickersManager.getAnimatedEmojiSticker(messageMessage);\r\n        if(bigEmojis === 1 && !messageMedia && sticker) {\r\n          messageMedia = {\r\n            _: 'messageMediaDocument',\r\n            document: sticker\r\n          };\r\n        } else {\r\n          const attachmentDiv = document.createElement('div');\r\n          attachmentDiv.classList.add('attachment', 'spoilers-container');\r\n\r\n          setInnerHTML(attachmentDiv, richText);\r\n\r\n          bubbleContainer.append(attachmentDiv);\r\n        }\r\n\r\n        bubble.classList.add('is-message-empty', 'emoji-big');\r\n        isStandaloneMedia = true;\r\n        canHaveTail = false;\r\n        needToSetHTML = false;\r\n      }\r\n\r\n      bubble.classList.add('can-have-big-emoji');\r\n    }\r\n\r\n    if(needToSetHTML) {\r\n      setInnerHTML(messageDiv, richText);\r\n    }\r\n\r\n    const timeSpan = MessageRender.setTime({\r\n      chatType: this.chat.type,\r\n      message,\r\n      reactionsMessage\r\n    });\r\n    messageDiv.append(timeSpan);\r\n    bubbleContainer.prepend(messageDiv);\r\n    // bubble.prepend(timeSpan, messageDiv); // that's bad\r\n\r\n    if(isMessage && message.views) {\r\n      bubble.classList.add('channel-post');\r\n\r\n      if(!message.fwd_from?.saved_from_msg_id && this.chat.type !== 'pinned') {\r\n        const forward = document.createElement('div');\r\n        forward.classList.add('bubble-beside-button', 'forward', 'tgico-forward_filled');\r\n        bubbleContainer.prepend(forward);\r\n        bubble.classList.add('with-beside-button');\r\n      }\r\n\r\n      if(!message.pFlags.is_outgoing && this.observer) {\r\n        this.observer.observe(bubble, this.viewsObserverCallback);\r\n      }\r\n    }\r\n\r\n    const replyMarkup = isMessage && message.reply_markup;\r\n    if(replyMarkup && replyMarkup._ === 'replyInlineMarkup' && replyMarkup.rows && replyMarkup.rows.length) {\r\n      const rows = replyMarkup.rows;\r\n\r\n      const containerDiv = document.createElement('div');\r\n      containerDiv.classList.add('reply-markup');\r\n      rows.forEach((row) => {\r\n        const buttons = row.buttons;\r\n        if(!buttons || !buttons.length) return;\r\n\r\n        const rowDiv = document.createElement('div');\r\n        rowDiv.classList.add('reply-markup-row');\r\n\r\n        buttons.forEach((button) => {\r\n          let text: DocumentFragment | HTMLElement | string = wrapRichText(button.text, {noLinks: true, noLinebreaks: true});\r\n\r\n          let buttonEl: HTMLButtonElement | HTMLAnchorElement;\r\n\r\n          switch(button._) {\r\n            case 'keyboardButtonUrl': {\r\n              const r = wrapRichText(' ', {\r\n                entities: [{\r\n                  _: 'messageEntityTextUrl',\r\n                  length: 1,\r\n                  offset: 0,\r\n                  url: button.url\r\n                }]\r\n              });\r\n\r\n              buttonEl = htmlToDocumentFragment(r).firstElementChild as HTMLAnchorElement;\r\n              buttonEl.classList.add('is-link');\r\n\r\n              break;\r\n            }\r\n\r\n            case 'keyboardButtonSwitchInline': {\r\n              buttonEl = document.createElement('button');\r\n              buttonEl.classList.add('is-switch-inline');\r\n              attachClickEvent(buttonEl, (e) => {\r\n                cancelEvent(e);\r\n\r\n                const botId = message.viaBotId || message.fromId;\r\n                let promise: Promise<PeerId>;\r\n                if(button.pFlags.same_peer) promise = Promise.resolve(this.peerId);\r\n                else promise = this.managers.appInlineBotsManager.checkSwitchReturn(botId).then((peerId) => {\r\n                  if(peerId) {\r\n                    return peerId;\r\n                  }\r\n\r\n                  return new Promise<PeerId>((resolve, reject) => {\r\n                    const popup = new PopupForward({\r\n                      [this.peerId]: []\r\n                    }, (peerId) => {\r\n                      resolve(peerId);\r\n                    }, true);\r\n\r\n                    popup.addEventListener('close', () => {\r\n                      reject();\r\n                    });\r\n                  });\r\n                });\r\n\r\n                promise.then((peerId) => {\r\n                  const threadId = this.peerId === peerId ? this.chat.threadId : undefined;\r\n                  this.chat.appImManager.setInnerPeer({peerId});\r\n                  this.managers.appInlineBotsManager.switchInlineQuery(peerId, threadId, botId, button.query);\r\n                });\r\n              });\r\n              break;\r\n            }\r\n\r\n            case 'keyboardButtonBuy': {\r\n              buttonEl = document.createElement('button');\r\n              buttonEl.classList.add('is-buy');\r\n\r\n              if(messageMedia?._ === 'messageMediaInvoice') {\r\n                if(messageMedia.receipt_msg_id) {\r\n                  text = i18n('Message.ReplyActionButtonShowReceipt');\r\n                }\r\n              }\r\n\r\n              break;\r\n            }\r\n\r\n            default: {\r\n              buttonEl = document.createElement('button');\r\n              break;\r\n            }\r\n          }\r\n\r\n          buttonEl.classList.add('reply-markup-button', 'rp', 'tgico');\r\n          if(typeof(text) === 'string') {\r\n            buttonEl.insertAdjacentHTML('beforeend', text);\r\n          } else {\r\n            buttonEl.append(text);\r\n          }\r\n\r\n          ripple(buttonEl);\r\n\r\n          rowDiv.append(buttonEl);\r\n        });\r\n\r\n        containerDiv.append(rowDiv);\r\n      });\r\n\r\n      attachClickEvent(containerDiv, (e) => {\r\n        let target = e.target as HTMLElement;\r\n\r\n        if(!target.classList.contains('reply-markup-button')) target = findUpClassName(target, 'reply-markup-button');\r\n        if(\r\n          !target ||\r\n          target.classList.contains('is-link') ||\r\n          target.classList.contains('is-switch-inline') ||\r\n          target.classList.contains('is-buy')\r\n        ) return;\r\n\r\n        cancelEvent(e);\r\n\r\n        const column = whichChild(target);\r\n        const row = rows[whichChild(target.parentElement)];\r\n\r\n        if(!row.buttons || !row.buttons[column]) {\r\n          this.log.warn('no such button', row, column, message);\r\n          return;\r\n        }\r\n\r\n        const button = row.buttons[column];\r\n        this.managers.appInlineBotsManager.callbackButtonClick(this.peerId, message.mid, button).then((callbackAnswer) => {\r\n          if(typeof callbackAnswer.message === 'string' && callbackAnswer.message.length) {\r\n            toast(wrapRichText(callbackAnswer.message, {noLinks: true, noLinebreaks: true}));\r\n          }\r\n\r\n          // console.log('callbackButtonClick callbackAnswer:', callbackAnswer);\r\n        });\r\n      });\r\n\r\n      canHaveTail = false;\r\n      bubble.classList.add('with-reply-markup');\r\n      contentWrapper.append(containerDiv);\r\n    }\r\n\r\n    const isOutgoing = message.pFlags.is_outgoing/*  && this.peerId !== rootScope.myId */;\r\n    if(our) {\r\n      if(message.pFlags.unread || isOutgoing) this.unreadOut.add(message.mid);\r\n      let status = '';\r\n      if(message.error) status = 'is-error';\r\n      else if(isOutgoing) status = 'is-sending';\r\n      else status = message.pFlags.unread || (message as Message.message).pFlags.is_scheduled ? 'is-sent' : 'is-read';\r\n      bubble.classList.add(status);\r\n    }\r\n\r\n    if(isOutgoing && !message.error) {\r\n      bubble.classList.add('is-outgoing');\r\n    }\r\n\r\n    const messageWithReplies = isMessage && await this.managers.appMessagesManager.getMessageWithCommentReplies(message);\r\n    const withReplies = !!messageWithReplies && message.mid > 0;\r\n\r\n    if(withReplies) {\r\n      bubble.classList.add('with-replies');\r\n    }\r\n\r\n    const fwdFrom = isMessage && message.fwd_from;\r\n    const fwdFromId = isMessage && message.fwdFromId;\r\n\r\n    const isOut = this.chat.isOutMessage(message);\r\n    let nameContainer: HTMLElement = bubbleContainer;\r\n\r\n    const canHideNameIfMedia = !message.viaBotId && (message.fromId === rootScope.myId || !message.pFlags.out);\r\n\r\n    // media\r\n    if(messageMedia/*  && messageMedia._ === 'messageMediaPhoto' */) {\r\n      let attachmentDiv = document.createElement('div');\r\n      attachmentDiv.classList.add('attachment');\r\n\r\n      if(!messageMessage) {\r\n        bubble.classList.add('is-message-empty');\r\n      }\r\n\r\n      let processingWebPage = false;\r\n\r\n      /* if(isMessage)  */switch(messageMedia._) {\r\n        case 'messageMediaPhoto': {\r\n          const photo = messageMedia.photo;\r\n          // //////this.log('messageMediaPhoto', photo);\r\n\r\n          if(!messageMessage) {\r\n            canHaveTail = false;\r\n          }\r\n\r\n          if(canHideNameIfMedia) {\r\n            bubble.classList.add('hide-name');\r\n          }\r\n\r\n          bubble.classList.add('photo');\r\n\r\n          if(albumMustBeRenderedFull && groupedId && albumMids.length !== 1) {\r\n            bubble.classList.add('is-album', 'is-grouped');\r\n            wrapAlbum({\r\n              messages: albumMessages,\r\n              attachmentDiv,\r\n              middleware: this.getMiddleware(),\r\n              isOut: our,\r\n              lazyLoadQueue: this.lazyLoadQueue,\r\n              chat: this.chat,\r\n              loadPromises,\r\n              autoDownload: this.chat.autoDownload\r\n            });\r\n\r\n            break;\r\n          }\r\n\r\n          const withTail = !IS_ANDROID && canHaveTail && !withReplies && USE_MEDIA_TAILS;\r\n          if(withTail) bubble.classList.add('with-media-tail');\r\n          wrapPhoto({\r\n            photo: photo as Photo.photo,\r\n            message,\r\n            container: attachmentDiv,\r\n            withTail,\r\n            isOut,\r\n            lazyLoadQueue: this.lazyLoadQueue,\r\n            middleware: this.getMiddleware(),\r\n            loadPromises,\r\n            autoDownloadSize: this.chat.autoDownload.photo\r\n          });\r\n\r\n          break;\r\n        }\r\n\r\n        case 'messageMediaWebPage': {\r\n          processingWebPage = true;\r\n\r\n          const webPage: WebPage = messageMedia.webpage;\r\n          // //////this.log('messageMediaWebPage', webpage);\r\n          if(webPage._ !== 'webPage') {\r\n            break;\r\n          }\r\n\r\n          bubble.classList.add('webpage');\r\n\r\n          const box = document.createElement('div');\r\n          box.classList.add('web');\r\n\r\n          const quote = document.createElement('div');\r\n          quote.classList.add('quote');\r\n\r\n          let previewResizer: HTMLDivElement, preview: HTMLDivElement;\r\n          const photo: Photo.photo = webPage.photo as any;\r\n          if(photo || webPage.document) {\r\n            previewResizer = document.createElement('div');\r\n            previewResizer.classList.add('preview-resizer');\r\n            preview = document.createElement('div');\r\n            preview.classList.add('preview');\r\n            previewResizer.append(preview);\r\n          }\r\n\r\n          const quoteTextDiv = document.createElement('div');\r\n          quoteTextDiv.classList.add('quote-text');\r\n\r\n          const doc = webPage.document as MyDocument;\r\n          if(doc) {\r\n            if(doc.type === 'gif' || doc.type === 'video' || doc.type === 'round') {\r\n              // if(doc.size <= 20e6) {\r\n              const mediaSize = doc.type === 'round' ? mediaSizes.active.round : mediaSizes.active.webpage;\r\n              if(doc.type === 'round') {\r\n                bubble.classList.add('round');\r\n                preview.classList.add('is-round');\r\n              } else {\r\n                bubble.classList.add('video');\r\n              }\r\n              wrapVideo({\r\n                doc,\r\n                container: preview,\r\n                message: message as Message.message,\r\n                boxWidth: mediaSize.width,\r\n                boxHeight: mediaSize.height,\r\n                lazyLoadQueue: this.lazyLoadQueue,\r\n                middleware: this.getMiddleware(),\r\n                isOut,\r\n                group: CHAT_ANIMATION_GROUP,\r\n                loadPromises,\r\n                autoDownload: this.chat.autoDownload,\r\n                noInfo: message.mid < 0\r\n              });\r\n              // }\r\n            } else {\r\n              const docDiv = await wrapDocument({\r\n                message: message as Message.message,\r\n                autoDownloadSize: this.chat.autoDownload.file,\r\n                lazyLoadQueue: this.lazyLoadQueue,\r\n                loadPromises,\r\n                sizeType: 'documentName',\r\n                searchContext: {\r\n                  useSearch: false,\r\n                  peerId: this.peerId,\r\n                  inputFilter: {\r\n                    _: 'inputMessagesFilterEmpty'\r\n                  }\r\n                }\r\n              });\r\n              preview.append(docDiv);\r\n              preview.classList.add('preview-with-document');\r\n              quoteTextDiv.classList.add('has-document');\r\n              // messageDiv.classList.add((webpage.type || 'document') + '-message');\r\n              // doc = null;\r\n            }\r\n          }\r\n\r\n          if(previewResizer) {\r\n            quoteTextDiv.append(previewResizer);\r\n          }\r\n\r\n          let t: HTMLElement;\r\n          if(webPage.site_name) {\r\n            const html = wrapRichText(webPage.url);\r\n            const a: HTMLAnchorElement = htmlToDocumentFragment(html).firstElementChild as any;\r\n            a.classList.add('webpage-name');\r\n            const strong = document.createElement('strong');\r\n            setInnerHTML(strong, wrapEmojiText(webPage.site_name));\r\n            a.textContent = '';\r\n            a.append(strong);\r\n            quoteTextDiv.append(a);\r\n            t = a;\r\n          }\r\n\r\n          const title = wrapWebPageTitle(webPage);\r\n          if(title.textContent) {\r\n            const titleDiv = document.createElement('div');\r\n            titleDiv.classList.add('title');\r\n            const strong = document.createElement('strong');\r\n            setInnerHTML(strong, title);\r\n            titleDiv.append(strong);\r\n            quoteTextDiv.append(titleDiv);\r\n            t = titleDiv;\r\n          }\r\n\r\n          const description = wrapWebPageDescription(webPage);\r\n          if(description.textContent) {\r\n            const textDiv = document.createElement('div');\r\n            textDiv.classList.add('text');\r\n            setInnerHTML(textDiv, description);\r\n            quoteTextDiv.append(textDiv);\r\n            t = textDiv;\r\n          }\r\n\r\n          /* if(t) {\r\n            t.append(timeSpan);\r\n          } else {\r\n            box.classList.add('no-text');\r\n          } */\r\n\r\n          quote.append(quoteTextDiv);\r\n\r\n          if(photo && !doc) {\r\n            bubble.classList.add('photo');\r\n\r\n            const size: PhotoSize.photoSize = photo.sizes[photo.sizes.length - 1] as any;\r\n            let isSquare = false;\r\n            if(size.w === size.h && t) {\r\n              bubble.classList.add('is-square-photo');\r\n              isSquare = true;\r\n              setAttachmentSize(photo, preview, 48, 48, false);\r\n\r\n              /* if(t) {\r\n                t.append(timeSpan);\r\n              } */\r\n            } else if(size.h > size.w) {\r\n              bubble.classList.add('is-vertical-photo');\r\n            }\r\n\r\n            wrapPhoto({\r\n              photo,\r\n              message,\r\n              container: preview,\r\n              boxWidth: isSquare ? 0 : mediaSizes.active.webpage.width,\r\n              boxHeight: isSquare ? 0 : mediaSizes.active.webpage.height,\r\n              isOut,\r\n              lazyLoadQueue: this.lazyLoadQueue,\r\n              middleware: this.getMiddleware(),\r\n              loadPromises,\r\n              withoutPreloader: isSquare,\r\n              autoDownloadSize: this.chat.autoDownload.photo\r\n            });\r\n          }\r\n\r\n          box.append(quote);\r\n\r\n          // bubble.prepend(box);\r\n          // if(timeSpan.parentElement === messageDiv) {\r\n          messageDiv.insertBefore(box, timeSpan);\r\n          // } else {\r\n          //   messageDiv.append(box);\r\n          // }\r\n\r\n          // this.log('night running', bubble.scrollHeight);\r\n\r\n          break;\r\n        }\r\n\r\n        case 'messageMediaDocument': {\r\n          const doc = messageMedia.document as MyDocument;\r\n\r\n          // this.log('messageMediaDocument', doc, bubble);\r\n\r\n          if(doc.sticker/*  && doc.size <= 1e6 */) {\r\n            bubble.classList.add('sticker');\r\n            canHaveTail = false;\r\n            isStandaloneMedia = true;\r\n\r\n            if(doc.animated) {\r\n              bubble.classList.add('sticker-animated');\r\n            }\r\n\r\n            const sizes = mediaSizes.active;\r\n            const isEmoji = bubble.classList.contains('emoji-big');\r\n            const boxSize = isEmoji ? sizes.emojiSticker : (doc.animated ? sizes.animatedSticker : sizes.staticSticker);\r\n            setAttachmentSize(doc, attachmentDiv, boxSize.width, boxSize.height);\r\n            // let preloader = new ProgressivePreloader(attachmentDiv, false);\r\n            bubbleContainer.style.minWidth = attachmentDiv.style.width;\r\n            bubbleContainer.style.minHeight = attachmentDiv.style.height;\r\n            // appPhotosManager.setAttachmentSize(doc, bubble);\r\n            wrapSticker({\r\n              doc,\r\n              div: attachmentDiv,\r\n              middleware,\r\n              lazyLoadQueue: this.lazyLoadQueue,\r\n              group: CHAT_ANIMATION_GROUP,\r\n              // play: !!message.pending || !multipleRender,\r\n              play: true,\r\n              loop: true,\r\n              emoji: isEmoji ? messageMessage : undefined,\r\n              withThumb: true,\r\n              loadPromises,\r\n              isOut,\r\n              noPremium: messageMedia?.pFlags?.nopremium\r\n            });\r\n\r\n            if(getStickerEffectThumb(doc) && (isInUnread || isOutgoing)/*  || true */) {\r\n              this.observer.observe(bubble, this.stickerEffectObserverCallback);\r\n            }\r\n          } else if(doc.type === 'video' || doc.type === 'gif' || doc.type === 'round'/*  && doc.size <= 20e6 */) {\r\n            // this.log('never get free 2', doc);\r\n\r\n            const isRound = doc.type === 'round';\r\n            if(isRound) {\r\n              isStandaloneMedia = true;\r\n            }\r\n\r\n            if(isRound || !messageMessage) {\r\n              canHaveTail = false;\r\n            }\r\n\r\n            if(canHideNameIfMedia) {\r\n              bubble.classList.add('hide-name');\r\n            }\r\n\r\n            bubble.classList.add(isRound ? 'round' : 'video');\r\n            if(albumMustBeRenderedFull && groupedId && albumMids.length !== 1) {\r\n              bubble.classList.add('is-album', 'is-grouped');\r\n\r\n              wrapAlbum({\r\n                messages: albumMessages,\r\n                attachmentDiv,\r\n                middleware,\r\n                isOut: our,\r\n                lazyLoadQueue: this.lazyLoadQueue,\r\n                chat: this.chat,\r\n                loadPromises,\r\n                autoDownload: this.chat.autoDownload\r\n              });\r\n            } else {\r\n              const withTail = !IS_ANDROID && !IS_APPLE && !isRound && canHaveTail && !withReplies && USE_MEDIA_TAILS;\r\n              if(withTail) bubble.classList.add('with-media-tail');\r\n              wrapVideo({\r\n                doc,\r\n                container: attachmentDiv,\r\n                message: message as Message.message,\r\n                boxWidth: mediaSizes.active.regular.width,\r\n                boxHeight: mediaSizes.active.regular.height,\r\n                withTail,\r\n                isOut,\r\n                lazyLoadQueue: this.lazyLoadQueue,\r\n                middleware,\r\n                group: CHAT_ANIMATION_GROUP,\r\n                loadPromises,\r\n                autoDownload: this.chat.autoDownload,\r\n                searchContext: isRound ? {\r\n                  peerId: this.peerId,\r\n                  inputFilter: {_: 'inputMessagesFilterRoundVoice'},\r\n                  threadId: this.chat.threadId,\r\n                  useSearch: !(message as Message.message).pFlags.is_scheduled,\r\n                  isScheduled: (message as Message.message).pFlags.is_scheduled\r\n                } : undefined,\r\n                noInfo: message.mid < 0\r\n              });\r\n            }\r\n          } else {\r\n            const newNameContainer = await wrapGroupedDocuments({\r\n              albumMustBeRenderedFull,\r\n              message,\r\n              bubble,\r\n              messageDiv,\r\n              chat: this.chat,\r\n              loadPromises,\r\n              autoDownloadSize: this.chat.autoDownload.file,\r\n              lazyLoadQueue: this.lazyLoadQueue,\r\n              searchContext: doc.type === 'voice' || doc.type === 'audio' ? {\r\n                peerId: this.peerId,\r\n                inputFilter: {_: doc.type === 'voice' ? 'inputMessagesFilterRoundVoice' : 'inputMessagesFilterMusic'},\r\n                threadId: this.chat.threadId,\r\n                useSearch: !(message as Message.message).pFlags.is_scheduled,\r\n                isScheduled: (message as Message.message).pFlags.is_scheduled\r\n              } : undefined,\r\n              sizeType: 'documentName'\r\n            });\r\n\r\n            if(newNameContainer) {\r\n              nameContainer = newNameContainer;\r\n            }\r\n\r\n            const lastContainer = messageDiv.lastElementChild.querySelector('.document-message, .document, .audio');\r\n            // lastContainer && lastContainer.append(timeSpan.cloneNode(true));\r\n            lastContainer && lastContainer.append(timeSpan);\r\n\r\n            bubble.classList.remove('is-message-empty');\r\n            messageDiv.classList.add((!(['photo', 'pdf'] as MyDocument['type'][]).includes(doc.type) ? doc.type || 'document' : 'document') + '-message');\r\n            processingWebPage = true;\r\n          }\r\n\r\n          break;\r\n        }\r\n\r\n        case 'messageMediaCall': {\r\n          const action = messageMedia.action;\r\n          const div = document.createElement('div');\r\n          div.classList.add('bubble-call', action.pFlags.video ? 'tgico-videocamera' : 'tgico-phone');\r\n\r\n          const type: CallType = action.pFlags.video ? 'video' : 'voice';\r\n          div.dataset.type = type;\r\n\r\n          const title = document.createElement('div');\r\n          title.classList.add('bubble-call-title');\r\n\r\n          _i18n(title, isOut ?\r\n            (action.pFlags.video ? 'CallMessageVideoOutgoing' : 'CallMessageOutgoing') :\r\n            (action.pFlags.video ? 'CallMessageVideoIncoming' : 'CallMessageIncoming'));\r\n\r\n          const subtitle = document.createElement('div');\r\n          subtitle.classList.add('bubble-call-subtitle');\r\n\r\n          if(action.duration !== undefined) {\r\n            subtitle.append(formatCallDuration(action.duration));\r\n          } else {\r\n            let langPackKey: LangPackKey;\r\n            switch(action.reason._) {\r\n              case 'phoneCallDiscardReasonBusy':\r\n                langPackKey = 'Call.StatusBusy';\r\n                break;\r\n              case 'phoneCallDiscardReasonMissed':\r\n                langPackKey = 'Chat.Service.Call.Missed';\r\n                break;\r\n              // case 'phoneCallDiscardReasonHangup':\r\n              default:\r\n                langPackKey = 'Chat.Service.Call.Cancelled';\r\n                break;\r\n            }\r\n\r\n            subtitle.classList.add('is-reason');\r\n            _i18n(subtitle, langPackKey);\r\n          }\r\n\r\n          subtitle.classList.add('tgico', 'arrow-' + (action.duration !== undefined ? 'green' : 'red'));\r\n\r\n          div.append(title, subtitle);\r\n\r\n          processingWebPage = true;\r\n\r\n          bubble.classList.remove('is-message-empty');\r\n          messageDiv.classList.add('call-message');\r\n          messageDiv.append(div);\r\n\r\n          break;\r\n        }\r\n\r\n        case 'messageMediaContact': {\r\n          // this.log('wrapping contact', message);\r\n\r\n          const contact = messageMedia;\r\n          const contactDiv = document.createElement('div');\r\n          contactDiv.classList.add('contact');\r\n          contactDiv.dataset.peerId = '' + contact.user_id;\r\n\r\n          processingWebPage = true;\r\n\r\n          const contactDetails = document.createElement('div');\r\n          contactDetails.className = 'contact-details';\r\n          const contactNameDiv = document.createElement('div');\r\n          contactNameDiv.className = 'contact-name';\r\n          contactNameDiv.append(\r\n            wrapEmojiText([\r\n              contact.first_name,\r\n              contact.last_name\r\n            ].filter(Boolean).join(' '))\r\n          );\r\n\r\n          const contactNumberDiv = document.createElement('div');\r\n          contactNumberDiv.className = 'contact-number';\r\n          contactNumberDiv.textContent = contact.phone_number ? '+' + formatPhoneNumber(contact.phone_number).formatted : 'Unknown phone number';\r\n\r\n          contactDiv.append(contactDetails);\r\n          contactDetails.append(contactNameDiv, contactNumberDiv);\r\n\r\n          const avatarElem = new AvatarElement();\r\n          avatarElem.updateWithOptions({\r\n            lazyLoadQueue: this.lazyLoadQueue,\r\n            peerId: contact.user_id.toPeerId()\r\n          });\r\n          avatarElem.classList.add('contact-avatar', 'avatar-54');\r\n\r\n          contactDiv.prepend(avatarElem);\r\n\r\n          bubble.classList.remove('is-message-empty');\r\n          messageDiv.classList.add('contact-message');\r\n          messageDiv.append(contactDiv);\r\n\r\n          break;\r\n        }\r\n\r\n        case 'messageMediaPoll': {\r\n          bubble.classList.remove('is-message-empty');\r\n\r\n          const pollElement = wrapPoll(message);\r\n          messageDiv.prepend(pollElement);\r\n          messageDiv.classList.add('poll-message');\r\n\r\n          break;\r\n        }\r\n\r\n        case 'messageMediaInvoice': {\r\n          const isTest = messageMedia.pFlags.test;\r\n          const photo = messageMedia.photo;\r\n\r\n          const priceEl = document.createElement(photo ? 'span' : 'div');\r\n          const f = document.createDocumentFragment();\r\n          const l = i18n(messageMedia.receipt_msg_id ? 'PaymentReceipt' : (isTest ? 'PaymentTestInvoice' : 'PaymentInvoice'));\r\n          l.classList.add('text-uppercase');\r\n          const joiner = ' ';\r\n          const p = document.createElement('span');\r\n          p.classList.add('text-bold');\r\n          p.textContent = paymentsWrapCurrencyAmount(messageMedia.total_amount, messageMedia.currency) + joiner;\r\n          f.append(p, l);\r\n          if(isTest && messageMedia.receipt_msg_id) {\r\n            const a = document.createElement('span');\r\n            a.classList.add('text-uppercase', 'pre-wrap');\r\n            a.append(joiner + '(Test)');\r\n            f.append(a);\r\n          }\r\n          setInnerHTML(priceEl, f);\r\n\r\n          if(photo) {\r\n            const mediaSize = mediaSizes.active.invoice;\r\n            wrapPhoto({\r\n              photo,\r\n              container: attachmentDiv,\r\n              withTail: false,\r\n              isOut,\r\n              lazyLoadQueue: this.lazyLoadQueue,\r\n              middleware,\r\n              loadPromises,\r\n              boxWidth: mediaSize.width,\r\n              boxHeight: mediaSize.height\r\n            });\r\n\r\n            bubble.classList.add('photo');\r\n\r\n            priceEl.classList.add('video-time');\r\n            attachmentDiv.append(priceEl);\r\n          } else {\r\n            attachmentDiv = undefined;\r\n          }\r\n\r\n          const titleDiv = document.createElement('div');\r\n          titleDiv.classList.add('bubble-primary-color');\r\n          setInnerHTML(titleDiv, wrapEmojiText(messageMedia.title));\r\n\r\n          const richText = wrapEmojiText(messageMedia.description);\r\n          messageDiv.prepend(...[titleDiv, !photo && priceEl, richText].filter(Boolean));\r\n\r\n          bubble.classList.remove('is-message-empty');\r\n          bubble.classList.add('is-invoice');\r\n\r\n          break;\r\n        }\r\n\r\n        default:\r\n          attachmentDiv = undefined;\r\n          bubble.classList.remove('is-message-empty');\r\n          messageDiv.append(i18n(UNSUPPORTED_LANG_PACK_KEY), timeSpan);\r\n          this.log.warn('unrecognized media type:', messageMedia._, message);\r\n          break;\r\n      }\r\n\r\n      if(!processingWebPage && attachmentDiv) {\r\n        bubbleContainer.append(attachmentDiv);\r\n      }\r\n\r\n      /* if(bubble.classList.contains('is-message-empty') && (bubble.classList.contains('photo') || bubble.classList.contains('video'))) {\r\n        bubble.classList.add('no-tail');\r\n\r\n        if(!bubble.classList.contains('with-media-tail')) {\r\n          bubble.classList.add('use-border-radius');\r\n        }\r\n      } */\r\n    }\r\n\r\n    if(isStandaloneMedia) {\r\n      bubble.classList.add('just-media');\r\n    }\r\n\r\n    let savedFrom = '';\r\n\r\n    // const needName = ((peerId.isAnyChat() && (peerId !== message.fromId || our)) && message.fromId !== rootScope.myId) || message.viaBotId;\r\n    const needName = (message.fromId !== rootScope.myId && this.chat.isAnyGroup) || message.viaBotId || (message as Message.message).pFlags.sponsored;\r\n    if(needName || fwdFrom || message.reply_to_mid) { // chat\r\n      let title: HTMLElement | DocumentFragment;\r\n      let titleVia: typeof title;\r\n\r\n      const isForwardFromChannel = message.from_id && message.from_id._ === 'peerChannel' && message.fromId === fwdFromId;\r\n\r\n      const isHidden = fwdFrom && !fwdFrom.from_id;\r\n      if(message.viaBotId) {\r\n        titleVia = document.createElement('span');\r\n        titleVia.innerText = '@' + (await this.managers.appUsersManager.getUser(message.viaBotId)).username;\r\n        titleVia.classList.add('peer-title');\r\n        bubble.classList.add('must-have-name');\r\n      }\r\n\r\n      if(isHidden) {\r\n        // /////this.log('message to render hidden', message);\r\n        title = document.createElement('span');\r\n        setInnerHTML(title, wrapEmojiText(fwdFrom.from_name));\r\n        title.classList.add('peer-title');\r\n        // title = fwdFrom.from_name;\r\n        bubble.classList.add('hidden-profile');\r\n      } else {\r\n        title = new PeerTitle({peerId: fwdFromId || message.fromId}).element;\r\n      }\r\n\r\n      if(message.reply_to_mid && message.reply_to_mid !== this.chat.threadId && isMessage) {\r\n        await MessageRender.setReply({\r\n          chat: this.chat,\r\n          bubble,\r\n          bubbleContainer,\r\n          message\r\n        });\r\n      }\r\n\r\n      // this.log(title);\r\n\r\n      let nameDiv: HTMLElement;\r\n      if((fwdFromId || fwdFrom)) {\r\n        if(this.peerId !== rootScope.myId && !isForwardFromChannel) {\r\n          bubble.classList.add('forwarded');\r\n        }\r\n\r\n        if(message.savedFrom) {\r\n          savedFrom = message.savedFrom;\r\n          title.dataset.savedFrom = savedFrom;\r\n        }\r\n\r\n        nameDiv = document.createElement('div');\r\n        title.dataset.peerId = '' + fwdFromId;\r\n\r\n        if((this.peerId === rootScope.myId || this.peerId === REPLIES_PEER_ID || isForwardFromChannel) && !isStandaloneMedia) {\r\n          nameDiv.style.color = getPeerColorById(fwdFromId, false);\r\n          nameDiv.append(title);\r\n        } else {\r\n          /* const fromTitle = message.fromId === this.myID || appPeersManager.isBroadcast(fwdFromId || message.fromId) ? '' : `<div class=\"name\" data-peer-id=\"${message.fromId}\" style=\"color: ${appPeersManager.getPeerColorByID(message.fromId, false)};\">${appPeersManager.getPeerTitle(message.fromId)}</div>`;\r\n          nameDiv.innerHTML = fromTitle + 'Forwarded from ' + title; */\r\n          const args: FormatterArguments = [title];\r\n          if(isStandaloneMedia) {\r\n            args.unshift(document.createElement('br'));\r\n          }\r\n          nameDiv.append(i18n('ForwardedFrom', [args]));\r\n        }\r\n      } else if(!message.viaBotId) {\r\n        if(!isStandaloneMedia && needName) {\r\n          nameDiv = document.createElement('div');\r\n          nameDiv.append(title);\r\n\r\n          const peer = await this.managers.appPeersManager.getPeer(message.fromId);\r\n          const pFlags = (peer as User.user)?.pFlags;\r\n          if(pFlags && (pFlags.scam || pFlags.fake)) {\r\n            nameDiv.append(generateFakeIcon(pFlags.scam));\r\n          }\r\n\r\n          if(!our) {\r\n            nameDiv.style.color = getPeerColorById(message.fromId, false);\r\n          }\r\n\r\n          nameDiv.dataset.peerId = '' + message.fromId;\r\n        } else /* if(!message.reply_to_mid) */ {\r\n          bubble.classList.add('hide-name');\r\n        }\r\n      }\r\n\r\n      if(message.viaBotId) {\r\n        if(!nameDiv) {\r\n          nameDiv = document.createElement('div');\r\n        } else {\r\n          nameDiv.append(' ');\r\n        }\r\n\r\n        const span = document.createElement('span');\r\n        span.append(i18n('ViaBot'), ' ', titleVia);\r\n        span.classList.add('is-via');\r\n\r\n        nameDiv.append(span);\r\n      }\r\n\r\n      if(nameDiv) {\r\n        nameDiv.classList.add('name');\r\n        nameContainer.append(nameDiv);\r\n      }\r\n    } else {\r\n      bubble.classList.add('hide-name');\r\n    }\r\n\r\n    if(this.chat.type === 'pinned') {\r\n      savedFrom = `${this.chat.peerId}_${message.mid}`;\r\n    }\r\n\r\n    const isThreadStarter = messageWithReplies && messageWithReplies.mid === this.chat.threadId;\r\n    if(isThreadStarter) {\r\n      bubble.classList.add('is-thread-starter', 'is-group-last');\r\n    }\r\n\r\n    if(savedFrom && (this.chat.type === 'pinned' || fwdFrom.saved_from_msg_id) && this.peerId !== REPLIES_PEER_ID) {\r\n      const goto = document.createElement('div');\r\n      goto.classList.add('bubble-beside-button', 'goto-original', 'tgico-arrow_next');\r\n      bubbleContainer.append(goto);\r\n      bubble.dataset.savedFrom = savedFrom;\r\n      bubble.classList.add('with-beside-button');\r\n    }\r\n\r\n    bubble.classList.add(isOut ? 'is-out' : 'is-in');\r\n\r\n    if(withReplies) {\r\n      const isFooter = MessageRender.renderReplies({\r\n        bubble,\r\n        bubbleContainer,\r\n        message: messageWithReplies,\r\n        messageDiv,\r\n        loadPromises,\r\n        lazyLoadQueue: this.lazyLoadQueue\r\n      });\r\n\r\n      if(isFooter) {\r\n        canHaveTail = true;\r\n      } else {\r\n        bubble.classList.add('with-beside-replies');\r\n      }\r\n    }\r\n\r\n    if(isMessage) {\r\n      this.appendReactionsElementToBubble(bubble, message, reactionsMessage);\r\n    }\r\n\r\n    /* if(isMessage) {\r\n      const reactionHover = document.createElement('div');\r\n      reactionHover.classList.add('bubble-reaction-hover');\r\n      contentWrapper.append(reactionHover);\r\n    } */\r\n\r\n    if(canHaveTail) {\r\n      bubble.classList.add('can-have-tail');\r\n\r\n      bubbleContainer.append(generateTail());\r\n    }\r\n\r\n    return ret;\r\n  }\r\n\r\n  private appendReactionsElementToBubble(bubble: HTMLElement, message: Message.message, reactionsMessage: Message.message, changedResults?: ReactionCount[]) {\r\n    if(this.peerId.isUser()/*  || true */) {\r\n      return;\r\n    }\r\n\r\n    if(!reactionsMessage?.reactions || !reactionsMessage.reactions.results.length) {\r\n      return;\r\n    }\r\n\r\n    // message = this.appMessagesManager.getMessageWithReactions(message);\r\n\r\n    const reactionsElement = new ReactionsElement();\r\n    reactionsElement.init(reactionsMessage, 'block');\r\n    reactionsElement.render(changedResults);\r\n\r\n    if(bubble.classList.contains('is-message-empty')) {\r\n      bubble.querySelector('.bubble-content-wrapper').append(reactionsElement);\r\n    } else {\r\n      const messageDiv = bubble.querySelector('.message');\r\n      if(bubble.classList.contains('is-multiple-documents')) {\r\n        const documentContainer = messageDiv.lastElementChild as HTMLElement;\r\n        let documentMessageDiv = documentContainer.querySelector('.document-message');\r\n\r\n        let timeSpan: HTMLElement = documentMessageDiv && documentMessageDiv.querySelector('.time');\r\n        if(!timeSpan) {\r\n          timeSpan = MessageRender.setTime({\r\n            chatType: this.chat.type,\r\n            message,\r\n            reactionsMessage\r\n          });\r\n        }\r\n\r\n        reactionsElement.append(timeSpan);\r\n\r\n        if(!documentMessageDiv) {\r\n          documentMessageDiv = document.createElement('div');\r\n          documentMessageDiv.classList.add('document-message');\r\n          documentContainer.querySelector('.document-wrapper').prepend(documentMessageDiv);\r\n        }\r\n\r\n        documentMessageDiv.append(reactionsElement);\r\n      } else {\r\n        const timeSpan = Array.from(bubble.querySelectorAll('.time')).pop();\r\n        reactionsElement.append(timeSpan);\r\n\r\n        messageDiv.append(reactionsElement);\r\n      }\r\n    }\r\n  }\r\n\r\n  private prepareToSaveScroll(reverse?: boolean) {\r\n    const isMounted = !!this.chatInner.parentElement;\r\n    if(!isMounted) {\r\n      return {};\r\n    }\r\n\r\n    const log = this.log.bindPrefix('prepareToSaveScroll');\r\n    log('save');\r\n    const scrollSaver = this.createScrollSaver(reverse);\r\n    scrollSaver.save(); // * let's save scroll position by point before the slicing, not after\r\n\r\n    if(this.getRenderedLength() && !this.chat.setPeerPromise) {\r\n      const viewportSlice = this.getViewportSlice();\r\n      this.deleteViewportSlice(viewportSlice, true);\r\n    }\r\n\r\n    // scrollSaver.save(); // ! slicing will corrupt scroll position\r\n    // const saved = scrollSaver.getSaved();\r\n    // const hadScroll = saved.scrollHeight !== saved.clientHeight;\r\n\r\n    return {\r\n      restoreScroll: () => {\r\n        log('restore');\r\n        // scrollSaver.restore(_history.length === 1 && !reverse ? false : true);\r\n        scrollSaver.restore(reverse);\r\n        this.onRenderScrollSet(scrollSaver.getSaved());\r\n      },\r\n      scrollSaver\r\n    };\r\n  }\r\n\r\n  public async performHistoryResult(historyResult: HistoryResult | {history: (Message.message | Message.messageService | number)[]}, reverse: boolean) {\r\n    const log = false ? this.log.bindPrefix('perform-' + (Math.random() * 1000 | 0)) : undefined;\r\n    log && log('start', this.chatInner.parentElement);\r\n\r\n    let history = historyResult.history;\r\n    history = history.slice(); // need\r\n\r\n    if(this.needReflowScroll) {\r\n      reflowScrollableElement(this.scrollable.container);\r\n      this.needReflowScroll = false;\r\n    }\r\n\r\n    const cb = (message: Message.message | Message.messageService) => {\r\n      if(!message) {\r\n        return;\r\n      } else if(message.pFlags.local) {\r\n        return this.processLocalMessageRender(message);\r\n      } else {\r\n        return this.safeRenderMessage(message, reverse);\r\n      }\r\n    };\r\n\r\n    const messages = await Promise.all(history.map((mid) => {\r\n      return typeof(mid) === 'number' ? this.chat.getMessage(mid) : mid;\r\n    }));\r\n\r\n    const setLoadedPromises: Promise<any>[] = [];\r\n    if(!this.scrollable.loadedAll['bottom'] || !this.scrollable.loadedAll['top']) {\r\n      let isEnd = (historyResult as HistoryResult).isEnd;\r\n      if(!isEnd) {\r\n        const historyStorage = await this.chat.getHistoryStorage();\r\n        const firstSlice = historyStorage.history.first;\r\n        const lastSlice = historyStorage.history.last;\r\n        isEnd = {top: false, bottom: false, both: false};\r\n        if(firstSlice.isEnd(SliceEnd.Bottom) && (!firstSlice.length || history.includes(firstSlice[0]))) {\r\n          isEnd.bottom = true;\r\n        }\r\n\r\n        if(lastSlice.isEnd(SliceEnd.Top) && (!lastSlice.length || history.includes(lastSlice[lastSlice.length - 1]))) {\r\n          isEnd.top = true;\r\n        }\r\n      }\r\n\r\n      if(!isEnd.bottom && this.setPeerOptions) {\r\n        const {lastMsgId, topMessage} = this.setPeerOptions;\r\n        this.setPeerOptions = undefined;\r\n        if(!lastMsgId || this.bubbles[topMessage] || lastMsgId === topMessage) {\r\n          isEnd.bottom = true;\r\n        }\r\n      }\r\n\r\n      if(isEnd.top) setLoadedPromises.push(this.setLoaded('top', true));\r\n      if(isEnd.bottom) setLoadedPromises.push(this.setLoaded('bottom', true));\r\n    }\r\n\r\n    await Promise.all(setLoadedPromises);\r\n\r\n    // ! it is important to insert bubbles to group reversed way\r\n    // const length = history.length, promises: Promise<any>[] = [];\r\n    // if(reverse) for(let i = 0; i < length; ++i) promises.push(cb(messages[i]));\r\n    // else for(let i = length - 1; i >= 0; --i) promises.push(cb(messages[i]));\r\n    const promises = messages.map(cb);\r\n\r\n    // cannot combine them into one promise\r\n    await Promise.all(promises);\r\n    await this.messagesQueuePromise;\r\n\r\n    if(this.scrollable.loadedAll.top && this.messagesQueueOnRenderAdditional) {\r\n      this.messagesQueueOnRenderAdditional();\r\n\r\n      if(this.messagesQueueOnRenderAdditional) {\r\n        this.messagesQueueOnRenderAdditional();\r\n      }\r\n    }\r\n\r\n    log && log('performHistoryResult end');\r\n  }\r\n\r\n  private onRenderScrollSet(state?: {scrollHeight: number, clientHeight: number}) {\r\n    const className = 'has-sticky-dates';\r\n    if(!this.container.classList.contains(className)) {\r\n      const isLoading = !this.preloader.detached;\r\n\r\n      if(isLoading ||\r\n        (\r\n          state ??= {\r\n            scrollHeight: this.scrollable.scrollHeight,\r\n            clientHeight: this.scrollable.container.clientHeight\r\n          },\r\n          state.scrollHeight !== state.clientHeight\r\n        )\r\n      ) {\r\n        /* for(const timestamp in this.dateMessages) {\r\n          const dateMessage = this.dateMessages[timestamp];\r\n          dateMessage.div.classList.add('is-sticky');\r\n        } */\r\n\r\n        const middleware = this.getMiddleware();\r\n        const callback = () => {\r\n          if(!middleware()) return;\r\n          this.container.classList.add(className);\r\n        };\r\n\r\n        if(this.willScrollOnLoad) {\r\n          callback();\r\n        } else {\r\n          setTimeout(callback, 600);\r\n        }\r\n\r\n        return;\r\n      }\r\n    }\r\n\r\n    this.willScrollOnLoad = undefined;\r\n  }\r\n\r\n  public onDatePick = (timestamp: number) => {\r\n    const peerId = this.peerId;\r\n    this.managers.appMessagesManager.requestHistory(peerId, 0, 2, -1, timestamp, this.chat.threadId).then((history) => {\r\n      if(!history?.messages?.length) {\r\n        this.log.error('no history!');\r\n        return;\r\n      } else if(this.peerId !== peerId) {\r\n        return;\r\n      }\r\n\r\n      this.chat.setMessageId((history.messages[0] as MyMessage).mid);\r\n      // console.log('got history date:', history);\r\n    });\r\n  };\r\n\r\n  public requestHistory(maxId: number, loadCount: number, backLimit: number) {\r\n    // const middleware = this.getMiddleware();\r\n    if(this.chat.type === 'chat' || this.chat.type === 'discussion') {\r\n      return this.managers.acknowledged.appMessagesManager.getHistory(this.peerId, maxId, loadCount, backLimit, this.chat.threadId);\r\n    } else if(this.chat.type === 'pinned') {\r\n      return this.managers.acknowledged.appMessagesManager.getSearch({\r\n        peerId: this.peerId,\r\n        inputFilter: {_: 'inputMessagesFilterPinned'},\r\n        maxId,\r\n        limit: loadCount,\r\n        backLimit\r\n      }).then((ackedResult) => {\r\n        return {\r\n          cached: ackedResult.cached,\r\n          result: Promise.resolve(ackedResult.result).then((value) => {\r\n            return {history: value.history.map((m) => m.mid)};\r\n          })\r\n        };\r\n      });\r\n    } else if(this.chat.type === 'scheduled') {\r\n      return this.managers.acknowledged.appMessagesManager.getScheduledMessages(this.peerId).then((ackedResult) => {\r\n        // this.setLoaded('top', true);\r\n        // this.setLoaded('bottom', true);\r\n        return {\r\n          cached: ackedResult.cached,\r\n          result: Promise.resolve(ackedResult.result).then((mids) => ({history: mids.slice().reverse()}))\r\n        };\r\n      });\r\n    }\r\n  }\r\n\r\n  private async animateAsLadder(additionMsgId: number, additionMsgIds: number[], isAdditionRender: boolean, backLimit: number, maxId: number) {\r\n    /* const middleware = this.getMiddleware();\r\n    await this.ladderDeferred; */\r\n\r\n    const log = this.log.bindPrefix('ladder');\r\n    if(this.chat.setPeerPromise && !this.resolveLadderAnimation) {\r\n      log.warn('will be delayed');\r\n      // @ts-ignore\r\n      this.resolveLadderAnimation = this.animateAsLadder.bind(this, additionMsgId, additionMsgIds, isAdditionRender, backLimit, maxId);\r\n      return;\r\n    }\r\n\r\n    /* if(!middleware()) {\r\n      return;\r\n    } */\r\n\r\n    if(!Object.keys(this.bubbles).length) {\r\n      log.warn('no bubbles');\r\n      return;\r\n    }\r\n\r\n    let sortedMids = getObjectKeysAndSort(this.bubbles, 'desc');\r\n\r\n    if(isAdditionRender && additionMsgIds.length) {\r\n      sortedMids = sortedMids.filter((mid) => !additionMsgIds.includes(mid));\r\n    }\r\n\r\n    let targetMid: number;\r\n    if(backLimit) {\r\n      targetMid = maxId || Math.max(...sortedMids); // * on discussion enter\r\n    } else {\r\n      if(additionMsgId) {\r\n        targetMid = additionMsgId;\r\n      } else { // * if maxId === 0\r\n        targetMid = Math.max(...sortedMids);\r\n      }\r\n    }\r\n\r\n    const topIds = sortedMids.slice(sortedMids.findIndex((mid) => targetMid > mid));\r\n    const middleIds = isAdditionRender ? [] : [targetMid];\r\n    const bottomIds = isAdditionRender ? [] : sortedMids.slice(0, sortedMids.findIndex((mid) => targetMid >= mid)).reverse();\r\n\r\n    if(DEBUG) {\r\n      log('targeting mid:', targetMid, maxId, additionMsgId,\r\n        topIds.map((m) => getServerMessageId(m)),\r\n        bottomIds.map((m) => getServerMessageId(m)));\r\n    }\r\n\r\n    const setBubbles: HTMLElement[] = [];\r\n\r\n    this.chatInner.classList.add('zoom-fading');\r\n    const delay = isAdditionRender ? 10 : 40;\r\n    const offsetIndex = isAdditionRender ? 0 : 1;\r\n    const animateAsLadder = (mids: number[], offsetIndex = 0) => {\r\n      const animationPromise = deferredPromise<void>();\r\n      let lastMsDelay = 0;\r\n      mids.forEach((mid, idx) => {\r\n        const bubble = this.bubbles[mid];\r\n        if(!bubble || this.skippedMids.has(mid)) {\r\n          log.warn('no bubble by mid:', mid);\r\n          return;\r\n        }\r\n\r\n        lastMsDelay = ((idx + offsetIndex) || 0.1) * delay;\r\n        // lastMsDelay = (idx + offsetIndex) * delay;\r\n        // lastMsDelay = (idx || 0.1) * 1000;\r\n\r\n        const contentWrapper = bubble.lastElementChild as HTMLElement;\r\n        const elementsToAnimate: HTMLElement[] = [contentWrapper];\r\n        const item = this.bubbleGroups.getItemByBubble(bubble);\r\n        if(item && item.group.avatar && item.group.lastItem === item) {\r\n          elementsToAnimate.push(item.group.avatar);\r\n        }\r\n\r\n        elementsToAnimate.forEach((element) => {\r\n          element.classList.add('zoom-fade', 'can-zoom-fade');\r\n          element.style.transitionDelay = lastMsDelay + 'ms';\r\n        });\r\n\r\n        if(idx === (mids.length - 1)) {\r\n          const onTransitionEnd = (e: TransitionEvent) => {\r\n            if(e.target !== contentWrapper) {\r\n              return;\r\n            }\r\n\r\n            animationPromise.resolve();\r\n            contentWrapper.removeEventListener('transitionend', onTransitionEnd);\r\n          };\r\n\r\n          contentWrapper.addEventListener('transitionend', onTransitionEnd);\r\n        }\r\n\r\n        setBubbles.push(...elementsToAnimate);\r\n      });\r\n\r\n      if(!mids.length) {\r\n        animationPromise.resolve();\r\n      }\r\n\r\n      return {lastMsDelay, animationPromise};\r\n    };\r\n\r\n    const topRes = animateAsLadder(topIds, offsetIndex);\r\n    const middleRes = animateAsLadder(middleIds);\r\n    const bottomRes = animateAsLadder(bottomIds, offsetIndex);\r\n    const promises = [topRes.animationPromise, middleRes.animationPromise, bottomRes.animationPromise];\r\n    const delays: number[] = [topRes.lastMsDelay, middleRes.lastMsDelay, bottomRes.lastMsDelay];\r\n\r\n    if(this.onAnimateLadder) {\r\n      await this.onAnimateLadder();\r\n    }\r\n\r\n    fastRaf(() => {\r\n      this.setStickyDateManually(); // ! maybe it's not efficient\r\n\r\n      setBubbles.forEach((element) => {\r\n        element.classList.remove('zoom-fade');\r\n      });\r\n    });\r\n\r\n    let promise: Promise<any>;\r\n    if(topIds.length || middleIds.length || bottomIds.length) {\r\n      promise = Promise.all(promises);\r\n\r\n      dispatchHeavyAnimationEvent(promise, Math.max(...delays) + 200) // * 200 - transition time\r\n      .then(() => {\r\n        fastRaf(() => {\r\n          setBubbles.forEach((element) => {\r\n            element.style.transitionDelay = '';\r\n            element.classList.remove('can-zoom-fade');\r\n          });\r\n\r\n          this.chatInner.classList.remove('zoom-fading');\r\n        });\r\n\r\n        // !  , -  - zoom-fade        ,\r\n        // ! ..   ,  ,     translateZ    scrollable\r\n        // if(!IS_SAFARI) {\r\n        //   this.needReflowScroll = true;\r\n        // }\r\n      });\r\n    }\r\n\r\n    return promise;\r\n  }\r\n\r\n  private async renderEmptyPlaceholder(\r\n    type: 'group' | 'saved' | 'noMessages' | 'noScheduledMessages' | 'greeting' | 'restricted',\r\n    bubble: HTMLElement,\r\n    message: any,\r\n    elements: (Node | string)[]\r\n  ) {\r\n    const BASE_CLASS = 'empty-bubble-placeholder';\r\n    bubble.classList.add(BASE_CLASS, BASE_CLASS + '-' + type);\r\n\r\n    let title: HTMLElement;\r\n    if(type === 'group') title = i18n('GroupEmptyTitle1');\r\n    else if(type === 'saved') title = i18n('ChatYourSelfTitle');\r\n    else if(type === 'noMessages' || type === 'greeting') title = i18n('NoMessages');\r\n    else if(type === 'noScheduledMessages') title = i18n('NoScheduledMessages');\r\n    else if(type === 'restricted') {\r\n      title = document.createElement('span');\r\n      title.innerText = await this.managers.appPeersManager.getRestrictionReasonText(this.peerId);\r\n    }\r\n    title.classList.add('center', BASE_CLASS + '-title');\r\n\r\n    elements.push(title);\r\n\r\n    let listElements: HTMLElement[];\r\n    if(type === 'group') {\r\n      elements.push(i18n('GroupEmptyTitle2'));\r\n      listElements = [\r\n        i18n('GroupDescription1'),\r\n        i18n('GroupDescription2'),\r\n        i18n('GroupDescription3'),\r\n        i18n('GroupDescription4')\r\n      ];\r\n    } else if(type === 'saved') {\r\n      listElements = [\r\n        i18n('ChatYourSelfDescription1'),\r\n        i18n('ChatYourSelfDescription2'),\r\n        i18n('ChatYourSelfDescription3'),\r\n        i18n('ChatYourSelfDescription4')\r\n      ];\r\n    } else if(type === 'greeting') {\r\n      const subtitle = i18n('NoMessagesGreetingsDescription');\r\n      subtitle.classList.add('center', BASE_CLASS + '-subtitle');\r\n\r\n      // findAndSplice(this.messagesQueue, q => q.bubble === bubble);\r\n\r\n      const stickerDiv = document.createElement('div');\r\n      stickerDiv.classList.add(BASE_CLASS + '-sticker');\r\n\r\n      const middleware = this.getMiddleware();\r\n\r\n      await this.managers.appStickersManager.getGreetingSticker().then(async(doc) => {\r\n        if(!middleware()) return;\r\n\r\n        const loadPromises: Promise<any>[] = [];\r\n        await wrapSticker({\r\n          doc,\r\n          // doc: appDocsManager.getDoc(\"5431607541660389336\"), // cubigator mockup\r\n          div: stickerDiv,\r\n          middleware,\r\n          lazyLoadQueue: this.lazyLoadQueue,\r\n          group: CHAT_ANIMATION_GROUP,\r\n          // play: !!message.pending || !multipleRender,\r\n          play: true,\r\n          loop: true,\r\n          withThumb: true,\r\n          loadPromises\r\n        });\r\n\r\n        attachClickEvent(stickerDiv, (e) => {\r\n          cancelEvent(e);\r\n          EmoticonsDropdown.onMediaClick({target: e.target});\r\n        });\r\n\r\n        return Promise.all(loadPromises);\r\n      });\r\n\r\n      // this.renderMessagesQueue({\r\n      //   message,\r\n      //   bubble,\r\n      //   reverse: false,\r\n      //   promises: [loadPromise]\r\n      // });\r\n\r\n      elements.push(subtitle, stickerDiv);\r\n    }\r\n\r\n    if(listElements) {\r\n      elements.push(\r\n        ...listElements.map((elem) => {\r\n          const span = document.createElement('span');\r\n          span.classList.add(BASE_CLASS + '-list-item');\r\n          span.append(elem);\r\n          return span;\r\n        })\r\n      );\r\n\r\n      if(type === 'group') {\r\n        listElements.forEach((elem) => {\r\n          const i = document.createElement('span');\r\n          i.classList.add('tgico-check');\r\n          elem.prepend(i);\r\n        });\r\n      } else if(type === 'saved') {\r\n        listElements.forEach((elem) => {\r\n          const i = document.createElement('span');\r\n          i.classList.add(BASE_CLASS + '-list-bullet');\r\n          i.innerText = '';\r\n          elem.prepend(i);\r\n        });\r\n      }\r\n    }\r\n\r\n    if(elements.length > 1) {\r\n      bubble.classList.add('has-description');\r\n    }\r\n\r\n    elements.forEach((element: any) => element.classList.add(BASE_CLASS + '-line'));\r\n  }\r\n\r\n  private async processLocalMessageRender(message: Message.message | Message.messageService, animate?: boolean) {\r\n    const isSponsored = !!(message as Message.message).pFlags.sponsored;\r\n    const middleware = this.getMiddleware();\r\n    const m = middlewarePromise(middleware);\r\n    return this.safeRenderMessage(message, isSponsored ? false : true, undefined, isSponsored, async(result) => {\r\n      const {bubble} = await m(result);\r\n      if(!bubble) {\r\n        return result;\r\n      }\r\n\r\n      bubble.classList.add('is-group-last', 'is-group-first');\r\n\r\n      const updatePosition = () => {\r\n        if(this.updatePlaceholderPosition === updatePosition) {\r\n          this.updatePlaceholderPosition = undefined;\r\n        }\r\n\r\n        appendTo[method](bubble);\r\n      };\r\n\r\n      if(!isSponsored) {\r\n        bubble.classList.add('bubble-first');\r\n        bubble.classList.remove('can-have-tail', 'is-in');\r\n      }\r\n\r\n      const elements: (Node | string)[] = [];\r\n      const isBot = this.chat.isBot;\r\n      let renderPromise: Promise<any>, appendTo = this.container, method: 'append' | 'prepend' = 'append';\r\n      if(this.chat.isRestricted) {\r\n        renderPromise = this.renderEmptyPlaceholder('restricted', bubble, message, elements);\r\n      } else if(isSponsored) {\r\n        let text: LangPackKey, mid: number, startParam: string, callback: () => void;\r\n\r\n        bubble.classList.add('avoid-selection');\r\n\r\n        const sponsoredMessage = this.sponsoredMessage = (message as Message.message).sponsoredMessage;\r\n        const peerId = getPeerId(sponsoredMessage.from_id);\r\n        // const peer = this.appPeersManager.getPeer(peerId);\r\n        if(sponsoredMessage.channel_post) {\r\n          text = 'OpenChannelPost';\r\n          mid = generateMessageId(sponsoredMessage.channel_post);\r\n        } else if(sponsoredMessage.start_param || isBot) {\r\n          text = 'Chat.Message.ViewBot';\r\n          startParam = sponsoredMessage.start_param;\r\n        } else {\r\n          text = await this.managers.appPeersManager.isAnyGroup(peerId) ? 'Chat.Message.ViewGroup' : 'Chat.Message.ViewChannel';\r\n        }\r\n\r\n        if(sponsoredMessage.chat_invite) {\r\n          callback = () => {\r\n            new PopupJoinChatInvite(sponsoredMessage.chat_invite_hash, sponsoredMessage.chat_invite as ChatInvite.chatInvite);\r\n          };\r\n        } else if(sponsoredMessage.chat_invite_hash) {\r\n          callback = () => {\r\n            const link: InternalLink = {\r\n              _: INTERNAL_LINK_TYPE.JOIN_CHAT,\r\n              invite: sponsoredMessage.chat_invite_hash\r\n            };\r\n\r\n            this.chat.appImManager.processInternalLink(link);\r\n          };\r\n        } else {\r\n          callback = () => {\r\n            this.chat.appImManager.setInnerPeer({\r\n              peerId,\r\n              lastMsgId: mid,\r\n              startParam\r\n            });\r\n          };\r\n        }\r\n\r\n        const button = Button('btn-primary btn-primary-transparent bubble-view-button', {\r\n          text\r\n        });\r\n\r\n        this.observer.observe(button, this.viewsObserverCallback);\r\n\r\n        if(callback) {\r\n          attachClickEvent(button, callback);\r\n        }\r\n\r\n        bubble.querySelector('.bubble-content').prepend(button);\r\n\r\n        return result;\r\n      } else if(isBot && message._ === 'message') {\r\n        const b = document.createElement('b');\r\n        b.append(i18n('BotInfoTitle'));\r\n        elements.push(b, '\\n\\n');\r\n        appendTo = this.chatInner;\r\n        method = 'prepend';\r\n      } else if(await m(this.managers.appPeersManager.isAnyGroup(this.peerId)) && (await m(this.managers.appPeersManager.getPeer(this.peerId))).pFlags.creator) {\r\n        renderPromise = this.renderEmptyPlaceholder('group', bubble, message, elements);\r\n      } else if(this.chat.type === 'scheduled') {\r\n        renderPromise = this.renderEmptyPlaceholder('noScheduledMessages', bubble, message, elements);\r\n      } else if(rootScope.myId === this.peerId) {\r\n        renderPromise = this.renderEmptyPlaceholder('saved', bubble, message, elements);\r\n      } else if(this.peerId.isUser() && !isBot && await m(this.chat.canSend()) && this.chat.type === 'chat') {\r\n        renderPromise = this.renderEmptyPlaceholder('greeting', bubble, message, elements);\r\n      } else {\r\n        renderPromise = this.renderEmptyPlaceholder('noMessages', bubble, message, elements);\r\n      }\r\n\r\n      if(renderPromise) {\r\n        await renderPromise;\r\n      }\r\n\r\n      if(elements.length) {\r\n        const messageDiv = bubble.querySelector('.message, .service-msg');\r\n        messageDiv.prepend(...elements);\r\n      }\r\n\r\n      const isWaitingForAnimation = !!this.messagesQueueOnRenderAdditional;\r\n      const noTransition = this.setPeerCached && !isWaitingForAnimation;\r\n      if(noTransition) {\r\n        const setOn = bubble.firstElementChild;\r\n        setOn.classList.add('no-transition');\r\n\r\n        if(this.chat.setPeerPromise) {\r\n          this.chat.setPeerPromise.catch(noop).finally(() => {\r\n            setOn.classList.remove('no-transition');\r\n          });\r\n        }\r\n      }\r\n\r\n      if(animate === undefined && !noTransition) {\r\n        animate = true;\r\n      }\r\n\r\n      if(isWaitingForAnimation || animate) {\r\n        this.updatePlaceholderPosition = updatePosition;\r\n\r\n        this.onAnimateLadder = () => {\r\n          // appendTo[method](bubble);\r\n          this.onAnimateLadder = undefined;\r\n\r\n          // need raf here because animation won't fire if this message is single\r\n          if(!this.messagesQueuePromise) {\r\n            return fastRafPromise();\r\n          }\r\n        };\r\n      } else if(this.chat.setPeerPromise) {\r\n        this.attachPlaceholderOnRender = () => {\r\n          this.attachPlaceholderOnRender = undefined;\r\n          updatePosition();\r\n          // appendTo[method](bubble);\r\n        };\r\n      } else {\r\n        this.updatePlaceholderPosition = updatePosition;\r\n        // appendTo[method](bubble);\r\n      }\r\n\r\n      if(!isWaitingForAnimation && animate) {\r\n        await m(getHeavyAnimationPromise());\r\n        const additionMsgIds = getObjectKeysAndSort(this.bubbles);\r\n        indexOfAndSplice(additionMsgIds, message.mid);\r\n        this.animateAsLadder(message.mid, additionMsgIds, false, 0, 0);\r\n      }\r\n\r\n      // if(!isSponsored) {\r\n      this.emptyPlaceholderBubble = bubble;\r\n      // }\r\n\r\n      return result;\r\n    });\r\n  }\r\n\r\n  private generateLocalMessageId(addOffset = 0) {\r\n    // const INCREMENT = 0x10;\r\n    const offset = (this.chat.type === 'scheduled' ? -1 : 0) + addOffset;\r\n    // offset = generateMessageId(offset);\r\n    // id: -Math.abs(+this.peerId * INCREMENT + offset),\r\n    const id = -Math.abs(offset);\r\n    const mid = -Math.abs(generateMessageId(id));\r\n    return {id, mid};\r\n  }\r\n\r\n  private async generateLocalFirstMessage<T extends boolean>(service?: T, fill?: (message: GenerateLocalMessageType<T>) => void, addOffset = 0): Promise<GenerateLocalMessageType<T>> {\r\n    const {id, mid} = this.generateLocalMessageId(addOffset);\r\n    let message: Omit<Message.message | Message.messageService, 'message'> & {message?: string} = {\r\n      _: service ? 'messageService' : 'message',\r\n      date: 0,\r\n      id,\r\n      mid,\r\n      peer_id: await this.managers.appPeersManager.getOutputPeer(this.peerId),\r\n      pFlags: {\r\n        local: true\r\n      }\r\n    };\r\n\r\n    if(!service) {\r\n      message.message = '';\r\n    }/*  else {\r\n      (message as Message.messageService).action = {} as any;\r\n    } */\r\n\r\n    assumeType<GenerateLocalMessageType<T>>(message);\r\n\r\n    fill && fill(message);\r\n\r\n    const savedMessages = await this.managers.appMessagesManager.saveMessages([message], {storage: new Map() as any});\r\n    message = savedMessages[0];\r\n    message.mid = mid;\r\n    return message as any;\r\n  }\r\n\r\n  public getViewportSlice() {\r\n    // this.log.trace('viewport slice');\r\n    return getViewportSlice({\r\n      overflowElement: this.scrollable.container,\r\n      selector: '.bubbles-date-group .bubble:not(.is-date)',\r\n      extraSize: Math.max(700, windowSize.height) * 2\r\n    });\r\n  }\r\n\r\n  public deleteViewportSlice(slice: ReturnType<ChatBubbles['getViewportSlice']>, ignoreScrollSaving?: boolean) {\r\n    if(DO_NOT_SLICE_VIEWPORT_ON_RENDER) {\r\n      return;\r\n    }\r\n\r\n    const {invisibleTop, invisibleBottom} = slice;\r\n    const invisible = invisibleTop.concat(invisibleBottom);\r\n    if(!invisible.length) {\r\n      return;\r\n    }\r\n\r\n    if(invisibleTop.length) {\r\n      this.setLoaded('top', false);\r\n      this.getHistoryTopPromise = undefined;\r\n    }\r\n\r\n    if(invisibleBottom.length) {\r\n      this.setLoaded('bottom', false);\r\n      this.getHistoryBottomPromise = undefined;\r\n    }\r\n\r\n    const mids = invisible.map(({element}) => +element.dataset.mid);\r\n\r\n    let scrollSaver: ScrollSaver;\r\n    if(/* !!invisibleTop.length !== !!invisibleBottom.length &&  */!ignoreScrollSaving) {\r\n      scrollSaver = this.createScrollSaver(!!invisibleTop.length);\r\n      scrollSaver.save();\r\n    }\r\n\r\n    this.deleteMessagesByIds(mids, false, true);\r\n\r\n    if(scrollSaver) {\r\n      scrollSaver.restore();\r\n    } else if(invisibleTop.length) {\r\n      this.scrollable.lastScrollPosition = this.scrollable.scrollTop;\r\n    }\r\n  }\r\n\r\n  public sliceViewport(ignoreHeavyAnimation?: boolean) {\r\n    // Safari cannot reset the scroll.\r\n    if(IS_SAFARI || (this.isHeavyAnimationInProgress && !ignoreHeavyAnimation) || DO_NOT_SLICE_VIEWPORT) {\r\n      return;\r\n    }\r\n\r\n    // const scrollSaver = new ScrollSaver(this.scrollable, true);\r\n    // scrollSaver.save();\r\n    const slice = this.getViewportSlice();\r\n    // if(IS_SAFARI) slice.invisibleTop = [];\r\n    this.deleteViewportSlice(slice);\r\n    // scrollSaver.restore();\r\n  }\r\n\r\n  private async setLoaded(side: SliceSides, value: boolean, checkPlaceholders = true) {\r\n    const willChange = this.scrollable.loadedAll[side] !== value;\r\n    if(!willChange) {\r\n      return;\r\n    }\r\n\r\n    const log = this.log.bindPrefix('setLoaded');\r\n    log('change', side, value);\r\n\r\n    this.scrollable.loadedAll[side] = value;\r\n    this.scrollable.onScroll(); // ! WARNING\r\n    // return;\r\n\r\n    if(!checkPlaceholders) {\r\n      return;\r\n    }\r\n\r\n    if(!this.chat.isRestricted) {\r\n      if(side === 'bottom' && this.chat.isBroadcast/*  && false */) {\r\n        this.toggleSponsoredMessage(value);\r\n      }\r\n\r\n      if(side === 'top' && value && this.chat.isBot) {\r\n        return this.renderBotPlaceholder();\r\n      }\r\n    }\r\n\r\n    return this.checkIfEmptyPlaceholderNeeded();\r\n  }\r\n\r\n  private async toggleSponsoredMessage(value: boolean) {\r\n    const _log = this.log.bindPrefix('sponsored');\r\n    _log('checking');\r\n    const {mid} = this.generateLocalMessageId(SPONSORED_MESSAGE_ID_OFFSET);\r\n    if(value) {\r\n      const middleware = this.getMiddleware(() => {\r\n        return this.scrollable.loadedAll.bottom && !this.bubbles[mid] && this.getSponsoredMessagePromise === promise;\r\n      });\r\n\r\n      const promise = this.getSponsoredMessagePromise = this.managers.appChatsManager.getSponsoredMessage(this.peerId.toChatId())\r\n      .then(async(sponsoredMessages) => {\r\n        const sponsoredMessage = sponsoredMessages.messages[0];\r\n        if(!sponsoredMessage) {\r\n          _log('no message');\r\n          return;\r\n        }\r\n\r\n        const messagePromise = this.generateLocalFirstMessage(false, (message) => {\r\n          message.message = sponsoredMessage.message;\r\n          message.from_id = sponsoredMessage.from_id;\r\n          message.entities = sponsoredMessage.entities;\r\n          message.pFlags.sponsored = true;\r\n          message.sponsoredMessage = sponsoredMessage;\r\n        }, SPONSORED_MESSAGE_ID_OFFSET);\r\n\r\n        return Promise.all([\r\n          messagePromise,\r\n          this.getHistoryTopPromise, // wait for top load and execute rendering after or with it\r\n          this.messagesQueuePromise\r\n        ]).then(([message]) => {\r\n          if(!middleware()) return;\r\n          // this.processLocalMessageRender(message);\r\n          _log('rendering', message);\r\n          const promise = this.performHistoryResult({history: [message]}, false);\r\n        });\r\n      }).finally(() => {\r\n        this.getSponsoredMessagePromise = undefined;\r\n      });\r\n    } else {\r\n      _log('clearing rendered', mid);\r\n      this.deleteMessagesByIds([mid]);\r\n      this.getSponsoredMessagePromise = undefined;\r\n    }\r\n  }\r\n\r\n  private async renderBotPlaceholder() {\r\n    const _log = this.log.bindPrefix('bot placeholder');\r\n\r\n    const middleware = this.getMiddleware();\r\n    const result = await this.managers.acknowledged.appProfileManager.getProfile(this.peerId.toUserId());\r\n    _log('getting profile, cached:', result.cached);\r\n    const processPromise = result.result.then(async(userFull) => {\r\n      if(!middleware()) {\r\n        return;\r\n      }\r\n\r\n      if(!userFull.bot_info?.description) {\r\n        _log.warn('no description');\r\n        return this.checkIfEmptyPlaceholderNeeded();\r\n      }\r\n\r\n      const message = await this.generateLocalFirstMessage(false, (message) => {\r\n        const botInfo = userFull.bot_info;\r\n        message.message = botInfo.description;\r\n        if(botInfo.description_document) message.media = {_: 'messageMediaDocument', document: botInfo.description_document};\r\n        if(botInfo.description_photo) message.media = {_: 'messageMediaPhoto', photo: botInfo.description_photo};\r\n      });\r\n\r\n      if(!middleware()) {\r\n        return;\r\n      }\r\n\r\n      _log('rendering');\r\n      const renderPromise = this.processLocalMessageRender(message, !result.cached).then(() => {\r\n        _log('done');\r\n      });\r\n\r\n      return {renderPromise};\r\n    });\r\n\r\n    if(!result.cached) {\r\n      return;\r\n    }\r\n\r\n    return processPromise;\r\n  }\r\n\r\n  public async checkIfEmptyPlaceholderNeeded() {\r\n    if(this.scrollable.loadedAll.top &&\r\n      this.scrollable.loadedAll.bottom &&\r\n      this.emptyPlaceholderBubble === undefined &&\r\n      (\r\n        this.chat.isRestricted ||\r\n        !(await this.chat.getHistoryStorage()).count ||\r\n        (\r\n          !Object.keys(this.bubbles).length ||\r\n          // ! WARNING ! ! ! ! ! ! REPLACE LINE ABOVE WITH THESE\r\n          Object.keys(this.bubbles).length &&\r\n          !this.getRenderedLength()\r\n        ) ||\r\n        (this.chat.type === 'scheduled' && !Object.keys(this.bubbles).length)\r\n      )\r\n    ) {\r\n      this.log('inject empty peer placeholder');\r\n\r\n      const message = await this.generateLocalFirstMessage(true);\r\n      return {renderPromise: this.processLocalMessageRender(message)};\r\n    }\r\n  }\r\n\r\n  public getHistory1(maxId?: number, reverse?: boolean, isBackLimit?: boolean, additionMsgId?: number, justLoad?: boolean) {\r\n    const middleware = this.getMiddleware(justLoad ? undefined : () => {\r\n      return (reverse ? this.getHistoryTopPromise : this.getHistoryBottomPromise) === waitPromise;\r\n    });\r\n\r\n    const result = this.getHistory(maxId, reverse, isBackLimit, additionMsgId, justLoad, middleware);\r\n    const waitPromise = result.then((res) => res && (res.waitPromise || res.promise));\r\n\r\n    (reverse ? this.getHistoryTopPromise = waitPromise : this.getHistoryBottomPromise = waitPromise);\r\n    waitPromise.then(() => {\r\n      if(!middleware()) {\r\n        return;\r\n      }\r\n\r\n      (reverse ? this.getHistoryTopPromise = undefined : this.getHistoryBottomPromise = undefined);\r\n\r\n      if(!justLoad) {\r\n        // preload more\r\n        // if(!isFirstMessageRender) {\r\n        if(this.chat.type === 'chat'/*  || this.chat.type === 'discussion' */) {\r\n          /* const storage = this.appMessagesManager.getHistoryStorage(peerId, this.chat.threadId);\r\n            const isMaxIdInHistory = storage.history.indexOf(maxId) !== -1;\r\n            if(isMaxIdInHistory || true) { // * otherwise it is a search or jump */\r\n          setTimeout(() => {\r\n            if(reverse) {\r\n              this.loadMoreHistory(true, true);\r\n            } else {\r\n              this.loadMoreHistory(false, true);\r\n            }\r\n          }, 0);\r\n          // }\r\n        }\r\n        // }\r\n\r\n        // this.scrollable.onScroll();\r\n      }\r\n    });\r\n\r\n    return result;\r\n  }\r\n\r\n  /**\r\n   * Load and render history\r\n   * @param maxId max message id\r\n   * @param reverse 'true' means up\r\n   * @param isBackLimit is search\r\n   * @param additionMsgId for the last message\r\n   * @param justLoad do not render\r\n   */\r\n  public async getHistory(\r\n    maxId = 0,\r\n    reverse = false,\r\n    isBackLimit = false,\r\n    additionMsgId = 0,\r\n    justLoad = false,\r\n    middleware?: () => boolean\r\n  ): Promise<{cached: boolean, promise: Promise<void>, waitPromise: Promise<any>}> {\r\n    const peerId = this.peerId;\r\n\r\n    const isBroadcast = this.chat.isBroadcast;\r\n    // console.time('appImManager call getHistory');\r\n    const pageCount = Math.min(30, windowSize.height / 40/*  * 1.25 */ | 0);\r\n    // const loadCount = Object.keys(this.bubbles).length > 0 ? 50 : pageCount;\r\n    const realLoadCount = isBroadcast ? 20 : (Object.keys(this.bubbles).length > 0 ? Math.max(35, pageCount) : pageCount);\r\n    // const realLoadCount = pageCount;//const realLoadCount = 50;\r\n    let loadCount = realLoadCount;\r\n\r\n    /* if(TEST_SCROLL) {\r\n      //loadCount = 1;\r\n      if(Object.keys(this.bubbles).length > 0)\r\n      return {cached: false, promise: Promise.resolve(true)};\r\n    } */\r\n    if(TEST_SCROLL !== undefined) {\r\n      if(TEST_SCROLL) {\r\n        if(Object.keys(this.bubbles).length > 0) {\r\n          --TEST_SCROLL;\r\n        }\r\n      } else {\r\n        return {cached: false, promise: Promise.resolve(), waitPromise: Promise.resolve()};\r\n      }\r\n    }\r\n\r\n    // //console.time('render history total');\r\n\r\n    let backLimit = 0;\r\n    if(isBackLimit) {\r\n      backLimit = loadCount;\r\n\r\n      if(!reverse) { // if not jump\r\n        loadCount = 0;\r\n        // maxId = this.appMessagesManager.incrementMessageId(maxId, 1);\r\n      }\r\n    }\r\n\r\n    let additionMsgIds: number[];\r\n    if(additionMsgId && !isBackLimit) {\r\n      if(this.chat.type === 'pinned') {\r\n        additionMsgIds = [additionMsgId];\r\n      } else {\r\n        const historyStorage = await this.chat.getHistoryStorage();\r\n        const slice = historyStorage.history.slice;\r\n        if(slice.length < loadCount && !slice.isEnd(SliceEnd.Both)) {\r\n          additionMsgIds = slice.slice();\r\n\r\n          // * filter last album, because we don't know is it the last item\r\n          for(let i = additionMsgIds.length - 1; i >= 0; --i) {\r\n            const message = await this.chat.getMessage(additionMsgIds[i]);\r\n            if((message as Message.message)?.grouped_id) additionMsgIds.splice(i, 1);\r\n            else break;\r\n          }\r\n\r\n          maxId = additionMsgIds[additionMsgIds.length - 1] || maxId;\r\n        }\r\n      }\r\n    }\r\n\r\n    /* const result = additionMsgID ?\r\n      {history: [additionMsgID]} :\r\n      appMessagesManager.getHistory(this.peerId, maxId, loadCount, backLimit); */\r\n    let result: AckedResult<MyHistoryResult> = await this.requestHistory(maxId, loadCount, backLimit) as any;\r\n    let resultPromise: typeof result['result'];\r\n\r\n    // const isFirstMessageRender = !!additionMsgID && result.cached && !appMessagesManager.getMessage(additionMsgID).grouped_id;\r\n    const isAdditionRender = additionMsgIds?.length && !result.cached;\r\n    const isFirstMessageRender = (this.isFirstLoad && backLimit && !result.cached) || isAdditionRender;\r\n    if(isAdditionRender) {\r\n      resultPromise = result.result;\r\n\r\n      result = {\r\n        cached: true,\r\n        result: Promise.resolve({history: additionMsgIds})\r\n      };\r\n\r\n      // additionMsgID = 0;\r\n    }\r\n\r\n    this.isFirstLoad = false;\r\n\r\n    const processResult = async(historyResult: Awaited<typeof result['result']>) => {\r\n      if((historyResult as HistoryResult).isEnd?.top) {\r\n        if(this.chat.type === 'discussion') { // * inject discussion start\r\n          const serviceStartMessageId = await this.managers.appMessagesManager.getThreadServiceMessageId(this.peerId, this.chat.threadId);\r\n          if(serviceStartMessageId) historyResult.history.push(serviceStartMessageId);\r\n          const mids = await this.chat.getMidsByMid(this.chat.threadId);\r\n          historyResult.history.push(...mids.reverse());\r\n        }\r\n\r\n        // synchronize bot placeholder appearance\r\n        await this.managers.appProfileManager.getProfileByPeerId(peerId);\r\n\r\n        // await this.setLoaded('top', true);\r\n      }\r\n    };\r\n\r\n    const sup = (historyResult: Awaited<typeof result['result']>) => {\r\n      return getHeavyAnimationPromise().then(() => {\r\n        return processResult(historyResult);\r\n      }).then(() => {\r\n        if(!isAdditionRender && additionMsgId) {\r\n          historyResult.history.unshift(additionMsgId);\r\n        }\r\n\r\n        return this.performHistoryResult(historyResult, reverse);\r\n      });\r\n    };\r\n\r\n    const processPromise = (_promise: typeof result['result']) => {\r\n      const promise = Promise.resolve(_promise).then((result) => {\r\n        if(middleware && !middleware()) {\r\n          throw PEER_CHANGED_ERROR;\r\n        }\r\n\r\n        if(justLoad) {\r\n          //   -  \r\n          this.scrollable.onScroll();\r\n          // fastRaf(() => {\r\n          //   this.scrollable.checkForTriggers();\r\n          // });\r\n          return;\r\n        }\r\n\r\n        return sup(result);\r\n      }, (err) => {\r\n        this.log.error('getHistory error:', err);\r\n        throw err;\r\n      });\r\n\r\n      return promise;\r\n    };\r\n\r\n    let promise: Promise<void>, cached: boolean;\r\n    if(!result.cached) {\r\n      cached = false;\r\n      promise = processPromise(result.result);\r\n    } else if(justLoad) {\r\n      //   -  \r\n      this.scrollable.onScroll();\r\n      return null;\r\n    } else {\r\n      cached = true;\r\n      promise = sup(await result.result);\r\n    }\r\n\r\n    const waitPromise = isAdditionRender ? processPromise(resultPromise) : promise;\r\n\r\n    if(isFirstMessageRender && rootScope.settings.animationsEnabled/*  && false */) {\r\n      let times = isAdditionRender ? 2 : 1;\r\n      this.messagesQueueOnRenderAdditional = () => {\r\n        this.log('messagesQueueOnRenderAdditional');\r\n\r\n        if(--times) return;\r\n\r\n        this.messagesQueueOnRenderAdditional = undefined;\r\n\r\n        const promise = this.animateAsLadder(additionMsgId, additionMsgIds, isAdditionRender, backLimit, maxId);\r\n        promise.then(() => {\r\n          setTimeout(() => { // preload messages\r\n            this.loadMoreHistory(reverse, true);\r\n          }, 0);\r\n        });\r\n      };\r\n    } else {\r\n      this.messagesQueueOnRenderAdditional = undefined;\r\n    }\r\n\r\n    if(justLoad) {\r\n      return null;\r\n    }\r\n\r\n    return {cached, promise, waitPromise};\r\n  }\r\n\r\n  public async setUnreadDelimiter() {\r\n    if(!(this.chat.type === 'chat' || this.chat.type === 'discussion')) {\r\n      return;\r\n    }\r\n\r\n    if(this.attachedUnreadBubble) {\r\n      return;\r\n    }\r\n\r\n    const historyMaxId = await this.chat.getHistoryMaxId();\r\n    let readMaxId = await this.managers.appMessagesManager.getReadMaxIdIfUnread(this.peerId, this.chat.threadId);\r\n    if(!readMaxId) return;\r\n\r\n    readMaxId = Object.keys(this.bubbles)\r\n    .filter((mid) => !this.bubbles[mid].classList.contains('is-out'))\r\n    .map((i) => +i)\r\n    .sort((a, b) => a - b)\r\n    .find((i) => i > readMaxId);\r\n\r\n    if(readMaxId && this.bubbles[readMaxId]) {\r\n      const bubble = this.bubbles[readMaxId];\r\n      if(this.firstUnreadBubble && this.firstUnreadBubble !== bubble) {\r\n        this.firstUnreadBubble.classList.remove('is-first-unread');\r\n        this.firstUnreadBubble = null;\r\n      }\r\n\r\n      if(readMaxId !== historyMaxId) {\r\n        bubble.classList.add('is-first-unread');\r\n      }\r\n\r\n      this.firstUnreadBubble = bubble;\r\n      this.attachedUnreadBubble = true;\r\n    }\r\n  }\r\n\r\n  public deleteEmptyDateGroups() {\r\n    const mustBeCount = this.stickyIntersector ? STICKY_OFFSET : 1;\r\n    let deleted = false;\r\n    for(const i in this.dateMessages) {\r\n      const dateMessage = this.dateMessages[i];\r\n\r\n      if(dateMessage.container.childElementCount === mustBeCount) { // only date div + sentinel div\r\n        dateMessage.container.remove();\r\n        if(this.stickyIntersector) {\r\n          this.stickyIntersector.unobserve(dateMessage.container, dateMessage.div);\r\n        }\r\n        delete this.dateMessages[i];\r\n        deleted = true;\r\n\r\n        // * no sense in it\r\n        /* if(dateMessage.div === this.previousStickyDate) {\r\n          this.previousStickyDate = undefined;\r\n        } */\r\n      }\r\n    }\r\n\r\n    if(!deleted) {\r\n      return;\r\n    }\r\n\r\n    if(!Object.keys(this.dateMessages).length) {\r\n      this.container.classList.remove('has-groups');\r\n    }\r\n\r\n    this.checkIfEmptyPlaceholderNeeded();\r\n    this.setStickyDateManually();\r\n  }\r\n}\r\n\r\nexport function generateTail() {\r\n  const svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');\r\n  svg.setAttributeNS(null, 'viewBox', '0 0 11 20');\r\n  svg.setAttributeNS(null, 'width', '11');\r\n  svg.setAttributeNS(null, 'height', '20');\r\n  svg.classList.add('bubble-tail');\r\n\r\n  const use = document.createElementNS('http://www.w3.org/2000/svg', 'use');\r\n  use.setAttributeNS(null, 'href', '#message-tail-filled');\r\n\r\n  svg.append(use);\r\n\r\n  return svg;\r\n}\r\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport {copyTextToClipboard} from '../clipboard';\n// import SelectionSaver from \"../selectionSaver\";\n// import selectElementContents from \"./selectElementContents\";\n\nexport default function copyFromElement(element: HTMLElement) {\n  copyTextToClipboard(element.textContent);\n  // const saver = new SelectionSaver();\n  // saver.save();\n  // selectElementContents(element);\n  // document.execCommand('copy');\n  // saver.restore();\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport PopupElement, {addCancelButton} from '.';\nimport PopupPeer, {PopupPeerButtonCallbackCheckboxes, PopupPeerOptions} from './peer';\nimport rootScope from '../../lib/rootScope';\nimport {FormatterArguments, LangPackKey} from '../../lib/langPack';\nimport PeerTitle from '../peerTitle';\n\nexport default class PopupPinMessage {\n  constructor(private peerId: PeerId, private mid: number, private unpin?: true, private onConfirm?: () => void) {\n    this.construct();\n  }\n\n  private async construct() {\n    const {peerId, mid, unpin, onConfirm} = this;\n    let title: LangPackKey, description: LangPackKey, descriptionArgs: FormatterArguments;\n    const buttons: PopupPeerOptions['buttons'] = [], checkboxes: PopupPeerOptions['checkboxes'] = [];\n\n    const managers = PopupElement.MANAGERS;\n\n    const canUnpin = await managers.appPeersManager.canPinMessage(peerId);\n\n    const callback = (checked: PopupPeerButtonCallbackCheckboxes, oneSide?: boolean, silent?: boolean) => {\n      setTimeout(() => { // * ,   document.elementFromPoint  popup-peer    \n        let promise: Promise<any>;\n        if(unpin && !mid) {\n          if(canUnpin) {\n            promise = managers.appMessagesManager.unpinAllMessages(peerId);\n          } else {\n            promise = managers.appMessagesManager.hidePinnedMessages(peerId);\n          }\n        } else {\n          promise = managers.appMessagesManager.updatePinnedMessage(peerId, mid, unpin, silent, oneSide);\n        }\n\n        if(onConfirm) {\n          promise.then(onConfirm);\n        }\n      }, 300);\n    };\n\n    if(unpin) {\n      let buttonText: LangPackKey = 'UnpinMessage';\n      if(!mid) {\n        if(canUnpin) {\n          title = 'Popup.Unpin.AllTitle';\n          description = 'Chat.UnpinAllMessagesConfirmation';\n          descriptionArgs = ['' + ((await managers.appMessagesManager.getPinnedMessagesCount(peerId)) || 1)];\n        } else {\n          title = 'Popup.Unpin.HideTitle';\n          description = 'Popup.Unpin.HideDescription';\n          buttonText = 'Popup.Unpin.Hide';\n        }\n      } else {\n        title = 'UnpinMessageAlertTitle';\n        description = 'Chat.Confirm.Unpin';\n      }\n\n      buttons.push({\n        langKey: buttonText,\n        isDanger: true,\n        callback\n      });\n    } else {\n      title = 'PinMessageAlertTitle';\n      const pinButtonText: LangPackKey = 'PinMessage';\n\n      if(peerId.isAnyChat()) {\n        buttons.push({\n          langKey: pinButtonText,\n          callback: (checked) => callback(checked, false, !checked.size)\n        });\n\n        if(await managers.appChatsManager.isBroadcast(peerId.toChatId())) {\n          description = 'PinMessageAlertChannel';\n        } else {\n          description = 'PinMessageAlert';\n\n          checkboxes.push({\n            text: 'PinNotify',\n            checked: true\n          });\n        }\n      } else {\n        description = 'PinMessageAlertChat';\n\n        if(peerId === rootScope.myId) {\n          buttons.push({\n            langKey: pinButtonText,\n            callback\n          });\n        } else {\n          buttons.push({\n            langKey: pinButtonText,\n            callback: (checked) => callback(checked, !checked.size)\n          });\n\n          checkboxes.push({\n            text: 'PinAlsoFor',\n            textArgs: [new PeerTitle({peerId}).element],\n            checked: true\n          });\n        }\n      }\n    }\n\n    addCancelButton(buttons);\n\n    const popup = new PopupPeer('popup-delete-chat', {\n      peerId,\n      titleLangKey: title,\n      descriptionLangKey: description,\n      descriptionLangArgs: descriptionArgs,\n      buttons,\n      checkboxes\n    });\n\n    popup.show();\n  }\n}\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nexport default function isSelectionEmpty(selection = window.getSelection()) {\r\n  if(!selection || !selection.rangeCount) {\r\n    return true;\r\n  }\r\n\r\n  const selectionRange = selection.getRangeAt(0);\r\n  if(!selectionRange.toString() || !selectionRange.START_TO_END) {\r\n    return true;\r\n  }\r\n\r\n  return false;\r\n}\r\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport appDownloadManager from '../lib/appManagers/appDownloadManager';\nimport lottieLoader from '../lib/rlottie/lottieLoader';\nimport rootScope from '../lib/rootScope';\nimport {getEmojiToneIndex} from '../vendor/emoji';\nimport mediaSizes from './mediaSizes';\nimport {saveLottiePreview} from './saveLottiePreview';\n\nexport default function preloadAnimatedEmojiSticker(emoji: string, width?: number, height?: number) {\n  return rootScope.managers.appStickersManager.preloadAnimatedEmojiSticker(emoji).then(({doc}) => {\n    if(!doc) {\n      return;\n    }\n\n    return appDownloadManager.downloadMedia({media: doc})\n    .then(async(blob) => {\n      const mediaSize = mediaSizes.active.emojiSticker;\n      const toneIndex = getEmojiToneIndex(emoji);\n      const animation = await lottieLoader.loadAnimationWorker({\n        container: undefined,\n        animationData: blob,\n        width: width ?? mediaSize.width,\n        height: height ?? mediaSize.height,\n        name: 'doc' + doc.id,\n        autoplay: false,\n        loop: false,\n        toneIndex\n      }, 'none');\n\n      animation.addEventListener('firstFrame', () => {\n        saveLottiePreview(doc, animation.canvas[0], toneIndex);\n        animation.remove();\n      }, {once: true});\n    });\n  });\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport {ReportReason} from '../../layer';\nimport InputField from '../inputField';\nimport {toastNew} from '../toast';\nimport wrapStickerEmoji from '../wrappers/stickerEmoji';\nimport PopupPeer from './peer';\n\nexport default class PopupReportMessagesConfirm extends PopupPeer {\n  public static STICKER_EMOJI = '';\n  constructor(peerId: PeerId, mids: number[], reason: ReportReason['_'], onConfirm?: () => void) {\n    super('popup-report-messages-confirm', {\n      noTitle: true,\n      descriptionLangKey: 'ReportInfo',\n      buttons: [{\n        langKey: 'ReportChat',\n        callback: () => {\n          if(!inputField.isValid()) {\n            return;\n          }\n\n          onConfirm && onConfirm();\n          this.managers.appMessagesManager.reportMessages(peerId, mids, reason, inputField.value).then((bool) => {\n            if(!bool) return;\n\n            toastNew({\n              langPackKey: 'ReportSentInfo'\n            });\n          });\n        }\n      }],\n      body: true\n    });\n\n    const div = document.createElement('div');\n    const size = 100;\n    wrapStickerEmoji({\n      div,\n      emoji: PopupReportMessagesConfirm.STICKER_EMOJI,\n      width: size,\n      height: size\n    }).then(({render}) => render).finally(() => {\n      this.show();\n    });\n\n    this.header.append(div);\n\n    const inputField = new InputField({\n      label: 'ReportHint',\n      maxLength: 512,\n      placeholder: 'ReportChatDescription'\n    });\n\n    inputField.input.addEventListener('input', () => {\n      this.buttons[0].element.toggleAttribute('disabled', !inputField.isValid());\n    });\n\n    this.body.append(inputField.container);\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport {attachClickEvent} from '../../helpers/dom/clickEvent';\nimport findUpClassName from '../../helpers/dom/findUpClassName';\nimport whichChild from '../../helpers/dom/whichChild';\nimport preloadAnimatedEmojiSticker from '../../helpers/preloadAnimatedEmojiSticker';\nimport {ReportReason} from '../../layer';\nimport {LangPackKey} from '../../lib/langPack';\nimport Button from '../button';\nimport PopupPeer from './peer';\nimport PopupReportMessagesConfirm from './reportMessagesConfirm';\n\nexport default class PopupReportMessages extends PopupPeer {\n  constructor(peerId: PeerId, mids: number[], onConfirm?: () => void) {\n    super('popup-report-messages', {titleLangKey: 'ChatTitle.ReportMessages', buttons: [], body: true});\n\n    mids = mids.slice();\n\n    const buttons: [LangPackKey, ReportReason['_']][] = [\n      ['ReportChatSpam', 'inputReportReasonSpam'],\n      ['ReportChatViolence', 'inputReportReasonViolence'],\n      ['ReportChatChild', 'inputReportReasonChildAbuse'],\n      ['ReportChatPornography', 'inputReportReasonPornography'],\n      ['ReportChatOther', 'inputReportReasonOther'],\n      ['ReportChatPersonalDetails', 'inputReportReasonPersonalDetails'],\n      ['ReportChatIllegalDrugs', 'inputReportReasonIllegalDrugs']\n    ];\n\n    const className = 'btn-primary btn-transparent';\n    buttons.forEach((b) => {\n      const button = Button(className, {/* icon: 'edit',  */text: b[0]});\n      this.body.append(button);\n    });\n\n    const preloadStickerPromise = preloadAnimatedEmojiSticker(PopupReportMessagesConfirm.STICKER_EMOJI);\n\n    attachClickEvent(this.body, (e) => {\n      const target = findUpClassName(e.target, 'btn-primary');\n      const reason = buttons[whichChild(target)][1];\n\n      preloadStickerPromise.then(() => {\n        this.hide();\n\n        new PopupReportMessagesConfirm(peerId, mids, reason, onConfirm);\n      });\n    }, {listenerSetter: this.listenerSetter});\n\n    this.body.style.margin = '0 -1rem';\n    this.buttonsEl.style.marginTop = '.5rem';\n\n    this.show();\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport I18n, {i18n} from '../../lib/langPack';\nimport PopupPeer from './peer';\n\nexport default class PopupSponsored extends PopupPeer {\n  constructor() {\n    super('popup-sponsored', {\n      titleLangKey: 'Chat.Message.Sponsored.What',\n      descriptionLangKey: 'Chat.Message.Ad.Text',\n      descriptionLangArgs: [i18n('Chat.Message.Sponsored.Link')],\n      buttons: [{\n        langKey: 'OK',\n        isCancel: true\n      }, {\n        langKey: 'Chat.Message.Ad.ReadMore',\n        callback: () => {\n          window.open(I18n.format('Chat.Message.Sponsored.Link', true));\n        },\n        isCancel: true\n      }],\n      scrollable: true\n    });\n\n    this.scrollable.append(this.description);\n\n    this.show();\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport PopupElement from '.';\nimport {Message} from '../../layer';\nimport {SettingSection} from '../sidebarLeft';\nimport ReactionsElement from '../chat/reactions';\nimport {horizontalMenu} from '../horizontalMenu';\nimport Scrollable from '../scrollable';\nimport ScrollableLoader from '../../helpers/scrollableLoader';\nimport appDialogsManager from '../../lib/appManagers/appDialogsManager';\nimport replaceContent from '../../helpers/dom/replaceContent';\nimport {wrapSticker} from '../wrappers';\nimport ReactionElement from '../chat/reaction';\nimport getUserStatusString from '../wrappers/getUserStatusString';\n\nexport default class PopupReactedList extends PopupElement {\n  constructor(\n    private message: Message.message\n  ) {\n    super('popup-reacted-list', {closable: true, overlayClosable: true, body: true});\n\n    this.init();\n  }\n\n  private async init() {\n    const message = await this.managers.appMessagesManager.getGroupsFirstMessage(this.message);\n\n    const canViewReadParticipants = await this.managers.appMessagesManager.canViewMessageReadParticipants(message);\n\n    // this.body.append(generateDelimiter());\n\n    const reactionsElement = new ReactionsElement();\n    const newMessage: Message.message = {\n      ...message,\n      mid: 0,\n      id: 0,\n      reactions: {\n        _: 'messageReactions',\n        results: [],\n\n        ...message.reactions,\n\n        pFlags: {},\n        recent_reactions: []\n      }\n    };\n\n    newMessage.reactions.results = newMessage.reactions.results.map((reactionCount) => {\n      return {\n        ...reactionCount,\n        pFlags: {}\n      };\n    });\n\n    reactionsElement.init(newMessage, 'block');\n    reactionsElement.render();\n    reactionsElement.classList.add('no-stripe');\n    reactionsElement.classList.remove('has-no-reactions');\n\n    reactionsElement.append(this.btnClose);\n\n    this.header.append(reactionsElement);\n\n    const tabsContainer = document.createElement('div');\n    tabsContainer.classList.add('tabs-container');\n    tabsContainer.dataset.animation = 'tabs';\n\n    const loaders: Map<HTMLElement, ScrollableLoader> = new Map();\n\n    let hasAllReactions = false;\n    if(newMessage.reactions.results.length) {\n      const reaction = this.createFakeReaction('reactions', newMessage.reactions.results.reduce((acc, r) => acc + r.count, 0));\n\n      reactionsElement.prepend(reaction);\n      newMessage.reactions.results.unshift(reaction.reactionCount);\n      hasAllReactions = true;\n    }\n\n    let hasReadParticipants = false;\n    if(canViewReadParticipants) {\n      try {\n        const readUserIds = await this.managers.appMessagesManager.getMessageReadParticipants(message.peerId, message.mid);\n        if(!readUserIds.length) {\n          throw '';\n        }\n\n        const reaction = this.createFakeReaction('checks', readUserIds.length);\n\n        reactionsElement.prepend(reaction);\n        newMessage.reactions.results.unshift(reaction.reactionCount);\n        hasReadParticipants = true;\n      } catch(err) {\n\n      }\n    }\n\n    newMessage.reactions.results.forEach((reactionCount) => {\n      const scrollable = new Scrollable(undefined);\n      scrollable.container.classList.add('tabs-tab');\n\n      const section = new SettingSection({\n        noShadow: true,\n        noDelimiter: true\n      });\n\n      const chatlist = appDialogsManager.createChatList({\n        dialogSize: 72\n      });\n\n      appDialogsManager.setListClickListener(chatlist, () => {\n        this.hide();\n      }, undefined, false, true);\n\n      section.content.append(chatlist);\n      scrollable.container.append(section.container);\n\n      const skipReadParticipants = reactionCount.reaction !== 'checks';\n      const skipReactionsList = reactionCount.reaction === 'checks';\n      if(['checks', 'reactions'].includes(reactionCount.reaction)) {\n        reactionCount.reaction = undefined;\n      }\n\n      let nextOffset: string;\n      const loader = new ScrollableLoader({\n        scrollable,\n        getPromise: async() => {\n          const result = await this.managers.appMessagesManager.getMessageReactionsListAndReadParticipants(message, undefined, reactionCount.reaction, nextOffset, skipReadParticipants, skipReactionsList);\n          nextOffset = result.nextOffset;\n\n          await Promise.all(result.combined.map(async({peerId, reaction}) => {\n            const {dom} = appDialogsManager.addDialogNew({\n              peerId: peerId,\n              autonomous: true,\n              container: chatlist,\n              avatarSize: 54,\n              rippleEnabled: false,\n              meAsSaved: false\n            });\n\n            if(reaction) {\n              const stickerContainer = document.createElement('div');\n              stickerContainer.classList.add('reacted-list-reaction-icon');\n              const availableReaction = await this.managers.appReactionsManager.getReactionCached(reaction);\n\n              wrapSticker({\n                doc: availableReaction.static_icon,\n                div: stickerContainer,\n                width: 24,\n                height: 24\n              });\n\n              dom.listEl.append(stickerContainer);\n            }\n\n            replaceContent(dom.lastMessageSpan, getUserStatusString(await this.managers.appUsersManager.getUser(peerId.toUserId())));\n          }));\n\n          return !nextOffset;\n        }\n      });\n\n      loaders.set(scrollable.container, loader);\n\n      tabsContainer.append(scrollable.container);\n    });\n\n    this.body.append(tabsContainer);\n\n    const selectTab = horizontalMenu(reactionsElement, tabsContainer, (id, tabContent) => {\n      if(id === (reactionsElement.childElementCount - 1)) {\n        return false;\n      }\n\n      const reaction = reactionsElement.children[id] as ReactionElement;\n      const prevId = selectTab.prevId();\n      if(prevId !== -1) {\n        (reactionsElement.children[prevId] as ReactionElement).setIsChosen(false);\n      }\n\n      reaction.setIsChosen(true);\n\n      const loader = loaders.get(tabContent);\n      loader.load();\n    }, undefined, undefined, undefined, this.listenerSetter);\n\n    // selectTab(hasAllReactions && hasReadParticipants ? 1 : 0, false);\n    selectTab(0, false);\n\n    this.show();\n  }\n\n  private createFakeReaction(icon: string, count: number) {\n    const reaction = new ReactionElement();\n    reaction.init('block');\n    reaction.reactionCount = {\n      _: 'reactionCount',\n      count: count,\n      reaction: icon\n    };\n    reaction.setCanRenderAvatars(false);\n    reaction.renderCounter();\n\n    const allReactionsSticker = document.createElement('div');\n    allReactionsSticker.classList.add('reaction-counter', 'reaction-sticker-icon', 'tgico-' + icon);\n    reaction.prepend(allReactionsSticker);\n\n    return reaction;\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport IS_TOUCH_SUPPORTED from '../../environment/touchSupport';\nimport {IS_MOBILE, IS_SAFARI} from '../../environment/userAgent';\nimport assumeType from '../../helpers/assumeType';\nimport callbackify from '../../helpers/callbackify';\nimport {attachClickEvent} from '../../helpers/dom/clickEvent';\nimport findUpClassName from '../../helpers/dom/findUpClassName';\nimport getVisibleRect from '../../helpers/dom/getVisibleRect';\nimport {getMiddleware} from '../../helpers/middleware';\nimport noop from '../../helpers/noop';\nimport {fastRaf} from '../../helpers/schedulers';\nimport {Message, AvailableReaction} from '../../layer';\nimport {AppManagers} from '../../lib/appManagers/managers';\nimport lottieLoader from '../../lib/rlottie/lottieLoader';\nimport RLottiePlayer from '../../lib/rlottie/rlottiePlayer';\nimport rootScope from '../../lib/rootScope';\nimport animationIntersector, {AnimationItemGroup} from '../animationIntersector';\nimport Scrollable, {ScrollableBase, ScrollableX} from '../scrollable';\nimport {wrapSticker} from '../wrappers';\n\nconst REACTIONS_CLASS_NAME = 'btn-menu-reactions';\nconst REACTION_CLASS_NAME = REACTIONS_CLASS_NAME + '-reaction';\n\nconst REACTION_SIZE = 26;\nconst PADDING = 4;\nexport const REACTION_CONTAINER_SIZE = REACTION_SIZE + PADDING * 2;\n\nconst CAN_USE_TRANSFORM = !IS_SAFARI;\n\ntype ChatReactionsMenuPlayers = {\n  select?: RLottiePlayer,\n  appear?: RLottiePlayer,\n  selectWrapper: HTMLElement,\n  appearWrapper: HTMLElement,\n  reaction: string\n};\nexport class ChatReactionsMenu {\n  public widthContainer: HTMLElement;\n  public container: HTMLElement;\n  private reactionsMap: Map<HTMLElement, ChatReactionsMenuPlayers>;\n  public scrollable: ScrollableBase;\n  private animationGroup: AnimationItemGroup;\n  private middleware: ReturnType<typeof getMiddleware>;\n  private message: Message.message;\n\n  constructor(\n    private managers: AppManagers,\n    private type: 'horizontal' | 'vertical',\n    middleware: ChatReactionsMenu['middleware']\n  ) {\n    const widthContainer = this.widthContainer = document.createElement('div');\n    widthContainer.classList.add(REACTIONS_CLASS_NAME + '-container');\n    widthContainer.classList.add(REACTIONS_CLASS_NAME + '-container-' + type);\n\n    const reactionsContainer = this.container = document.createElement('div');\n    reactionsContainer.classList.add(REACTIONS_CLASS_NAME);\n\n    const reactionsScrollable = this.scrollable = type === 'vertical' ? new Scrollable(undefined) : new ScrollableX(undefined);\n    reactionsContainer.append(reactionsScrollable.container);\n    reactionsScrollable.onAdditionalScroll = this.onScroll;\n    reactionsScrollable.setListeners();\n\n    reactionsScrollable.container.classList.add('no-scrollbar');\n\n    // ['big'].forEach((type) => {\n    //   const bubble = document.createElement('div');\n    //   bubble.classList.add(REACTIONS_CLASS_NAME + '-bubble', REACTIONS_CLASS_NAME + '-bubble-' + type);\n    //   reactionsContainer.append(bubble);\n    // });\n\n    this.reactionsMap = new Map();\n    this.animationGroup = `CHAT-MENU-REACTIONS-${Date.now()}`;\n    animationIntersector.setOverrideIdleGroup(this.animationGroup, true);\n\n    if(!IS_TOUCH_SUPPORTED) {\n      reactionsContainer.addEventListener('mousemove', this.onMouseMove);\n    }\n\n    attachClickEvent(reactionsContainer, (e) => {\n      const reactionDiv = findUpClassName(e.target, REACTION_CLASS_NAME);\n      if(!reactionDiv) return;\n\n      const players = this.reactionsMap.get(reactionDiv);\n      if(!players) return;\n\n      this.managers.appReactionsManager.sendReaction(this.message, players.reaction);\n    });\n\n    widthContainer.append(reactionsContainer);\n\n    this.middleware = middleware ?? getMiddleware();\n  }\n\n  public init(message: Message.message) {\n    this.message = message;\n\n    const middleware = this.middleware.get();\n    // const result = Promise.resolve(this.appReactionsManager.getAvailableReactionsForPeer(message.peerId)).then((res) => pause(1000).then(() => res));\n    const result = this.managers.appReactionsManager.getAvailableReactionsByMessage(message);\n    callbackify(result, (reactions) => {\n      if(!middleware() || !reactions.length) return;\n      reactions.forEach((reaction) => {\n        if(reaction.pFlags.premium && !rootScope.premium) return;\n        this.renderReaction(reaction);\n      });\n\n      const setVisible = () => {\n        this.container.classList.add('is-visible');\n      };\n\n      if(result instanceof Promise) {\n        fastRaf(setVisible);\n      } else {\n        setVisible();\n      }\n    });\n  }\n\n  public cleanup() {\n    this.middleware.clean();\n    this.scrollable.removeListeners();\n    this.reactionsMap.clear();\n    animationIntersector.setOverrideIdleGroup(this.animationGroup, false);\n    animationIntersector.checkAnimations(true, this.animationGroup, true);\n  }\n\n  private onScroll = () => {\n    this.reactionsMap.forEach((players, div) => {\n      this.onScrollProcessItem(div, players);\n    });\n  };\n\n  private canUseAnimations() {\n    return rootScope.settings.animationsEnabled && !IS_MOBILE;\n  }\n\n  private renderReaction(reaction: AvailableReaction) {\n    const reactionDiv = document.createElement('div');\n    reactionDiv.classList.add(REACTION_CLASS_NAME);\n\n    const scaleContainer = document.createElement('div');\n    scaleContainer.classList.add(REACTION_CLASS_NAME + '-scale');\n\n    const appearWrapper = document.createElement('div');\n    let selectWrapper: HTMLElement;;\n    appearWrapper.classList.add(REACTION_CLASS_NAME + '-appear');\n\n    if(this.canUseAnimations()) {\n      selectWrapper = document.createElement('div');\n      selectWrapper.classList.add(REACTION_CLASS_NAME + '-select', 'hide');\n    }\n\n    const players: ChatReactionsMenuPlayers = {\n      selectWrapper,\n      appearWrapper,\n      reaction: reaction.reaction\n    };\n    this.reactionsMap.set(reactionDiv, players);\n\n    const middleware = this.middleware.get();\n\n    const hoverScale = IS_TOUCH_SUPPORTED ? 1 : 1.25;\n    const size = REACTION_SIZE * hoverScale;\n\n    const options = {\n      width: size,\n      height: size,\n      skipRatio: 1,\n      needFadeIn: false,\n      withThumb: false,\n      group: this.animationGroup,\n      middleware\n    };\n\n    if(!this.canUseAnimations()) {\n      delete options.needFadeIn;\n      delete options.withThumb;\n\n      wrapSticker({\n        doc: reaction.static_icon,\n        div: appearWrapper,\n        ...options\n      });\n    } else {\n      let isFirst = true;\n      wrapSticker({\n        doc: reaction.appear_animation,\n        div: appearWrapper,\n        play: true,\n        ...options\n      }).then(({render}) => render).then((player) => {\n        assumeType<RLottiePlayer>(player);\n\n        players.appear = player;\n\n        player.addEventListener('enterFrame', (frameNo) => {\n          if(player.maxFrame === frameNo) {\n            selectLoadPromise.then((selectPlayer) => {\n              assumeType<RLottiePlayer>(selectPlayer);\n              appearWrapper.classList.add('hide');\n              selectWrapper.classList.remove('hide');\n\n              if(isFirst) {\n                players.select = selectPlayer;\n                isFirst = false;\n              }\n            }, noop);\n          }\n        });\n      }, noop);\n\n      const selectLoadPromise = wrapSticker({\n        doc: reaction.select_animation,\n        div: selectWrapper,\n        ...options\n      }).then(({render}) => render).then((player) => {\n        assumeType<RLottiePlayer>(player);\n\n        return lottieLoader.waitForFirstFrame(player);\n      }).catch(noop);\n    }\n\n    scaleContainer.append(appearWrapper);\n    selectWrapper && scaleContainer.append(selectWrapper);\n    reactionDiv.append(scaleContainer);\n    this.scrollable.append(reactionDiv);\n  }\n\n  private onScrollProcessItem(div: HTMLElement, players: ChatReactionsMenuPlayers) {\n    // return;\n\n    const scaleContainer = div.firstElementChild as HTMLElement;\n    const visibleRect = getVisibleRect(div, this.scrollable.container);\n    let transform: string;\n    if(!visibleRect) {\n      if(!players.appearWrapper.classList.contains('hide') || !players.appear) {\n        return;\n      }\n\n      if(players.select) {\n        players.select.stop();\n      }\n\n      players.appear.stop();\n      players.appear.autoplay = true;\n      players.appearWrapper.classList.remove('hide');\n      players.selectWrapper.classList.add('hide');\n\n      transform = '';\n    } else if(visibleRect.overflow.left || visibleRect.overflow.right) {\n      const diff = Math.abs(visibleRect.rect.left - visibleRect.rect.right);\n      const scale = Math.min(diff ** 2 / REACTION_CONTAINER_SIZE ** 2, 1);\n\n      transform = 'scale(' + scale + ')';\n    } else {\n      transform = '';\n    }\n\n    if(CAN_USE_TRANSFORM) {\n      scaleContainer.style.transform = transform;\n    }\n  }\n\n  private onMouseMove = (e: MouseEvent) => {\n    const reactionDiv = findUpClassName(e.target, REACTION_CLASS_NAME);\n    if(!reactionDiv) {\n      return;\n    }\n\n    const players = this.reactionsMap.get(reactionDiv);\n    if(!players) {\n      return;\n    }\n\n    // do not play select animation when appearing\n    if(!players.appear?.paused) {\n      return;\n    }\n\n    const player = players.select;\n    if(!player) {\n      return;\n    }\n\n    if(player.paused) {\n      player.autoplay = true;\n      player.restart();\n    }\n  };\n}\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport type {MyDocument} from '../../lib/appManagers/appDocsManager';\r\nimport type Chat from './chat';\r\nimport IS_TOUCH_SUPPORTED from '../../environment/touchSupport';\r\nimport ButtonMenu, {ButtonMenuItemOptions} from '../buttonMenu';\r\nimport PopupDeleteMessages from '../popups/deleteMessages';\r\nimport PopupForward from '../popups/forward';\r\nimport PopupPinMessage from '../popups/unpinMessage';\r\nimport {copyTextToClipboard} from '../../helpers/clipboard';\r\nimport PopupSendNow from '../popups/sendNow';\r\nimport {toast} from '../toast';\r\nimport I18n, {i18n, LangPackKey} from '../../lib/langPack';\r\nimport findUpClassName from '../../helpers/dom/findUpClassName';\r\nimport cancelEvent from '../../helpers/dom/cancelEvent';\r\nimport {attachClickEvent, simulateClickEvent} from '../../helpers/dom/clickEvent';\r\nimport isSelectionEmpty from '../../helpers/dom/isSelectionEmpty';\r\nimport {Message, Poll, Chat as MTChat, MessageMedia, AvailableReaction, MessageEntity, InputStickerSet, StickerSet, Document} from '../../layer';\r\nimport PopupReportMessages from '../popups/reportMessages';\r\nimport assumeType from '../../helpers/assumeType';\r\nimport PopupSponsored from '../popups/sponsored';\r\nimport ListenerSetter from '../../helpers/listenerSetter';\r\nimport {getMiddleware} from '../../helpers/middleware';\r\nimport PeerTitle from '../peerTitle';\r\nimport StackedAvatars from '../stackedAvatars';\r\nimport {IS_APPLE} from '../../environment/userAgent';\r\nimport PopupReactedList from '../popups/reactedList';\r\nimport {ChatReactionsMenu, REACTION_CONTAINER_SIZE} from './reactionsMenu';\r\nimport getPeerId from '../../lib/appManagers/utils/peers/getPeerId';\r\nimport getServerMessageId from '../../lib/appManagers/utils/messageId/getServerMessageId';\r\nimport {AppManagers} from '../../lib/appManagers/managers';\r\nimport positionMenu, {MenuPositionPadding} from '../../helpers/positionMenu';\r\nimport contextMenuController from '../../helpers/contextMenuController';\r\nimport {attachContextMenuListener} from '../../helpers/dom/attachContextMenuListener';\r\nimport filterAsync from '../../helpers/array/filterAsync';\r\nimport appDownloadManager from '../../lib/appManagers/appDownloadManager';\r\nimport {SERVICE_PEER_ID} from '../../lib/mtproto/mtproto_config';\r\nimport {MessagesStorageKey} from '../../lib/appManagers/appMessagesManager';\r\nimport filterUnique from '../../helpers/array/filterUnique';\r\nimport replaceContent from '../../helpers/dom/replaceContent';\r\nimport wrapEmojiText from '../../lib/richTextProcessor/wrapEmojiText';\r\nimport deferredPromise, {CancellablePromise} from '../../helpers/cancellablePromise';\r\nimport PopupStickers from '../popups/stickers';\r\n\r\nexport default class ChatContextMenu {\r\n  private buttons: (ButtonMenuItemOptions & {verify: () => boolean | Promise<boolean>, notDirect?: () => boolean, withSelection?: true, isSponsored?: true, localName?: 'views' | 'emojis'})[];\r\n  private element: HTMLElement;\r\n\r\n  private isSelectable: boolean;\r\n  private isSelected: boolean;\r\n  private target: HTMLElement;\r\n  private isTargetAGroupedItem: boolean;\r\n  private isTextSelected: boolean;\r\n  private isAnchorTarget: boolean;\r\n  private isUsernameTarget: boolean;\r\n  private isSponsored: boolean;\r\n  private isOverBubble: boolean;\r\n  private peerId: PeerId;\r\n  private mid: number;\r\n  private message: Message.message | Message.messageService;\r\n  private noForwards: boolean;\r\n\r\n  private reactionsMenu: ChatReactionsMenu;\r\n  private listenerSetter: ListenerSetter;\r\n  private attachListenerSetter: ListenerSetter;\r\n\r\n  private viewerPeerId: PeerId;\r\n  private middleware: ReturnType<typeof getMiddleware>;\r\n  private canOpenReactedList: boolean;\r\n\r\n  private emojiInputsPromise: CancellablePromise<InputStickerSet.inputStickerSetID[]>;\r\n\r\n  constructor(\r\n    private chat: Chat,\r\n    private managers: AppManagers\r\n  ) {\r\n    this.listenerSetter = new ListenerSetter();\r\n    this.attachListenerSetter = new ListenerSetter();\r\n    this.middleware = getMiddleware();\r\n  }\r\n\r\n  public attachTo(element: HTMLElement) {\r\n    this.attachListenerSetter.removeAll();\r\n\r\n    if(IS_TOUCH_SUPPORTED/*  && false */) {\r\n      attachClickEvent(element, (e) => {\r\n        if(this.chat.selection.isSelecting) {\r\n          return;\r\n        }\r\n\r\n        this.chat.log('touchend', e);\r\n\r\n        const badSelectors = [\r\n          '.name',\r\n          '.peer-title',\r\n          '.reply',\r\n          '.document',\r\n          'audio-element',\r\n          'avatar-element',\r\n          'a',\r\n          '.bubble-beside-button',\r\n          'replies-element',\r\n          '[data-saved-from]:not(.bubble)',\r\n          'poll-element',\r\n          '.attachment',\r\n          '.reply-markup-button'\r\n        ];\r\n        const good = !(e.target as HTMLElement).closest(badSelectors.join(', '));\r\n        if(good) {\r\n          cancelEvent(e);\r\n          // onContextMenu((e as TouchEvent).changedTouches[0]);\r\n          // onContextMenu((e as TouchEvent).changedTouches ? (e as TouchEvent).changedTouches[0] : e as MouseEvent);\r\n          this.onContextMenu(e);\r\n        }\r\n      }, {listenerSetter: this.attachListenerSetter});\r\n    } else attachContextMenuListener(element, this.onContextMenu, this.attachListenerSetter);\r\n  }\r\n\r\n  private onContextMenu = (e: MouseEvent | Touch | TouchEvent) => {\r\n    let bubble: HTMLElement, contentWrapper: HTMLElement;\r\n\r\n    try {\r\n      contentWrapper = findUpClassName(e.target, 'bubble-content-wrapper');\r\n      bubble = contentWrapper ? contentWrapper.parentElement : findUpClassName(e.target, 'bubble');\r\n    } catch(e) {}\r\n\r\n    // ! context menu click by date bubble (there is no pointer-events)\r\n    if(!bubble || bubble.classList.contains('bubble-first')) return;\r\n\r\n    let element = this.element;\r\n    if(e instanceof MouseEvent || e.hasOwnProperty('preventDefault')) (e as any).preventDefault();\r\n    if(element && element.classList.contains('active')) {\r\n      return false;\r\n    }\r\n    if(e instanceof MouseEvent || e.hasOwnProperty('cancelBubble')) (e as any).cancelBubble = true;\r\n\r\n    let mid = +bubble.dataset.mid;\r\n    if(!mid) return;\r\n\r\n    const r = async() => {\r\n      const isSponsored = this.isSponsored = mid < 0;\r\n      this.isSelectable = this.chat.selection.canSelectBubble(bubble);\r\n      this.peerId = this.chat.peerId;\r\n      // this.msgID = msgID;\r\n      this.target = e.target as HTMLElement;\r\n      this.isTextSelected = !isSelectionEmpty();\r\n      this.isAnchorTarget = this.target.tagName === 'A' && (\r\n        (this.target as HTMLAnchorElement).target === '_blank' ||\r\n        this.target.classList.contains('anchor-url')\r\n      );\r\n      this.isUsernameTarget = this.target.tagName === 'A' && this.target.classList.contains('mention');\r\n\r\n      // *         ,     ,    \r\n      if(this.chat.selection.isSelecting && !contentWrapper) {\r\n        if(isSponsored) {\r\n          return;\r\n        }\r\n\r\n        const mids = await this.chat.getMidsByMid(mid);\r\n        if(mids.length > 1) {\r\n          const selectedMid = this.chat.selection.isMidSelected(this.peerId, mid) ?\r\n            mid :\r\n            mids.find((mid) => this.chat.selection.isMidSelected(this.peerId, mid));\r\n          if(selectedMid) {\r\n            mid = selectedMid;\r\n          }\r\n        }\r\n      }\r\n\r\n      this.isOverBubble = !!contentWrapper;\r\n\r\n      const groupedItem = findUpClassName(this.target, 'grouped-item');\r\n      this.isTargetAGroupedItem = !!groupedItem;\r\n      if(groupedItem) {\r\n        this.mid = +groupedItem.dataset.mid;\r\n      } else {\r\n        this.mid = mid;\r\n      }\r\n\r\n      this.isSelected = this.chat.selection.isMidSelected(this.peerId, this.mid);\r\n      this.message = await this.chat.getMessage(this.mid);\r\n      this.noForwards = !isSponsored && !(await this.managers.appMessagesManager.canForward(this.message));\r\n      this.viewerPeerId = undefined;\r\n      this.canOpenReactedList = undefined;\r\n\r\n      const initResult = await this.init();\r\n      if(!initResult) {\r\n        return;\r\n      }\r\n\r\n      element = initResult.element;\r\n      const {cleanup, destroy, menuPadding, reactionsMenu, reactionsMenuPosition} = initResult;\r\n      let isReactionsMenuVisible = false;\r\n      if(reactionsMenu) {\r\n        const className = 'is-visible';\r\n        isReactionsMenuVisible = reactionsMenu.container.classList.contains(className);\r\n        if(isReactionsMenuVisible) reactionsMenu.container.classList.remove(className);\r\n\r\n        if(reactionsMenuPosition === 'horizontal') {\r\n          const offsetSize = element[/* reactionsMenuPosition === 'vertical' ? 'offsetHeight' :  */'offsetWidth'];\r\n          // if(reactionsMenu.scrollable.container.scrollWidth > offsetWidth) {\r\n          const INNER_CONTAINER_PADDING = 8;\r\n          const visibleLength = (offsetSize - INNER_CONTAINER_PADDING) / REACTION_CONTAINER_SIZE;\r\n          const nextVisiblePart = visibleLength % 1;\r\n          const MIN_NEXT_VISIBLE_PART = 0.65;\r\n          if(nextVisiblePart < MIN_NEXT_VISIBLE_PART) {\r\n            const minSize = (offsetSize + (MIN_NEXT_VISIBLE_PART - nextVisiblePart) * REACTION_CONTAINER_SIZE) | 0;\r\n            element.style[/* reactionsMenuPosition === 'vertical' ? 'minHeight' :  */'minWidth'] = minSize + 'px';\r\n          }\r\n          // }\r\n        }\r\n      }\r\n\r\n      const side: 'left' | 'right' = bubble.classList.contains('is-in') ? 'left' : 'right';\r\n      // bubble.parentElement.append(element);\r\n      // appImManager.log('contextmenu', e, bubble, side);\r\n      positionMenu((e as TouchEvent).touches ? (e as TouchEvent).touches[0] : e as MouseEvent, element, side, menuPadding);\r\n\r\n      if(reactionsMenu) {\r\n        reactionsMenu.widthContainer.style.top = element.style.top;\r\n        reactionsMenu.widthContainer.style.left = element.style.left;\r\n        reactionsMenu.widthContainer.style.setProperty('--menu-width', element[reactionsMenuPosition === 'vertical' ? 'offsetHeight' : 'offsetWidth'] + 'px');\r\n        element.parentElement.append(reactionsMenu.widthContainer);\r\n        if(isReactionsMenuVisible) void reactionsMenu.container.offsetLeft; // reflow\r\n      }\r\n\r\n      contextMenuController.openBtnMenu(element, () => {\r\n        if(reactionsMenu) {\r\n          reactionsMenu.container.classList.remove('is-visible');\r\n        }\r\n\r\n        this.mid = 0;\r\n        this.peerId = undefined;\r\n        this.target = null;\r\n        this.viewerPeerId = undefined;\r\n        this.canOpenReactedList = undefined;\r\n        cleanup();\r\n\r\n        setTimeout(() => {\r\n          destroy();\r\n        }, 300);\r\n      });\r\n\r\n      if(isReactionsMenuVisible) {\r\n        reactionsMenu.container.classList.add('is-visible');\r\n      }\r\n    };\r\n\r\n    r();\r\n  };\r\n\r\n  public cleanup() {\r\n    this.listenerSetter.removeAll();\r\n    this.reactionsMenu && this.reactionsMenu.cleanup();\r\n    this.middleware.clean();\r\n  }\r\n\r\n  public destroy() {\r\n    this.cleanup();\r\n    this.attachListenerSetter.removeAll();\r\n  }\r\n\r\n  private async filterButtons(buttons: ChatContextMenu['buttons']) {\r\n    if(this.isSponsored) {\r\n      return buttons.filter((button) => {\r\n        return button.isSponsored;\r\n      });\r\n    } else {\r\n      return filterAsync(buttons, async(button) => {\r\n        let good: boolean;\r\n\r\n        // if((appImManager.chatSelection.isSelecting && !button.withSelection) || (button.withSelection && !appImManager.chatSelection.isSelecting)) {\r\n        if(this.chat.selection.isSelecting && !button.withSelection) {\r\n          good = false;\r\n        } else {\r\n          good = this.isOverBubble || IS_TOUCH_SUPPORTED || true ?\r\n            await button.verify() :\r\n            button.notDirect && await button.verify() && button.notDirect();\r\n        }\r\n\r\n        return !!good;\r\n      });\r\n    }\r\n  }\r\n\r\n  private setButtons() {\r\n    const verifyFavoriteSticker = async(toAdd: boolean) => {\r\n      const doc = ((this.message as Message.message).media as MessageMedia.messageMediaDocument)?.document;\r\n      if(!(doc as MyDocument)?.sticker) {\r\n        return false;\r\n      }\r\n\r\n      const favedStickers = await this.managers.acknowledged.appStickersManager.getFavedStickersStickers();\r\n      if(!favedStickers.cached) {\r\n        return false;\r\n      }\r\n\r\n      const found = (await favedStickers.result).some((_doc) => _doc.id === doc.id);\r\n      return toAdd ? !found : found;\r\n    };\r\n\r\n    this.buttons = [{\r\n      icon: 'send2',\r\n      text: 'MessageScheduleSend',\r\n      onClick: this.onSendScheduledClick,\r\n      verify: () => this.chat.type === 'scheduled' && !this.message.pFlags.is_outgoing\r\n    }, {\r\n      icon: 'send2',\r\n      text: 'Message.Context.Selection.SendNow',\r\n      onClick: this.onSendScheduledClick,\r\n      verify: () => this.chat.type === 'scheduled' && this.isSelected && !this.chat.selection.selectionSendNowBtn.hasAttribute('disabled'),\r\n      notDirect: () => true,\r\n      withSelection: true\r\n    }, {\r\n      icon: 'schedule',\r\n      text: 'MessageScheduleEditTime',\r\n      onClick: () => {\r\n        this.chat.input.scheduleSending(() => {\r\n          assumeType<Message.message>(this.message);\r\n          this.managers.appMessagesManager.editMessage(this.message, this.message.message, {\r\n            scheduleDate: this.chat.input.scheduleDate,\r\n            entities: this.message.entities\r\n          });\r\n\r\n          this.chat.input.onMessageSent(false, false);\r\n        }, new Date(this.message.date * 1000));\r\n      },\r\n      verify: () => this.chat.type === 'scheduled'\r\n    }, {\r\n      icon: 'reply',\r\n      text: 'Reply',\r\n      onClick: this.onReplyClick,\r\n      verify: async() => await this.chat.canSend() &&\r\n        !this.message.pFlags.is_outgoing &&\r\n        !!this.chat.input.messageInput &&\r\n        this.chat.type !== 'scheduled'/* ,\r\n      cancelEvent: true */\r\n    }, {\r\n      icon: 'favourites',\r\n      text: 'AddToFavorites',\r\n      onClick: this.onFaveStickerClick.bind(this, false),\r\n      verify: () => verifyFavoriteSticker(true)\r\n    }, {\r\n      icon: 'favourites',\r\n      text: 'DeleteFromFavorites',\r\n      onClick: this.onFaveStickerClick.bind(this, true),\r\n      verify: () => verifyFavoriteSticker(false)\r\n    }, {\r\n      icon: 'edit',\r\n      text: 'Edit',\r\n      onClick: this.onEditClick,\r\n      verify: async() => (await this.managers.appMessagesManager.canEditMessage(this.message, 'text')) && !!this.chat.input.messageInput\r\n    }, {\r\n      icon: 'copy',\r\n      text: 'Copy',\r\n      onClick: this.onCopyClick,\r\n      verify: () => !this.noForwards && !!(this.message as Message.message).message && !this.isTextSelected && (!this.isAnchorTarget || (this.message as Message.message).message !== this.target.innerText)\r\n    }, {\r\n      icon: 'copy',\r\n      text: 'Chat.CopySelectedText',\r\n      onClick: this.onCopyClick,\r\n      verify: () => !this.noForwards && !!(this.message as Message.message).message && this.isTextSelected\r\n    }, {\r\n      icon: 'copy',\r\n      text: 'Message.Context.Selection.Copy',\r\n      onClick: this.onCopyClick,\r\n      verify: async() => {\r\n        if(!this.isSelected || this.noForwards) {\r\n          return false;\r\n        }\r\n\r\n        for(const [peerId, mids] of this.chat.selection.selectedMids) {\r\n          const storageKey: MessagesStorageKey = `${peerId}_${this.chat.type === 'scheduled' ? 'scheduled' : 'history'}`;\r\n          for(const mid of mids) {\r\n            const message = (await this.managers.appMessagesManager.getMessageFromStorage(storageKey, mid)) as Message.message;\r\n            if(!!message.message) {\r\n              return true;\r\n            }\r\n          }\r\n        }\r\n\r\n        return false;\r\n      },\r\n      notDirect: () => true,\r\n      withSelection: true\r\n    }, {\r\n      icon: 'copy',\r\n      text: 'CopyLink',\r\n      onClick: this.onCopyAnchorLinkClick,\r\n      verify: () => this.isAnchorTarget,\r\n      withSelection: true\r\n    }, {\r\n      icon: 'copy',\r\n      text: 'Text.Context.Copy.Username',\r\n      onClick: () => {\r\n        copyTextToClipboard(this.target.innerHTML);\r\n      },\r\n      verify: () => this.isUsernameTarget,\r\n      withSelection: true\r\n    }, {\r\n      icon: 'copy',\r\n      text: 'Text.Context.Copy.Hashtag',\r\n      onClick: () => {\r\n        copyTextToClipboard(this.target.innerHTML);\r\n      },\r\n      verify: () => this.target.classList.contains('anchor-hashtag'),\r\n      withSelection: true\r\n    }, {\r\n      icon: 'link',\r\n      text: 'MessageContext.CopyMessageLink1',\r\n      onClick: this.onCopyLinkClick,\r\n      verify: async() => await this.managers.appPeersManager.isChannel(this.peerId) && !this.message.pFlags.is_outgoing\r\n    }, {\r\n      icon: 'pin',\r\n      text: 'Message.Context.Pin',\r\n      onClick: this.onPinClick,\r\n      verify: async() => !this.message.pFlags.is_outgoing &&\r\n        this.message._ !== 'messageService' &&\r\n        !this.message.pFlags.pinned &&\r\n        await this.managers.appPeersManager.canPinMessage(this.peerId) &&\r\n        this.chat.type !== 'scheduled'\r\n    }, {\r\n      icon: 'unpin',\r\n      text: 'Message.Context.Unpin',\r\n      onClick: this.onUnpinClick,\r\n      verify: async() => (this.message as Message.message).pFlags.pinned && await this.managers.appPeersManager.canPinMessage(this.peerId)\r\n    }, {\r\n      icon: 'download',\r\n      text: 'MediaViewer.Context.Download',\r\n      onClick: () => {\r\n        appDownloadManager.downloadToDisc({media: (this.message as any).media.document});\r\n      },\r\n      verify: () => {\r\n        if(this.message.pFlags.is_outgoing) {\r\n          return false;\r\n        }\r\n\r\n        const doc: MyDocument = ((this.message as Message.message).media as MessageMedia.messageMediaDocument)?.document as any;\r\n        if(!doc) return false;\r\n\r\n        let hasTarget = !!IS_TOUCH_SUPPORTED;\r\n        const isGoodType = !doc.type || !(['gif', 'video'/* , 'sticker' */] as MyDocument['type'][]).includes(doc.type);\r\n        if(isGoodType) hasTarget ||= !!findUpClassName(this.target, 'document') || !!findUpClassName(this.target, 'audio') || !!findUpClassName(this.target, 'media-sticker-wrapper');\r\n        return isGoodType && hasTarget;\r\n      }\r\n    }, {\r\n      icon: 'checkretract',\r\n      text: 'Chat.Poll.Unvote',\r\n      onClick: this.onRetractVote,\r\n      verify: () => {\r\n        const poll = (this.message as any).media?.poll as Poll;\r\n        return poll && poll.chosenIndexes.length && !poll.pFlags.closed && !poll.pFlags.quiz;\r\n      }/* ,\r\n      cancelEvent: true */\r\n    }, {\r\n      icon: 'stop',\r\n      text: 'Chat.Poll.Stop',\r\n      onClick: this.onStopPoll,\r\n      verify: async() => {\r\n        const poll = (this.message as any).media?.poll;\r\n        return await this.managers.appMessagesManager.canEditMessage(this.message, 'poll') && poll && !poll.pFlags.closed && !this.message.pFlags.is_outgoing;\r\n      }/* ,\r\n      cancelEvent: true */\r\n    }, {\r\n      icon: 'forward',\r\n      text: 'Forward',\r\n      onClick: this.onForwardClick, // let forward the message if it's outgoing but not ours (like a changelog)\r\n      verify: () => !this.noForwards && this.chat.type !== 'scheduled' && (!this.message.pFlags.is_outgoing || this.message.fromId === SERVICE_PEER_ID) && this.message._ !== 'messageService'\r\n    }, {\r\n      icon: 'forward',\r\n      text: 'Message.Context.Selection.Forward',\r\n      onClick: this.onForwardClick,\r\n      verify: () => this.chat.selection.selectionForwardBtn &&\r\n        this.isSelected &&\r\n        !this.chat.selection.selectionForwardBtn.hasAttribute('disabled'),\r\n      notDirect: () => true,\r\n      withSelection: true\r\n    }, {\r\n      icon: 'flag',\r\n      text: 'ReportChat',\r\n      onClick: () => {\r\n        new PopupReportMessages(this.peerId, [this.mid]);\r\n      },\r\n      verify: async() => !this.message.pFlags.out && this.message._ === 'message' && !this.message.pFlags.is_outgoing && await this.managers.appPeersManager.isChannel(this.peerId),\r\n      notDirect: () => true,\r\n      withSelection: true\r\n    }, {\r\n      icon: 'select',\r\n      text: 'Message.Context.Select',\r\n      onClick: this.onSelectClick,\r\n      verify: () => !(this.message as Message.messageService).action && !this.isSelected && this.isSelectable,\r\n      notDirect: () => true,\r\n      withSelection: true\r\n    }, {\r\n      icon: 'select',\r\n      text: 'Message.Context.Selection.Clear',\r\n      onClick: this.onClearSelectionClick,\r\n      verify: () => this.isSelected,\r\n      notDirect: () => true,\r\n      withSelection: true\r\n    }, {\r\n      onClick: () => {\r\n        if(this.viewerPeerId) {\r\n          this.chat.appImManager.setInnerPeer({\r\n            peerId: this.viewerPeerId\r\n          });\r\n        } else if(this.canOpenReactedList) {\r\n          new PopupReactedList(this.message as Message.message);\r\n        } else {\r\n          return false;\r\n        }\r\n      },\r\n      verify: async() => !this.peerId.isUser() && (!!(this.message as Message.message).reactions?.recent_reactions?.length || await this.managers.appMessagesManager.canViewMessageReadParticipants(this.message)),\r\n      notDirect: () => true,\r\n      localName: 'views'\r\n    }, {\r\n      icon: 'delete danger',\r\n      text: 'Delete',\r\n      onClick: this.onDeleteClick,\r\n      verify: async() => this.managers.appMessagesManager.canDeleteMessage(this.message)\r\n    }, {\r\n      icon: 'delete danger',\r\n      text: 'Message.Context.Selection.Delete',\r\n      onClick: this.onDeleteClick,\r\n      verify: () => this.isSelected && !this.chat.selection.selectionDeleteBtn.hasAttribute('disabled'),\r\n      notDirect: () => true,\r\n      withSelection: true\r\n    }, {\r\n      icon: 'info',\r\n      text: 'Chat.Message.Sponsored.What',\r\n      onClick: () => {\r\n        new PopupSponsored();\r\n      },\r\n      verify: () => false,\r\n      isSponsored: true\r\n    }, {\r\n      // icon: 'smile',\r\n      text: 'Loading',\r\n      onClick: () => {\r\n        this.emojiInputsPromise.then((inputs) => {\r\n          new PopupStickers(inputs, true).show();\r\n        });\r\n      },\r\n      verify: () => {\r\n        const entities = (this.message as Message.message).entities;\r\n        return entities?.some((entity) => entity._ === 'messageEntityCustomEmoji');\r\n      },\r\n      notDirect: () => true,\r\n      localName: 'emojis'\r\n    }];\r\n  }\r\n\r\n  private async init() {\r\n    this.cleanup();\r\n    this.setButtons();\r\n\r\n    const filteredButtons = await this.filterButtons(this.buttons);\r\n    if(!filteredButtons.length) {\r\n      return;\r\n    }\r\n\r\n    const element = this.element = ButtonMenu(filteredButtons, this.listenerSetter);\r\n    element.id = 'bubble-contextmenu';\r\n    element.classList.add('contextmenu');\r\n\r\n    const viewsButton = filteredButtons.find((button) => button.localName === 'views');\r\n    if(viewsButton) {\r\n      const reactions = (this.message as Message.message).reactions;\r\n      const recentReactions = reactions?.recent_reactions;\r\n      const isViewingReactions = !!recentReactions?.length;\r\n      const participantsCount = await this.managers.appMessagesManager.canViewMessageReadParticipants(this.message) ?\r\n        ((await this.managers.appPeersManager.getPeer(this.peerId)) as MTChat.chat).participants_count :\r\n        undefined;\r\n      const reactedLength = reactions ? reactions.results.reduce((acc, r) => acc + r.count, 0) : undefined;\r\n\r\n      viewsButton.element.classList.add('tgico-' + (isViewingReactions ? 'reactions' : 'checks'));\r\n      const i18nElem = new I18n.IntlElement({\r\n        key: isViewingReactions ? (\r\n          participantsCount === undefined ? 'Chat.Context.ReactedFast' : 'Chat.Context.Reacted'\r\n        ) : 'NobodyViewed',\r\n        args: isViewingReactions ? (\r\n          participantsCount === undefined ? [reactedLength] : [participantsCount, participantsCount]\r\n        ) : undefined,\r\n        element: viewsButton.textElement\r\n      });\r\n\r\n      let fakeText: HTMLElement;\r\n      if(isViewingReactions) {\r\n        if(participantsCount === undefined) {\r\n          fakeText = i18n('Chat.Context.ReactedFast', [reactedLength]);\r\n        } else {\r\n          fakeText = i18n(\r\n            recentReactions.length === participantsCount ? 'Chat.Context.ReactedFast' : 'Chat.Context.Reacted',\r\n            [recentReactions.length, participantsCount]\r\n          );\r\n        }\r\n      } else {\r\n        fakeText = i18n('Loading');\r\n      }\r\n\r\n      fakeText.classList.add('btn-menu-item-text-fake');\r\n      viewsButton.element.append(fakeText);\r\n\r\n      const AVATAR_SIZE = 22;\r\n      const MAX_AVATARS = 3;\r\n      const PADDING_PER_AVATAR = 1.125;\r\n      i18nElem.element.style.visibility = 'hidden';\r\n      i18nElem.element.style.paddingRight = isViewingReactions ? PADDING_PER_AVATAR * Math.min(MAX_AVATARS, recentReactions.length) + 'rem' : '1rem';\r\n      const middleware = this.middleware.get();\r\n      this.managers.appMessagesManager.getMessageReactionsListAndReadParticipants(this.message as Message.message).then((result) => {\r\n        if(!middleware()) {\r\n          return;\r\n        }\r\n\r\n        if(fakeText) {\r\n          fakeText.remove();\r\n        }\r\n\r\n        const reactions = result.combined;\r\n        const reactedLength = participantsCount === undefined ?\r\n          result.reactionsCount :\r\n          (\r\n            isViewingReactions ?\r\n              reactions.filter((reaction) => reaction.reaction).length :\r\n              reactions.length\r\n          );\r\n\r\n        let fakeElem: HTMLElement;\r\n        if(reactions.length === 1) {\r\n          fakeElem = new PeerTitle({\r\n            peerId: reactions[0].peerId,\r\n            onlyFirstName: true,\r\n            dialog: false\r\n          }).element;\r\n\r\n          if(!isViewingReactions || result.readParticipants.length <= 1) {\r\n            this.viewerPeerId = reactions[0].peerId;\r\n          }\r\n        } else if(isViewingReactions) {\r\n          const isFull = reactedLength === reactions.length || participantsCount === undefined;\r\n          fakeElem = i18n(\r\n            isFull ? 'Chat.Context.ReactedFast' : 'Chat.Context.Reacted',\r\n            isFull ? [reactedLength] : [reactedLength, reactions.length]\r\n          );\r\n        } else {\r\n          if(!reactions.length) {\r\n            i18nElem.element.style.visibility = '';\r\n          } else {\r\n            fakeElem = i18n('MessageSeen', [reactions.length]);\r\n          }\r\n        }\r\n\r\n        if(fakeElem) {\r\n          fakeElem.style.paddingRight = PADDING_PER_AVATAR * Math.min(MAX_AVATARS, reactedLength) + 'rem';\r\n          fakeElem.classList.add('btn-menu-item-text-fake');\r\n          viewsButton.element.append(fakeElem);\r\n        }\r\n\r\n        if(reactions.length) {\r\n          const avatars = new StackedAvatars({avatarSize: AVATAR_SIZE});\r\n          avatars.render(recentReactions ? recentReactions.map((r) => getPeerId(r.peer_id)) : reactions.map((reaction) => reaction.peerId));\r\n          viewsButton.element.append(avatars.container);\r\n\r\n          // if(reactions.length > 1) {\r\n          // if(isViewingReactions) {\r\n          this.canOpenReactedList = true;\r\n          // }\r\n        }\r\n      });\r\n    }\r\n\r\n    let menuPadding: MenuPositionPadding;\r\n    let reactionsMenu: ChatReactionsMenu;\r\n    let reactionsMenuPosition: 'horizontal' | 'vertical';\r\n    if(this.message._ === 'message' && !this.chat.selection.isSelecting && !this.message.pFlags.is_outgoing && !this.message.pFlags.is_scheduled) {\r\n      reactionsMenuPosition = (IS_APPLE || IS_TOUCH_SUPPORTED)/*  && false */ ? 'horizontal' : 'vertical';\r\n      reactionsMenu = this.reactionsMenu = new ChatReactionsMenu(this.managers, reactionsMenuPosition, this.middleware);\r\n      reactionsMenu.init(await this.managers.appMessagesManager.getGroupsFirstMessage(this.message));\r\n      // element.prepend(reactionsMenu.widthContainer);\r\n\r\n      const size = 36;\r\n      const margin = 8;\r\n      const totalSize = size + margin;\r\n      const paddingLeft = 0, paddingRight = 0;\r\n      if(reactionsMenuPosition === 'vertical') {\r\n        menuPadding = {\r\n          top: paddingLeft,\r\n          // bottom: 36, // positionMenu will detect it itself somehow\r\n          left: totalSize\r\n        };\r\n      } else {\r\n        menuPadding = {\r\n          top: totalSize,\r\n          right: paddingRight,\r\n          left: paddingLeft\r\n        };\r\n      }\r\n    }\r\n\r\n    const emojisButton = filteredButtons.find((button) => button.localName === 'emojis');\r\n    if(emojisButton) {\r\n      emojisButton.element.classList.add('is-multiline');\r\n      emojisButton.element.parentElement.insertBefore(document.createElement('hr'), emojisButton.element);\r\n\r\n      const setPadding = () => {\r\n        menuPadding ??= {};\r\n        menuPadding.bottom = 24;\r\n      };\r\n\r\n      const entities = (this.message as Message.message).entities.filter((entity) => entity._ === 'messageEntityCustomEmoji') as MessageEntity.messageEntityCustomEmoji[];\r\n      const docIds = filterUnique(entities.map((entity) => entity.document_id));\r\n      const inputsPromise = this.emojiInputsPromise = deferredPromise();\r\n      await this.managers.appEmojiManager.getCachedCustomEmojiDocuments(docIds).then(async(docs) => {\r\n        const p = async(docs: Document.document[]) => {\r\n          const s: Map<StickerSet['id'], InputStickerSet.inputStickerSetID> = new Map();\r\n          docs.forEach((doc) => {\r\n            if(!doc || s.has(doc.stickerSetInput.id)) {\r\n              return;\r\n            }\r\n\r\n            s.set(doc.stickerSetInput.id, doc.stickerSetInput);\r\n          });\r\n\r\n          const inputs = [...s.values()];\r\n          inputsPromise.resolve(inputs);\r\n          if(s.size === 1) {\r\n            const result = await this.managers.acknowledged.appStickersManager.getStickerSet(inputs[0]);\r\n            const promise = result.result.then((set) => {\r\n              const el = i18n('MessageContainsEmojiPack', [wrapEmojiText(set.set.title)]);\r\n              replaceContent(emojisButton.textElement, el);\r\n            });\r\n\r\n            return result.cached ? promise : (setPadding(), undefined);\r\n          }\r\n\r\n          replaceContent(emojisButton.textElement, i18n('MessageContainsEmojiPacks', [s.size]));\r\n        };\r\n\r\n        if(docs.some((doc) => !doc)) {\r\n          setPadding();\r\n          this.managers.appEmojiManager.getCustomEmojiDocuments(docIds).then(p);\r\n        } else {\r\n          return p(docs);\r\n        }\r\n      });\r\n      // emojisButton.element.append(i18n('Loading'));\r\n    }\r\n\r\n    this.chat.container.append(element);\r\n\r\n    return {\r\n      element,\r\n      cleanup: () => {\r\n        this.cleanup();\r\n        reactionsMenu && reactionsMenu.cleanup();\r\n      },\r\n      destroy: () => {\r\n        element.remove();\r\n        reactionsMenu && reactionsMenu.widthContainer.remove();\r\n      },\r\n      menuPadding,\r\n      reactionsMenu,\r\n      reactionsMenuPosition\r\n    };\r\n  }\r\n\r\n  private onSendScheduledClick = async() => {\r\n    if(this.chat.selection.isSelecting) {\r\n      simulateClickEvent(this.chat.selection.selectionSendNowBtn);\r\n    } else {\r\n      new PopupSendNow(this.peerId, await this.chat.getMidsByMid(this.mid));\r\n    }\r\n  };\r\n\r\n  private onReplyClick = () => {\r\n    this.chat.input.initMessageReply(this.mid);\r\n  };\r\n\r\n  private onFaveStickerClick = (unfave?: boolean) => {\r\n    const docId = ((this.message as Message.message).media as MessageMedia.messageMediaDocument).document.id;\r\n    this.managers.appStickersManager.faveSticker(docId, unfave);\r\n  };\r\n\r\n  private onEditClick = () => {\r\n    this.chat.input.initMessageEditing(this.mid);\r\n  };\r\n\r\n  private onCopyClick = async() => {\r\n    if(isSelectionEmpty()) {\r\n      const mids = this.chat.selection.isSelecting ?\r\n        [...this.chat.selection.selectedMids.get(this.peerId)].sort((a, b) => a - b) :\r\n        [this.mid];\r\n\r\n      const parts: string[] = await Promise.all(mids.map(async(mid) => {\r\n        const message = (await this.chat.getMessage(mid)) as Message.message;\r\n        return message?.message ? message.message + '\\n' : '';\r\n      }));\r\n\r\n      const str = parts.join('');\r\n\r\n      copyTextToClipboard(str);\r\n    } else {\r\n      document.execCommand('copy');\r\n      // cancelSelection();\r\n    }\r\n  };\r\n\r\n  private onCopyAnchorLinkClick = () => {\r\n    copyTextToClipboard((this.target as HTMLAnchorElement).href);\r\n  };\r\n\r\n  private onCopyLinkClick = async() => {\r\n    let threadMessage: Message.message;\r\n    const {peerId, mid} = this;\r\n    const threadId = this.chat.threadId;\r\n    if(this.chat.type === 'discussion') {\r\n      threadMessage = (await this.managers.appMessagesManager.getMessageByPeer(peerId, threadId)) as Message.message;\r\n    }\r\n\r\n    const username = await this.managers.appPeersManager.getPeerUsername(threadMessage ? threadMessage.fromId : peerId);\r\n    const msgId = getServerMessageId(mid);\r\n    let url = 'https://t.me/';\r\n    let key: LangPackKey;\r\n    if(username) {\r\n      url += username + '/' + (threadMessage ? getServerMessageId(threadMessage.fwd_from.channel_post) : msgId);\r\n      if(threadMessage) url += '?comment=' + msgId;\r\n      key = 'LinkCopied';\r\n    } else {\r\n      url += 'c/' + peerId.toChatId() + '/' + msgId;\r\n      if(threadMessage) url += '?thread=' + getServerMessageId(threadMessage.mid);\r\n      key = 'LinkCopiedPrivateInfo';\r\n    }\r\n\r\n    toast(I18n.format(key, true));\r\n\r\n    copyTextToClipboard(url);\r\n  };\r\n\r\n  private onPinClick = () => {\r\n    new PopupPinMessage(this.peerId, this.mid);\r\n  };\r\n\r\n  private onUnpinClick = () => {\r\n    new PopupPinMessage(this.peerId, this.mid, true);\r\n  };\r\n\r\n  private onRetractVote = () => {\r\n    this.managers.appPollsManager.sendVote(this.message, []);\r\n  };\r\n\r\n  private onStopPoll = () => {\r\n    this.managers.appPollsManager.stopPoll(this.message);\r\n  };\r\n\r\n  private onForwardClick = async() => {\r\n    if(this.chat.selection.isSelecting) {\r\n      simulateClickEvent(this.chat.selection.selectionForwardBtn);\r\n    } else {\r\n      const peerId = this.peerId;\r\n      const mids = this.isTargetAGroupedItem ? [this.mid] : await this.chat.getMidsByMid(this.mid);\r\n      new PopupForward({\r\n        [peerId]: mids\r\n      });\r\n    }\r\n  };\r\n\r\n  private onSelectClick = () => {\r\n    this.chat.selection.toggleByElement(findUpClassName(this.target, 'grouped-item') || findUpClassName(this.target, 'bubble'));\r\n  };\r\n\r\n  private onClearSelectionClick = () => {\r\n    this.chat.selection.cancelSelection();\r\n  };\r\n\r\n  private onDeleteClick = async() => {\r\n    if(this.chat.selection.isSelecting) {\r\n      simulateClickEvent(this.chat.selection.selectionDeleteBtn);\r\n    } else {\r\n      new PopupDeleteMessages(this.peerId, this.isTargetAGroupedItem ? [this.mid] : await this.chat.getMidsByMid(this.mid), this.chat.type);\r\n    }\r\n  };\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport contextMenuController from '../../helpers/contextMenuController';\r\nimport {attachContextMenuListener} from '../../helpers/dom/attachContextMenuListener';\r\nimport cancelEvent from '../../helpers/dom/cancelEvent';\r\nimport ListenerSetter from '../../helpers/listenerSetter';\r\nimport rootScope from '../../lib/rootScope';\r\nimport ButtonMenu, {ButtonMenuItemOptions} from '../buttonMenu';\r\n\r\nexport default class SendMenu {\r\n  public sendMenu: HTMLDivElement;\r\n  private sendMenuButtons: (ButtonMenuItemOptions & {verify: () => boolean})[];\r\n  private type: 'schedule' | 'reminder';\r\n\r\n  constructor(options: {\r\n    onSilentClick: () => void,\r\n    onScheduleClick: () => void,\r\n    listenerSetter?: ListenerSetter,\r\n    openSide: string,\r\n    onContextElement: HTMLElement,\r\n    onOpen?: () => boolean\r\n  }) {\r\n    this.sendMenuButtons = [{\r\n      icon: 'mute',\r\n      text: 'Chat.Send.WithoutSound',\r\n      onClick: options.onSilentClick,\r\n      verify: () => this.type === 'schedule'\r\n    }, {\r\n      icon: 'schedule',\r\n      text: 'Chat.Send.ScheduledMessage',\r\n      onClick: options.onScheduleClick,\r\n      verify: () => this.type === 'schedule'\r\n    }, {\r\n      icon: 'schedule',\r\n      text: 'Chat.Send.SetReminder',\r\n      onClick: options.onScheduleClick,\r\n      verify: () => this.type === 'reminder'\r\n    }];\r\n\r\n    this.sendMenu = ButtonMenu(this.sendMenuButtons, options.listenerSetter);\r\n    this.sendMenu.classList.add('menu-send', options.openSide);\r\n\r\n    attachContextMenuListener(options.onContextElement, (e: any) => {\r\n      if(options.onOpen && !options.onOpen()) {\r\n        return;\r\n      }\r\n\r\n      this.sendMenuButtons.forEach((button) => {\r\n        button.element.classList.toggle('hide', !button.verify());\r\n      });\r\n\r\n      cancelEvent(e);\r\n      contextMenuController.openBtnMenu(this.sendMenu);\r\n    }, options.listenerSetter);\r\n  }\r\n\r\n  public setPeerId(peerId: PeerId) {\r\n    this.type = peerId === rootScope.myId ? 'reminder' : 'schedule';\r\n  }\r\n};\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport type Chat from '../chat/chat';\r\nimport PopupElement from '.';\r\nimport CheckboxField from '../checkboxField';\r\nimport InputField from '../inputField';\r\nimport RadioField from '../radioField';\r\nimport Scrollable from '../scrollable';\r\nimport SendContextMenu from '../chat/sendContextMenu';\r\nimport I18n, {_i18n} from '../../lib/langPack';\r\nimport findUpTag from '../../helpers/dom/findUpTag';\r\nimport cancelEvent from '../../helpers/dom/cancelEvent';\r\nimport getRichValue from '../../helpers/dom/getRichValue';\r\nimport isInputEmpty from '../../helpers/dom/isInputEmpty';\r\nimport whichChild from '../../helpers/dom/whichChild';\r\nimport {attachClickEvent} from '../../helpers/dom/clickEvent';\r\nimport {Poll} from '../../layer';\r\n\r\nconst MAX_LENGTH_QUESTION = 255;\r\nconst MAX_LENGTH_OPTION = 100;\r\nconst MAX_LENGTH_SOLUTION = 200;\r\n\r\nexport default class PopupCreatePoll extends PopupElement {\r\n  private questionInputField: InputField;\r\n  private questions: HTMLElement;\r\n  protected scrollable: Scrollable;\r\n  private tempId = 0;\r\n\r\n  private anonymousCheckboxField: CheckboxField;\r\n  private multipleCheckboxField: PopupCreatePoll['anonymousCheckboxField'];\r\n  private quizCheckboxField: PopupCreatePoll['anonymousCheckboxField'];\r\n\r\n  private correctAnswers: Uint8Array[];\r\n  private quizSolutionField: InputField;\r\n  private optionInputFields: InputField[];\r\n\r\n  constructor(private chat: Chat) {\r\n    super('popup-create-poll popup-new-media', {closable: true, withConfirm: 'Create', body: true, title: 'NewPoll'});\r\n    this.construct();\r\n  }\r\n\r\n  private async construct() {\r\n    this.questionInputField = new InputField({\r\n      placeholder: 'AskAQuestion',\r\n      label: 'AskAQuestion',\r\n      name: 'question',\r\n      maxLength: MAX_LENGTH_QUESTION\r\n    });\r\n\r\n    this.listenerSetter.add(this.questionInputField.input)('input', () => {\r\n      this.handleChange();\r\n    });\r\n\r\n    this.optionInputFields = [];\r\n\r\n    if(this.chat.type !== 'scheduled') {\r\n      const sendMenu = new SendContextMenu({\r\n        onSilentClick: () => {\r\n          this.chat.input.sendSilent = true;\r\n          this.send();\r\n        },\r\n        onScheduleClick: () => {\r\n          this.chat.input.scheduleSending(() => {\r\n            this.send();\r\n          });\r\n        },\r\n        openSide: 'bottom-left',\r\n        onContextElement: this.btnConfirm\r\n      });\r\n\r\n      sendMenu.setPeerId(this.chat.peerId);\r\n\r\n      this.header.append(sendMenu.sendMenu);\r\n    }\r\n\r\n    this.header.append(this.questionInputField.container);\r\n\r\n    const hr = document.createElement('hr');\r\n    const d = document.createElement('div');\r\n    d.classList.add('caption');\r\n    _i18n(d, 'PollOptions');\r\n\r\n    this.questions = document.createElement('form');\r\n    this.questions.classList.add('poll-create-questions');\r\n\r\n    const dd = document.createElement('div');\r\n    dd.classList.add('poll-create-settings');\r\n\r\n    const settingsCaption = document.createElement('div');\r\n    settingsCaption.classList.add('caption');\r\n    _i18n(settingsCaption, 'Settings');\r\n\r\n    if(!(await this.chat.managers.appPeersManager.isBroadcast(this.chat.peerId))) {\r\n      this.anonymousCheckboxField = new CheckboxField({\r\n        text: 'NewPoll.Anonymous',\r\n        name: 'anonymous'\r\n      });\r\n      this.anonymousCheckboxField.input.checked = true;\r\n      dd.append(this.anonymousCheckboxField.label);\r\n    }\r\n\r\n    this.multipleCheckboxField = new CheckboxField({\r\n      text: 'NewPoll.MultipleChoice',\r\n      name: 'multiple'\r\n    });\r\n    this.quizCheckboxField = new CheckboxField({\r\n      text: 'NewPoll.Quiz',\r\n      name: 'quiz'\r\n    });\r\n\r\n    this.listenerSetter.add(this.multipleCheckboxField.input)('change', () => {\r\n      const checked = this.multipleCheckboxField.input.checked;\r\n      this.quizCheckboxField.input.toggleAttribute('disabled', checked);\r\n    });\r\n\r\n    this.listenerSetter.add(this.quizCheckboxField.input)('change', () => {\r\n      const checked = this.quizCheckboxField.input.checked;\r\n\r\n      (Array.from(this.questions.children) as HTMLElement[]).map((el) => {\r\n        el.classList.toggle('radio-field', checked);\r\n      });\r\n\r\n      if(!checked) {\r\n        this.correctAnswers = undefined;\r\n        this.quizSolutionField.setValueSilently('');\r\n      }\r\n\r\n      quizElements.forEach((el) => el.classList.toggle('hide', !checked));\r\n\r\n      this.multipleCheckboxField.input.toggleAttribute('disabled', checked);\r\n      this.handleChange();\r\n    });\r\n\r\n    dd.append(this.multipleCheckboxField.label, this.quizCheckboxField.label);\r\n\r\n    const quizElements: HTMLElement[] = [];\r\n\r\n    const quizSolutionCaption = document.createElement('div');\r\n    quizSolutionCaption.classList.add('caption');\r\n    _i18n(quizSolutionCaption, 'AccDescrQuizExplanation');\r\n\r\n    const quizHr = document.createElement('hr');\r\n\r\n    const quizSolutionContainer = document.createElement('div');\r\n    quizSolutionContainer.classList.add('poll-create-questions');\r\n\r\n    this.quizSolutionField = new InputField({\r\n      placeholder: 'NewPoll.Explanation.Placeholder',\r\n      label: 'NewPoll.Explanation.Placeholder',\r\n      name: 'solution',\r\n      maxLength: MAX_LENGTH_SOLUTION\r\n    });\r\n\r\n    this.listenerSetter.add(this.questionInputField.input)('input', () => {\r\n      this.handleChange();\r\n    });\r\n\r\n    const quizSolutionSubtitle = document.createElement('div');\r\n    quizSolutionSubtitle.classList.add('subtitle');\r\n    _i18n(quizSolutionSubtitle, 'AddAnExplanationInfo');\r\n\r\n    quizSolutionContainer.append(this.quizSolutionField.container, quizSolutionSubtitle);\r\n\r\n    quizElements.push(quizHr, quizSolutionCaption, quizSolutionContainer);\r\n    quizElements.forEach((el) => el.classList.add('hide'));\r\n\r\n    this.body.parentElement.insertBefore(hr, this.body);\r\n    this.body.append(d, this.questions, document.createElement('hr'), settingsCaption, dd, ...quizElements);\r\n\r\n    attachClickEvent(this.btnConfirm, this.onSubmitClick, {listenerSetter: this.listenerSetter});\r\n\r\n    this.scrollable = new Scrollable(this.body);\r\n    this.appendMoreField();\r\n\r\n    this.onEscape = () => {\r\n      return !this.getFilledAnswers().length;\r\n    };\r\n\r\n    this.handleChange();\r\n  }\r\n\r\n  private getFilledAnswers() {\r\n    const answers = Array.from(this.questions.children).map((el, idx) => {\r\n      const input = el.querySelector('.input-field-input') as HTMLElement;\r\n      return input instanceof HTMLInputElement ? input.value : getRichValue(input, false).value;\r\n    }).filter((v) => !!v.trim());\r\n\r\n    return answers;\r\n  }\r\n\r\n  private onSubmitClick = () => {\r\n    this.send();\r\n  };\r\n\r\n  private validate() {\r\n    const question = this.questionInputField.value;\r\n    if(!question) {\r\n      return false;\r\n    }\r\n\r\n    if(question.length > MAX_LENGTH_QUESTION) {\r\n      return false;\r\n    }\r\n\r\n    if(this.quizCheckboxField.input.checked && !this.correctAnswers?.length) {\r\n      return false;\r\n    }\r\n\r\n    const answers = this.getFilledAnswers();\r\n    if(answers.length < 2) {\r\n      return false;\r\n    }\r\n\r\n    const tooLongOption = answers.find((a) => a.length > MAX_LENGTH_OPTION);\r\n    if(tooLongOption) {\r\n      return false;\r\n    }\r\n\r\n    const {value: quizSolution} = getRichValue(this.quizSolutionField.input, false);\r\n    if(quizSolution.length > MAX_LENGTH_SOLUTION) {\r\n      return false;\r\n    }\r\n\r\n    return true;\r\n  }\r\n\r\n  private handleChange() {\r\n    const valid = this.validate();\r\n    this.btnConfirm.toggleAttribute('disabled', !valid);\r\n  }\r\n\r\n  public async send(force = false) {\r\n    const question = this.questionInputField.value;\r\n\r\n    const answers = this.getFilledAnswers();\r\n\r\n    const {value: quizSolution, entities: quizSolutionEntities} = getRichValue(this.quizSolutionField.input);\r\n\r\n    if(this.chat.type === 'scheduled' && !force) {\r\n      this.chat.input.scheduleSending(() => {\r\n        this.send(true);\r\n      });\r\n\r\n      return;\r\n    }\r\n\r\n    this.hide();\r\n\r\n    // const randomID = [nextRandomInt(0xFFFFFFFF), nextRandomInt(0xFFFFFFFF)];\r\n    // const randomIDS = bigint(randomID[0]).shiftLeft(32).add(bigint(randomID[1])).toString();\r\n\r\n    const pFlags: Poll['pFlags'] = {};\r\n\r\n    if(this.anonymousCheckboxField && !this.anonymousCheckboxField.input.checked) {\r\n      pFlags.public_voters = true;\r\n    }\r\n\r\n    if(this.multipleCheckboxField.input.checked) {\r\n      pFlags.multiple_choice = true;\r\n    }\r\n\r\n    if(this.quizCheckboxField.input.checked) {\r\n      pFlags.quiz = true;\r\n    }\r\n\r\n    const poll: Poll = {\r\n      _: 'poll',\r\n      pFlags,\r\n      question,\r\n      answers: answers.map((value, idx) => {\r\n        return {\r\n          _: 'pollAnswer',\r\n          text: value,\r\n          option: new Uint8Array([idx])\r\n        };\r\n      }),\r\n      id: undefined\r\n    };\r\n    // poll.id = randomIDS;\r\n\r\n    const inputMediaPoll = await this.chat.managers.appPollsManager.getInputMediaPoll(poll, this.correctAnswers, quizSolution, quizSolutionEntities);\r\n\r\n    // console.log('Will try to create poll:', inputMediaPoll);\r\n\r\n    this.chat.managers.appMessagesManager.sendOther(this.chat.peerId, inputMediaPoll, {\r\n      ...this.chat.getMessageSendingParams()\r\n    });\r\n\r\n    if(this.chat.input.helperType === 'reply') {\r\n      this.chat.input.clearHelper();\r\n    }\r\n\r\n    this.chat.input.onMessageSent(false, false);\r\n  }\r\n\r\n  onInput = (e: Event) => {\r\n    const target = e.target as HTMLInputElement;\r\n\r\n    const radioLabel = findUpTag(target, 'LABEL');\r\n    const isEmpty = isInputEmpty(target);\r\n    if(!isEmpty) {\r\n      target.parentElement.classList.add('is-filled');\r\n      radioLabel.classList.remove('hidden-widget');\r\n      radioLabel.firstElementChild.removeAttribute('disabled');\r\n    }\r\n\r\n    const isLast = !radioLabel.nextElementSibling;\r\n    if(isLast && !isEmpty && this.questions.childElementCount < 10) {\r\n      this.appendMoreField();\r\n    }\r\n\r\n    this.handleChange();\r\n  };\r\n\r\n  onDeleteClick = (e: MouseEvent) => {\r\n    const target = e.target as HTMLSpanElement;\r\n    const label = findUpTag(target, 'LABEL');\r\n    const idx = whichChild(label);\r\n\r\n    if(this.correctAnswers && this.correctAnswers[0][0] === idx) {\r\n      this.correctAnswers = undefined;\r\n    }\r\n\r\n    label.remove();\r\n    this.optionInputFields.splice(idx, 1);\r\n\r\n    this.optionInputFields.forEach((inputField, idx) => {\r\n      inputField.options.labelOptions.length = 0;\r\n      inputField.options.labelOptions.push(idx + 1);\r\n      const i18nElement = I18n.weakMap.get(inputField.label.firstElementChild as HTMLElement);\r\n      i18nElement.update();\r\n    });\r\n\r\n    this.handleChange();\r\n  };\r\n\r\n  private appendMoreField() {\r\n    const tempId = this.tempId++;\r\n    const idx = this.questions.childElementCount + 1;\r\n    const questionField = new InputField({\r\n      placeholder: 'NewPoll.OptionsAddOption',\r\n      label: 'NewPoll.OptionLabel',\r\n      labelOptions: [idx],\r\n      name: 'question-' + tempId,\r\n      maxLength: MAX_LENGTH_OPTION\r\n    });\r\n    this.listenerSetter.add(questionField.input)('input', this.onInput);\r\n\r\n    const radioField = new RadioField({\r\n      text: '',\r\n      name: 'question'\r\n    });\r\n    radioField.main.append(questionField.container);\r\n    attachClickEvent(questionField.input, cancelEvent, {listenerSetter: this.listenerSetter});\r\n    radioField.label.classList.add('hidden-widget');\r\n    radioField.input.disabled = true;\r\n    if(!this.quizCheckboxField.input.checked) {\r\n      radioField.label.classList.remove('radio-field');\r\n    }\r\n    this.listenerSetter.add(radioField.input)('change', () => {\r\n      const checked = radioField.input.checked;\r\n      if(checked) {\r\n        const idx = whichChild(radioField.label);\r\n        this.correctAnswers = [new Uint8Array([idx])];\r\n        this.handleChange();\r\n      }\r\n    });\r\n\r\n    const deleteBtn = document.createElement('span');\r\n    deleteBtn.classList.add('btn-icon', 'tgico-close');\r\n    questionField.container.append(deleteBtn);\r\n\r\n    attachClickEvent(deleteBtn, this.onDeleteClick, {listenerSetter: this.listenerSetter, once: true});\r\n\r\n    this.questions.append(radioField.label);\r\n\r\n    this.scrollable.scrollIntoViewNew({\r\n      element: this.questions.lastElementChild as HTMLElement,\r\n      position: 'center'\r\n    });\r\n    // this.scrollable.scrollTo(this.scrollable.scrollHeight, 'top', true, true);\r\n\r\n    this.optionInputFields.push(questionField);\r\n  }\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport pause from './schedulers/pause';\r\nimport {makeMediaSize} from './mediaSize';\r\nimport scaleMediaElement from './canvas/scaleMediaElement';\r\nimport preloadVideo from './preloadVideo';\r\n\r\nexport function createPosterFromMedia(media: HTMLVideoElement | HTMLImageElement) {\r\n  let width: number, height: number;\r\n  if(media instanceof HTMLVideoElement) {\r\n    width = media.videoWidth;\r\n    height = media.videoHeight;\r\n  } else {\r\n    width = media.naturalWidth;\r\n    height = media.naturalHeight;\r\n  }\r\n\r\n  return scaleMediaElement({\r\n    media,\r\n    mediaSize: makeMediaSize(width, height),\r\n    boxSize: makeMediaSize(320, 240),\r\n    quality: .9\r\n  });\r\n}\r\n\r\nexport function createPosterFromVideo(video: HTMLVideoElement): ReturnType<typeof scaleMediaElement> {\r\n  return new Promise((resolve, reject) => {\r\n    video.onseeked = () => {\r\n      video.onseeked = () => {\r\n        createPosterFromMedia(video).then(resolve);\r\n\r\n        video.onseeked = undefined;\r\n      };\r\n\r\n      video.currentTime = 0;\r\n    };\r\n\r\n    video.onerror = reject;\r\n    video.currentTime = Math.min(video.duration, 1);\r\n  });\r\n}\r\n\r\nexport async function createPosterForVideo(url: string) {\r\n  const video = await preloadVideo(url);\r\n\r\n  return Promise.race([\r\n    pause(2000) as Promise<undefined>,\r\n    createPosterFromVideo(video)\r\n  ]);\r\n}\r\n\r\n\r\n","/**\n * @returns duration in ms\n */\nexport default function getGifDuration(image: HTMLImageElement) {\n  const src = image.src;\n\n  return fetch(src)\n  .then((response) => response.arrayBuffer())\n  .then((arrayBuffer) => {\n    const d = new Uint8Array(arrayBuffer);\n    // Thanks to http://justinsomnia.org/2006/10/gif-animation-duration-calculation/\n    // And http://www.w3.org/Graphics/GIF/spec-gif89a.txt\n    let duration = 0;\n    for(let i = 0, length = d.length; i < length; ++i) {\n      // Find a Graphic Control Extension hex(21F904__ ____ __00)\n      if(d[i] == 0x21 &&\n       d[i + 1] == 0xF9 &&\n       d[i + 2] == 0x04 &&\n       d[i + 7] == 0x00) {\n        // Swap 5th and 6th bytes to get the delay per frame\n        const delay = (d[i + 5] << 8) | (d[i + 4] & 0xFF);\n\n        // Should be aware browsers have a minimum frame delay\n        // e.g. 6ms for IE, 2ms modern browsers (50fps)\n        duration += delay < 2 ? 10 : delay;\n      }\n    }\n\n    return duration / 1000;\n  });\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport type Chat from '../chat/chat';\nimport InputField from '../inputField';\nimport PopupElement from '.';\nimport Scrollable from '../scrollable';\nimport {toast} from '../toast';\nimport {wrapDocument} from '../wrappers';\nimport CheckboxField from '../checkboxField';\nimport SendContextMenu from '../chat/sendContextMenu';\nimport {createPosterFromMedia, createPosterFromVideo} from '../../helpers/createPoster';\nimport {MyDocument} from '../../lib/appManagers/appDocsManager';\nimport I18n, {FormatterArguments, i18n, LangPackKey} from '../../lib/langPack';\nimport calcImageInBox from '../../helpers/calcImageInBox';\nimport placeCaretAtEnd from '../../helpers/dom/placeCaretAtEnd';\nimport {attachClickEvent} from '../../helpers/dom/clickEvent';\nimport MEDIA_MIME_TYPES_SUPPORTED from '../../environment/mediaMimeTypesSupport';\nimport getGifDuration from '../../helpers/getGifDuration';\nimport replaceContent from '../../helpers/dom/replaceContent';\nimport createVideo from '../../helpers/dom/createVideo';\nimport prepareAlbum from '../prepareAlbum';\nimport {MediaSize} from '../../helpers/mediaSize';\nimport {ThumbCache} from '../../lib/storages/thumbs';\nimport onMediaLoad from '../../helpers/onMediaLoad';\nimport apiManagerProxy from '../../lib/mtproto/mtprotoworker';\nimport {THUMB_TYPE_FULL} from '../../lib/mtproto/mtproto_config';\n\ntype SendFileParams = Partial<{\n  file: File,\n  objectURL: string,\n  thumb: {\n    blob: Blob,\n    url: string,\n    size: MediaSize\n  },\n  width: number,\n  height: number,\n  duration: number,\n  noSound: boolean,\n  itemDiv: HTMLElement\n}>;\n\nlet currentPopup: PopupNewMedia;\n\nexport function getCurrentNewMediaPopup() {\n  return currentPopup;\n}\n\nexport default class PopupNewMedia extends PopupElement {\n  private input: HTMLElement;\n  private mediaContainer: HTMLElement;\n  private groupCheckboxField: CheckboxField;\n  private mediaCheckboxField: CheckboxField;\n  private wasInputValue: string;\n\n  private willAttach: Partial<{\n    type: 'media' | 'document',\n    isMedia: true,\n    group: boolean,\n    sendFileDetails: SendFileParams[]\n  }>;\n  private inputField: InputField;\n  private captionLengthMax: number;\n\n  constructor(private chat: Chat, private files: File[], willAttachType: PopupNewMedia['willAttach']['type']) {\n    super('popup-send-photo popup-new-media', {closable: true, withConfirm: 'Modal.Send', confirmShortcutIsSendShortcut: true, body: true, title: true});\n    this.construct(willAttachType);\n  }\n\n  private async construct(willAttachType: PopupNewMedia['willAttach']['type']) {\n    this.willAttach = {\n      type: willAttachType,\n      sendFileDetails: [],\n      group: false\n    };\n\n    const config = await this.managers.apiManager.getConfig();\n    this.captionLengthMax = config.caption_length_max;\n\n    attachClickEvent(this.btnConfirm, () => this.send(), {listenerSetter: this.listenerSetter});\n\n    if(this.chat.type !== 'scheduled') {\n      const sendMenu = new SendContextMenu({\n        onSilentClick: () => {\n          this.chat.input.sendSilent = true;\n          this.send();\n        },\n        onScheduleClick: () => {\n          this.chat.input.scheduleSending(() => {\n            this.send();\n          });\n        },\n        openSide: 'bottom-left',\n        onContextElement: this.btnConfirm,\n        listenerSetter: this.listenerSetter\n      });\n\n      sendMenu.setPeerId(this.chat.peerId);\n\n      this.header.append(sendMenu.sendMenu);\n    }\n\n    this.mediaContainer = document.createElement('div');\n    this.mediaContainer.classList.add('popup-photo');\n    const scrollable = new Scrollable(null);\n    scrollable.container.append(this.mediaContainer);\n\n    this.inputField = new InputField({\n      placeholder: 'PreviewSender.CaptionPlaceholder',\n      label: 'Caption',\n      name: 'photo-caption',\n      maxLength: this.captionLengthMax,\n      withLinebreaks: true\n    });\n    this.input = this.inputField.input;\n\n    this.inputField.value = this.wasInputValue = this.chat.input.messageInputField.input.innerHTML;\n    this.chat.input.messageInputField.value = '';\n\n    this.body.append(scrollable.container);\n    this.container.append(this.inputField.container);\n\n    this.attachFiles();\n\n    this.addEventListener('close', () => {\n      this.files = [];\n      currentPopup = undefined;\n    });\n\n    currentPopup = this;\n  }\n\n  public appendDrops(element: HTMLElement) {\n    this.body.append(element);\n  }\n\n  get type() {\n    return this.willAttach.type;\n  }\n\n  set type(type: PopupNewMedia['willAttach']['type']) {\n    this.willAttach.type = type;\n  }\n\n  private appendGroupCheckboxField() {\n    const good = this.files.length > 1;\n    if(good && !this.groupCheckboxField) {\n      this.groupCheckboxField = new CheckboxField({\n        text: 'PreviewSender.GroupItems',\n        name: 'group-items'\n      });\n      this.container.append(...[this.groupCheckboxField.label, this.mediaCheckboxField?.label, this.inputField.container].filter(Boolean));\n\n      this.willAttach.group = true;\n      this.groupCheckboxField.setValueSilently(this.willAttach.group);\n\n      this.listenerSetter.add(this.groupCheckboxField.input)('change', () => {\n        const checked = this.groupCheckboxField.checked;\n\n        this.willAttach.group = checked;\n\n        this.attachFiles();\n      });\n    } else if(this.groupCheckboxField) {\n      this.groupCheckboxField.label.classList.toggle('hide', !good);\n    }\n  }\n\n  private appendMediaCheckboxField() {\n    const good = !!this.files.find((file) => MEDIA_MIME_TYPES_SUPPORTED.has(file.type));\n    if(good && !this.mediaCheckboxField) {\n      this.mediaCheckboxField = new CheckboxField({\n        text: 'PreviewSender.CompressFile',\n        name: 'compress-items'\n      });\n      this.container.append(...[this.groupCheckboxField?.label, this.mediaCheckboxField.label, this.inputField.container].filter(Boolean));\n\n      this.mediaCheckboxField.setValueSilently(this.willAttach.type === 'media');\n\n      this.listenerSetter.add(this.mediaCheckboxField.input)('change', () => {\n        const checked = this.mediaCheckboxField.checked;\n\n        this.willAttach.type = checked ? 'media' : 'document';\n\n        this.attachFiles();\n      });\n    } else if(this.mediaCheckboxField) {\n      this.mediaCheckboxField.label.classList.toggle('hide', !good);\n    }\n  }\n\n  public addFiles(files: File[]) {\n    const toPush = files.filter((file) => {\n      const found = this.files.find((_file) => {\n        return _file.lastModified === file.lastModified && _file.name === file.name && _file.size === file.size;\n      });\n\n      return !found;\n    });\n\n    if(toPush.length) {\n      this.files.push(...toPush);\n      this.attachFiles();\n    }\n  }\n\n  private onKeyDown = (e: KeyboardEvent) => {\n    const target = e.target as HTMLElement;\n    if(target !== this.input) {\n      if(target.tagName === 'INPUT' || target.hasAttribute('contenteditable')) {\n        return;\n      }\n\n      this.input.focus();\n      placeCaretAtEnd(this.input);\n    }\n  };\n\n  private send(force = false) {\n    if(this.chat.type === 'scheduled' && !force) {\n      this.chat.input.scheduleSending(() => {\n        this.send(true);\n      });\n\n      return;\n    }\n\n    let caption = this.inputField.value;\n    if(caption.length > this.captionLengthMax) {\n      toast(I18n.format('Error.PreviewSender.CaptionTooLong', true));\n      return;\n    }\n\n    this.hide();\n    const willAttach = this.willAttach;\n    willAttach.isMedia = willAttach.type === 'media' ? true : undefined;\n    const {sendFileDetails, isMedia} = willAttach;\n\n    // console.log('will send files with options:', willAttach);\n\n    const {peerId, input} = this.chat;\n\n    sendFileDetails.forEach((d) => {\n      d.itemDiv = undefined;\n    });\n\n    const {length} = sendFileDetails;\n    const sendingParams = this.chat.getMessageSendingParams();\n    this.iterate((sendFileDetails) => {\n      if(caption && sendFileDetails.length !== length) {\n        this.managers.appMessagesManager.sendText(peerId, caption, {\n          ...sendingParams,\n          clearDraft: true\n        });\n\n        caption = undefined;\n      }\n\n      const w = {\n        ...willAttach,\n        sendFileDetails\n      };\n\n      this.managers.appMessagesManager.sendAlbum(peerId, w.sendFileDetails.map((d) => d.file), Object.assign({\n        ...sendingParams,\n        caption,\n        isMedia: isMedia,\n        clearDraft: true as true\n      }, w));\n\n      caption = undefined;\n    });\n\n    input.replyToMsgId = this.chat.threadId;\n    input.onMessageSent();\n  }\n\n  private async attachMedia(params: SendFileParams, itemDiv: HTMLElement) {\n    itemDiv.classList.add('popup-item-media');\n\n    const file = params.file;\n    const isVideo = file.type.startsWith('video/');\n\n    let promise: Promise<void>;\n    if(isVideo) {\n      const video = createVideo();\n      const source = document.createElement('source');\n      source.src = params.objectURL = await apiManagerProxy.invoke('createObjectURL', file);\n      video.autoplay = true;\n      video.controls = false;\n      video.muted = true;\n\n      video.addEventListener('timeupdate', () => {\n        video.pause();\n      }, {once: true});\n\n      promise = onMediaLoad(video).then(async() => {\n        params.width = video.videoWidth;\n        params.height = video.videoHeight;\n        params.duration = Math.floor(video.duration);\n\n        const audioDecodedByteCount = (video as any).webkitAudioDecodedByteCount;\n        if(audioDecodedByteCount !== undefined) {\n          params.noSound = !audioDecodedByteCount;\n        }\n\n        itemDiv.append(video);\n        const thumb = await createPosterFromVideo(video);\n        params.thumb = {\n          url: await apiManagerProxy.invoke('createObjectURL', thumb.blob),\n          ...thumb\n        };\n      });\n\n      video.append(source);\n    } else {\n      const img = new Image();\n      promise = new Promise<void>((resolve) => {\n        img.onload = () => {\n          params.width = img.naturalWidth;\n          params.height = img.naturalHeight;\n\n          itemDiv.append(img);\n\n          if(file.type === 'image/gif') {\n            params.noSound = true;\n\n            Promise.all([\n              getGifDuration(img).then((duration) => {\n                params.duration = Math.ceil(duration);\n              }),\n\n              createPosterFromMedia(img).then(async(thumb) => {\n                params.thumb = {\n                  url: await apiManagerProxy.invoke('createObjectURL', thumb.blob),\n                  ...thumb\n                };\n              })\n            ]).then(() => {\n              resolve();\n            });\n          } else {\n            resolve();\n          }\n        };\n      });\n\n      img.src = params.objectURL = await apiManagerProxy.invoke('createObjectURL', file);\n    }\n\n    return promise;\n  }\n\n  private async attachDocument(params: SendFileParams, itemDiv: HTMLElement): ReturnType<PopupNewMedia['attachMedia']> {\n    itemDiv.classList.add('popup-item-document');\n    const file = params.file;\n\n    const isPhoto = file.type.startsWith('image/');\n    const isAudio = file.type.startsWith('audio/');\n    if(isPhoto || isAudio || file.size < 20e6) {\n      params.objectURL = await apiManagerProxy.invoke('createObjectURL', file);\n    }\n\n    const doc = {\n      _: 'document',\n      file: file,\n      file_name: file.name || '',\n      size: file.size,\n      type: isPhoto ? 'photo' : 'doc'\n    } as MyDocument;\n\n    let cacheContext: ThumbCache;\n    if(params.objectURL) {\n      cacheContext = {\n        url: params.objectURL,\n        downloaded: file.size,\n        type: THUMB_TYPE_FULL\n      };\n    }\n\n    const docDiv = await wrapDocument({\n      message: {\n        _: 'message',\n        pFlags: {\n          is_outgoing: true\n        },\n        mid: 0,\n        peerId: 0,\n        media: {\n          _: 'messageMediaDocument',\n          document: doc\n        }\n      } as any,\n      cacheContext\n    });\n\n    const promise = new Promise<void>((resolve) => {\n      const finish = () => {\n        itemDiv.append(docDiv);\n        resolve();\n      };\n\n      if(isPhoto) {\n        const img = new Image();\n        img.src = params.objectURL;\n        img.onload = () => {\n          params.width = img.naturalWidth;\n          params.height = img.naturalHeight;\n\n          finish();\n        };\n\n        img.onerror = finish;\n      } else {\n        finish();\n      }\n    });\n\n    return promise;\n  }\n\n  private attachFile = (file: File) => {\n    const willAttach = this.willAttach;\n    const shouldCompress = this.shouldCompress(file.type);\n\n    const params: SendFileParams = {};\n    params.file = file;\n\n    const itemDiv = document.createElement('div');\n    itemDiv.classList.add('popup-item');\n\n    params.itemDiv = itemDiv;\n\n    const promise = shouldCompress ? this.attachMedia(params, itemDiv) : this.attachDocument(params, itemDiv);\n    willAttach.sendFileDetails.push(params);\n    return promise;\n  };\n\n  private shouldCompress(mimeType: string) {\n    return this.willAttach.type === 'media' && MEDIA_MIME_TYPES_SUPPORTED.has(mimeType);\n  }\n\n  private onRender() {\n    // show now\n    if(!this.element.classList.contains('active')) {\n      this.listenerSetter.add(document.body)('keydown', this.onKeyDown);\n      this.addEventListener('close', () => {\n        if(this.wasInputValue) {\n          this.chat.input.messageInputField.value = this.wasInputValue;\n        }\n      });\n      this.show();\n    }\n  }\n\n  private setTitle() {\n    const {willAttach, title, files} = this;\n    let key: LangPackKey;\n    const args: FormatterArguments = [];\n    if(willAttach.type === 'document') {\n      key = 'PreviewSender.SendFile';\n      args.push(files.length);\n    } else {\n      let foundPhotos = 0, foundVideos = 0, foundFiles = 0;\n      files.forEach((file) => {\n        if(file.type.startsWith('image/')) ++foundPhotos;\n        else if(file.type.startsWith('video/')) ++foundVideos;\n        else ++foundFiles;\n      });\n\n      if([foundPhotos, foundVideos, foundFiles].filter((n) => n > 0).length > 1) {\n        key = 'PreviewSender.SendFile';\n        args.push(files.length);\n      } else\n\n      /* const sum = foundPhotos + foundVideos;\n      if(sum > 1 && willAttach.group) {\n        key = 'PreviewSender.SendAlbum';\n        const albumsLength = Math.ceil(sum / 10);\n        args.push(albumsLength);\n      } else  */if(foundPhotos) {\n        key = 'PreviewSender.SendPhoto';\n        args.push(foundPhotos);\n      } else if(foundVideos) {\n        key = 'PreviewSender.SendVideo';\n        args.push(foundVideos);\n      }\n    }\n\n    replaceContent(title, i18n(key, args));\n  }\n\n  private appendMediaToContainer(div: HTMLElement, params: SendFileParams) {\n    if(this.shouldCompress(params.file.type)) {\n      const size = calcImageInBox(params.width, params.height, 380, 320);\n      div.style.width = size.width + 'px';\n      div.style.height = size.height + 'px';\n    }\n\n    this.mediaContainer.append(div);\n  }\n\n  private iterate(cb: (sendFileDetails: SendFileParams[]) => void) {\n    const {sendFileDetails} = this.willAttach;\n    if(!this.willAttach.group) {\n      sendFileDetails.forEach((p) => cb([p]));\n      return;\n    }\n\n    const length = sendFileDetails.length;\n    for(let i = 0; i < length;) {\n      const firstType = sendFileDetails[i].file.type;\n      let k = 0;\n      for(; k < 10 && i < length; ++i, ++k) {\n        const type = sendFileDetails[i].file.type;\n        if(this.shouldCompress(firstType) !== this.shouldCompress(type)) {\n          break;\n        }\n      }\n\n      cb(sendFileDetails.slice(i - k, i));\n    }\n  }\n\n  private attachFiles() {\n    const {files, willAttach, mediaContainer} = this;\n    willAttach.sendFileDetails.length = 0;\n\n    this.appendGroupCheckboxField();\n    this.appendMediaCheckboxField();\n\n    Promise.all(files.map(this.attachFile)).then(() => {\n      mediaContainer.innerHTML = '';\n\n      if(!files.length) {\n        return;\n      }\n\n      this.setTitle();\n\n      this.iterate((sendFileDetails) => {\n        if(this.shouldCompress(sendFileDetails[0].file.type) && sendFileDetails.length > 1) {\n          const albumContainer = document.createElement('div');\n          albumContainer.classList.add('popup-item-album', 'popup-item');\n          albumContainer.append(...sendFileDetails.map((s) => s.itemDiv));\n\n          prepareAlbum({\n            container: albumContainer,\n            items: sendFileDetails.map((o) => ({w: o.width, h: o.height})),\n            maxWidth: 380,\n            minWidth: 100,\n            spacing: 4\n          });\n\n          mediaContainer.append(albumContainer);\n        } else {\n          sendFileDetails.forEach((params) => {\n            this.appendMediaToContainer(params.itemDiv, params);\n          });\n        }\n      });\n    }).then(() => {\n      this.onRender();\n    });\n  }\n}\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport fastSmoothScroll from '../fastSmoothScroll';\r\nimport cancelEvent from './cancelEvent';\r\nimport {attachClickEvent, detachClickEvent} from './clickEvent';\r\nimport findUpAsChild from './findUpAsChild';\r\nimport findUpClassName from './findUpClassName';\r\n\r\ntype ArrowKey = 'ArrowUp' | 'ArrowDown' | 'ArrowLeft' | 'ArrowRight';\r\nconst HANDLE_EVENT = 'keydown';\r\nconst ACTIVE_CLASS_NAME = 'active';\r\n\r\nconst AXIS_Y_KEYS: ArrowKey[] = ['ArrowUp', 'ArrowDown'];\r\nconst AXIS_X_KEYS: ArrowKey[] = ['ArrowLeft', 'ArrowRight'];\r\n\r\nexport type ListNavigationOptions = {\r\n  list: HTMLElement,\r\n  type: 'xy' | 'x' | 'y',\r\n  onSelect: (target: Element) => void | boolean | Promise<boolean>,\r\n  once: boolean,\r\n  waitForKey?: string[]\r\n};\r\n\r\nexport default function attachListNavigation({list, type, onSelect, once, waitForKey}: ListNavigationOptions) {\r\n  let waitForKeySet = waitForKey?.length ? new Set(waitForKey) : undefined;\r\n  const keyNames = new Set(type === 'xy' ? AXIS_Y_KEYS.concat(AXIS_X_KEYS) : (type === 'x' ? AXIS_X_KEYS : AXIS_Y_KEYS));\r\n\r\n  let target: Element;\r\n  const getCurrentTarget = () => {\r\n    return target || list.querySelector('.' + ACTIVE_CLASS_NAME) || list.firstElementChild;\r\n  };\r\n\r\n  const setCurrentTarget = (_target: Element, scrollTo: boolean) => {\r\n    if(target === _target) {\r\n      return;\r\n    }\r\n\r\n    let hadTarget = false;\r\n    if(target) {\r\n      hadTarget = true;\r\n      target.classList.remove(ACTIVE_CLASS_NAME);\r\n    }\r\n\r\n    target = _target;\r\n    if(!target) return;\r\n    target.classList.add(ACTIVE_CLASS_NAME);\r\n\r\n    if(hadTarget && scrollable && scrollTo) {\r\n      fastSmoothScroll({\r\n        container: scrollable,\r\n        element: target as HTMLElement,\r\n        position: 'center',\r\n        forceDuration: 100,\r\n        axis: type === 'x' ? 'x' : 'y'\r\n      });\r\n    }\r\n  };\r\n\r\n  const getNextTargetX = (currentTarget: Element, isNext: boolean) => {\r\n    let nextTarget: Element;\r\n    if(isNext) nextTarget = currentTarget.nextElementSibling || list.firstElementChild;\r\n    else nextTarget = currentTarget.previousElementSibling || list.lastElementChild;\r\n\r\n    return nextTarget;\r\n  };\r\n\r\n  const getNextTargetY = (currentTarget: Element, isNext: boolean) => {\r\n    const property = isNext ? 'nextElementSibling' : 'previousElementSibling';\r\n    const endProperty = isNext ? 'firstElementChild' : 'lastElementChild';\r\n    const currentRect = currentTarget.getBoundingClientRect();\r\n\r\n    let nextTarget = currentTarget[property] || list[endProperty];\r\n    while(nextTarget !== currentTarget) {\r\n      const targetRect = nextTarget.getBoundingClientRect();\r\n      if(targetRect.x === currentRect.x && targetRect.y !== currentRect.y) {\r\n        break;\r\n      }\r\n\r\n      nextTarget = nextTarget[property] || list[endProperty];\r\n    }\r\n\r\n    return nextTarget;\r\n  };\r\n\r\n  let handleArrowKey: (currentTarget: Element, key: ArrowKey) => Element;\r\n  if(type === 'xy') { // flex-direction: row; flex-wrap: wrap;\r\n    handleArrowKey = (currentTarget, key) => {\r\n      if(key === 'ArrowUp' || key === 'ArrowDown') return getNextTargetY(currentTarget, key === 'ArrowDown');\r\n      else return getNextTargetX(currentTarget, key === 'ArrowRight');\r\n    };\r\n  } else { // flex-direction: row | column;\r\n    handleArrowKey = (currentTarget, key) => getNextTargetX(currentTarget, key === 'ArrowRight' || key === 'ArrowDown');\r\n  }\r\n\r\n  let onKeyDown = (e: KeyboardEvent) => {\r\n    const key = e.key;\r\n    if(!keyNames.has(key as any)) {\r\n      if(key === 'Enter' || (type !== 'xy' && key === 'Tab')) {\r\n        cancelEvent(e);\r\n        fireSelect(getCurrentTarget());\r\n      }\r\n\r\n      return;\r\n    }\r\n\r\n    cancelEvent(e);\r\n\r\n    if(list.childElementCount > 1) {\r\n      let currentTarget = getCurrentTarget();\r\n      currentTarget = handleArrowKey(currentTarget, key as any);\r\n      setCurrentTarget(currentTarget, true);\r\n    }\r\n  };\r\n\r\n  const scrollable = findUpClassName(list, 'scrollable');\r\n  list.classList.add('navigable-list');\r\n\r\n  const onMouseMove = (e: MouseEvent) => {\r\n    const target = findUpAsChild(e.target as HTMLElement, list) as HTMLElement;\r\n    if(!target) {\r\n      return;\r\n    }\r\n\r\n    setCurrentTarget(target, false);\r\n  };\r\n\r\n  const onClick = (e: Event) => {\r\n    cancelEvent(e); // cancel keyboard closening\r\n\r\n    const target = findUpAsChild(e.target as HTMLElement, list) as HTMLElement;\r\n    if(!target) {\r\n      return;\r\n    }\r\n\r\n    setCurrentTarget(target, false);\r\n    fireSelect(getCurrentTarget());\r\n  };\r\n\r\n  const fireSelect = async(target: Element) => {\r\n    const canContinue = await onSelect(target);\r\n    if(canContinue !== undefined ? !canContinue : once) {\r\n      detach();\r\n    }\r\n  };\r\n\r\n  let attached = false;\r\n  const attach = () => {\r\n    if(attached) return;\r\n    attached = true;\r\n    // const input = document.activeElement as HTMLElement;\r\n    // input.addEventListener(HANDLE_EVENT, onKeyDown, {capture: true, passive: false});\r\n    document.addEventListener(HANDLE_EVENT, onKeyDown, {capture: true, passive: false});\r\n    list.addEventListener('mousemove', onMouseMove, {passive: true});\r\n    attachClickEvent(list, onClick);\r\n  };\r\n\r\n  const detach = () => {\r\n    if(!attached) return;\r\n    attached = false;\r\n    // input.removeEventListener(HANDLE_EVENT, onKeyDown, {capture: true});\r\n    document.removeEventListener(HANDLE_EVENT, onKeyDown, {capture: true});\r\n    list.removeEventListener('mousemove', onMouseMove);\r\n    detachClickEvent(list, onClick);\r\n  };\r\n\r\n  const resetTarget = () => {\r\n    if(waitForKeySet) return;\r\n    setCurrentTarget(list.firstElementChild, false);\r\n  };\r\n\r\n  if(waitForKeySet) {\r\n    const _onKeyDown = onKeyDown;\r\n    onKeyDown = (e) => {\r\n      if(waitForKeySet.has(e.key)) {\r\n        cancelEvent(e);\r\n\r\n        document.removeEventListener(HANDLE_EVENT, onKeyDown, {capture: true});\r\n        onKeyDown = _onKeyDown;\r\n        document.addEventListener(HANDLE_EVENT, onKeyDown, {capture: true, passive: false});\r\n\r\n        waitForKeySet = undefined;\r\n        resetTarget();\r\n      }\r\n    };\r\n  } else {\r\n    resetTarget();\r\n  }\r\n\r\n  attach();\r\n\r\n  return {\r\n    attach,\r\n    detach,\r\n    resetTarget\r\n  };\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport attachListNavigation, {ListNavigationOptions} from '../../helpers/dom/attachListNavigation';\r\nimport EventListenerBase from '../../helpers/eventListenerBase';\r\nimport {IS_MOBILE} from '../../environment/userAgent';\r\nimport rootScope from '../../lib/rootScope';\r\nimport appNavigationController, {NavigationItem} from '../appNavigationController';\r\nimport SetTransition from '../singleTransition';\r\nimport AutocompleteHelperController from './autocompleteHelperController';\r\nimport safeAssign from '../../helpers/object/safeAssign';\r\n\r\nexport default class AutocompleteHelper extends EventListenerBase<{\r\n  hidden: () => void,\r\n  visible: () => void,\r\n  hiding: () => void\r\n}> {\r\n  protected hidden = true;\r\n  protected container: HTMLElement;\r\n  protected list: HTMLElement;\r\n  protected resetTarget: () => void;\r\n  protected attach: () => void;\r\n  protected detach: () => void;\r\n  protected init?(): void;\r\n\r\n  protected controller: AutocompleteHelperController;\r\n  protected listType: 'xy' | 'x' | 'y';\r\n  protected onSelect: ListNavigationOptions['onSelect'];\r\n  protected waitForKey?: string[];\r\n\r\n  protected navigationItem: NavigationItem;\r\n\r\n  constructor(options: {\r\n    appendTo: HTMLElement,\r\n    controller?: AutocompleteHelper['controller'],\r\n    listType: AutocompleteHelper['listType'],\r\n    onSelect: AutocompleteHelper['onSelect'],\r\n    waitForKey?: AutocompleteHelper['waitForKey']\r\n  }) {\r\n    super(false);\r\n\r\n    safeAssign(this, options);\r\n\r\n    this.container = document.createElement('div');\r\n    this.container.classList.add('autocomplete-helper', 'z-depth-1');\r\n\r\n    options.appendTo.append(this.container);\r\n\r\n    this.attachNavigation();\r\n\r\n    this.controller && this.controller.addHelper(this);\r\n  }\r\n\r\n  public toggleListNavigation(enabled: boolean) {\r\n    if(enabled) {\r\n      this.attach && this.attach();\r\n    } else {\r\n      this.detach && this.detach();\r\n    }\r\n  }\r\n\r\n  protected onVisible = () => {\r\n    if(this.detach) { // it can be so because 'visible' calls before animation's end\r\n      this.detach();\r\n    }\r\n\r\n    const list = this.list;\r\n    const {attach, detach, resetTarget} = attachListNavigation({\r\n      list,\r\n      type: this.listType,\r\n      onSelect: this.onSelect,\r\n      once: true,\r\n      waitForKey: this.waitForKey\r\n    });\r\n\r\n    this.attach = attach;\r\n    this.detach = detach;\r\n    this.resetTarget = resetTarget;\r\n    if(!IS_MOBILE && !this.navigationItem) {\r\n      this.navigationItem = {\r\n        type: 'autocomplete-helper',\r\n        onPop: () => {\r\n          this.navigationItem = undefined;\r\n          this.toggle(true);\r\n        },\r\n        noBlurOnPop: true\r\n      };\r\n\r\n      appNavigationController.pushItem(this.navigationItem);\r\n    }\r\n\r\n    this.addEventListener('hidden', () => {\r\n      this.resetTarget = undefined;\r\n      this.attach = undefined;\r\n      this.detach = undefined;\r\n\r\n      list.innerHTML = '';\r\n      detach();\r\n\r\n      if(this.navigationItem) {\r\n        appNavigationController.removeItem(this.navigationItem);\r\n        this.navigationItem = undefined;\r\n      }\r\n    }, {once: true});\r\n  };\r\n\r\n  protected attachNavigation() {\r\n    this.addEventListener('visible', this.onVisible);\r\n  }\r\n\r\n  public toggle(hide?: boolean, fromController = false, skipAnimation?: boolean) {\r\n    if(this.init) {\r\n      return;\r\n    }\r\n\r\n    if(hide === undefined) {\r\n      hide = this.container.classList.contains('is-visible') && !this.container.classList.contains('backwards');\r\n    }\r\n\r\n    if(this.hidden === hide) {\r\n      if(!hide) {\r\n        this.dispatchEvent('visible'); // reset target and listener\r\n      }\r\n\r\n      return;\r\n    }\r\n\r\n    this.hidden = hide;\r\n\r\n    if(!hide) {\r\n      this.controller && this.controller.hideOtherHelpers(this);\r\n      this.dispatchEvent('visible'); // fire it before so target will be set\r\n    } else {\r\n      if(this.navigationItem) {\r\n        appNavigationController.removeItem(this.navigationItem);\r\n        this.navigationItem = undefined;\r\n      }\r\n\r\n      if(!fromController && this.controller) {\r\n        this.controller.hideOtherHelpers();\r\n      }\r\n\r\n      if(this.detach) { // force detach here\r\n        this.detach();\r\n      }\r\n    }\r\n\r\n    const useRafs = this.controller || hide ? 0 : 2;\r\n\r\n    if(hide) {\r\n      this.dispatchEvent('hiding');\r\n    }\r\n\r\n    SetTransition(\r\n      this.container,\r\n      'is-visible',\r\n      !hide,\r\n      rootScope.settings.animationsEnabled && !skipAnimation ? 300 : 0,\r\n      () => {\r\n        this.hidden && this.dispatchEvent('hidden');\r\n      },\r\n      useRafs\r\n    );\r\n  }\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport ListenerSetter from '../../helpers/listenerSetter';\r\nimport mediaSizes from '../../helpers/mediaSizes';\r\nimport preloadAnimatedEmojiSticker from '../../helpers/preloadAnimatedEmojiSticker';\r\nimport {MyDocument} from '../../lib/appManagers/appDocsManager';\r\nimport {CHAT_ANIMATION_GROUP} from '../../lib/appManagers/appImManager';\r\nimport {AppManagers} from '../../lib/appManagers/managers';\r\nimport rootScope from '../../lib/rootScope';\r\nimport {EmoticonsDropdown} from '../emoticonsDropdown';\r\nimport {SuperStickerRenderer} from '../emoticonsDropdown/tabs/stickers';\r\nimport LazyLoadQueue from '../lazyLoadQueue';\r\nimport Scrollable from '../scrollable';\r\nimport attachStickerViewerListeners from '../stickerViewer';\r\nimport AutocompleteHelper from './autocompleteHelper';\r\nimport AutocompleteHelperController from './autocompleteHelperController';\r\n\r\nexport default class StickersHelper extends AutocompleteHelper {\r\n  private scrollable: Scrollable;\r\n  private superStickerRenderer: SuperStickerRenderer;\r\n  private lazyLoadQueue: LazyLoadQueue;\r\n  private onChangeScreen: () => void;\r\n  private listenerSetter: ListenerSetter;\r\n\r\n  constructor(\r\n    appendTo: HTMLElement,\r\n    controller: AutocompleteHelperController,\r\n    private managers: AppManagers\r\n  ) {\r\n    super({\r\n      appendTo,\r\n      controller,\r\n      listType: 'xy',\r\n      onSelect: async(target) => {\r\n        return !(await EmoticonsDropdown.onMediaClick({target}, true));\r\n      },\r\n      waitForKey: ['ArrowUp', 'ArrowDown']\r\n    });\r\n\r\n    this.container.classList.add('stickers-helper');\r\n\r\n    this.addEventListener('visible', () => {\r\n      setTimeout(() => { // it is not rendered yet\r\n        this.scrollable.container.scrollTop = 0;\r\n      }, 0);\r\n\r\n      rootScope.dispatchEvent('choosing_sticker', true);\r\n    });\r\n\r\n    this.addEventListener('hidden', () => {\r\n      if(this.onChangeScreen) {\r\n        mediaSizes.removeEventListener('changeScreen', this.onChangeScreen);\r\n        this.onChangeScreen = undefined;\r\n\r\n        this.listenerSetter.removeAll();\r\n        this.listenerSetter = undefined;\r\n      }\r\n\r\n      rootScope.dispatchEvent('choosing_sticker', false);\r\n    });\r\n  }\r\n\r\n  public checkEmoticon(emoticon: string) {\r\n    const middleware = this.controller.getMiddleware();\r\n\r\n    if(this.lazyLoadQueue) {\r\n      this.lazyLoadQueue.clear();\r\n    }\r\n\r\n    preloadAnimatedEmojiSticker(emoticon);\r\n    this.managers.appStickersManager.getStickersByEmoticon(emoticon)\r\n    .then((stickers) => {\r\n      if(!middleware()) {\r\n        return;\r\n      }\r\n\r\n      if(this.init) {\r\n        this.init();\r\n        this.init = null;\r\n      }\r\n\r\n      const container = this.list.cloneNode() as HTMLElement;\r\n\r\n      let ready: Promise<void>;\r\n\r\n      this.lazyLoadQueue.clear();\r\n      if(stickers.length) {\r\n        ready = new Promise<void>((resolve) => {\r\n          const promises: Promise<any>[] = [];\r\n          stickers.forEach((sticker) => {\r\n            container.append(this.superStickerRenderer.renderSticker(sticker as MyDocument, undefined, promises));\r\n          });\r\n\r\n          (Promise.all(promises) as Promise<any>).finally(resolve);\r\n        });\r\n      } else {\r\n        ready = Promise.resolve();\r\n      }\r\n\r\n      ready.then(() => {\r\n        this.list.replaceWith(container);\r\n        this.list = container;\r\n\r\n        if(!this.onChangeScreen) {\r\n          this.onChangeScreen = () => {\r\n            const width = (this.list.childElementCount * mediaSizes.active.esgSticker.width) + (this.list.childElementCount - 1 * 1);\r\n            this.list.style.width = width + 'px';\r\n          };\r\n          mediaSizes.addEventListener('changeScreen', this.onChangeScreen);\r\n\r\n          this.listenerSetter = new ListenerSetter();\r\n          attachStickerViewerListeners({listenTo: this.container, listenerSetter: this.listenerSetter});\r\n        }\r\n\r\n        this.onChangeScreen();\r\n\r\n        this.toggle(!stickers.length);\r\n        this.scrollable.scrollTop = 0;\r\n      });\r\n    });\r\n  }\r\n\r\n  protected init() {\r\n    this.list = document.createElement('div');\r\n    this.list.classList.add('stickers-helper-stickers', 'super-stickers');\r\n\r\n    this.container.append(this.list);\r\n\r\n    this.scrollable = new Scrollable(this.container);\r\n    this.lazyLoadQueue = new LazyLoadQueue();\r\n    this.superStickerRenderer = new SuperStickerRenderer(this.lazyLoadQueue, CHAT_ANIMATION_GROUP, this.managers);\r\n  }\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport {attachClickEvent} from '../../helpers/dom/clickEvent';\r\nimport {SEND_WHEN_ONLINE_TIMESTAMP} from '../../lib/mtproto/constants';\r\nimport Button from '../button';\r\nimport PopupDatePicker from './datePicker';\r\n\r\nconst getMinDate = () => {\r\n  const date = new Date();\r\n  // date.setDate(date.getDate() - 1);\r\n  date.setHours(0, 0, 0, 0);\r\n  return date;\r\n};\r\n\r\nconst getMaxDate = () => {\r\n  const date = new Date();\r\n  date.setFullYear(date.getFullYear() + 1);\r\n  date.setDate(date.getDate() - 1);\r\n  return date;\r\n};\r\n\r\nconst checkDate = (date: Date) => {\r\n  return date.getTime() > getMaxDate().getTime() ? new Date() : date;\r\n};\r\n\r\nexport default class PopupSchedule extends PopupDatePicker {\r\n  constructor(initDate: Date, onPick: (timestamp: number) => void, canSendWhenOnline: boolean) {\r\n    super(checkDate(initDate), onPick, {\r\n      noButtons: true,\r\n      noTitle: true,\r\n      closable: true,\r\n      withConfirm: true,\r\n      minDate: getMinDate(),\r\n      maxDate: getMaxDate(),\r\n      withTime: true,\r\n      showOverflowMonths: true,\r\n      confirmShortcutIsSendShortcut: true,\r\n      title: true\r\n    });\r\n\r\n    this.element.classList.add('popup-schedule');\r\n    this.header.append(this.controlsDiv);\r\n    this.title.replaceWith(this.monthTitle);\r\n    this.body.append(this.btnConfirm);\r\n\r\n    if(canSendWhenOnline) {\r\n      const btnSendWhenOnline = Button('btn-primary btn-secondary btn-primary-transparent primary', {text: 'Schedule.SendWhenOnline'});\r\n      this.body.append(btnSendWhenOnline);\r\n\r\n      attachClickEvent(btnSendWhenOnline, () => {\r\n        onPick(SEND_WHEN_ONLINE_TIMESTAMP);\r\n        this.hide();\r\n      });\r\n    }\r\n  }\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n *\r\n * Originally from:\r\n * https://github.com/zhukov/webogram\r\n * Copyright (C) 2014 Igor Zhukov <igor.beatle@gmail.com>\r\n * https://github.com/zhukov/webogram/blob/master/LICENSE\r\n */\r\n\r\nimport {MessageEntity} from '../../layer';\r\nimport combineSameEntities from '../../lib/richTextProcessor/combineSameEntities';\r\nimport getRichElementValue from './getRichElementValue';\r\n\r\nexport default function getRichValueWithCaret(field: HTMLElement, withEntities = true) {\r\n  const lines: string[] = [];\r\n  const line: string[] = [];\r\n\r\n  const sel = window.getSelection();\r\n  let selNode: Node;\r\n  let selOffset: number;\r\n  if(sel && sel.rangeCount) {\r\n    const range = sel.getRangeAt(0);\r\n    const startOffset = range.startOffset;\r\n    if(\r\n      range.startContainer &&\r\n      range.startContainer == range.endContainer &&\r\n      startOffset == range.endOffset\r\n    ) {\r\n      // * if focused on img, or caret has been set via placeCaretAtEnd\r\n      const possibleChildrenFocusOffset = startOffset - 1;\r\n      const childNodes = field.childNodes;\r\n      if(range.startContainer === field && childNodes[possibleChildrenFocusOffset]) {\r\n        selNode = childNodes[possibleChildrenFocusOffset];\r\n        selOffset = 0;\r\n\r\n        for(let i = 0; i < range.endOffset; ++i) {\r\n          const node = childNodes[i];\r\n          const value = node.nodeValue || (node as HTMLImageElement).alt;\r\n\r\n          if(value) {\r\n            selOffset += value.length;\r\n          }\r\n        }\r\n      } else {\r\n        selNode = range.startContainer;\r\n        selOffset = startOffset;\r\n      }\r\n    }\r\n  }\r\n\r\n  const entities: MessageEntity[] = withEntities ? [] : undefined;\r\n  getRichElementValue(field, lines, line, selNode, selOffset, entities);\r\n\r\n  if(line.length) {\r\n    lines.push(line.join(''));\r\n  }\r\n\r\n  let value = lines.join('\\n');\r\n  const caretPos = value.indexOf('\\x01');\r\n  if(caretPos != -1) {\r\n    value = value.substr(0, caretPos) + value.substr(caretPos + 1);\r\n  }\r\n  value = value.replace(/\\u00A0/g, ' ');\r\n\r\n  if(entities) {\r\n    combineSameEntities(entities);\r\n  }\r\n\r\n  return {value, entities, caretPos};\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport type ChatInput from './input';\r\nimport {appendEmoji, getEmojiFromElement} from '../emoticonsDropdown/tabs/emoji';\r\nimport {ScrollableX} from '../scrollable';\r\nimport AutocompleteHelper from './autocompleteHelper';\r\nimport AutocompleteHelperController from './autocompleteHelperController';\r\nimport {AppManagers} from '../../lib/appManagers/managers';\r\n\r\nexport default class EmojiHelper extends AutocompleteHelper {\r\n  private scrollable: ScrollableX;\r\n\r\n  constructor(\r\n    appendTo: HTMLElement,\r\n    controller: AutocompleteHelperController,\r\n    chatInput: ChatInput,\r\n    private managers: AppManagers\r\n  ) {\r\n    super({\r\n      appendTo,\r\n      controller,\r\n      listType: 'x',\r\n      onSelect: (target) => {\r\n        chatInput.onEmojiSelected(getEmojiFromElement(target as any), true);\r\n      }\r\n    });\r\n\r\n    this.container.classList.add('emoji-helper');\r\n  }\r\n\r\n  protected init() {\r\n    this.list = document.createElement('div');\r\n    this.list.classList.add('emoji-helper-emojis', 'super-emojis');\r\n\r\n    this.container.append(this.list);\r\n\r\n    this.scrollable = new ScrollableX(this.container);\r\n\r\n    this.addEventListener('visible', () => {\r\n      setTimeout(() => { // it is not rendered yet\r\n        this.scrollable.container.scrollLeft = 0;\r\n      }, 0);\r\n    });\r\n  }\r\n\r\n  public render(emojis: string[], waitForKey: boolean) {\r\n    if(this.init) {\r\n      if(!emojis.length) {\r\n        return;\r\n      }\r\n\r\n      this.init();\r\n      this.init = null;\r\n    }\r\n\r\n    emojis = emojis.slice(0, 80);\r\n\r\n    if(emojis.length) {\r\n      this.list.innerHTML = '';\r\n      emojis.forEach((emoji) => {\r\n        appendEmoji(emoji, this.list, false, true);\r\n      });\r\n    }\r\n\r\n    this.waitForKey = waitForKey ? ['ArrowUp', 'ArrowDown'] : undefined;\r\n    this.toggle(!emojis.length);\r\n\r\n    /* window.requestAnimationFrame(() => {\r\n      this.container.style.width = (3 * 2) + (emojis.length * 44) + 'px';\r\n    }); */\r\n  }\r\n\r\n  public checkQuery(query: string, firstChar: string) {\r\n    const middleware = this.controller.getMiddleware();\r\n    this.managers.appEmojiManager.getBothEmojiKeywords().then(async() => {\r\n      if(!middleware()) {\r\n        return;\r\n      }\r\n\r\n      const q = query.replace(/^:/, '');\r\n      const emojis = await this.managers.appEmojiManager.searchEmojis(q);\r\n      if(!middleware()) {\r\n        return;\r\n      }\r\n\r\n      this.render(emojis, firstChar !== ':');\r\n      // console.log(emojis);\r\n    });\r\n  }\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport setInnerHTML from '../../helpers/dom/setInnerHTML';\r\nimport wrapEmojiText from '../../lib/richTextProcessor/wrapEmojiText';\r\nimport AvatarElement from '../avatar';\r\nimport PeerTitle from '../peerTitle';\r\nimport Scrollable from '../scrollable';\r\nimport AutocompleteHelper from './autocompleteHelper';\r\nimport AutocompleteHelperController from './autocompleteHelperController';\r\n\r\nexport default class AutocompletePeerHelper extends AutocompleteHelper {\r\n  protected static BASE_CLASS = 'autocomplete-peer-helper';\r\n  protected static BASE_CLASS_LIST_ELEMENT = AutocompletePeerHelper.BASE_CLASS + '-list-element';\r\n  private scrollable: Scrollable;\r\n\r\n  constructor(\r\n    appendTo: HTMLElement,\r\n    controller: AutocompleteHelperController,\r\n    protected className: string,\r\n    onSelect: (target: Element) => boolean | void\r\n  ) {\r\n    super({\r\n      appendTo,\r\n      controller,\r\n      listType: 'y',\r\n      onSelect\r\n    });\r\n\r\n    this.container.classList.add(AutocompletePeerHelper.BASE_CLASS, className);\r\n  }\r\n\r\n  protected init() {\r\n    this.list = document.createElement('div');\r\n    this.list.classList.add(AutocompletePeerHelper.BASE_CLASS + '-list', this.className + '-list');\r\n\r\n    this.container.append(this.list);\r\n\r\n    this.scrollable = new Scrollable(this.container);\r\n\r\n    this.addEventListener('visible', () => {\r\n      setTimeout(() => { // it is not rendered yet\r\n        this.scrollable.container.scrollTop = 0;\r\n      }, 0);\r\n    });\r\n  }\r\n\r\n  public render(data: {peerId: PeerId, name?: string, description?: string}[], doNotShow?: boolean) {\r\n    if(this.init) {\r\n      if(!data.length) {\r\n        return;\r\n      }\r\n\r\n      this.init();\r\n      this.init = null;\r\n    }\r\n\r\n    if(data.length) {\r\n      this.list.innerHTML = '';\r\n      data.forEach((d) => {\r\n        const div = AutocompletePeerHelper.listElement({\r\n          className: this.className,\r\n          peerId: d.peerId,\r\n          name: d.name,\r\n          description: d.description\r\n        });\r\n\r\n        this.list.append(div);\r\n      });\r\n    }\r\n\r\n    if(!doNotShow) {\r\n      this.toggle(!data.length);\r\n    }\r\n  }\r\n\r\n  public static listElement(options: {\r\n    className: string,\r\n    peerId: PeerId,\r\n    name?: string,\r\n    description?: string\r\n  }) {\r\n    const BASE = AutocompletePeerHelper.BASE_CLASS_LIST_ELEMENT;\r\n    options.className += '-list-element';\r\n\r\n    const div = document.createElement('div');\r\n    div.classList.add(BASE, options.className);\r\n    div.dataset.peerId = '' + options.peerId;\r\n\r\n    const avatar = new AvatarElement();\r\n    avatar.classList.add('avatar-30', BASE + '-avatar', options.className + '-avatar');\r\n    avatar.updateWithOptions({\r\n      isDialog: false,\r\n      peerId: options.peerId\r\n    });\r\n\r\n    const name = document.createElement('div');\r\n    name.classList.add(BASE + '-name', options.className + '-name');\r\n    if(!options.name) {\r\n      name.append(new PeerTitle({\r\n        peerId: options.peerId,\r\n        dialog: false,\r\n        onlyFirstName: false,\r\n        plainText: false\r\n      }).element);\r\n    } else {\r\n      setInnerHTML(name, wrapEmojiText(options.name));\r\n    }\r\n\r\n    div.append(avatar, name);\r\n\r\n    if(options.description) {\r\n      const description = document.createElement('div');\r\n      description.classList.add(BASE + '-description', options.className + '-description');\r\n      setInnerHTML(description, wrapEmojiText(options.description));\r\n      div.append(description);\r\n    }\r\n\r\n    return div;\r\n  }\r\n}\r\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport type ChatInput from './input';\nimport type {BotInfo, ChatFull, UserFull} from '../../layer';\nimport AutocompleteHelperController from './autocompleteHelperController';\nimport AutocompletePeerHelper from './autocompletePeerHelper';\nimport SearchIndex from '../../lib/searchIndex';\nimport {AppManagers} from '../../lib/appManagers/managers';\n\nexport function processPeerFullForCommands(peerId: PeerId, full: ChatFull.chatFull | ChatFull.channelFull | UserFull.userFull, query?: string) {\n  const botInfos: BotInfo.botInfo[] = [].concat(full.bot_info);\n  let index: SearchIndex<string>;\n\n  if(query !== undefined) {\n    index = new SearchIndex<string>({\n      ignoreCase: true\n    });\n  }\n\n  type T = {peerId: PeerId, name: string, description: string, index: number, command: string};\n  const commands: Map<string, T> = new Map();\n  botInfos.forEach((botInfo) => {\n    if(!botInfo.commands) {\n      return;\n    }\n\n    botInfo.commands.forEach(({command, description}, idx) => {\n      const c = '/' + command;\n      commands.set(command, {\n        peerId: botInfo.user_id ? botInfo.user_id.toPeerId(false) : peerId,\n        command: command,\n        name: c,\n        description: description,\n        index: idx\n      });\n\n      if(index) {\n        index.indexObject(command, c);\n      }\n    });\n  });\n\n  let out: T[];\n  if(!index) {\n    out = [...commands.values()];\n  } else {\n    const found = index.search(query);\n    out = Array.from(found).map((command) => commands.get(command));\n  }\n\n  out = out.sort((a, b) => commands.get(a.command).index - commands.get(b.command).index);\n\n  return out;\n}\n\nexport default class CommandsHelper extends AutocompletePeerHelper {\n  constructor(\n    appendTo: HTMLElement,\n    controller: AutocompleteHelperController,\n    chatInput: ChatInput,\n    private managers: AppManagers\n  ) {\n    super(appendTo,\n      controller,\n      'commands-helper',\n      (target) => {\n        const innerHTML = target.querySelector(`.${AutocompletePeerHelper.BASE_CLASS_LIST_ELEMENT}-name`).innerHTML;\n        return chatInput.getReadyToSend(() => {\n          chatInput.messageInput.innerHTML = innerHTML;\n          chatInput.sendMessage(true);\n        });\n      }\n    );\n  }\n\n  public async checkQuery(query: string, peerId: PeerId) {\n    if(!(await this.managers.appUsersManager.isBot(peerId))) {\n      return false;\n    }\n\n    const middleware = this.controller.getMiddleware();\n    this.managers.appProfileManager.getProfileByPeerId(peerId).then((full) => {\n      if(!middleware()) {\n        return;\n      }\n\n      const filtered = processPeerFullForCommands(peerId, full, query);\n      this.render(filtered);\n      // console.log('found commands', found, filtered);\n    });\n\n    return true;\n  }\n}\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport {getMiddleware} from '../../helpers/middleware';\r\nimport AutocompleteHelper from './autocompleteHelper';\r\n\r\nexport default class AutocompleteHelperController {\r\n  private helpers: Set<AutocompleteHelper> = new Set();\r\n  private middleware = getMiddleware();\r\n  /* private tempId = 0;\r\n\r\n  public incrementToggleCount() {\r\n    return ++this.tempId;\r\n  }\r\n\r\n  public getToggleCount() {\r\n    return this.tempId;\r\n  } */\r\n\r\n  public toggleListNavigation(enabled: boolean) {\r\n    for(const helper of this.helpers) {\r\n      helper.toggleListNavigation(enabled);\r\n    }\r\n  }\r\n\r\n  public getMiddleware() {\r\n    this.middleware.clean();\r\n    return this.middleware.get();\r\n  }\r\n\r\n  public addHelper(helper: AutocompleteHelper) {\r\n    this.helpers.add(helper);\r\n  }\r\n\r\n  public hideOtherHelpers(preserveHelper?: AutocompleteHelper) {\r\n    this.helpers.forEach((helper) => {\r\n      if(helper !== preserveHelper) {\r\n        helper.toggle(true, true);\r\n      }\r\n    });\r\n\r\n    if(!preserveHelper) {\r\n      this.middleware.clean();\r\n    }\r\n  }\r\n}\r\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport type ChatInput from './input';\nimport type {MessageEntity} from '../../layer';\nimport AutocompleteHelperController from './autocompleteHelperController';\nimport AutocompletePeerHelper from './autocompletePeerHelper';\nimport {AppManagers} from '../../lib/appManagers/managers';\n\nexport default class MentionsHelper extends AutocompletePeerHelper {\n  constructor(\n    appendTo: HTMLElement,\n    controller: AutocompleteHelperController,\n    chatInput: ChatInput,\n    private managers: AppManagers\n  ) {\n    super(\n      appendTo,\n      controller,\n      'mentions-helper',\n      (target) => {\n        const userId = (target as HTMLElement).dataset.peerId.toUserId();\n        const user = Promise.resolve(managers.appUsersManager.getUser(userId)).then((user) => {\n          let str = '', entity: MessageEntity;\n          if(user.username) {\n            str = '@' + user.username;\n          } else {\n            str = user.first_name || user.last_name;\n            entity = {\n              _: 'messageEntityMentionName',\n              length: str.length,\n              offset: 0,\n              user_id: user.id\n            };\n          }\n\n          str += ' ';\n          chatInput.insertAtCaret(str, entity);\n        });\n      }\n    );\n  }\n\n  public checkQuery(query: string, peerId: PeerId, topMsgId: number) {\n    const trimmed = query.trim(); // check that there is no whitespace\n    if(query.length !== trimmed.length) return false;\n\n    const middleware = this.controller.getMiddleware();\n    this.managers.appProfileManager.getMentions(peerId && peerId.toChatId(), trimmed, topMsgId).then(async(peerIds) => {\n      if(!middleware()) return;\n\n      const username = trimmed.slice(1).toLowerCase();\n\n      const p = peerIds.map(async(peerId) => {\n        const user = await this.managers.appUsersManager.getUser(peerId);\n        if(user.username && user.username.toLowerCase() === username) { // hide full matched suggestion\n          return;\n        }\n\n        return {\n          peerId,\n          description: user.username ? '@' + user.username : undefined\n        };\n      });\n\n      this.render((await Promise.all(p)).filter(Boolean));\n    });\n\n    return true;\n  }\n}\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport type ChatInput from './input';\r\nimport DropdownHover from '../../helpers/dropdownHover';\r\nimport {KeyboardButton, ReplyMarkup} from '../../layer';\r\nimport rootScope from '../../lib/rootScope';\r\nimport ListenerSetter, {Listener} from '../../helpers/listenerSetter';\r\nimport findUpClassName from '../../helpers/dom/findUpClassName';\r\nimport IS_TOUCH_SUPPORTED from '../../environment/touchSupport';\r\nimport findUpAsChild from '../../helpers/dom/findUpAsChild';\r\nimport cancelEvent from '../../helpers/dom/cancelEvent';\r\nimport {getHeavyAnimationPromise} from '../../hooks/useHeavyAnimationCheck';\r\nimport confirmationPopup from '../confirmationPopup';\r\nimport safeAssign from '../../helpers/object/safeAssign';\r\nimport setInnerHTML from '../../helpers/dom/setInnerHTML';\r\nimport wrapEmojiText from '../../lib/richTextProcessor/wrapEmojiText';\r\nimport {AppManagers} from '../../lib/appManagers/managers';\r\nimport {attachClickEvent} from '../../helpers/dom/clickEvent';\r\n\r\nexport default class ReplyKeyboard extends DropdownHover {\r\n  private static BASE_CLASS = 'reply-keyboard';\r\n  private appendTo: HTMLElement;\r\n  private listenerSetter: ListenerSetter;\r\n  private managers: AppManagers;\r\n  private btnHover: HTMLElement;\r\n  private peerId: PeerId;\r\n  private touchListener: Listener;\r\n  private chatInput: ChatInput;\r\n\r\n  constructor(options: {\r\n    listenerSetter: ListenerSetter,\r\n    managers: AppManagers,\r\n    appendTo: HTMLElement,\r\n    btnHover: HTMLElement,\r\n    chatInput: ChatInput\r\n  }) {\r\n    super({\r\n      element: document.createElement('div')\r\n    });\r\n\r\n    safeAssign(this, options);\r\n\r\n    this.element.classList.add(ReplyKeyboard.BASE_CLASS);\r\n    this.element.style.display = 'none';\r\n\r\n    this.attachButtonListener(this.btnHover, this.listenerSetter);\r\n    this.listenerSetter.add(rootScope)('history_reply_markup', async({peerId}) => {\r\n      if(this.peerId === peerId) {\r\n        if(this.checkAvailability() && this.isActive()) {\r\n          await this.render();\r\n        }\r\n\r\n        getHeavyAnimationPromise().then(() => {\r\n          this.checkForceReply();\r\n        });\r\n      }\r\n    });\r\n  }\r\n\r\n  protected init() {\r\n    this.appendTo.append(this.element);\r\n\r\n    this.listenerSetter.add(this)('open', async() => {\r\n      await this.render();\r\n\r\n      if(IS_TOUCH_SUPPORTED) {\r\n        this.touchListener = this.listenerSetter.add(document.body)('touchstart', this.onBodyTouchStart, {passive: false, capture: true}) as any as Listener;\r\n        this.listenerSetter.add(this)('close', () => {\r\n          this.listenerSetter.remove(this.touchListener);\r\n        }, {once: true});\r\n      }\r\n    });\r\n\r\n    attachClickEvent(this.element, (e) => {\r\n      const target = findUpClassName(e.target, 'btn');\r\n      if(!target) {\r\n        return;\r\n      }\r\n\r\n      const type = target.dataset.type as KeyboardButton['_'];\r\n      const {peerId} = this;\r\n      switch(type) {\r\n        case 'keyboardButtonRequestPhone': {\r\n          confirmationPopup({\r\n            titleLangKey: 'ShareYouPhoneNumberTitle',\r\n            button: {\r\n              langKey: 'OK'\r\n            },\r\n            descriptionLangKey: 'AreYouSureShareMyContactInfoBot'\r\n          }).then(() => {\r\n            this.managers.appMessagesManager.sendContact(peerId, rootScope.myId);\r\n          });\r\n          break;\r\n        }\r\n\r\n        default: {\r\n          this.managers.appMessagesManager.sendText(peerId, target.dataset.text);\r\n          break;\r\n        }\r\n      }\r\n\r\n      this.toggle(false);\r\n    }, {listenerSetter: this.listenerSetter});\r\n\r\n    return super.init();\r\n  }\r\n\r\n  private onBodyTouchStart = (e: TouchEvent) => {\r\n    const target = e.touches[0].target as HTMLElement;\r\n    if(!findUpAsChild(target, this.element) && target !== this.btnHover) {\r\n      cancelEvent(e);\r\n      this.toggle(false);\r\n    }\r\n  };\r\n\r\n  public async checkForceReply() {\r\n    const replyMarkup = await this.getReplyMarkup();\r\n    if(replyMarkup._ === 'replyKeyboardForceReply' &&\r\n      !replyMarkup.pFlags.hidden &&\r\n      !replyMarkup.pFlags.used) {\r\n      replyMarkup.pFlags.used = true;\r\n      this.chatInput.initMessageReply(replyMarkup.mid);\r\n    }\r\n  }\r\n\r\n  private async getReplyMarkup() {\r\n    return (await this.managers.appMessagesManager.getHistoryStorageTransferable(this.peerId)).replyMarkup ?? {\r\n      _: 'replyKeyboardHide'\r\n    };\r\n  }\r\n\r\n  public async render(replyMarkup?: ReplyMarkup.replyKeyboardMarkup) {\r\n    if(replyMarkup === undefined) {\r\n      replyMarkup = await this.getReplyMarkup() as any;\r\n    }\r\n\r\n    this.element.textContent = '';\r\n\r\n    for(const row of replyMarkup.rows) {\r\n      const div = document.createElement('div');\r\n      div.classList.add(ReplyKeyboard.BASE_CLASS + '-row');\r\n\r\n      for(const button of row.buttons) {\r\n        const btn = document.createElement('button');\r\n        btn.classList.add(ReplyKeyboard.BASE_CLASS + '-button', 'btn');\r\n        setInnerHTML(btn, wrapEmojiText(button.text));\r\n        btn.dataset.text = button.text;\r\n        btn.dataset.type = button._;\r\n        div.append(btn);\r\n      }\r\n\r\n      this.element.append(div);\r\n    }\r\n  }\r\n\r\n  public async checkAvailability(replyMarkup?: ReplyMarkup) {\r\n    if(replyMarkup === undefined) {\r\n      replyMarkup = await this.getReplyMarkup();\r\n    }\r\n\r\n    const hide = replyMarkup._ === 'replyKeyboardHide' || !(replyMarkup as ReplyMarkup.replyInlineMarkup).rows?.length;\r\n    this.btnHover.classList.toggle('hide', hide);\r\n\r\n    if(hide) {\r\n      this.toggle(false);\r\n    }\r\n\r\n    return !hide;\r\n  }\r\n\r\n  public setPeer(peerId: PeerId) {\r\n    this.peerId = peerId;\r\n\r\n    this.checkAvailability();\r\n    this.checkForceReply();\r\n  }\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport type Chat from './chat';\r\nimport debounce from '../../helpers/schedulers/debounce';\r\nimport {WebDocument} from '../../layer';\r\nimport {MyDocument} from '../../lib/appManagers/appDocsManager';\r\nimport LazyLoadQueue from '../lazyLoadQueue';\r\nimport Scrollable from '../scrollable';\r\nimport {wrapPhoto} from '../wrappers';\r\nimport AutocompleteHelper from './autocompleteHelper';\r\nimport AutocompleteHelperController from './autocompleteHelperController';\r\nimport Button from '../button';\r\nimport {attachClickEvent} from '../../helpers/dom/clickEvent';\r\nimport {MyPhoto} from '../../lib/appManagers/appPhotosManager';\r\nimport assumeType from '../../helpers/assumeType';\r\nimport GifsMasonry from '../gifsMasonry';\r\nimport {SuperStickerRenderer} from '../emoticonsDropdown/tabs/stickers';\r\nimport mediaSizes from '../../helpers/mediaSizes';\r\nimport readBlobAsDataURL from '../../helpers/blob/readBlobAsDataURL';\r\nimport setInnerHTML from '../../helpers/dom/setInnerHTML';\r\nimport renderMediaWithFadeIn from '../../helpers/dom/renderMediaWithFadeIn';\r\nimport {AppManagers} from '../../lib/appManagers/managers';\r\nimport wrapEmojiText from '../../lib/richTextProcessor/wrapEmojiText';\r\nimport wrapRichText from '../../lib/richTextProcessor/wrapRichText';\r\nimport generateQId from '../../lib/appManagers/utils/inlineBots/generateQId';\r\nimport appDownloadManager from '../../lib/appManagers/appDownloadManager';\r\nimport {AnimationItemGroup} from '../animationIntersector';\r\n\r\nconst ANIMATION_GROUP: AnimationItemGroup = 'INLINE-HELPER';\r\n// const GRID_ITEMS = 5;\r\n\r\nexport default class InlineHelper extends AutocompleteHelper {\r\n  private scrollable: Scrollable;\r\n  private lazyLoadQueue: LazyLoadQueue;\r\n  private gifsMasonry: GifsMasonry;\r\n  private superStickerRenderer: SuperStickerRenderer;\r\n  private onChangeScreen: () => void;\r\n  public checkQuery: (peerId: PeerId, username: string, query: string) => ReturnType<InlineHelper['_checkQuery']>;\r\n\r\n  constructor(\r\n    appendTo: HTMLElement,\r\n    controller: AutocompleteHelperController,\r\n    private chat: Chat,\r\n    private managers: AppManagers\r\n  ) {\r\n    super({\r\n      appendTo,\r\n      controller,\r\n      listType: 'xy',\r\n      waitForKey: ['ArrowUp', 'ArrowDown'],\r\n      onSelect: (target) => {\r\n        if(!target) return false; // can happen when there is only button\r\n        const {peerId, botId, queryId} = this.list.dataset;\r\n        return this.chat.input.getReadyToSend(() => {\r\n          const queryAndResultIds = generateQId(queryId, (target as HTMLElement).dataset.resultId);\r\n          this.managers.appInlineBotsManager.sendInlineResult(peerId.toPeerId(), botId, queryAndResultIds, {\r\n            ...this.chat.getMessageSendingParams(),\r\n            clearDraft: true\r\n          });\r\n\r\n          this.chat.input.onMessageSent(true, true);\r\n        });\r\n      }\r\n    });\r\n\r\n    this.container.classList.add('inline-helper');\r\n\r\n    this.addEventListener('visible', () => {\r\n      setTimeout(() => { // it is not rendered yet\r\n        this.scrollable.container.scrollTop = 0;\r\n      }, 0);\r\n    });\r\n\r\n    this.checkQuery = debounce(this._checkQuery, 200, true, true);\r\n\r\n    this.addEventListener('hidden', () => {\r\n      if(this.onChangeScreen) {\r\n        mediaSizes.removeEventListener('changeScreen', this.onChangeScreen);\r\n        this.onChangeScreen = undefined;\r\n      }\r\n    });\r\n  }\r\n\r\n  public _checkQuery = async(peerId: PeerId, username: string, query: string) => {\r\n    const middleware = this.controller.getMiddleware();\r\n\r\n    const peer = await this.managers.appUsersManager.resolveUsername(username);\r\n    if(!middleware()) {\r\n      throw 'PEER_CHANGED';\r\n    }\r\n\r\n    if(peer._ !== 'user') {\r\n      throw 'NOT_A_BOT';\r\n    }\r\n\r\n    const renderPromise = this.managers.appInlineBotsManager.getInlineResults(peerId, peer.id, query).then((botResults) => {\r\n      if(!middleware()) {\r\n        throw 'PEER_CHANGED';\r\n      }\r\n\r\n      if(this.init) {\r\n        this.init();\r\n        this.init = null;\r\n      }\r\n\r\n      const list = this.list.cloneNode() as HTMLElement;\r\n      list.dataset.peerId = '' + peerId;\r\n      list.dataset.botId = '' + peer.id;\r\n      list.dataset.queryId = '' + botResults.query_id;\r\n\r\n      const gifsMasonry = new GifsMasonry(null, ANIMATION_GROUP, this.scrollable, false);\r\n\r\n      this.lazyLoadQueue.clear();\r\n      this.superStickerRenderer.clear();\r\n\r\n      const loadPromises: Promise<any>[] = [];\r\n      const isGallery = !!botResults.pFlags.gallery;\r\n      // botResults.results.length = 3;\r\n      for(const item of botResults.results) {\r\n        const container = document.createElement('div');\r\n        container.classList.add('inline-helper-result');\r\n        container.dataset.resultId = item.id;\r\n\r\n        const preview = isGallery ? undefined : document.createElement('div');\r\n        if(preview) {\r\n          preview.classList.add('inline-helper-result-preview');\r\n\r\n          container.append(preview);\r\n        }\r\n\r\n        list.append(container);\r\n\r\n        if(!isGallery) {\r\n          preview.classList.add('empty');\r\n          setInnerHTML(preview, wrapEmojiText([...item.title.trim()][0]));\r\n\r\n          const title = document.createElement('div');\r\n          title.classList.add('inline-helper-result-title');\r\n          setInnerHTML(title, wrapEmojiText(item.title));\r\n\r\n          const description = document.createElement('div');\r\n          description.classList.add('inline-helper-result-description');\r\n          setInnerHTML(description, wrapRichText(item.description, {\r\n            noCommands: true,\r\n            noLinks: true\r\n          }));\r\n\r\n          container.append(title, description);\r\n\r\n          const separator = document.createElement('div');\r\n          separator.classList.add('inline-helper-separator');\r\n\r\n          list.append(separator);\r\n        } else {\r\n          container.classList.add('grid-item');\r\n        }\r\n\r\n        if(item._ === 'botInlineResult') {\r\n          if(item.thumb && item.thumb.mime_type.indexOf('image/') === 0) {\r\n            let mediaContainer: HTMLElement;\r\n            if(preview) {\r\n              mediaContainer = document.createElement('div');\r\n              preview.append(mediaContainer);\r\n            } else {\r\n              mediaContainer = container;\r\n            }\r\n\r\n            mediaContainer.classList.add('media-container');\r\n            isGallery && mediaContainer.classList.add('no-border-radius');\r\n\r\n            this.lazyLoadQueue.push({\r\n              div: container,\r\n              load: () => {\r\n                return appDownloadManager.download({\r\n                  dcId: 4,\r\n                  location: {\r\n                    _: 'inputWebFileLocation',\r\n                    access_hash: (item.thumb as WebDocument.webDocument).access_hash,\r\n                    url: item.thumb.url\r\n                  },\r\n                  size: item.thumb.size,\r\n                  mimeType: item.thumb.mime_type\r\n                }).then((blob) => {\r\n                  const image = new Image();\r\n                  image.classList.add('media-photo');\r\n                  readBlobAsDataURL(blob).then((dataURL) => {\r\n                    renderMediaWithFadeIn(mediaContainer, image, dataURL, true);\r\n                  });\r\n                });\r\n              }\r\n            });\r\n          }\r\n        } else {\r\n          const media = item.document as MyDocument || item.photo as MyPhoto;\r\n          if((['sticker', 'gif'] as MyDocument['type'][]).includes((media as MyDocument)?.type) && isGallery) {\r\n            assumeType<MyDocument>(media);\r\n\r\n            if(media.type === 'gif') {\r\n              gifsMasonry.add(media, container);\r\n            } else if(media.type === 'sticker') {\r\n              container.classList.add('super-sticker');\r\n              this.superStickerRenderer.renderSticker(media, container, loadPromises);\r\n              if(media.animated) {\r\n                this.superStickerRenderer.observeAnimated(container);\r\n              }\r\n            }\r\n          } else if(media) {\r\n            const size = isGallery ? 48 : undefined;\r\n            isGallery && container.classList.add('no-border-radius');\r\n            wrapPhoto({\r\n              photo: media,\r\n              container: isGallery ? container : preview,\r\n              boxWidth: size,\r\n              boxHeight: size,\r\n              middleware,\r\n              lazyLoadQueue: this.lazyLoadQueue,\r\n              loadPromises\r\n            });\r\n          }\r\n        }\r\n      }\r\n\r\n      return Promise.all(loadPromises).then(() => {\r\n        if(!middleware()) {\r\n          gifsMasonry.clear();\r\n          return;\r\n        }\r\n\r\n        list.classList.toggle('is-gallery', isGallery);\r\n        list.classList.toggle('super-stickers', isGallery);\r\n        this.container.classList.toggle('is-gallery', isGallery);\r\n\r\n        /* if(isGallery) {\r\n          list.style.gridTemplateColumns = `repeat(${Math.min(botResults.results.length, 4)}, 1fr)`;\r\n        }\r\n\r\n        this.container.style.setProperty('width', isGallery ? `${Math.min(botResults.results.length, 4) * 25}%` : '', 'important'); */\r\n\r\n        const parent = this.list.parentElement;\r\n        parent.textContent = '';\r\n        if(botResults.switch_pm) {\r\n          const btnSwitchToPM = Button('btn-primary btn-secondary btn-primary-transparent primary');\r\n          setInnerHTML(btnSwitchToPM, wrapEmojiText(botResults.switch_pm.text));\r\n          attachClickEvent(btnSwitchToPM, (e) => {\r\n            this.chat.appImManager.setInnerPeer({peerId});\r\n            this.managers.appInlineBotsManager.switchToPM(peerId, peer.id, botResults.switch_pm.start_param);\r\n          });\r\n          parent.append(btnSwitchToPM);\r\n        }\r\n        parent.append(this.list = list);\r\n\r\n        if(this.gifsMasonry) {\r\n          this.gifsMasonry.detach();\r\n        }\r\n        this.gifsMasonry = gifsMasonry;\r\n        gifsMasonry.attach();\r\n\r\n        if(!this.onChangeScreen) {\r\n          this.onChangeScreen = () => {\r\n            if(this.list.classList.contains('is-gallery')) {\r\n              const width = (this.list.childElementCount * mediaSizes.active.esgSticker.width) + (this.list.childElementCount - 1 * 1);\r\n              this.list.style.width = width + 'px';\r\n            } else {\r\n              this.list.style.width = '';\r\n            }\r\n          };\r\n          mediaSizes.addEventListener('changeScreen', this.onChangeScreen);\r\n        }\r\n\r\n        this.onChangeScreen();\r\n\r\n        this.toggle(!botResults.results.length && !botResults.switch_pm);\r\n        this.scrollable.scrollTop = 0;\r\n      });\r\n    });\r\n\r\n    return {user: peer, renderPromise};\r\n  };\r\n\r\n  protected init() {\r\n    this.list = document.createElement('div');\r\n    this.list.classList.add('inline-helper-results');\r\n\r\n    this.container.append(this.list);\r\n\r\n    this.scrollable = new Scrollable(this.container);\r\n    this.lazyLoadQueue = new LazyLoadQueue();\r\n    this.superStickerRenderer = new SuperStickerRenderer(this.lazyLoadQueue, ANIMATION_GROUP, this.managers);\r\n  }\r\n}\r\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport type ChatInput from './input';\nimport callbackify from '../../helpers/callbackify';\nimport AutocompletePeerHelper from './autocompletePeerHelper';\nimport {processPeerFullForCommands} from './commandsHelper';\nimport {AppManagers} from '../../lib/appManagers/managers';\n\nconst CLASS_NAME = 'bot-commands';\nexport default class ChatBotCommands extends AutocompletePeerHelper {\n  private userId: UserId;\n\n  constructor(\n    appendTo: HTMLElement,\n    chatInput: ChatInput,\n    private managers: AppManagers\n  ) {\n    super(appendTo, undefined, CLASS_NAME, (target) => {\n      const innerHTML = target.querySelector(`.${AutocompletePeerHelper.BASE_CLASS_LIST_ELEMENT}-name`).innerHTML;\n      return chatInput.getReadyToSend(() => {\n        chatInput.messageInput.innerHTML = innerHTML;\n        chatInput.sendMessage(true);\n        this.toggle(true);\n      });\n    });\n  }\n\n  public setUserId(userId: UserId, middleware: () => boolean) {\n    if(this.userId === userId && this.list?.childElementCount) {\n      this.toggle(false);\n      return;\n    }\n\n    this.userId = userId;\n    return callbackify(this.managers.appProfileManager.getProfile(userId), (full) => {\n      if(!middleware()) return;\n      const filtered = processPeerFullForCommands(userId.toPeerId(false), full);\n\n      const PADDING_TOP = 8;\n      // const PADDING_BOTTOM = 8;\n      const PADDING_BOTTOM = 24;\n      const height = filtered.length * 50 + PADDING_TOP + PADDING_BOTTOM;\n      this.container.style.setProperty('--height', height + 'px');\n\n      this.render(filtered);\n\n      // this.container.style.top =\n    });\n  }\n}\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport {AckedResult} from '../lib/mtproto/superMessagePort';\r\nimport {Modify} from '../types';\r\n\r\nexport default async function modifyAckedResult<T>(acked: AckedResult<T>): Promise<Modify<AckedResult<T>, {result: T | Promise<T>}>> {\r\n  return {\r\n    cached: acked.cached,\r\n    result: acked.cached ? await acked.result : acked.result\r\n  };\r\n}\r\n\r\nexport function modifyAckedPromise<T>(promise: Promise<AckedResult<T>>) {\r\n  return promise.then(modifyAckedResult);\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport indexOfAndSplice from '../../helpers/array/indexOfAndSplice';\r\nimport callbackify from '../../helpers/callbackify';\r\nimport ListenerSetter from '../../helpers/listenerSetter';\r\nimport {getMiddleware} from '../../helpers/middleware';\r\nimport {modifyAckedPromise} from '../../helpers/modifyAckedResult';\r\nimport {ChatFull} from '../../layer';\r\nimport {AppManagers} from '../../lib/appManagers/managers';\r\nimport getPeerId from '../../lib/appManagers/utils/peers/getPeerId';\r\nimport {i18n} from '../../lib/langPack';\r\nimport {AckedResult} from '../../lib/mtproto/superMessagePort';\r\nimport rootScope from '../../lib/rootScope';\r\nimport AvatarElement from '../avatar';\r\nimport ButtonMenu, {ButtonMenuItemOptions} from '../buttonMenu';\r\nimport ButtonMenuToggle from '../buttonMenuToggle';\r\nimport PeerTitle from '../peerTitle';\r\nimport SetTransition from '../singleTransition';\r\nimport getChatMembersString from '../wrappers/getChatMembersString';\r\n\r\nconst SEND_AS_ANIMATION_DURATION = 300;\r\n\r\nexport default class ChatSendAs {\r\n  private avatar: AvatarElement;\r\n  private container: HTMLElement;\r\n  private closeBtn: HTMLElement;\r\n  private btnMenu: HTMLElement;\r\n  private sendAsPeerIds: PeerId[];\r\n  private sendAsPeerId: PeerId;\r\n  private updatingPromise: ReturnType<ChatSendAs['updateManual']>;\r\n  private middleware: ReturnType<typeof getMiddleware>;\r\n  private listenerSetter: ListenerSetter;\r\n  private peerId: PeerId;\r\n  private addedListener: boolean;\r\n\r\n  constructor(\r\n    private managers: AppManagers,\r\n    private onReady: (container: HTMLElement, skipAnimation?: boolean) => void,\r\n    private onChange: (sendAsPeerId: PeerId) => void\r\n  ) {\r\n    this.middleware = getMiddleware();\r\n    this.listenerSetter = new ListenerSetter();\r\n    this.construct();\r\n  }\r\n\r\n  private construct() {\r\n    this.container = document.createElement('div');\r\n    this.container.classList.add('new-message-send-as-container');\r\n\r\n    this.closeBtn = document.createElement('div');\r\n    this.closeBtn.classList.add('new-message-send-as-close', 'new-message-send-as-avatar', 'tgico-close');\r\n\r\n    const sendAsButtons: ButtonMenuItemOptions[] = [{\r\n      text: 'SendMessageAsTitle',\r\n      onClick: undefined\r\n    }];\r\n\r\n    let previousAvatar: HTMLElement;\r\n    const onSendAsMenuToggle = (visible: boolean) => {\r\n      if(visible) {\r\n        previousAvatar = this.avatar;\r\n      }\r\n\r\n      const isChanged = this.avatar !== previousAvatar;\r\n      const useRafs = !visible && isChanged ? 2 : 0;\r\n\r\n      SetTransition(this.closeBtn, 'is-visible', visible, SEND_AS_ANIMATION_DURATION, undefined, useRafs);\r\n      if(!isChanged) {\r\n        SetTransition(previousAvatar, 'is-visible', !visible, SEND_AS_ANIMATION_DURATION, undefined, useRafs);\r\n      }\r\n    };\r\n\r\n    ButtonMenuToggle({\r\n      noRipple: true,\r\n      listenerSetter: this.listenerSetter,\r\n      container: this.container\r\n    }, 'top-right', sendAsButtons, () => {\r\n      onSendAsMenuToggle(true);\r\n    }, () => {\r\n      onSendAsMenuToggle(false);\r\n    });\r\n\r\n    sendAsButtons[0].element.classList.add('btn-menu-item-header');\r\n    this.btnMenu = this.container.firstElementChild as any;\r\n    this.btnMenu.classList.add('scrollable', 'scrollable-y');\r\n    this.container.append(this.closeBtn);\r\n  }\r\n\r\n  private async updateButtons(peerIds: PeerId[]) {\r\n    const promises: Promise<ButtonMenuItemOptions>[] = peerIds.map(async(sendAsPeerId, idx) => {\r\n      const textElement = document.createElement('div');\r\n\r\n      const subtitle = document.createElement('div');\r\n      subtitle.classList.add('btn-menu-item-subtitle');\r\n      if(sendAsPeerId.isUser()) {\r\n        subtitle.append(i18n('Chat.SendAs.PersonalAccount'));\r\n      } else if(sendAsPeerId === this.peerId) {\r\n        subtitle.append(i18n('VoiceChat.DiscussionGroup'));\r\n      } else {\r\n        subtitle.append(await getChatMembersString(sendAsPeerId.toChatId()));\r\n      }\r\n\r\n      textElement.append(\r\n        new PeerTitle({peerId: sendAsPeerId}).element,\r\n        subtitle\r\n      );\r\n\r\n      return {\r\n        onClick: idx ? async() => {\r\n          const currentPeerId = this.peerId;\r\n          this.changeSendAsPeerId(sendAsPeerId);\r\n\r\n          const middleware = this.middleware.get();\r\n          const executeButtonsUpdate = () => {\r\n            if(this.sendAsPeerId !== sendAsPeerId || !middleware()) return;\r\n            const peerIds = this.sendAsPeerIds.slice();\r\n            indexOfAndSplice(peerIds, sendAsPeerId);\r\n            peerIds.unshift(sendAsPeerId);\r\n            this.updateButtons(peerIds);\r\n          };\r\n\r\n          if(rootScope.settings.animationsEnabled) {\r\n            setTimeout(executeButtonsUpdate, 250);\r\n          } else {\r\n            executeButtonsUpdate();\r\n          }\r\n\r\n          // return;\r\n          this.managers.appMessagesManager.saveDefaultSendAs(currentPeerId, sendAsPeerId);\r\n        } : undefined,\r\n        textElement\r\n      };\r\n    });\r\n\r\n    const buttons = await Promise.all(promises);\r\n    const btnMenu = ButtonMenu(buttons/* , this.listenerSetter */);\r\n    buttons.forEach((button, idx) => {\r\n      const peerId = peerIds[idx];\r\n      const avatar = new AvatarElement();\r\n      avatar.classList.add('avatar-26', 'btn-menu-item-icon');\r\n      avatar.updateWithOptions({peerId});\r\n\r\n      if(!idx) {\r\n        avatar.classList.add('active');\r\n      }\r\n\r\n      button.element.prepend(avatar);\r\n    });\r\n\r\n    Array.from(this.btnMenu.children).slice(1).forEach((node) => node.remove());\r\n    this.btnMenu.append(...Array.from(btnMenu.children));\r\n  }\r\n\r\n  private async updateAvatar(sendAsPeerId: PeerId, skipAnimation?: boolean) {\r\n    const previousAvatar = this.avatar;\r\n    if(previousAvatar) {\r\n      if(previousAvatar.peerId === sendAsPeerId) {\r\n        return;\r\n      }\r\n    }\r\n\r\n    if(!previousAvatar) {\r\n      skipAnimation = true;\r\n    }\r\n\r\n    const useRafs = skipAnimation ? 0 : 2;\r\n    const duration = skipAnimation ? 0 : SEND_AS_ANIMATION_DURATION;\r\n    const avatar = this.avatar = new AvatarElement();\r\n    avatar.classList.add('new-message-send-as-avatar', 'avatar-30');\r\n    await avatar.updateWithOptions({\r\n      isDialog: false,\r\n      peerId: sendAsPeerId\r\n    });\r\n\r\n    SetTransition(avatar, 'is-visible', true, duration, undefined, useRafs);\r\n    if(previousAvatar) {\r\n      SetTransition(previousAvatar, 'is-visible', false, duration, () => {\r\n        previousAvatar.remove();\r\n      }, useRafs);\r\n    }\r\n\r\n    this.container.append(avatar);\r\n  }\r\n\r\n  private changeSendAsPeerId(sendAsPeerId: PeerId, skipAnimation?: boolean) {\r\n    this.sendAsPeerId = sendAsPeerId;\r\n    this.onChange(sendAsPeerId);\r\n    return this.updateAvatar(sendAsPeerId, skipAnimation);\r\n  }\r\n\r\n  private getDefaultSendAs(): Promise<AckedResult<PeerId>> {\r\n    // return rootScope.myId;\r\n    return this.managers.acknowledged.appProfileManager.getChannelFull(this.peerId.toChatId()).then((acked) => {\r\n      return {\r\n        cached: acked.cached,\r\n        result: acked.result.then((channelFull) => {\r\n          return channelFull.default_send_as ? getPeerId(channelFull.default_send_as) : undefined\r\n        })\r\n      };\r\n    });\r\n  }\r\n\r\n  public async updateManual(skipAnimation?: boolean): Promise<() => void> {\r\n    const peerId = this.peerId;\r\n    if(this.updatingPromise || !(await this.managers.appPeersManager.isChannel(peerId))) {\r\n      return;\r\n    }\r\n\r\n    const middleware = this.middleware.get(() => {\r\n      return !this.updatingPromise || this.updatingPromise === updatingPromise;\r\n    });\r\n\r\n    const {container} = this;\r\n    const chatId = peerId.toChatId();\r\n    const result = (await modifyAckedPromise(this.getDefaultSendAs())).result;\r\n    // const result = Promise.resolve(this.getDefaultSendAs());\r\n\r\n    const wasSkippingAnimation = skipAnimation;\r\n    if(result instanceof Promise) {\r\n      skipAnimation = undefined;\r\n    }\r\n\r\n    const auto = wasSkippingAnimation && !skipAnimation;\r\n\r\n    const updatingPromise = this.updatingPromise = callbackify(result, async(sendAsPeerId) => {\r\n      if(!middleware() || sendAsPeerId === undefined) return;\r\n\r\n      await this.changeSendAsPeerId(sendAsPeerId, skipAnimation);\r\n      if(!middleware()) return;\r\n\r\n      this.managers.appChatsManager.getSendAs(chatId).then((peers) => {\r\n        if(!middleware()) return;\r\n\r\n        const peerIds = peers.map((peer) => getPeerId(peer));\r\n        this.sendAsPeerIds = peerIds.slice();\r\n\r\n        indexOfAndSplice(peerIds, sendAsPeerId);\r\n        peerIds.unshift(sendAsPeerId);\r\n        this.updateButtons(peerIds);\r\n      });\r\n\r\n      const callback = () => {\r\n        this.onReady(container, skipAnimation);\r\n\r\n        if(!this.addedListener) {\r\n          this.listenerSetter.add(rootScope)('peer_full_update', (peerId) => {\r\n            if(this.peerId === peerId) {\r\n              this.update();\r\n            }\r\n          });\r\n\r\n          this.addedListener = true;\r\n        }\r\n      };\r\n\r\n      if(auto) {\r\n        callback();\r\n        return;\r\n      }\r\n\r\n      return callback;\r\n    });\r\n\r\n    updatingPromise.finally(() => {\r\n      if(this.updatingPromise === updatingPromise) {\r\n        this.updatingPromise = undefined;\r\n      }\r\n    });\r\n\r\n    if(!auto) {\r\n      return updatingPromise;\r\n    }\r\n  }\r\n\r\n  public update(skipAnimation?: boolean) {\r\n    return this.updateManual(skipAnimation).then((callback) => callback && callback());\r\n  }\r\n\r\n  public setPeerId(peerId?: PeerId) {\r\n    /* if(this.avatar) {\r\n      this.avatar.remove();\r\n      this.avatar = undefined;\r\n    } */\r\n\r\n    this.middleware.clean();\r\n    this.updatingPromise = undefined;\r\n    this.peerId = peerId;\r\n  }\r\n\r\n  public destroy() {\r\n    this.container.remove();\r\n    this.setPeerId();\r\n    this.listenerSetter.removeAll();\r\n  }\r\n}\r\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport {_i18n} from '../lib/langPack';\nimport InputField, {InputFieldOptions} from './inputField';\nimport SetTransition from './singleTransition';\n\nexport default class InputFieldAnimated extends InputField {\n  public inputFake: HTMLElement;\n\n  // public onLengthChange: (length: number, isOverflow: boolean) => void;\n  // protected wasInputFakeClientHeight: number;\n  // protected showScrollDebounced: () => void;\n\n  constructor(options?: InputFieldOptions) {\n    super(options);\n\n    this.input.addEventListener('input', () => {\n      this.inputFake.innerHTML = this.input.innerHTML;\n      this.onFakeInput();\n    });\n\n    if(options.placeholder) {\n      _i18n(this.inputFake, options.placeholder, undefined, 'placeholder');\n    }\n\n    this.input.classList.add('scrollable', 'scrollable-y');\n    // this.wasInputFakeClientHeight = 0;\n    // this.showScrollDebounced = debounce(() => this.input.classList.remove('no-scrollbar'), 150, false, true);\n    this.inputFake = document.createElement('div');\n    this.inputFake.setAttribute('contenteditable', 'true');\n    this.inputFake.className = this.input.className + ' input-field-input-fake';\n  }\n\n  public onFakeInput(setHeight = true) {\n    const {scrollHeight: newHeight/* , clientHeight */} = this.inputFake;\n    /* if(this.wasInputFakeClientHeight && this.wasInputFakeClientHeight !== clientHeight) {\n      this.input.classList.add('no-scrollbar'); // !         ,      reflow   overflow.\n      this.showScrollDebounced();\n    } */\n\n    const currentHeight = +this.input.style.height.replace('px', '');\n    if(currentHeight === newHeight) {\n      return;\n    }\n\n    const TRANSITION_DURATION_FACTOR = 50;\n    const transitionDuration = Math.round(\n      TRANSITION_DURATION_FACTOR * Math.log(Math.abs(newHeight - currentHeight))\n    );\n\n    // this.wasInputFakeClientHeight = clientHeight;\n    this.input.style.transitionDuration = `${transitionDuration}ms`;\n\n    if(setHeight) {\n      this.input.style.height = newHeight ? newHeight + 'px' : '';\n    }\n\n    const className = 'is-changing-height';\n    SetTransition(this.input, className, true, transitionDuration, () => {\n      this.input.classList.remove(className);\n    });\n  }\n\n  public setValueSilently(value: string, fromSet?: boolean) {\n    super.setValueSilently(value, fromSet);\n\n    this.inputFake.innerHTML = value;\n    if(!fromSet) {\n      this.onFakeInput();\n    }\n  }\n}\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport type {MyDocument} from '../../lib/appManagers/appDocsManager';\r\nimport type {AppImManager} from '../../lib/appManagers/appImManager';\r\nimport type {MyDraftMessage} from '../../lib/appManagers/appDraftsManager';\r\nimport type Chat from './chat';\r\nimport Recorder from '../../../public/recorder.min';\r\nimport IS_TOUCH_SUPPORTED from '../../environment/touchSupport';\r\n// import Recorder from '../opus-recorder/dist/recorder.min';\r\nimport opusDecodeController from '../../lib/opusDecodeController';\r\nimport ButtonMenu, {ButtonMenuItemOptions} from '../buttonMenu';\r\nimport emoticonsDropdown from '../emoticonsDropdown';\r\nimport PopupCreatePoll from '../popups/createPoll';\r\nimport PopupForward from '../popups/forward';\r\nimport PopupNewMedia from '../popups/newMedia';\r\nimport {toast, toastNew} from '../toast';\r\nimport {wrapReply} from '../wrappers';\r\nimport {MessageEntity, DraftMessage, WebPage, Message, UserFull} from '../../layer';\r\nimport StickersHelper from './stickersHelper';\r\nimport ButtonIcon from '../buttonIcon';\r\nimport ButtonMenuToggle from '../buttonMenuToggle';\r\nimport ListenerSetter, {Listener} from '../../helpers/listenerSetter';\r\nimport Button from '../button';\r\nimport PopupSchedule from '../popups/schedule';\r\nimport SendMenu from './sendContextMenu';\r\nimport rootScope from '../../lib/rootScope';\r\nimport PopupPinMessage from '../popups/unpinMessage';\r\nimport tsNow from '../../helpers/tsNow';\r\nimport appNavigationController, {NavigationItem} from '../appNavigationController';\r\nimport {IS_MOBILE, IS_MOBILE_SAFARI} from '../../environment/userAgent';\r\nimport I18n, {i18n, join, LangPackKey} from '../../lib/langPack';\r\nimport {generateTail} from './bubbles';\r\nimport findUpClassName from '../../helpers/dom/findUpClassName';\r\nimport ButtonCorner from '../buttonCorner';\r\nimport blurActiveElement from '../../helpers/dom/blurActiveElement';\r\nimport cancelEvent from '../../helpers/dom/cancelEvent';\r\nimport cancelSelection from '../../helpers/dom/cancelSelection';\r\nimport {attachClickEvent, simulateClickEvent} from '../../helpers/dom/clickEvent';\r\nimport getRichValue from '../../helpers/dom/getRichValue';\r\nimport isInputEmpty from '../../helpers/dom/isInputEmpty';\r\nimport isSendShortcutPressed from '../../helpers/dom/isSendShortcutPressed';\r\nimport placeCaretAtEnd from '../../helpers/dom/placeCaretAtEnd';\r\nimport {MarkdownType, markdownTags} from '../../helpers/dom/getRichElementValue';\r\nimport getRichValueWithCaret from '../../helpers/dom/getRichValueWithCaret';\r\nimport EmojiHelper from './emojiHelper';\r\nimport CommandsHelper from './commandsHelper';\r\nimport AutocompleteHelperController from './autocompleteHelperController';\r\nimport AutocompleteHelper from './autocompleteHelper';\r\nimport MentionsHelper from './mentionsHelper';\r\nimport fixSafariStickyInput from '../../helpers/dom/fixSafariStickyInput';\r\nimport ReplyKeyboard from './replyKeyboard';\r\nimport InlineHelper from './inlineHelper';\r\nimport debounce from '../../helpers/schedulers/debounce';\r\nimport noop from '../../helpers/noop';\r\nimport {putPreloader} from '../putPreloader';\r\nimport SetTransition from '../singleTransition';\r\nimport PeerTitle from '../peerTitle';\r\nimport {fastRaf} from '../../helpers/schedulers';\r\nimport PopupDeleteMessages from '../popups/deleteMessages';\r\nimport fixSafariStickyInputFocusing, {IS_STICKY_INPUT_BUGGED} from '../../helpers/dom/fixSafariStickyInputFocusing';\r\nimport PopupPeer from '../popups/peer';\r\nimport MEDIA_MIME_TYPES_SUPPORTED from '../../environment/mediaMimeTypesSupport';\r\nimport appMediaPlaybackController from '../appMediaPlaybackController';\r\nimport {BOT_START_PARAM, NULL_PEER_ID} from '../../lib/mtproto/mtproto_config';\r\nimport setCaretAt from '../../helpers/dom/setCaretAt';\r\nimport CheckboxField from '../checkboxField';\r\nimport DropdownHover from '../../helpers/dropdownHover';\r\nimport RadioForm from '../radioForm';\r\nimport findUpTag from '../../helpers/dom/findUpTag';\r\nimport toggleDisability from '../../helpers/dom/toggleDisability';\r\nimport callbackify from '../../helpers/callbackify';\r\nimport ChatBotCommands from './botCommands';\r\nimport copy from '../../helpers/object/copy';\r\nimport toHHMMSS from '../../helpers/string/toHHMMSS';\r\nimport documentFragmentToHTML from '../../helpers/dom/documentFragmentToHTML';\r\nimport PopupElement from '../popups';\r\nimport getEmojiEntityFromEmoji from '../../lib/richTextProcessor/getEmojiEntityFromEmoji';\r\nimport mergeEntities from '../../lib/richTextProcessor/mergeEntities';\r\nimport parseEntities from '../../lib/richTextProcessor/parseEntities';\r\nimport parseMarkdown from '../../lib/richTextProcessor/parseMarkdown';\r\nimport wrapDraftText from '../../lib/richTextProcessor/wrapDraftText';\r\nimport wrapDraft from '../wrappers/draft';\r\nimport wrapMessageForReply from '../wrappers/messageForReply';\r\nimport getServerMessageId from '../../lib/appManagers/utils/messageId/getServerMessageId';\r\nimport {AppManagers} from '../../lib/appManagers/managers';\r\nimport contextMenuController from '../../helpers/contextMenuController';\r\nimport {emojiFromCodePoints} from '../../vendor/emoji';\r\nimport {modifyAckedPromise} from '../../helpers/modifyAckedResult';\r\nimport ChatSendAs from './sendAs';\r\nimport filterAsync from '../../helpers/array/filterAsync';\r\nimport InputFieldAnimated from '../inputFieldAnimated';\r\nimport getStickerEffectThumb from '../../lib/appManagers/utils/stickers/getStickerEffectThumb';\r\nimport PopupStickers from '../popups/stickers';\r\nimport wrapPeerTitle from '../wrappers/peerTitle';\r\n\r\nconst RECORD_MIN_TIME = 500;\r\nconst POSTING_MEDIA_NOT_ALLOWED = 'Posting media content isn\\'t allowed in this group.';\r\n\r\ntype ChatInputHelperType = 'edit' | 'webpage' | 'forward' | 'reply';\r\n\r\nexport default class ChatInput {\r\n  // private static AUTO_COMPLETE_REG_EXP = /(\\s|^)((?::|.)(?!.*[:@]).*|(?:[@\\/]\\S*))$/;\r\n  private static AUTO_COMPLETE_REG_EXP = /(\\s|^)((?:(?:@|^\\/)\\S*)|(?::|^[^:@\\/])(?!.*[:@\\/]).*)$/;\r\n  public messageInput: HTMLElement;\r\n  public messageInputField: InputFieldAnimated;\r\n  private fileInput: HTMLInputElement;\r\n  private inputMessageContainer: HTMLDivElement;\r\n  private btnSend: HTMLButtonElement;\r\n  private btnCancelRecord: HTMLButtonElement;\r\n  private lastUrl = '';\r\n  private lastTimeType = 0;\r\n\r\n  public chatInput: HTMLElement;\r\n  public inputContainer: HTMLElement;\r\n  public rowsWrapper: HTMLDivElement;\r\n  private newMessageWrapper: HTMLDivElement;\r\n  private btnToggleEmoticons: HTMLButtonElement;\r\n  private btnToggleReplyMarkup: HTMLButtonElement;\r\n  private btnSendContainer: HTMLDivElement;\r\n\r\n  private replyKeyboard: ReplyKeyboard;\r\n\r\n  private attachMenu: HTMLElement;\r\n  private attachMenuButtons: (ButtonMenuItemOptions & {verify: (peerId: PeerId, threadId: number) => boolean | Promise<boolean>})[];\r\n\r\n  private sendMenu: SendMenu;\r\n\r\n  private replyElements: {\r\n    container: HTMLElement,\r\n    cancelBtn: HTMLButtonElement,\r\n    iconBtn: HTMLButtonElement\r\n  } = {} as any;\r\n\r\n  private forwardElements: {\r\n    changePeer: ButtonMenuItemOptions,\r\n    showSender: ButtonMenuItemOptions,\r\n    hideSender: ButtonMenuItemOptions,\r\n    showCaption: ButtonMenuItemOptions,\r\n    hideCaption: ButtonMenuItemOptions,\r\n    container: HTMLElement,\r\n    modifyArgs?: ButtonMenuItemOptions[]\r\n  };\r\n  private forwardHover: DropdownHover;\r\n  private forwardWasDroppingAuthor: boolean;\r\n\r\n  private getWebPagePromise: Promise<void>;\r\n  private willSendWebPage: WebPage = null;\r\n  private forwarding: {[fromPeerId: PeerId]: number[]};\r\n  public replyToMsgId: number;\r\n  public editMsgId: number;\r\n  public editMessage: Message.message;\r\n  private noWebPage: true;\r\n  public scheduleDate: number;\r\n  public sendSilent: true;\r\n  public startParam: string;\r\n\r\n  private recorder: any;\r\n  public recording = false;\r\n  private recordCanceled = false;\r\n  private recordTimeEl: HTMLElement;\r\n  private recordRippleEl: HTMLElement;\r\n  private recordStartTime = 0;\r\n  private recordingOverlayListener: Listener;\r\n  private recordingNavigationItem: NavigationItem;\r\n\r\n  // private scrollTop = 0;\r\n  // private scrollOffsetTop = 0;\r\n  // private scrollDiff = 0;\r\n\r\n  public helperType: Exclude<ChatInputHelperType, 'webpage'>;\r\n  private helperFunc: () => void | Promise<void>;\r\n  private helperWaitingForward: boolean;\r\n\r\n  public willAttachType: 'document' | 'media';\r\n\r\n  private lockRedo = false;\r\n  private canRedoFromHTML = '';\r\n  private readonly undoHistory: string[] = [];\r\n  private readonly executedHistory: string[] = [];\r\n  private canUndoFromHTML = '';\r\n\r\n  private autocompleteHelperController: AutocompleteHelperController;\r\n  private stickersHelper: StickersHelper;\r\n  private emojiHelper: EmojiHelper;\r\n  private commandsHelper: CommandsHelper;\r\n  private mentionsHelper: MentionsHelper;\r\n  private inlineHelper: InlineHelper;\r\n  private listenerSetter: ListenerSetter;\r\n\r\n  private pinnedControlBtn: HTMLButtonElement;\r\n\r\n  private goDownBtn: HTMLButtonElement;\r\n  private goDownUnreadBadge: HTMLElement;\r\n  private goMentionBtn: HTMLButtonElement;\r\n  private goMentionUnreadBadge: HTMLSpanElement;\r\n  private btnScheduled: HTMLButtonElement;\r\n\r\n  private btnPreloader: HTMLButtonElement;\r\n\r\n  private saveDraftDebounced: () => void;\r\n\r\n  private fakeRowsWrapper: HTMLDivElement;\r\n\r\n  private previousQuery: string;\r\n\r\n  private releaseMediaPlayback: () => void;\r\n\r\n  private botStartBtn: HTMLButtonElement;\r\n  private rowsWrapperWrapper: HTMLDivElement;\r\n  private controlContainer: HTMLElement;\r\n  private fakeSelectionWrapper: HTMLDivElement;\r\n\r\n  private fakeWrapperTo: HTMLElement;\r\n  private toggleBotStartBtnDisability: () => void;\r\n\r\n  private botCommandsToggle: HTMLElement;\r\n  private botCommands: ChatBotCommands;\r\n  private botCommandsIcon: HTMLDivElement;\r\n  private hasBotCommands: boolean;\r\n\r\n  // private activeContainer: HTMLElement;\r\n\r\n  private sendAs: ChatSendAs;\r\n  public sendAsPeerId: PeerId;\r\n\r\n  constructor(\r\n    private chat: Chat,\r\n    private appImManager: AppImManager,\r\n    private managers: AppManagers\r\n  ) {\r\n    this.listenerSetter = new ListenerSetter();\r\n  }\r\n\r\n  public construct() {\r\n    this.chatInput = document.createElement('div');\r\n    this.chatInput.classList.add('chat-input', 'hide');\r\n\r\n    this.inputContainer = document.createElement('div');\r\n    this.inputContainer.classList.add('chat-input-container');\r\n\r\n    this.rowsWrapperWrapper = document.createElement('div');\r\n    this.rowsWrapperWrapper.classList.add('rows-wrapper-wrapper');\r\n\r\n    this.rowsWrapper = document.createElement('div');\r\n    this.rowsWrapper.classList.add('rows-wrapper', 'chat-input-wrapper');\r\n\r\n    this.rowsWrapperWrapper.append(this.rowsWrapper);\r\n\r\n    const tail = generateTail();\r\n    this.rowsWrapper.append(tail);\r\n\r\n    const fakeRowsWrapper = this.fakeRowsWrapper = document.createElement('div');\r\n    fakeRowsWrapper.classList.add('fake-wrapper', 'fake-rows-wrapper');\r\n\r\n    const fakeSelectionWrapper = this.fakeSelectionWrapper = document.createElement('div');\r\n    fakeSelectionWrapper.classList.add('fake-wrapper', 'fake-selection-wrapper');\r\n\r\n    this.inputContainer.append(this.rowsWrapperWrapper, fakeRowsWrapper, fakeSelectionWrapper);\r\n    this.chatInput.append(this.inputContainer);\r\n\r\n    this.goDownBtn = ButtonCorner({icon: 'arrow_down', className: 'bubbles-corner-button bubbles-go-down hide'});\r\n    this.inputContainer.append(this.goDownBtn);\r\n\r\n    attachClickEvent(this.goDownBtn, (e) => {\r\n      cancelEvent(e);\r\n      this.chat.bubbles.onGoDownClick();\r\n    }, {listenerSetter: this.listenerSetter});\r\n\r\n    // * constructor end\r\n\r\n    /* let setScrollTopTimeout: number;\r\n    // @ts-ignore\r\n    let height = window.visualViewport.height; */\r\n    // @ts-ignore\r\n    // this.listenerSetter.add(window.visualViewport)('resize', () => {\r\n    //   const scrollable = this.chat.bubbles.scrollable;\r\n    //   const wasScrolledDown = scrollable.isScrolledDown;\r\n\r\n    //   /* if(wasScrolledDown) {\r\n    //     this.saveScroll();\r\n    //   } */\r\n\r\n    //   // @ts-ignore\r\n    //   let newHeight = window.visualViewport.height;\r\n    //   const diff = height - newHeight;\r\n    //   const scrollTop = scrollable.scrollTop;\r\n    //   const needScrollTop = wasScrolledDown ? scrollable.scrollHeight : scrollTop + diff; // * wasScrolledDown     ,     \r\n\r\n    //   console.log('resize before', scrollable.scrollTop, scrollable.container.clientHeight, scrollable.scrollHeight, wasScrolledDown, scrollable.lastScrollTop, diff, needScrollTop);\r\n\r\n    //   scrollable.scrollTop = needScrollTop;\r\n\r\n    //   if(setScrollTopTimeout) clearTimeout(setScrollTopTimeout);\r\n    //   setScrollTopTimeout = window.setTimeout(() => {\r\n    //     const diff = height - newHeight;\r\n    //     const isScrolledDown = scrollable.scrollHeight - Math.round(scrollable.scrollTop + scrollable.container.offsetHeight + diff) <= 1;\r\n    //     height = newHeight;\r\n\r\n    //     scrollable.scrollTop = needScrollTop;\r\n\r\n    //     console.log('resize after', scrollable.scrollTop, scrollable.container.clientHeight, scrollable.scrollHeight, scrollable.isScrolledDown, scrollable.lastScrollTop, isScrolledDown);\r\n\r\n    //     /* if(isScrolledDown) {\r\n    //       scrollable.scrollTop = scrollable.scrollHeight;\r\n    //     } */\r\n\r\n    //     //scrollable.scrollTop += diff;\r\n    //     setScrollTopTimeout = 0;\r\n    //   }, 0);\r\n    // });\r\n\r\n    // ! Can't use it with resizeObserver\r\n    /* this.listenerSetter.add(window.visualViewport)('resize', () => {\r\n      const scrollable = this.chat.bubbles.scrollable;\r\n      const wasScrolledDown = scrollable.isScrolledDown;\r\n\r\n      // @ts-ignore\r\n      let newHeight = window.visualViewport.height;\r\n      const diff = height - newHeight;\r\n      const needScrollTop = wasScrolledDown ? scrollable.scrollHeight : scrollable.scrollTop + diff; // * wasScrolledDown     ,     \r\n\r\n      //console.log('resize before', scrollable.scrollTop, scrollable.container.clientHeight, scrollable.scrollHeight, wasScrolledDown, scrollable.lastScrollTop, diff, needScrollTop);\r\n\r\n      scrollable.scrollTop = needScrollTop;\r\n      height = newHeight;\r\n\r\n      if(setScrollTopTimeout) clearTimeout(setScrollTopTimeout);\r\n      setScrollTopTimeout = window.setTimeout(() => { // * try again for scrolled down Android Chrome\r\n        scrollable.scrollTop = needScrollTop;\r\n\r\n        //console.log('resize after', scrollable.scrollTop, scrollable.container.clientHeight, scrollable.scrollHeight, scrollable.isScrolledDown, scrollable.lastScrollTop, isScrolledDown);\r\n        setScrollTopTimeout = 0;\r\n      }, 0);\r\n    }); */\r\n\r\n    const c = this.controlContainer = document.createElement('div');\r\n    c.classList.add('chat-input-control', 'chat-input-wrapper');\r\n    this.inputContainer.append(c);\r\n  }\r\n\r\n  public constructPeerHelpers() {\r\n    this.replyElements.container = document.createElement('div');\r\n    this.replyElements.container.classList.add('reply-wrapper');\r\n\r\n    this.replyElements.iconBtn = ButtonIcon('');\r\n    this.replyElements.cancelBtn = ButtonIcon('close reply-cancel', {noRipple: true});\r\n\r\n    this.replyElements.container.append(this.replyElements.iconBtn, this.replyElements.cancelBtn);\r\n\r\n    //\r\n\r\n    const onHideAuthorClick = () => {\r\n      isChangingAuthor = true;\r\n      return this.canToggleHideAuthor();\r\n    };\r\n\r\n    const onHideCaptionClick = () => {\r\n      isChangingAuthor = false;\r\n    };\r\n\r\n    const forwardElements: ChatInput['forwardElements'] = this.forwardElements = {} as any;\r\n    let isChangingAuthor = false;\r\n    const forwardButtons: ButtonMenuItemOptions[] = [\r\n      forwardElements.showSender = {\r\n        text: 'Chat.Alert.Forward.Action.Show1',\r\n        onClick: onHideAuthorClick,\r\n        checkboxField: new CheckboxField({checked: true})\r\n      },\r\n      forwardElements.hideSender = {\r\n        text: 'Chat.Alert.Forward.Action.Hide1',\r\n        onClick: onHideAuthorClick,\r\n        checkboxField: new CheckboxField({checked: false})\r\n      },\r\n      forwardElements.showCaption = {\r\n        text: 'Chat.Alert.Forward.Action.ShowCaption',\r\n        onClick: onHideCaptionClick,\r\n        checkboxField: new CheckboxField({checked: true})\r\n      },\r\n      forwardElements.hideCaption = {\r\n        text: 'Chat.Alert.Forward.Action.HideCaption',\r\n        onClick: onHideCaptionClick,\r\n        checkboxField: new CheckboxField({checked: false})\r\n      },\r\n      forwardElements.changePeer = {\r\n        text: 'Chat.Alert.Forward.Action.Another',\r\n        onClick: () => {\r\n          this.changeForwardRecipient();\r\n        },\r\n        icon: 'replace'\r\n      }\r\n    ];\r\n    const forwardBtnMenu = forwardElements.container = ButtonMenu(forwardButtons, this.listenerSetter);\r\n    // forwardBtnMenu.classList.add('top-center');\r\n\r\n    const children = Array.from(forwardBtnMenu.children) as HTMLElement[];\r\n    const groups: {\r\n      elements: HTMLElement[],\r\n      onChange: (value: string, event: Event) => void\r\n    }[] = [{\r\n      elements: children.slice(0, 2),\r\n      onChange: (value, e) => {\r\n        const checked = !!+value;\r\n        if(isChangingAuthor) {\r\n          this.forwardWasDroppingAuthor = !checked;\r\n        }\r\n\r\n        const replyTitle = this.replyElements.container.querySelector('.reply-title');\r\n        if(replyTitle) {\r\n          const el = replyTitle.firstElementChild as HTMLElement;\r\n          const i = I18n.weakMap.get(el) as I18n.IntlElement;\r\n          const langPackKey: LangPackKey = forwardElements.showSender.checkboxField.checked ? 'Chat.Accessory.Forward' : 'Chat.Accessory.Hidden';\r\n          i.key = langPackKey;\r\n          i.update();\r\n        }\r\n      }\r\n    }, {\r\n      elements: children.slice(2, 4),\r\n      onChange: (value) => {\r\n        const checked = !!+value;\r\n        let b: ButtonMenuItemOptions;\r\n        if(checked && this.forwardWasDroppingAuthor !== undefined) {\r\n          b = this.forwardWasDroppingAuthor ? forwardElements.hideSender : forwardElements.showSender;\r\n        } else {\r\n          b = checked ? forwardElements.showSender : forwardElements.hideSender;\r\n        }\r\n\r\n        b.checkboxField.checked = true;\r\n      }\r\n    }];\r\n    groups.forEach((group) => {\r\n      const container = RadioForm(group.elements.map((e) => {\r\n        return {\r\n          container: e,\r\n          input: e.querySelector('input')\r\n        };\r\n      }), group.onChange);\r\n\r\n      const hr = document.createElement('hr');\r\n      container.append(hr);\r\n      forwardBtnMenu.append(container);\r\n    });\r\n\r\n    forwardBtnMenu.append(forwardElements.changePeer.element);\r\n\r\n    if(!IS_TOUCH_SUPPORTED) {\r\n      const forwardHover = this.forwardHover = new DropdownHover({\r\n        element: forwardBtnMenu\r\n      });\r\n    }\r\n\r\n    forwardElements.modifyArgs = forwardButtons.slice(0, -1);\r\n    this.replyElements.container.append(forwardBtnMenu);\r\n\r\n    forwardElements.modifyArgs.forEach((b, idx) => {\r\n      const {input} = b.checkboxField;\r\n      input.type = 'radio';\r\n      input.name = idx < 2 ? 'author' : 'caption';\r\n      input.value = '' + +!(idx % 2);\r\n    });\r\n\r\n    //\r\n\r\n    this.newMessageWrapper = document.createElement('div');\r\n    this.newMessageWrapper.classList.add('new-message-wrapper');\r\n\r\n    this.btnToggleEmoticons = ButtonIcon('none toggle-emoticons', {noRipple: true});\r\n\r\n    this.inputMessageContainer = document.createElement('div');\r\n    this.inputMessageContainer.classList.add('input-message-container');\r\n\r\n    if(this.chat.type === 'chat') {\r\n      this.goDownUnreadBadge = document.createElement('span');\r\n      this.goDownUnreadBadge.classList.add('badge', 'badge-24', 'badge-primary');\r\n      this.goDownBtn.append(this.goDownUnreadBadge);\r\n\r\n      this.goMentionBtn = ButtonCorner({icon: 'mention', className: 'bubbles-corner-button bubbles-go-mention'});\r\n      this.goMentionUnreadBadge = document.createElement('span');\r\n      this.goMentionUnreadBadge.classList.add('badge', 'badge-24', 'badge-primary');\r\n      this.goMentionBtn.append(this.goMentionUnreadBadge);\r\n      this.inputContainer.append(this.goMentionBtn);\r\n\r\n      attachClickEvent(this.goMentionBtn, (e) => {\r\n        cancelEvent(e);\r\n        const middleware = this.chat.bubbles.getMiddleware();\r\n        this.managers.appMessagesManager.goToNextMention(this.chat.peerId).then((mid) => {\r\n          if(!middleware()) {\r\n            return;\r\n          }\r\n\r\n          if(mid) {\r\n            this.chat.setMessageId(mid);\r\n          }\r\n        });\r\n      }, {listenerSetter: this.listenerSetter});\r\n\r\n      this.btnScheduled = ButtonIcon('scheduled btn-scheduled float hide', {noRipple: true});\r\n\r\n      attachClickEvent(this.btnScheduled, (e) => {\r\n        this.appImManager.openScheduled(this.chat.peerId);\r\n      }, {listenerSetter: this.listenerSetter});\r\n\r\n      this.listenerSetter.add(rootScope)('scheduled_new', ({peerId}) => {\r\n        if(this.chat.peerId !== peerId) {\r\n          return;\r\n        }\r\n\r\n        this.btnScheduled.classList.remove('hide');\r\n      });\r\n\r\n      this.listenerSetter.add(rootScope)('scheduled_delete', ({peerId}) => {\r\n        if(this.chat.peerId !== peerId) {\r\n          return;\r\n        }\r\n\r\n        this.managers.appMessagesManager.getScheduledMessages(this.chat.peerId).then((value) => {\r\n          this.btnScheduled.classList.toggle('hide', !value.length);\r\n        });\r\n      });\r\n\r\n      this.btnToggleReplyMarkup = ButtonIcon('botcom toggle-reply-markup float hide', {noRipple: true});\r\n      this.replyKeyboard = new ReplyKeyboard({\r\n        appendTo: this.rowsWrapper,\r\n        listenerSetter: this.listenerSetter,\r\n        managers: this.managers,\r\n        btnHover: this.btnToggleReplyMarkup,\r\n        chatInput: this\r\n      });\r\n      this.listenerSetter.add(this.replyKeyboard)('open', () => this.btnToggleReplyMarkup.classList.add('active'));\r\n      this.listenerSetter.add(this.replyKeyboard)('close', () => this.btnToggleReplyMarkup.classList.remove('active'));\r\n\r\n      this.botCommands = new ChatBotCommands(this.rowsWrapper, this, this.managers);\r\n      this.botCommandsToggle = document.createElement('div');\r\n      this.botCommandsToggle.classList.add('new-message-bot-commands');\r\n\r\n      const scaler = document.createElement('div');\r\n      scaler.classList.add('new-message-bot-commands-icon-scale');\r\n\r\n      const icon = this.botCommandsIcon = document.createElement('div');\r\n      icon.classList.add('animated-menu-icon', 'animated-menu-close-icon');\r\n      scaler.append(icon);\r\n      this.botCommandsToggle.append(scaler);\r\n\r\n      attachClickEvent(this.botCommandsToggle, (e) => {\r\n        cancelEvent(e);\r\n        const isShown = icon.classList.contains('state-back');\r\n        if(isShown) {\r\n          this.botCommands.toggle(true);\r\n          icon.classList.remove('state-back');\r\n        } else {\r\n          this.botCommands.setUserId(this.chat.peerId.toUserId(), this.chat.bubbles.getMiddleware());\r\n          icon.classList.add('state-back');\r\n        }\r\n      }, {listenerSetter: this.listenerSetter});\r\n\r\n      this.botCommands.addEventListener('visible', () => {\r\n        icon.classList.add('state-back');\r\n      });\r\n\r\n      this.botCommands.addEventListener('hiding', () => {\r\n        icon.classList.remove('state-back');\r\n      });\r\n    }\r\n\r\n    this.attachMenuButtons = [{\r\n      icon: 'image',\r\n      text: 'Chat.Input.Attach.PhotoOrVideo',\r\n      onClick: () => {\r\n        this.fileInput.value = '';\r\n        const accept = [...MEDIA_MIME_TYPES_SUPPORTED].join(', ');\r\n        this.fileInput.setAttribute('accept', accept);\r\n        this.willAttachType = 'media';\r\n        this.fileInput.click();\r\n      },\r\n      verify: () => this.chat.canSend('send_media')\r\n    }, {\r\n      icon: 'document',\r\n      text: 'Chat.Input.Attach.Document',\r\n      onClick: () => {\r\n        this.fileInput.value = '';\r\n        this.fileInput.removeAttribute('accept');\r\n        this.willAttachType = 'document';\r\n        this.fileInput.click();\r\n      },\r\n      verify: () => this.chat.canSend('send_media')\r\n    }, {\r\n      icon: 'poll',\r\n      text: 'Poll',\r\n      onClick: () => {\r\n        PopupElement.createPopup(PopupCreatePoll, this.chat).show();\r\n      },\r\n      verify: (peerId) => peerId.isAnyChat() && this.chat.canSend('send_polls')\r\n    }];\r\n\r\n    this.attachMenu = ButtonMenuToggle({noRipple: true, listenerSetter: this.listenerSetter}, 'top-left', this.attachMenuButtons);\r\n    this.attachMenu.classList.add('attach-file', 'tgico-attach');\r\n    this.attachMenu.classList.remove('tgico-more');\r\n\r\n    // this.inputContainer.append(this.sendMenu);\r\n\r\n    this.recordTimeEl = document.createElement('div');\r\n    this.recordTimeEl.classList.add('record-time');\r\n\r\n    this.fileInput = document.createElement('input');\r\n    this.fileInput.type = 'file';\r\n    this.fileInput.multiple = true;\r\n    this.fileInput.style.display = 'none';\r\n\r\n    this.newMessageWrapper.append(...[this.botCommandsToggle, this.btnToggleEmoticons, this.inputMessageContainer, this.btnScheduled, this.btnToggleReplyMarkup, this.attachMenu, this.recordTimeEl, this.fileInput].filter(Boolean));\r\n\r\n    this.rowsWrapper.append(this.replyElements.container);\r\n    this.autocompleteHelperController = new AutocompleteHelperController();\r\n    this.stickersHelper = new StickersHelper(this.rowsWrapper, this.autocompleteHelperController, this.managers);\r\n    this.emojiHelper = new EmojiHelper(this.rowsWrapper, this.autocompleteHelperController, this, this.managers);\r\n    this.commandsHelper = new CommandsHelper(this.rowsWrapper, this.autocompleteHelperController, this, this.managers);\r\n    this.mentionsHelper = new MentionsHelper(this.rowsWrapper, this.autocompleteHelperController, this, this.managers);\r\n    this.inlineHelper = new InlineHelper(this.rowsWrapper, this.autocompleteHelperController, this.chat, this.managers);\r\n    this.rowsWrapper.append(this.newMessageWrapper);\r\n\r\n    this.btnCancelRecord = ButtonIcon('delete btn-circle z-depth-1 btn-record-cancel');\r\n\r\n    this.btnSendContainer = document.createElement('div');\r\n    this.btnSendContainer.classList.add('btn-send-container');\r\n\r\n    this.recordRippleEl = document.createElement('div');\r\n    this.recordRippleEl.classList.add('record-ripple');\r\n\r\n    this.btnSend = ButtonIcon('none btn-circle z-depth-1 btn-send animated-button-icon');\r\n    this.btnSend.insertAdjacentHTML('afterbegin', `\r\n    <span class=\"tgico tgico-send\"></span>\r\n    <span class=\"tgico tgico-schedule\"></span>\r\n    <span class=\"tgico tgico-check\"></span>\r\n    <span class=\"tgico tgico-microphone_filled\"></span>\r\n    `);\r\n\r\n    this.btnSendContainer.append(this.recordRippleEl, this.btnSend);\r\n\r\n    if(this.chat.type !== 'scheduled') {\r\n      this.sendMenu = new SendMenu({\r\n        onSilentClick: () => {\r\n          this.sendSilent = true;\r\n          this.sendMessage();\r\n        },\r\n        onScheduleClick: () => {\r\n          this.scheduleSending(undefined);\r\n        },\r\n        listenerSetter: this.listenerSetter,\r\n        openSide: 'top-left',\r\n        onContextElement: this.btnSend,\r\n        onOpen: () => {\r\n          return !this.isInputEmpty() || !!Object.keys(this.forwarding).length;\r\n        }\r\n      });\r\n\r\n      this.btnSendContainer.append(this.sendMenu.sendMenu);\r\n    }\r\n\r\n    this.inputContainer.append(this.btnCancelRecord, this.btnSendContainer);\r\n\r\n    emoticonsDropdown.attachButtonListener(this.btnToggleEmoticons, this.listenerSetter);\r\n    this.listenerSetter.add(emoticonsDropdown)('open', this.onEmoticonsOpen);\r\n    this.listenerSetter.add(emoticonsDropdown)('close', this.onEmoticonsClose);\r\n\r\n    this.attachMessageInputField();\r\n\r\n    /* this.attachMenu.addEventListener('mousedown', (e) => {\r\n      const hidden = this.attachMenu.querySelectorAll('.hide');\r\n      if(hidden.length === this.attachMenuButtons.length) {\r\n        toast(POSTING_MEDIA_NOT_ALLOWED);\r\n        cancelEvent(e);\r\n        return false;\r\n      }\r\n    }, {passive: false, capture: true}); */\r\n\r\n    this.listenerSetter.add(rootScope)('settings_updated', () => {\r\n      if(this.stickersHelper || this.emojiHelper) {\r\n        // this.previousQuery = undefined;\r\n        this.previousQuery = '';\r\n        this.checkAutocomplete();\r\n        /* if(!rootScope.settings.stickers.suggest) {\r\n          this.stickersHelper.checkEmoticon('');\r\n        } else {\r\n          this.onMessageInput();\r\n        } */\r\n      }\r\n\r\n      if(this.messageInputField) {\r\n        this.messageInputField.onFakeInput();\r\n      }\r\n    });\r\n\r\n    this.listenerSetter.add(rootScope)('draft_updated', ({peerId, threadId, draft, force}) => {\r\n      if(this.chat.threadId !== threadId || this.chat.peerId !== peerId) return;\r\n      this.setDraft(draft, true, force);\r\n    });\r\n\r\n    this.listenerSetter.add(this.appImManager)('peer_changing', (chat) => {\r\n      if(this.chat === chat) {\r\n        this.saveDraft();\r\n      }\r\n    });\r\n\r\n    this.listenerSetter.add(this.appImManager)('chat_changing', ({from, to}) => {\r\n      if(this.chat === from) {\r\n        this.autocompleteHelperController.toggleListNavigation(false);\r\n      } else if(this.chat === to) {\r\n        this.autocompleteHelperController.toggleListNavigation(true);\r\n      }\r\n    });\r\n\r\n    if(this.chat.type === 'scheduled') {\r\n      this.listenerSetter.add(rootScope)('scheduled_delete', ({peerId, mids}) => {\r\n        if(this.chat.peerId === peerId && mids.includes(this.editMsgId)) {\r\n          this.onMessageSent();\r\n        }\r\n      });\r\n    } else {\r\n      this.listenerSetter.add(rootScope)('history_delete', ({peerId, msgs}) => {\r\n        if(this.chat.peerId === peerId) {\r\n          if(msgs.has(this.editMsgId)) {\r\n            this.onMessageSent();\r\n          }\r\n\r\n          if(this.replyToMsgId && msgs.has(this.replyToMsgId)) {\r\n            this.clearHelper('reply');\r\n          }\r\n\r\n          /* if(this.chat.isStartButtonNeeded()) {\r\n            this.setStartParam(BOT_START_PARAM);\r\n          } */\r\n        }\r\n      });\r\n\r\n      this.listenerSetter.add(rootScope)('dialogs_multiupdate', (dialogs) => {\r\n        if(dialogs.has(this.chat.peerId)) {\r\n          if(this.startParam === BOT_START_PARAM) {\r\n            this.setStartParam();\r\n          } else { // updateNewMessage comes earlier than dialog appers\r\n            this.center(true);\r\n          }\r\n        }\r\n      });\r\n    }\r\n\r\n    try {\r\n      this.recorder = new Recorder({\r\n        // encoderBitRate: 32,\r\n        // encoderPath: \"../dist/encoderWorker.min.js\",\r\n        encoderSampleRate: 48000,\r\n        monitorGain: 0,\r\n        numberOfChannels: 1,\r\n        recordingGain: 1,\r\n        reuseWorker: true\r\n      });\r\n    } catch(err) {\r\n      console.error('Recorder constructor error:', err);\r\n    }\r\n\r\n    this.updateSendBtn();\r\n\r\n    this.listenerSetter.add(this.fileInput)('change', (e) => {\r\n      const files = (e.target as HTMLInputElement & EventTarget).files;\r\n      if(!files.length) {\r\n        return;\r\n      }\r\n\r\n      PopupElement.createPopup(PopupNewMedia, this.chat, Array.from(files).slice(), this.willAttachType);\r\n      this.fileInput.value = '';\r\n    }, false);\r\n\r\n    /* let time = Date.now();\r\n    this.btnSend.addEventListener('touchstart', (e) => {\r\n      time = Date.now();\r\n    });\r\n\r\n    let eventName1 = 'touchend';\r\n    this.btnSend.addEventListener(eventName1, (e: Event) => {\r\n      //cancelEvent(e);\r\n      console.log(eventName1 + ', time: ' + (Date.now() - time));\r\n    });\r\n\r\n    let eventName = 'mousedown';\r\n    this.btnSend.addEventListener(eventName, (e: Event) => {\r\n      cancelEvent(e);\r\n      console.log(eventName + ', time: ' + (Date.now() - time));\r\n    }); */\r\n    attachClickEvent(this.btnSend, this.onBtnSendClick, {listenerSetter: this.listenerSetter, touchMouseDown: true});\r\n\r\n    if(this.recorder) {\r\n      attachClickEvent(this.btnCancelRecord, this.onCancelRecordClick, {listenerSetter: this.listenerSetter});\r\n\r\n      this.recorder.onstop = () => {\r\n        this.setRecording(false);\r\n        this.chatInput.classList.remove('is-locked');\r\n        this.recordRippleEl.style.transform = '';\r\n      };\r\n\r\n      this.recorder.ondataavailable = (typedArray: Uint8Array) => {\r\n        if(this.releaseMediaPlayback) {\r\n          this.releaseMediaPlayback();\r\n          this.releaseMediaPlayback = undefined;\r\n        }\r\n\r\n        if(this.recordingOverlayListener) {\r\n          this.listenerSetter.remove(this.recordingOverlayListener);\r\n          this.recordingOverlayListener = undefined;\r\n        }\r\n\r\n        if(this.recordingNavigationItem) {\r\n          appNavigationController.removeItem(this.recordingNavigationItem);\r\n          this.recordingNavigationItem = undefined;\r\n        }\r\n\r\n        if(this.recordCanceled) {\r\n          return;\r\n        }\r\n\r\n        const {peerId, threadId} = this.chat;\r\n        const replyToMsgId = this.replyToMsgId;\r\n\r\n        const duration = (Date.now() - this.recordStartTime) / 1000 | 0;\r\n        const dataBlob = new Blob([typedArray], {type: 'audio/ogg'});\r\n        /* const fileName = new Date().toISOString() + \".opus\";\r\n        console.log('Recorder data received', typedArray, dataBlob); */\r\n\r\n        // let perf = performance.now();\r\n        opusDecodeController.decode(typedArray, true).then((result) => {\r\n          // console.log('WAVEFORM!:', /* waveform,  */performance.now() - perf);\r\n\r\n          opusDecodeController.setKeepAlive(false);\r\n\r\n          //  objectURL    audio/wav\r\n          this.managers.appMessagesManager.sendFile(peerId, dataBlob, {\r\n            isVoiceMessage: true,\r\n            isMedia: true,\r\n            duration,\r\n            waveform: result.waveform,\r\n            objectURL: result.url,\r\n            replyToMsgId,\r\n            threadId,\r\n            clearDraft: true\r\n          });\r\n\r\n          this.onMessageSent(false, true);\r\n        });\r\n      };\r\n    }\r\n\r\n    attachClickEvent(this.replyElements.cancelBtn, this.onHelperCancel, {listenerSetter: this.listenerSetter});\r\n    attachClickEvent(this.replyElements.container, this.onHelperClick, {listenerSetter: this.listenerSetter});\r\n\r\n    this.saveDraftDebounced = debounce(() => this.saveDraft(), 2500, false, true);\r\n\r\n    this.botStartBtn = Button('btn-primary btn-transparent text-bold chat-input-control-button');\r\n    this.botStartBtn.append(i18n('BotStart'));\r\n\r\n    attachClickEvent(this.botStartBtn, () => {\r\n      const {startParam} = this;\r\n      if(startParam === undefined) {\r\n        return;\r\n      }\r\n\r\n      const toggle = this.toggleBotStartBtnDisability = toggleDisability([this.botStartBtn], true);\r\n      const peerId = this.chat.peerId;\r\n      const middleware = this.chat.bubbles.getMiddleware(() => {\r\n        return this.chat.peerId === peerId && this.startParam === startParam && this.toggleBotStartBtnDisability === toggle;\r\n      });\r\n\r\n      this.managers.appMessagesManager.startBot(peerId.toUserId(), undefined, startParam).then(() => {\r\n        if(middleware()) {\r\n          toggle();\r\n          this.toggleBotStartBtnDisability = undefined;\r\n          this.setStartParam();\r\n        }\r\n      });\r\n    }, {listenerSetter: this.listenerSetter});\r\n\r\n    this.controlContainer.append(this.botStartBtn);\r\n  }\r\n\r\n  public constructPinnedHelpers() {\r\n    this.pinnedControlBtn = Button('btn-primary btn-transparent text-bold chat-input-control-button', {icon: 'unpin'});\r\n    this.controlContainer.append(this.pinnedControlBtn);\r\n\r\n    this.listenerSetter.add(this.pinnedControlBtn)('click', () => {\r\n      const peerId = this.chat.peerId;\r\n\r\n      new PopupPinMessage(peerId, 0, true, () => {\r\n        this.chat.appImManager.setPeer(); // * close tab\r\n\r\n        // ! ,     ,  ,      \r\n        const originalChat = this.chat.appImManager.chat;\r\n        if(originalChat.topbar.pinnedMessage) {\r\n          originalChat.topbar.pinnedMessage.pinnedMessageContainer.toggle(true);\r\n        }\r\n      });\r\n    });\r\n\r\n    this.chatInput.classList.add('type-pinned');\r\n  }\r\n\r\n  public _center(neededFakeContainer: HTMLElement, animate?: boolean) {\r\n    if(!neededFakeContainer && !this.inputContainer.classList.contains('is-centering')) {\r\n      return;\r\n    }\r\n\r\n    if(neededFakeContainer === this.fakeWrapperTo) {\r\n      return;\r\n    }\r\n\r\n    /* if(neededFakeContainer === this.botStartContainer && this.fakeWrapperTo === this.fakeSelectionWrapper) {\r\n      this.inputContainer.classList.remove('is-centering');\r\n      void this.rowsWrapper.offsetLeft; // reflow\r\n      // this.inputContainer.classList.add('is-centering');\r\n      // void this.rowsWrapper.offsetLeft; // reflow\r\n    } */\r\n\r\n    const fakeSelectionWrapper = neededFakeContainer || this.fakeWrapperTo;\r\n    const forwards = !!neededFakeContainer;\r\n    const oldFakeWrapperTo = this.fakeWrapperTo;\r\n    let transform = '', borderRadius = '', needTranslateX: number;\r\n    // if(forwards) {]\r\n    const fakeSelectionRect = fakeSelectionWrapper.getBoundingClientRect();\r\n    const fakeRowsRect = this.fakeRowsWrapper.getBoundingClientRect();\r\n    const widthFrom = fakeRowsRect.width;\r\n    const widthTo = fakeSelectionRect.width;\r\n\r\n    if(widthFrom !== widthTo) {\r\n      const scale = (widthTo/*  - 8 */) / widthFrom;\r\n      const initTranslateX = (widthFrom - widthTo) / 2;\r\n      needTranslateX = fakeSelectionRect.left - fakeRowsRect.left - initTranslateX;\r\n\r\n      if(forwards) {\r\n        transform = `translateX(${needTranslateX}px) scaleX(${scale})`;\r\n        // transform = `translateX(0px) scaleX(${scale})`;\r\n\r\n        if(scale < 1) {\r\n          const br = 12;\r\n          borderRadius = '' + (br + br * (1 - scale)) + 'px';\r\n        }\r\n      }\r\n      // scale = widthTo / widthFrom;\r\n    }\r\n    // }\r\n\r\n    this.fakeWrapperTo = neededFakeContainer;\r\n\r\n    const duration = animate ? 200 : 0;\r\n    SetTransition(this.inputContainer, 'is-centering', forwards, duration);\r\n    SetTransition(this.rowsWrapperWrapper, 'is-centering-to-control', !!(forwards && neededFakeContainer && neededFakeContainer.classList.contains('chat-input-control')), duration);\r\n    this.rowsWrapper.style.transform = transform;\r\n    this.rowsWrapper.style.borderRadius = borderRadius;\r\n\r\n    return {\r\n      transform,\r\n      borderRadius,\r\n      needTranslateX: oldFakeWrapperTo && (\r\n          (\r\n            neededFakeContainer &&\r\n            neededFakeContainer.classList.contains('chat-input-control') &&\r\n            oldFakeWrapperTo === this.fakeSelectionWrapper\r\n          ) || oldFakeWrapperTo.classList.contains('chat-input-control')\r\n        ) ? needTranslateX * -.5 : needTranslateX,\r\n      widthFrom,\r\n      widthTo\r\n    };\r\n  }\r\n\r\n  public async center(animate = false) {\r\n    return this._center(await this.getNeededFakeContainer(), animate);\r\n  }\r\n\r\n  public setStartParam(startParam?: string) {\r\n    if(this.startParam === startParam) {\r\n      return;\r\n    }\r\n\r\n    this.startParam = startParam;\r\n    this.center(true);\r\n  }\r\n\r\n  public async getNeededFakeContainer(startParam = this.startParam) {\r\n    if(this.chat.selection.isSelecting) {\r\n      return this.fakeSelectionWrapper;\r\n    } else if(\r\n      startParam !== undefined ||\r\n      !(await this.chat.canSend()) ||\r\n      this.chat.type === 'pinned' ||\r\n      await this.chat.isStartButtonNeeded()\r\n    ) {\r\n      return this.controlContainer;\r\n    }\r\n  }\r\n\r\n  // public getActiveContainer() {\r\n  //   if(this.chat.selection.isSelecting) {\r\n  //     return this.chat\r\n  //   }\r\n  //   return this.startParam !== undefined ? this.botStartContainer : this.rowsWrapper;\r\n  // }\r\n\r\n  // public setActiveContainer() {\r\n  //   const container = this.activeContainer;\r\n  //   const newContainer = this.getActiveContainer();\r\n  //   if(newContainer === container) {\r\n  //     return;\r\n  //   }\r\n\r\n\r\n  // }\r\n\r\n  private onCancelRecordClick = (e?: Event) => {\r\n    if(e) {\r\n      cancelEvent(e);\r\n    }\r\n\r\n    this.recordCanceled = true;\r\n    this.recorder.stop();\r\n    opusDecodeController.setKeepAlive(false);\r\n  };\r\n\r\n  private onEmoticonsOpen = () => {\r\n    const toggleClass = IS_TOUCH_SUPPORTED ? 'flip-icon' : 'active';\r\n    this.btnToggleEmoticons.classList.toggle(toggleClass, true);\r\n  };\r\n\r\n  private onEmoticonsClose = () => {\r\n    const toggleClass = IS_TOUCH_SUPPORTED ? 'flip-icon' : 'active';\r\n    this.btnToggleEmoticons.classList.toggle(toggleClass, false);\r\n  };\r\n\r\n  public getReadyToSend(callback: () => void) {\r\n    return this.chat.type === 'scheduled' ? (this.scheduleSending(callback), true) : (callback(), false);\r\n  }\r\n\r\n  public scheduleSending = async(callback: () => void = this.sendMessage.bind(this, true), initDate = new Date()) => {\r\n    const {peerId} = this.chat;\r\n    const middleware = this.chat.bubbles.getMiddleware();\r\n    const canSendWhenOnline = rootScope.myId !== peerId && peerId.isUser() && await this.managers.appUsersManager.isUserOnlineVisible(peerId);\r\n\r\n    new PopupSchedule(initDate, (timestamp) => {\r\n      if(!middleware()) {\r\n        return;\r\n      }\r\n\r\n      const minTimestamp = (Date.now() / 1000 | 0) + 10;\r\n      if(timestamp <= minTimestamp) {\r\n        timestamp = undefined;\r\n      }\r\n\r\n      this.scheduleDate = timestamp;\r\n      callback();\r\n\r\n      if(this.chat.type !== 'scheduled' && timestamp) {\r\n        setTimeout(() => { // ! need timeout here because .forwardMessages will be called after timeout\r\n          if(!middleware()) {\r\n            return;\r\n          }\r\n\r\n          const popups = PopupElement.getPopups(PopupStickers);\r\n          popups.forEach((popup) => popup.hide());\r\n\r\n          this.appImManager.openScheduled(peerId);\r\n        }, 0);\r\n      }\r\n    }, canSendWhenOnline).show();\r\n  };\r\n\r\n  public async setUnreadCount() {\r\n    if(!this.goDownUnreadBadge) {\r\n      return;\r\n    }\r\n\r\n    const dialog = await this.managers.appMessagesManager.getDialogOnly(this.chat.peerId);\r\n    const count = dialog?.unread_count;\r\n    this.goDownUnreadBadge.innerText = '' + (count || '');\r\n    this.goDownUnreadBadge.classList.toggle('badge-gray', await this.managers.appNotificationsManager.isPeerLocalMuted(this.chat.peerId, true));\r\n\r\n    if(this.goMentionUnreadBadge && this.chat.type === 'chat') {\r\n      const hasMentions = !!(dialog?.unread_mentions_count && dialog.unread_count);\r\n      this.goMentionUnreadBadge.innerText = hasMentions ? '' + (dialog.unread_mentions_count) : '';\r\n      this.goMentionBtn.classList.toggle('is-visible', hasMentions);\r\n    }\r\n  }\r\n\r\n  public saveDraft() {\r\n    if(!this.chat.peerId || this.editMsgId || this.chat.type === 'scheduled') return;\r\n\r\n    const {value, entities} = getRichValue(this.messageInputField.input);\r\n\r\n    let draft: DraftMessage.draftMessage;\r\n    if(value.length || this.replyToMsgId) {\r\n      draft = {\r\n        _: 'draftMessage',\r\n        date: tsNow(true),\r\n        message: value,\r\n        entities: entities.length ? entities : undefined,\r\n        pFlags: {\r\n          no_webpage: this.noWebPage\r\n        },\r\n        reply_to_msg_id: this.replyToMsgId\r\n      };\r\n    }\r\n\r\n    this.managers.appDraftsManager.syncDraft(this.chat.peerId, this.chat.threadId, draft);\r\n  }\r\n\r\n  public destroy() {\r\n    // this.chat.log.error('Input destroying');\r\n\r\n    this.listenerSetter.removeAll();\r\n  }\r\n\r\n  public cleanup(helperToo = true) {\r\n    if(!this.chat.peerId) {\r\n      this.chatInput.classList.add('hide');\r\n      this.goDownBtn.classList.add('hide');\r\n    }\r\n\r\n    cancelSelection();\r\n\r\n    this.lastTimeType = 0;\r\n    this.startParam = undefined;\r\n\r\n    if(this.toggleBotStartBtnDisability) {\r\n      this.toggleBotStartBtnDisability();\r\n      this.toggleBotStartBtnDisability = undefined;\r\n    }\r\n\r\n    if(this.messageInput) {\r\n      this.clearInput();\r\n      helperToo && this.clearHelper();\r\n    }\r\n  }\r\n\r\n  public async setDraft(draft?: MyDraftMessage, fromUpdate = true, force = false) {\r\n    if((!force && !isInputEmpty(this.messageInput)) || this.chat.type === 'scheduled') return false;\r\n\r\n    if(!draft) {\r\n      draft = await this.managers.appDraftsManager.getDraft(this.chat.peerId, this.chat.threadId);\r\n\r\n      if(!draft) {\r\n        if(force) { // this situation can only happen when sending message with clearDraft\r\n          /* const height = this.chatInput.getBoundingClientRect().height;\r\n          const willChangeHeight = 78 - height;\r\n          this.willChangeHeight = willChangeHeight; */\r\n          if(this.chat.container.classList.contains('is-helper-active')) {\r\n            this.t();\r\n          }\r\n\r\n          this.messageInputField.inputFake.textContent = '';\r\n          this.messageInputField.onFakeInput(false);\r\n\r\n          ((this.chat.bubbles.messagesQueuePromise || Promise.resolve()) as Promise<any>).then(() => {\r\n            fastRaf(() => {\r\n              this.onMessageSent();\r\n            });\r\n          });\r\n        }\r\n\r\n        return false;\r\n      }\r\n    }\r\n\r\n    const wrappedDraft = wrapDraft(draft);\r\n\r\n    if(this.messageInputField.value === wrappedDraft && this.replyToMsgId === draft.reply_to_msg_id) return false;\r\n\r\n    if(fromUpdate) {\r\n      this.clearHelper();\r\n    }\r\n\r\n    this.noWebPage = draft.pFlags.no_webpage;\r\n    if(draft.reply_to_msg_id) {\r\n      this.initMessageReply(draft.reply_to_msg_id);\r\n    }\r\n\r\n    this.setInputValue(wrappedDraft, fromUpdate, fromUpdate);\r\n    return true;\r\n  }\r\n\r\n  private createSendAs() {\r\n    this.sendAsPeerId = undefined;\r\n\r\n    if(this.chat.type === 'chat' || this.chat.type === 'discussion') {\r\n      let firstChange = true;\r\n      this.sendAs = new ChatSendAs(\r\n        this.managers,\r\n        (container, skipAnimation) => {\r\n          let useRafs = 0;\r\n          if(!container.parentElement) {\r\n            this.newMessageWrapper.prepend(container);\r\n            useRafs = 2;\r\n          }\r\n\r\n          this.updateOffset('as', true, skipAnimation, useRafs);\r\n        },\r\n        (sendAsPeerId) => {\r\n          this.sendAsPeerId = sendAsPeerId;\r\n\r\n          // do not change placeholder earlier than finishPeerChange does\r\n          if(firstChange) {\r\n            firstChange = false;\r\n            return;\r\n          }\r\n\r\n          this.getPlaceholderKey().then((key) => {\r\n            this.updateMessageInputPlaceholder(key);\r\n          });\r\n        }\r\n      );\r\n    } else {\r\n      this.sendAs = undefined;\r\n    }\r\n\r\n    return this.sendAs;\r\n  }\r\n\r\n  public async finishPeerChange(startParam?: string) {\r\n    const peerId = this.chat.peerId;\r\n\r\n    const {forwardElements, btnScheduled, replyKeyboard, sendMenu, goDownBtn, chatInput, botCommandsToggle} = this;\r\n\r\n    const previousSendAs = this.sendAs;\r\n    const sendAs = this.createSendAs();\r\n\r\n    const [\r\n      isBroadcast,\r\n      canPinMessage,\r\n      isBot,\r\n      canSend,\r\n      neededFakeContainer,\r\n      ackedPeerFull,\r\n      ackedScheduledMids,\r\n      setSendAsCallback,\r\n      filteredAttachMenuButtons\r\n    ] = await Promise.all([\r\n      this.managers.appPeersManager.isBroadcast(peerId),\r\n      this.managers.appPeersManager.canPinMessage(peerId),\r\n      this.managers.appPeersManager.isBot(peerId),\r\n      this.chat.canSend(),\r\n      this.getNeededFakeContainer(startParam),\r\n      modifyAckedPromise(this.managers.acknowledged.appProfileManager.getProfileByPeerId(peerId)),\r\n      btnScheduled ? modifyAckedPromise(this.managers.acknowledged.appMessagesManager.getScheduledMessages(peerId)) : undefined,\r\n      sendAs ? (sendAs.setPeerId(this.chat.peerId), sendAs.updateManual(true)) : undefined,\r\n      this.filterAttachMenuButtons()\r\n    ]);\r\n\r\n    const placeholderKey = this.messageInput ? await this.getPlaceholderKey() : undefined;\r\n\r\n    return () => {\r\n      // console.warn('[input] finishpeerchange start');\r\n\r\n      chatInput.classList.remove('hide');\r\n      goDownBtn.classList.toggle('is-broadcast', isBroadcast);\r\n      goDownBtn.classList.remove('hide');\r\n\r\n      if(this.goDownUnreadBadge) {\r\n        this.setUnreadCount();\r\n      }\r\n\r\n      if(this.chat.type === 'pinned') {\r\n        chatInput.classList.toggle('can-pin', canPinMessage);\r\n      }/*  else if(this.chat.type === 'chat') {\r\n      } */\r\n\r\n      if(forwardElements) {\r\n        this.forwardWasDroppingAuthor = false;\r\n        forwardElements.showCaption.checkboxField.setValueSilently(true);\r\n        forwardElements.showSender.checkboxField.setValueSilently(true);\r\n      }\r\n\r\n      if(btnScheduled && ackedScheduledMids) {\r\n        btnScheduled.classList.add('hide');\r\n        const middleware = this.chat.bubbles.getMiddleware();\r\n        callbackify(ackedScheduledMids.result, (mids) => {\r\n          if(!middleware() || !mids) return;\r\n          btnScheduled.classList.toggle('hide', !mids.length);\r\n        });\r\n      }\r\n\r\n      if(this.newMessageWrapper) {\r\n        this.updateOffset(null, false, true);\r\n      }\r\n\r\n      if(botCommandsToggle) {\r\n        this.hasBotCommands = undefined;\r\n        this.botCommands.toggle(true, undefined, true);\r\n        this.updateBotCommandsToggle(true);\r\n        botCommandsToggle.remove();\r\n        if(isBot) {\r\n          const middleware = this.chat.bubbles.getMiddleware();\r\n          const result = ackedPeerFull.result;\r\n          callbackify(result, (userFull) => {\r\n            if(!middleware()) return;\r\n            this.updateBotCommands(userFull as UserFull.userFull, !(result instanceof Promise));\r\n          });\r\n        }\r\n      }\r\n\r\n      if(previousSendAs) {\r\n        previousSendAs.destroy();\r\n      }\r\n\r\n      if(setSendAsCallback) {\r\n        setSendAsCallback();\r\n      }\r\n\r\n      if(replyKeyboard) {\r\n        replyKeyboard.setPeer(peerId);\r\n      }\r\n\r\n      if(sendMenu) {\r\n        sendMenu.setPeerId(peerId);\r\n      }\r\n\r\n      if(this.messageInput) {\r\n        this.updateMessageInput(canSend, placeholderKey, filteredAttachMenuButtons);\r\n      } else if(this.pinnedControlBtn) {\r\n        this.pinnedControlBtn.append(i18n(canPinMessage ? 'Chat.Input.UnpinAll' : 'Chat.Pinned.DontShow'));\r\n      }\r\n\r\n      // * testing\r\n      // this.startParam = this.appPeersManager.isBot(peerId) ? '123' : undefined;\r\n\r\n      this.startParam = startParam;\r\n\r\n      this._center(neededFakeContainer, false);\r\n\r\n      // console.warn('[input] finishpeerchange ends');\r\n    };\r\n  }\r\n\r\n  private updateOffset(type: 'commands' | 'as', forwards: boolean, skipAnimation?: boolean, useRafs?: number) {\r\n    if(type) {\r\n      this.newMessageWrapper.dataset.offset = type;\r\n    } else {\r\n      delete this.newMessageWrapper.dataset.offset;\r\n    }\r\n\r\n    SetTransition(this.newMessageWrapper, 'has-offset', forwards, skipAnimation ? 0 : 300, undefined, useRafs);\r\n  }\r\n\r\n  private updateBotCommands(userFull: UserFull.userFull, skipAnimation?: boolean) {\r\n    this.hasBotCommands = !!userFull.bot_info?.commands?.length;\r\n    this.updateBotCommandsToggle(skipAnimation);\r\n  }\r\n\r\n  private updateBotCommandsToggle(skipAnimation?: boolean) {\r\n    const {botCommandsToggle, hasBotCommands} = this;\r\n\r\n    const show = !!hasBotCommands && this.isInputEmpty();\r\n    if(!hasBotCommands) {\r\n      if(!botCommandsToggle.parentElement) {\r\n        return;\r\n      }\r\n\r\n      botCommandsToggle.remove();\r\n    }\r\n\r\n    const forwards = show;\r\n    const useRafs = botCommandsToggle.parentElement ? 0 : 2;\r\n\r\n    if(!botCommandsToggle.parentElement) {\r\n      this.newMessageWrapper.prepend(botCommandsToggle);\r\n    }\r\n\r\n    this.updateOffset('commands', forwards, skipAnimation, useRafs);\r\n  }\r\n\r\n  private async getPlaceholderKey() {\r\n    const {peerId, threadId} = this.chat;\r\n    let key: LangPackKey;\r\n    if(threadId) {\r\n      key = 'Comment';\r\n    } else if(await this.managers.appPeersManager.isBroadcast(peerId)) {\r\n      key = 'ChannelBroadcast';\r\n    } else if(\r\n      (this.sendAsPeerId !== undefined && this.sendAsPeerId !== rootScope.myId) ||\r\n      await this.managers.appMessagesManager.isAnonymousSending(peerId)\r\n    ) {\r\n      key = 'SendAnonymously';\r\n    } else {\r\n      key = 'Message';\r\n    }\r\n\r\n    return key;\r\n  }\r\n\r\n  private updateMessageInputPlaceholder(key: LangPackKey) {\r\n    // console.warn('[input] update placeholder');\r\n    const i = I18n.weakMap.get(this.messageInput) as I18n.IntlElement;\r\n    if(!i) {\r\n      return;\r\n    }\r\n\r\n    i.compareAndUpdate({key});\r\n  }\r\n\r\n  private filterAttachMenuButtons() {\r\n    if(!this.attachMenuButtons) return;\r\n    const {peerId, threadId} = this.chat;\r\n    return filterAsync(this.attachMenuButtons, (button) => {\r\n      return button.verify(peerId, threadId);\r\n    });\r\n  }\r\n\r\n  public updateMessageInput(canSend: boolean, placeholderKey: LangPackKey, visible: ChatInput['attachMenuButtons']) {\r\n    const {chatInput, attachMenu, messageInput} = this;\r\n    const {peerId, threadId} = this.chat;\r\n    const isHidden = chatInput.classList.contains('is-hidden');\r\n    const willBeHidden = !canSend;\r\n    if(isHidden !== willBeHidden) {\r\n      chatInput.classList.add('no-transition');\r\n      chatInput.classList.toggle('is-hidden', !canSend);\r\n      void chatInput.offsetLeft; // reflow\r\n      chatInput.classList.remove('no-transition');\r\n    }\r\n\r\n    this.updateMessageInputPlaceholder(placeholderKey);\r\n\r\n    this.attachMenuButtons && this.attachMenuButtons.forEach((button) => {\r\n      button.element.classList.toggle('hide', !visible.includes(button));\r\n    });\r\n\r\n    if(!canSend) {\r\n      messageInput.removeAttribute('contenteditable');\r\n    } else {\r\n      messageInput.setAttribute('contenteditable', 'true');\r\n      this.setDraft(undefined, false);\r\n\r\n      if(!messageInput.innerHTML) {\r\n        this.messageInputField.onFakeInput();\r\n      }\r\n    }\r\n\r\n    if(attachMenu) {\r\n      attachMenu.toggleAttribute('disabled', !visible.length);\r\n      attachMenu.classList.toggle('btn-disabled', !visible.length);\r\n    }\r\n\r\n    this.updateSendBtn();\r\n  }\r\n\r\n  private attachMessageInputField() {\r\n    const oldInputField = this.messageInputField;\r\n    this.messageInputField = new InputFieldAnimated({\r\n      placeholder: 'Message',\r\n      name: 'message',\r\n      withLinebreaks: true\r\n    });\r\n\r\n    this.messageInputField.input.classList.replace('input-field-input', 'input-message-input');\r\n    this.messageInputField.inputFake.classList.replace('input-field-input', 'input-message-input');\r\n    this.messageInput = this.messageInputField.input;\r\n    this.messageInput.classList.add('no-scrollbar');\r\n    this.attachMessageInputListeners();\r\n\r\n    if(IS_STICKY_INPUT_BUGGED) {\r\n      fixSafariStickyInputFocusing(this.messageInput);\r\n    }\r\n\r\n    if(oldInputField) {\r\n      oldInputField.input.replaceWith(this.messageInputField.input);\r\n      oldInputField.inputFake.replaceWith(this.messageInputField.inputFake);\r\n    } else {\r\n      this.inputMessageContainer.append(this.messageInputField.input, this.messageInputField.inputFake);\r\n    }\r\n  }\r\n\r\n  private attachMessageInputListeners() {\r\n    this.listenerSetter.add(this.messageInput)('keydown', (e: KeyboardEvent) => {\r\n      const key = e.key;\r\n      if(isSendShortcutPressed(e)) {\r\n        cancelEvent(e);\r\n        this.sendMessage();\r\n      } else if(e.ctrlKey || e.metaKey) {\r\n        this.handleMarkdownShortcut(e);\r\n      } else if((key === 'PageUp' || key === 'PageDown') && !e.shiftKey) { // * fix pushing page to left (Chrome Windows)\r\n        e.preventDefault();\r\n\r\n        if(key === 'PageUp') {\r\n          const range = document.createRange();\r\n          const sel = window.getSelection();\r\n\r\n          range.setStart(this.messageInput.childNodes[0] || this.messageInput, 0);\r\n          range.collapse(true);\r\n\r\n          sel.removeAllRanges();\r\n          sel.addRange(range);\r\n        } else {\r\n          placeCaretAtEnd(this.messageInput);\r\n        }\r\n      }\r\n    });\r\n\r\n    if(IS_TOUCH_SUPPORTED) {\r\n      attachClickEvent(this.messageInput, (e) => {\r\n        this.appImManager.selectTab(1); // * set chat tab for album orientation\r\n        // this.saveScroll();\r\n        emoticonsDropdown.toggle(false);\r\n      }, {listenerSetter: this.listenerSetter});\r\n\r\n      /* this.listenerSetter.add(window)('resize', () => {\r\n        this.restoreScroll();\r\n      }); */\r\n\r\n      /* if(isSafari) {\r\n        this.listenerSetter.add(this.messageInput)('mousedown', () => {\r\n          window.requestAnimationFrame(() => {\r\n            window.requestAnimationFrame(() => {\r\n              emoticonsDropdown.toggle(false);\r\n            });\r\n          });\r\n        });\r\n      } */\r\n    }\r\n\r\n    /* this.listenerSetter.add(this.messageInput)('beforeinput', (e: Event) => {\r\n      // * validate due to manual formatting through browser's context menu\r\n      const inputType = (e as InputEvent).inputType;\r\n      //console.log('message beforeinput event', e);\r\n\r\n      if(inputType.indexOf('format') === 0) {\r\n        //console.log('message beforeinput format', e, inputType, this.messageInput.innerHTML);\r\n        const markdownType = inputType.split('format')[1].toLowerCase() as MarkdownType;\r\n        if(this.applyMarkdown(markdownType)) {\r\n          cancelEvent(e); // * cancel legacy markdown event\r\n        }\r\n      }\r\n    }); */\r\n    this.listenerSetter.add(this.messageInput)('input', this.onMessageInput);\r\n    this.listenerSetter.add(this.messageInput)('keyup', () => {\r\n      this.checkAutocomplete();\r\n    });\r\n\r\n    if(this.chat.type === 'chat' || this.chat.type === 'discussion') {\r\n      this.listenerSetter.add(this.messageInput)('focusin', () => {\r\n        if(this.chat.bubbles.scrollable.loadedAll.bottom) {\r\n          this.managers.appMessagesManager.readAllHistory(this.chat.peerId, this.chat.threadId);\r\n        }\r\n      });\r\n    }\r\n  }\r\n\r\n  private prepareDocumentExecute = () => {\r\n    this.executedHistory.push(this.messageInput.innerHTML);\r\n    return () => this.canUndoFromHTML = this.messageInput.innerHTML;\r\n  };\r\n\r\n  private undoRedo = (e: Event, type: 'undo' | 'redo', needHTML: string) => {\r\n    cancelEvent(e); // cancel legacy event\r\n\r\n    let html = this.messageInput.innerHTML;\r\n    if(html && html !== needHTML) {\r\n      this.lockRedo = true;\r\n\r\n      let sameHTMLTimes = 0;\r\n      do {\r\n        document.execCommand(type, false, null);\r\n        const currentHTML = this.messageInput.innerHTML;\r\n        if(html === currentHTML) {\r\n          if(++sameHTMLTimes > 2) { // * unlink, removeFormat (   , :    (  ),  )\r\n            break;\r\n          }\r\n        } else {\r\n          sameHTMLTimes = 0;\r\n        }\r\n\r\n        html = currentHTML;\r\n      } while(html !== needHTML);\r\n\r\n      this.lockRedo = false;\r\n    }\r\n  };\r\n\r\n  public applyMarkdown(type: MarkdownType, href?: string) {\r\n    const MONOSPACE_FONT = 'var(--font-monospace)';\r\n    const SPOILER_FONT = 'spoiler';\r\n    const commandsMap: Partial<{[key in typeof type]: string | (() => void)}> = {\r\n      bold: 'Bold',\r\n      italic: 'Italic',\r\n      underline: 'Underline',\r\n      strikethrough: 'Strikethrough',\r\n      monospace: () => document.execCommand('fontName', false, MONOSPACE_FONT),\r\n      link: href ? () => document.execCommand('createLink', false, href) : () => document.execCommand('unlink', false, null),\r\n      spoiler: () => document.execCommand('fontName', false, SPOILER_FONT)\r\n    };\r\n\r\n    if(!commandsMap[type]) {\r\n      return false;\r\n    }\r\n\r\n    const command = commandsMap[type];\r\n\r\n    // type = 'monospace';\r\n\r\n    const saveExecuted = this.prepareDocumentExecute();\r\n    const executed: any[] = [];\r\n    /**\r\n     * * clear previous formatting, due to Telegram's inability to handle several entities\r\n     */\r\n    /* const checkForSingle = () => {\r\n      const nodes = getSelectedNodes();\r\n      //console.log('Using formatting:', commandsMap[type], nodes, this.executedHistory);\r\n\r\n      const parents = [...new Set(nodes.map((node) => node.parentNode))];\r\n      //const differentParents = !!nodes.find((node) => node.parentNode !== firstParent);\r\n      const differentParents = parents.length > 1;\r\n\r\n      let notSingle = false;\r\n      if(differentParents) {\r\n        notSingle = true;\r\n      } else {\r\n        const node = nodes[0];\r\n        if(node && (node.parentNode as HTMLElement) !== this.messageInput && (node.parentNode.parentNode as HTMLElement) !== this.messageInput) {\r\n          notSingle = true;\r\n        }\r\n      }\r\n\r\n      if(notSingle) {\r\n        //if(type === 'monospace') {\r\n          executed.push(document.execCommand('styleWithCSS', false, 'true'));\r\n        //}\r\n\r\n        executed.push(document.execCommand('unlink', false, null));\r\n        executed.push(document.execCommand('removeFormat', false, null));\r\n        executed.push(typeof(command) === 'function' ? command() : document.execCommand(command, false, null));\r\n\r\n        //if(type === 'monospace') {\r\n          executed.push(document.execCommand('styleWithCSS', false, 'false'));\r\n        //}\r\n      }\r\n    }; */\r\n\r\n    executed.push(document.execCommand('styleWithCSS', false, 'true'));\r\n\r\n    const checkType = (type: MarkdownType) => {\r\n      let haveThisType = false;\r\n      // executed.push(document.execCommand('styleWithCSS', false, 'true'));\r\n\r\n      const selection = window.getSelection();\r\n      if(!selection.isCollapsed) {\r\n        const range = selection.getRangeAt(0);\r\n        const tag = markdownTags[type];\r\n\r\n        const node = range.commonAncestorContainer;\r\n        if((node.parentNode as HTMLElement).matches(tag.match) || (node instanceof HTMLElement && node.matches(tag.match))) {\r\n          haveThisType = true;\r\n        }\r\n      }\r\n\r\n      return haveThisType;\r\n    };\r\n\r\n    // * monospace can't be combined with different types\r\n    if(type === 'monospace' || type === 'spoiler') {\r\n      // executed.push(document.execCommand('styleWithCSS', false, 'true'));\r\n\r\n      const haveThisType = checkType(type);\r\n      // executed.push(document.execCommand('removeFormat', false, null));\r\n\r\n      if(haveThisType) {\r\n        executed.push(this.resetCurrentFontFormatting());\r\n      } else {\r\n        if(type === 'monospace' || checkType('monospace')) {\r\n          executed.push(this.resetCurrentFormatting());\r\n        }\r\n\r\n        executed.push(typeof(command) === 'function' ? command() : document.execCommand(command, false, null));\r\n      }\r\n    } else {\r\n      if(checkType('monospace')) {\r\n        executed.push(this.resetCurrentFormatting());\r\n      }\r\n\r\n      executed.push(typeof(command) === 'function' ? command() : document.execCommand(command, false, null));\r\n    }\r\n\r\n    executed.push(document.execCommand('styleWithCSS', false, 'false'));\r\n\r\n    // checkForSingle();\r\n    saveExecuted();\r\n    if(this.appImManager.markupTooltip) {\r\n      this.appImManager.markupTooltip.setActiveMarkupButton();\r\n    }\r\n\r\n    return true;\r\n  }\r\n\r\n  private resetCurrentFormatting() {\r\n    return document.execCommand('removeFormat', false, null);\r\n  }\r\n\r\n  private resetCurrentFontFormatting() {\r\n    return document.execCommand('fontName', false, 'Roboto');\r\n  }\r\n\r\n  private handleMarkdownShortcut = (e: KeyboardEvent) => {\r\n    // console.log('handleMarkdownShortcut', e);\r\n    const formatKeys: {[key: string]: MarkdownType} = {\r\n      'KeyB': 'bold',\r\n      'KeyI': 'italic',\r\n      'KeyU': 'underline',\r\n      'KeyS': 'strikethrough',\r\n      'KeyM': 'monospace',\r\n      'KeyP': 'spoiler'\r\n    };\r\n\r\n    if(this.appImManager.markupTooltip) {\r\n      formatKeys['KeyK'] = 'link';\r\n    }\r\n\r\n    const code = e.code;\r\n    const applyMarkdown = formatKeys[code];\r\n\r\n    const selection = document.getSelection();\r\n    if(selection.toString().trim().length && applyMarkdown) {\r\n      // * \r\n      if(code === 'KeyK') {\r\n        this.appImManager.markupTooltip.showLinkEditor();\r\n      } else {\r\n        this.applyMarkdown(applyMarkdown);\r\n      }\r\n\r\n      cancelEvent(e); // cancel legacy event\r\n    }\r\n\r\n    // return;\r\n    if(code === 'KeyZ') {\r\n      let html = this.messageInput.innerHTML;\r\n\r\n      if(e.shiftKey) {\r\n        if(this.undoHistory.length) {\r\n          this.executedHistory.push(html);\r\n          html = this.undoHistory.pop();\r\n          this.undoRedo(e, 'redo', html);\r\n          html = this.messageInput.innerHTML;\r\n          this.canRedoFromHTML = this.undoHistory.length ? html : '';\r\n          this.canUndoFromHTML = html;\r\n        }\r\n      } else {\r\n        // * ,        ,     saveExecuted\r\n        if(this.executedHistory.length && (!this.canUndoFromHTML || html === this.canUndoFromHTML)) {\r\n          this.undoHistory.push(html);\r\n          html = this.executedHistory.pop();\r\n          this.undoRedo(e, 'undo', html);\r\n\r\n          // *      ,    -,       \r\n          this.canUndoFromHTML = this.canRedoFromHTML = this.messageInput.innerHTML;\r\n        }\r\n      }\r\n    }\r\n  };\r\n\r\n  private onMessageInput = (e?: Event) => {\r\n    // * validate due to manual formatting through browser's context menu\r\n    /* const inputType = (e as InputEvent).inputType;\r\n    console.log('message input event', e);\r\n    if(inputType === 'formatBold') {\r\n      console.log('message input format', this.messageInput.innerHTML);\r\n      cancelEvent(e);\r\n    }\r\n\r\n    if(!isSelectionSingle()) {\r\n      alert('not single');\r\n    } */\r\n\r\n    // console.log('messageInput input', this.messageInput.innerText);\r\n    // const value = this.messageInput.innerText;\r\n    const {value: richValue, entities: markdownEntities, caretPos} = getRichValueWithCaret(this.messageInputField.input);\r\n\r\n    // const entities = parseEntities(value);\r\n    const value = parseMarkdown(richValue, markdownEntities, true);\r\n    const entities = mergeEntities(markdownEntities, parseEntities(value));\r\n\r\n    // this.chat.log('messageInput entities', richValue, value, markdownEntities, caretPos);\r\n\r\n    if(this.canRedoFromHTML && !this.lockRedo && this.messageInput.innerHTML !== this.canRedoFromHTML) {\r\n      this.canRedoFromHTML = '';\r\n      this.undoHistory.length = 0;\r\n    }\r\n\r\n    const urlEntities: Array<MessageEntity.messageEntityUrl | MessageEntity.messageEntityTextUrl> = (!this.editMessage?.media || this.editMessage.media._ === 'messageMediaWebPage') && entities.filter((e) => e._ === 'messageEntityUrl' || e._ === 'messageEntityTextUrl') as any;\r\n    if(urlEntities.length) {\r\n      for(const entity of urlEntities) {\r\n        let url: string;\r\n        if(entity._ === 'messageEntityTextUrl') {\r\n          url = entity.url;\r\n        } else {\r\n          url = richValue.slice(entity.offset, entity.offset + entity.length);\r\n\r\n          if(!(url.includes('http://') || url.includes('https://'))) {\r\n            continue;\r\n          }\r\n        }\r\n\r\n        // console.log('messageInput url:', url);\r\n\r\n        if(this.lastUrl !== url) {\r\n          this.lastUrl = url;\r\n          // this.willSendWebPage = null;\r\n          const promise = this.getWebPagePromise = this.managers.appWebPagesManager.getWebPage(url).then((webpage) => {\r\n            if(this.getWebPagePromise === promise) this.getWebPagePromise = undefined;\r\n            if(this.lastUrl !== url) return;\r\n            if(webpage._  === 'webPage') {\r\n              // console.log('got webpage: ', webpage);\r\n\r\n              this.setTopInfo('webpage', () => {}, webpage.site_name || webpage.title || 'Webpage', webpage.description || webpage.url || '');\r\n              delete this.noWebPage;\r\n              this.willSendWebPage = webpage;\r\n            } else if(this.willSendWebPage) {\r\n              this.onHelperCancel();\r\n            }\r\n          });\r\n        }\r\n\r\n        break;\r\n      }\r\n    } else if(this.lastUrl) {\r\n      this.lastUrl = '';\r\n      delete this.noWebPage;\r\n      this.willSendWebPage = null;\r\n\r\n      if(this.helperType) {\r\n        this.helperFunc();\r\n      } else {\r\n        this.clearHelper();\r\n      }\r\n    }\r\n\r\n    const isEmpty = !richValue.trim();\r\n    if(isEmpty) {\r\n      if(this.lastTimeType) {\r\n        this.managers.appMessagesManager.setTyping(this.chat.peerId, {_: 'sendMessageCancelAction'});\r\n      }\r\n\r\n      if(this.appImManager.markupTooltip) {\r\n        this.appImManager.markupTooltip.hide();\r\n      }\r\n\r\n      // * Chrome has a bug - it will preserve the formatting if the input with monospace text is cleared\r\n      // * so have to reset formatting\r\n      if(document.activeElement === this.messageInput) {\r\n        // document.execCommand('styleWithCSS', false, 'true');\r\n        setTimeout(() => {\r\n          if(document.activeElement === this.messageInput) {\r\n            this.resetCurrentFontFormatting();\r\n          }\r\n        }, 0);\r\n        // document.execCommand('styleWithCSS', false, 'false');\r\n      }\r\n    } else {\r\n      const time = Date.now();\r\n      if(time - this.lastTimeType >= 6000) {\r\n        this.lastTimeType = time;\r\n        this.managers.appMessagesManager.setTyping(this.chat.peerId, {_: 'sendMessageTypingAction'});\r\n      }\r\n\r\n      if(this.botCommands) {\r\n        this.botCommands.toggle(true);\r\n      }\r\n    }\r\n\r\n    if(this.botCommands) {\r\n      this.updateBotCommandsToggle();\r\n    }\r\n\r\n    if(!this.editMsgId) {\r\n      this.saveDraftDebounced();\r\n    }\r\n\r\n    this.checkAutocomplete(richValue, caretPos, entities);\r\n\r\n    this.updateSendBtn();\r\n  };\r\n\r\n  public insertAtCaret(insertText: string, insertEntity?: MessageEntity, isHelper = true) {\r\n    const {value: fullValue, caretPos, entities} = getRichValueWithCaret(this.messageInput);\r\n    const pos = caretPos >= 0 ? caretPos : fullValue.length;\r\n    const prefix = fullValue.substr(0, pos);\r\n    const suffix = fullValue.substr(pos);\r\n\r\n    const matches = isHelper ? prefix.match(ChatInput.AUTO_COMPLETE_REG_EXP) : null;\r\n\r\n    const matchIndex = matches ? matches.index + (matches[0].length - matches[2].length) : prefix.length;\r\n    const newPrefix = prefix.slice(0, matchIndex);\r\n    const newValue = newPrefix + insertText + suffix;\r\n\r\n    // merge emojis\r\n    const hadEntities = parseEntities(fullValue);\r\n    mergeEntities(entities, hadEntities);\r\n\r\n    // max for additional whitespace\r\n    const insertLength = insertEntity ? Math.max(insertEntity.length, insertText.length) : insertText.length;\r\n    const addEntities: MessageEntity[] = [];\r\n    if(insertEntity) {\r\n      addEntities.push(insertEntity);\r\n      insertEntity.offset = matchIndex;\r\n    }\r\n\r\n    // add offset to entities next to emoji\r\n    const diff = matches ? insertLength - matches[2].length : insertLength;\r\n    entities.forEach((entity) => {\r\n      if(entity.offset >= matchIndex) {\r\n        entity.offset += diff;\r\n      }\r\n    });\r\n\r\n    mergeEntities(entities, addEntities);\r\n\r\n    if(/* caretPos !== -1 && caretPos !== fullValue.length */true) {\r\n      const caretEntity: MessageEntity.messageEntityCaret = {\r\n        _: 'messageEntityCaret',\r\n        offset: matchIndex + insertLength,\r\n        length: 0\r\n      };\r\n\r\n      let insertCaretAtIndex = 0;\r\n      for(let length = entities.length; insertCaretAtIndex < length; ++insertCaretAtIndex) {\r\n        const entity = entities[insertCaretAtIndex];\r\n        if(entity.offset > caretEntity.offset) {\r\n          break;\r\n        }\r\n      }\r\n\r\n      entities.splice(insertCaretAtIndex, 0, caretEntity);\r\n    }\r\n\r\n    // const saveExecuted = this.prepareDocumentExecute();\r\n    // can't exec .value here because it will instantly check for autocomplete\r\n    const value = documentFragmentToHTML(wrapDraftText(newValue, {entities}));\r\n    this.messageInputField.setValueSilently(value);\r\n\r\n    const caret = this.messageInput.querySelector('.composer-sel');\r\n    if(caret) {\r\n      setCaretAt(caret);\r\n      caret.remove();\r\n    }\r\n\r\n    // but it's needed to be checked only here\r\n    this.onMessageInput();\r\n\r\n    // saveExecuted();\r\n\r\n    // document.execCommand('insertHTML', true, wrapEmojiText(emoji));\r\n  }\r\n\r\n  public onEmojiSelected = (emoji: string, autocomplete: boolean) => {\r\n    this.insertAtCaret(emoji, getEmojiEntityFromEmoji(emoji), autocomplete);\r\n  };\r\n\r\n  private async checkAutocomplete(value?: string, caretPos?: number, entities?: MessageEntity[]) {\r\n    // return;\r\n\r\n    if(value === undefined) {\r\n      const r = getRichValueWithCaret(this.messageInputField.input, true);\r\n      value = r.value;\r\n      caretPos = r.caretPos;\r\n      entities = r.entities;\r\n    }\r\n\r\n    if(caretPos === -1) {\r\n      caretPos = value.length;\r\n    }\r\n\r\n    if(entities === undefined) {\r\n      const _value = parseMarkdown(value, entities, true);\r\n      entities = mergeEntities(entities, parseEntities(_value));\r\n    }\r\n\r\n    value = value.slice(0, caretPos);\r\n\r\n    if(this.previousQuery === value) {\r\n      return;\r\n    }\r\n\r\n    this.previousQuery = value;\r\n\r\n    const matches = value.match(ChatInput.AUTO_COMPLETE_REG_EXP);\r\n    let foundHelper: AutocompleteHelper;\r\n    if(matches) {\r\n      const entity = entities[0];\r\n\r\n      let query = matches[2];\r\n      const firstChar = query[0];\r\n\r\n      if(this.stickersHelper &&\r\n        rootScope.settings.stickers.suggest &&\r\n        await this.chat.canSend('send_stickers') &&\r\n        entity?._ === 'messageEntityEmoji' && entity.length === value.length && !entity.offset) {\r\n        foundHelper = this.stickersHelper;\r\n        this.stickersHelper.checkEmoticon(value);\r\n      } else if(firstChar === '@') { // mentions\r\n        const topMsgId = this.chat.threadId ? getServerMessageId(this.chat.threadId) : undefined;\r\n        if(await this.mentionsHelper.checkQuery(query, this.chat.peerId.isUser() ? NULL_PEER_ID : this.chat.peerId, topMsgId)) {\r\n          foundHelper = this.mentionsHelper;\r\n        }\r\n      } else if(!matches[1] && firstChar === '/') { // commands\r\n        if(await this.commandsHelper.checkQuery(query, this.chat.peerId)) {\r\n          foundHelper = this.commandsHelper;\r\n        }\r\n      } else if(rootScope.settings.emoji.suggest) { // emoji\r\n        query = query.replace(/^\\s*/, '');\r\n        if(!value.match(/^\\s*:(.+):\\s*$/) && !value.match(/:[;!@#$%^&*()-=|]/) && query) {\r\n          foundHelper = this.emojiHelper;\r\n          this.emojiHelper.checkQuery(query, firstChar);\r\n        }\r\n      }\r\n    }\r\n\r\n    foundHelper = this.checkInlineAutocomplete(value, foundHelper);\r\n\r\n    this.autocompleteHelperController.hideOtherHelpers(foundHelper);\r\n  }\r\n\r\n  private checkInlineAutocomplete(value: string, foundHelper?: AutocompleteHelper): AutocompleteHelper {\r\n    let needPlaceholder = false;\r\n\r\n    if(!foundHelper) {\r\n      const inlineMatch = value.match(/^@([a-zA-Z\\\\d_]{3,32})\\s/);\r\n      if(inlineMatch) {\r\n        const username = inlineMatch[1];\r\n        const query = value.slice(inlineMatch[0].length);\r\n        needPlaceholder = inlineMatch[0].length === value.length;\r\n\r\n        foundHelper = this.inlineHelper;\r\n\r\n        if(!this.btnPreloader) {\r\n          this.btnPreloader = ButtonIcon('none btn-preloader float show disable-hover', {noRipple: true});\r\n          putPreloader(this.btnPreloader, true);\r\n          this.inputMessageContainer.parentElement.insertBefore(this.btnPreloader, this.inputMessageContainer.nextSibling);\r\n        } else {\r\n          SetTransition(this.btnPreloader, 'show', true, 400);\r\n        }\r\n\r\n        this.inlineHelper.checkQuery(this.chat.peerId, username, query).then(({user, renderPromise}) => {\r\n          if(needPlaceholder && user.bot_inline_placeholder) {\r\n            this.messageInput.dataset.inlinePlaceholder = user.bot_inline_placeholder;\r\n          }\r\n\r\n          renderPromise.then(() => {\r\n            SetTransition(this.btnPreloader, 'show', false, 400);\r\n          });\r\n        }).catch(noop);\r\n      }\r\n    }\r\n\r\n    if(!needPlaceholder) {\r\n      delete this.messageInput.dataset.inlinePlaceholder;\r\n    }\r\n\r\n    if(foundHelper !== this.inlineHelper) {\r\n      if(this.btnPreloader) {\r\n        SetTransition(this.btnPreloader, 'show', false, 400);\r\n      }\r\n    }\r\n\r\n    return foundHelper;\r\n  }\r\n\r\n  private setRecording(value: boolean) {\r\n    if(this.recording === value) {\r\n      return;\r\n    }\r\n\r\n    SetTransition(this.chatInput, 'is-recording', value, 200);\r\n    this.recording = value;\r\n    this.updateSendBtn();\r\n  }\r\n\r\n  private onBtnSendClick = async(e: Event) => {\r\n    cancelEvent(e);\r\n\r\n    if(!this.recorder || this.recording || !this.isInputEmpty() || this.forwarding || this.editMsgId) {\r\n      if(this.recording) {\r\n        if((Date.now() - this.recordStartTime) < RECORD_MIN_TIME) {\r\n          this.onCancelRecordClick();\r\n        } else {\r\n          this.recorder.stop();\r\n        }\r\n      } else {\r\n        this.sendMessage();\r\n      }\r\n    } else {\r\n      const isAnyChat = this.chat.peerId.isAnyChat();\r\n      if(isAnyChat && !(await this.chat.canSend('send_media'))) {\r\n        toast(POSTING_MEDIA_NOT_ALLOWED);\r\n        return;\r\n      }\r\n\r\n      this.chatInput.classList.add('is-locked');\r\n      blurActiveElement();\r\n\r\n      let restricted = false;\r\n      if(!isAnyChat) {\r\n        const userFull = await this.managers.appProfileManager.getProfile(this.chat.peerId.toUserId());\r\n        if(userFull?.pFlags.voice_messages_forbidden) {\r\n          toastNew({\r\n            langPackKey: 'Chat.SendVoice.PrivacyError',\r\n            langPackArguments: [await wrapPeerTitle({peerId: this.chat.peerId})]\r\n          });\r\n          restricted = true;\r\n        }\r\n      }\r\n\r\n      if(restricted) {\r\n        this.chatInput.classList.remove('is-locked');\r\n        return;\r\n      }\r\n\r\n      this.recorder.start().then(() => {\r\n        this.releaseMediaPlayback = appMediaPlaybackController.setSingleMedia();\r\n        this.recordCanceled = false;\r\n\r\n        this.setRecording(true);\r\n        opusDecodeController.setKeepAlive(true);\r\n\r\n        const showDiscardPopup = () => {\r\n          new PopupPeer('popup-cancel-record', {\r\n            titleLangKey: 'DiscardVoiceMessageTitle',\r\n            descriptionLangKey: 'DiscardVoiceMessageDescription',\r\n            buttons: [{\r\n              langKey: 'DiscardVoiceMessageAction',\r\n              callback: () => {\r\n                simulateClickEvent(this.btnCancelRecord);\r\n              }\r\n            }, {\r\n              langKey: 'Continue',\r\n              isCancel: true\r\n            }]\r\n          }).show();\r\n        };\r\n\r\n        this.recordingOverlayListener = this.listenerSetter.add(document.body)('mousedown', (e) => {\r\n          if(!findUpClassName(e.target, 'chat-input') && !findUpClassName(e.target, 'popup-cancel-record')) {\r\n            cancelEvent(e);\r\n            showDiscardPopup();\r\n          }\r\n        }, {capture: true, passive: false}) as any;\r\n\r\n        appNavigationController.pushItem(this.recordingNavigationItem = {\r\n          type: 'voice',\r\n          onPop: () => {\r\n            setTimeout(() => {\r\n              showDiscardPopup();\r\n            }, 0);\r\n\r\n            return false;\r\n          }\r\n        });\r\n\r\n        this.recordStartTime = Date.now();\r\n\r\n        const sourceNode: MediaStreamAudioSourceNode = this.recorder.sourceNode;\r\n        const context = sourceNode.context;\r\n\r\n        const analyser = context.createAnalyser();\r\n        sourceNode.connect(analyser);\r\n        // analyser.connect(context.destination);\r\n        analyser.fftSize = 32;\r\n\r\n        const frequencyData = new Uint8Array(analyser.frequencyBinCount);\r\n        const max = frequencyData.length * 255;\r\n        const min = 54 / 150;\r\n        const r = () => {\r\n          if(!this.recording) return;\r\n\r\n          analyser.getByteFrequencyData(frequencyData);\r\n\r\n          let sum = 0;\r\n          frequencyData.forEach((value) => {\r\n            sum += value;\r\n          });\r\n\r\n          const percents = Math.min(1, (sum / max) + min);\r\n          // console.log('frequencyData', frequencyData, percents);\r\n\r\n          this.recordRippleEl.style.transform = `scale(${percents})`;\r\n\r\n          const diff = Date.now() - this.recordStartTime;\r\n          const ms = diff % 1000;\r\n\r\n          const formatted = toHHMMSS(diff / 1000) + ',' + ('00' + Math.round(ms / 10)).slice(-2);\r\n\r\n          this.recordTimeEl.innerText = formatted;\r\n\r\n          fastRaf(r);\r\n        };\r\n\r\n        r();\r\n      }).catch((e: Error) => {\r\n        switch(e.name as string) {\r\n          case 'NotAllowedError': {\r\n            toast('Please allow access to your microphone');\r\n            break;\r\n          }\r\n\r\n          case 'NotReadableError': {\r\n            toast(e.message);\r\n            break;\r\n          }\r\n\r\n          default:\r\n            console.error('Recorder start error:', e, e.name, e.message);\r\n            toast(e.message);\r\n            break;\r\n        }\r\n\r\n        this.setRecording(false);\r\n        this.chatInput.classList.remove('is-locked');\r\n      });\r\n    }\r\n  };\r\n\r\n  private onHelperCancel = async(e?: Event, force?: boolean) => {\r\n    if(e) {\r\n      cancelEvent(e);\r\n    }\r\n\r\n    if(this.willSendWebPage) {\r\n      const lastUrl = this.lastUrl;\r\n      let needReturn = false;\r\n      if(this.helperType) {\r\n        // if(this.helperFunc) {\r\n        await this.helperFunc();\r\n        // }\r\n\r\n        needReturn = true;\r\n      }\r\n\r\n      // * restore values\r\n      this.lastUrl = lastUrl;\r\n      this.noWebPage = true;\r\n      this.willSendWebPage = null;\r\n\r\n      if(needReturn) return;\r\n    }\r\n\r\n    if(this.helperType === 'edit' && !force) {\r\n      const message = this.editMessage\r\n      const value = parseMarkdown(this.messageInputField.value, []);\r\n      if(message.message !== value) {\r\n        new PopupPeer('discard-editing', {\r\n          buttons: [{\r\n            langKey: 'Alert.Confirm.Discard',\r\n            callback: () => {\r\n              this.onHelperCancel(undefined, true);\r\n            }\r\n          }],\r\n          descriptionLangKey: 'Chat.Edit.Cancel.Text'\r\n        }).show();\r\n\r\n        return;\r\n      }\r\n    }\r\n\r\n    this.clearHelper();\r\n    this.updateSendBtn();\r\n  };\r\n\r\n  private onHelperClick = (e: Event) => {\r\n    cancelEvent(e);\r\n\r\n    if(!findUpClassName(e.target, 'reply')) return;\r\n    if(this.helperType === 'forward') {\r\n      const {forwardElements} = this;\r\n      if(forwardElements && IS_TOUCH_SUPPORTED && !forwardElements.container.classList.contains('active')) {\r\n        contextMenuController.openBtnMenu(forwardElements.container);\r\n      }\r\n    } else if(this.helperType === 'reply') {\r\n      this.chat.setMessageId(this.replyToMsgId);\r\n    } else if(this.helperType === 'edit') {\r\n      this.chat.setMessageId(this.editMsgId);\r\n    }\r\n  };\r\n\r\n  private changeForwardRecipient() {\r\n    if(this.helperWaitingForward) return;\r\n    this.helperWaitingForward = true;\r\n\r\n    const forwarding = copy(this.forwarding);\r\n    const helperFunc = this.helperFunc;\r\n    this.clearHelper();\r\n    this.updateSendBtn();\r\n    let selected = false;\r\n    const popup = new PopupForward(forwarding, () => {\r\n      selected = true;\r\n    });\r\n\r\n    popup.addEventListener('close', () => {\r\n      this.helperWaitingForward = false;\r\n\r\n      if(!selected) {\r\n        helperFunc();\r\n      }\r\n    });\r\n  }\r\n\r\n  public async clearInput(canSetDraft = true, fireEvent = true, clearValue = '') {\r\n    if(document.activeElement === this.messageInput && IS_MOBILE_SAFARI) { // fix first char uppercase\r\n      const i = document.createElement('input');\r\n      document.body.append(i);\r\n      fixSafariStickyInput(i);\r\n      this.messageInputField.setValueSilently(clearValue);\r\n      fixSafariStickyInput(this.messageInput);\r\n      i.remove();\r\n    } else {\r\n      this.messageInputField.setValueSilently(clearValue);\r\n    }\r\n\r\n    if(IS_TOUCH_SUPPORTED) {\r\n      // this.messageInput.innerText = '';\r\n    } else {\r\n      // this.attachMessageInputField();\r\n      // this.messageInput.innerText = '';\r\n\r\n      // clear executions\r\n      this.canRedoFromHTML = '';\r\n      this.undoHistory.length = 0;\r\n      this.executedHistory.length = 0;\r\n      this.canUndoFromHTML = '';\r\n    }\r\n\r\n    let set = false;\r\n    if(canSetDraft) {\r\n      set = await this.setDraft(undefined, false);\r\n    }\r\n\r\n    if(!set && fireEvent) {\r\n      this.onMessageInput();\r\n    }\r\n  }\r\n\r\n  public isInputEmpty() {\r\n    return isInputEmpty(this.messageInput);\r\n  }\r\n\r\n  public updateSendBtn() {\r\n    let icon: 'send' | 'record' | 'edit' | 'schedule';\r\n\r\n    const isInputEmpty = this.isInputEmpty();\r\n\r\n    if(this.editMsgId) icon = 'edit';\r\n    else if(!this.recorder || this.recording || !isInputEmpty || this.forwarding) icon = this.chat.type === 'scheduled' ? 'schedule' : 'send';\r\n    else icon = 'record';\r\n\r\n    ['send', 'record', 'edit', 'schedule'].forEach((i) => {\r\n      this.btnSend.classList.toggle(i, icon === i);\r\n    });\r\n\r\n    if(this.btnScheduled) {\r\n      this.btnScheduled.classList.toggle('show', isInputEmpty);\r\n    }\r\n\r\n    if(this.btnToggleReplyMarkup) {\r\n      this.btnToggleReplyMarkup.classList.toggle('show', isInputEmpty);\r\n    }\r\n  }\r\n\r\n  public onMessageSent(clearInput = true, clearReply?: boolean) {\r\n    if(this.chat.type !== 'scheduled') {\r\n      this.managers.appMessagesManager.readAllHistory(this.chat.peerId, this.chat.threadId, true);\r\n    }\r\n\r\n    this.scheduleDate = undefined;\r\n    this.sendSilent = undefined;\r\n\r\n    const value = this.messageInputField.value;\r\n    const entities = parseEntities(value);\r\n    const emojiEntities: MessageEntity.messageEntityEmoji[] = entities.filter((entity) => entity._ === 'messageEntityEmoji') as any;\r\n    emojiEntities.forEach((entity) => {\r\n      const emoji = emojiFromCodePoints(entity.unicode);\r\n      this.managers.appEmojiManager.pushRecentEmoji(emoji);\r\n    });\r\n\r\n    if(clearInput) {\r\n      this.lastUrl = '';\r\n      delete this.noWebPage;\r\n      this.willSendWebPage = null;\r\n      this.clearInput();\r\n    }\r\n\r\n    if(clearReply || clearInput) {\r\n      this.clearHelper();\r\n    }\r\n\r\n    this.updateSendBtn();\r\n  }\r\n\r\n  public sendMessage(force = false) {\r\n    const {editMsgId, chat} = this;\r\n    if(chat.type === 'scheduled' && !force && !editMsgId) {\r\n      this.scheduleSending();\r\n      return;\r\n    }\r\n\r\n    const {peerId} = chat;\r\n    const {noWebPage} = this;\r\n    const sendingParams = this.chat.getMessageSendingParams();\r\n\r\n    const {value, entities} = getRichValue(this.messageInputField.input);\r\n\r\n    // return;\r\n    if(editMsgId) {\r\n      const message = this.editMessage;\r\n      if(value.trim() || message.media) {\r\n        this.managers.appMessagesManager.editMessage(message, value, {\r\n          entities,\r\n          noWebPage: noWebPage\r\n        });\r\n\r\n        this.onMessageSent();\r\n      } else {\r\n        new PopupDeleteMessages(peerId, [editMsgId], chat.type);\r\n\r\n        return;\r\n      }\r\n    } else if(value.trim()) {\r\n      this.managers.appMessagesManager.sendText(peerId, value, {\r\n        entities,\r\n        ...sendingParams,\r\n        noWebPage: noWebPage,\r\n        webPage: this.getWebPagePromise ? undefined : this.willSendWebPage,\r\n        clearDraft: true\r\n      });\r\n\r\n      if(this.chat.type === 'scheduled') {\r\n        this.onMessageSent(true);\r\n      } else {\r\n        this.onMessageSent(false, false);\r\n      }\r\n      // this.onMessageSent();\r\n    }\r\n\r\n    // * wait for sendText set messageId for invokeAfterMsg\r\n    if(this.forwarding) {\r\n      const forwarding = copy(this.forwarding);\r\n      // setTimeout(() => {\r\n      for(const fromPeerId in forwarding) {\r\n        this.managers.appMessagesManager.forwardMessages(peerId, fromPeerId.toPeerId(), forwarding[fromPeerId], {\r\n          ...sendingParams,\r\n          dropAuthor: this.forwardElements && this.forwardElements.hideSender.checkboxField.checked,\r\n          dropCaptions: this.isDroppingCaptions()\r\n        }).catch(async(err: ApiError) => {\r\n          if(err.type === 'VOICE_MESSAGES_FORBIDDEN') {\r\n            toastNew({\r\n              langPackKey: 'Chat.SendVoice.PrivacyError',\r\n              langPackArguments: [await wrapPeerTitle({peerId})]\r\n            });\r\n          }\r\n        });\r\n      }\r\n\r\n      if(!value) {\r\n        this.onMessageSent();\r\n      }\r\n      // }, 0);\r\n    }\r\n\r\n    // this.onMessageSent();\r\n  }\r\n\r\n  public async sendMessageWithDocument(\r\n    document: MyDocument | DocId,\r\n    force = false,\r\n    clearDraft = false,\r\n    silent = false\r\n  ) {\r\n    document = await this.managers.appDocsManager.getDoc(document);\r\n\r\n    const flag = document.type === 'sticker' ? 'send_stickers' : (document.type === 'gif' ? 'send_gifs' : 'send_media');\r\n    if(this.chat.peerId.isAnyChat() && !(await this.chat.canSend(flag))) {\r\n      toast(POSTING_MEDIA_NOT_ALLOWED);\r\n      return false;\r\n    }\r\n\r\n    if(this.chat.type === 'scheduled' && !force) {\r\n      this.scheduleSending(() => this.sendMessageWithDocument(document, true, clearDraft, silent));\r\n      return false;\r\n    }\r\n\r\n    if(!document) {\r\n      return false;\r\n    }\r\n\r\n    if(getStickerEffectThumb(document) && !rootScope.premium) {\r\n      return false;\r\n    }\r\n\r\n    this.managers.appMessagesManager.sendFile(this.chat.peerId, document, {\r\n      ...this.chat.getMessageSendingParams(),\r\n      isMedia: true,\r\n      clearDraft: clearDraft || undefined,\r\n      silent\r\n    });\r\n    this.onMessageSent(clearDraft, true);\r\n\r\n    if(document.type === 'sticker') {\r\n      emoticonsDropdown.stickersTab?.unshiftRecentSticker(document);\r\n    }\r\n\r\n    return true;\r\n  }\r\n\r\n  private canToggleHideAuthor() {\r\n    const {forwardElements} = this;\r\n    if(!forwardElements) return false;\r\n    const hideCaptionCheckboxField = forwardElements.hideCaption.checkboxField;\r\n    return !hideCaptionCheckboxField.checked ||\r\n      findUpTag(hideCaptionCheckboxField.label, 'FORM').classList.contains('hide');\r\n  }\r\n\r\n  private isDroppingCaptions() {\r\n    return !this.canToggleHideAuthor();\r\n  }\r\n\r\n  /* public sendSomething(callback: () => void, force = false) {\r\n    if(this.chat.type === 'scheduled' && !force) {\r\n      this.scheduleSending(() => this.sendSomething(callback, true));\r\n      return false;\r\n    }\r\n\r\n    callback();\r\n    this.onMessageSent(false, true);\r\n\r\n    return true;\r\n  } */\r\n\r\n  public async initMessageEditing(mid: number) {\r\n    const message = (await this.chat.getMessage(mid)) as Message.message;\r\n\r\n    let input = documentFragmentToHTML(wrapDraftText(message.message, {entities: message.totalEntities}));\r\n    const f = async() => {\r\n      const replyFragment = await wrapMessageForReply(message, undefined, [message.mid]);\r\n      this.setTopInfo('edit', f, i18n('AccDescrEditing'), replyFragment, input, message);\r\n\r\n      this.editMsgId = mid;\r\n      this.editMessage = message;\r\n      input = undefined;\r\n    };\r\n    f();\r\n  }\r\n\r\n  public initMessagesForward(fromPeerIdsMids: {[fromPeerId: PeerId]: number[]}) {\r\n    const f = async() => {\r\n      // const peerTitles: string[]\r\n      const fromPeerIds = Object.keys(fromPeerIdsMids).map((fromPeerId) => fromPeerId.toPeerId());\r\n      const smth: Set<string> = new Set();\r\n      let length = 0, messagesWithCaptionsLength = 0;\r\n\r\n      const p = fromPeerIds.map(async(fromPeerId) => {\r\n        const mids = fromPeerIdsMids[fromPeerId];\r\n        const promises = mids.map(async(mid) => {\r\n          const message = (await this.managers.appMessagesManager.getMessageByPeer(fromPeerId, mid)) as Message.message;\r\n          if(message.fwd_from?.from_name && !message.fromId && !message.fwdFromId) {\r\n            smth.add('N' + message.fwd_from.from_name);\r\n          } else {\r\n            smth.add('P' + message.fromId);\r\n          }\r\n\r\n          if(message.media && message.message) {\r\n            ++messagesWithCaptionsLength;\r\n          }\r\n        });\r\n\r\n        await Promise.all(promises);\r\n\r\n        length += mids.length;\r\n      });\r\n\r\n      await Promise.all(p);\r\n\r\n      const onlyFirstName = smth.size > 2;\r\n      const peerTitles = [...smth].map((smth) => {\r\n        const type = smth[0];\r\n        smth = smth.slice(1);\r\n        if(type === 'P') {\r\n          const peerId = smth.toPeerId();\r\n          return peerId === rootScope.myId ? i18n('Chat.Accessory.Forward.You') : new PeerTitle({peerId, dialog: false, onlyFirstName}).element;\r\n        } else {\r\n          return onlyFirstName ? smth.split(' ')[0] : smth;\r\n        }\r\n      });\r\n\r\n      const {forwardElements} = this;\r\n      const form = findUpTag(forwardElements.showCaption.checkboxField.label, 'FORM');\r\n      form.classList.toggle('hide', !messagesWithCaptionsLength);\r\n      const hideCaption = forwardElements.hideCaption.checkboxField.checked;\r\n      if(messagesWithCaptionsLength && hideCaption) {\r\n        forwardElements.hideSender.checkboxField.setValueSilently(true);\r\n      } else if(this.forwardWasDroppingAuthor !== undefined) {\r\n        (this.forwardWasDroppingAuthor ? forwardElements.hideSender : forwardElements.showSender).checkboxField.setValueSilently(true);\r\n      }\r\n\r\n      const titleKey: LangPackKey = forwardElements.showSender.checkboxField.checked ? 'Chat.Accessory.Forward' : 'Chat.Accessory.Hidden';\r\n      const title = i18n(titleKey, [length]);\r\n\r\n      const senderTitles = document.createDocumentFragment();\r\n      if(peerTitles.length < 3) {\r\n        senderTitles.append(...join(peerTitles, false));\r\n      } else {\r\n        senderTitles.append(peerTitles[0], i18n('AndOther', [peerTitles.length - 1]));\r\n      }\r\n\r\n      let firstMessage: Message.message, usingFullAlbum: boolean;\r\n      if(fromPeerIds.length === 1) {\r\n        const fromPeerId = fromPeerIds[0];\r\n        const mids = fromPeerIdsMids[fromPeerId];\r\n        firstMessage = (await this.managers.appMessagesManager.getMessageByPeer(fromPeerId, mids[0])) as Message.message;\r\n\r\n        usingFullAlbum = !!firstMessage.grouped_id;\r\n        if(usingFullAlbum) {\r\n          const albumMids = await this.managers.appMessagesManager.getMidsByMessage(firstMessage);\r\n          if(albumMids.length !== length || albumMids.find((mid) => !mids.includes(mid))) {\r\n            usingFullAlbum = false;\r\n          }\r\n        }\r\n      }\r\n\r\n      const subtitleFragment = document.createDocumentFragment();\r\n      const delimiter = ': ';\r\n      if(usingFullAlbum || length === 1) {\r\n        const mids = fromPeerIdsMids[fromPeerIds[0]];\r\n        const replyFragment = await wrapMessageForReply(firstMessage, undefined, mids);\r\n        subtitleFragment.append(\r\n          senderTitles,\r\n          delimiter,\r\n          replyFragment\r\n        );\r\n      } else {\r\n        subtitleFragment.append(\r\n          i18n('Chat.Accessory.Forward.From'),\r\n          delimiter,\r\n          senderTitles\r\n        );\r\n      }\r\n\r\n      const newReply = this.setTopInfo('forward', f, title, subtitleFragment);\r\n\r\n      forwardElements.modifyArgs.forEach((b, idx) => {\r\n        const text = b.textElement;\r\n        const intl: I18n.IntlElement = I18n.weakMap.get(text) as any;\r\n        intl.args = [idx < 2 ? fromPeerIds.length : messagesWithCaptionsLength];\r\n        intl.update();\r\n      });\r\n\r\n      if(this.forwardHover) {\r\n        this.forwardHover.attachButtonListener(newReply, this.listenerSetter);\r\n      }\r\n\r\n      this.forwarding = fromPeerIdsMids;\r\n    };\r\n\r\n    f();\r\n  }\r\n\r\n  public async initMessageReply(mid: number) {\r\n    if(this.replyToMsgId === mid) {\r\n      return;\r\n    }\r\n\r\n    let message = await this.chat.getMessage(mid);\r\n    const f = () => {\r\n      let peerTitleEl: HTMLElement;\r\n      if(!message) { // load missing replying message\r\n        peerTitleEl = i18n('Loading');\r\n\r\n        this.managers.appMessagesManager.wrapSingleMessage(this.chat.peerId, mid).then((_message) => {\r\n          if(this.replyToMsgId !== mid) {\r\n            return;\r\n          }\r\n\r\n          message = _message;\r\n          if(!message) {\r\n            this.clearHelper('reply');\r\n          } else {\r\n            f();\r\n          }\r\n        });\r\n      } else {\r\n        peerTitleEl = new PeerTitle({\r\n          peerId: message.fromId,\r\n          dialog: false\r\n        }).element;\r\n      }\r\n\r\n      this.setTopInfo('reply', f, peerTitleEl, message && (message as Message.message).message, undefined, message);\r\n      this.replyToMsgId = mid;\r\n    };\r\n    f();\r\n  }\r\n\r\n  public clearHelper(type?: ChatInputHelperType) {\r\n    if(this.helperType === 'edit' && type !== 'edit') {\r\n      this.clearInput();\r\n    }\r\n\r\n    if(type) {\r\n      this.lastUrl = '';\r\n      delete this.noWebPage;\r\n      this.willSendWebPage = null;\r\n    }\r\n\r\n    if(type !== 'reply') {\r\n      this.replyToMsgId = undefined;\r\n      this.forwarding = undefined;\r\n    }\r\n\r\n    this.editMsgId = this.editMessage = undefined;\r\n    this.helperType = this.helperFunc = undefined;\r\n\r\n    if(this.chat.container.classList.contains('is-helper-active')) {\r\n      appNavigationController.removeByType('input-helper');\r\n      this.chat.container.classList.remove('is-helper-active');\r\n      this.t();\r\n    }\r\n  }\r\n\r\n  private t() {\r\n    const className = 'is-toggling-helper';\r\n    SetTransition(this.chat.container, className, true, 150, () => {\r\n      this.chat.container.classList.remove(className);\r\n    });\r\n  }\r\n\r\n  public setInputValue(value: string, clear = true, focus = true) {\r\n    if(!value) value = '';\r\n\r\n    if(clear) this.clearInput(false, false, value);\r\n    else this.messageInputField.setValueSilently(value);\r\n\r\n    fastRaf(() => {\r\n      focus && placeCaretAtEnd(this.messageInput);\r\n      this.onMessageInput();\r\n      this.messageInput.scrollTop = this.messageInput.scrollHeight;\r\n    });\r\n  }\r\n\r\n  public setTopInfo(\r\n    type: ChatInputHelperType,\r\n    callerFunc: () => void,\r\n    title: Parameters<typeof wrapReply>[0] = '',\r\n    subtitle: Parameters<typeof wrapReply>[1] = '',\r\n    input?: string,\r\n    message?: any\r\n  ) {\r\n    if(this.willSendWebPage && type === 'reply') {\r\n      return;\r\n    }\r\n\r\n    if(type !== 'webpage') {\r\n      this.clearHelper(type);\r\n      this.helperType = type;\r\n      this.helperFunc = callerFunc;\r\n    }\r\n\r\n    const replyParent = this.replyElements.container;\r\n    const oldReply = replyParent.lastElementChild.previousElementSibling;\r\n    const haveReply = oldReply.classList.contains('reply');\r\n\r\n    this.replyElements.iconBtn.replaceWith(this.replyElements.iconBtn = ButtonIcon((type === 'webpage' ? 'link' : type) + ' active reply-icon', {noRipple: true}));\r\n    const {container} = wrapReply(title, subtitle, message);\r\n    if(haveReply) {\r\n      oldReply.replaceWith(container);\r\n    } else {\r\n      replyParent.insertBefore(container, replyParent.lastElementChild);\r\n    }\r\n\r\n    if(type === 'webpage') {\r\n      container.style.cursor = 'default';\r\n    }\r\n\r\n    if(!this.chat.container.classList.contains('is-helper-active')) {\r\n      this.chat.container.classList.add('is-helper-active');\r\n      this.t();\r\n    }\r\n\r\n    /* const scroll = appImManager.scrollable;\r\n    if(scroll.isScrolledDown && !scroll.scrollLocked && !appImManager.messagesQueuePromise && !appImManager.setPeerPromise) {\r\n      scroll.scrollTo(scroll.scrollHeight, 'top', true, true, 200);\r\n    } */\r\n\r\n    if(!IS_MOBILE) {\r\n      appNavigationController.pushItem({\r\n        type: 'input-helper',\r\n        onPop: () => {\r\n          this.onHelperCancel();\r\n        }\r\n      });\r\n    }\r\n\r\n    if(input !== undefined) {\r\n      this.setInputValue(input);\r\n    }\r\n\r\n    setTimeout(() => {\r\n      this.updateSendBtn();\r\n    }, 0);\r\n\r\n    return container;\r\n  }\r\n\r\n  // public saveScroll() {\r\n  //   this.scrollTop = this.chat.bubbles.scrollable.container.scrollTop;\r\n  //   this.scrollOffsetTop = this.chatInput.offsetTop;\r\n  // }\r\n\r\n  // public restoreScroll() {\r\n  //   if(this.chatInput.style.display) return;\r\n  //   //console.log('input resize', offsetTop, this.chatInput.offsetTop);\r\n  //   let newOffsetTop = this.chatInput.offsetTop;\r\n  //   let container = this.chat.bubbles.scrollable.container;\r\n  //   let scrollTop = container.scrollTop;\r\n  //   let clientHeight = container.clientHeight;\r\n  //   let maxScrollTop = container.scrollHeight;\r\n\r\n  //   if(newOffsetTop < this.scrollOffsetTop) {\r\n  //     this.scrollDiff = this.scrollOffsetTop - newOffsetTop;\r\n  //     container.scrollTop += this.scrollDiff;\r\n  //   } else if(scrollTop !== this.scrollTop) {\r\n  //     let endDiff = maxScrollTop - (scrollTop + clientHeight);\r\n  //     if(endDiff < this.scrollDiff/*  && false */) {\r\n  //       //container.scrollTop -= endDiff;\r\n  //     } else {\r\n  //       container.scrollTop -= this.scrollDiff;\r\n  //     }\r\n  //   }\r\n  // }\r\n}\r\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport documentFragmentToHTML from '../../helpers/dom/documentFragmentToHTML';\nimport {DraftMessage} from '../../layer';\nimport mergeEntities from '../../lib/richTextProcessor/mergeEntities';\nimport parseEntities from '../../lib/richTextProcessor/parseEntities';\nimport wrapDraftText from '../../lib/richTextProcessor/wrapDraftText';\n\nexport default function wrapDraft(draft: DraftMessage.draftMessage) {\n  const myEntities = parseEntities(draft.message);\n  const apiEntities = draft.entities || [];\n  const totalEntities = mergeEntities(apiEntities.slice(), myEntities); // ! only in this order, otherwise bold and emoji formatting won't work\n\n  return documentFragmentToHTML(wrapDraftText(draft.message, {entities: totalEntities}));\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nexport default function setCaretAt(node: Node) {\n  // node.appendChild(document.createTextNode(''));\n\n  const originalNode = node;\n  node = node.previousSibling;\n\n  if(node.nodeType === 1) {\n    const newNode = document.createTextNode('');\n    node.parentNode.insertBefore(newNode, !originalNode.nextSibling || originalNode.nextSibling.nodeType === node.nodeType ? originalNode : originalNode.nextSibling);\n    node = newNode;\n  }\n\n  if(window.getSelection && document.createRange) {\n    const range = document.createRange();\n    if(node) {\n      range.setStartAfter(node);\n      range.insertNode(node);\n      range.setStart(node, node.nodeValue.length);\n    }\n\n    range.collapse(true);\n\n    const sel = window.getSelection();\n    sel.removeAllRanges();\n    sel.addRange(range);\n  }\n}\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport type Chat from './chat';\r\nimport type ChatTopbar from './topbar';\r\nimport mediaSizes from '../../helpers/mediaSizes';\r\nimport DivAndCaption from '../divAndCaption';\r\nimport ripple from '../ripple';\r\nimport ListenerSetter from '../../helpers/listenerSetter';\r\nimport cancelEvent from '../../helpers/dom/cancelEvent';\r\nimport {attachClickEvent} from '../../helpers/dom/clickEvent';\r\nimport {Message} from '../../layer';\r\nimport safeAssign from '../../helpers/object/safeAssign';\r\n\r\nconst classNames: string[] = ['is-pinned-message-shown', 'is-pinned-audio-shown'];\r\nconst CLASSNAME_BASE = 'pinned-container';\r\nconst HEIGHT = 52;\r\n\r\nexport default class PinnedContainer {\r\n  public wrapperUtils: HTMLElement;\r\n  public btnClose: HTMLElement;\r\n  protected wrapper: HTMLElement;\r\n\r\n  protected topbar: ChatTopbar;\r\n  protected chat: Chat;\r\n  protected listenerSetter: ListenerSetter;\r\n  public className: string;\r\n  public divAndCaption: DivAndCaption<(title: string | HTMLElement | DocumentFragment, subtitle: string | HTMLElement | DocumentFragment, message?: any) => void>;\r\n\r\n  protected floating = false;\r\n\r\n  public onClose?: () => void | Promise<boolean>;\r\n\r\n  constructor(options: {\r\n    topbar: PinnedContainer['topbar'],\r\n    chat: PinnedContainer['chat'],\r\n    listenerSetter: PinnedContainer['listenerSetter'],\r\n    className: PinnedContainer['className'],\r\n    divAndCaption: PinnedContainer['divAndCaption'],\r\n    onClose?: PinnedContainer['onClose'],\r\n    floating?: PinnedContainer['floating']\r\n  }) {\r\n    safeAssign(this, options);\r\n\r\n    const {divAndCaption, className} = this;\r\n    divAndCaption.container.classList.add(CLASSNAME_BASE, 'hide');\r\n    divAndCaption.title.classList.add(CLASSNAME_BASE + '-title');\r\n    divAndCaption.subtitle.classList.add(CLASSNAME_BASE + '-subtitle');\r\n    divAndCaption.content.classList.add(CLASSNAME_BASE + '-content');\r\n\r\n    this.btnClose = document.createElement('button');\r\n    this.btnClose.classList.add(CLASSNAME_BASE + '-close', `pinned-${className}-close`, 'btn-icon', 'tgico-close');\r\n\r\n    this.wrapper = document.createElement('div');\r\n    this.wrapper.classList.add(CLASSNAME_BASE + '-wrapper');\r\n    ripple(this.wrapper);\r\n\r\n    this.wrapperUtils = document.createElement('div');\r\n    this.wrapperUtils.classList.add(CLASSNAME_BASE + '-wrapper-utils');\r\n    this.wrapperUtils.append(this.btnClose);\r\n\r\n    this.wrapper.append(...Array.from(divAndCaption.container.children), this.wrapperUtils);\r\n\r\n    divAndCaption.container.append(this.wrapper/* , this.close */);\r\n\r\n    this.attachOnCloseEvent(this.btnClose);\r\n  }\r\n\r\n  public attachOnCloseEvent(elem: HTMLElement) {\r\n    attachClickEvent(elem, (e) => {\r\n      cancelEvent(e);\r\n\r\n      ((this.onClose ? this.onClose() : null) || Promise.resolve(true)).then((needClose) => {\r\n        if(needClose) {\r\n          this.toggle(true);\r\n        }\r\n      });\r\n    }, {listenerSetter: this.listenerSetter});\r\n  }\r\n\r\n  public toggle(hide?: boolean) {\r\n    const isHidden = this.divAndCaption.container.classList.contains('hide');\r\n    if(hide === undefined) {\r\n      hide = !isHidden;\r\n    } else if(hide === isHidden) {\r\n      return;\r\n    }\r\n\r\n    // const scrollable = this.chat.bubbles.scrollable;\r\n\r\n    const isFloating = (this.floating || mediaSizes.isMobile) && !hide;\r\n    // const scrollTop = isFloating || this.divAndCaption.container.classList.contains('is-floating') ? scrollable.scrollTop : undefined;\r\n\r\n    this.divAndCaption.container.classList.toggle('is-floating', isFloating);\r\n    this.divAndCaption.container.classList.toggle('hide', hide);\r\n\r\n    this.topbar.container.classList.toggle('is-pinned-floating', isFloating);\r\n    this.topbar.container.classList.toggle(`is-pinned-${this.className}-shown`, !hide);\r\n\r\n    // const active = classNames.filter((className) => this.topbar.container.classList.contains(className));\r\n    // const maxActive = hide ? 0 : 1;\r\n\r\n    // * not sure when it became unneeded\r\n    // if(scrollTop !== undefined && active.length <= maxActive/*  && !scrollable.isScrolledDown */) {\r\n    //   scrollable.scrollTop = scrollTop + ((hide ? -1 : 1) * HEIGHT);\r\n    // }\r\n\r\n    this.topbar.setFloating();\r\n    this.topbar.setUtilsWidth();\r\n  }\r\n\r\n  public isVisible() {\r\n    return !this.divAndCaption.container.classList.contains('hide');\r\n  }\r\n\r\n  public isFloating() {\r\n    return this.divAndCaption.container.classList.contains('is-floating');\r\n  }\r\n\r\n  public fill(title: string | HTMLElement | DocumentFragment, subtitle: string | HTMLElement | DocumentFragment, message: Message.message) {\r\n    this.divAndCaption.container.dataset.peerId = '' + message.peerId;\r\n    this.divAndCaption.container.dataset.mid = '' + message.mid;\r\n    this.divAndCaption.fill(title, subtitle, message);\r\n    this.topbar.setUtilsWidth();\r\n  }\r\n}\r\n","// https://github.com/evgeny-nadymov/telegram-react/blob/master/src/Components/ColumnMiddle/PinnedMessageBorder.js\n\nenum BAR_HEIGHTS {\n  ONE = 32,\n  TWO = 15,\n  THREE = 10,\n  FOUR = 8,\n  MORE = 8\n};\n\nconst GAP = 1;\nconst WIDTH = 2;\nconst BASE_CLASS = 'pinned-message-border';\n\nexport default class PinnedMessageBorder {\n  private border: HTMLElement;\n  private wrapper: HTMLElement;\n  private svg: SVGSVGElement;\n  private defs: SVGDefsElement;\n  private clipPath: SVGClipPathElement;\n  private path: SVGPathElement;\n  private mark: HTMLElement;\n\n  private count: number;\n  private index: number;\n\n  private drawRect = (x: number, y: number, width: number, height: number, radius: number) => {\n    return `M${x},${y + radius}a${radius},${radius},0,0,1,${width},0v${height - 2 * radius}a${radius},${radius},0,0,1,${-width},0Z`;\n  };\n\n  private getClipPath = (id: string, barHeight: number, count: number) => {\n    const radius = 1;\n\n    let d = '';\n    /* if(count === 3) {\n      d = this.drawRect(0, 0, WIDTH, barHeight, radius)\n        + this.drawRect(0, barHeight + GAP, WIDTH, barHeight + 1, radius)\n        + this.drawRect(0, barHeight * 2 + GAP * 2 + 1, WIDTH, barHeight, radius);\n    } */if(count === 2) {\n      d = this.drawRect(0, 0, WIDTH, barHeight, radius) + this.drawRect(0, barHeight + GAP * 2, WIDTH, barHeight, radius);\n    } else {\n      for(let i = 0; i < count; ++i) {\n        d += this.drawRect(0, (barHeight + GAP) * i, WIDTH, barHeight, radius);\n      }\n    }\n\n    if(!this.clipPath) {\n      this.clipPath = document.createElementNS('http://www.w3.org/2000/svg', 'clipPath');\n      this.path = document.createElementNS('http://www.w3.org/2000/svg', 'path');\n\n      this.clipPath.append(this.path);\n    }\n\n    this.clipPath.id = id;\n    this.path.setAttributeNS(null, 'd', d);\n\n    return this.clipPath;\n  };\n\n  private getBarHeight = (count: number, index: number) => {\n    let barHeight: number;\n    if(count <= 1) {\n      barHeight = BAR_HEIGHTS.ONE;\n    } else if(count === 2) {\n      barHeight = BAR_HEIGHTS.TWO;\n    } else if(count === 3) {\n      barHeight = BAR_HEIGHTS.THREE;\n    } else if(count === 4) {\n      barHeight = BAR_HEIGHTS.FOUR;\n    } else if(count > 3) {\n      barHeight = BAR_HEIGHTS.MORE;\n    }\n\n    return barHeight;\n  };\n\n  private getMarkHeight = (count: number, index: number) => {\n    let markHeight: number;\n    if(count <= 1) {\n      markHeight = BAR_HEIGHTS.ONE;\n    } else if(count === 2) {\n      markHeight = BAR_HEIGHTS.TWO;\n    } else if(count === 3) {\n      markHeight = BAR_HEIGHTS.THREE;\n    } else if(count === 4) {\n      markHeight = BAR_HEIGHTS.FOUR;\n    } else if(count > 3) {\n      markHeight = BAR_HEIGHTS.MORE;\n    }\n\n    return markHeight;\n  };\n\n  private getMarkTranslateY = (index: number, barHeight: number, count: number) => {\n    if(count === 1) {\n      return 0;\n    } else if(count === 2) {\n      return !index ? 0 : barHeight + GAP;\n    }\n\n    if(count === 3) {\n      if(!index) {\n        return 0;\n      } else if(index === 1) {\n        return barHeight + GAP;\n      }\n\n      return barHeight * 2 + GAP * 2 + 1;\n    } else {\n      return (barHeight + GAP) * index;\n    }\n  };\n\n  private getTrackTranslateY = (index: number, count: number, barHeight: number, trackHeight: number) => {\n    if(count <= 4) {\n      return 0;\n    }\n\n    if(index <= 1) {\n      return 0;\n    } else if(index >= (count - 2)) {\n      return trackHeight - BAR_HEIGHTS.ONE - barHeight;\n    }\n\n    // return (index + 1) * barHeight + index * GAP;\n    return (index - 2) * barHeight + index * GAP;\n    // return (barHeight + GAP * 2) / 2 + (index - 2) * (barHeight + GAP);\n  };\n\n  private getTrackHeight = (count: number, barHeight: number) => {\n    return count <= 3 ? BAR_HEIGHTS.ONE : barHeight * count + GAP * (count - 1);\n  };\n\n  public render(count: number, index: number) {\n    if(!this.border) {\n      this.border = document.createElement('div');\n      this.border.classList.add(BASE_CLASS);\n\n      this.wrapper = document.createElement('div');\n      this.border.append(this.wrapper);\n    }\n\n    if(count === 1) {\n      if(this.count !== count) {\n        this.wrapper.className = BASE_CLASS + '-wrapper-1';\n        this.border.classList.remove(BASE_CLASS + '-mask');\n        this.wrapper.innerHTML = this.wrapper.style.cssText = '';\n      }\n\n      return this.border;\n    }\n\n    const barHeight = this.getBarHeight(count, index);\n    const markHeight = this.getMarkHeight(count, index);\n    const trackHeight = this.getTrackHeight(count, barHeight);\n\n    const clipPathId = `clipPath_${count}`;\n    const clipPath = this.getClipPath(clipPathId, barHeight, count);\n\n    const markTranslateY = this.getMarkTranslateY(index, barHeight, count);\n    const trackTranslateY = this.getTrackTranslateY(index, count, barHeight, trackHeight);\n\n    this.border.classList.toggle(BASE_CLASS + '-mask', count > 4);\n\n    if(index <= 1) {\n      this.border.classList.add('mask-bottom');\n      this.border.classList.remove('mask-top');\n    } else if(index >= (count - 2)) {\n      this.border.classList.add('mask-top');\n      this.border.classList.remove('mask-bottom');\n    } else {\n      this.border.classList.add('mask-top', 'mask-bottom');\n    }\n\n    this.wrapper.className = BASE_CLASS + '-wrapper';\n    this.wrapper.style.cssText = `clip-path: url(#${clipPathId}); width: 2px; height: ${trackHeight}px; transform: translateY(-${trackTranslateY}px);`;\n\n    if(!this.svg) {\n      this.svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');\n      this.svg.setAttributeNS(null, 'height', '0');\n      this.svg.setAttributeNS(null, 'width', '0');\n\n      this.defs = document.createElementNS('http://www.w3.org/2000/svg', 'defs');\n      this.defs.append(clipPath);\n\n      this.svg.append(this.defs);\n\n      this.mark = document.createElement('div');\n      this.mark.classList.add(BASE_CLASS + '-mark');\n    }\n\n    if(!this.svg.parentElement) {\n      this.wrapper.append(this.svg, this.mark);\n    }\n\n    this.mark.style.cssText = `height: ${markHeight}px; transform: translateY(${markTranslateY}px);`;\n\n    this.count = count;\n    this.index = index;\n\n    return this.border;\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport type {AppMessagesManager} from '../../lib/appManagers/appMessagesManager';\nimport type ChatTopbar from './topbar';\nimport rootScope from '../../lib/rootScope';\nimport appMediaPlaybackController, {AppMediaPlaybackController} from '../appMediaPlaybackController';\nimport DivAndCaption from '../divAndCaption';\nimport PinnedContainer from './pinnedContainer';\nimport Chat from './chat';\nimport cancelEvent from '../../helpers/dom/cancelEvent';\nimport {attachClickEvent} from '../../helpers/dom/clickEvent';\nimport replaceContent from '../../helpers/dom/replaceContent';\nimport PeerTitle from '../peerTitle';\nimport {i18n} from '../../lib/langPack';\nimport {formatFullSentTime} from '../../helpers/date';\nimport ButtonIcon from '../buttonIcon';\nimport {DocumentAttribute} from '../../layer';\nimport MediaProgressLine from '../mediaProgressLine';\nimport VolumeSelector from '../volumeSelector';\nimport wrapEmojiText from '../../lib/richTextProcessor/wrapEmojiText';\nimport {AppManagers} from '../../lib/appManagers/managers';\n\nexport default class ChatAudio extends PinnedContainer {\n  private toggleEl: HTMLElement;\n  private progressLine: MediaProgressLine;\n  private volumeSelector: VolumeSelector;\n  private fasterEl: HTMLElement;\n  private repeatEl: HTMLButtonElement;\n\n  constructor(protected topbar: ChatTopbar, protected chat: Chat, protected managers: AppManagers) {\n    super({\n      topbar,\n      chat,\n      listenerSetter: topbar.listenerSetter,\n      className: 'audio',\n      divAndCaption: new DivAndCaption(\n        'pinned-audio',\n        (title: string | HTMLElement | DocumentFragment, subtitle: string | HTMLElement | DocumentFragment) => {\n          replaceContent(this.divAndCaption.title, title);\n          replaceContent(this.divAndCaption.subtitle, subtitle);\n        }\n      ),\n      onClose: () => {\n        appMediaPlaybackController.stop();\n      },\n      floating: true\n    });\n\n    this.divAndCaption.border.remove();\n\n    const prevEl = ButtonIcon('fast_rewind active', {noRipple: true});\n    const nextEl = ButtonIcon('fast_forward active', {noRipple: true});\n\n    const attachClick = (elem: HTMLElement, callback: () => void) => {\n      attachClickEvent(elem, (e) => {\n        cancelEvent(e);\n        callback();\n      }, {listenerSetter: this.topbar.listenerSetter});\n    };\n\n    attachClick(prevEl, () => {\n      appMediaPlaybackController.previous();\n    });\n\n    attachClick(nextEl, () => {\n      appMediaPlaybackController.next();\n    });\n\n    this.toggleEl = ButtonIcon('', {noRipple: true});\n    this.toggleEl.classList.add('active', 'pinned-audio-ico', 'tgico');\n    attachClick(this.toggleEl, () => {\n      appMediaPlaybackController.toggle();\n    });\n    this.wrapper.prepend(this.wrapper.firstElementChild, prevEl, this.toggleEl, nextEl);\n\n    this.volumeSelector = new VolumeSelector(this.listenerSetter, true);\n    const volumeProgressLineContainer = document.createElement('div');\n    volumeProgressLineContainer.classList.add('progress-line-container');\n    volumeProgressLineContainer.append(this.volumeSelector.container);\n    const tunnel = document.createElement('div');\n    tunnel.classList.add('pinned-audio-volume-tunnel');\n    this.volumeSelector.btn.classList.add('pinned-audio-volume', 'active');\n    this.volumeSelector.btn.prepend(tunnel);\n    this.volumeSelector.btn.append(volumeProgressLineContainer);\n\n    this.repeatEl = ButtonIcon('audio_repeat', {noRipple: true});\n    attachClick(this.repeatEl, () => {\n      const params = appMediaPlaybackController.getPlaybackParams();\n      if(!params.round) {\n        appMediaPlaybackController.round = true;\n      } else if(params.loop) {\n        appMediaPlaybackController.round = false;\n        appMediaPlaybackController.loop = false;\n      } else {\n        appMediaPlaybackController.loop = !appMediaPlaybackController.loop;\n      }\n    });\n\n    const fasterEl = this.fasterEl = ButtonIcon('playback_2x', {noRipple: true});\n    attachClick(fasterEl, () => {\n      appMediaPlaybackController.playbackRate = fasterEl.classList.contains('active') ? 1 : 1.75;\n    });\n\n    this.wrapperUtils.prepend(this.volumeSelector.btn, fasterEl, this.repeatEl);\n\n    const progressWrapper = document.createElement('div');\n    progressWrapper.classList.add('pinned-audio-progress-wrapper');\n\n    this.progressLine = new MediaProgressLine(undefined, undefined, true, true);\n    this.progressLine.container.classList.add('pinned-audio-progress');\n    progressWrapper.append(this.progressLine.container);\n    this.wrapper.insertBefore(progressWrapper, this.wrapperUtils);\n\n    this.topbar.listenerSetter.add(appMediaPlaybackController)('play', this.onMediaPlay);\n    this.topbar.listenerSetter.add(appMediaPlaybackController)('pause', this.onPause);\n    this.topbar.listenerSetter.add(appMediaPlaybackController)('stop', this.onStop);\n    this.topbar.listenerSetter.add(appMediaPlaybackController)('playbackParams', this.onPlaybackParams);\n\n    const playingDetails = appMediaPlaybackController.getPlayingDetails();\n    if(playingDetails) {\n      this.onMediaPlay(playingDetails);\n      this.onPlaybackParams(playingDetails.playbackParams);\n    }\n  }\n\n  public destroy() {\n    if(this.progressLine) {\n      this.progressLine.removeListeners();\n    }\n  }\n\n  private onPlaybackParams = (playbackParams: ReturnType<AppMediaPlaybackController['getPlaybackParams']>) => {\n    this.fasterEl.classList.toggle('active', playbackParams.playbackRate > 1);\n\n    this.repeatEl.classList.remove('tgico-audio_repeat', 'tgico-audio_repeat_single');\n    this.repeatEl.classList.add(playbackParams.loop ? 'tgico-audio_repeat_single' : 'tgico-audio_repeat');\n    this.repeatEl.classList.toggle('active', playbackParams.loop || playbackParams.round);\n  };\n\n  private onPause = () => {\n    this.toggleEl.classList.remove('flip-icon');\n  };\n\n  private onStop = () => {\n    this.toggle(true);\n  };\n\n  private onMediaPlay = ({doc, message, media, playbackParams}: ReturnType<AppMediaPlaybackController['getPlayingDetails']>) => {\n    let title: string | HTMLElement | DocumentFragment, subtitle: string | HTMLElement | DocumentFragment;\n    const isMusic = doc.type !== 'voice' && doc.type !== 'round';\n    if(!isMusic) {\n      title = new PeerTitle({peerId: message.fromId, fromName: message.fwd_from?.from_name}).element;\n\n      // subtitle = 'Voice message';\n      subtitle = formatFullSentTime(message.date);\n    } else {\n      const audioAttribute = doc.attributes.find((attr) => attr._ === 'documentAttributeAudio') as DocumentAttribute.documentAttributeAudio;\n      title = wrapEmojiText(audioAttribute?.title ?? doc.file_name);\n      subtitle = audioAttribute?.performer ? wrapEmojiText(audioAttribute.performer) : i18n('AudioUnknownArtist');\n    }\n\n    this.fasterEl.classList.toggle('hide', isMusic);\n    this.repeatEl.classList.toggle('hide', !isMusic);\n\n    this.onPlaybackParams(playbackParams);\n    this.volumeSelector.setVolume();\n\n    this.progressLine.setMedia(media);\n\n    this.fill(title, subtitle, message);\n    // this.toggleEl.classList.add('flip-icon');\n    this.toggleEl.classList.toggle('flip-icon', !media.paused);\n    this.toggle(false);\n  };\n}\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport type ChatTopbar from './topbar';\r\nimport PopupPinMessage from '../popups/unpinMessage';\r\nimport PinnedContainer from './pinnedContainer';\r\nimport PinnedMessageBorder from './pinnedMessageBorder';\r\nimport ReplyContainer, {wrapReplyDivAndCaption} from './replyContainer';\r\nimport rootScope from '../../lib/rootScope';\r\nimport Chat from './chat';\r\nimport ListenerSetter from '../../helpers/listenerSetter';\r\nimport ButtonIcon from '../buttonIcon';\r\nimport {getHeavyAnimationPromise} from '../../hooks/useHeavyAnimationCheck';\r\nimport {i18n} from '../../lib/langPack';\r\nimport cancelEvent from '../../helpers/dom/cancelEvent';\r\nimport {attachClickEvent} from '../../helpers/dom/clickEvent';\r\nimport handleScrollSideEvent from '../../helpers/dom/handleScrollSideEvent';\r\nimport debounce from '../../helpers/schedulers/debounce';\r\nimport throttle from '../../helpers/schedulers/throttle';\r\nimport {AppManagers} from '../../lib/appManagers/managers';\r\nimport {Message} from '../../layer';\r\nimport {logger} from '../../lib/logger';\r\n\r\nclass AnimatedSuper {\r\n  static DURATION = 200;\r\n  static BASE_CLASS = 'animated-super';\r\n  container: HTMLDivElement;\r\n  rows: {[index: string]: {element: HTMLElement, timeout?: number, new?: true}} = {};\r\n  clearTimeout: number;\r\n\r\n  constructor() {\r\n    this.container = document.createElement('div');\r\n    this.container.className = AnimatedSuper.BASE_CLASS;\r\n  }\r\n\r\n  public getRow(index: number, animateFirst = false) {\r\n    if(this.rows[index]) return this.rows[index].element;\r\n    const row = document.createElement('div');\r\n    const isFirst = !Object.keys(this.rows).length && !animateFirst;\r\n    row.className = AnimatedSuper.BASE_CLASS + '-row' + (isFirst ? '' : ' is-hiding hide');\r\n    this.rows[index] = {element: row, new: true};\r\n    this.container.append(row);\r\n    return row;\r\n  }\r\n\r\n  public clearRow(index: number) {\r\n    if(!this.rows[index]) return;\r\n    this.rows[index].element.remove();\r\n    delete this.rows[index];\r\n  }\r\n\r\n  public clearRows(currentIndex?: number) {\r\n    if(this.clearTimeout) clearTimeout(this.clearTimeout);\r\n    this.clearTimeout = window.setTimeout(() => {\r\n      for(const i in this.rows) {\r\n        if(+i === currentIndex) continue;\r\n        this.clearRow(+i);\r\n      }\r\n    }, AnimatedSuper.DURATION);\r\n  }\r\n\r\n  public setNewRow(index: number, reflow = false) {\r\n    const row = this.rows[index];\r\n    if(row.new) {\r\n      if(reflow) {\r\n        row.element.classList.remove('hide');\r\n        void row.element.offsetLeft; // reflow\r\n      } else {\r\n        row.element.classList.remove('is-hiding', 'hide');\r\n      }\r\n\r\n      delete row.new;\r\n    }\r\n\r\n    this.clearRows(index);\r\n  }\r\n\r\n  public animate(index: number, previousIndex: number, fromTop = index > previousIndex, ignorePrevious = false) {\r\n    if(index === previousIndex) { // * handle if set index 0 and previousIndex 0\r\n      return this.setNewRow(index);\r\n    }\r\n\r\n    const row = this.rows[index];\r\n    const previousRow = this.rows[previousIndex];\r\n    if(!previousRow && !ignorePrevious) {\r\n      return this.setNewRow(index);\r\n    }\r\n\r\n    const sides = ['from-top', 'from-bottom'];\r\n    if(!fromTop) sides.reverse();\r\n\r\n    row.element.classList.add(sides[0]);\r\n    row.element.classList.remove(sides[1]);\r\n    if(previousRow) {\r\n      previousRow.element.classList.add(sides[1]);\r\n      previousRow.element.classList.remove(sides[0]);\r\n    }\r\n\r\n    if(row.new) {\r\n      this.setNewRow(index, true);\r\n    }\r\n\r\n    row.element.classList.toggle('is-hiding', false);\r\n    previousRow && previousRow.element.classList.toggle('is-hiding', true);\r\n\r\n    /* const height = row.element.getBoundingClientRect().height;\r\n    row.element.style.transform = `translateY(${fromTop ? height * -1 : height}px)`;\r\n    if(previousRow) {\r\n      previousRow.element.style.transform = `translateY(${fromTop ? height : height * -1}px)`;\r\n    } */\r\n\r\n    /* row.element.style.setProperty('--height', row.element.getBoundingClientRect().height + 'px');\r\n    if(previousRow) {\r\n      previousRow.element.style.setProperty('--height', previousRow.element.getBoundingClientRect().height + 'px');\r\n    } */\r\n\r\n    this.clearRows(index);\r\n  }\r\n}\r\n\r\nclass AnimatedCounter {\r\n  static EMPTY_INDEX = -1;\r\n  static BASE_CLASS = 'animated-counter';\r\n  container: HTMLElement;\r\n  decimals: {\r\n    container: HTMLElement,\r\n    placeholder: HTMLElement,\r\n    animatedSuper: AnimatedSuper\r\n  }[] = [];\r\n  previousNumber = 0;\r\n  clearTimeout: number;\r\n\r\n  constructor(private reverse = false) {\r\n    this.container = document.createElement('div');\r\n    this.container.className = AnimatedCounter.BASE_CLASS;\r\n  }\r\n\r\n  getDecimal(index: number) {\r\n    if(this.decimals[index]) return this.decimals[index];\r\n    const item = document.createElement('div');\r\n    item.className = AnimatedCounter.BASE_CLASS + '-decimal';\r\n\r\n    const placeholder = document.createElement('div');\r\n    placeholder.className = AnimatedCounter.BASE_CLASS + '-decimal-placeholder';\r\n\r\n    const animatedSuper = new AnimatedSuper();\r\n    animatedSuper.container.className = AnimatedCounter.BASE_CLASS + '-decimal-wrapper';\r\n\r\n    item.append(placeholder, animatedSuper.container);\r\n\r\n    this.container.append(item);\r\n\r\n    return this.decimals[index] = {container: item, placeholder, animatedSuper};\r\n  }\r\n\r\n  clear(number: number) {\r\n    if(this.clearTimeout) clearTimeout(this.clearTimeout);\r\n\r\n    const decimals = ('' + number).length;\r\n    if(decimals >= this.decimals.length) {\r\n      return;\r\n    }\r\n\r\n    this.clearTimeout = window.setTimeout(() => {\r\n      const byDecimal = this.decimals.splice(decimals, this.decimals.length - decimals);\r\n      byDecimal.forEach((decimal) => {\r\n        decimal.container.remove();\r\n      });\r\n    }, AnimatedSuper.DURATION);\r\n  }\r\n\r\n  /* prepareNumber(number: number) {\r\n    const decimals = ('' + number).length;\r\n    if(this.decimals.length < decimals) {\r\n      for(let i = this.decimals.length; i < decimals; ++i) {\r\n        this.getDecimal(i);\r\n      }\r\n    }\r\n  } */\r\n\r\n  hideLeft(number: number) {\r\n    const decimals = ('' + number).length;\r\n    const byDecimal = this.decimals.slice(decimals);// this.decimals.splice(deleteCount, this.decimals.length - deleteCount);\r\n    byDecimal.forEach((decimal) => {\r\n      const previousDecimalNumber = +decimal.placeholder.innerText || 0;\r\n      const row = decimal.animatedSuper.getRow(AnimatedCounter.EMPTY_INDEX, true);\r\n      decimal.animatedSuper.animate(AnimatedCounter.EMPTY_INDEX, previousDecimalNumber, this.reverse ? number < this.previousNumber : number > this.previousNumber, true);\r\n    });\r\n\r\n    this.clear(number);\r\n  }\r\n\r\n  setCount(number: number) {\r\n    // this.prepareNumber(number);\r\n\r\n    const previousByDecimal = Array.from('' + this.previousNumber).map((n) => +n);\r\n    const byDecimal = Array.from('' + number).map((n) => +n);\r\n    byDecimal.forEach((decimalNumber, idx) => {\r\n      const decimal = this.getDecimal(idx);\r\n      // const row = decimal.animatedSuper.getRow(number, true);\r\n      const row = decimal.animatedSuper.getRow(decimalNumber, true);\r\n      const previousDecimalNumber = previousByDecimal[idx] ?? AnimatedCounter.EMPTY_INDEX;\r\n      row.innerText = decimal.placeholder.innerText = '' + decimalNumber;\r\n      // decimal.animatedSuper.animate(number, this.previousNumber, this.reverse ? number < this.previousNumber : number > this.previousNumber, true);\r\n      decimal.animatedSuper.animate(decimalNumber, previousDecimalNumber, this.reverse ? number < this.previousNumber : number > this.previousNumber, true);\r\n    });\r\n\r\n    this.hideLeft(number);\r\n    // this.clear(number);\r\n    this.previousNumber = number;\r\n  }\r\n}\r\n\r\nexport default class ChatPinnedMessage {\r\n  private static LOAD_COUNT = 50;\r\n  private static LOAD_OFFSET = 5;\r\n\r\n  public pinnedMessageContainer: PinnedContainer;\r\n  private pinnedMessageBorder: PinnedMessageBorder;\r\n\r\n  private pinnedMaxMid = 0;\r\n  public pinnedMid = 0;\r\n  public pinnedIndex = -1;\r\n  private wasPinnedIndex = 0;\r\n  private wasPinnedMediaIndex = 0;\r\n\r\n  public locked = false;\r\n  private waitForScrollBottom = false;\r\n\r\n  public count = 0;\r\n  private mids: number[] = [];\r\n  private offsetIndex = 0;\r\n\r\n  private loading = false;\r\n  private loadedBottom = false;\r\n  private loadedTop = false;\r\n\r\n  private animatedSubtitle: AnimatedSuper;\r\n  private animatedMedia: AnimatedSuper;\r\n  private animatedCounter: AnimatedCounter;\r\n\r\n  private listenerSetter: ListenerSetter;\r\n  private scrollDownListenerSetter: ListenerSetter = null;\r\n\r\n  public hidden = false;\r\n\r\n  private getCurrentIndexPromise: Promise<any> = null;\r\n  private btnOpen: HTMLButtonElement;\r\n\r\n  private setPinnedMessage: () => void;\r\n\r\n  private isStatic: boolean;\r\n\r\n  private debug: boolean;\r\n\r\n  public setCorrectIndexThrottled: (lastScrollDirection?: number) => void;\r\n\r\n  private log: ReturnType<typeof logger>;\r\n\r\n  constructor(private topbar: ChatTopbar, private chat: Chat, private managers: AppManagers) {\r\n    this.listenerSetter = new ListenerSetter();\r\n    this.log = logger('PM');\r\n    this.debug = true;\r\n    this.isStatic = false;\r\n\r\n    const dAC = new ReplyContainer('pinned-message');\r\n    this.pinnedMessageContainer = new PinnedContainer({\r\n      topbar,\r\n      chat,\r\n      listenerSetter: this.listenerSetter,\r\n      className: 'message',\r\n      divAndCaption: dAC,\r\n      onClose: async() => {\r\n        if(await managers.appPeersManager.canPinMessage(this.chat.peerId)) {\r\n          new PopupPinMessage(this.chat.peerId, this.pinnedMid, true);\r\n        } else {\r\n          new PopupPinMessage(this.chat.peerId, 0, true);\r\n        }\r\n\r\n        return false;\r\n      }\r\n    });\r\n\r\n    this.pinnedMessageBorder = new PinnedMessageBorder();\r\n    dAC.border.replaceWith(this.pinnedMessageBorder.render(1, 0));\r\n\r\n    this.animatedSubtitle = new AnimatedSuper();\r\n    dAC.subtitle.append(this.animatedSubtitle.container);\r\n\r\n    this.animatedMedia = new AnimatedSuper();\r\n    this.animatedMedia.container.classList.add('pinned-message-media-container');\r\n    dAC.content.prepend(this.animatedMedia.container);\r\n\r\n    this.animatedCounter = new AnimatedCounter(true);\r\n    dAC.title.append(i18n('PinnedMessage'), ' ', this.animatedCounter.container);\r\n\r\n    const btnClose = this.pinnedMessageContainer.btnClose.cloneNode(true) as HTMLElement;\r\n    this.pinnedMessageContainer.attachOnCloseEvent(btnClose);\r\n    dAC.container.prepend(btnClose);\r\n\r\n    this.btnOpen = ButtonIcon('pinlist pinned-container-close pinned-message-pinlist', {noRipple: true});\r\n\r\n    this.pinnedMessageContainer.wrapperUtils.prepend(this.btnOpen);\r\n\r\n    attachClickEvent(this.btnOpen, (e) => {\r\n      cancelEvent(e);\r\n      this.topbar.openPinned(true);\r\n    }, {listenerSetter: this.listenerSetter});\r\n\r\n    this.listenerSetter.add(rootScope)('peer_pinned_messages', ({peerId}) => {\r\n      if(peerId === this.chat.peerId) {\r\n        // this.wasPinnedIndex = 0;\r\n        // setTimeout(() => {\r\n        if(this.hidden) {\r\n          this.pinnedMessageContainer.toggle(this.hidden = false);\r\n        }\r\n\r\n        this.loadedTop = this.loadedBottom = false;\r\n        this.pinnedIndex = -1;\r\n        this.pinnedMid = 0;\r\n        this.count = 0;\r\n        this.mids = [];\r\n        this.offsetIndex = 0;\r\n        this.pinnedMaxMid = 0;\r\n        this.setCorrectIndex(0);\r\n        // }, 300);\r\n      }\r\n    });\r\n\r\n    this.listenerSetter.add(rootScope)('peer_pinned_hidden', ({peerId}) => {\r\n      if(peerId === this.chat.peerId) {\r\n        this.pinnedMessageContainer.toggle(this.hidden = true);\r\n      }\r\n    });\r\n\r\n    // * 200 - no lags\r\n    // * 100 - need test\r\n    this.setPinnedMessage = debounce(() => this._setPinnedMessage(), 100, true, true);\r\n    this.setCorrectIndexThrottled = throttle(this.setCorrectIndex.bind(this), 100, false);\r\n\r\n    this.isStatic = this.chat.type === 'discussion';\r\n  }\r\n\r\n  public destroy() {\r\n    this.pinnedMessageContainer.divAndCaption.container.remove();\r\n    this.pinnedMessageContainer.toggle(true);\r\n    this.listenerSetter.removeAll();\r\n    this.unsetScrollDownListener(false);\r\n  }\r\n\r\n  public setCorrectIndex(lastScrollDirection?: number) {\r\n    if(this.isStatic) return;\r\n    // return;\r\n\r\n    if(this.locked || this.hidden/*  || this.chat.setPeerPromise || this.chat.bubbles.messagesQueuePromise */) {\r\n      return;\r\n    }\r\n\r\n    if((this.loadedBottom || this.loadedTop) && !this.count) {\r\n      return;\r\n    }\r\n\r\n    // const perf = performance.now();\r\n    const el = this.chat.bubbles.getBubbleByPoint('bottom');\r\n    // this.log('setCorrectIndex: get last element perf:', performance.now() - perf, el);\r\n    if(!el) return;\r\n\r\n    // return;\r\n\r\n    const mid = el.dataset.mid;\r\n    if(el && mid !== undefined) {\r\n      // this.log('setCorrectIndex will test mid:', mid);\r\n      this.testMid(+mid, lastScrollDirection);\r\n    }\r\n  }\r\n\r\n  public testMid(mid: number, lastScrollDirection?: number) {\r\n    if(this.isStatic) return;\r\n\r\n    // if(lastScrollDirection !== undefined) return;\r\n    if(this.hidden) return;\r\n\r\n    // this.log('testMid', mid);\r\n\r\n    let currentIndex: number = this.mids.findIndex((_mid) => _mid <= mid);\r\n    if(currentIndex !== -1 && !this.isNeededMore(currentIndex)) {\r\n      currentIndex += this.offsetIndex;\r\n    } else if(this.loadedTop && mid < this.mids[this.mids.length - 1]) {\r\n      // currentIndex = 0;\r\n      currentIndex = this.mids.length - 1 + this.offsetIndex;\r\n    } else {\r\n      if(!this.getCurrentIndexPromise) {\r\n        this.getCurrentIndexPromise = this.getCurrentIndex(mid, lastScrollDirection !== undefined);\r\n      }\r\n\r\n      return;\r\n    }\r\n\r\n    // const idx = Math.max(0, this.mids.indexOf(mid));\r\n\r\n    /* if(currentIndex === this.count) {\r\n      currentIndex = 0;\r\n    } */\r\n\r\n    // this.log('testMid: pinned currentIndex', currentIndex, mid);\r\n\r\n    const changed = this.pinnedIndex !== currentIndex;\r\n    if(changed) {\r\n      if(this.waitForScrollBottom && lastScrollDirection !== undefined) {\r\n        if(this.pinnedIndex === 0 || this.pinnedIndex > currentIndex) { //          - \r\n          return;\r\n        }\r\n      }\r\n\r\n      this.pinnedIndex = currentIndex;\r\n      this.pinnedMid = this.mids.find((_mid) => _mid <= mid) || this.mids[this.mids.length - 1];\r\n      this.setPinnedMessage();\r\n    }\r\n  }\r\n\r\n  private isNeededMore(currentIndex: number) {\r\n    return (this.count > ChatPinnedMessage.LOAD_COUNT &&\r\n      (\r\n        (!this.loadedBottom && currentIndex <= ChatPinnedMessage.LOAD_OFFSET) ||\r\n        (!this.loadedTop && (this.count - 1 - currentIndex) <= ChatPinnedMessage.LOAD_OFFSET)\r\n      )\r\n    );\r\n  }\r\n\r\n  private async getCurrentIndex(mid: number, correctAfter = true) {\r\n    if(this.loading) return;\r\n    this.loading = true;\r\n\r\n    try {\r\n      const log = this.debug ? this.log.bindPrefix('getCurrentIndex') : undefined;\r\n      log && log('start', mid, correctAfter);\r\n\r\n      let gotRest = false;\r\n      const promises = [\r\n        this.managers.appMessagesManager.getSearch({\r\n          peerId: this.chat.peerId,\r\n          inputFilter: {_: 'inputMessagesFilterPinned'},\r\n          maxId: mid,\r\n          limit: ChatPinnedMessage.LOAD_COUNT,\r\n          backLimit: ChatPinnedMessage.LOAD_COUNT\r\n        })\r\n        .then((r) => {\r\n          gotRest = true;\r\n          return r;\r\n        })\r\n      ];\r\n\r\n      if(!this.pinnedMaxMid) {\r\n        const promise = this.managers.appMessagesManager.getPinnedMessage(this.chat.peerId).then((p) => {\r\n          if(!p.maxId) return;\r\n          this.pinnedMaxMid = p.maxId;\r\n\r\n          if(!gotRest && correctAfter) {\r\n            this.mids = [this.pinnedMaxMid];\r\n            this.count = p.count;\r\n            this.pinnedIndex = 0;\r\n            this.pinnedMid = this.mids[0];\r\n            this.setPinnedMessage();\r\n            // this.pinnedMessageContainer.toggle(false);\r\n          }\r\n        });\r\n\r\n        promises.push(promise as any);\r\n      }\r\n\r\n      const result = (await Promise.all(promises))[0];\r\n\r\n      let backLimited = result.history.findIndex((message) => message.mid <= mid);\r\n      if(backLimited === -1) {\r\n        backLimited = result.history.length;\r\n      }/*  else {\r\n        backLimited -= 1;\r\n      } */\r\n\r\n      this.offsetIndex = result.offset_id_offset ? result.offset_id_offset - backLimited : 0;\r\n      this.mids = result.history.map((message) => message.mid).slice();\r\n      this.count = result.count;\r\n\r\n      if(!this.count) {\r\n        this.pinnedMessageContainer.toggle(true);\r\n      }\r\n\r\n      this.loadedTop = (this.offsetIndex + this.mids.length) === this.count;\r\n      this.loadedBottom = !this.offsetIndex;\r\n\r\n      log && log('result', mid, result, backLimited, this.offsetIndex, this.loadedTop, this.loadedBottom);\r\n    } catch(err) {\r\n      this.log.error('getCurrentIndex error', err);\r\n    }\r\n\r\n    this.loading = false;\r\n\r\n    if(this.locked) {\r\n      this.testMid(mid);\r\n    } else if(correctAfter) {\r\n      this.setCorrectIndex(0);\r\n    }\r\n\r\n    this.getCurrentIndexPromise = null;\r\n    // return result.offset_id_offset || 0;\r\n  }\r\n\r\n  public setScrollDownListener() {\r\n    this.waitForScrollBottom = true;\r\n\r\n    if(!this.scrollDownListenerSetter) {\r\n      this.scrollDownListenerSetter = new ListenerSetter();\r\n      handleScrollSideEvent(this.chat.bubbles.scrollable.container, 'bottom', () => {\r\n        this.unsetScrollDownListener();\r\n      }, this.scrollDownListenerSetter);\r\n    }\r\n  }\r\n\r\n  public unsetScrollDownListener(refreshPosition = true) {\r\n    this.waitForScrollBottom = false;\r\n\r\n    if(this.scrollDownListenerSetter) {\r\n      this.scrollDownListenerSetter.removeAll();\r\n      this.scrollDownListenerSetter = null;\r\n    }\r\n\r\n    if(refreshPosition) {\r\n      this.setCorrectIndex(0);\r\n    }\r\n  }\r\n\r\n  public async handleFollowingPinnedMessage() {\r\n    this.locked = true;\r\n\r\n    this.debug && this.log('handleFollowingPinnedMessage');\r\n    try {\r\n      this.setScrollDownListener();\r\n\r\n      const setPeerPromise = this.chat.setPeerPromise;\r\n      if(setPeerPromise instanceof Promise) {\r\n        await setPeerPromise;\r\n      }\r\n\r\n      // await this.chat.bubbles.scrollable.scrollLockedPromise;\r\n      await getHeavyAnimationPromise();\r\n\r\n      if(this.getCurrentIndexPromise) {\r\n        await this.getCurrentIndexPromise;\r\n      }\r\n\r\n      this.debug && this.log('handleFollowingPinnedMessage: unlock');\r\n      this.locked = false;\r\n\r\n      /* // ,   \r\n      setTimeout(() => {\r\n        this.log('handleFollowingPinnedMessage: unlock');\r\n        this.locked = false;\r\n      }, 50); */\r\n    } catch(err) {\r\n      this.log.error('handleFollowingPinnedMessage error:', err);\r\n\r\n      this.locked = false;\r\n      this.waitForScrollBottom = false;\r\n      this.setCorrectIndex(0);\r\n    }\r\n  }\r\n\r\n  public async followPinnedMessage(mid: number) {\r\n    const message = await this.chat.getMessage(mid);\r\n    if(!message) {\r\n      return;\r\n    }\r\n\r\n    this.chat.setMessageId(mid);\r\n    (this.chat.setPeerPromise || Promise.resolve()).then(() => { // * debounce fast clicker\r\n      this.handleFollowingPinnedMessage();\r\n      this.testMid(this.pinnedIndex >= (this.count - 1) ? this.pinnedMaxMid : mid - 1);\r\n    });\r\n  }\r\n\r\n  public async _setPinnedMessage() {\r\n    // ///this.log('setting pinned message', message);\r\n    // return;\r\n    /* const promise: Promise<any> = this.chat.setPeerPromise || this.chat.bubbles.messagesQueuePromise || Promise.resolve();\r\n    Promise.all([\r\n      promise\r\n    ]).then(() => { */\r\n    // const mids = results[0];\r\n    const count = this.count;\r\n    if(count) {\r\n      const pinnedIndex = this.pinnedIndex;\r\n      const message = await this.chat.getMessage(this.pinnedMid);\r\n\r\n      // this.animatedCounter.prepareNumber(count);\r\n\r\n      // setTimeout(() => {\r\n      const isLast = pinnedIndex === 0;\r\n      this.animatedCounter.container.classList.toggle('is-last', isLast);\r\n      // SetTransition(this.animatedCounter.container, 'is-last', isLast, AnimatedSuper.DURATION);\r\n      if(!isLast) {\r\n        this.animatedCounter.setCount(count - pinnedIndex);\r\n      }\r\n      // }, 100);\r\n\r\n      // this.pinnedMessageContainer.fill(undefined, message.message, message);\r\n      this.pinnedMessageContainer.toggle(false);\r\n\r\n      const fromTop = pinnedIndex > this.wasPinnedIndex;\r\n\r\n      this.debug && this.log('setPinnedMessage: fromTop', fromTop, pinnedIndex, this.wasPinnedIndex);\r\n\r\n      const writeTo = this.animatedSubtitle.getRow(pinnedIndex);\r\n      const writeMediaTo = this.animatedMedia.getRow(pinnedIndex);\r\n      writeMediaTo.classList.add('pinned-message-media');\r\n      // writeMediaTo.innerHTML = writeMediaTo.style.cssText = writeMediaTo.dataset.docId = '';\r\n      const loadPromises: Promise<any>[] = [];\r\n      const isMediaSet = await wrapReplyDivAndCaption({\r\n        title: undefined,\r\n        titleEl: null,\r\n        subtitle: (message as Message.message).message,\r\n        subtitleEl: writeTo,\r\n        message,\r\n        mediaEl: writeMediaTo,\r\n        loadPromises\r\n      });\r\n\r\n      await Promise.all(loadPromises);\r\n\r\n      this.pinnedMessageContainer.divAndCaption.container.classList.toggle('is-media', isMediaSet);\r\n\r\n      // if(this.wasPinnedIndex !== this.pinnedIndex) {\r\n      this.animatedSubtitle.animate(pinnedIndex, this.wasPinnedIndex);\r\n      if(isMediaSet) {\r\n        this.animatedMedia.animate(pinnedIndex, this.wasPinnedMediaIndex); // * wasPinnedMediaIndex - ,      \r\n        this.wasPinnedMediaIndex = pinnedIndex;\r\n      } else {\r\n        this.animatedMedia.clearRows();\r\n      }\r\n      // }\r\n\r\n      this.pinnedMessageBorder.render(count, count - pinnedIndex - 1);\r\n      this.wasPinnedIndex = pinnedIndex;\r\n      this.pinnedMessageContainer.divAndCaption.container.dataset.mid = '' + message.mid;\r\n    } else {\r\n      this.pinnedMessageContainer.toggle(true);\r\n      this.wasPinnedIndex = 0;\r\n    }\r\n\r\n    this.pinnedMessageContainer.divAndCaption.container.classList.toggle('is-many', this.count > 1);\r\n    // });\r\n  }\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport type ListenerSetter from '../listenerSetter';\r\nimport IS_TOUCH_SUPPORTED from '../../environment/touchSupport';\r\n\r\nexport default function handleScrollSideEvent(elem: HTMLElement, side: 'top' | 'bottom', callback: () => void, listenerSetter: ListenerSetter) {\r\n  if(IS_TOUCH_SUPPORTED) {\r\n    let lastY: number;\r\n    const options = {passive: true};\r\n    listenerSetter.add(elem)('touchstart', (e) => {\r\n      if(e.touches.length > 1) {\r\n        onTouchEnd();\r\n        return;\r\n      }\r\n\r\n      lastY = e.touches[0].clientY;\r\n\r\n      listenerSetter.add(elem)('touchmove', onTouchMove, options);\r\n      listenerSetter.add(elem)('touchend', onTouchEnd, options);\r\n    }, options);\r\n\r\n    const onTouchMove = (e: TouchEvent) => {\r\n      const clientY = e.touches[0].clientY;\r\n\r\n      const isDown = clientY < lastY;\r\n      if(side === 'bottom' && isDown) callback();\r\n      else if(side === 'top' && !isDown) callback();\r\n      lastY = clientY;\r\n      // alert('isDown: ' + !!isDown);\r\n    };\r\n\r\n    const onTouchEnd = () => {\r\n      listenerSetter.removeManual(elem, 'touchmove', onTouchMove, options);\r\n      listenerSetter.removeManual(elem, 'touchend', onTouchEnd, options);\r\n    };\r\n  } else {\r\n    listenerSetter.add(elem)('wheel', (e) => {\r\n      const isDown = e.deltaY > 0;\r\n      // this.log('wheel', e, isDown);\r\n      if(side === 'bottom' && isDown) callback();\r\n      else if(side === 'top' && !isDown) callback();\r\n    }, {passive: true});\r\n  }\r\n}\r\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport type {Channel} from '../../lib/appManagers/appChatsManager';\nimport type {AppSidebarRight} from '../sidebarRight';\nimport type Chat from './chat';\nimport {RIGHT_COLUMN_ACTIVE_CLASSNAME} from '../sidebarRight';\nimport mediaSizes, {ScreenSize} from '../../helpers/mediaSizes';\nimport {IS_SAFARI} from '../../environment/userAgent';\nimport rootScope from '../../lib/rootScope';\nimport AvatarElement from '../avatar';\nimport Button from '../button';\nimport ButtonIcon from '../buttonIcon';\nimport ButtonMenuToggle from '../buttonMenuToggle';\nimport ChatAudio from './audio';\nimport ChatPinnedMessage from './pinnedMessage';\nimport {ButtonMenuItemOptions} from '../buttonMenu';\nimport ListenerSetter from '../../helpers/listenerSetter';\nimport PopupDeleteDialog from '../popups/deleteDialog';\nimport appNavigationController from '../appNavigationController';\nimport {LEFT_COLUMN_ACTIVE_CLASSNAME} from '../sidebarLeft';\nimport PeerTitle from '../peerTitle';\nimport {i18n} from '../../lib/langPack';\nimport findUpClassName from '../../helpers/dom/findUpClassName';\nimport blurActiveElement from '../../helpers/dom/blurActiveElement';\nimport cancelEvent from '../../helpers/dom/cancelEvent';\nimport {attachClickEvent} from '../../helpers/dom/clickEvent';\nimport findUpTag from '../../helpers/dom/findUpTag';\nimport {toast, toastNew} from '../toast';\nimport replaceContent from '../../helpers/dom/replaceContent';\nimport {ChatFull, Chat as MTChat, GroupCall} from '../../layer';\nimport PopupPickUser from '../popups/pickUser';\nimport PopupPeer from '../popups/peer';\nimport AppEditContactTab from '../sidebarRight/tabs/editContact';\nimport appMediaPlaybackController from '../appMediaPlaybackController';\nimport IS_GROUP_CALL_SUPPORTED from '../../environment/groupCallSupport';\nimport IS_CALL_SUPPORTED from '../../environment/callSupport';\nimport {CallType} from '../../lib/calls/types';\nimport PopupMute from '../popups/mute';\nimport {AppManagers} from '../../lib/appManagers/managers';\nimport hasRights from '../../lib/appManagers/utils/chats/hasRights';\nimport wrapPeerTitle from '../wrappers/peerTitle';\nimport groupCallsController from '../../lib/calls/groupCallsController';\nimport apiManagerProxy from '../../lib/mtproto/mtprotoworker';\n\ntype ButtonToVerify = {element?: HTMLElement, verify: () => boolean | Promise<boolean>};\n\nexport default class ChatTopbar {\n  public container: HTMLDivElement;\n  private btnBack: HTMLButtonElement;\n  private chatInfo: HTMLDivElement;\n  private avatarElement: AvatarElement;\n  private title: HTMLDivElement;\n  private subtitle: HTMLDivElement;\n  private chatUtils: HTMLDivElement;\n  private btnJoin: HTMLButtonElement;\n  private btnPinned: HTMLButtonElement;\n  private btnCall: HTMLButtonElement;\n  private btnGroupCall: HTMLButtonElement;\n  private btnMute: HTMLButtonElement;\n  private btnSearch: HTMLButtonElement;\n  private btnMore: HTMLElement;\n\n  private chatAudio: ChatAudio;\n  public pinnedMessage: ChatPinnedMessage;\n\n  private setUtilsRAF: number;\n  private setPeerStatusInterval: number;\n\n  public listenerSetter: ListenerSetter;\n\n  private menuButtons: (ButtonMenuItemOptions & {verify: ButtonToVerify['verify']})[];\n  private buttonsToVerify: ButtonToVerify[];\n  private chatInfoContainer: HTMLDivElement;\n\n  constructor(\n    private chat: Chat,\n    private appSidebarRight: AppSidebarRight,\n    private managers: AppManagers\n  ) {\n    this.listenerSetter = new ListenerSetter();\n\n    this.menuButtons = [];\n    this.buttonsToVerify = [];\n  }\n\n  public construct() {\n    // this.chat.log.error('Topbar construction');\n\n    this.container = document.createElement('div');\n    this.container.classList.add('sidebar-header', 'topbar', 'hide');\n    this.container.dataset.floating = '0';\n\n    this.btnBack = ButtonIcon('left sidebar-close-button', {noRipple: true});\n\n    // * chat info section\n    this.chatInfoContainer = document.createElement('div');\n    this.chatInfoContainer.classList.add('chat-info-container');\n\n    this.chatInfo = document.createElement('div');\n    this.chatInfo.classList.add('chat-info');\n\n    const person = document.createElement('div');\n    person.classList.add('person');\n\n    const content = document.createElement('div');\n    content.classList.add('content');\n\n    const top = document.createElement('div');\n    top.classList.add('top');\n\n    this.title = document.createElement('div');\n    this.title.classList.add('user-title');\n\n    top.append(this.title);\n\n    const bottom = document.createElement('div');\n    bottom.classList.add('bottom');\n\n    if(this.subtitle) {\n      bottom.append(this.subtitle);\n    }\n\n    content.append(top, bottom);\n    if(this.avatarElement) {\n      person.append(this.avatarElement);\n    }\n\n    person.append(content);\n    this.chatInfo.append(person);\n\n    // * chat utils section\n    this.chatUtils = document.createElement('div');\n    this.chatUtils.classList.add('chat-utils');\n\n    this.chatAudio = new ChatAudio(this, this.chat, this.managers);\n\n    if(this.menuButtons.length) {\n      this.btnMore = ButtonMenuToggle({listenerSetter: this.listenerSetter}, 'bottom-left', this.menuButtons, this.verifyButtons);\n    }\n\n    this.chatUtils.append(...[\n      // this.chatAudio ? this.chatAudio.divAndCaption.container : null,\n      this.pinnedMessage ? this.pinnedMessage.pinnedMessageContainer.divAndCaption.container : null,\n      this.btnJoin,\n      this.btnPinned,\n      this.btnCall,\n      this.btnGroupCall,\n      this.btnMute,\n      this.btnSearch,\n      this.btnMore\n    ].filter(Boolean));\n\n    this.pushButtonToVerify(this.btnCall, this.verifyCallButton.bind(this, 'voice'));\n    this.pushButtonToVerify(this.btnGroupCall, this.verifyVideoChatButton);\n\n    this.chatInfoContainer.append(this.btnBack, this.chatInfo, this.chatUtils);\n    this.container.append(this.chatInfoContainer);\n\n    if(this.chatAudio) {\n      // this.container.append(this.chatAudio.divAndCaption.container, this.chatUtils);\n      this.container.append(this.chatAudio.divAndCaption.container);\n    }\n\n    // * construction end\n\n    // * fix topbar overflow section\n\n    this.listenerSetter.add(window)('resize', this.onResize);\n    this.listenerSetter.add(mediaSizes)('changeScreen', this.onChangeScreen);\n\n    attachClickEvent(this.container, (e) => {\n      const container = findUpClassName(e.target, 'pinned-container');\n      blurActiveElement();\n      if(container) {\n        cancelEvent(e);\n\n        if(findUpClassName(e.target, 'progress-line')) {\n          return;\n        }\n\n        const mid = +container.dataset.mid;\n        if(container.classList.contains('pinned-message')) {\n          // if(!this.pinnedMessage.locked) {\n          this.pinnedMessage.followPinnedMessage(mid);\n          // }\n        } else {\n          const peerId = container.dataset.peerId.toPeerId();\n          const searchContext = appMediaPlaybackController.getSearchContext();\n          this.chat.appImManager.setInnerPeer({\n            peerId,\n            lastMsgId: mid,\n            type: searchContext.isScheduled ? 'scheduled' : (searchContext.threadId ? 'discussion' : undefined),\n            threadId: searchContext.threadId\n          });\n        }\n      } else {\n        if(mediaSizes.activeScreen === ScreenSize.medium && document.body.classList.contains(LEFT_COLUMN_ACTIVE_CLASSNAME)) {\n          onBtnBackClick();\n        } else if(findUpTag(e.target, 'AVATAR-ELEMENT')) {\n          this.appSidebarRight.toggleSidebar(!document.body.classList.contains(RIGHT_COLUMN_ACTIVE_CLASSNAME));\n        } else {\n          this.appSidebarRight.toggleSidebar(true);\n        }\n      }\n    }, {listenerSetter: this.listenerSetter});\n\n    const onBtnBackClick = (e?: Event) => {\n      if(e) {\n        cancelEvent(e);\n      }\n\n      // const item = appNavigationController.findItemByType('chat');\n      // * return manually to chat by arrow, since can't get back to\n      if(mediaSizes.activeScreen === ScreenSize.medium && document.body.classList.contains(LEFT_COLUMN_ACTIVE_CLASSNAME)) {\n        this.chat.appImManager.setPeer({peerId: this.peerId});\n      } else {\n        const isFirstChat = this.chat.appImManager.chats.indexOf(this.chat) === 0;\n        appNavigationController.back(isFirstChat ? 'im' : 'chat');\n        /* return;\n\n        if(mediaSizes.activeScreen === ScreenSize.medium && !appNavigationController.findItemByType('chat')) {\n          this.chat.appImManager.setPeer(0);\n          blurActiveElement();\n        } else {\n          appNavigationController.back('chat');\n        } */\n      }\n    };\n\n    attachClickEvent(this.btnBack, onBtnBackClick, {listenerSetter: this.listenerSetter});\n  }\n\n  private pushButtonToVerify(element: HTMLElement, verify: ButtonToVerify['verify']) {\n    if(!element) {\n      return;\n    }\n\n    this.buttonsToVerify.push({element, verify});\n  }\n\n  private verifyButtons = (e?: Event) => {\n    const isMenuOpen = !!e || !!(this.btnMore && this.btnMore.classList.contains('menu-open'));\n\n    e && cancelEvent(e);\n\n    const r = async() => {\n      const deleteButtonText = await this.managers.appPeersManager.getDeleteButtonText(this.peerId);\n      if(isMenuOpen) {\n        // delete button\n        this.menuButtons[this.menuButtons.length - 1].element.lastChild.replaceWith(i18n(deleteButtonText));\n      }\n\n      const buttons = this.buttonsToVerify.concat(isMenuOpen ? this.menuButtons : []);\n      const results = await Promise.all(buttons.map(async(button) => {\n        return {\n          result: await button.verify(),\n          button\n        }\n      }));\n\n      results.forEach(({button, result}) => {\n        button.element.classList.toggle('hide', !result);\n      });\n    };\n\n    r();\n  };\n\n  private verifyVideoChatButton = async(type?: 'group' | 'broadcast') => {\n    if(!IS_GROUP_CALL_SUPPORTED || this.peerId.isUser()) return false;\n\n    const currentGroupCall = groupCallsController.groupCall;\n    const chatId = this.peerId.toChatId();\n    if(currentGroupCall?.chatId === chatId) {\n      return false;\n    }\n\n    if(type) {\n      if(((await this.managers.appPeersManager.isBroadcast(this.peerId)) && type === 'group') ||\n        ((await this.managers.appPeersManager.isAnyGroup(this.peerId)) && type === 'broadcast')) {\n        return false;\n      }\n    }\n\n    const chat = await this.managers.appChatsManager.getChatTyped(chatId);\n    return (chat as MTChat.chat).pFlags?.call_active || hasRights(chat, 'manage_call');\n  };\n\n  private verifyCallButton = async(type?: CallType) => {\n    if(!IS_CALL_SUPPORTED || !this.peerId.isUser()) return false;\n    const userId = this.peerId.toUserId();\n    const userFull = await this.managers.appProfileManager.getCachedFullUser(userId);\n\n    return !!userFull && !!(type === 'voice' ? userFull.pFlags.phone_calls_available : userFull.pFlags.video_calls_available);\n  };\n\n  public constructUtils() {\n    this.menuButtons = [{\n      icon: 'search',\n      text: 'Search',\n      onClick: () => {\n        this.chat.initSearch();\n      },\n      verify: () => mediaSizes.isMobile\n    }, /* {\n      icon: 'pinlist',\n      text: 'Pinned Messages',\n      onClick: () => this.openPinned(false),\n      verify: () => mediaSizes.isMobile\n    }, */{\n      icon: 'mute',\n      text: 'ChatList.Context.Mute',\n      onClick: this.onMuteClick,\n      verify: async() => this.chat.type === 'chat' && rootScope.myId !== this.peerId && !(await this.managers.appNotificationsManager.isPeerLocalMuted(this.peerId, false))\n    }, {\n      icon: 'unmute',\n      text: 'ChatList.Context.Unmute',\n      onClick: () => {\n        this.managers.appMessagesManager.togglePeerMute(this.peerId);\n      },\n      verify: async() => this.chat.type === 'chat' && rootScope.myId !== this.peerId && (await this.managers.appNotificationsManager.isPeerLocalMuted(this.peerId, false))\n    }, {\n      icon: 'comments',\n      text: 'ViewDiscussion',\n      onClick: () => {\n        const middleware = this.chat.bubbles.getMiddleware();\n        Promise.resolve(this.managers.appProfileManager.getChannelFull(this.peerId.toChatId())).then((channelFull) => {\n          if(middleware() && channelFull.linked_chat_id) {\n            this.chat.appImManager.setInnerPeer({\n              peerId: channelFull.linked_chat_id.toPeerId(true)\n            });\n          }\n        });\n      },\n      verify: async() => {\n        const chatFull = await this.managers.appProfileManager.getCachedFullChat(this.peerId.toChatId());\n        return this.chat.type === 'chat' && !!(chatFull as ChatFull.channelFull)?.linked_chat_id;\n      }\n    }, {\n      icon: 'phone',\n      text: 'Call',\n      onClick: this.onCallClick.bind(this, 'voice'),\n      verify: this.verifyCallButton.bind(this, 'voice')\n    }, {\n      icon: 'videocamera',\n      text: 'VideoCall',\n      onClick: this.onCallClick.bind(this, 'video'),\n      verify: this.verifyCallButton.bind(this, 'video')\n    }, {\n      icon: 'videochat',\n      text: 'PeerInfo.Action.LiveStream',\n      onClick: this.onJoinGroupCallClick,\n      verify: this.verifyVideoChatButton.bind(this, 'broadcast')\n    }, {\n      icon: 'videochat',\n      text: 'PeerInfo.Action.VoiceChat',\n      onClick: this.onJoinGroupCallClick,\n      verify: this.verifyVideoChatButton.bind(this, 'group')\n    }, {\n      icon: 'select',\n      text: 'Chat.Menu.SelectMessages',\n      onClick: () => {\n        const selection = this.chat.selection;\n        selection.toggleSelection(true, true);\n        apiManagerProxy.getState().then((state) => {\n          if(state.chatContextMenuHintWasShown) {\n            return;\n          }\n\n          const original = selection.toggleByElement.bind(selection);\n          selection.toggleByElement = async(bubble) => {\n            this.managers.appStateManager.pushToState('chatContextMenuHintWasShown', true);\n            toast(i18n('Chat.Menu.Hint'));\n\n            selection.toggleByElement = original;\n            selection.toggleByElement(bubble);\n          };\n        });\n      },\n      verify: () => !this.chat.selection.isSelecting && !!this.chat.bubbles.getRenderedLength()\n    }, {\n      icon: 'select',\n      text: 'Chat.Menu.ClearSelection',\n      onClick: () => {\n        this.chat.selection.cancelSelection();\n      },\n      verify: () => this.chat.selection.isSelecting\n    }, {\n      icon: 'adduser',\n      text: 'AddContact',\n      onClick: () => {\n        if(!this.appSidebarRight.isTabExists(AppEditContactTab)) {\n          const tab = this.appSidebarRight.createTab(AppEditContactTab);\n          tab.peerId = this.peerId;\n          tab.open();\n\n          this.appSidebarRight.toggleSidebar(true);\n        }\n      },\n      verify: async() => this.peerId.isUser() && !(await this.managers.appPeersManager.isContact(this.peerId))\n    }, {\n      icon: 'forward',\n      text: 'ShareContact',\n      onClick: () => {\n        const contactPeerId = this.peerId;\n        new PopupPickUser({\n          peerTypes: ['dialogs', 'contacts'],\n          onSelect: (peerId) => {\n            return new Promise((resolve, reject) => {\n              new PopupPeer('', {\n                titleLangKey: 'SendMessageTitle',\n                descriptionLangKey: 'SendContactToGroupText',\n                descriptionLangArgs: [new PeerTitle({peerId, dialog: true}).element],\n                buttons: [{\n                  langKey: 'Send',\n                  callback: () => {\n                    resolve();\n\n                    this.managers.appMessagesManager.sendContact(peerId, contactPeerId);\n                    this.chat.appImManager.setInnerPeer({peerId});\n                  }\n                }, {\n                  langKey: 'Cancel',\n                  callback: () => {\n                    reject();\n                  },\n                  isCancel: true\n                }],\n                peerId,\n                overlayClosable: true\n              }).show();\n            });\n          },\n          placeholder: 'ShareModal.Search.Placeholder',\n          chatRightsAction: 'send_messages',\n          selfPresence: 'ChatYourSelf'\n        });\n      },\n      verify: async() => rootScope.myId !== this.peerId && this.peerId.isUser() && (await this.managers.appPeersManager.isContact(this.peerId)) && !!(await this.managers.appUsersManager.getUser(this.peerId.toUserId())).phone\n    }, {\n      icon: 'lock',\n      text: 'BlockUser',\n      onClick: () => {\n        new PopupPeer('', {\n          peerId: this.peerId,\n          titleLangKey: 'BlockUser',\n          descriptionLangKey: 'AreYouSureBlockContact2',\n          descriptionLangArgs: [new PeerTitle({peerId: this.peerId}).element],\n          buttons: [{\n            langKey: 'BlockUser',\n            isDanger: true,\n            callback: () => {\n              this.managers.appUsersManager.toggleBlock(this.peerId, true).then((value) => {\n                if(value) {\n                  toastNew({langPackKey: 'UserBlocked'});\n                }\n              });\n            }\n          }]\n        }).show();\n      },\n      verify: async() => {\n        if(!this.peerId.isUser()) return false;\n        const userFull = await this.managers.appProfileManager.getCachedFullUser(this.peerId.toUserId());\n        return this.peerId !== rootScope.myId && userFull && !userFull.pFlags?.blocked;\n      }\n    }, {\n      icon: 'lockoff',\n      text: 'Unblock',\n      onClick: () => {\n        this.managers.appUsersManager.toggleBlock(this.peerId, false).then((value) => {\n          if(value) {\n            toastNew({langPackKey: 'UserUnblocked'});\n          }\n        });\n      },\n      verify: async() => {\n        const userFull = await this.managers.appProfileManager.getCachedFullUser(this.peerId.toUserId());\n        return !!userFull?.pFlags?.blocked;\n      }\n    }, {\n      icon: 'delete danger',\n      text: 'Delete',\n      onClick: () => {\n        new PopupDeleteDialog(this.peerId/* , 'leave' */);\n      },\n      verify: async() => this.chat.type === 'chat' && !!(await this.managers.appMessagesManager.getDialogOnly(this.peerId))\n    }];\n\n    this.btnSearch = ButtonIcon('search');\n    this.attachClickEvent(this.btnSearch, (e) => {\n      this.chat.initSearch();\n    }, true);\n  }\n\n  public attachClickEvent(el: HTMLElement, cb: (e: MouseEvent) => void, noBlur?: boolean) {\n    attachClickEvent(el, (e) => {\n      cancelEvent(e);\n      !noBlur && blurActiveElement();\n      cb(e);\n    }, {listenerSetter: this.listenerSetter});\n  }\n\n  private onCallClick(type: CallType) {\n    this.chat.appImManager.callUser(this.peerId.toUserId(), type);\n  }\n\n  private onJoinGroupCallClick = () => {\n    this.chat.appImManager.joinGroupCall(this.peerId);\n  };\n\n  private constructAvatar() {\n    const avatarElement = new AvatarElement();\n    avatarElement.isDialog = true;\n    avatarElement.classList.add('avatar-42', 'person-avatar');\n    return avatarElement;\n  }\n\n  private get peerId() {\n    return this.chat.peerId;\n  }\n\n  public constructPeerHelpers() {\n    this.avatarElement = this.constructAvatar();\n\n    this.subtitle = document.createElement('div');\n    this.subtitle.classList.add('info');\n\n    this.pinnedMessage = new ChatPinnedMessage(this, this.chat, this.managers);\n\n    this.btnJoin = Button('btn-primary btn-color-primary chat-join hide');\n    this.btnCall = ButtonIcon('phone');\n    this.btnGroupCall = ButtonIcon('videochat');\n    this.btnPinned = ButtonIcon('pinlist');\n    this.btnMute = ButtonIcon('mute');\n\n    this.attachClickEvent(this.btnCall, this.onCallClick.bind(this, 'voice'));\n    this.attachClickEvent(this.btnGroupCall, this.onJoinGroupCallClick);\n\n    this.attachClickEvent(this.btnPinned, () => {\n      this.openPinned(true);\n    });\n\n    this.attachClickEvent(this.btnMute, this.onMuteClick);\n\n    this.attachClickEvent(this.btnJoin, async() => {\n      const middleware = this.chat.bubbles.getMiddleware();\n      this.btnJoin.setAttribute('disabled', 'true');\n\n      const chatId = this.peerId.toChatId();\n      let promise: Promise<any>;\n      if(await this.managers.appChatsManager.isChannel(chatId)) {\n        promise = this.managers.appChatsManager.joinChannel(chatId);\n      } else {\n        promise = this.managers.appChatsManager.addChatUser(chatId, rootScope.myId);\n      }\n\n      promise.finally(() => {\n        if(!middleware()) {\n          return;\n        }\n\n        this.btnJoin.removeAttribute('disabled');\n      });\n    });\n\n    this.listenerSetter.add(rootScope)('chat_update', async(chatId) => {\n      if(this.peerId === chatId.toPeerId(true)) {\n        const chat = await this.managers.appChatsManager.getChat(chatId) as Channel/*  | Chat */;\n\n        this.btnJoin.classList.toggle('hide', !(chat as Channel)?.pFlags?.left);\n        this.setUtilsWidth();\n        this.verifyButtons();\n      }\n    });\n\n    this.listenerSetter.add(rootScope)('dialog_notify_settings', (dialog) => {\n      if(dialog.peerId === this.peerId) {\n        this.setMutedState();\n      }\n    });\n\n    this.listenerSetter.add(rootScope)('peer_typings', ({peerId}) => {\n      if(this.peerId === peerId) {\n        this.setPeerStatus();\n      }\n    });\n\n    this.listenerSetter.add(rootScope)('user_update', (userId) => {\n      if(this.peerId === userId.toPeerId()) {\n        this.setPeerStatus();\n      }\n    });\n\n    this.listenerSetter.add(rootScope)('peer_full_update', (peerId) => {\n      if(this.peerId === peerId) {\n        this.verifyButtons();\n      }\n    });\n\n    if(this.pinnedMessage) {\n      this.chat.addEventListener('setPeer', (mid, isTopMessage) => {\n        const middleware = this.chat.bubbles.getMiddleware();\n        apiManagerProxy.getState().then((state) => {\n          if(!middleware()) return;\n\n          this.pinnedMessage.hidden = !!state.hiddenPinnedMessages[this.chat.peerId];\n\n          if(isTopMessage) {\n            this.pinnedMessage.unsetScrollDownListener();\n            this.pinnedMessage.testMid(mid, 0); // * because slider will not let get bubble by document.elementFromPoint\n          } else if(!this.pinnedMessage.locked) {\n            this.pinnedMessage.handleFollowingPinnedMessage();\n            this.pinnedMessage.testMid(mid);\n          }\n        });\n      });\n    }\n\n    this.setPeerStatusInterval = window.setInterval(this.setPeerStatus, 60e3);\n\n    return this;\n  }\n\n  public constructPinnedHelpers() {\n    this.listenerSetter.add(rootScope)('peer_pinned_messages', ({peerId, mids}) => {\n      if(peerId !== this.peerId) return;\n\n      if(mids) {\n        this.setTitle();\n      }\n    });\n  }\n\n  public constructDiscussionHelpers() {\n    this.pinnedMessage = new ChatPinnedMessage(this, this.chat, this.managers);\n  }\n\n  public openPinned(byCurrent: boolean) {\n    this.chat.appImManager.setInnerPeer({\n      peerId: this.peerId,\n      lastMsgId: byCurrent ? +this.pinnedMessage.pinnedMessageContainer.divAndCaption.container.dataset.mid : 0,\n      type: 'pinned'\n    });\n  }\n\n  private onMuteClick = () => {\n    new PopupMute(this.peerId);\n  };\n\n  private onResize = () => {\n    this.setUtilsWidth(true);\n    this.setFloating();\n  };\n\n  private onChangeScreen = (from: ScreenSize, to: ScreenSize) => {\n    this.container.classList.toggle('is-pinned-floating', mediaSizes.isMobile);\n    // this.chatAudio && this.chatAudio.divAndCaption.container.classList.toggle('is-floating', to === ScreenSize.mobile);\n    this.pinnedMessage && this.pinnedMessage.pinnedMessageContainer.divAndCaption.container.classList.toggle('is-floating', to === ScreenSize.mobile);\n    this.onResize();\n  };\n\n  public destroy() {\n    // this.chat.log.error('Topbar destroying');\n    this.listenerSetter.removeAll();\n    window.clearInterval(this.setPeerStatusInterval);\n\n    if(this.pinnedMessage) {\n      this.pinnedMessage.destroy(); // *     \n    }\n\n    if(this.chatAudio) {\n      this.chatAudio.destroy();\n    }\n\n    delete this.chatAudio;\n    delete this.pinnedMessage;\n  }\n\n  public cleanup() {\n    if(!this.chat.peerId) {\n      this.container.classList.add('hide');\n    }\n  }\n\n  public async finishPeerChange(isTarget: boolean) {\n    const peerId = this.peerId;\n\n    let newAvatar: AvatarElement;\n    if(this.avatarElement) {\n      newAvatar = this.constructAvatar();\n    }\n\n    const [isBroadcast, isAnyChat, chat, _, setTitleCallback, setStatusCallback, state] = await Promise.all([\n      this.managers.appPeersManager.isBroadcast(peerId),\n      this.managers.appPeersManager.isAnyChat(peerId),\n      peerId.isAnyChat() ? this.managers.appChatsManager.getChat(peerId.toChatId()) : undefined,\n      newAvatar ? newAvatar.updateWithOptions({peerId}) : undefined,\n      this.setTitleManual(),\n      this.setPeerStatusManual(true),\n      apiManagerProxy.getState()\n    ]);\n\n    return () => {\n      this.btnMute && this.btnMute.classList.toggle('hide', !isBroadcast);\n      if(this.btnJoin) {\n        if(isAnyChat && !this.chat.isRestricted) {\n          replaceContent(this.btnJoin, i18n(isBroadcast ? 'Chat.Subscribe' : 'ChannelJoin'));\n          this.btnJoin.classList.toggle('hide', !chat?.pFlags?.left);\n        } else {\n          this.btnJoin.classList.add('hide');\n        }\n      }\n\n      if(newAvatar) {\n        this.avatarElement.replaceWith(newAvatar);\n        this.avatarElement = newAvatar;\n      }\n\n      this.setUtilsWidth();\n\n      this.verifyButtons();\n\n      if(this.pinnedMessage) { // * replace with new one\n        if(this.chat.type === 'chat') {\n          if(this.chat.wasAlreadyUsed) { // * change\n            const newPinnedMessage = new ChatPinnedMessage(this, this.chat, this.managers);\n            this.pinnedMessage.pinnedMessageContainer.divAndCaption.container.replaceWith(newPinnedMessage.pinnedMessageContainer.divAndCaption.container);\n            this.pinnedMessage.destroy();\n            // this.pinnedMessage.pinnedMessageContainer.toggle(true);\n            this.pinnedMessage = newPinnedMessage;\n          }\n\n          this.pinnedMessage.hidden = !!state.hiddenPinnedMessages[peerId];\n        } else if(this.chat.type === 'discussion') {\n          this.pinnedMessage.pinnedMid = this.chat.threadId;\n          this.pinnedMessage.count = 1;\n          this.pinnedMessage.pinnedIndex = 0;\n          this.pinnedMessage._setPinnedMessage();\n        }\n      }\n\n      setTitleCallback();\n      setStatusCallback && setStatusCallback();\n      this.setMutedState();\n\n      this.container.classList.remove('hide');\n    };\n  }\n\n  public async setTitleManual(count?: number) {\n    const peerId = this.peerId;\n    const middleware = () => this.peerId === peerId;\n    let titleEl: HTMLElement, icons: Element[];\n    if(this.chat.type === 'pinned') {\n      if(count === undefined) titleEl = i18n('Loading');\n      else titleEl = i18n('PinnedMessagesCount', [count]);\n\n      if(count === undefined) {\n        this.managers.appMessagesManager.getSearchCounters(peerId, [{_: 'inputMessagesFilterPinned'}], false).then((result) => {\n          if(!middleware()) return;\n          const count = result[0].count;\n          this.setTitle(count);\n\n          // !  2,      \n          if(!count) {\n            this.chat.appImManager.setPeer(); // * close tab\n\n            // ! ,     ,  ,      \n            const originalChat = this.chat.appImManager.chat;\n            if(originalChat.topbar.pinnedMessage) {\n              originalChat.topbar.pinnedMessage.pinnedMessageContainer.toggle(true);\n            }\n          }\n        });\n      }\n    } else if(this.chat.type === 'scheduled') {\n      titleEl = i18n(peerId === rootScope.myId ? 'Reminders' : 'ScheduledMessages');\n    } else if(this.chat.type === 'discussion') {\n      if(count === undefined) {\n        const result = await this.managers.acknowledged.appMessagesManager.getHistory(peerId, 0, 1, 0, this.chat.threadId);\n        if(!middleware()) return;\n        if(result.cached) {\n          const historyResult = await result.result;\n          if(!middleware()) return;\n          count = historyResult.count;\n        } else result.result.then((historyResult) => {\n          if(!middleware()) return;\n          this.setTitle(historyResult.count);\n        });\n      }\n\n      if(count === undefined) titleEl = i18n('Loading');\n      else titleEl = i18n('Chat.Title.Comments', [count]);\n    } else if(this.chat.type === 'chat') {\n      [titleEl/* , icons */] = await Promise.all([\n        wrapPeerTitle({\n          peerId,\n          dialog: true,\n          withIcons: true\n        })\n        // generateTitleIcons(peerId)\n      ]);\n\n      if(!middleware()) {\n        return;\n      }\n    }\n\n    return () => {\n      replaceContent(this.title, titleEl);\n      // if(icons) {\n      //   this.title.append(...icons);\n      // }\n    };\n  }\n\n  public setTitle(count?: number) {\n    this.setTitleManual(count).then((setTitleCallback) => setTitleCallback());\n  }\n\n  public async setMutedState() {\n    if(!this.btnMute) return;\n\n    const peerId = this.peerId;\n    const muted = await this.managers.appNotificationsManager.isPeerLocalMuted(peerId, false);\n    if(await this.managers.appPeersManager.isBroadcast(peerId)) { // not human\n      this.btnMute.classList.remove('tgico-mute', 'tgico-unmute');\n      this.btnMute.classList.add(muted ? 'tgico-unmute' : 'tgico-mute');\n      this.btnMute.style.display = '';\n    } else {\n      this.btnMute.style.display = 'none';\n    }\n  }\n\n  // !    ,    -    ,          ,    !\n  public setUtilsWidth = (resize = false) => {\n    // return;\n    if(this.setUtilsRAF) window.cancelAnimationFrame(this.setUtilsRAF);\n\n    if(IS_SAFARI && resize) {\n      this.chatUtils.classList.add('hide');\n    }\n\n    // mutationObserver.disconnect();\n    this.setUtilsRAF = window.requestAnimationFrame(() => {\n      // mutationRAF = window.requestAnimationFrame(() => {\n\n      // setTimeout(() => {\n      if(IS_SAFARI && resize) {\n        this.chatUtils.classList.remove('hide');\n      }\n      /* this.chatInfo.style.removeProperty('--utils-width');\n          void this.chatInfo.offsetLeft; // reflow */\n      const width = /* chatUtils.scrollWidth */this.chatUtils.getBoundingClientRect().width;\n      this.chat.log('utils width:', width);\n      this.container.style.setProperty('--utils-width', width + 'px');\n      // this.chatInfo.classList.toggle('have-utils-width', !!width);\n      // }, 0);\n\n      this.setUtilsRAF = 0;\n\n      // mutationObserver.observe(chatUtils, observeOptions);\n      // });\n    });\n  };\n\n  public setFloating = () => {\n    const containers = [this.chatAudio, this.pinnedMessage && this.pinnedMessage.pinnedMessageContainer].filter(Boolean);\n    const count = containers.reduce((acc, container) => {\n      const isFloating = container.isFloating();\n      this.container.classList.toggle(`is-pinned-${container.className}-floating`, isFloating);\n\n      if(!container.isVisible()) {\n        return acc;\n      }\n\n      return acc + +isFloating;\n    }, 0);\n    this.container.dataset.floating = '' + count;\n  };\n\n  public setPeerStatusManual = async(needClear = false) => {\n    if(!this.subtitle) return;\n\n    const peerId = this.peerId;\n    return this.chat.appImManager.setPeerStatus(\n      peerId,\n      this.subtitle,\n      needClear,\n      false,\n      () => peerId === this.peerId\n    );\n  };\n\n  public setPeerStatus = (needClear?: boolean) => {\n    return this.setPeerStatusManual(needClear).then((callback) => {\n      if(callback) {\n        callback();\n      }\n    });\n  };\n}\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport appSidebarRight from '..';\r\nimport {attachClickEvent} from '../../../helpers/dom/clickEvent';\r\nimport AppSearch, {SearchGroup} from '../../appSearch';\r\nimport ButtonIcon from '../../buttonIcon';\r\nimport InputSearch from '../../inputSearch';\r\nimport PopupElement from '../../popups';\r\nimport PopupDatePicker from '../../popups/datePicker';\r\nimport {SliderSuperTab} from '../../slider';\r\n\r\nexport default class AppPrivateSearchTab extends SliderSuperTab {\r\n  private inputSearch: InputSearch;\r\n  private appSearch: AppSearch;\r\n  private btnPickDate: HTMLElement;\r\n\r\n  private peerId: PeerId;\r\n  private threadId = 0;\r\n  private query = '';\r\n  private onDatePick: (timestamp: number) => void;\r\n\r\n  onOpenAfterTimeout() {\r\n    this.appSearch.beginSearch(this.peerId, this.threadId, this.query);\r\n  }\r\n\r\n  protected init() {\r\n    this.container.id = 'search-private-container';\r\n    this.container.classList.add('chatlist-container');\r\n    this.inputSearch = new InputSearch('Search');\r\n    this.title.replaceWith(this.inputSearch.container);\r\n\r\n    this.btnPickDate = ButtonIcon('calendar sidebar-header-right');\r\n    this.header.append(this.btnPickDate);\r\n\r\n    const c = document.createElement('div');\r\n    c.classList.add('chatlist-container');\r\n    this.scrollable.container.replaceWith(c);\r\n    this.appSearch = new AppSearch(c, this.inputSearch, {\r\n      messages: new SearchGroup('Chat.Search.PrivateSearch', 'messages')\r\n    });\r\n  }\r\n\r\n  open(peerId: PeerId, threadId?: number, onDatePick?: AppPrivateSearchTab['onDatePick'], query?: string) {\r\n    const ret = super.open();\r\n\r\n    if(!this.peerId) {\r\n      this.query = query;\r\n      this.peerId = peerId;\r\n      this.threadId = threadId;\r\n      this.onDatePick = onDatePick;\r\n\r\n      this.btnPickDate.classList.toggle('hide', !this.onDatePick);\r\n      if(this.onDatePick) {\r\n        attachClickEvent(this.btnPickDate, () => {\r\n          PopupElement.createPopup(PopupDatePicker, new Date(), this.onDatePick).show();\r\n        });\r\n      }\r\n\r\n      query && this.appSearch.searchInput.inputField.setValueSilently(query);\r\n\r\n      appSidebarRight.toggleSidebar(true);\r\n    } else {\r\n      this.appSearch.beginSearch(this.peerId, this.threadId, query);\r\n    }\r\n\r\n    return ret;\r\n  }\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport type ChatTopbar from './topbar';\r\nimport AppSearch, {SearchGroup} from '../appSearch';\r\nimport PopupDatePicker from '../popups/datePicker';\r\nimport ripple from '../ripple';\r\nimport InputSearch from '../inputSearch';\r\nimport type Chat from './chat';\r\nimport findUpTag from '../../helpers/dom/findUpTag';\r\nimport cancelEvent from '../../helpers/dom/cancelEvent';\r\nimport whichChild from '../../helpers/dom/whichChild';\r\nimport replaceContent from '../../helpers/dom/replaceContent';\r\nimport {i18n} from '../../lib/langPack';\r\nimport ListenerSetter from '../../helpers/listenerSetter';\r\nimport {attachClickEvent} from '../../helpers/dom/clickEvent';\r\nimport appNavigationController, {NavigationItem} from '../appNavigationController';\r\nimport {IS_MOBILE_SAFARI} from '../../environment/userAgent';\r\nimport PopupElement from '../popups';\r\nimport {DIALOG_LIST_ELEMENT_TAG} from '../../lib/appManagers/appDialogsManager';\r\n\r\nexport default class ChatSearch {\r\n  private element: HTMLElement;\r\n  private backBtn: HTMLElement;\r\n  private inputSearch: InputSearch;\r\n\r\n  private results: HTMLElement;\r\n\r\n  private footer: HTMLElement;\r\n  private dateBtn: HTMLElement;\r\n  private foundCountEl: HTMLElement;\r\n  private controls: HTMLElement;\r\n  private downBtn: HTMLElement;\r\n  private upBtn: HTMLElement;\r\n\r\n  private appSearch: AppSearch;\r\n  private searchGroup: SearchGroup;\r\n\r\n  private foundCount = 0;\r\n  private selectedIndex = 0;\r\n  private setPeerPromise: Promise<any>;\r\n  private listenerSetter: ListenerSetter;\r\n  private navigationItem: NavigationItem;\r\n\r\n  constructor(private topbar: ChatTopbar, private chat: Chat, query?: string) {\r\n    this.element = document.createElement('div');\r\n    this.element.classList.add('sidebar-header', 'chat-search', 'chatlist-container');\r\n\r\n    this.backBtn = document.createElement('button');\r\n    this.backBtn.classList.add('btn-icon', 'tgico-left', 'sidebar-close-button');\r\n    ripple(this.backBtn);\r\n\r\n    const listenerSetter = this.listenerSetter = new ListenerSetter();\r\n\r\n    const attachClick = (element: HTMLElement, callback: (e: MouseEvent) => void) => {\r\n      attachClickEvent(element, callback, {listenerSetter});\r\n    };\r\n\r\n    attachClick(this.backBtn, () => {\r\n      this.destroy();\r\n    });\r\n\r\n    this.inputSearch = new InputSearch('Search');\r\n\r\n    // Results\r\n    this.results = document.createElement('div');\r\n    this.results.classList.add('chat-search-results', 'chatlist-container');\r\n\r\n    this.searchGroup = new SearchGroup(false, 'messages', undefined, '', false);\r\n    attachClick(this.searchGroup.list, this.onResultsClick);\r\n\r\n    this.appSearch = new AppSearch(this.results, this.inputSearch, {\r\n      messages: this.searchGroup\r\n    }, (count) => {\r\n      this.foundCount = count;\r\n\r\n      if(!this.foundCount) {\r\n        replaceContent(this.foundCountEl, this.inputSearch.value ? i18n('NoResult') : '');\r\n        this.results.classList.remove('active');\r\n        this.chat.bubbles.container.classList.remove('search-results-active');\r\n        this.upBtn.setAttribute('disabled', 'true');\r\n        this.downBtn.setAttribute('disabled', 'true');\r\n      } else {\r\n        this.selectResult(this.searchGroup.list.children[0] as HTMLElement);\r\n      }\r\n    });\r\n    this.appSearch.beginSearch(this.chat.peerId, this.chat.threadId);\r\n\r\n    // appImManager.topbar.parentElement.insertBefore(this.results, appImManager.bubblesContainer);\r\n    this.chat.bubbles.container.append(this.results);\r\n\r\n    // Footer\r\n    this.footer = document.createElement('div');\r\n    this.footer.classList.add('chat-search-footer');\r\n\r\n    attachClick(this.footer, this.onFooterClick);\r\n    ripple(this.footer);\r\n\r\n    this.foundCountEl = document.createElement('span');\r\n    this.foundCountEl.classList.add('chat-search-count');\r\n\r\n    this.dateBtn = document.createElement('button');\r\n    this.dateBtn.classList.add('btn-icon', 'tgico-calendar');\r\n\r\n    this.controls = document.createElement('div');\r\n    this.controls.classList.add('chat-search-controls');\r\n\r\n    this.upBtn = document.createElement('button');\r\n    this.upBtn.classList.add('btn-icon', 'tgico-up');\r\n    this.downBtn = document.createElement('button');\r\n    this.downBtn.classList.add('btn-icon', 'tgico-down');\r\n\r\n    this.upBtn.setAttribute('disabled', 'true');\r\n    this.downBtn.setAttribute('disabled', 'true');\r\n\r\n    attachClick(this.dateBtn, this.onDateClick);\r\n    attachClick(this.upBtn, this.onUpClick);\r\n    attachClick(this.downBtn, this.onDownClick);\r\n    this.controls.append(this.upBtn, this.downBtn);\r\n\r\n    this.footer.append(this.foundCountEl, this.dateBtn, this.controls);\r\n\r\n    this.topbar.container.parentElement.insertBefore(this.footer, chat.input.chatInput);\r\n\r\n    // Append container\r\n    this.element.append(this.backBtn, this.inputSearch.container);\r\n\r\n    this.topbar.container.classList.add('hide-pinned');\r\n    this.topbar.container.parentElement.append(this.element);\r\n\r\n    this.inputSearch.input.focus();\r\n\r\n    if(query) {\r\n      this.setQuery(query);\r\n    }\r\n\r\n    if(!IS_MOBILE_SAFARI) {\r\n      this.navigationItem = {\r\n        type: 'mobile-search',\r\n        onPop: () => {\r\n          this.destroy();\r\n        }\r\n      };\r\n\r\n      appNavigationController.pushItem(this.navigationItem);\r\n    }\r\n  }\r\n\r\n  public destroy() {\r\n    this.topbar.container.classList.remove('hide-pinned');\r\n    this.element.remove();\r\n    this.inputSearch.remove();\r\n    this.results.remove();\r\n    this.footer.remove();\r\n    this.listenerSetter.removeAll();\r\n    this.chat.bubbles.container.classList.remove('search-results-active');\r\n    this.chat.search = undefined;\r\n    appNavigationController.removeItem(this.navigationItem);\r\n  }\r\n\r\n  public setQuery(query: string) {\r\n    this.inputSearch.inputField.value = query;\r\n  }\r\n\r\n  private onDateClick = (e: MouseEvent) => {\r\n    cancelEvent(e);\r\n    PopupElement.createPopup(PopupDatePicker, new Date(), this.chat.bubbles.onDatePick).show();\r\n  };\r\n\r\n  private selectResult(elem: HTMLElement) {\r\n    if(this.setPeerPromise) return this.setPeerPromise;\r\n\r\n    const peerId = elem.dataset.peerId.toPeerId();\r\n    const lastMsgId = +elem.dataset.mid || undefined;\r\n\r\n    const index = whichChild(elem);\r\n\r\n    if(index === (this.foundCount - 1)) {\r\n      this.upBtn.setAttribute('disabled', 'true');\r\n    } else {\r\n      this.upBtn.removeAttribute('disabled');\r\n    }\r\n\r\n    if(!index) {\r\n      this.downBtn.setAttribute('disabled', 'true');\r\n    } else {\r\n      this.downBtn.removeAttribute('disabled');\r\n    }\r\n\r\n    this.results.classList.remove('active');\r\n    this.chat.bubbles.container.classList.remove('search-results-active');\r\n\r\n    const res = this.chat.setPeer(peerId, lastMsgId);\r\n    this.setPeerPromise = ((res instanceof Promise ? res : Promise.resolve(res)) as Promise<any>).then(() => {\r\n      this.selectedIndex = index;\r\n      replaceContent(this.foundCountEl, i18n('Of', [index + 1, this.foundCount]));\r\n\r\n      const renderedCount = this.searchGroup.list.childElementCount;\r\n      if(this.selectedIndex >= (renderedCount - 6)) {\r\n        this.appSearch.searchMore();\r\n      }\r\n    }).finally(() => {\r\n      this.setPeerPromise = null;\r\n    });\r\n  }\r\n\r\n  private onResultsClick = (e: MouseEvent) => {\r\n    const target = findUpTag(e.target, DIALOG_LIST_ELEMENT_TAG);\r\n    if(target) {\r\n      this.selectResult(target);\r\n    }\r\n  };\r\n\r\n  private onFooterClick = (e: MouseEvent) => {\r\n    if(this.foundCount) {\r\n      this.chat.bubbles.container.classList.toggle('search-results-active');\r\n      this.results.classList.toggle('active');\r\n    }\r\n  };\r\n\r\n  private onUpClick = (e: MouseEvent) => {\r\n    cancelEvent(e);\r\n    this.selectResult(this.searchGroup.list.children[this.selectedIndex + 1] as HTMLElement);\r\n  };\r\n\r\n  private onDownClick = (e: MouseEvent) => {\r\n    cancelEvent(e);\r\n    this.selectResult(this.searchGroup.list.children[this.selectedIndex - 1] as HTMLElement);\r\n  };\r\n}\r\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport indexOfAndSplice from '../../helpers/array/indexOfAndSplice';\nimport deepEqual from '../../helpers/object/deepEqual';\nimport {renderImageFromUrlPromise} from '../../helpers/dom/renderImageFromUrl';\nimport mediaSizes, {ScreenSize} from '../../helpers/mediaSizes';\n\ntype ChatBackgroundPatternRendererInitOptions = {\n  url: string,\n  width: number,\n  height: number,\n  mask?: boolean\n};\n\nexport default class ChatBackgroundPatternRenderer {\n  private static INSTANCES: ChatBackgroundPatternRenderer[] = [];\n\n  // private pattern: CanvasPattern;\n  private objectUrl: string;\n  private options: ChatBackgroundPatternRendererInitOptions;\n  private canvases: Set<HTMLCanvasElement>;\n  // private createCanvasPatternPromise: Promise<CanvasPattern>;\n  // private exportCanvasPatternToImagePromise: Promise<string>;\n  private renderImageFromUrlPromise: Promise<HTMLImageElement>;\n  private img: HTMLImageElement;\n\n  constructor() {\n    this.canvases = new Set();\n  }\n\n  public static getInstance(options: ChatBackgroundPatternRendererInitOptions) {\n    let instance = this.INSTANCES.find((instance) => {\n      return deepEqual(instance.options, options);\n    });\n\n    if(!instance) {\n      instance = new ChatBackgroundPatternRenderer();\n      instance.init(options);\n      this.INSTANCES.push(instance);\n    }\n\n    return instance;\n  }\n\n  public init(options: ChatBackgroundPatternRendererInitOptions) {\n    // if(this.options) {\n    //   if(this.options.width !== options.width || this.options.height !== options.height) {\n    //     this.createCanvasPatternPromise =\n    //       this.pattern =\n    //       this.exportCanvasPatternToImagePromise =\n    //       undefined;\n    //   }\n    // }\n\n    this.options = options;\n  }\n\n  public renderToCanvas(canvas: HTMLCanvasElement) {\n    // return this.createCanvasPattern(canvas).then(() => {\n    // return this.fillCanvas(canvas);\n    // });\n\n    return this.renderImageFromUrl(this.options.url).then(() => {\n      return this.fillCanvas(canvas);\n    });\n  }\n\n  private renderImageFromUrl(url: string) {\n    if(this.renderImageFromUrlPromise) return this.renderImageFromUrlPromise;\n    const img = this.img = document.createElement('img');\n    img.crossOrigin = 'anonymous';\n    return this.renderImageFromUrlPromise = renderImageFromUrlPromise(img, url, false).then(() => img);\n  }\n\n  /* private createCanvasPattern(canvas: HTMLCanvasElement) {\n    if(this.createCanvasPatternPromise) return this.createCanvasPatternPromise;\n    return this.createCanvasPatternPromise = this.renderImageFromUrl(this.options.url).then((img) => {\n      let createPatternFrom: HTMLImageElement | HTMLCanvasElement;\n      if(IS_SAFARI) {\n        const canvas = createPatternFrom = document.createElement('canvas');\n        canvas.width = img.naturalWidth;\n        canvas.height = img.naturalHeight;\n        const ctx = canvas.getContext('2d');\n        ctx.drawImage(img, 0, 0, canvas.width, canvas.height);\n      } else {\n        createPatternFrom = img;\n      }\n\n      const perf = performance.now();\n      this.pattern = canvas.getContext('2d').createPattern(createPatternFrom, 'repeat-x');\n      console.warn('creating pattern time:', performance.now() - perf);\n\n      return this.pattern;\n    });\n  }\n\n  public exportCanvasPatternToImage(canvas: HTMLCanvasElement) {\n    if(this.exportCanvasPatternToImagePromise) return this.exportCanvasPatternToImagePromise;\n    return this.exportCanvasPatternToImagePromise = new Promise<string>((resolve) => {\n      canvas.toBlob((blob) => {\n        const newUrl = this.objectUrl = URL.createObjectURL(blob);\n        resolve(newUrl);\n      }, 'image/png');\n    });\n  } */\n\n  public cleanup(canvas: HTMLCanvasElement) {\n    this.canvases.delete(canvas);\n\n    if(!this.canvases.size) {\n      indexOfAndSplice(ChatBackgroundPatternRenderer.INSTANCES, this);\n\n      if(this.objectUrl) {\n        URL.revokeObjectURL(this.objectUrl);\n      }\n    }\n  }\n\n  public fillCanvas(canvas: HTMLCanvasElement) {\n    const context = canvas.getContext('2d');\n    const {width, height} = canvas;\n    // const perf = performance.now();\n    // if(context.fillStyle instanceof CanvasPattern) {\n    //   context.clearRect(0, 0, width, height);\n    // }\n\n    const img = this.img;\n\n    let imageWidth = img.width, imageHeight = img.height;\n    // if(imageHeight < height) {\n    let patternHeight = 1480 * canvas.dpr;\n    // * correct\n    // if(+canvas.dataset.originalHeight !== height) hhh *= 2 / 3;\n    // * but have to make it good\n    if(+canvas.dataset.originalHeight !== height) patternHeight *= .875;\n    const ratio = patternHeight / imageHeight;\n    imageWidth *= ratio;\n    imageHeight = patternHeight;\n    // }\n\n    if(this.options.mask) {\n      context.fillStyle = '#000';\n      context.fillRect(0, 0, width, height);\n      context.globalCompositeOperation = 'destination-out';\n    } else {\n      context.globalCompositeOperation = 'source-over';\n    }\n\n    const d = (y: number) => {\n      for(let x = 0; x < width; x += imageWidth) {\n        context.drawImage(img, x, y, imageWidth, imageHeight);\n      }\n    };\n\n    const centerY = height / 2 - imageHeight / 2;\n    d(centerY);\n\n    if(centerY > 0) {\n      let topY = centerY;\n      do {\n        d(topY -= imageHeight);\n      } while(topY >= 0);\n    }\n\n    const endY = height - 1;\n    for(let bottomY = centerY + imageHeight; bottomY < endY; bottomY += imageHeight) {\n      d(bottomY);\n    }\n\n    // for(let x = 0; x < width; x += imageWidth) {\n    //   for(let y = 0; y < height; y += imageHeight) {\n    //     context.drawImage(img, x, y, imageWidth, imageHeight);\n    //   }\n    // }\n    // context.fillStyle = this.pattern;\n    // context.fillRect(0, 0, width, height);\n    // console.warn('fill canvas time', performance.now() - perf);\n  }\n\n  public setCanvasDimensions(canvas: HTMLCanvasElement) {\n    const devicePixelRatio = Math.min(2, window.devicePixelRatio);\n    const width = this.options.width * devicePixelRatio;\n    let height = this.options.height * devicePixelRatio;\n\n    canvas.dpr = devicePixelRatio;\n    canvas.dataset.originalHeight = '' + height;\n    if(mediaSizes.activeScreen === ScreenSize.large) height *= 1.5;\n    canvas.width = width;\n    canvas.height = height;\n  }\n\n  public createCanvas() {\n    const canvas = document.createElement('canvas');\n    this.canvases.add(canvas);\n    this.setCanvasDimensions(canvas);\n    return canvas;\n  }\n\n  public resize(width: number, height: number) {\n    this.init({\n      ...this.options,\n      width,\n      height\n    });\n\n    const promises: Promise<any>[] = [];\n    for(const canvas of this.canvases) {\n      this.setCanvasDimensions(canvas);\n      promises.push(this.renderToCanvas(canvas));\n    }\n\n    return Promise.all(promises);\n  }\n\n  public static resizeInstances(width: number, height: number) {\n    return Promise.all(this.INSTANCES.map((instance) => instance.resize(width, height)));\n  }\n\n  /* public setResizeMode(resizing: boolean) {\n    const canvases = Array.from(this.canvases);\n    const canvas = canvases[canvases.length - 1];\n    canvas.style.display = resizing ? 'none' : '';\n    const img = this.img;\n    img.style.display = resizing ? '' : 'none';\n\n    return {img, canvas};\n  } */\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport type {ChatRights} from '../../lib/appManagers/appChatsManager';\nimport type {AppImManager} from '../../lib/appManagers/appImManager';\nimport type {MessagesStorageKey} from '../../lib/appManagers/appMessagesManager';\nimport EventListenerBase from '../../helpers/eventListenerBase';\nimport {logger, LogTypes} from '../../lib/logger';\nimport rootScope from '../../lib/rootScope';\nimport appSidebarRight from '../sidebarRight';\nimport ChatBubbles from './bubbles';\nimport ChatContextMenu from './contextMenu';\nimport ChatInput from './input';\nimport ChatSelection from './selection';\nimport ChatTopbar from './topbar';\nimport {NULL_PEER_ID, REPLIES_PEER_ID} from '../../lib/mtproto/mtproto_config';\nimport SetTransition from '../singleTransition';\nimport AppPrivateSearchTab from '../sidebarRight/tabs/search';\nimport renderImageFromUrl from '../../helpers/dom/renderImageFromUrl';\nimport mediaSizes from '../../helpers/mediaSizes';\nimport ChatSearch from './search';\nimport IS_TOUCH_SUPPORTED from '../../environment/touchSupport';\nimport getAutoDownloadSettingsByPeerId, {ChatAutoDownloadSettings} from '../../helpers/autoDownload';\nimport ChatBackgroundGradientRenderer from './gradientRenderer';\nimport ChatBackgroundPatternRenderer from './patternRenderer';\nimport pause from '../../helpers/schedulers/pause';\nimport {AppManagers} from '../../lib/appManagers/managers';\nimport SlicedArray from '../../helpers/slicedArray';\nimport themeController from '../../helpers/themeController';\nimport AppSharedMediaTab from '../sidebarRight/tabs/sharedMedia';\nimport noop from '../../helpers/noop';\nimport middlewarePromise from '../../helpers/middlewarePromise';\nimport indexOfAndSplice from '../../helpers/array/indexOfAndSplice';\nimport {Message} from '../../layer';\n\nexport type ChatType = 'chat' | 'pinned' | 'replies' | 'discussion' | 'scheduled';\n\nexport default class Chat extends EventListenerBase<{\n  setPeer: (mid: number, isTopMessage: boolean) => void\n}> {\n  public container: HTMLElement;\n  public backgroundEl: HTMLElement;\n\n  public topbar: ChatTopbar;\n  public bubbles: ChatBubbles;\n  public input: ChatInput;\n  public selection: ChatSelection;\n  public contextMenu: ChatContextMenu;\n  public search: ChatSearch;\n\n  public wasAlreadyUsed: boolean;\n  // public initPeerId = 0;\n  public peerId: PeerId;\n  public threadId: number;\n  public setPeerPromise: Promise<void>;\n  public peerChanged: boolean;\n\n  public log: ReturnType<typeof logger>;\n\n  public type: ChatType;\n  public messagesStorageKey: MessagesStorageKey;\n\n  public noForwards: boolean;\n\n  public inited: boolean;\n\n  public isRestricted: boolean;\n  public autoDownload: ChatAutoDownloadSettings;\n\n  public gradientRenderer: ChatBackgroundGradientRenderer;\n  public patternRenderer: ChatBackgroundPatternRenderer;\n  public gradientCanvas: HTMLCanvasElement;\n  public patternCanvas: HTMLCanvasElement;\n  public backgroundTempId: number;\n  public setBackgroundPromise: Promise<void>;\n  public sharedMediaTab: AppSharedMediaTab;\n  public sharedMediaTabs: AppSharedMediaTab[];\n  // public renderDarkPattern: () => Promise<void>;\n\n  public isBot: boolean;\n  public isChannel: boolean;\n  public isBroadcast: boolean;\n  public isAnyGroup: boolean;\n  public isMegagroup: boolean;\n\n  constructor(\n    public appImManager: AppImManager,\n    public managers: AppManagers\n  ) {\n    super();\n\n    this.type = 'chat';\n\n    this.container = document.createElement('div');\n    this.container.classList.add('chat', 'tabs-tab');\n\n    this.backgroundEl = document.createElement('div');\n    this.backgroundEl.classList.add('chat-background');\n\n    // * constructor end\n\n    this.log = logger('CHAT', LogTypes.Log | LogTypes.Warn | LogTypes.Debug | LogTypes.Error);\n    // this.log.error('Chat construction');\n\n    this.peerId = NULL_PEER_ID;\n\n    this.container.append(this.backgroundEl);\n    this.appImManager.chatsContainer.append(this.container);\n\n    this.backgroundTempId = 0;\n    this.sharedMediaTabs = [];\n  }\n\n  public setBackground(url: string, skipAnimation?: boolean): Promise<void> {\n    const theme = themeController.getTheme();\n\n    let item: HTMLElement;\n    const isColorBackground = !!theme.background.color && !theme.background.slug && !theme.background.intensity;\n    if(\n      isColorBackground &&\n      document.documentElement.style.cursor === 'grabbing' &&\n      this.gradientRenderer &&\n      !this.patternRenderer\n    ) {\n      this.gradientCanvas.dataset.colors = theme.background.color;\n      this.gradientRenderer.init(this.gradientCanvas);\n      return Promise.resolve();\n    }\n\n    const tempId = ++this.backgroundTempId;\n\n    const previousGradientRenderer = this.gradientRenderer;\n    const previousPatternRenderer = this.patternRenderer;\n    const previousGradientCanvas = this.gradientCanvas;\n    const previousPatternCanvas = this.patternCanvas;\n\n    this.gradientRenderer =\n      this.patternRenderer =\n      this.gradientCanvas =\n      this.patternCanvas =\n      // this.renderDarkPattern =\n      undefined;\n\n    const intensity = theme.background.intensity && theme.background.intensity / 100;\n    const isDarkPattern = !!intensity && intensity < 0;\n\n    let patternRenderer: ChatBackgroundPatternRenderer;\n    let patternCanvas = item?.firstElementChild as HTMLCanvasElement;\n    let gradientCanvas: HTMLCanvasElement;\n    if(!item) {\n      item = document.createElement('div');\n      item.classList.add('chat-background-item');\n\n      if(url) {\n        if(intensity) {\n          item.classList.add('is-pattern');\n\n          const rect = this.appImManager.chatsContainer.getBoundingClientRect();\n          patternRenderer = this.patternRenderer = ChatBackgroundPatternRenderer.getInstance({\n            url,\n            width: rect.width,\n            height: rect.height,\n            mask: isDarkPattern\n          });\n\n          patternCanvas = this.patternCanvas = patternRenderer.createCanvas();\n          patternCanvas.classList.add('chat-background-item-canvas', 'chat-background-item-pattern-canvas');\n\n          if(isDarkPattern) {\n            item.classList.add('is-dark');\n          }\n\n          // if(isDarkPattern) {\n          //   this.renderDarkPattern = () => {\n          //     return patternRenderer.exportCanvasPatternToImage(patternCanvas).then((url) => {\n          //       if(this.backgroundTempId !== tempId) {\n          //         return;\n          //       }\n\n          //       gradientCanvas.style.webkitMaskImage = `url(${url})`;\n          //     });\n          //   };\n          // }\n        } else if(theme.background.slug) {\n          item.classList.add('is-image');\n        }\n      } else if(theme.background.color) {\n        item.classList.add('is-color');\n      }\n    }\n\n    let gradientRenderer: ChatBackgroundGradientRenderer;\n    const color = theme.background.color;\n    if(color) {\n      // if(color.includes(',')) {\n      const {canvas, gradientRenderer: _gradientRenderer} = ChatBackgroundGradientRenderer.create(color);\n      gradientRenderer = this.gradientRenderer = _gradientRenderer;\n      gradientCanvas = this.gradientCanvas = canvas;\n      gradientCanvas.classList.add('chat-background-item-canvas', 'chat-background-item-color-canvas');\n\n      if(rootScope.settings.animationsEnabled) {\n        gradientRenderer.scrollAnimate(true);\n      }\n      // } else {\n      //   item.style.backgroundColor = color;\n      //   item.style.backgroundImage = 'none';\n      // }\n    }\n\n    if(patternRenderer) {\n      const setOpacityTo = isDarkPattern ? gradientCanvas : patternCanvas;\n      setOpacityTo.style.setProperty('--opacity-max', '' + Math.abs(intensity));\n    }\n\n    const promise = new Promise<void>((resolve) => {\n      const cb = () => {\n        if(this.backgroundTempId !== tempId) {\n          if(patternRenderer) {\n            patternRenderer.cleanup(patternCanvas);\n          }\n\n          if(gradientRenderer) {\n            gradientRenderer.cleanup();\n          }\n\n          return;\n        }\n\n        const prev = this.backgroundEl.lastElementChild as HTMLElement;\n\n        if(prev === item) {\n          resolve();\n          return;\n        }\n\n        const append = [\n          gradientCanvas,\n          // isDarkPattern && this.renderDarkPattern ? undefined : patternCanvas\n          patternCanvas\n        ].filter(Boolean);\n        if(append.length) {\n          item.append(...append);\n        }\n\n        this.backgroundEl.append(item);\n\n        SetTransition(item, 'is-visible', true, !skipAnimation ? 200 : 0, prev ? () => {\n          if(previousPatternRenderer) {\n            previousPatternRenderer.cleanup(previousPatternCanvas);\n          }\n\n          if(previousGradientRenderer) {\n            previousGradientRenderer.cleanup();\n          }\n\n          prev.remove();\n        } : null, 2);\n\n        resolve();\n      };\n\n      if(patternRenderer) {\n        const renderPatternPromise = patternRenderer.renderToCanvas(patternCanvas);\n        renderPatternPromise.then(() => {\n          if(this.backgroundTempId !== tempId) {\n            return;\n          }\n\n          // let promise: Promise<any>;\n          // if(isDarkPattern && this.renderDarkPattern) {\n          //   promise = this.renderDarkPattern();\n          // } else {\n          // const promise = Promise.resolve();\n          // }\n\n          // promise.then(cb);\n          cb();\n        });\n      } else if(url) {\n        renderImageFromUrl(item, url, cb);\n      } else {\n        cb();\n      }\n    });\n\n    return this.setBackgroundPromise = Promise.race([\n      pause(500),\n      promise\n    ]);\n  }\n\n  public setType(type: ChatType) {\n    this.type = type;\n  }\n\n  public init(/* peerId: PeerId */) {\n    // this.initPeerId = peerId;\n\n    this.topbar = new ChatTopbar(this, appSidebarRight, this.managers);\n    this.bubbles = new ChatBubbles(this, this.managers);\n    this.input = new ChatInput(this, this.appImManager, this.managers);\n    this.contextMenu = new ChatContextMenu(this, this.managers);\n    this.selection = new ChatSelection(this, this.bubbles, this.input, this.managers);\n\n    if(this.type === 'chat') {\n      this.topbar.constructUtils();\n      this.topbar.constructPeerHelpers();\n    } else if(this.type === 'pinned') {\n      this.topbar.constructPinnedHelpers();\n    } else if(this.type === 'discussion') {\n      this.topbar.constructUtils();\n      this.topbar.constructDiscussionHelpers();\n    }\n\n    this.topbar.construct();\n    this.input.construct();\n\n    if(this.type === 'chat') { // *   ,   -   \n      this.bubbles.constructPeerHelpers();\n      this.input.constructPeerHelpers();\n    } else if(this.type === 'pinned') {\n      this.bubbles.constructPinnedHelpers();\n      this.input.constructPinnedHelpers();\n    } else if(this.type === 'scheduled') {\n      this.bubbles.constructScheduledHelpers();\n      this.input.constructPeerHelpers();\n    } else if(this.type === 'discussion') {\n      this.bubbles.constructPeerHelpers();\n      this.input.constructPeerHelpers();\n    }\n\n    if(this.type !== 'scheduled' && !IS_TOUCH_SUPPORTED) {\n      this.bubbles.setReactionsHoverListeners();\n    }\n\n    this.bubbles.attachContainerListeners();\n\n    this.container.classList.add('type-' + this.type);\n    this.container.append(this.topbar.container, this.bubbles.container, this.input.chatInput);\n\n    this.bubbles.listenerSetter.add(rootScope)('dialog_migrate', ({migrateFrom, migrateTo}) => {\n      if(this.peerId === migrateFrom) {\n        this.setPeer(migrateTo);\n      }\n    });\n\n    this.bubbles.listenerSetter.add(rootScope)('dialog_drop', (e) => {\n      if(e.peerId === this.peerId) {\n        this.appImManager.setPeer();\n      }\n    });\n  }\n\n  public beforeDestroy() {\n    this.bubbles.cleanup();\n  }\n\n  private cleanupBackground() {\n    ++this.backgroundTempId;\n    if(this.patternRenderer) {\n      this.patternRenderer.cleanup(this.patternCanvas);\n      this.patternRenderer = undefined;\n    }\n\n    if(this.gradientRenderer) {\n      this.gradientRenderer.cleanup();\n      this.gradientRenderer = undefined;\n    }\n  }\n\n  public destroy() {\n    // const perf = performance.now();\n\n    this.topbar.destroy();\n    this.bubbles.destroy();\n    this.input.destroy();\n    this.contextMenu && this.contextMenu.destroy();\n    this.selection && this.selection.attachListeners(undefined, undefined);\n\n    this.cleanupBackground();\n\n    delete this.topbar;\n    delete this.bubbles;\n    delete this.input;\n    delete this.selection;\n    delete this.contextMenu;\n\n    this.container.remove();\n\n    // this.log.error('Chat destroy time:', performance.now() - perf);\n  }\n\n  public cleanup(helperToo = true) {\n    this.input.cleanup(helperToo);\n    this.topbar.cleanup();\n    this.selection.cleanup();\n  }\n\n  public async onChangePeer(m: ReturnType<typeof middlewarePromise>) {\n    const {peerId} = this;\n\n    const searchTab = appSidebarRight.getTab(AppPrivateSearchTab);\n    if(searchTab) {\n      searchTab.close();\n    }\n\n    const [\n      noForwards,\n      isRestricted,\n      isAnyGroup,\n      _,\n      isMegagroup,\n      isBroadcast,\n      isChannel,\n      isBot\n    ] = await m(Promise.all([\n      this.managers.appPeersManager.noForwards(peerId),\n      this.managers.appPeersManager.isRestricted(peerId),\n      this._isAnyGroup(peerId),\n      this.setAutoDownloadMedia(),\n      this.managers.appPeersManager.isMegagroup(peerId),\n      this.managers.appPeersManager.isBroadcast(peerId),\n      this.managers.appPeersManager.isChannel(peerId),\n      this.managers.appPeersManager.isBot(peerId)\n    ]));\n\n    this.noForwards = noForwards;\n    this.isRestricted = isRestricted;\n    this.isAnyGroup = isAnyGroup;\n    this.isMegagroup = isMegagroup;\n    this.isBroadcast = isBroadcast;\n    this.isChannel = isChannel;\n    this.isBot = isBot;\n\n    this.container.classList.toggle('no-forwards', this.noForwards);\n\n    this.sharedMediaTab = appSidebarRight.createSharedMediaTab();\n    this.sharedMediaTabs.push(this.sharedMediaTab);\n\n    this.sharedMediaTab.setPeer(peerId, this.threadId);\n    this.input.clearHelper(); // \n    this.selection.cleanup(); // TODO: REFACTOR !!!!!!\n  }\n\n  public setPeer(peerId: PeerId, lastMsgId?: number, startParam?: string) {\n    if(!peerId) {\n      this.inited = undefined;\n    } else if(!this.inited) {\n      if(this.init) {\n        this.init(/* peerId */);\n        this.init = null;\n      }\n\n      this.inited = true;\n    }\n\n    // const appMediaViewer = (window as any).appMediaViewer as AppMediaViewerBase<any, any, any>;\n    // if(appMediaViewer) {\n    //   appMediaViewer.close();\n    // }\n\n    const samePeer = this.peerId === peerId;\n    if(!samePeer) {\n      this.appImManager.dispatchEvent('peer_changing', this);\n      this.peerId = peerId || NULL_PEER_ID;\n      this.messagesStorageKey = `${this.peerId}_${this.type === 'scheduled' ? 'scheduled' : 'history'}`;\n    } else if(this.setPeerPromise) {\n      return;\n    }\n\n    if(!peerId) {\n      appSidebarRight.toggleSidebar(false);\n      this.cleanup(true);\n      this.bubbles.setPeer(false, peerId);\n      this.appImManager.dispatchEvent('peer_changed', peerId);\n\n      appSidebarRight.replaceSharedMediaTab();\n      this.destroySharedMediaTab();\n      this.sharedMediaTab = undefined;\n\n      return;\n    }\n\n    this.peerChanged = samePeer;\n\n    const bubblesSetPeerPromise = this.bubbles.setPeer(samePeer, peerId, lastMsgId, startParam);\n    const setPeerPromise = this.setPeerPromise = bubblesSetPeerPromise.then((result) => {\n      return result.promise;\n    }).catch(noop).finally(() => {\n      if(this.setPeerPromise === setPeerPromise) {\n        this.setPeerPromise = null;\n      }\n    });\n\n    return bubblesSetPeerPromise;\n  }\n\n  public destroySharedMediaTab(tab = this.sharedMediaTab) {\n    indexOfAndSplice(this.sharedMediaTabs, tab);\n    tab.destroy();\n  }\n\n  public async setAutoDownloadMedia() {\n    this.autoDownload = await getAutoDownloadSettingsByPeerId(this.peerId);\n  }\n\n  public setMessageId(messageId?: number) {\n    return this.setPeer(this.peerId, messageId);\n  }\n\n  public async finishPeerChange(isTarget: boolean, isJump: boolean, lastMsgId: number, startParam?: string) {\n    if(this.peerChanged) return;\n\n    const peerId = this.peerId;\n    this.peerChanged = true;\n    this.wasAlreadyUsed = true;\n\n    const middleware = this.bubbles.getMiddleware();\n\n    this.cleanup(false);\n\n    const sharedMediaTab = this.sharedMediaTab;\n    sharedMediaTab.loadSidebarMedia(true);\n\n    const callbacksPromise = Promise.all([\n      this.topbar.finishPeerChange(isTarget),\n      this.bubbles.finishPeerChange(),\n      this.input.finishPeerChange(startParam)\n    ]);\n\n    const [callbacks] = await Promise.all([\n      callbacksPromise,\n      sharedMediaTab.fillProfileElements()\n    ]);\n\n    if(!middleware()) {\n      return;\n    }\n\n    callbacks.forEach((callback) => {\n      callback();\n    });\n\n    appSidebarRight.replaceSharedMediaTab(sharedMediaTab);\n\n    this.sharedMediaTabs.filter((tab) => tab !== sharedMediaTab).forEach((tab) => this.destroySharedMediaTab(tab));\n\n    this.log.setPrefix('CHAT-' + peerId + '-' + this.type);\n\n    this.appImManager.dispatchEvent('peer_changed', peerId);\n  }\n\n  public getMessage(mid: number) {\n    return this.managers.appMessagesManager.getMessageFromStorage(this.messagesStorageKey, mid);\n  }\n\n  public async getMidsByMid(mid: number) {\n    return this.managers.appMessagesManager.getMidsByMessage(await this.getMessage(mid));\n  }\n\n  public getHistoryStorage(ignoreThreadId?: boolean) {\n    return this.managers.appMessagesManager.getHistoryStorageTransferable(this.peerId, ignoreThreadId ? undefined : this.threadId)\n    .then((historyStorageTransferable) => {\n      return {\n        ...historyStorageTransferable,\n        history: SlicedArray.fromJSON<number>(historyStorageTransferable.historySerialized)\n      }\n    });\n  }\n\n  public getHistoryMaxId() {\n    return this.getHistoryStorage().then((historyStorage) => historyStorage.maxId);\n  }\n\n  public async _isAnyGroup(peerId: PeerId) {\n    return peerId === rootScope.myId || peerId === REPLIES_PEER_ID || (await this.managers.appPeersManager.isAnyGroup(peerId));\n  }\n\n  public initSearch(query?: string) {\n    if(!this.peerId) return;\n\n    if(mediaSizes.isMobile) {\n      if(!this.search) {\n        this.search = new ChatSearch(this.topbar, this, query);\n      } else {\n        this.search.setQuery(query);\n      }\n    } else {\n      let tab = appSidebarRight.getTab(AppPrivateSearchTab);\n      if(!tab) {\n        tab = appSidebarRight.createTab(AppPrivateSearchTab);\n      }\n\n      tab.open(this.peerId, this.threadId, this.bubbles.onDatePick, query);\n    }\n  }\n\n  public canSend(action?: ChatRights) {\n    return this.managers.appMessagesManager.canSendToPeer(this.peerId, this.threadId, action);\n  }\n\n  public isStartButtonNeeded() {\n    return Promise.all([\n      this.managers.appPeersManager.isBot(this.peerId),\n      this.managers.appMessagesManager.getDialogOnly(this.peerId),\n      this.getHistoryStorage(true)\n    ]).then(([isBot, dialog, historyStorage]) => {\n      return isBot && !dialog && !historyStorage.history.length;\n    });\n  }\n\n  public getMessageSendingParams() {\n    return {\n      threadId: this.threadId,\n      replyToMsgId: this.input.replyToMsgId,\n      scheduleDate: this.input.scheduleDate,\n      sendSilent: this.input.sendSilent,\n      sendAsPeerId: this.input.sendAsPeerId\n    };\n  }\n\n  public isOurMessage(message: Message.message | Message.messageService) {\n    return message.fromId === rootScope.myId || (!!message.pFlags.out && this.isMegagroup);\n  }\n\n  public isOutMessage(message: Message.message | Message.messageService) {\n    const fwdFrom = (message as Message.message).fwd_from;\n    const isOut = this.isOurMessage(message) && (!fwdFrom || this.peerId !== rootScope.myId);\n    return !!isOut;\n  }\n\n  public isAvatarNeeded(message: Message.message | Message.messageService) {\n    return this.isAnyGroup && !this.isOutMessage(message);\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport type {State} from '../config/state';\nimport rootScope from '../lib/rootScope';\n\nexport type ChatAutoDownloadSettings = {\n  photo: number,\n  video: number,\n  file: number\n};\n\nexport default async function getAutoDownloadSettingsByPeerId(peerId: PeerId): Promise<ChatAutoDownloadSettings> {\n  let type: keyof State['settings']['autoDownload'];\n\n  let photoSizeMax = 0, videoSizeMax = 0, fileSizeMax = 0;\n  const settings = rootScope.settings;\n  const appPeersManager = rootScope.managers.appPeersManager;\n  if(!settings.autoDownloadNew.pFlags.disabled && peerId) {\n    if(peerId.isUser()) {\n      if(await appPeersManager.isContact(peerId)) {\n        type = 'contacts';\n      } else {\n        type = 'private';\n      }\n    } else if(await appPeersManager.isBroadcast(peerId)) {\n      type = 'channels';\n    } else {\n      type = 'groups';\n    }\n\n    if(settings.autoDownload.photo[type]) photoSizeMax = settings.autoDownloadNew.photo_size_max;\n    if(settings.autoDownload.video[type]) videoSizeMax = settings.autoDownloadNew.video_size_max;\n    if(settings.autoDownload.file[type]) fileSizeMax = settings.autoDownloadNew.file_size_max;\n  }\n\n  return {\n    photo: photoSizeMax,\n    video: videoSizeMax,\n    file: fileSizeMax\n  };\n}\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport type {AppImManager} from '../../lib/appManagers/appImManager';\r\nimport ButtonIcon from '../buttonIcon';\r\nimport IS_TOUCH_SUPPORTED from '../../environment/touchSupport';\r\nimport {IS_APPLE, IS_MOBILE} from '../../environment/userAgent';\r\nimport appNavigationController from '../appNavigationController';\r\nimport {_i18n} from '../../lib/langPack';\r\nimport cancelEvent from '../../helpers/dom/cancelEvent';\r\nimport {attachClickEvent} from '../../helpers/dom/clickEvent';\r\nimport getSelectedNodes from '../../helpers/dom/getSelectedNodes';\r\nimport isSelectionEmpty from '../../helpers/dom/isSelectionEmpty';\r\nimport {MarkdownType, markdownTags} from '../../helpers/dom/getRichElementValue';\r\nimport getVisibleRect from '../../helpers/dom/getVisibleRect';\r\nimport clamp from '../../helpers/number/clamp';\r\nimport matchUrl from '../../lib/richTextProcessor/matchUrl';\r\nimport matchUrlProtocol from '../../lib/richTextProcessor/matchUrlProtocol';\r\n// import { logger } from \"../../lib/logger\";\r\n\r\nexport default class MarkupTooltip {\r\n  public container: HTMLElement;\r\n  private wrapper: HTMLElement;\r\n  private buttons: {[type in MarkdownType]: HTMLElement} = {} as any;\r\n  private linkBackButton: HTMLElement;\r\n  private linkApplyButton: HTMLButtonElement;\r\n  private hideTimeout: number;\r\n  private addedListener = false;\r\n  private waitingForMouseUp = false;\r\n  private linkInput: HTMLInputElement;\r\n  private savedRange: Range;\r\n  private mouseUpCounter: number = 0;\r\n  // private log: ReturnType<typeof logger>;\r\n\r\n  constructor(private appImManager: AppImManager) {\r\n    // this.log = logger('MARKUP');\r\n  }\r\n\r\n  private init() {\r\n    this.container = document.createElement('div');\r\n    this.container.classList.add('markup-tooltip', 'z-depth-1', 'hide');\r\n\r\n    this.wrapper = document.createElement('div');\r\n    this.wrapper.classList.add('markup-tooltip-wrapper');\r\n\r\n    const tools1 = document.createElement('div');\r\n    const tools2 = document.createElement('div');\r\n    tools1.classList.add('markup-tooltip-tools');\r\n    tools2.classList.add('markup-tooltip-tools');\r\n\r\n    const arr = ['bold', 'italic', 'underline', 'strikethrough', 'monospace', 'spoiler', 'link'] as (keyof MarkupTooltip['buttons'])[];\r\n    arr.forEach((c) => {\r\n      const button = ButtonIcon(c, {noRipple: true});\r\n      tools1.append(this.buttons[c] = button);\r\n\r\n      if(c !== 'link') {\r\n        button.addEventListener('mousedown', (e) => {\r\n          cancelEvent(e);\r\n          this.appImManager.chat.input.applyMarkdown(c);\r\n          this.cancelClosening();\r\n\r\n          /* this.mouseUpCounter = 0;\r\n          this.setMouseUpEvent(); */\r\n          // this.hide();\r\n        });\r\n      } else {\r\n        attachClickEvent(button, (e) => {\r\n          cancelEvent(e);\r\n          this.showLinkEditor();\r\n          this.cancelClosening();\r\n        });\r\n      }\r\n    });\r\n\r\n    this.linkBackButton = ButtonIcon('left', {noRipple: true});\r\n    this.linkInput = document.createElement('input');\r\n    _i18n(this.linkInput, 'MarkupTooltip.LinkPlaceholder', undefined, 'placeholder');\r\n    this.linkInput.classList.add('input-clear');\r\n    this.linkInput.addEventListener('keydown', (e) => {\r\n      const valid = !this.linkInput.value.length || !!matchUrl(this.linkInput.value);// /^(http)|(https):\\/\\//i.test(this.linkInput.value);\r\n\r\n      if(e.key === 'Enter') {\r\n        if(!valid) {\r\n          if(this.linkInput.classList.contains('error')) {\r\n            this.linkInput.classList.remove('error');\r\n            void this.linkInput.offsetLeft; // reflow\r\n          }\r\n\r\n          this.linkInput.classList.add('error');\r\n        } else {\r\n          this.applyLink(e);\r\n        }\r\n      }\r\n    });\r\n\r\n    this.linkInput.addEventListener('input', (e) => {\r\n      const valid = this.isLinkValid();\r\n\r\n      this.linkInput.classList.toggle('is-valid', valid);\r\n      this.linkInput.classList.remove('error');\r\n    });\r\n\r\n    this.linkBackButton.addEventListener('mousedown', (e) => {\r\n      // this.log('linkBackButton click');\r\n      cancelEvent(e);\r\n      this.container.classList.remove('is-link');\r\n      // input.value = '';\r\n      this.resetSelection();\r\n      this.setTooltipPosition();\r\n      this.cancelClosening();\r\n    });\r\n\r\n    this.linkApplyButton = ButtonIcon('check markup-tooltip-link-apply', {noRipple: true});\r\n    this.linkApplyButton.addEventListener('mousedown', (e) => {\r\n      // this.log('linkApplyButton click');\r\n      this.applyLink(e);\r\n    });\r\n\r\n    const applyDiv = document.createElement('div');\r\n    applyDiv.classList.add('markup-tooltip-link-apply-container');\r\n\r\n    const delimiter1 = document.createElement('span');\r\n    const delimiter2 = document.createElement('span');\r\n    const delimiter3 = document.createElement('span');\r\n    delimiter1.classList.add('markup-tooltip-delimiter');\r\n    delimiter2.classList.add('markup-tooltip-delimiter');\r\n    delimiter3.classList.add('markup-tooltip-delimiter');\r\n    tools1.insertBefore(delimiter1, this.buttons.link);\r\n    applyDiv.append(delimiter3, this.linkApplyButton);\r\n    tools2.append(this.linkBackButton, delimiter2, this.linkInput, applyDiv);\r\n    // tools1.insertBefore(delimiter2, this.buttons.link.nextSibling);\r\n\r\n    this.wrapper.append(tools1, tools2);\r\n    this.container.append(this.wrapper);\r\n    document.body.append(this.container);\r\n\r\n    window.addEventListener('resize', () => {\r\n      this.hide();\r\n    });\r\n  }\r\n\r\n  public showLinkEditor() {\r\n    if(!this.container || !this.container.classList.contains('is-visible')) { // * if not inited yet (Ctrl+A + Ctrl+K)\r\n      this.show();\r\n    }\r\n\r\n    const button = this.buttons.link;\r\n    this.container.classList.add('is-link');\r\n\r\n    const selection = document.getSelection();\r\n    this.savedRange = selection.getRangeAt(0);\r\n\r\n    if(button.classList.contains('active')) {\r\n      const startContainer = this.savedRange.startContainer;\r\n      const anchor = startContainer.parentElement as HTMLAnchorElement;\r\n      this.linkInput.value = anchor.href;\r\n    } else {\r\n      this.linkInput.value = '';\r\n    }\r\n\r\n    this.setTooltipPosition(true);\r\n\r\n    setTimeout(() => {\r\n      this.linkInput.focus(); // !!! instant focus will break animation\r\n    }, 200);\r\n    this.linkInput.classList.toggle('is-valid', this.isLinkValid());\r\n  }\r\n\r\n  private applyLink(e: Event) {\r\n    cancelEvent(e);\r\n    this.resetSelection();\r\n    let url = this.linkInput.value;\r\n    if(url && !matchUrlProtocol(url)) {\r\n      url = 'https://' + url;\r\n    }\r\n    this.appImManager.chat.input.applyMarkdown('link', url);\r\n    setTimeout(() => {\r\n      this.hide();\r\n    }, 0);\r\n  }\r\n\r\n  private isLinkValid() {\r\n    return !this.linkInput.value.length || !!matchUrl(this.linkInput.value);\r\n  }\r\n\r\n  private resetSelection(range: Range = this.savedRange) {\r\n    const selection = window.getSelection();\r\n    selection.removeAllRanges();\r\n    selection.addRange(range);\r\n    this.appImManager.chat.input.messageInput.focus();\r\n  }\r\n\r\n  public hide() {\r\n    // return;\r\n\r\n    if(this.init) return;\r\n\r\n    this.container.classList.remove('is-visible');\r\n    // document.removeEventListener('mouseup', this.onMouseUp);\r\n    document.removeEventListener('mouseup', this.onMouseUpSingle);\r\n    this.waitingForMouseUp = false;\r\n\r\n    appNavigationController.removeByType('markup');\r\n\r\n    if(this.hideTimeout) clearTimeout(this.hideTimeout);\r\n    this.hideTimeout = window.setTimeout(() => {\r\n      this.hideTimeout = undefined;\r\n      this.container.classList.add('hide');\r\n      this.container.classList.remove('is-link');\r\n    }, 200);\r\n  }\r\n\r\n  public getActiveMarkupButton() {\r\n    const nodes = getSelectedNodes();\r\n    const parents = [...new Set(nodes.map((node) => node.parentNode))];\r\n    // if(parents.length > 1 && parents) return [];\r\n\r\n    const currentMarkups: Set<HTMLElement> = new Set();\r\n    (parents as HTMLElement[]).forEach((node) => {\r\n      for(const type in markdownTags) {\r\n        const tag = markdownTags[type as MarkdownType];\r\n        const closest = node.closest(tag.match + ', [contenteditable]');\r\n        if(closest !== this.appImManager.chat.input.messageInput) {\r\n          currentMarkups.add(this.buttons[type as MarkdownType]);\r\n        }\r\n      }\r\n    });\r\n\r\n\r\n    return [...currentMarkups];\r\n  }\r\n\r\n  public setActiveMarkupButton() {\r\n    const activeButtons = this.getActiveMarkupButton();\r\n\r\n    for(const i in this.buttons) {\r\n      // @ts-ignore\r\n      const button = this.buttons[i];\r\n      button.classList.toggle('active', activeButtons.includes(button));\r\n    }\r\n  }\r\n\r\n  private setTooltipPosition(isLinkToggle = false) {\r\n    const selection = document.getSelection();\r\n    const range = selection.getRangeAt(0);\r\n\r\n    const bodyRect = document.body.getBoundingClientRect();\r\n    const selectionRect = range.getBoundingClientRect();\r\n    const inputRect = this.appImManager.chat.input.rowsWrapper.getBoundingClientRect();\r\n\r\n    this.container.style.maxWidth = inputRect.width + 'px';\r\n\r\n    const visibleRect = getVisibleRect(undefined, this.appImManager.chat.input.messageInput, false, selectionRect);\r\n\r\n    const selectionTop = visibleRect.rect.top/* selectionRect.top */ + (bodyRect.top * -1);\r\n\r\n    const currentTools = this.container.classList.contains('is-link') ? this.wrapper.lastElementChild : this.wrapper.firstElementChild;\r\n\r\n    const sizesRect = currentTools.getBoundingClientRect();\r\n    const top = selectionTop - sizesRect.height - 8;\r\n\r\n    const minX = inputRect.left;\r\n    const maxX = (inputRect.left + inputRect.width) - Math.min(inputRect.width, sizesRect.width);\r\n    let left: number;\r\n    if(isLinkToggle) {\r\n      const containerRect = this.container.getBoundingClientRect();\r\n      left = clamp(containerRect.left, minX, maxX);\r\n    } else {\r\n      const x = selectionRect.left + (selectionRect.width - sizesRect.width) / 2;\r\n      left = clamp(x, minX, maxX);\r\n    }\r\n\r\n    /* const isClamped = x !== minX && x !== maxX && (left === minX || left === maxX || this.container.getBoundingClientRect().left >= maxX);\r\n\r\n    if(isLinkToggle && this.container.classList.contains('is-link') && !isClamped) return; */\r\n\r\n    this.container.style.transform = `translate3d(${left}px, ${top}px, 0)`;\r\n  }\r\n\r\n  public show() {\r\n    if(this.init) {\r\n      this.init();\r\n      this.init = null;\r\n    }\r\n\r\n    if(isSelectionEmpty()) {\r\n      this.hide();\r\n      return;\r\n    }\r\n\r\n    if(this.hideTimeout !== undefined) {\r\n      clearTimeout(this.hideTimeout);\r\n    }\r\n\r\n    if(this.container.classList.contains('is-visible')) {\r\n      return;\r\n    }\r\n\r\n    this.setActiveMarkupButton();\r\n\r\n    this.container.classList.remove('is-link');\r\n    const isFirstShow = this.container.classList.contains('hide');\r\n    if(isFirstShow) {\r\n      this.container.classList.remove('hide');\r\n      this.container.classList.add('no-transition');\r\n    }\r\n\r\n    this.setTooltipPosition();\r\n\r\n    if(isFirstShow) {\r\n      void this.container.offsetLeft; // reflow\r\n      this.container.classList.remove('no-transition');\r\n    }\r\n\r\n    this.container.classList.add('is-visible');\r\n\r\n    if(!IS_MOBILE) {\r\n      appNavigationController.pushItem({\r\n        type: 'markup',\r\n        onPop: () => {\r\n          this.hide();\r\n        }\r\n      });\r\n    }\r\n\r\n    // this.log('selection', selectionRect, activeButton);\r\n  }\r\n\r\n  /* private onMouseUp = (e: Event) => {\r\n    this.log('onMouseUp');\r\n    if(findUpClassName(e.target, 'markup-tooltip')) return;\r\n\r\n    this.hide();\r\n    //document.removeEventListener('mouseup', this.onMouseUp);\r\n  }; */\r\n\r\n  private onMouseUpSingle = (e?: Event) => {\r\n    // this.log('onMouseUpSingle');\r\n    this.waitingForMouseUp = false;\r\n\r\n    if(IS_TOUCH_SUPPORTED) {\r\n      e && cancelEvent(e);\r\n      if(this.mouseUpCounter++ === 0) {\r\n        this.resetSelection(this.savedRange);\r\n      } else {\r\n        this.hide();\r\n        return;\r\n      }\r\n    }\r\n\r\n    this.show();\r\n\r\n    /* !isTouchSupported && document.addEventListener('mouseup', this.onMouseUp); */\r\n  };\r\n\r\n  public setMouseUpEvent() {\r\n    if(this.waitingForMouseUp) return;\r\n    this.waitingForMouseUp = true;\r\n\r\n    // this.log('setMouseUpEvent');\r\n\r\n    document.addEventListener('mouseup', this.onMouseUpSingle, {once: true});\r\n  }\r\n\r\n  public cancelClosening() {\r\n    if(IS_TOUCH_SUPPORTED && !IS_APPLE) {\r\n      document.removeEventListener('mouseup', this.onMouseUpSingle);\r\n      document.addEventListener('mouseup', (e) => {\r\n        cancelEvent(e);\r\n        this.mouseUpCounter = 1;\r\n        this.waitingForMouseUp = false;\r\n        this.setMouseUpEvent();\r\n      }, {once: true});\r\n    }\r\n  }\r\n\r\n  public handleSelection() {\r\n    if(this.addedListener) return;\r\n    this.addedListener = true;\r\n    document.addEventListener('selectionchange', (e) => {\r\n      // this.log('selectionchange');\r\n\r\n      if(document.activeElement === this.linkInput) {\r\n        return;\r\n      }\r\n\r\n      const messageInput = this.appImManager.chat.input.messageInput;\r\n      if(document.activeElement !== messageInput) {\r\n        this.hide();\r\n        return;\r\n      }\r\n\r\n      const selection = document.getSelection();\r\n      if(isSelectionEmpty(selection)) {\r\n        this.hide();\r\n        return;\r\n      }\r\n\r\n      if(IS_TOUCH_SUPPORTED) {\r\n        if(IS_APPLE) {\r\n          this.show();\r\n          this.setTooltipPosition(); // * because can skip this in .show();\r\n        } else {\r\n          if(this.mouseUpCounter === 2) {\r\n            this.mouseUpCounter = 0;\r\n            return;\r\n          }\r\n\r\n          this.savedRange = selection.getRangeAt(0);\r\n          this.setMouseUpEvent();\r\n          /* document.addEventListener('touchend', (e) => {\r\n            cancelEvent(e);\r\n            this.resetSelection(range);\r\n            this.show();\r\n          }, {once: true, passive: false}); */\r\n        }\r\n      } else if(this.container && this.container.classList.contains('is-visible')) {\r\n        this.setTooltipPosition();\r\n      } else if(messageInput.matches(':active')) {\r\n        this.setMouseUpEvent();\r\n      } else {\r\n        this.show();\r\n      }\r\n    });\r\n  }\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nexport default function getSelectedNodes() {\r\n  const nodes: Node[] = [];\r\n  const selection = window.getSelection();\r\n  for(let i = 0; i < selection.rangeCount; ++i) {\r\n    const range = selection.getRangeAt(i);\r\n    let {startContainer, endContainer} = range;\r\n    if(endContainer.nodeType !== 3) endContainer = endContainer.firstChild;\r\n\r\n    while(startContainer && startContainer !== endContainer) {\r\n      nodes.push(startContainer.nodeType === 3 ? startContainer : startContainer.firstChild);\r\n      startContainer = startContainer.nextSibling;\r\n    }\r\n\r\n    if(nodes[nodes.length - 1] !== endContainer) {\r\n      nodes.push(endContainer);\r\n    }\r\n  }\r\n\r\n  // * filter null's due to <br>\r\n  return nodes.filter((node) => !!node);\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport generatePathData from '../../helpers/generatePathData';\r\nimport {FormatterArguments, i18n, LangPackKey} from '../../lib/langPack';\r\n\r\nexport default class ChatDragAndDrop {\r\n  container: HTMLDivElement;\r\n  svg: SVGSVGElement;\r\n  outlineWrapper: HTMLDivElement;\r\n  path: SVGPathElement;\r\n\r\n  constructor(appendTo: HTMLElement, private options: {\r\n    icon?: string,\r\n    header: LangPackKey,\r\n    headerArgs?: FormatterArguments,\r\n    subtitle?: LangPackKey,\r\n    onDrop: (e: DragEvent) => void\r\n  }) {\r\n    this.container = document.createElement('div');\r\n    this.container.classList.add('drop', 'z-depth-1');\r\n\r\n    this.outlineWrapper = document.createElement('div');\r\n    this.outlineWrapper.classList.add('drop-outline-wrapper');\r\n\r\n    this.svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');\r\n    this.svg.classList.add('drop-outline');\r\n\r\n    this.path = document.createElementNS('http://www.w3.org/2000/svg', 'path');\r\n    this.path.classList.add('drop-outline-path');\r\n\r\n    let dropIcon: HTMLElement;\r\n    if(options.icon) {\r\n      dropIcon = document.createElement('div');\r\n      dropIcon.classList.add('drop-icon', 'tgico-' + options.icon);\r\n    }\r\n\r\n    const dropHeader = document.createElement('div');\r\n    dropHeader.classList.add('drop-header');\r\n    dropHeader.append(i18n(options.header, options.headerArgs));\r\n\r\n    let dropSubtitle: HTMLElement;\r\n    if(options.subtitle) {\r\n      dropSubtitle = document.createElement('div');\r\n      dropSubtitle.classList.add('drop-subtitle');\r\n      dropSubtitle.append(i18n(options.subtitle));\r\n    }\r\n\r\n    this.svg.append(this.path);\r\n    this.outlineWrapper.append(this.svg);\r\n\r\n    this.container.append(...[this.outlineWrapper, dropIcon, dropHeader, dropSubtitle].filter(Boolean));\r\n    appendTo.append(this.container);\r\n\r\n    this.container.addEventListener('dragover', this.onDragOver);\r\n    this.container.addEventListener('dragleave', this.onDragLeave);\r\n    this.container.addEventListener('drop', this.onDrop);\r\n  }\r\n\r\n  onDragOver = (e: DragEvent) => {\r\n    this.container.classList.add('is-dragover');\r\n    // SetTransition(this.container, 'is-dragover', true, 500);\r\n  };\r\n\r\n  onDragLeave = (e: DragEvent) => {\r\n    this.container.classList.remove('is-dragover');\r\n    // SetTransition(this.container, 'is-dragover', false, 500);\r\n  };\r\n\r\n  onDrop = (e: DragEvent) => {\r\n    this.options.onDrop(e);\r\n  };\r\n\r\n  destroy() {\r\n    delete this.options;\r\n    this.container.remove();\r\n    this.container.removeEventListener('dragover', this.onDragOver);\r\n    this.container.removeEventListener('dragleave', this.onDragLeave);\r\n    this.container.removeEventListener('drop', this.onDrop);\r\n  }\r\n\r\n  setPath() {\r\n    const rect = this.outlineWrapper.getBoundingClientRect();\r\n    this.svg.setAttributeNS(null, 'preserveAspectRatio', 'none');\r\n    this.svg.setAttributeNS(null, 'viewBox', `0 0 ${rect.width} ${rect.height}`);\r\n    this.svg.setAttributeNS(null, 'width', `${rect.width}`);\r\n    this.svg.setAttributeNS(null, 'height', `${rect.height}`);\r\n\r\n    const radius = 10;\r\n    // const strokeWidth = 2;\r\n    const sizeX = rect.width - radius;\r\n    const sizeY = rect.height - radius;\r\n    const pos = radius / 2;\r\n    const d = generatePathData(pos, pos, sizeX, sizeY, radius, radius, radius, radius);\r\n    this.path.setAttributeNS(null, 'd', d);\r\n  }\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport {doubleRaf} from '../schedulers';\r\n\r\nexport default function disableTransition(elements: HTMLElement[]) {\r\n  elements.forEach((el) => el.classList.add('no-transition'));\r\n\r\n  doubleRaf().then(() => {\r\n    elements.forEach((el) => el.classList.remove('no-transition'));\r\n  });\r\n}\r\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n *\n * Originally from:\n * https://github.com/evgeny-nadymov/telegram-react\n * Copyright (C) 2018 Evgeny Nadymov\n * https://github.com/evgeny-nadymov/telegram-react/blob/master/LICENSE\n */\n\nexport const MAX_SPEED = 8.2;\nexport const MIN_SPEED = 0.8;\n\n// import { MIN_SPEED, MAX_SPEED } from './BlobDrawable';\n\ntype Radius = number[];\n\nexport default class LineBlobDrawable {\n  public maxRadius: number;\n  public minRadius: number;\n  private N: number;\n  private radius: Radius;\n  private radiusNext: Radius;\n  private progress: number[];\n  private speed: number[];\n\n  constructor(n: number) {\n    this.maxRadius = 10;\n    this.minRadius = 0;\n\n    this.N = n;\n    this.radius = new Array(n + 1);\n\n    this.radiusNext = new Array(n + 1);\n    this.progress = new Array(n + 1);\n    this.speed = new Array(n + 1);\n\n    for(let i = 0; i <= n; i++) {\n      this.generateBlob(this.radius, i);\n      this.generateBlob(this.radiusNext, i);\n      this.progress[i] = 0;\n    }\n  }\n\n  private generateBlob(radius: Radius, i: number) {\n    const {maxRadius, minRadius, speed} = this;\n\n    const radDif = maxRadius - minRadius;\n    radius[i] = minRadius + Math.random() * radDif;\n    speed[i] = 0.017 + 0.003 * Math.random();\n  }\n\n  private generateNextBlob() {\n    const {radius, radiusNext, progress, N} = this;\n    for(let i = 0; i < N; i++) {\n      this.generateBlob(radius, i);\n      this.generateBlob(radiusNext, i);\n      progress[i] = 0.0;\n    }\n  }\n\n  public update(amplitude: number, speedScale: number) {\n    const {N, progress, speed, radius, radiusNext} = this;\n    for(let i = 0; i <= N; i++) {\n      progress[i] += (speed[i] * MIN_SPEED) + amplitude * speed[i] * MAX_SPEED * speedScale;\n      if(progress[i] >= 1.0) {\n        progress[i] = 0.0;\n        radius[i] = radiusNext[i];\n        this.generateBlob(radiusNext, i);\n      }\n    }\n  }\n\n  public draw(left: number, top: number, right: number, bottom: number, canvas: HTMLCanvasElement, paint: (ctx: CanvasRenderingContext2D) => void, pinnedTop: number, progressToPinned: number) {\n    if(canvas.getContext) {\n      const ctx = canvas.getContext('2d');\n      // ctx.globalAlpha = 0.5;\n      // ctx.lineWidth = 1;\n\n      ctx.beginPath();\n      ctx.moveTo(right, bottom);\n      ctx.lineTo(left, bottom);\n\n      const {radius, radiusNext, N} = this;\n      for(let i = 0; i <= N; i++) {\n        if(i === 0) {\n          const progress = this.progress[i];\n          const r1 = radius[i] * (1.0 - progress) + radiusNext[i] * progress;\n          const y = (top - r1) * progressToPinned + pinnedTop * (1.0 - progressToPinned);\n          ctx.lineTo(left, y);\n        } else {\n          const progress = this.progress[i - 1];\n          const r1 = radius[i - 1] * (1.0 - progress) + radiusNext[i - 1] * progress;\n          const progressNext = this.progress[i];\n          const r2 = radius[i] * (1.0 - progressNext) + radiusNext[i] * progressNext;\n          const x1 = (right - left) / N * (i - 1);\n          const x2 = (right - left) / N * i;\n          const cx = x1 + (x2 - x1) / 2;\n\n          const y1 = (top - r1) * progressToPinned + pinnedTop * (1.0 - progressToPinned);\n          const y2 = (top - r2) * progressToPinned + pinnedTop * (1.0 - progressToPinned);\n          ctx.bezierCurveTo(cx, y1, cx, y2, x2, y2);\n          if(i === N) {\n            ctx.lineTo(right, bottom);\n          }\n        }\n      }\n\n      // ctx.scale(1.0, 1.0);\n      paint(ctx);\n      ctx.fill();\n      ctx.closePath();\n    }\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n *\n * Originally from:\n * https://github.com/evgeny-nadymov/telegram-react\n * Copyright (C) 2018 Evgeny Nadymov\n * https://github.com/evgeny-nadymov/telegram-react/blob/master/LICENSE\n */\n\nimport GROUP_CALL_STATE from '../lib/calls/groupCallState';\nimport LineBlobDrawable from './lineBlobDrawable';\n\nexport class WeavingState {\n  public shader: (ctx: CanvasRenderingContext2D, left: number, top: number, right: number, bottom: number) => void;\n\n  constructor(public stateId: GROUP_CALL_STATE) {\n    this.createGradient(stateId);\n  }\n\n  public createGradient(stateId: GROUP_CALL_STATE) {\n    this.shader = (ctx, left, top, right, bottom) => {\n      ctx.fillStyle = WeavingState.getGradientFromType(ctx, stateId, left, top, right, bottom);\n    };\n  }\n\n  // Android colors\n  static getGradientFromType(ctx: CanvasRenderingContext2D, type: GROUP_CALL_STATE, x0: number, y0: number, x1: number, y1: number) {\n    const gradient = ctx.createLinearGradient(x0, y0, x1, y1);\n    if(type === GROUP_CALL_STATE.MUTED_BY_ADMIN) {\n      gradient.addColorStop(0, '#F05459');\n      gradient.addColorStop(.4, '#766EE9');\n      gradient.addColorStop(1, '#57A4FE');\n    } else if(type === GROUP_CALL_STATE.UNMUTED) {\n      gradient.addColorStop(0, '#52CE5D');\n      gradient.addColorStop(1, '#00B1C0');\n    } else if(type === GROUP_CALL_STATE.MUTED) {\n      gradient.addColorStop(0, '#0976E3');\n      gradient.addColorStop(1, '#2BCEFF');\n    } else if(type === GROUP_CALL_STATE.CONNECTING) {\n      gradient.addColorStop(0, '#8599aa');\n      gradient.addColorStop(1, '#8599aa');\n    }\n\n    return gradient;\n  }\n\n  update(height: number, width: number, dt: number, amplitude: number) {\n    // TODO: move gradient here\n  }\n}\n\nexport default class TopbarWeave {\n  private focused: boolean;\n  private resizing: boolean;\n  private lastUpdateTime: number;\n  private amplitude: number;\n  private amplitude2: number;\n\n  private states: Map<GROUP_CALL_STATE, WeavingState>;\n  private previousState: WeavingState;\n  private currentState: WeavingState;\n  private progressToState: number;\n\n  private scale: number;\n  private left: number;\n  private top: number;\n  private right: number;\n  private bottom: number;\n\n  private mounted: boolean;\n  private media: MediaQueryList;\n\n  private container: HTMLDivElement;\n  private canvas: HTMLCanvasElement;\n\n  private resizeHandler: number;\n  private raf: number;\n\n  private lbd: LineBlobDrawable;\n  private lbd1: LineBlobDrawable;\n  private lbd2: LineBlobDrawable;\n\n  private animateToAmplitude: number;\n  private animateAmplitudeDiff: number;\n  private animateAmplitudeDiff2: number;\n\n  constructor() {\n    this.focused = true;\n    this.resizing = false;\n    this.lastUpdateTime = Date.now();\n    this.amplitude = 0.0;\n    this.amplitude2 = 0.0;\n\n    this.states = new Map([\n      [GROUP_CALL_STATE.UNMUTED, new WeavingState(GROUP_CALL_STATE.UNMUTED)],\n      [GROUP_CALL_STATE.MUTED, new WeavingState(GROUP_CALL_STATE.MUTED)],\n      [GROUP_CALL_STATE.MUTED_BY_ADMIN, new WeavingState(GROUP_CALL_STATE.MUTED_BY_ADMIN)],\n      [GROUP_CALL_STATE.CONNECTING, new WeavingState(GROUP_CALL_STATE.CONNECTING)]\n    ]);\n    this.previousState = null;\n    this.currentState = this.states.get(GROUP_CALL_STATE.CONNECTING);\n    this.progressToState = 1.0;\n  }\n\n  public componentDidMount() {\n    if(this.mounted) {\n      return;\n    }\n\n    this.mounted = true;\n    // window.addEventListener('blur', this.handleBlur);\n    // window.addEventListener('focus', this.handleFocus);\n    window.addEventListener('resize', this.handleResize);\n    this.media = window.matchMedia('screen and (min-resolution: 2dppx)');\n    this.media.addEventListener('change', this.handleDevicePixelRatioChanged);\n\n    this.setSize();\n    this.forceUpdate();\n\n    this.lbd = new LineBlobDrawable(3);\n    this.lbd1 = new LineBlobDrawable(7);\n    this.lbd2 = new LineBlobDrawable(8);\n    this.setAmplitude(this.amplitude);\n\n    this.draw();\n  }\n\n  public componentWillUnmount() {\n    this.mounted = false;\n    // window.removeEventListener('blur', this.handleBlur);\n    // window.removeEventListener('focus', this.handleFocus);\n    window.removeEventListener('resize', this.handleResize);\n    this.media.addEventListener('change', this.handleDevicePixelRatioChanged);\n\n    const {canvas} = this;\n    const ctx = canvas.getContext('2d');\n    ctx.clearRect(0, 0, canvas.width, canvas.height);\n  }\n\n  private setSize() {\n    this.scale = window.devicePixelRatio;\n    this.top = 20 * this.scale;\n    this.right = (this.mounted ? this.container.offsetWidth : 1261) * this.scale;\n    this.bottom = (this.mounted ? this.container.offsetHeight : 68) * this.scale;\n    this.left = 0 * this.scale;\n    this.setCanvasSize();\n  }\n\n  private setCanvasSize() {\n    this.canvas.width = this.right;\n    this.canvas.height = this.bottom;\n  }\n\n  private handleDevicePixelRatioChanged = (e: Event) => {\n    this.setSize();\n    this.forceUpdate();\n  }\n\n  private handleResize = () => {\n    if(this.resizeHandler) {\n      clearTimeout(this.resizeHandler);\n      this.resizeHandler = null;\n    }\n\n    this.resizing = true;\n    this.resizeCanvas();\n    this.resizeHandler = window.setTimeout(() => {\n      this.resizing = false;\n      this.invokeDraw();\n    }, 250);\n  }\n\n  private resizeCanvas() {\n    this.scale = window.devicePixelRatio;\n    this.right = this.container.offsetWidth * this.scale;\n\n    this.forceUpdate();\n    this.invokeDraw();\n  }\n\n  public handleFocus = () => {\n    this.focused = true;\n    this.invokeDraw();\n  }\n\n  public handleBlur = () => {\n    this.focused = false;\n  }\n\n  private invokeDraw = () => {\n    if(this.raf) return;\n\n    this.draw();\n  }\n\n  private draw = (force = false) => {\n    this.raf = null;\n    if(!this.mounted) {\n      return;\n    }\n    const {lbd, lbd1, lbd2, scale, left, top, right, bottom, currentState, previousState, focused, resizing, canvas} = this;\n    if(!focused && !resizing && this.progressToState >= 1.0) {\n      return;\n    }\n\n    // console.log('[top] draw', [focused, resizing, this.mounted]);\n\n    const newTime = Date.now();\n    let dt = (newTime - this.lastUpdateTime);\n    if(dt > 20) {\n      dt = 17;\n    }\n\n    // console.log('draw start', this.amplitude, this.animateToAmplitude);\n    if(this.animateToAmplitude !== this.amplitude) {\n      this.amplitude += this.animateAmplitudeDiff * dt;\n      if(this.animateAmplitudeDiff > 0) {\n        if(this.amplitude > this.animateToAmplitude) {\n          this.amplitude = this.animateToAmplitude;\n        }\n      } else {\n        if(this.amplitude < this.animateToAmplitude) {\n          this.amplitude = this.animateToAmplitude;\n        }\n      }\n    }\n\n    if(this.animateToAmplitude !== this.amplitude2) {\n      this.amplitude2 += this.animateAmplitudeDiff2 * dt;\n      if(this.animateAmplitudeDiff2 > 0) {\n        if(this.amplitude2 > this.animateToAmplitude) {\n          this.amplitude2 = this.animateToAmplitude;\n        }\n      } else {\n        if(this.amplitude2 < this.animateToAmplitude) {\n          this.amplitude2 = this.animateToAmplitude;\n        }\n      }\n    }\n\n    if(previousState) {\n      this.progressToState += dt / 250;\n      if(this.progressToState > 1) {\n        this.progressToState = 1;\n        this.previousState = null;\n      }\n    }\n\n    const {amplitude, amplitude2, progressToState} = this;\n\n    const top1 = 6 * amplitude2 * scale;\n    const top2 = 6 * amplitude2 * scale;\n\n    const ctx = canvas.getContext('2d');\n    ctx.clearRect(0, 0, canvas.width, canvas.height);\n\n    lbd.minRadius = 0;\n    lbd.maxRadius = (2 + 2 * amplitude) * scale;\n    lbd1.minRadius = 0;\n    lbd1.maxRadius = (3 + 9 * amplitude) * scale;\n    lbd2.minRadius = 0;\n    lbd2.maxRadius = (3 + 9 * amplitude) * scale;\n\n    lbd.update(amplitude, 0.3);\n    lbd1.update(amplitude, 0.7);\n    lbd2.update(amplitude, 0.7);\n\n    for(let i = 0; i < 2; i++) {\n      if(i === 0 && !previousState) {\n        continue;\n      }\n\n      let alpha = 1;\n      let state: WeavingState = null;\n      if(i === 0) {\n        alpha = 1 - progressToState;\n        state = previousState;\n        // previousState.setToPaint(paint);\n      } else {\n        alpha = previousState ? progressToState : 1;\n        currentState.update(bottom - top, right - left, dt, amplitude);\n        state = currentState;\n        // currentState.setToPaint(paint);\n      }\n\n      const paint1 = (ctx: CanvasRenderingContext2D) => {\n        ctx.globalAlpha = 0.3 * alpha;\n        state.shader(ctx, left, top, right, bottom);\n      };\n      const paint = (ctx: CanvasRenderingContext2D) => {\n        ctx.globalAlpha = i === 0 ? 1 : alpha;\n        state.shader(ctx, left, top, right, bottom);\n      };\n\n      lbd1.draw(left, top - top1, right, bottom, canvas, paint1, top, 1.0);\n      lbd2.draw(left, top - top2, right, bottom, canvas, paint1, top, 1.0);\n      lbd.draw(left, top, right, bottom, canvas, paint, top, 1.0);\n    }\n\n    if(!force) {\n      this.raf = requestAnimationFrame(() => this.draw());\n    }\n  };\n\n  public setCurrentState = (stateId: GROUP_CALL_STATE, animated: boolean) => {\n    const {currentState, states} = this;\n\n    if(currentState?.stateId === stateId) {\n      return;\n    }\n\n    this.previousState = animated ? currentState : null;\n    this.currentState = states.get(stateId);\n    this.progressToState = this.previousState ? 0.0 : 1.0;\n  };\n\n  public setAmplitude(value: number) {\n    const {amplitude} = this;\n    this.animateToAmplitude = value;\n    this.animateAmplitudeDiff = (value - amplitude) / 250;\n    this.animateAmplitudeDiff2 = (value - amplitude) / 120;\n  }\n\n  private forceUpdate() {\n    this.setCanvasSize();\n  }\n\n  public render(className: string) {\n    const container = this.container = document.createElement('div');\n    container.classList.add(className);\n\n    const canvas = this.canvas = document.createElement('canvas');\n    canvas.classList.add(className + '-canvas');\n\n    container.append(canvas);\n\n    return container;\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport noop from '../../helpers/noop';\nimport safeAssign from '../../helpers/object/safeAssign';\nimport rootScope from '../rootScope';\nimport lottieLoader, {LottieAssetName} from './lottieLoader';\nimport type RLottiePlayer from './rlottiePlayer';\nimport {RLottieColor} from './rlottiePlayer';\n\nexport type RLottieIconOptions = {\n  width: number,\n  height: number,\n  container?: HTMLElement,\n  skipAnimation?: boolean\n};\n\nexport type RLottieIconItemPartOptions = {\n  startFrame: number,\n  endFrame: number,\n  name?: string\n};\n\nexport type RLottieIconItemOptions = {\n  name: LottieAssetName,\n  parts: RLottieIconItemPartOptions[],\n  initFrame?: number,\n  player?: RLottiePlayer,\n  autoplay?: boolean,\n  color?: RLottieColor,\n  inverseColor?: RLottieColor,\n};\n\nexport class RLottieIconItemPart implements RLottieIconItemPartOptions {\n  public startFrame: number;\n  public endFrame: number;\n  public name?: string;\n\n  constructor(public item: RLottieIconItem, options: RLottieIconItemPartOptions) {\n    safeAssign(this, options);\n  }\n\n  public play(callback?: () => void) {\n    return this.item.playPart(this, callback);\n  }\n}\n\n// export type RLottieIconItemPart = RLottieIconItemPartOptions;\n\nexport class RLottieIconItem implements RLottieIconItemOptions {\n  public name: LottieAssetName;\n  public parts: RLottieIconItemPart[];\n  public player: RLottiePlayer;\n  public initFrame: number;\n  public autoplay: boolean;\n  public color: RLottieColor;\n  public inverseColor: RLottieColor;\n  public loadPromise: Promise<void>;\n  public onLoadForPart: () => void;\n  public onLoadForColor: () => void;\n\n  constructor(public icon: RLottieIcon, options: RLottieIconItemOptions) {\n    this.autoplay = false;\n\n    safeAssign(this, options);\n\n    this.parts = this.parts.map((options) => this.createPart(options));\n  }\n\n  public load() {\n    let loadPromise = this.loadPromise;\n    if(loadPromise) {\n      return loadPromise;\n    }\n\n    const {container, canvas, width, height} = this.icon;\n    loadPromise = lottieLoader.loadAnimationAsAsset({\n      container,\n      canvas,\n      width,\n      height,\n      group: 'none',\n      loop: false,\n      autoplay: this.autoplay ?? false,\n      initFrame: this.initFrame,\n      skipFirstFrameRendering: this.initFrame === undefined,\n      color: this.color,\n      inverseColor: this.inverseColor\n    }, this.name).then((player) => {\n      return lottieLoader.waitForFirstFrame(player);\n    }).then((player) => {\n      this.player = player;\n\n      if(this.onLoadForColor) {\n        this.onLoadForColor();\n        this.onLoadForColor = undefined;\n      }\n\n      if(this.onLoadForPart) {\n        this.onLoadForPart();\n        this.onLoadForPart = undefined;\n      }\n    });\n\n    this.loadPromise = loadPromise;\n    this.icon.loadPromises.set(this.name, loadPromise);\n    return loadPromise;\n  }\n\n  public createPart(options: RLottieIconItemPartOptions) {\n    return new RLottieIconItemPart(this, options);\n  }\n\n  public getPart(index: string | number | RLottieIconItemPart) {\n    if(index instanceof RLottieIconItemPart) return index;\n    else if(typeof(index) === 'string') return this.parts.find((part) => part.name === index);\n    else return this.parts[index];\n  }\n\n  public playPart(part: RLottieIconItemPart, callback?: () => void) {\n    return this.icon.playPart(this, part, callback);\n  }\n}\n\nexport default class RLottieIcon {\n  public container: HTMLElement;\n  public canvas: HTMLCanvasElement;\n  public width: number;\n  public height: number;\n\n  protected items: Map<LottieAssetName, RLottieIconItem>;\n  public loadPromises: Map<LottieAssetName, Promise<void>>;\n\n  protected skipAnimation: boolean;\n\n  constructor(options: RLottieIconOptions) {\n    safeAssign(this, options);\n\n    if(!this.container) this.container = document.createElement('div');\n    this.container.classList.add('rlottie-icon');\n\n    const {width, height} = this;\n    this.container.style.width = width + 'px';\n    this.container.style.height = height + 'px';\n\n    const canvas = this.canvas = document.createElement('canvas');\n    canvas.classList.add('rlottie');\n    canvas.width = width;\n    canvas.height = height;\n\n    this.items = new Map();\n    this.loadPromises = new Map();\n  }\n\n  public get loadPromise() {\n    return Promise.all([...this.loadPromises.values()]).then(noop);\n  }\n\n  public getItem(name?: LottieAssetName): RLottieIconItem {\n    return !name && this.items.size === 1 ? this.items.values().next().value : this.items.get(name);\n  }\n\n  public add(options: Omit<RLottieIconItemOptions, 'player'>) {\n    const item = new RLottieIconItem(this, options);\n    this.items.set(options.name, item);\n\n    return item;\n  }\n\n  public playPart(item: RLottieIconItem, index: Parameters<RLottieIconItem['getPart']>[0], callback?: () => void) {\n    if(!item.player) {\n      item.onLoadForPart = () => {\n        this.playPart(item, index, callback);\n      };\n\n      return;\n    }\n\n    const part = item.getPart(index);\n    item.player.playPart({\n      from: rootScope.settings.animationsEnabled && !this.skipAnimation ? part.startFrame : part.endFrame,\n      to: part.endFrame,\n      callback\n    });\n  }\n\n  /* public playToPart(item: RLottieIconItem, index: Parameters<RLottieIconItem['getPart']>[0], toEnd: boolean) {\n    if(!item.player) return;\n    const part = item.getPart(index);\n    const toFrame = toEnd ? part.endFrame : part.startFrame;\n    item.player.playToFrame({\n      frame: toFrame\n    });\n  } */\n\n  public static generateEqualParts(length: number, frameCount: number): RLottieIconItemPartOptions[] {\n    return new Array(length).fill(0).map((_, idx) => {\n      const startFrame = idx * frameCount;\n      return {startFrame, endFrame: startFrame + frameCount - 1};\n    });\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport noop from '../helpers/noop';\nimport safeAssign from '../helpers/object/safeAssign';\nimport {LottieAssetName} from '../lib/rlottie/lottieLoader';\nimport RLottieIcon, {RLottieIconItemPartOptions, RLottieIconItemPart} from '../lib/rlottie/rlottieIcon';\nimport {RLottieColor} from '../lib/rlottie/rlottiePlayer';\n\nexport type SuperRLottieIconAddItemOptions = {name: LottieAssetName, parts: RLottieIconItemPartOptions};\nexport type SuperRLottieIconGetInfoResult = RLottieIconItemPart;\nexport class SuperRLottieIcon<Options extends {\n  PartState: any,\n  ColorState?: any,\n  Items?: {\n    name: string\n  }[]\n}> extends RLottieIcon {\n  protected getPart: (state: Options['PartState'], prevState?: Options['PartState']) => SuperRLottieIconGetInfoResult;\n  protected getColor?: (state: Options['ColorState'], prevState?: Options['ColorState']) => RLottieColor;\n\n  protected partState: Options['PartState'];\n  protected colorState: Options['ColorState'];\n  protected loaded: boolean;\n\n  constructor(options: {\n    width: number,\n    height: number,\n    skipAnimation?: boolean,\n    getPart: (state: Options['PartState'], prevState?: Options['PartState']) => SuperRLottieIconGetInfoResult,\n    getColor?: (state: Options['ColorState'], prevState?: Options['ColorState']) => RLottieColor,\n  }) {\n    super({\n      width: options.width,\n      height: options.height\n    });\n\n    safeAssign(this, options);\n\n    // hook the first call\n    /* const originalFunction = this.setState.bind(this);\n    this.setState = (partState, colorState) => {\n      this.setState = originalFunction;\n      this.load(partState, colorState);\n      return originalFunction(partState, colorState);\n    }; */\n  }\n\n  public load(partState: Options['PartState'], colorState?: Options['ColorState']) {\n    if(this.loaded) {\n      return this.loadPromise;\n    }\n\n    this.loaded = true;\n    this.partState = partState;\n    this.colorState = colorState;\n\n    const part = this.getPart(partState);\n    const color = colorState !== undefined && this.getColor && this.getColor(colorState);\n\n    const item = part.item;\n    item.initFrame = part.endFrame;\n    item.color = color;\n\n    const promises = [...this.items.values()].map((item) => item.load());\n    return Promise.all(promises).then(noop);\n  }\n\n  /**\n   * Will redirect setting color state to part callback to synchronize the rendering\n   */\n  public setState(partState: Options['PartState'], colorState?: Options['ColorState'], partCallback?: () => void) {\n    if(!this.loaded) this.load(partState, colorState);\n\n    let changedPartState = false, changedColorState = false;\n    if(partState !== undefined) changedPartState = this.setPartState(partState, colorState, partCallback);\n    else if(colorState !== undefined) changedColorState = this.setColorState(colorState);\n\n    return changedPartState || changedColorState;\n  }\n\n  public setPartState(state: Options['PartState'], colorState?: Options['ColorState'], callback?: () => void) {\n    const {partState: prevState} = this;\n    if(prevState === state) {\n      return colorState !== undefined ? this.setColorState(colorState) : false;\n    }\n\n    if(colorState !== undefined) {\n      this.setColorState(colorState, false);\n    }\n\n    this.partState = state;\n\n    const part = this.getPart(state, prevState);\n    part.play(callback);\n\n    return true;\n  }\n\n  public setColorState(state: Options['ColorState'], renderIfPaused = true) {\n    const {colorState: prevState} = this;\n    if(prevState === state || !this.getColor) {\n      return false;\n    }\n\n    this.colorState = state;\n\n    const item = this.getItem();\n    const color = this.getColor(state, prevState);\n    const invoke = () => {\n      item.player.setColor(color, renderIfPaused);\n    };\n\n    if(item.player) {\n      invoke();\n    } else {\n      item.onLoadForColor = invoke;\n    }\n\n    return true;\n  }\n\n  public destroy() {\n    this.items.forEach((item) => {\n      item.loadPromise.then(() => {\n        item.player.remove();\n      });\n    });\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport {RLottieIconItemPartOptions} from '../../lib/rlottie/rlottieIcon';\nimport {GROUP_CALL_MICROPHONE_BUTTON_STATE} from '.';\nimport {SuperRLottieIcon} from '../superIcon';\n\nexport default class GroupCallMicrophoneIcon extends SuperRLottieIcon<{\n  PartState: GROUP_CALL_MICROPHONE_BUTTON_STATE\n}> {\n  constructor() {\n    super({\n      width: 36,\n      height: 36,\n      getPart: (state, prevState) => {\n        const states = GROUP_CALL_MICROPHONE_BUTTON_STATE;\n        let partName: string;\n        switch(state) {\n          case states.HAND:\n            partName = prevState === states.MUTED ? 'muted-to-hand' : 'unmuted-to-hand';\n            break;\n          case states.MUTED:\n            partName = prevState === states.HAND ? 'hand-to-muted' : 'mute';\n            break;\n          case states.UNMUTED:\n            partName = 'unmute';\n            break;\n        }\n\n        return this.getItem().getPart(partName);\n      }\n    });\n\n    const className = 'group-call-microphone-icon';\n    this.container.classList.add(className + '-container');\n\n    const parts: RLottieIconItemPartOptions[] = [{\n      startFrame: 0,\n      endFrame: 35,\n      name: 'hand-to-muted'\n    }, {\n      startFrame: 36,\n      endFrame: 68,\n      name: 'unmute'\n    }, {\n      startFrame: 69,\n      endFrame: 98,\n      name: 'mute'\n    }, {\n      startFrame: 99,\n      endFrame: 135,\n      name: 'muted-to-hand'\n    }, {\n      startFrame: 136,\n      endFrame: 172,\n      name: 'unmuted-to-hand'\n    }, {\n      startFrame: 173,\n      endFrame: 201,\n      name: 'scheduled-crossing'\n    }, {\n      startFrame: 202,\n      endFrame: 236,\n      name: 'scheduled-to-muted'\n    }, {\n      startFrame: 237,\n      endFrame: 273,\n      name: 'scheduled-to-hand'\n    }, {\n      startFrame: 274,\n      endFrame: 310,\n      name: 'scheduled-crossed-to-hand'\n    }, {\n      startFrame: 311,\n      endFrame: 343,\n      name: 'scheduled-uncrossing'\n    }, {\n      startFrame: 344,\n      endFrame: 375,\n      name: 'scheduled-to-muted'\n    }, {\n      startFrame: 376,\n      endFrame: 403,\n      name: 'play-to-muted'\n    }];\n\n    this.add({\n      name: 'voip_filled',\n      parts\n    });\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport RLottieIcon from '../../lib/rlottie/rlottieIcon';\nimport {GROUP_CALL_PARTICIPANT_CLEARED_MUTED_STATE, GROUP_CALL_PARTICIPANT_MUTED_STATE, getColorByMutedState, clearMutedStateModifier} from '.';\nimport {SuperRLottieIcon} from '../superIcon';\n\nexport default class GroupCallParticipantMutedIcon extends SuperRLottieIcon<{\n  PartState: GROUP_CALL_PARTICIPANT_CLEARED_MUTED_STATE,\n  ColorState: GROUP_CALL_PARTICIPANT_MUTED_STATE\n}> {\n  constructor(private colored: boolean) {\n    super({\n      width: 32,\n      height: 32,\n      getPart: (state, prevState) => {\n        const states = GROUP_CALL_PARTICIPANT_MUTED_STATE;\n\n        let index: number;\n        switch(state) {\n          case states.HAND:\n            index = 3;\n            break;\n          case states.MUTED:\n            index = prevState === states.HAND ? 0 : 2;\n            break;\n          case states.UNMUTED:\n            index = 1;\n            break;\n        }\n\n        return this.getItem().getPart(index);\n      },\n      getColor: colored ? (state, prevState) => {\n        return getColorByMutedState(state);\n      } : undefined\n    });\n\n    const className = 'group-call-participant-muted-icon';\n    this.container.classList.add(className + '-container');\n\n    const parts = RLottieIcon.generateEqualParts(4, 21);\n    this.add({\n      name: 'voice_outlined2',\n      parts\n    });\n  }\n\n  public setState(state: GROUP_CALL_PARTICIPANT_MUTED_STATE) {\n    return super.setState(clearMutedStateModifier(state), state);\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport PopupElement from '../popups';\nimport {hexToRgb} from '../../helpers/color';\nimport {attachClickEvent} from '../../helpers/dom/clickEvent';\nimport customProperties from '../../helpers/dom/customProperties';\nimport {GroupCall, GroupCallParticipant} from '../../layer';\nimport type {AppChatsManager} from '../../lib/appManagers/appChatsManager';\nimport type {AppGroupCallsManager} from '../../lib/appManagers/appGroupCallsManager';\nimport type {AppPeersManager} from '../../lib/appManagers/appPeersManager';\nimport GROUP_CALL_STATE from '../../lib/calls/groupCallState';\nimport {RLottieColor} from '../../lib/rlottie/rlottiePlayer';\nimport rootScope from '../../lib/rootScope';\nimport ButtonIcon from '../buttonIcon';\nimport GroupCallMicrophoneIcon from './microphoneIcon';\nimport GroupCallParticipantsElement from './participants';\nimport GroupCallParticipantsVideoElement from './participantVideos';\nimport PopupPeer from '../popups/peer';\nimport GroupCallDescriptionElement from './description';\nimport GroupCallTitleElement from './title';\nimport {addFullScreenListener, cancelFullScreen, isFullScreen, requestFullScreen} from '../../helpers/dom/fullScreen';\nimport Scrollable from '../scrollable';\nimport {MovableState} from '../movableElement';\nimport animationIntersector from '../animationIntersector';\nimport {IS_APPLE_MOBILE} from '../../environment/userAgent';\nimport throttle from '../../helpers/schedulers/throttle';\nimport IS_SCREEN_SHARING_SUPPORTED from '../../environment/screenSharingSupport';\nimport GroupCallInstance from '../../lib/calls/groupCallInstance';\nimport makeButton from '../call/button';\nimport MovablePanel from '../../helpers/movablePanel';\nimport findUpClassName from '../../helpers/dom/findUpClassName';\nimport safeAssign from '../../helpers/object/safeAssign';\nimport toggleClassName from '../../helpers/toggleClassName';\nimport {AppManagers} from '../../lib/appManagers/managers';\nimport themeController from '../../helpers/themeController';\nimport groupCallsController from '../../lib/calls/groupCallsController';\n\nexport enum GROUP_CALL_PARTICIPANT_MUTED_STATE {\n  UNMUTED,\n  MUTED,\n  MUTED_FOR_ME,\n  MUTED_BY_ADMIN,\n  HAND\n}\n\nexport type GROUP_CALL_PARTICIPANT_CLEARED_MUTED_STATE = Exclude<GROUP_CALL_PARTICIPANT_MUTED_STATE, GROUP_CALL_PARTICIPANT_MUTED_STATE.MUTED_BY_ADMIN | GROUP_CALL_PARTICIPANT_MUTED_STATE.MUTED_FOR_ME>;\n\nexport function getGroupCallParticipantMutedState(participant: GroupCallParticipant) {\n  const states = GROUP_CALL_PARTICIPANT_MUTED_STATE;\n  if(participant.pFlags.muted_by_you) {\n    return states.MUTED_FOR_ME;\n  } else if(participant.raise_hand_rating !== undefined) {\n    return states.HAND;\n  } else if(participant.pFlags.muted) {\n    return participant.pFlags.can_self_unmute ? states.MUTED : states.MUTED_BY_ADMIN;\n  } else {\n    return states.UNMUTED;\n  }\n}\n\nexport function clearMutedStateModifier(state: GROUP_CALL_PARTICIPANT_MUTED_STATE): GROUP_CALL_PARTICIPANT_CLEARED_MUTED_STATE {\n  const states = GROUP_CALL_PARTICIPANT_MUTED_STATE;\n  switch(state) {\n    case states.MUTED_BY_ADMIN:\n    case states.MUTED_FOR_ME:\n      return states.MUTED;\n    default:\n      return state;\n  }\n}\n\nexport function getColorByMutedState(state: GROUP_CALL_PARTICIPANT_MUTED_STATE) {\n  const states = GROUP_CALL_PARTICIPANT_MUTED_STATE;\n  let colorStr: 'blue' | 'green' | 'secondary' | 'red';\n  switch(state) {\n    case states.HAND:\n      colorStr = 'blue';\n      break;\n    case states.MUTED:\n    case states.MUTED_FOR_ME:\n    case states.MUTED_BY_ADMIN:\n      colorStr = state === states.MUTED ? 'secondary' : 'red';\n      break;\n    case states.UNMUTED:\n      colorStr = 'green';\n      break;\n  }\n\n  const propertyValue = customProperties.getProperty('gc-' + colorStr + '-text-color');\n  const color: RLottieColor = hexToRgb(propertyValue);\n\n  return color;\n}\n\nexport enum GROUP_CALL_MICROPHONE_BUTTON_STATE {\n  HAND,\n  MUTED,\n  UNMUTED,\n}\n\nexport function getGroupCallMicrophoneButtonState(groupCall: GroupCall.groupCall, participant: GroupCallParticipant) {\n  const states = GROUP_CALL_MICROPHONE_BUTTON_STATE;\n  if(!participant.pFlags.can_self_unmute) {\n    return states.HAND;\n  } else if(participant.pFlags.muted) {\n    return states.MUTED\n  } else {\n    return states.UNMUTED;\n  }\n}\n\nlet previousState: MovableState = {\n  width: 420,\n  height: 640\n};\n\nconst className = 'group-call';\n\nexport default class PopupGroupCall extends PopupElement {\n  private instance: GroupCallInstance;\n  private groupCallTitle: GroupCallTitleElement;\n  private groupCallDescription: GroupCallDescriptionElement;\n  private groupCallBodyHeaderDescription: GroupCallDescriptionElement;\n  private groupCallParticipants: GroupCallParticipantsElement;\n  private groupCallParticipantsVideo: GroupCallParticipantsVideoElement;\n  private groupCallMicrophoneIcon: GroupCallMicrophoneIcon;\n  private videosCount: number;\n  private btnFullScreen: HTMLButtonElement;\n  private btnExitFullScreen: HTMLButtonElement;\n  private btnInvite: HTMLButtonElement;\n  private btnShowColumn: HTMLButtonElement;\n  private movablePanel: MovablePanel;\n  private buttonsContainer: HTMLDivElement;\n  private btnFullScreen2: HTMLButtonElement;\n  private btnVideo: HTMLDivElement;\n  private btnScreen: HTMLDivElement;\n\n  constructor() {\n    super('popup-group-call', {\n      body: true,\n      withoutOverlay: true,\n      closable: true,\n      title: true\n    });\n\n    this.videosCount = 0;\n    this.container.classList.add(className, 'night');\n\n    const instance = this.instance = groupCallsController.groupCall;\n    const {listenerSetter} = this;\n\n    if(!IS_APPLE_MOBILE) {\n      const btnFullScreen = this.btnFullScreen = ButtonIcon('fullscreen');\n      const btnFullScreen2 = this.btnFullScreen2 = ButtonIcon('fullscreen ' + className + '-cfs');\n      const btnExitFullScreen = this.btnExitFullScreen = ButtonIcon('smallscreen');\n\n      attachClickEvent(btnFullScreen, this.onFullScreenClick, {listenerSetter});\n      attachClickEvent(btnFullScreen2, this.onFullScreenClick, {listenerSetter});\n\n      attachClickEvent(btnExitFullScreen, () => {\n        cancelFullScreen();\n      }, {listenerSetter});\n\n      addFullScreenListener(this.container, this.onFullScreenChange, listenerSetter);\n    }\n\n    const btnInvite = this.btnInvite = ButtonIcon('adduser');\n    const btnShowColumn = this.btnShowColumn = ButtonIcon('rightpanel ' + className + '-only-big');\n\n    attachClickEvent(btnShowColumn, this.toggleRightColumn, {listenerSetter});\n\n    const headerInfo = document.createElement('div');\n    headerInfo.classList.add(className + '-header-info');\n\n    this.title.classList.add(className + '-header-title');\n\n    const subtitle = document.createElement('div');\n    subtitle.classList.add(className + '-header-subtitle');\n\n    headerInfo.append(this.title, subtitle);\n\n    this.header.classList.add(className + '-header');\n    this.header.append(...[this.btnExitFullScreen, headerInfo/* , btnInvite */, this.btnFullScreen, btnShowColumn].filter(Boolean));\n\n    const newHeader = this.header.cloneNode(false) as HTMLElement;\n    const newHeaderInfo = headerInfo.cloneNode(false) as HTMLElement;\n    const newHeaderTitle = this.title.cloneNode(false) as HTMLElement;\n\n    newHeaderInfo.append(newHeaderTitle);\n\n    const btnHideColumn = ButtonIcon('rightpanel');\n    newHeader.append(...[btnHideColumn, newHeaderInfo, this.btnFullScreen2].filter(Boolean));\n\n    attachClickEvent(btnHideColumn, this.toggleRightColumn, {listenerSetter});\n\n    this.body.prepend(newHeader);\n\n    const videosScrollable = new Scrollable(undefined);\n    videosScrollable.container.classList.add('group-call-big-video-container');\n    this.container.append(videosScrollable.container);\n\n    this.groupCallTitle = new GroupCallTitleElement(this.title);\n    this.groupCallDescription = new GroupCallDescriptionElement(subtitle);\n    this.groupCallBodyHeaderDescription = new GroupCallDescriptionElement(newHeaderTitle);\n    this.constructButtons();\n\n    this.groupCallParticipantsVideo = new GroupCallParticipantsVideoElement({\n      appendTo: videosScrollable.container,\n      instance,\n      listenerSetter,\n      displayPinned: true,\n      onLengthChange: (length) => {\n        this.videosCount = length;\n        this.toggleBigLayout();\n      },\n      managers: this.managers\n    });\n    this.groupCallParticipants = new GroupCallParticipantsElement({\n      appendTo: this.body,\n      instance,\n      listenerSetter,\n      managers: this.managers\n    });\n\n    this.movablePanel = new MovablePanel({\n      listenerSetter,\n      movableOptions: {\n        minWidth: 400,\n        minHeight: 480,\n        element: this.element,\n        verifyTouchTarget: (e) => {\n          const target = e.target;\n          if(findUpClassName(target, 'chatlist') ||\n            findUpClassName(target, 'group-call-button') ||\n            findUpClassName(target, 'btn-icon') ||\n            findUpClassName(target, 'group-call-participants-video-container') ||\n            isFullScreen()) {\n            return false;\n          }\n\n          return true;\n        }\n      },\n      onResize: () => this.toggleBigLayout(),\n      previousState\n    });\n\n    listenerSetter.add(instance)('state', () => {\n      this.updateInstance();\n    });\n\n    listenerSetter.add(rootScope)('group_call_update', (groupCall) => {\n      if(this.instance?.id === groupCall.id) {\n        this.updateInstance();\n      }\n    });\n\n    listenerSetter.add(instance)('pinned', () => {\n      this.setHasPinned();\n    });\n\n    listenerSetter.add(this.groupCallParticipantsVideo)('toggleControls', this.onToggleControls);\n\n    this.addEventListener('close', () => {\n      const {movablePanel} = this;\n      previousState = movablePanel.state;\n\n      this.groupCallParticipantsVideo.destroy();\n      this.groupCallParticipants.destroy();\n      this.groupCallMicrophoneIcon.destroy();\n\n      movablePanel.destroy();\n    });\n\n    this.toggleRightColumn();\n    this.onFullScreenChange();\n\n    this.updateInstance();\n  }\n\n  private constructButtons() {\n    const buttons = this.buttonsContainer = document.createElement('div');\n    buttons.classList.add(className + '-buttons');\n\n    const _makeButton = makeButton.bind(null, className, this.listenerSetter);\n\n    const btnVideo = this.btnVideo = _makeButton({\n      // text: 'VoiceChat.Video.Stream.Video',\n      callback: this.onVideoClick,\n      icon: 'videocamera_filled'\n    });\n\n    const btnScreen = this.btnScreen = _makeButton({\n      // text: 'VoiceChat.Video.Stream.Screencast',\n      callback: this.onScreenClick,\n      icon: 'sharescreen_filled'\n    });\n\n    btnScreen.classList.toggle('hide', !IS_SCREEN_SHARING_SUPPORTED);\n\n    const btnMute = _makeButton({\n      noRipple: true,\n      callback: throttle(this.onMuteClick, 600, true)\n    });\n    btnMute.classList.add(className + '-microphone-button');\n\n    const microphoneIcon = this.groupCallMicrophoneIcon = new GroupCallMicrophoneIcon();\n    btnMute.append(microphoneIcon.container);\n\n    const btnMore = _makeButton({\n      // text: 'VoiceChat.Video.Stream.More'\n      icon: 'settings_filled'\n    });\n\n    btnMore.classList.add('btn-disabled');\n    btnMore.classList.toggle('hide', !IS_SCREEN_SHARING_SUPPORTED);\n\n    const btnLeave = _makeButton({\n      // text: 'VoiceChat.Leave',\n      isDanger: true,\n      callback: this.onLeaveClick,\n      icon: 'close'\n    });\n\n    buttons.append(btnVideo, btnScreen, btnMute, btnMore, btnLeave);\n\n    this.container.append(buttons);\n  }\n\n  private onFullScreenClick = () => {\n    requestFullScreen(this.container);\n  };\n\n  private onToggleControls = (show: boolean) => {\n    this.container.classList.toggle('show-controls', show);\n    this.buttonsContainer.classList.toggle('show-controls', show);\n  };\n\n  private toggleDisability = toggleClassName.bind(null, 'btn-disabled');\n\n  private onVideoClick = () => {\n    const toggle = this.toggleDisability([this.btnVideo], true);\n    this.instance.toggleVideoSharing().finally(() => {\n      toggle();\n    });\n  };\n\n  private onScreenClick = () => {\n    const toggle = this.toggleDisability([this.btnScreen], true);\n    this.instance.toggleScreenSharing().finally(() => {\n      toggle();\n    });\n  };\n\n  private onMuteClick = () => {\n    const participant = this.instance.participant;\n    if(!participant.pFlags.can_self_unmute) {\n      if(participant.raise_hand_rating === undefined) {\n        this.instance.changeRaiseHand(true);\n      }\n    } else {\n      this.instance.toggleMuted();\n    }\n  };\n\n  private onLeaveClick = async() => {\n    const hangUp = (discard: boolean) => {\n      this.instance.hangUp(discard);\n    };\n\n    if(await this.managers.appChatsManager.hasRights(this.instance.chatId, 'manage_call')) {\n      new PopupPeer('popup-end-video-chat', {\n        titleLangKey: 'VoiceChat.End.Title',\n        descriptionLangKey: 'VoiceChat.End.Text',\n        checkboxes: [{\n          text: 'VoiceChat.End.Third'\n        }],\n        buttons: [{\n          langKey: 'VoiceChat.End.OK',\n          callback: (checkboxes) => {\n            hangUp(!!checkboxes.size);\n          },\n          isDanger: true\n        }]\n      }).show();\n    } else {\n      hangUp(false);\n    }\n  };\n\n  public getContainer() {\n    return this.container;\n  }\n\n  private onFullScreenChange = () => {\n    this.toggleBigLayout();\n    const isFull = isFullScreen();\n\n    const {btnFullScreen, btnExitFullScreen} = this;\n\n    const wasFullScreen = this.container.classList.contains('is-full-screen');\n    this.container.classList.toggle('is-full-screen', isFull);\n    btnFullScreen && btnFullScreen.classList.toggle('hide', isFull);\n    btnExitFullScreen && btnExitFullScreen.classList.toggle('hide', !isFull);\n    this.btnClose.classList.toggle('hide', isFull);\n\n    if(isFull !== wasFullScreen) {\n      animationIntersector.checkAnimations(isFull);\n\n      themeController.setThemeColor(isFull ? '#000000' : undefined);\n    }\n  };\n\n  private toggleBigLayout = () => {\n    const isFull = isFullScreen();\n    const movable = this.movablePanel?.movable;\n    const isBig = (isFull || !!(movable && movable.width >= 680)) && !!this.videosCount;\n\n    /* if(!isBig && isFull) {\n      cancelFullScreen();\n      return;\n    } */\n\n    const wasBig = this.container.classList.contains('is-big-layout');\n    let buttons: HTMLElement[];\n    if(isBig && !wasBig) { // fix buttons transition to 0 opacity\n      buttons = Array.from(this.buttonsContainer.children) as HTMLElement[];\n      buttons.forEach((element) => {\n        element.style.opacity = '0';\n      });\n\n      void this.buttonsContainer.offsetLeft;\n    }\n\n    this.container.classList.toggle('is-big-layout', isBig);\n    this.btnInvite.classList.toggle('hide', isBig);\n    this.btnShowColumn.classList.toggle('hide', !isBig);\n\n    if(buttons) {\n      // window.requestAnimationFrame(() => {\n      buttons.forEach((element) => {\n        element.style.opacity = '';\n      });\n      // });\n    }\n  };\n\n  private toggleRightColumn = () => {\n    this.container.classList.toggle('is-right-column-shown');\n  };\n\n  private setHasPinned() {\n    this.container.classList.toggle('has-pinned', !!this.instance.pinnedSource);\n  }\n\n  private updateInstance() {\n    if(this.instance.state === GROUP_CALL_STATE.CLOSED) {\n      if(this.container.classList.contains('is-full-screen')) {\n        cancelFullScreen();\n      }\n\n      this.hide();\n      return;\n    }\n\n    const {participant, groupCall} = this.instance;\n    if(!participant) {\n      return;\n    }\n\n    this.setTitle();\n    this.setDescription();\n    this.setHasPinned();\n\n    const microphoneButtonState = getGroupCallMicrophoneButtonState(groupCall as any, participant);\n    this.container.dataset.micState = microphoneButtonState === GROUP_CALL_MICROPHONE_BUTTON_STATE.HAND ? 'hand' : (microphoneButtonState === GROUP_CALL_MICROPHONE_BUTTON_STATE.MUTED ? 'muted' : 'unmuted');\n    this.groupCallMicrophoneIcon.setState(microphoneButtonState);\n  }\n\n  private setTitle() {\n    this.groupCallTitle.update(this.instance);\n  }\n\n  private setDescription() {\n    this.groupCallDescription.update(this.instance);\n    this.groupCallBodyHeaderDescription.update(this.instance);\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport replaceContent from '../../helpers/dom/replaceContent';\nimport setInnerHTML from '../../helpers/dom/setInnerHTML';\nimport {GroupCallParticipant} from '../../layer';\nimport {i18n} from '../../lib/langPack';\nimport {GROUP_CALL_PARTICIPANT_MUTED_STATE} from '.';\nimport {GroupCallParticipantVideoType} from './participantVideo';\nimport wrapEmojiText from '../../lib/richTextProcessor/wrapEmojiText';\n\nconst className = 'group-call-participant-status';\nexport default class GroupCallParticipantStatusElement {\n  public container: HTMLElement;\n\n  constructor(private withIcons: GroupCallParticipantVideoType[]) {\n    this.container = document.createElement('div');\n    this.container.classList.add(className + '-container');\n  }\n\n  public setState(state: GROUP_CALL_PARTICIPANT_MUTED_STATE, participant: GroupCallParticipant) {\n    const states = GROUP_CALL_PARTICIPANT_MUTED_STATE;\n    const icons = this.withIcons.filter((type) => !!participant[type]).map((type) => {\n      const iconClassName = `tgico-${type === 'presentation' ? 'listscreenshare' : 'videocamera_filled'}`;\n      const i = document.createElement('i');\n      i.classList.add(className + '-icon', className + '-icon-' + type, iconClassName);\n      return i;\n    });\n\n    let element2: HTMLElement, actionClassName: string;\n    if(state === states.MUTED_FOR_ME) {\n      element2 = i18n('VoiceChat.Status.MutedForYou');\n      actionClassName = 'is-muted';\n    } else if(state === states.UNMUTED) {\n      element2 = i18n('VoiceChat.Status.Speaking');\n      actionClassName = 'is-speaking';\n    } else if(state === states.HAND) {\n      element2 = i18n('VoiceChat.Status.WantsSpeak');\n      actionClassName = 'is-waiting';\n    } else if(participant.about && !icons.length) {\n      setInnerHTML(this.container, wrapEmojiText(participant.about));\n      return;\n    } else {\n      element2 = i18n('VoiceChat.Status.Listening');\n      actionClassName = 'is-listening';\n    }\n\n    const span = document.createElement('span');\n    span.classList.add(className, actionClassName);\n    span.append(...icons, element2);\n\n    replaceContent(this.container, span);\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport positionElementByIndex from '../../helpers/dom/positionElementByIndex';\nimport replaceContent from '../../helpers/dom/replaceContent';\nimport {fastRaf} from '../../helpers/schedulers';\nimport SortedList, {SortedElementBase} from '../../helpers/sortedList';\nimport {GroupCallParticipant} from '../../layer';\nimport appDialogsManager, {DialogDom, AppDialogsManager} from '../../lib/appManagers/appDialogsManager';\nimport {getGroupCallParticipantMutedState} from '.';\nimport GroupCallParticipantMutedIcon from './participantMutedIcon';\nimport GroupCallParticipantStatusElement from './participantStatus';\nimport type GroupCallInstance from '../../lib/calls/groupCallInstance';\nimport type LazyLoadQueue from '../lazyLoadQueue';\n\ninterface SortedParticipant extends SortedElementBase {\n  dom: DialogDom,\n  mutedIcon: GroupCallParticipantMutedIcon,\n  status: GroupCallParticipantStatusElement\n}\n\nexport default class GroupCallParticipantsList extends SortedList<SortedParticipant> {\n  public list: HTMLUListElement;\n\n  protected lazyLoadQueue: LazyLoadQueue;\n  protected avatarSize = 54;\n  protected rippleEnabled = true;\n  protected autonomous = true;\n  protected createChatListOptions: Parameters<AppDialogsManager['createChatList']>[0] = {/* new: true,  */dialogSize: 72};\n\n  constructor(private instance: GroupCallInstance) {\n    super({\n      getIndex: async(element) => (await this.instance.getParticipantByPeerId(element.id)).date,\n      onDelete: (element) => {\n        element.dom.listEl.remove();\n        this.onElementDestroy(element);\n      },\n      onUpdate: async(element) => {\n        const participant = await this.instance.getParticipantByPeerId(element.id);\n        const state = getGroupCallParticipantMutedState(participant);\n\n        element.mutedIcon.setState(state);\n        element.status.setState(state, participant);\n      },\n      onSort: (element, idx) => {\n        positionElementByIndex(element.dom.listEl, this.list, idx);\n      },\n      onElementCreate: (base) => {\n        const {dom} = appDialogsManager.addDialogNew({\n          peerId: base.id,\n          container: false,\n          avatarSize: this.avatarSize,\n          autonomous: this.autonomous,\n          meAsSaved: false,\n          rippleEnabled: this.rippleEnabled,\n          lazyLoadQueue: this.lazyLoadQueue\n        });\n\n        const className = 'group-call-participant';\n        dom.listEl.classList.add(className);\n\n        const mutedIcon = new GroupCallParticipantMutedIcon(true);\n        const status = new GroupCallParticipantStatusElement(['presentation', 'video']);\n        replaceContent(dom.lastMessageSpan, status.container);\n        dom.listEl.append(mutedIcon.container);\n        (base as SortedParticipant).mutedIcon = mutedIcon;\n        (base as SortedParticipant).status = status;\n\n        /* instance.getParticipantByPeerId(base.id).then((participant) => {\n          const mutedState = getGroupCallParticipantMutedState(participant);\n\n          mutedIcon.setState(mutedState);\n          status.setState(mutedState, participant);\n        }); */\n\n        (base as SortedParticipant).dom = dom;\n\n        return base as SortedParticipant;\n      },\n      updateElementWith: fastRaf\n    });\n\n    this.list = appDialogsManager.createChatList(this.createChatListOptions);\n  }\n\n  public destroy() {\n    this.elements.forEach((element) => {\n      this.onElementDestroy(element);\n    });\n  }\n\n  protected onElementDestroy(element: SortedParticipant) {\n    element.mutedIcon.destroy();\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport {animate} from '../../helpers/animation';\n\nexport default function callVideoCanvasBlur(video: HTMLVideoElement) {\n  const canvas = document.createElement('canvas');\n  canvas.classList.add('call-video-blur');\n  const size = 16;\n  canvas.width = size;\n  canvas.height = size;\n\n  const ctx = canvas.getContext('2d', {alpha: false});\n  ctx.filter = 'blur(2px)';\n  const renderFrame = () => {\n    ctx.drawImage(video, 0, 0, video.videoWidth, video.videoHeight, 0, 0, canvas.width, canvas.height);\n  };\n\n  animate(() => {\n    renderFrame();\n    return canvas.isConnected;\n  });\n\n  renderFrame();\n\n  return canvas;\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport {GroupCallParticipant} from '../../layer';\nimport type {GroupCallOutputSource} from '../../lib/appManagers/appGroupCallsManager';\nimport {i18n} from '../../lib/langPack';\nimport PeerTitle from '../peerTitle';\nimport {getGroupCallParticipantMutedState} from '.';\nimport GroupCallParticipantMutedIcon from './participantMutedIcon';\nimport GroupCallParticipantStatusElement from './participantStatus';\nimport GroupCallInstance from '../../lib/calls/groupCallInstance';\nimport callVideoCanvasBlur from '../call/videoCanvasBlur';\nimport getPeerId from '../../lib/appManagers/utils/peers/getPeerId';\nimport {AppManagers} from '../../lib/appManagers/managers';\n\nconst className = 'group-call-participant-video';\n\nexport type GroupCallParticipantVideoType = 'video' | 'presentation';\nexport default class GroupCallParticipantVideoElement {\n  public container: HTMLElement;\n  private peerTitle: PeerTitle;\n  private subtitle: HTMLElement;\n  private info: HTMLElement;\n  private left: HTMLElement;\n  private right: HTMLElement;\n  private header: HTMLElement;\n  private groupCallParticipantMutedIcon: GroupCallParticipantMutedIcon;\n  private groupCallParticipantStatus: GroupCallParticipantStatusElement;\n\n  constructor(private managers: AppManagers, private instance: GroupCallInstance, public source: GroupCallOutputSource) {\n    this.container = document.createElement('div');\n    this.container.classList.add(className + '-container');\n\n    this.info = document.createElement('div');\n    this.info.classList.add(className + '-info');\n\n    this.left = document.createElement('div');\n    this.left.classList.add(className + '-info-left');\n\n    this.right = document.createElement('div');\n    this.right.classList.add(className + '-info-right');\n\n    this.info.append(this.left, this.right);\n\n    this.container.append(this.info);\n  }\n\n  public setPinned(value: boolean) {\n    if(!value) {\n      if(this.header) {\n        this.header.remove();\n        this.header = undefined;\n      }\n\n      return;\n    } else if(this.header) {\n      return;\n    }\n\n    // if(!this.header) {\n    this.header = document.createElement('div');\n    this.header.classList.add(className + '-header');\n\n    const icon = document.createElement('i');\n    icon.classList.add('group-call-pin-icon', 'tgico-pin');\n    this.header.append(icon);\n\n    this.container.append(this.header);\n    // }\n\n    // this.container.classList.toggle('is-pinned', value);\n  }\n\n  public setParticipant(participant: GroupCallParticipant, type: GroupCallParticipantVideoType, video: HTMLVideoElement) {\n    let peerTitleElement: HTMLElement;\n    if(participant.pFlags.self) {\n      peerTitleElement = i18n('VoiceChat.Status.You');\n      peerTitleElement.classList.add('peer-title');\n    } else {\n      this.peerTitle = new PeerTitle({\n        peerId: getPeerId(participant.peer)\n      });\n\n      peerTitleElement = this.peerTitle.element;\n    }\n\n    this.groupCallParticipantMutedIcon = new GroupCallParticipantMutedIcon(false);\n    this.groupCallParticipantStatus = new GroupCallParticipantStatusElement([type]);\n\n    this.left.append(peerTitleElement, this.groupCallParticipantStatus.container);\n\n    this.right.append(this.groupCallParticipantMutedIcon.container);\n\n    video.classList.add(className, 'call-video');\n\n    if(video.paused) {\n      video.play();\n    }\n\n    const canvas = callVideoCanvasBlur(video);\n    canvas.classList.add(className + '-blur');\n\n    this.container.prepend(canvas, video);\n\n    this.updateParticipant(participant);\n  }\n\n  public updateParticipant(participant: GroupCallParticipant) {\n    const state = getGroupCallParticipantMutedState(participant);\n\n    this.groupCallParticipantMutedIcon.setState(state);\n    this.groupCallParticipantStatus.setState(state, participant);\n  }\n\n  public destroy() {\n    this.groupCallParticipantMutedIcon.destroy();\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport {attachClickEvent} from '../../helpers/dom/clickEvent';\nimport ControlsHover from '../../helpers/dom/controlsHover';\nimport findUpClassName from '../../helpers/dom/findUpClassName';\nimport ListenerSetter from '../../helpers/listenerSetter';\nimport safeAssign from '../../helpers/object/safeAssign';\nimport {GroupCallParticipant} from '../../layer';\nimport {GroupCallOutputSource} from '../../lib/appManagers/appGroupCallsManager';\nimport {AppManagers} from '../../lib/appManagers/managers';\nimport getPeerId from '../../lib/appManagers/utils/peers/getPeerId';\nimport GroupCallInstance from '../../lib/calls/groupCallInstance';\nimport rootScope from '../../lib/rootScope';\nimport GroupCallParticipantVideoElement, {GroupCallParticipantVideoType} from './participantVideo';\n\nexport default class GroupCallParticipantsVideoElement extends ControlsHover {\n  private container: HTMLDivElement;\n  private instance: GroupCallInstance;\n  private participantsElements: Map<PeerId, Map<GroupCallParticipantVideoType, GroupCallParticipantVideoElement>>;\n  private displayPinned: boolean;\n  private containers: Map<HTMLElement, GroupCallParticipantVideoElement>;\n  private onLengthChange: (length: number) => void;\n  private managers: AppManagers;\n\n  constructor(options: {\n    appendTo: HTMLElement,\n    instance: GroupCallInstance,\n    listenerSetter: ListenerSetter,\n    displayPinned: boolean,\n    onLengthChange?: GroupCallParticipantsVideoElement['onLengthChange'],\n    managers: AppManagers\n  }) {\n    super();\n    safeAssign(this, options);\n\n    const className = 'group-call-participants-video';\n    const container = this.container = document.createElement('div');\n    this.container.classList.add(className + '-container');\n\n    options.appendTo.append(container);\n\n    this.participantsElements = new Map();\n    this.containers = new Map();\n\n    const {listenerSetter} = this;\n\n    listenerSetter.add(rootScope)('group_call_participant', ({groupCallId, participant}) => {\n      if(this.instance.id === groupCallId) {\n        this.updateParticipant(participant);\n      }\n    });\n\n    listenerSetter.add(this.instance)('pinned', (source) => {\n      this.participantsElements.forEach((map) => {\n        map.forEach((element) => {\n          this.setElementDisplay(element, source);\n        });\n      });\n    });\n\n    attachClickEvent(this.container, (e) => {\n      const container = findUpClassName(e.target, 'group-call-participant-video-container');\n      if(!container) {\n        return;\n      }\n\n      const element = this.containers.get(container);\n      if(this.instance.pinnedSource === element.source) {\n        this.instance.unpinAll();\n        return;\n      }\n\n      this.instance.pinSource(element.source);\n    }, {listenerSetter});\n\n    this.setInstance(this.instance);\n\n    this.setup({\n      element: container,\n      listenerSetter: listenerSetter,\n      showOnLeaveToClassName: 'group-call-buttons'\n    });\n  }\n\n  private shouldDisplayElement(element: GroupCallParticipantVideoElement, pinnedSource: GroupCallOutputSource) {\n    return this.displayPinned ? !pinnedSource || element.source === pinnedSource : pinnedSource && element.source !== pinnedSource;\n  }\n\n  private setElementDisplay(element: GroupCallParticipantVideoElement, pinnedSource: GroupCallOutputSource) {\n    const shouldDisplay = this.shouldDisplayElement(element, pinnedSource);\n    element.container.classList.toggle('video-hidden', !shouldDisplay);\n\n    const isPinned = element.source === pinnedSource;\n    element.setPinned(isPinned);\n  }\n\n  private updateParticipant(participant: GroupCallParticipant) {\n    const peerId = getPeerId(participant.peer);\n    const types: GroupCallParticipantVideoType[] = ['video', 'presentation'];\n    const hasAnyVideo = types.some((type) => !!participant[type]);\n    let participantElements = this.participantsElements.get(peerId);\n    if(!hasAnyVideo && !participantElements) {\n      return;\n    }\n\n    if(!participantElements) {\n      this.participantsElements.set(peerId, participantElements = new Map());\n    }\n\n    types.forEach((type) => {\n      let element = participantElements.get(type);\n      const participantVideo = participant[type];\n      if(!!participantVideo === !!element) {\n        if(element) {\n          element.updateParticipant(participant);\n        }\n\n        return;\n      }\n\n      if(participantVideo) {\n        const result = this.instance.getVideoElementFromParticipantByType(participant, type);\n        if(!result) {\n          return;\n        }\n\n        const {video, source} = result;\n\n        element = new GroupCallParticipantVideoElement(this.managers, this.instance, source);\n\n        this.containers.set(element.container, element);\n\n        this.setElementDisplay(element, this.instance.pinnedSource);\n        participantElements.set(type, element);\n        element.setParticipant(participant, type, video);\n\n        this.container.prepend(element.container);\n      } else {\n        participantElements.delete(type);\n        element.container.remove();\n\n        if(!participantElements.size) {\n          this.participantsElements.delete(peerId);\n          this.containers.delete(element.container);\n          element.destroy();\n        }\n      }\n\n      this._onLengthChange();\n    });\n  }\n\n  private _onLengthChange() {\n    const length = this.container.childElementCount;\n    this.container.dataset.length = '' + length;\n    this.container.dataset.layout = length <= 2 ? '1' : (length === 3 ? '3' : '4');\n\n    this.onLengthChange && this.onLengthChange(length);\n  }\n\n  public async setInstance(instance: GroupCallInstance) {\n    (await instance.participants).forEach((participant) => {\n      this.updateParticipant(participant);\n    });\n  }\n\n  public destroy() {\n    this.containers.forEach((element) => {\n      element.destroy();\n    });\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport PopupGroupCall from '.';\nimport filterAsync from '../../helpers/array/filterAsync';\nimport contextMenuController from '../../helpers/contextMenuController';\nimport {attachContextMenuListener} from '../../helpers/dom/attachContextMenuListener';\nimport cancelEvent from '../../helpers/dom/cancelEvent';\nimport findUpClassName from '../../helpers/dom/findUpClassName';\nimport {addFullScreenListener, isFullScreen} from '../../helpers/dom/fullScreen';\nimport ListenerSetter from '../../helpers/listenerSetter';\nimport noop from '../../helpers/noop';\nimport safeAssign from '../../helpers/object/safeAssign';\nimport positionMenu from '../../helpers/positionMenu';\nimport ScrollableLoader from '../../helpers/scrollableLoader';\nimport {GroupCallParticipant} from '../../layer';\nimport type {AppChatsManager} from '../../lib/appManagers/appChatsManager';\nimport type {AppGroupCallsManager} from '../../lib/appManagers/appGroupCallsManager';\nimport appImManager from '../../lib/appManagers/appImManager';\nimport type {AppPeersManager} from '../../lib/appManagers/appPeersManager';\nimport {AppManagers} from '../../lib/appManagers/managers';\nimport getPeerId from '../../lib/appManagers/utils/peers/getPeerId';\nimport GroupCallInstance from '../../lib/calls/groupCallInstance';\nimport rootScope from '../../lib/rootScope';\nimport ButtonMenu, {ButtonMenuItemOptions} from '../buttonMenu';\nimport confirmationPopup from '../confirmationPopup';\nimport PeerTitle from '../peerTitle';\nimport PopupElement from '../popups';\nimport Scrollable from '../scrollable';\nimport GroupCallParticipantsList from './participantsList';\nimport GroupCallParticipantsVideoElement from './participantVideos';\n\nexport class GroupCallParticipantContextMenu {\n  private buttons: (ButtonMenuItemOptions & {verify: (peerId: PeerId) => boolean | Promise<boolean>})[];\n  private element: HTMLDivElement;\n  private chatId: ChatId;\n  private targetPeerId: PeerId;\n  private participant: GroupCallParticipant;\n  private instance: GroupCallInstance;\n  private canManageCall: boolean;\n  private managers: AppManagers;\n\n  constructor(options: {\n    listenerSetter: ListenerSetter,\n    onContextElement: HTMLElement,\n    managers: AppManagers,\n    instance: GroupCallInstance,\n  }) {\n    this.buttons = [{\n      icon: 'gc_microphoneoff',\n      text: 'VoiceChat.MutePeer',\n      verify: () => this.canManageCall && this.participant.pFlags.can_self_unmute,\n      onClick: () => this.toggleParticipantMuted(true)\n    }, {\n      icon: 'gc_microphone',\n      text: 'VoiceChat.UnmutePeer',\n      verify: () => this.canManageCall && !this.participant.pFlags.can_self_unmute,\n      onClick: () => this.toggleParticipantMuted(false)\n    }, {\n      icon: 'gc_microphoneoff',\n      text: 'VoiceChat.MuteForMe',\n      verify: () => !this.canManageCall && !this.participant.pFlags.muted_by_you,\n      onClick: () => this.toggleParticipantMuted(true)\n    }, {\n      icon: 'gc_microphone',\n      text: 'VoiceChat.UnmuteForMe',\n      verify: () => !this.canManageCall && this.participant.pFlags.muted_by_you,\n      onClick: () => this.toggleParticipantMuted(false)\n    }, {\n      icon: 'newprivate',\n      text: 'VoiceChat.OpenProfile',\n      verify: () => true,\n      onClick: this.onOpenProfileClick\n    }, {\n      icon: 'deleteuser danger',\n      text: 'VoiceChat.RemovePeer',\n      verify: () => this.managers.appChatsManager.hasRights(this.chatId, 'ban_users'),\n      onClick: async() => {\n        confirmationPopup({\n          peerId: this.targetPeerId,\n          title: new PeerTitle({peerId: this.targetPeerId}).element,\n          descriptionLangKey: await this.managers.appChatsManager.isBroadcast(this.chatId) ? 'VoiceChat.RemovePeer.Confirm.Channel' : 'VoiceChat.RemovePeer.Confirm',\n          descriptionLangArgs: [new PeerTitle({peerId: this.targetPeerId}).element],\n          button: {\n            langKey: 'VoiceChat.RemovePeer.Confirm.OK',\n            isDanger: true\n          }\n        }).then(() => {\n          this.managers.appChatsManager.kickFromChat(this.chatId, this.targetPeerId);\n        }, noop);\n      }\n    }];\n\n    const {listenerSetter} = options;\n    this.managers = options.managers;\n    this.instance = options.instance;\n    this.chatId = this.instance.chatId;\n\n    this.element = ButtonMenu(this.buttons, listenerSetter);\n    this.element.classList.add('group-call-participant-menu', 'night');\n\n    attachContextMenuListener(options.onContextElement, async(e: any) => {\n      const li = findUpClassName(e.target, 'group-call-participant');\n      if(!li) {\n        return;\n      }\n\n      if(this.element.parentElement !== appendTo) {\n        appendTo.append(this.element);\n      }\n\n      cancelEvent(e);\n\n      const peerId = this.targetPeerId = li.dataset.peerId.toPeerId();\n      this.participant = await this.instance.getParticipantByPeerId(peerId);\n      if(this.participant.pFlags.self) {\n        return;\n      }\n\n      this.canManageCall = await this.managers.appChatsManager.hasRights(this.chatId, 'manage_call');\n\n      await filterAsync(this.buttons, async(button) => {\n        const good = await button.verify(peerId);\n        button.element.classList.toggle('hide', !good);\n        return good;\n      });\n\n      positionMenu((e as TouchEvent).touches ? (e as TouchEvent).touches[0] : e as MouseEvent, this.element, 'right');\n      contextMenuController.openBtnMenu(this.element);\n    }, listenerSetter);\n\n    listenerSetter.add(rootScope)('group_call_participant', ({groupCallId, participant}) => {\n      if(this.instance.id === groupCallId) {\n        const peerId = getPeerId(participant.peer);\n        if(this.targetPeerId === peerId) {\n          contextMenuController.close();\n        }\n      }\n    });\n\n    let appendTo: HTMLElement = document.body;\n    addFullScreenListener(document.body, () => {\n      const isFull = isFullScreen();\n      appendTo = isFull ? PopupElement.getPopups(PopupGroupCall)[0].getContainer(): document.body;\n\n      if(!isFull) {\n        contextMenuController.close();\n      }\n    }, listenerSetter);\n  }\n\n  private onOpenProfileClick = () => {\n    const popup = PopupElement.getPopups(PopupGroupCall)[0];\n    if(popup) {\n      popup.hide();\n    }\n\n    appImManager.setInnerPeer({peerId: this.targetPeerId});\n  };\n\n  private toggleParticipantMuted = (muted: boolean) => {\n    this.instance.editParticipant(this.participant, {\n      muted\n    });\n  };\n};\n\nexport default class GroupCallParticipantsElement {\n  private container: HTMLDivElement;\n  private sortedList: GroupCallParticipantsList;\n  private instance: GroupCallInstance;\n  private listenerSetter: ListenerSetter;\n  private groupCallParticipantsVideo: GroupCallParticipantsVideoElement;\n  private contextMenu: GroupCallParticipantContextMenu;\n  private managers: AppManagers;\n\n  constructor(options: {\n    appendTo: HTMLElement,\n    instance: GroupCallInstance,\n    listenerSetter: ListenerSetter,\n    managers: AppManagers\n  }) {\n    safeAssign(this, options);\n\n    const className = 'group-call-participants';\n\n    const scrollable = new Scrollable(undefined);\n    scrollable.container.classList.add(className + '-scrollable');\n\n    const container = this.container = document.createElement('div');\n    container.classList.add(className);\n\n    // const invite = Button(`btn-primary btn-transparent ${className}-invite`, {icon: 'adduser', text: 'VoiceChat.Invite.InviteMembers'});\n\n    const sortedList = this.sortedList = new GroupCallParticipantsList(this.instance);\n\n    const {instance, listenerSetter} = this;\n    this.contextMenu = new GroupCallParticipantContextMenu({\n      ...options,\n      onContextElement: sortedList.list,\n      listenerSetter,\n      instance\n    });\n\n    this.groupCallParticipantsVideo = new GroupCallParticipantsVideoElement({\n      ...options,\n      appendTo: scrollable.container,\n      displayPinned: false\n    });\n\n    scrollable.append(/* invite,  */sortedList.list);\n    container.append(scrollable.container);\n\n    options.appendTo.append(container);\n\n    listenerSetter.add(rootScope)('group_call_participant', ({groupCallId, participant}) => {\n      if(this.instance.id === groupCallId) {\n        this.updateParticipant(participant);\n      }\n    });\n\n    const scrollableLoader = new ScrollableLoader({\n      scrollable,\n      getPromise: () => {\n        return this.managers.appGroupCallsManager.getGroupCallParticipants(this.instance.id).then(({participants, isEnd}) => {\n          participants.forEach((participant) => {\n            this.updateParticipant(participant);\n          });\n\n          return isEnd;\n        });\n      }\n    });\n\n    this.setInstance(instance);\n  }\n\n  private updateParticipant(participant: GroupCallParticipant) {\n    const peerId = getPeerId(participant.peer);\n    const has = this.sortedList.has(peerId);\n    if(participant.pFlags.left) {\n      if(has) {\n        this.sortedList.delete(peerId);\n      }\n\n      return;\n    }\n\n    if(!has) {\n      this.sortedList.add(peerId);\n      return;\n    }\n\n    this.sortedList.update(peerId);\n  }\n\n  public async setInstance(instance: GroupCallInstance) {\n    // @ts-ignore\n    /* const users = appUsersManager.users;\n    for(const userId in users) {\n      const participant: GroupCallParticipant = {\n        _: 'groupCallParticipant',\n        date: 0,\n        peer: {_: 'peerUser', user_id: userId.toPeerId()},\n        pFlags: {\n          muted: true\n        },\n        source: 1\n      };\n\n      instance.participants.set(userId.toPeerId(), participant);\n      this.updateParticipant(participant);\n    } */\n    const participants = await instance.participants;\n    participants.forEach((participant) => {\n      this.updateParticipant(participant);\n    });\n  }\n\n  public destroy() {\n    this.sortedList.destroy();\n    this.groupCallParticipantsVideo.destroy();\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport {GroupCall} from '../../layer';\nimport GroupCallInstance from '../../lib/calls/groupCallInstance';\nimport GROUP_CALL_STATE from '../../lib/calls/groupCallState';\nimport I18n, {LangPackKey, FormatterArguments} from '../../lib/langPack';\n\nexport default class GroupCallDescriptionElement {\n  private descriptionIntl: I18n.IntlElement;\n\n  constructor(private appendTo: HTMLElement) {\n    this.descriptionIntl = new I18n.IntlElement({\n      key: 'VoiceChat.Status.Connecting'\n    });\n\n    this.descriptionIntl.element.classList.add('group-call-description');\n  }\n\n  public detach() {\n    this.descriptionIntl.element.remove();\n  }\n\n  public update(instance: GroupCallInstance) {\n    const {state} = instance;\n\n    let key: LangPackKey, args: FormatterArguments;\n    if(state === GROUP_CALL_STATE.CONNECTING) {\n      key = 'VoiceChat.Status.Connecting';\n    } else {\n      key = 'VoiceChat.Status.Members';\n      args = [(instance.groupCall as GroupCall.groupCall).participants_count];\n    }\n\n    const {descriptionIntl} = this;\n    descriptionIntl.compareAndUpdate({\n      key,\n      args\n    });\n\n    if(!this.descriptionIntl.element.parentElement) {\n      this.appendTo.append(this.descriptionIntl.element);\n    }\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport setInnerHTML from '../../helpers/dom/setInnerHTML';\nimport {GroupCall} from '../../layer';\nimport GroupCallInstance from '../../lib/calls/groupCallInstance';\nimport wrapEmojiText from '../../lib/richTextProcessor/wrapEmojiText';\nimport PeerTitle from '../peerTitle';\n\nexport default class GroupCallTitleElement {\n  private peerTitle: PeerTitle;\n\n  constructor(private appendTo: HTMLElement) {\n    this.peerTitle = new PeerTitle({peerId: 0});\n  }\n\n  public update(instance: GroupCallInstance) {\n    const {peerTitle, appendTo} = this;\n    const groupCall = instance.groupCall as GroupCall.groupCall;\n    const peerId = instance.chatId.toPeerId(true);\n    if(groupCall.title) {\n      setInnerHTML(appendTo, wrapEmojiText(groupCall.title));\n    } else {\n      if(peerTitle.peerId !== peerId) {\n        peerTitle.peerId = peerId;\n        peerTitle.update();\n      }\n\n      if(peerTitle.element.parentElement !== appendTo) {\n        appendTo.append(peerTitle.element);\n      }\n    }\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport {attachClickEvent} from '../../helpers/dom/clickEvent';\nimport ListenerSetter from '../../helpers/listenerSetter';\nimport {i18n, LangPackKey} from '../../lib/langPack';\nimport ripple from '../ripple';\n\nexport default function makeButton(className: string, listenerSetter: ListenerSetter, options: {\n  text?: LangPackKey | HTMLElement,\n  isDanger?: boolean,\n  noRipple?: boolean,\n  callback?: () => void,\n  icon?: string,\n  isConfirm?: boolean,\n}) {\n  const _className = className + '-button';\n  const buttonDiv = document.createElement('div');\n  buttonDiv.classList.add(_className, 'call-button', 'rp-overflow');\n\n  if(options.icon) {\n    buttonDiv.classList.add('tgico-' + options.icon);\n  }\n\n  if(!options.noRipple) {\n    ripple(buttonDiv);\n  }\n\n  if(options.isDanger) {\n    buttonDiv.classList.add(_className + '-red');\n  }\n\n  if(options.isConfirm) {\n    buttonDiv.classList.add(_className + '-green');\n  }\n\n  if(options.callback) {\n    attachClickEvent(buttonDiv, options.callback, {listenerSetter});\n  }\n\n  let ret = buttonDiv;\n  if(options.text) {\n    const div = document.createElement('div');\n    div.classList.add(_className + '-container', 'call-button-container');\n\n    const textEl = typeof(options.text) === 'string' ? i18n(options.text) : options.text;\n    textEl.classList.add(_className + '-text', 'call-button-text');\n\n    div.append(buttonDiv, textEl);\n\n    ret = div;\n  }\n\n  return ret;\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport findUpClassName from '../helpers/dom/findUpClassName';\nimport EventListenerBase from '../helpers/eventListenerBase';\nimport mediaSizes from '../helpers/mediaSizes';\nimport clamp from '../helpers/number/clamp';\nimport safeAssign from '../helpers/object/safeAssign';\nimport windowSize from '../helpers/windowSize';\nimport SwipeHandler from './swipeHandler';\n\ntype ResizeSide = 'n' | 'e' | 's' | 'w' | 'ne' | 'se' | 'sw' | 'nw';\nexport type MovableState = {\n  top?: number;\n  left?: number;\n  width: number;\n  height: number;\n};\n\nconst className = 'movable-element';\nconst resizeHandlerClassName = className + '-resize-handler';\n\nexport type MovableElementOptions = {\n  minWidth: MovableElement['minWidth'],\n  minHeight: MovableElement['minHeight'],\n  element: MovableElement['element'],\n  verifyTouchTarget?: MovableElement['verifyTouchTarget']\n};\n\nexport default class MovableElement extends EventListenerBase<{\n  resize: () => void\n}> {\n  private minWidth: number;\n  private minHeight: number;\n  private element: HTMLElement;\n  private verifyTouchTarget: (e: TouchEvent | MouseEvent) => boolean;\n\n  private top: number;\n  private left: number;\n  private _width: number;\n  private _height: number;\n\n  private swipeHandler: SwipeHandler;\n  private handlers: HTMLElement[];\n\n  constructor(options: MovableElementOptions) {\n    super(true);\n    safeAssign(this, options);\n\n    this.top = this.left = this.width = this.height = 0;\n    this.element.classList.add(className);\n\n    this.addResizeHandlers();\n    this.setSwipeHandler();\n\n    mediaSizes.addEventListener('resize', this.onResize);\n  }\n\n  private onResize = () => {\n    this.fixDimensions();\n    this.fixPosition();\n    this.setPosition();\n  };\n\n  public destroyElements() {\n    this.element.classList.remove(className);\n\n    if(this.handlers) {\n      this.handlers.forEach((handler) => {\n        handler.remove();\n      });\n    }\n  }\n\n  public destroy() {\n    mediaSizes.removeEventListener('resize', this.onResize);\n    this.swipeHandler.removeListeners();\n  }\n\n  private addResizeHandlers() {\n    const sides: ResizeSide[] = ['n', 'e', 's', 'w', 'ne', 'se', 'sw', 'nw'];\n    this.handlers = sides.map((side) => {\n      const div = document.createElement('div');\n      div.dataset.side = side;\n      div.classList.add(resizeHandlerClassName, resizeHandlerClassName + '-side-' + side);\n      this.element.append(div);\n      return div;\n    });\n  }\n\n  private setSwipeHandler() {\n    let startTop: number, startLeft: number, startWidth: number, startHeight: number, resizingSide: ResizeSide;\n    const swipeHandler = this.swipeHandler = new SwipeHandler({\n      element: this.element,\n      onSwipe: (xDiff, yDiff, e) => {\n        xDiff *= -1; // to right will be positive\n        yDiff *= -1; // to bottom will be positive\n        // console.log(xDiff, yDiff, e);\n\n        if(resizingSide) {\n          if(resizingSide.includes('e') || resizingSide.includes('w')) {\n            const isEnlarging = resizingSide.includes('e') && xDiff > 0 || resizingSide.includes('w') && xDiff < 0;\n            const resizeDiff = Math.abs(xDiff) * (isEnlarging ? 1 : -1);\n\n            const maxPossible = resizingSide.includes('e') ? windowSize.width - startLeft : startWidth + startLeft;\n            this.width = Math.min(maxPossible, startWidth + resizeDiff);\n          }\n\n          if(resizingSide.includes('n') || resizingSide.includes('s')) {\n            const isEnlarging = resizingSide.includes('s') && yDiff > 0 || resizingSide.includes('n') && yDiff < 0;\n            const resizeDiff = Math.abs(yDiff) * (isEnlarging ? 1 : -1);\n\n            const maxPossible = resizingSide.includes('s') ? windowSize.height - startTop : startHeight + startTop;\n            this.height = Math.min(maxPossible, startHeight + resizeDiff);\n          }\n\n          this.fixDimensions();\n\n          if(resizingSide.includes('w')) {\n            this.left = Math.min(startLeft + startWidth - this.minWidth, startLeft + xDiff);\n          }\n\n          if(resizingSide.includes('n')) {\n            this.top = Math.min(startTop + startHeight - this.minHeight, startTop + yDiff);\n          }\n        } else {\n          this.top = startTop + yDiff;\n          this.left = startLeft + xDiff;\n        }\n\n        this.fixPosition();\n        this.setPosition();\n      },\n      verifyTouchTarget: (e) => {\n        const target = e.target;\n        if(this.verifyTouchTarget && !this.verifyTouchTarget(e)) {\n          return false;\n        }\n\n        const resizeHandler = findUpClassName(target, resizeHandlerClassName);\n        if(resizeHandler) {\n          resizingSide = resizeHandler.dataset.side as ResizeSide;\n          swipeHandler.setCursor('');\n        } else {\n          resizingSide = undefined;\n          swipeHandler.setCursor('grabbing');\n        }\n\n        return true;\n      },\n      onFirstSwipe: () => {\n        startTop = this.top;\n        startLeft = this.left;\n        startWidth = this.width;\n        startHeight = this.height;\n      }\n    });\n  }\n\n  public setPositionToCenter() {\n    this.top = (windowSize.height / 2) - (this.height / 2);\n    this.left = (windowSize.width / 2) - (this.width / 2);\n    this.setPosition();\n  }\n\n  private fixDimensions() {\n    this.width = clamp(this.width, this.minWidth, windowSize.width);\n    this.height = clamp(this.height, this.minHeight, windowSize.height);\n  }\n\n  private fixPosition() {\n    this.top = clamp(this.top, 0, windowSize.height - this.height);\n    this.left = clamp(this.left, 0, windowSize.width - this.width);\n  }\n\n  private setPosition() {\n    this.element.style.top = this.top + 'px';\n    this.element.style.left = this.left + 'px';\n    this.element.style.right = 'auto';\n    this.element.style.bottom = 'auto';\n    this.element.style.width = this.width + 'px';\n    this.element.style.height = this.height + 'px';\n\n    this.dispatchEvent('resize');\n  }\n\n  public get width() {\n    return this._width;\n  }\n\n  public get height() {\n    return this._height;\n  }\n\n  private set width(value: number) {\n    this._width = value;\n  }\n\n  private set height(value: number) {\n    this._height = value;\n  }\n\n  public get state(): MovableState {\n    const {top, left, width, height} = this;\n    return {\n      top,\n      left,\n      width,\n      height\n    };\n  }\n\n  public set state(state: MovableState) {\n    const {top, left, width, height} = state;\n    this.top = top;\n    this.left = left;\n    this.width = width;\n    this.height = height;\n    this.onResize();\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport MovableElement, {MovableElementOptions, MovableState} from '../components/movableElement';\nimport IS_TOUCH_SUPPORTED from '../environment/touchSupport';\nimport ListenerSetter from './listenerSetter';\nimport mediaSizes, {ScreenSize} from './mediaSizes';\nimport safeAssign from './object/safeAssign';\n\nexport default class MovablePanel {\n  #movable: MovableElement;\n  private listenerSetter: ListenerSetter;\n  private previousState: MovableState;\n  private onResize: () => void;\n  private movableOptions: MovableElementOptions;\n\n  constructor(options: {\n    listenerSetter: ListenerSetter,\n    previousState: MovableState,\n    onResize?: () => void,\n    movableOptions: MovableElementOptions\n  }) {\n    safeAssign(this, options);\n\n    this.toggleMovable(!IS_TOUCH_SUPPORTED);\n\n    this.listenerSetter.add(mediaSizes)('changeScreen', (from, to) => {\n      if(to === ScreenSize.mobile || from === ScreenSize.mobile) {\n        this.toggleMovable(!IS_TOUCH_SUPPORTED);\n      }\n    });\n  }\n\n  public destroy() {\n    const movable = this.movable;\n    if(movable) {\n      movable.destroy();\n    }\n  }\n\n  public get movable() {\n    return this.#movable;\n  }\n\n  public get state() {\n    return this.movable ? this.movable.state : this.previousState;\n  }\n\n  public set state(state: MovableState) {\n    this.previousState = state;\n  }\n\n  private toggleMovable(enabled: boolean) {\n    let {movable} = this;\n    if(enabled) {\n      if(movable) {\n        return;\n      }\n\n      movable = this.#movable = new MovableElement(this.movableOptions);\n\n      movable.state = this.previousState;\n      if(this.previousState.top === undefined) {\n        movable.setPositionToCenter();\n      }\n\n      if(this.onResize) {\n        this.listenerSetter.add(movable)('resize', this.onResize);\n      }\n    } else {\n      if(!movable) {\n        return;\n      }\n\n      this.previousState = movable.state;\n      movable.destroyElements();\n      movable.destroy();\n      this.#movable = undefined;\n    }\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nexport default function toggleClassName(className: string, elements: HTMLElement[], disable: boolean) {\n  elements.forEach((element) => {\n    element.classList.toggle(className, disable);\n  });\n\n  return () => toggleClassName(className, elements, !disable);\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport replaceContent from '../../helpers/dom/replaceContent';\nimport toHHMMSS from '../../helpers/string/toHHMMSS';\nimport CALL_STATE from '../../lib/calls/callState';\nimport {i18n, LangPackKey} from '../../lib/langPack';\n\nexport default class CallDescriptionElement {\n  private container: HTMLElement;\n  private state: CALL_STATE;\n  private interval: number;\n\n  constructor(private appendTo: HTMLElement) {\n    this.container = document.createElement('div');\n    this.container.classList.add('call-description');\n  }\n\n  public detach() {\n    if(this.interval !== undefined) {\n      clearInterval(this.interval);\n      this.interval = undefined;\n    }\n\n    this.container.remove();\n    this.state = undefined;\n  }\n\n  public update(instance: any) {\n    const {connectionState} = instance;\n\n    if(this.state === connectionState) {\n      return;\n    }\n\n    this.state = connectionState;\n\n    let element: HTMLElement;\n    if(connectionState === CALL_STATE.CONNECTED) {\n      element = document.createElement('span');\n      element.classList.add('call-description-duration');\n\n      const setTime = () => {\n        element.innerText = toHHMMSS(instance.duration, true);\n      };\n\n      this.interval = window.setInterval(setTime, 1000);\n      setTime();\n    } else {\n      let langPackKey: LangPackKey;\n      switch(connectionState) {\n        case CALL_STATE.PENDING:\n          langPackKey = instance.isOutgoing ? 'Call.StatusRinging' : 'Call.StatusCalling';\n          break;\n        case CALL_STATE.REQUESTING:\n          langPackKey = 'Call.StatusRequesting';\n          break;\n        case CALL_STATE.EXCHANGING_KEYS:\n          langPackKey = 'VoipExchangingKeys';\n          break;\n        case CALL_STATE.CLOSED:\n          langPackKey = instance.connectedAt !== undefined ? 'Call.StatusEnded' : 'Call.StatusFailed';\n          break;\n        default:\n          langPackKey = 'Call.StatusConnecting';\n          break;\n      }\n\n      element = i18n(langPackKey);\n      if(this.interval !== undefined) {\n        clearInterval(this.interval);\n        this.interval = undefined;\n      }\n    }\n\n    this.container.classList.toggle('has-duration', connectionState === CALL_STATE.CONNECTED);\n    replaceContent(this.container, element);\n\n    if(!this.container.parentElement) {\n      this.appendTo.append(this.container);\n    }\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport {SuperRLottieIcon} from '../superIcon';\n\nexport default class GroupCallMicrophoneIconMini extends SuperRLottieIcon<{\n  PartState: boolean,\n  ColorState: boolean,\n  Items: {\n    name: 'voice_mini'\n  }[]\n}> {\n  constructor(colored?: boolean, skipAnimation?: boolean) {\n    super({\n      width: 36,\n      height: 36,\n      getPart: (state) => {\n        return this.getItem().getPart(state ? 'unmute' : 'mute');\n      },\n      getColor: colored ? (state) => {\n        return state ? [255, 255, 255] : [158, 158, 158];\n      } : undefined,\n      skipAnimation\n    });\n\n    this.add({\n      name: 'voice_mini',\n      parts: [{\n        startFrame: 0,\n        endFrame: 35,\n        name: 'hand-to-muted'\n      }, {\n        startFrame: 36,\n        endFrame: 68,\n        name: 'unmute'\n      }, {\n        startFrame: 69,\n        endFrame: 98,\n        name: 'mute'\n      }, {\n        startFrame: 99,\n        endFrame: 135,\n        name: 'muted-to-hand'\n      }, {\n        startFrame: 136,\n        endFrame: 171,\n        name: 'unmuted-to-hand'\n      }]\n    });\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport IS_SCREEN_SHARING_SUPPORTED from '../../environment/screenSharingSupport';\nimport {IS_MOBILE} from '../../environment/userAgent';\nimport {attachClickEvent} from '../../helpers/dom/clickEvent';\nimport ControlsHover from '../../helpers/dom/controlsHover';\nimport findUpClassName from '../../helpers/dom/findUpClassName';\nimport {addFullScreenListener, cancelFullScreen, isFullScreen, requestFullScreen} from '../../helpers/dom/fullScreen';\nimport replaceContent from '../../helpers/dom/replaceContent';\nimport MovablePanel from '../../helpers/movablePanel';\nimport onMediaLoad from '../../helpers/onMediaLoad';\nimport themeController from '../../helpers/themeController';\nimport toggleClassName from '../../helpers/toggleClassName';\nimport CallInstance from '../../lib/calls/callInstance';\nimport CALL_STATE from '../../lib/calls/callState';\nimport I18n, {i18n} from '../../lib/langPack';\nimport wrapEmojiText from '../../lib/richTextProcessor/wrapEmojiText';\nimport animationIntersector from '../animationIntersector';\nimport AvatarElement from '../avatar';\nimport ButtonIcon from '../buttonIcon';\nimport GroupCallMicrophoneIconMini from '../groupCall/microphoneIconMini';\nimport {MovableState} from '../movableElement';\nimport PeerTitle from '../peerTitle';\nimport PopupElement from '../popups';\nimport SetTransition from '../singleTransition';\nimport makeButton from './button';\nimport CallDescriptionElement from './description';\nimport callVideoCanvasBlur from './videoCanvasBlur';\n\nconst className = 'call';\n\nconst MIN_WIDTH = 400;\nconst MIN_HEIGHT = 580;\n\nconst INIT_STATE: MovableState = {\n  width: MIN_WIDTH,\n  height: MIN_HEIGHT\n};\n\nlet previousState: MovableState = {...INIT_STATE};\n\nexport default class PopupCall extends PopupElement {\n  private peerId: PeerId;\n\n  private description: CallDescriptionElement;\n  private emojisSubtitle: HTMLElement;\n\n  private partyStates: HTMLElement;\n  private partyMutedState: HTMLElement;\n\n  private firstButtonsRow: HTMLElement;\n  private secondButtonsRow: HTMLElement;\n\n  private declineI18nElement: I18n.IntlElement;\n\n  private makeButton: (options: Parameters<typeof makeButton>[2]) => HTMLElement;\n  private btnAccept: HTMLElement;\n  private btnDecline: HTMLElement;\n  private btnVideo: HTMLElement;\n  private btnScreen: HTMLElement;\n  private btnMute: HTMLElement;\n  private btnFullScreen: HTMLButtonElement;\n  private btnExitFullScreen: HTMLButtonElement;\n\n  private movablePanel: MovablePanel;\n  private microphoneIcon: GroupCallMicrophoneIconMini;\n  private muteI18nElement: I18n.IntlElement;\n\n  private videoContainers: {\n    input?: HTMLElement,\n    output?: HTMLElement\n  };\n\n  private controlsHover: ControlsHover;\n\n  constructor(private instance: CallInstance) {\n    super('popup-call', {\n      withoutOverlay: true,\n      closable: true\n    });\n\n    this.videoContainers = {};\n\n    const {container, listenerSetter} = this;\n    container.classList.add(className, 'night');\n\n    const avatarContainer = document.createElement('div');\n    avatarContainer.classList.add(className + '-avatar');\n\n    const peerId = this.peerId = this.instance.interlocutorUserId.toPeerId();\n    const avatar = new AvatarElement();\n    avatar.classList.add('avatar-full');\n    avatar.updateWithOptions({\n      isBig: true,\n      peerId: peerId\n    });\n    avatarContainer.append(avatar);\n\n    const title = new PeerTitle({\n      peerId\n    }).element;\n\n    title.classList.add(className + '-title');\n\n    const subtitle = document.createElement('div');\n    subtitle.classList.add(className + '-subtitle');\n\n    const description = this.description = new CallDescriptionElement(subtitle);\n\n    const emojisSubtitle = this.emojisSubtitle = document.createElement('div');\n    emojisSubtitle.classList.add(className + '-emojis');\n\n    container.append(avatarContainer, title, subtitle);\n\n    if(!IS_MOBILE) {\n      this.btnFullScreen = ButtonIcon('fullscreen');\n      this.btnExitFullScreen = ButtonIcon('smallscreen hide');\n      attachClickEvent(this.btnFullScreen, this.onFullScreenClick, {listenerSetter});\n      attachClickEvent(this.btnExitFullScreen, () => cancelFullScreen(), {listenerSetter});\n      addFullScreenListener(this.container, this.onFullScreenChange, listenerSetter);\n      this.header.prepend(this.btnExitFullScreen);\n      this.header.append(this.btnFullScreen);\n\n      container.append(emojisSubtitle);\n    } else {\n      this.header.append(emojisSubtitle);\n    }\n\n    this.partyStates = document.createElement('div');\n    this.partyStates.classList.add(className + '-party-states');\n\n    this.partyMutedState = document.createElement('div');\n    this.partyMutedState.classList.add(className + '-party-state');\n    const stateText = i18n('VoipUserMicrophoneIsOff', [new PeerTitle({peerId, onlyFirstName: true, limitSymbols: 18}).element]);\n    stateText.classList.add(className + '-party-state-text');\n    const mutedIcon = new GroupCallMicrophoneIconMini(false, true);\n    mutedIcon.setState(false, false);\n    this.partyMutedState.append(\n      mutedIcon.container,\n      stateText\n    );\n\n    this.partyStates.append(this.partyMutedState);\n    this.container.append(this.partyStates);\n\n    this.makeButton = makeButton.bind(null, className, this.listenerSetter);\n    this.constructFirstButtons();\n    this.constructSecondButtons();\n\n    listenerSetter.add(instance)('state', () => {\n      this.updateInstance();\n    });\n\n    listenerSetter.add(instance)('mediaState', () => {\n      this.updateInstance();\n    });\n\n    this.movablePanel = new MovablePanel({\n      listenerSetter,\n      movableOptions: {\n        minWidth: MIN_WIDTH,\n        minHeight: MIN_HEIGHT,\n        element: this.element,\n        verifyTouchTarget: (e) => {\n          const target = e.target;\n          if(findUpClassName(target, 'call-button') ||\n            findUpClassName(target, 'btn-icon') ||\n            isFullScreen()) {\n            return false;\n          }\n\n          return true;\n        }\n      },\n      // onResize: () => this.toggleBigLayout(),\n      previousState: !this.instance.wasTryingToJoin && !this.instance.isOutgoing ? {...INIT_STATE} : previousState\n    });\n\n    const movableElement = this.movablePanel.movable;\n    if(movableElement) {\n      this.listenerSetter.add(movableElement)('resize', () => {\n        this.resizeVideoContainers();\n      });\n    }\n\n    const controlsHover = this.controlsHover = new ControlsHover();\n    controlsHover.setup({\n      element: this.container,\n      listenerSetter: this.listenerSetter,\n      showOnLeaveToClassName: 'call-buttons'\n    });\n    controlsHover.showControls(false);\n\n    this.addEventListener('close', () => {\n      const {movablePanel} = this;\n      previousState = movablePanel.state;\n\n      this.microphoneIcon.destroy();\n\n      movablePanel.destroy();\n    });\n\n    this.updateInstance();\n  }\n\n  public getCallInstance() {\n    return this.instance;\n  }\n\n  private constructFirstButtons() {\n    const buttons = this.firstButtonsRow = document.createElement('div');\n    buttons.classList.add(className + '-buttons', 'is-first');\n\n    const toggleDisability = toggleClassName.bind(null, 'btn-disabled');\n\n    const btnVideo = this.btnVideo = this.makeButton({\n      text: 'Call.Camera',\n      icon: 'videocamera_filled',\n      callback: () => {\n        const toggle = toggleDisability([btnVideo, btnScreen], true);\n        this.instance.toggleVideoSharing().finally(toggle);\n      }\n    });\n\n    const btnScreen = this.btnScreen = this.makeButton({\n      text: 'Call.Screen',\n      icon: 'sharescreen_filled',\n      callback: () => {\n        const toggle = toggleDisability([btnVideo, btnScreen], true);\n        this.instance.toggleScreenSharing().finally(toggle);\n      }\n    });\n\n    if(!IS_SCREEN_SHARING_SUPPORTED) {\n      btnScreen.classList.add('hide');\n      this.container.classList.add('no-screen');\n    }\n\n    this.muteI18nElement = new I18n.IntlElement({\n      key: 'Call.Mute'\n    });\n    const btnMute = this.btnMute = this.makeButton({\n      text: this.muteI18nElement.element,\n      callback: () => {\n        this.instance.toggleMuted();\n      }\n    });\n\n    const microphoneIcon = this.microphoneIcon = new GroupCallMicrophoneIconMini(true, true);\n    btnMute.firstElementChild.append(microphoneIcon.container);\n\n    // btnVideo.classList.add('disabled');\n    // btnScreen.classList.add('disabled');\n\n    buttons.append(btnVideo, btnScreen, btnMute);\n    this.container.append(buttons);\n  }\n\n  private constructSecondButtons() {\n    const buttons = this.secondButtonsRow = document.createElement('div');\n    buttons.classList.add(className + '-buttons', 'is-second');\n\n    this.declineI18nElement = new I18n.IntlElement({\n      key: 'Call.Decline'\n    });\n    const btnDecline = this.btnDecline = this.makeButton({\n      text: this.declineI18nElement.element,\n      icon: 'endcall_filled',\n      callback: () => {\n        this.instance.hangUp('phoneCallDiscardReasonHangup');\n      },\n      isDanger: true\n    });\n\n    const btnAccept = this.btnAccept = this.makeButton({\n      text: 'Call.Accept',\n      icon: 'phone_filled',\n      callback: () => {\n        this.instance.acceptCall();\n      },\n      isConfirm: true\n    });\n\n    buttons.append(btnDecline, btnAccept);\n    this.container.append(buttons);\n  }\n\n  private onFullScreenClick = () => {\n    requestFullScreen(this.container);\n  };\n\n  private onFullScreenChange = () => {\n    const isFull = isFullScreen();\n\n    const {btnFullScreen, btnExitFullScreen} = this;\n\n    const wasFullScreen = this.container.classList.contains('is-full-screen');\n    this.container.classList.toggle('is-full-screen', isFull);\n    btnFullScreen && btnFullScreen.classList.toggle('hide', isFull);\n    btnExitFullScreen && btnExitFullScreen.classList.toggle('hide', !isFull);\n    this.btnClose.classList.toggle('hide', isFull);\n\n    if(isFull !== wasFullScreen) {\n      animationIntersector.checkAnimations(isFull);\n\n      themeController.setThemeColor(isFull ? '#000000' : undefined);\n\n      this.resizeVideoContainers();\n    }\n  };\n\n  private createVideoContainer(video: HTMLVideoElement) {\n    const _className = className + '-video';\n    const container = document.createElement('div');\n    container.classList.add(_className + '-container');\n\n    video.classList.add(_className);\n    if(video.paused) {\n      video.play();\n    }\n\n    attachClickEvent(container, () => {\n      if(!container.classList.contains('small')) {\n        return;\n      }\n\n      const big = Object.values(this.videoContainers).find((container) => !container.classList.contains('small'));\n      big.classList.add('small');\n      big.style.cssText = container.style.cssText;\n      container.classList.remove('small');\n      container.style.cssText = '';\n\n      this.resizeVideoContainers();\n    });\n\n    const canvas = callVideoCanvasBlur(video);\n    canvas.classList.add(_className + '-blur');\n\n    container.append(canvas, video);\n\n    return container;\n  }\n\n  private updateInstance() {\n    const {instance} = this;\n    const {connectionState} = instance;\n    if(connectionState === CALL_STATE.CLOSED) {\n      if(this.container.classList.contains('is-full-screen')) {\n        cancelFullScreen();\n      }\n\n      this.btnVideo.classList.add('disabled');\n\n      this.hide();\n      return;\n    }\n\n    const isPendingIncoming = !instance.isOutgoing && connectionState === CALL_STATE.PENDING;\n    this.declineI18nElement.compareAndUpdate({\n      key: connectionState === CALL_STATE.PENDING ? 'Call.Decline' : 'Call.End'\n    });\n    this.btnAccept.classList.toggle('disable', !isPendingIncoming);\n    this.btnAccept.classList.toggle('hide-me', !isPendingIncoming);\n    this.container.classList.toggle('two-button-rows', isPendingIncoming);\n\n    const isMuted = instance.isMuted;\n    const onFrame = () => {\n      this.btnMute.firstElementChild.classList.toggle('active', isMuted);\n    };\n\n    const player = this.microphoneIcon.getItem().player;\n    this.microphoneIcon.setState(!isMuted, !isMuted, onFrame);\n    if(!player) {\n      onFrame();\n    }\n\n    this.muteI18nElement.compareAndUpdate({\n      key: isMuted ? 'VoipUnmute' : 'Call.Mute'\n    });\n\n    const isSharingVideo = instance.isSharingVideo;\n    this.btnVideo.firstElementChild.classList.toggle('active', isSharingVideo);\n\n    const isSharingScreen = instance.isSharingScreen;\n    this.btnScreen.firstElementChild.classList.toggle('active', isSharingScreen);\n\n    const outputState = instance.getMediaState('output');\n\n    SetTransition(this.partyMutedState, 'is-visible', !!outputState?.muted, 300);\n\n    const containers = this.videoContainers;\n    const oldContainers = {...containers};\n    ['input' as const, 'output' as const].forEach((type) => {\n      const mediaState = instance.getMediaState(type);\n      const video = instance.getVideoElement(type) as HTMLVideoElement;\n\n      const hasFrame = !!(video && video.videoWidth && video.videoHeight);\n      if(video && !hasFrame && !video.dataset.hasPromise) {\n        video.dataset.hasPromise = '1';\n        // container.classList.add('hide');\n        onMediaLoad(video).then(() => {\n          delete video.dataset.hasPromise;\n          this.updateInstance();\n          // this.resizeVideoContainers();\n          // container.classList.remove('hide');\n        });\n      }\n\n      const isActive = !!video && hasFrame && !!(mediaState && (mediaState.videoState === 'active' || mediaState.screencastState === 'active'));\n      let videoContainer = containers[type];\n\n      if(isActive && video && !videoContainer) {\n        videoContainer = containers[type] = this.createVideoContainer(video);\n        this.container.append(videoContainer);\n      }\n\n      if(!isActive && videoContainer) {\n        videoContainer.remove();\n        delete containers[type];\n      }\n    });\n\n    {\n      const input = containers.input;\n      const output = containers.output;\n      if(Object.keys(oldContainers).length !== Object.keys(containers).length && input) {\n        input.classList.toggle('small', !!output);\n      }\n\n      if(output && !input) {\n        output.classList.remove('small');\n      }\n    }\n\n    this.resizeVideoContainers();\n\n    this.container.classList.toggle('no-video', !Object.keys(containers).length);\n\n    if(!this.emojisSubtitle.textContent && connectionState < CALL_STATE.EXCHANGING_KEYS) {\n      Promise.resolve(instance.getEmojisFingerprint()).then((emojis) => {\n        replaceContent(this.emojisSubtitle, wrapEmojiText(emojis.join('')));\n      });\n    }\n\n    this.setDescription();\n  }\n\n  private resizeVideoContainers() {\n    Object.values(this.videoContainers).forEach((container) => {\n      const isSmall = container.classList.contains('small');\n      if(isSmall) {\n        const video = container.querySelector('video');\n        const popupWidth = this.movablePanel.state;\n        const MAX_WIDTH_PX = 240;\n        const MAX_HEIGHT_PX = 240;\n\n        const isVertical = video.videoHeight > video.videoWidth;\n        const MAX_SIZE = isVertical ? MAX_HEIGHT_PX : MAX_WIDTH_PX;\n\n        const biggestSideSize = 1 / 3 * (isFullScreen() ? 0xFFFF : (isVertical ? popupWidth.height : popupWidth.width));\n        const widthRatio = isVertical ? video.videoWidth / video.videoHeight : 1;\n        const heightRatio = isVertical ? 1 : video.videoHeight / video.videoWidth;\n        container.style.width = biggestSideSize * widthRatio + 'px';\n        container.style.height = biggestSideSize * heightRatio + 'px';\n        container.style.maxWidth = MAX_SIZE * widthRatio + 'px';\n        container.style.maxHeight = MAX_SIZE * heightRatio + 'px';\n      } else {\n        container.style.cssText = '';\n      }\n    });\n  }\n\n  private setDescription() {\n    this.description.update(this.instance);\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport cancelEvent from '../helpers/dom/cancelEvent';\nimport {attachClickEvent} from '../helpers/dom/clickEvent';\nimport ListenerSetter from '../helpers/listenerSetter';\nimport GROUP_CALL_STATE from '../lib/calls/groupCallState';\nimport rootScope from '../lib/rootScope';\nimport ButtonIcon from './buttonIcon';\nimport TopbarWeave from './topbarWeave';\nimport SetTransition from './singleTransition';\nimport PopupGroupCall from './groupCall';\nimport GroupCallDescriptionElement from './groupCall/description';\nimport GroupCallTitleElement from './groupCall/title';\nimport PopupElement from './popups';\nimport throttle from '../helpers/schedulers/throttle';\nimport GroupCallInstance from '../lib/calls/groupCallInstance';\nimport CALL_STATE from '../lib/calls/callState';\nimport replaceContent from '../helpers/dom/replaceContent';\nimport PeerTitle from './peerTitle';\nimport CallDescriptionElement from './call/description';\nimport PopupCall from './call';\nimport GroupCallMicrophoneIconMini from './groupCall/microphoneIconMini';\nimport CallInstance from '../lib/calls/callInstance';\nimport {AppManagers} from '../lib/appManagers/managers';\nimport groupCallsController from '../lib/calls/groupCallsController';\nimport StreamManager from '../lib/calls/streamManager';\nimport callsController from '../lib/calls/callsController';\n\nfunction convertCallStateToGroupState(state: CALL_STATE, isMuted: boolean) {\n  switch(state) {\n    case CALL_STATE.CLOSING:\n    case CALL_STATE.CLOSED:\n      return GROUP_CALL_STATE.CLOSED;\n    case CALL_STATE.CONNECTED:\n      return isMuted ? GROUP_CALL_STATE.MUTED : GROUP_CALL_STATE.UNMUTED;\n    default:\n      return GROUP_CALL_STATE.CONNECTING;\n  }\n}\n\nconst CLASS_NAME = 'topbar-call';\n\nexport default class TopbarCall {\n  public container: HTMLElement;\n  private listenerSetter: ListenerSetter;\n  private weave: TopbarWeave;\n  private center: HTMLDivElement;\n  private groupCallTitle: GroupCallTitleElement;\n  private groupCallDescription: GroupCallDescriptionElement;\n  private groupCallMicrophoneIconMini: GroupCallMicrophoneIconMini;\n  private callDescription: CallDescriptionElement;\n\n  private currentDescription: GroupCallDescriptionElement | CallDescriptionElement;\n\n  private instance: GroupCallInstance | any/* CallInstance */;\n  private instanceListenerSetter: ListenerSetter;\n\n  constructor(\n    private managers: AppManagers\n  ) {\n    const listenerSetter = this.listenerSetter = new ListenerSetter();\n\n    listenerSetter.add(callsController)('instance', ({instance}) => {\n      if(!this.instance) {\n        this.updateInstance(instance);\n      }\n    });\n\n    listenerSetter.add(callsController)('accepting', (instance) => {\n      if(this.instance !== instance) {\n        this.updateInstance(instance);\n      }\n    });\n\n    listenerSetter.add(groupCallsController)('instance', (instance) => {\n      this.updateInstance(instance);\n    });\n\n    listenerSetter.add(rootScope)('group_call_update', (groupCall) => {\n      const instance = groupCallsController.groupCall;\n      if(instance?.id === groupCall.id) {\n        this.updateInstance(instance);\n      }\n    });\n\n    listenerSetter.add(StreamManager.ANALYSER_LISTENER)('amplitude', ({amplitudes, type}) => {\n      const {weave} = this;\n      if(!amplitudes.length || !weave/*  || type !== 'input' */) return;\n\n      let max = 0;\n      for(let i = 0; i < amplitudes.length; ++i) {\n        const {type, value} = amplitudes[i];\n        max = value > max ? value : max;\n      }\n\n      weave.setAmplitude(max);\n    });\n  }\n\n  private onState = () => {\n    this.updateInstance(this.instance);\n  };\n\n  private clearCurrentInstance() {\n    if(!this.instance) return;\n    this.center.textContent = '';\n\n    if(this.currentDescription) {\n      this.currentDescription.detach();\n      this.currentDescription = undefined;\n    }\n\n    this.instance = undefined;\n    this.instanceListenerSetter.removeAll();\n  }\n\n  private updateInstance(instance: TopbarCall['instance']) {\n    if(this.construct) {\n      this.construct();\n      this.construct = undefined;\n    }\n\n    const isChangingInstance = this.instance !== instance;\n    if(isChangingInstance) {\n      this.clearCurrentInstance();\n\n      this.instance = instance;\n      this.instanceListenerSetter = new ListenerSetter();\n\n      this.instanceListenerSetter.add(instance as GroupCallInstance)('state', this.onState);\n\n      if(instance instanceof GroupCallInstance) {\n        this.currentDescription = this.groupCallDescription;\n      } else {\n        this.currentDescription = this.callDescription;\n        this.instanceListenerSetter.add(instance)('muted', this.onState);\n      }\n\n      this.container.classList.toggle('is-call', !(instance instanceof GroupCallInstance));\n    }\n\n    const isMuted = this.instance.isMuted;\n    const state = instance instanceof GroupCallInstance ? instance.state : convertCallStateToGroupState(instance.connectionState, isMuted);\n\n    const {weave} = this;\n\n    weave.componentDidMount();\n\n    const isClosed = state === GROUP_CALL_STATE.CLOSED;\n    if((!document.body.classList.contains('is-calling') || isChangingInstance) || isClosed) {\n      if(isClosed) {\n        weave.setAmplitude(0);\n      }\n\n      SetTransition(document.body, 'is-calling', !isClosed, 250, isClosed ? () => {\n        weave.componentWillUnmount();\n\n        this.clearCurrentInstance();\n      }: undefined);\n    }\n\n    if(isClosed) {\n      return;\n    }\n\n    weave.setCurrentState(state, true);\n    // if(state === GROUP_CALL_STATE.CONNECTING) {\n    //   weave.setCurrentState(state, true);\n    // } else {\n    //   /* var a = 0;\n    //   animate(() => {\n    //     a += 0.1;\n    //     if(a > 1) a = 0;\n    //     weave.setAmplitude(a);\n    //     return true;\n    //   });\n    //   weave.setAmplitude(1); */\n    //   weave.setCurrentState(state, true);\n    // }\n\n    this.setTitle(instance);\n    this.setDescription(instance);\n    this.groupCallMicrophoneIconMini.setState(!isMuted);\n  }\n\n  private setDescription(instance: TopbarCall['instance']) {\n    return this.currentDescription.update(instance as any);\n  }\n\n  private setTitle(instance: TopbarCall['instance']) {\n    if(instance instanceof GroupCallInstance) {\n      return this.groupCallTitle.update(instance);\n    } else {\n      replaceContent(this.center, new PeerTitle({peerId: instance.interlocutorUserId.toPeerId()}).element);\n    }\n  }\n\n  private construct() {\n    const {listenerSetter} = this;\n    const container = this.container = document.createElement('div');\n    container.classList.add('sidebar-header', CLASS_NAME + '-container');\n\n    const left = document.createElement('div');\n    left.classList.add(CLASS_NAME + '-left');\n\n    const groupCallMicrophoneIconMini = this.groupCallMicrophoneIconMini = new GroupCallMicrophoneIconMini();\n\n    const mute = ButtonIcon();\n    mute.append(groupCallMicrophoneIconMini.container);\n    left.append(mute);\n\n    const throttledMuteClick = throttle(() => {\n      this.instance.toggleMuted();\n    }, 600, true);\n\n    attachClickEvent(mute, (e) => {\n      cancelEvent(e);\n      throttledMuteClick();\n    }, {listenerSetter});\n\n    const center = this.center = document.createElement('div');\n    center.classList.add(CLASS_NAME + '-center');\n\n    this.groupCallTitle = new GroupCallTitleElement(center);\n    this.groupCallDescription = new GroupCallDescriptionElement(left);\n\n    this.callDescription = new CallDescriptionElement(left);\n\n    const right = document.createElement('div');\n    right.classList.add(CLASS_NAME + '-right');\n\n    const end = ButtonIcon('endcall_filled');\n    right.append(end);\n\n    attachClickEvent(end, (e) => {\n      cancelEvent(e);\n\n      const {instance} = this;\n      if(!instance) {\n        return;\n      }\n\n      if(instance instanceof GroupCallInstance) {\n        instance.hangUp();\n      } else {\n        instance.hangUp('phoneCallDiscardReasonHangup');\n      }\n    }, {listenerSetter});\n\n    attachClickEvent(container, () => {\n      if(this.instance instanceof GroupCallInstance) {\n        if(PopupElement.getPopups(PopupGroupCall).length) {\n          return;\n        }\n\n        new PopupGroupCall().show();\n      } else if(this.instance instanceof CallInstance) {\n        const popups = PopupElement.getPopups(PopupCall);\n        if(popups.find((popup) => popup.getCallInstance() === this.instance)) {\n          return;\n        }\n\n        new PopupCall(this.instance).show();\n      }\n    }, {listenerSetter});\n\n    container.append(left, center, right);\n\n    const weave = this.weave = new TopbarWeave();\n    const weaveContainer = weave.render(CLASS_NAME + '-weave');\n    container.prepend(weaveContainer);\n\n    document.getElementById('column-center').prepend(container);\n    weave.componentDidMount();\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport getPeerTitle from '../../components/wrappers/getPeerTitle';\nimport wrapMessageForReply from '../../components/wrappers/messageForReply';\nimport {MOUNT_CLASS_TO} from '../../config/debug';\nimport {FontFamily} from '../../config/font';\nimport {IS_MOBILE} from '../../environment/userAgent';\nimport IS_VIBRATE_SUPPORTED from '../../environment/vibrateSupport';\nimport deferredPromise, {CancellablePromise} from '../../helpers/cancellablePromise';\nimport idleController from '../../helpers/idleController';\nimport deepEqual from '../../helpers/object/deepEqual';\nimport tsNow from '../../helpers/tsNow';\nimport {Message, MessagePeerReaction, PeerNotifySettings} from '../../layer';\nimport I18n, {FormatterArguments, LangPackKey} from '../langPack';\nimport apiManagerProxy from '../mtproto/mtprotoworker';\nimport singleInstance from '../mtproto/singleInstance';\nimport webPushApiManager, {PushSubscriptionNotify} from '../mtproto/webPushApiManager';\nimport fixEmoji from '../richTextProcessor/fixEmoji';\nimport wrapPlainText from '../richTextProcessor/wrapPlainText';\nimport rootScope from '../rootScope';\nimport appImManager from './appImManager';\nimport appRuntimeManager from './appRuntimeManager';\nimport {AppManagers} from './managers';\nimport generateMessageId from './utils/messageId/generateMessageId';\nimport getPeerId from './utils/peers/getPeerId';\n\ntype MyNotification = Notification & {\n  hidden?: boolean,\n  show?: () => void,\n};\n\nexport type NotifyOptions = Partial<{\n  tag: string;\n  image: string;\n  key: string;\n  title: string;\n  message: string;\n  silent: boolean;\n  onclick: () => void;\n  noIncrement: boolean;\n}>;\n\nexport type NotificationSettings = {\n  nodesktop: boolean,\n  volume: number,\n  novibrate: boolean,\n  nopreview: boolean,\n  nopush: boolean,\n  nosound: boolean\n};\n\nexport class UiNotificationsManager {\n  private notificationsUiSupport: boolean;\n  private notificationsShown: {[key: string]: MyNotification | true} = {};\n  private notificationIndex = 0;\n  private notificationsCount = 0;\n  private soundsPlayed: {[tag: string]: number} = {};\n  private vibrateSupport = IS_VIBRATE_SUPPORTED;\n  private nextSoundAt: number;\n  private prevSoundVolume: number;\n\n  private faviconEl: HTMLLinkElement = document.head.querySelector('link[rel=\"icon\"]');\n\n  private titleBackup = document.title;\n  private titleChanged = false;\n  private titleInterval: number;\n  private prevFavicon: string;\n\n  private notifySoundEl: HTMLElement;\n\n  private stopped = false;\n\n  private topMessagesDeferred: CancellablePromise<void>;\n\n  private settings: NotificationSettings = {} as any;\n\n  private registeredDevice: any;\n  private pushInited = false;\n\n  private managers: AppManagers;\n  private setAppBadge: (contents?: any) => Promise<void>;\n\n  construct(managers: AppManagers) {\n    this.managers = managers;\n\n    navigator.vibrate = navigator.vibrate || (navigator as any).mozVibrate || (navigator as any).webkitVibrate;\n    this.setAppBadge = (navigator as any).setAppBadge && (navigator as any).setAppBadge.bind(navigator);\n    this.setAppBadge && this.setAppBadge(0);\n\n    this.notificationsUiSupport = ('Notification' in window) || ('mozNotification' in navigator);\n\n    this.notifySoundEl = document.createElement('div');\n    this.notifySoundEl.id = 'notify-sound';\n    document.body.append(this.notifySoundEl);\n\n    this.topMessagesDeferred = deferredPromise<void>();\n\n    singleInstance.addEventListener('deactivated', () => {\n      this.stop();\n    });\n\n    singleInstance.addEventListener('activated', () => {\n      if(this.stopped) {\n        this.start();\n      }\n    });\n\n    idleController.addEventListener('change', (idle) => {\n      if(this.stopped) {\n        return;\n      }\n\n      if(!idle) {\n        this.clear();\n      }\n\n      this.toggleToggler();\n    });\n\n    rootScope.addEventListener('notification_reset', (peerString) => {\n      this.soundReset(peerString);\n    });\n\n    rootScope.addEventListener('notification_cancel', (str) => {\n      this.cancel(str);\n    });\n\n    if(this.setAppBadge) {\n      rootScope.addEventListener('folder_unread', (folder) => {\n        if(folder.id === 0) {\n          this.setAppBadge(folder.unreadUnmutedPeerIds.size);\n        }\n      });\n    }\n\n    webPushApiManager.addEventListener('push_init', (tokenData) => {\n      this.pushInited = true;\n      if(!this.settings.nodesktop && !this.settings.nopush) {\n        if(tokenData) {\n          this.registerDevice(tokenData);\n        } else {\n          webPushApiManager.subscribe();\n        }\n      } else {\n        this.unregisterDevice(tokenData);\n      }\n    });\n    webPushApiManager.addEventListener('push_subscribe', (tokenData) => {\n      this.registerDevice(tokenData);\n    });\n    webPushApiManager.addEventListener('push_unsubscribe', (tokenData) => {\n      this.unregisterDevice(tokenData);\n    });\n\n    rootScope.addEventListener('dialogs_multiupdate', () => {\n      // unregisterTopMsgs()\n      this.topMessagesDeferred.resolve();\n    }, {once: true});\n\n    webPushApiManager.addEventListener('push_notification_click', (notificationData) => {\n      if(notificationData.action === 'push_settings') {\n        /* this.topMessagesDeferred.then(() => {\n          $modal.open({\n            templateUrl: templateUrl('settings_modal'),\n            controller: 'SettingsModalController',\n            windowClass: 'settings_modal_window mobile_modal',\n            backdrop: 'single'\n          })\n        }); */\n        return;\n      }\n\n      if(notificationData.action === 'mute1d') {\n        this.managers.apiManager.invokeApi('account.updateDeviceLocked', {\n          period: 86400\n        }).then(() => {\n          // var toastData = toaster.pop({\n          //   type: 'info',\n          //   body: _('push_action_mute1d_success'),\n          //   bodyOutputType: 'trustedHtml',\n          //   clickHandler: () => {\n          //     toaster.clear(toastData)\n          //   },\n          //   showCloseButton: false\n          // })\n        });\n\n        return;\n      }\n\n      const peerId = notificationData.custom && notificationData.custom.peerId.toPeerId();\n      console.log('click', notificationData, peerId);\n      if(peerId) {\n        this.topMessagesDeferred.then(async() => {\n          if(notificationData.custom.channel_id &&\n              !(await this.managers.appChatsManager.hasChat(notificationData.custom.channel_id))) {\n            return;\n          }\n\n          if(peerId.isUser() && !(await this.managers.appUsersManager.hasUser(peerId))) {\n            return;\n          }\n\n          appImManager.setInnerPeer({\n            peerId,\n            lastMsgId: generateMessageId(+notificationData.custom.msg_id)\n          });\n        });\n      }\n    });\n  }\n\n  public async buildNotification({message, fwdCount, peerReaction, peerTypeNotifySettings}: {\n    message: Message.message | Message.messageService,\n    fwdCount?: number,\n    peerReaction?: MessagePeerReaction,\n    peerTypeNotifySettings?: PeerNotifySettings\n  }) {\n    const peerId = message.peerId;\n    const isAnyChat = peerId.isAnyChat();\n    const notification: NotifyOptions = {};\n    const peerString = await this.managers.appPeersManager.getPeerString(peerId);\n    let notificationMessage: string;\n\n    if(peerTypeNotifySettings.show_previews) {\n      if(message._ === 'message' && message.fwd_from && fwdCount > 1) {\n        notificationMessage = I18n.format('Notifications.Forwarded', true, [fwdCount]);\n      } else {\n        notificationMessage = await wrapMessageForReply(message, undefined, undefined, true);\n\n        if(peerReaction) {\n          const langPackKey: LangPackKey = /* isAnyChat ? 'Notification.Group.Reacted' :  */'Notification.Contact.Reacted';\n          const args: FormatterArguments = [\n            fixEmoji(peerReaction.reaction), // can be plain heart\n            notificationMessage\n          ];\n\n          /* if(isAnyChat) {\n            args.unshift(appPeersManager.getPeerTitle(message.fromId, true));\n          } */\n\n          notificationMessage = I18n.format(langPackKey, true, args);\n        }\n      }\n    } else {\n      notificationMessage = I18n.format('Notifications.New', true);\n    }\n\n    if(peerReaction) {\n      notification.noIncrement = true;\n      notification.silent = true;\n    }\n\n    const notificationFromPeerId = peerReaction ? getPeerId(peerReaction.peer_id) : message.fromId;\n    notification.title = await getPeerTitle(peerId, true, undefined, undefined, this.managers);\n    if(isAnyChat && notificationFromPeerId !== message.peerId) {\n      notification.title = await getPeerTitle(notificationFromPeerId, true, undefined, undefined, this.managers) +\n        ' @ ' +\n        notification.title;\n    }\n\n    notification.title = wrapPlainText(notification.title);\n\n    notification.onclick = () => {\n      appImManager.setInnerPeer({peerId, lastMsgId: message.mid});\n    };\n\n    notification.message = notificationMessage;\n    notification.key = 'msg' + message.mid;\n    notification.tag = peerString;\n    notification.silent = true;// message.pFlags.silent || false;\n\n    const peerPhoto = await this.managers.appPeersManager.getPeerPhoto(peerId);\n    if(peerPhoto) {\n      this.managers.appAvatarsManager.loadAvatar(peerId, peerPhoto, 'photo_small').then((url) => {\n        // ! WARNING, message can be already read\n        if(message.pFlags.unread || peerReaction) {\n          notification.image = url;\n          this.notify(notification);\n        }\n      });\n    } else {\n      this.notify(notification);\n    }\n  }\n\n  private toggleToggler(enable = idleController.isIdle) {\n    if(IS_MOBILE) return;\n\n    const resetTitle = (isBlink?: boolean) => {\n      this.titleChanged = false;\n      document.title = this.titleBackup;\n      this.setFavicon();\n    };\n\n    window.clearInterval(this.titleInterval);\n    this.titleInterval = 0;\n\n    if(!enable) {\n      resetTitle();\n    } else {\n      this.titleInterval = window.setInterval(() => {\n        const count = this.notificationsCount;\n        if(!count) {\n          this.toggleToggler(false);\n        } else if(this.titleChanged) {\n          resetTitle(true);\n        } else {\n          this.titleChanged = true;\n          document.title = I18n.format('Notifications.Count', true, [count]);\n          // this.setFavicon('assets/img/favicon_unread.ico');\n\n          // fetch('assets/img/favicon.ico')\n          // .then((res) => res.blob())\n          // .then((blob) => {\n          // const img = document.createElement('img');\n          // img.src = URL.createObjectURL(blob);\n\n          const canvas = document.createElement('canvas');\n          canvas.width = 32 * window.devicePixelRatio;\n          canvas.height = canvas.width;\n\n          const ctx = canvas.getContext('2d');\n          ctx.beginPath();\n          ctx.arc(canvas.width / 2, canvas.height / 2, canvas.width / 2, 0, 2 * Math.PI, false);\n          ctx.fillStyle = '#3390ec';\n          ctx.fill();\n\n          let fontSize = 24;\n          let str = '' + count;\n          if(count < 10) {\n            fontSize = 22;\n          } else if(count < 100) {\n            fontSize = 20;\n          } else {\n            str = '99+';\n            fontSize = 16;\n          }\n\n          fontSize *= window.devicePixelRatio;\n\n          ctx.font = `700 ${fontSize}px ${FontFamily}`;\n          ctx.textBaseline = 'middle';\n          ctx.textAlign = 'center';\n          ctx.fillStyle = 'white';\n          ctx.fillText(str, canvas.width / 2, canvas.height * .5625);\n\n          /* const ctx = canvas.getContext('2d');\n            ctx.drawImage(img, 0, 0, canvas.width, canvas.height); */\n\n          this.setFavicon(canvas.toDataURL());\n          // });\n        }\n      }, 1000);\n    }\n  }\n\n  private setFavicon(href: string = 'assets/img/favicon.ico') {\n    if(this.prevFavicon === href) {\n      return;\n    }\n\n    const link = this.faviconEl.cloneNode() as HTMLLinkElement;\n    link.href = href;\n    this.faviconEl.parentNode.replaceChild(link, this.faviconEl);\n    this.faviconEl = link;\n\n    this.prevFavicon = href;\n  }\n\n  public notify(data: NotifyOptions) {\n    // console.log('notify', data, rootScope.idle.isIDLE, this.notificationsUiSupport, this.stopped);\n\n    if(this.stopped) {\n      return;\n    }\n\n    // FFOS Notification blob src bug workaround\n    /* if(Config.Navigator.ffos && !Config.Navigator.ffos2p) {\n      data.image = 'https://telegram.org/img/t_logo.png'\n    }\n    else if (data.image && !angular.isString(data.image)) {\n      if (Config.Navigator.ffos2p) {\n        FileManager.getDataUrl(data.image, 'image/jpeg').then(function (url) {\n          data.image = url\n          notify(data)\n        })\n        return false\n      } else {\n        data.image = FileManager.getUrl(data.image, 'image/jpeg')\n      }\n    }\n    else */ if(!data.image) {\n      data.image = 'assets/img/logo_filled_rounded.png';\n    }\n    // console.log('notify image', data.image)\n\n    if(!data.noIncrement) {\n      ++this.notificationsCount;\n    }\n\n    if(!this.titleInterval) {\n      this.toggleToggler();\n    }\n\n    const idx = ++this.notificationIndex;\n    const key = data.key || 'k' + idx;\n    this.notificationsShown[key] = true;\n\n    const now = tsNow();\n    if(this.settings.volume > 0 && !this.settings.nosound/* &&\n      (\n        !data.tag ||\n        !this.soundsPlayed[data.tag] ||\n        now > this.soundsPlayed[data.tag] + 60000\n      ) */\n    ) {\n      this.testSound(this.settings.volume);\n      this.soundsPlayed[data.tag] = now;\n    }\n\n    if(!this.notificationsUiSupport ||\n      'Notification' in window && Notification.permission !== 'granted') {\n      return false;\n    }\n\n    if(this.settings.nodesktop) {\n      if(this.vibrateSupport && !this.settings.novibrate) {\n        navigator.vibrate([200, 100, 200]);\n        return;\n      }\n\n      return;\n    }\n\n    let notification: MyNotification;\n\n    if('Notification' in window) {\n      try {\n        if(data.tag) {\n          for(const i in this.notificationsShown) {\n            const notification = this.notificationsShown[i];\n            if(typeof(notification) !== 'boolean' && notification.tag === data.tag) {\n              notification.hidden = true;\n            }\n          }\n        }\n\n        notification = new Notification(data.title, {\n          icon: data.image || '',\n          body: data.message || '',\n          tag: data.tag || '',\n          silent: data.silent || false\n        });\n\n        // console.log('notify constructed notification');\n      } catch(e) {\n        this.notificationsUiSupport = false;\n        webPushApiManager.setLocalNotificationsDisabled();\n        return;\n      }\n    } /* else if('mozNotification' in navigator) {\n      notification = navigator.mozNotification.createNotification(data.title, data.message || '', data.image || '')\n    } else if(notificationsMsSiteMode) {\n      window.external.msSiteModeClearIconOverlay()\n      window.external.msSiteModeSetIconOverlay('img/icons/icon16.png', data.title)\n      window.external.msSiteModeActivate()\n      notification = {\n        index: idx\n      }\n    } */ else {\n      return;\n    }\n\n    notification.onclick = () => {\n      notification.close();\n      appRuntimeManager.focus();\n      this.clear();\n      if(data.onclick) {\n        data.onclick();\n      }\n    };\n\n    notification.onclose = () => {\n      if(!notification.hidden) {\n        delete this.notificationsShown[key];\n        this.clear();\n      }\n    };\n\n    if(notification.show) {\n      notification.show();\n    }\n    this.notificationsShown[key] = notification;\n\n    if(!IS_MOBILE) {\n      setTimeout(() => {\n        this.hide(key);\n      }, 8000);\n    }\n  }\n\n  public updateLocalSettings = () => {\n    const keys = ['notify_nodesktop', 'notify_volume', 'notify_novibrate', 'notify_nopreview', 'notify_nopush'];\n    const promises = keys.map(() => undefined);\n    // const promises = keys.map((k) => stateStorage.get(k as any));\n    Promise.all(promises)\n    .then((updSettings) => {\n      this.settings.nodesktop = updSettings[0];\n      this.settings.volume = updSettings[1] === undefined ? 0.5 : updSettings[1];\n      this.settings.novibrate = updSettings[2];\n      this.settings.nopreview = updSettings[3];\n      this.settings.nopush = updSettings[4];\n\n      if(this.pushInited) {\n        const needPush = !this.settings.nopush && !this.settings.nodesktop && webPushApiManager.isAvailable || false;\n        const hasPush = this.registeredDevice !== false;\n        if(needPush !== hasPush) {\n          if(needPush) {\n            webPushApiManager.subscribe();\n          } else {\n            webPushApiManager.unsubscribe();\n          }\n        }\n      }\n\n      webPushApiManager.setSettings(this.settings);\n    });\n\n    apiManagerProxy.getState().then((state) => {\n      this.settings.nosound = !state.settings.notifications.sound;\n    });\n  }\n\n  public getLocalSettings() {\n    return this.settings;\n  }\n\n  private hide(key: string) {\n    const notification = this.notificationsShown[key];\n    if(notification && typeof(notification) !== 'boolean') {\n      try {\n        if(notification.close) {\n          notification.hidden = true;\n          notification.close();\n        }\n      } catch(e) {}\n    }\n  }\n\n  public soundReset(tag: string) {\n    delete this.soundsPlayed[tag];\n  }\n\n  private requestPermission = () => {\n    Notification.requestPermission();\n    window.removeEventListener('click', this.requestPermission);\n  };\n\n  public testSound(volume: number) {\n    const now = tsNow();\n    if(this.nextSoundAt && now < this.nextSoundAt && this.prevSoundVolume === volume) {\n      return;\n    }\n\n    this.nextSoundAt = now + 1000;\n    this.prevSoundVolume = volume;\n    const filename = 'assets/audio/notification.mp3';\n    const audio = document.createElement('audio');\n    audio.autoplay = true;\n    audio.setAttribute('mozaudiochannel', 'notification');\n    audio.volume = volume;\n    audio.innerHTML = `\n      <source src=\"${filename}\" type=\"audio/mpeg\" />\n      <embed hidden=\"true\" autostart=\"true\" loop=\"false\" volume=\"${volume * 100}\" src=\"${filename}\" />\n    `;\n    this.notifySoundEl.append(audio);\n\n    audio.addEventListener('ended', () => {\n      audio.remove();\n    }, {once: true});\n  }\n\n  public cancel(key: string) {\n    const notification = this.notificationsShown[key];\n    if(notification) {\n      if(this.notificationsCount > 0) {\n        --this.notificationsCount;\n      }\n\n      try {\n        if(typeof(notification) !== 'boolean' && notification.close) {\n          notification.hidden = true;\n          notification.close();\n        }/*  else if(notificationsMsSiteMode &&\n          notification.index === notificationIndex) {\n          window.external.msSiteModeClearIconOverlay()\n        } */\n      } catch(e) {}\n\n      delete this.notificationsShown[key];\n    }\n  }\n\n  public clear() {\n    /* if(notificationsMsSiteMode) {\n      window.external.msSiteModeClearIconOverlay()\n    } else { */\n    for(const i in this.notificationsShown) {\n      const notification = this.notificationsShown[i];\n      try {\n        if(typeof(notification) !== 'boolean' && notification.close) {\n          notification.close();\n        }\n      } catch(e) {}\n    }\n    /* } */\n    this.notificationsShown = {};\n    this.notificationsCount = 0;\n\n    webPushApiManager.hidePushNotifications();\n  }\n\n  public start() {\n    this.updateLocalSettings();\n    rootScope.addEventListener('settings_updated', this.updateLocalSettings);\n    webPushApiManager.start();\n\n    if(!this.notificationsUiSupport) {\n      return false;\n    }\n\n    if('Notification' in window && Notification.permission !== 'granted' && Notification.permission !== 'denied') {\n      window.addEventListener('click', this.requestPermission);\n    }\n\n    try {\n      if('onbeforeunload' in window) {\n        window.addEventListener('beforeunload', this.clear);\n      }\n    } catch(e) {}\n  }\n\n  private stop() {\n    this.clear();\n    window.clearInterval(this.titleInterval);\n    this.titleInterval = 0;\n    this.setFavicon();\n    this.stopped = true;\n  }\n\n  private registerDevice(tokenData: PushSubscriptionNotify) {\n    if(this.registeredDevice && deepEqual(this.registeredDevice, tokenData)) {\n      return false;\n    }\n\n    this.managers.apiManager.invokeApi('account.registerDevice', {\n      token_type: tokenData.tokenType,\n      token: tokenData.tokenValue,\n      other_uids: [],\n      app_sandbox: false,\n      secret: new Uint8Array()\n    }).then(() => {\n      this.registeredDevice = tokenData;\n    }, (error) => {\n      error.handled = true;\n    });\n  }\n\n  private unregisterDevice(tokenData: PushSubscriptionNotify) {\n    if(!this.registeredDevice) {\n      return false;\n    }\n\n    this.managers.apiManager.invokeApi('account.unregisterDevice', {\n      token_type: tokenData.tokenType,\n      token: tokenData.tokenValue,\n      other_uids: []\n    }).then(() => {\n      this.registeredDevice = false;\n    }, (error) => {\n      error.handled = true;\n    });\n  }\n}\n\nconst uiNotificationsManager = new UiNotificationsManager();\nMOUNT_CLASS_TO && (MOUNT_CLASS_TO.uiNotificationsManager = uiNotificationsManager);\nexport default uiNotificationsManager;\n","export default async function getFilesFromEvent(e: ClipboardEvent | DragEvent, onlyTypes = false): Promise<any[]> {\n  const files: any[] = [];\n\n  const scanFiles = async(entry: any, item: DataTransferItem) => {\n    if(entry.isDirectory) {\n      const directoryReader = entry.createReader();\n      await new Promise<void>((resolve, reject) => {\n        directoryReader.readEntries(async(entries: any) => {\n          for(const entry of entries) {\n            await scanFiles(entry, item);\n          }\n\n          resolve();\n        });\n      });\n    } else if(entry) {\n      if(onlyTypes) {\n        files.push(entry.type);\n      } else {\n        const itemFile = item.getAsFile(); // * Safari can't handle entry.file with pasting\n        const file = entry instanceof File ?\n          entry :\n          (\n            entry instanceof DataTransferItem ?\n              entry.getAsFile() :\n              await new Promise((resolve, reject) => entry.file(resolve, (err: any) => resolve(itemFile)))\n          );\n\n        /* if(!onlyTypes) {\n          console.log('getFilesFromEvent: got file', item, file);\n        } */\n\n        if(!file) return;\n        files.push(file);\n      }\n    }\n  };\n\n  if(e instanceof DragEvent && e.dataTransfer.files && !e.dataTransfer.items) {\n    for(let i = 0; i < e.dataTransfer.files.length; i++) {\n      const file = e.dataTransfer.files[i];\n      files.push(onlyTypes ? file.type : file);\n    }\n  } else {\n    // @ts-ignore\n    const items = (e.dataTransfer || e.clipboardData || e.originalEvent.clipboardData).items;\n\n    const promises: Promise<any>[] = [];\n    for(let i = 0; i < items.length; ++i) {\n      const item: DataTransferItem = items[i];\n      if(item.kind === 'file') {\n        const entry = (onlyTypes ? item : item.webkitGetAsEntry()) || item.getAsFile();\n        promises.push(scanFiles(entry, item));\n      }\n    }\n\n    await Promise.all(promises);\n  }\n\n  /* if(!onlyTypes) {\n    console.log('getFilesFromEvent: got files:', e, files);\n  } */\n\n  return files;\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport animationIntersector, {AnimationItemGroup} from '../../components/animationIntersector';\nimport appSidebarLeft, {LEFT_COLUMN_ACTIVE_CLASSNAME} from '../../components/sidebarLeft';\nimport appSidebarRight, {RIGHT_COLUMN_ACTIVE_CLASSNAME} from '../../components/sidebarRight';\nimport mediaSizes, {ScreenSize} from '../../helpers/mediaSizes';\nimport {logger, LogTypes} from '../logger';\nimport rootScope from '../rootScope';\nimport Chat, {ChatType} from '../../components/chat/chat';\nimport PopupNewMedia, {getCurrentNewMediaPopup} from '../../components/popups/newMedia';\nimport MarkupTooltip from '../../components/chat/markupTooltip';\nimport IS_TOUCH_SUPPORTED from '../../environment/touchSupport';\nimport SetTransition from '../../components/singleTransition';\nimport ChatDragAndDrop from '../../components/chat/dragAndDrop';\nimport {doubleRaf} from '../../helpers/schedulers';\nimport lottieLoader from '../rlottie/lottieLoader';\nimport useHeavyAnimationCheck, {dispatchHeavyAnimationEvent} from '../../hooks/useHeavyAnimationCheck';\nimport stateStorage from '../stateStorage';\nimport {MOUNT_CLASS_TO} from '../../config/debug';\nimport appNavigationController from '../../components/appNavigationController';\nimport AppPrivateSearchTab from '../../components/sidebarRight/tabs/search';\nimport I18n, {i18n, join, LangPackKey} from '../langPack';\nimport {ChatFull, ChatInvite, ChatParticipant, ChatParticipants, Message, MessageAction, MessageMedia, SendMessageAction} from '../../layer';\nimport PeerTitle from '../../components/peerTitle';\nimport PopupPeer from '../../components/popups/peer';\nimport blurActiveElement from '../../helpers/dom/blurActiveElement';\nimport cancelEvent from '../../helpers/dom/cancelEvent';\nimport disableTransition from '../../helpers/dom/disableTransition';\nimport placeCaretAtEnd from '../../helpers/dom/placeCaretAtEnd';\nimport replaceContent from '../../helpers/dom/replaceContent';\nimport whichChild from '../../helpers/dom/whichChild';\nimport PopupElement from '../../components/popups';\nimport singleInstance, {InstanceDeactivateReason, SingleInstance} from '../mtproto/singleInstance';\nimport PopupStickers from '../../components/popups/stickers';\nimport PopupJoinChatInvite from '../../components/popups/joinChatInvite';\nimport {toast, toastNew} from '../../components/toast';\nimport debounce from '../../helpers/schedulers/debounce';\nimport pause from '../../helpers/schedulers/pause';\nimport {InternalLink, InternalLinkTypeMap, INTERNAL_LINK_TYPE} from './internalLink';\nimport MEDIA_MIME_TYPES_SUPPORTED from '../../environment/mediaMimeTypesSupport';\nimport {NULL_PEER_ID} from '../mtproto/mtproto_config';\nimport telegramMeWebManager from '../mtproto/telegramMeWebManager';\nimport {ONE_DAY} from '../../helpers/date';\nimport type {GroupCallId, MyGroupCall} from './appGroupCallsManager';\nimport TopbarCall from '../../components/topbarCall';\nimport confirmationPopup from '../../components/confirmationPopup';\nimport IS_GROUP_CALL_SUPPORTED from '../../environment/groupCallSupport';\nimport IS_CALL_SUPPORTED from '../../environment/callSupport';\nimport {CallType} from '../calls/types';\nimport {Awaited, Modify, SendMessageEmojiInteractionData} from '../../types';\nimport htmlToSpan from '../../helpers/dom/htmlToSpan';\nimport getVisibleRect from '../../helpers/dom/getVisibleRect';\nimport {attachClickEvent, simulateClickEvent} from '../../helpers/dom/clickEvent';\nimport PopupCall from '../../components/call';\nimport copy from '../../helpers/object/copy';\nimport getObjectKeysAndSort from '../../helpers/object/getObjectKeysAndSort';\nimport type GroupCallInstance from '../calls/groupCallInstance';\nimport type CallInstance from '../calls/callInstance';\nimport numberThousandSplitter from '../../helpers/number/numberThousandSplitter';\nimport ChatBackgroundPatternRenderer from '../../components/chat/patternRenderer';\nimport {IS_FIREFOX} from '../../environment/userAgent';\nimport compareVersion from '../../helpers/compareVersion';\nimport {AppManagers} from './managers';\nimport uiNotificationsManager from './uiNotificationsManager';\nimport appMediaPlaybackController from '../../components/appMediaPlaybackController';\nimport {PHONE_NUMBER_REG_EXP} from '../richTextProcessor';\nimport wrapEmojiText from '../richTextProcessor/wrapEmojiText';\nimport wrapRichText from '../richTextProcessor/wrapRichText';\nimport wrapUrl from '../richTextProcessor/wrapUrl';\nimport generateMessageId from './utils/messageId/generateMessageId';\nimport getUserStatusString from '../../components/wrappers/getUserStatusString';\nimport getChatMembersString from '../../components/wrappers/getChatMembersString';\nimport {STATE_INIT} from '../../config/state';\nimport CacheStorageController from '../files/cacheStorage';\nimport themeController from '../../helpers/themeController';\nimport overlayCounter from '../../helpers/overlayCounter';\nimport appDialogsManager from './appDialogsManager';\nimport idleController from '../../helpers/idleController';\nimport EventListenerBase from '../../helpers/eventListenerBase';\nimport {AckedResult} from '../mtproto/superMessagePort';\nimport groupCallsController from '../calls/groupCallsController';\nimport callsController from '../calls/callsController';\nimport getFilesFromEvent from '../../helpers/files/getFilesFromEvent';\nimport apiManagerProxy from '../mtproto/mtprotoworker';\nimport appRuntimeManager from './appRuntimeManager';\nimport paymentsWrapCurrencyAmount from '../../helpers/paymentsWrapCurrencyAmount';\nimport findUpClassName from '../../helpers/dom/findUpClassName';\nimport {CLICK_EVENT_NAME} from '../../helpers/dom/clickEvent';\nimport PopupPayment from '../../components/popups/payment';\n\nexport const CHAT_ANIMATION_GROUP: AnimationItemGroup = 'chat';\n\nexport type ChatSavedPosition = {\n  mids: number[],\n  top: number\n};\n\nexport type ChatSetPeerOptions = {\n  peerId?: PeerId,\n  lastMsgId?: number,\n  threadId?: number,\n  startParam?: string\n};\n\nexport type ChatSetInnerPeerOptions = Modify<ChatSetPeerOptions, {\n  peerId: PeerId\n}> & {\n  type?: ChatType\n};\n\nexport class AppImManager extends EventListenerBase<{\n  chat_changing: (details: {from: Chat, to: Chat}) => void,\n  peer_changed: (peerId: PeerId) => void,\n  peer_changing: (chat: Chat) => void,\n}> {\n  public columnEl = document.getElementById('column-center') as HTMLDivElement;\n  public chatsContainer: HTMLElement;\n\n  public offline = false;\n  public updateStatusInterval = 0;\n\n  public log: ReturnType<typeof logger>;\n\n  public setPeerPromise: Promise<void> = null;\n\n  public tabId = -1;\n\n  public chats: Chat[] = [];\n  private prevTab: HTMLElement;\n  private chatsSelectTabDebounced: () => void;\n\n  public markupTooltip: MarkupTooltip;\n  private backgroundPromises: {[slug: string]: Promise<string>};\n\n  private topbarCall: TopbarCall;\n  public emojiAnimationContainer: HTMLDivElement;\n\n  private lastBackgroundUrl: string;\n\n  public managers: AppManagers;\n\n  public cacheStorage = new CacheStorageController('cachedFiles');\n\n  get myId() {\n    return rootScope.myId;\n  }\n\n  get chat(): Chat {\n    return this.chats[this.chats.length - 1];\n  }\n\n  public construct(managers: AppManagers) {\n    this.managers = managers;\n\n    const {\n      apiUpdatesManager\n    } = managers;\n    apiUpdatesManager.attach(I18n.lastRequestedLangCode);\n\n    appMediaPlaybackController.construct(managers);\n    uiNotificationsManager.construct(managers);\n    uiNotificationsManager.start();\n\n    this.log = logger('IM', LogTypes.Log | LogTypes.Warn | LogTypes.Debug | LogTypes.Error);\n\n    this.backgroundPromises = {};\n    STATE_INIT.settings.themes.forEach((theme) => {\n      if(theme.background.slug) {\n        const url = 'assets/img/' + theme.background.slug + '.svg' + (IS_FIREFOX ? '?1' : '');\n        this.backgroundPromises[theme.background.slug] = Promise.resolve(url);\n      }\n    });\n\n    this.selectTab(0);\n\n    idleController.addEventListener('change', (idle) => {\n      this.offline = idle;\n      this.updateStatus();\n      if(idle) {\n        clearInterval(this.updateStatusInterval);\n      } else {\n        this.updateStatusInterval = window.setInterval(() => this.updateStatus(), 50e3);\n      }\n    });\n\n    this.chatsContainer = document.createElement('div');\n    this.chatsContainer.classList.add('chats-container', 'tabs-container');\n    this.chatsContainer.dataset.animation = 'navigation';\n\n    this.emojiAnimationContainer = document.createElement('div');\n    this.emojiAnimationContainer.classList.add('emoji-animation-container');\n    this.appendEmojiAnimationContainer(mediaSizes.activeScreen);\n\n    this.columnEl.append(this.chatsContainer);\n\n    this.createNewChat();\n    this.chatsSelectTab(this.chat.container);\n\n    appNavigationController.onHashChange = this.onHashChange;\n    // window.addEventListener('hashchange', this.onHashChange);\n\n    this.setSettings();\n    rootScope.addEventListener('settings_updated', this.setSettings);\n\n    const onPremiumToggle = (isPremium: boolean) => {\n      document.body.classList.toggle('is-premium', isPremium);\n    };\n    rootScope.addEventListener('premium_toggle', onPremiumToggle);\n    onPremiumToggle(rootScope.premium);\n\n    useHeavyAnimationCheck(() => {\n      animationIntersector.setOnlyOnePlayableGroup('lock');\n      animationIntersector.checkAnimations(true);\n    }, () => {\n      animationIntersector.setOnlyOnePlayableGroup();\n      animationIntersector.checkAnimations(false);\n    });\n\n    if(IS_FIREFOX && apiManagerProxy.oldVersion && compareVersion(apiManagerProxy.oldVersion, '1.4.3') === -1) {\n      this.deleteFilesIterative((response) => {\n        return response.headers.get('Content-Type') === 'image/svg+xml';\n      }).then(() => {\n        this.applyCurrentTheme();\n      });\n    } else {\n      this.applyCurrentTheme();\n    }\n\n    // * fix simultaneous opened both sidebars, can happen when floating sidebar is opened with left sidebar\n    mediaSizes.addEventListener('changeScreen', (from, to) => {\n      if(document.body.classList.contains(LEFT_COLUMN_ACTIVE_CLASSNAME) &&\n        document.body.classList.contains(RIGHT_COLUMN_ACTIVE_CLASSNAME)) {\n        appSidebarRight.toggleSidebar(false);\n      }\n\n      this.appendEmojiAnimationContainer(to);\n    });\n\n    mediaSizes.addEventListener('resize', () => {\n      // const perf = performance.now();\n      const rect = this.chatsContainer.getBoundingClientRect();\n      ChatBackgroundPatternRenderer.resizeInstances(rect.width, rect.height).then(() => {\n        // this.log.warn('resize bg time:', performance.now() - perf);\n        // for(const chat of this.chats) {\n        //   if(chat.renderDarkPattern) {\n        //     chat.renderDarkPattern();\n        //   }\n        // }\n      });\n    });\n\n    this.addEventListener('peer_changing', (chat) => {\n      this.saveChatPosition(chat);\n    });\n\n    rootScope.addEventListener('theme_change', () => {\n      this.applyCurrentTheme();\n    });\n\n    rootScope.addEventListener('choosing_sticker', (choosing) => {\n      this.setChoosingStickerTyping(!choosing);\n    });\n\n    rootScope.addEventListener('peer_typings', ({peerId, typings}) => {\n      const chat = this.chat;\n      if(\n        !chat ||\n        chat.peerId !== peerId ||\n        overlayCounter.isOverlayActive || (\n          mediaSizes.activeScreen === ScreenSize.mobile &&\n          this.tabId !== 1\n        )\n      ) {\n        return;\n      }\n\n      const typing = typings.find((typing) => typing.action._ === 'sendMessageEmojiInteraction');\n      if(typing?.action?._ === 'sendMessageEmojiInteraction') {\n        const action = typing.action;\n        const bubble = chat.bubbles.bubbles[generateMessageId(typing.action.msg_id)];\n        if(bubble && bubble.classList.contains('emoji-big') && getVisibleRect(bubble, chat.bubbles.scrollable.container)) {\n          const stickerWrapper: HTMLElement = bubble.querySelector('.media-sticker-wrapper:not(.bubble-hover-reaction-sticker):not(.reaction-sticker)');\n\n          const data: SendMessageEmojiInteractionData = JSON.parse(action.interaction.data);\n          data.a.forEach((a) => {\n            setTimeout(() => {\n              simulateClickEvent(stickerWrapper);\n            }, a.t * 1000);\n          });\n\n          this.managers.appMessagesManager.setTyping(peerId, {\n            _: 'sendMessageEmojiInteractionSeen',\n            emoticon: action.emoticon\n          });\n        }\n      }\n    });\n\n    const onInstanceDeactivated = (reason: InstanceDeactivateReason) => {\n      const isUpdated = reason === 'version';\n      const popup = new PopupElement('popup-instance-deactivated', {overlayClosable: true});\n      const c = document.createElement('div');\n      c.classList.add('instance-deactivated-container');\n      (popup as any).container.replaceWith(c);\n\n      const header = document.createElement('div');\n      header.classList.add('header');\n      header.append(i18n(isUpdated ? 'Deactivated.Version.Title' : 'Deactivated.Title'));\n\n      const subtitle = document.createElement('div');\n      subtitle.classList.add('subtitle');\n      subtitle.append(i18n(isUpdated ? 'Deactivated.Version.Subtitle' : 'Deactivated.Subtitle'));\n\n      c.append(header, subtitle);\n\n      document.body.classList.add('deactivated');\n\n      const onClose = isUpdated ? () => {\n        appRuntimeManager.reload();\n      } : () => {\n        document.body.classList.add('deactivated-backwards');\n\n        singleInstance.activateInstance();\n\n        setTimeout(() => {\n          document.body.classList.remove('deactivated', 'deactivated-backwards');\n        }, 333);\n      };\n\n      popup.addEventListener('close', onClose);\n      popup.show();\n    };\n\n    singleInstance.addEventListener('deactivated', onInstanceDeactivated);\n    if(singleInstance.deactivatedReason) {\n      onInstanceDeactivated(singleInstance.deactivatedReason);\n    }\n\n    // remove scroll listener when setting chat to tray\n    this.addEventListener('chat_changing', ({to}) => {\n      this.toggleChatGradientAnimation(to);\n    });\n\n    rootScope.addEventListener('service_notification', (update) => {\n      confirmationPopup({\n        button: {langKey: 'OK', isCancel: true},\n        description: wrapRichText(update.message)\n      });\n    });\n\n    rootScope.addEventListener('payment_sent', async({peerId, mid, receiptMessage}) => {\n      const message = await this.managers.appMessagesManager.getMessageByPeer(peerId, mid);\n      if(!message) {\n        return;\n      }\n\n      const action = receiptMessage.action as MessageAction.messageActionPaymentSent;\n      toastNew({\n        langPackKey: 'PaymentInfoHint',\n        langPackArguments: [\n          paymentsWrapCurrencyAmount(action.total_amount, action.currency),\n          wrapEmojiText(((message as Message.message).media as MessageMedia.messageMediaInvoice).title)\n        ]\n      });\n    });\n\n    (window as any).onSpoilerClick = (e: MouseEvent) => {\n      const spoiler = findUpClassName(e.target, 'spoiler');\n      const parentElement = findUpClassName(spoiler, 'spoilers-container') || spoiler.parentElement;\n\n      const className = 'is-spoiler-visible';\n      const isVisible = parentElement.classList.contains(className);\n      if(!isVisible) {\n        cancelEvent(e);\n\n        if(CLICK_EVENT_NAME !== 'click') {\n          window.addEventListener('click', cancelEvent, {capture: true, once: true});\n        }\n      }\n\n      const duration = 400 / 2;\n      const showDuration = 5000;\n      const useRafs = !isVisible ? 2 : 0;\n      if(useRafs) {\n        parentElement.classList.add('will-change');\n      }\n\n      const spoilerTimeout = parentElement.dataset.spoilerTimeout;\n      if(spoilerTimeout !== null) {\n        clearTimeout(+spoilerTimeout);\n        delete parentElement.dataset.spoilerTimeout;\n      }\n\n      SetTransition(parentElement, className, true, duration, () => {\n        parentElement.dataset.spoilerTimeout = '' + window.setTimeout(() => {\n          SetTransition(parentElement, className, false, duration, () => {\n            parentElement.classList.remove('will-change');\n            delete parentElement.dataset.spoilerTimeout;\n          });\n        }, showDuration);\n      }, useRafs);\n    };\n\n    rootScope.addEventListener('sticker_updated', ({type, faved}) => {\n      if(type === 'faved') {\n        toastNew({\n          langPackKey: faved ? 'AddedToFavorites' : 'RemovedFromFavorites'\n        });\n      } else if(!faved) {\n        toastNew({\n          langPackKey: 'RemovedFromRecent'\n        });\n      }\n    });\n\n    apiManagerProxy.addEventListener('notificationBuild', (options) => {\n      if(this.chat.peerId === options.message.peerId && !idleController.isIdle) {\n        return;\n      }\n\n      uiNotificationsManager.buildNotification(options);\n    });\n\n    this.addEventListener('peer_changed', async(peerId) => {\n      document.body.classList.toggle('has-chat', !!peerId);\n\n      this.emojiAnimationContainer.textContent = '';\n\n      this.overrideHash(peerId);\n\n      apiManagerProxy.updateTabState('chatPeerIds', this.chats.map((chat) => chat.peerId).filter(Boolean));\n    });\n\n    // stateStorage.get('chatPositions').then((c) => {\n    stateStorage.setToCache('chatPositions', /* c ||  */{});\n    // });\n\n    if(IS_CALL_SUPPORTED || IS_GROUP_CALL_SUPPORTED) {\n      this.topbarCall = new TopbarCall(managers);\n    }\n\n    if(IS_CALL_SUPPORTED) {\n      callsController.addEventListener('instance', ({instance/* , hasCurrent */}) => {\n        // if(hasCurrent) {\n        // return;\n        // }\n\n        const popup = new PopupCall(instance);\n\n        instance.addEventListener('acceptCallOverride', () => {\n          return this.discardCurrentCall(instance.interlocutorUserId.toPeerId(), undefined, instance)\n          .then(() => {\n            callsController.dispatchEvent('accepting', instance);\n            return true;\n          })\n          .catch(() => false);\n        });\n\n        popup.addEventListener('close', () => {\n          const currentCall = callsController.currentCall;\n          if(currentCall && currentCall !== instance && !instance.wasTryingToJoin) {\n            instance.hangUp('phoneCallDiscardReasonBusy');\n          }\n        }, {once: true});\n\n        popup.show();\n      });\n\n      callsController.addEventListener('incompatible', (userId) => {\n        toastNew({\n          langPackKey: 'VoipPeerIncompatible',\n          langPackArguments: [\n            new PeerTitle({peerId: userId.toPeerId()}).element\n          ]\n        });\n      });\n    }\n\n    // ! do not remove this line\n    // ! instance can be deactivated before the UI starts, because it waits in background for RAF that is delayed\n    singleInstance.activateInstance();\n\n    const setAuthorized = () => {\n      telegramMeWebManager.setAuthorized(true);\n    };\n\n    setInterval(setAuthorized, ONE_DAY);\n    setAuthorized();\n\n    this.addAnchorListener<{}>({\n      name: 'showMaskedAlert',\n      callback: (params, element) => {\n        const href = element.href;\n\n        const a = element.cloneNode(true) as HTMLAnchorElement;\n        a.className = 'anchor-url';\n        a.innerText = href;\n        a.removeAttribute('onclick');\n\n        new PopupPeer('popup-masked-url', {\n          titleLangKey: 'OpenUrlTitle',\n          descriptionLangKey: 'OpenUrlAlert2',\n          descriptionLangArgs: [a],\n          buttons: [{\n            langKey: 'Open',\n            callback: () => {\n              a.click();\n            }\n          }]\n        }).show();\n      }\n    });\n\n    this.addAnchorListener<{uriParams: {command: string, bot: string}}>({\n      name: 'execBotCommand',\n      callback: ({uriParams}) => {\n        const {command, bot} = uriParams;\n\n        /* const promise = bot ? this.openUsername(bot).then(() => this.chat.peerId) : Promise.resolve(this.chat.peerId);\n        promise.then((peerId) => {\n          this.managers.appMessagesManager.sendText(peerId, '/' + command);\n        }); */\n\n        this.managers.appMessagesManager.sendText(this.chat.peerId, '/' + command + (bot ? '@' + bot : ''));\n\n        // console.log(command, bot);\n      }\n    });\n\n    this.addAnchorListener<{uriParams: {hashtag: string}}>({\n      name: 'searchByHashtag',\n      callback: ({uriParams}) => {\n        const {hashtag} = uriParams;\n        if(!hashtag) {\n          return;\n        }\n\n        this.chat.initSearch('#' + hashtag + ' ');\n      }\n    });\n\n    ([\n      ['addstickers', INTERNAL_LINK_TYPE.STICKER_SET],\n      ['addemoji', INTERNAL_LINK_TYPE.EMOJI_SET]\n    ] as [\n      'addstickers' | 'addemoji',\n      INTERNAL_LINK_TYPE.STICKER_SET | INTERNAL_LINK_TYPE.EMOJI_SET\n    ][]).forEach(([name, type]) => {\n      this.addAnchorListener<{pathnameParams: [typeof name, string]}>({\n        name,\n        callback: ({pathnameParams}) => {\n          if(!pathnameParams[1]) {\n            return;\n          }\n\n          const link: InternalLink = {\n            _: type,\n            set: pathnameParams[1]\n          };\n\n          this.processInternalLink(link);\n        }\n      });\n\n      this.addAnchorListener<{\n        uriParams: {\n          set: string\n        }\n      }>({\n        name,\n        protocol: 'tg',\n        callback: ({uriParams}) => {\n          const link = this.makeLink(type, uriParams);\n          this.processInternalLink(link);\n        }\n      });\n    });\n\n    // * t.me/invoice/asdasdad\n    // * t.me/$asdasdad\n    this.addAnchorListener<{pathnameParams: ['invoice', string] | string}>({\n      name: 'invoice',\n      callback: ({pathnameParams}) => {\n        const link: InternalLink = {\n          _: INTERNAL_LINK_TYPE.INVOICE,\n          slug: pathnameParams.length > 1 ? pathnameParams[1] : pathnameParams[0].slice(1)\n        };\n\n        this.processInternalLink(link);\n      }\n    });\n\n    // Support old t.me/joinchat/asd and new t.me/+asd\n    this.addAnchorListener<{pathnameParams: ['joinchat', string]}>({\n      name: 'joinchat',\n      callback: ({pathnameParams}) => {\n        const link: InternalLink = {\n          _: INTERNAL_LINK_TYPE.JOIN_CHAT,\n          invite: pathnameParams[1] || decodeURIComponent(pathnameParams[0]).slice(1)\n        };\n\n        this.processInternalLink(link);\n      }\n    });\n\n    if(IS_GROUP_CALL_SUPPORTED) {\n      this.addAnchorListener<{\n        uriParams: Omit<InternalLink.InternalLinkVoiceChat, '_'>\n      }>({\n        name: 'voicechat',\n        protocol: 'tg',\n        callback: ({uriParams}) => {\n          const link = this.makeLink(INTERNAL_LINK_TYPE.VOICE_CHAT, uriParams);\n          this.processInternalLink(link);\n        }\n      });\n    }\n\n    this.addAnchorListener<{\n    //   pathnameParams: ['c', string, string],\n    //   uriParams: {thread?: number}\n    // } | {\n    //   pathnameParams: [string, string?],\n    //   uriParams: {comment?: number}\n      pathnameParams: ['c', string, string] | [string, string?],\n      uriParams: {thread?: string, comment?: string} | {comment?: string, start?: string}\n    }>({\n      name: 'im',\n      callback: async({pathnameParams, uriParams}) => {\n        let link: InternalLink;\n        if(PHONE_NUMBER_REG_EXP.test(pathnameParams[0])) {\n          link = {\n            _: INTERNAL_LINK_TYPE.USER_PHONE_NUMBER,\n            phone: pathnameParams[0].slice(1)\n          };\n        } else if(pathnameParams[0] === 'c') {\n          link = {\n            _: INTERNAL_LINK_TYPE.PRIVATE_POST,\n            channel: pathnameParams[1],\n            post: pathnameParams[2],\n            thread: 'thread' in uriParams && uriParams.thread,\n            comment: uriParams.comment\n          };\n        } else {\n          link = {\n            _: INTERNAL_LINK_TYPE.MESSAGE,\n            domain: pathnameParams[0],\n            post: pathnameParams[1],\n            comment: uriParams.comment,\n            start: 'start' in uriParams ? uriParams.start : undefined\n          };\n        }\n\n        this.processInternalLink(link);\n      }\n    });\n\n    this.addAnchorListener<{\n      uriParams: {\n        domain: string,\n\n        // telegrampassport\n        scope?: string,\n        nonce?: string,\n        payload?: string,\n        bot_id?: string,\n        public_key?: string,\n        callback_url?: string,\n\n        // regular\n        start?: string,\n        startgroup?: string,\n        game?: string,\n        voicechat?: string,\n        post?: string,\n        thread?: string,\n        comment?: string,\n        phone?: string\n      }\n    }>({\n      name: 'resolve',\n      protocol: 'tg',\n      callback: ({uriParams}) => {\n        let link: InternalLink;\n        if(uriParams.phone) {\n          link = this.makeLink(INTERNAL_LINK_TYPE.USER_PHONE_NUMBER, uriParams as Required<typeof uriParams>);\n        } else if(uriParams.domain === 'telegrampassport') {\n\n        } else {\n          link = this.makeLink(INTERNAL_LINK_TYPE.MESSAGE, uriParams);\n        }\n\n        this.processInternalLink(link);\n      }\n    });\n\n    this.addAnchorListener<{\n      uriParams: {\n        channel: string,\n        post: string,\n        thread?: string,\n        comment?: string\n      }\n    }>({\n      name: 'privatepost',\n      protocol: 'tg',\n      callback: ({uriParams}) => {\n        const link = this.makeLink(INTERNAL_LINK_TYPE.PRIVATE_POST, uriParams);\n        this.processInternalLink(link);\n      }\n    });\n\n    this.addAnchorListener<{\n      uriParams: {\n        slug: string\n      }\n    }>({\n      name: 'invoice',\n      protocol: 'tg',\n      callback: ({uriParams}) => {\n        const link = this.makeLink(INTERNAL_LINK_TYPE.INVOICE, uriParams);\n        this.processInternalLink(link);\n      }\n    });\n\n    ['joinchat' as const, 'join' as const].forEach((name) => {\n      this.addAnchorListener<{\n        uriParams: {\n          invite: string\n        }\n      }>({\n        name,\n        protocol: 'tg',\n        callback: ({uriParams}) => {\n          const link = this.makeLink(INTERNAL_LINK_TYPE.JOIN_CHAT, uriParams);\n          this.processInternalLink(link);\n        }\n      });\n    });\n\n    this.onHashChange(true);\n    this.attachKeydownListener();\n  }\n\n  private deleteFilesIterative(callback: (response: Response) => boolean) {\n    return this.cacheStorage.timeoutOperation((cache) => {\n      const perf = performance.now();\n      return cache.keys().then((requests) => {\n        const promises = requests.map((request) => {\n          return cache.match(request).then((response) => {\n            return callback(response);\n          });\n        });\n\n        return Promise.all(promises).then((values) => {\n          values.map((isBad, idx) => {\n            if(!isBad) {\n              return;\n            }\n\n            const request = requests[idx];\n            return cache.delete(request);\n          });\n\n          return Promise.all(values.filter(Boolean));\n        });\n      }).then(() => {\n        this.log('deleted files', performance.now() - perf);\n      });\n    });\n  }\n\n  private toggleChatGradientAnimation(activatingChat: Chat) {\n    this.chats.forEach((chat) => {\n      if(chat.gradientRenderer) {\n        chat.gradientRenderer.scrollAnimate(rootScope.settings.animationsEnabled && chat === activatingChat);\n      }\n    });\n  }\n\n  private appendEmojiAnimationContainer(screen: ScreenSize) {\n    const appendTo = screen === ScreenSize.mobile ? this.columnEl : document.body;\n    if(this.emojiAnimationContainer.parentElement !== appendTo) {\n      appendTo.append(this.emojiAnimationContainer)\n    }\n  }\n\n  private attachKeydownListener() {\n    const IGNORE_KEYS = new Set(['PageUp', 'PageDown', 'Meta', 'Control']);\n    const onKeyDown = (e: KeyboardEvent) => {\n      const key = e.key;\n      if(overlayCounter.isOverlayActive || IGNORE_KEYS.has(key)) return;\n\n      const target = e.target as HTMLElement;\n\n      // if(target.tagName === 'INPUT') return;\n\n      // this.log('onkeydown', e, document.activeElement);\n\n      const chat = this.chat;\n\n      if(e.code === 'KeyC' && (e.ctrlKey || e.metaKey) && target.tagName !== 'INPUT') {\n        return;\n      } else if(e.altKey && (key === 'ArrowUp' || key === 'ArrowDown')) {\n        cancelEvent(e);\n        this.managers.dialogsStorage.getNextDialog(this.chat.peerId, key === 'ArrowDown', appDialogsManager.filterId).then((dialog) => {\n          if(dialog) {\n            this.setPeer({peerId: dialog.peerId});\n          }\n        });\n      } else if(key === 'ArrowUp' && this.chat.type !== 'scheduled') {\n        if(!chat.input.editMsgId && chat.input.isInputEmpty()) {\n          this.managers.appMessagesManager.getFirstMessageToEdit(chat.peerId, chat.threadId).then((message) => {\n            if(message) {\n              chat.input.initMessageEditing(message.mid);\n              cancelEvent(e); // * prevent from scrolling\n            }\n          });\n        } else {\n          return;\n        }\n      } else if(key === 'ArrowDown') {\n        return;\n      }\n\n      if(\n        chat?.input?.messageInput &&\n        e.target !== chat.input.messageInput &&\n        target.tagName !== 'INPUT' &&\n        !target.hasAttribute('contenteditable') &&\n        !IS_TOUCH_SUPPORTED &&\n        (!mediaSizes.isMobile || this.tabId === 1) &&\n        !chat.selection.isSelecting &&\n        !chat.input.recording\n      ) {\n        chat.input.messageInput.focus();\n        placeCaretAtEnd(chat.input.messageInput);\n\n        // clone and dispatch same event to new input. it is needed for sending message if input was blurred\n        const newEvent = new KeyboardEvent(e.type, e);\n        chat.input.messageInput.dispatchEvent(newEvent);\n      }\n    };\n\n    document.body.addEventListener('keydown', onKeyDown);\n  }\n\n  private makeLink<T extends INTERNAL_LINK_TYPE>(type: T, uriParams: Omit<InternalLinkTypeMap[T], '_'>) {\n    return {\n      _: type,\n      ...uriParams\n    } as any as InternalLinkTypeMap[T];\n  }\n\n  public async processInternalLink(link: InternalLink) {\n    switch(link?._) {\n      case INTERNAL_LINK_TYPE.MESSAGE: {\n        const postId = link.post ? generateMessageId(+link.post) : undefined;\n        const commentId = link.comment ? generateMessageId(+link.comment) : undefined;\n\n        this.openUsername({\n          userName: link.domain,\n          lastMsgId: postId,\n          commentId,\n          startParam: link.start\n        });\n        break;\n      }\n\n      case INTERNAL_LINK_TYPE.PRIVATE_POST: {\n        const chatId = link.channel.toChatId();\n        const peerId = chatId.toPeerId(true);\n\n        const chat = await this.managers.appChatsManager.getChat(chatId);\n        if(chat.deleted) {\n          try {\n            await this.managers.appChatsManager.resolveChannel(chatId);\n          } catch(err) {\n            toastNew({langPackKey: 'LinkNotFound'});\n            throw err;\n          }\n        }\n\n        const postId = generateMessageId(+link.post);\n        const threadId = link.thread ? generateMessageId(+link.thread) : undefined;\n\n        if(threadId) this.openThread(peerId, postId, threadId);\n        else this.setInnerPeer({\n          peerId,\n          lastMsgId: postId,\n          threadId\n        });\n        break;\n      }\n\n      case INTERNAL_LINK_TYPE.EMOJI_SET:\n      case INTERNAL_LINK_TYPE.STICKER_SET: {\n        new PopupStickers({id: link.set}, link._ === INTERNAL_LINK_TYPE.EMOJI_SET).show();\n        break;\n      }\n\n      case INTERNAL_LINK_TYPE.JOIN_CHAT: {\n        this.managers.appChatsManager.checkChatInvite(link.invite).then((chatInvite) => {\n          if((chatInvite as ChatInvite.chatInvitePeek).chat) {\n            this.managers.appChatsManager.saveApiChat((chatInvite as ChatInvite.chatInvitePeek).chat, true);\n          }\n\n          // console.log(chatInvite);\n\n          if(chatInvite._ === 'chatInviteAlready' ||\n            chatInvite._ === 'chatInvitePeek'/*  && chatInvite.expires > tsNow(true) */) {\n            this.setInnerPeer({\n              peerId: chatInvite.chat.id.toPeerId(true)\n            });\n            return;\n          }\n\n          new PopupJoinChatInvite(link.invite, chatInvite);\n        }, (err) => {\n          if(err.type === 'INVITE_HASH_EXPIRED') {\n            toast(i18n('InviteExpired'));\n          }\n        });\n        break;\n      }\n\n      case INTERNAL_LINK_TYPE.VOICE_CHAT: {\n        if(IS_GROUP_CALL_SUPPORTED) {\n          this.joinGroupCall(link.chat_id.toPeerId(true), link.id);\n        }\n\n        break;\n      }\n\n      case INTERNAL_LINK_TYPE.USER_PHONE_NUMBER: {\n        this.managers.appUsersManager.resolvePhone(link.phone).then((user) => {\n          this.setInnerPeer({\n            peerId: user.id.toPeerId(false)\n          });\n        }).catch((err) => {\n          if(err.type === 'PHONE_NOT_OCCUPIED') {\n            toastNew({langPackKey: 'Alert.UserDoesntExists'});\n          }\n        });\n\n        break;\n      }\n\n      case INTERNAL_LINK_TYPE.INVOICE: {\n        this.managers.appPaymentsManager.getInputInvoiceBySlug(link.slug).then((inputInvoice) => {\n          this.managers.appPaymentsManager.getPaymentForm(inputInvoice).then((paymentForm) => {\n            // const message: Message.message = {\n            //   _: 'message',\n            //   date: 0,\n            //   id: 0,\n            //   peerId: 0,\n            //   peer_id: undefined,\n            //   message: '',\n            //   media: {\n            //     _: 'messageMediaInvoice',\n            //     currency: paymentForm.invoice.currency,\n            //     description: paymentForm.description,\n\n            //   }\n            // };\n            new PopupPayment(undefined, inputInvoice, paymentForm);\n          });\n        });\n        break;\n      }\n\n      default: {\n        this.log.warn('Not supported internal link:', link);\n        break;\n      }\n    }\n  }\n\n  public openUrl(url: string) {\n    const {url: wrappedUrl, onclick} = wrapUrl(url);\n    const a = document.createElement('a');\n    a.href = wrappedUrl;\n\n    (window as any)[onclick](a);\n  }\n\n  private addAnchorListener<Params extends {pathnameParams?: any, uriParams?: any}>(options: {\n    name: 'showMaskedAlert' | 'execBotCommand' | 'searchByHashtag' | 'addstickers' | 'im' |\n          'resolve' | 'privatepost' | 'addstickers' | 'voicechat' | 'joinchat' | 'join' | 'invoice' |\n          'addemoji',\n    protocol?: 'tg',\n    callback: (params: Params, element?: HTMLAnchorElement) => boolean | any,\n    noPathnameParams?: boolean,\n    noUriParams?: boolean\n  }) {\n    (window as any)[(options.protocol ? options.protocol + '_' : '') + options.name] = (element?: HTMLAnchorElement/* , e: Event */) => {\n      cancelEvent(null);\n\n      let href = element.href;\n      let pathnameParams: any[];\n      let uriParams: any;\n\n      const u = new URL(href);\n      const match = u.host.match(/(.+?)\\.t(?:elegram)?\\.me/);\n      if(match) {\n        u.pathname = match[1] + (u.pathname === '/' ? '' : u.pathname);\n        href = u.toString();\n      }\n\n      if(!options.noPathnameParams) pathnameParams = new URL(href).pathname.split('/').slice(1);\n      if(!options.noUriParams) uriParams = this.parseUriParams(href);\n\n      const res = options.callback({pathnameParams, uriParams} as Params, element);\n      return res === undefined ? res : false;\n    };\n  }\n\n  private parseUriParams(uri: string, splitted = uri.split('?')) {\n    const params: any = {};\n    if(!splitted[1]) return params;\n    splitted[1].split('&').forEach((item) => {\n      params[item.split('=')[0]] = decodeURIComponent(item.split('=')[1]);\n    });\n\n    return params;\n  }\n\n  private onHashChange = (saveState?: boolean) => {\n    const hash = location.hash;\n    if(!saveState) {\n      appNavigationController.replaceState();\n    }\n\n    const splitted = hash.split('?');\n    const params = this.parseUriParams(hash, splitted);\n    this.log('hashchange', hash, splitted[0], params);\n    if(!hash) {\n      return;\n    }\n\n    if(params.tgaddr) {\n      const {onclick} = wrapUrl(params.tgaddr);\n      if(onclick) {\n        const a = document.createElement('a');\n        a.href = params.tgaddr;\n        (window as any)[onclick](a);\n      }\n      return;\n    }\n\n    switch(splitted[0]) {\n      default: {\n        params.p = splitted[0].slice(1);\n      }\n\n      case '#/im': {\n        const p: string = params.p;\n        const postId = params.post !== undefined ? generateMessageId(+params.post) : undefined;\n\n        switch(p[0]) {\n          case '@': {\n            this.openUsername({\n              userName: p,\n              lastMsgId: postId\n            });\n            break;\n          }\n\n          default: { // peerId\n            this.setInnerPeer({\n              peerId: postId ? p.toPeerId(true) : p.toPeerId(),\n              lastMsgId: postId\n            });\n            break;\n          }\n        }\n      }\n    }\n\n    // appNavigationController.replaceState();\n    // location.hash = '';\n  };\n\n  public openUsername(options: {\n    userName: string,\n    lastMsgId?: number,\n    threadId?: number,\n    commentId?: number,\n    startParam?: string\n  }) {\n    const {userName, lastMsgId, threadId, commentId, startParam} = options;\n    return this.managers.appUsersManager.resolveUsername(userName).then((peer) => {\n      const isUser = peer._ === 'user';\n      const peerId = peer.id.toPeerId(!isUser);\n\n      if(threadId) {\n        return this.openThread(peerId, lastMsgId, threadId);\n      } else if(commentId) {\n        return this.openComment(peerId, lastMsgId, commentId);\n      }\n\n      return this.setInnerPeer({\n        peerId,\n        lastMsgId,\n        startParam: startParam\n      });\n    }, (err) => {\n      if(err.type === 'USERNAME_NOT_OCCUPIED') {\n        toastNew({langPackKey: 'NoUsernameFound'});\n      } else if(err.type === 'USERNAME_INVALID') {\n        toastNew({langPackKey: 'Alert.UserDoesntExists'});\n      }\n    });\n  }\n\n  /**\n   * Opens thread when peerId of discussion group is known\n   */\n  public openThread(peerId: PeerId, lastMsgId: number, threadId: number) {\n    return this.managers.appMessagesManager.wrapSingleMessage(peerId, threadId).then((message) => {\n      // const message: Message = this.managers.appMessagesManager.getMessageByPeer(peerId, threadId);\n      if(!message) {\n        lastMsgId = undefined;\n      } else {\n        this.managers.appMessagesManager.generateThreadServiceStartMessage(message);\n      }\n\n      return this.setInnerPeer({\n        peerId,\n        lastMsgId,\n        threadId,\n        type: 'discussion'\n      });\n    });\n  }\n\n  /**\n   * Opens comment directly from original channel\n   */\n  public openComment(peerId: PeerId, msgId: number, commentId: number) {\n    return this.managers.appMessagesManager.getDiscussionMessage(peerId, msgId).then((message) => {\n      return this.openThread(message.peerId, commentId, message.mid);\n    });\n  }\n\n  public async callUser(userId: UserId, type: CallType) {\n    const call = callsController.getCallByUserId(userId);\n    if(call) {\n      return;\n    }\n\n    const userFull = await this.managers.appProfileManager.getProfile(userId);\n    if(userFull.pFlags.phone_calls_private) {\n      confirmationPopup({\n        descriptionLangKey: 'Call.PrivacyErrorMessage',\n        descriptionLangArgs: [new PeerTitle({peerId: userId.toPeerId()}).element],\n        button: {\n          langKey: 'OK',\n          isCancel: true\n        }\n      });\n\n      return;\n    }\n\n    await this.discardCurrentCall(userId.toPeerId());\n\n    callsController.startCallInternal(userId, type === 'video');\n  }\n\n  private discardCurrentCall(toPeerId: PeerId, ignoreGroupCall?: GroupCallInstance, ignoreCall?: CallInstance) {\n    if(groupCallsController.groupCall && groupCallsController.groupCall !== ignoreGroupCall) return this.discardGroupCallConfirmation(toPeerId);\n    else if(callsController.currentCall && callsController.currentCall !== ignoreCall) return this.discardCallConfirmation(toPeerId);\n    else return Promise.resolve();\n  }\n\n  private async discardCallConfirmation(toPeerId: PeerId) {\n    const currentCall = callsController.currentCall;\n    if(currentCall) {\n      await confirmationPopup({\n        titleLangKey: 'Call.Confirm.Discard.Call.Header',\n        descriptionLangKey: toPeerId.isUser() ? 'Call.Confirm.Discard.Call.ToCall.Text' : 'Call.Confirm.Discard.Call.ToVoice.Text',\n        descriptionLangArgs: [\n          new PeerTitle({peerId: currentCall.interlocutorUserId.toPeerId(false)}).element,\n          new PeerTitle({peerId: toPeerId}).element\n        ],\n        button: {\n          langKey: 'OK'\n        }\n      });\n\n      if(!currentCall.isClosing) {\n        await currentCall.hangUp('phoneCallDiscardReasonDisconnect');\n      }\n    }\n  }\n\n  private async discardGroupCallConfirmation(toPeerId: PeerId) {\n    const currentGroupCall = groupCallsController.groupCall;\n    if(currentGroupCall) {\n      await confirmationPopup({\n        titleLangKey: 'Call.Confirm.Discard.Voice.Header',\n        descriptionLangKey: toPeerId.isUser() ? 'Call.Confirm.Discard.Voice.ToCall.Text' : 'Call.Confirm.Discard.Voice.ToVoice.Text',\n        descriptionLangArgs: [\n          new PeerTitle({peerId: currentGroupCall.chatId.toPeerId(true)}).element,\n          new PeerTitle({peerId: toPeerId}).element\n        ],\n        button: {\n          langKey: 'OK'\n        }\n      });\n\n      if(groupCallsController.groupCall === currentGroupCall) {\n        await currentGroupCall.hangUp();\n      }\n    }\n  }\n\n  public async joinGroupCall(peerId: PeerId, groupCallId?: GroupCallId) {\n    const chatId = peerId.toChatId();\n    const hasRights = this.managers.appChatsManager.hasRights(chatId, 'manage_call');\n    const next = async() => {\n      const chatFull = await this.managers.appProfileManager.getChatFull(chatId);\n      let call: MyGroupCall;\n      if(!chatFull.call) {\n        if(!hasRights) {\n          return;\n        }\n\n        call = await this.managers.appGroupCallsManager.createGroupCall(chatId);\n      } else {\n        call = chatFull.call;\n      }\n\n      groupCallsController.joinGroupCall(chatId, call.id, true, false);\n    };\n\n    if(groupCallId) {\n      const groupCall = await this.managers.appGroupCallsManager.getGroupCallFull(groupCallId);\n      if(groupCall._ === 'groupCallDiscarded') {\n        if(!hasRights) {\n          toastNew({\n            langPackKey: 'VoiceChat.Chat.Ended'\n          });\n\n          return;\n        }\n\n        await confirmationPopup({\n          descriptionLangKey: 'VoiceChat.Chat.StartNew',\n          button: {\n            langKey: 'VoiceChat.Chat.StartNew.OK'\n          }\n        });\n      }\n    }\n\n    // await this.discardCurrentCall(peerId);\n\n    next();\n  };\n\n  public setCurrentBackground(broadcastEvent = false): ReturnType<AppImManager['setBackground']> {\n    const theme = themeController.getTheme();\n\n    if(theme.background.slug) {\n      const defaultTheme = STATE_INIT.settings.themes.find((t) => t.name === theme.name);\n      // const isDefaultBackground = theme.background.blur === defaultTheme.background.blur &&\n      // theme.background.slug === defaultTheme.background.slug;\n\n      // if(!isDefaultBackground) {\n      return this.getBackground(theme.background.slug).then((url) => {\n        return this.setBackground(url, broadcastEvent);\n      }, () => { // * if NO_ENTRY_FOUND\n        theme.background = copy(defaultTheme.background); // * reset background\n        return this.setCurrentBackground(true);\n      });\n      // }\n    }\n\n    return this.setBackground('', broadcastEvent);\n  }\n\n  private getBackground(slug: string) {\n    if(this.backgroundPromises[slug]) return this.backgroundPromises[slug];\n    return this.backgroundPromises[slug] = this.cacheStorage.getFile('backgrounds/' + slug).then((blob) => {\n      return URL.createObjectURL(blob);\n    });\n  }\n\n  public setBackground(url: string, broadcastEvent = true): Promise<void> {\n    this.lastBackgroundUrl = url;\n    const promises = this.chats.map((chat) => chat.setBackground(url));\n    return promises[promises.length - 1].then(() => {\n      if(broadcastEvent) {\n        rootScope.dispatchEvent('background_change');\n      }\n    });\n  }\n\n  public saveChatPosition(chat: Chat) {\n    if(!(['chat', 'discussion'] as ChatType[]).includes(chat.type) || !chat.peerId) {\n      return;\n    }\n\n    // const bubble = chat.bubbles.getBubbleByPoint('top');\n    // if(bubble) {\n    // const top = bubble.getBoundingClientRect().top;\n    const chatBubbles = chat.bubbles;\n    const key = chat.peerId + (chat.threadId ? '_' + chat.threadId : '');\n    const chatPositions = stateStorage.getFromCache('chatPositions');\n    if(!(chatBubbles.scrollable.getDistanceToEnd() <= 16 && chatBubbles.scrollable.loadedAll.bottom) && chatBubbles.getRenderedLength()) {\n      chatBubbles.sliceViewport(true);\n      const top = chatBubbles.scrollable.scrollTop;\n\n      const position = {\n        mids: getObjectKeysAndSort(chatBubbles.bubbles, 'desc').filter((mid) => !chatBubbles.skippedMids.has(mid)),\n        top\n      };\n\n      chatPositions[key] = position;\n\n      this.log('saved chat position:', position);\n    } else {\n      delete chatPositions[key];\n\n      this.log('deleted chat position');\n    }\n\n    stateStorage.set({chatPositions}, true);\n    // }\n  }\n\n  public getChatSavedPosition(chat: Chat): ChatSavedPosition {\n    if(!(['chat', 'discussion'] as ChatType[]).includes(chat.type) || !chat.peerId) {\n      return;\n    }\n\n    const key = chat.peerId + (chat.threadId ? '_' + chat.threadId : '');\n    const cache = stateStorage.getFromCache('chatPositions');\n    return cache && cache[key];\n  }\n\n  public applyCurrentTheme(slug?: string, backgroundUrl?: string, broadcastEvent?: boolean) {\n    if(backgroundUrl) {\n      this.backgroundPromises[slug] = Promise.resolve(backgroundUrl);\n    }\n\n    themeController.setTheme();\n\n    return this.setCurrentBackground(broadcastEvent === undefined ? !!slug : broadcastEvent);\n  }\n\n  private setSettings = () => {\n    document.documentElement.style.setProperty('--messages-text-size', rootScope.settings.messagesTextSize + 'px');\n\n    document.body.classList.toggle('animation-level-0', !rootScope.settings.animationsEnabled);\n    document.body.classList.toggle('animation-level-1', false);\n    document.body.classList.toggle('animation-level-2', rootScope.settings.animationsEnabled);\n\n    this.chatsSelectTabDebounced = debounce(() => {\n      const topbar = this.chat.topbar;\n      if(topbar.pinnedMessage) { // *   ,     ,       \n        topbar.pinnedMessage.setCorrectIndex(0);\n      }\n\n      this.managers.apiFileManager.setQueueId(this.chat.bubbles.lazyLoadQueue.queueId);\n    }, rootScope.settings.animationsEnabled ? 250 : 0, false, true);\n\n    lottieLoader.setLoop(rootScope.settings.stickers.loop);\n    animationIntersector.checkAnimations(false);\n\n    for(const chat of this.chats) {\n      chat.setAutoDownloadMedia();\n    }\n\n    I18n.setTimeFormat(rootScope.settings.timeFormat);\n\n    this.toggleChatGradientAnimation(this.chat);\n  };\n\n  // *     TransitionSlider,       \n  // * (   )     (. scrollTop)\n  private chatsSelectTab(tab: HTMLElement, animate?: boolean) {\n    if(this.prevTab === tab) {\n      return;\n    }\n\n    if(animate === false && this.prevTab) { // * will be used for Safari iOS history swipe\n      disableTransition([tab, this.prevTab].filter(Boolean));\n    }\n\n    if(this.prevTab) {\n      this.prevTab.classList.remove('active');\n      this.chatsSelectTabDebounced();\n\n      // !    animation,         250\n      if(rootScope.settings.animationsEnabled && animate !== false) {\n        dispatchHeavyAnimationEvent(pause(250 + 150), 250 + 150);\n      }\n\n      const prevIdx = whichChild(this.prevTab);\n      const idx = whichChild(tab);\n      if(idx > prevIdx) {\n        appNavigationController.pushItem({\n          type: 'chat',\n          onPop: (canAnimate) => {\n            this.setPeer({}, canAnimate);\n            blurActiveElement();\n          }\n        });\n      }\n    }\n\n    tab.classList.add('active');\n    this.prevTab = tab;\n  }\n\n  private init() {\n    document.addEventListener('paste', this.onDocumentPaste, true);\n\n    if(!IS_TOUCH_SUPPORTED) {\n      this.attachDragAndDropListeners();\n    }\n\n    // if(!isTouchSupported) {\n    this.markupTooltip = new MarkupTooltip(this);\n    this.markupTooltip.handleSelection();\n    // }\n  }\n\n  private attachDragAndDropListeners() {\n    const drops: ChatDragAndDrop[] = [];\n    const mediaDrops: ChatDragAndDrop[] = [];\n    let mounted = false;\n    const toggle = async(e: DragEvent, mount: boolean) => {\n      if(mount === mounted) return;\n\n      const _types = e.dataTransfer.types;\n      // @ts-ignore\n      const isFiles = _types.contains ? _types.contains('Files') : _types.indexOf('Files') >= 0;\n\n      const newMediaPopup = getCurrentNewMediaPopup();\n      const types: string[] = await getFilesFromEvent(e, true);\n      if(!isFiles || (!(await this.canDrag()) && !newMediaPopup)) { // * skip dragging text case\n        counter = 0;\n        return;\n      }\n\n      const _dropsContainer = newMediaPopup ? mediaDropsContainer : dropsContainer;\n      const _drops = newMediaPopup ? mediaDrops : drops;\n\n      if(mount && !_drops.length) {\n        const force = isFiles && !types.length; // * can't get file items not from 'drop' on Safari\n\n        const foundMedia = types.filter((t) => MEDIA_MIME_TYPES_SUPPORTED.has(t)).length;\n        // const foundDocuments = types.length - foundMedia;\n\n        this.log('drag files', types);\n\n        if(newMediaPopup) {\n          newMediaPopup.appendDrops(_dropsContainer);\n\n          if(types.length || force) {\n            _drops.push(new ChatDragAndDrop(_dropsContainer, {\n              header: 'Preview.Dragging.AddItems',\n              headerArgs: [types.length],\n              onDrop: (e: DragEvent) => {\n                toggle(e, false);\n                this.log('drop', e);\n                this.onDocumentPaste(e, 'document');\n              }\n            }));\n          }\n        } else {\n          if(types.length || force) {\n            _drops.push(new ChatDragAndDrop(_dropsContainer, {\n              icon: 'dragfiles',\n              header: 'Chat.DropTitle',\n              subtitle: 'Chat.DropAsFilesDesc',\n              onDrop: (e: DragEvent) => {\n                toggle(e, false);\n                this.log('drop', e);\n                this.onDocumentPaste(e, 'document');\n              }\n            }));\n          }\n\n          // if((foundMedia && !foundDocuments) || force) {\n          if(foundMedia || force) {\n            _drops.push(new ChatDragAndDrop(_dropsContainer, {\n              icon: 'dragmedia',\n              header: 'Chat.DropTitle',\n              subtitle: 'Chat.DropQuickDesc',\n              onDrop: (e: DragEvent) => {\n                toggle(e, false);\n                this.log('drop', e);\n                this.onDocumentPaste(e, 'media');\n              }\n            }));\n          }\n\n          this.chat.container.append(_dropsContainer);\n        }\n      }\n\n      // if(!mount) return;\n\n      SetTransition(_dropsContainer, 'is-visible', mount, 200, () => {\n        if(!mount) {\n          _drops.forEach((drop) => {\n            drop.destroy();\n          });\n\n          _drops.length = 0;\n        }\n      });\n\n      if(mount) {\n        _drops.forEach((drop) => {\n          drop.setPath();\n        });\n      } else {\n        counter = 0;\n      }\n\n      document.body.classList.toggle('is-dragging', mount);\n      mounted = mount;\n    };\n\n    /* document.body.addEventListener('dragover', (e) => {\n      cancelEvent(e);\n    }); */\n\n    let counter = 0;\n    document.body.addEventListener('dragenter', (e) => {\n      counter++;\n    });\n\n    document.body.addEventListener('dragover', (e) => {\n      // this.log('dragover', e/* , e.dataTransfer.types[0] */);\n      toggle(e, true);\n      cancelEvent(e);\n    });\n\n    document.body.addEventListener('dragleave', (e) => {\n      // this.log('dragleave', e, counter);\n      // if((e.pageX <= 0 || e.pageX >= this.managers.appPhotosManager.windowW) || (e.pageY <= 0 || e.pageY >= this.managers.appPhotosManager.windowH)) {\n      counter--;\n      if(counter === 0) {\n      // if(!findUpClassName(e.target, 'drops-container')) {\n        toggle(e, false);\n      }\n    });\n\n    const dropsContainer = document.createElement('div');\n    dropsContainer.classList.add('drops-container');\n\n    const mediaDropsContainer = dropsContainer.cloneNode(true) as HTMLElement;\n  }\n\n  private async canDrag() {\n    const chat = this.chat;\n    const peerId = chat?.peerId;\n    return !(!peerId || overlayCounter.isOverlayActive || !(await chat.canSend('send_media')));\n  }\n\n  private onDocumentPaste = async(e: ClipboardEvent | DragEvent, attachType?: 'media' | 'document') => {\n    const newMediaPopup = getCurrentNewMediaPopup();\n\n    // console.log('document paste');\n    // console.log('item', event.clipboardData.getData());\n\n    if(e instanceof DragEvent) {\n      const _types = e.dataTransfer.types;\n      // @ts-ignore\n      const isFiles = _types.contains ? _types.contains('Files') : _types.indexOf('Files') >= 0;\n      if(isFiles) {\n        cancelEvent(e);\n      }\n    }\n\n    const files = await getFilesFromEvent(e);\n    if(!(await this.canDrag()) && !newMediaPopup) return;\n    if(files.length) {\n      if(newMediaPopup) {\n        newMediaPopup.addFiles(files);\n        return;\n      }\n\n      const chatInput = this.chat.input;\n      chatInput.willAttachType = attachType || (MEDIA_MIME_TYPES_SUPPORTED.has(files[0].type) ? 'media' : 'document');\n      PopupElement.createPopup(PopupNewMedia, this.chat, files, chatInput.willAttachType);\n    }\n  };\n\n  private async overrideHash(peerId?: PeerId) {\n    let str: string;\n    if(peerId) {\n      const username = await this.managers.appPeersManager.getPeerUsername(peerId);\n      str = username ? '@' + username : '' + peerId;\n    }\n\n    appNavigationController.overrideHash(str);\n  }\n\n  public selectTab(id: number, animate?: boolean) {\n    if(animate === false) { // * will be used for Safari iOS history swipe\n      disableTransition([appSidebarLeft.sidebarEl, this.columnEl, appSidebarRight.sidebarEl]);\n    }\n\n    document.body.classList.toggle(LEFT_COLUMN_ACTIVE_CLASSNAME, id === 0);\n\n    const prevTabId = this.tabId;\n    if(prevTabId !== -1) {\n      this.overrideHash(id > 0 ? this.chat?.peerId : undefined);\n    }\n\n    this.log('selectTab', id, prevTabId);\n\n    let animationPromise: Promise<any> = rootScope.settings.animationsEnabled ? doubleRaf() : Promise.resolve();\n    if(prevTabId !== -1 && prevTabId !== id && rootScope.settings.animationsEnabled && animate !== false && mediaSizes.activeScreen !== ScreenSize.large) {\n      const transitionTime = (mediaSizes.isMobile ? 250 : 200) + 100; // * cause transition time could be > 250ms\n      animationPromise = pause(transitionTime);\n      dispatchHeavyAnimationEvent(animationPromise, transitionTime);\n\n      // ! it's very heavy operation. will blink in firefox\n      /* this.columnEl.classList.add('disable-hover');\n      animationPromise.finally(() => {\n        this.columnEl.classList.remove('disable-hover');\n      }); */\n    }\n\n    this.tabId = id;\n    blurActiveElement();\n    if(mediaSizes.isMobile && prevTabId === 2 && id < 2) {\n      document.body.classList.remove(RIGHT_COLUMN_ACTIVE_CLASSNAME);\n    }\n\n    if(prevTabId !== -1 && id > prevTabId) {\n      if(id < 2 || !appNavigationController.findItemByType('im')) {\n        appNavigationController.pushItem({\n          type: 'im',\n          onPop: (canAnimate) => {\n            // this.selectTab(prevTabId, !isSafari);\n            this.setPeer({}, canAnimate);\n          }\n        });\n      }\n    }\n\n    const onImTabChange = (window as any).onImTabChange;\n    onImTabChange && onImTabChange(id);\n\n    // this._selectTab(id, mediaSizes.isMobile);\n    // document.body.classList.toggle(RIGHT_COLUMN_ACTIVE_CLASSNAME, id === 2);\n\n    return animationPromise;\n  }\n\n  public updateStatus() {\n    return this.managers.appUsersManager.updateMyOnlineStatus(this.offline);\n  }\n\n  private createNewChat() {\n    const chat = new Chat(\n      this,\n      this.managers\n    );\n\n    if(this.chats.length) {\n      chat.setBackground(this.lastBackgroundUrl, true);\n    }\n\n    this.chats.push(chat);\n\n    return chat;\n  }\n\n  private spliceChats(fromIndex: number, justReturn = true, animate?: boolean, spliced?: Chat[]) {\n    if(fromIndex >= this.chats.length) return;\n\n    const chatFrom = this.chat;\n    if(this.chats.length > 1 && justReturn) {\n      this.dispatchEvent('peer_changing', this.chat);\n    }\n\n    if(!spliced) {\n      spliced = this.chats.splice(fromIndex, this.chats.length - fromIndex);\n    }\n\n    const chatTo = this.chat;\n    this.dispatchEvent('chat_changing', {from: chatFrom, to: chatTo});\n\n    // * -1 because one item is being sliced when closing the chat by calling .removeByType\n    for(let i = 0; i < spliced.length - 1; ++i) {\n      appNavigationController.removeByType('chat', true);\n    }\n\n    // * fix middle chat z-index on animation\n    if(spliced.length > 1) {\n      spliced.slice(0, -1).forEach((chat) => {\n        chat.container.remove();\n      });\n    }\n\n    this.chatsSelectTab(chatTo.container, animate);\n\n    if(justReturn) {\n      this.dispatchEvent('peer_changed', chatTo.peerId);\n\n      const searchTab = appSidebarRight.getTab(AppPrivateSearchTab);\n      if(searchTab) {\n        searchTab.close();\n      }\n\n      appSidebarRight.replaceSharedMediaTab(chatTo.sharedMediaTab);\n    }\n\n    spliced.forEach((chat) => {\n      chat.beforeDestroy();\n    });\n\n    setTimeout(() => {\n      // chat.setPeer(0);\n      spliced.forEach((chat) => {\n        chat.destroy();\n      });\n    }, 250 + 100);\n  }\n\n  public async setPeer(options: ChatSetPeerOptions = {}, animate?: boolean): Promise<boolean> {\n    if(this.init) {\n      this.init();\n      this.init = null;\n    }\n\n    options.peerId ??= NULL_PEER_ID;\n\n    const {peerId, lastMsgId} = options;\n\n    const chat = this.chat;\n    const chatIndex = this.chats.indexOf(chat);\n\n    if(!peerId) {\n      if(chatIndex > 0) {\n        this.spliceChats(chatIndex, undefined, animate);\n        return;\n      } else if(mediaSizes.activeScreen === ScreenSize.medium) { // * floating sidebar case\n        this.selectTab(+!this.tabId, animate);\n        return;\n      }\n    } else if(chatIndex > 0 && chat.peerId && chat.peerId !== peerId) {\n      // const firstChat = this.chats[0];\n      // if(firstChat.peerId !== chat.peerId) {\n      /* // * slice idx > 0, set background and slice first, so new one will be the first\n        const spliced = this.chats.splice(1, this.chats.length - 1);\n        this.createNewChat();\n        this.chats.splice(0, 1); */\n      const spliced = this.chats.splice(1, this.chats.length - 1);\n      if(this.chat.peerId === peerId) {\n        this.spliceChats(0, true, true, spliced);\n        return;\n      } else {\n        const ret = this.setPeer(options);\n        this.spliceChats(0, false, false, spliced);\n        return ret;\n      }\n      // } else {\n      //   this.spliceChats(1, false, animate);\n      // }\n\n      // return ret;\n    }\n\n    // * don't reset peer if returning\n    if(peerId === chat.peerId && mediaSizes.activeScreen <= ScreenSize.medium && document.body.classList.contains(LEFT_COLUMN_ACTIVE_CLASSNAME)) {\n      this.selectTab(1, animate);\n      return false;\n    }\n\n    if(peerId || mediaSizes.activeScreen !== ScreenSize.mobile) {\n      const result = await chat.setPeer(peerId, lastMsgId, options.startParam);\n\n      // * wait for cached render\n      const promise = result?.cached ? result.promise : Promise.resolve();\n      if(peerId) {\n        Promise.all([\n          promise,\n          chat.setBackgroundPromise\n        ]).then(() => {\n          // window.requestAnimationFrame(() => {\n          setTimeout(() => { // * setTimeout is better here\n            setTimeout(() => {\n              this.chatsSelectTab(this.chat.container);\n            }, 0);\n            this.selectTab(1, animate);\n          }, 0);\n        });\n      }\n    }\n\n    if(!peerId) {\n      this.selectTab(0, animate);\n      return false;\n    }\n  }\n\n  public setInnerPeer(options: ChatSetInnerPeerOptions) {\n    const {peerId} = options;\n    if(peerId === NULL_PEER_ID || !peerId) {\n      return;\n    }\n\n    if(options.threadId) {\n      options.type = 'discussion';\n    }\n\n    const type = options.type ??= 'chat';\n\n    // * prevent opening already opened peer\n    const existingIndex = this.chats.findIndex((chat) => chat.peerId === peerId && chat.type === type);\n    if(existingIndex !== -1) {\n      this.spliceChats(existingIndex + 1);\n      return this.setPeer(options);\n    }\n\n    const oldChat = this.chat;\n    let chat = oldChat;\n    if(oldChat.inited) { // * use first not inited chat\n      chat = this.createNewChat();\n    }\n\n    if(type) {\n      chat.setType(type);\n\n      if(options.threadId) {\n        chat.threadId = options.threadId;\n      }\n    }\n\n    this.dispatchEvent('chat_changing', {from: oldChat, to: chat});\n\n    // this.chatsSelectTab(chat.container);\n\n    return this.setPeer(options);\n  }\n\n  public openScheduled(peerId: PeerId) {\n    this.setInnerPeer({\n      peerId,\n      type: 'scheduled'\n    });\n  }\n\n  private getTypingElement(action: SendMessageAction) {\n    const el = document.createElement('span');\n    let c = 'peer-typing';\n    el.classList.add(c);\n    el.dataset.action = action._;\n    switch(action._) {\n      case 'sendMessageTypingAction': {\n      // default: {\n        c += '-text';\n        for(let i = 0; i < 3; ++i) {\n          const dot = document.createElement('span');\n          dot.className = c + '-dot';\n          el.append(dot);\n        }\n        break;\n      }\n\n      case 'sendMessageUploadAudioAction':\n      case 'sendMessageUploadDocumentAction':\n      case 'sendMessageUploadRoundAction':\n      case 'sendMessageUploadVideoAction':\n      case 'sendMessageUploadPhotoAction': {\n        c += '-upload';\n        /* const trail = document.createElement('span');\n        trail.className = c + '-trail';\n        el.append(trail); */\n        break;\n      }\n\n      case 'sendMessageRecordAudioAction':\n      case 'sendMessageRecordRoundAction':\n      case 'sendMessageRecordVideoAction': {\n        c += '-record';\n        break;\n      }\n\n      case 'sendMessageEmojiInteractionSeen':\n      case 'sendMessageChooseStickerAction': {\n        c += '-choosing-sticker';\n        for(let i = 0; i < 2; ++i) {\n          const eye = document.createElement('div');\n          eye.className = c + '-eye';\n          el.append(eye);\n        }\n        break;\n      }\n    }\n\n    el.classList.add(c);\n\n    return el;\n  }\n\n  public async getPeerTyping(peerId: PeerId, container?: HTMLElement) {\n    // const log = this.log.bindPrefix('getPeerTyping-' + peerId);\n    // log('getting peer typing');\n\n    const isUser = peerId.isUser();\n    if(isUser && await this.managers.appUsersManager.isBot(peerId)) {\n      // log('a bot');\n      return;\n    }\n\n    const typings = await this.managers.appProfileManager.getPeerTypings(peerId);\n    if(!typings?.length) {\n      // log('have no typing');\n      return;\n    }\n\n    const typing = typings[0];\n\n    const langPackKeys: {\n      [peerType in 'private' | 'chat' | 'multi']?: Partial<{[action in SendMessageAction['_']]: LangPackKey}>\n    } = {\n      private: {\n        'sendMessageTypingAction': 'Peer.Activity.User.TypingText',\n        'sendMessageUploadAudioAction': 'Peer.Activity.User.SendingFile',\n        'sendMessageUploadDocumentAction': 'Peer.Activity.User.SendingFile',\n        'sendMessageUploadPhotoAction': 'Peer.Activity.User.SendingPhoto',\n        'sendMessageUploadVideoAction': 'Peer.Activity.User.SendingVideo',\n        'sendMessageUploadRoundAction': 'Peer.Activity.User.SendingVideo',\n        'sendMessageRecordVideoAction': 'Peer.Activity.User.RecordingVideo',\n        'sendMessageRecordAudioAction': 'Peer.Activity.User.RecordingAudio',\n        'sendMessageRecordRoundAction': 'Peer.Activity.User.RecordingVideo',\n        'sendMessageGamePlayAction': 'Peer.Activity.User.PlayingGame',\n        'sendMessageChooseStickerAction': 'Peer.Activity.User.ChoosingSticker',\n        'sendMessageEmojiInteractionSeen': 'Peer.Activity.User.EnjoyingAnimations'\n      },\n      chat: {\n        'sendMessageTypingAction': 'Peer.Activity.Chat.TypingText',\n        'sendMessageUploadAudioAction': 'Peer.Activity.Chat.SendingFile',\n        'sendMessageUploadDocumentAction': 'Peer.Activity.Chat.SendingFile',\n        'sendMessageUploadPhotoAction': 'Peer.Activity.Chat.SendingPhoto',\n        'sendMessageUploadVideoAction': 'Peer.Activity.Chat.SendingVideo',\n        'sendMessageUploadRoundAction': 'Peer.Activity.Chat.SendingVideo',\n        'sendMessageRecordVideoAction': 'Peer.Activity.Chat.RecordingVideo',\n        'sendMessageRecordAudioAction': 'Peer.Activity.Chat.RecordingAudio',\n        'sendMessageRecordRoundAction': 'Peer.Activity.Chat.RecordingVideo',\n        'sendMessageGamePlayAction': 'Peer.Activity.Chat.PlayingGame',\n        'sendMessageChooseStickerAction': 'Peer.Activity.Chat.ChoosingSticker',\n        'sendMessageEmojiInteractionSeen': 'Peer.Activity.Chat.EnjoyingAnimations'\n      },\n      multi: {\n        'sendMessageTypingAction': 'Peer.Activity.Chat.Multi.TypingText1',\n        'sendMessageUploadAudioAction': 'Peer.Activity.Chat.Multi.SendingFile1',\n        'sendMessageUploadDocumentAction': 'Peer.Activity.Chat.Multi.SendingFile1',\n        'sendMessageUploadPhotoAction': 'Peer.Activity.Chat.Multi.SendingPhoto1',\n        'sendMessageUploadVideoAction': 'Peer.Activity.Chat.Multi.SendingVideo1',\n        'sendMessageUploadRoundAction': 'Peer.Activity.Chat.Multi.SendingVideo1',\n        'sendMessageRecordVideoAction': 'Peer.Activity.Chat.Multi.RecordingVideo1',\n        'sendMessageRecordAudioAction': 'Peer.Activity.Chat.Multi.RecordingAudio1',\n        'sendMessageRecordRoundAction': 'Peer.Activity.Chat.Multi.RecordingVideo1',\n        'sendMessageGamePlayAction': 'Peer.Activity.Chat.Multi.PlayingGame1',\n        'sendMessageChooseStickerAction': 'Peer.Activity.Chat.Multi.ChoosingSticker1'\n      }\n    };\n\n    const mapa = isUser ? langPackKeys.private : (typings.length > 1 ? langPackKeys.multi : langPackKeys.chat);\n    let action = typing.action;\n\n    if(typings.length > 1) {\n      const s: any = {};\n      typings.forEach((typing) => {\n        const type = typing.action._;\n        if(s[type] === undefined) s[type] = 0;\n        ++s[type];\n      });\n\n      if(Object.keys(s).length > 1) {\n        action = {\n          _: 'sendMessageTypingAction'\n        };\n      }\n    }\n\n    const langPackKey = mapa[action._];\n    if(!langPackKey) {\n      // log('no langPackKey');\n      return;\n    }\n\n    let peerTitlePromise: Promise<any>;\n    let args: any[];\n    if(peerId.isAnyChat()) {\n      const peerTitle = new PeerTitle();\n      peerTitlePromise = peerTitle.update({peerId: typing.userId.toPeerId(false), onlyFirstName: true});\n      args = [\n        peerTitle.element,\n        typings.length - 1\n      ];\n\n      await peerTitlePromise;\n    }\n\n    if(!container) {\n      container = document.createElement('span');\n      container.classList.add('online', 'peer-typing-container');\n    }\n\n    container.classList.toggle('peer-typing-flex', action._ === 'sendMessageChooseStickerAction' || action._ === 'sendMessageEmojiInteractionSeen');\n\n    let typingElement = container.firstElementChild as HTMLElement;\n    if(!typingElement) {\n      typingElement = this.getTypingElement(action);\n      container.prepend(typingElement);\n    } else {\n      if(typingElement.dataset.action !== action._) {\n        typingElement.replaceWith(this.getTypingElement(action));\n      }\n    }\n\n    if(action._ === 'sendMessageEmojiInteractionSeen') {\n      if(args) {\n        args.pop();\n      } else {\n        args = [];\n      }\n\n      const span = htmlToSpan(wrapEmojiText(action.emoticon));\n      args.push(span);\n    }\n\n    const descriptionElement = i18n(langPackKey, args);\n    descriptionElement.classList.add('peer-typing-description');\n\n    if(container.childElementCount > 1) container.lastElementChild.replaceWith(descriptionElement);\n    else container.append(descriptionElement);\n\n    // log('returning typing');\n    return container;\n  }\n\n  private async getChatStatus(chatId: ChatId): Promise<AckedResult<HTMLElement>> {\n    const typingEl = await this.getPeerTyping(chatId.toPeerId(true));\n    if(typingEl) {\n      return {cached: true, result: Promise.resolve(typingEl)};\n    }\n\n    const result = await this.managers.acknowledged.appProfileManager.getChatFull(chatId);\n    const dooo = async(chatInfo: ChatFull) => {\n      // this.chat.log('chatInfo res:', chatInfo);\n\n      const participants_count = (chatInfo as ChatFull.channelFull).participants_count ||\n        ((chatInfo as ChatFull.chatFull).participants as ChatParticipants.chatParticipants)?.participants?.length ||\n        1;\n      // if(participants_count) {\n      let subtitle = await getChatMembersString(chatId);\n\n      if(participants_count < 2) {\n        return subtitle;\n      }\n\n      const onlines = await this.managers.appProfileManager.getOnlines(chatId);\n      if(onlines > 1) {\n        const span = document.createElement('span');\n\n        span.append(...join([subtitle, i18n('OnlineCount', [numberThousandSplitter(onlines)])], false));\n        subtitle = span;\n      }\n\n      return subtitle;\n      // }\n    };\n\n    const promise = Promise.resolve(result.result).then(dooo);\n    return {\n      cached: result.cached,\n      result: promise\n    };\n  }\n\n  private async getUserStatus(userId: UserId, ignoreSelf?: boolean) {\n    const result: AckedResult<HTMLElement> = {\n      cached: true,\n      result: Promise.resolve(undefined as HTMLElement)\n    };\n\n    const user = await this.managers.appUsersManager.getUser(userId);\n    if(!user || (user.pFlags.self && !ignoreSelf)) {\n      return result;\n    }\n\n    const subtitle = getUserStatusString(user);\n\n    if(!user.pFlags.bot) {\n      let typingEl = await this.getPeerTyping(userId.toPeerId());\n      if(!typingEl && user.status?._ === 'userStatusOnline') {\n        typingEl = document.createElement('span');\n        typingEl.classList.add('online');\n        typingEl.append(subtitle);\n      }\n\n      if(typingEl) {\n        result.result = Promise.resolve(typingEl);\n        return result;\n      }\n    }\n\n    result.result = Promise.resolve(subtitle);\n    return result;\n  }\n\n  private async getPeerStatus(peerId: PeerId, ignoreSelf?: boolean) {\n    if(!peerId) return;\n    let promise: Promise<AckedResult<HTMLElement>>;\n    if(peerId.isAnyChat()) {\n      promise = this.getChatStatus(peerId.toChatId());\n    } else {\n      promise = this.getUserStatus(peerId.toUserId(), ignoreSelf);\n    }\n\n    return promise;\n  }\n\n  public async setPeerStatus(\n    peerId: PeerId,\n    element: HTMLElement,\n    needClear: boolean,\n    useWhitespace: boolean,\n    middleware: () => boolean,\n    ignoreSelf?: boolean\n  ) {\n    // const log = this.log.bindPrefix('status-' + peerId);\n    // log('setting status', element);\n\n    if(!needClear) {\n      // * good good good\n      const typingContainer = element.querySelector('.peer-typing-container') as HTMLElement;\n      if(typingContainer && await this.getPeerTyping(peerId, typingContainer)) {\n        // log('already have a status');\n        return;\n      }\n    }\n\n    const result = await this.getPeerStatus(peerId, ignoreSelf);\n    // log('getPeerStatus result', result);\n    if(!middleware()) {\n      // log.warn('middleware');\n      return;\n    }\n\n    const set = async() => {\n      const subtitle = result && await result.result;\n      if(!middleware()) {\n        return;\n      }\n\n      return () => replaceContent(element, subtitle || placeholder);\n    };\n\n    const placeholder = useWhitespace ? '' : ''; // ! HERE U CAN FIND WHITESPACE\n    if(!result || result.cached) {\n      return await set();\n    } else if(needClear) {\n      return () => {\n        element.textContent = placeholder;\n        return set().then((callback) => callback && callback());\n      };\n    }\n  }\n\n  public setChoosingStickerTyping(cancel: boolean) {\n    this.managers.appMessagesManager.setTyping(this.chat.peerId, {_: cancel ? 'sendMessageCancelAction' : 'sendMessageChooseStickerAction'});\n  }\n}\n\nconst appImManager = new AppImManager();\nMOUNT_CLASS_TO && (MOUNT_CLASS_TO.appImManager = appImManager);\nexport default appImManager;\n","import {Document, Message, MessageAction, MessageMedia, Photo, WebPage} from '../../../../layer';\n\nexport default function getMediaFromMessage(message: Message) {\n  if(!message) return;\n\n  const media = (message as Message.messageService).action ?\n    ((message as Message.messageService).action as MessageAction.messageActionChannelEditPhoto).photo :\n    (message as Message.message).media && (\n      ((message as Message.message).media as MessageMedia.messageMediaPhoto).photo ||\n      ((message as Message.message).media as MessageMedia.messageMediaDocument).document || (\n        ((message as Message.message).media as MessageMedia.messageMediaWebPage).webpage && (\n          (((message as Message.message).media as MessageMedia.messageMediaWebPage).webpage as WebPage.webPage).document ||\n          (((message as Message.message).media as MessageMedia.messageMediaWebPage).webpage as WebPage.webPage).photo\n        )\n      )\n    );\n\n  return media as Photo.photo | Document.document;\n}\n","import {Message} from '../../../../layer';\nimport type {MyMessage} from '../../appMessagesManager';\n\nexport default function getMessageSenderPeerIdOrName(message: MyMessage) {\n  if(message.fromId) {\n    return {\n      peerId: message.fromId\n    };\n  } else {\n    return {\n      fromName: (message as Message.message).fwd_from?.from_name\n    };\n  }\n}\n","import {isRestricted} from '../../../../helpers/restrictions';\nimport {Message} from '../../../../layer';\n\nexport default function isMessageRestricted(message: Message.message) {\n  return !!(message.restriction_reason && isRestricted(message.restriction_reason));\n}\n","// https://github.com/eelcohn/Telegram-API/wiki/Calculating-color-for-a-Telegram-user-on-IRC\n/*\n  HTML-color  IRC-color  Description\n  #c03d33     4          red\n  #4fad2d     3          green\n  #d09306     7          yellow\n  #168acd     10         blue\n  #8544d6     6          purple\n  #cd4073     13         pink\n  #2996ad     11         sea\n  #ce671b     5          orange\n*/\nconst DialogColorsFg = ['#fc5c51', '#0fb297', '#d09306', '#3d72ed', '#895dd5', '#cd4073', '#00c1a6', '#fa790f'];\nconst DialogColors = ['red', 'green', 'yellow', 'blue', 'violet', 'pink', 'cyan', 'orange'];\nconst DialogColorsMap = [0, 7, 4, 1, 6, 3, 5];\n\nexport default function getPeerColorById(peerId: PeerId, pic = true) {\n  if(!peerId) return '';\n\n  const idx = DialogColorsMap[Math.abs(+peerId) % 7];\n  const color = (pic ? DialogColors : DialogColorsFg)[idx];\n  return color;\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport type {MyDocument} from '../../appDocsManager';\nimport type {MyPhoto} from '../../appPhotosManager';\nimport type {PhotoSize, VideoSize, WebDocument} from '../../../../layer';\nimport calcImageInBox from '../../../../helpers/calcImageInBox';\nimport {THUMB_TYPE_FULL} from '../../../mtproto/mtproto_config';\n\nexport default function choosePhotoSize(\n  photo: MyPhoto | MyDocument | WebDocument,\n  boxWidth = 0,\n  boxHeight = 0,\n  useBytes = false,\n  pushDocumentSize = false\n) {\n  if(window.devicePixelRatio > 1) {\n    boxWidth *= 2;\n    boxHeight *= 2;\n  }\n\n  /*\n  s box 100x100\n  m box 320x320\n  x box 800x800\n  y box 1280x1280\n  w box 2560x2560\n  a crop  160x160\n  b crop  320x320\n  c crop  640x640\n  d crop  1280x1280 */\n\n  let sizes: PhotoSize[] = (photo as MyPhoto).sizes || (photo as MyDocument).thumbs as PhotoSize[];\n  let bestPhotoSize: typeof sizes[0] = {_: 'photoSizeEmpty', type: THUMB_TYPE_FULL};\n  if(pushDocumentSize && sizes && photo._ !== 'photo') {\n    sizes = sizes.concat({\n      _: 'photoSize',\n      w: photo.w,\n      h: photo.h,\n      size: photo.size,\n      type: THUMB_TYPE_FULL\n    });\n  }\n\n  if(sizes?.length) {\n    for(let i = 0, length = sizes.length; i < length; ++i) {\n      const photoSize = sizes[i];\n      if(!('w' in photoSize) && !('h' in photoSize)) continue;\n\n      bestPhotoSize = photoSize;\n\n      const size = calcImageInBox(photoSize.w, photoSize.h, boxWidth, boxHeight);\n      if(size.width >= boxWidth || size.height >= boxHeight) {\n        break;\n      }\n    }\n\n    if(useBytes && bestPhotoSize._ === 'photoSizeEmpty' && sizes[0]._ === 'photoStrippedSize') {\n      bestPhotoSize = sizes[0];\n    }\n  }\n\n  return bestPhotoSize;\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport safeAssign from '../../helpers/object/safeAssign';\nimport {logger} from '../logger';\nimport createDataChannel from './helpers/createDataChannel';\nimport createPeerConnection from './helpers/createPeerConnection';\nimport LocalConferenceDescription from './localConferenceDescription';\nimport StreamManager from './streamManager';\nimport {Ssrc} from './types';\n\nexport type CallConnectionInstanceOptions = {\n  streamManager: StreamManager,\n  connection?: RTCPeerConnection,\n  log?: ReturnType<typeof logger>\n};\n\nexport default abstract class CallConnectionInstanceBase {\n  public connection: RTCPeerConnection;\n  public streamManager: StreamManager;\n  public dataChannel: RTCDataChannel;\n  public description: LocalConferenceDescription;\n  public sources: {\n    audio: Ssrc,\n    video?: Ssrc,\n  };\n  protected negotiating: Promise<void>;\n  protected log: ReturnType<typeof logger>;\n\n  constructor(options: CallConnectionInstanceOptions) {\n    safeAssign(this, options);\n\n    if(!this.log) {\n      this.log = this.connection?.log || logger('CALL-CONNECTION-BASE');\n    }\n\n    this.sources = {} as any;\n  }\n\n  public createPeerConnection(config?: RTCConfiguration) {\n    return this.connection || (this.connection = createPeerConnection(config, this.log.bindPrefix('connection')).connection);\n  }\n\n  public createDataChannel(dict?: RTCDataChannelInit) {\n    return this.dataChannel || (this.dataChannel = createDataChannel(this.connection, dict, this.log.bindPrefix('data')));\n  }\n\n  public createDescription() {\n    return this.description || (this.description = new LocalConferenceDescription(this.connection));\n  }\n\n  public appendStreamToConference() {\n    return this.streamManager.appendToConference(this.description);\n  }\n\n  public closeConnection() {\n    const {connection} = this;\n    if(!connection) {\n      return;\n    }\n\n    try {\n      connection.log('close');\n      connection.close();\n    } catch(e) {\n      this.log.error(e);\n    }\n  }\n\n  public closeConnectionAndStream(stopStream: boolean) {\n    this.closeConnection();\n    stopStream && this.streamManager.stop();\n  }\n\n  protected abstract negotiateInternal(): CallConnectionInstanceBase['negotiating'];\n\n  public negotiate() {\n    const promise = this.negotiating;\n    if(promise) {\n      return promise;\n    }\n\n    return this.negotiating = this.negotiateInternal().finally(() => {\n      this.negotiating = undefined;\n    });\n  }\n\n  public sendDataChannelData(data: any) {\n    if(this.dataChannel.readyState !== 'open') {\n      return;\n    }\n\n    this.dataChannel.send(JSON.stringify(data));\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport {Logger, logger} from '../../logger';\n\nexport default function createPeerConnection(config: RTCConfiguration, log?: Logger) {\n  if(!log) {\n    log = logger('RTCPeerConnection');\n  }\n\n  log('constructor');\n\n  // @ts-ignore\n  const connection = new RTCPeerConnection(config);\n  connection.addEventListener('track', (event) => {\n    log('ontrack', event);\n  });\n  connection.addEventListener('signalingstatechange', () => {\n    log('onsignalingstatechange', connection.signalingState);\n  });\n  connection.addEventListener('connectionstatechange', () => {\n    log('onconnectionstatechange', connection.connectionState);\n  });\n  connection.addEventListener('negotiationneeded', () => { // * will be fired every time input device changes\n    log('onnegotiationneeded', connection.signalingState);\n  });\n  connection.addEventListener('icecandidate', (event) => {\n    log('onicecandidate', event);\n  });\n  connection.addEventListener('iceconnectionstatechange', () => {\n    log('oniceconnectionstatechange', connection.iceConnectionState);\n  });\n  connection.addEventListener('datachannel', () => {\n    log('ondatachannel');\n  });\n\n  connection.log = log;\n\n  return {connection};\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport {Logger, logger} from '../../logger';\n\nexport default function createDataChannel(connection: RTCPeerConnection, dict?: RTCDataChannelInit, log?: Logger) {\n  // return;\n\n  if(!log) {\n    log = logger('RTCDataChannel');\n  }\n\n  const channel = connection.createDataChannel('data', dict);\n\n  channel.addEventListener('message', (e) => {\n    log('onmessage', e);\n  });\n  channel.addEventListener('open', () => {\n    log('onopen');\n  });\n  channel.addEventListener('close', () => {\n    log('onclose');\n  });\n\n  channel.log = log;\n\n  return channel;\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport SDP from '../sdp';\nimport {CallSignalingData, P2PVideoCodec} from '../types';\nimport parseMediaSectionInfo from './parseMediaSectionInfo';\n\nexport default function parseSignalingData(sdp: SDP) {\n  const info = parseMediaSectionInfo(sdp, sdp.media[0]);\n\n  const data: CallSignalingData.initialSetup = {\n    '@type': 'InitialSetup',\n    'fingerprints': [info.fingerprint],\n    'ufrag': info.ufrag,\n    'pwd': info.pwd,\n    'audio': undefined,\n    'video': undefined,\n    'screencast': undefined\n  };\n\n  const convertNumber = (number: number) => '' + number;\n\n  for(const section of sdp.media) {\n    const mediaType = section.mediaType;\n    if(mediaType === 'application' || !section.isSending) {\n      continue;\n    }\n\n    const codec: P2PVideoCodec = data[mediaType === 'video' && data['video'] ? 'screencast' : mediaType] = {} as any;\n    const info = parseMediaSectionInfo(sdp, section);\n    codec.ssrc = convertNumber(info.source);\n\n    if(info.sourceGroups) {\n      codec.ssrcGroups = info.sourceGroups.map((sourceGroup) => ({semantics: sourceGroup.semantics, ssrcs: sourceGroup.sources.map(convertNumber)}));\n    }\n\n    const rtpExtensions: P2PVideoCodec['rtpExtensions'] = codec.rtpExtensions = [];\n    section.attributes.get('extmap').forEach((attribute) => {\n      rtpExtensions.push({\n        id: +attribute.key,\n        uri: attribute.value\n      });\n    });\n\n    const payloadTypesMap: Map<number, P2PVideoCodec['payloadTypes'][0]> = new Map();\n\n    const getPayloadType = (id: number) => {\n      let payloadType = payloadTypesMap.get(id);\n      if(!payloadType) {\n        payloadTypesMap.set(id, payloadType = {\n          id\n        } as any);\n      }\n\n      return payloadType;\n    };\n\n    section.attributes.get('rtpmap').forEach((attribute) => {\n      const id = +attribute.key;\n      const payloadType = getPayloadType(id);\n      const splitted = attribute.value.split('/');\n      const [name, clockrate, channels] = splitted;\n      payloadType.name = name;\n      payloadType.clockrate = +clockrate;\n      payloadType.channels = channels ? +channels : 0;\n    });\n\n    section.attributes.get('rtcp-fb').forEach((attribute) => {\n      const id = +attribute.key;\n      const payloadType = getPayloadType(id);\n      payloadType.feedbackTypes = attribute.lines.map((line) => {\n        const splitted = line.split(' ');\n        const [type, subtype] = splitted;\n        return {\n          type,\n          subtype: subtype || ''\n        };\n      });\n    });\n\n    section.attributes.get('fmtp').forEach((attribute) => {\n      const id = +attribute.key;\n      const payloadType = getPayloadType(id);\n      const parameters: P2PVideoCodec['payloadTypes'][0]['parameters'] = payloadType.parameters = {};\n      const splitted = attribute.value.split(';');\n      for(const str of splitted) {\n        const [key, value] = str.split('=');\n        parameters[key] = value;\n      }\n    });\n\n    codec.payloadTypes = Array.from(payloadTypesMap.values());\n\n    /* if(codec.payloadTypes.length > 5) {\n      codec.payloadTypes.length = Math.min(codec.payloadTypes.length, 5);\n    } */\n  }\n\n  return data;\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport CallConnectionInstanceBase, {CallConnectionInstanceOptions} from './callConnectionInstanceBase';\nimport CallInstance from './callInstance';\nimport parseSignalingData from './helpers/parseSignalingData';\nimport {parseSdp} from './sdp/utils';\n\nexport default class CallConnectionInstance extends CallConnectionInstanceBase {\n  private call: CallInstance;\n\n  constructor(options: CallConnectionInstanceOptions & {\n    call: CallConnectionInstance['call']\n  }) {\n    super(options);\n  }\n\n  protected async negotiateInternal() {\n    const {connection, call} = this;\n\n    if(!connection.localDescription && !connection.remoteDescription && !call.isOutgoing) {\n      return;\n    }\n\n    let descriptionInit: RTCSessionDescriptionInit;\n    if(call.offerReceived) {\n      call.offerReceived = false;\n\n      const answer = descriptionInit = await connection.createAnswer();\n\n      this.log('[sdp] local', answer.type, answer.sdp);\n      await connection.setLocalDescription(answer);\n\n      this.log('[InitialSetup] send 2');\n    } else {\n      const offer = descriptionInit = await connection.createOffer();\n\n      this.log('[sdp] local', offer.sdp);\n      await connection.setLocalDescription(offer);\n\n      call.offerSent = true;\n\n      this.log('[InitialSetup] send 0');\n    }\n\n    const initialSetup = parseSignalingData(parseSdp(descriptionInit.sdp));\n    call.sendCallSignalingData(initialSetup);\n  }\n}\n","const subtle = typeof(window) !== 'undefined' && 'crypto' in window ? window.crypto.subtle : self.crypto.subtle;\n\nexport default subtle;\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n *\n * Originally from:\n * https://github.com/evgeny-nadymov/telegram-react\n * Copyright (C) 2018 Evgeny Nadymov\n * https://github.com/evgeny-nadymov/telegram-react/blob/master/LICENSE\n */\n\nimport bufferConcats from '../../../helpers/bytes/bufferConcats';\nimport subtle from '../../crypto/subtle';\nimport sha256 from '../../crypto/utils/sha256';\n\nconst kMaxIncomingPacketSize = 128 * 1024 * 1024;\n\nexport default class P2PEncryptor {\n  private type: 'Signaling';\n  private counter: number;\n  private seqMap: Map<number, number>;\n\n  constructor(private isOutgoing: boolean, private p2pKey: Uint8Array) {\n    this.type = 'Signaling';\n    this.counter = 0;\n    this.seqMap = new Map();\n  }\n\n  private concatSHA256(parts: Uint8Array[]) {\n    return sha256(bufferConcats(...parts));\n  }\n\n  private async encryptPrepared(buffer: Uint8Array) {\n    const result = {\n      counter: 0, // this.counterFromSeq(this.readSeq(buffer)),\n      bytes: new Uint8Array(16 + buffer.length)\n    };\n\n    const x = (this.isOutgoing ? 0 : 8) + (this.type === 'Signaling' ? 128 : 0);\n    const key = this.p2pKey;\n\n    const msgKeyLarge = await this.concatSHA256([key.subarray(x + 88, x + 88 + 32), buffer]);\n    const msgKey = result.bytes;\n    for(let i = 0; i < 16; ++i) {\n      msgKey[i] = msgKeyLarge[i + 8];\n    }\n\n    const aesKeyIv = await this.prepareAesKeyIv(key, msgKey, x);\n\n    const bytes = await this.aesProcessCtr(buffer, buffer.length, aesKeyIv, true);\n\n    result.bytes = new Uint8Array([...result.bytes.subarray(0, 16), ...bytes]);\n\n    return result;\n  }\n\n  public encryptRawPacket(buffer: Uint8Array) {\n    const seq = ++this.counter;\n    const arr = new ArrayBuffer(4);\n    const view = new DataView(arr);\n    view.setUint32(0, seq >>> 0, false); // byteOffset = 0; litteEndian = false\n\n    const result = new Uint8Array([...new Uint8Array(arr), ...buffer]);\n\n    return this.encryptPrepared(result);\n  }\n\n  private async prepareAesKeyIv(key: Uint8Array, msgKey: Uint8Array, x: number) {\n    const [sha256a, sha256b] = await Promise.all([\n      this.concatSHA256([\n        msgKey.subarray(0, 16),\n        key.subarray(x, x + 36)\n      ]),\n\n      this.concatSHA256([\n        key.subarray(40 + x, 40 + x + 36),\n        msgKey.subarray(0, 16)\n      ])\n    ]);\n\n    return {\n      key: new Uint8Array([\n        ...sha256a.subarray(0, 8),\n        ...sha256b.subarray(8, 8 + 16),\n        ...sha256a.subarray(24, 24 + 8)\n      ]),\n      iv: new Uint8Array([\n        ...sha256b.subarray(0, 4),\n        ...sha256a.subarray(8, 8 + 8),\n        ...sha256b.subarray(24, 24 + 4)\n      ])\n    };\n  }\n\n  private async aesProcessCtr(encryptedData: Uint8Array, dataSize: number, aesKeyIv: {key: Uint8Array, iv: Uint8Array}, encrypt = true) {\n    const cryptoKey = await subtle.importKey(\n      'raw',\n      aesKeyIv.key,\n      {name: 'AES-CTR'},\n      false,\n      [encrypt ? 'encrypt' : 'decrypt']\n    );\n\n    const buffer: ArrayBuffer = await subtle[encrypt ? 'encrypt' : 'decrypt']({\n      name: 'AES-CTR',\n      counter: aesKeyIv.iv,\n      length: aesKeyIv.iv.length * 8\n    },\n    cryptoKey,\n    encryptedData\n    );\n\n    return new Uint8Array(buffer);\n  }\n\n  private constTimeIsDifferent(a: Uint8Array, b: Uint8Array, count: number) {\n    let msgKeyEquals = true;\n    for(let i = 0; i < count; ++i) {\n      if(a[i] !== b[i]) {\n        msgKeyEquals = false;\n      }\n    }\n\n    return !msgKeyEquals;\n  }\n\n  public async decryptRawPacket(buffer: Uint8Array) {\n    if(buffer.length < 21 || buffer.length > kMaxIncomingPacketSize) {\n      return;\n    }\n\n    const {isOutgoing, type} = this;\n\n    const x = (isOutgoing ? 8 : 0) + (type === 'Signaling' ? 128 : 0);\n    const key = this.p2pKey;\n\n    const msgKey = buffer.subarray(0, 16);\n    const encryptedData = buffer.subarray(16);\n    const encryptedDataSize = buffer.length - 16;\n\n    const aesKeyIv = await this.prepareAesKeyIv(key, msgKey, x);\n\n    const decryptionBuffer = await this.aesProcessCtr(encryptedData, encryptedDataSize, aesKeyIv, false);\n\n    const msgKeyLarge = await this.concatSHA256([\n      key.subarray(88 + x, 88 + x + 32),\n      decryptionBuffer\n    ]);\n\n    if(this.constTimeIsDifferent(msgKeyLarge.subarray(8), msgKey, 16)) {\n      return;\n    }\n\n    const dataView = new DataView(decryptionBuffer.buffer);\n    const seq = dataView.getUint32(0);\n    if(this.seqMap.has(seq)) {\n      return;\n    }\n    this.seqMap.set(seq, seq);\n\n    return decryptionBuffer.slice(4);\n  }\n}\n","import convertToUint8Array from '../../../helpers/bytes/convertToUint8Array';\nimport subtle from '../subtle';\n// import sha256 from '@cryptography/sha256';\n\nexport default function sha256(bytes: Parameters<typeof convertToUint8Array>[0]) {\n  return subtle.digest('SHA-256', convertToUint8Array(bytes)).then((b) => {\n    // console.log('legacy', performance.now() - perfS);\n    return new Uint8Array(b);\n  });\n  /* //console.log('SHA-256 hash start');\n\n  let perfS = performance.now();\n\n\n  let perfD = performance.now();\n  let words = typeof(bytes) === 'string' ? bytes : bytesToWordss(bytes as any);\n  let hash = sha256(words);\n  console.log('darutkin', performance.now() - perfD);\n\n  //console.log('SHA-256 hash finish', hash, sha256(words, 'hex'));\n\n  return bytesFromWordss(hash); */\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n *\n * Originally from:\n * https://github.com/evgeny-nadymov/telegram-react\n * Copyright (C) 2018 Evgeny Nadymov\n * https://github.com/evgeny-nadymov/telegram-react/blob/master/LICENSE\n */\n\nimport StringFromLineBuilder from '../stringFromLineBuilder';\nimport {addDataChannel, addExtmap, addPayloadTypes, addSsrc} from './p2PSdpBuilder';\n\nexport default class ChromeP2PSdpBuilder {\n  static generateOffer(info: any) {\n    const {fingerprints, ufrag, pwd, audio, video} = info;\n    audio.type = 'audio';\n    video.type = 'video';\n    const media = [audio, video];\n\n    const stringBuilder = new StringFromLineBuilder();\n    stringBuilder.add(\n      'v=0',\n      'o=- 1 2 IN IP4 127.0.0.1',\n      's=-',\n      't=0 0'\n    );\n\n    if(fingerprints) {\n      fingerprints.forEach((x: any) => {\n        const {hash, fingerprint, setup} = x;\n        stringBuilder.add(\n          `a=fingerprint:${hash} ${fingerprint}`,\n          `a=setup:${setup}`\n        );\n      });\n    }\n    if(ufrag && pwd) {\n      stringBuilder.add(\n        `a=ice-ufrag:${ufrag}`,\n        `a=ice-pwd:${pwd}`\n      );\n    }\n\n    stringBuilder.add(\n      'a=group:BUNDLE 0 1 2',\n      'a=extmap-allow-mixed',\n      'a=msid-semantic: WMS *'\n    );\n    const streamName = 'stream' + media.map((x) => x.ssrc).join('_');\n    for(let i = 0; i < media.length; i++) {\n      const m = media[i];\n      const {type, ssrc, ssrcGroups, payloadTypes, rtpExtensions} = m;\n      switch(type) {\n        case 'audio': {\n          stringBuilder.add(\n            `m=audio 56930 UDP/TLS/RTP/SAVPF ${payloadTypes.map((x: any) => x.id).join(' ')}`,\n            'c=IN IP4 0.0.0.0',\n            'a=rtcp:9 IN IP4 0.0.0.0',\n            'a=ice-options:trickle',\n            `a=mid:${i}`,\n            'a=sendrecv',\n            addExtmap(rtpExtensions)\n          );\n          if(ssrc) {\n            stringBuilder.add(`a=msid:${streamName} audio${ssrc}`);\n          }\n          stringBuilder.add(\n            'a=rtcp-mux',\n            addPayloadTypes(payloadTypes),\n            addSsrc(type, ssrc, ssrcGroups, streamName)\n          );\n\n          break;\n        }\n\n        case 'video': {\n          stringBuilder.add(\n            `m=video 61986 UDP/TLS/RTP/SAVPF ${payloadTypes.map((x: any) => x.id).join(' ')}`,\n            'c=IN IP4 0.0.0.0',\n            'a=rtcp:9 IN IP4 0.0.0.0',\n            'a=ice-options:trickle',\n            `a=mid:${i}`,\n            'a=sendrecv',\n            addExtmap(rtpExtensions)\n          );\n          if(ssrc) {\n            stringBuilder.add(`a=msid:${streamName} video${ssrc}`);\n          }\n          stringBuilder.add(\n            'a=rtcp-mux',\n            'a=rtcp-rsize',\n            addPayloadTypes(payloadTypes),\n            addSsrc(type, ssrc, ssrcGroups, streamName)\n          );\n          break;\n        }\n      }\n    }\n    stringBuilder.add(addDataChannel(2));\n    return stringBuilder.finalize();\n  }\n\n  static generateAnswer(info: any) {\n    const {fingerprints, ufrag, pwd, audio, video} = info;\n    audio.type = 'audio';\n    video.type = 'video';\n    const media = [audio, video];\n\n    const stringBuilder = new StringFromLineBuilder();\n    stringBuilder.add(\n      'v=0',\n      'o=- 1 2 IN IP4 127.0.0.1',\n      's=-',\n      't=0 0'\n    );\n\n    if(fingerprints) {\n      fingerprints.forEach((x: any) => {\n        const {hash, fingerprint, setup} = x;\n        stringBuilder.add(\n          `a=fingerprint:${hash} ${fingerprint}`,\n          `a=setup:${setup}`\n        );\n      });\n    }\n    if(ufrag && pwd) {\n      stringBuilder.add(\n        `a=ice-ufrag:${ufrag}`,\n        `a=ice-pwd:${pwd}`\n      );\n    }\n\n    stringBuilder.add(\n      'a=group:BUNDLE 0 1 2',\n      'a=extmap-allow-mixed',\n      'a=msid-semantic: WMS *'\n    );\n    const streamName = 'stream' + media.map((x) => x.ssrc).join('_');\n    for(let i = 0; i < media.length; i++) {\n      const m = media[i];\n      const {type, ssrc, ssrcGroups, payloadTypes, rtpExtensions} = m;\n      switch(type) {\n        case 'audio': {\n          stringBuilder.add(\n            `m=audio 56930 UDP/TLS/RTP/SAVPF ${payloadTypes.map((x: any) => x.id).join(' ')}`,\n            'c=IN IP4 0.0.0.0',\n            'a=rtcp:9 IN IP4 0.0.0.0',\n            'a=ice-options:trickle',\n            `a=mid:${i}`,\n            'a=sendrecv',\n            addExtmap(rtpExtensions)\n          );\n          if(ssrc) {\n            stringBuilder.add(`a=msid:${streamName} audio${ssrc}`);\n          }\n          stringBuilder.add(\n            'a=rtcp-mux',\n            addPayloadTypes(payloadTypes),\n            addSsrc(type, ssrc, ssrcGroups, streamName)\n          );\n          break;\n        }\n\n        case 'video': {\n          stringBuilder.add(\n            `m=video 61986 UDP/TLS/RTP/SAVPF ${payloadTypes.map((x: any) => x.id).join(' ')}`,\n            'c=IN IP4 0.0.0.0',\n            'a=rtcp:9 IN IP4 0.0.0.0',\n            'a=ice-options:trickle',\n            `a=mid:${i}`,\n            'a=sendrecv',\n            addExtmap(rtpExtensions)\n          );\n          if(ssrc) {\n            stringBuilder.add(`a=msid:${streamName} video${ssrc}`);\n          }\n\n          stringBuilder.add(\n            'a=rtcp-mux',\n            'a=rtcp-rsize',\n            addPayloadTypes(payloadTypes),\n            addSsrc(type, ssrc, ssrcGroups, streamName)\n          );\n          break;\n        }\n      }\n    }\n    stringBuilder.add(addDataChannel(2));\n    return stringBuilder.finalize();\n  }\n}\n","/*\n*  Copyright (c) 2018-present, Evgeny Nadymov\n*\n* This source code is licensed under the GPL v.3.0 license found in the\n* LICENSE file in the root directory of this source tree.\n*/\n\nimport ChromeP2PSdpBuilder from './chromeP2PSdpBuilder';\nimport { FirefoxP2PSdpBuilder } from './firefoxP2PSdpBuilder';\nimport { SafariP2PSdpBuilder } from './safariP2PSdpBuilder';\n// import { TG_CALLS_SDP_STRING } from '../../Stores/CallStore';\n\nexport function p2pParseCandidate(candidate) {\n  if(!candidate || !candidate.startsWith('candidate:')) {\n    return;\n  }\n  \n  const sdpString = candidate;\n  candidate = candidate.substr('candidate:'.length);\n  \n  const [foundation, component, protocol, priority, ip, port, ...other] = candidate.split(' ');\n  const c = {\n    sdpString,\n    foundation,\n    component,\n    protocol,\n    priority,\n    address: { ip, port }\n  };\n  \n  for(let i = 0; i < other.length; i += 2) {\n    switch(other[i]) {\n      case 'typ': {\n        c.type = other[i + 1];\n        break;\n      }\n      case 'raddr': {\n        if(!c.relAddress) {\n          c.relAddress = {};\n        }\n        \n        c.relAddress.ip = other[i + 1];\n        break;\n      }\n      case 'rport': {\n        if(!c.relAddress) {\n          c.relAddress = {};\n        }\n        \n        c.relAddress.port = other[i + 1];\n        break;\n      }\n      case 'generation': {\n        c.generation = other[i + 1];\n        break;\n      }\n      case 'tcptype': {\n        c.tcpType = other[i + 1];\n        break;\n      }\n      case 'network-id': {\n        c.networkId = other[i + 1];\n        break;\n      }\n      case 'network-cost': {\n        c.networkCost = other[i + 1];\n        break;\n      }\n      case 'ufrag': {\n        c.username = other[i + 1];\n        break;\n      }\n    }\n  }\n  \n  return c;\n}\n\nexport function p2pParseSdp(sdp) {\n  const lines = sdp.split('\\r\\n');\n  const lookup = (prefix, force = true, lineFrom = 0, lineTo = Number.MAX_VALUE) => {\n    if (lineTo === -1) {\n      lineTo = Number.MAX_VALUE;\n    }\n    for (let i = lineFrom; i < lines.length && i < lineTo; i++) {\n      const line = lines[i];\n      if (line.startsWith(prefix)) {\n        return line.substr(prefix.length);\n      }\n    }\n    \n    if (force) {\n      console.error(\"Can't find prefix\", prefix);\n    }\n    \n    return null;\n  };\n  const findIndex = (prefix, lineFrom = 0, lineTo = Number.MAX_VALUE) => {\n    if (lineTo === -1) {\n      lineTo = Number.MAX_VALUE;\n    }\n    for (let i = lineFrom; i < lines.length && i < lineTo; i++) {\n      const line = lines[i];\n      if (line.startsWith(prefix)) {\n        return i;\n      }\n    }\n    \n    return -1;\n  };\n  \n  const pwdIndex = findIndex('a=ice-pwd:');\n  const ufragIndex = findIndex('a=ice-ufrag:');\n  if (pwdIndex === -1 && ufragIndex === -1) {\n    return {\n      // sessionId: lookup('o=').split(' ')[1],\n      ufrag: null,\n      pwd: null,\n      fingerprints: []\n    };\n  }\n  \n  const info = {\n    // sessionId: lookup('o=').split(' ')[1],\n    ufrag: null,\n    pwd: null,\n    fingerprints: []\n  };\n  \n  let mediaIndex = findIndex('m=');\n  const fingerprint = lookup('a=fingerprint:', false);\n  const setup = lookup('a=setup:', false);\n  if (fingerprint && setup) {\n    info.fingerprints.push({\n      hash: fingerprint.split(' ')[0],\n      fingerprint: fingerprint.split(' ')[1],\n      setup\n    });\n  }\n  \n  const ufrag = lookup('a=ice-ufrag:', false);\n  const pwd = lookup('a=ice-pwd:', false);\n  if (ufrag && pwd) {\n    info.ufrag = ufrag;\n    info.pwd = pwd;\n  }\n  \n  while (mediaIndex !== -1) {\n    let nextMediaIndex = findIndex('m=', mediaIndex + 1);\n    \n    const extmap = [];\n    const types = [];\n    const mediaType = lookup('m=', true, mediaIndex, nextMediaIndex).split(' ')[0];\n    const media = {\n      // type: lookup('m=', true, mediaIndex, nextMediaIndex).split(' ')[0],\n      // mid: lookup('a=mid:', true, mediaIndex, nextMediaIndex),\n      // dir: findDirection(mediaIndex, nextMediaIndex),\n      rtpExtensions: extmap,\n      payloadTypes: types\n    }\n    \n    const lineTo = nextMediaIndex === -1 ? lines.length : nextMediaIndex;\n    const fmtp = new Map();\n    const rtcpFb = new Map();\n    for (let i = mediaIndex; i < lineTo; i++) {\n      const line = lines[i];\n      if (line.startsWith('a=extmap:')) {\n        const [ id, uri ] = line.substr('a=extmap:'.length).split(' ');\n        extmap.push({ id: parseInt(id), uri });\n      } else if (line.startsWith('a=fmtp:')) {\n        const [ id, str ] = line.substr('a=fmtp:'.length).split(' ');\n        const obj = { };\n        const arr =  str.split(';').map(x => {\n          const [ key, value ] = x.split('=');\n          obj[key] = value;\n          return { [key]: value };\n        });\n        fmtp.set(parseInt(id), obj);\n      } else if (line.startsWith('a=rtcp-fb:')) {\n        const [ id, type = '', subtype = '' ] = line.substr('a=rtcp-fb:'.length).split(' ');\n        if (rtcpFb.has(parseInt(id))) {\n          rtcpFb.get(parseInt(id)).push({ type, subtype });\n        } else {\n          rtcpFb.set(parseInt(id), [{ type, subtype }])\n        }\n      } else if (line.startsWith('a=rtpmap')) {\n        const [ id, str ] = line.substr('a=rtpmap:'.length).split(' ');\n        const [ name, clockrate, channels = '0' ] = str.split('/');\n        const obj = { id: parseInt(id), name, clockrate: parseInt(clockrate), channels: parseInt(channels) };\n        \n        types.push(obj);\n      }\n    }\n    \n    for (let i = 0; i < types.length; i++) {\n      const { id } = types[i];\n      if (rtcpFb.has(id)) {\n        types[i].feedbackTypes = rtcpFb.get(id);\n      }\n      if (fmtp.has(id)) {\n        types[i].parameters = fmtp.get(id);\n      }\n    }\n    \n    const ssrc = lookup('a=ssrc:', false, mediaIndex, nextMediaIndex);\n    if (ssrc) {\n      media.ssrc = ssrc.split(' ')[0];\n    }\n    \n    const ssrcGroup = lookup('a=ssrc-group:', false, mediaIndex, nextMediaIndex);\n    if (ssrcGroup) {\n      const [ semantics, ...ssrcs ] = ssrcGroup.split(' ');\n      media.ssrcGroups = [{\n        semantics,\n        ssrcs\n      }]\n    }\n    \n    switch (mediaType) {\n      case 'audio': {\n        info.audio = media;\n        break;\n      }\n      case 'video': {\n        info.video = media;\n        break;\n      }\n    }\n    \n    mediaIndex = nextMediaIndex;\n  }\n\n  if(!info.video.ssrcGroups) {\n    info.video.ssrcGroups = [];\n  }\n\n  info['@type'] = 'InitialSetup';\n  \n  // console.log('[p2pParseSdp]', sdp, info);\n  return info;\n}\n\nexport function isFirefox() {\n  return navigator.userAgent.toLowerCase().indexOf('firefox') > -1;\n}\n\nfunction isSafari() {\n  return navigator.userAgent.toLowerCase().indexOf('safari') > -1 && navigator.userAgent.toLowerCase().indexOf('chrome') === -1;\n}\n\nexport function addExtmap(extmap) {\n  let sdp = [];\n  // return sdp;\n  for (let j = 0; j < extmap.length; j++) {\n    const ext = extmap[j];\n    const { id, uri } = ext;\n    // if (isFirefox() && uri.indexOf(''))\n    console.log('[extmap] add', id, uri);\n    sdp.push(`a=extmap:${id} ${uri}`);\n  }\n  \n  return sdp.join('\\n');\n}\n\nexport function addPayloadTypes(types) {\n  let sdp = [];\n  console.log('[SDP] addPayloadTypes', types);\n  for (let i = 0; i < types.length; i++) {\n    const type = types[i];\n    const { id, name, clockrate, channels, feedbackTypes, parameters } = type;\n    sdp.push(`a=rtpmap:${id} ${name}/${clockrate}${channels ? '/' + channels : ''}`);\n    if (feedbackTypes) {\n      feedbackTypes.forEach(x => {\n        const { type, subtype } = x;\n        sdp.push(`a=rtcp-fb:${id} ${[type, subtype].join(' ')}`);\n      });\n    }\n    if (parameters) {\n      const fmtp = [];\n      Object.getOwnPropertyNames(parameters).forEach(pName => {\n        fmtp.push(`${pName}=${parameters[pName]}`);\n      });\n      \n      sdp.push(`a=fmtp:${id} ${fmtp.join(';')}`);\n    }\n  }\n  \n  return sdp.join('\\n');\n}\n\nexport function addSsrc(type, ssrc, ssrcGroups, streamName) {\n  let sdp = [];\n  \n  if (ssrcGroups && ssrcGroups.length > 0) {\n    ssrcGroups.forEach(ssrcGroup => {\n      if (ssrcGroup && ssrcGroup.ssrcs.length > 0) {\n        sdp.push(`a=ssrc-group:${ssrcGroup.semantics} ${ssrcGroup.ssrcs.join(' ')}`);\n        ssrcGroup.ssrcs.forEach(ssrc => {\n          sdp.push(\n            `a=ssrc:${ssrc} cname:stream${ssrc}`,\n            `a=ssrc:${ssrc} msid:${streamName} ${type}${ssrc}`,\n            `a=ssrc:${ssrc} mslabel:${type}${ssrc}`,\n            `a=ssrc:${ssrc} label:${type}${ssrc}`\n          );\n        });\n      }\n    });\n  } else if (ssrc) {\n    sdp.push(\n      `a=ssrc:${ssrc} cname:stream${ssrc}`,\n      `a=ssrc:${ssrc} msid:${streamName} ${type}${ssrc}`,\n      `a=ssrc:${ssrc} mslabel:${type}${ssrc}`,\n      `a=ssrc:${ssrc} label:${type}${ssrc}`\n    );\n  }\n  \n  return sdp.join('\\n');\n}\n\nexport function addDataChannel(mid) {\n  return `m=application 9 UDP/DTLS/SCTP webrtc-datachannel\nc=IN IP4 0.0.0.0\na=ice-options:trickle\na=mid:2\na=sctp-port:5000\na=max-message-size:262144`;\n}\n\nexport class P2PSdpBuilder {\n  static generateCandidate(info) {\n    if (!info) return null;\n    \n    const { sdpString, sdpMLineIndex, sdpMid, foundation, component, protocol, priority, address, type, relAddress, generation, tcpType, networkId, networkCost, username } = info;\n    if (/* TG_CALLS_SDP_STRING */true) {\n      if (sdpString) {\n        return {\n          candidate: sdpString,\n          sdpMLineIndex,\n          sdpMid\n        };\n      }\n    }\n    throw 'no sdpString';\n    \n    let candidate = `candidate:${foundation} ${component} ${protocol} ${priority} ${address.ip} ${address.port}`;\n    const attrs = []\n    if (type) {\n      attrs.push(`typ ${type}`);\n    }\n    if (relAddress) {\n      attrs.push(`raddr ${relAddress.ip}`);\n      attrs.push(`rport ${relAddress.port}`);\n    }\n    if (tcpType) {\n      attrs.push(`tcptype ${tcpType}`);\n    }\n    if (generation) {\n      attrs.push(`generation ${generation}`);\n    }\n    if (username) {\n      attrs.push(`ufrag ${username}`);\n    }\n    if (networkId) {\n      attrs.push(`network-id ${networkId}`);\n    }\n    if (networkCost) {\n      attrs.push(`network-cost ${networkCost}`);\n    }\n    if (attrs.length > 0) {\n      candidate += ` ${attrs.join(' ')}`;\n    }\n    \n    return { candidate, sdpMid, sdpMLineIndex };\n  }\n  \n  static generateOffer(info) {\n    if (isFirefox()) {\n      return FirefoxP2PSdpBuilder.generateOffer(info);\n    } else if (isSafari()) {\n      return SafariP2PSdpBuilder.generateOffer(info);\n    }\n    \n    return ChromeP2PSdpBuilder.generateOffer(info);\n  }\n  \n  static generateAnswer(info) {\n    if (isFirefox()) {\n      return FirefoxP2PSdpBuilder.generateAnswer(info);\n    } else if (isSafari()) {\n      return SafariP2PSdpBuilder.generateAnswer(info);\n    }\n    \n    return ChromeP2PSdpBuilder.generateAnswer(info);\n  }\n}","/*\n *  Copyright (c) 2018-present, Evgeny Nadymov\n *\n * This source code is licensed under the GPL v.3.0 license found in the\n * LICENSE file in the root directory of this source tree.\n */\n\nimport { addDataChannel, addExtmap, addPayloadTypes, addSsrc } from './p2PSdpBuilder';\n\nexport class FirefoxP2PSdpBuilder {\n    static generateOffer(info) {\n        const { fingerprints, ufrag, pwd, audio, video } = info;\n        audio.type = 'audio';\n        video.type = 'video';\n        const media = [audio, video];\n\n        let sdp = `v=0\no=- 1 0 IN IP4 0.0.0.0\ns=-\nt=0 0`;\n        if (fingerprints) {\n            fingerprints.forEach(x => {\n                const { hash, fingerprint, setup } = x;\n                sdp += `\na=fingerprint:${hash} ${fingerprint}\na=setup:${setup}`;\n            });\n        }\n        if (ufrag && pwd) {\n            sdp += `\na=ice-ufrag:${ufrag}\na=ice-pwd:${pwd}`;\n        }\n\n        sdp += `\na=group:BUNDLE 0 1 2\na=ice-options:trickle\na=msid-semantic:WMS *`;\n        const streamName = 'stream' + media.map(x => x.ssrc).join('_');\n        for (let i = 0; i < media.length; i++) {\n            const m = media[i];\n            const { type, ssrc, ssrcGroups, payloadTypes, rtpExtensions } = m;\n            switch (type) {\n                case 'audio': {\n                    sdp += `\nm=audio 9 UDP/TLS/RTP/SAVPF ${payloadTypes.map(x => x.id).join(' ')}\nc=IN IP4 0.0.0.0\na=mid:${i}\na=sendrecv`;\n                    sdp += addExtmap(rtpExtensions);\n                    sdp += `\na=rtcp-mux`;\n                    sdp += addPayloadTypes(payloadTypes);\n                    sdp += addSsrc(type, ssrc, ssrcGroups, streamName);\n\n                    break;\n                }\n                case 'video': {\n                    sdp += `\nm=video 9 UDP/TLS/RTP/SAVPF ${payloadTypes.map(x => x.id).join(' ')}\nc=IN IP4 0.0.0.0\na=mid:${i}\na=sendrecv`;\n                    sdp += addExtmap(rtpExtensions);\n                    sdp += `\na=rtcp-mux\na=rtcp-rsize`;\n                    sdp += addPayloadTypes(payloadTypes);\n                    sdp += addSsrc(type, ssrc, ssrcGroups, streamName);\n\n                    break;\n                }\n            }\n        }\n        sdp += addDataChannel(2);\n        sdp += `\n`;\n\n        return sdp;\n    }\n\n    static generateAnswer(info) {\n        const { fingerprints, ufrag, pwd, audio, video } = info;\n        audio.type = 'audio';\n        video.type = 'video';\n        const media = [audio, video];\n\n        let sdp = `v=0\no=- 1 0 IN IP4 0.0.0.0\ns=-\nt=0 0`;\n        if (fingerprints) {\n            fingerprints.forEach(x => {\n                const { hash, fingerprint, setup } = x;\n                sdp += `\na=fingerprint:${hash} ${fingerprint}\na=setup:${setup}`;\n            });\n        }\n        if (ufrag && pwd) {\n            sdp += `\na=ice-ufrag:${ufrag}\na=ice-pwd:${pwd}`;\n        }\n\n        sdp += `\na=group:BUNDLE 0 1 2\na=ice-options:trickle\na=msid-semantic:WMS *`;\n        const streamName = 'stream' + media.map(x => x.ssrc).join('_');\n        for (let i = 0; i < media.length; i++) {\n            const m = media[i];\n            const { type, mid, ssrc, ssrcGroups, payloadTypes, dir, rtpExtensions } = m;\n            switch (type) {\n                case 'audio': {\n                    sdp += `\nm=audio 9 UDP/TLS/RTP/SAVPF ${payloadTypes.map(x => x.id).join(' ')}\nc=IN IP4 0.0.0.0\na=mid:${i}\na=sendrecv`;\n                    sdp += addExtmap(rtpExtensions);\n                    sdp += `\na=rtcp-mux`;\n                    sdp += addPayloadTypes(payloadTypes);\n                    sdp += addSsrc(type, ssrc, ssrcGroups, streamName);\n\n                    break;\n                }\n                case 'video': {\n                    sdp += `\nm=video 9 UDP/TLS/RTP/SAVPF ${payloadTypes.map(x => x.id).join(' ')}\nc=IN IP4 0.0.0.0\na=mid:${i}\na=sendrecv`;\n                    sdp += addExtmap(rtpExtensions);\n                    sdp += `\na=rtcp-mux\na=rtcp-rsize`;\n                    sdp += addPayloadTypes(payloadTypes);\n                    sdp += addSsrc(type, ssrc, ssrcGroups, streamName);\n                    break;\n                }\n            }\n        }\n        sdp += addDataChannel(2);\n        sdp += `\n`;\n\n        return sdp;\n    }\n}","/*\n *  Copyright (c) 2018-present, Evgeny Nadymov\n *\n * This source code is licensed under the GPL v.3.0 license found in the\n * LICENSE file in the root directory of this source tree.\n */\n\nimport { addDataChannel, addExtmap, addPayloadTypes, addSsrc } from './p2PSdpBuilder';\n\nexport class SafariP2PSdpBuilder {\n    static generateOffer(info) {\n        const { fingerprints, ufrag, pwd, audio, video } = info;\n        audio.type = 'audio';\n        video.type = 'video';\n        const media = [audio, video];\n\n        if (!media.length) {\n            return `v=0\no=- 1 2 IN IP4 127.0.0.1\ns=-\nt=0 0\na=msid-semantic: WMS\n`;\n        }\n\n        let sdp = `v=0\no=- 1 2 IN IP4 127.0.0.1\ns=-\nt=0 0`;\n        if (fingerprints) {\n            fingerprints.forEach(x => {\n                const { hash, fingerprint, setup } = x;\n                sdp += `\na=fingerprint:${hash} ${fingerprint}\na=setup:${setup}`;\n            });\n        }\n        if (ufrag && pwd) {\n            sdp += `\na=ice-ufrag:${ufrag}\na=ice-pwd:${pwd}`;\n        }\n\n        sdp += `\na=group:BUNDLE 0 1 2\na=extmap-allow-mixed\na=msid-semantic: WMS *`;\n        const streamName = 'stream' + media.map(x => x.ssrc).join('_');\n        for (let i = 0; i < media.length; i++) {\n            const m = media[i];\n            const { type, ssrc, ssrcGroups, payloadTypes, rtpExtensions } = m;\n            switch (type) {\n                case 'audio': {\n                    sdp += `\nm=audio 9 UDP/TLS/RTP/SAVPF ${payloadTypes.map(x => x.id).join(' ')}\nc=IN IP4 0.0.0.0\na=rtcp:9 IN IP4 0.0.0.0\na=ice-options:trickle\na=mid:${i}\na=sendrecv`;\n                    sdp += addExtmap(rtpExtensions);\n                    if (ssrc) {\n                        sdp += `\na=msid:${streamName} audio${ssrc}`;\n                    }\n                    sdp += `\na=rtcp-mux`;\n                    sdp += addPayloadTypes(payloadTypes);\n                    sdp += addSsrc(type, ssrc, ssrcGroups, streamName);\n\n                    break;\n                }\n                case 'video': {\n                    sdp += `\nm=video 9 UDP/TLS/RTP/SAVPF ${payloadTypes.map(x => x.id).join(' ')}\nc=IN IP4 0.0.0.0\na=rtcp:9 IN IP4 0.0.0.0\na=ice-options:trickle\na=mid:${i}\na=sendrecv`;\n                    sdp += addExtmap(rtpExtensions);\n                    if (ssrc) {\n                        sdp += `\na=msid:${streamName} video${ssrc}`;\n                    }\n                    sdp += `\na=rtcp-mux\na=rtcp-rsize`;\n                    sdp += addPayloadTypes(payloadTypes);\n                    sdp += addSsrc(type, ssrc, ssrcGroups, streamName);\n                    break;\n                }\n            }\n        }\n        sdp += addDataChannel(2);\n        sdp += `\n`;\n\n        return sdp;\n    }\n\n    static generateAnswer(info) {\n        const { fingerprints, ufrag, pwd, audio, video } = info;\n        audio.type = 'audio';\n        video.type = 'video';\n        const media = [audio, video];\n\n        if (!media.length) {\n            return `v=0\no=- 1 2 IN IP4 127.0.0.1\ns=-\nt=0 0\na=msid-semantic: WMS\n`;\n        }\n\n        let sdp = `v=0\no=- 1 2 IN IP4 127.0.0.1\ns=-\nt=0 0`;\n        if (fingerprints) {\n            fingerprints.forEach(x => {\n                const { hash, fingerprint, setup } = x;\n                sdp += `\na=fingerprint:${hash} ${fingerprint}\na=setup:${setup}`;\n            });\n        }\n        if (ufrag && pwd) {\n            sdp += `\na=ice-ufrag:${ufrag}\na=ice-pwd:${pwd}`;\n        }\n\n        sdp += `\na=group:BUNDLE 0 1 2\na=extmap-allow-mixed\na=msid-semantic: WMS *`;\n        const streamName = 'stream' + media.map(x => x.ssrc).join('_');\n        for (let i = 0; i < media.length; i++) {\n            const m = media[i];\n            const { type, ssrc, ssrcGroups, payloadTypes, rtpExtensions } = m;\n            switch (type) {\n                case 'audio': {\n                    sdp += `\nm=audio 9 UDP/TLS/RTP/SAVPF ${payloadTypes.map(x => x.id).join(' ')}\nc=IN IP4 0.0.0.0\na=rtcp:9 IN IP4 0.0.0.0\na=ice-options:trickle\na=mid:${i}\na=sendrecv`;\n                    sdp += addExtmap(rtpExtensions);\n                    if (ssrc) {\n                        sdp += `\na=msid:${streamName} audio${ssrc}`;\n                    }\n                    sdp += `\na=rtcp-mux`;\n                    sdp += addPayloadTypes(payloadTypes);\n                    sdp += addSsrc(type, ssrc, ssrcGroups, streamName);\n\n                    break;\n                }\n                case 'video': {\n                    sdp += `\nm=video 9 UDP/TLS/RTP/SAVPF ${payloadTypes.map(x => x.id).join(' ')}\nc=IN IP4 0.0.0.0\na=rtcp:9 IN IP4 0.0.0.0\na=ice-options:trickle\na=mid:${i}\na=sendrecv`;\n                    sdp += addExtmap(rtpExtensions);\n                    if (ssrc) {\n                        sdp += `\na=msid:${streamName} video${ssrc}`;\n                    }\n                    sdp += `\na=rtcp-mux\na=rtcp-rsize`;\n                    sdp += addPayloadTypes(payloadTypes);\n                    sdp += addSsrc(type, ssrc, ssrcGroups, streamName);\n                    break;\n                }\n            }\n        }\n        sdp += addDataChannel(2);\n        sdp += `\n`;\n\n        return sdp;\n    }\n}","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport ctx from '../../environment/ctx';\nimport {IS_SAFARI} from '../../environment/userAgent';\nimport safeAssign from '../../helpers/object/safeAssign';\nimport debounce from '../../helpers/schedulers/debounce';\nimport {GroupCallParticipantVideoSourceGroup, PhoneCall, PhoneCallDiscardReason, PhoneCallProtocol, Update} from '../../layer';\nimport {emojiFromCodePoints} from '../../vendor/emoji';\nimport type {CallId} from '../appManagers/appCallsManager';\nimport type {AppManagers} from '../appManagers/managers';\nimport {logger} from '../logger';\nimport apiManagerProxy from '../mtproto/mtprotoworker';\nimport CallConnectionInstance from './callConnectionInstance';\nimport CallInstanceBase from './callInstanceBase';\nimport callsController from './callsController';\nimport CALL_STATE from './callState';\nimport {GROUP_CALL_AMPLITUDE_ANALYSE_INTERVAL_MS} from './constants';\nimport parseSignalingData from './helpers/parseSignalingData';\nimport stopTrack from './helpers/stopTrack';\nimport localConferenceDescription, {ConferenceEntry, generateSsrc} from './localConferenceDescription';\nimport getCallProtocol from './p2P/getCallProtocol';\nimport getRtcConfiguration from './p2P/getRtcConfiguration';\nimport P2PEncryptor from './p2P/p2PEncryptor';\nimport {p2pParseCandidate, P2PSdpBuilder} from './p2P/p2PSdpBuilder';\nimport {parseSdp} from './sdp/utils';\nimport {WebRTCLineType} from './sdpBuilder';\nimport StreamManager from './streamManager';\nimport {AudioCodec, CallMediaState, CallSignalingData, DiffieHellmanInfo, P2PAudioCodec, P2PVideoCodec, VideoCodec} from './types';\n\nexport default class CallInstance extends CallInstanceBase<{\n  state: (state: CALL_STATE) => void,\n  id: (id: CallId, prevId: CallId) => void,\n  muted: (muted: boolean) => void,\n  mediaState: (mediaState: CallMediaState) => void,\n  acceptCallOverride: () => Promise<boolean>,\n}> {\n  public dh: Partial<DiffieHellmanInfo.a & DiffieHellmanInfo.b>;\n  public id: CallId;\n  public call: PhoneCall;\n  public interlocutorUserId: UserId;\n  public protocol: PhoneCallProtocol;\n  public isOutgoing: boolean;\n  public encryptionKey: Uint8Array;\n  public connectionInstance: CallConnectionInstance;\n  public encryptor: P2PEncryptor;\n  public decryptor: P2PEncryptor;\n  public candidates: RTCIceCandidate[];\n\n  public offerReceived: boolean;\n  public offerSent: boolean;\n\n  public createdParticipantEntries: boolean;\n  public release: () => Promise<void>;\n  public _connectionState: CALL_STATE;\n\n  public createdAt: number;\n  public connectedAt: number;\n  public discardReason: string;\n\n  private managers: AppManagers;\n\n  private hangUpTimeout: number;\n\n  private mediaStates: {\n    input: CallMediaState,\n    output?: CallMediaState\n  };\n\n  private sendMediaState: () => Promise<void>;\n\n  private decryptQueue: Uint8Array[];\n\n  private getEmojisFingerprintPromise: Promise<CallInstance['emojisFingerprint']>;\n  private emojisFingerprint: [string, string, string, string];\n\n  private wasStartingScreen: boolean;\n  private wasStartingVideo: boolean;\n  public wasTryingToJoin: boolean;\n\n  public streamManager: StreamManager;\n\n  constructor(options: {\n    isOutgoing: boolean,\n    interlocutorUserId: UserId,\n    managers: CallInstance['managers'],\n    protocol?: PhoneCallProtocol\n  }) {\n    super();\n\n    this.log = logger('CALL');\n\n    if(!this.protocol) {\n      this.protocol = getCallProtocol();\n    }\n\n    safeAssign(this, options);\n\n    this.createdAt = Date.now();\n    this.offerReceived = false;\n    this.offerSent = false;\n    this.decryptQueue = [];\n    this.candidates = [];\n\n    this.addEventListener('state', (state) => {\n      this.log('state', CALL_STATE[state]);\n\n      if(state === CALL_STATE.CLOSED) {\n        this.cleanup();\n      }\n    });\n\n    const streamManager = this.streamManager = new StreamManager(GROUP_CALL_AMPLITUDE_ANALYSE_INTERVAL_MS);\n    streamManager.direction = 'sendrecv';\n    streamManager.types.push('screencast');\n    if(!this.isOutgoing) {\n      streamManager.locked = true;\n      streamManager.canCreateConferenceEntry = false;\n    }\n\n    let mediaState: CallMediaState = {\n      '@type': 'MediaState',\n      'type': 'input',\n      'lowBattery': false,\n      'muted': true,\n      'screencastState': 'inactive',\n      'videoRotation': 0,\n      'videoState': 'inactive'\n    };\n\n    const self = this;\n    mediaState = new Proxy(mediaState, {\n      set: function(target, key, value) {\n        // @ts-ignore\n        target[key] = value;\n        self.setMediaState(mediaState);\n        self.sendMediaState();\n        return true;\n      }\n    });\n\n    this.mediaStates = {\n      input: mediaState\n    };\n\n    this.sendMediaState = debounce(this._sendMediaState.bind(this), 0, false, true);\n  }\n\n  get connectionState() {\n    const {_connectionState, connectionInstance} = this;\n    if(_connectionState !== undefined) {\n      return _connectionState;\n    } else if(!connectionInstance) {\n      return CALL_STATE.CONNECTING;\n    } else {\n      const {iceConnectionState} = connectionInstance.connection;\n      if(iceConnectionState === 'closed') {\n        return CALL_STATE.CLOSED;\n      } else if(iceConnectionState !== 'connected' && (!IS_SAFARI || iceConnectionState !== 'completed')) {\n        return CALL_STATE.CONNECTING;\n      } else {\n        return CALL_STATE.CONNECTED;\n      }\n    }\n  }\n\n  get sortIndex() {\n    const connectionState = this.connectionState;\n    const state = CALL_STATE.CLOSED - connectionState + 1;\n    let index = state * 10000000000000;\n    index += 2147483647000 - (connectionState === CALL_STATE.PENDING && this.isOutgoing ? 0 : this.createdAt);\n    return index;\n  }\n\n  public getVideoElement(type: CallMediaState['type']) {\n    if(type === 'input') return this.elements.get('main');\n    else {\n      const mediaState = this.getMediaState('output');\n      if(!mediaState) {\n        return;\n      }\n\n      const type: WebRTCLineType = mediaState.videoState === 'active' ? 'video' : (mediaState.screencastState === 'active' ? 'screencast' : undefined);\n      if(!type) {\n        return;\n      }\n\n      const entry = this.description.findEntry((entry) => entry.type === type);\n      if(!entry) {\n        return;\n      }\n\n      return this.elements.get('' + entry.recvEntry.source);\n    }\n  }\n\n  public async startScreenSharingInternal() {\n    try {\n      this.wasStartingScreen = true;\n      this.wasStartingVideo = false;\n      this.streamManager.types = ['audio', 'screencast'];\n      await this.requestScreen();\n    } catch(err) {\n      this.log.error('startScreenSharing error', err);\n    }\n  }\n\n  public async toggleScreenSharing() {\n    if(this.isSharingVideo) {\n      await this.stopVideoSharing();\n    }\n\n    if(this.isSharingScreen) {\n      return this.stopVideoSharing();\n    } else {\n      return this.startScreenSharingInternal();\n    }\n  }\n\n  public async startVideoSharingInternal() {\n    try {\n      this.wasStartingScreen = false;\n      this.wasStartingVideo = true;\n      this.streamManager.types = ['audio', 'video'];\n      await this.requestInputSource(false, true, false);\n    } catch(err) {\n      this.log.error('startVideoSharing error', err);\n    }\n  }\n\n  public async stopVideoSharing() {\n    const mediaState = this.getMediaState('input');\n    mediaState.videoState = mediaState.screencastState = 'inactive';\n\n    const {streamManager, description} = this;\n    const track = streamManager.inputStream.getVideoTracks()[0];\n    if(track) {\n      stopTrack(track);\n      streamManager.appendToConference(description); // clear sender track\n    }\n  }\n\n  public async toggleVideoSharing() {\n    if(this.isSharingScreen) {\n      await this.stopVideoSharing();\n    }\n\n    if(this.isSharingVideo) {\n      return this.stopVideoSharing();\n    } else {\n      return this.startVideoSharingInternal();\n    }\n  }\n\n  public getMediaState(type: CallMediaState['type']) {\n    return this.mediaStates[type];\n  }\n\n  public setMediaState(mediaState: CallMediaState) {\n    this.mediaStates[mediaState.type] = mediaState;\n    this.dispatchEvent('mediaState', mediaState);\n  }\n\n  public isSharingVideoType(type: 'video' | 'screencast') {\n    try {\n      const hasVideoTrack = super.isSharingVideo;\n      return hasVideoTrack && !!((this.wasStartingScreen && type === 'screencast') || (this.wasStartingVideo && type === 'video'));\n\n      // ! it will be used before the track appears\n      // return !!this.description.entries.find((entry) => entry.type === type && entry.transceiver.sender.track.enabled);\n    } catch(err) {\n      return false;\n    }\n  }\n\n  public get isSharingVideo() {\n    return this.isSharingVideoType('video');\n  }\n\n  public get isSharingScreen() {\n    return this.isSharingVideoType('screencast');\n  }\n\n  public get isMuted() {\n    const audioTrack = this.streamManager.inputStream.getAudioTracks()[0];\n    return !audioTrack?.enabled;\n  }\n\n  public get isClosing() {\n    const {connectionState} = this;\n    return connectionState === CALL_STATE.CLOSING || connectionState === CALL_STATE.CLOSED;\n  }\n\n  public get description(): localConferenceDescription {\n    return this.connectionInstance?.description;\n  }\n\n  public setHangUpTimeout(timeout: number, reason: PhoneCallDiscardReason['_']) {\n    this.clearHangUpTimeout();\n    this.hangUpTimeout = ctx.setTimeout(() => {\n      this.hangUpTimeout = undefined;\n      this.hangUp(reason);\n    }, timeout);\n  }\n\n  public clearHangUpTimeout() {\n    if(this.hangUpTimeout !== undefined) {\n      clearTimeout(this.hangUpTimeout);\n      this.hangUpTimeout = undefined;\n    }\n  }\n\n  public setPhoneCall(phoneCall: PhoneCall) {\n    this.call = phoneCall;\n\n    const {id} = phoneCall;\n    if(this.id !== id) {\n      const prevId = this.id;\n      this.id = id;\n      this.dispatchEvent('id', id, prevId);\n    }\n  }\n\n  public async acceptCall() {\n    const canAccept = (await Promise.all(this.dispatchResultableEvent('acceptCallOverride')))[0] ?? true;\n    if(this.isClosing || !canAccept) {\n      return;\n    }\n\n    // this.clearHangUpTimeout();\n    this.overrideConnectionState(CALL_STATE.EXCHANGING_KEYS);\n\n    const call = this.call as PhoneCall.phoneCallRequested;\n    this.requestInputSource(true, !!call.pFlags.video, false);\n\n    const g_a_hash = call.g_a_hash;\n    this.managers.appCallsManager.generateDh().then(async(dh) => {\n      this.dh = { // ! it is correct\n        g_a_hash,\n        b: dh.a,\n        g_b: dh.g_a,\n        g_b_hash: dh.g_a_hash,\n        p: dh.p\n      };\n\n      return this.managers.apiManager.invokeApi('phone.acceptCall', {\n        peer: await this.managers.appCallsManager.getCallInput(this.id),\n        protocol: this.protocol,\n        g_b: this.dh.g_b\n      });\n    }).then(async(phonePhoneCall) => {\n      await this.managers.appCallsManager.savePhonePhoneCall(phonePhoneCall);\n    }).catch((err) => {\n      this.log.error('accept call error', err);\n      // if(err.type === 'CALL_PROTOCOL_COMPAT_LAYER_INVALID') {\n\n      // }\n\n      this.hangUp('phoneCallDiscardReasonHangup');\n    });\n  }\n\n  public joinCall() {\n    this.log('joinCall');\n\n    this.getEmojisFingerprint();\n\n    this.overrideConnectionState();\n\n    const {isOutgoing, encryptionKey, streamManager} = this;\n\n    const configuration = getRtcConfiguration(this.call as PhoneCall.phoneCall);\n    this.log('joinCall configuration', configuration);\n    if(!configuration) return;\n\n    const connectionInstance = this.connectionInstance = new CallConnectionInstance({\n      call: this,\n      streamManager,\n      log: this.log.bindPrefix('connection')\n    });\n\n    const connection = connectionInstance.createPeerConnection(configuration);\n    connection.addEventListener('iceconnectionstatechange', () => {\n      const state = this.connectionState;\n      if(this.connectedAt === undefined && state === CALL_STATE.CONNECTED) {\n        this.connectedAt = Date.now();\n      }\n\n      this.dispatchEvent('state', state);\n    });\n    connection.addEventListener('negotiationneeded', () => {\n      connectionInstance.negotiate();\n    });\n    connection.addEventListener('icecandidate', (event) => {\n      const {candidate} = event;\n      connection.log('onicecandidate', candidate);\n      if(candidate?.candidate) {\n        this.sendIceCandidate(candidate);\n      }\n    });\n    connection.addEventListener('track', (event) => {\n      const {track} = event;\n      connection.log('ontrack', track);\n      this.onTrack(event);\n    });\n\n    const description = connectionInstance.createDescription();\n\n    this.encryptor = new P2PEncryptor(isOutgoing, encryptionKey);\n    this.decryptor = new P2PEncryptor(!isOutgoing, encryptionKey);\n\n    this.log('currentCall', this);\n\n    if(isOutgoing) {\n      connectionInstance.appendStreamToConference();\n    }\n\n    this.createDataChannel();\n\n    this.processDecryptQueue();\n  }\n\n  private createDataChannelEntry() {\n    const dataChannelEntry = this.description.createEntry('application');\n    dataChannelEntry.setDirection('sendrecv');\n    dataChannelEntry.sendEntry = dataChannelEntry.recvEntry = dataChannelEntry;\n  }\n\n  private createDataChannel() {\n    if(this.connectionInstance.dataChannel) {\n      return;\n    }\n\n    const channel = this.connectionInstance.createDataChannel({\n      id: 0,\n      negotiated: true\n    });\n    channel.addEventListener('message', (e) => {\n      this.applyDataChannelData(JSON.parse(e.data));\n    });\n    channel.addEventListener('open', () => {\n      this.sendMediaState();\n    });\n  }\n\n  private applyDataChannelData(data: CallMediaState) {\n    switch(data['@type']) {\n      case 'MediaState': {\n        data.type = 'output';\n        this.log('got output media state', data);\n        this.setMediaState(data);\n        break;\n      }\n\n      default:\n        this.log.error('unknown data channel data:', data);\n        break;\n    }\n  }\n\n  private _sendMediaState() {\n    const {connectionInstance} = this;\n    if(!connectionInstance) return;\n\n    const mediaState = {...this.getMediaState('input')};\n    // mediaState.videoRotation = 90;\n    delete mediaState.type;\n    this.log('sendMediaState', mediaState);\n\n    connectionInstance.sendDataChannelData(mediaState);\n  }\n\n  public async sendCallSignalingData(data: CallSignalingData) {\n    /* if(data['@type'] === 'InitialSetup') {\n      this.filterNotVP8(data);\n    } */\n\n    const json = JSON.stringify(data);\n    const arr = new TextEncoder().encode(json);\n    const {bytes} = await this.encryptor.encryptRawPacket(arr);\n\n    this.log('sendCallSignalingData', this.id, json);\n    await this.managers.apiManager.invokeApi('phone.sendSignalingData', {\n      peer: await this.managers.appCallsManager.getCallInput(this.id),\n      data: bytes\n    });\n  }\n\n  public sendIceCandidate(iceCandidate: RTCIceCandidate) {\n    this.log('sendIceCandidate', iceCandidate);\n    const {candidate, sdpMLineIndex} = iceCandidate;\n    if(sdpMLineIndex !== 0) {\n      return;\n    }\n\n    const parsed = p2pParseCandidate(candidate);\n    // const parsed = {sdpString: candidate};\n    /* if(parsed.address.ip !== '') {\n      return;\n    } */\n\n    this.sendCallSignalingData({\n      '@type': 'Candidates',\n      'candidates': [parsed]\n    });\n  }\n\n  public async confirmCall() {\n    const {protocol, id, call} = this;\n    const dh = this.dh as DiffieHellmanInfo.a;\n\n    // this.clearHangUpTimeout();\n    this.overrideConnectionState(CALL_STATE.EXCHANGING_KEYS);\n    const {key, key_fingerprint} = await this.managers.appCallsManager.computeKey((call as PhoneCall.phoneCallAccepted).g_b, dh.a, dh.p);\n\n    const phonePhoneCall = await this.managers.apiManager.invokeApi('phone.confirmCall', {\n      peer: await this.managers.appCallsManager.getCallInput(id),\n      protocol: protocol,\n      g_a: dh.g_a,\n      key_fingerprint: key_fingerprint\n    });\n\n    this.encryptionKey = key;\n    await this.managers.appCallsManager.savePhonePhoneCall(phonePhoneCall);\n    this.joinCall();\n  }\n\n  public getEmojisFingerprint() {\n    if(this.emojisFingerprint) return this.emojisFingerprint;\n    if(this.getEmojisFingerprintPromise) return this.getEmojisFingerprintPromise;\n    return this.getEmojisFingerprintPromise = apiManagerProxy.invokeCrypto('get-emojis-fingerprint', this.encryptionKey, this.dh.g_a).then((codePoints) => {\n      this.getEmojisFingerprintPromise = undefined;\n      return this.emojisFingerprint = codePoints.map((codePoints) => emojiFromCodePoints(codePoints)) as [string, string, string, string];\n    });\n  }\n\n  private unlockStreamManager() {\n    this.connectionInstance.streamManager.locked = false;\n    this.connectionInstance.appendStreamToConference();\n  }\n\n  private async doTheMagic() {\n    this.connectionInstance.appendStreamToConference();\n\n    const connection = this.connectionInstance.connection;\n\n    let answer = await connection.createAnswer();\n\n    this.log('[sdp] local', answer.type, answer.sdp);\n    await connection.setLocalDescription(answer);\n\n    connection.getTransceivers().filter((transceiver) => transceiver.direction === 'recvonly').forEach((transceiver) => {\n      const entry = this.connectionInstance.description.getEntryByMid(transceiver.mid);\n      entry.transceiver = entry.recvEntry.transceiver = transceiver;\n      transceiver.direction = 'sendrecv';\n    });\n\n    const isAnswer = false;\n\n    const description = this.description;\n    const bundle = description.entries.map((entry) => entry.mid);\n    const sdpDescription: RTCSessionDescriptionInit = {\n      type: isAnswer ? 'answer' : 'offer',\n      sdp: description.generateSdp({\n        bundle,\n        entries: description.entries.filter((entry) => bundle.includes(entry.mid)),\n        // isAnswer: isAnswer\n        isAnswer: !isAnswer\n      })\n    };\n\n    await connection.setRemoteDescription(sdpDescription);\n\n    answer = await connection.createAnswer();\n\n    await connection.setLocalDescription(answer);\n\n    const initialSetup = parseSignalingData(parseSdp(answer.sdp));\n    this.log('[InitialSetup] send 1');\n    this.sendCallSignalingData(initialSetup);\n\n    this.unlockStreamManager();\n  }\n\n  public overrideConnectionState(state?: CALL_STATE) {\n    this._connectionState = state;\n    this.dispatchEvent('state', this.connectionState);\n  }\n\n  public get duration() {\n    return this.connectedAt !== undefined ? (Date.now() - this.connectedAt) / 1000 | 0 : 0;\n  }\n\n  protected onInputStream(stream: MediaStream): void {\n    super.onInputStream(stream);\n\n    const videoTrack = stream.getVideoTracks()[0];\n    if(videoTrack) {\n      const state = this.getMediaState('input');\n\n      // handle starting camera\n      if(!this.wasStartingScreen && !this.wasStartingVideo) {\n        this.wasStartingVideo = true;\n      }\n\n      if(this.isSharingVideo) {\n        state.videoState = 'active';\n      } else if(this.isSharingScreen) {\n        state.screencastState = 'active';\n      }\n\n      videoTrack.addEventListener('ended', () => {\n        this.stopVideoSharing();\n      }, {once: true});\n    }\n\n    if(stream.getAudioTracks().length) {\n      this.onMutedChange();\n    }\n  }\n\n  private onMutedChange() {\n    const isMuted = this.isMuted;\n    this.dispatchEvent('muted', isMuted);\n\n    const state = this.getMediaState('input');\n    state.muted = isMuted;\n  }\n\n  public toggleMuted(): Promise<void> {\n    return this.requestAudioSource(true).then(() => {\n      this.setMuted();\n      this.onMutedChange();\n    });\n  }\n\n  public async hangUp(discardReason?: PhoneCallDiscardReason['_'], discardedByOtherParty?: boolean) {\n    if(this.isClosing) {\n      return;\n    }\n\n    this.discardReason = discardReason;\n    this.log('hangUp', discardReason);\n    this.overrideConnectionState(CALL_STATE.CLOSED);\n\n    if(this.connectionInstance) {\n      this.connectionInstance.closeConnectionAndStream(true);\n    }\n\n    if(discardReason && !discardedByOtherParty) {\n      let hasVideo = false;\n      for(const type in this.mediaStates) {\n        const mediaState = this.mediaStates[type as 'input' | 'output'];\n        hasVideo = mediaState.videoState === 'active' || mediaState.screencastState === 'active' || hasVideo;\n      }\n\n      await this.managers.appCallsManager.discardCall(this.id, this.duration, discardReason, hasVideo);\n    }\n  }\n\n  private performCodec(_codec: P2PAudioCodec | P2PVideoCodec) {\n    const payloadTypes: AudioCodec['payload-types'] = _codec.payloadTypes.map((payloadType) => {\n      return {\n        ...payloadType,\n        'rtcp-fbs': payloadType.feedbackTypes\n      }\n    });\n\n    const codec: AudioCodec = {\n      'rtp-hdrexts': _codec.rtpExtensions,\n      'payload-types': payloadTypes\n    };\n\n    return codec;\n  }\n\n  private setDataToDescription(data: CallSignalingData.initialSetup) {\n    this.description.setData({\n      transport: {\n        'pwd': data.pwd,\n        'ufrag': data.ufrag,\n        'fingerprints': data.fingerprints,\n        'rtcp-mux': true\n      },\n      audio: this.performCodec(data.audio),\n      video: data.video ? this.performCodec(data.video) as VideoCodec : undefined,\n      screencast: data.screencast ? this.performCodec(data.screencast) as VideoCodec : undefined\n    });\n  }\n\n  private filterNotVP8(initialSetup: CallSignalingData.initialSetup) {\n    if(!this.isOutgoing) { // only VP8 works now\n      [initialSetup.video, initialSetup.screencast].filter(Boolean).forEach((codec) => {\n        const payloadTypes = codec.payloadTypes;\n        const idx = payloadTypes.findIndex((payloadType) => payloadType.name === 'VP8');\n        const vp8PayloadType = payloadTypes[idx];\n        const rtxIdx = payloadTypes.findIndex((payloadType) => +payloadType.parameters?.apt === vp8PayloadType.id);\n        codec.payloadTypes = [payloadTypes[idx], payloadTypes[rtxIdx]];\n      });\n    }\n  }\n\n  public async applyCallSignalingData(data: CallSignalingData) {\n    this.log('applyCallSignalingData', this, data);\n\n    const {connection, description} = this.connectionInstance;\n\n    switch(data['@type']) {\n      case 'InitialSetup': {\n        this.log('[sdp] InitialSetup', data);\n\n        this.filterNotVP8(data);\n        this.setDataToDescription(data);\n\n        const performSsrcGroups = (ssrcGroups: P2PVideoCodec['ssrcGroups']): GroupCallParticipantVideoSourceGroup[] => {\n          return ssrcGroups.map((ssrcGroup) => {\n            return {\n              _: 'groupCallParticipantVideoSourceGroup',\n              semantics: ssrcGroup.semantics,\n              sources: ssrcGroup.ssrcs.map((source) => +source)\n            };\n          });\n        };\n\n        const ssrcs = [\n          generateSsrc('audio', +data.audio.ssrc),\n          data.video ? generateSsrc('video', performSsrcGroups(data.video.ssrcGroups)) : undefined,\n          data.screencast ? generateSsrc('screencast', performSsrcGroups(data.screencast.ssrcGroups)) : undefined\n        ].filter(Boolean);\n\n        ssrcs.forEach((ssrc) => {\n          let entry = description.getEntryBySource(ssrc.source);\n          if(entry) {\n            return;\n          }\n\n          const sendRecvEntry = description.findFreeSendRecvEntry(ssrc.type, false);\n          entry = new ConferenceEntry(sendRecvEntry.mid, ssrc.type);\n          entry.setDirection('sendrecv');\n          sendRecvEntry.recvEntry = entry;\n\n          description.setEntrySource(entry, ssrc.sourceGroups || ssrc.source);\n        });\n\n        this.createDataChannelEntry();\n\n        const isAnswer = this.offerSent;\n        this.offerSent = false;\n\n        const bundle = description.entries.map((entry) => entry.mid);\n        const sdpDescription: RTCSessionDescriptionInit = {\n          type: isAnswer ? 'answer' : 'offer',\n          sdp: description.generateSdp({\n            bundle,\n            entries: description.entries.filter((entry) => bundle.includes(entry.mid)),\n            // isAnswer: isAnswer\n            isAnswer: !isAnswer\n          })\n        };\n\n        this.log('[sdp] remote', sdpDescription.sdp);\n\n        await connection.setRemoteDescription(sdpDescription);\n\n        await this.tryToReleaseCandidates();\n\n        if(!isAnswer) {\n          await this.doTheMagic();\n        }\n\n        break;\n      }\n\n      case 'Candidates': {\n        for(const candidate of data.candidates) {\n          const init: RTCIceCandidateInit = P2PSdpBuilder.generateCandidate(candidate);\n          init.sdpMLineIndex = 0;\n          const iceCandidate = new RTCIceCandidate(init);\n          this.candidates.push(iceCandidate);\n        }\n\n        await this.tryToReleaseCandidates();\n        break;\n      }\n\n      default: {\n        this.log.error('unrecognized signaling data', data);\n      }\n    }\n  }\n\n  public async tryToReleaseCandidates() {\n    const {connectionInstance} = this;\n    if(!connectionInstance) {\n      return;\n    }\n\n    const {connection} = connectionInstance;\n    if(connection.remoteDescription) {\n      const promises: Promise<void>[] = this.candidates.map((candidate) => this.addIceCandidate(connection, candidate));\n      this.candidates.length = 0;\n\n      await Promise.all(promises);\n    } else {\n      this.log('[candidates] postpone');\n    }\n  }\n\n  private async addIceCandidate(connection: RTCPeerConnection, candidate: RTCIceCandidate) {\n    this.log('[candidate] start', candidate);\n    try {\n      // if(!candidate.address) return;\n      await connection.addIceCandidate(candidate);\n      this.log('[candidate] add', candidate);\n    } catch(e) {\n      this.log.error('[candidate] error', candidate, e);\n    }\n  }\n\n  private async processDecryptQueue() {\n    const {encryptor} = this;\n    if(!encryptor) {\n      this.log.warn('got encrypted signaling data before the encryption key');\n      return;\n    }\n\n    const length = this.decryptQueue.length;\n    if(!length) {\n      return;\n    }\n\n    const queue = this.decryptQueue.slice();\n    this.decryptQueue.length = 0;\n\n    for(const data of queue) {\n      const decryptedData = await encryptor.decryptRawPacket(data);\n      if(!decryptedData) {\n        continue;\n      }\n\n      // this.log('[update] updateNewCallSignalingData', update, decryptedData);\n\n      const str = new TextDecoder().decode(decryptedData);\n      try {\n        const signalingData: CallSignalingData = JSON.parse(str);\n        this.log('[update] updateNewCallSignalingData', signalingData);\n        this.applyCallSignalingData(signalingData);\n      } catch(err) {\n        this.log.error('wrong signaling data', str);\n        this.hangUp('phoneCallDiscardReasonDisconnect');\n        callsController.dispatchEvent('incompatible', this.interlocutorUserId);\n      }\n    }\n  }\n\n  public onUpdatePhoneCallSignalingData(data: Uint8Array) {\n    this.decryptQueue.push(data);\n    this.processDecryptQueue();\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n *\n * Originally from:\n * https://github.com/evgeny-nadymov/telegram-react\n * Copyright (C) 2018 Evgeny Nadymov\n * https://github.com/evgeny-nadymov/telegram-react/blob/master/LICENSE\n */\n\nimport {PhoneCallProtocol} from '../../../layer';\n\nexport default function getCallProtocol(): PhoneCallProtocol {\n  return {\n    _: 'phoneCallProtocol',\n    pFlags: {\n      udp_p2p: true,\n      udp_reflector: true\n    },\n    min_layer: 92,\n    max_layer: 92,\n    library_versions: ['4.0.0']\n  };\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n *\n * Originally from:\n * https://github.com/evgeny-nadymov/telegram-react\n * Copyright (C) 2018 Evgeny Nadymov\n * https://github.com/evgeny-nadymov/telegram-react/blob/master/LICENSE\n */\n\nimport {PhoneCall} from '../../../layer';\n\nexport default function getRtcConfiguration(call: PhoneCall.phoneCall): RTCConfiguration {\n  const iceServers: RTCIceServer[] = [];\n  call.connections.forEach((connection) => {\n    switch(connection._) {\n      /* case 'callServerTypeTelegramReflector': {\n        break;\n      } */\n      case 'phoneConnectionWebrtc': {\n        const {ip, ipv6, port, username, password} = connection;\n        const urls: string[] = [];\n        if(connection.pFlags.turn) {\n          if(ip) {\n            urls.push(`turn:${ip}:${port}`);\n          }\n          if(ipv6) {\n            urls.push(`turn:[${ipv6}]:${port}`);\n          }\n        } else if(connection.pFlags.stun) {\n          if(ip) {\n            urls.push(`stun:${ip}:${port}`);\n          }\n          if(ipv6) {\n            urls.push(`stun:[${ipv6}]:${port}`);\n          }\n        }\n\n        if(urls.length > 0) {\n          iceServers.push({\n            urls,\n            username,\n            credential: password\n          });\n        }\n        break;\n      }\n    }\n  });\n\n  return {\n    iceServers,\n    iceTransportPolicy: call.pFlags.p2p_allowed ? 'all' : 'relay'\n  };\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport getScreenStream from './getScreenStream';\nimport getStream from './getStream';\n\n/**\n * ! Use multiple constraints together only with first invoke\n */\nexport default function getStreamCached() {\n  const _cache: {\n    main: Partial<{\n      audio: Promise<MediaStream>,\n      video: Promise<MediaStream>\n    }>,\n    screen: Partial<{\n      audio: Promise<MediaStream>,\n      video: Promise<MediaStream>\n    }>\n  } = {\n    main: {},\n    screen: {}\n  };\n\n  return async(options: {\n    isScreen: true,\n    constraints: DisplayMediaStreamConstraints,\n  } | {\n    isScreen?: false,\n    constraints: MediaStreamConstraints,\n    muted: boolean\n  }) => {\n    const {isScreen, constraints} = options;\n    const cache = _cache[isScreen ? 'screen' : 'main'];\n    let promise: Promise<MediaStream> = cache[constraints.audio ? 'audio' : 'video'];\n\n    if(!promise) {\n      promise = (isScreen ? getScreenStream : getStream)(constraints, (options as any).muted);\n      if(constraints.audio && !cache.audio) cache.audio = promise.finally(() => cache.audio = undefined);\n      if(constraints.video && !cache.video) cache.video = promise.finally(() => cache.video = undefined);\n    }\n\n    try {\n      return await promise;\n      /* let out: Partial<{\n        audio: MediaStream,\n        video: MediaStream\n      }> = {};\n\n      await Promise.all([\n        constraints.audio && cache.audio.then((stream) => out.audio = stream),\n        constraints.video && cache.video.then((stream) => out.video = stream)\n      ].filter(Boolean));\n\n      return out; */\n    } catch(err) {\n      throw err;\n    }\n  };\n}\n\n(window as any).getStreamCached = getStreamCached;\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport EventListenerBase, {EventListenerListeners} from '../../helpers/eventListenerBase';\nimport noop from '../../helpers/noop';\nimport {logger} from '../logger';\nimport getAudioConstraints from './helpers/getAudioConstraints';\nimport getScreenConstraints from './helpers/getScreenConstraints';\nimport getStreamCached from './helpers/getStreamCached';\nimport getVideoConstraints from './helpers/getVideoConstraints';\nimport stopTrack from './helpers/stopTrack';\nimport LocalConferenceDescription from './localConferenceDescription';\nimport StreamManager, {StreamItem} from './streamManager';\n\nexport type TryAddTrackOptions = {\n  stream: MediaStream,\n  track: MediaStreamTrack,\n  type: StreamItem['type'],\n  source?: string\n};\n\nexport default abstract class CallInstanceBase<E extends EventListenerListeners> extends EventListenerBase<E> {\n  protected log: ReturnType<typeof logger>;\n  protected outputDeviceId: string;\n\n  protected player: HTMLElement;\n  protected elements: Map<string, HTMLMediaElement>;\n\n  protected audio: HTMLAudioElement;\n  // protected fixedSafariAudio: boolean;\n\n  protected getStream: ReturnType<typeof getStreamCached>;\n\n  constructor() {\n    super(false);\n\n    const player = this.player = document.createElement('div');\n    player.classList.add('call-player');\n    player.style.display = 'none';\n    document.body.append(player);\n\n    this.elements = new Map();\n\n    // possible Safari fix\n    const audio = this.audio = new Audio();\n    audio.autoplay = true;\n    audio.volume = 1.0;\n    this.player.append(audio);\n    this.elements.set('audio', audio);\n\n    this.fixSafariAudio();\n\n    this.getStream = getStreamCached();\n  }\n\n  public get isSharingAudio() {\n    return !!this.streamManager.hasInputTrackKind('audio');\n  }\n\n  public get isSharingVideo() {\n    return !!this.streamManager.hasInputTrackKind('video');\n  }\n\n  public abstract get isMuted(): boolean;\n  public abstract get isClosing(): boolean;\n\n  public fixSafariAudio() {\n    // if(this.fixedSafariAudio) return;\n    this.audio.play().catch(noop);\n    // this.fixedSafariAudio = true;\n  }\n\n  public requestAudioSource(muted: boolean) {\n    return this.requestInputSource(true, false, muted);\n  }\n\n  public requestInputSource(audio: boolean, video: boolean, muted: boolean) {\n    const {streamManager} = this;\n    if(streamManager) {\n      const isAudioGood = !audio || this.isSharingAudio;\n      const isVideoGood = !video || this.isSharingVideo;\n      if(isAudioGood && isVideoGood) {\n        return Promise.resolve();\n      }\n    }\n\n    const constraints: MediaStreamConstraints = {\n      audio: audio && getAudioConstraints(),\n      video: video && getVideoConstraints()\n    };\n\n    return this.getStream({\n      constraints,\n      muted\n    }).then((stream) => {\n      this.onInputStream(stream);\n    });\n  }\n\n  public requestScreen() {\n    return this.getStream({\n      isScreen: true,\n      constraints: getScreenConstraints(true)\n    }).then((stream) => {\n      this.onInputStream(stream);\n    });\n  }\n\n  public getElement(endpoint: number | string) {\n    return this.elements.get('' + endpoint);\n  }\n\n  public abstract get streamManager(): StreamManager;\n  public abstract get description(): LocalConferenceDescription;\n  public abstract toggleMuted(): Promise<void>;\n\n  public cleanup() {\n    this.player.textContent = '';\n    this.player.remove();\n    this.elements.clear();\n\n    // can have no connectionInstance but streamManager with input stream\n    this.streamManager.stop();\n\n    super.cleanup();\n  }\n\n  public onTrack(event: RTCTrackEvent) {\n    this.tryAddTrack({\n      stream: event.streams[0],\n      track: event.track,\n      type: 'output'\n    });\n  }\n\n  public saveInputVideoStream(stream: MediaStream, type?: string) {\n    const track = stream.getVideoTracks()[0];\n    this.tryAddTrack({\n      stream,\n      track,\n      type: 'input',\n      source: type || 'main'\n    });\n  }\n\n  public tryAddTrack({stream, track, type, source}: TryAddTrackOptions) {\n    if(!source) {\n      source = StreamManager.getSource(stream, type);\n    }\n\n    this.log('tryAddTrack', stream, track, type, source);\n\n    const isOutput = type === 'output';\n\n    const {player, elements, streamManager} = this;\n\n    const tagName = track.kind as StreamItem['kind'];\n    const isVideo = tagName === 'video';\n\n    const elementEndpoint = isVideo ? source : tagName;\n    let element = elements.get(elementEndpoint);\n\n    if(isVideo) {\n      track.addEventListener('ended', () => {\n        this.log('[track] onended');\n        elements.delete(elementEndpoint);\n        // element.remove();\n      }, {once: true});\n    }\n\n    if(isOutput) {\n      streamManager.addTrack(stream, track, type);\n    }\n\n    const useStream = isVideo ? stream : streamManager.outputStream;\n    if(!element) {\n      element = document.createElement(tagName);\n      element.autoplay = true;\n      element.srcObject = useStream;\n      element.volume = 1.0;\n\n      if((element as any).sinkId !== 'undefined') {\n        const {outputDeviceId} = this;\n        if(outputDeviceId) {\n          (element as any).setSinkId(outputDeviceId);\n        }\n      }\n\n      if(!isVideo) {\n        player.appendChild(element);\n      } else {\n        element.setAttribute('playsinline', 'true');\n        element.muted = true;\n      }\n      // audio.play();\n\n      elements.set(elementEndpoint, element);\n    } else {\n      if(element.paused) {\n        element.play().catch(noop);\n      }\n\n      // ! EVEN IF MEDIASTREAM IS THE SAME NEW TRACK WON'T PLAY WITHOUT REPLACING IT WHEN NEW PARTICIPANT IS ENTERING !\n      // if(element.srcObject !== useStream) {\n      element.srcObject = useStream;\n      // }\n    }\n\n    return source;\n  }\n\n  public setMuted(muted?: boolean) {\n    this.streamManager.inputStream.getAudioTracks().forEach((track) => {\n      if(track?.kind === 'audio') {\n        track.enabled = muted === undefined ? !track.enabled : !muted;\n      }\n    });\n  }\n\n  protected onInputStream(stream: MediaStream): void {\n    if(!this.isClosing) {\n      const videoTracks = stream.getVideoTracks();\n      if(videoTracks.length) {\n        this.saveInputVideoStream(stream, 'main');\n      }\n\n      const {streamManager, description} = this;\n      streamManager.addStream(stream, 'input');\n\n      if(description) {\n        streamManager.appendToConference(description);\n      }\n    } else { // if call is declined earlier than stream appears\n      stream.getTracks().forEach((track) => {\n        stopTrack(track);\n      });\n    }\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nenum CALL_STATE {\n  CONNECTED,\n  CONNECTING,\n  EXCHANGING_KEYS,\n  PENDING,\n  REQUESTING,\n  CLOSING,\n  CLOSED\n}\n\nexport default CALL_STATE;\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport AudioAssetPlayer from '../../helpers/audioAssetPlayer';\r\n\r\nexport type CallAudioAssetName = 'call_busy.mp3' | 'call_connect.mp3' | 'call_end.mp3' | 'call_incoming.mp3' | 'call_outgoing.mp3' | 'voip_failed.mp3' | 'voip_connecting.mp3';\r\n\r\nlet audioAsset: AudioAssetPlayer<CallAudioAssetName>;\r\nexport default function getCallAudioAsset() {\r\n  return audioAsset ??= new AudioAssetPlayer([\r\n    'call_busy.mp3',\r\n    'call_connect.mp3',\r\n    'call_end.mp3',\r\n    'call_incoming.mp3',\r\n    'call_outgoing.mp3',\r\n    'voip_failed.mp3'\r\n  ]);\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport getCallAudioAsset, {CallAudioAssetName} from '../../components/call/getAudioAsset';\r\nimport {MOUNT_CLASS_TO} from '../../config/debug';\r\nimport IS_CALL_SUPPORTED from '../../environment/callSupport';\r\nimport indexOfAndSplice from '../../helpers/array/indexOfAndSplice';\r\nimport insertInDescendSortedArray from '../../helpers/array/insertInDescendSortedArray';\r\nimport AudioAssetPlayer from '../../helpers/audioAssetPlayer';\r\nimport bytesCmp from '../../helpers/bytes/bytesCmp';\r\nimport EventListenerBase from '../../helpers/eventListenerBase';\r\nimport tsNow from '../../helpers/tsNow';\r\nimport {PhoneCallProtocol} from '../../layer';\r\nimport {CallId} from '../appManagers/appCallsManager';\r\nimport {AppManagers} from '../appManagers/managers';\r\nimport {logger} from '../logger';\r\nimport apiManagerProxy from '../mtproto/mtprotoworker';\r\nimport {NULL_PEER_ID} from '../mtproto/mtproto_config';\r\nimport rootScope from '../rootScope';\r\nimport CallInstance from './callInstance';\r\nimport CALL_STATE from './callState';\r\n\r\nconst CALL_REQUEST_TIMEOUT = 45e3;\r\n\r\nexport class CallsController extends EventListenerBase<{\r\n  instance: (details: {hasCurrent: boolean, instance: CallInstance}) => void,\r\n  accepting: (instance: CallInstance) => void, //  .    ,     topbarCall\r\n  incompatible: (userId: UserId) => void,\r\n}> {\r\n  private log: ReturnType<typeof logger>;\r\n  private managers: AppManagers;\r\n  private audioAsset: AudioAssetPlayer<CallAudioAssetName>;\r\n  private instances: Map<CallId, CallInstance>;\r\n  private sortedInstances: Array<CallInstance>;\r\n  private tempId: number;\r\n\r\n  public construct(managers: AppManagers) {\r\n    this.managers = managers;\r\n    this.log = logger('CC');\r\n\r\n    if(!IS_CALL_SUPPORTED) {\r\n      return;\r\n    }\r\n\r\n    this.audioAsset = getCallAudioAsset();\r\n    this.tempId = 0;\r\n    this.instances = new Map();\r\n    this.sortedInstances = [];\r\n\r\n    rootScope.addEventListener('call_update', async(call) => {\r\n      let instance = this.instances.get(call.id);\r\n\r\n      if(instance) {\r\n        instance.setPhoneCall(call);\r\n      }\r\n\r\n      switch(call._) {\r\n        case 'phoneCallDiscarded': {\r\n          if(instance) {\r\n            instance.hangUp(call.reason?._, true);\r\n          }\r\n\r\n          break;\r\n        }\r\n\r\n        case 'phoneCallAccepted': {\r\n          if(instance) {\r\n            /* if(!this.verifyProtocolCompatibility(call.protocol)) {\r\n              instance.hangUp('phoneCallDiscardReasonDisconnect');\r\n              rootScope.dispatchEvent('call_incompatible', instance.interlocutorUserId);\r\n              break;\r\n            } */\r\n\r\n            instance.confirmCall();\r\n          }\r\n\r\n          break;\r\n        }\r\n\r\n        case 'phoneCallRequested': {\r\n          if(!instance) {\r\n            /* if(!this.verifyProtocolCompatibility(call.protocol)) {\r\n              rootScope.dispatchEvent('call_incompatible', call.admin_id);\r\n              break;\r\n            } */\r\n\r\n            instance = this.createCallInstance({\r\n              isOutgoing: false,\r\n              interlocutorUserId: call.admin_id\r\n            });\r\n\r\n            instance.overrideConnectionState(CALL_STATE.PENDING);\r\n            instance.setPhoneCall(call);\r\n            instance.setHangUpTimeout(CALL_REQUEST_TIMEOUT, 'phoneCallDiscardReasonMissed');\r\n          }\r\n\r\n          break;\r\n        }\r\n\r\n        case 'phoneCall': {\r\n          if(!instance || instance.encryptionKey) {\r\n            break;\r\n          }\r\n\r\n          const g_a = instance.dh.g_a = call.g_a_or_b;\r\n          const dh = instance.dh;\r\n          const g_a_hash = await apiManagerProxy.invokeCrypto('sha256', g_a);\r\n          if(!bytesCmp(dh.g_a_hash, g_a_hash)) {\r\n            this.log.error('Incorrect g_a_hash', dh.g_a_hash, g_a_hash);\r\n            break;\r\n          }\r\n\r\n          const {key, key_fingerprint} = await this.managers.appCallsManager.computeKey(g_a, dh.b, dh.p);\r\n          if(call.key_fingerprint !== key_fingerprint) {\r\n            this.log.error('Incorrect key fingerprint', call.key_fingerprint, key_fingerprint, g_a, dh);\r\n            instance.hangUp('phoneCallDiscardReasonDisconnect');\r\n            break;\r\n          }\r\n\r\n          instance.encryptionKey = key;\r\n          instance.joinCall();\r\n\r\n          break;\r\n        }\r\n      }\r\n    });\r\n\r\n    rootScope.addEventListener('call_signaling', ({callId, data}) => {\r\n      const instance = this.instances.get(callId);\r\n      if(instance?.id !== callId) {\r\n        return;\r\n      }\r\n\r\n      instance.onUpdatePhoneCallSignalingData(data);\r\n    });\r\n  }\r\n\r\n  public get currentCall() {\r\n    return this.sortedInstances[0];\r\n  }\r\n\r\n  public getCallByUserId(userId: UserId) {\r\n    for(const [callId, instance] of this.instances) {\r\n      if(instance.interlocutorUserId === userId) {\r\n        return instance;\r\n      }\r\n    }\r\n  }\r\n\r\n  private createCallInstance(options: {\r\n    isOutgoing: boolean,\r\n    interlocutorUserId: UserId,\r\n    protocol?: PhoneCallProtocol\r\n  }) {\r\n    const call = new CallInstance({\r\n      managers: this.managers,\r\n      ...options\r\n    });\r\n\r\n    call.addEventListener('state', (state) => {\r\n      const currentCall = this.currentCall;\r\n      if(state === CALL_STATE.CLOSED) {\r\n        this.instances.delete(call.id);\r\n        indexOfAndSplice(this.sortedInstances, call);\r\n      } else {\r\n        insertInDescendSortedArray(this.sortedInstances, call, 'sortIndex');\r\n      }\r\n\r\n      if(state === CALL_STATE.EXCHANGING_KEYS) {\r\n        call.wasTryingToJoin = true;\r\n      }\r\n\r\n      const hasConnected = call.connectedAt !== undefined;\r\n      if(state === CALL_STATE.EXCHANGING_KEYS || (state === CALL_STATE.CONNECTING && hasConnected)) {\r\n        call.setHangUpTimeout(CALL_REQUEST_TIMEOUT, 'phoneCallDiscardReasonDisconnect');\r\n      } else {\r\n        call.clearHangUpTimeout();\r\n      }\r\n\r\n      if(currentCall === call || !currentCall) {\r\n        if(state === CALL_STATE.CLOSED) {\r\n          if(!call.isOutgoing && !call.wasTryingToJoin) { // incoming call has been accepted on other device or ended\r\n            this.audioAsset.stopSound();\r\n          } else if(call.wasTryingToJoin && !hasConnected) { // something has happened during the key exchanging\r\n            this.audioAsset.playSound('voip_failed.mp3');\r\n          } else {\r\n            this.audioAsset.playSound(call.discardReason === 'phoneCallDiscardReasonBusy' ? 'call_busy.mp3' : 'call_end.mp3');\r\n          }\r\n        } else if(state === CALL_STATE.PENDING) {\r\n          this.audioAsset.playSound(call.isOutgoing ? 'call_outgoing.mp3' : 'call_incoming.mp3', true);\r\n        } else if(state === CALL_STATE.EXCHANGING_KEYS) {\r\n          this.audioAsset.playSoundIfDifferent('call_connect.mp3');\r\n        } else if(state === CALL_STATE.CONNECTING) {\r\n          if(call.duration) {\r\n            this.audioAsset.playSound('voip_connecting.mp3', true);\r\n          }\r\n        } else {\r\n          this.audioAsset.stopSound();\r\n        }\r\n      }\r\n    });\r\n\r\n    call.addEventListener('id', (id, prevId) => {\r\n      if(prevId !== undefined) {\r\n        this.instances.delete(prevId);\r\n      }\r\n\r\n      const hasCurrent = !!this.currentCall;\r\n      this.instances.set(id, call);\r\n\r\n      if(prevId === undefined) {\r\n        this.dispatchEvent('instance', {instance: call, hasCurrent: hasCurrent});\r\n      }\r\n    });\r\n\r\n    return call;\r\n  }\r\n\r\n  public async startCallInternal(userId: UserId, isVideo: boolean) {\r\n    this.log('p2pStartCallInternal', userId, isVideo);\r\n\r\n    const fullInfo = await this.managers.appProfileManager.getProfile(userId);\r\n    if(!fullInfo) return;\r\n\r\n    const {video_calls_available} = fullInfo.pFlags;\r\n\r\n    const call = this.createCallInstance({\r\n      isOutgoing: true,\r\n      interlocutorUserId: userId\r\n    });\r\n\r\n    call.requestInputSource(true, !!(isVideo && video_calls_available), false);\r\n\r\n    call.overrideConnectionState(CALL_STATE.REQUESTING);\r\n    call.setPhoneCall({\r\n      _: 'phoneCallWaiting',\r\n      access_hash: '',\r\n      admin_id: NULL_PEER_ID,\r\n      date: tsNow(true),\r\n      id: --this.tempId,\r\n      participant_id: userId,\r\n      protocol: call.protocol,\r\n      pFlags: {\r\n        video: isVideo || undefined\r\n      }\r\n    });\r\n\r\n    // return;\r\n    this.managers.appCallsManager.generateDh().then(async(dh) => {\r\n      call.dh = dh;\r\n\r\n      return this.managers.appCallsManager.requestCall(userId, call.protocol, call.dh.g_a_hash, isVideo && video_calls_available);\r\n    }).then((phoneCall) => {\r\n      call.overrideConnectionState(CALL_STATE.PENDING);\r\n      call.setPhoneCall(phoneCall);\r\n      call.setHangUpTimeout(CALL_REQUEST_TIMEOUT, 'phoneCallDiscardReasonHangup');\r\n    });\r\n  }\r\n}\r\n\r\nconst callsController = new CallsController();\r\nMOUNT_CLASS_TO && (MOUNT_CLASS_TO.callsController = callsController);\r\nexport default callsController;\r\n","export const GROUP_CALL_AMPLITUDE_ANALYSE_COUNT_MAX = 50;\nexport const GROUP_CALL_AMPLITUDE_ANALYSE_INTERVAL_MS = 100;\nexport const GROUP_CALL_PARTICIPANTS_LOAD_LIMIT = 100;\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport forEachReverse from '../../helpers/array/forEachReverse';\nimport throttle from '../../helpers/schedulers/throttle';\nimport {GroupCallConnectionType, JoinGroupCallJsonPayload} from '../appManagers/appGroupCallsManager';\nimport {AppManagers} from '../appManagers/managers';\nimport rootScope from '../rootScope';\nimport CallConnectionInstanceBase, {CallConnectionInstanceOptions} from './callConnectionInstanceBase';\nimport GroupCallInstance from './groupCallInstance';\nimport filterServerCodecs from './helpers/filterServerCodecs';\nimport fixLocalOffer from './helpers/fixLocalOffer';\nimport processMediaSection from './helpers/processMediaSection';\nimport {ConferenceEntry} from './localConferenceDescription';\nimport SDP from './sdp';\nimport SDPMediaSection from './sdp/mediaSection';\nimport {WebRTCLineType} from './sdpBuilder';\nimport {UpdateGroupCallConnectionData} from './types';\n\nexport default class GroupCallConnectionInstance extends CallConnectionInstanceBase {\n  private groupCall: GroupCallInstance;\n  public updateConstraints?: boolean;\n  private type: GroupCallConnectionType;\n  private options: {\n    type: Extract<GroupCallConnectionType, 'main'>,\n    isMuted?: boolean,\n    joinVideo?: boolean,\n    rejoin?: boolean\n  } | {\n    type: Extract<GroupCallConnectionType, 'presentation'>,\n  };\n\n  private updateConstraintsInterval: number;\n  public negotiateThrottled: () => void;\n\n  private managers: AppManagers;\n\n  constructor(options: CallConnectionInstanceOptions & {\n    groupCall: GroupCallConnectionInstance['groupCall'],\n    type: GroupCallConnectionInstance['type'],\n    options: GroupCallConnectionInstance['options'],\n    managers: AppManagers\n  }) {\n    super(options);\n\n    this.negotiateThrottled = throttle(this.negotiate.bind(this), 0, false);\n  }\n\n  public createPeerConnection() {\n    return this.connection || super.createPeerConnection({\n      iceServers: [],\n      iceTransportPolicy: 'all',\n      bundlePolicy: 'max-bundle',\n      rtcpMuxPolicy: 'require',\n      iceCandidatePoolSize: 0\n      // sdpSemantics: \"unified-plan\",\n      // extmapAllowMixed: true,\n    });\n  }\n\n  public createDataChannel() {\n    if(this.dataChannel) {\n      return this.dataChannel;\n    }\n\n    const dataChannel = super.createDataChannel();\n\n    dataChannel.addEventListener('open', () => {\n      this.maybeUpdateRemoteVideoConstraints();\n    });\n\n    dataChannel.addEventListener('close', () => {\n      if(this.updateConstraintsInterval) {\n        clearInterval(this.updateConstraintsInterval);\n        this.updateConstraintsInterval = undefined;\n      }\n    });\n\n    return dataChannel;\n  }\n\n  public createDescription() {\n    if(this.description) {\n      return this.description;\n    }\n\n    const description = super.createDescription();\n\n    /* const perType = 0;\n    const types = ['audio' as const, 'video' as const];\n    const count = types.length * perType;\n    const init: RTCRtpTransceiverInit = {direction: 'recvonly'};\n    types.forEach((type) => {\n      for(let i = 0; i < perType; ++i) {\n        description.createEntry(type).createTransceiver(connection, init);\n      }\n    }); */\n\n    return description;\n  }\n\n  public appendStreamToConference() {\n    super.appendStreamToConference();/* .then(() => {\n      currentGroupCall.connections.main.negotiating = false;\n      this.startNegotiation({\n        type: type,\n        isMuted: muted,\n        rejoin\n      });\n    }); */\n  }\n\n  private async invokeJoinGroupCall(localSdp: SDP, mainChannels: SDPMediaSection[], options: GroupCallConnectionInstance['options']) {\n    const {groupCall, description} = this;\n    const groupCallId = groupCall.id;\n\n    const processedChannels = mainChannels.map((section) => {\n      const processed = processMediaSection(localSdp, section);\n\n      this.sources[processed.entry.type as 'video' | 'audio'] = processed.entry;\n\n      return processed;\n    });\n\n    const audioChannel = processedChannels.find((channel) => channel.media.mediaType === 'audio');\n    const videoChannel = processedChannels.find((channel) => channel.media.mediaType === 'video');\n    let {source, params} = audioChannel || {};\n    const useChannel = videoChannel || audioChannel;\n\n    const channels: {[type in WebRTCLineType]?: typeof audioChannel} = {\n      audio: audioChannel,\n      video: videoChannel\n    };\n\n    description.entries.forEach((entry) => {\n      if(entry.direction === 'sendonly') {\n        const channel = channels[entry.type];\n        if(!channel) return;\n\n        description.setEntrySource(entry, channel.sourceGroups || channel.source);\n        description.setEntryPeerId(entry, rootScope.myId);\n      }\n    });\n\n    // overwrite ssrc with audio in video params\n    if(params !== useChannel.params) {\n      const data: JoinGroupCallJsonPayload = JSON.parse(useChannel.params.data);\n      // data.ssrc = source || data.ssrc - 1; // audio channel can be missed in screensharing\n      if(source) data.ssrc = source;\n      else delete data.ssrc;\n      params = {\n        _: 'dataJSON',\n        data: JSON.stringify(data)\n      };\n    }\n\n    const update = await this.managers.appGroupCallsManager.joinGroupCall(groupCallId, params, options);\n\n    const data: UpdateGroupCallConnectionData = JSON.parse(update.params.data);\n\n    data.audio = data.audio || groupCall.connections.main.description.audio;\n    description.setData(data);\n    filterServerCodecs(mainChannels, data);\n\n    return data;\n  }\n\n  protected async negotiateInternal() {\n    const {connection, description} = this;\n    const isNewConnection = connection.iceConnectionState === 'new' && !description.getEntryByMid('0').source;\n    const log = this.log.bindPrefix('startNegotiation');\n    log('start');\n\n    const originalOffer = await connection.createOffer({iceRestart: false});\n\n    if(isNewConnection && this.dataChannel) {\n      const dataChannelEntry = description.createEntry('application');\n      dataChannelEntry.setDirection('sendrecv');\n    }\n\n    const {sdp: localSdp, offer} = fixLocalOffer({\n      offer: originalOffer,\n      data: description\n    });\n\n    log('[sdp] setLocalDescription', offer.sdp);\n    await connection.setLocalDescription(offer);\n\n    const mainChannels = localSdp.media.filter((media) => {\n      return media.mediaType !== 'application' && media.isSending;\n    });\n\n    if(isNewConnection) {\n      try {\n        await this.invokeJoinGroupCall(localSdp, mainChannels, this.options);\n      } catch(e) {\n        this.log.error('[tdweb] joinGroupCall error', e);\n      }\n    }\n\n    /* if(!data) {\n      log('abort 0');\n      this.closeConnectionAndStream(connection, streamManager);\n      return;\n    } */\n\n    /* if(connection.iceConnectionState !== 'new') {\n      log(`abort 1 connectionState=${connection.iceConnectionState}`);\n      this.closeConnectionAndStream(connection, streamManager);\n      return;\n    } */\n    /* if(this.currentGroupCall !== currentGroupCall || connectionHandler.connection !== connection) {\n      log('abort', this.currentGroupCall, currentGroupCall);\n      this.closeConnectionAndStream(connection, streamManager);\n      return;\n    } */\n\n    const isAnswer = true;\n    // const _bundleMids = bundleMids.slice();\n    const entriesToDelete: ConferenceEntry[] = [];\n    const bundle = localSdp.bundle;\n    forEachReverse(bundle, (mid, idx, arr) => {\n      const entry = description.getEntryByMid(mid);\n      if(entry.shouldBeSkipped(isAnswer)) {\n        arr.splice(idx, 1);\n        entriesToDelete.push(entry);\n      }\n    });\n\n    /* forEachReverse(description.entries, (entry, idx, arr) => {\n      const mediaSection = _parsedSdp.media.find((section) => section.oa.get('mid').oa === entry.mid);\n      const deleted = !mediaSection;\n      // const deleted = !_bundleMids.includes(entry.mid); // ! can't use it because certain mid can be missed in bundle\n      if(deleted) {\n        arr.splice(idx, 1);\n      }\n    }); */\n\n    const entries = localSdp.media.map((section) => {\n      const mid = section.mid;\n      let entry = description.getEntryByMid(mid);\n      if(!entry) {\n        entry = new ConferenceEntry(mid, section.mediaType);\n        entry.setDirection('inactive');\n      }\n\n      return entry;\n    });\n\n    const answerDescription: RTCSessionDescriptionInit = {\n      type: 'answer',\n      sdp: description.generateSdp({\n        bundle,\n        entries,\n        isAnswer\n      })\n    };\n\n    entriesToDelete.forEach((entry) => {\n      description.deleteEntry(entry);\n    });\n\n    log(`[sdp] setRemoteDescription signaling=${connection.signalingState} ice=${connection.iceConnectionState} gathering=${connection.iceGatheringState} connection=${connection.connectionState}`, answerDescription.sdp);\n    await connection.setRemoteDescription(answerDescription);\n\n    log('end');\n  }\n\n  public negotiate() {\n    let promise = this.negotiating;\n    if(promise) {\n      return promise;\n    }\n\n    promise = super.negotiate();\n\n    if(this.updateConstraints) {\n      promise.then(() => {\n        this.maybeUpdateRemoteVideoConstraints();\n        this.updateConstraints = false;\n      });\n    }\n\n    if(this.options.type === 'presentation') {\n      promise.then(() => {\n        this.connection.getTransceivers().find((transceiver) => {\n          if(transceiver.sender?.track?.kind === 'video') {\n            transceiver.sender.setParameters({\n              ...transceiver.sender.getParameters(),\n              degradationPreference: 'maintain-resolution'\n            });\n          }\n        });\n      });\n    }\n\n    return promise;\n  }\n\n  public maybeUpdateRemoteVideoConstraints() {\n    if(this.dataChannel.readyState !== 'open') {\n      return;\n    }\n\n    this.log('maybeUpdateRemoteVideoConstraints');\n\n    // * https://github.com/TelegramMessenger/tgcalls/blob/6f2746e04c9b040f8c8dfc64d916a1853d09c4ce/tgcalls/group/GroupInstanceCustomImpl.cpp#L2549\n    type VideoConstraints = {minHeight?: number, maxHeight: number};\n    const obj: {\n      colibriClass: 'ReceiverVideoConstraints',\n      constraints: {[endpoint: string]: VideoConstraints},\n      defaultConstraints: VideoConstraints,\n      onStageEndpoints: string[]\n    } = {\n      colibriClass: 'ReceiverVideoConstraints',\n      constraints: {},\n      defaultConstraints: {maxHeight: 0},\n      onStageEndpoints: []\n    };\n\n    for(const entry of this.description.entries) {\n      if(entry.direction !== 'recvonly' || entry.type !== 'video') {\n        continue;\n      }\n\n      const {endpoint} = entry;\n      obj.onStageEndpoints.push(endpoint);\n      obj.constraints[endpoint] = {\n        minHeight: 180,\n        maxHeight: 720\n      };\n    }\n\n    this.sendDataChannelData(obj);\n\n    if(!obj.onStageEndpoints.length) {\n      if(this.updateConstraintsInterval) {\n        clearInterval(this.updateConstraintsInterval);\n        this.updateConstraintsInterval = undefined;\n      }\n    } else if(!this.updateConstraintsInterval) {\n      this.updateConstraintsInterval = window.setInterval(this.maybeUpdateRemoteVideoConstraints.bind(this), 5000);\n    }\n  }\n\n  public addInputVideoStream(stream: MediaStream) {\n    // const {sources} = this;\n    // if(sources?.video) {\n    // const source = this.sources.video.source;\n    // stream.source = '' + source;\n    this.groupCall.saveInputVideoStream(stream, this.type);\n    // }\n\n    this.streamManager.addStream(stream, 'input');\n    this.appendStreamToConference(); // replace sender track\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport {DataJSON} from '../../../layer';\nimport {JoinGroupCallJsonPayload} from '../../appManagers/appGroupCallsManager';\nimport SDP from '../sdp';\nimport {Ssrc} from '../types';\nimport parseMediaSectionInfo from './parseMediaSectionInfo';\n\nexport default function processMediaSection(sdp: SDP, media: SDP['media'][0]) {\n  const sectionInfo = parseMediaSectionInfo(sdp, media);\n\n  const mediaType: Exclude<typeof media['mediaType'], 'application'> = media.mediaType as any;\n  const entry: Ssrc = {\n    source: sectionInfo.source,\n    sourceGroups: sectionInfo.sourceGroups,\n    type: mediaType\n  };\n\n  // do not change this value, otherwise onconnectionstatechange won't fire\n  sectionInfo.fingerprint.setup = 'active';\n  const payload: JoinGroupCallJsonPayload = {\n    'fingerprints': [sectionInfo.fingerprint],\n    'pwd': sectionInfo.pwd,\n    'ssrc': sectionInfo.source,\n    'ssrc-groups': sectionInfo.sourceGroups || [],\n    'ufrag': sectionInfo.ufrag\n  };\n  const paramsDataJson = JSON.stringify(payload);\n\n  const params: DataJSON = {\n    _: 'dataJSON',\n    data: paramsDataJson\n  };\n\n  return {\n    params,\n    source: sectionInfo.source,\n    media,\n    sourceGroups: sectionInfo.sourceGroups,\n    entry\n  };\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport forEachReverse from '../../../helpers/array/forEachReverse';\nimport SDPMediaSection from '../sdp/mediaSection';\nimport {UpdateGroupCallConnectionData, Codec} from '../types';\n\nexport default function filterServerCodecs(mainChannels: SDPMediaSection[], data: UpdateGroupCallConnectionData) {\n  // ! Need to filter server's extmap for Firefox\n  const performExtmap = (channel: typeof mainChannels[0]) => {\n    const out: {[id: string]: string} = {};\n    const extmap = channel.attributes.get('extmap');\n    extmap.forEach((extmap) => {\n      const id = extmap.key.split('/', 1)[0];\n      out[id] = extmap.value;\n    });\n\n    return out;\n  };\n\n  const codecsToPerform: [Codec, 'audio' | 'video'][] = /* flatten([data, dataPresentation].filter(Boolean).map((data) => {\n    return  */['audio' as const, 'video' as const].filter((type) => data[type]).map((type) => ([data[type], type]));\n  // }));\n\n  codecsToPerform.forEach(([codec, type]) => {\n    const channel = mainChannels.find((line) => line.mediaType === type);\n    if(!channel) {\n      return;\n    }\n\n    const extmap = performExtmap(channel);\n    forEachReverse(codec['rtp-hdrexts'], (value, index, arr) => {\n      if(extmap[value.id] !== value.uri) {\n        arr.splice(index, 1);\n        console.log(`[sdp] filtered extmap:`, value, index, type);\n      }\n    });\n  });\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport forEachReverse from '../../../helpers/array/forEachReverse';\nimport copy from '../../../helpers/object/copy';\nimport {ConferenceEntry} from '../localConferenceDescription';\nimport {parseSdp, addSimulcast} from '../sdp/utils';\nimport {generateMediaFirstLine, SDPBuilder} from '../sdpBuilder';\nimport {UpdateGroupCallConnectionData} from '../types';\nimport parseMediaSectionInfo from './parseMediaSectionInfo';\n\nexport default function fixLocalOffer(options: {\n  offer: RTCSessionDescriptionInit,\n  data: UpdateGroupCallConnectionData,\n  skipAddingMulticast?: boolean\n  // mids?: string[]\n}) {\n  const {offer, data} = options;\n  const sdp = parseSdp(offer.sdp);\n  let hasMunged = false;\n\n  if(!options.skipAddingMulticast) {\n    hasMunged = addSimulcast(sdp) || hasMunged;\n  }\n\n  // const bundleLine = parsedSdp.session.lines.find((line) => line.Ha?.key === 'group');\n  // const bundleMids = bundleLine.value.split(' ').slice(1);\n\n  forEachReverse(sdp.media, (section, idx, arr) => {\n    // const mid = section.oa.get('mid').oa;\n\n    //        . -    \n    // !     ,  \n    /* if(mids && !mids.includes(mid) && !bundleMids.includes(mid)) {\n      console.error('wtf');\n      hasMunged = true;\n      arr.splice(idx, 1);\n      return;\n    } */\n\n    if(/* section.mediaType !== 'video' ||  */section.isSending) {\n      return;\n    }\n\n    if(section.mediaType === 'application') {\n      return;\n    }\n\n    const mediaLine = section.mediaLine;\n    const mediaLineParts = mediaLine.mediaLineParts;\n    const mediaCodecIds = mediaLineParts.ids;\n    const localMLine = mediaLine.toString();\n\n    const codec = data[section.mediaType];\n    const payloadTypes = codec['payload-types'];\n\n    /* forEachReverse(payloadTypes, (payloadType, idx, arr) => {\n      if(!mediaCodecIds.includes('' + payloadType.id) && section.mediaType === 'video') {\n      // if(payloadType.name === 'H265') {\n        console.warn('[sdp] filtered unsupported codec', payloadType, mediaCodecIds, section.mediaType);\n        arr.splice(idx, 1);\n      }\n    }); */\n\n    const codecIds = payloadTypes.map((payload) => '' + payload.id);\n    const correctMLine = generateMediaFirstLine(section.mediaType, undefined, codecIds);\n\n    if(localMLine !== correctMLine) {\n      const sectionInfo = parseMediaSectionInfo(sdp, section);\n\n      const newData = {...data};\n      newData.transport = copy(newData.transport);\n      newData.transport.ufrag = sectionInfo.ufrag;\n      newData.transport.pwd = sectionInfo.pwd;\n      newData.transport.fingerprints = [sectionInfo.fingerprint];\n      newData.transport.candidates = [];\n\n      const entry = new ConferenceEntry(sectionInfo.mid, mediaLineParts.type);\n      entry.setPort(mediaLineParts.port);\n      sectionInfo.source && entry.setSource(sectionInfo.sourceGroups || sectionInfo.source);\n      entry.setDirection(section.direction);\n\n      const newSdp = new SDPBuilder().addSsrcEntry(entry, newData).finalize();\n\n      const newChannel = parseSdp(newSdp).media[0];\n      arr[idx] = newChannel;\n\n      hasMunged = true;\n    }\n  });\n\n  if(hasMunged) {\n    const mungedSdp = sdp.toString();\n    offer.sdp = mungedSdp;\n  }\n\n  return {offer, sdp/* , bundleMids */};\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport type {GroupCallConnectionType, GroupCallId, GroupCallOutputSource} from '../appManagers/appGroupCallsManager';\nimport {IS_SAFARI} from '../../environment/userAgent';\nimport indexOfAndSplice from '../../helpers/array/indexOfAndSplice';\nimport safeAssign from '../../helpers/object/safeAssign';\nimport throttle from '../../helpers/schedulers/throttle';\nimport {GroupCall, GroupCallParticipant} from '../../layer';\nimport {logger} from '../logger';\nimport {NULL_PEER_ID} from '../mtproto/mtproto_config';\nimport rootScope from '../rootScope';\nimport CallInstanceBase, {TryAddTrackOptions} from './callInstanceBase';\nimport GroupCallConnectionInstance from './groupCallConnectionInstance';\nimport GROUP_CALL_STATE from './groupCallState';\nimport getScreenConstraints from './helpers/getScreenConstraints';\nimport getScreenStream from './helpers/getScreenStream';\nimport getStream from './helpers/getStream';\nimport getVideoConstraints from './helpers/getVideoConstraints';\nimport stopTrack from './helpers/stopTrack';\nimport localConferenceDescription from './localConferenceDescription';\nimport {WebRTCLineType} from './sdpBuilder';\nimport StreamManager from './streamManager';\nimport {Ssrc} from './types';\nimport getPeerId from '../appManagers/utils/peers/getPeerId';\nimport {AppManagers} from '../appManagers/managers';\nimport {generateSelfVideo, makeSsrcFromParticipant, makeSsrcsFromParticipant} from './groupCallsController';\n\nexport default class GroupCallInstance extends CallInstanceBase<{\n  state: (state: GROUP_CALL_STATE) => void,\n  pinned: (source?: GroupCallOutputSource) => void,\n}> {\n  public id: GroupCallId;\n  public chatId: ChatId;\n  public handleUpdateGroupCallParticipants: boolean;\n  public updatingSdp: boolean;\n  public isSpeakingMap: Map<any, any>;\n  public connections: {[k in GroupCallConnectionType]?: GroupCallConnectionInstance};\n  public groupCall: GroupCall;\n  public participant: GroupCallParticipant;\n\n  // will be set with negotiation\n  public joined: boolean;\n\n  private pinnedSources: Array<GroupCallOutputSource>;\n  private participantsSsrcs: Map<PeerId, Ssrc[]>;\n  private hadAutoPinnedSources: Set<GroupCallOutputSource>;\n  private dispatchPinnedThrottled: () => void;\n  private startVideoSharingPromise: Promise<void>;\n  private startScreenSharingPromise: Promise<void>;\n\n  private managers: AppManagers;\n\n  constructor(options: {\n    id: GroupCallInstance['id'],\n    chatId: GroupCallInstance['chatId'],\n    isSpeakingMap?: GroupCallInstance['isSpeakingMap'],\n    connections?: GroupCallInstance['connections'],\n    managers: AppManagers\n  }) {\n    super();\n\n    safeAssign(this, options);\n\n    if(!this.log) {\n      this.log = logger('GROUP-CALL');\n    }\n\n    if(!this.connections) {\n      this.connections = {};\n    }\n\n    if(!this.isSpeakingMap) {\n      this.isSpeakingMap = new Map();\n    }\n\n    this.pinnedSources = [];\n    this.participantsSsrcs = new Map();\n    this.hadAutoPinnedSources = new Set();\n    this.dispatchPinnedThrottled = throttle(() => {\n      this.dispatchEvent('pinned', this.pinnedSource);\n    }, 0, false);\n\n    this.addEventListener('state', (state) => {\n      if(state === GROUP_CALL_STATE.CLOSED) {\n        this.cleanup();\n      }\n    });\n  }\n\n  get connectionState() {\n    return this.connections.main.connection.iceConnectionState;\n  }\n\n  get state() {\n    const {connectionState} = this;\n    if(connectionState === 'closed') {\n      return GROUP_CALL_STATE.CLOSED;\n    } else if(connectionState !== 'connected' && (!IS_SAFARI || connectionState !== 'completed')) {\n      return GROUP_CALL_STATE.CONNECTING;\n    } else {\n      const {participant} = this;\n      if(!participant.pFlags.can_self_unmute) {\n        return GROUP_CALL_STATE.MUTED_BY_ADMIN;\n      } else if(participant.pFlags.muted) {\n        return GROUP_CALL_STATE.MUTED;\n      } else {\n        return GROUP_CALL_STATE.UNMUTED;\n      }\n    }\n  }\n\n  get participants() {\n    return this.managers.appGroupCallsManager.getCachedParticipants(this.id);\n  }\n\n  get isSharingScreen() {\n    return !!this.connections.presentation;\n  }\n\n  get pinnedSource() {\n    return this.pinnedSources[this.pinnedSources.length - 1];\n  }\n\n  public get isMuted() {\n    return this.state !== GROUP_CALL_STATE.UNMUTED;\n  }\n\n  public get isClosing() {\n    const {state} = this;\n    return state === GROUP_CALL_STATE.CLOSED;\n  }\n\n  public get streamManager(): StreamManager {\n    return this.connections.main.streamManager;\n  }\n\n  public get description(): localConferenceDescription {\n    return this.connections.main.description;\n  }\n\n  public pinSource(source: GroupCallOutputSource) {\n    indexOfAndSplice(this.pinnedSources, source);\n    this.pinnedSources.push(source);\n    this.dispatchPinnedThrottled();\n  }\n\n  public unpinSource(source: GroupCallOutputSource) {\n    this.hadAutoPinnedSources.delete(source);\n    indexOfAndSplice(this.pinnedSources, source);\n    this.dispatchPinnedThrottled();\n  }\n\n  public unpinAll() {\n    this.pinnedSources.length = 0;\n    this.dispatchPinnedThrottled();\n  }\n\n  public async getParticipantByPeerId(peerId: PeerId) {\n    return NULL_PEER_ID === peerId ? this.participant : (await this.participants).get(peerId);\n  }\n\n  public toggleMuted() {\n    return this.requestAudioSource(true).then(() => this.changeUserMuted(NULL_PEER_ID));\n  }\n\n  public async changeUserMuted(peerId: PeerId, muted?: boolean) {\n    const participant = await this.getParticipantByPeerId(peerId);\n    if(NULL_PEER_ID === peerId && participant.pFlags.can_self_unmute) {\n      muted = muted === undefined ? !participant.pFlags.muted : muted;\n    }\n\n    return this.editParticipant(participant, {muted});\n  }\n\n  public getElement(endpoint: GroupCallOutputSource) {\n    return super.getElement(endpoint);\n  }\n\n  public getVideoElementFromParticipantByType(participant: GroupCallParticipant, type: 'video' | 'presentation') {\n    let source: GroupCallOutputSource;\n    if(participant.pFlags.self) {\n      const connectionType: GroupCallConnectionType = type === 'video' ? 'main' : 'presentation';\n      source = connectionType;\n    } else {\n      const codec = participant[type];\n      source = codec.source_groups[0].sources[0];\n    }\n\n    const element = this.getElement(source) as HTMLVideoElement;\n    if(!element) return;\n\n    const clone = element.cloneNode() as typeof element;\n    clone.srcObject = element.srcObject;\n    return {video: clone, source};\n  }\n\n  public createConnectionInstance(options: {\n    streamManager: StreamManager,\n    type: GroupCallConnectionType,\n    options: GroupCallConnectionInstance['options'],\n  }) {\n    return this.connections[options.type] = new GroupCallConnectionInstance({\n      groupCall: this,\n      log: this.log.bindPrefix(options.type),\n      managers: this.managers,\n      ...options\n    });\n  }\n\n  public changeRaiseHand(raise: boolean) {\n    return this.editParticipant(this.participant, {raiseHand: raise});\n  }\n\n  public async startScreenSharingInternal() {\n    try {\n      const type: GroupCallConnectionType = 'presentation';\n\n      const stream = await getScreenStream(getScreenConstraints());\n      const streamManager = new StreamManager();\n\n      const connectionInstance = this.createConnectionInstance({\n        streamManager,\n        type,\n        options: {\n          type\n        }\n      });\n\n      const connection = connectionInstance.createPeerConnection();\n      connection.addEventListener('negotiationneeded', () => {\n        connectionInstance.negotiate();\n      });\n\n      stream.getVideoTracks()[0].addEventListener('ended', () => {\n        if(this.connections.presentation) { // maybe user has stopped screensharing through browser's ui\n          this.stopScreenSharing();\n        }\n      }, {once: true});\n\n      connectionInstance.createDescription();\n      connectionInstance.addInputVideoStream(stream);\n    } catch(err) {\n      this.log.error('start screen sharing error', err);\n    }\n  }\n\n  public startScreenSharing() {\n    return this.startScreenSharingPromise ??= this.startScreenSharingInternal().finally(() => {\n      this.startScreenSharingPromise = undefined;\n    });\n  }\n\n  public stopScreenSharing() {\n    const connectionInstance = this.connections.presentation;\n    if(!connectionInstance) {\n      return Promise.resolve();\n    }\n\n    delete this.connections.presentation;\n    this.unpinSource('presentation');\n    connectionInstance.closeConnectionAndStream(true);\n\n    delete this.participant.presentation;\n    this.managers.appGroupCallsManager.saveApiParticipant(this.id, this.participant);\n\n    return this.managers.appGroupCallsManager.leaveGroupCallPresentation(this.id);\n  }\n\n  public toggleScreenSharing() {\n    if(this.isSharingScreen) {\n      return this.stopScreenSharing();\n    } else {\n      return this.startScreenSharing();\n    }\n  }\n\n  public async startVideoSharingInternal() {\n    const constraints: MediaStreamConstraints = {\n      video: getVideoConstraints()\n    };\n\n    try {\n      const stream = await getStream(constraints, false);\n      const connectionInstance = this.connections.main;\n      connectionInstance.addInputVideoStream(stream);\n\n      await this.editParticipant(this.participant, {\n        videoPaused: false,\n        videoStopped: false\n      });\n    } catch(err) {\n      this.log.error('startVideoSharing error', err, constraints);\n    }\n  }\n\n  public startVideoSharing() {\n    return this.startVideoSharingPromise ??= this.startVideoSharingInternal().finally(() => {\n      this.startVideoSharingPromise = undefined;\n    });\n  }\n\n  public async stopVideoSharing() {\n    const connectionInstance = this.connections.main;\n    const track = connectionInstance.streamManager.inputStream.getVideoTracks()[0];\n    if(!track) {\n      return;\n    }\n\n    stopTrack(track);\n    connectionInstance.streamManager.appendToConference(connectionInstance.description); // clear sender track\n\n    await this.editParticipant(this.participant, {\n      videoStopped: true\n    });\n  }\n\n  public toggleVideoSharing() {\n    if(this.isSharingVideo) {\n      return this.stopVideoSharing();\n    } else {\n      return this.startVideoSharing();\n    }\n  }\n\n  public async hangUp(discard = false, rejoin = false, isDiscarded = false) {\n    for(const type in this.connections) {\n      const connection = this.connections[type as GroupCallConnectionType];\n      connection.closeConnectionAndStream(!rejoin);\n    }\n\n    this.dispatchEvent('state', this.state);\n\n    if(isDiscarded) {\n      return;\n    }\n\n    if(!rejoin) {\n      const d = discard || (this.joined ? this.connections.main.sources.audio.source : undefined);\n      this.managers.appGroupCallsManager.hangUp(this.id, d);\n    }\n  }\n\n  public tryAddTrack(options: Omit<TryAddTrackOptions, 'streamManager'>) {\n    const {description} = this;\n    const source = super.tryAddTrack(options);\n\n    if(options.type === 'output') {\n      const entry = description.getEntryBySource(+source);\n      this.getParticipantByPeerId(entry.peerId).then((participant) => {\n        if(participant) {\n          rootScope.dispatchEvent('group_call_participant', {groupCallId: this.id, participant});\n        }\n      });\n    }\n\n    return source;\n  }\n\n  public async editParticipant(participant: GroupCallParticipant, options: Partial<{\n    muted: boolean,\n    volume: number,\n    raiseHand: boolean,\n    videoStopped: boolean,\n    videoPaused: boolean,\n    presentationPaused: boolean\n  }>) {\n    if(!Object.keys(options).length) {\n      return;\n    }\n\n    // let processUpdate = true;\n    if(participant) {\n      // const {currentGroupCall} = this;\n      // const isCurrentCall = currentGroupCall?.id === groupCallId;\n      const isCurrentCall = true;\n      const isUpdatingMeInCurrentCall = isCurrentCall && participant.pFlags.self;\n\n      if(isUpdatingMeInCurrentCall) {\n        if(options.muted !== undefined && !this.isSharingAudio) {\n          delete options.muted;\n\n          if(!Object.keys(options).length) {\n            return;\n          }\n        }\n      }\n\n      // if(isCurrentCall) {\n      const muted = options.muted;\n      if(muted !== undefined) {\n        /* const isAdmin = appChatsManager.hasRights(currentGroupCall.chatId, 'manage_call');\n          if(isAdmin) {\n            if(muted) {\n              participant.pFlags.muted = true;\n              delete participant.pFlags.can_self_unmute;\n            } else {\n              participant.pFlags.can_self_unmute = true;\n            }\n          } else  */if(participant.pFlags.self) {\n          if(muted) {\n            participant.pFlags.muted = true;\n          } else if(participant.pFlags.can_self_unmute) {\n            delete participant.pFlags.muted;\n          }\n        }/*  else {\n            if(muted) {\n              participant.pFlags.muted_by_you = true;\n            } else {\n              delete participant.pFlags.muted_by_you;\n            }\n          } */\n      }\n      // }\n\n      /* const a: [keyof GroupCallParticipant['pFlags'], keyof typeof options][] = [\n        ['muted', 'muted']\n      ];\n\n      a.forEach(([key, optionKey]) => {\n        const value = options[optionKey];\n        if(value === undefined) {\n          return;\n        }\n\n        if(value) {\n          participant.pFlags[key] = true;\n        } else {\n          delete participant.pFlags[key];\n        }\n      }); */\n\n      if(options.raiseHand !== undefined) {\n        if(options.raiseHand) participant.raise_hand_rating = '1';\n        else delete participant.raise_hand_rating;\n      }\n\n      if(isUpdatingMeInCurrentCall) {\n        if(options.videoStopped !== undefined) {\n          if(options.videoStopped) delete participant.video;\n          else participant.video = generateSelfVideo(this.connections.main.sources.video);\n        }\n\n        if(!participant.pFlags.muted && participant.pFlags.can_self_unmute) {\n          this.setMuted(false);\n        }\n\n        this.dispatchEvent('state', this.state);\n      }\n\n      // rootScope.dispatchEvent('group_call_participant', {groupCallId, participant});\n\n      /* if(participant.pFlags.self) {\n        processUpdate = false;\n      } */\n    }\n\n    return this.managers.appGroupCallsManager.editParticipant(this.id, participant, options);\n  }\n\n  public onParticipantUpdate(participant: GroupCallParticipant, doNotDispatchParticipantUpdate?: PeerId) {\n    const connectionInstance = this.connections.main;\n    const {connection, description} = connectionInstance;\n\n    const peerId = getPeerId(participant.peer);\n    const hasLeft = !!participant.pFlags.left;\n    const oldSsrcs = this.participantsSsrcs.get(peerId) || [];\n\n    if(participant.presentation && !hasLeft) {\n      const {source} = makeSsrcFromParticipant(participant, 'video', participant.presentation.source_groups, participant.presentation.endpoint);\n      if(!this.hadAutoPinnedSources.has(source)) {\n        this.hadAutoPinnedSources.add(source);\n        this.pinSource(participant.pFlags.self ? 'presentation' : source);\n      }\n    }\n\n    if(participant.pFlags.self) {\n      this.participant = participant;\n\n      if(connectionInstance.sources.audio.source !== participant.source) {\n        this.hangUp();\n      }\n\n      let mute = false;\n      if(!participant.pFlags.can_self_unmute) {\n        this.stopScreenSharing();\n        this.stopVideoSharing();\n        mute = true;\n      } else if(participant.pFlags.muted) {\n        mute = true;\n      }\n\n      if(mute) {\n        this.setMuted(true);\n      }\n\n      if(doNotDispatchParticipantUpdate !== peerId) {\n        this.dispatchEvent('state', this.state);\n      }\n\n      return;\n    }\n\n    const ssrcs = hasLeft ? [] : makeSsrcsFromParticipant(participant);\n\n    if(!hasLeft) {\n      this.participantsSsrcs.set(peerId, ssrcs);\n    } else {\n      this.participantsSsrcs.delete(peerId);\n    }\n\n    // const TEST_OLD = false;\n\n    const modifiedTypes: Set<WebRTCLineType> = new Set();\n    oldSsrcs.forEach((oldSsrc) => {\n      const oldSource = oldSsrc.source;\n      const newSsrc = ssrcs.find((ssrc) => ssrc.source === oldSource);\n      if(!newSsrc) {\n        this.unpinSource(oldSource);\n\n        const oldEntry = description.getEntryBySource(oldSource);\n        if(oldEntry && oldEntry.direction !== 'inactive') {\n          oldEntry.setDirection('inactive');\n          modifiedTypes.add(oldEntry.type);\n        }\n      }\n    });\n\n    ssrcs.forEach((ssrc) => {\n      let entry = description.getEntryBySource(ssrc.source);\n      if(entry) {\n        if(entry.direction === 'inactive') {\n          entry.setDirection(entry.originalDirection);\n          modifiedTypes.add(entry.type);\n        }\n\n        return;\n      }\n\n      entry = description.createEntry(ssrc.type);\n      description.setEntrySource(entry, ssrc.sourceGroups || ssrc.source);\n      description.setEntryPeerId(entry, peerId);\n\n      // if(TEST_OLD) {\n      //   description.bundleMids.push(entry.mid);\n      //   entry.setDirection('recvonly');\n      // } else {\n      ssrc.type === 'video' && entry.setEndpoint(ssrc.endpoint);\n      entry.createTransceiver(connection, {direction: 'recvonly'});\n      // }\n\n      modifiedTypes.add(entry.type);\n    });\n\n    /* if(TEST_OLD) {\n      this.setRemoteOffer({\n        connection,\n        description,\n        ssrcs\n      });\n    } else  */if(modifiedTypes.size) {\n      if(modifiedTypes.has('video')) {\n        connectionInstance.updateConstraints = true;\n      }\n\n      connectionInstance.negotiateThrottled();\n    }\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nenum GROUP_CALL_STATE {\n  UNMUTED,\n  MUTED,\n  MUTED_BY_ADMIN,\n  CONNECTING,\n  CLOSED\n}\n\nexport default GROUP_CALL_STATE;\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport AudioAssetPlayer from '../../helpers/audioAssetPlayer';\r\n\r\nexport type GroupCallAudioAssetName = 'group_call_connect.mp3' | 'group_call_end.mp3' | 'group_call_start.mp3' | 'voip_onallowtalk.mp3';\r\n\r\nlet audioAsset: AudioAssetPlayer<GroupCallAudioAssetName>;\r\nexport default function getGroupCallAudioAsset() {\r\n  return audioAsset ??= new AudioAssetPlayer([\r\n    'group_call_connect.mp3',\r\n    'group_call_end.mp3',\r\n    'group_call_start.mp3',\r\n    'voip_onallowtalk.mp3'\r\n  ]);\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport getGroupCallAudioAsset from '../../components/groupCall/getAudioAsset';\r\nimport {MOUNT_CLASS_TO} from '../../config/debug';\r\nimport EventListenerBase from '../../helpers/eventListenerBase';\r\nimport {GroupCallParticipant, GroupCallParticipantVideo, GroupCallParticipantVideoSourceGroup} from '../../layer';\r\nimport {GroupCallId, GroupCallConnectionType} from '../appManagers/appGroupCallsManager';\r\nimport {AppManagers} from '../appManagers/managers';\r\nimport {logger} from '../logger';\r\nimport rootScope from '../rootScope';\r\nimport GroupCallInstance from './groupCallInstance';\r\nimport GROUP_CALL_STATE from './groupCallState';\r\nimport createMainStreamManager from './helpers/createMainStreamManager';\r\nimport {generateSsrc} from './localConferenceDescription';\r\nimport {WebRTCLineType} from './sdpBuilder';\r\nimport StreamManager from './streamManager';\r\nimport {Ssrc} from './types';\r\n\r\nconst IS_MUTED = true;\r\n\r\nexport function makeSsrcsFromParticipant(participant: GroupCallParticipant) {\r\n  return [\r\n    makeSsrcFromParticipant(participant, 'audio', participant.source),\r\n    participant.video?.audio_source && makeSsrcFromParticipant(participant, 'audio', participant.video.audio_source),\r\n    participant.video && makeSsrcFromParticipant(participant, 'video', participant.video.source_groups, participant.video.endpoint),\r\n    participant.presentation?.audio_source && makeSsrcFromParticipant(participant, 'audio', participant.presentation.audio_source),\r\n    participant.presentation && makeSsrcFromParticipant(participant, 'video', participant.presentation.source_groups, participant.presentation.endpoint)\r\n  ].filter(Boolean);\r\n};\r\n\r\nexport function makeSsrcFromParticipant(participant: GroupCallParticipant, type: WebRTCLineType, source?: number | GroupCallParticipantVideoSourceGroup[], endpoint?: string): Ssrc {\r\n  return generateSsrc(type, source, endpoint);\r\n}\r\n\r\nexport function generateSelfVideo(source: Ssrc, audioSource?: number): GroupCallParticipantVideo {\r\n  return source && {\r\n    _: 'groupCallParticipantVideo',\r\n    pFlags: {},\r\n    endpoint: '',\r\n    source_groups: source.sourceGroups,\r\n    audio_source: audioSource\r\n  };\r\n}\r\n\r\nexport class GroupCallsController extends EventListenerBase<{\r\n  instance: (instance: GroupCallInstance) => void\r\n}> {\r\n  private audioAsset: ReturnType<typeof getGroupCallAudioAsset>;\r\n  private log: ReturnType<typeof logger>;\r\n  private currentGroupCall: GroupCallInstance;\r\n  private managers: AppManagers;\r\n\r\n  public construct(managers: AppManagers) {\r\n    this.managers = managers;\r\n    this.audioAsset = getGroupCallAudioAsset();\r\n    this.log = logger('GCC');\r\n\r\n    rootScope.addEventListener('group_call_update', (groupCall) => {\r\n      const {currentGroupCall} = this;\r\n      if(currentGroupCall?.id === groupCall.id) {\r\n        currentGroupCall.groupCall = groupCall;\r\n\r\n        if(groupCall._ === 'groupCallDiscarded') {\r\n          currentGroupCall.hangUp(false, false, true);\r\n        }\r\n      }\r\n    });\r\n\r\n    rootScope.addEventListener('group_call_participant', ({groupCallId, participant}) => {\r\n      const {currentGroupCall} = this;\r\n      if(currentGroupCall?.id === groupCallId) {\r\n        currentGroupCall.onParticipantUpdate(participant/* , this.doNotDispatchParticipantUpdate */);\r\n      }\r\n    });\r\n  }\r\n\r\n  get groupCall() {\r\n    return this.currentGroupCall;\r\n  }\r\n\r\n  public setCurrentGroupCall(groupCall: GroupCallInstance) {\r\n    this.currentGroupCall = groupCall;\r\n\r\n    if(groupCall) {\r\n      this.dispatchEvent('instance', groupCall);\r\n    }\r\n  }\r\n\r\n  public startConnectingSound() {\r\n    this.stopConnectingSound();\r\n    this.audioAsset.playSoundWithTimeout('group_call_connect.mp3', true, 2500);\r\n  }\r\n\r\n  public stopConnectingSound() {\r\n    this.audioAsset.stopSound();\r\n    this.audioAsset.cancelDelayedPlay();\r\n  }\r\n\r\n  public async joinGroupCall(chatId: ChatId, groupCallId: GroupCallId, muted = IS_MUTED, rejoin?: boolean, joinVideo?: boolean) {\r\n    this.audioAsset.createAudio();\r\n\r\n    this.log(`joinGroupCall chatId=${chatId} id=${groupCallId} muted=${muted} rejoin=${rejoin}`);\r\n\r\n    let streamManager: StreamManager;\r\n    if(rejoin) {\r\n      streamManager = this.currentGroupCall.connections.main.streamManager;\r\n    } else {\r\n      streamManager = await createMainStreamManager(muted, joinVideo);\r\n    }\r\n\r\n    return this.joinGroupCallInternal(chatId, groupCallId, streamManager, muted, rejoin, joinVideo);\r\n  }\r\n\r\n  public async joinGroupCallInternal(chatId: ChatId, groupCallId: GroupCallId, streamManager: StreamManager, muted: boolean, rejoin = false, joinVideo?: boolean) {\r\n    const log = this.log.bindPrefix('joinGroupCallInternal');\r\n    log('start', groupCallId);\r\n\r\n    const type: GroupCallConnectionType = 'main';\r\n\r\n    let {currentGroupCall} = this;\r\n    if(currentGroupCall && rejoin) {\r\n      // currentGroupCall.connections.main.connection = connection;\r\n      currentGroupCall.handleUpdateGroupCallParticipants = false;\r\n      currentGroupCall.updatingSdp = false;\r\n      log('update currentGroupCall', groupCallId, currentGroupCall);\r\n    } else {\r\n      currentGroupCall = new GroupCallInstance({\r\n        chatId,\r\n        id: groupCallId,\r\n        managers: this.managers\r\n      });\r\n\r\n      currentGroupCall.fixSafariAudio();\r\n\r\n      currentGroupCall.addEventListener('state', (state) => {\r\n        if(this.currentGroupCall === currentGroupCall && state === GROUP_CALL_STATE.CLOSED) {\r\n          this.setCurrentGroupCall(null);\r\n          this.stopConnectingSound();\r\n          this.audioAsset.playSound('group_call_end.mp3');\r\n          rootScope.dispatchEvent('chat_update', currentGroupCall.chatId);\r\n        }\r\n      });\r\n\r\n      currentGroupCall.groupCall = await this.managers.appGroupCallsManager.getGroupCallFull(groupCallId);\r\n\r\n      const connectionInstance = currentGroupCall.createConnectionInstance({\r\n        streamManager,\r\n        type,\r\n        options: {\r\n          type,\r\n          isMuted: muted,\r\n          joinVideo,\r\n          rejoin\r\n        }\r\n      });\r\n\r\n      const connection = connectionInstance.createPeerConnection();\r\n      connection.addEventListener('negotiationneeded', () => {\r\n        connectionInstance.negotiate();\r\n      });\r\n\r\n      connection.addEventListener('track', (event) => {\r\n        log('ontrack', event);\r\n        currentGroupCall.onTrack(event);\r\n      });\r\n\r\n      connection.addEventListener('iceconnectionstatechange', () => {\r\n        currentGroupCall.dispatchEvent('state', currentGroupCall.state);\r\n\r\n        const {iceConnectionState} = connection;\r\n        if(iceConnectionState === 'disconnected' || iceConnectionState === 'checking' || iceConnectionState === 'new') {\r\n          this.startConnectingSound();\r\n        } else {\r\n          this.stopConnectingSound();\r\n        }\r\n\r\n        switch(iceConnectionState) {\r\n          case 'checking': {\r\n            break;\r\n          }\r\n\r\n          case 'closed': {\r\n            currentGroupCall.hangUp();\r\n            break;\r\n          }\r\n\r\n          case 'completed': {\r\n            break;\r\n          }\r\n\r\n          case 'connected': {\r\n            if(!currentGroupCall.joined) {\r\n              currentGroupCall.joined = true;\r\n              this.audioAsset.playSound('group_call_start.mp3');\r\n              this.managers.appGroupCallsManager.getGroupCallParticipants(groupCallId);\r\n            }\r\n\r\n            break;\r\n          }\r\n\r\n          case 'disconnected': {\r\n            break;\r\n          }\r\n\r\n          case 'failed': {\r\n            // TODO: replace with ICE restart\r\n            currentGroupCall.hangUp();\r\n            // connection.restartIce();\r\n            break;\r\n          }\r\n\r\n          case 'new': {\r\n            break;\r\n          }\r\n        }\r\n      });\r\n\r\n      connectionInstance.createDescription();\r\n      connectionInstance.createDataChannel();\r\n\r\n      connectionInstance.appendStreamToConference();\r\n\r\n      this.setCurrentGroupCall(currentGroupCall);\r\n      log('set currentGroupCall', groupCallId, currentGroupCall);\r\n\r\n      this.startConnectingSound();\r\n\r\n      return connectionInstance.negotiate();\r\n    }\r\n  }\r\n}\r\n\r\nconst groupCallsController = new GroupCallsController();\r\nMOUNT_CLASS_TO && (MOUNT_CLASS_TO.groupCallController = groupCallsController);\r\nexport default groupCallsController;\r\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport {GROUP_CALL_AMPLITUDE_ANALYSE_INTERVAL_MS} from '../constants';\nimport StreamManager from '../streamManager';\nimport getAudioConstraints from './getAudioConstraints';\nimport getStream from './getStream';\nimport getVideoConstraints from './getVideoConstraints';\n\nexport default async function createMainStreamManager(muted?: boolean, joinVideo?: boolean) {\n  const constraints: MediaStreamConstraints = {\n    audio: getAudioConstraints(),\n    video: joinVideo && getVideoConstraints()\n  };\n\n  const streamManager = new StreamManager(GROUP_CALL_AMPLITUDE_ANALYSE_INTERVAL_MS);\n\n  try {\n    const stream = await getStream(constraints, muted);\n    streamManager.addStream(stream, 'input');\n  } catch(err) {\n    console.error('joinGroupCall getStream error', err, constraints);\n    streamManager.inputStream = new MediaStream();\n  }\n\n  return streamManager;\n}\n","import constraintSupported, {MyMediaTrackSupportedConstraints} from '../../../environment/constraintSupport';\n\nexport default function getAudioConstraints(): MediaTrackConstraints {\n  const constraints: MediaTrackConstraints = {\n    channelCount: 2\n  };\n\n  const desirable: (keyof MyMediaTrackSupportedConstraints)[] = [\n    'noiseSuppression',\n    'echoCancellation',\n    'autoGainControl'\n  ];\n\n  desirable.forEach((constraint) => {\n    if(constraintSupported(constraint)) {\n      // @ts-ignore\n      constraints[constraint] = true;\n    }\n  });\n\n  return constraints;\n}\n","export type MyMediaTrackSupportedConstraints = MediaTrackSupportedConstraints & {\n  noiseSuppression?: boolean,\n  autoGainControl?: boolean\n};\n\nexport default function constraintSupported(constraint: keyof MyMediaTrackSupportedConstraints) {\n  return (!!navigator?.mediaDevices?.getSupportedConstraints() as any as MyMediaTrackSupportedConstraints)[constraint];\n}\n","export default function getScreenConstraints(skipAudio?: boolean) {\n  const constraints: DisplayMediaStreamConstraints = {\n    video: {\n      // @ts-ignore\n      // cursor: 'always',\n      width: {max: 1920},\n      height: {max: 1080},\n      frameRate: {max: 30}\n    }\n  };\n\n  if(!skipAudio) {\n    constraints.audio = true;\n  }\n\n  return constraints;\n}\n","export default async function getScreenStream(constraints: DisplayMediaStreamConstraints) {\n  const screenStream = await navigator.mediaDevices.getDisplayMedia(constraints);\n  const track = screenStream.getVideoTracks()[0];\n  track.contentHint = 'text';\n  return screenStream;\n}\n","export default async function getStream(constraints: MediaStreamConstraints, muted: boolean) {\n  // console.log('getStream', constraints);\n\n  const stream = await navigator.mediaDevices.getUserMedia(constraints);\n  stream.getTracks().forEach((x) => {\n    x.enabled = !muted;\n  });\n\n  // console.log('getStream result', stream);\n  return stream;\n}\n\n(window as any).getStream = getStream;\n","export default function getVideoConstraints(): MediaTrackConstraints {\n  return {\n    width: {min: 1280, max: 1920/* , ideal: 1920 */},\n    height: {min: 720, max: 1080/* , ideal: 1080 */},\n    frameRate: {min: 24, max: 30}\n  };\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport SDP from '../sdp';\nimport SDPMediaSection from '../sdp/mediaSection';\nimport {toTelegramSource} from '../utils';\nimport {parseSourceGroups} from './parseSourceGroups';\n\nexport default function parseMediaSectionInfo(sdp: SDP, channel: SDPMediaSection) {\n  const clientInfo = channel.lookupAttributeKeys({\n    'ice-ufrag': true,\n    'ice-pwd': true,\n    'fingerprint': true,\n    'setup': true,\n    'ssrc': true,\n    'mid': true,\n    'ssrc-group': false\n  });\n\n  if(!clientInfo.fingerprint) { // support Firefox\n    const line = sdp.session.lines.find((line) => line.parsed?.key === 'fingerprint');\n    clientInfo.fingerprint = line.parsed.value;\n  }\n\n  const telegramSourceGroups = parseSourceGroups(clientInfo['ssrc-group']);\n  const [hash, fingerprint] = clientInfo.fingerprint.split(' ', 2);\n  const ssrc = clientInfo.ssrc && toTelegramSource(+clientInfo.ssrc.split(' ', 1)[0]);\n  // ssrc = telegramSourceGroups ? telegramSourceGroups[0].sources[0] : ssrc;\n\n  return {\n    raw: clientInfo,\n    ufrag: clientInfo['ice-ufrag'],\n    pwd: clientInfo['ice-pwd'],\n    fingerprint: {\n      fingerprint,\n      setup: clientInfo.setup,\n      hash\n    },\n    source: ssrc,\n    sourceGroups: telegramSourceGroups,\n    mid: clientInfo.mid\n  };\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport {GroupCallParticipantVideoSourceGroup} from '../../../layer';\nimport {toTelegramSource} from '../utils';\n\nexport function parseSourceGroups(sdpLines: string[]) {\n  const telegramSourceGroups = sdpLines.map((str) => {\n    const [semantics, ...rest] = str.split(' ');\n\n    const sourceGroup: GroupCallParticipantVideoSourceGroup = {\n      _: 'groupCallParticipantVideoSourceGroup',\n      semantics,\n      // sources: rest.map((ssrc) => +ssrc)\n      sources: rest.map((ssrc) => toTelegramSource(+ssrc))\n    };\n\n    return sourceGroup;\n  });\n\n  /* const simIndex = telegramSourceGroups.findIndex((g) => g.semantics === 'SIM');\n  if(simIndex !== -1) {\n    const sourceGroup = telegramSourceGroups.splice(simIndex, 1)[0];\n    telegramSourceGroups.unshift(sourceGroup);\n  } */\n\n  return telegramSourceGroups.length ? telegramSourceGroups : undefined;\n}\n","import simulateEvent from '../../../helpers/dom/dispatchEvent';\n\nexport default function stopTrack(track: MediaStreamTrack) {\n  track.stop();\n  simulateEvent(track, 'ended');\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n *\n * Originally from:\n * https://github.com/evgeny-nadymov/telegram-react\n * Copyright (C) 2018 Evgeny Nadymov\n * https://github.com/evgeny-nadymov/telegram-react/blob/master/LICENSE\n */\n\nimport indexOfAndSplice from '../../helpers/array/indexOfAndSplice';\nimport safeAssign from '../../helpers/object/safeAssign';\nimport {GroupCallParticipantVideoSourceGroup} from '../../layer';\nimport {fixMediaLineType, SDPBuilder, WebRTCLineType, WEBRTC_MEDIA_PORT} from './sdpBuilder';\nimport {AudioCodec, GroupCallConnectionTransport, Ssrc, UpdateGroupCallConnectionData, VideoCodec} from './types';\n\nexport class ConferenceEntry {\n  public source: number;\n  public sourceGroups: GroupCallParticipantVideoSourceGroup[];\n  public transceiver: RTCRtpTransceiver;\n  public originalDirection: RTCRtpTransceiverDirection;\n  public direction: RTCRtpTransceiverDirection;\n  public port: string;\n  public endpoint: string;\n  public peerId: PeerId;\n\n  public sendEntry: ConferenceEntry;\n  public recvEntry: ConferenceEntry;\n\n  constructor(public mid: string, public type: WebRTCLineType) {\n    this.port = WEBRTC_MEDIA_PORT;\n  }\n\n  public setDirection(direction: RTCRtpTransceiverDirection) {\n    if(!this.originalDirection) {\n      this.originalDirection = direction;\n    }\n\n    return this.direction = direction;\n  }\n\n  public setPort(port: string) {\n    return this.port = port;\n  }\n\n  public setEndpoint(endpoint: string) {\n    return this.endpoint = endpoint;\n  }\n\n  public setPeerId(peerId: PeerId) {\n    return this.peerId = peerId;\n  }\n\n  public createTransceiver(connection: RTCPeerConnection, init?: RTCRtpTransceiverInit) {\n    if(init?.direction) {\n      this.setDirection(init.direction);\n    }\n\n    return this.transceiver = connection.addTransceiver(fixMediaLineType(this.type), init);\n  }\n\n  public setSource(source: number | GroupCallParticipantVideoSourceGroup[]) {\n    let sourceGroups: GroupCallParticipantVideoSourceGroup[];\n    if(Array.isArray(source)) {\n      if(!source[0]) return;\n      sourceGroups = source;\n      source = sourceGroups[0].sources[0];\n    }\n\n    this.sourceGroups = sourceGroups;\n    return this.source = source;\n  }\n\n  public shouldBeSkipped(isAnswer?: boolean) {\n    return isAnswer && this.direction === 'inactive';\n  }\n}\n\nexport function generateSsrc(type: WebRTCLineType, source: number | GroupCallParticipantVideoSourceGroup[], endpoint?: string): Ssrc {\n  let sourceGroups: GroupCallParticipantVideoSourceGroup[];\n  if(Array.isArray(source)) {\n    if(!source[0]) return;\n    sourceGroups = source;\n    source = sourceGroups[0].sources[0];\n  }\n\n  return {\n    endpoint,\n    type,\n    source,\n    sourceGroups\n  };\n}\n\nexport default class LocalConferenceDescription implements UpdateGroupCallConnectionData {\n  public readonly sessionId: string;\n  // public ssrcs: Ssrc[];\n  public readonly transport: GroupCallConnectionTransport;\n  public readonly audio?: AudioCodec;\n  public readonly video: VideoCodec;\n  public readonly screencast?: VideoCodec;\n\n  private maxSeenId: number;\n  public readonly entries: ConferenceEntry[];\n  private entriesByMid: Map<ConferenceEntry['mid'], ConferenceEntry>;\n  private entriesBySource: Map<ConferenceEntry['source'], ConferenceEntry>;\n  private entriesByPeerId: Map<ConferenceEntry['peerId'], Set<ConferenceEntry>>;\n\n  constructor(public connection: RTCPeerConnection) {\n    this.sessionId = '' + Date.now();\n    // this.ssrcs = [];\n    this.maxSeenId = -1;\n    this.entries = [];\n    this.entriesByMid = new Map();\n    this.entriesBySource = new Map();\n    this.entriesByPeerId = new Map();\n  }\n\n  public setData(data: UpdateGroupCallConnectionData) {\n    return safeAssign(this, data);\n  }\n\n  public createEntry(type: WebRTCLineType) {\n    const mid = '' + ++this.maxSeenId;\n    const entry = new ConferenceEntry(mid, type);\n    this.entries.push(entry);\n    this.entriesByMid.set(mid, entry);\n    return entry;\n  }\n\n  public deleteEntry(entry: ConferenceEntry) {\n    indexOfAndSplice(this.entries, entry);\n    this.entriesByMid.delete(entry.mid);\n    this.entriesBySource.delete(entry.source);\n\n    const set = this.entriesByPeerId.get(entry.peerId);\n    if(set) {\n      set.delete(entry);\n      if(!set.size) {\n        this.entriesByPeerId.delete(entry.peerId);\n      }\n    }\n  }\n\n  public setEntrySource(entry: ConferenceEntry, source: Parameters<ConferenceEntry['setSource']>[0]) {\n    entry.setSource(source);\n    this.entriesBySource.set(entry.source, entry);\n  }\n\n  public setEntryPeerId(entry: ConferenceEntry, peerId: ConferenceEntry['peerId']) {\n    entry.setPeerId(peerId);\n    let set = this.entriesByPeerId.get(peerId);\n    if(!set) {\n      this.entriesByPeerId.set(peerId, set = new Set());\n    }\n\n    set.add(entry);\n  }\n\n  public findEntry(verify: Parameters<LocalConferenceDescription['entries']['find']>[0]) {\n    return this.entries.find(verify);\n  }\n\n  public findFreeSendRecvEntry(type: WebRTCLineType, isSending: boolean) {\n    let entry = this.entries.find((entry) => {\n      return entry.direction === 'sendrecv' && entry.type === type && !(isSending ? entry.sendEntry : entry.recvEntry);\n    });\n\n    if(!entry) {\n      entry = this.createEntry(type);\n      entry.setDirection('sendrecv');\n    }\n\n    return entry;\n  }\n\n  public getEntryByMid(mid: ConferenceEntry['mid']) {\n    return this.entriesByMid.get(mid);\n  }\n\n  public getEntryBySource(source: ConferenceEntry['source']) {\n    return this.entriesBySource.get(source);\n  }\n\n  public getEntriesByPeerId(peerId: ConferenceEntry['peerId']) {\n    return this.entriesByPeerId.get(peerId);\n  }\n\n  public generateSdp(options: Omit<Parameters<SDPBuilder['addConference']>[0], 'conference'>) {\n    return SDPBuilder.fromConference({\n      conference: this,\n      ...options\n    });\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport SDPMediaSection from './mediaSection';\nimport SDPSessionSection from './sessionSection';\n\nexport type AttributeKey = 'group' | 'rtcp' | 'ice-ufrag' |\n  'ice-pwd' | 'ice-options' | 'fingerprint' | 'setup' |\n  'mid' | 'extmap' | 'sendonly' | 'msid' | 'rtcp-mux' |\n  'rtpmap' | 'rtcp-fb' | 'fmtp' | 'ssrc' | 'ssrc-group' |\n  'extmap-allow-mixed' | 'msid-semantic';\n\nexport type AttributeMap = {[k in AttributeKey]?: boolean};\n\nexport default class SDP {\n  #session: SDPSessionSection;\n  #media: SDPMediaSection[];\n\n  constructor(session: SDP['session'], mediaSections: SDP['media']) {\n    this.#session = session;\n    this.#media = mediaSections;\n  }\n\n  public get session() {\n    return this.#session;\n  }\n\n  public get media() {\n    return this.#media;\n  }\n\n  public get bundle() {\n    const bundleLine = this.session.lines.find((line) => line.parsed?.key === 'group');\n    return bundleLine.value.split(' ').slice(1);\n  }\n\n  toString() {\n    return this.session.lines\n    .concat(...this.media.map((section) => section.lines))\n    .map((line) => line.toString()).join('\\r\\n') + '\\r\\n';\n  }\n\n  /* get buggedMedia() {\n    const bundle = this.bundle;\n    type A = {\n      mid: SDPMediaSection['mid'],\n      mediaType: SDPMediaSection['mediaType'],\n      direction: SDPMediaSection['direction']\n    };\n    const out: A[] = [];\n    for(let i = 0, length = this.media.length; i < length; ++i) {\n      const section = this.media[i];\n      const mid = section.mid;\n      if(!bundle.includes(mid)) {\n        out.push(section);\n      }\n    }\n\n    return out;\n  } */\n\n  /* get mediaTypes() {\n    return this.media.map((section) => {\n      return {mid: section.oa.get('mid').oa, type: section.mediaType, direction: section.direction};\n    });\n  } */\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nexport default function splitStringByLimitWithRest(str: string, separator: string, limit: number) {\n  const splitted = str.split(separator);\n  const out: string[] = [];\n\n  while(limit > 0 && splitted.length) {\n    out.push(splitted.shift());\n    --limit;\n  }\n\n  if(splitted.length) {\n    out.push(splitted.join(separator));\n  }\n\n  return out;\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nexport default class UniqueNumberGenerator {\n  #set: Set<number>;\n  #min: number;\n  #max: number;\n\n  constructor(min: number, max: number) {\n    this.#set = new Set();\n    this.#min = min;\n    this.#max = max;\n  }\n\n  public generate() {\n    const min = this.#min;\n    const max = this.#max;\n    const set = this.#set;\n\n    const maxTries = max - min + 1;\n    let value = Math.floor(min + maxTries * Math.random()), _try = 0;\n    while(set.has(value)) {\n      if(value < max) {\n        ++value;\n      } else {\n        value = min;\n      }\n\n      if(++_try >= maxTries) {\n        return null;\n      }\n    }\n\n    set.add(value);\n    return value;\n  }\n\n  public add(value: number) {\n    this.#set.add(value);\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport {AttributeKey} from '.';\n\nexport default class SDPAttributeSplitted {\n  #key: AttributeKey;\n  #value: string;\n\n  // key = 'ssrc-group', value = 'SIM 1 2 3'\n  constructor(key: AttributeKey, value: string) {\n    this.#key = key;\n    this.#value = value;\n  }\n\n  public get key() {\n    return this.#key;\n  }\n\n  public get value() {\n    return this.#value;\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nexport default class SDPMediaLineParts {\n  #type: 'audio' | 'video' | 'application';\n  #port: string;\n  #protocol: string;\n  #ids: string[];\n\n  constructor(\n    type: SDPMediaLineParts['type'],\n    port: SDPMediaLineParts['port'],\n    protocol: SDPMediaLineParts['protocol'],\n    ids: SDPMediaLineParts['ids']\n  ) {\n    this.#type = type;\n    this.#port = port;\n    this.#protocol = protocol;\n    this.#ids = ids;\n  }\n\n  public get type() {\n    return this.#type;\n  }\n\n  public get port() {\n    return this.#port;\n  }\n\n  public get protocol() {\n    return this.#protocol;\n  }\n\n  public get ids() {\n    return this.#ids;\n  }\n\n  toString() {\n    return this.type + ' ' + this.port + ' ' + this.protocol + ' ' + this.ids.join(' ');\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport splitStringByLimitWithRest from '../../../helpers/string/splitStringByLimitWithRest';\nimport SDPAttributeSplitted from './attributeSplitted';\nimport SDPMediaLineParts from './mediaLineParts';\n\nexport default class SDPLine {\n  #key: 'm' | 'a' | 'o' | 'v' | 's' | 't' | 'c';\n  #value: string;\n  #mediaLineParts: SDPMediaLineParts;\n  #parsed?: SDPAttributeSplitted;\n\n  // key = 'a', value = 'ssrc-group:SIM 1 2 3'\n  constructor(key: SDPLine['key'], value: string | SDPMediaLineParts | SDPAttributeSplitted) {\n    this.#key = key;\n\n    if(typeof(value) === 'string') {\n      this.#value = value;\n\n      if(key === 'm') {\n        const splitted = value.split(' ');\n        this.#mediaLineParts = new SDPMediaLineParts(splitted[0] as any, splitted[1], splitted[2], splitted.slice(3));\n      } else {\n        if(key === 'a') {\n          const result = splitStringByLimitWithRest(value, ':', 1);\n          value = result[0];\n          this.#parsed = result.length === 1 ? new SDPAttributeSplitted(value as any, null) : new SDPAttributeSplitted(value as any, result[1]);\n        }\n      }\n    } else {\n      if(value instanceof SDPMediaLineParts) {\n        this.#mediaLineParts = value;\n        this.#value = value.toString();\n      } else if(value instanceof SDPAttributeSplitted) {\n        this.#parsed = value;\n        this.#value = value.value ? `${value.key}:${value.value}` : value.key;\n      }\n    }\n  }\n\n  public get key() {\n    return this.#key;\n  }\n\n  public get value() {\n    return this.#value;\n  }\n\n  public get parsed() {\n    return this.#parsed;\n  }\n\n  public get mediaLineParts() {\n    return this.#mediaLineParts;\n  }\n\n  toString() {\n    return `${this.key}=${this.value}`;\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport splitStringByLimitWithRest from '../../../helpers/string/splitStringByLimitWithRest';\n\nexport default class SDPAttributeInner {\n  #key: string;\n  #lines: Array<string>;\n  #prefix: string;\n  #nestedMap: Map<string, SDPAttributeInner>;\n  #missed: boolean;\n  #keys: Array<string>;\n\n  constructor(key: SDPAttributeInner['key'], lines: SDPAttributeInner['lines'], prefix: string = ':', missed = false) {\n    this.#key = key;\n    this.#lines = lines;\n    this.#prefix = prefix;\n    this.#missed = missed;\n    this.#nestedMap = missed ? new Map() : null;\n    this.#keys = missed ? [] : null;\n  }\n\n  public get lines() {\n    return this.#lines;\n  }\n\n  public get value() {\n    return this.#missed || !this.lines.length ? null : this.lines[0];\n  }\n\n  public get exists() {\n    return !this.#missed;\n  }\n\n  public get key() {\n    return this.#key;\n  }\n\n  public get keys() {\n    SDPAttributeInner.fill(this);\n    return this.#keys;\n  }\n\n  public forEach(callback: Parameters<Map<string, SDPAttributeInner>['forEach']>[0]) {\n    SDPAttributeInner.fill(this);\n    this.#nestedMap.forEach(callback);\n  }\n\n  public get(key: string) {\n    SDPAttributeInner.fill(this);\n    return this.#nestedMap.get(key) || new SDPAttributeInner(key, [], ':', true);\n  }\n\n  private static fill(attribute: SDPAttributeInner) {\n    if(attribute.#nestedMap !== null) {\n      return;\n    }\n\n    const map: Map<string, Array<string>> = new Map();\n    attribute.lines.forEach((str) => {\n      const [key, rest] = splitStringByLimitWithRest(str, attribute.#prefix, 1);\n      const values = map.get(key) || [];\n      map.set(key, [...values, rest || '']);\n    });\n\n    const nestedMap = attribute.#nestedMap = SDPAttributeInner.makeAttributes(map);\n    attribute.#keys = Array.from(nestedMap.keys());\n  }\n\n  private static makeAttributes(innerParts: Map<string, Array<string>>) {\n    const out: Map<string, SDPAttributeInner> = new Map();\n\n    innerParts.forEach((lines, key) => {\n      out.set(key, new SDPAttributeInner(key, lines));\n    });\n\n    return out;\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport SDPAttributeInner from './attributeInner';\nimport SDPLine from './line';\n\nexport default class SDPAttributes {\n  #lines: SDPLine[];\n  #attributes: Map<string, SDPAttributeInner>;\n\n  constructor(lines: SDPLine[]) {\n    this.#lines = lines;\n    this.#attributes = new Map();\n    SDPAttributes.fillAttributes(this);\n  }\n\n  public get(key: string) {\n    return this.#attributes.get(key) || new SDPAttributeInner(key, [], ' ', true);\n  }\n\n  private static fillAttributes(attributes: SDPAttributes) {\n    const attributesMap: Map<string, Array<string>> = new Map();\n    attributes.#lines.forEach((line) => {\n      if(line.key === 'a') {\n        const {key, value} = line.parsed;\n\n        let linesArray = attributesMap.get(key);\n        if(!linesArray) {\n          linesArray = [];\n          attributesMap.set(key, linesArray);\n        }\n\n        linesArray.push(value || '');\n      }\n    });\n\n    attributesMap.forEach((linesArray, key) => {\n      attributes.#attributes.set(key, new SDPAttributeInner(key, linesArray, ' ', false));\n    });\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport {AttributeMap} from '.';\nimport {NoExtraProperties} from '../../../types';\nimport SDPAttributes from './attributes';\nimport SDPLine from './line';\n\nexport type SDPMediaDirection = 'sendonly' | 'recvonly' | 'inactive' | 'sendrecv';\nexport default class SDPMediaSection {\n  #lines: Array<SDPLine>;\n  #mediaLine: SDPLine;\n  #attributes: SDPAttributes;\n  #direction: SDPMediaDirection;\n\n  constructor(lines: Array<SDPLine>) {\n    this.#lines = lines;\n    this.#mediaLine = lines[0];\n    this.#attributes = this.#direction = null;\n  }\n\n  public get lines() {\n    return this.#lines;\n  }\n\n  public get mediaLine() {\n    return this.#mediaLine;\n  }\n\n  public get mediaLineParts() {\n    return this.#mediaLine.mediaLineParts;\n  }\n\n  public get mediaType() {\n    return this.mediaLineParts.type;\n  }\n\n  public get direction() {\n    if(!this.#direction) {\n      const attributes = this.attributes;\n\n      let direction: SDPMediaDirection;\n      if(attributes.get('sendonly').exists) direction = 'sendonly';\n      else if(attributes.get('recvonly').exists) direction = 'recvonly';\n      else if(attributes.get('inactive').exists) direction = 'inactive';\n      else direction = 'sendrecv';\n\n      this.#direction = direction;\n    }\n\n    return this.#direction;\n  }\n\n  public get isSending() {\n    return this.direction === 'sendrecv' || this.direction === 'sendonly';\n  }\n\n  public get isReceiving() {\n    return this.direction === 'sendrecv' || this.direction === 'recvonly';\n  }\n\n  public get attributes() {\n    this.#attributes || (this.#attributes = new SDPAttributes(this.lines));\n    return this.#attributes;\n  }\n\n  public get mid() {\n    return this.attributes.get('mid').value;\n  }\n\n  public lookupAttributeKeys<T extends AttributeMap>(keys: NoExtraProperties<AttributeMap, T>): {[k in keyof T]: T[k] extends true ? string : string[]} {\n    const out: any = {};\n\n    for(const key in keys) {\n      const result = this.attributes.get(key);\n      // @ts-ignore\n      const resultShouldBeArray = !keys[key];\n      if(!result) {\n        out[key] = resultShouldBeArray ? [] : undefined;\n      } else {\n        out[key] = resultShouldBeArray ? result.lines : result.value;\n      }\n    }\n\n    return out;\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport SDPLine from './line';\n\nexport default class SDPSessionSection {\n  #lines: SDPLine[];\n  #sessionId: string;\n\n  constructor(lines: SDPLine[]) {\n    this.#lines = lines;\n    this.#sessionId = lines.filter((line) => line.key === 'o').map((line) => line.value.split(' ')[1])[0];\n  }\n\n  public get lines() {\n    return this.#lines;\n  }\n\n  public get sessionId() {\n    return this.#sessionId;\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport SDP from '.';\nimport splitStringByLimitWithRest from '../../../helpers/string/splitStringByLimitWithRest';\nimport UniqueNumberGenerator from '../../../helpers/uniqueNumberGenerator';\nimport SDPLine from './line';\nimport SDPMediaSection from './mediaSection';\nimport SDPSessionSection from './sessionSection';\n\nexport function parseSdp(str: string) {\n  function createSection() {\n    if(sessionSection) {\n      mediaSections.push(new SDPMediaSection(lines));\n    } else {\n      sessionSection = new SDPSessionSection(lines);\n    }\n  }\n\n  let sessionSection: SDPSessionSection = null, lines: SDPLine[] = [];\n  const mediaSections: SDPMediaSection[] = [];\n  str.split(/\\r?\\n/).forEach((lineStr) => {\n    if(!isIncorrectSdpLine(lineStr)) {\n      const line = parseSdpLine(lineStr);\n      if(line.key === 'm') {\n        createSection();\n        lines = [];\n      }\n\n      lines.push(line);\n    }\n  });\n\n  createSection();\n  return new SDP(sessionSection, mediaSections);\n}\n\nexport function isIncorrectSdpLine(str: string) {\n  return /^[\\s\\xa0]*$/.test(str);\n}\n\nexport function parseSdpLine(str: string) {\n  const splitted = splitStringByLimitWithRest(str, '=', 1);\n  return new SDPLine(splitted[0] as any, splitted[1]);\n}\n\nexport function addSimulcast(sdp: SDP) {\n  let generator: UniqueNumberGenerator;\n  sdp.media.forEach((section, idx) => {\n    if(section.mediaType === 'video' && section.isSending && !section.attributes.get('ssrc-group').get('SIM').exists) {\n      if(!generator) {\n        generator = new UniqueNumberGenerator(2, 4294967295);\n      }\n\n      const originalSsrcs = section.attributes.get('ssrc-group').get('FID').value.split(' ');\n      const lines = section.lines;\n      originalSsrcs.forEach((ssrc) => generator.add(+ssrc)); // fix possible duplicates\n      const ssrcs = [originalSsrcs[0], generator.generate(), generator.generate()];\n      const ssrcs2 = [originalSsrcs[1], generator.generate(), generator.generate()];\n\n      lines.push(parseSdpLine('a=ssrc-group:SIM ' + ssrcs.join(' ')));\n\n      const ssrcsStrLines = section.attributes.get('ssrc').get(originalSsrcs[0]).lines;\n\n      ssrcs.forEach((ssrc, idx) => {\n        const ssrc2 = ssrcs2[idx];\n        if(idx > 0) {\n          lines.push(parseSdpLine('a=ssrc-group:FID ' + ssrc + ' ' + ssrc2));\n\n          ssrcsStrLines.forEach((v) => {\n            lines.push(parseSdpLine('a=ssrc:' + ssrc + ' ' + v));\n          });\n\n          ssrcsStrLines.forEach((v) => {\n            lines.push(parseSdpLine('a=ssrc:' + ssrc2 + ' ' + v));\n          });\n        }\n      });\n\n      sdp.media[idx] = new SDPMediaSection(lines);\n    }\n  });\n\n  return !!generator;\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n *\n * Originally from:\n * https://github.com/evgeny-nadymov/telegram-react\n * Copyright (C) 2018 Evgeny Nadymov\n * https://github.com/evgeny-nadymov/telegram-react/blob/master/LICENSE\n */\n\nimport {IS_FIREFOX} from '../../environment/userAgent';\nimport LocalConferenceDescription, {ConferenceEntry} from './localConferenceDescription';\nimport StringFromLineBuilder from './stringFromLineBuilder';\nimport {GroupCallConnectionTransport, PayloadType, UpdateGroupCallConnectionData} from './types';\nimport {fromTelegramSource} from './utils';\n\n// screencast is for Peer-to-Peer only\nexport type WebRTCLineTypeTrue = 'video' | 'audio' | 'application';\nexport type WebRTCLineType = WebRTCLineTypeTrue | 'screencast';\n\nexport const WEBRTC_MEDIA_PORT = '9';\n\nexport function fixMediaLineType(mediaType: WebRTCLineType) {\n  return mediaType === 'screencast' ? 'video' : mediaType;\n}\n\nexport function performCandidate(c: GroupCallConnectionTransport['candidates'][0]) {\n  const arr: string[] = [];\n  arr.push('a=candidate:');\n  arr.push(`${c.foundation} ${c.component} ${c.protocol.toUpperCase()} ${c.priority} ${c.ip} ${c.port} typ ${c.type}`);\n  if(c['rel-addr'] !== undefined) {\n    arr.push(` raddr ${c['rel-addr']} rport ${c['rel-port']}`);\n  }\n  arr.push(` generation ${c.generation}`);\n  return arr.join('');\n}\n\nexport function getConnectionTypeForMediaType(mediaType: WebRTCLineType) {\n  // return mediaType === 'application' ? 'DTLS/SCTP' : 'RTP/SAVPF';\n  return mediaType === 'application' ? 'DTLS/SCTP' : 'UDP/TLS/RTP/SAVPF';\n}\n\nexport function generateMediaFirstLine(mediaType: WebRTCLineType, port = WEBRTC_MEDIA_PORT, payloadIds: (string | number)[]) {\n  const connectionType = getConnectionTypeForMediaType(mediaType);\n  return `m=${fixMediaLineType(mediaType)} ${port} ${connectionType} ${payloadIds.join(' ')}`;\n}\n\ntype ConferenceData = UpdateGroupCallConnectionData | LocalConferenceDescription;\n\n// https://tools.ietf.org/id/draft-ietf-rtcweb-sdp-08.html\n// https://datatracker.ietf.org/doc/html/draft-roach-mmusic-unified-plan-00\nexport class SDPBuilder extends StringFromLineBuilder {\n  public addCandidate(c: GroupCallConnectionTransport['candidates'][0]) {\n    return this.add(performCandidate(c));\n  }\n\n  /* public addDataChannel(mid: string, transport: GroupCallConnectionTransport, isAnswer?: boolean) {\n    this.add(\n      'm=application 9 UDP/DTLS/SCTP webrtc-datachannel',\n      'c=IN IP4 0.0.0.0',\n      'a=ice-options:trickle',\n      `a=mid:${mid}`\n    );\n\n    // if(!isAnswer) {\n      this.add('a=sendrecv');\n    // }\n\n    this.addTransport(transport, isAnswer);\n\n    return this.add(\n      'a=sctp-port:5000',\n      'a=max-message-size:262144'\n    );\n  } */\n\n  public addHeader(sId: string, bundleMids: string[]) {\n    const bundle = bundleMids.join(' ');\n    return this.add(\n      'v=0',                          // version\n      `o=- ${sId} 2 IN IP4 0.0.0.0`,  // sessionId, 2=sessionVersion\n      's=-',                          // name of the session\n      't=0 0',                        // time when session is valid\n      'a=extmap-allow-mixed',\n      `a=group:BUNDLE ${bundle}`,\n      'a=ice-options:trickle',\n      // 'a=ice-lite',                   // ice-lite: is a minimal version of the ICE specification, intended for servers running on a public IP address.\n      'a=msid-semantic:WMS *'\n    );\n  }\n\n  public addTransport(transport: GroupCallConnectionTransport, skipCandidates?: boolean) {\n    this.add(\n      `a=ice-ufrag:${transport.ufrag}`,\n      `a=ice-pwd:${transport.pwd}`,\n      'a=ice-options:trickle'           // ! test\n    );\n\n    for(const fingerprint of transport.fingerprints) {\n      this.add(\n        `a=fingerprint:${fingerprint.hash} ${fingerprint.fingerprint}`,\n        `a=setup:${fingerprint.setup}`\n      );\n    }\n\n    if(!skipCandidates && transport.candidates) {\n      for(const candidate of transport.candidates) {\n        this.addCandidate(candidate);\n      }\n    }\n\n    return this;\n  }\n\n  public addSsrc(entry: ConferenceEntry) {\n    let streamName = 'stream';\n    let {type, sourceGroups} = entry;\n\n    // let source = ssrc.source ?? ssrc.sourceGroups[0].sources[0];\n    // source = fromTelegramSource(source);\n    const source = fromTelegramSource(entry.source);\n\n    streamName += source;\n    type += source as any;\n\n    // streamName += mid;\n    // type += mid as any;\n\n    // streamName = type = entry.transceiver.receiver.track.id as any;\n\n    const addMsid = () => {\n      this.add(`a=msid:${streamName} ${type}`);\n    };\n\n    const addSource = (ssrc: number) => {\n      this.add(\n        `a=ssrc:${ssrc} cname:${streamName}`,\n        `a=ssrc:${ssrc} msid:${streamName} ${type}`,\n        `a=ssrc:${ssrc} mslabel:${streamName}`,\n        `a=ssrc:${ssrc} label:${type}`\n      );\n    };\n\n    addMsid();\n    if(sourceGroups?.length) {\n      sourceGroups.forEach((ssrcGroup) => {\n        if(ssrcGroup.sources.length) {\n          const sources = ssrcGroup.sources.map(fromTelegramSource);\n          this.add(`a=ssrc-group:${ssrcGroup.semantics} ${sources.join(' ')}`);\n          sources.forEach(addSource);\n        }\n      });\n    } else {\n      addSource(source);\n    }\n\n    return this;\n  }\n\n  public addSsrcEntry(entry: ConferenceEntry, data: ConferenceData, isAnswer?: boolean) {\n    const add = (...x: string[]) => this.add(...x);\n\n    const {type, mid, direction, port} = entry;\n    const transport = data.transport;\n\n    /* if(type === 'application') {\n      return this.addDataChannel(mid, transport, isAnswer);\n    } */\n\n    const isApplication = type === 'application';\n    const codec = isApplication ? undefined : data[type];\n\n    const isInactive = direction === 'inactive';\n    if(entry.shouldBeSkipped(isAnswer)) {\n      return add(\n        `m=${fixMediaLineType(type)} 0 ${getConnectionTypeForMediaType(type)} 0`,\n        `c=IN IP4 0.0.0.0`,\n        `a=inactive`,\n        `a=mid:${mid}`\n      );\n    }\n\n    const payloadTypes = !isApplication ? codec['payload-types'] : [{id: 5000} as PayloadType];\n    const ids = payloadTypes.map((type) => type.id);\n    add(\n      generateMediaFirstLine(type, port, ids),\n      'c=IN IP4 0.0.0.0',\n      `a=rtcp:${port} IN IP4 0.0.0.0`\n    );\n\n    if(transport['rtcp-mux']) {\n      add('a=rtcp-mux');\n    }\n\n    add(`a=mid:${mid}`);\n    /* if(type === 'video') {\n      add('b=AS:2500');\n    } */\n\n    let setDirection = direction;\n    if(direction !== 'sendrecv' && isAnswer && !(isInactive || isApplication)) {\n      setDirection = direction === 'sendonly' ? 'recvonly' : 'sendonly';\n    }\n\n    // a=bundle-only\n    add(`a=${setDirection}`);\n\n    // this.addTransport(transport, isAnswer);\n    this.addTransport(transport);\n\n    if(!isApplication) {\n      const hdrexts = codec['rtp-hdrexts'];\n      if(hdrexts?.length) {\n        hdrexts.forEach((hdrext) => {\n          add(`a=extmap:${hdrext.id} ${hdrext.uri}`);\n        });\n      }\n\n      payloadTypes.forEach((type) => {\n        add(`a=rtpmap:${type.id} ${type.name}/${type.clockrate}${type.channels && type.channels > 1 ? `/${type.channels}` : ''}`);\n\n        const parameters = type.parameters;\n        if(Array.isArray(parameters)) {\n          if(parameters.length) {\n            console.error('parameters is array???', parameters);\n          }\n        } else if(parameters && Object.keys(parameters).length) {\n          const p: string[] = [];\n          for(const i in parameters) {\n            p.push(`${i}=${parameters[i]}`);\n          }\n          add(`a=fmtp:${type.id} ${p.join(';')}`);\n        }\n\n        const fbs = type['rtcp-fbs'];\n        if(fbs?.length) {\n          fbs.forEach((fb) => {\n            add(`a=rtcp-fb:${type.id} ${fb.type}${fb.subtype ? ' ' + fb.subtype : ''}`);\n          });\n        }\n      });\n    } else {\n      add(`a=sctpmap:${payloadTypes[0].id} webrtc-datachannel 256`);\n    }\n\n    if(entry.source && (setDirection === 'sendonly' || setDirection === 'sendrecv')) {\n      this.addSsrc(entry);\n    }\n\n    return this;\n  }\n\n  public addConference(options: {\n    conference: LocalConferenceDescription,\n    bundle: string[],\n    entries: ConferenceEntry[],\n    isAnswer?: boolean,\n  }) {\n    const {conference, entries, bundle, isAnswer} = options;\n    this.addHeader(conference.sessionId, bundle);\n\n    if(IS_FIREFOX) {\n      this.addTransport(conference.transport); // support Firefox\n    }\n\n    for(const entry of entries) {\n      // this.addSsrcEntry(entry, conference, isAnswer);\n      this.addSsrcEntry((isAnswer ? entry.recvEntry || entry.sendEntry : entry.sendEntry || entry.recvEntry) || entry, conference, isAnswer);\n    }\n\n    return this;\n  }\n\n  public static fromConference(options: Parameters<SDPBuilder['addConference']>[0]) {\n    return new SDPBuilder().addConference(options).finalize();\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n *\n * Originally from:\n * https://github.com/evgeny-nadymov/telegram-react\n * Copyright (C) 2018 Evgeny Nadymov\n * https://github.com/evgeny-nadymov/telegram-react/blob/master/LICENSE\n */\n\nimport EventListenerBase from '../../helpers/eventListenerBase';\nimport {logger} from '../logger';\nimport rootScope from '../rootScope';\nimport {GROUP_CALL_AMPLITUDE_ANALYSE_COUNT_MAX} from './constants';\nimport stopTrack from './helpers/stopTrack';\nimport LocalConferenceDescription from './localConferenceDescription';\nimport {fixMediaLineType, WebRTCLineType} from './sdpBuilder';\nimport {getAmplitude, toTelegramSource} from './utils';\n\nexport type StreamItemBase = {\n  type: 'input' | 'output',\n  track: MediaStreamTrack,\n  source: string,\n  stream: MediaStream\n};\n\nexport type StreamItem = StreamAudioItem | StreamVideoItem;\n\nexport type StreamAudioItem = StreamItemBase & {kind: 'audio', streamAnalyser: AudioStreamAnalyser};\nexport type StreamVideoItem = StreamItemBase & {kind: 'video'};\n\nexport type StreamAmplitude = {\n  type: 'input' | 'output';\n  source: string;\n  stream: MediaStream;\n  track: MediaStreamTrack;\n  value: number;\n};\n\nclass AudioStreamAnalyser {\n  public analyser: AnalyserNode;\n  public gain: GainNode;\n  public streamSource: MediaStreamAudioSourceNode;\n\n  constructor(context: AudioContext, stream: MediaStream) {\n    const streamSource = this.streamSource = context.createMediaStreamSource(stream);\n    const analyser = this.analyser = context.createAnalyser();\n    const gain = this.gain = context.createGain();\n    // const streamDestination = context.createMediaStreamDestination();\n\n    analyser.minDecibels = -100;\n    analyser.maxDecibels = -30;\n    analyser.smoothingTimeConstant = 0.05;\n    analyser.fftSize = 1024;\n\n    // connect Web Audio API\n    streamSource.connect(analyser);\n    // analyser.connect(context.destination);\n  }\n}\n\nexport default class StreamManager {\n  public static ANALYSER_LISTENER = new EventListenerBase<{amplitude: (details: {amplitudes: StreamAmplitude[], type: 'all' | 'input'}) => void}>();\n  private context: AudioContext;\n  public outputStream: MediaStream;\n  public inputStream: MediaStream;\n\n  private timer: number;\n  private counter: number;\n\n  private items: StreamItem[];\n\n  private log: ReturnType<typeof logger>;\n\n  public direction: RTCRtpTransceiver['direction'];\n  public canCreateConferenceEntry: boolean;\n  public locked: boolean;\n  public types: WebRTCLineType[];\n\n  constructor(private interval?: number) {\n    this.context = new (window.AudioContext || (window as any).webkitAudioContext)();\n    this.items = [];\n    this.outputStream = new MediaStream();\n    this.inputStream = new MediaStream();\n    this.counter = 0;\n    this.log = logger('SM');\n    this.direction = 'sendonly';\n    this.canCreateConferenceEntry = true;\n    // this.lol = true;\n    this.types = ['audio', 'video'];\n  }\n\n  public addStream(stream: MediaStream, type: StreamItem['type']) {\n    stream.getTracks().forEach((track) => {\n      this.addTrack(stream, track, type);\n    });\n  }\n\n  public addTrack(stream: MediaStream, track: MediaStreamTrack, type: StreamItem['type']) {\n    this.log('addTrack', type, track, stream);\n\n    const {context, items, inputStream, outputStream} = this;\n    const kind: StreamItem['kind'] = track.kind as any;\n    const source = StreamManager.getSource(stream, type);\n\n    // this.removeTrack(track);\n    switch(type) {\n      case 'input': {\n        if(!inputStream) {\n          this.inputStream = stream;\n        } else {\n          inputStream.addTrack(track);\n        }\n\n        break;\n      }\n\n      case 'output': {\n        for(let i = 0; i < items.length; ++i) {\n          const {track: t, type, source: itemSource} = items[i];\n          if(itemSource === source && type === 'input') {\n            items.splice(i, 1);\n            outputStream.removeTrack(t);\n            break;\n          }\n        }\n\n        if(kind !== 'video') {\n          outputStream.addTrack(track);\n        }\n\n        break;\n      }\n    }\n\n    this.finalizeAddingTrack({\n      type,\n      source,\n      stream,\n      track,\n      kind,\n      streamAnalyser: kind === 'audio' ? new AudioStreamAnalyser(context, stream) : undefined\n    });\n\n    if(kind === 'audio' && this.interval) {\n      this.changeTimer();\n    }\n  }\n\n  private finalizeAddingTrack(item: StreamItem) {\n    const {track} = item;\n    track.addEventListener('ended', () => {\n      this.removeTrack(track);\n    }, {once: true});\n\n    this.items.push(item);\n  }\n\n  public hasInputTrackKind(kind: StreamItem['kind']) {\n    return this.items.find((item) => item.type === 'input' && item.kind === kind);\n  }\n\n  public static getSource(stream: MediaStream, type: StreamItem['type']) {\n    return type === 'input' ? (stream.source || stream.id) : '' + toTelegramSource(+stream.id.substring(6));\n  }\n\n  public removeTrack(track: MediaStreamTrack) {\n    this.log('removeTrack', track);\n\n    const {items} = this;\n\n    let handled = false;\n    for(let i = 0, length = items.length; !handled && i < length; ++i) {\n      const {track: t, type} = items[i];\n      switch(type) {\n        case 'output': {\n          if(t === track) {\n            items.splice(i, 1);\n            this.outputStream.removeTrack(track);\n            handled = true;\n          }\n\n          break;\n        }\n\n        case 'input': {\n          if(t === track) {\n            items.splice(i, 1);\n            this.inputStream.removeTrack(track);\n            handled = true;\n          }\n\n          break;\n        }\n      }\n    }\n\n    if(track.kind === 'audio' && this.interval) {\n      this.changeTimer();\n    }\n  }\n\n  public replaceInputAudio(stream: MediaStream, oldTrack: MediaStreamTrack) {\n    this.removeTrack(oldTrack);\n    this.addStream(stream, 'input');\n  }\n\n  private changeTimer() {\n    if(this.timer !== undefined) {\n      clearInterval(this.timer);\n    }\n\n    if(this.items.length) {\n      this.timer = window.setInterval(this.analyse, this.interval);\n    }\n  }\n\n  public getAmplitude = (item: StreamAudioItem): StreamAmplitude => {\n    const {streamAnalyser, stream, track, source, type} = item;\n    const analyser = streamAnalyser.analyser;\n    if(!analyser) return;\n\n    const array = new Uint8Array(analyser.frequencyBinCount);\n    analyser.getByteFrequencyData(array);\n    const value = getAmplitude(array);\n\n    return {\n      type,\n      source,\n      stream,\n      track,\n      value\n    };\n  };\n\n  public analyse = () => {\n    const all = this.counter % 3 === 0;\n    const filteredItems = all ? this.items : this.items.filter((x) => x.type === 'input');\n    const audioItems = filteredItems.filter((x) => x.kind === 'audio') as StreamAudioItem[];\n    const amplitudes = audioItems.slice(0, GROUP_CALL_AMPLITUDE_ANALYSE_COUNT_MAX).map(this.getAmplitude);\n    if(++this.counter >= 1000) {\n      this.counter = 0;\n    }\n\n    StreamManager.ANALYSER_LISTENER.dispatchEvent('amplitude', {\n      amplitudes,\n      type: all ? 'all' : 'input'\n    });\n  };\n\n  /* public appendToConnection(connection: RTCPeerConnection) {\n    if(this.inputStream) {\n      this.inputStream.getTracks().forEach((track) => {\n        connection.log('addTrack', track);\n        connection.addTrack(track, this.inputStream);\n\n        if(track.kind === 'video') {\n          track.enabled = true;\n        }\n      });\n    }\n  } */\n\n  public appendToConference(conference: LocalConferenceDescription) {\n    if(this.locked) {\n      return;\n    }\n\n    const {inputStream, direction, canCreateConferenceEntry} = this;\n    const transceiverInit: RTCRtpTransceiverInit = {direction, streams: [inputStream]};\n    const types = this.types.map((type) => {\n      return [\n        type,\n        /* type === 'video' || type === 'screencast' ?\n          {sendEncodings: [{maxBitrate: 2500000}], ...transceiverInit} :  */\n        transceiverInit\n      ] as const;\n    });\n\n    const tracks = inputStream.getTracks();\n    // const transceivers = conference.connection.getTransceivers();\n    for(const [type, transceiverInit] of types) {\n      let entry = conference.findEntry((entry) => entry.direction === direction && entry.type === type);\n      if(!entry) {\n        if(!canCreateConferenceEntry) {\n          continue;\n        }\n\n        entry = conference.createEntry(type);\n      }\n      /* const entry = conference.findFreeSendRecvEntry(type, true);\n      if(!entry.transceiver) {\n        entry.transceiver = transceivers.find((transceiver) => transceiver.mid === entry.mid);\n      } */\n\n      let {transceiver} = entry;\n      if(!transceiver) {\n        transceiver = entry.createTransceiver(conference.connection, transceiverInit);\n\n        /* if(this.isScreenSharingManager) {\n          transceiver.sender.setParameters({\n            ...transceiver.sender.getParameters(),\n            degradationPreference: 'maintain-resolution'\n          });\n        } */\n      }\n\n      if(entry.direction !== transceiver.direction) {\n        transceiver.direction = entry.direction;\n      }\n\n      const mediaTrackType = fixMediaLineType(type);\n      const trackIdx = tracks.findIndex((track) => track.kind === mediaTrackType);\n      const track = trackIdx !== -1 ? tracks.splice(trackIdx, 1)[0] : undefined;\n      const sender = transceiver.sender;\n      if(sender.track === track) {\n        continue;\n      }\n\n      // try { // ! don't use await here. it will wait for adding track and fake one won't be visible in startNegotiation.\n      /* await  */sender.replaceTrack(track).catch((err) => {\n        this.log.error(err);\n      });\n      // } catch(err) {\n\n      // }\n    }\n  }\n\n  public stop() {\n    try {\n      const tracks = this.inputStream.getTracks().concat(this.outputStream.getTracks());\n      tracks.forEach((track) => {\n        stopTrack(track);\n      });\n    } catch(e) {\n      this.log.error(e);\n    }\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n *\n * Originally from:\n * https://github.com/evgeny-nadymov/telegram-react\n * Copyright (C) 2018 Evgeny Nadymov\n * https://github.com/evgeny-nadymov/telegram-react/blob/master/LICENSE\n */\n\nexport default class StringFromLineBuilder {\n  private lines: string[];\n  private newLine: string[];\n\n  constructor(private joiner = '\\r\\n') {\n    this.lines = [];\n    this.newLine = [];\n  }\n\n  public add(...strs: string[]) {\n    this.lines.push(...strs);\n    return this;\n  }\n\n  public push(word: string) {\n    this.newLine.push(word);\n    return this;\n  }\n\n  public addJoined(separator = '') {\n    this.add(this.newLine.join(separator));\n    this.newLine = [];\n    return this;\n  }\n\n  public join() {\n    return this.lines.join(this.joiner);\n  }\n\n  public finalize() {\n    return this.join() + this.joiner;\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n *\n * Originally from:\n * https://github.com/evgeny-nadymov/telegram-react\n * Copyright (C) 2018 Evgeny Nadymov\n * https://github.com/evgeny-nadymov/telegram-react/blob/master/LICENSE\n */\n\n// NOTE: telegram returns sign source, while webrtc uses unsign source internally\n// unsign => sign\nexport function toTelegramSource(source: number) {\n  return source << 0;\n}\n\n// NOTE: telegram returns sign source, while webrtc uses unsign source internally\n// sign => unsign\nexport function fromTelegramSource(source: number) {\n  return source >>> 0;\n}\n\nexport function getAmplitude(array: Uint8Array, scale = 3) {\n  if(!array) return 0;\n\n  const {length} = array;\n  let total = 0;\n  for(let i = 0; i < length; ++i) {\n    total += array[i] * array[i];\n  }\n  const rms = Math.sqrt(total / length) / 255;\n\n  return Math.min(1, rms * scale);\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport wrapEmojiText from './wrapEmojiText';\n\nexport default function getAbbreviation(str: string, onlyFirst = false) {\n  if(!str) return '';\n  const splitted = str.trim().split(' ');\n  if(!splitted[0]) return '';\n\n  const first = [...splitted[0]][0];\n\n  if(onlyFirst || splitted.length === 1) return wrapEmojiText(first);\n\n  const last = [...splitted[splitted.length - 1]][0];\n\n  return wrapEmojiText(first + last);\n}\n","import {MessageEntity} from '../../layer';\nimport {toCodePoints} from '../../vendor/emoji';\n\nexport default function getEmojiEntityFromEmoji(emoji: string): MessageEntity.messageEntityEmoji {\n  return {\n    _: 'messageEntityEmoji',\n    offset: 0,\n    length: emoji.length,\n    unicode: toCodePoints(emoji).join('-').replace(/-?fe0f/g, '')\n  };\n}\n","import {EMAIL_REG_EXP} from '.';\n\nexport default function matchEmail(text: string) {\n  return !text ? null : text.match(EMAIL_REG_EXP);\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport {MessageEntity} from '../../layer';\nimport wrapRichText from './wrapRichText';\n\nexport default function wrapDraftText(text: string, options: Partial<{\n  entities: MessageEntity[]\n}> = {}) {\n  if(!text) {\n    return wrapRichText('');\n  }\n\n  return wrapRichText(text, {\n    entities: options.entities,\n    noLinks: true,\n    wrappingDraft: true,\n    passEntities: {\n      messageEntityTextUrl: true,\n      messageEntityMentionName: true\n    }\n  });\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport parseEntities from './parseEntities';\nimport wrapRichText from './wrapRichText';\n\nexport default function wrapEmojiText(text: string, isDraft = false) {\n  if(!text) return wrapRichText('');\n\n  const entities = parseEntities(text).filter((e) => e._ === 'messageEntityEmoji');\n  return wrapRichText(text, {entities, wrappingDraft: isDraft});\n}\n","export default function setBlankToAnchor(anchor: HTMLAnchorElement) {\n  anchor.target = '_blank';\n  anchor.rel = 'noopener noreferrer';\n  return anchor;\n}\n","import IS_EMOJI_SUPPORTED from './emojiSupport';\n\nexport type EMOJI_VERSION = '' | '14';\n\nconst EMOJI_VERSIONS_SUPPORTED: {\n  [v in EMOJI_VERSION]: boolean\n} = {} as any;\n\n// Thanks to WebZ for the detect\nfunction isEmojiSupported(emoji: string) {\n  const ALLOWABLE_CALCULATION_ERROR_SIZE = 5;\n  const inlineEl = document.createElement('span');\n  inlineEl.classList.add('emoji');\n  document.body.appendChild(inlineEl);\n\n  inlineEl.innerText = emoji; // Emoji from 14.0 version\n  const newEmojiWidth = inlineEl.offsetWidth;\n  inlineEl.innerText = ''; // Emoji from 1.0 version\n  const legacyEmojiWidth = inlineEl.offsetWidth;\n\n  document.body.removeChild(inlineEl);\n\n  return Math.abs(newEmojiWidth - legacyEmojiWidth) < ALLOWABLE_CALCULATION_ERROR_SIZE;\n}\n\nif(IS_EMOJI_SUPPORTED) {\n  EMOJI_VERSIONS_SUPPORTED[''] = true;\n\n  const a: [keyof typeof EMOJI_VERSIONS_SUPPORTED, string][] = [\n    ['14', '']\n  ];\n\n  a.forEach(([version, emoji]) => {\n    EMOJI_VERSIONS_SUPPORTED[version] = isEmojiSupported(emoji);\n  });\n}\n\nexport default EMOJI_VERSIONS_SUPPORTED;\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport type {EMOJI_VERSION} from '../../environment/emojiVersionsSupport';\nimport {SITE_HASHTAGS} from '.';\nimport {EmojiVersions} from '../../config/emoji';\nimport IS_EMOJI_SUPPORTED from '../../environment/emojiSupport';\nimport {IS_SAFARI} from '../../environment/userAgent';\nimport buildURLHash from '../../helpers/buildURLHash';\nimport copy from '../../helpers/object/copy';\nimport encodeEntities from '../../helpers/string/encodeEntities';\nimport {MessageEntity} from '../../layer';\nimport encodeSpoiler from './encodeSpoiler';\nimport parseEntities from './parseEntities';\nimport setBlankToAnchor from './setBlankToAnchor';\nimport wrapUrl from './wrapUrl';\nimport EMOJI_VERSIONS_SUPPORTED from '../../environment/emojiVersionsSupport';\nimport {CLICK_EVENT_NAME} from '../../helpers/dom/clickEvent';\nimport IS_CUSTOM_EMOJI_SUPPORTED from '../../environment/customEmojiSupport';\nimport rootScope from '../rootScope';\nimport mediaSizes from '../../helpers/mediaSizes';\nimport {wrapSticker} from '../../components/wrappers';\nimport RLottiePlayer from '../rlottie/rlottiePlayer';\nimport animationIntersector, {AnimationItemGroup} from '../../components/animationIntersector';\nimport type {MyDocument} from '../appManagers/appDocsManager';\nimport LazyLoadQueue from '../../components/lazyLoadQueue';\nimport {Awaited} from '../../types';\nimport {MediaSize} from '../../helpers/mediaSize';\nimport IS_WEBM_SUPPORTED from '../../environment/webmSupport';\nimport assumeType from '../../helpers/assumeType';\nimport noop from '../../helpers/noop';\nimport indexOfAndSplice from '../../helpers/array/indexOfAndSplice';\nimport findUpClassName from '../../helpers/dom/findUpClassName';\nimport getViewportSlice from '../../helpers/dom/getViewportSlice';\nimport {getMiddleware, Middleware} from '../../helpers/middleware';\n\nconst resizeObserver = new ResizeObserver((entries) => {\n  for(const entry of entries) {\n    const renderer = entry.target.parentElement as CustomEmojiRendererElement;\n    renderer.setDimensionsFromRect(entry.contentRect);\n  }\n});\n\nclass CustomEmojiElement extends HTMLElement {\n  public elements: CustomEmojiElement[];\n  public renderer: CustomEmojiRendererElement;\n  public player: RLottiePlayer | HTMLVideoElement;\n  public paused: boolean;\n  public syncedPlayer: SyncedPlayer;\n\n  constructor() {\n    super();\n    this.paused = true;\n  }\n\n  public connectedCallback() {\n    if(this.player) {\n      animationIntersector.addAnimation(this, this.renderer.animationGroup);\n    }\n\n    this.connectedCallback = undefined;\n  }\n\n  public disconnectedCallback() {\n    if(this.syncedPlayer) {\n      this.syncedPlayer.pausedElements.delete(this);\n    }\n\n    // otherwise https://bugs.chromium.org/p/chromium/issues/detail?id=1144736#c27 will happen\n    this.textContent = '';\n\n    this.disconnectedCallback = this.elements = this.renderer = this.player = this.syncedPlayer = undefined;\n  }\n\n  public pause() {\n    if(this.paused) {\n      return;\n    }\n\n    this.paused = true;\n\n    if(this.player instanceof HTMLVideoElement) {\n      this.renderer.lastPausedVideo = this.player;\n      this.player.pause();\n    }\n\n    if(this.syncedPlayer && !this.syncedPlayer.pausedElements.has(this)) {\n      this.syncedPlayer.pausedElements.add(this);\n\n      if(this.syncedPlayer.pausedElements.size === this.syncedPlayer.elementsCounter) {\n        this.syncedPlayer.player.pause();\n      }\n    }\n  }\n\n  public play() {\n    if(!this.paused) {\n      return;\n    }\n\n    this.paused = false;\n\n    if(this.player instanceof HTMLVideoElement) {\n      this.player.currentTime = this.renderer.lastPausedVideo?.currentTime || this.player.currentTime;\n      this.player.play().catch(noop);\n    }\n\n    if(this.syncedPlayer && this.syncedPlayer.pausedElements.has(this)) {\n      this.syncedPlayer.pausedElements.delete(this);\n\n      if(this.syncedPlayer.pausedElements.size !== this.syncedPlayer.elementsCounter) {\n        this.player.play();\n      }\n    }\n  }\n\n  public remove() {\n    this.elements = this.renderer = this.player = undefined;\n  }\n\n  public get autoplay() {\n    return true;\n  }\n}\n\nexport class CustomEmojiRendererElement extends HTMLElement {\n  public canvas: HTMLCanvasElement;\n  public context: CanvasRenderingContext2D;\n\n  public playersSynced: Map<CustomEmojiElement[], RLottiePlayer | HTMLVideoElement>;\n  public syncedElements: Map<SyncedPlayer, CustomEmojiElement[]>;\n  public clearedElements: Set<CustomEmojiElement[]>;\n  public lastPausedVideo: HTMLVideoElement;\n\n  public lastRect: DOMRect;\n  public isDimensionsSet: boolean;\n\n  public animationGroup: AnimationItemGroup;\n  public size: MediaSize;\n\n  public lazyLoadQueue: LazyLoadQueue;\n\n  constructor() {\n    super();\n\n    this.classList.add('custom-emoji-renderer');\n    this.canvas = document.createElement('canvas');\n    this.canvas.classList.add('custom-emoji-canvas');\n    this.context = this.canvas.getContext('2d');\n    this.append(this.canvas);\n\n    this.playersSynced = new Map();\n    this.syncedElements = new Map();\n    this.clearedElements = new Set();\n\n    this.animationGroup = 'EMOJI';\n  }\n\n  public connectedCallback() {\n    // this.setDimensions();\n    // animationIntersector.addAnimation(this, this.animationGroup);\n    resizeObserver.observe(this.canvas);\n    emojiRenderers.push(this);\n\n    this.connectedCallback = undefined;\n  }\n\n  public disconnectedCallback() {\n    for(const [syncedPlayer, elements] of this.syncedElements) {\n      if(syncedPlayers.get(syncedPlayer.key) !== syncedPlayer) {\n        continue;\n      }\n\n      if(elements) {\n        syncedPlayer.elementsCounter -= elements.length;\n      }\n\n      if(!--syncedPlayer.counter) {\n        if(syncedPlayer.player) {\n          const frame = syncedPlayersFrames.get(syncedPlayer.player);\n          if(frame) {\n            (frame as ImageBitmap).close?.();\n            syncedPlayersFrames.delete(syncedPlayer.player);\n          }\n\n          syncedPlayersFrames.delete(syncedPlayer.player);\n          syncedPlayer.player.overrideRender = noop;\n          syncedPlayer.player.remove();\n          syncedPlayer.player = undefined;\n        }\n\n        syncedPlayers.delete(syncedPlayer.key);\n\n        if(!syncedPlayers.size) {\n          clearRenderInterval();\n        }\n      }\n    }\n\n    resizeObserver.unobserve(this.canvas);\n\n    indexOfAndSplice(emojiRenderers, this);\n    this.playersSynced.clear();\n    this.syncedElements.clear();\n    this.clearedElements.clear();\n    this.lazyLoadQueue?.clear();\n    this.middlewareHelper?.clean();\n\n    this.disconnectedCallback = this.lastPausedVideo = this.lazyLoadQueue = undefined;\n  }\n\n  public getOffsets(offsetsMap: Map<CustomEmojiElement[], {top: number, left: number}[]> = new Map()) {\n    if(!this.playersSynced.size) {\n      return offsetsMap;\n    }\n\n    const overflowElement = findUpClassName(this, 'scrollable') || this.offsetParent as HTMLElement;\n    const overflowRect = overflowElement.getBoundingClientRect();\n    const rect = this.getBoundingClientRect();\n\n    for(const elements of this.playersSynced.keys()) {\n      const {visible} = getViewportSlice({\n        overflowElement,\n        overflowRect,\n        elements,\n        extraSize: this.size.height * 2.5 // let's add some margin\n      });\n\n      const offsets = visible.map(({rect: elementRect}) => {\n        const top = elementRect.top - rect.top;\n        const left = elementRect.left - rect.left;\n        return {top, left};\n      });\n\n      if(offsets.length) {\n        offsetsMap.set(elements, offsets);\n      }\n    }\n\n    // const rect = this.getBoundingClientRect();\n    // const visibleRect = getVisibleRect(this, overflowElement, undefined, rect);\n    // const minTop = visibleRect ? visibleRect.rect.top - this.size.height : 0;\n    // const maxTop = Infinity;\n    // for(const elements of this.playersSynced.keys()) {\n    //   const offsets = elements.map((element) => {\n    //     const elementRect = element.getBoundingClientRect();\n    //     const top = elementRect.top - rect.top;\n    //     const left = elementRect.left - rect.left;\n    //     return top >= minTop && (top + elementRect.height) <= maxTop ? {top, left} : undefined;\n    //   }).filter(Boolean);\n\n    //   if(offsets.length) {\n    //     offsetsMap.set(elements, offsets);\n    //   }\n    // }\n\n    return offsetsMap;\n  }\n\n  public clearCanvas() {\n    const {context, canvas} = this;\n    context.clearRect(0, 0, canvas.width, canvas.height);\n  }\n\n  public render(offsetsMap: ReturnType<CustomEmojiRendererElement['getOffsets']>) {\n    const {context, canvas, isDimensionsSet} = this;\n    if(!isDimensionsSet) {\n      this.setDimensionsFromRect();\n    }\n\n    const {width, height, dpr} = canvas;\n    for(const [elements, offsets] of offsetsMap) {\n      const player = this.playersSynced.get(elements);\n      const frame = syncedPlayersFrames.get(player);\n      if(!frame) {\n        continue;\n      }\n\n      const isImageData = frame instanceof ImageData;\n      const {width: frameWidth, height: frameHeight} = frame;\n      const maxTop = height - frameHeight;\n      const maxLeft = width - frameWidth;\n\n      if(!this.clearedElements.has(elements)) {\n        elements.forEach((element) => {\n          element.textContent = '';\n        });\n\n        this.clearedElements.add(elements);\n      }\n\n      offsets.forEach(({top, left}) => {\n        top = Math.round(top * dpr), left = Math.round(left * dpr);\n        if(/* top > maxTop ||  */left > maxLeft) {\n          return;\n        }\n\n        if(isImageData) {\n          context.putImageData(frame as ImageData, left, top);\n        } else {\n          // context.clearRect(left, top, width, height);\n          context.drawImage(frame as ImageBitmap, left, top, frameWidth, frameHeight);\n        }\n      });\n    }\n  }\n\n  public checkForAnyFrame() {\n    for(const player of this.playersSynced.values()) {\n      if(syncedPlayersFrames.has(player)) {\n        return true;\n      }\n    }\n\n    return false;\n  }\n\n  public remove() {\n    // this.canvas.remove();\n  }\n\n  // public setDimensions() {\n  //   const {canvas} = this;\n  //   sequentialDom.mutateElement(canvas, () => {\n  //     const rect = canvas.getBoundingClientRect();\n  //     this.setDimensionsFromRect(rect);\n  //   });\n  // }\n\n  public setDimensionsFromRect(rect: DOMRect = this.lastRect) {\n    const {canvas} = this;\n    const {dpr} = canvas;\n\n    if(this.lastRect !== rect) {\n      this.lastRect = rect;\n    }\n\n    if(!rect || !dpr) {\n      return;\n    }\n\n    this.isDimensionsSet = true;\n    canvas.width = Math.round(rect.width * dpr);\n    canvas.height = Math.round(rect.height * dpr);\n  }\n}\n\ntype CustomEmojiRenderer = CustomEmojiRendererElement;\ntype SyncedPlayer = {\n  player: RLottiePlayer,\n  middlewares: Set<() => boolean>,\n  pausedElements: Set<CustomEmojiElement>,\n  elementsCounter: number,\n  counter: number,\n  key: string\n};\ntype CustomEmojiFrame = Parameters<RLottiePlayer['overrideRender']>[0] | HTMLVideoElement;\n\nconst CUSTOM_EMOJI_INSTANT_PLAY = true; // do not wait for animationIntersector\nlet emojiRenderInterval: number;\nconst emojiRenderers: Array<CustomEmojiRenderer> = [];\nconst syncedPlayers: Map<string, SyncedPlayer> = new Map();\nconst syncedPlayersFrames: Map<RLottiePlayer | HTMLVideoElement, CustomEmojiFrame> = new Map();\nconst renderEmojis = () => {\n  const t = emojiRenderers.filter((r) => r.isConnected && r.checkForAnyFrame());\n  if(!t.length) {\n    return;\n  }\n\n  const o = t.map((renderer) => {\n    const offsets = renderer.getOffsets();\n    return offsets.size ? [renderer, offsets] as const : undefined;\n  }).filter(Boolean);\n\n  for(const [renderer] of o) {\n    renderer.clearCanvas();\n  }\n\n  for(const [renderer, offsets] of o) {\n    renderer.render(offsets);\n  }\n};\nconst CUSTOM_EMOJI_FPS = 60;\nconst CUSTOM_EMOJI_FRAME_INTERVAL = 1000 / CUSTOM_EMOJI_FPS;\nconst setRenderInterval = () => {\n  if(emojiRenderInterval) {\n    return;\n  }\n\n  emojiRenderInterval = window.setInterval(renderEmojis, CUSTOM_EMOJI_FRAME_INTERVAL);\n  renderEmojis();\n};\nconst clearRenderInterval = () => {\n  if(!emojiRenderInterval) {\n    return;\n  }\n\n  clearInterval(emojiRenderInterval);\n  emojiRenderInterval = undefined;\n};\n\n(window as any).syncedPlayers = syncedPlayers;\n\ncustomElements.define('custom-emoji-element', CustomEmojiElement);\ncustomElements.define('custom-emoji-renderer-element', CustomEmojiRendererElement);\n\n/**\n * * Expecting correctly sorted nested entities (RichTextProcessor.sortEntities)\n */\nexport default function wrapRichText(text: string, options: Partial<{\n  entities: MessageEntity[],\n  contextSite: string,\n  highlightUsername: string,\n  noLinks: boolean,\n  noLinebreaks: boolean,\n  noCommands: boolean,\n  wrappingDraft: boolean,\n  // mustWrapEmoji: boolean,\n  fromBot: boolean,\n  noTextFormat: boolean,\n  passEntities: Partial<{\n    [_ in MessageEntity['_']]: boolean\n  }>,\n  noEncoding: boolean,\n\n  contextHashtag?: string,\n\n  // ! recursive, do not provide\n  nasty?: {\n    i: number,\n    usedLength: number,\n    text: string,\n    lastEntity?: MessageEntity\n  },\n  voodoo?: boolean,\n  customEmojis?: {[docId: DocId]: CustomEmojiElement[]},\n\n  loadPromises?: Promise<any>[],\n  middleware?: Middleware,\n  lazyLoadQueue?: LazyLoadQueue,\n  customEmojiSize?: MediaSize,\n  animationGroup?: AnimationItemGroup\n}> = {}) {\n  const fragment = document.createDocumentFragment();\n  if(!text) {\n    return fragment;\n  }\n\n  const nasty = options.nasty ??= {\n    i: 0,\n    usedLength: 0,\n    text\n  };\n\n  const customEmojis = options.customEmojis ??= {};\n\n  const entities = options.entities ??= parseEntities(nasty.text);\n\n  const passEntities = options.passEntities ??= {};\n  const contextSite = options.contextSite ??= 'Telegram';\n  const contextExternal = contextSite !== 'Telegram';\n\n  const textLength = nasty.text.length;\n  const length = entities.length;\n  let lastElement: HTMLElement | DocumentFragment;\n  for(; nasty.i < length; ++nasty.i) {\n    let entity = entities[nasty.i];\n\n    // * check whether text was sliced\n    // TODO: consider about moving it to other function\n    if(entity.offset >= textLength) {\n      if(entity._ !== 'messageEntityCaret') { // * can set caret to the end\n        continue;\n      }\n    } else if((entity.offset + entity.length) > textLength) {\n      entity = copy(entity);\n      // entity.length = entity.offset + entity.length - textLength;\n      entity.length = textLength - entity.offset;\n    }\n\n    if(entity.length) {\n      nasty.lastEntity = entity;\n    }\n\n    let nextEntity = entities[nasty.i + 1];\n\n    const startOffset = entity.offset;\n    const endOffset = startOffset + entity.length;\n    const endPartOffset = Math.min(endOffset, nextEntity?.offset ?? 0xFFFF);\n    const fullEntityText = nasty.text.slice(startOffset, endOffset);\n    const sliced = nasty.text.slice(startOffset, endPartOffset);\n    let partText = sliced;\n\n    if(nasty.usedLength < startOffset) {\n      (lastElement || fragment).append(nasty.text.slice(nasty.usedLength, startOffset));\n    }\n\n    if(lastElement) {\n      lastElement = fragment;\n    }\n\n    nasty.usedLength = endPartOffset;\n\n    let element: HTMLElement,\n      property: 'textContent' | 'alt' = 'textContent',\n      usedText = false;\n    switch(entity._) {\n      case 'messageEntityBold': {\n        if(!options.noTextFormat) {\n          if(options.wrappingDraft) {\n            element = document.createElement('span');\n            element.style.fontWeight = 'bold';\n          } else {\n            element = document.createElement('strong');\n          }\n        }\n\n        break;\n      }\n\n      case 'messageEntityItalic': {\n        if(!options.noTextFormat) {\n          if(options.wrappingDraft) {\n            element = document.createElement('span');\n            element.style.fontStyle = 'italic';\n          } else {\n            element = document.createElement('em');\n          }\n        }\n\n        break;\n      }\n\n      case 'messageEntityStrike': {\n        if(options.wrappingDraft) {\n          const styleName = IS_SAFARI ? 'text-decoration' : 'text-decoration-line';\n          element = document.createElement('span');\n          element.style.cssText = `${styleName}: line-through;`;\n        } else if(!options.noTextFormat) {\n          element = document.createElement('del');\n        }\n\n        break;\n      }\n\n      case 'messageEntityUnderline': {\n        if(options.wrappingDraft) {\n          const styleName = IS_SAFARI ? 'text-decoration' : 'text-decoration-line';\n          element = document.createElement('span');\n          element.style.cssText = `${styleName}: underline;`;\n        } else if(!options.noTextFormat) {\n          element = document.createElement('u');\n        }\n\n        break;\n      }\n\n      case 'messageEntityPre':\n      case 'messageEntityCode': {\n        if(options.wrappingDraft) {\n          element = document.createElement('span');\n          element.style.fontFamily = 'var(--font-monospace)';\n        } else if(!options.noTextFormat) {\n          element = document.createElement('code');\n        }\n\n        break;\n      }\n\n      // case 'messageEntityPre': {\n      //   if(options.wrappingDraft) {\n      //     element = document.createElement('span');\n      //     element.style.fontFamily = 'var(--font-monospace)';\n      //   } else if(!options.noTextFormat) {\n      //     element = document.createElement('pre');\n      //     const inner = document.createElement('code');\n      //     if(entity.language) {\n      //       inner.className = 'language-' + entity.language;\n      //       inner.textContent = entityText;\n      //       usedText = true;\n      //     }\n      //   }\n\n      //   break;\n      // }\n\n      case 'messageEntityHighlight': {\n        element = document.createElement('i');\n        element.className = 'text-highlight';\n        break;\n      }\n\n      case 'messageEntityBotCommand': {\n        // if(!(options.noLinks || options.noCommands || contextExternal)/*  && !entity.unsafe */) {\n        if(!options.noLinks && passEntities[entity._]) {\n          let command = fullEntityText.slice(1);\n          let bot: string | boolean;\n          let atPos: number;\n          if((atPos = command.indexOf('@')) !== -1) {\n            bot = command.slice(atPos + 1);\n            command = command.slice(0, atPos);\n          } else {\n            bot = options.fromBot;\n          }\n\n          element = document.createElement('a');\n          (element as HTMLAnchorElement).href = encodeEntities('tg://bot_command?command=' + encodeURIComponent(command) + (bot ? '&bot=' + encodeURIComponent(bot) : ''));\n          if(!contextExternal) {\n            element.setAttribute('onclick', 'execBotCommand(this)');\n          }\n        }\n\n        break;\n      }\n\n      case 'messageEntityCustomEmoji': {\n        if(!IS_CUSTOM_EMOJI_SUPPORTED) {\n          break;\n        }\n\n        while(nextEntity?._ === 'messageEntityEmoji' && nextEntity.offset < endOffset) {\n          ++nasty.i;\n          nasty.lastEntity = nextEntity;\n          nasty.usedLength += nextEntity.length;\n          nextEntity = entities[nasty.i + 1];\n        }\n\n        (customEmojis[entity.document_id] ??= []).push(element = new CustomEmojiElement());\n        element.classList.add('custom-emoji');\n\n        property = 'alt';\n        break;\n      }\n\n      case 'messageEntityEmoji': {\n        let isSupported = IS_EMOJI_SUPPORTED;\n        if(isSupported) {\n          for(const version in EmojiVersions) {\n            if(version) {\n              const emojiData = EmojiVersions[version as EMOJI_VERSION];\n              if(emojiData.hasOwnProperty(entity.unicode) && !EMOJI_VERSIONS_SUPPORTED[version as EMOJI_VERSION]) {\n                isSupported = false;\n                break;\n              }\n            }\n          }\n        }\n\n        // if(!(options.wrappingDraft && isSupported)) { // * fix safari emoji\n        if(!isSupported) { // no wrapping needed\n          // if(isSupported) { // ! contenteditable=\"false\"    ,       Safari,     ,  \n          //   insertPart(entity, '<span class=\"emoji\">', '</span>');\n          // } else {\n          element = document.createElement('img');\n          (element as HTMLImageElement).src = `assets/img/emoji/${entity.unicode}.png`;\n          property = 'alt';\n          element.className = 'emoji';\n          // }\n        // } else if(options.mustWrapEmoji) {\n        } else if(!options.wrappingDraft) {\n          element = document.createElement('span');\n          element.className = 'emoji';\n        }/*  else if(!IS_SAFARI) {\n          insertPart(entity, '<span class=\"emoji\" contenteditable=\"false\">', '</span>');\n        } */\n        /* if(!isSupported) {\n          insertPart(entity, `<img src=\"assets/img/emoji/${entity.unicode}.png\" alt=\"`, `\" class=\"emoji\">`);\n        } */\n\n        break;\n      }\n\n      case 'messageEntityCaret': {\n        element = document.createElement('span');\n        element.className = 'composer-sel';\n        break;\n      }\n\n      // case 'messageEntityLinebreak': {\n      //   if(options.noLinebreaks) {\n      //     insertPart(entity, ' ');\n      //   } else {\n      //     insertPart(entity, '<br/>');\n      //   }\n\n      //   break;\n      // }\n\n      case 'messageEntityUrl':\n      case 'messageEntityTextUrl': {\n        if(!(options.noLinks && !passEntities[entity._])) {\n          // let inner: string;\n          let url: string = (entity as MessageEntity.messageEntityTextUrl).url || fullEntityText;\n          let masked = false;\n          let onclick: string;\n\n          const wrapped = wrapUrl(url, true);\n          url = wrapped.url;\n          onclick = wrapped.onclick;\n\n          if(entity._ === 'messageEntityTextUrl') {\n            if(nextEntity?._ === 'messageEntityUrl' &&\n              nextEntity.length === entity.length &&\n              nextEntity.offset === entity.offset) {\n              nasty.lastEntity = nextEntity;\n              ++nasty.i;\n            }\n\n            if(url !== fullEntityText) {\n              masked = true;\n            }\n          } else {\n            // inner = encodeEntities(replaceUrlEncodings(entityText));\n          }\n\n          const currentContext = !!onclick;\n          if(!onclick && masked && !currentContext) {\n            onclick = 'showMaskedAlert';\n          }\n\n          if(options.wrappingDraft) {\n            onclick = undefined;\n          }\n\n          const href = (currentContext || typeof electronHelpers === 'undefined') ?\n            url :\n            `javascript:electronHelpers.openExternal('${url}');`;\n\n          element = document.createElement('a');\n          element.className = 'anchor-url';\n          (element as HTMLAnchorElement).href = href;\n\n          if(!(currentContext || typeof electronHelpers !== 'undefined')) {\n            setBlankToAnchor(element as HTMLAnchorElement);\n          }\n\n          if(onclick) {\n            element.setAttribute('onclick', onclick + '(this)');\n          }\n        }\n\n        break;\n      }\n\n      case 'messageEntityEmail': {\n        if(!options.noLinks) {\n          element = document.createElement('a');\n          (element as HTMLAnchorElement).href = encodeEntities('mailto:' + fullEntityText);\n          setBlankToAnchor(element as HTMLAnchorElement);\n        }\n\n        break;\n      }\n\n      case 'messageEntityHashtag': {\n        const contextUrl = !options.noLinks && SITE_HASHTAGS[contextSite];\n        if(contextUrl) {\n          const hashtag = fullEntityText.slice(1);\n          element = document.createElement('a');\n          element.className = 'anchor-hashtag';\n          (element as HTMLAnchorElement).href = contextUrl.replace('{1}', encodeURIComponent(hashtag));\n          if(contextExternal) {\n            setBlankToAnchor(element as HTMLAnchorElement);\n          } else {\n            element.setAttribute('onclick', 'searchByHashtag(this)');\n          }\n        }\n\n        break;\n      }\n\n      case 'messageEntityMentionName': {\n        if(!(options.noLinks && !passEntities[entity._])) {\n          element = document.createElement('a');\n          (element as HTMLAnchorElement).href = buildURLHash('' + entity.user_id);\n          element.className = 'follow';\n          element.dataset.follow = '' + entity.user_id;\n        }\n\n        break;\n      }\n\n      case 'messageEntityMention': {\n        // const contextUrl = !options.noLinks && siteMentions[contextSite];\n        if(!options.noLinks) {\n          const username = fullEntityText.slice(1);\n\n          const {url, onclick} = wrapUrl('t.me/' + username);\n\n          element = document.createElement('a');\n          element.className = 'mention';\n          (element as HTMLAnchorElement).href = url;\n          if(onclick) {\n            element.setAttribute('onclick', `${onclick}(this)`);\n          }\n\n          // insertPart(entity, `<a class=\"mention\" href=\"${contextUrl.replace('{1}', encodeURIComponent(username))}\"${contextExternal ? ' target=\"_blank\" rel=\"noopener noreferrer\"' : ''}>`, '</a>');\n        }\n\n        break;\n      }\n\n      case 'messageEntitySpoiler': {\n        if(options.noTextFormat) {\n          const encoded = encodeSpoiler(nasty.text, entity);\n          nasty.text = encoded.text;\n          partText = encoded.entityText;\n          if(endPartOffset !== endOffset) {\n            nasty.usedLength += endOffset - endPartOffset;\n          }\n          let n: MessageEntity;\n          for(; n = entities[nasty.i + 1], n && n.offset < endOffset;) {\n            // nasty.usedLength += n.length;\n            ++nasty.i;\n            nasty.lastEntity = n;\n            nextEntity = entities[nasty.i + 1];\n          }\n        } else if(options.wrappingDraft) {\n          element = document.createElement('span');\n          element.style.fontFamily = 'spoiler';\n        } else {\n          const container = document.createElement('span');\n          container.className = 'spoiler';\n          element = document.createElement('span');\n          element.className = 'spoiler-text';\n          element.textContent = partText;\n          usedText = true;\n          container.append(element);\n          fragment.append(container);\n\n          container[`on${CLICK_EVENT_NAME}`] = (window as any).onSpoilerClick;\n        }\n\n        break;\n      }\n    }\n\n    if(!usedText) {\n      if(element) {\n        // @ts-ignore\n        element[property] = partText;\n      } else {\n        (element || fragment).append(partText);\n      }\n    }\n\n    if(element && !element.parentElement) {\n      (lastElement || fragment).append(element);\n    }\n\n    while(nextEntity && nextEntity.offset < endOffset) {\n      ++nasty.i;\n\n      (element || fragment).append(wrapRichText(nasty.text, {\n        ...options,\n        voodoo: true\n      }));\n\n      nextEntity = entities[nasty.i + 1];\n    }\n\n    // if(!element?.parentElement) {\n    //   (lastElement || fragment).append(element ?? partText);\n    // }\n\n    if(nasty.usedLength <= endOffset) {\n      if(nasty.usedLength < endOffset) {\n        (element || fragment).append(nasty.text.slice(nasty.usedLength, endOffset));\n        nasty.usedLength = endOffset;\n      }\n\n      lastElement = fragment;\n      nasty.lastEntity = undefined;\n    } else if(entity.length > partText.length && element) {\n      lastElement = element;\n    } else {\n      lastElement = fragment;\n    }\n\n    if(options.voodoo) {\n      return fragment;\n    }\n  }\n\n  if(nasty.lastEntity) {\n    nasty.usedLength = nasty.lastEntity.offset + nasty.lastEntity.length;\n  }\n\n  if(nasty.usedLength < textLength) {\n    (lastElement || fragment).append(nasty.text.slice(nasty.usedLength));\n  }\n\n  const docIds = Object.keys(customEmojis) as DocId[];\n  if(docIds.length) {\n    const managers = rootScope.managers;\n    const size = options.customEmojiSize || mediaSizes.active.customEmoji;\n    const renderer = new CustomEmojiRendererElement();\n    // const middleware = () => !!renderer.disconnectedCallback && (!options.middleware || options.middleware());\n    let middleware: Middleware;\n    if(options.middleware) {\n      middleware = options.middleware;\n      options.middleware.onDestroy(() => {\n        renderer.disconnectedCallback?.();\n      });\n    } else {\n      renderer.middlewareHelper = getMiddleware();\n      middleware = renderer.middlewareHelper.get();\n    }\n\n    renderer.animationGroup = options.animationGroup;\n    renderer.size = size;\n    fragment.prepend(renderer);\n\n    const loadPromise = managers.appEmojiManager.getCachedCustomEmojiDocuments(docIds).then((docs) => {\n      if(middleware && !middleware()) return;\n\n      const loadPromises: Promise<any>[] = [];\n      const wrap = (doc: MyDocument, _loadPromises?: Promise<any>[]) => {\n        const elements = customEmojis[doc.id];\n        const isLottie = doc.sticker === 2;\n\n        const loadPromises: Promise<any>[] = [];\n        const promise = wrapSticker({\n          div: elements,\n          doc,\n          width: size.width,\n          height: size.height,\n          loop: true,\n          play: CUSTOM_EMOJI_INSTANT_PLAY,\n          managers,\n          isCustomEmoji: true,\n          group: 'none',\n          loadPromises,\n          middleware,\n          exportLoad: true,\n          needFadeIn: false,\n          loadStickerMiddleware: isLottie && middleware ? middleware.create().get(() => {\n            if(syncedPlayers.get(key) !== syncedPlayer) {\n              return false;\n            }\n\n            let good = !syncedPlayer.middlewares.size;\n            for(const middleware of syncedPlayer.middlewares) {\n              if(middleware()) {\n                good = true;\n              }\n            }\n\n            return good;\n          }) : undefined,\n          static: doc.mime_type === 'video/webm' && !IS_WEBM_SUPPORTED\n        });\n\n        if(_loadPromises) {\n          promise.then(() => _loadPromises.push(...loadPromises));\n        }\n\n        const addition: {\n          onRender?: (_p: Awaited<Awaited<typeof promise>['render']>) => Promise<void>,\n          elements: typeof elements\n        } = {\n          elements\n        };\n\n        if(doc.sticker === 1) {\n          return promise.then((res) => ({...res, ...addition}));\n        }\n\n        // eslint-disable-next-line prefer-const\n        addition.onRender = (_p) => Promise.all(loadPromises).then(() => {\n          if((middleware && !middleware()) || !doc.animated) {\n            return;\n          }\n\n          const players = Array.isArray(_p) ? _p as HTMLVideoElement[] : [_p as RLottiePlayer];\n          const player = Array.isArray(players) ? players[0] : players;\n          assumeType<RLottiePlayer | HTMLVideoElement>(player);\n          elements.forEach((element, idx) => {\n            const player = players[idx] || players[0];\n            element.renderer = renderer;\n            element.elements = elements;\n            element.player = player;\n\n            if(syncedPlayer) {\n              element.syncedPlayer = syncedPlayer;\n              if(element.paused) {\n                element.syncedPlayer.pausedElements.add(element);\n              }\n            }\n\n            if(element.isConnected) {\n              animationIntersector.addAnimation(element, element.renderer.animationGroup);\n            }\n          });\n\n          if(syncedPlayer) {\n            syncedPlayer.elementsCounter += elements.length;\n            syncedPlayer.middlewares.delete(middleware);\n            renderer.syncedElements.set(syncedPlayer, elements);\n          }\n\n          if(player instanceof RLottiePlayer) {\n            syncedPlayer.player = player;\n            renderer.playersSynced.set(elements, player);\n            renderer.canvas.dpr = player.canvas[0].dpr;\n            player.group = renderer.animationGroup;\n\n            player.overrideRender ??= (frame) => {\n              syncedPlayersFrames.set(player, frame);\n              // frames.set(containers, frame);\n            };\n\n            setRenderInterval();\n          } else if(player instanceof HTMLVideoElement) {\n            // player.play();\n\n            // const cache = framesCache.getCache(key);\n            // let {width, height} = renderer.size;\n            // width *= dpr;\n            // height *= dpr;\n\n            // const onFrame = (frame: ImageBitmap | HTMLCanvasElement) => {\n            //   topFrames.set(player, frame);\n            //   player.requestVideoFrameCallback(callback);\n            // };\n\n            // let frameNo = -1, lastTime = 0;\n            // const callback: VideoFrameRequestCallback = (now, metadata) => {\n            //   const time = player.currentTime;\n            //   if(lastTime > time) {\n            //     frameNo = -1;\n            //   }\n\n            //   const _frameNo = ++frameNo;\n            //   lastTime = time;\n            //   // const frameNo = Math.floor(player.currentTime * 1000 / CUSTOM_EMOJI_FRAME_INTERVAL);\n            //   // const frameNo = metadata.presentedFrames;\n            //   const imageBitmap = cache.framesNew.get(_frameNo);\n\n            //   if(imageBitmap) {\n            //     onFrame(imageBitmap);\n            //   } else if(IS_IMAGE_BITMAP_SUPPORTED) {\n            //     createImageBitmap(player, {resizeWidth: width, resizeHeight: height}).then((imageBitmap) => {\n            //       cache.framesNew.set(_frameNo, imageBitmap);\n            //       if(frameNo === _frameNo) onFrame(imageBitmap);\n            //     });\n            //   } else {\n            //     const canvas = document.createElement('canvas');\n            //     const context = canvas.getContext('2d');\n            //     canvas.width = width;\n            //     canvas.height = height;\n            //     context.drawImage(player, 0, 0);\n            //     cache.framesNew.set(_frameNo, canvas);\n            //     onFrame(canvas);\n            //   }\n            // };\n\n            // // player.requestVideoFrameCallback(callback);\n            // // setInterval(callback, CUSTOM_EMOJI_FRAME_INTERVAL);\n          }\n        });\n\n        let syncedPlayer: SyncedPlayer;\n        const key = [doc.id, size.width, size.height].join('-');\n        if(isLottie) {\n          syncedPlayer = syncedPlayers.get(key);\n          if(!syncedPlayer) {\n            syncedPlayer = {\n              player: undefined,\n              middlewares: new Set(),\n              pausedElements: new Set(),\n              elementsCounter: 0,\n              counter: 0,\n              key\n            };\n\n            syncedPlayers.set(key, syncedPlayer);\n          }\n\n          renderer.syncedElements.set(syncedPlayer, undefined);\n\n          ++syncedPlayer.counter;\n\n          if(middleware) {\n            syncedPlayer.middlewares.add(middleware);\n          }\n        }\n\n        return promise.then((res) => ({...res, ...addition}));\n      };\n\n      const missing: DocId[] = [];\n      const cachedPromises = docs.map((doc, idx) => {\n        if(!doc) {\n          missing.push(docIds[idx]);\n          return;\n        }\n\n        return wrap(doc, loadPromises);\n      }).filter(Boolean);\n\n      const uncachedPromisesPromise = managers.appEmojiManager.getCustomEmojiDocuments(missing).then((docs) => {\n        if(middleware && !middleware()) return [];\n        return docs.filter(Boolean).map((doc) => wrap(doc));\n      });\n\n      const loadFromPromises = (promises: typeof cachedPromises) => {\n        return Promise.all(promises).then((arr) => {\n          const promises = arr.map(({load, onRender, elements}) => {\n            if(!load) {\n              return;\n            }\n\n            const l = () => load().then(onRender);\n\n            if(renderer.lazyLoadQueue) {\n              elements.forEach((element) => {\n                renderer.lazyLoadQueue.push({\n                  div: element,\n                  load: () => {\n                    elements.forEach((element) => {\n                      renderer.lazyLoadQueue.unobserve(element);\n                    });\n\n                    return l();\n                  }\n                });\n              });\n            } else {\n              return l();\n            }\n          });\n\n          return Promise.all(promises);\n        });\n      };\n\n      const load = () => {\n        if(middleware && !middleware()) return;\n        const cached = loadFromPromises(cachedPromises);\n        const uncached = uncachedPromisesPromise.then((promises) => loadFromPromises(promises));\n        return Promise.all([cached, uncached]);\n      };\n\n      if(options.lazyLoadQueue) {\n        options.lazyLoadQueue.push({\n          div: renderer.canvas,\n          load\n        });\n      } else {\n        renderer.lazyLoadQueue = new LazyLoadQueue();\n        load();\n      }\n\n      return Promise.all(cachedPromises).then(() => Promise.all(loadPromises)).then(() => {});\n    });\n\n    // recordPromise(loadPromise, 'render emojis: ' + docIds.length);\n\n    options.loadPromises?.push(loadPromise);\n  }\n\n  return fragment;\n}\n\n(window as any).wrapRichText = wrapRichText;\n","// just for the future\nexport default function buildURLHash(str: string) {\n  return '#' + encodeURIComponent(str);\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport CAN_USE_TRANSFERABLES from '../../environment/canUseTransferables';\nimport EventListenerBase from '../../helpers/eventListenerBase';\n\nexport default class QueryableWorker extends EventListenerBase<{\n  ready: () => void,\n  frame: (reqId: number, frameNo: number, frame: Uint8ClampedArray | ImageBitmap) => void,\n  loaded: (reqId: number, frameCount: number, fps: number) => void,\n  error: (reqId: number, error: Error) => void,\n  workerError: (error: ErrorEvent) => void\n}> {\n  constructor(private worker: Worker) {\n    super();\n\n    this.worker.onerror = (error) => {\n      try {\n        this.dispatchEvent('workerError', error);\n        this.cleanup();\n        this.terminate();\n      } catch(err) {\n\n      }\n    };\n\n    this.worker.onmessage = (event) => {\n      this.dispatchEvent(event.data.queryMethodListener, ...event.data.queryMethodArguments);\n    };\n  }\n\n  public postMessage(message: any) {\n    this.worker.postMessage(message);\n  }\n\n  public terminate() {\n    this.worker.terminate();\n  }\n\n  public sendQuery(args: any[], transfer?: Transferable[]) {\n    this.worker.postMessage({\n      queryMethod: args.shift(),\n      queryMethodArguments: args\n    }, CAN_USE_TRANSFERABLES ? transfer: undefined);\n  }\n}\n","const IS_WEB_ASSEMBLY_SUPPORTED = typeof(WebAssembly) !== 'undefined';\n\nexport default IS_WEB_ASSEMBLY_SUPPORTED;\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport animationIntersector, {AnimationItemGroup} from '../../components/animationIntersector';\r\nimport {MOUNT_CLASS_TO} from '../../config/debug';\r\nimport pause from '../../helpers/schedulers/pause';\r\nimport {logger, LogTypes} from '../logger';\r\nimport RLottiePlayer, {RLottieOptions} from './rlottiePlayer';\r\nimport QueryableWorker from './queryableWorker';\r\nimport blobConstruct from '../../helpers/blob/blobConstruct';\r\nimport apiManagerProxy from '../mtproto/mtprotoworker';\r\nimport IS_WEB_ASSEMBLY_SUPPORTED from '../../environment/webAssemblySupport';\r\nimport makeError from '../../helpers/makeError';\r\n\r\nexport type LottieAssetName = 'EmptyFolder' | 'Folders_1' | 'Folders_2' |\r\n  'TwoFactorSetupMonkeyClose' | 'TwoFactorSetupMonkeyCloseAndPeek' |\r\n  'TwoFactorSetupMonkeyCloseAndPeekToIdle' | 'TwoFactorSetupMonkeyIdle' |\r\n  'TwoFactorSetupMonkeyPeek' | 'TwoFactorSetupMonkeyTracking' |\r\n  'voice_outlined2' | 'voip_filled' | 'voice_mini';\r\n\r\nexport class LottieLoader {\r\n  private loadPromise: Promise<void> = !IS_WEB_ASSEMBLY_SUPPORTED ? Promise.reject() : undefined;\r\n  private loaded = false;\r\n\r\n  private workersLimit = 4;\r\n  private players: {[reqId: number]: RLottiePlayer} = {};\r\n  private playersByCacheName: {[cacheName: string]: Set<RLottiePlayer>} = {};\r\n\r\n  private workers: QueryableWorker[] = [];\r\n  private curWorkerNum = 0;\r\n\r\n  private log = logger('LOTTIE', LogTypes.Error);\r\n\r\n  public getAnimation(element: HTMLElement) {\r\n    for(const i in this.players) {\r\n      if(this.players[i].el.includes(element)) {\r\n        return this.players[i];\r\n      }\r\n    }\r\n\r\n    return null;\r\n  }\r\n\r\n  public setLoop(loop: boolean) {\r\n    for(const i in this.players) {\r\n      const player = this.players[i];\r\n      player.loop = loop;\r\n      player.autoplay = player._autoplay;\r\n    }\r\n  }\r\n\r\n  public loadLottieWorkers() {\r\n    if(this.loadPromise) {\r\n      return this.loadPromise;\r\n    }\r\n\r\n    return this.loadPromise = new Promise((resolve, reject) => {\r\n      let remain = this.workersLimit;\r\n      for(let i = 0; i < this.workersLimit; ++i) {\r\n        const worker = new Worker(new URL('./rlottie.worker.ts', import.meta.url));\r\n        const queryableWorker = this.workers[i] = new QueryableWorker(worker);\r\n\r\n        queryableWorker.addEventListener('ready', () => {\r\n          this.log('worker #' + i + ' ready');\r\n\r\n          queryableWorker.addEventListener('frame', this.onFrame);\r\n          queryableWorker.addEventListener('loaded', this.onPlayerLoaded);\r\n          queryableWorker.addEventListener('error', this.onPlayerError);\r\n\r\n          --remain;\r\n          if(!remain) {\r\n            this.log('workers ready');\r\n            resolve();\r\n            this.loaded = true;\r\n          }\r\n        }, {once: true});\r\n\r\n        queryableWorker.addEventListener('workerError', (error) => {\r\n          reject('rlottie load error: ' + error.message);\r\n          this.loaded = false;\r\n        }, {once: true});\r\n      }\r\n    });\r\n  }\r\n\r\n  public loadAnimationAsAsset(params: Omit<RLottieOptions, 'animationData' | 'name'>, name: LottieAssetName) {\r\n    (params as RLottieOptions).name = name;\r\n    return this.loadAnimationFromURL(params, 'assets/tgs/' + name + '.json');\r\n  }\r\n\r\n  public loadAnimationFromURL(params: Omit<RLottieOptions, 'animationData'>, url: string): Promise<RLottiePlayer> {\r\n    if(!IS_WEB_ASSEMBLY_SUPPORTED) {\r\n      return this.loadPromise as any;\r\n    }\r\n\r\n    if(!this.loaded) {\r\n      this.loadLottieWorkers();\r\n    }\r\n\r\n    return fetch(url)\r\n    .then((res) => {\r\n      if(!res.headers || res.headers.get('content-type') === 'application/octet-stream') {\r\n        return res.arrayBuffer().then((data) => apiManagerProxy.invokeCrypto('gzipUncompress', data)).then((arr) => blobConstruct(arr as Uint8Array, ''))\r\n      } else {\r\n        return res.blob();\r\n      }\r\n    })\r\n    /* .then((str) => {\r\n      return new Promise<string>((resolve) => setTimeout(() => resolve(str), 2e3));\r\n    }) */\r\n    .then((blob) => {\r\n      const newParams = Object.assign(params, {animationData: blob, needUpscale: true});\r\n      if(!newParams.name) newParams.name = url;\r\n      return this.loadAnimationWorker(newParams);\r\n    });\r\n  }\r\n\r\n  public waitForFirstFrame(player: RLottiePlayer) {\r\n    return Promise.race([\r\n      /* new Promise<void>((resolve) => {\r\n        player.addEventListener('firstFrame', () => {\r\n          setTimeout(() => resolve(), 1500);\r\n        }, true);\r\n      }) */\r\n      new Promise<void>((resolve) => {\r\n        player.addEventListener('firstFrame', resolve, {once: true});\r\n      }),\r\n      pause(2500)\r\n    ]).then(() => player);\r\n  }\r\n\r\n  public async loadAnimationWorker(\r\n    params: RLottieOptions,\r\n    group: AnimationItemGroup = params.group || '',\r\n    middleware?: () => boolean\r\n  ): Promise<RLottiePlayer> {\r\n    if(!IS_WEB_ASSEMBLY_SUPPORTED) {\r\n      return this.loadPromise as any;\r\n    }\r\n\r\n    if(!this.loaded) {\r\n      await this.loadLottieWorkers();\r\n    }\r\n\r\n    if(middleware && !middleware()) {\r\n      throw makeError('MIDDLEWARE');\r\n    }\r\n\r\n    if(params.sync) {\r\n      const cacheName = RLottiePlayer.CACHE.generateName(params.name, params.width, params.height, params.color, params.toneIndex);\r\n      const players = this.playersByCacheName[cacheName];\r\n      if(players?.size) {\r\n        return Promise.resolve(players.entries().next().value[0]);\r\n      }\r\n    }\r\n\r\n    const containers = Array.isArray(params.container) ? params.container : [params.container];\r\n    if(!params.width || !params.height) {\r\n      params.width = parseInt(containers[0].style.width);\r\n      params.height = parseInt(containers[0].style.height);\r\n    }\r\n\r\n    if(!params.width || !params.height) {\r\n      throw new Error('No size for sticker!');\r\n    }\r\n\r\n    params.group = group;\r\n\r\n    const player = this.initPlayer(containers, params);\r\n\r\n    animationIntersector.addAnimation(player, group);\r\n\r\n    return player;\r\n  }\r\n\r\n  private onPlayerLoaded = (reqId: number, frameCount: number, fps: number) => {\r\n    const player = this.players[reqId];\r\n    if(!player) {\r\n      this.log.warn('onPlayerLoaded on destroyed player:', reqId, frameCount);\r\n      return;\r\n    }\r\n\r\n    this.log.debug('onPlayerLoaded');\r\n    player.onLoad(frameCount, fps);\r\n  };\r\n\r\n  private onFrame = (reqId: number, frameNo: number, frame: Uint8ClampedArray | ImageBitmap) => {\r\n    const player = this.players[reqId];\r\n    if(!player) {\r\n      this.log.warn('onFrame on destroyed player:', reqId, frameNo);\r\n      return;\r\n    }\r\n\r\n    if(player.clamped !== undefined && frame instanceof Uint8ClampedArray) {\r\n      player.clamped = frame;\r\n    }\r\n\r\n    player.renderFrame(frame, frameNo);\r\n  };\r\n\r\n  private onPlayerError = (reqId: number, error: Error) => {\r\n    const player = this.players[reqId];\r\n    if(!player) {\r\n      return;\r\n    }\r\n\r\n    // ! will need refactoring later, this is not the best way to remove the animation\r\n    const animations = animationIntersector.getAnimations(player.el[0]);\r\n    animations.forEach((animation) => {\r\n      animationIntersector.checkAnimation(animation, true, true);\r\n    });\r\n  };\r\n\r\n  public onDestroy(reqId: number) {\r\n    delete this.players[reqId];\r\n  }\r\n\r\n  public destroyWorkers() {\r\n    if(!IS_WEB_ASSEMBLY_SUPPORTED) {\r\n      return;\r\n    }\r\n\r\n    this.workers.forEach((worker, idx) => {\r\n      worker.terminate();\r\n      this.log('worker #' + idx + ' terminated');\r\n    });\r\n\r\n    this.log('workers destroyed');\r\n    this.workers.length = 0;\r\n    this.curWorkerNum = 0;\r\n    this.loaded = false;\r\n    this.loadPromise = undefined;\r\n  }\r\n\r\n  private initPlayer(el: RLottiePlayer['el'], options: RLottieOptions) {\r\n    const player = new RLottiePlayer({\r\n      el,\r\n      worker: this.workers[this.curWorkerNum++],\r\n      options\r\n    });\r\n\r\n    const {reqId, cacheName} = player;\r\n    this.players[reqId] = player;\r\n\r\n    const playersByCacheName = cacheName ? this.playersByCacheName[cacheName] ??= new Set() : undefined;\r\n    if(cacheName) {\r\n      playersByCacheName.add(player);\r\n    }\r\n\r\n    if(this.curWorkerNum >= this.workers.length) {\r\n      this.curWorkerNum = 0;\r\n    }\r\n\r\n    player.addEventListener('destroy', () => {\r\n      this.onDestroy(reqId);\r\n      if(playersByCacheName.delete(player) && !playersByCacheName.size) {\r\n        delete this.playersByCacheName[cacheName];\r\n      }\r\n    });\r\n\r\n    player.loadFromData(options.animationData);\r\n\r\n    return player;\r\n  }\r\n}\r\n\r\nconst lottieLoader = new LottieLoader();\r\nMOUNT_CLASS_TO.lottieLoader = lottieLoader;\r\nexport default lottieLoader;\r\n","const IS_IMAGE_BITMAP_SUPPORTED = typeof(ImageBitmap) !== 'undefined';\n\nexport default IS_IMAGE_BITMAP_SUPPORTED;\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport type {RLottieColor} from '../lib/rlottie/rlottiePlayer';\n\nexport type FramesCacheMap = Map<number, Uint8ClampedArray>;\nexport type FramesCacheMapNew = Map<number, HTMLCanvasElement | ImageBitmap>;\nexport type FramesCacheMapURLs = Map<number, string>;\nexport type FramesCacheItem = {\n  frames: FramesCacheMap,\n  framesNew: FramesCacheMapNew,\n  framesURLs: FramesCacheMapURLs,\n  clearCache: () => void,\n  counter: number\n};\n\nexport class FramesCache {\n  private cache: Map<string, FramesCacheItem>;\n\n  constructor() {\n    this.cache = new Map();\n  }\n\n  public static createCache(): FramesCacheItem {\n    const cache: FramesCacheItem = {\n      frames: new Map(),\n      framesNew: new Map(),\n      framesURLs: new Map(),\n      clearCache: () => {\n        cache.framesNew.forEach((value) => {\n          (value as ImageBitmap).close?.();\n        });\n\n        cache.frames.clear();\n        cache.framesNew.clear();\n        cache.framesURLs.clear();\n      },\n      counter: 0\n    };\n\n    return cache;\n  }\n\n  public getCache(name: string) {\n    let cache = this.cache.get(name);\n    if(!cache) {\n      this.cache.set(name, cache = FramesCache.createCache());\n    } else {\n      // console.warn('[RLottieCache] cache will be reused', cache);\n    }\n\n    ++cache.counter;\n    return cache;\n  }\n\n  public releaseCache(name: string) {\n    const cache = this.cache.get(name);\n    if(cache && !--cache.counter) {\n      this.cache.delete(name);\n      // console.warn('[RLottieCache] released cache', cache);\n    }\n  }\n\n  public getCacheCounter(name: string) {\n    const cache = this.cache.get(name);\n    return cache?.counter;\n  }\n\n  public generateName(name: string, width: number, height: number, color: RLottieColor, toneIndex: number) {\n    return [\n      name,\n      width,\n      height,\n      // color ? rgbaToHexa(color) : ''\n      color ? 'colored' : '',\n      toneIndex || ''\n    ].filter(Boolean).join('-');\n  }\n}\n\nconst framesCache = new FramesCache();\n\nexport default framesCache;\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport type {AnimationItemGroup, AnimationItemWrapper} from '../../components/animationIntersector';\nimport CAN_USE_TRANSFERABLES from '../../environment/canUseTransferables';\nimport IS_APPLE_MX from '../../environment/appleMx';\nimport {IS_ANDROID, IS_APPLE_MOBILE, IS_APPLE, IS_SAFARI} from '../../environment/userAgent';\nimport EventListenerBase from '../../helpers/eventListenerBase';\nimport mediaSizes from '../../helpers/mediaSizes';\nimport clamp from '../../helpers/number/clamp';\nimport QueryableWorker from './queryableWorker';\nimport IS_IMAGE_BITMAP_SUPPORTED from '../../environment/imageBitmapSupport';\nimport framesCache, {FramesCache, FramesCacheItem} from '../../helpers/framesCache';\n\nexport type RLottieOptions = {\n  container: HTMLElement | HTMLElement[],\n  canvas?: HTMLCanvasElement,\n  autoplay?: boolean,\n  animationData: Blob,\n  loop?: boolean,\n  width?: number,\n  height?: number,\n  group?: AnimationItemGroup,\n  noCache?: boolean,\n  needUpscale?: boolean,\n  skipRatio?: number,\n  initFrame?: number, // index\n  color?: RLottieColor,\n  inverseColor?: RLottieColor,\n  name?: string,\n  skipFirstFrameRendering?: boolean,\n  toneIndex?: number,\n  sync?: boolean\n};\n\nexport type RLottieColor = [number, number, number];\n\nexport function getLottiePixelRatio(width: number, height: number, needUpscale?: boolean) {\n  let pixelRatio = clamp(window.devicePixelRatio, 1, 2);\n  if(pixelRatio > 1 && !needUpscale) {\n    if(width > 90 && height > 90) {\n      if(!IS_APPLE && mediaSizes.isMobile) {\n        pixelRatio = 1;\n      }\n    } else if(width > 60 && height > 60) {\n      pixelRatio = Math.max(1.5, pixelRatio - 1.5);\n    }\n  }\n\n  return pixelRatio;\n}\n\nexport default class RLottiePlayer extends EventListenerBase<{\n  enterFrame: (frameNo: number) => void,\n  ready: () => void,\n  firstFrame: () => void,\n  cached: () => void,\n  destroy: () => void\n}> implements AnimationItemWrapper {\n  public static CACHE = framesCache;\n  private static reqId = 0;\n\n  public reqId = 0;\n  public curFrame: number;\n  private frameCount: number;\n  private fps: number;\n  private skipDelta: number;\n  public name: string;\n  public cacheName: string;\n  private toneIndex: number;\n\n  private worker: QueryableWorker;\n\n  private width = 0;\n  private height = 0;\n\n  public el: HTMLElement[];\n  public canvas: HTMLCanvasElement[];\n  private contexts: CanvasRenderingContext2D[];\n\n  public paused = true;\n  // public paused = false;\n  public direction = 1;\n  private speed = 1;\n  public autoplay = true;\n  public _autoplay: boolean; // ! will be used to store original value for settings.stickers.loop\n  public loop = true;\n  private _loop: boolean; // ! will be used to store original value for settings.stickers.loop\n  public group: AnimationItemGroup = '';\n\n  private frInterval: number;\n  private frThen: number;\n  private rafId: number;\n\n  // private caching = false;\n  // private removed = false;\n\n  private cache: FramesCacheItem;\n  private imageData: ImageData;\n  public clamped: Uint8ClampedArray;\n  private cachingDelta = 0;\n\n  private initFrame: number;\n  private color: RLottieColor;\n  private inverseColor: RLottieColor;\n\n  public minFrame: number;\n  public maxFrame: number;\n\n  // private playedTimes = 0;\n\n  private currentMethod: RLottiePlayer['mainLoopForwards'] | RLottiePlayer['mainLoopBackwards'];\n  private frameListener: (currentFrame: number) => void;\n  private skipFirstFrameRendering: boolean;\n  private playToFrameOnFrameCallback: (frameNo: number) => void;\n\n  public overrideRender: (frame: ImageData | HTMLCanvasElement | ImageBitmap) => void;\n  private renderedFirstFrame: boolean;\n\n  constructor({el, worker, options}: {\n    el: RLottiePlayer['el'],\n    worker: QueryableWorker,\n    options: RLottieOptions\n  }) {\n    super(true);\n\n    this.reqId = ++RLottiePlayer['reqId'];\n    this.el = el;\n    this.worker = worker;\n\n    for(const i in options) {\n      if(this.hasOwnProperty(i)) {\n        // @ts-ignore\n        this[i] = options[i];\n      }\n    }\n\n    this._loop = this.loop;\n    this._autoplay = this.autoplay;\n\n    // ! :(\n    this.initFrame = options.initFrame;\n    this.color = options.color;\n    this.inverseColor = options.inverseColor;\n    this.name = options.name;\n    this.skipFirstFrameRendering = options.skipFirstFrameRendering;\n    this.toneIndex = options.toneIndex;\n\n    if(this.name) {\n      this.cacheName = RLottiePlayer.CACHE.generateName(this.name, this.width, this.height, this.color, this.toneIndex);\n    }\n\n    // * Skip ratio (30fps)\n    let skipRatio: number;\n    if(options.skipRatio !== undefined) skipRatio = options.skipRatio;\n    else if((IS_ANDROID || IS_APPLE_MOBILE || (IS_APPLE && !IS_SAFARI && !IS_APPLE_MX)) && this.width < 100 && this.height < 100 && !options.needUpscale) {\n      skipRatio = 0.5;\n    }\n\n    this.skipDelta = skipRatio !== undefined ? 1 / skipRatio | 0 : 1;\n\n    // options.needUpscale = true;\n\n    // * Pixel ratio\n    const pixelRatio = getLottiePixelRatio(this.width, this.height, options.needUpscale);\n\n    this.width = Math.round(this.width * pixelRatio);\n    this.height = Math.round(this.height * pixelRatio);\n\n    // options.noCache = true;\n\n    // * Cache frames params\n    if(!options.noCache/*  && false */) {\n      //      ,     ,   8080  6868,   75%\n      if(IS_APPLE && this.width > 100 && this.height > 100) {\n        this.cachingDelta = 2; // 2 // 50%\n      } else if(this.width < 100 && this.height < 100) {\n        this.cachingDelta = Infinity; // 100%\n      } else {\n        this.cachingDelta = 4; // 75%\n      }\n    }\n\n    // this.cachingDelta = Infinity;\n    // this.cachingDelta = 0;\n    // if(isApple) {\n    //   this.cachingDelta = 0; //2 // 50%\n    // }\n\n    if(!this.canvas) {\n      this.canvas = this.el.map(() => {\n        const canvas = document.createElement('canvas');\n        canvas.classList.add('rlottie');\n        canvas.width = this.width;\n        canvas.height = this.height;\n        canvas.dpr = pixelRatio;\n        return canvas;\n      });\n    }\n\n    this.contexts = this.canvas.map((canvas) => canvas.getContext('2d'));\n\n    if(!IS_IMAGE_BITMAP_SUPPORTED) {\n      this.imageData = new ImageData(this.width, this.height);\n\n      if(CAN_USE_TRANSFERABLES) {\n        this.clamped = new Uint8ClampedArray(this.width * this.height * 4);\n      }\n    }\n\n    if(this.name) {\n      this.cache = RLottiePlayer.CACHE.getCache(this.cacheName);\n    } else {\n      this.cache = FramesCache.createCache();\n    }\n  }\n\n  public clearCache() {\n    if(this.cachingDelta === Infinity) {\n      return;\n    }\n\n    if(this.cacheName && this.cache.counter > 1) { // skip clearing because same sticker can be still visible\n      return;\n    }\n\n    this.cache.clearCache();\n  }\n\n  public sendQuery(args: any[]) {\n    this.worker.sendQuery([args.shift(), this.reqId, ...args]);\n  }\n\n  public loadFromData(data: RLottieOptions['animationData']) {\n    this.sendQuery(['loadFromData', data, this.width, this.height, this.toneIndex/* , this.canvas.transferControlToOffscreen() */]);\n  }\n\n  public play() {\n    if(!this.paused) {\n      return;\n    }\n\n    this.paused = false;\n    this.setMainLoop();\n  }\n\n  public pause(clearPendingRAF = true) {\n    if(this.paused) {\n      return;\n    }\n\n    this.paused = true;\n    if(clearPendingRAF) {\n      clearTimeout(this.rafId);\n    }\n    // window.cancelAnimationFrame(this.rafId);\n  }\n\n  private resetCurrentFrame() {\n    return this.curFrame = this.initFrame ?? (this.direction === 1 ? this.minFrame : this.maxFrame);\n  }\n\n  public stop(renderFirstFrame = true) {\n    this.pause();\n\n    const curFrame = this.resetCurrentFrame();\n    if(renderFirstFrame) {\n      this.requestFrame(curFrame);\n      // this.sendQuery('renderFrame', this.curFrame);\n    }\n  }\n\n  public restart() {\n    this.stop(false);\n    this.play();\n  }\n\n  public setSpeed(speed: number) {\n    if(this.speed === speed) {\n      return;\n    }\n\n    this.speed = speed;\n\n    if(!this.paused) {\n      this.setMainLoop();\n    }\n  }\n\n  public setDirection(direction: number) {\n    if(this.direction === direction) {\n      return;\n    }\n\n    this.direction = direction;\n\n    if(!this.paused) {\n      this.setMainLoop();\n    }\n  }\n\n  public remove() {\n    this.pause();\n    this.sendQuery(['destroy']);\n    if(this.cacheName) RLottiePlayer.CACHE.releaseCache(this.cacheName);\n    this.dispatchEvent('destroy');\n    this.cleanup();\n  }\n\n  private applyColor(frame: Uint8ClampedArray) {\n    const [r, g, b] = this.color;\n    for(let i = 0, length = frame.length; i < length; i += 4) {\n      if(frame[i + 3] !== 0) {\n        frame[i] = r;\n        frame[i + 1] = g;\n        frame[i + 2] = b;\n      }\n    }\n  }\n\n  private applyInversing(frame: Uint8ClampedArray) {\n    const [r, g, b] = this.inverseColor;\n    for(let i = 0, length = frame.length; i < length; i += 4) {\n      if(frame[i + 3] === 0) {\n        frame[i] = r;\n        frame[i + 1] = g;\n        frame[i + 2] = b;\n        frame[i + 3] = 255;\n      } else {\n        frame[i + 3] = 0;\n      }\n    }\n  }\n\n  public renderFrame2(frame: Uint8ClampedArray | HTMLCanvasElement | ImageBitmap, frameNo: number) {\n    /* this.setListenerResult('enterFrame', frameNo);\n    return; */\n\n    try {\n      if(frame instanceof Uint8ClampedArray) {\n        if(this.color) {\n          this.applyColor(frame);\n        }\n\n        if(this.inverseColor) {\n          this.applyInversing(frame);\n        }\n\n        this.imageData.data.set(frame);\n      }\n\n      // this.context.putImageData(new ImageData(frame, this.width, this.height), 0, 0);\n      this.contexts.forEach((context, idx) => {\n        let cachedSource: HTMLCanvasElement | ImageBitmap = this.cache.framesNew.get(frameNo);\n        if(!(frame instanceof Uint8ClampedArray)) {\n          cachedSource = frame;\n        } else if(idx > 0) {\n          cachedSource = this.canvas[0];\n        }\n\n        if(!cachedSource) {\n          // console.log('drawing from data');\n          const c = document.createElement('canvas');\n          c.width = context.canvas.width;\n          c.height = context.canvas.height;\n          c.getContext('2d').putImageData(this.imageData, 0, 0);\n          this.cache.framesNew.set(frameNo, c);\n          cachedSource = c;\n        }\n\n        if(this.overrideRender && this.renderedFirstFrame) {\n          this.overrideRender(cachedSource || this.imageData);\n        } else if(cachedSource) {\n          // console.log('drawing from canvas');\n          context.clearRect(0, 0, cachedSource.width, cachedSource.height);\n          context.drawImage(cachedSource, 0, 0);\n        } else {\n          context.putImageData(this.imageData, 0, 0);\n        }\n\n        if(!this.renderedFirstFrame) {\n          this.renderedFirstFrame = true;\n        }\n      });\n\n      this.dispatchEvent('enterFrame', frameNo);\n    } catch(err) {\n      console.error('RLottiePlayer renderFrame error:', err/* , frame */, this.width, this.height);\n      this.autoplay = false;\n      this.pause();\n    }\n  }\n\n  public renderFrame(frame: Parameters<RLottiePlayer['renderFrame2']>[0], frameNo: number) {\n    const canCacheFrame = this.cachingDelta && (frameNo % this.cachingDelta || !frameNo);\n    if(canCacheFrame) {\n      if(frame instanceof Uint8ClampedArray && !this.cache.frames.has(frameNo)) {\n        this.cache.frames.set(frameNo, new Uint8ClampedArray(frame));// frame;\n      } else if(IS_IMAGE_BITMAP_SUPPORTED && frame instanceof ImageBitmap && !this.cache.framesNew.has(frameNo)) {\n        this.cache.framesNew.set(frameNo, frame);\n      }\n    }\n\n    /* if(!this.listenerResults.hasOwnProperty('cached')) {\n      this.setListenerResult('enterFrame', frameNo);\n      if(frameNo === (this.frameCount - 1)) {\n        this.setListenerResult('cached');\n      }\n\n      return;\n    } */\n\n    if(this.frInterval) {\n      const now = Date.now(), delta = now - this.frThen;\n\n      if(delta < 0) {\n        const timeout = this.frInterval > -delta ? -delta % this.frInterval : this.frInterval;\n        if(this.rafId) clearTimeout(this.rafId);\n        this.rafId = window.setTimeout(() => {\n          this.renderFrame2(frame, frameNo);\n        }, timeout);\n        // await new Promise((resolve) => setTimeout(resolve, -delta % this.frInterval));\n        return;\n      }\n    }\n\n    this.renderFrame2(frame, frameNo);\n  }\n\n  public requestFrame(frameNo: number) {\n    const frame = this.cache.frames.get(frameNo);\n    const frameNew = this.cache.framesNew.get(frameNo);\n    if(frameNew) {\n      this.renderFrame(frameNew, frameNo);\n    } else if(frame) {\n      this.renderFrame(frame, frameNo);\n    } else {\n      if(this.clamped && !this.clamped.length) { // fix detached\n        this.clamped = new Uint8ClampedArray(this.width * this.height * 4);\n      }\n\n      this.sendQuery(['renderFrame', frameNo, this.clamped]);\n    }\n  }\n\n  private onLap() {\n    // this.playedTimes++;\n\n    if(!this.loop) {\n      this.pause(false);\n      return false;\n    }\n\n    return true;\n  }\n\n  private mainLoopForwards() {\n    const {skipDelta, maxFrame} = this;\n    const frame = (this.curFrame + skipDelta) > maxFrame ? this.curFrame = (this.loop ? this.minFrame : this.maxFrame) : this.curFrame += skipDelta;\n    // console.log('mainLoopForwards', this.curFrame, skipDelta, frame);\n\n    this.requestFrame(frame);\n    if((frame + skipDelta) > maxFrame) {\n      return this.onLap();\n    }\n\n    return true;\n  }\n\n  private mainLoopBackwards() {\n    const {skipDelta, minFrame} = this;\n    const frame = (this.curFrame - skipDelta) < minFrame ? this.curFrame = (this.loop ? this.maxFrame : this.minFrame) : this.curFrame -= skipDelta;\n    // console.log('mainLoopBackwards', this.curFrame, skipDelta, frame);\n\n    this.requestFrame(frame);\n    if((frame - skipDelta) < minFrame) {\n      return this.onLap();\n    }\n\n    return true;\n  }\n\n  public setMainLoop() {\n    // window.cancelAnimationFrame(this.rafId);\n    clearTimeout(this.rafId);\n\n    this.frInterval = 1000 / this.fps / this.speed * this.skipDelta;\n    this.frThen = Date.now() - this.frInterval;\n\n    // console.trace('setMainLoop', this.frInterval, this.direction, this, JSON.stringify(this.listenerResults), this.listenerResults);\n\n    const method = (this.direction === 1 ? this.mainLoopForwards : this.mainLoopBackwards).bind(this);\n    this.currentMethod = method;\n    // this.frameListener && this.removeListener('enterFrame', this.frameListener);\n\n    // setTimeout(() => {\n    // this.addListener('enterFrame', this.frameListener);\n    // }, 0);\n\n    if(this.frameListener) {\n      const lastResult = this.listenerResults.enterFrame;\n      if(lastResult !== undefined) {\n        this.frameListener(this.curFrame);\n      }\n    }\n\n    // this.mainLoop(method);\n    // this.r(method);\n    // method();\n  }\n\n  public playPart(options: {\n    from: number,\n    to: number,\n    callback?: () => void\n  }) {\n    this.pause();\n\n    const {from, to, callback} = options;\n    this.curFrame = from - 1;\n\n    return this.playToFrame({\n      frame: to,\n      direction: to > from ? 1 : -1,\n      callback\n    });\n  }\n\n  public playToFrame(options: {\n    frame: number,\n    speed?: number,\n    direction?: number,\n    callback?: () => void\n  }) {\n    this.pause();\n\n    const {frame, speed, callback, direction} = options;\n    this.setDirection(direction === undefined ? this.curFrame > frame ? -1 : 1 : direction);\n    speed !== undefined && this.setSpeed(speed);\n\n    const bounds = [this.curFrame, frame];\n    if(this.direction === -1) bounds.reverse();\n\n    this.loop = false;\n    this.setMinMax(bounds[0], bounds[1]);\n\n    if(this.playToFrameOnFrameCallback) {\n      this.removeEventListener('enterFrame', this.playToFrameOnFrameCallback);\n    }\n\n    if(callback) {\n      this.playToFrameOnFrameCallback = (frameNo: number) => {\n        if(frameNo === frame) {\n          this.removeEventListener('enterFrame', this.playToFrameOnFrameCallback);\n          callback();\n        }\n      };\n\n      this.addEventListener('enterFrame', this.playToFrameOnFrameCallback);\n    }\n\n    this.play();\n  }\n\n  public setColor(color: RLottieColor, renderIfPaused: boolean) {\n    this.color = color;\n\n    if(renderIfPaused && this.paused) {\n      this.renderFrame2(this.imageData.data, this.curFrame);\n    }\n  }\n\n  public setInverseColor(color: RLottieColor) {\n    this.inverseColor = color;\n  }\n\n  private setMinMax(minFrame = 0, maxFrame = this.frameCount - 1) {\n    this.minFrame = minFrame;\n    this.maxFrame = maxFrame;\n  }\n\n  public async onLoad(frameCount: number, fps: number) {\n    this.frameCount = frameCount;\n    this.fps = fps;\n    this.setMinMax();\n    if(this.initFrame !== undefined) {\n      this.initFrame = clamp(this.initFrame, this.minFrame, this.maxFrame);\n    }\n\n    const curFrame = this.resetCurrentFrame();\n\n    // * Handle 30fps stickers if 30fps set\n    if(this.fps < 60 && this.skipDelta !== 1) {\n      const diff = 60 / fps;\n      this.skipDelta = this.skipDelta / diff | 0;\n    }\n\n    this.frInterval = 1000 / this.fps / this.speed * this.skipDelta;\n    this.frThen = Date.now() - this.frInterval;\n    // this.sendQuery('renderFrame', 0);\n\n    //    ,   ()  519,\n    //   75%      ,  475, ..  100%   593,    84.\n\n    /* console.time('cache' + this.reqId);\n    for(let i = 0; i < frameCount; ++i) {\n      //if(this.removed) return;\n\n      if(i % 4) {\n        await new Promise((resolve) => {\n          delete this.listenerResults.enterFrame;\n          this.addListener('enterFrame', resolve, true);\n          this.requestFrame(i);\n        });\n      }\n    }\n\n    console.timeEnd('cache' + this.reqId); */\n    // console.log('cached');\n    /* this.el.innerHTML = '';\n    this.el.append(this.canvas);\n    return; */\n\n    !this.skipFirstFrameRendering && this.requestFrame(curFrame);\n    this.dispatchEvent('ready');\n    this.addEventListener('enterFrame', () => {\n      this.dispatchEvent('firstFrame');\n\n      if(!this.canvas[0].parentNode && this.el && !this.overrideRender) {\n        this.el.forEach((container, idx) => container.append(this.canvas[idx]));\n      }\n\n      // console.log('enterFrame firstFrame');\n\n      // let lastTime = this.frThen;\n      this.frameListener = () => {\n        if(this.paused || !this.currentMethod) {\n          return;\n        }\n\n        const time = Date.now();\n        // console.log(`enterFrame handle${this.reqId}`, time, (time - lastTime), this.frInterval);\n        /* if(Math.round(time - lastTime + this.frInterval * 0.25) < Math.round(this.frInterval)) {\n          return;\n        } */\n\n        // lastTime = time;\n\n        this.frThen = time + this.frInterval;\n        const canContinue = this.currentMethod();\n        if(!canContinue && !this.loop && this.autoplay) {\n          this.autoplay = false;\n        }\n      };\n\n      this.addEventListener('enterFrame', this.frameListener);\n      // setInterval(this.frameListener, this.frInterval);\n\n      // ! fix autoplaying since there will be no animationIntersector for it\n      if(this.group === 'none' && this.autoplay) {\n        this.play();\n      }\n    }, {once: true});\n  }\n}\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport Page from './page';\r\nimport lottieLoader from '../lib/rlottie/lottieLoader';\r\nimport {horizontalMenu} from '../components/horizontalMenu';\r\nimport {MOUNT_CLASS_TO} from '../config/debug';\r\nimport fastSmoothScroll from '../helpers/fastSmoothScroll';\r\nimport whichChild from '../helpers/dom/whichChild';\r\n\r\nclass PagesManager {\r\n  private pageId = -1;\r\n  private page: Page;\r\n\r\n  private selectTab: ReturnType<typeof horizontalMenu>;\r\n  public pagesDiv: HTMLDivElement;\r\n  public scrollableDiv: HTMLElement;\r\n\r\n  constructor() {\r\n    this.pagesDiv = document.getElementById('auth-pages') as HTMLDivElement;\r\n    this.scrollableDiv = this.pagesDiv.querySelector('.scrollable') as HTMLElement;\r\n    this.selectTab = horizontalMenu(null, this.scrollableDiv.querySelector('.tabs-container') as HTMLDivElement, null, () => {\r\n      if(this.page?.onShown) {\r\n        this.page.onShown();\r\n      }\r\n    });\r\n  }\r\n\r\n  public setPage(page: Page) {\r\n    if(page.isAuthPage) {\r\n      this.pagesDiv.style.display = '';\r\n\r\n      const id = whichChild(page.pageEl);\r\n      if(this.pageId === id) return;\r\n\r\n      this.selectTab(id);\r\n\r\n      if(this.pageId !== -1 && id > 1) {\r\n        lottieLoader.loadLottieWorkers();\r\n      }\r\n\r\n\r\n      this.pageId = id;\r\n\r\n      if(this.scrollableDiv) {\r\n        fastSmoothScroll({\r\n          container: this.scrollableDiv,\r\n          element: this.scrollableDiv.firstElementChild as HTMLElement,\r\n          position: 'start'\r\n        });\r\n      }\r\n    } else {\r\n      this.pagesDiv.style.display = 'none';\r\n      page.pageEl.style.display = '';\r\n\r\n      this.pageId = -1;\r\n    }\r\n\r\n    this.page = page;\r\n  }\r\n}\r\n\r\nconst pagesManager = new PagesManager();\r\nMOUNT_CLASS_TO.pagesManager = pagesManager;\r\nexport default pagesManager;\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport pagesManager from './pagesManager';\r\n\r\nexport default class Page {\r\n  public pageEl: HTMLDivElement;\r\n  private installed = false;\r\n\r\n  constructor(className: string, public isAuthPage: boolean, private onFirstMount?: (...args: any[]) => Promise<any> | void, private onMount?: (...args: any[]) => void, public onShown?: () => void) {\r\n    this.pageEl = document.body.querySelector('.' + className) as HTMLDivElement;\r\n  }\r\n\r\n  public async mount(...args: any[]) {\r\n    // this.pageEl.style.display = '';\r\n\r\n    if(this.onMount) {\r\n      this.onMount(...args);\r\n    }\r\n\r\n    if(!this.installed) {\r\n      if(this.onFirstMount) {\r\n        try {\r\n          const res = this.onFirstMount(...args);\r\n          if(res instanceof Promise) {\r\n            await res;\r\n          }\r\n        } catch(err) {\r\n          console.error('PAGE MOUNT ERROR:', err);\r\n        }\r\n      }\r\n\r\n      this.installed = true;\r\n    }\r\n\r\n    pagesManager.setPage(this);\r\n  }\r\n}\r\n","// https://github.com/twitter/twemoji-parser/blob/master/src/lib/regex.js\r\n\r\nexport function encodeEmoji(emojiText: string) {\r\n  const codepoints = toCodePoints(removeVS16s(emojiText)).join('-');\r\n  return codepoints;\r\n}\r\n\r\nconst vs16RegExp = /\\uFE0F/g;\r\n// avoid using a string literal like '\\u200D' here because minifiers expand it inline\r\nconst zeroWidthJoiner = String.fromCharCode(0x200d);\r\n\r\nconst removeVS16s = (rawEmoji: string) => (rawEmoji.indexOf(zeroWidthJoiner) < 0 ? rawEmoji.replace(vs16RegExp, '') : rawEmoji);\r\n\r\nexport function toCodePoints(unicodeSurrogates: string): Array<string> {\r\n  const points = [];\r\n  let char = 0;\r\n  let previous = 0;\r\n  let i = 0;\r\n  while(i < unicodeSurrogates.length) {\r\n    char = unicodeSurrogates.charCodeAt(i++);\r\n    if(previous) {\r\n      points.push((0x10000 + ((previous - 0xd800) << 10) + (char - 0xdc00)).toString(16));\r\n      previous = 0;\r\n    } else if(char > 0xd800 && char <= 0xdbff) {\r\n      previous = char;\r\n    } else {\r\n      points.push(char.toString(16));\r\n    }\r\n  }\r\n\r\n  if(points.length && points[0].length === 2) {\r\n    points[0] = '00' + points[0];\r\n  }\r\n\r\n  return points;\r\n}\r\n\r\nexport function getEmojiToneIndex(input: string) {\r\n  const match = input.match(/[\\uDFFB-\\uDFFF]/);\r\n  return match ? 5 - (57343 - match[0].charCodeAt(0)) : 0;\r\n}\r\n\r\nexport function getCountryEmoji(iso2: string) {\r\n  return String.fromCharCode(55356, 56741 + iso2.charCodeAt(0), 55356, 56741 + iso2.charCodeAt(1));\r\n}\r\n\r\nexport function emojiFromCodePoints(codePoints: string) {\r\n  return codePoints.split('-').reduce((prev, curr) => prev + String.fromCodePoint(parseInt(curr, 16)), '');\r\n}\n","!function(e,t){\"object\"==typeof exports&&\"object\"==typeof module?module.exports=t():\"function\"==typeof define&&define.amd?define([],t):\"object\"==typeof exports?exports.Recorder=t():e.Recorder=t()}(\"undefined\"!=typeof self?self:this,(function(){return function(e){var t={};function o(i){if(t[i])return t[i].exports;var n=t[i]={i:i,l:!1,exports:{}};return e[i].call(n.exports,n,n.exports,o),n.l=!0,n.exports}return o.m=e,o.c=t,o.d=function(e,t,i){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},o.r=function(e){\"undefined\"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:\"Module\"}),Object.defineProperty(e,\"__esModule\",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&\"object\"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(o.r(i),Object.defineProperty(i,\"default\",{enumerable:!0,value:e}),2&t&&\"string\"!=typeof e)for(var n in e)o.d(i,n,function(t){return e[t]}.bind(null,n));return i},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,\"a\",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p=\"\",o(o.s=0)}([function(e,t,o){\"use strict\";(function(t){var o=t.AudioContext||t.webkitAudioContext,i=function(e){if(!i.isRecordingSupported())throw new Error(\"Recording is not supported in this browser\");e||(e={}),this.state=\"inactive\",this.config=Object.assign({bufferLength:4096,encoderApplication:2049,encoderFrameSize:20,encoderPath:\"encoderWorker.min.js\",encoderSampleRate:48e3,maxFramesPerPage:40,mediaTrackConstraints:!0,monitorGain:0,numberOfChannels:1,recordingGain:1,resampleQuality:3,streamPages:!1,reuseWorker:!1,wavBitDepth:16},e),this.encodedSamplePosition=0};i.isRecordingSupported=function(){return o&&t.navigator&&t.navigator.mediaDevices&&t.navigator.mediaDevices.getUserMedia&&t.WebAssembly},i.prototype.clearStream=function(){this.stream&&(this.stream.getTracks?this.stream.getTracks().forEach((function(e){e.stop()})):this.stream.stop(),delete this.stream),this.audioContext&&this.closeAudioContext&&(this.audioContext.close(),delete this.audioContext)},i.prototype.encodeBuffers=function(e){if(\"recording\"===this.state){for(var t=[],o=0;o<e.numberOfChannels;o++)t[o]=e.getChannelData(o);this.encoder.postMessage({command:\"encode\",buffers:t})}},i.prototype.initAudioContext=function(e){return e&&e.context?(this.audioContext=e.context,this.closeAudioContext=!1):(this.audioContext=new o,this.closeAudioContext=!0),this.audioContext},i.prototype.initAudioGraph=function(){this.encodeBuffers=function(){delete this.encodeBuffers},this.scriptProcessorNode=this.audioContext.createScriptProcessor(this.config.bufferLength,this.config.numberOfChannels,this.config.numberOfChannels),this.scriptProcessorNode.connect(this.audioContext.destination),this.scriptProcessorNode.onaudioprocess=e=>{this.encodeBuffers(e.inputBuffer)},this.monitorGainNode=this.audioContext.createGain(),this.setMonitorGain(this.config.monitorGain),this.monitorGainNode.connect(this.audioContext.destination),this.recordingGainNode=this.audioContext.createGain(),this.setRecordingGain(this.config.recordingGain),this.recordingGainNode.connect(this.scriptProcessorNode)},i.prototype.initSourceNode=function(e){return e&&e.context?t.Promise.resolve(e):t.navigator.mediaDevices.getUserMedia({audio:this.config.mediaTrackConstraints}).then(e=>(this.stream=e,this.audioContext.createMediaStreamSource(e)))},i.prototype.loadWorker=function(){this.encoder||(this.encoder=new t.Worker(this.config.encoderPath))},i.prototype.initWorker=function(){var e=(this.config.streamPages?this.streamPage:this.storePage).bind(this);return this.recordedPages=[],this.totalLength=0,this.loadWorker(),new Promise((t,o)=>{var i=o=>{switch(o.data.message){case\"ready\":t();break;case\"page\":this.encodedSamplePosition=o.data.samplePosition,e(o.data.page);break;case\"done\":this.encoder.removeEventListener(\"message\",i),this.finish()}};this.encoder.addEventListener(\"message\",i),this.encoder.postMessage(Object.assign({command:\"init\",originalSampleRate:this.audioContext.sampleRate,wavSampleRate:this.audioContext.sampleRate},this.config))})},i.prototype.pause=function(e){if(\"recording\"===this.state){if(this.state=\"paused\",e&&this.config.streamPages){var t=this.encoder;return new Promise((e,o)=>{var i=o=>{\"flushed\"===o.data.message&&(t.removeEventListener(\"message\",i),this.onpause(),e())};t.addEventListener(\"message\",i),t.postMessage({command:\"flush\"})})}return this.onpause(),Promise.resolve()}},i.prototype.resume=function(){\"paused\"===this.state&&(this.state=\"recording\",this.onresume())},i.prototype.setRecordingGain=function(e){this.config.recordingGain=e,this.recordingGainNode&&this.audioContext&&this.recordingGainNode.gain.setTargetAtTime(e,this.audioContext.currentTime,.01)},i.prototype.setMonitorGain=function(e){this.config.monitorGain=e,this.monitorGainNode&&this.audioContext&&this.monitorGainNode.gain.setTargetAtTime(e,this.audioContext.currentTime,.01)},i.prototype.start=function(e){if(\"inactive\"===this.state)return this.initAudioContext(e),this.initAudioGraph(),this.encodedSamplePosition=0,this.initWorker().then(()=>this.initSourceNode(e)).then(e=>{this.sourceNode=e,this.state=\"recording\",this.onstart(),this.encoder.postMessage({command:\"getHeaderPages\"}),this.sourceNode.connect(this.monitorGainNode),this.sourceNode.connect(this.recordingGainNode)})},i.prototype.stop=function(){if(\"inactive\"!==this.state){this.state=\"inactive\",this.monitorGainNode.disconnect(),this.scriptProcessorNode.disconnect(),this.recordingGainNode.disconnect(),this.sourceNode.disconnect(),this.clearStream();var e=this.encoder;return new Promise(t=>{var o=i=>{\"done\"===i.data.message&&(e.removeEventListener(\"message\",o),t())};e.addEventListener(\"message\",o),e.postMessage({command:\"done\"}),this.config.reuseWorker||e.postMessage({command:\"close\"})})}return Promise.resolve()},i.prototype.destroyWorker=function(){\"inactive\"===this.state&&this.encoder&&(this.encoder.postMessage({command:\"close\"}),delete this.encoder)},i.prototype.storePage=function(e){this.recordedPages.push(e),this.totalLength+=e.length},i.prototype.streamPage=function(e){this.ondataavailable(e)},i.prototype.finish=function(){if(!this.config.streamPages){var e=new Uint8Array(this.totalLength);this.recordedPages.reduce((function(t,o){return e.set(o,t),t+o.length}),0),this.ondataavailable(e)}this.onstop(),this.config.reuseWorker||delete this.encoder},i.prototype.ondataavailable=function(){},i.prototype.onpause=function(){},i.prototype.onresume=function(){},i.prototype.onstart=function(){},i.prototype.onstop=function(){},e.exports=i}).call(this,o(1))},function(e,t){var o;o=function(){return this}();try{o=o||new Function(\"return this\")()}catch(e){\"object\"==typeof window&&(o=window)}e.exports=o}])}));"],"names":["animationIntersector","constructor","visible","Set","byGroups","lockedGroups","onlyOnePlayableGroup","intersectionLockedGroups","videosLocked","this","observer","IntersectionObserver","entries","entry","target","group","animation","find","p","el","isIntersecting","add","checkAnimation","delete","_animation","clearCache","overrideIdleGroups","doc","type","checkAnimations","idle","setOverrideIdleGroup","override","getAnimations","element","found","player","push","removeAnimation","remove","HTMLVideoElement","IS_SAFARI","setTimeout","src","load","length","unobserve","addAnimation","canvas","HTMLElement","loop","observe","blurred","destroy","undefined","groups","Object","keys","animations","paused","pause","has","autoplay","play","getOnlyOnePlayableGroup","setOnlyOnePlayableGroup","lockGroup","unlockGroup","refreshGroup","forEach","lockIntersectionGroup","unlockIntersectionGroup","SHOULD_USE_SAFARI_FIX","navigator","userAgent","match","err","AppMediaPlaybackController","media","Map","scheduled","mediaDetails","waitingMediaForLoad","waitingScheduledMediaForLoad","waitingDocumentsForLoad","playbackRates","voice","video","audio","seekBackward","details","playingMedia","currentTime","Math","max","seekOffset","seekForward","min","duration","seekTo","seekTime","onMediaDocumentLoad","get","managers","appDocsManager","getDoc","docId","supportsStreaming","handleSafariStreamable","cacheContext","thumbsStorage","getCacheContext","url","playbackRate","set","id","size","onPlay","e","peerId","mid","pip","message","getMessageByMedia","stop","setMedia","verify","listLoader","current","getCurrent","jumpLength","withOtherSide","previous","getPrevious","idx","findIndex","getNext","go","setTargets","dispatchEvent","getPlayingDetails","pauseMediaInOtherTabs","onPause","onEnded","isTrusted","lockedSwitchers","round","next","toggle","clean","s","isScheduled","storage","playingMediaType","playItem","item","searchContext","getMedia","resolveWaitingForLoadMedia","dispatchJump","goRound","browserPlay","bindBrowserCallback","browserPause","browserStop","browserSeekBackward","browserSeekForward","browserSeekTo","browserNext","browserPrevious","seekToStart","construct","container","document","createElement","style","cssText","body","append","mediaSession","actions","seekbackward","seekforward","seekto","previoustrack","nexttrack","action","setActionHandler","console","warn","skipMediaPlayEvent","properties","key","_key","value","dispatchPlaybackParams","defineProperties","getPlaybackParams","volume","muted","setPlaybackParams","params","_volume","_muted","_playbackRate","_loop","_round","addMedia","autoload","pFlags","is_scheduled","setAttribute","addEventListener","media_unread","fromId","appMessagesManager","readMessages","once","deferred","resolve","w","waitingStorage","then","promise","isSafariBuffering","safariBuffering","setSafariBuffering","setNewMediadata","pictureInPictureElement","artwork","isVoice","title","artist","thumbs","bytes","sizes","h","thumb","appPeersManager","getPeerPhoto","attribute","attributes","_","file_name","performer","IS_APPLE","metadata","MediaMetadata","setCurrentMediadata","playbackParams","cb","willBePlayed","willBePlayedMedia","setSearchContext","context","getSearchContext","prev","reset","loadCount","loadWhenLeft","processItem","onJump","older","onEmptied","reverse","folderId","getPlaybackMediaTypeFromMessage","mediaType","setSingleMedia","wasPlaying","toggleSwitchers","playPaused","removeEventListener","enabled","setPictureInPicture","listenerSetter","removeAll","appMediaPlaybackController","AppMediaViewer","captionTimeout","super","isForDocument","inputFilter","isMediaCompatibleForDocumentViewer","onPrevClick","openMedia","getMessageByPeer","onNextClick","onDeleteClick","content","close","onForwardClick","onAuthorClick","Number","MAX_SAFE_INTEGER","threadId","tab","lastMsgId","onDownloadClick","queueId","caption","classList","setCaptionTimeout","clearTimeout","window","onAdditionalScroll","wholeDiv","buttons","btnMenuForward","icon","text","onClick","btnMenuDownload","btnMenuDelete","setBtnMenuToggle","setListeners","forward","author","onCaptionClick","a","spoiler","HTMLAnchorElement","contains","onclick","getAttribute","includes","capture","click","getScheduledMessageByPeer","setCaption","html","entities","totalEntities","firstElementChild","fromRight","prevTargets","nextTargets","setMoverPromise","fwd_from","from_name","cantForwardMessage","canForward","button","cantDownloadMessage","download","canDeleteMessage","_openMedia","date","static","mime_type","VideoPlayer","streamable","onPlaybackRackMenuToggle","onPip","onPipClose","wrapper","setup","canHideControls","playbackRateButton","showOnLeaveToClassName","ignoreClickClassName","parentNode","insertBefore","appendChild","skin","stylePlayer","controls","querySelector","progress","prepend","catch","name","finally","initDuration","buildControls","timeDuration","insertAdjacentHTML","pipButton","querySelectorAll","fullScreenButton","timeElapsed","textContent","toHHMMSS","volumeSelector","leftControls","btn","parentElement","Array","from","togglePlay","requestPictureInPicture","visibility","debounceTime","debouncedPip","debounce","listener","timeout","overlayCounter","code","good","toggleFullScreen","altKey","nextIdx","PLAYBACK_RATES","indexOf","cancelEvent","onFullScreen","bind","hideControls","showControls","setPlaybackRateIcon","onMediaLoad","IS_MOBILE","pictureInPictureEnabled","map","rate","regularText","btnMenu","PLAYBACK_RATES_ICONS","className","IS_APPLE_MOBILE","webkitEnterFullscreen","enterFullscreen","isFull","cleanup","removeListeners","MEDIA_VIEWER_CLASSNAME","AppMediaViewerBase","topButtons","tempId","preloader","preloaderStreamable","isFirstOpen","pageEl","getElementById","zoomElements","zoomSwipeStartX","zoomSwipeStartY","zoomSwipeX","zoomSwipeY","setZoomValue","rangeSelector","moversContainer","transform","btnOut","btnIn","toggleZoom","setMoverAnimationPromise","tagName","highlightSwitchersTimeout","isZooming","mover","classNames","findUpClassName","onKeyDown","ctrlKeyDown","changeZoom","ctrlKey","metaKey","onKeyUp","onWheel","scrollingUp","deltaY","rootScope","log","logger","cancelable","lazyLoadQueue","overlaysDiv","mainDiv","topbar","topbarLeft","onlyMobile","authorRight","avatarEl","nameEl","buttonsDiv","concat","noRipple","zoom","step","withTransition","setHandlers","onScrub","onMouseUp","main","innerHTML","onLoadedMore","setNewMover","moveLength","onSwipe","xDiff","yDiff","abs","windowSize","verifyTouchTarget","evt","enable","isVisible","mousedown","zoomValue","setProgress","videoPlayer","lockControls","zoomSwipeHandler","lastDiffX","lastDiffY","multiplier","onFirstSwipe","onReset","cursor","addProgress","btnMenuToggle","Promise","reject","navigationItem","appNavigationController","clear","setMoverToTarget","onAnimationEnd","appMediaViewer","removeGlobalListeners","toggleOverlay","active","toggleGlobalListeners","setGlobalListeners","passive","closing","removeCenterFromMover","wasActive","delay","realParent","rect","getBoundingClientRect","SVGImageElement","SVGForeignObjectElement","left","needOpacity","overflowElement","visibleRect","getVisibleRect","overflow","vertical","horizontal","containerRect","top","aspecter","width","HTMLImageElement","setFullAspect","offsetLeft","height","scaleX","scaleY","borderRadius","getComputedStyle","getPropertyValue","brSplitted","str","splitted","split","i","fillPropertyValue","r","parseInt","join","willBeLeft","willBeTop","path","opacity","isOut","ret","isFulfilled","isRejected","SVGSVGElement","sizeTailPath","toggleWholeActive","mediaElement","selector","queryFrom","matches","elements","pop","getContext","naturalWidth","naturalHeight","videoWidth","videoHeight","HTMLCanvasElement","drawImage","image","Image","createVideo","clipId","dataset","newClipId","newSvg","createElementNS","setAttributeNS","outerHTML","replace","lastElementChild","defs","use","SVGUseElement","d","getAttributeNS","x","y","sX","sY","br","v","generatePathData","foreignObject","renderImageFromUrl","display","proportion","upscale","start","Date","now","diff","_br","moveTheMover","toLeft","windowW","newTransform","p1","newMover","updateMediaSource","toLowerCase","setAuthorInfo","timestamp","isPeerId","wrapTitlePromise","dialog","onlyFirstName","plainText","wrapEmojiText","oldAvatar","newAvatar","cloneNode","all","updateWithOptions","peerTitle","replaceContent","replaceWith","setAuthorPromise","isDocument","isVideo","useContainerAsTarget","IS_MOBILE_SAFARI","onPop","canAnimate","maxWidth","padding","windowH","mediaSizes","maxHeight","thumbPromise","setAttachmentSize","photoSize","img","downloaded","gotThumb","getStrippedThumbIfNeeded","loadPromise","useController","div","moverVideo","canPlayThrough","createPlayer","ckin","overlay","open","otherMediaViewer","releaseSingleMedia","show","readyState","HAVE_FUTURE_DATA","attach","attachCanPlay","detach","loading","networkState","NETWORK_LOADING","isntEnoughData","unshift","appDownloadManager","error","cancellablePromise","attachPromise","imgs","haveImage","setManual","onPopState","hash","location","state","debug","isPossibleSwipe","currentHash","overriddenHash","overrideHash","onHashChange","pushState","navigations","manual","handleItem","onEscape","back","onTouchStart","touches","options","history","scrollRestoration","replaceState","pushItem","noBlurOnPop","findItemByType","index","backByItem","splice","onItemAdded","noHistory","unshiftItem","spliceItems","items","origin","pathname","search","removeItem","removeByType","single","SearchGroup","clearable","clickable","autonomous","onFound","noIcons","list","setActive","childElementCount","AppSearch","searchInput","searchGroups","onSearch","minMsgId","loadedCount","foundCount","searchPromise","searchTimeout","query","listsContainer","scrollable","messages","setVirtualContainer","onChange","searchMore","onScrolledBottom","trim","beginSearch","inputField","input","focus","maxId","limit","res","count","shift","searchGroup","avatarSize","meAsSaved","SearchContextMenu","attachTo","searchSuper","onGotoClick","appImManager","selection","isSelecting","selectionForwardBtn","onSelectClick","toggleByElement","onClearSelectionClick","cancelSelection","selectionDeleteBtn","attachContextMenuListener","init","MouseEvent","preventDefault","cancelBubble","toPeerId","isSelected","isMidSelected","withSelection","positionMenu","contextMenuController","AppSearchSuper","tabs","prevTabId","middleware","historyStorage","usedFromHistory","urlsToRevoke","loadMutex","nextRates","loadPromises","loaded","loadedChats","firstLoad","monthContainers","mediaTabsMap","asChatList","groupByMonth","hideEmptyTabs","showSender","onTransitionStart","onTransitionEnd","safeAssign","searchContextMenu","navScrollableContainer","navScrollable","nav","tabsMenu","mediaTab","mediaTabs","menuTab","span","ripple","unlockScroll","tabsContainer","swipeHandler","handleTabSwipe","prevId","selectTab","children","onTouchMove","lockers","lockTouchScroll","contentTab","searchGroupMedia","canLoadMediaTab","horizontalMenu","tabContent","animate","skipScroll","scrollIntoViewNew","position","startCallback","scrollStartCallback","newMediaTab","onChangeTab","fromMediaTab","offsetTop","scrollTop","scroll","scrollHeight","rect2","onScroll","onMediaClick","targetClassName","targets","containerEl","copySearchContext","slice","inputMessagesFilterPhotoVideo","inputMessagesFilterDocument","useHeavyAnimationCheck","lock","unlockAndRefresh","filterMessagesByType","filterMessagesByInputFilter","processEmptyFilter","dom","appDialogsManager","setLastMessagePromise","lastMessage","highlightWord","processPhotoVideoFilter","promises","getMediaFromMessage","wrapped","choosePhotoSize","boxWidth","boxHeight","onlyPreview","withoutPreloader","noPlayButton","photo","noBlur","images","full","filter","Boolean","processDocumentFilter","withTime","fontWeight","voiceAsMusic","autoDownloadSize","processUrlFilter","webpage","entity","display_url","sliced","offset","matchUrl","same","URL","hostname","description","previewDiv","setInnerHTML","getAbbreviation","subtitleFragment","htmlToDocumentFragment","wrapRichText","innerText","decodeURIComponent","href","firstChild","wrapPlainText","row","titleRight","subtitle","havePadding","performSearchResult","elemsToAppend","sharedMediaDiv","processCallback","results","awaited","method","monthContainer","getMonthContainerByTimestamp","toggleElementCheckbox","afterPerforming","parent","child","loadChats","renderedPeerIds","inputMessagesFilterEmpty","setResults","showMembersCount","peer","getPeer","participants_count","participants","regExp","RegExp","escapeRegExp","cleanSearchText","titleSpan","lastMessageSpan","getChatMembersString","toChatId","username","getPeerUsername","user","appUsersManager","getUser","phone","formatPhoneNumber","formatted","onLoad","arg","getContactsPeerIds","contacts","searchContacts","my_results","globalContacts","showMore","intlElement","isShort","update","getConversations","dialogs","minDate","renderRecentSearch","recent","recentSearch","isUser","getUserStatusString","toUserId","getTopPeers","peers","people","loadMembers","renderParticipants","membersList","rippleEnabled","li","findUpTag","DIALOG_LIST_ELEMENT_TAG","participant","getParticipantPeerId","isAnyChat","deleted","appChatsManager","isChannel","LOAD_COUNT","appProfileManager","getChannelParticipants","getChatFull","chatFull","loadType","justLoad","used","slicedLength","ids","notFilteredMessages","m","checkForTriggers","getSearch","nextRate","next_rate","loadFirstTime","filters","counters","canViewMembers","getSearchCounters","firstMediaTab","counter","c","membersTab","loadFirstTimePromise","toLoad","t","findAndSplice","setHours","setDate","dateTimestamp","getTime","containers","month","getFullYear","year","dateElement","haveTimestamps","getObjectKeysAndSort","positionElementByIndex","isBroadcast","hasRights","cleanScrollPositions","cleanupHTML","goFirst","revokeObjectURL","putPreloader","empty","newInputFilter","copy","setQuery","maxDate","AppSelectPeers","chatsContainer","selected","freezed","offsetIndex","loadedWhat","peerType","multiSelect","exceptSelf","tempIds","selfPresence","needSwitchList","onInput","cachedContacts","getMoreResults","f","renderResultsFunc","renderResults","peerIds","splitUp","notRendered","filterPeerTypeBy","placeholder","section","innerContainer","topContainer","selectedContainer","selectedScrollable","sectionNameLangPackKey","noShadow","checkbox","checked","debouncedInput","appendTo","getResultsPromise","onFirstRender","renderSaved","testSelfSearch","getTempId","getMoreDialogs","archived","pageCount","newOffsetIndex","chatRightsAction","filterByRights","isEnd","getMoreContacts","isGlobalSearch","searchResult","resultPeerIds","arr","getMoreChannelParticipants","channelParticipants","q","isNonContactUser","checkboxField","label","subtitleEl","isDialog","insertAdjacentElement","offsetWidth","getSelected","addInitial","values","requestAnimationFrame","forceDirection","constructDownloadPreloader","tryAgainOnFail","circle","totalLength","mids","attr","elem","findMediaTargets","anchor","anchorMid","isBubbles","justAudioSelector","selectors","prefix","mediaItems","AudioElement","render","isRealVoice","isOutgoing","is_outgoing","uploadingFileName","durationStr","downloadDiv","onTypeLoad","audioEl","out","waveform","Uint8Array","valueCount","result","dataView","DataView","buffer","byteIndex","bitShift","getUint16","decodeWaveform","svg","svgContainer","availW","barHeightMax","minW","maxW","normValue","wfSize","barCount","maxValue","maxDelta","barX","sumI","bar_value","barWidth","createWaveformBars","fakeSvgContainer","waveformContainer","timeDiv","onTimeUpdate","throttledTimeUpdate","addAudioListener","readyPromise","mousemove","scrub","offsetX","targetTouches","pageX","scrubTime","wrapVoiceMessage","descriptionEl","audioAttribute","parts","titleEl","middleEllipsisEl","sizeType","subtitleDiv","launched","progressLine","lastChild","wrapAudio","audioTimeDiv","HAVE_CURRENT_DATA","onTypeDisconnect","getTimeStr","hadSearchContext","useSearch","autoDownload","shouldPlay","onDownloadInit","pauseListener","notifyAll","done","total","cancel","Error","playListener","setDownloadFunction","disconnectedCallback","isConnected","customElements","define","AvatarListLoader","loadMore","photoId","appPhotosManager","getUserPhotos","photos","loadedAllUp","AppMediaViewerAvatar","getPhoto","onAvatarUpdate","openAvatarViewer","getTarget","hadMessage","isObject","believeMe","seen","AvatarElement","addedToQueue","attachClickEvent","updateOptions","wasPeerId","newPeerId","onlyThumb","putPhoto","isBig","AvatarEdit","clearRect","asDiv","rippleSquare","disabled","ButtonMenuItem","noCheckboxClickListener","textElement","textArgs","keepOpen","menu","b","ButtonMenuToggleHandler","onOpen","onClose","openedMenu","direction","ChatBackgroundGradientRenderer","_width","_height","_tails","_scrollTails","_curve","_positions","_phases","_animatingToNextPosition","_scrollDelta","_onWheelRAF","drawOnWheel","floor","ceil","changeTailAndDraw","drawNextPositionAnimated","getProgress","transitionValue","nextPositionTail","_nextPositionTail","_nextPositionTails","_nextPositionLeft","frames","_frames","drawImageData","_incrementalCurve","hexToRgb","hex","g","getPositions","positions","getNextPositions","phase","curveMax","curve","pos","distances","nextPos","distance","curPosition","tail","changeTail","_tail","_phase","curPos","drawGradient","getGradientImageData","_hctx","createImageData","pixels","data","centerDistanceY","centerDistanceY2","centerDistanceX","swirlFactor","sqrt","theta","sinTheta","sin","cosTheta","cos","pixelX","pixelY","distanceSum","_colors","distanceX","distanceY","putImageData","_ctx","_hc","cancelAnimationFrame","colors","color","alpha","_canvas","fillStyle","fillRect","toNextPosition","tails","nextPhaseOnIdx","inc","toFixed","curves","last","scrollAnimate","_addedScrollListener","createCanvas","gradientRenderer","MEDIA_SIZE","wrapReplyDivAndCaption","mediaEl","messageMedia","isRound","mediaChildren","video_thumbs","noInfo","videoSize","ReplyContainer","isMediaSet","accumulateMapSet","reduce","acc","AppSelection","selectedMids","onMouseDown","targetLookupClassName","verifyTarget","selecting","firstTarget","processElement","checkBetween","isInDOM","seenSet","seenLength","findUpAsChild","elementsBetween","getElementsBetween","toggleByMid","canceledSelection","onMouseMove","getElementFromTarget","verifyMouseMoveTarget","removeManual","listenElement","documentListenerOptions","first","firstRect","lastRect","isHigher","lookupBetweenParentClassName","lookupBetweenElementsQuery","firstIndex","lastIndex","doNotAnimate","onCancelSelection","toggleSelection","navigationType","random","attachListeners","selectedText","getSelection","toString","createRange","verifyTouchLongPress","isElementShouldBeSelected","appendCheckbox","hasCheckbox","getCheckboxInputFromElement","updateContainer","forceSelection","cantForward","cantDelete","cantSend","storageKey","cantForwardDeleteMids","onUpdateContainer","toggleCheckboxes","wasSelecting","blurActiveElement","forwards","toggleResult","onToggleSelection","updateElementSelection","toggleMid","unselect","deleteSelectedMids","SearchSelection","selectionCountEl","selectionGotoBtn","selectionContainer","BASE_CLASS","btnCancel","attachClickOptions","obj","fromPeerId","sort","isPrivate","transitionElement","ChatSelection","chat","bubbles","recording","bubble","canSelectBubble","isGroupedBubbleSelected","getMidsFromGroupContainer","getBubbleGroupedItems","groupContainer","isGroupedSelected","isGroupedMidsSelected","mounted","getMountedBubble","needTranslateX","widthFrom","widthTo","center","selectionInputWrapper","selectionSendNowBtn","selectionLeft","selectionRight","translateButtonsX","right","inputContainer","toggleAttribute","skippedMids","isGrouped","groupedCheckboxInput","CheckboxField","restriction","toggleDisability","stateKey","stateValues","stateValue","setValueSilently","box","checkSvg","bg","border","withRipple","withHover","event","Event","disable","CodeInputField","autocomplete","lastLength","setLabel","onFill","confirmationPopup","callback","cancelButton","isCancel","checkboxes","countries","setCountries","country","hidden","default_name","localeCompare","CountryInputField","hidePicker","hideTimeout","selectWrapper","selectCountryByTarget","defaultName","phoneCodeEl","phoneCode","countryCode","lastCountrySelected","lastCountryCodeSelected","country_codes","_countryCode","country_code","onCountryChange","liMap","arrowDown","selectList","initSelect","emoji","iso2","liArr","noPhoneCodes","Infinity","spanEmoji","select","margin","mouseDownHandlerAttached","onKeyPress","_value","names","abbr","word","test","blur","selectCountryByIso2","countryName","DivAndCaption","fill","EditPeer","_disabled","isChanged","uploadAvatar","changedLength","requiredLength","requiredValidLength","inputFields","isValid","required","handleChange","nextBtn","withoutAvatar","avatarElem","doNotEditAvatar","avatarEdit","_upload","lockWithPromise","unlockOnSuccess","GifsTab","gifsContainer","EmoticonsDropdown","masonry","EMOTICONSSTICKERGROUP","getGifs","docs","processInvisibleDiv","ANIMATIONGROUP","AppGifsTab","nextOffset","loadedAll","onGifsClick","fileId","inputSearch","gifsDiv","onCloseAfterTimeout","newSearch","gifBotPeerId","resolveUsername","appInlineBotsManager","getInlineResults","next_offset","AppStickersTab","setsDiv","listenTo","sticker","stickerSet","access_hash","appStickersManager","getStickerSet","toggleStickerSet","changed","installed_date","removeAttribute","renderSet","header","countDiv","stickersDiv","stickerDiv","documents","withLock","renderFeatured","getFeaturedStickers","coveredSets","filterRendered","forEachReverse","covered","searchStickerSets","tabId","onSelectTabClick","searchButton","deleteBtn","checkRights","tabsEl","tabsElements","canSendStickers","canSendGifs","canSendToPeer","whichChild","savedRange","getGoodRange","unlock","refresh","emojiTab","stickersTab","gifsTab","HIDE_EMOJI_TAB","INIT_TAB_ID","lastMouseMoveEvent","mouseMoveEventAttached","isActive","onMouseOut","getElement","clearDraft","silent","emoticonsDropdown","forceClose","addLazyLoadQueueRepeat","divs","intersector","getVisible","clearVisible","getSavedRange","sel","rangeCount","activeElement","getRangeAt","menuOnClick","menuScroll","jumpedTo","stickyIntersector","stuck","which","axis","sendDocId","loadedURLs","appendEmoji","unify","kek","getEmojiEntityFromEmoji","wrapSingleEmoji","fixEmoji","getEmojiFromElement","nodeType","nodeValue","EmojiTab","closeScrollTop","onContentClick","categories","sorted","category","emojis","titleDiv","itemsDiv","unified","previousElementSibling","emojiScroll","appEmojiManager","getRecentEmojis","hasRecent","activeId","setMenuActive","recentItemsDiv","observeStickyHeaderChanges","LazyLoadQueueRepeat","parallelLimit","onVisibilityChange","_queue","spliced","findAndSpliceAll","queue","setProcessQueueTimeout","SuperStickerRenderer","regularLazyLoadQueue","animated","checkAnimationContainer","processVisible","processInvisible","renderSticker","observeAnimated","unobserveAnimated","StickersTab","categoriesMap","localCategories","setFavedLimit","appConfig","stickers_faved_limit_premium","stickers_faved_limit_default","createCategory","_title","menuTabPadding","categoriesIntersector","categoryAppendStickers","isCategoryVisible","superStickerRenderer","setCategoryItemsHeight","containerWidth","stickerSize","itemsPerRow","minHeight","renderStickerSet","menuWrapper","setTyping","intersectionOptions","root","clearCategoryItems","createLocalCategory","toggleLocalCategory","onCategoryStickers","stickers","deleteSticker","unshiftSticker","spliceExceed","favedCategory","recentCategory","clearButton","titleLangKey","descriptionLangKey","langKey","clearRecentStickers","noop","premiumCategory","apiManager","getAppConfig","getFavedStickersStickers","getRecentStickersStickers","getAllStickers","sets","getPremiumStickers","isPremium","race","rendererLazyLoadQueue","faved","resizeCategories","createStickersContextMenu","verifyRecent","notMounted","onLocalCategoryUpdate","batch","unshiftRecentSticker","saveRecentSticker","deleteRecentSticker","generateFakeIcon","isScam","LazyLoadQueueRepeat2","GifsMasonry","scrollPromise","processVisibleDiv","noPreview","gifWidth","gifHeight","willUseWidth","calcImageInBox","transitionTime","scrollableX","proxy","Proxy","apply","that","args","selectTarget","result1","canChange","forceDuration","mutateCallback","useStripe","indicator","currentIndicator","shiftLeft","scaleFactor","clientWidth","findUpAttribute","noLinebreaks","originalEvent","clipboardData","getData","usePlainText","filterEntity","curChild","nextSibling","richValue","getRichValue","entities2","parseEntities","mergeEntities","fragment","wrapDraftText","documentFragmentToHTML","execCommand","InputState","InputField","validate","maxLength","showLengthOn","canBeEdited","labelText","onInputCallbacks","String","isInputEmpty","inputMode","labelEl","showingLength","wasError","inputLength","isError","withLinebreaks","range","selectNodeContents","removeAllRanges","addRange","selectElementContents","labelOptions","fromSet","originalValue","isValidToChange","setDraftValue","setOriginalValue","setState","Valid","setError","InputSearch","prevValue","onClearClick","onClear","searchIcon","clearBtn","LazyLoadQueue","wasSeen","getItem","addElement","hasOwnProperty","LazyLoadQueueIntersector","inProcess","disconnect","loadItem","intersectorTimeout","processQueue","MediaProgressLine","useTransform","progressRAF","onLoadedData","seek","setLoadProgress","onProgress","filledLoad","setSeekMax","buf","buffered","numRanges","nearestStart","end","percents","testQueue","pendingTest","setTestQueue","testElement","getElementWidth","mapped","firstTime","textLength","font","textWidth","elementWidth","newElementWidth","widthChanged","smallerText","smallerWidth","smallerTextLength","half","half1","substr","half2","MiddleEllipsisElement","connectedCallback","PasswordMonkey","passwordInputField","needFrame","noCache","currentFrame","setSpeed","onVisibilityClickAdditional","passwordVisible","setDirection","curFrame","TrackingMonkey","playAnimation","frame","idleAnimation","PasswordInputField","onVisibilityClick","toggleVisible","stealthy","tabIndex","PeerProfileAvatars","avatar","avatars","draggable","loadCallback","intersectionObserver","loadCallbacks","addTab","gradient","info","arrowPrevious","arrowNext","checkScrollTop","SWITCH_ZONE","freeze","_e","clickX","toRight","cancelNextClick","minX","lastX","SCALE","TRANSLATE_TEMPLATE","addIndex","loadNearestToTarget","setPeer","backLimit","filterChatPhotosMessages","chat_photo","generateFakeAvatarMessage","activeTab","photo_id","setText","PeerProfile","setPeerStatus","needClear","noDelimiter","bio","subtitleLangKey","getProfileByPeerId","about","toast","link","notifications","togglePeerMute","appNotificationsManager","isPeerLocalMuted","setMoreDetails","fillUsername","userId","self","fillUserPhone","setAvatar","setPeerStatusInterval","setInterval","clearSetMoreDetailsTimeout","canBeDetailed","oldAvatars","formatUserPhone","fillNotifications","notificationsRow","fillRows","withIcons","fillProfileElements","cleaned","_setMoreDetails","peerFull","getChat","exportedInvite","exported_invite","address","setMoreDetailsTimeout","isRestricted","acknowledged","setPromise","cached","clearInterval","generateTitleIcons","verified","use2","generateVerifiedIcon","fake","scam","premium","generatePremiumIcon","weakMap","WeakMap","PeerTitle","setOptions","hasInner","fromName","limitSymbols","icons","getPeerTitle","inner","createDocumentFragment","PopupAvatar","closable","withConfirm","cropper","crop","removeHandlers","h6","btnClose","cropContainer","file","files","readBlobAsDataURL","contents","onload","originalImage","cropComponent","cropImage","event_state","cropLeft","cropTop","cropWidth","cropHeight","scaledRatio","overlayColor","CROPWIDTH","offsetHeight","CROPHEIGHT","updateCropSize","updateCropImage","startMoving","resizing","keyHandler","imgZoom","PI","bottom","newWidth","newHeight","clientHeight","fromCharCode","charCode","stopPropagation","container_width","container_height","container_left","container_top","mouse_x","clientX","scrollX","mouse_y","clientY","pageY","scrollY","saveEventState","moving","endMoving","currentTouch","complete","btnConfirm","hide","toBlob","blob","darkenCanvas","onCrop","postCanvas","ctx","PopupDeleteDialog","onSelect","peerTitleElement","getDialogType","callbackLeave","flush","leave","flushHistory","callbackDelete","descriptionArgs","isDanger","descriptionLangArgs","PopupDeleteMessages","onConfirm","revoke","deleteScheduledMessages","deleteMessages","titleArgs","isMegagroup","_hasRights","canRevoke","titleLangArgs","PopupForward","peerIdMids","overrideOnSelect","peerTypes","DEFAULT_APPEND_TO","appendPopupTo","onFullScreenChange","PopupElement","reAppend","middlewareHelper","MANAGERS","confirmShortcutIsSendShortcut","withoutOverlay","overlayClosable","isScrolledDown","btnConfirmOnEnter","buttonsEl","buttonsElements","langArgs","POPUPS","onContentUpdate","popup","popupConstructor","ctor","addCancelButton","times","time","ONE_HOUR","PopupMute","mutePeer","rows","radioField","radioForm","PopupPeer","noTitle","o","original","nextElementSibling","PopupPickUser","PopupSendNow","sendScheduledMessages","ANIMATION_GROUP","PopupStickers","stickerSetInput","isEmojis","onStickersClick","updateAdded","stickersFooter","onStickerSetUpdate","_set","updateButton","loadStickerSet","createStickerSetElements","headerRow","buttonRight","added","itemsContainer","setsPromises","isArray","firstSet","langPackKey","isStickerPack","onSend","containersPromises","stickerEmojiRaw","document_id","animationGroup","customEmojiSize","toggleStickerSets","isAdd","buttonAppend","installed","ProgressivePreloader","detached","isUpload","attachMethod","loadFunc","constructContainer","bold","constructDownloadIcon","downloadSvg","cancelSvg","func","startTime","onEnd","notify","elapsedTime","TRANSITION_TIME","addNotifyListener","useRafs","getTotalLength","strokeDasharray","Layouter","minWidth","spacing","ratios","countRatios","proportions","countProportions","averageRatio","accumulate","maxSizeRatio","layout","ComplexLayouter","layoutTwo","layoutThree","layoutFour","layoutTwoTopBottom","layoutTwoLeftRightEqual","layoutTwoLeftRight","layoutThreeLeftAndOther","layoutThreeTopAndOther","layoutFourTopAndOther","layoutFourLeftAndOther","geometry","sides","RectPart","minimalWidth","secondWidth","firstWidth","firstHeight","thirdHeight","secondHeight","rightWidth","leftWidth","thirdWidth","h0","w0","w2","w1","h1","h2","ratio","cropRatios","clamp","attempts","multiHeight","sum","pushAttempt","lineCounts","heights","second","third","fourth","optimalAttempt","optimalDiff","attempt","counts","lineCount","totalHeight","minLineHeight","bad1","bad2","line","optimalCounts","optimalHeights","rowCount","colCount","lineHeight","col","prepareAlbum","widthItem","heightItem","borderTopLeftRadius","borderBottomLeftRadius","borderTopRightRadius","borderBottomRightRadius","forMedia","mediaDiv","putAvatar","renderThumbPromise","thumbImage","isFullLoaded","stripped_thumb","getPreviewURLFromBytes","sequentialDom","renderPromise","myId","getPeerColorById","avatarAvailable","avatarRendered","appAvatarsManager","isAvatarCached","first_name","last_name","getPeerInitials","returnDiv","setButtonLoader","RadioField","alignRight","RadioForm","radios","form","RangeSelector","events","setFilled","filled","stepStr","decimals","_removeListeners","rectMax","offsetAxisValue","rippleClickId","attachListenerTo","handler","drawRipple","clickId","touchStartFired","clickY","isRippleUnneeded","touchEnd","Row","subtitleLangArgs","isToggle","noCheckboxSubtitle","titleRightSecondary","noWrap","titleRightEl","navigationTab","buttonRightLangKey","createMedia","RadioFormFromRows","SCROLL_THROTTLE","IS_ANDROID","ScrollableBase","logPrefix","onScrollMeasure","lastScrollPosition","lastScrollDirection","isHeavyAnimationInProgress","needCheckAfterAnimation","cancelMeasure","onScrolledTop","scrollPosition","scrollProperty","addScrollListener","addedScrollListener","removeScrollListener","removeHeavyAnimationListener","Scrollable","onScrollOffset","withPaddingContainer","maxScrollTop","getDistanceToEnd","setScrollTopSilently","ignoreNextScrollEvent","ScrollableX","splitCount","scrollHorizontally","deltaX","scrollWidth","scrollLeft","AppNewGroupTab","isGeoChat","setTitle","SettingSection","inputWrapper","groupNameInputField","groupLocationInputField","valueCheck","userLocationCoords","userLocationAddress","createChannel","geo_point","megagroup","chatId","inputFile","editPhoto","inviteToChannel","createChat","chatsSection","nameArgs","new","startLocating","geolocation","getCurrentPosition","lat","coords","latitude","long","longitude","uri","fetch","response","json","display_name","GeolocationPositionError","PrivacyType","getPrivacyRulesDetails","rules","types","allowPeers","users","chats","disallowPeers","rule","PrivacySection","onRadioChange","captions","captionElement","radioSection","exceptions","radioRows","skipTypes","noExceptions","generateSection","exceptionTexts","exception","_peerIds","slider","createTab","skippable","takeOut","newPeerIds","generateStr","splitPeersByType","selectedPeerIds","appPrivacyManager","getPrivacy","inputKey","setRadio","k","eventListener","chatKey","usersKey","getUserInput","setPrivacy","AppPrivacyPhoneNumberTab","getSelf","captionEl","mePath","anchorCopy","phoneSection","sCaption","AppTwoStepVerificationSetTab","captionOld","stickerContainer","inputContent","generateContentElement","btnReturn","sliceTabsUntilTab","AppSettingsTab","canFocus","isFirstInput","AppTwoStepVerificationEmailConfirmationTab","isFirst","email","codeInputField","passwordManager","confirmPasswordEmail","goNext","btnChange","btnResend","cancelPasswordEmail","AppTwoStepVerificationEmailTab","resendPasswordEmail","onOpenAfterTimeout","onContinueClick","btnContinue","btnSkip","matchEmail","toggleButtons","updateSettings","hint","currentPassword","plainPassword","newPassword","symbols","AppTwoStepVerificationHintTab","onSkipClick","saveHint","AppTwoStepVerificationReEnterPasswordTab","monkey","I","verifyInput","AppTwoStepVerificationEnterPasswordTab","isNew","has_password","textEl","getStateInterval","getState","_state","check","auth","AppTwoStepVerificationTab","removeTabFromHistory","btnChangePassword","btnDisablePassword","btnSetRecoveryEmail","has_recovery","btnSetPassword","AppPrivacyLastSeenTab","AppPrivacyProfilePhotoTab","AppPrivacyForwardMessagesTab","AppPrivacyAddToGroupsTab","AppPrivacyCallsTab","AppActiveSessionsTab","Session","app_name","app_version","ip","date_active","date_created","midtitle","device_model","system_version","platform","authorizations","session","btnTerminate","invokeApi","otherSection","onError","onTerminateClick","menuElement","AppBlockedUsersTab","btnAdd","toggleBlock","bot","blocked","getBlocked","convertKeyToInputKey","toUpperCase","AppPrivacyVoicesTab","AppPrivacyAndSecurityTab","SUBTITLE","blockedPeerIds","blockedUsersRow","passwordState","twoFactorRowOptions","email_unconfirmed_pattern","twoFactorRow","activeSessionsRow","updateActiveSessions","setBlockedCount","updateBlocked","rowsByKeys","numberVisibilityRow","lastSeenTimeRow","photoVisibilityRow","callRow","linkAccountRow","groupChatsAddRow","voicesRow","updatePrivacyRow","disallowLength","allowLength","destroyed","setGlobalPrivacySettings","archive_and_mute_new_noncontact_peers","getGlobalPrivacySettings","settings","onPremiumToggle","autoarchive_setting_available","_enabled","sensitive_enabled","sensitive_can_change","payment","appPaymentsManager","clearSavedInfo","deleteButton","appDraftsManager","clearAllDrafts","auths","averageColorFromCanvas","pixel","getImageData","pixelsLength","outPixel","Uint8ClampedArray","highlightningColor","rgba","l","ColorPicker","hue","saturation","lightness","onGrabStart","documentElement","boxDragger","onGrabEnd","sliders","hueDragger","hexInputField","rgbInputField","inputs","valid","setColor","rgbRegExp","attachBoxListeners","attachHueListeners","attachGrabListeners","boxRect","saturationHandler","hueRect","hueHandler","updateHexInput","updateRgbInput","rgb","boxX","percentY","boxY","percentHue","hueX","updatePicker","getCurrentColor","rgbaArray","hexa","hsl","hsla","maxX","maxY","posX","posY","lightnessX","lightnessY","AppBackgroundColorTab","_applyColor","updateColorPicker","colorPicker","background","theme","intensity","slug","appStateManager","pushToState","onColorChange","applyColor","themeController","gridSection","grid","backgroundColor","throttle","isColored","AppBackgroundTab","clicked","wallPapersByElement","elementsByKey","onUploadClick","accept","requestFile","endsWith","createObjectURL","mimeType","scaleMediaElement","File","wallPaper","prepareWallPaperUpload","uploadPromise","uploadWallPaper","uploadDeferred","newKey","getWallPaperKey","setBackgroundDocument","addWallPaper","onResetClick","defaultTheme","blurCheckboxField","onGridClick","wallpaper","saveToCache","_tempId","onReady","getPixelPromise","imageUrl","imageSource","averageColorFromImageSource","averageColor","getColorsFromWallPaper","toDataURL","getWallPaperKeyFromTheme","uploadButton","colorButton","resetButton","pattern","getWallPapers","wallPapers","gridContainer","background_color","second_background_color","third_background_color","fourth_background_color","hasFile","isDark","dark","noFadeIn","webkitMaskImage","AppQuickReactionTab","appReactionsManager","getQuickReaction","getAvailableReactions","quickReaction","availableReactions","reaction","inactive","availableReaction","static_icon","setDefaultReaction","RangeSettingSelector","initialValue","minValue","writeValue","nameDiv","valueDiv","valueContainer","AppGeneralSettingsTab","chatBackgroundButton","animationsCheckboxField","enterRow","ctrlEnterRow","kilometersRow","milesRow","formats","format","runFirst","getNextTimeout","_callback","run","eachTimeout","getSeconds","eachMinute","toLocaleTimeString","hour","minute","suggestCheckboxField","bigCheckboxField","reactionsRow","renderQuickReaction","loopCheckboxField","stickerSets","stickersContent","allStickers","assumeType","AppEditProfileTab","firstNameInputField","lastNameInputField","bioInputField","about_length_limit_premium","about_length_limit_default","editPeer","usernameInputField","setProfileUrl","availableText","takenText","invalidText","profileUrlContainer","profileUrlAnchor","updateProfile","uploadProfilePhoto","updateUsername","userFull","getProfile","AppNotificationsTab","NotifySection","enabledRow","typeText","previewEnabledRow","inputNotifyPeer","getNotifySettings","notifySettings","applySettings","isMuted","show_previews","mute","showPreviews","inputSettings","mute_until","updateNotifySettings","notify_settings","contactsSignUpRow","soundRow","sound","getContactSignUpNotification","setContactSignUpNotification","AppLanguageTab","invokeApiCacheable","lang_pack","languages1","languages2","rendered","webLangCodes","language","lang_code","native_name","langPack","autoDownloadPeerTypeSection","contactsCheckboxField","privateCheckboxField","groupsCheckboxField","channelsCheckboxField","AppAutoDownloadPhotoTab","AppAutoDownloadFileTab","debouncedSave","sizeMax","setByKey","MIN","MAX_RANGE","MAX","upTo","formatBytes","compareAndUpdate","AppAutoDownloadVideoTab","AUTO_DOWNLOAD_FOR_KEYS","private","channels","AppDataAndStorageTab","autoCheckboxField","autoDownloadNew","deepEqual","setSubtitles","setAutoDownloadSubtitle","photoRow","videoRow","fileRow","file_size_max","openTab","tabConstructor","onDisabledChange","gifsCheckboxField","videosCheckboxField","peerKeys","enabledKeys","isAll","logOut","edit","profile","fillPromise","changeAvatarBtn","upload","updateChangeAvatarBtn","devicesRow","languageRow","buttonsSection","lottieLoader","getAuthorizations","overwrite","getAuthorizationsPromise","AppNewChannelTab","channelNameInputField","channelDescriptionInputField","onLengthChange","broadcast","channelId","PopupCreateContact","importContact","nameInputField","telInputField","AppContactsTab","openContacts","isContact","sortedUserList","createList","renderPage","AppArchivedTab","wasFilterId","filterId","chatList","localId","AppPeopleNearbyTab","isLocationWatched","parseDistance","retryBtn","latestLocationSaved","accuracy","getLocated","updates","orderedPeers","groupsCounter","usersCounter","getPeerId","peopleSection","locatedPeers","sortedList","errorCategory","startWatching","watchPosition","isLongitudeDifferent","isLatitudeDifferent","distanceCheck","calculateDistance","stopWatching","lat1","long1","lat2","long2","asin","LEFT_COLUMN_ACTIVE_CLASSNAME","AppSidebarLeft","sidebarEl","sidebarHeader","onContactsClick","backBtn","btnArchive","dialogsStorage","getFolderDialogs","isDialogsLoaded","themeCheckboxField","filteredButtons","sessionStorage","kz_version","toolsBtn","btnMenuFooter","rel","newBtnMenu","updateBtn","reload","initSearch","archivedCount","folder","unreadPeerIds","formatNumber","checkUpdateInterval","cache","status","ok","hasUpdate","searchContainer","pickedElements","selectedPeerId","selectedMinDate","selectedMaxDate","updatePicked","setProperty","removeProperty","helper","unselectEntity","renderEntity","indexOfAndSplice","dates","dateData","pushRecentSearch","peopleContainer","hideNewBtnMenuTimeout","transition","activeClassName","onFocus","clearRecentSearchBtn","clearRecentSearch","fakeGradientDelimiter","generateDelimiter","hr","captionArgs","delimiter","appSidebarLeft","AppAddMembersTab","attachToPromise","removeLoader","isPrivacy","AppChatFoldersTab","filtersRendered","renderFolder","dialogFilter","non_contacts","broadcasts","bots","isAnyGroup","filtersStorage","getFilter","createFolderBtn","foldersSection","suggestedSection","canCreateFolder","onFiltersContainerUpdate","getDialogFilters","toggleAllChats","getSuggestedFilters","order","loadAnimationPromise","dialog_filters_limit_premium","dialog_filters_limit_default","getSuggestedDialogsFilters","suggestedFilters","includePeerIds","excludePeerIds","pinnedPeerIds","createDialogFilter","bool","AppIncludedChatsTab","getContacts","foundInFilters","dialogsByFilters","onSelectChange","confirmBtn","cmp","pinned_peers","other","otherLegacy","getInputPeerById","editFolderTab","setFilter","onAppConfig","dialog_filters_chats_limit_premium","dialog_filters_chats_limit_default","categoriesSection","exclude_muted","ico","exclude_archived","exclude_read","selectedPeers","addedInitial","_add","flag","originalFilter","AppEditFolderTab","flags","deleteFolderButton","updateDialogFilter","menuBtn","inputSection","generateList","h2Text","to","includedFlagsContainer","excludedFlagsContainer","include","include_peers","editCheckForChange","reloadMissingPromises","reloadMissingPeerIds","onCreateOpen","onEditOpen","ul","ignoreClick","hasPeer","getDialogOnly","filtered","filterAsync","renderMore","_length","exclude_peers","RIGHT_COLUMN_ACTIVE_CLASSNAME","AppSidebarRight","canHideFirst","isColumnProportionSet","toggleSidebar","setColumnProportion","createSharedMediaTab","replaceSharedMediaTab","previousTab","sharedMediaTab","historyTabIds","_selectTab","getFrom","setFrom","onCloseTab","isNavigation","willChange","animationPromise","appSidebarRight","AppEditContactTab","notificationsCheckboxField","profileNameDiv","profileSubtitleDiv","phoneRow","addContact","btnDelete","deleteContacts","AppChatTypeTab","privateRow","publicRow","privateSection","publicSection","linkRow","btnRevoke","getChatInviteLink","linkInputField","applyBtn","head","getValue","migrateChat","toggleNoForwards","onChatUpdate","noforwards","AppUserPermissionsTab","destroyListener","ChatPermissions","rights","banned_rights","editBanned","btnDeleteException","clearChannelParticipantBannedRights","kickFromChannel","exceptionText","toggleWith","defaultBannedRights","default_banned_rights","defaultRights","combineParticipantBannedRights","restrictionText","mainFlag","until_date","AppGroupPermissionsTab","chatPermissions","editChatDefaultBannedRights","addExceptionRow","openPermissions","getChannelParticipant","setSubtitle","bannedRights","cantWhat","listEl","setLength","exceptionsCount","loader","setLoader","getPromise","migrateFrom","migrateTo","AppChatReactionsTab","getActiveAvailableReactions","originalReactions","available_reactions","enabledReactions","toggleSection","toggleCheckboxField","toggleRow","reactionsSection","checkboxFields","saveReactionsDebounced","every","saveReactions","newReactions","getCachedFullChat","setChatAvailableReactions","AppEditChatTab","_init","chatUpdateListeners","addChatUpdateListener","canChangeType","canChangePermissions","chatNameInputField","descriptionInputField","chatTypeRow","setChatTypeSubtitle","setReactionsLength","availableReactionsLength","reactions","permissionsRow","setPermissionsLength","getChatTyped","editTitle","editAbout","signMessagesCheckboxField","signatures","toggleSignatures","showChatHistoryCheckboxField","togglePreHistoryHidden","hidden_prehistory","historiesStorage","AppSharedMediaTab","newCloseBtn","closeBtn","animatedCloseIcon","transitionContainer","transitionFirstItem","editBtn","transitionLastItem","secondTitle","setIsSharedMedia","isSharedMedia","onCloseBtnClick","toggleEditBtn","renderNewMessages","msgs","deleteDeletedMessages","btnAddMembers","showConfirmation","addChatUser","setLoadMutex","peerChanged","loadSidebarMedia","destroyable","SetTransition","raf","afterTimeout","SidebarSlider","closeTab","closingId","preserveTab","getTab","isTabExists","doNotAppend","SliderSuperTab","_constructor","SliderSuperTabEventable","SortedUserList","getIndex","getUserStatusForSort","onDelete","onListLengthChange","onUpdate","onSort","willChangeLength","onElementCreate","base","updateElementWith","updateListWith","createChatListOptions","doTimeout","updateList","SORT_INTERVAL","CLASS_NAME","StackedAvatars","avatarContainer","AVATAR_CLASS_NAME","hasViewer","attachStickerViewerListeners","findTarget","checkForParent","closest","mediaContainer","previousGroup","_middleware","previousTransformer","doThatSticker","lockGroups","isSwitching","effectThumb","mediaRect","boxSize","fitted","aspectFitted","transformer","stickerEmoji","transformX","transformY","needFadeIn","withThumb","relativeEffect","loopEffect","firstFramePromise","prevPlayer","ready","onMousePreMove","newMediaContainer","_previousTransformer","StickyIntersector","observeHeaders","observeElements","headersObserver","targetInfo","boundingClientRect","stickyTarget","rootBoundsInfo","rootBounds","threshold","elementsObserver","addSentinel","sentinel","headerSentinel","getEvent","attachGlobalListenerTo","RESET_GLOBAL","SwipeHandler","listenerOptions","hadMove","xDown","yDown","handleMove","setCursorTo","handleStart","xUp","yUp","onSwipeResult","setCursor","TelInputField","pasted","lastValue","telEl","HTMLInputElement","pixelRatio","devicePixelRatio","letterSpacing","originalFunc","formattedPhoneNumber","leftPattern","shiftKey","toastEl","hideToast","toastNew","langPackArguments","slideNavigation","prevTabContent","slideTabs","TransitionSlider","isHeavy","animationFunction","Transition","withAnimationListener","onTransitionEndCallbacks","animationDeferred","listenerName","onEndEvent","overrideFrom","onTransitionEndCallback","_from","isUsernameValid","UsernameInputField","checkUsernameDebounced","checkUsername","checkUsernamePromise","available","VisibilityIntersector","locked","change","refreshVisible","VolumeSelector","onMuteClick","setVolume","iconIndex","ICONS","wrapPhoto","withTail","noThumb","blurAfter","isWebDoc","isWebDocument","noAutoDownload","isFit","loadThumbPromise","isGif","renderOnLoad","renderMediaWithFadeIn","canAttachPreloader","haveToDownload","onlyCache","getDownloadPromise","roundVideoCircumference","wrapVideo","isAlbumItem","canAutoplay","spanTime","spanPlay","needPlayButton","photoRes","divRound","halfSize","strokeWidth","radius","strokeDashoffset","globalVideo","onPaused","onFrame","uploadFileName","renderDeferred","loadPhotoThumbFunc","wrapAlbum","attachmentDiv","uploading","wrapDocument","audioElement","extSplitted","ext","docDiv","icoDiv","icoTextEl","hadContext","hasThumb","performance","fileName","bytesContainer","descriptionParts","bytesMaxEl","sizeDiv","_downloadDiv","addByteProgress","sizeContainer","_bytesContainer","_d","save","canOpenAfter","downloadFileName","getDownloadMediaDetails","downloadId","apiFileManager","isDownloading","wrapGroupedDocuments","albumMustBeRenderedFull","messageDiv","nameContainer","getMidsByMid","getMessage","richText","AppPollResultsTab","resultsDiv","poll","appPollsManager","getPoll","quiz","question","voters","total_voters","roundPercents","answer","answers","answerEl","answerTitle","answerPercents","getVotes","option","votesList","votes","vote","user_id","down","lineTotalLength","minIndex","minRemainder","remainder","maxRemainder","pollElement","isClosed","closed","performResults","chosenIndexes","PollElement","setMaxLength","resizePolls","hideQuizHint","onHide","prevQuizHint","prevQuizHintOnHide","prevQuizHintTimeout","isListenerSet","isQuiz","isRetracted","isPublic","isMultiple","chosingIndexes","sentVote","MAX_LENGTH","MAX_OFFSET","svgLines","setLineProgress","descKey","public_voters","multiple_choice","multipleSelect","descDiv","typeDiv","avatarsDiv","close_period","close_date","timeLeftDiv","quizTimer","circumference","period","closeTime","quizInterval","timeLeft","stroke","getResults","answerDivs","numberDivs","footerDiv","viewResults","votersCountDiv","sendVoteBtn","sendVotes","canVote","setVotersCount","clickHandler","initQuizHint","solution","solution_entities","toggleHint","setQuizHint","correctResult","correct","chosen","answerIndex","foundIndex","indexes","sendVotePromise","sendVote","timeEl","recent_voters","stackedAvatars","isVoted","hideSendVoteBtn","hideViewResultsBtn","maxPercents","getPercentValue","iterate","fullTime","votersCount","wrapPoll","wrapReply","setColorPeerId","replyContainer","wrapStickerSetThumb","downloadOptions","getStickerSetThumbDownloadOptions","videos","animationData","needUpscale","wrapStickerToRow","previousMedia","_size","_limitSymbols","support","was_online","today","getDate","dateEl","wrapJoinVoiceChatAnchor","wrapUrl","call","wrapLinkToMessage","plain","savedFrom","dir","wrapMessageActionTextNew","unsafeMessage","getNameDivHTML","formatCallDuration","post","schedule_date","daysToStart","tomorrowDate","_args","day","pinnedMessage","reply_to_mid","fetchMessageReplyTo","htmlToSpan","joined","anchorHTML","domain","isRecurringInit","recurring_init","isRecurringUsed","recurring_used","paymentsWrapCurrencyAmount","total_amount","currency","invoiceMessage","reply_to","reply_to_peer_id","waited","wrapMessageActionTextNewUnsafe","wrapMessageForReply","usingMids","withoutMediaType","hasAlbumKey","addPart","part","usingFullAlbum","grouped_id","getMidsByMessage","albumText","getAlbumText","emoticon","game","actionWrapped","restriction_reason","exec","messageWrapped","noLinks","noTextFormat","wrapPeerTitle","wrapSenderToPeer","senderTitle","fromMe","wrapSentTime","STICKER_EFFECT_MULTIPLIER","locksUrls","wrapSticker","loadStickerMiddleware","exportLoad","skipRatio","asStatic","fullThumb","noPremium","isCustomEmoji","stickerType","emojiSticker","animatedSticker","staticSticker","isAnimated","getStickerEffectThumb","willHaveLock","lockUrl","toneIndex","isThumbNeededForType","lottieCachedThumb","getLottieCachedThumb","haveThumbCached","afterRender","num","getPathFromBytes","ns","getPreviewURLFromThumb","stickerThumbConverted","webpWorkerController","saveWebPConvertedStrippedThumb","getImageFromStrippedThumb","middlewareError","makeError","sync","setLockColor","dpr","skipx","skipy","imageData","sr","sg","sb","sa","outCanvas","outContext","computeLockColor","saveLottiePreview","onFirstFrame","preloadAnimatedEmojiStickerAnimation","isSingleVideo","mediaLength","lastPromise","_media","preloadSticker","playing","animationDiv","stickerPromise","side","attachStickerEffectHandler","onEmojiStickerClick","emojiData","sendInteractionThrottled","msg_id","getServerMessageId","interaction","JSON","stringify","getAnimatedEmojiSoundDocument","restart","getAnimatedEmojiSticker","withRandomOffset","wrapStickerAnimation","unmountAnimation","create","frameNo","maxFrame","vibrate","generateRandomSigned","randomOffsetX","randomOffsetY","setPosition","factor","stableOffsetX","stableOffsetY","rectX","rectY","addOffsetX","addOffsetY","wrapStickerEmoji","wrapWebPageDescription","webPage","shortDescriptionText","wrapWebPageTitle","shortTitle","site_name","EmojiVersions","Emoji","version","assign","FontFamily","FontSize","FontWeight","instances","getAnimationInstance","cancelAnimationByKey","instance","isCancelled","animateSingle","tick","createAnimationInstance","array","AudioAssetPlayer","assets","playSound","assetName","createAudio","playSoundIfDifferent","Audio","stopSound","cancelDelayedPlay","playSoundWithTimeout","heavyQueue","processingQueue","addHeavyTask","processHeavyQueue","todo","possiblePromise","process","realResult","timedChunk","requireBlurPromise","fastBlurFunc","processBlurNext","iterations","default","dataUri","JPEG_HEADER","bytesFromHex","JPEG_TAIL","isSticker","btoa","bytesToDataURL","imageW","imageH","boxW","boxH","noZoom","boxedImageW","boxedImageH","getTextWidth","measureText","mediaSize","quality","badCharsRe","trimRe","C2L","clearBadCharsAndTrim","latinize","processSearchText","clearBadChars","ignoreCase","hasTag","includeTag","charAt","originalText","ch","latinizeCh","latinizeString","fixCyrillic","copyTextToClipboard","clipboard","writeText","textArea","removeChild","fallbackCopyTextToClipboard","ContextMenuController","diffX","diffY","isOpened","openBtnMenu","months","days","ONE_DAY","getWeekNumber","UTC","getMonth","dayNum","getUTCDay","setUTCDate","getUTCDate","yearStart","getUTCFullYear","formatDateAccordingToTodayNew","weekday","formatFullSentTimeRaw","formatTime","capitalize","textTransform","formatFullSentTime","getFullDate","joiner","monthAsNumber","getHours","getMinutes","noSeconds","leadingZero","noTime","minYear","yearPattern","monthYearOrDayPattern","yearOrDayAndMonthPattern","shortDate","longDate","numberOfDaysEachMonth","fillTipDates","setFullYear","dayOfWeek","formatWeekLong","getDay","getDayOfWeek","setTime","g1","g2","createForDayMonth","createForMonthYear","selectedYear","currentYear","g3","validDateForMonth","formatterYearMax","k1","setMonth","formatterMonthYear","formatterDayMonth","_cancelContextMenuOpening","_cancelContextMenuOpeningTimeout","cancelContextMenuOpening","onCancel","onStart","onMove","isTouch","onTouchEnd","CLICK_EVENT_NAME","touchMouseDown","detachClickEvent","simulateClickEvent","ControlsHover","setHideTimeout","hideControlsTimeout","isShown","controlsLocked","toggleControls","relatedTarget","verifyFavoriteSticker","toAdd","favedStickers","some","_doc","findElement","filterButtons","attachListenerSetter","_element","initResult","createContextMenu","disablePictureInPicture","computedStyle","getProperty","simulateEvent","childNodes","node","tag","requestFullScreen","requestFullscreen","mozRequestFullScreen","webkitRequestFullscreen","msRequestFullscreen","cancelFullScreen","mozCancelFullScreen","webkitCancelFullScreen","msExitFullscreen","addFullScreenListener","addListener","eventName","getFullScreenElement","fullscreenElement","mozFullScreenElement","webkitFullscreenElement","msFullscreenElement","isFullScreen","markdownTags","entityName","underline","italic","monospace","strikethrough","mentionName","BLOCK_TAG_NAMES","getRichElementValue","lines","selNode","selOffset","follow","isBlock","alt","isTableCell","wasEntitiesLength","wasLength","field","withEntities","getViewportSlice","overflowRect","extraSize","invisibleTop","invisibleBottom","foundVisible","lookForSticky","overflowTop","overflowRight","overflowBottom","overflowLeft","sticky","windowWidth","windowHeight","handleHorizontalSwipe","cancelY","DocumentFragment","template","hasAttribute","isSendShortcutPressed","isComposing","secondaryKey","isSwipingBackSafari","TouchEvent","placeCaretAtEnd","ignoreTouchCheck","selectionStart","selectionEnd","collapse","createTextRange","textRange","moveToElementText","prevPos","backgroundImage","useCache","isImage","renderImageFromUrlPromise","DropdownHover","inited","ignoreMouseOut","displayTimeout","toElement","willBeActive","dispatchResultableEvent","attachButtonListener","onmouseout","onmouseover","setIgnoreMouseOut","ignore","FocusDirection","fastSmoothScroll","maxDistance","Static","scrollWithJs","getNormalSize","rectStartKey","rectEndKey","sizeKey","scrollSizeKey","scrollPositionKey","elementRect","elementPosition","elementSize","containerSize","scrollSize","fallbackToElementStartWhenCentering","remainingPath","absPath","startAt","shortTransition","longTransition","currentPath","distanceToEnd","FILENAME_JOINER","getFileNameByLocation","thumb_size","big","stickerset","short_name","thumb_version","volume_id","local_id","strictDecimals","_decimals","dm","fixed","pow","parseFloat","CALL_DURATION_LANG_KEYS","showLast","modulus","formatDuration","strings","prefixes","maxPrefixLength","setPrefix","originalStr","prefixCountry","patterns","searchForPattern","mostMatchedPatternMatches","mostMatchedPattern","_pattern","patternMatches","symbol","arcParameter","rx","ry","xAxisRotation","largeArcFlag","sweepFlag","tl","tr","bl","useBlur","ignoreCache","ListLoader","loadedAllDown","setLoaded","unsetCurrent","toPrevious","goUnsafe","leftLength","loadPromiseDown","loadPromiseUp","processedArr","processed","ListenerSetter","listeners","addManual","onceCallback","onceFired","_listener","MediaSize","aspect","aspectCovered","makeMediaSize","ScreenSize","MediaSizes","screenSizes","mobile","medium","large","handhelds","regular","album","esgSticker","documentName","invoice","customEmoji","esgCustomEmoji","desktop","isMobile","handleResize","innerWidth","activeScreen","wasScreen","rAF","middlewarePromise","throwWhat","numberThousandSplitter","HAVE_METADATA","useCanplayOnIos","OverlayClickHandler","withOverlay","amount","skipSymbol","isNegative","currencyData","amountExp","exp","number","dec_point","thousands_sep","n","isFinite","prec","sep","dec","toFixedFix","number_format","decimal_sep","space_between","symbol_left","splitter","additionalPadding","getScrollWidthFromElement","menuWidth","menuHeight","paddingTop","paddingRight","paddingBottom","paddingLeft","verticalSide","maxTop","maxLeft","minLeft","intermediateX","intermediateY","possibleSides","platforms","getRestrictionReason","reasons","reason","savingLottiePreview","isSavingLottiePreview","saving","throttleWithRaf","fn","schedulerFn","waiting","throttleWith","ScrollableLoader","SearchListLoader","messageId","generateMessageId","filterMids","onHistoryDelete","shouldBeDeleted","onHistoryMultiappend","onMessageSent","isInner","otherSideLoader","filterMessagesByInputFilterFromStorage","goToOtherEnd","do","kind","scheduleFlush","measure","mutate","mutateElement","read","write","pushDocumentSize","_isWebDocument","replies","comments","channel_id","SortedList","_updateList","canUpdate","getAll","updateBatch","noScheduler","encodeEntities","charCodeAt","limitFrom","leadZero","sec_num","hours","minutes","seconds","visualViewport","innerHeight","ANIMATION_START_EVENT","ANIMATION_END_EVENT","isAnimating","heavyAnimationPromise","promisesInQueue","dispatchHeavyAnimationEvent","perf","_heavyAnimationPromise","onHeavyAnimationEnd","interruptHeavyAnimation","getHeavyAnimationPromise","handleAnimationStart","handleAnimationEnd","DialogsContextMenu","onArchiveClick","selectedId","editPeerFolders","folder_id","onPinClick","toggleDialogPin","config","getConfig","pinned_dialogs_count_max","onUnmuteClick","onUnreadClick","unread_count","readHistory","top_message","markDialogUnread","onContextMenu","getDeleteButtonText","isDialogUnread","pinned","ConnectionStatusComponent","hadConnect","connecting","timedOut","updating","setConnectionStatus","baseDcId","connectionStatus","setFirstConnectionTimeout","online","apiUpdatesManager","forceGetDifference","retryAt","setStatusText","currentLangPackKey","statusEl","statusPreloader","singleInstance","CHANGE_STATE_DELAY","getA","networkerFactory","forceReconnect","timerSpan","interval","forceReconnectTimeout","setStateTimeout","statusContainer","SENDING_STATUS","easeInOutSine","easeInOutSineApply","roundRect","defaultRadius","beginPath","moveTo","lineTo","quadraticCurveTo","closePath","DPR","SIZE","MARGIN","WIDTH","RADIUS","Shimmer","currTime","diffTime","spread","pausedTime","pauseInterval","lightSource","lightSpread","currentAnimationIndex","keepTime","cycleAnimation","currentAnimation","animateGlow","animateSlide","smartInc","lightLeft","lightRight","lightCenter","createLinearGradient","customProperties","shimmerColor","addColorStop","dict","on","fillText","DialogsPlaceholder","onThemeChange","stopAnimation","startAnimation","onResize","updateCanvasSize","shimmer","generatedValues","marginVertical","lineBorderRadius","lineMarginVertical","statusWidth","getRectFrom","onRemove","blockScrollable","overflowY","availableLength","detachTime","renderDetachAnimationFrame","globalCompositeOperation","completed","elapsedRowTime","dialogHeight","renderFrame","createPattern","patternCanvas","patternContext","drawChat","firstLineWidth","secondLineWidth","marginLeft","arc","drawCircle","drawCircleFromStart","setPromiseMiddleware","oldPromise","SortedDialogList","indexKey","getDialogIndex","addListDialog","isBatch","AppDialogsManager","Log","placeholders","sortedLists","scrollables","folders","menuScrollContainer","lastActiveElements","offsets","initedListeners","loadedDialogsAtLeastOnce","onTabChange","loadDialogsRenderPromise","loadDialogsPromise","onChatsScroll","_onListLengthChange","checkIfPlaceholderNeeded","hasContacts","removeContactsPlaceholder","updateContactsLength","dialogSize","loadContacts","verifyPeerIdForContacts","processContact","setListClickListener","onChatsRegularScroll","sliceTimeout","scrollTopWas","rectContainer","rectTarget","firstY","lastY","firstElement","elementFromPoint","lastElement","elementOverflow","sliceFromStart","sliceFromEnd","deleteDialog","setOffsets","onChatsScrollTop","loadDialogs","getProxiedManagers","contextMenu","bottomPart","allChatsIntlElement","isFilterIdAvailable","clearCurrent","onStateLoaded","setFilterId","addFilter","foldersScrollable","_id","filtersNavigationItem","setFilterIdAndChangeTab","changeFiltersAllChatsKey","groupCallsController","callsController","getDialogIndexKey","getDialogIndexKeyByFilterId","setOnlineStatus","hasClassName","initListeners","getDialogDom","isBot","processDialogForCallStatus","setFilterUnreadCount","setLastMessageN","setUnread","validateDialogForFilter","setFiltersUnreadCount","updateDialog","setUnreadMessagesN","drop","setDialogActive","getCachedDialogs","validateListForFilter","onFiltersLengthChange","containerToAppend","renderedFilter","typings","unsetTyping","dialogDom","callIcon","filtersArr","haveFilters","addFilters","addFiltersPromise","doNotRenderChatList","showFiltersPromise","getNotifyPeerTypeSettings","fillConversations","getOffsetIndex","isDialogMustBeInViewport","migratedTo","testDialogForFilter","topOffset","bottomOffset","unreadSpan","unread","unreadUnmutedCount","unreadCount","getFolderUnreadCount","generateScrollable","sortedDialogList","createChatList","wasShowing","cachedInfoPromise","currentOffsetIndex","needIndex","getConversationsResult","isTopEnd","callbacks","cccc","offsetDialog","generateEmptyPlaceholder","classNameType","subtitleArgs","placeholderContainer","needPlaceholder","emptyDialogsPlaceholderSubtitle","usersLength","placeholderType","updatePartClassName","updateContactsLengthPromise","firstDialog","getDialogFromElement","lastDialog","withContext","openInner","lastActiveListElement","setPeerFunc","sameElement","getDialogByPeerId","setLastMessage","draftMessage","draft","topMessage","lastTimeSpan","isMessageRestricted","willPrepend","videoTypes","playIcon","senderBold","setUnreadMessages","wasMuted","setStatusMessage","isPinned","hasUnreadBadge","transitionDuration","disableAnimationIfRippleFound","iconClassName","setSendingStatus","statusSpan","isUnreadBadgeMounted","unreadBadge","hasMentionsBadge","unread_mentions_count","isMentionBadgeMounted","mentionsBadge","isUnread","isMention","getDialog","originalDialog","getOutputPeer","setCallStatus","START_X","wasMounted","itemProgress","groupCallActiveIcon","addDialogNew","call_active","call_not_empty","addDialogAndSetLastMessage","getMessageSenderPeerIdOrName","addDialog","captionDiv","titleSpanContainer","peerTitlePromise","titleP","rightSpan","oldTypingElement","newTypingElement","downloads","getNewDeferred","cancelDownload","clearDownload","getNewDeferredForUpload","getUpload","getDownload","getUploadPromise","getDownloadFileNameFromOptions","downloadMedia","promiseBefore","downloadMediaURL","downloadMediaVoid","getFileNameForUpload","downloadToDisc","justAttach","pingPromise","iframe","hadProgress","getDocumentDownloadOptions","getPhotoDownloadOptions","clickEvent","createEvent","initMouseEvent","createDownloadAnchor","BubbleGroup","createAvatar","avatarLoadPromise","fwdFrom","fwdFromId","isForwardFromChannel","from_id","currentPeerId","firstTimestamp","firstItem","firstMid","lastTimestamp","lastItem","lastMid","updateClassNames","insertItem","insertInDescendSortedArray","sortGroupItemsKey","insertGroup","mount","onItemUnmount","mountItem","onItemMount","unmountItem","dateContainer","getDateContainerByTimestamp","dateGroups","_group","dateGroupsLength","unmountedLength","STICKY_OFFSET","deleteEmptyDateGroups","BubbleGroups","itemsArr","itemsMap","newGroupDiff","sortItemsKey","sortGroupsKey","removeItemFromCache","removeAndUnmountBubble","getItemByBubble","siblings","getSiblingsAtIndex","modifiedGroups","previousSibling","canItemsBeGrouped","groupUngrouped","mountUnmountGroups","toMount","toUnmount","bad","partition","getLastGroup","changeBubbleMid","insertItemToArray","changeItemBubble","changeBubbleByBubble","item1","item2","itemIndex","findGroupSiblingByItem","findGroupSiblingInItems","previousItem","siblingGroupedItem","nextItem","addItemToGroup","addItemToCache","getMessageFromId","viaBotId","createItem","SERVICE_AS_REGULAR","getDateForDateContainer","groupMid","splitSiblingsOnGrouping","prepareForGrouping","hadGroup","foundItem","splittedGroups","PopupDatePicker","initDate","onPick","noButtons","selectedDate","selectedMonth","minMonth","prevBtn","maxMonth","onDateClick","selectedEl","setTimeTitle","controlsDiv","monthTitle","monthsContainer","handleTimeInput","onOverflow","maxString","hoursInputField","minutesInputField","setMinutes","popupCenterer","timeOptions","sendDate","dateOptions","renderElement","firstDate","weekStartDate","dayIndex","clonedDate","showOverflowMonths","ReactionElement","reactionCount","_reactionCount","setCanRenderAvatars","canRenderAvatars","doNotRenderSticker","hadStickerContainer","getReaction","callbackify","center_icon","wrapPromise","wrapStickerPromise","renderCounter","displayOn","renderAvatars","recentReactions","peer_id","setIsChosen","isChosen","fireAroundAnimation","REACTION_INLINE_SIZE","REACTION_BLOCK_SIZE","around_animation","iconPlayer","aroundPlayer","removeOnFrame","REACTIONS_ELEMENTS","ReactionsElement","onConnectCallback","getReactionCount","reactionElement","isPlaceholder","changeMessage","changedResults","hasReactions","availableReactionsResult","isReactionActive","totalReactions","can_see_list","reactionElementIdx","recent_reactions","handleChangedResults","timeSpan","RepliesElement","updated","postKey","leftPart","recent_repliers","read_max_id","max_id","textSpan","iconSpan","rippleContainer","subscribeRepliesThread","updateMessage","makeEdited","edited","makeSponsored","MessageRender","chatType","editedSpan","sponsoredSpan","reactionsElement","reactionsMessage","isSponsored","sponsored","isMessage","views","postAuthor","post_author","postViewsSpan","channelViews","edit_date","edit_hide","clonedArgs","_reactionsElement","renderReplies","bubbleContainer","isFooter","repliesFooter","setReply","isReplacing","currentReplyDiv","replyToPeerId","originalMessage","originalPeerTitle","titlePeerId","originalMessageFwdFromId","needUpdate","replyMid","getElementByPoint","horizontalSide","reflowScrollableElement","SEND_WHEN_ONLINE_TIMESTAMP","INTERNAL_LINK_TYPE","PopupJoinChatInvite","chatInvite","request_needed","importChatInvite","savePhoto","peopleCount","ScrollSaver","getSaved","findElements","replaceSaved","findAndSetElements","_save","scrollHeightMinusTop","onRestore","useReflow","setScrollTop","newScrollTop","restore","_restore","previousScrollHeightMinusTop","SuperIntersectionObserver","observing","observingQueue","freezedObservingNew","toggleObservingNew","isMentionUnread","mentioned","stringResults","numberResults","replaceNonNumber","CARD_BRAND_REGEXP","visa","mastercard","amex","discover","diners","diners14","jcb","unionpay","elo","mir","CARD_BRANDS","minLength","cvcMaxLength","cvcMinLength","unknown","detectCardBrand","card","sanitizedCard","brand","detectUnifiedCardBrand","createArray","delta","buggedRegExp","getDistanceFromBuggedToNormal","char","fixBuggedNumbers","makeOptionalCharacter","consumed","makeRequiredCharacter","partial","wrapCharacterRegExpFactory","optional","_regExp","source","makeCharacter","makeMonthDigitPatternCharacter","digit","capitalCharacter","cleanedResult","formattingCharacter","str1","makeFormattingCharacter","optionalPattern","spaceCharacter","yearOptionalPattern","sixteenPattern","fifteenPattern","requiredPostcodes","generateFourPattern","cardFormattingPatterns","cardNumber","cardExpiry","cardCvc","cardCvcFromBrand","postalCodeFromCountry","optionalDigits","accumulateLengths","strs","nbspRegExp","makeValidationError","validateCardNumber","sanitized","getCardInfoByNumber","ignoreIncomplete","validateCompleteCardNumber","makeCardNumberError","validateCardExpiry","monthStr","yearStr","_year","nextMonth","isNaN","validateExpiry","createVerificationIframe","allow","contentWindow","parse","PopupPaymentVerification","eventType","eventData","path_full","InputFieldCorrected","lastKeyDown","deleting","lastTransformed","getPattern","pushRest","autocorrectComplete","character","getCharacter","meta","formatInputValueByPattern","formatMethod","transformedValue","validateNew","onBlur","justReturn","validateMethod","validateAnyIncomplete","errorKeys","handleInputFieldsOnChange","_onChange","createCountryZipFields","zip","countryInputField","postcodeInputField","SUPPORTED_NATIVE_PROVIDERS","PopupPaymentCard","paymentForm","savedCard","native_provider","cardOut","token","credentials","can_save_credentials","cardSection","nativeParams","native_params","lastBrand","lastBrandImg","brandIconTempId","cardInputField","invalid","incomplete","transformed","getPaymentBrandIconPath","setBrandIcon","cvcInputField","need_cardholder_name","expireInputField","switchFocusOrder","previousInputField","nextInputField","inputFieldsRow","billingSection","need_country","need_zip","canSave","saveCheckboxField","saveRow","payButton","PaymentButton","expiryFull","expiryMonth","expiryYear","cvc","cardholderName","nativeProvider","URLSearchParams","headers","publishable_key","expiration_month","expiration_year","security_code","public_token","PopupPaymentCardConfirmation","inputCheckPassword","getInputCheckPassword","tmpPassword","password","handled","PopupPaymentShipping","inputInvoice","savedInfo","saved_info","addressSection","address1InputField","address2InputField","cityInputField","stateInputField","receiverSection","emailInputField","shipping_address_requested","name_requested","email_requested","phone_requested","validateEmail","validatePhone","selectedCountry","shipping_address","street_line1","street_line2","city","country_iso2","post_code","requestedInfo","validateRequestedInfo","shippingAddress","ADDRESS_STREET_LINE1_INVALID","ADDRESS_STREET_LINE2_INVALID","ADDRESS_COUNTRY_INVALID","ADDRESS_CITY_INVALID","ADDRESS_STATE_INVALID","ADDRESS_POSTCODE_INVALID","REQ_INFO_NAME_INVALID","REQ_INFO_EMAIL_INVALID","REQ_INFO_PHONE_INVALID","focusField","PopupPaymentShippingMethods","shippingOption","shipping_options","prices","lastShippingId","PopupPayment","tipButtonsMap","confirmed","onConfirmed","popupPaymentVerification","mediaInvoice","isReceipt","receipt_msg_id","isTest","itemEl","detailsClassName","photoEl","linesClassName","linesEl","botName","preloaderContainer","getPaymentReceipt","getPaymentForm","savedCredentials","saved_credentials","lastRequestedInfo","providerPeerTitle","provider_id","bot_id","wrapAmount","isRecurring","recurring","peerTitle2","makeLabel","pricesClassName","makePricesElements","price","_label","wrappedAmount","pricesElements","getTipsAmount","shippingAmount","setTotal","totalAmount","totalLabel","payI18n","canTip","max_tip_amount","tip_amount","tipsClassName","getInputValue","setInputWidth","setInputValue","unsetActiveTip","tipEl","tipsLabel","haveToIgnoreEvents","onSelectionChange","ignoreNextSelectionChange","onFocusOut","tipsEl","tipClassName","tipButtons","suggested_tip_amounts","tipAmount","prevTipEl","setRowIcon","createRow","setRowTitle","setCardSubtitle","methodRow","onMethodClick","previousCardDetails","previousToken","credentials_title","providerRow","providerAvatar","shippingAddressRow","shippingNameRow","shippingEmailRow","shippingPhoneRow","shippingMethodRow","lastShippingOption","onShippingAddressClick","onShippingMethodClick","setShippingTitle","postAddress","setShippingInfo","setShippingOption","scrollSaver","lastShippingPricesElements","shipping","acceptTermsCheckboxField","recurring_terms_url","acceptTermsRow","recurringElements","lastTmpPasword","missingInfo","tmp_password","paymentResult","sendPaymentForm","form_id","_passwordState","valid_until","tsNow","IGNORE_ACTIONS","TEST_SCROLL_TIMES","TEST_SCROLL","PEER_CHANGED_ERROR","getMainMidForGrouped","ChatBubbles","unreadOut","bubblesNewByGroupedId","bubblesNew","dateMessages","scrolledDown","isScrollingTimeout","unreaded","unreadedSeen","messagesQueuePromise","messagesQueue","messagesQueueOnRenderAdditional","firstUnreadBubble","replyFollowHistory","isFirstLoad","passEntities","viewsMids","isTopPaddingSet","renderingMessages","bubblesToEject","bubblesToReplace","setPeerTempId","renderNewPromises","unreadedObserverCallback","onUnreadedInViewport","viewsObserverCallback","sendViewCountersDebounced","sponsoredMessage","random_id","viewSponsoredMessage","stickerEffectObserverCallback","onBubblesMouseMove","unhoverPrevious","hoverBubble","hoverReaction","setHoverVisible","stickerWrapper","getGroupsFirstMessage","getMiddleware","getAvailableReactionsByMessage","select_animation","CHAT_ANIMATION_GROUP","sendReaction","onBubblesClick","setInnerPeer","chatInner","onDatePick","contactDiv","callDiv","callUser","getInputInvoiceByPeerId","stickerEmojiEl","bubbleMid","reply_to_top_id","saved_from_msg_id","openThread","message1","getMessageWithReplies","getDiscussionMessage","via","setDraft","peerIdStr","documentDiv","groupedItem","SINGLE_MEDIA_CLASSNAME","isSingleMedia","parents","hasAspecter","albumItem","isReplyClick","replyToMid","reply_to_msg_id","ignoreHeavyAnimation","scrollDimensions","forceDown","sliceViewportDebounced","setCorrectIndexThrottled","setStickyDateManually","setPeerPromise","requestHistory","setMessageId","constructBubbles","bubbleGroups","sequential","messagesStorageKey","newItem","_items","groupBubbles","scrollingToBubble","scrollToEnd","deleteMessagesByIds","tempMessage","_bubble","groupedId","getMessagesByAlbum","reactionsElements","repliesElement","newDiv","safeRenderMessage","scrollToBubbleIfLast","deletedMids","wasMainMid","mainMid","createScrollSaver","appendReactionsElementToBubble","dateMessage","dateBubble","previousStickyDate","sliceViewport","setScroll","attachContainerListeners","highlightBubble","replyAfter","shouldReply","canSend","_target","initMessageReply","constructPeerHelpers","updateGradient","renderNewMessage","setUnreadCount","updateUnreadByDialog","finishPeerChange","postViewsElements","different","postViews","incrementMessageViews","createResizeObserver","resizeObserver","wasHeight","skip","scrolled","onResizeEnd","setEndRAF","ResizeObserver","contentRect","realDiff","_part","needScrollTop","destroyResizeObserver","setReactionsHoverListeners","getRenderedLength","readUnreaded","readPromise","idleController","bubblesMaxId","getHistoryMaxId","readContents","constructPinnedHelpers","constructScheduledHelpers","getScheduledMessagesStorage","onGoDownClick","getBubbleByPoint","getGroupedBubble","groupId","getMidsByAlbum","findNextMountedBubbleByMsgId","filterCallback","_mid","foundMid","loadMoreHistory","getHistoryTopPromise","getHistoryBottomPromise","getHistory1","destroyScrollable","getHistoryStorage","readMaxId","readOutboxMaxId","msgId","permanent","ignoreOnScroll","emptyPlaceholderBubble","setTopPadding","setPaddingTo","isPaddingNeeded","unsetPadding","_renderNewMessage","newMessage","replyTo","getLastBubble","performHistoryResult","scrollToBubbleEnd","scrollToBubble","isChangingHeight","messageInput","dimensions","datasetKey","createDateBubble","bubbleContent","serviceMsg","fakeBubble","bubblesToo","cleanupPlaceholders","attachedUnreadBubble","fetchNewPromise","getSponsoredMessagePromise","onAnimateLadder","resolveLadderAnimation","attachPlaceholderOnRender","samePeer","startParam","bindPrefix","onChangePeer","getPinnedMessagesMaxId","isTarget","followingUnread","savedPosition","overrideAdditionMsgId","getChatSavedPosition","getReadMaxIdIfUnread","foundSlice","findSliceOffset","isJump","isStartButtonNeeded","setStartParam","setQueueId","messageEntityBotCommand","additionMsgId","maxBubbleId","oldChatInner","oldPlaceholderBubble","haveToScrollToBubble","fromUp","scrollFromDown","scrollFromUp","willScrollOnLoad","setPeerOptions","waitPromise","setPeerCached","mountedByLastMsgId","setCorrectIndex","lastBubble","onRenderScrollSet","afterSetPromise","setFetchReactionsInterval","setFetchHistoryInterval","onScrolledAllDown","unread_mark","fetchReactions","getMessagesReactions","needFetchInterval","isFetchIntervalNeeded","getNewHistory","isBottomEnd","historyMaxId","canWrite","renderMessagesQueue","setMessagesQueuePromise","possibleError","renderQueue","renderQueuePromises","loadQueue","filterQueue","avatarPromises","updatePosition","timePromises","groupCollapsed","groupEnd","setUnreadDelimiter","restoreScroll","prepareToSaveScroll","ejectBubbles","oldBubble","local","updatePlaceholderPosition","isAvatarNeeded","additionalCallback","processResult","newBubble","originalPromise","renderMessage","albumMids","albumMessages","our","isOurMessage","contentWrapper","isInUnread","chat_id","is_single","messageMessage","bigEmojis","emojiEntities","strLength","curr","canHaveTail","isStandaloneMedia","needToSetHTML","replyMarkup","reply_markup","containerDiv","rowDiv","buttonEl","botId","same_peer","checkSwitchReturn","switchInlineQuery","column","callbackButtonClick","callbackAnswer","messageWithReplies","getMessageWithCommentReplies","withReplies","isOutMessage","canHideNameIfMedia","processingWebPage","quote","previewResizer","preview","quoteTextDiv","strong","textDiv","isSquare","isEmoji","nopremium","newNameContainer","lastContainer","contact","contactDetails","contactNameDiv","contactNumberDiv","phone_number","priceEl","needName","titleVia","isHidden","goto","generateTail","documentContainer","documentMessageDiv","viewportSlice","deleteViewportSlice","historyResult","needReflowScroll","setLoadedPromises","firstSlice","lastSlice","both","processLocalMessageRender","getHistory","ackedResult","getScheduledMessages","animateAsLadder","additionMsgIds","isAdditionRender","targetMid","sortedMids","topIds","middleIds","bottomIds","setBubbles","lastMsDelay","elementsToAnimate","transitionDelay","topRes","middleRes","bottomRes","delays","renderEmptyPlaceholder","listElements","getRestrictionReasonText","getGreetingSticker","channel_post","start_param","chat_invite","chat_invite_hash","JOIN_CHAT","invite","processInternalLink","creator","isWaitingForAnimation","noTransition","setOn","generateLocalMessageId","addOffset","generateLocalFirstMessage","service","saveMessages","ignoreScrollSaving","invisible","checkPlaceholders","toggleSponsoredMessage","renderBotPlaceholder","checkIfEmptyPlaceholderNeeded","_log","getSponsoredMessage","sponsoredMessages","messagePromise","processPromise","bot_info","botInfo","description_document","description_photo","isBackLimit","resultPromise","isFirstMessageRender","serviceStartMessageId","getThreadServiceMessageId","sup","_promise","mustBeCount","PopupPinMessage","unpin","canUnpin","canPinMessage","oneSide","unpinAllMessages","hidePinnedMessages","updatePinnedMessage","buttonText","getPinnedMessagesCount","pinButtonText","isSelectionEmpty","selectionRange","START_TO_END","preloadAnimatedEmojiSticker","PopupReportMessagesConfirm","reportMessages","STICKER_EMOJI","PopupReportMessages","preloadStickerPromise","marginTop","PopupSponsored","PopupReactedList","canViewReadParticipants","canViewMessageReadParticipants","loaders","hasAllReactions","createFakeReaction","hasReadParticipants","readUserIds","getMessageReadParticipants","chatlist","skipReadParticipants","skipReactionsList","getMessageReactionsListAndReadParticipants","combined","getReactionCached","allReactionsSticker","REACTION_CLASS_NAME","REACTIONS_CLASS_NAME","CAN_USE_TRANSFORM","ChatReactionsMenu","reactionsMap","players","onScrollProcessItem","reactionDiv","appear","widthContainer","reactionsContainer","reactionsScrollable","renderReaction","setVisible","canUseAnimations","scaleContainer","appearWrapper","appear_animation","selectLoadPromise","selectPlayer","REACTION_SIZE","ChatContextMenu","isSelectable","isTextSelected","isAnchorTarget","isUsernameTarget","selectedMid","isOverBubble","isTargetAGroupedItem","noForwards","viewerPeerId","canOpenReactedList","menuPadding","reactionsMenu","reactionsMenuPosition","isReactionsMenuVisible","offsetSize","nextVisiblePart","MIN_NEXT_VISIBLE_PART","minSize","onSendScheduledClick","onReplyClick","onFaveStickerClick","unfave","faveSticker","onEditClick","initMessageEditing","onCopyClick","onCopyAnchorLinkClick","onCopyLinkClick","threadMessage","onUnpinClick","onRetractVote","onStopPoll","stopPoll","setButtons","notDirect","scheduleSending","editMessage","scheduleDate","canEditMessage","getMessageFromStorage","hasTarget","isGoodType","localName","emojiInputsPromise","viewsButton","isViewingReactions","participantsCount","reactedLength","i18nElem","fakeText","AVATAR_SIZE","MAX_AVATARS","PADDING_PER_AVATAR","reactionsCount","fakeElem","readParticipants","totalSize","emojisButton","setPadding","docIds","filterUnique","inputsPromise","getCachedCustomEmojiDocuments","getCustomEmojiDocuments","SendMenu","sendMenuButtons","onSilentClick","onScheduleClick","sendMenu","openSide","onContextElement","setPeerId","PopupCreatePoll","onSubmitClick","send","radioLabel","isEmpty","questions","appendMoreField","correctAnswers","optionInputFields","questionInputField","sendSilent","dd","settingsCaption","anonymousCheckboxField","multipleCheckboxField","quizCheckboxField","quizSolutionField","quizElements","quizSolutionCaption","quizHr","quizSolutionContainer","quizSolutionSubtitle","getFilledAnswers","quizSolution","force","quizSolutionEntities","inputMediaPoll","getInputMediaPoll","sendOther","getMessageSendingParams","helperType","clearHelper","questionField","createPosterFromMedia","getGifDuration","arrayBuffer","currentPopup","getCurrentNewMediaPopup","PopupNewMedia","willAttachType","attachFile","willAttach","shouldCompress","itemDiv","attachMedia","attachDocument","sendFileDetails","captionLengthMax","caption_length_max","wasInputValue","messageInputField","attachFiles","appendDrops","appendGroupCheckboxField","groupCheckboxField","mediaCheckboxField","appendMediaCheckboxField","addFiles","toPush","_file","lastModified","isMedia","sendingParams","sendText","sendAlbum","replyToMsgId","startsWith","objectURL","audioDecodedByteCount","webkitAudioDecodedByteCount","noSound","onseeked","onerror","createPosterFromVideo","isPhoto","isAudio","finish","onRender","foundPhotos","foundVideos","foundFiles","appendMediaToContainer","firstType","albumContainer","HANDLE_EVENT","ACTIVE_CLASS_NAME","AXIS_Y_KEYS","AXIS_X_KEYS","attachListNavigation","waitForKey","waitForKeySet","keyNames","getCurrentTarget","setCurrentTarget","scrollTo","hadTarget","getNextTargetX","currentTarget","isNext","nextTarget","handleArrowKey","property","endProperty","currentRect","targetRect","getNextTargetY","fireSelect","canContinue","attached","resetTarget","_onKeyDown","AutocompleteHelper","onVisible","listType","attachNavigation","controller","addHelper","toggleListNavigation","fromController","skipAnimation","hideOtherHelpers","StickersHelper","onChangeScreen","checkEmoticon","getStickersByEmoticon","getMinDate","getMaxDate","PopupSchedule","canSendWhenOnline","btnSendWhenOnline","getRichValueWithCaret","startOffset","startContainer","endContainer","endOffset","possibleChildrenFocusOffset","caretPos","combineSameEntities","EmojiHelper","chatInput","onEmojiSelected","checkQuery","firstChar","getBothEmojiKeywords","searchEmojis","AutocompletePeerHelper","doNotShow","listElement","BASE","BASE_CLASS_LIST_ELEMENT","processPeerFullForCommands","botInfos","commands","command","indexObject","CommandsHelper","getReadyToSend","sendMessage","AutocompleteHelperController","helpers","preserveHelper","MentionsHelper","insertAtCaret","topMsgId","trimmed","getMentions","ReplyKeyboard","onBodyTouchStart","btnHover","checkAvailability","checkForceReply","touchListener","sendContact","getReplyMarkup","getHistoryStorageTransferable","InlineHelper","queryId","queryAndResultIds","generateQId","resultId","sendInlineResult","_checkQuery","botResults","query_id","gifsMasonry","isGallery","gallery","noCommands","separator","dcId","dataURL","switch_pm","btnSwitchToPM","switchToPM","ChatBotCommands","setUserId","modifyAckedResult","acked","modifyAckedPromise","ChatSendAs","sendAsButtons","previousAvatar","onSendAsMenuToggle","updateButtons","sendAsPeerId","changeSendAsPeerId","executeButtonsUpdate","sendAsPeerIds","saveDefaultSendAs","updateAvatar","getDefaultSendAs","getChannelFull","channelFull","default_send_as","updateManual","updatingPromise","wasSkippingAnimation","auto","getSendAs","addedListener","InputFieldAnimated","inputFake","onFakeInput","setHeight","currentHeight","POSTING_MEDIA_NOT_ALLOWED","ChatInput","lastUrl","lastTimeType","replyElements","willSendWebPage","recordCanceled","recordStartTime","lockRedo","canRedoFromHTML","undoHistory","executedHistory","canUndoFromHTML","onCancelRecordClick","recorder","opusDecodeController","onEmoticonsOpen","toggleClass","btnToggleEmoticons","onEmoticonsClose","isUserOnlineVisible","openScheduled","prepareDocumentExecute","undoRedo","needHTML","sameHTMLTimes","currentHTML","handleMarkdownShortcut","formatKeys","markupTooltip","applyMarkdown","showLinkEditor","onMessageInput","markdownEntities","parseMarkdown","urlEntities","getWebPagePromise","appWebPagesManager","getWebPage","setTopInfo","noWebPage","onHelperCancel","helperFunc","botCommands","resetCurrentFontFormatting","updateBotCommandsToggle","editMsgId","saveDraftDebounced","checkAutocomplete","updateSendBtn","onBtnSendClick","forwarding","restricted","voice_messages_forbidden","releaseMediaPlayback","setRecording","showDiscardPopup","btnCancelRecord","recordingOverlayListener","recordingNavigationItem","sourceNode","analyser","createAnalyser","connect","fftSize","frequencyData","frequencyBinCount","getByteFrequencyData","recordRippleEl","ms","recordTimeEl","needReturn","onHelperClick","forwardElements","rowsWrapperWrapper","rowsWrapper","fakeRowsWrapper","fakeSelectionWrapper","goDownBtn","controlContainer","iconBtn","cancelBtn","onHideAuthorClick","isChangingAuthor","canToggleHideAuthor","onHideCaptionClick","forwardButtons","hideSender","showCaption","hideCaption","changePeer","changeForwardRecipient","forwardBtnMenu","forwardWasDroppingAuthor","replyTitle","forwardHover","modifyArgs","newMessageWrapper","inputMessageContainer","goDownUnreadBadge","goMentionBtn","goMentionUnreadBadge","goToNextMention","btnScheduled","btnToggleReplyMarkup","replyKeyboard","botCommandsToggle","scaler","botCommandsIcon","attachMenuButtons","fileInput","attachMenu","multiple","autocompleteHelperController","stickersHelper","emojiHelper","commandsHelper","mentionsHelper","inlineHelper","btnSendContainer","btnSend","attachMessageInputField","previousQuery","saveDraft","encoderSampleRate","monitorGain","numberOfChannels","recordingGain","reuseWorker","onstop","ondataavailable","typedArray","dataBlob","Blob","sendFile","isVoiceMessage","botStartBtn","toggleBotStartBtnDisability","startBot","pinnedControlBtn","originalChat","pinnedMessageContainer","_center","neededFakeContainer","fakeWrapperTo","oldFakeWrapperTo","fakeSelectionRect","fakeRowsRect","scale","initTranslateX","getNeededFakeContainer","hasMentions","no_webpage","syncDraft","helperToo","clearInput","fromUpdate","getDraft","wrappedDraft","myEntities","apiEntities","wrapDraft","createSendAs","firstChange","sendAs","updateOffset","getPlaceholderKey","updateMessageInputPlaceholder","previousSendAs","ackedPeerFull","ackedScheduledMids","setSendAsCallback","filteredAttachMenuButtons","filterAttachMenuButtons","placeholderKey","hasBotCommands","updateBotCommands","updateMessageInput","isAnonymousSending","oldInputField","attachMessageInputListeners","fixSafariStickyInputFocusing","setStart","readAllHistory","commandsMap","saveExecuted","executed","checkType","haveThisType","isCollapsed","commonAncestorContainer","resetCurrentFormatting","setActiveMarkupButton","insertText","insertEntity","isHelper","fullValue","suffix","AUTO_COMPLETE_REG_EXP","matchIndex","newValue","hadEntities","insertLength","addEntities","caretEntity","insertCaretAtIndex","caret","originalNode","newNode","createTextNode","setStartAfter","insertNode","setCaretAt","foundHelper","checkInlineAutocomplete","inlineMatch","btnPreloader","bot_inline_placeholder","inlinePlaceholder","helperWaitingForward","canSetDraft","fireEvent","clearValue","fixSafariStickyInput","clearReply","unicode","pushRecentEmoji","forwardMessages","dropAuthor","dropCaptions","isDroppingCaptions","sendMessageWithDocument","hideCaptionCheckboxField","replyFragment","initMessagesForward","fromPeerIdsMids","fromPeerIds","smth","messagesWithCaptionsLength","peerTitles","titleKey","senderTitles","firstMessage","newReply","intl","peerTitleEl","wrapSingleMessage","_message","callerFunc","replyParent","oldReply","haveReply","CLASSNAME_BASE","PinnedContainer","floating","divAndCaption","wrapperUtils","attachOnCloseEvent","needClose","isFloating","setFloating","setUtilsWidth","BAR_HEIGHTS","ChatAudio","onPlaybackParams","fasterEl","repeatEl","toggleEl","onStop","onMediaPlay","isMusic","prevEl","nextEl","attachClick","volumeProgressLineContainer","tunnel","progressWrapper","playingDetails","PinnedMessageBorder","drawRect","getClipPath","barHeight","GAP","clipPath","getBarHeight","ONE","TWO","THREE","FOUR","MORE","getMarkHeight","markHeight","getMarkTranslateY","getTrackTranslateY","trackHeight","getTrackHeight","clipPathId","markTranslateY","trackTranslateY","mark","AnimatedSuper","getRow","animateFirst","clearRow","clearRows","currentIndex","DURATION","setNewRow","reflow","previousIndex","fromTop","ignorePrevious","previousRow","AnimatedCounter","previousNumber","getDecimal","animatedSuper","decimal","hideLeft","previousDecimalNumber","EMPTY_INDEX","setCount","previousByDecimal","decimalNumber","ChatPinnedMessage","pinnedMaxMid","pinnedMid","pinnedIndex","wasPinnedIndex","wasPinnedMediaIndex","waitForScrollBottom","loadedBottom","loadedTop","scrollDownListenerSetter","getCurrentIndexPromise","isStatic","dAC","pinnedMessageBorder","animatedSubtitle","animatedMedia","animatedCounter","btnOpen","openPinned","setPinnedMessage","_setPinnedMessage","unsetScrollDownListener","testMid","isNeededMore","getCurrentIndex","LOAD_OFFSET","correctAfter","gotRest","getPinnedMessage","backLimited","offset_id_offset","setScrollDownListener","isDown","handleScrollSideEvent","refreshPosition","handleFollowingPinnedMessage","followPinnedMessage","isLast","writeTo","writeMediaTo","ChatTopbar","verifyButtons","isMenuOpen","btnMore","deleteButtonText","menuButtons","buttonsToVerify","verifyVideoChatButton","currentGroupCall","groupCall","verifyCallButton","getCachedFullUser","phone_calls_available","video_calls_available","onJoinGroupCallClick","joinGroupCall","resize","setUtilsRAF","chatUtils","chatAudio","setPeerStatusManual","btnBack","chatInfoContainer","chatInfo","person","avatarElement","btnJoin","btnPinned","btnCall","btnGroupCall","btnMute","btnSearch","pushButtonToVerify","onBtnBackClick","isFirstChat","constructUtils","linked_chat_id","onCallClick","chatContextMenuHintWasShown","contactPeerId","constructAvatar","joinChannel","setMutedState","isTopMessage","hiddenPinnedMessages","constructDiscussionHelpers","byCurrent","setTitleCallback","setStatusCallback","setTitleManual","wasAlreadyUsed","newPinnedMessage","AppPrivateSearchTab","appSearch","btnPickDate","ChatSearch","selectedIndex","onResultsClick","selectResult","onFooterClick","onUpClick","onDownClick","foundCountEl","upBtn","downBtn","footer","dateBtn","renderedCount","ChatBackgroundPatternRenderer","canvases","INSTANCES","renderToCanvas","fillCanvas","crossOrigin","objectUrl","imageWidth","imageHeight","patternHeight","originalHeight","mask","centerY","topY","endY","bottomY","setCanvasDimensions","Chat","backgroundEl","backgroundTempId","sharedMediaTabs","setBackground","patternRenderer","gradientCanvas","previousGradientRenderer","previousPatternRenderer","previousPatternCanvas","isDarkPattern","getInstance","_gradientRenderer","setBackgroundPromise","setType","beforeDestroy","cleanupBackground","searchTab","_isAnyGroup","setAutoDownloadMedia","destroySharedMediaTab","bubblesSetPeerPromise","photoSizeMax","videoSizeMax","fileSizeMax","photo_size_max","video_size_max","getAutoDownloadSettingsByPeerId","callbacksPromise","ignoreThreadId","historyStorageTransferable","historySerialized","MarkupTooltip","waitingForMouseUp","mouseUpCounter","onMouseUpSingle","resetSelection","tools1","tools2","cancelClosening","linkBackButton","linkInput","applyLink","isLinkValid","setTooltipPosition","linkApplyButton","applyDiv","delimiter1","delimiter2","delimiter3","matchUrlProtocol","getActiveMarkupButton","nodes","getSelectedNodes","currentMarkups","activeButtons","isLinkToggle","bodyRect","selectionRect","inputRect","selectionTop","sizesRect","isFirstShow","setMouseUpEvent","handleSelection","ChatDragAndDrop","dropIcon","onDragOver","onDragLeave","onDrop","outlineWrapper","dropHeader","dropSubtitle","headerArgs","setPath","sizeX","sizeY","disableTransition","LineBlobDrawable","maxRadius","minRadius","N","radiusNext","speed","generateBlob","radDif","generateNextBlob","amplitude","speedScale","draw","paint","pinnedTop","progressToPinned","r1","progressNext","x1","x2","cx","y1","y2","bezierCurveTo","WeavingState","stateId","createGradient","shader","getGradientFromType","x0","y0","dt","TopbarWeave","handleDevicePixelRatioChanged","setSize","forceUpdate","resizeHandler","resizeCanvas","invokeDraw","handleFocus","focused","handleBlur","lbd","lbd1","lbd2","currentState","previousState","progressToState","lastUpdateTime","animateToAmplitude","animateAmplitudeDiff","amplitude2","animateAmplitudeDiff2","top1","top2","paint1","globalAlpha","setCurrentState","states","componentDidMount","matchMedia","setAmplitude","componentWillUnmount","setCanvasSize","RLottieIconItemPart","playPart","RLottieIconItem","createPart","initFrame","skipFirstFrameRendering","inverseColor","onLoadForColor","onLoadForPart","getPart","RLottieIcon","startFrame","endFrame","frameCount","SuperRLottieIcon","partState","colorState","getColor","partCallback","changedPartState","changedColorState","setPartState","setColorState","prevState","renderIfPaused","invoke","GroupCallMicrophoneIcon","GROUP_CALL_MICROPHONE_BUTTON_STATE","partName","HAND","MUTED","UNMUTED","GroupCallParticipantMutedIcon","colored","GROUP_CALL_PARTICIPANT_MUTED_STATE","colorStr","MUTED_FOR_ME","MUTED_BY_ADMIN","propertyValue","getColorByMutedState","generateEqualParts","clearMutedStateModifier","GroupCallParticipantStatusElement","element2","actionClassName","GroupCallParticipantsList","getParticipantByPeerId","onElementDestroy","getGroupCallParticipantMutedState","mutedIcon","callVideoCanvasBlur","GroupCallParticipantVideoElement","setPinned","setParticipant","groupCallParticipantMutedIcon","groupCallParticipantStatus","updateParticipant","GroupCallParticipantsVideoElement","participantsElements","groupCallId","setElementDisplay","pinnedSource","pinSource","unpinAll","setInstance","shouldDisplayElement","displayPinned","shouldDisplay","hasAnyVideo","participantElements","participantVideo","getVideoElementFromParticipantByType","_onLengthChange","GroupCallParticipantContextMenu","onOpenProfileClick","PopupGroupCall","targetPeerId","toggleParticipantMuted","editParticipant","canManageCall","can_self_unmute","muted_by_you","kickFromChat","getContainer","GroupCallParticipantsElement","groupCallParticipantsVideo","appGroupCallsManager","getGroupCallParticipants","GroupCallDescriptionElement","descriptionIntl","GroupCallTitleElement","makeButton","_className","buttonDiv","isConfirm","resizeHandlerClassName","MovableElement","fixDimensions","fixPosition","addResizeHandlers","setSwipeHandler","destroyElements","handlers","startTop","startLeft","startWidth","startHeight","resizingSide","isEnlarging","resizeDiff","maxPossible","setPositionToCenter","MovablePanel","toggleMovable","movable","movableOptions","toggleClassName","raise_hand_rating","onFullScreenClick","onToggleControls","buttonsContainer","onVideoClick","btnVideo","toggleVideoSharing","onScreenClick","btnScreen","toggleScreenSharing","toggleMuted","changeRaiseHand","onLeaveClick","hangUp","discard","toggleBigLayout","btnFullScreen","btnExitFullScreen","wasFullScreen","movablePanel","videosCount","wasBig","btnInvite","btnShowColumn","toggleRightColumn","btnFullScreen2","headerInfo","newHeader","newHeaderInfo","newHeaderTitle","btnHideColumn","videosScrollable","groupCallTitle","groupCallDescription","groupCallBodyHeaderDescription","constructButtons","groupCallParticipants","updateInstance","setHasPinned","groupCallMicrophoneIcon","_makeButton","microphoneIcon","btnLeave","setDescription","microphoneButtonState","getGroupCallMicrophoneButtonState","micState","CallDescriptionElement","connectionState","connectedAt","GroupCallMicrophoneIconMini","INIT_STATE","PopupCall","resizeVideoContainers","videoContainers","interlocutorUserId","emojisSubtitle","partyStates","partyMutedState","stateText","constructFirstButtons","constructSecondButtons","wasTryingToJoin","movableElement","controlsHover","getCallInstance","firstButtonsRow","muteI18nElement","secondButtonsRow","declineI18nElement","btnDecline","btnAccept","acceptCall","createVideoContainer","isPendingIncoming","isSharingVideo","isSharingScreen","outputState","getMediaState","oldContainers","mediaState","getVideoElement","hasFrame","hasPromise","videoState","screencastState","videoContainer","output","getEmojisFingerprint","popupWidth","MAX_WIDTH_PX","MAX_HEIGHT_PX","isVertical","MAX_SIZE","biggestSideSize","widthRatio","heightRatio","TopbarCall","onState","amplitudes","weave","clearCurrentInstance","currentDescription","instanceListenerSetter","isChangingInstance","callDescription","convertCallStateToGroupState","groupCallMicrophoneIconMini","throttledMuteClick","weaveContainer","uiNotificationsManager","notificationsShown","notificationIndex","notificationsCount","soundsPlayed","vibrateSupport","faviconEl","titleBackup","titleChanged","stopped","pushInited","updateLocalSettings","updSettings","nodesktop","novibrate","nopreview","nopush","needPush","webPushApiManager","registeredDevice","nosound","requestPermission","Notification","mozVibrate","webkitVibrate","setAppBadge","notificationsUiSupport","notifySoundEl","topMessagesDeferred","toggleToggler","peerString","soundReset","unreadUnmutedPeerIds","tokenData","unregisterDevice","registerDevice","notificationData","custom","hasChat","hasUser","buildNotification","fwdCount","peerReaction","peerTypeNotifySettings","notification","getPeerString","notificationMessage","noIncrement","notificationFromPeerId","peerPhoto","loadAvatar","resetTitle","isBlink","setFavicon","titleInterval","fontSize","textBaseline","textAlign","prevFavicon","replaceChild","testSound","permission","appRuntimeManager","onclose","getLocalSettings","nextSoundAt","prevSoundVolume","filename","token_type","tokenType","tokenValue","other_uids","app_sandbox","secret","getFilesFromEvent","onlyTypes","scanFiles","isDirectory","directoryReader","createReader","readEntries","itemFile","getAsFile","DataTransferItem","DragEvent","dataTransfer","webkitGetAsEntry","AppImManager","columnEl","offline","updateStatusInterval","cacheStorage","saveState","parseUriParams","tgaddr","postId","openUsername","userName","setSettings","chatsSelectTabDebounced","toggleChatGradientAnimation","onDocumentPaste","attachType","newMediaPopup","_types","canDrag","backgroundPromises","IS_FIREFOX","updateStatus","emojiAnimationContainer","appendEmojiAnimationContainer","createNewChat","chatsSelectTab","compareVersion","deleteFilesIterative","applyCurrentTheme","resizeInstances","saveChatPosition","choosing","setChoosingStickerTyping","typing","onInstanceDeactivated","isUpdated","receiptMessage","onSpoilerClick","spoilerTimeout","stateStorage","topbarCall","discardCurrentCall","currentCall","setAuthorized","telegramMeWebManager","addAnchorListener","uriParams","hashtag","STICKER_SET","EMOJI_SET","pathnameParams","protocol","makeLink","INVOICE","VOICE_CHAT","USER_PHONE_NUMBER","PRIVATE_POST","channel","thread","comment","MESSAGE","attachKeydownListener","timeoutOperation","requests","request","isBad","activatingChat","screen","IGNORE_KEYS","getFirstMessageToEdit","getNextDialog","newEvent","KeyboardEvent","commentId","resolveChannel","checkChatInvite","saveApiChat","resolvePhone","getInputInvoiceBySlug","openUrl","wrappedUrl","u","host","noPathnameParams","noUriParams","openComment","generateThreadServiceStartMessage","phone_calls_private","ignoreGroupCall","ignoreCall","discardGroupCallConfirmation","discardCallConfirmation","isClosing","getGroupCallFull","createGroupCall","setCurrentBackground","broadcastEvent","getBackground","getFile","lastBackgroundUrl","chatBubbles","chatPositions","backgroundUrl","prevTab","prevIdx","attachDragAndDropListeners","drops","mediaDrops","isFiles","_dropsContainer","mediaDropsContainer","dropsContainer","_drops","foundMedia","onImTabChange","updateMyOnlineStatus","spliceChats","fromIndex","chatFrom","chatTo","chatIndex","existingIndex","oldChat","getTypingElement","dot","eye","getPeerTyping","getPeerTypings","langPackKeys","multi","mapa","typingElement","descriptionElement","getChatStatus","typingEl","onlines","getOnlines","getUserStatus","ignoreSelf","getPeerStatus","useWhitespace","typingContainer","DialogColorsFg","DialogColors","DialogColorsMap","pic","useBytes","bestPhotoSize","CallConnectionInstanceBase","connection","sources","createPeerConnection","RTCPeerConnection","signalingState","iceConnectionState","createDataChannel","dataChannel","createDescription","appendStreamToConference","streamManager","appendToConference","closeConnection","closeConnectionAndStream","stopStream","negotiate","negotiating","negotiateInternal","sendDataChannelData","parseSignalingData","sdp","parseMediaSectionInfo","fingerprint","ufrag","pwd","convertNumber","isSending","codec","ssrc","sourceGroups","ssrcGroups","sourceGroup","semantics","ssrcs","rtpExtensions","payloadTypesMap","getPayloadType","payloadType","clockrate","feedbackTypes","subtype","parameters","payloadTypes","CallConnectionInstance","localDescription","remoteDescription","descriptionInit","offerReceived","createAnswer","setLocalDescription","offer","createOffer","offerSent","initialSetup","sendCallSignalingData","crypto","subtle","P2PEncryptor","p2pKey","seqMap","concatSHA256","bufferConcats","convertToUint8Array","encryptPrepared","msgKeyLarge","subarray","msgKey","aesKeyIv","prepareAesKeyIv","aesProcessCtr","encryptRawPacket","seq","ArrayBuffer","setUint32","sha256a","sha256b","iv","encryptedData","dataSize","encrypt","cryptoKey","constTimeIsDifferent","msgKeyEquals","decryptRawPacket","encryptedDataSize","decryptionBuffer","getUint32","ChromeP2PSdpBuilder","fingerprints","stringBuilder","streamName","addExtmap","addPayloadTypes","addSsrc","finalize","FirefoxP2PSdpBuilder","SafariP2PSdpBuilder","isFirefox","isSafari","extmap","j","fmtp","getOwnPropertyNames","pName","ssrcGroup","P2PSdpBuilder","sdpString","sdpMLineIndex","sdpMid","foundation","component","priority","relAddress","generation","tcpType","networkId","networkCost","candidate","generateOffer","generateAnswer","CallInstance","udp_p2p","udp_reflector","min_layer","max_layer","library_versions","createdAt","decryptQueue","candidates","canCreateConferenceEntry","setMediaState","sendMediaState","mediaStates","_sendMediaState","_connectionState","connectionInstance","sortIndex","findEntry","recvEntry","startScreenSharingInternal","wasStartingScreen","wasStartingVideo","requestScreen","stopVideoSharing","startVideoSharingInternal","requestInputSource","track","inputStream","getVideoTracks","stopTrack","isSharingVideoType","audioTrack","getAudioTracks","setHangUpTimeout","clearHangUpTimeout","hangUpTimeout","setPhoneCall","phoneCall","canAccept","overrideConnectionState","g_a_hash","appCallsManager","generateDh","dh","g_b","g_a","g_b_hash","getCallInput","phonePhoneCall","savePhonePhoneCall","joinCall","encryptionKey","configuration","iceServers","connections","ipv6","port","urls","turn","stun","credential","iceTransportPolicy","p2p_allowed","getRtcConfiguration","sendIceCandidate","onTrack","encryptor","decryptor","processDecryptQueue","createDataChannelEntry","dataChannelEntry","createEntry","sendEntry","negotiated","applyDataChannelData","TextEncoder","encode","iceCandidate","parsed","p2pParseCandidate","confirmCall","key_fingerprint","computeKey","emojisFingerprint","getEmojisFingerprintPromise","codePoints","unlockStreamManager","doTheMagic","getTransceivers","transceiver","getEntryByMid","bundle","sdpDescription","generateSdp","isAnswer","setRemoteDescription","onInputStream","stream","videoTrack","onMutedChange","requestAudioSource","setMuted","discardReason","discardedByOtherParty","hasVideo","discardCall","performCodec","_codec","setDataToDescription","setData","transport","screencast","filterNotVP8","vp8PayloadType","rtxIdx","apt","applyCallSignalingData","performSsrcGroups","getEntryBySource","sendRecvEntry","findFreeSendRecvEntry","setEntrySource","tryToReleaseCandidates","generateCandidate","RTCIceCandidate","addIceCandidate","decryptedData","TextDecoder","decode","signalingData","onUpdatePhoneCallSignalingData","getStreamCached","_cache","isScreen","constraints","getScreenStream","getStream","CallInstanceBase","fixSafariAudio","isSharingAudio","hasInputTrackKind","isAudioGood","isVideoGood","getAudioConstraints","getVideoConstraints","getScreenConstraints","endpoint","tryAddTrack","streams","saveInputVideoStream","isOutput","elementEndpoint","addTrack","useStream","outputStream","srcObject","sinkId","outputDeviceId","setSinkId","getTracks","addStream","CALL_STATE","audioAsset","CALL_REQUEST_TIMEOUT","CallsController","sortedInstances","createCallInstance","admin_id","g_a_or_b","bytesCmp","callId","getCallByUserId","hasConnected","hasCurrent","startCallInternal","fullInfo","participant_id","requestCall","GROUP_CALL_AMPLITUDE_ANALYSE_COUNT_MAX","GROUP_CALL_AMPLITUDE_ANALYSE_INTERVAL_MS","GroupCallConnectionInstance","negotiateThrottled","bundlePolicy","rtcpMuxPolicy","iceCandidatePoolSize","maybeUpdateRemoteVideoConstraints","updateConstraintsInterval","invokeJoinGroupCall","localSdp","mainChannels","processedChannels","sectionInfo","payload","processMediaSection","audioChannel","videoChannel","useChannel","setEntryPeerId","performExtmap","filterServerCodecs","isNewConnection","originalOffer","iceRestart","hasMunged","skipAddingMulticast","mediaLine","mediaLineParts","localMLine","codecIds","newData","setPort","setSource","newSdp","addSsrcEntry","newChannel","mungedSdp","fixLocalOffer","entriesToDelete","shouldBeSkipped","answerDescription","deleteEntry","iceGatheringState","updateConstraints","sender","setParameters","getParameters","degradationPreference","colibriClass","defaultConstraints","onStageEndpoints","addInputVideoStream","GroupCallInstance","isSpeakingMap","pinnedSources","participantsSsrcs","hadAutoPinnedSources","dispatchPinnedThrottled","getCachedParticipants","presentation","unpinSource","changeUserMuted","source_groups","clone","createConnectionInstance","raise","raiseHand","stopScreenSharing","startScreenSharing","startScreenSharingPromise","saveApiParticipant","leaveGroupCallPresentation","videoPaused","videoStopped","startVideoSharing","startVideoSharingPromise","rejoin","isDiscarded","isUpdatingMeInCurrentCall","onParticipantUpdate","doNotDispatchParticipantUpdate","hasLeft","oldSsrcs","modifiedTypes","oldSsrc","oldSource","oldEntry","originalDirection","setEndpoint","createTransceiver","GROUP_CALL_STATE","makeSsrcsFromParticipant","makeSsrcFromParticipant","audio_source","generateSelfVideo","audioSource","GroupCallsController","setCurrentGroupCall","startConnectingSound","stopConnectingSound","joinVideo","MediaStream","createMainStreamManager","joinGroupCallInternal","handleUpdateGroupCallParticipants","updatingSdp","channelCount","constraint","mediaDevices","getSupportedConstraints","constraintSupported","skipAudio","frameRate","screenStream","getDisplayMedia","contentHint","getUserMedia","clientInfo","lookupAttributeKeys","telegramSourceGroups","sdpLines","rest","parseSourceGroups","raw","ConferenceEntry","addTransceiver","generateSsrc","LocalConferenceDescription","sessionId","maxSeenId","entriesByMid","entriesBySource","entriesByPeerId","getEntriesByPeerId","conference","SDP","mediaSections","splitStringByLimitWithRest","UniqueNumberGenerator","generate","maxTries","_try","SDPAttributeSplitted","SDPMediaLineParts","SDPLine","SDPAttributeInner","missed","exists","nestedMap","makeAttributes","innerParts","SDPAttributes","fillAttributes","attributesMap","linesArray","SDPMediaSection","isReceiving","resultShouldBeArray","SDPSessionSection","parseSdp","createSection","sessionSection","lineStr","isIncorrectSdpLine","parseSdpLine","addSimulcast","generator","originalSsrcs","ssrcs2","ssrcsStrLines","ssrc2","WEBRTC_MEDIA_PORT","fixMediaLineType","getConnectionTypeForMediaType","generateMediaFirstLine","payloadIds","connectionType","SDPBuilder","addCandidate","performCandidate","addHeader","sId","bundleMids","addTransport","skipCandidates","addSource","addMsid","isApplication","isInactive","hdrexts","hdrext","fbs","fb","addConference","AudioStreamAnalyser","streamSource","createMediaStreamSource","gain","createGain","minDecibels","maxDecibels","smoothingTimeConstant","StreamManager","getAmplitude","streamAnalyser","analyse","ANALYSER_LISTENER","AudioContext","webkitAudioContext","getSource","itemSource","removeTrack","finalizeAddingTrack","changeTimer","substring","replaceInputAudio","oldTrack","timer","transceiverInit","tracks","mediaTrackType","trackIdx","replaceTrack","StringFromLineBuilder","newLine","addJoined","toTelegramSource","fromTelegramSource","rms","onlyFirst","E","wrappingDraft","messageEntityTextUrl","messageEntityMentionName","isDraft","setBlankToAnchor","EMOJI_VERSIONS_SUPPORTED","inlineEl","newEmojiWidth","legacyEmojiWidth","isEmojiSupported","setDimensionsFromRect","CustomEmojiElement","renderer","syncedPlayer","pausedElements","lastPausedVideo","elementsCounter","CustomEmojiRendererElement","playersSynced","syncedElements","clearedElements","emojiRenderers","syncedPlayers","syncedPlayersFrames","overrideRender","clearRenderInterval","getOffsets","offsetsMap","offsetParent","clearCanvas","isDimensionsSet","isImageData","ImageData","frameWidth","frameHeight","checkForAnyFrame","emojiRenderInterval","renderEmojis","nasty","usedLength","customEmojis","contextSite","contextExternal","lastEntity","nextEntity","endPartOffset","fullEntityText","partText","usedText","fontStyle","styleName","fontFamily","atPos","fromBot","encodeURIComponent","isSupported","masked","currentContext","electronHelpers","contextUrl","encoded","encodeSpoiler","entityText","voodoo","onDestroy","wrap","_loadPromises","isLottie","middlewares","addition","_p","missing","cachedPromises","uncachedPromisesPromise","loadFromPromises","uncached","QueryableWorker","worker","terminate","onmessage","queryMethodListener","queryMethodArguments","postMessage","sendQuery","transfer","queryMethod","workersLimit","playersByCacheName","workers","curWorkerNum","onPlayerLoaded","reqId","fps","clamped","onPlayerError","getAnimation","setLoop","_autoplay","loadLottieWorkers","remain","Worker","queryableWorker","loadAnimationAsAsset","loadAnimationFromURL","blobConstruct","newParams","loadAnimationWorker","waitForFirstFrame","cacheName","initPlayer","destroyWorkers","loadFromData","FramesCache","framesNew","framesURLs","getCache","createCache","releaseCache","getCacheCounter","generateName","RLottiePlayer","cachingDelta","CACHE","skipDelta","getLottiePixelRatio","contexts","setMainLoop","clearPendingRAF","rafId","resetCurrentFrame","minFrame","renderFirstFrame","requestFrame","applyInversing","renderFrame2","cachedSource","renderedFirstFrame","ImageBitmap","frInterval","frThen","frameNew","onLap","mainLoopForwards","mainLoopBackwards","currentMethod","frameListener","listenerResults","enterFrame","playToFrame","bounds","setMinMax","playToFrameOnFrameCallback","setInverseColor","pagesManager","pageId","pagesDiv","scrollableDiv","page","onShown","setPage","isAuthPage","Page","onFirstMount","onMount","encodeEmoji","emojiText","toCodePoints","removeVS16s","vs16RegExp","zeroWidthJoiner","rawEmoji","unicodeSurrogates","points","getEmojiToneIndex","getCountryEmoji","emojiFromCodePoints","fromCodePoint","module","exports","defineProperty","enumerable","Symbol","toStringTag","__esModule","prototype","isRecordingSupported","bufferLength","encoderApplication","encoderFrameSize","encoderPath","maxFramesPerPage","mediaTrackConstraints","resampleQuality","streamPages","wavBitDepth","encodedSamplePosition","WebAssembly","clearStream","audioContext","closeAudioContext","encodeBuffers","getChannelData","encoder","buffers","initAudioContext","initAudioGraph","scriptProcessorNode","createScriptProcessor","destination","onaudioprocess","inputBuffer","monitorGainNode","setMonitorGain","recordingGainNode","setRecordingGain","initSourceNode","loadWorker","initWorker","streamPage","storePage","recordedPages","samplePosition","originalSampleRate","sampleRate","wavSampleRate","onpause","resume","onresume","setTargetAtTime","onstart","destroyWorker","Function"],"sourceRoot":""}