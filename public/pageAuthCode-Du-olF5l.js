const __vite__fileDeps=["./pageIm-BRUGiFEv.js","./index-B7WIMVLo.js","./index-C-9gLbWc.css","./page-CFQq45dV.js","./pageSignUp-BVjQTEBG.js","./loginPage-E29Tlywq.js","./avatar-CyLVJWYN.js","./putPreloader-BhMVPekh.js","./pagePassword-D3zlZLbH.js","./htmlToSpan-DhAls8qz.js","./wrapDuration-N7gVnHGH.js","./toast-CTXjJKhu.js","./pageSignIn-B3Hc6RvL.js","./pageSignQR-C3BPFinV.js","./countryInputField-CGoQGdNE.js"],__vite__mapDeps=i=>i.map(i=>__vite__fileDeps[i]);
import{f as v,g as D,h as I,j as d,s as N,k as u,d as _,_ as E,m as O,n as y,o as R,p as F}from"./index-B7WIMVLo.js";import{P as K}from"./page-CFQq45dV.js";import M from"./pageSignIn-B3Hc6RvL.js";import{T as H}from"./tracking-CFAwSx7m.js";import{C as x,w as V}from"./emailSetup-0NlYvq0Q.js";import{w as b,f as T,a as S}from"./wrapDuration-N7gVnHGH.js";import{S as w}from"./loginPage-E29Tlywq.js";import{t as L}from"./toast-CTXjJKhu.js";import"./putPreloader-BhMVPekh.js";import"./pageSignQR-C3BPFinV.js";import"./countryInputField-CGoQGdNE.js";import"./classNames-CN4lTu6a.js";import"./iconTsx-Dm7uuor6.js";import"./transition-4sVVeuD9.js";let o=null,g=null,k=null,a,s,i,l,m,c;const P=()=>{setTimeout(()=>{m?.remove(),c?.remove(),a?.cleanup(),l&&clearTimeout(l)},300)},q=e=>{a.disabled=!0;const t={phone_number:o.phone_number,phone_code_hash:o.phone_code_hash,phone_code:e};_.managers.apiManager.invokeApi("auth.signIn",t,{ignoreErrors:!0}).then(async r=>{switch(r._){case"auth.authorization":await _.managers.apiManager.setUser(r.user),E(()=>import("./pageIm-BRUGiFEv.js"),__vite__mapDeps([0,1,2,3]),import.meta.url).then(n=>{n.default.mount()}),P();break;case"auth.authorizationSignUpRequired":E(()=>import("./pageSignUp-BVjQTEBG.js"),__vite__mapDeps([4,1,2,5,3,6,7]),import.meta.url).then(n=>{n.default.mount({phone_number:o.phone_number,phone_code_hash:o.phone_code_hash})}),P();break}}).catch(async r=>{let n=!1;switch(r.type){case"SESSION_PASSWORD_NEEDED":n=!0,await(await E(()=>import("./pagePassword-D3zlZLbH.js"),__vite__mapDeps([8,1,2,7,3,5,9,10,11,12,13,14]),import.meta.url)).default.mount(),setTimeout(()=>{a.value=""},300);break;case"PHONE_CODE_EXPIRED":a.error=!0,d(s,u("PHONE_CODE_EXPIRED"));break;case"PHONE_CODE_EMPTY":case"PHONE_CODE_INVALID":a.error=!0,d(s,u("PHONE_CODE_INVALID"));break;default:a.error=!0,d(s,r.type);break}a.disabled=!1,n||(a.value="",v(()=>{a.input.focus()}))})},z=()=>{const e=h.pageEl.querySelector(".input-wrapper");e.append(a.container),s=document.createElement("div"),s.classList.add("error-label"),e.append(s);const t=h.pageEl.querySelector(".phone-edit");t.append(D("edit")),I(t,()=>M.mount()),e.append(i)},B=()=>{const e=h.pageEl.querySelector(".auth-image"),t=O.isMobile?100:166;if(o.type._==="auth.sentCodeTypeFragmentSms"){e.firstElementChild&&(m?.remove(),m=void 0,e.replaceChildren());const r=document.createElement("div");return r.classList.add("media-sticker-wrapper"),e.append(r),y.loadAnimationAsAsset({container:r,loop:!0,autoplay:!0,width:t,height:t},"jolly_roger").then(n=>(c=n,y.waitForFirstFrame(n))).then(()=>{})}else return e.firstElementChild&&(c?.remove(),c=void 0,e.replaceChildren()),m=new H(a,t),e.append(m.container),m.load()},f=()=>{_.managers.apiManager.invokeApi("auth.resetLoginEmail",{phone_number:o.phone_number,phone_code_hash:o.phone_code_hash}).then(e=>{e._==="auth.sentCode"?(e.phone_number=o.phone_number,o=e,e.type._==="auth.sentCodeTypeEmailCode"?C(e.type):A()):(console.error(e),L({langPackKey:"Error.AnError"}))}).catch(e=>{e.type.includes("TASK_ALREADY_EXISTS")?w.show({titleLangKey:"Login.ResetEmail.NeedPremium",descriptionLangKey:"Login.ResetEmail.NeedPremiumText",button:{langKey:"OK"}}):(console.error(e),L({langPackKey:"Error.AnError"}))})},C=e=>{if(l&&clearTimeout(l),e.reset_pending_date!=null){const t=e.reset_pending_date-R(!0);if(t<=0||e.reset_pending_date<=0){i.replaceChildren(u("Login.ResetEmail.PleaseWait")),f();return}i.replaceChildren(u("Login.ResetEmail.Pending",[b(T(t,2)),S(f)])),l=F.setTimeout(()=>C(e),3e4);return}e.reset_available_period!=null&&i.replaceChildren(u("TroubleEmail",[S(()=>{w.show({titleLangKey:"Login.ResetEmail.Title",descriptionLangKey:"Login.ResetEmail.Text",descriptionArgs:[b(T(e.reset_available_period,2))],button:{langKey:"Login.ResetEmail.Title"}}).then(()=>{f()})})]))},A=()=>{g?a.value="":(g=h.pageEl.getElementsByClassName("phone")[0],k=h.pageEl.getElementsByClassName("sent-type")[0]);const e=o.type.length;a||(a=new x({length:e,onChange:p=>{a.error=!1,d(s,"")},onFill:p=>{q(p)}})),a.options.length=e,g.innerText=o.phone_number,i||(i=document.createElement("div"),i.classList.add("forgot-link")),i.innerHTML="",l&&clearTimeout(l);let t,r;const n=o.type;switch(n._){case"auth.sentCodeTypeSms":t="Login.Code.SentSms";break;case"auth.sentCodeTypeApp":t="Login.Code.SentInApp";break;case"auth.sentCodeTypeCall":t="Login.Code.SentCall";break;case"auth.sentCodeTypeFragmentSms":t="PhoneNumber.Code.Fragment.Info";const p=document.createElement("a");N(p),p.href=n.url,r=[p];break;case"auth.sentCodeTypeEmailCode":t="Login.Code.SentEmail",r=[V(n.email_pattern)],C(n);break;default:t="Login.Code.SentUnknown",r=[n._];break}return d(k,u(t,r)),_.managers.appStateManager.pushToState("authState",{_:"authStateAuthCode",sentCode:o}),B().catch(()=>{})},h=new K("page-authCode",!0,z,e=>{o=e,A()},()=>{v(()=>{a?.input.focus()})});export{h as default};
//# sourceMappingURL=pageAuthCode-Du-olF5l.js.map
