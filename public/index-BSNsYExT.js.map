{"version":3,"mappings":"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","names":["draw","gl","payload","parameters","initPositionBuffer","width","height","positionBuffer","positions","initTextureBuffer","textureCoordBuffer","textureCoordinates","initShaderProgram","vsSource","fsSource","vertexShader","loadShader","fragmentShader","shaderProgram","log","type","source","shader","weakRefs","r","createVideoForDrawing","mediaSrc","options","currentTime","waitToSeek","muted","video","createVideo","timeout","promise","onMediaLoad","handleVideoLeak","deferred","deferredPromise","e","loadTexture","mediaType","videoTime","middleware","texture","media","image","initWebGL","vertexShaderSource","fragmentShaderSource","__vitePreload","buffers","adjustmentsConfig","uniform","_BrushPainter","targetCanvas","imageCanvas","blurAmount","line","ctx","shouldFinish","points","hexaToRgba","w","pointsX","p","pointsY","minX","maxX","minY","maxY","brushFn","i","cx","cy","arrowLength","i2","distance","angle","angle1","angle2","vec1","vec2","animateValue","length","BrushPainter","useNormalizePoint","editorState","useMediaEditorContext","size","createMemo","x","point","transform","h","useProcessPoint","densityAware","drawAdjustedImage","mediaState","flip","rotation","scale","translation","imageSize","Object","fromEntries","map","key","to100","value","adjustments","BrushCanvas","actions","fullImageGLPayload","setFullImageGLPayload","createSignal","normalizePoint","processPoint","processLine","finalTransform","processedLines","brushDrawnLines","lastLine","setLastLine","canvas","_el$","_tmpl$","_$effect","_p$","_v$","currentTab","_v$2","isAdjusting","_v$3","canvasSize","pixelRatio","_v$4","classList","toggle","style","setProperty","removeProperty","_$setAttribute","undefined","getContext","brushCanvas","fullImageMultiplier","Math","min","mediaSize","fullImageCanvas","_el$2","_tmpl$2","_v$5","_v$6","preserveDrawingBuffer","fullBrushesCanvas","_el$3","_v$7","_v$8","brushPainter","fullBrushPainter","onMount","createMiddleware","get","onCleanup","cleanupWebGl","createEffect","on","setTimeout","redrawFull","redraw","resetLastLine","color","currentBrush","brush","isMoving","clearRect","save","translate","rotate","drawImage","restore","clear","saveLastLine","forEach","drawLine","processLineForFullImage","defaultBlurAmount","redrawBrushes","initialPosition","builtUpDistance","push","pushToHistory","path","newValue","oldValue","HistoryItem","RemoveArrayItem","updateBlurredImage","startSwipe","y","bcr","getBoundingClientRect","left","top","prev","previewLine","selectedResizableLayer","endSwipe","addEventListener","clientX","clientY","touches","swipeHandler","SwipeHandler","element","cursor","onSwipe","xDiff","yDiff","_e","lastPoint","onReset","animateArrowBrush","removeListeners","useCropOffset","getConvenientPositioning","extendCrop","cropOffset","imageWidth","imageHeight","snapToViewport","imageLeftTop","imagePoints","sin","cos","r2","cropWidth","cropHeight","currentImageRatio","cropLeftTop","cropPoints","cropPointsX","cropPointsY","cropMinX","cropMaxX","max","cropMinY","cropMaxY","imageMinX","imageMaxX","imageMinY","imageMaxY","MAX_SCALE","CropHandles","isCropping","leftTop","setLeftTop","leftTopDiff","setLeftTopDiff","setSize","diff","setDiff","withCurrentOwner","_getConvenientPositioning","getNewLeftTopAndSize","cancelSizeAnimation","resetSizeWithAnimation","initialDiff","initialLeftTopDiff","initialLeftTop","initialSize","targetDiff","targetLeftTopDiff","targetLeftTop","targetSize","progress","batch","lerpArray","multipliers","el","leftTopHandle","rightTopHandle","leftBottomHandle","rightBottomHandle","leftHandle","topHandle","rightHandle","bottomHandle","boundDiff","initialScale","initialTranslation","firstTarget","resizeSwipeHandlers","setCursorTo","document","body","onStart","add","target","fixed","fixedImageRatioKey","ratio","minW","minH","xd","Number","halfImageWidth","halfImageHeight","imageCenter","additionalScaleX","additionalScaleY","additionalScale","newWidth","newHeight","newRatio","upScale","targetScale","targetTranslation","modifyMutable","produce","state","lerp","onEnd","remove","translationSwipeHandler","cropArea","resistance","prevTranslation","handler","right","bottom","croppedSizeFull","cw","ch","coverAnimatedStyle","controlsAnimatedStyle","_$p","_$style","background","position","_el$4","_el$5","_el$6","firstChild","_el$7","nextSibling","_el$8","_el$9","_el$10","_el$11","_el$12","_el$13","_el$14","_el$15","_el$16","_el$17","_el$18","_el$19","_ref$","_$use","_ref$2","_ref$3","_ref$4","_ref$5","_ref$6","_ref$7","_ref$8","_ref$9","overflow","initVideoPlayback","renderingPayload","pendingSeek","time","flags","SetVideoTimeFlags","seekListener","listener","event","frameCallbackId","playing","skip","frameCallback","animate","clamp","ImageCanvas","ownedDrawAdjustedImage","ownedInitVideoPlayback","init","currentVideoTime","mediaRatio","videoQuality","snapToAvailableQuality","updateMediaStateClone","isReady","createReaction","PreviewBrushSize","_$createComponent","Show","when","previewBrushSize","children","includes","hexToRgb","join","useMediaQuery","query","isMatch","setIsMatch","updateMatch","mediaQueryList","useIsMobile","StickerLayerContent","props","canImageResultInGIF","container","wrapSticker","div","doc","layer","sticker","group","play","loop","withThumb","stickersLayersInfo","id","destroy","ResizableContainer","TextLayerContent","textInfo","onFocus","currentTextLayerInfo","fontInfo","fontInfoMap","font","deleteThisLayer","layers","resizableLayers","idx","findIndex","deletedLayer","splice","textRenderingInfo","findBy","updateBackground","contentEditable","childNodes","childNode","HTMLDivElement","hasAttributes","querySelectorAll","node","createTextNode","textContent","replaceWith","createElement","innerHTML","child","range","createRange","sel","window","getSelection","setStart","collapse","removeAllRanges","addRange","selection","rangeCount","getRangeAt","startContainer","startOffset","innerDiv","innerDivRange","selectNodeContents","querySelector","lines","getLinesRenderingInfo","alignment","createTextBackgroundPath","updateBackgroundStyle","updateOutlineStyle","clientWidth","clientHeight","selectAll","isThisLayerSelected","innerText","trim","preventDefault","getContrastColor","intialContent","layerInfo","_$insert","content","i18n","$$input","fontFamily","fontWeight","flexAlignMap","linesContainer","Array","from","_child","offset","first","rounding","arcParams","s","prevPosition","prevY","diffSign","abs","currentRounding","last","info","svg","createElementFromMarkup","prepend","updateSvg","stretch","baseline","bgDiv","center","_$delegateEvents","ResizableLayers","context","isTextTab","canClick","moveSelectedLayerOnTop","addLayer","newResizableLayer","resizableLayersSeed","_$addEventListener","For","each","isMobile","handleTyping","store","createMutable","containerWidth","containerHeight","leftTopEl","rightTopEl","leftBottomEl","rightBottomEl","circleOffset","canShowHandles","resizeHandlesContainer","processedLayer","useResizeHandles","useContextMenu","unobserve","observeResize","$$click","_c$","_$memo","Portal","mount","_tmpl$3","_v$9","_v$10","_v$11","_v$12","PI","_v$13","_v$14","_v$15","_v$16","_v$17","_v$18","_v$19","_v$20","swipeStarted","_","__","getEvent","initialVector","resizedVector","rotationFromHorizon","atan2","hypot","moveHandler","find","onClick","otherLayer","contextMenu","createContextMenu","buttons","icon","className","text","listenTo","onElementReady","animateToNewRotationOrRatio","newRotation","snappedRotation90","isReversedRatio","snappedRotation","parts","originalRatio","w1","h1","w2","h2","initialRotation","targetRotation","DEGREE_DIST_PX","DEGREE_STEP","TOTAL_DEGREES_SIDE","MAX_DEGREES_DIST_PX","SNAP_DIST_PX","rotationFromMove","amount","RotationWheel","moved","setMoved","movedDiff","setMovedDiff","swiperEl","round","prevRotation","currentDiff","prevShouldSnap","getShouldSnap","isAnimating","isSnapped","cancelAnimation","timeoutId","handleDiffChange","removeSnapAfterTimeout","shouldSnap","clearTimeout","newMoved","rotationFromSwiper","rotationDiff","resetWheelWithAnimation","values","resetRotationWheel","isFirstEffect","rotateLeft","flipImage","snapTo1","targetFlip","toFixed","replace","ButtonIconTsx","fill","ArrowUp","_tmpl$4","useFinalTransform","cropTabAnimationProgress","setCropTabAnimationProgress","cancel","prevCanvasSize","setPrevCanvasSize","prevCropTranslation","setPrevCropTranslation","prevAdditionalScale","setPrevAdditionalScale","additionalImageScales","imageRatio","toCropScale","getSnappedViewportsScale","fromCroppedScale","snappedImageScale","cropTrnsl","cropTranslation","prevScale","updatePrevValues","prevSize","currentSize","currentAdditionalScale","scaleToChange","counterScale","totalScale","v","t","useVideoControlsCanvas","getCanvas","cleaned","chunkWidth","chunkHeight","fade","styles","HANDLE_WIDTH_PX","MOVE_ACTIVATION_THRESHOLD_PX","VideoControls","cropper","setCropper","isDraggingSomething","setIsDraggingSomething","cropperSize","useElementSize","strippedWidth","shouldShowTime","swiping","formattedResultingTime","totalSeconds","videoCropLength","duration","ts","hh","floor","padStart","mm","ss","decimal","minLength","initialStart","initialLength","leftHandleSwipeArgs","globalCursor","videoCropStart","isPlaying","onMove","setVideoTime","rightHandleSwipeArgs","maxLength","canMove","middleSwipeArgs","handleCursorMove","startDiff","self","cursorSwipeArgs","getPositionInCropper","onMiddlePartClick","showMutedTooltip","showTooltip","mountOn","parentElement","vertical","textElement","lighter","auto","closeTooltip","videoMuted","currentTarget","close","ripple","IconTsx","swipe","TimeStick","ThumbnailTrack","hidden","PausePlay","paused","Container","changed","InnerContainer","IconButton","MuteButton","Frames","Cropper","Images","CropperBg","CropperBgLeft","CropperBgRight","CropperHorizontalBorder","dragging","CropperHandle","CropperHandleLeft","CropperHandleRight","CroppedTime","_v$21","visible","_v$22","PlayButton","_v$23","PlayButtonInner","_$className","_$classList","ghostThumbnailPosition","setGhostThumbnailPosition","isDragging","setIsDragging","isGhostThumbnailVisible","isNaN","videoThumbnailPosition","canPreviewFrame","previewFrameTimeout","onPointerMove","UpdateVideo","Redraw","onPointerOut","swipeArgs","ThumbnailMark","withTransition","ghost","$$touchend","$$pointerout","$$touchmove","$$pointermove","_v$24","_v$25","disabled","_v$26","_v$27","_v$28","_tmpl$5","_el$20","_el$21","_el$22","_el$23","_el$24","_v$29","PausePlaySvg","_v$30","_v$31","PausePlaySvgPlay","_v$32","PausePlaySvgPause","_v$33","PausePlaySvgPauseLeft","_v$34","PausePlaySvgPauseRight","TouchEvent","changedTouches","pos","MainCanvas","removeEventListener","SIDE_MAX","SIDE_MIN","getResultSize","videoType","quality","scaledWidth","scaledHeight","willResultInVideo","defaultCodec","highResCodec","getResultTransform","initialCanvasWidth","initialCanvasHeight","canvasRatio","snappedCanvasWidth","snappedCanvasHeight","getScaledLayersAndLines","scaledLines","scaledLayers","layerStore","unwrap","FRAMES_PER_SECOND","STICKER_SIZE","drawStickerLayer","drawTextLayer","renderingInfo","multiply","newPath","part","boxLeft","yOffset","xOffset","generateVideoPreview","previewWidth","previewHeight","mirrorCanvas","previewCanvas","previewCtx","mirrorCtx","stickerChild","resolve","ImageStickerFrameByFrameRenderer","blob","appDownloadManager","LottieStickerFrameByFrameRenderer","animation","lottieLoader","frame","VideoStickerFrameByFrameRenderer","getMiddleware","apiManagerProxy","delay","IS_FIREFOX","EXPECTED_FPS","VIDEO_COMPARISON_ERROR","THUMBNAIL_MAX_SIZE","logger","renderToActualVideo","hasAnimatedStickers","drawToImageCanvas","resultCanvas","getMediaBlob","owner","getOwner","startTime","endTime","creationProgress","createRoot","dispose","setProgress","renderers","thumbnailCanvas","thumbnailCtx","thumbnailTime","currentVideoFrameDeferred","encodingPausedDeferred","lastTime","drewThumbnail","canceled","progressRAF","listenerSetter","ListenerSetter","initMuxerAndEncoder","Muxer","ArrayBufferTarget","audioBuffer","mediaBlob","supportsAudioEncoding","extractAudioFragment","muxer","encoder","chunk","meta","calcCodecAndBitrate","BITRATE_TARGET_FPS","drawToTexture","initStickerRenderers","stickerType","renderer","StickerType","ThrowReason","ThrowReason2","prepareAndRenderFrame","frameNo","callback","mediaTime","untilFrame","renderFrame","timestamp","appendToMuxer","promises","videoFrame","updateProgress","targetProgress","currentProgress","delta","cleanup","preview","runWithOwner","resultPromise","reject","firstFrameSeekDeferred","done","encodeAndMuxAudio","buffer","thumbBlob","MediaSize","result","noop","audioContext","arrayBuffer","fullAudioBuffer","sampleRate","startSample","endSample","frameCount","numChannels","fragmentBuffer","fullData","onChunk","totalFrames","interleaved","channelData","audioData","renderToImage","renderToVideoGIF","maxFrames","spawnAnimatedPreview","previewBlob","animatedImg","createFinalResult","checkIfHasAnimatedStickers","maxHeight","maxQuality","renderResult","animatedPreview","FinishButton","hasModifications","RangeInput","normalizedValue","nMap","mappedCenter","brightShadow","hexaToHsla","l","prevValue","ref","label","onChangeFinish","valueAsNumber","onChange","passiveLabel","StepInput","stepIndex","steps","step","isActive","createSelector","a","b","isSelected","index","ADJUST_TIMEOUT","AdjustmentsTab","removeIsAdjusting","resultingSize","debugResultingSize","console","maxVideoQuality","availableQualityHeights","filter","canShowQualityInput","Space","HeightTransition","item","setContainer","showGhost","setShowGhost","setValue","append","removeGhost","currentValue","PenBrush","ArrowBrush","MarkerBrush","NeonBrush","EraserBrush","BlurBrush","_tmpl$6","colorPickerSwatches","PICKER_WIDTH_PX","PICKER_HEIGHT_PX","SLIDER_WIDTH_PX","DEFAULT_SIZE_PX","ColorPicker","collapsed","setCollapsed","collapsing","setCollapsing","containerSize","setContainerSize","sizeContainer","swatch","hexColor","onCollapseToggle","previousColor","colorPicker","_ColorPicker","buildLayout","slider","pickerBox","hexInput","rgbInput","pickerBoxWidth","pickerBoxHeight","sliderWidth","thickSlider","hex","abortDrawerSlide","observer","ResizeObserver","observe","disconnect","colorKey","newCollapsed","then","doubleRaf","getCurrentColor","setColor","createStoredColor","defaultColor","savedColor","setSavedColor","fallback","LargeButton","_$spread","_$mergeProps","active","class","BrushTab","savedBrushColors","pen","arrow","neon","savedBrushSignal","updateCurrentBrush","brushButton","brushSvg","hasColor","removeSizePreview","previous","transition","ratioRects","1x1","3x2","4x3","5x4","7x5","16x9","ratioIcon","rotated","_tmpl$7","Item","inProps","buttonProps","splitProps","CropTab","what","onRatioClick","_tmpl$8","_tmpl$9","config","mediaEditorTabsOrder","Tabs","underline","tabs","onTabClick","tab","containerBR","targetBR","TabContentContext","createContext","TabContent","scrollAmount","setScrollAmount","prevElement","prevTab","scrollable","toRight","indexOf","newElement","Provider","setScrollable","cls","action","modifier","initialTab","Scrollable","setListeners","onScroll","scrollTop","onContainer","StickersTab","wrapStickerSetThumb","EmoticonsSearch","useHotReloadGuard","useContext","managers","recentStickers","createResource","appStickersManager","getRecentStickersStickers","stickerSets","getAllStickers","filteredStickers","setFilteredStickers","search","setSearch","setGroup","activeSet","setActiveSet","scrolling","setScrolling","intersectionObserver","setIntersectionObserver","recentLabel","setRecentLabel","lazyLoadQueue","LazyLoadQueue","stickerRenderer","SuperStickerRenderer","regularLazyLoadQueue","intersectionObserverInit","root","withLock","onStickerSetThumbClick","String","scrollIntoView","behavior","block","StickerSetThumb","renderContainer","autoplay","set","textColor","Sticker","renderSticker","observeAnimated","newLayer","StickerSetLabel","wrapEmojiText","title","StickerSetSection","stickers","getStickerSet","getStickerSetInputById","documents","ThumbList","thumbsListScrollable","ScrollableX","sets","IntersectionObserver","entries","entry","isIntersecting","dataset","setId","rootMargin","searchStickers","g","getPremiumStickers","getStickersByEmoticon","emoticon","emoticons","includeServerStickers","onValue","onGroup","categoryColor","animatedItemGroup","TextTab","untrack","setAlignment","setStyle","toggleButton","fontButton","textFont","Topbar","doneButton","processHistory","history","otherHistory","pop","processHistoryItem","onUndo","redoHistory","onRedo","removeListener","addShortcutListener","combo","onClose","onFinish","Toolbar","toolbar","move","setMove","isCollapsed","setIsCollapsed","setContainerHeight","extraMove","setExtraMove","shouldHide","setShouldHide","startY","isAborted","isResetting","resetMove","startDrag","dragMove","dragEnd","initialMove","initialExtraMove","targetExtraMove","totalMove","crop","MediaEditor","contextValue","createContextValue","overlay","isOverlayCounterCleaned","cleanupOverlayCounter","overlayCounter","isDarkOverlayActive","focus","navigationItem","onPop","handleClose","appNavigationController","pushItem","removeItem","onCanvasReady","onImageRendered","performClose","hasGif","finished","confirmationPopup","description","button","isFinishing","MediaEditorContext","handleFinish","finally","onEditFinish","isVideo","openMediaEditor","HotReloadGuardProvider","render","openMediaEditorFromMedia","rect","rest","spawnedAnimatedImage","spawnAnimatedImage","canvasBcr","removeWithFade","SolidJSHotReloadGuardProvider","openMediaEditorFromMediaNoAnimation","spawnedImageCanvas","spawnImageCanvas","snapToRect","fadeIn","centerLeft","centerTop","sourceWidth","sourceHeight","animateToNewCenter","canvasCenterLeft","canvasCenterTop","leftDiff","topDiff","snappedWidth","snappedHeight"],"ignoreList":[],"sources":["../src/components/mediaEditor/webgl/draw.ts","../src/components/mediaEditor/webgl/initBuffers.ts","../src/components/mediaEditor/webgl/initShaderProgram.ts","../src/components/mediaEditor/canvas/createVideoForDrawing.ts","../src/components/mediaEditor/webgl/loadTexture.ts","../src/components/mediaEditor/webgl/initWebGL.ts","../src/components/mediaEditor/canvas/brushPainter.ts","../src/components/mediaEditor/canvas/useNormalizePoint.ts","../src/components/mediaEditor/canvas/useProcessPoint.ts","../src/components/mediaEditor/canvas/brushCanvas.tsx","../src/components/mediaEditor/canvas/useCropOffset.ts","../src/components/mediaEditor/canvas/getConvenientPositioning.tsx","../src/components/mediaEditor/canvas/cropHandles.tsx","../src/components/mediaEditor/canvas/initVideoPlayback.ts","../src/components/mediaEditor/canvas/imageCanvas.tsx","../src/components/mediaEditor/canvas/previewBrushSize.tsx","../src/components/mediaEditor/useIsMobile.ts","../src/components/mediaEditor/canvas/stickerLayerContent.tsx","../src/components/mediaEditor/canvas/textLayerContent.tsx","../src/components/mediaEditor/canvas/resizableLayers.tsx","../src/components/mediaEditor/canvas/animateToNewRotationOrRatio.ts","../src/components/mediaEditor/canvas/rotationWheel.tsx","../src/components/mediaEditor/canvas/useFinalTransform.ts","../src/components/mediaEditor/canvas/useVideoControlsCanvas.ts","../src/components/mediaEditor/canvas/videoControls.tsx","../src/components/mediaEditor/canvas/mainCanvas.tsx","../src/components/mediaEditor/finalRender/getResultSize.ts","../src/components/mediaEditor/finalRender/getResultTransform.ts","../src/components/mediaEditor/finalRender/getScaledLayersAndLines.ts","../src/components/mediaEditor/finalRender/constants.ts","../src/components/mediaEditor/finalRender/drawStickerLayer.ts","../src/components/mediaEditor/finalRender/drawTextLayer.ts","../src/components/mediaEditor/finalRender/generateVideoPreview.ts","../src/components/mediaEditor/finalRender/imageStickerFrameByFrameRenderer.ts","../src/components/mediaEditor/finalRender/lottieStickerFrameByFrameRenderer.ts","../src/components/mediaEditor/finalRender/videoStickerFrameByFrameRenderer.ts","../src/components/mediaEditor/finalRender/renderToActualVideo.ts","../src/components/mediaEditor/finalRender/renderToImage.ts","../src/components/mediaEditor/finalRender/renderToVideoGIF.ts","../src/components/mediaEditor/finalRender/spawnAnimatedPreview.ts","../src/components/mediaEditor/finalRender/createFinalResult.ts","../src/components/mediaEditor/finishButton.tsx","../src/components/mediaEditor/rangeInput.tsx","../src/components/mediaEditor/stepInput.tsx","../src/components/mediaEditor/tabs/adjustmentsTab.tsx","../src/components/mediaEditor/brushesSvg.tsx","../src/components/mediaEditor/colorPicker.tsx","../src/components/mediaEditor/createStoredColor.ts","../src/components/mediaEditor/largeButton.tsx","../src/components/mediaEditor/tabs/brushTab.tsx","../src/components/mediaEditor/tabs/cropTab.tsx","../src/components/mediaEditor/tabs/tabs.tsx","../src/components/mediaEditor/tabs/tabContent.tsx","../src/components/mediaEditor/tabs/stickersTab.tsx","../src/components/mediaEditor/tabs/textTab.tsx","../src/components/mediaEditor/topbar.tsx","../src/components/mediaEditor/toolbar.tsx","../src/components/mediaEditor/mediaEditor.tsx","../src/components/mediaEditor/index.ts"],"sourcesContent":["import {AdjustmentKey} from '@components/mediaEditor/adjustments';\nimport {NumberPair} from '@components/mediaEditor/types';\n\nimport {RenderingPayload} from '@components/mediaEditor/webgl/initWebGL';\n\n\ntype DrawingParameters = {\n  rotation: number;\n  scale: number;\n  translation: NumberPair;\n  imageSize: NumberPair;\n  flip: NumberPair;\n} & Record<AdjustmentKey, number>;\n\nexport function draw(gl: WebGLRenderingContext, payload: RenderingPayload, parameters: DrawingParameters) {\n  gl.viewport(0, 0, gl.canvas.width, gl.canvas.height);\n\n  gl.clearColor(0.0, 0.0, 0.0, 1.0);\n  gl.clear(gl.COLOR_BUFFER_BIT);\n\n  gl.bindBuffer(gl.ARRAY_BUFFER, payload.buffers.position);\n  gl.vertexAttribPointer(payload.attribs.vertexPosition, 2, gl.FLOAT, false, 0, 0);\n  gl.enableVertexAttribArray(payload.attribs.vertexPosition);\n\n  gl.bindBuffer(gl.ARRAY_BUFFER, payload.buffers.texture);\n  gl.vertexAttribPointer(payload.attribs.textureCoord, 2, gl.FLOAT, false, 0, 0);\n  gl.enableVertexAttribArray(payload.attribs.textureCoord);\n\n  gl.useProgram(payload.program);\n\n  gl.activeTexture(gl.TEXTURE0);\n  gl.bindTexture(gl.TEXTURE_2D, payload.texture);\n  gl.uniform1i(payload.uniforms.uSampler, 0);\n\n  gl.uniform1f(payload.uniforms.uAngle, -parameters.rotation);\n  gl.uniform2f(payload.uniforms.uResolution, gl.canvas.width, gl.canvas.height);\n  gl.uniform1f(payload.uniforms.uScale, parameters.scale);\n  gl.uniform2fv(payload.uniforms.uTranslation, parameters.translation);\n  gl.uniform2fv(payload.uniforms.uImageSize, parameters.imageSize);\n  gl.uniform2fv(payload.uniforms.uFlip, parameters.flip);\n\n  gl.uniform1f(payload.uniforms.uSaturation, parameters.saturation);\n  gl.uniform1f(payload.uniforms.uBrightness, parameters.brightness);\n  gl.uniform1f(payload.uniforms.uContrast, parameters.contrast);\n  gl.uniform1f(payload.uniforms.uWarmth, parameters.warmth);\n  gl.uniform1f(payload.uniforms.uFade, parameters.fade);\n  gl.uniform1f(payload.uniforms.uShadows, parameters.shadows);\n  gl.uniform1f(payload.uniforms.uHighlights, parameters.highlights);\n  gl.uniform1f(payload.uniforms.uVignette, parameters.vignette);\n  gl.uniform1f(payload.uniforms.uGrain, parameters.grain);\n  gl.uniform1f(payload.uniforms.uSharpen, parameters.sharpen);\n  gl.uniform1f(payload.uniforms.uEnhance, parameters.enhance);\n\n  gl.drawArrays(gl.TRIANGLE_STRIP, 0, 4);\n}\n","export function initPositionBuffer(gl: WebGLRenderingContext, width: number, height: number) {\n  const positionBuffer = gl.createBuffer();\n  gl.bindBuffer(gl.ARRAY_BUFFER, positionBuffer);\n\n  const positions = [0, 0, width, 0, 0, height, width, height];\n  gl.bufferData(gl.ARRAY_BUFFER, new Float32Array(positions), gl.STATIC_DRAW);\n\n  return positionBuffer;\n}\n\nexport function initTextureBuffer(gl: WebGLRenderingContext) {\n  const textureCoordBuffer = gl.createBuffer();\n  gl.bindBuffer(gl.ARRAY_BUFFER, textureCoordBuffer);\n\n  const textureCoordinates = [0.0, 0.0, 1.0, 0.0, 0.0, 1.0, 1.0, 1.0];\n  gl.bufferData(gl.ARRAY_BUFFER, new Float32Array(textureCoordinates), gl.STATIC_DRAW);\n\n  return textureCoordBuffer;\n}\n","import {log} from '@components/mediaEditor/utils';\n\nexport function initShaderProgram(gl: WebGLRenderingContext, vsSource: string, fsSource: string) {\n  const vertexShader = loadShader(gl, gl.VERTEX_SHADER, vsSource);\n  const fragmentShader = loadShader(gl, gl.FRAGMENT_SHADER, fsSource);\n\n  const shaderProgram = gl.createProgram();\n  gl.attachShader(shaderProgram, vertexShader);\n  gl.attachShader(shaderProgram, fragmentShader);\n  gl.linkProgram(shaderProgram);\n\n  if(!gl.getProgramParameter(shaderProgram, gl.LINK_STATUS)) {\n    log.error(`Unable to initialize the shader program: ${gl.getProgramInfoLog(shaderProgram)}`);\n    return null;\n  }\n\n  return shaderProgram;\n}\n\nfunction loadShader(gl: WebGLRenderingContext, type: GLenum, source: string) {\n  const shader = gl.createShader(type);\n\n  gl.shaderSource(shader, source);\n  gl.compileShader(shader);\n\n  if(!gl.getShaderParameter(shader, gl.COMPILE_STATUS)) {\n    log.error(`An error occurred compiling the shaders: ${gl.getShaderInfoLog(shader)}`);\n    gl.deleteShader(shader);\n    return null;\n  }\n\n  return shader;\n}\n","import deferredPromise from '@helpers/cancellablePromise';\nimport createVideo from '@helpers/dom/createVideo';\nimport handleVideoLeak from '@helpers/dom/handleVideoLeak';\nimport {Middleware} from '@helpers/middleware';\nimport onMediaLoad from '@helpers/onMediaLoad';\n\n\ntype Options = {\n  /**\n   * [0, 1] will be multiplied by duration\n   */\n  currentTime?: number;\n  muted?: boolean;\n  waitToSeek?: boolean;\n  middleware?: Middleware;\n};\n\nconst weakRefs: WeakRef<any>[] = [];\n\n\n// TODO: The video nodes themselves remain references somewhere, but they're src is cleaned up WTF\n(window as any).derefMediaEditorVideos = () => {\n  console.log('Dereffed weak refs ::>> ', weakRefs.map(r => r.deref()));\n}\n\nexport default async function createVideoForDrawing(mediaSrc: string, options: Options = {}) {\n  const currentTime = options.currentTime ?? 0;\n  const waitToSeek = options.waitToSeek ?? true;\n  const muted = options.muted ?? true;\n\n  const video = createVideo({pip: false, middleware: options.middleware});\n  video.src = mediaSrc;\n  video.autoplay = true;\n  video.controls = false;\n  video.muted = true; // prevent sound playing while we're waiting for metadata\n\n  weakRefs.push(new WeakRef(video));\n\n  let timeout: number;\n\n  video.addEventListener('timeupdate', () => {\n    video.pause();\n  }, {once: true});\n\n  // Theoretically we should not have any errors here as this is handled in the media popup\n  try {\n    const promise = onMediaLoad(video);\n    await handleVideoLeak(video, promise);\n\n    if(waitToSeek) {\n      const deferred = deferredPromise<void>();\n      video.addEventListener('seeked', () => void deferred.resolve(), {once: true});\n      timeout = self.setTimeout(() => deferred.resolve(), 500); // just in case\n\n      video.currentTime = video.duration * currentTime;\n\n      await deferred;\n      self.clearTimeout(timeout);\n    }\n  } catch(e) {\n    console.error(e);\n  }\n\n\n  if(!muted) video.muted = false;\n\n  return video;\n}\n","import deferredPromise from '@helpers/cancellablePromise';\nimport {Middleware} from '@helpers/middleware';\nimport createVideoForDrawing from '@components/mediaEditor/canvas/createVideoForDrawing';\nimport {MediaType} from '@components/mediaEditor/types';\n\n\ntype LoadTextureArgs = {\n  gl: WebGLRenderingContext;\n  mediaSrc: string;\n  mediaType: MediaType;\n  videoTime: number;\n  waitToSeek?: boolean;\n\n  middleware?: Middleware;\n};\n\ntype LoadTextureMedia = {\n  width: number;\n  height: number;\n  image?: HTMLImageElement;\n  video?: HTMLVideoElement;\n};\n\ntype LoadTextureResult = {\n  texture: WebGLTexture;\n  media: LoadTextureMedia;\n};\n\nexport async function loadTexture({gl, mediaSrc, mediaType, videoTime, waitToSeek, middleware}: LoadTextureArgs): Promise<LoadTextureResult> {\n  const texture = gl.createTexture();\n  gl.bindTexture(gl.TEXTURE_2D, texture);\n\n  let media: LoadTextureMedia;\n\n  if(mediaType === 'image') {\n    const image = new Image();\n    image.src = mediaSrc;\n\n    const deferred = deferredPromise<void>();\n    image.addEventListener('load', () => void deferred.resolve());\n    await deferred;\n\n    media = {\n      image,\n      width: image.naturalWidth,\n      height: image.naturalHeight\n    };\n  } else {\n    const video = await createVideoForDrawing(mediaSrc, {currentTime: videoTime, waitToSeek, middleware});\n\n    media = {\n      video,\n      width: video.videoWidth,\n      height: video.videoHeight\n    };\n  }\n\n  gl.bindTexture(gl.TEXTURE_2D, texture);\n  gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, gl.RGBA, gl.UNSIGNED_BYTE, media.video || media.image);\n\n  gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\n  gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\n  gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR);\n  gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.LINEAR);\n\n  return {media, texture};\n}\n","import {Middleware} from '@helpers/middleware';\nimport {adjustmentsConfig, AdjustmentsConfig} from '@components/mediaEditor/adjustments';\nimport {MediaType} from '@components/mediaEditor/types';\n\nimport {initPositionBuffer, initTextureBuffer} from '@components/mediaEditor/webgl/initBuffers';\nimport {initShaderProgram} from '@components/mediaEditor/webgl/initShaderProgram';\nimport {loadTexture} from '@components/mediaEditor/webgl/loadTexture';\n\nexport type RenderingPayload = Awaited<ReturnType<typeof initWebGL>>;\n\ntype InitWebGLArgs = {\n  gl: WebGLRenderingContext;\n  mediaSrc: string;\n  mediaType: MediaType;\n  videoTime: number;\n  waitToSeek?: boolean;\n\n  middleware?: Middleware;\n};\n\nexport async function initWebGL({gl, mediaSrc, mediaType, videoTime, waitToSeek, middleware}: InitWebGLArgs) {\n  const [{vertexShaderSource, fragmentShaderSource}, {texture, media}] = await Promise.all([\n    import('./shaderSources'),\n    loadTexture({gl, mediaSrc, mediaType, videoTime, waitToSeek, middleware})\n  ]);\n\n  const shaderProgram = initShaderProgram(gl, vertexShaderSource, fragmentShaderSource);\n\n  const buffers = {\n    position: initPositionBuffer(gl, media.width, media.height),\n    texture: initTextureBuffer(gl)\n  };\n\n  return {\n    program: shaderProgram,\n    buffers,\n    media,\n    texture,\n    attribs: {\n      vertexPosition: gl.getAttribLocation(shaderProgram, 'aVertexPosition'),\n      textureCoord: gl.getAttribLocation(shaderProgram, 'aTextureCoord')\n    },\n    uniforms: {\n      uSampler: gl.getUniformLocation(shaderProgram, 'uSampler'),\n      uFlip: gl.getUniformLocation(shaderProgram, 'uFlip'),\n      uAngle: gl.getUniformLocation(shaderProgram, 'uAngle'),\n      uResolution: gl.getUniformLocation(shaderProgram, 'uResolution'),\n      uTranslation: gl.getUniformLocation(shaderProgram, 'uTranslation'),\n      uScale: gl.getUniformLocation(shaderProgram, 'uScale'),\n      uImageSize: gl.getUniformLocation(shaderProgram, 'uImageSize'),\n      ...(Object.fromEntries(\n        adjustmentsConfig.map(({uniform}) => [uniform, gl.getUniformLocation(shaderProgram, uniform)])\n      ) as Record<AdjustmentsConfig[number]['uniform'], WebGLUniformLocation>)\n    }\n  };\n}\n","import {animateValue} from '@helpers/animateValue';\nimport deferredPromise from '@helpers/cancellablePromise';\nimport {hexaToRgba} from '@helpers/color';\nimport {NumberPair} from '@components/mediaEditor/types';\nimport {distance} from '@components/mediaEditor/utils';\n\n\nexport type BrushDrawnLine = {\n  color: string;\n  brush: string;\n  size: number;\n  points: NumberPair[];\n};\n\ntype BrushPainterOptions = {\n  targetCanvas: HTMLCanvasElement;\n  imageCanvas: HTMLCanvasElement;\n  blurAmount?: number;\n};\n\nexport default class BrushPainter {\n  private imageCanvas: HTMLCanvasElement;\n  private cacheCanvas: HTMLCanvasElement;\n  private blurredImageCanvas: HTMLCanvasElement;\n  private blurredLineCanvas: HTMLCanvasElement;\n\n  private targetCtx: CanvasRenderingContext2D;\n  private cacheCtx: CanvasRenderingContext2D;\n  private blurredImageCtx: CanvasRenderingContext2D;\n  private blurredLineCtx: CanvasRenderingContext2D;\n\n  private width: number;\n  private height: number;\n\n  private blurAmount: number;\n\n  static defaultBlurAmount = 10;\n\n  constructor({targetCanvas, imageCanvas, blurAmount = BrushPainter.defaultBlurAmount}: BrushPainterOptions) {\n    this.targetCtx = targetCanvas.getContext('2d');\n    this.imageCanvas = imageCanvas;\n    this.blurAmount = blurAmount;\n\n    this.cacheCanvas = document.createElement('canvas');\n    this.blurredImageCanvas = document.createElement('canvas');\n    this.blurredLineCanvas = document.createElement('canvas');\n\n    this.width =\n      this.cacheCanvas.width =\n      this.blurredImageCanvas.width =\n      this.blurredLineCanvas.width =\n        targetCanvas.width;\n    this.height =\n      this.cacheCanvas.height =\n      this.blurredImageCanvas.height =\n      this.blurredLineCanvas.height =\n        targetCanvas.height;\n\n    this.cacheCtx = this.cacheCanvas.getContext('2d');\n    this.blurredImageCtx = this.blurredImageCanvas.getContext('2d');\n    this.blurredLineCtx = this.blurredLineCanvas.getContext('2d');\n  }\n\n  previewLine(line: BrushDrawnLine, shouldFinish = false) {\n    this.targetCtx.clearRect(0, 0, this.width, this.height);\n\n    this.targetCtx.drawImage(this.cacheCanvas, 0, 0);\n    const brushFn = this.brushes[line.brush];\n    this.targetCtx.save();\n    brushFn(line, this.targetCtx, shouldFinish);\n    this.targetCtx.restore();\n  }\n\n  saveLastLine() {\n    this.cacheCtx.clearRect(0, 0, this.width, this.height);\n    this.cacheCtx.drawImage(this.targetCtx.canvas, 0, 0);\n    this.updateBlurredImage();\n  }\n\n  updateBlurredImage() {\n    this.blurredImageCtx.clearRect(0, 0, this.width, this.height);\n    this.blurredImageCtx.filter = `blur(${this.blurAmount}px)`;\n    this.blurredImageCtx.drawImage(this.imageCanvas, 0, 0, this.width, this.height);\n\n    this.blurredImageCtx.drawImage(this.cacheCanvas, 0, 0);\n  }\n\n  drawLine(line: BrushDrawnLine) {\n    this.previewLine(line, true);\n    this.saveLastLine();\n  }\n\n  clear() {\n    this.targetCtx.clearRect(0, 0, this.width, this.height);\n    this.cacheCtx.clearRect(0, 0, this.width, this.height);\n  }\n\n  private drawLinePath(line: BrushDrawnLine, ctx: CanvasRenderingContext2D) {\n    const {points} = line;\n    if(!points.length) return;\n\n    if(points.length === 1) {\n      ctx.fillStyle = ctx.strokeStyle;\n      ctx.beginPath();\n      ctx.arc(points[0][0], points[0][1], line.size / 2, 0, 2 * Math.PI);\n      ctx.fill();\n      return;\n    }\n\n    ctx.lineWidth = line.size;\n    ctx.lineCap = 'round';\n    ctx.lineJoin = 'round';\n\n    ctx.beginPath();\n    ctx.moveTo(points[0][0], points[0][1]);\n\n    for(let i = 1; i < points.length - 2; i++) {\n      const cx = (points[i][0] + points[i + 1][0]) / 2;\n      const cy = (points[i][1] + points[i + 1][1]) / 2;\n      ctx.quadraticCurveTo(points[i][0], points[i][1], cx, cy);\n    }\n\n    const i = points.length - 1;\n    ctx.quadraticCurveTo(points[i - 1][0], points[i - 1][1], points[i][0], points[i][1]);\n\n    ctx.stroke();\n  }\n\n  private getArrowHeadLength(line: BrushDrawnLine) {\n    return Math.sqrt(line.size) + line.size * 2.5;\n  }\n\n  private drawArrowHead(ctx: CanvasRenderingContext2D, line: BrushDrawnLine, arrowLength: number) {\n    const {points} = line;\n    if(points.length < 2) return;\n\n    const i = points.length - 1;\n\n    let i2 = i;\n    for(; i2 > 0; i2--) {\n      if(distance(points[i], points[i2]) > line.size * 0.5) break;\n    }\n\n    const angle = Math.atan2(points[i][0] - points[i2][0], points[i][1] - points[i2][1]) + Math.PI;\n\n    const angle1 = angle + Math.PI / 4;\n    const angle2 = angle - Math.PI / 4;\n\n    const vec1 = [arrowLength * Math.sin(angle1), arrowLength * Math.cos(angle1)];\n    const vec2 = [arrowLength * Math.sin(angle2), arrowLength * Math.cos(angle2)];\n\n    ctx.strokeStyle = line.color;\n    ctx.lineWidth = line.size;\n    ctx.lineCap = 'round';\n    ctx.lineJoin = 'round';\n\n    ctx.beginPath();\n    ctx.moveTo(points[i][0], points[i][1]);\n    ctx.lineTo(points[i][0] + vec1[0], points[i][1] + vec1[1]);\n    ctx.moveTo(points[i][0], points[i][1]);\n    ctx.lineTo(points[i][0] + vec2[0], points[i][1] + vec2[1]);\n    ctx.stroke();\n  }\n\n  async animateArrowBrush(line: BrushDrawnLine) {\n    const {points} = line;\n    if(points.length < 2) return;\n\n    const ctx = this.targetCtx;\n\n    const arrowLength = this.getArrowHeadLength(line);\n\n    const deferred = deferredPromise<void>();\n    animateValue(0.1, arrowLength, 120, (length) => this.drawArrowHead(ctx, line, length), {\n      onEnd: () => deferred.resolve()\n    });\n    await deferred;\n  }\n\n  private brushes: Record<\n    string,\n    (line: BrushDrawnLine, ctx: CanvasRenderingContext2D, shouldFinish: boolean) => void\n  > = {\n      pen: (line, ctx) => {\n        ctx.strokeStyle = line.color;\n        this.drawLinePath(line, ctx);\n      },\n      arrow: (line, ctx, shouldFinish) => {\n        const {points} = line;\n\n        ctx.strokeStyle = line.color;\n        this.drawLinePath(line, ctx);\n\n        if(!shouldFinish) return;\n        if(points.length < 2) return;\n\n        this.drawArrowHead(ctx, line, this.getArrowHeadLength(line));\n      },\n      brush: (line, ctx) => {\n        ctx.strokeStyle = `rgba(${hexaToRgba(line.color).join(',')},0.4)`;\n        this.drawLinePath(line, ctx);\n      },\n      neon: (line, ctx) => {\n        ctx.strokeStyle = '#ffffff';\n        ctx.shadowBlur = line.size;\n        ctx.shadowColor = line.color;\n        this.drawLinePath(line, ctx);\n      },\n      blur: (line, ctx) => {\n        const w = ctx.canvas.width,\n          h = ctx.canvas.height;\n\n        this.blurredLineCtx.clearRect(0, 0, w, h);\n\n        const {points} = line;\n        const pointsX = points.map((p) => p[0]);\n        const pointsY = points.map((p) => p[1]);\n        const minX = Math.max(Math.min(...pointsX) - line.size, 0),\n          maxX = Math.max(...pointsX) + line.size,\n          minY = Math.max(Math.min(...pointsY) - line.size, 0),\n          maxY = Math.max(...pointsY) + line.size;\n\n        this.blurredLineCtx.strokeStyle = 'white';\n        this.drawLinePath(line, this.blurredLineCtx);\n\n        this.blurredLineCtx.globalCompositeOperation = 'source-in';\n        this.blurredLineCtx.drawImage(this.blurredImageCanvas, 0, 0);\n\n        ctx.drawImage(this.blurredLineCanvas, minX, minY, maxX, maxY, minX, minY, maxX, maxY);\n        this.blurredLineCtx.globalCompositeOperation = 'source-over';\n      },\n      eraser: (line, ctx) => {\n        ctx.strokeStyle = 'white';\n        ctx.globalCompositeOperation = 'destination-out';\n        this.drawLinePath(line, ctx);\n        ctx.stroke();\n        ctx.globalCompositeOperation = 'source-over';\n      }\n    };\n}\n","import {createMemo} from 'solid-js';\n\nimport {useMediaEditorContext} from '@components/mediaEditor/context';\nimport {NumberPair} from '@components/mediaEditor/types';\n\n\nexport default function useNormalizePoint() {\n  const {editorState} = useMediaEditorContext();\n\n  const size = createMemo(() => editorState.canvasSize.map((x) => x * editorState.pixelRatio));\n\n  return (point: NumberPair) => {\n    const transform = editorState.finalTransform;\n    const [w, h] = size();\n\n    point = point.map((x) => x * editorState.pixelRatio) as NumberPair;\n\n    point = [\n      (point[0] - transform.translation[0] - w / 2) / transform.scale,\n      (point[1] - transform.translation[1] - h / 2) / transform.scale\n    ];\n    const r = [Math.sin(transform.rotation), Math.cos(transform.rotation)];\n    point = [point[0] * r[1] + point[1] * r[0], point[1] * r[1] - point[0] * r[0]];\n    return point;\n  };\n}\n","import {createMemo} from 'solid-js';\n\nimport {useMediaEditorContext} from '@components/mediaEditor/context';\nimport {NumberPair} from '@components/mediaEditor/types';\n\nexport default function useProcessPoint(densityAware = true) {\n  const {editorState} = useMediaEditorContext();\n\n  const size = createMemo(() => editorState.canvasSize.map((x) => x * editorState.pixelRatio));\n\n  return (point: NumberPair) => {\n    const [w, h] = size();\n\n    const transform = editorState.finalTransform;\n    const r = [Math.sin(-transform.rotation), Math.cos(-transform.rotation)];\n    point = [point[0] * r[1] + point[1] * r[0], point[1] * r[1] - point[0] * r[0]];\n    point = [\n      (point[0] * transform.scale + w / 2 + transform.translation[0]) / (densityAware ? 1 : editorState.pixelRatio),\n      (point[1] * transform.scale + h / 2 + transform.translation[1]) / (densityAware ? 1 : editorState.pixelRatio)\n    ];\n    return point;\n  };\n}\n","import {createEffect, createMemo, createSignal, on, onCleanup, onMount} from 'solid-js';\nimport createMiddleware from '@helpers/solid/createMiddleware';\nimport SwipeHandler from '@components/swipeHandler';\nimport {adjustmentsConfig, AdjustmentsConfig} from '@components/mediaEditor/adjustments';\nimport {HistoryItem, useMediaEditorContext} from '@components/mediaEditor/context';\nimport {NumberPair} from '@components/mediaEditor/types';\nimport {cleanupWebGl, distance} from '@components/mediaEditor/utils';\nimport {draw} from '@components/mediaEditor/webgl/draw';\nimport {initWebGL, RenderingPayload} from '@components/mediaEditor/webgl/initWebGL';\nimport BrushPainter, {BrushDrawnLine} from '@components/mediaEditor/canvas/brushPainter';\nimport useNormalizePoint from '@components/mediaEditor/canvas/useNormalizePoint';\nimport useProcessPoint from '@components/mediaEditor/canvas/useProcessPoint';\n\n\nfunction drawAdjustedImage(gl: WebGLRenderingContext, payload: RenderingPayload) {\n  const {mediaState} = useMediaEditorContext();\n\n  if(!payload) return;\n\n  draw(gl, payload, {\n    flip: mediaState.flip,\n    rotation: 0,\n    scale: 1,\n    translation: [0, 0],\n    imageSize: [payload.media.width, payload.media.height],\n    ...(Object.fromEntries(\n      adjustmentsConfig.map(({key, to100}) => {\n        const value = mediaState.adjustments[key];\n        return [key, value / (to100 ? 100 : 50)];\n      })\n    ) as Record<AdjustmentsConfig[number]['key'], number>)\n  });\n}\n\nexport default function BrushCanvas() {\n  const {editorState, mediaState, actions, mediaSrc, mediaType} = useMediaEditorContext();\n\n  const [fullImageGLPayload, setFullImageGLPayload] = createSignal<RenderingPayload>();\n\n  const normalizePoint = useNormalizePoint();\n  const processPoint = useProcessPoint();\n\n  function processLine(line: BrushDrawnLine): BrushDrawnLine {\n    const transform = editorState.finalTransform;\n    return {\n      ...line,\n      size: line.size * transform.scale,\n      points: line.points.map(processPoint)\n    };\n  }\n\n  const processedLines = createMemo(() => mediaState.brushDrawnLines.map(processLine));\n\n  const [lastLine, setLastLine] = createSignal<BrushDrawnLine>();\n\n  const canvas = (\n    <canvas\n      class=\"media-editor__brush-canvas\"\n      classList={{\n        'media-editor__brush-canvas--active': editorState.currentTab === 'brush'\n      }}\n      style={{\n        'opacity': editorState.isAdjusting ? 0 : 1\n      }}\n      width={editorState.canvasSize?.[0] * editorState.pixelRatio}\n      height={editorState.canvasSize?.[1] * editorState.pixelRatio}\n    ></canvas>\n  ) as HTMLCanvasElement;\n  const ctx = canvas.getContext('2d');\n\n  editorState.brushCanvas = canvas;\n\n  const fullImageMultiplier = () =>\n    Math.min(\n      editorState.canvasSize?.[0] / editorState.mediaSize?.[0],\n      editorState.canvasSize?.[1] / editorState.mediaSize?.[1]\n    ) * 2 * editorState.pixelRatio;\n\n  const fullImageCanvas = (<canvas width={editorState.mediaSize?.[0]} height={editorState.mediaSize?.[1]} />) as HTMLCanvasElement;\n  const gl = fullImageCanvas.getContext('webgl', {\n    preserveDrawingBuffer: true\n  });\n\n  const fullBrushesCanvas = (\n    <canvas width={editorState.mediaSize?.[0] * fullImageMultiplier()} height={editorState.mediaSize?.[1] * fullImageMultiplier()} />\n  ) as HTMLCanvasElement;\n\n  let brushPainter = new BrushPainter({\n    imageCanvas: editorState.imageCanvas,\n    targetCanvas: canvas\n  });\n\n  let fullBrushPainter: BrushPainter;\n\n  onMount(async() => {\n    if(mediaType !== 'image') return;\n    const middleware = createMiddleware().get();\n    setFullImageGLPayload(await initWebGL({gl, mediaSrc, mediaType, videoTime: 0, middleware}));\n  });\n\n  onCleanup(() => {\n    cleanupWebGl(gl);\n  });\n\n  createEffect(() => {\n    const payload = fullImageGLPayload();\n    drawAdjustedImage(gl, payload);\n  });\n\n  createEffect(on(fullImageGLPayload, () => {\n    const payload = fullImageGLPayload();\n    if(payload) setTimeout(() => redrawFull(), 100);\n  }));\n\n  createEffect(\n    on(() => editorState.canvasSize, () => {\n      brushPainter = new BrushPainter({\n        imageCanvas: editorState.imageCanvas,\n        targetCanvas: canvas\n      });\n      redraw();\n    })\n  );\n\n  function resetLastLine() {\n    setLastLine({\n      color: editorState.currentBrush.color,\n      brush: editorState.currentBrush.brush,\n      size: (editorState.currentBrush.size * editorState.pixelRatio) / editorState.finalTransform.scale,\n      points: []\n    });\n  }\n\n  createEffect(() => {\n    resetLastLine();\n  });\n\n  createEffect(() => {\n    if(editorState.isMoving) {\n      const transform = editorState.finalTransform;\n      ctx.clearRect(0, 0, canvas.width, canvas.height);\n      ctx.save();\n\n      ctx.translate(transform.translation[0] + canvas.width / 2, transform.translation[1] + canvas.height / 2);\n      ctx.rotate(transform.rotation);\n      ctx.scale(transform.scale, transform.scale);\n\n      const [w, h] = editorState.mediaSize;\n      ctx.drawImage(fullBrushesCanvas, -(w / 2), -(h / 2), w, h);\n\n      ctx.restore();\n    } else {\n      redraw();\n      redrawFull();\n    }\n  });\n\n  function redraw() {\n    brushPainter.clear();\n    brushPainter.saveLastLine();\n    processedLines().forEach((line) => brushPainter.drawLine(line));\n  }\n\n  function processLineForFullImage(line: BrushDrawnLine) {\n    return {\n      ...line,\n      size: line.size * fullImageMultiplier(),\n      points: line.points.map(\n        (point) =>\n          [\n            (point[0] + editorState.mediaSize?.[0] / 2) * fullImageMultiplier(),\n            (point[1] + editorState.mediaSize?.[1] / 2) * fullImageMultiplier()\n          ] as NumberPair\n      )\n    };\n  }\n\n  function redrawFull() {\n    if(!fullBrushPainter) return;\n\n    fullBrushPainter.clear();\n    fullBrushPainter.saveLastLine();\n\n    mediaState.brushDrawnLines.forEach((line) => fullBrushPainter.drawLine(processLineForFullImage(line)));\n  }\n\n  createEffect(\n    on(() => editorState.mediaSize, () => {\n      if(!editorState.mediaSize?.[0]) return;\n      fullBrushPainter = new BrushPainter({\n        imageCanvas: fullImageCanvas,\n        targetCanvas: fullBrushesCanvas,\n        blurAmount: BrushPainter.defaultBlurAmount * fullImageMultiplier()\n      });\n\n      redraw();\n      redrawFull();\n    })\n  );\n\n  createEffect(() => {\n    if(editorState.isAdjusting) {\n      onCleanup(() => {\n        redraw();\n        redrawFull();\n      });\n    }\n  });\n\n  actions.redrawBrushes = () => {\n    redraw();\n    redrawFull();\n  };\n  onCleanup(() => {\n    actions.redrawBrushes = () => {};\n  });\n\n  onMount(() => {\n    let initialPosition: NumberPair;\n    let points: NumberPair[] = [];\n\n    let builtUpDistance = 0;\n\n    function saveLastLine() {\n      mediaState.brushDrawnLines.push(lastLine());\n      actions.pushToHistory({\n        path: ['brushDrawnLines', mediaState.brushDrawnLines.length - 1],\n        newValue: lastLine(),\n        oldValue: HistoryItem.RemoveArrayItem\n      });\n\n      fullBrushPainter.updateBlurredImage();\n      fullBrushPainter.drawLine(processLineForFullImage(lastLine()));\n      resetLastLine();\n      brushPainter.saveLastLine();\n\n      points = [];\n      initialPosition = undefined;\n    }\n\n    function startSwipe(x: number, y: number) {\n      const bcr = canvas.getBoundingClientRect();\n\n      initialPosition = [x - bcr.left, y - bcr.top];\n      const point = normalizePoint(initialPosition);\n      points = [point];\n\n      setLastLine((prev) => ({...prev, points}));\n      brushPainter.updateBlurredImage();\n      brushPainter.previewLine(processLine(lastLine()));\n\n      editorState.selectedResizableLayer = undefined;\n    }\n\n    function endSwipe() {\n      if(points.length === 1) {\n        saveLastLine();\n      }\n    }\n\n    canvas.addEventListener('mousedown', (e) => {\n      startSwipe(e.clientX, e.clientY);\n    });\n    canvas.addEventListener('touchstart', (e) => {\n      startSwipe(e.touches[0].clientX, e.touches[0].clientY);\n    });\n\n    canvas.addEventListener('mouseup', () => {\n      endSwipe();\n    });\n    canvas.addEventListener('touchend', () => {\n      endSwipe();\n    });\n\n    const swipeHandler = new SwipeHandler({\n      element: canvas,\n      cursor: '',\n      onSwipe: (xDiff, yDiff, _e) => {\n        const point = normalizePoint([initialPosition[0] + xDiff, initialPosition[1] + yDiff]);\n\n        if(points.length > 0) {\n          const lastPoint = points[points.length - 1];\n          builtUpDistance += distance(processPoint(lastPoint), processPoint(point));\n        }\n        if(builtUpDistance < Math.min(lastLine().size, 12) * editorState.pixelRatio && points.length > 1) {\n          points[points.length - 1] = point;\n        } else {\n          points.push(point);\n          builtUpDistance = 0;\n        }\n\n        setLastLine((prev) => ({...prev, points}));\n        brushPainter.previewLine(processLine(lastLine()));\n      },\n      onReset() {\n        (async() => {\n          builtUpDistance = 0;\n          if(lastLine().brush === 'arrow') {\n            await brushPainter.animateArrowBrush(processLine(lastLine()));\n          }\n          saveLastLine();\n        })();\n      }\n    });\n\n    onCleanup(() => {\n      swipeHandler.removeListeners();\n    })\n  });\n\n  return <>{canvas}</>;\n}\n","import {useMediaEditorContext} from '@components/mediaEditor/context';\n\nexport function useCropOffset() {\n  const {editorState} = useMediaEditorContext();\n\n  return () => {\n    const {canvasSize} = editorState;\n    if(!canvasSize) return {left: 0, top: 0, width: 0, height: 0};\n\n    const w = canvasSize[0],\n      h = canvasSize[1];\n\n    return {\n      left: 60,\n      top: 60,\n      width: w - 120,\n      height: h - 180\n    };\n  };\n}\n","import {useMediaEditorContext} from '@components/mediaEditor/context';\nimport {snapToViewport} from '@components/mediaEditor/utils';\nimport {NumberPair} from '@components/mediaEditor/types';\n\nimport {useCropOffset} from '@components/mediaEditor/canvas/useCropOffset';\n\ntype Options = {\n  rotation: number;\n  translation: NumberPair;\n  scale: number;\n  extendCrop?: [NumberPair, NumberPair];\n};\n\nexport default function getConvenientPositioning({\n  scale,\n  translation,\n  rotation,\n  extendCrop = [\n    [0, 0],\n    [0, 0]\n  ]\n}: Options) {\n  const {editorState, mediaState} = useMediaEditorContext();\n\n  const cropOffset = useCropOffset();\n\n  const [w, h] = editorState.mediaSize;\n  const [imageWidth, imageHeight] = snapToViewport(w / h, cropOffset().width, cropOffset().height);\n\n  const imageLeftTop = [-imageWidth / 2, imageHeight / 2];\n\n  const imagePoints = [\n    [imageLeftTop[0], imageLeftTop[1]],\n    [imageLeftTop[0] + imageWidth, imageLeftTop[1]],\n    [imageLeftTop[0] + imageWidth, imageLeftTop[1] - imageHeight],\n    [imageLeftTop[0], imageLeftTop[1] - imageHeight]\n  ].map((point) => {\n    const r = [Math.sin(rotation), Math.cos(rotation)];\n    point = [point[0] * r[1] - point[1] * r[0], point[1] * r[1] + point[0] * r[0]].map((x) => x * scale);\n    point = [point[0] + translation[0], point[1] + translation[1]];\n    const r2 = [Math.sin(-rotation), Math.cos(-rotation)];\n    point = [point[0] * r2[1] - point[1] * r2[0], point[1] * r2[1] + point[0] * r2[0]];\n    return point;\n  });\n\n  const [cropWidth, cropHeight] = snapToViewport(mediaState.currentImageRatio, cropOffset().width, cropOffset().height);\n\n  const cropLeftTop = [-cropWidth / 2, cropHeight / 2];\n  const cropPoints = [\n    [cropLeftTop[0] + extendCrop[0][0], cropLeftTop[1] + extendCrop[0][1]],\n    [cropLeftTop[0] + cropWidth + extendCrop[1][0], cropLeftTop[1] + extendCrop[0][1]],\n    [cropLeftTop[0] + cropWidth + extendCrop[1][0], cropLeftTop[1] - cropHeight + extendCrop[1][1]],\n    [cropLeftTop[0] + extendCrop[0][0], cropLeftTop[1] - cropHeight + extendCrop[1][1]]\n  ].map((point) => {\n    const r = [Math.sin(-rotation), Math.cos(-rotation)];\n    return [point[0] * r[1] - point[1] * r[0], point[1] * r[1] + point[0] * r[0]];\n  });\n  const cropPointsX = cropPoints.map((p) => p[0]);\n  const cropPointsY = cropPoints.map((p) => p[1]);\n\n  return {\n    cropMinX: Math.min(...cropPointsX),\n    cropMaxX: Math.max(...cropPointsX),\n    cropMinY: Math.min(...cropPointsY),\n    cropMaxY: Math.max(...cropPointsY),\n    imageMinX: imagePoints[0][0],\n    imageMaxX: imagePoints[2][0],\n    imageMinY: imagePoints[2][1],\n    imageMaxY: imagePoints[0][1]\n  };\n}\n","import {batch, createEffect, createSignal, on, onCleanup, onMount} from 'solid-js';\nimport {modifyMutable, produce} from 'solid-js/store';\nimport {animateValue} from '@helpers/animateValue';\nimport {lerp, lerpArray} from '@helpers/lerp';\nimport SwipeHandler from '@components/swipeHandler';\nimport {useMediaEditorContext} from '@components/mediaEditor/context';\nimport {NumberPair} from '@components/mediaEditor/types';\nimport {snapToViewport, withCurrentOwner} from '@components/mediaEditor/utils';\nimport _getConvenientPositioning from '@components/mediaEditor/canvas/getConvenientPositioning';\nimport {useCropOffset} from '@components/mediaEditor/canvas/useCropOffset';\n\n\nconst MAX_SCALE = 20;\n\nexport default function CropHandles() {\n  const {editorState, mediaState} = useMediaEditorContext();\n\n  const isCropping = () => editorState.currentTab === 'crop';\n\n  const cropOffset = useCropOffset();\n\n  const [leftTop, setLeftTop] = createSignal([0, 0]);\n  const [leftTopDiff, setLeftTopDiff] = createSignal([0, 0]);\n  const [size, setSize] = createSignal([0, 0]);\n  const [diff, setDiff] = createSignal([0, 0]);\n\n  const getConvenientPositioning = withCurrentOwner(_getConvenientPositioning);\n\n  const getNewLeftTopAndSize = () => {\n    const [width, height] = snapToViewport(mediaState.currentImageRatio, cropOffset().width, cropOffset().height);\n\n    return {\n      leftTop: [\n        cropOffset().left + (cropOffset().width - width) / 2,\n        cropOffset().top + (cropOffset().height - height) / 2\n      ],\n      size: [width, height]\n    };\n  };\n\n  createEffect(\n    on(cropOffset, () => {\n      const {leftTop, size} = getNewLeftTopAndSize();\n      setLeftTop(leftTop);\n      setSize(size);\n    })\n  );\n\n  let cancelSizeAnimation: () => void;\n\n  function resetSizeWithAnimation() {\n    const initialDiff = diff();\n    const initialLeftTopDiff = leftTopDiff();\n    const initialLeftTop = leftTop();\n    const initialSize = size();\n\n    const targetDiff = [0, 0];\n    const targetLeftTopDiff = [0, 0];\n    const {leftTop: targetLeftTop, size: targetSize} = getNewLeftTopAndSize();\n\n    cancelSizeAnimation?.();\n\n    cancelSizeAnimation = animateValue(0, 1, 200, (progress) => {\n      batch(() => {\n        setDiff(lerpArray(initialDiff, targetDiff, progress) as NumberPair);\n        setLeftTopDiff(lerpArray(initialLeftTopDiff, targetLeftTopDiff, progress) as NumberPair);\n        setLeftTop(lerpArray(initialLeftTop, targetLeftTop, progress) as NumberPair);\n        setSize(lerpArray(initialSize, targetSize, progress) as NumberPair);\n      });\n    });\n  }\n\n  createEffect(\n    on(() => mediaState.currentImageRatio, () => {\n      resetSizeWithAnimation();\n    })\n  );\n\n  onMount(() => {\n    const multipliers = [\n      {el: leftTopHandle, left: -1, top: -1},\n      {el: rightTopHandle, left: 1, top: -1},\n      {el: leftBottomHandle, left: -1, top: 1},\n      {el: rightBottomHandle, left: 1, top: 1},\n\n      {el: leftHandle, left: -1, top: 0},\n      {el: topHandle, left: 0, top: -1},\n      {el: rightHandle, left: 1, top: 0},\n      {el: bottomHandle, left: 0, top: 1}\n    ];\n\n    let boundDiff: NumberPair;\n    let initialScale: number;\n    let initialTranslation: NumberPair;\n    let firstTarget: EventTarget;\n\n    const resizeSwipeHandlers = multipliers.map(({el, left, top}) => {\n      return new SwipeHandler({\n        element: el,\n        setCursorTo: document.body,\n        onStart() {\n          initialScale = mediaState.scale;\n          initialTranslation = mediaState.translation;\n          editorState.isMoving = true;\n\n          el.classList.add('media-editor__crop-handles-circle--anti-flicker');\n        },\n        onSwipe(xDiff, yDiff, e) {\n          if(!firstTarget) firstTarget = e.target;\n          if(firstTarget !== el) return;\n\n          const fixed = editorState.fixedImageRatioKey;\n          let ratio = mediaState.currentImageRatio;\n          if(left < 0) {\n            ratio = -ratio;\n          }\n          if(top < 0) {\n            ratio = -ratio;\n          }\n\n          const [w, h] = size();\n          const minW = Math.min(w, (cropOffset().width / MAX_SCALE) * Math.min(MAX_SCALE, initialScale));\n          const minH = Math.min(h, (cropOffset().height / MAX_SCALE) * Math.min(MAX_SCALE, initialScale));\n          xDiff = Math.max(xDiff * left, minW - w) * left;\n          yDiff = Math.max(yDiff * top, minH - h) * top;\n\n          if(fixed) {\n            if(top === 0) {\n              yDiff = xDiff / ratio;\n            } else if(left === 0) {\n              xDiff = yDiff * ratio;\n            } else {\n              const xd = xDiff;\n              xDiff = (xDiff + yDiff * ratio) / 2;\n              yDiff = (xd / ratio + yDiff) / 2;\n            }\n          }\n\n          if(fixed && top === 0) {\n            setDiff([left * xDiff, yDiff]);\n          } else if(fixed && left === 0) {\n            setDiff([xDiff, top * yDiff]);\n          } else {\n            setDiff([xDiff * left, yDiff * top]);\n          }\n\n          setLeftTopDiff([\n            fixed && left === 0 ? -xDiff / 2 : Number(left < 0) * xDiff,\n            fixed && top === 0 ? -yDiff / 2 : Number(top < 0) * yDiff\n          ]);\n          const {cropMinX, cropMaxX, cropMinY, cropMaxY, imageMinX, imageMaxX, imageMinY, imageMaxY} =\n            getConvenientPositioning({\n              scale: initialScale,\n              rotation: mediaState.rotation,\n              translation: initialTranslation,\n              extendCrop: [\n                [\n                  fixed && left === 0 ? -xDiff / 2 : left === -1 ? xDiff : 0,\n                  fixed && top === 0 ? yDiff / 2 : top === 1 ? yDiff : 0\n                ],\n                [\n                  fixed && left === 0 ? xDiff / 2 : left === 1 ? xDiff : 0,\n                  fixed && top === 0 ? -yDiff / 2 : top === -1 ? yDiff : 0\n                ]\n              ]\n            });\n          const halfImageWidth = (imageMaxX - imageMinX) / 2,\n            halfImageHeight = (imageMaxY - imageMinY) / 2;\n          const imageCenter = [imageMinX + halfImageWidth, imageMinY + halfImageHeight];\n\n          let additionalScaleX = 1;\n          let additionalScaleY = 1;\n\n          if(imageMinX > cropMinX) additionalScaleX *= 1 + ((imageCenter[0] - cropMinX) / halfImageWidth - 1) / 2;\n          if(imageMaxX < cropMaxX) additionalScaleX *= 1 + ((cropMaxX - imageCenter[0]) / halfImageWidth - 1) / 2;\n          if(imageMinY > cropMinY) additionalScaleY *= 1 + ((imageCenter[1] - cropMinY) / halfImageHeight - 1) / 2;\n          if(imageMaxY < cropMaxY) additionalScaleY *= 1 + ((cropMaxY - imageCenter[1]) / halfImageHeight - 1) / 2;\n\n          const additionalScale = Math.max(additionalScaleX, additionalScaleY);\n          if(additionalScale > 1) {\n            mediaState.scale = initialScale * additionalScale;\n          }\n\n          let boundDiff = [0, 0];\n\n          if(imageMinX > cropMinX) boundDiff[0] += imageMinX - cropMinX;\n          if(imageMaxX < cropMaxX) boundDiff[0] += imageMaxX - cropMaxX;\n          if(imageMinY > cropMinY) boundDiff[1] += imageMinY - cropMinY;\n          if(imageMaxY < cropMaxY) boundDiff[1] += imageMaxY - cropMaxY;\n\n          const r = [Math.sin(mediaState.rotation), Math.cos(mediaState.rotation)];\n\n          boundDiff = [boundDiff[0] * r[1] - boundDiff[1] * r[0], boundDiff[1] * r[1] + boundDiff[0] * r[0]];\n\n          mediaState.translation = [initialTranslation[0] - boundDiff[0] / 2, initialTranslation[1] - boundDiff[1] / 2];\n        },\n        onReset() {\n          if(firstTarget !== el) return (firstTarget = undefined);\n          firstTarget = undefined;\n\n          const newWidth = size()[0] + diff()[0],\n            newHeight = size()[1] + diff()[1];\n          const newRatio = newWidth / newHeight;\n\n          const upScale = Math.min(cropOffset().width / newWidth, cropOffset().height / newHeight);\n          mediaState.currentImageRatio = newRatio;\n          resetSizeWithAnimation();\n\n          const initialScale = mediaState.scale;\n          const initialTranslation = mediaState.translation;\n\n          const targetScale = mediaState.scale * upScale;\n          const targetTranslation = [\n            upScale * (mediaState.translation[0] + -diff()[0] * left * 0.5),\n            upScale * (mediaState.translation[1] + -diff()[1] * top * 0.5)\n          ];\n\n          animateValue(\n            0,\n            1,\n            200,\n            (progress) => {\n              modifyMutable(mediaState, produce((state) => {\n                state.scale = lerp(initialScale, targetScale, progress);\n                state.translation = lerpArray(initialTranslation, targetTranslation, progress) as NumberPair;\n              }));\n            },\n            {\n              onEnd: () => editorState.isMoving = false\n            }\n          );\n\n          el.classList.remove('media-editor__crop-handles-circle--anti-flicker');\n        }\n      });\n    });\n\n    const translationSwipeHandler = new SwipeHandler({\n      element: cropArea,\n      onStart() {\n        initialTranslation = mediaState.translation;\n        editorState.isMoving = true;\n      },\n      onSwipe(xDiff, yDiff, e) {\n        if(!firstTarget) firstTarget = e.target;\n        if(firstTarget !== cropArea) return;\n\n        const {cropMinX, cropMaxX, cropMinY, cropMaxY, imageMinX, imageMaxX, imageMinY, imageMaxY} =\n          getConvenientPositioning({\n            scale: mediaState.scale,\n            rotation: mediaState.rotation,\n            translation: [initialTranslation[0] + xDiff, initialTranslation[1] + yDiff]\n          });\n\n        boundDiff = [0, 0];\n\n        if(imageMinX > cropMinX) boundDiff[0] = imageMinX - cropMinX;\n        if(imageMaxX < cropMaxX) boundDiff[0] = imageMaxX - cropMaxX;\n        if(imageMinY > cropMinY) boundDiff[1] = imageMinY - cropMinY;\n        if(imageMaxY < cropMaxY) boundDiff[1] = imageMaxY - cropMaxY;\n\n        const r = [Math.sin(mediaState.rotation), Math.cos(mediaState.rotation)];\n\n        boundDiff = [boundDiff[0] * r[1] - boundDiff[1] * r[0], boundDiff[1] * r[1] + boundDiff[0] * r[0]];\n\n        const resistance = 4;\n        mediaState.translation = [\n          initialTranslation[0] + xDiff - (boundDiff[0] - boundDiff[0] / resistance),\n          initialTranslation[1] + yDiff - (boundDiff[1] - boundDiff[1] / resistance)\n        ]\n        boundDiff = [boundDiff[0] / resistance, boundDiff[1] / resistance];\n      },\n      onReset() {\n        if(firstTarget !== cropArea) return (firstTarget = undefined);\n        firstTarget = undefined;\n\n        const prevTranslation = mediaState.translation;\n        animateValue(\n          prevTranslation,\n          [prevTranslation[0] - boundDiff[0], prevTranslation[1] - boundDiff[1]] as const,\n          120,\n          (value) => mediaState.translation = value,\n          {\n            onEnd: () => editorState.isMoving = false\n          }\n        );\n      }\n    });\n\n    onCleanup(() => {\n      resizeSwipeHandlers.forEach((handler) => handler.removeListeners());\n      translationSwipeHandler.removeListeners();\n    });\n  });\n\n  const left = () => leftTop()[0] + leftTopDiff()[0];\n  const top = () => leftTop()[1] + leftTopDiff()[1];\n  const width = () => size()[0] + diff()[0];\n  const height = () => size()[1] + diff()[1];\n  const right = () => left() + width();\n  const bottom = () => top() + height();\n\n  const croppedSizeFull = () => {\n    const [cw, ch] = editorState.canvasSize;\n    let [w, h] = [cw, ch];\n    const ratio = mediaState.currentImageRatio;\n\n    if(w / ratio > h) w = h * ratio;\n    else h = w / ratio;\n\n    return [(cw - w) / 2, (ch - h) / 2];\n  };\n\n  let cropArea: HTMLDivElement;\n\n  let leftTopHandle: HTMLDivElement;\n  let rightTopHandle: HTMLDivElement;\n  let leftBottomHandle: HTMLDivElement;\n  let rightBottomHandle: HTMLDivElement;\n\n  let leftHandle: HTMLDivElement;\n  let topHandle: HTMLDivElement;\n  let rightHandle: HTMLDivElement;\n  let bottomHandle: HTMLDivElement;\n\n  const coverAnimatedStyle = () =>\n    ({\n      'transition': 'opacity 0.2s',\n      'transition-timing-function': isCropping() ? 'ease-in' : 'ease-out',\n      'pointer-events': isCropping() ? 'none' : undefined,\n      'opacity': isCropping() ? 0 : 1\n    }) as const;\n\n  const controlsAnimatedStyle = () =>\n    ({\n      'transition': 'transform 0.2s, opacity 0.2s',\n      'transition-timing-function': isCropping() ? 'ease-out' : 'ease-in',\n      'pointer-events': isCropping() ? undefined : 'none',\n      'opacity': isCropping() ? 1 : 0,\n      'transform': isCropping() ? undefined : 'scale(1.05)'\n    }) as const;\n\n  return (\n    <>\n      <div\n        style={{\n          background: 'black',\n          position: 'absolute',\n          left: '0px',\n          top: '0px',\n          width: '100%',\n          height: croppedSizeFull()[1] + 'px',\n          ...coverAnimatedStyle()\n        }}\n      ></div>\n      <div\n        style={{\n          background: 'black',\n          position: 'absolute',\n          left: '0px',\n          bottom: '0px',\n          width: '100%',\n          height: croppedSizeFull()[1] + 'px',\n          ...coverAnimatedStyle()\n        }}\n      ></div>\n      <div\n        style={{\n          background: 'black',\n          position: 'absolute',\n          left: '0px',\n          top: '0px',\n          height: '100%',\n          width: croppedSizeFull()[0] + 'px',\n          ...coverAnimatedStyle()\n        }}\n      ></div>\n      <div\n        style={{\n          background: 'black',\n          position: 'absolute',\n          right: '0px',\n          top: '0px',\n          height: '100%',\n          width: croppedSizeFull()[0] + 'px',\n          ...coverAnimatedStyle()\n        }}\n      ></div>\n      <div\n        style={{\n          position: 'absolute',\n          right: '0px',\n          top: '0px',\n          height: '100%',\n          width: '100%',\n          overflow: 'hidden',\n          ...controlsAnimatedStyle()\n        }}\n      >\n        <div\n          class=\"media-editor__crop-handles-backdrop\"\n          style={{\n            ['clip-path']: `polygon(\n              0 0, 0 100%,\n              ${left()}px 100%, ${left()}px ${top()}px, ${right()}px ${top()}px,\n              ${right()}px ${bottom()}px, ${left()}px ${bottom()}px, ${left()}px 100%,\n              100% 100%, 100% 0%\n            )`\n          }}\n        />\n        <div\n          ref={cropArea}\n          class=\"media-editor__crop-handles\"\n          style={{\n            left: left() + 'px',\n            top: top() + 'px',\n            width: width() + 'px',\n            height: height() + 'px'\n          }}\n        >\n          <div class=\"media-editor__crop-handles-line-h\" style={{top: '33%'}} />\n          <div class=\"media-editor__crop-handles-line-h\" style={{top: '66%'}} />\n          <div class=\"media-editor__crop-handles-line-v\" style={{left: '33%'}} />\n          <div class=\"media-editor__crop-handles-line-v\" style={{left: '66%'}} />\n\n          <div ref={leftHandle} class=\"media-editor__crop-handles-side media-editor__crop-handles-side--w\" />\n          <div ref={topHandle} class=\"media-editor__crop-handles-side media-editor__crop-handles-side--n\" />\n          <div ref={rightHandle} class=\"media-editor__crop-handles-side media-editor__crop-handles-side--e\" />\n          <div ref={bottomHandle} class=\"media-editor__crop-handles-side media-editor__crop-handles-side--s\" />\n\n          <div ref={leftTopHandle} class=\"media-editor__crop-handles-circle media-editor__crop-handles-circle--nw\" />\n          <div ref={rightTopHandle} class=\"media-editor__crop-handles-circle media-editor__crop-handles-circle--ne\" />\n          <div ref={leftBottomHandle} class=\"media-editor__crop-handles-circle media-editor__crop-handles-circle--sw\" />\n          <div\n            ref={rightBottomHandle}\n            class=\"media-editor__crop-handles-circle media-editor__crop-handles-circle--se\"\n          />\n        </div>\n      </div>\n    </>\n  );\n}\n","import {createEffect, onCleanup} from 'solid-js';\nimport {animate} from '@helpers/animation';\nimport clamp from '@helpers/number/clamp';\nimport {SetVideoTimeFlags, useMediaEditorContext} from '@components/mediaEditor/context';\n\n\ntype Args = {\n  gl: WebGLRenderingContext;\n  drawAdjustedImage: () => void;\n};\n\nexport default function initVideoPlayback({gl, drawAdjustedImage}: Args) {\n  const {editorState, mediaState, actions} = useMediaEditorContext();\n  const {renderingPayload} = editorState;\n  const video = renderingPayload.media.video;\n\n  if(!video) return;\n\n  // We don't want this 'seeked' event to be fired when generating the final result\n  let pendingSeek = false;\n\n  actions.setVideoTime = (time: number, flags = SetVideoTimeFlags.Redraw | SetVideoTimeFlags.UpdateVideo | SetVideoTimeFlags.UpdateCursor) => {\n    if(flags & SetVideoTimeFlags.UpdateCursor) mediaState.currentVideoTime = time;\n    if(flags & SetVideoTimeFlags.UpdateVideo) video.currentTime = time * video.duration;\n    if(flags & SetVideoTimeFlags.Redraw) pendingSeek = true;\n  };\n\n  const seekListener = () => {\n    if(!pendingSeek) return;\n    pendingSeek = false;\n\n    gl.bindTexture(gl.TEXTURE_2D, renderingPayload.texture);\n    gl.texSubImage2D(gl.TEXTURE_2D, 0, 0, 0, gl.RGBA, gl.UNSIGNED_BYTE, video);\n\n    drawAdjustedImage();\n  };\n\n  video.addEventListener('seeked', seekListener);\n  onCleanup(() => {\n    video.removeEventListener('seeked', seekListener);\n  });\n\n\n  createEffect(() => {\n    if(editorState.currentTab !== 'adjustments') return;\n\n    const listener = (event: KeyboardEvent) => {\n      const el = (event.target as HTMLElement);\n\n      if(event.code === 'Space' && !el.isContentEditable) {\n        event.preventDefault(); // stop page from scrolling, idk if needed\n        editorState.isPlaying = !editorState.isPlaying;\n      }\n    };\n\n    document.addEventListener('keydown', listener);\n\n    onCleanup(() => {\n      editorState.isPlaying = false;\n      document.removeEventListener('keydown', listener);\n    });\n  });\n\n  createEffect(() => {\n    video.muted = mediaState.videoMuted;\n  });\n\n  createEffect(() => {\n    if(!editorState.isPlaying) return;\n\n    let\n      frameCallbackId: number,\n      playing = true,\n      skip = 0\n    ;\n\n    function frameCallback() {\n      gl.bindTexture(gl.TEXTURE_2D, renderingPayload.texture);\n      gl.texSubImage2D(gl.TEXTURE_2D, 0, 0, 0, gl.RGBA, gl.UNSIGNED_BYTE, video);\n\n      drawAdjustedImage();\n\n      frameCallbackId = video.requestVideoFrameCallback(() => frameCallback());\n    }\n\n    const timeout = self.setTimeout(() => {\n      if(mediaState.currentVideoTime >= mediaState.videoCropStart + mediaState.videoCropLength)\n        actions.setVideoTime(mediaState.videoCropStart);\n\n      frameCallbackId = video.requestVideoFrameCallback(frameCallback);\n      video.play();\n\n      animate(() => {\n        skip = (skip + 1) % 3;\n\n        if(skip) return true;\n        if(!playing) return false;\n\n        mediaState.currentVideoTime = video.currentTime / video.duration || 0;\n\n        if(video.ended || video.paused || mediaState.currentVideoTime >= mediaState.videoCropStart + mediaState.videoCropLength) {\n          playing = false;\n          editorState.isPlaying = false;\n          mediaState.currentVideoTime = clamp(mediaState.currentVideoTime, mediaState.videoCropStart, mediaState.videoCropStart + mediaState.videoCropLength);\n        }\n\n        return playing;\n      });\n    }, 200); // Let the pause/play icon animation finish as it might lag without this\n\n    onCleanup(() => {\n      playing = false;\n      self.clearTimeout(timeout);\n      video.cancelVideoFrameCallback(frameCallbackId);\n      video.pause();\n    });\n  });\n};\n","import {adjustmentsConfig, AdjustmentsConfig} from '@components/mediaEditor/adjustments';\nimport initVideoPlayback from '@components/mediaEditor/canvas/initVideoPlayback';\nimport {useMediaEditorContext} from '@components/mediaEditor/context';\nimport {cleanupWebGl, snapToAvailableQuality, withCurrentOwner} from '@components/mediaEditor/utils';\nimport {draw} from '@components/mediaEditor/webgl/draw';\nimport {initWebGL} from '@components/mediaEditor/webgl/initWebGL';\nimport createMiddleware from '@helpers/solid/createMiddleware';\nimport {batch, createEffect, createReaction, onCleanup, onMount} from 'solid-js';\n\n\nfunction drawAdjustedImage(gl: WebGLRenderingContext) {\n  const {editorState, mediaState} = useMediaEditorContext();\n\n  const payload = editorState.renderingPayload;\n  if(!payload) return;\n\n  draw(gl, payload, {\n    ...editorState.finalTransform,\n    imageSize: [payload.media.width, payload.media.height],\n    ...(Object.fromEntries(\n      adjustmentsConfig.map(({key, to100}) => {\n        const value = mediaState.adjustments[key];\n        return [key, value / (to100 ? 100 : 50)];\n      })\n    ) as Record<AdjustmentsConfig[number]['key'], number>)\n  });\n}\n\nexport default function ImageCanvas() {\n  const {editorState, mediaState, mediaSrc, mediaType, actions} = useMediaEditorContext();\n\n  const canvas = (\n    <canvas width={editorState.canvasSize[0] * editorState.pixelRatio} height={editorState.canvasSize[1] * editorState.pixelRatio} />\n  ) as HTMLCanvasElement;\n\n  const gl = canvas.getContext('webgl', {\n    preserveDrawingBuffer: true\n  });\n\n  editorState.imageCanvas = canvas;\n\n  const ownedDrawAdjustedImage = withCurrentOwner(() => drawAdjustedImage(gl));\n\n  const ownedInitVideoPlayback = withCurrentOwner(() =>\n    initVideoPlayback({gl, drawAdjustedImage: ownedDrawAdjustedImage})\n  );\n\n  const middleware = createMiddleware().get();\n\n  async function init() {\n    const payload = await initWebGL({gl, mediaSrc, mediaType, videoTime: mediaState.currentVideoTime, middleware});\n\n    batch(() => {\n      editorState.renderingPayload = payload;\n      editorState.mediaSize = [payload.media.width, payload.media.height];\n      editorState.mediaRatio = payload.media.width / payload.media.height;\n\n      if(!mediaState.videoQuality) {\n        const videoQuality = snapToAvailableQuality(payload.media.height);\n        actions.updateMediaStateClone(state => {\n          state.videoQuality = videoQuality;\n        });\n        mediaState.videoQuality = videoQuality;\n      }\n\n      if(!mediaState.currentImageRatio) {\n        const ratio = payload.media.width / payload.media.height;\n        actions.updateMediaStateClone(state => {\n          state.currentImageRatio = ratio;\n        });\n        mediaState.currentImageRatio = ratio;\n      }\n    });\n\n\n    ownedInitVideoPlayback();\n  }\n\n  onMount(() => {\n    if(editorState.isReady) init(); // When hot reloading\n    else {\n      const track = createReaction(() => {\n        init();\n      });\n\n      track(() => editorState.isReady);\n    }\n  });\n\n  createEffect(() => {\n    drawAdjustedImage(gl);\n  });\n\n  onCleanup(() => {\n    cleanupWebGl(gl);\n  });\n\n  return <>{canvas}</>;\n}\n","import {Show} from 'solid-js';\n\nimport {hexToRgb} from '@helpers/color';\n\nimport {useMediaEditorContext} from '@components/mediaEditor/context';\n\n\nconst PreviewBrushSize = () => {\n  const {editorState} = useMediaEditorContext();\n\n  return (\n    <Show when={editorState.previewBrushSize}>\n      <div\n        class=\"media-editor__preview-brush-size\"\n        style={{\n          '--color': !['blur', 'eraser'].includes(editorState.currentBrush.brush) ?\n            hexToRgb(editorState.currentBrush.color).join(',') :\n            undefined,\n          'width': editorState.previewBrushSize + 'px',\n          'height': editorState.previewBrushSize + 'px'\n        }}\n      />\n    </Show>\n  );\n};\n\nexport default PreviewBrushSize;\n","import {createSignal, onCleanup} from 'solid-js';\n\nfunction useMediaQuery(query: string) {\n  const [isMatch, setIsMatch] = createSignal(false);\n\n  const updateMatch = () => {\n    setIsMatch(window.matchMedia(query).matches);\n  };\n\n  const mediaQueryList = window.matchMedia(query);\n  setIsMatch(mediaQueryList.matches);\n\n  mediaQueryList.addEventListener('change', updateMatch);\n  onCleanup(() => {\n    mediaQueryList.removeEventListener('change', updateMatch);\n  });\n\n  return isMatch;\n}\n\nexport default function useIsMobile() {\n  const isMobile = useMediaQuery('(max-width: 800px');\n  return isMobile;\n}\n","import {onCleanup, onMount} from 'solid-js';\n\nimport createMiddleware from '@helpers/solid/createMiddleware';\nimport wrapSticker from '@components/wrappers/sticker';\n\nimport {useMediaEditorContext} from '@components/mediaEditor/context';\nimport {ResizableLayerProps} from '@components/mediaEditor/types';\n\nimport {ResizableContainer} from '@components/mediaEditor/canvas/resizableLayers';\n\nexport default function StickerLayerContent(props: ResizableLayerProps) {\n  const {editorState, canImageResultInGIF} = useMediaEditorContext();\n\n  let container: HTMLDivElement;\n\n  onMount(() => {\n    const middleware = createMiddleware();\n\n    wrapSticker({\n      div: container,\n      doc: props.layer.sticker,\n      group: 'none',\n      width: 500,\n      height: 500,\n      play: canImageResultInGIF,\n      loop: canImageResultInGIF,\n      withThumb: false,\n      middleware: middleware.get()\n    });\n\n    editorState.stickersLayersInfo[props.layer.id] = {container};\n\n    onCleanup(() => {\n      middleware.destroy();\n    });\n  });\n\n  const children = (\n    <div ref={container} class=\"media-editor__sticker-layer-content\" />\n  ); // Needs to be rendered here for hot reload to work properly\n\n  return (\n    <ResizableContainer layer={props.layer}>\n      {children}\n    </ResizableContainer>\n  );\n}\n","import {batch, createEffect, createMemo, on, onCleanup, onMount} from 'solid-js';\n\nimport createElementFromMarkup from '@helpers/createElementFromMarkup';\nimport {i18n} from '@lib/langPack';\n\nimport {ResizableLayerProps, TextLayerInfo, TextRenderingInfoLine} from '@components/mediaEditor/types';\nimport {fontInfoMap, getContrastColor, log} from '@components/mediaEditor/utils';\nimport {HistoryItem, useMediaEditorContext} from '@components/mediaEditor/context';\n\nimport {ResizableContainer} from '@components/mediaEditor/canvas/resizableLayers';\n\nexport default function TextLayerContent(props: ResizableLayerProps) {\n  const {editorState, mediaState, actions} = useMediaEditorContext();\n\n  if(!props.layer.textInfo) return;\n\n  const onFocus = () => {\n    batch(() => {\n      editorState.selectedResizableLayer = props.layer.id;\n      editorState.currentTextLayerInfo = {...props.layer.textInfo};\n    });\n  };\n\n  const fontInfo = () => fontInfoMap[props.layer.textInfo.font];\n\n  function deleteThisLayer() {\n    const layers = mediaState.resizableLayers;\n    const idx = layers.findIndex(layer => layer.id === props.layer.id);\n    if(idx < 0) return;\n    const deletedLayer = layers.splice(idx, 1)[0];\n    deletedLayer.textRenderingInfo = undefined;\n\n    actions.pushToHistory({\n      path: ['resizableLayers', idx],\n      newValue: HistoryItem.RemoveArrayItem,\n      oldValue: deletedLayer,\n      findBy: {\n        id: deletedLayer.id\n      }\n    });\n  }\n\n  function updateBackground() {\n    contentEditable.childNodes.forEach((childNode) => {\n      if(childNode instanceof HTMLDivElement && !childNode.hasAttributes()) {\n        childNode.querySelectorAll('*').forEach((element) => {\n          const node = document.createTextNode(element.textContent);\n          element.replaceWith(node);\n        });\n      } else {\n        const div = document.createElement('div');\n        div.textContent = childNode.textContent;\n        childNode.replaceWith(div);\n      }\n    });\n    if(!contentEditable.textContent) {\n      contentEditable.innerHTML = '<div></div>';\n\n      // Firefox cursor reset\n      const child = contentEditable.children[0];\n      const range = document.createRange();\n      const sel = window.getSelection();\n\n      range.setStart(child, 0);\n      range.collapse(true);\n\n      sel.removeAllRanges();\n      sel.addRange(range);\n    }\n\n    // Firefox puts the cursor outside the inner divs and messes up everything\n    const selection = window.getSelection();\n    if(selection.rangeCount > 0) {\n      const range = selection.getRangeAt(0);\n      if(range.startContainer === contentEditable && range.startOffset === 0) {\n        const innerDiv = contentEditable.children[0];\n        const innerDivRange = document.createRange();\n        innerDivRange.selectNodeContents(innerDiv);\n        innerDivRange.collapse(false); // Collapse to the end of the inner div\n\n        selection.removeAllRanges();\n        selection.addRange(innerDivRange);\n      }\n    }\n\n    container.querySelector('.media-editor__text-layer-background')?.remove();\n    const lines = getLinesRenderingInfo(contentEditable, props.layer.textInfo.alignment);\n    const path = createTextBackgroundPath(lines);\n\n    if(props.layer.textInfo.style === 'background') updateBackgroundStyle(container, path.join(' '), props.layer.textInfo);\n    if(props.layer.textInfo.style === 'outline') updateOutlineStyle(container, contentEditable, props.layer.textInfo);\n\n    props.layer.textRenderingInfo =  {\n      width: container.clientWidth,\n      height: container.clientHeight,\n      path,\n      lines\n    };\n  }\n\n  function selectAll() {\n    const range = document.createRange();\n    range.selectNodeContents(contentEditable.children[0]);\n    const selection = window.getSelection();\n    selection.removeAllRanges();\n    selection.addRange(range);\n  }\n\n  createEffect(() => {\n    updateBackground();\n  });\n\n  const isThisLayerSelected = createMemo(() => props.layer.id === editorState.selectedResizableLayer);\n\n  onMount(() => {\n    if(isThisLayerSelected()) selectAll();\n  });\n\n\n  createEffect(() => {\n    if(isThisLayerSelected()) {\n      onCleanup(() => {\n        if(!contentEditable.innerText.trim()) {\n          deleteThisLayer();\n        }\n      })\n    }\n  });\n\n  createEffect(\n    on(() => ({...editorState.currentTextLayerInfo}), () => {\n      if(editorState.selectedResizableLayer !== props.layer.id) return;\n      props.layer.textInfo = {...editorState.currentTextLayerInfo};\n    })\n  );\n\n  onMount(() => {\n    container.addEventListener('dragstart', (e: Event) => {\n      e.preventDefault();\n    });\n  });\n\n  let container: HTMLDivElement;\n  let contentEditable: HTMLDivElement;\n\n  const color = () => {\n    if(props.layer.textInfo.style === 'normal') return props.layer.textInfo.color;\n    return getContrastColor(props.layer.textInfo.color);\n  };\n\n  const intialContent = (() => {\n    const layerInfo = props.layer.textRenderingInfo;\n    if(!layerInfo) return <div>{i18n('MediaEditor.TypeSomething')}</div>;\n    return layerInfo.lines.map((line) => <div>{line.content}</div>);\n  })();\n\n  const children = (\n    <div\n      ref={container}\n      class=\"media-editor__text-layer\"\n      classList={{\n        'media-editor__text-layer--with-bg': props.layer.textInfo.style === 'background'\n      }}\n      style={{\n        'color': color(),\n        'font-size': props.layer.textInfo.size + 'px',\n        'font-family': fontInfo().fontFamily,\n        'font-weight': fontInfo().fontWeight,\n        '--align-items': flexAlignMap[props.layer.textInfo.alignment]\n      }}\n    >\n      <div\n        ref={contentEditable}\n        class=\"media-editor__text-layer-layout\"\n        contenteditable\n        onInput={() => updateBackground()}\n        onFocus={onFocus}\n      >\n        {intialContent}\n      </div>\n    </div>\n  ); // Needs to be rendered here for hot reload to work properly\n\n  return (\n    <ResizableContainer layer={props.layer}>\n      {children}\n    </ResizableContainer>\n  );\n}\n\nfunction getLinesRenderingInfo(linesContainer: HTMLDivElement, alignment: string): TextRenderingInfoLine[] {\n  return Array.from(linesContainer.children).map((_child) => {\n    const child = _child as HTMLElement;\n    let offset = 0;\n    if(alignment === 'left') {\n      offset = 0;\n    } else if(alignment === 'center') {\n      offset = (linesContainer.clientWidth - child.clientWidth) / 2;\n    } else {\n      offset = linesContainer.clientWidth - child.clientWidth;\n    }\n    return {\n      left: offset,\n      right: offset + child.clientWidth,\n      content: child.innerText,\n      height: child.clientHeight\n    };\n  });\n}\n\nfunction createTextBackgroundPath(lines: TextRenderingInfoLine[]) {\n  const first = lines[0];\n\n  const rounding = first.height * 0.3;\n\n  const arcParams = (r: number, s: number = 1) => [r, r, 0, 0, s];\n\n  const path = [];\n  path.push('M', first.left, rounding);\n\n  path.push('A', ...arcParams(rounding), first.left + rounding, 0);\n  path.push('L', first.right - rounding, 0);\n  path.push('A', ...arcParams(rounding), first.right, rounding);\n\n  let prevPosition = first;\n  let prevY = first.height;\n\n  for(let i = 1; i < lines.length; i++) {\n    const position = lines[i];\n\n    const diffSign = position.right > prevPosition.right ? 1 : -1;\n    const diff = Math.min(Math.abs((position.right - prevPosition.right) / 2), rounding) * diffSign;\n    const currentRounding = Math.abs(diff);\n\n    path.push('L', prevPosition.right, prevY - currentRounding);\n    path.push('A', ...arcParams(currentRounding, diffSign === 1 ? 0 : 1), prevPosition.right + diff, prevY);\n    path.push('L', position.right - diff, prevY);\n    path.push('A', ...arcParams(currentRounding, diffSign === 1 ? 1 : 0), position.right, prevY + currentRounding);\n\n    prevY += position.height;\n    prevPosition = position;\n  }\n\n  path.push('L', prevPosition.right, prevY - rounding);\n  path.push('A', ...arcParams(rounding), prevPosition.right - rounding, prevY);\n  path.push('L', prevPosition.left + rounding, prevY);\n  path.push('A', ...arcParams(rounding), prevPosition.left, prevY - rounding);\n\n  const last = lines[lines.length - 1];\n  prevY -= last.height;\n  for(let i = lines.length - 2; i >= 0; i--) {\n    const position = lines[i];\n\n    const diffSign = position.left > prevPosition.left ? 1 : -1;\n    const diff = Math.min(Math.abs((position.left - prevPosition.left) / 2), rounding) * diffSign;\n    const currentRounding = Math.abs(diff);\n\n    path.push('L', prevPosition.left, prevY + currentRounding);\n    path.push('A', ...arcParams(currentRounding, diffSign !== 1 ? 0 : 1), prevPosition.left + diff, prevY);\n    path.push('L', position.left - diff, prevY);\n    path.push('A', ...arcParams(currentRounding, diffSign !== 1 ? 1 : 0), position.left, prevY - currentRounding);\n\n    prevY -= position.height;\n    prevPosition = position;\n  }\n\n  return path;\n}\n\nfunction updateBackgroundStyle(container: HTMLDivElement, path: string, info: TextLayerInfo) {\n  const svg = createElementFromMarkup(`\n    <svg width=\"${container.clientWidth}\" height=\"${container.clientHeight}\" viewBox=\"0 0 ${container.clientWidth} ${container.clientHeight}\">\n      <path d=\"${path}\" fill=\"${info.color}\" />\n    </svg>\n  `);\n  svg.classList.add('media-editor__text-layer-background');\n  container.prepend(svg);\n\n  return path;\n}\n\nfunction updateOutlineStyle(container: HTMLDivElement, contentEditable: HTMLDivElement, info: TextLayerInfo) {\n  const fontInfo = fontInfoMap[info.font];\n  function updateSvg(div: HTMLDivElement) {\n    div.querySelector('.media-editor__text-layer-svg-outline')?.remove();\n    const stretch = info.size * 0.5;\n    const w = div.clientWidth + stretch;\n    const h = div.clientHeight + stretch;\n    const svg = createElementFromMarkup(`\n      <div class=\"media-editor__text-layer-svg-outline\" style=\"width: ${w}px; height: ${h}px;\">\n        <svg style=\"width: ${w}px; height: ${h}px;\" viewBox=\"${-stretch / 2} 0 ${div.clientWidth + stretch / 2} ${div.clientHeight + stretch}\">\n          <text\n            x=\"${info.size * 0.2}\"\n            y=\"${info.size * 1.33 * fontInfo.baseline}\"\n            style=\"font-size:${info.size}px;stroke:${info.color};stroke-width:${div.clientHeight * 0.15}px;font-family:${fontInfo.fontFamily};font-weight:${fontInfo.fontWeight};\">\n            ${div.innerText}\n          </text>\n        </svg>\n      </div>\n    `);\n    div.prepend(svg);\n  }\n\n  const bgDiv = document.createElement('div');\n  bgDiv.classList.add('media-editor__text-layer-background', 'media-editor__text-layer-background--as-layout');\n  bgDiv.innerHTML = contentEditable.innerHTML;\n  container.prepend(bgDiv);\n  Array.from(bgDiv.children).forEach((line) => {\n    if(line instanceof HTMLDivElement) updateSvg(line);\n  });\n}\n\nconst flexAlignMap: Record<string, string> = {\n  left: 'start',\n  center: 'center',\n  right: 'end'\n};\n","import {Accessor, batch, createEffect, createMemo, For, on, onCleanup, onMount, ParentProps, Show} from 'solid-js';\nimport {createMutable, modifyMutable, produce} from 'solid-js/store';\nimport {Portal} from 'solid-js/web';\n\nimport createContextMenu from '@helpers/dom/createContextMenu';\n\nimport SwipeHandler, {getEvent} from '@components/swipeHandler';\nimport {observeResize} from '@components/resizeObserver';\n\nimport {NumberPair, ResizableLayer, ResizableLayerProps} from '@components/mediaEditor/types';\nimport {HistoryItem, useMediaEditorContext} from '@components/mediaEditor/context';\nimport {withCurrentOwner} from '@components/mediaEditor/utils';\nimport useIsMobile from '@components/mediaEditor/useIsMobile';\n\nimport StickerLayerContent from '@components/mediaEditor/canvas/stickerLayerContent';\nimport useNormalizePoint from '@components/mediaEditor/canvas/useNormalizePoint';\nimport TextLayerContent from '@components/mediaEditor/canvas/textLayerContent';\nimport useProcessPoint from '@components/mediaEditor/canvas/useProcessPoint';\n\n\ntype ProcessedLayer = {\n  position: NumberPair;\n  rotation: number;\n  scale: number;\n}\n\nexport default function ResizableLayers() {\n  const context = useMediaEditorContext();\n  const {editorState, mediaState, actions} = context;\n  const isTextTab = () => editorState.currentTab === 'text';\n  const canClick = () => ['stickers', 'text', 'adjustments'].includes(editorState.currentTab);\n\n\n  function moveSelectedLayerOnTop() {\n    const layers = mediaState.resizableLayers;\n    const idx = layers.findIndex(layer => layer.id === editorState.selectedResizableLayer);\n    if(idx < 0) return;\n    const layer = layers.splice(idx, 1)[0];\n    layer && layers.push(layer);\n  }\n\n  createEffect(\n    on(() => editorState.selectedResizableLayer, () => {\n      moveSelectedLayerOnTop();\n    })\n  );\n\n  createEffect(() => {\n    editorState.currentTab;\n    onCleanup(() => {\n      editorState.selectedResizableLayer = undefined;\n    });\n  });\n\n  let container: HTMLDivElement;\n\n  const normalizePoint = useNormalizePoint();\n\n  function addLayer(e: MouseEvent) {\n    if(e.target !== container) return;\n    if(editorState.selectedResizableLayer) {\n      editorState.selectedResizableLayer = undefined;\n      return;\n    }\n\n    if(!isTextTab()) return;\n\n    const bcr = container.getBoundingClientRect();\n    const transform = editorState.finalTransform;\n\n    const newResizableLayer = {\n      id: context.resizableLayersSeed++,\n      position: normalizePoint([e.clientX - bcr.left, e.clientY - bcr.top]),\n      rotation: -transform.rotation,\n      scale: 1 / transform.scale,\n      type: 'text',\n      textInfo: {...editorState.currentTextLayerInfo}\n    } as ResizableLayer;\n\n    batch(() => {\n      mediaState.resizableLayers.push(newResizableLayer);\n      editorState.selectedResizableLayer = newResizableLayer.id;\n\n      actions.pushToHistory({\n        path: ['resizableLayers', mediaState.resizableLayers.length - 1],\n        newValue: newResizableLayer,\n        oldValue: HistoryItem.RemoveArrayItem,\n        findBy: {\n          id: newResizableLayer.id\n        }\n      });\n    });\n  }\n\n  return (\n    <div\n      class=\"media-editor__resizable-layers\"\n      classList={{\n        'media-editor__resizable-layers--active': canClick()\n      }}\n      style={{\n        cursor: !editorState.selectedResizableLayer && isTextTab() ? 'text' : undefined\n      }}\n    >\n      <div\n        ref={container}\n        class=\"media-editor__resizable-layers-inner\"\n        onClick={withCurrentOwner(addLayer)}\n        style={{\n          'opacity': editorState.isAdjusting ? 0 : 1\n        }}\n      >\n        <For each={mediaState.resizableLayers}>\n          {(layer) => (\n            <>\n              <Show when={layer.type === 'text'}>\n                <TextLayerContent layer={layer} />\n              </Show>\n              <Show when={layer.type === 'sticker'}>\n                <StickerLayerContent layer={layer} />\n              </Show>\n            </>\n          )}\n        </For>\n      </div>\n    </div>\n  );\n}\n\nexport function ResizableContainer(props: ParentProps<ResizableLayerProps>) {\n  const {editorState, mediaState} = useMediaEditorContext();\n\n  const isMobile = useIsMobile();\n  const processPoint = useProcessPoint(false);\n\n\n  const handleTyping = (): HTMLDivElement | undefined => undefined;\n\n  const store = createMutable({\n    diff: [0, 0] as NumberPair,\n    containerWidth: 0,\n    containerHeight: 0,\n    leftTopEl: handleTyping(),\n    rightTopEl: handleTyping(),\n    leftBottomEl: handleTyping(),\n    rightBottomEl: handleTyping()\n  });\n\n  const circleOffset = () => (isMobile() ? '-6px' : '-4px');\n  const canShowHandles = () => editorState.resizeHandlesContainer && props.layer.id === editorState.selectedResizableLayer;\n\n  const processedLayer = createMemo(() => ({\n    position: processPoint(props.layer.position),\n    rotation: props.layer.rotation + mediaState.rotation,\n    scale: editorState.finalTransform.scale * props.layer.scale\n  }));\n\n\n  let container: HTMLDivElement;\n\n  onMount(() => {\n    useResizeHandles({\n      container,\n      leftBottomEl: () => store.leftBottomEl,\n      leftTopEl: () => store.leftTopEl,\n      rightBottomEl: () => store.rightBottomEl,\n      rightTopEl: () => store.rightTopEl,\n\n      layer: props.layer,\n      diff: store.diff,\n      processedLayer\n    });\n\n    useContextMenu({container, layer: props.layer});\n\n    const unobserve = observeResize(container, () => {\n      store.containerWidth = container.clientWidth;\n      store.containerHeight = container.clientHeight;\n    });\n\n    onCleanup(() => {\n      unobserve();\n    });\n  });\n\n  return (\n    <div\n      class=\"media-editor__resizable-container\"\n      style={{\n        'left': processedLayer().position[0] + store.diff[0] + 'px',\n        'top': processedLayer().position[1] + store.diff[1] + 'px',\n        '--rotation': (processedLayer().rotation / Math.PI) * 180 + 'deg',\n        '--scale': processedLayer().scale\n      }}\n      onClick={() => {\n        editorState.selectedResizableLayer = props.layer.id;\n      }}\n      ref={container}\n    >\n      {props.children}\n\n      {canShowHandles() && <Portal mount={editorState.resizeHandlesContainer}>\n        <div\n          class=\"media-editor__resizable-container-handles\"\n          style={{\n            'left': processedLayer().position[0] + store.diff[0] + 'px',\n            'top': processedLayer().position[1] + store.diff[1] + 'px',\n            'width': store.containerWidth * processedLayer().scale + 'px',\n            'height': store.containerHeight * processedLayer().scale + 'px',\n            '--rotation': (processedLayer().rotation / Math.PI) * 180 + 'deg'\n          }}\n        >\n          <div\n            class=\"media-editor__resizable-container-border media-editor__resizable-container-border--vertical\"\n            style={{left: 0}}\n          />\n          <div\n            class=\"media-editor__resizable-container-border media-editor__resizable-container-border--vertical\"\n            style={{right: 0}}\n          />\n          <div\n            class=\"media-editor__resizable-container-border media-editor__resizable-container-border--horizontal\"\n            style={{top: 0}}\n          />\n          <div\n            class=\"media-editor__resizable-container-border media-editor__resizable-container-border--horizontal\"\n            style={{bottom: 0}}\n          />\n          <div\n            ref={(el) => store.leftTopEl = el}\n            class=\"media-editor__resizable-container-circle\"\n            style={{left: circleOffset(), top: circleOffset()}}\n          />\n          <div\n            ref={(el) => store.rightTopEl = el}\n            class=\"media-editor__resizable-container-circle\"\n            style={{right: circleOffset(), top: circleOffset()}}\n          />\n          <div\n            ref={(el) => store.leftBottomEl = el}\n            class=\"media-editor__resizable-container-circle\"\n            style={{left: circleOffset(), bottom: circleOffset()}}\n          />\n          <div\n            ref={(el) => store.rightBottomEl = el}\n            class=\"media-editor__resizable-container-circle\"\n            style={{right: circleOffset(), bottom: circleOffset()}}\n          />\n        </div>\n      </Portal>}\n    </div>\n  );\n}\n\n\ntype UseResizeArgs = {\n  container: HTMLDivElement;\n  leftTopEl: () => HTMLDivElement;\n  rightTopEl: () => HTMLDivElement;\n  leftBottomEl: () => HTMLDivElement;\n  rightBottomEl: () => HTMLDivElement;\n\n  diff: NumberPair;\n  layer: ResizableLayer;\n  processedLayer: Accessor<ProcessedLayer>;\n};\n\nfunction useResizeHandles({\n  container,\n  leftTopEl,\n  rightTopEl,\n  leftBottomEl,\n  rightBottomEl,\n  diff,\n  layer,\n  processedLayer\n}: UseResizeArgs) {\n  const {editorState, mediaState} = useMediaEditorContext();\n\n  const normalizePoint = useNormalizePoint();\n\n\n  let firstTarget: EventTarget;\n  let swipeStarted = false;\n\n  const multipliers = [\n    {el: leftTopEl, x: -1, y: -1},\n    {el: rightTopEl, x: 1, y: -1},\n    {el: leftBottomEl, x: -1, y: 1},\n    {el: rightBottomEl, x: 1, y: 1}\n  ];\n\n  multipliers.forEach(({el, x, y}) => {\n    createEffect(() => {\n      const element = el();\n      if(!element) return;\n\n      const swipeHandler = new SwipeHandler({\n        element,\n        onStart() {\n          element.classList.add('media-editor__resizable-container-circle--anti-flicker');\n        },\n        onSwipe(_, __, _e) {\n          const e = getEvent(_e);\n\n          if(!firstTarget) firstTarget = e.target;\n          if(firstTarget !== element) return;\n\n          const initialVector = [\n            (container.clientWidth / 2) * x * editorState.finalTransform.scale,\n            (container.clientHeight / 2) * y * editorState.finalTransform.scale\n          ];\n          const bcr = container.getBoundingClientRect();\n          const resizedVector = [bcr.left + bcr.width / 2 - e.clientX, bcr.top + bcr.height / 2 - e.clientY];\n\n          const rotationFromHorizon =\n            Math.atan2(resizedVector[1], resizedVector[0]) - Math.atan2(initialVector[1], initialVector[0]) + Math.PI;\n          const scale = Math.hypot(resizedVector[0], resizedVector[1]) / Math.hypot(initialVector[0], initialVector[1]);\n\n          modifyMutable(layer, produce(s => {\n            s.rotation = rotationFromHorizon - mediaState.rotation;\n            s.scale = scale;\n          }));\n        },\n        onReset() {\n          element.classList.remove('media-editor__resizable-container-circle--anti-flicker');\n          firstTarget = undefined;\n        }\n      });\n      onCleanup(() => {\n        swipeHandler.removeListeners();\n      });\n    });\n  });\n\n\n  const moveHandler = new SwipeHandler({\n    element: container,\n    onSwipe(xDiff, yDiff, e) {\n      if(!firstTarget) firstTarget = e.target;\n      if(multipliers.find(({el}) => el() === firstTarget)) return;\n\n      if(!swipeStarted) {\n        // onStart messes up the typing\n        swipeStarted = true;\n        editorState.selectedResizableLayer = layer.id;\n      }\n\n      diff.splice(0, 2, xDiff, yDiff);\n    },\n    onReset() {\n      layer.position = normalizePoint([processedLayer().position[0] + diff[0], processedLayer().position[1] + diff[1]]);\n      diff.splice(0, 2, 0, 0);\n      swipeStarted = false;\n      firstTarget = undefined;\n    }\n  });\n\n  onCleanup(() => {\n    moveHandler.removeListeners();\n  });\n}\n\n\ntype UseContextMenuArgs = {\n  container: HTMLDivElement;\n  layer: ResizableLayer;\n}\n\nfunction useContextMenu({container, layer}: UseContextMenuArgs) {\n  const {editorState, mediaState, actions} = useMediaEditorContext();\n\n  function onClick() {\n    const layers = mediaState.resizableLayers;\n    const idx = layers.findIndex(otherLayer => otherLayer.id === layer.id);\n    if(idx < 0) return;\n\n    batch(() => {\n      editorState.selectedResizableLayer = undefined;\n      const deletedLayer = layers.splice(idx, 1)[0];\n\n      actions.pushToHistory({\n        path: ['resizableLayers', idx],\n        newValue: HistoryItem.RemoveArrayItem,\n        oldValue: deletedLayer,\n        findBy: {\n          id: deletedLayer.id\n        }\n      });\n    });\n  }\n\n  const contextMenu = createContextMenu({\n    buttons: [\n      {\n        icon: 'delete',\n        className: 'danger',\n        text: 'Delete',\n        onClick\n      }\n    ],\n    listenTo: container,\n    onElementReady: (element) => {\n      element.classList.add('night');\n    }\n  });\n\n  onCleanup(() => {\n    contextMenu.destroy();\n  });\n}\n","import {modifyMutable, produce} from 'solid-js/store';\nimport {animateValue} from '@helpers/animateValue';\nimport {lerp, lerpArray} from '@helpers/lerp';\nimport {useMediaEditorContext} from '@components/mediaEditor/context';\nimport {NumberPair} from '@components/mediaEditor/types';\nimport {snapToViewport} from '@components/mediaEditor/utils';\nimport {useCropOffset} from '@components/mediaEditor/canvas/useCropOffset';\n\n\nexport function animateToNewRotationOrRatio(newRotation: number) {\n  const {editorState, mediaState} = useMediaEditorContext();\n  if(!editorState.mediaSize) return;\n\n  const cropOffset = useCropOffset();\n\n  const [w, h] = editorState.mediaSize;\n\n  const snappedRotation90 = Math.round((newRotation / Math.PI) * 2);\n  const isReversedRatio = Math.abs(snappedRotation90) & 1;\n  const snappedRotation = (snappedRotation90 * Math.PI) / 2;\n\n  let ratio: number;\n\n  if(editorState.fixedImageRatioKey?.includes('x')) {\n    const parts = editorState.fixedImageRatioKey.split('x');\n    ratio = parseInt(parts[0]) / parseInt(parts[1]);\n  } else {\n    ratio = isReversedRatio ? h / w : w / h;\n  }\n\n  const originalRatio = w / h;\n\n  const [w1, h1] = snapToViewport(originalRatio, cropOffset().width, cropOffset().height);\n  const [w2, h2] = snapToViewport(ratio, cropOffset().width, cropOffset().height);\n\n  const initialScale = mediaState.scale;\n  const initialTranslation = mediaState.translation;\n  const initialRotation = mediaState.rotation;\n  const targetScale = isReversedRatio ? Math.max(w2 / h1, h2 / w1) : Math.max(w2 / w1, h2 / h1);\n  const targetTranslation = [0, 0];\n  const targetRotation = snappedRotation;\n\n  mediaState.currentImageRatio = ratio;\n  editorState.isMoving = true;\n\n  animateValue(\n    0,\n    1,\n    200,\n    (progress) => {\n      modifyMutable(mediaState, produce((state) => {\n        state.scale = lerp(initialScale, targetScale, progress);\n        state.translation = lerpArray(initialTranslation, targetTranslation, progress) as NumberPair;\n        state.rotation = lerp(initialRotation, targetRotation, progress);\n      }));\n    },\n    {\n      onEnd: () => {\n        editorState.isMoving = false;\n        mediaState.rotation = mediaState.rotation % (Math.PI * 2);\n      }\n    }\n  );\n}\n","import {batch, createEffect, createSignal, on, onCleanup, onMount} from 'solid-js';\nimport {modifyMutable, produce} from 'solid-js/store';\nimport {animateValue} from '@helpers/animateValue';\nimport {lerp} from '@helpers/lerp';\nimport clamp from '@helpers/number/clamp';\nimport {ButtonIconTsx} from '@components/buttonIconTsx';\nimport SwipeHandler from '@components/swipeHandler';\nimport {useMediaEditorContext} from '@components/mediaEditor/context';\nimport {NumberPair} from '@components/mediaEditor/types';\nimport {withCurrentOwner} from '@components/mediaEditor/utils';\nimport {animateToNewRotationOrRatio} from '@components/mediaEditor/canvas/animateToNewRotationOrRatio';\nimport getConvenientPositioning from '@components/mediaEditor/canvas/getConvenientPositioning';\n\n\nconst DEGREE_DIST_PX = 42;\nconst DEGREE_STEP = 15;\nconst TOTAL_DEGREES_SIDE = 90;\nconst MAX_DEGREES_DIST_PX = (TOTAL_DEGREES_SIDE / DEGREE_STEP) * DEGREE_DIST_PX;\nconst SNAP_DIST_PX = 40;\n\nfunction rotationFromMove(amount: number) {\n  return ((amount / DEGREE_DIST_PX) * DEGREE_STEP * Math.PI) / 180;\n}\n\nexport default function RotationWheel() {\n  const {editorState, mediaState, actions} = useMediaEditorContext();\n\n  const isCropping = () => editorState.currentTab === 'crop';\n\n  const [moved, setMoved] = createSignal(0);\n  const [movedDiff, setMovedDiff] = createSignal(0);\n\n  let swiperEl: HTMLDivElement;\n\n  onMount(() => {\n    const snappedRotation = (Math.round((mediaState.rotation / Math.PI) * 2) * Math.PI) / 2;\n    setMoved((((snappedRotation - mediaState.rotation) * 180) / Math.PI / DEGREE_STEP) * DEGREE_DIST_PX);\n    prevRotation = rotationFromMove(moved());\n\n    let currentDiff: number;\n    let targetDiff: number;\n    let prevShouldSnap = getShouldSnap();\n    let isAnimating = false;\n    let isSnapped = false;\n    let cancelAnimation: () => void;\n    let timeoutId: number;\n\n    function getShouldSnap() {\n      return Math.abs(moved() + currentDiff || 0) < SNAP_DIST_PX\n    }\n\n    function handleDiffChange(diff: number) {\n      setMovedDiff(diff);\n      onSwipe();\n    }\n\n    function removeSnapAfterTimeout() {\n      timeoutId = window.setTimeout(() => {\n        isSnapped = false;\n        isAnimating = true;\n\n        const initialDiff = movedDiff();\n        cancelAnimation?.();\n        cancelAnimation = animateValue(0, 1, 200, (progress) => {\n          handleDiffChange(lerp(initialDiff, currentDiff, progress));\n        }, {\n          onEnd: () => {\n            isAnimating = false\n          }\n        });\n      }, 750);\n    }\n\n    const swipeHandler = new SwipeHandler({\n      element: swiperEl,\n      onStart() {\n        initialScale = mediaState.scale;\n        currentDiff = movedDiff();\n        targetDiff = currentDiff;\n        isAnimating = false;\n        isSnapped = false;\n        prevShouldSnap = getShouldSnap();\n        editorState.isMoving = true;\n      },\n      onSwipe(xDiff) {\n        targetDiff = currentDiff = clamp(moved() + xDiff, -MAX_DEGREES_DIST_PX, MAX_DEGREES_DIST_PX) - moved();\n        const shouldSnap = getShouldSnap();\n        if(shouldSnap) targetDiff = -moved();\n\n        if(prevShouldSnap !== shouldSnap) {\n          window.clearTimeout(timeoutId);\n          timeoutId = window.setTimeout(() => {\n            const shouldSnapAfterTimeout = getShouldSnap();\n            if(shouldSnapAfterTimeout !== shouldSnap) return;\n            isAnimating = true;\n            const initialDiff = movedDiff();\n            cancelAnimation?.();\n            cancelAnimation = animateValue(0, 1, 200, (progress) => {\n              handleDiffChange(lerp(initialDiff, targetDiff, progress));\n            }, {\n              onEnd: () => {\n                isAnimating = false;\n                isSnapped = getShouldSnap();\n\n                if(!isSnapped) return;\n                removeSnapAfterTimeout();\n              }\n            });\n          }, 200);\n        }\n\n        prevShouldSnap = shouldSnap;\n\n        if(isAnimating || isSnapped) return;\n        handleDiffChange(currentDiff);\n      },\n      onReset() {\n        let newMoved = moved() + movedDiff();\n        if(Math.abs(newMoved) === MAX_DEGREES_DIST_PX) {\n          newMoved = 0;\n          prevRotation = 0;\n          prevShouldSnap = false;\n          isAnimating = false;\n        }\n        cancelAnimation?.();\n        window.clearTimeout(timeoutId);\n        batch(() => {\n          setMoved(newMoved);\n          setMovedDiff(0);\n          editorState.isMoving = false;\n          mediaState.rotation = mediaState.rotation % (Math.PI * 2)\n        });\n      }\n    });\n\n    onCleanup(() => {\n      swipeHandler.removeListeners();\n    });\n  });\n\n  let prevRotation = 0;\n  let initialScale = 0;\n\n  const onSwipe = withCurrentOwner(() => {\n    const rotationFromSwiper = rotationFromMove(moved() + movedDiff());\n    const rotationDiff = rotationFromSwiper - prevRotation;\n\n    const targetRotation = mediaState.rotation - rotationDiff;\n\n    const r = [Math.cos(rotationDiff), Math.sin(rotationDiff)];\n\n    const targetTranslation: NumberPair = [\n      mediaState.translation[0] * r[0] + mediaState.translation[1] * r[1],\n      mediaState.translation[1] * r[0] - mediaState.translation[0] * r[1]\n    ];\n\n    prevRotation = rotationFromSwiper;\n\n    if(!initialScale) return;\n    const {cropMinX, cropMaxX, cropMinY, cropMaxY, imageMinX, imageMaxX, imageMinY, imageMaxY} =\n      getConvenientPositioning({\n        scale: initialScale,\n        rotation: targetRotation,\n        translation: targetTranslation\n      });\n\n    const halfImageWidth = (imageMaxX - imageMinX) / 2,\n      halfImageHeight = (imageMaxY - imageMinY) / 2;\n    const imageCenter = [imageMinX + halfImageWidth, imageMinY + halfImageHeight];\n\n    let additionalScale = 1;\n\n    if(imageMinX > cropMinX) additionalScale = Math.max((imageCenter[0] - cropMinX) / halfImageWidth, additionalScale);\n    if(imageMaxX < cropMaxX) additionalScale = Math.max((cropMaxX - imageCenter[0]) / halfImageWidth, additionalScale);\n    if(imageMinY > cropMinY)\n      additionalScale = Math.max((imageCenter[1] - cropMinY) / halfImageHeight, additionalScale);\n    if(imageMaxY < cropMaxY)\n      additionalScale = Math.max((cropMaxY - imageCenter[1]) / halfImageHeight, additionalScale);\n\n\n    modifyMutable(mediaState, produce(s => {\n      s.rotation = targetRotation;\n      s.translation = targetTranslation;\n      if(additionalScale > 1) {\n        s.scale = initialScale * additionalScale;\n      }\n    }));\n  });\n\n  function resetWheelWithAnimation() {\n    prevRotation = 0;\n    animateValue([moved(), movedDiff()], [0, 0], 200, (values) => {\n      batch(() => {\n        setMoved(values[0]);\n        setMovedDiff(values[1]);\n      });\n    });\n  }\n\n  actions.resetRotationWheel = () => resetWheelWithAnimation();\n  onCleanup(() => {\n    actions.resetRotationWheel = () => {}\n  });\n\n  let isFirstEffect = true;\n  createEffect(\n    on(() => editorState.fixedImageRatioKey, () => {\n      if(isFirstEffect) {\n        isFirstEffect = false;\n        return;\n      }\n      resetWheelWithAnimation();\n    })\n  );\n\n  function rotateLeft() {\n    const newRotation = (Math.round((mediaState.rotation / Math.PI) * 2) * Math.PI) / 2 - Math.PI / 2;\n\n    animateToNewRotationOrRatio(newRotation);\n\n    resetWheelWithAnimation();\n  }\n\n  function flipImage() {\n    editorState.isMoving = true;\n    const isReversedRatio = Math.abs(Math.round((mediaState.rotation / Math.PI) * 2)) & 1;\n    const snapTo1 = (value: number) => value < 0 ? -1 : 1;\n    const targetFlip: NumberPair = [\n      snapTo1(mediaState.flip[0]) * (isReversedRatio ? 1 : -1),\n      snapTo1(mediaState.flip[1]) * (isReversedRatio ? -1 : 1)\n    ];\n    animateValue(mediaState.flip, targetFlip, 200, (value) => void (mediaState.flip = value), {\n      onEnd: () => void (editorState.isMoving = false)\n    });\n  }\n\n  const value = () =>\n    ((-(moved() + movedDiff()) / DEGREE_DIST_PX) * DEGREE_STEP)\n    .toFixed(1)\n    .replace(/\\.0$/, '')\n    .replace(/^-0$/, '0');\n\n  return (\n    <div class=\"media-editor__rotation-wheel\" style={{display: isCropping() ? undefined : 'none'}}>\n      <ButtonIconTsx onClick={withCurrentOwner(rotateLeft)} class=\"media-editor__rotation-wheel-button\" icon=\"rotate\" />\n      <div class=\"media-editor__rotation-wheel-swiper-wrapper\">\n        <div\n          ref={swiperEl}\n          style={{['--moved']: moved() + movedDiff() + 'px'}}\n          class=\"media-editor__rotation-wheel-swiper\"\n        >\n          <div class=\"media-editor__rotation-wheel-labels\">\n            {new Array(13).fill(null).map((_, i) => (\n              <div class=\"media-editor__rotation-wheel-label\">\n                <div class=\"media-editor__rotation-wheel-label-number\">{i * 15 - 90}</div>\n              </div>\n            ))}\n          </div>\n          <div class=\"media-editor__rotation-wheel-dots\">\n            {new Array(97).fill(null).map(() => (\n              <div class=\"media-editor__rotation-wheel-dot\" />\n            ))}\n          </div>\n        </div>\n      </div>\n      <div class=\"media-editor__rotation-wheel-value\">\n        <div class=\"media-editor__rotation-wheel-value-number\">{value()}</div>\n      </div>\n      <ArrowUp />\n      <ButtonIconTsx onClick={flipImage} class=\"media-editor__rotation-wheel-button\" icon=\"flip_image_horizontal\" />\n    </div>\n  );\n}\n\nfunction ArrowUp() {\n  return (\n    <svg\n      class=\"media-editor__rotation-wheel-arrow\"\n      width=\"6\"\n      height=\"4\"\n      viewBox=\"0 0 6 4\"\n      fill=\"none\"\n      xmlns=\"http://www.w3.org/2000/svg\"\n    >\n      <path\n        d=\"M2.29289 0.707106L0.28033 2.71967C-0.192143 3.19214 0.142482 4 0.81066 4H5.18934C5.85752 4 6.19214 3.19214 5.71967 2.71967L3.70711 0.707107C3.31658 0.316583 2.68342 0.316582 2.29289 0.707106Z\"\n        fill=\"white\"\n      />\n    </svg>\n  );\n}\n","import {batch, createEffect, createMemo, createSignal, on, onCleanup} from 'solid-js';\nimport {modifyMutable, produce} from 'solid-js/store';\nimport {animateValue} from '@helpers/animateValue';\nimport {lerp, lerpArray} from '@helpers/lerp';\nimport {useMediaEditorContext} from '@components/mediaEditor/context';\nimport {NumberPair} from '@components/mediaEditor/types';\nimport {getSnappedViewportsScale} from '@components/mediaEditor/utils';\nimport {useCropOffset} from '@components/mediaEditor/canvas/useCropOffset';\n\n\nexport type FinalTransform = {\n  flip: NumberPair;\n  translation: NumberPair;\n  rotation: number;\n  scale: number;\n};\n\nexport default function useFinalTransform() {\n  const {editorState, mediaState} = useMediaEditorContext();\n\n  const cropOffset = useCropOffset();\n\n  const isCropping = createMemo(() => editorState.currentTab === 'crop');\n\n  const [cropTabAnimationProgress, setCropTabAnimationProgress] = createSignal(0);\n\n  let isFirstEffect = true;\n  createEffect(\n    on(isCropping, () => {\n      if(isFirstEffect) {\n        isFirstEffect = false;\n        return;\n      }\n\n      editorState.isMoving = true;\n\n      const cancel = animateValue(cropTabAnimationProgress(), isCropping() ? 1 : 0, 200, setCropTabAnimationProgress, {\n        onEnd: () => editorState.isMoving = false\n      });\n\n      onCleanup(cancel);\n    })\n  );\n\n  const [prevCanvasSize, setPrevCanvasSize] = createSignal<NumberPair>();\n  const [prevCropTranslation, setPrevCropTranslation] = createSignal<NumberPair>();\n  const [prevAdditionalScale, setPrevAdditionalScale] = createSignal<number>();\n\n  const additionalImageScales = createMemo(() => {\n    const payload = editorState.renderingPayload;\n    if(!payload || !editorState.canvasSize) return;\n\n    const [w, h] = editorState.canvasSize;\n\n    const imageRatio = payload.media.width / payload.media.height;\n\n    const toCropScale = getSnappedViewportsScale(imageRatio, cropOffset().width, cropOffset().height, w, h);\n    const fromCroppedScale =\n      1 / getSnappedViewportsScale(mediaState.currentImageRatio, cropOffset().width, cropOffset().height, w, h);\n\n    const snappedImageScale = Math.min(w / payload.media.width, h / payload.media.height);\n\n    return {\n      toCropScale,\n      fromCroppedScale,\n      snappedImageScale\n    };\n  });\n\n  const cropTrnsl = createMemo(() => {\n    if(!editorState.canvasSize || !additionalImageScales()) return;\n    const {fromCroppedScale} = additionalImageScales();\n\n    return mediaState.translation.map((x) => x * fromCroppedScale - x) as NumberPair;\n  });\n\n  const cropTranslation = createMemo(() => {\n    if(!editorState.canvasSize || !additionalImageScales()) return;\n    const [, h] = editorState.canvasSize;\n    const {fromCroppedScale} = additionalImageScales();\n\n    return lerpArray(\n      mediaState.translation.map((x) => x * fromCroppedScale - x),\n      [0, cropOffset().left + cropOffset().height / 2 - h / 2],\n      cropTabAnimationProgress()\n    ) as NumberPair;\n  });\n\n  let prevScale: number;\n  let prevTranslation: NumberPair;\n\n  function updatePrevValues() {\n    if(!additionalImageScales() || !cropTrnsl()) return;\n    const {toCropScale, fromCroppedScale, snappedImageScale} = additionalImageScales();\n    prevScale = toCropScale * snappedImageScale * fromCroppedScale;\n    prevTranslation = cropTrnsl();\n  }\n\n  createEffect(\n    on(cropTabAnimationProgress, () => {\n      if([0, 1].includes(cropTabAnimationProgress())) updatePrevValues();\n    })\n  );\n  createEffect(\n    on(() => mediaState.currentImageRatio, () => {\n      updatePrevValues();\n    })\n  );\n\n  createEffect(\n    on(() => editorState.canvasSize, () => {\n      if(!editorState.canvasSize || !additionalImageScales()) return;\n      const prevSize = editorState.canvasSize;\n      const {toCropScale, fromCroppedScale, snappedImageScale} = additionalImageScales();\n      prevScale = toCropScale * snappedImageScale * fromCroppedScale;\n      prevTranslation = cropTrnsl();\n\n      onCleanup(() => {\n        batch(() => {\n          setPrevCanvasSize(prevSize);\n          setPrevAdditionalScale(prevScale);\n          setPrevCropTranslation(prevTranslation);\n        });\n      });\n    })\n  );\n\n  createEffect(\n    on(prevCanvasSize, () => {\n      if(!prevCanvasSize || !prevAdditionalScale()) return;\n      const currentSize = editorState.canvasSize;\n      const {toCropScale, fromCroppedScale, snappedImageScale} = additionalImageScales();\n      const currentAdditionalScale = toCropScale * snappedImageScale * fromCroppedScale;\n\n      const scaleToChange = getSnappedViewportsScale(\n        mediaState.currentImageRatio,\n        currentSize[0],\n        currentSize[1],\n        prevCanvasSize()[0],\n        prevCanvasSize()[1]\n      );\n      const counterScale = prevAdditionalScale() / currentAdditionalScale;\n\n      const totalScale = scaleToChange * counterScale;\n\n      // const translationDiff = [\n      //   prevCropTranslation()[0] - cropTrnsl()[0],\n      //   prevCropTranslation()[1] - cropTrnsl()[1]\n      // ];\n      // console.log('translationDiff', translationDiff)\n\n      modifyMutable(mediaState, produce((state) => {\n        state.scale = state.scale * totalScale,\n        state.translation = state.translation.map((v) => v * totalScale) as NumberPair\n      }));\n    })\n  );\n\n  createEffect(() => {\n    const payload = editorState.renderingPayload;\n    if(!payload) return;\n\n    let {fromCroppedScale, toCropScale, snappedImageScale} = additionalImageScales();\n\n    toCropScale *= lerp(fromCroppedScale, 1, cropTabAnimationProgress());\n\n    // const cropTranslation = lerpArray(\n    //   translation().map((x) => x * fromCroppedScale - x),\n    //   [0, cropOffset().left + cropOffset().height / 2 - h / 2],\n    //   cropTabAnimationProgress()\n    // );\n    // console.log('cropTranslation', cropTranslation)\n\n    modifyMutable(editorState.finalTransform, produce(t => {\n      t.flip = mediaState.flip,\n      t.rotation = mediaState.rotation,\n      t.scale = mediaState.scale * editorState.pixelRatio * snappedImageScale * toCropScale;\n      t.translation = [cropTranslation()[0] + mediaState.translation[0], cropTranslation()[1] + mediaState.translation[1]].map(\n        (v) => v * editorState.pixelRatio\n      ) as NumberPair\n    }));\n  });\n}\n","import {createEffect, onCleanup} from 'solid-js';\nimport deferredPromise from '@helpers/cancellablePromise';\nimport createMiddleware from '@helpers/solid/createMiddleware';\nimport {useMediaEditorContext} from '@components/mediaEditor/context';\nimport {snapToViewport} from '@components/mediaEditor/utils';\nimport createVideoForDrawing from '@components/mediaEditor/canvas/createVideoForDrawing';\nimport styles from '@components/mediaEditor/canvas/videoControls.module.scss';\n\ntype Args = {\n  getCanvas: () => HTMLCanvasElement;\n  size: {\n    width: number;\n    height: number;\n  };\n};\n\nexport default function useVideoControlsCanvas({getCanvas, size}: Args) {\n  const {editorState, mediaSrc} = useMediaEditorContext();\n\n  createEffect(() => {\n    const media = editorState.renderingPayload?.media;\n    const canvas = getCanvas();\n    if(!media || !canvas || !size.width || !size.height) return;\n\n    const ratio = media.width / media.height;\n\n    const ctx = canvas.getContext('2d');\n\n    let\n      deferred = deferredPromise<void>(),\n      cleaned = false\n    ;\n\n    onCleanup(() => {\n      cleaned = true;\n      deferred?.resolve();\n      ctx.clearRect(0, 0, canvas.width, canvas.height);\n    });\n\n    const middleware = createMiddleware().get();\n\n    (async() => {\n      const video = await createVideoForDrawing(mediaSrc, {currentTime: 0, middleware});\n      // (window as any).myWeakRef = new WeakRef(video); // works\n\n      if(cleaned) return;\n\n      video.addEventListener('seeked', () => {\n        deferred?.resolve();\n      });\n\n      const [chunkWidth, chunkHeight] = snapToViewport(ratio, size.width, size.height);\n\n      for(let x = 0; x < size.width; x += chunkWidth) {\n        deferred = deferredPromise();\n        video.currentTime = x / size.width * video.duration;\n\n        await deferred;\n        if(cleaned) return;\n\n        ctx.drawImage(video, x, 0, chunkWidth, chunkHeight);\n\n        const fade = document.createElement('div');\n\n        fade.classList.add(styles.FrameFade);\n        fade.style.top = '0px';\n        fade.style.left = x + 'px';\n        fade.style.width = chunkWidth + 0.5 + 'px'; // add a few px to prevent unexpected borders\n        fade.style.height = chunkHeight + 'px';\n\n        canvas.after(fade);\n\n        fade.animate({opacity: [1, 0]}, {duration: 500, easing: 'ease-in-out'}).finished\n        .then(() => fade.remove());\n      }\n    })();\n  });\n}\n","import {batch, Component, createMemo, createSignal} from 'solid-js';\n\nimport clamp from '@helpers/number/clamp';\nimport swipe, {SwipeDirectiveArgs} from '@helpers/useSwipe'; swipe; // keep\nimport useElementSize from '@hooks/useElementSize';\nimport {i18n} from '@lib/langPack';\n\nimport {IconTsx} from '@components/iconTsx';\nimport ripple from '@components/ripple'; ripple; // keep\nimport showTooltip from '@components/tooltip';\n\nimport {SetVideoTimeFlags, useMediaEditorContext} from '@components/mediaEditor/context';\n\nimport useVideoControlsCanvas from '@components/mediaEditor/canvas/useVideoControlsCanvas';\n\nimport styles from '@components/mediaEditor/canvas/videoControls.module.scss';\n\n\nconst HANDLE_WIDTH_PX = 9;\nconst MOVE_ACTIVATION_THRESHOLD_PX = 2;\n\nconst VideoControls: Component<{}> = () => {\n  const {editorState, mediaState, actions} = useMediaEditorContext();\n\n  const [cropper, setCropper] = createSignal<HTMLDivElement>();\n  const [isDraggingSomething, setIsDraggingSomething] = createSignal(false);\n\n  const cropperSize = useElementSize(cropper);\n  const strippedWidth = () => cropperSize.width - 2 * HANDLE_WIDTH_PX;\n\n  const shouldShowTime = () => isDraggingSomething() && (swiping === 'left' || swiping === 'right');\n\n  const formattedResultingTime = createMemo(() => {\n    if(!shouldShowTime()) return '';\n    const video = editorState.renderingPayload?.media?.video;\n    if(!video) return '';\n\n    const totalSeconds = mediaState.videoCropLength * video.duration;\n    let ts = totalSeconds;\n\n    const hh = (Math.floor(ts / 3600) + '').padStart(2, '0');\n    ts -= +hh * 3600;\n    const mm = (Math.floor(ts / 60) + '').padStart(2, '0');\n    ts -= +mm * 60;\n    const ss = (Math.floor(ts) + '').padStart(2, '0');\n    ts -= +ss;\n    const decimal = (Math.floor(ts * 4) * 25 + '').replace(/0$/, '');\n\n    return (+hh ? `${hh}:` : '') + `${mm}:${ss}` + (decimal && totalSeconds < 10 ? `.${decimal}` : '');\n  });\n\n  const minLength = createMemo(() => {\n    const duration = editorState.renderingPayload?.media?.video?.duration;\n    if(!duration) return 0;\n    return Math.min(1, 0.5 / duration);\n  });\n\n  let\n    canvas: HTMLCanvasElement,\n    initialStart: number,\n    initialLength: number,\n    swiping: 'left' | 'middle' | 'right' | 'cursor';\n  ;\n\n  useVideoControlsCanvas({\n    getCanvas: () => canvas,\n    size: cropperSize\n  });\n\n  const leftHandleSwipeArgs: SwipeDirectiveArgs = {\n    globalCursor: () => 'ew-resize',\n    onStart: () => {\n      swiping = 'left';\n      initialStart = mediaState.videoCropStart;\n      initialLength = mediaState.videoCropLength;\n\n      batch(() => {\n        setIsDraggingSomething(true);\n        editorState.isPlaying = false;\n      });\n    },\n    onMove: (xDiff) => void batch(() => {\n      if(swiping !== 'left') return;\n      const diff = clamp(initialStart + xDiff / strippedWidth(), 0, Math.max(0, initialStart + initialLength - minLength())) - initialStart;\n      batch(() => {\n        mediaState.videoCropStart = (initialStart + diff);\n        mediaState.videoCropLength = (initialLength - diff);\n        actions.setVideoTime(mediaState.videoCropStart);\n      });\n    }),\n    onEnd: () => void setIsDraggingSomething(false)\n  };\n\n  const rightHandleSwipeArgs: SwipeDirectiveArgs = {\n    globalCursor: () => 'ew-resize',\n    onStart: () => {\n      swiping = 'right';\n      initialLength = mediaState.videoCropLength;\n\n      batch(() => {\n        setIsDraggingSomething(true);\n        editorState.isPlaying = false;\n      });\n    },\n    onMove: (xDiff) => void batch(() => {\n      if(swiping !== 'right') return;\n      const maxLength = 1 - mediaState.videoCropStart;\n      mediaState.videoCropLength = (clamp(initialLength + xDiff / strippedWidth(), Math.min(minLength(), maxLength), maxLength));\n      actions.setVideoTime(mediaState.videoCropStart + mediaState.videoCropLength);\n    }),\n    onEnd: () => void setIsDraggingSomething(false)\n  };\n\n  let canMove = false;\n\n  const middleSwipeArgs: SwipeDirectiveArgs = {\n    globalCursor: () => initialLength === 1 ? 'col-resize' : 'grabbing',\n    onStart: (e) => {\n      swiping = 'middle';\n      initialStart = mediaState.videoCropStart;\n      initialLength = mediaState.videoCropLength;\n      canMove = false;\n\n      if(initialLength === 1) {\n        setIsDraggingSomething(true);\n        canMove = true;\n        handleCursorMove(e);\n      }\n    },\n    onMove: (xDiff, _, e) => void batch((): void => {\n      if(swiping !== 'middle') return;\n      if(initialLength === 1) return void handleCursorMove(e);\n\n      if(Math.abs(xDiff) > MOVE_ACTIVATION_THRESHOLD_PX) canMove = true;\n      if(!canMove) return;\n\n      const startDiff = clamp(initialStart + xDiff / strippedWidth(), 0, Math.max(0, 1 - Math.max(initialLength, minLength()))) - initialStart;\n      batch(() => {\n        setIsDraggingSomething(true);\n        editorState.isPlaying = false;\n\n        mediaState.videoCropStart = initialStart + startDiff;\n        // mediaState.videoCropLength = clamp(initialLength - startDiff + xDiff / strippedWidth(), Math.min(1, minLength()), 1 - mediaState.videoCropStart);\n\n        actions.setVideoTime(mediaState.videoCropStart);\n      });\n    }),\n    onEnd: () => {\n      self.setTimeout(() => {\n        setIsDraggingSomething(false);\n      }, 0); // prevent trigger click after finishing dragging\n    }\n  };\n\n  const cursorSwipeArgs: SwipeDirectiveArgs = {\n    globalCursor: () => 'col-resize',\n    onStart: () => {\n      swiping = 'cursor';\n      setIsDraggingSomething(true);\n    },\n    onMove: (xDiff, __, e) => {\n      if(swiping !== 'cursor') return;\n      // if(Math.abs(xDiff) > MOVE_ACTIVATION_THRESHOLD_PX)\n      editorState.isPlaying = false;\n      handleCursorMove(e);\n    },\n    onEnd: () => void setIsDraggingSomething(false)\n  };\n\n  const handleCursorMove = (e: PointerEvent | TouchEvent) => {\n    editorState.isPlaying = false;\n    actions.setVideoTime(clamp(getPositionInCropper(e, cropper()), mediaState.videoCropStart, mediaState.videoCropStart + mediaState.videoCropLength));\n  };\n\n  const onMiddlePartClick = (e: MouseEvent) => {\n    if(!cropper() || isDraggingSomething()) return;\n\n    actions.setVideoTime(clamp(getPositionInCropper(e, cropper()), mediaState.videoCropStart, mediaState.videoCropStart + mediaState.videoCropLength));\n  };\n\n  const showMutedTooltip = (el: HTMLElement) => showTooltip({\n    element: el,\n    mountOn: el.parentElement.parentElement.parentElement,\n    vertical: 'top',\n    textElement: i18n('MediaEditor.VideoMutedTooltip'),\n    lighter: true,\n    auto: true\n  });\n\n  let closeTooltip: () => void;\n\n  return (\n    <div\n      class={styles.Container}\n      classList={{\n        [styles.hidden]: editorState.currentTab !== 'adjustments',\n        [styles.changed]: mediaState.videoCropLength !== 1\n      }}\n      style={{\n        '--start': mediaState.videoCropStart,\n        '--length': mediaState.videoCropLength,\n        '--current-time': mediaState.currentVideoTime\n      }}\n    >\n      <div class={styles.InnerContainer}>\n        <button\n          use:ripple\n          class={`btn-icon ${styles.IconButton} ${styles.MuteButton}`}\n          classList={{\n            [styles.muted]: mediaState.videoMuted\n          }}\n          onClick={(e) => {\n            mediaState.videoMuted = !mediaState.videoMuted;\n            closeTooltip?.();\n            if(mediaState.videoMuted) closeTooltip = showMutedTooltip(e.currentTarget).close;\n          }}\n          tabIndex={-1}\n        >\n          <IconTsx icon={mediaState.videoMuted ? 'volume_off' : 'volume_up'} />\n        </button>\n\n        <div class={styles.Frames}>\n          <div ref={setCropper} class={styles.Cropper}>\n            <canvas ref={canvas} class={styles.Images} width={cropperSize.width} height={cropperSize.height} />\n\n            <div class={`${styles.CropperBg} ${styles.CropperBgLeft}`} />\n            <div class={`${styles.CropperBg} ${styles.CropperBgRight}`} />\n\n            <div\n              class={styles.CropperHorizontalBorder}\n              classList={{\n                [styles.dragging]: isDraggingSomething()\n              }}\n              use:swipe={middleSwipeArgs}\n              onClick={onMiddlePartClick}\n            />\n\n            <div class={`${styles.CropperHandle} ${styles.CropperHandleLeft}`} use:swipe={leftHandleSwipeArgs} />\n            <div class={`${styles.CropperHandle} ${styles.CropperHandleRight}`} use:swipe={rightHandleSwipeArgs} />\n          </div>\n\n          <TimeStick swipe={cursorSwipeArgs} />\n          <ThumbnailTrack\n            cropper={cropper()}\n            isDraggingSomething={isDraggingSomething()}\n            hidden={shouldShowTime()}\n          />\n          <div class={styles.CroppedTime} classList={{[styles.visible]: shouldShowTime()}}>\n            {formattedResultingTime()}\n          </div>\n\n        </div>\n\n        <button\n          use:ripple\n          class={`btn-icon ${styles.IconButton} ${styles.PlayButton}`}\n          onClick={() => {\n            editorState.isPlaying = !editorState.isPlaying;\n          }}\n          tabIndex={-1}\n        >\n          <span class={styles.PlayButtonInner}> {/* <span> prevents duplicating the svg on hot reload */}\n            <PausePlay paused={!editorState.isPlaying} />\n          </span>\n        </button>\n      </div>\n    </div>\n  );\n};\n\nconst ThumbnailTrack: Component<{\n  cropper: HTMLDivElement;\n  isDraggingSomething: boolean;\n  hidden: boolean;\n}> = (props) => {\n  const {actions, editorState, mediaState} = useMediaEditorContext();\n\n  const [ghostThumbnailPosition, setGhostThumbnailPosition] = createSignal<number>();\n\n  const [isDragging, setIsDragging] = createSignal(false);\n\n  const isGhostThumbnailVisible = createMemo(() => !props.isDraggingSomething && !isDragging() && !isNaN(ghostThumbnailPosition()));\n\n  const onClick = (e: MouseEvent) => {\n    if(!props.cropper) return;\n\n    mediaState.videoThumbnailPosition = getPositionInCropper(e, props.cropper);\n  };\n\n  let canPreviewFrame = false, previewFrameTimeout: number;\n\n  const onPointerMove = (e: PointerEvent | TouchEvent) => {\n    if(!props.cropper || editorState.isPlaying || props.isDraggingSomething) return;\n\n    if(!previewFrameTimeout) previewFrameTimeout = self.setTimeout(() => {\n      canPreviewFrame = true;\n    }, 200);\n\n    const position = getPositionInCropper(e, props.cropper);\n\n    setGhostThumbnailPosition(position);\n\n    if(canPreviewFrame) actions.setVideoTime(position, SetVideoTimeFlags.UpdateVideo | SetVideoTimeFlags.Redraw);\n  };\n\n  const onPointerOut = () => {\n    if(canPreviewFrame) actions.setVideoTime(mediaState.currentVideoTime, SetVideoTimeFlags.UpdateVideo | SetVideoTimeFlags.Redraw);\n\n    setGhostThumbnailPosition();\n    canPreviewFrame = false;\n    self.clearTimeout(previewFrameTimeout);\n    previewFrameTimeout = undefined;\n  };\n\n  const swipeArgs: SwipeDirectiveArgs = {\n    globalCursor: () => 'grabbing',\n    onStart: (e) => {\n      void setIsDragging(true);\n      if(!props.cropper) return;\n      mediaState.videoThumbnailPosition = getPositionInCropper(e, props.cropper);\n    },\n    onMove: (_, __, e) => {\n      if(!props.cropper) return;\n      mediaState.videoThumbnailPosition = getPositionInCropper(e, props.cropper);\n    },\n    onEnd: () => void setIsDragging(false)\n  };\n\n  return (\n    <>\n      <ThumbnailMark position={mediaState.videoThumbnailPosition} visible={!props.hidden} withTransition />\n      <ThumbnailMark position={ghostThumbnailPosition() || 0} ghost visible={!props.hidden && isGhostThumbnailVisible()} />\n\n      <div\n        class={styles.ThumbnailTrack}\n        classList={{\n          [styles.disabled]: props.isDraggingSomething\n        }}\n        use:swipe={swipeArgs}\n        onPointerMove={onPointerMove}\n        onTouchMove={onPointerMove}\n        onPointerOut={onPointerOut}\n        onTouchEnd={onPointerOut}\n        onClick={onClick}\n      />\n    </>\n  )\n};\n\nconst ThumbnailMark: Component<{\n  position: number;\n  visible: boolean;\n  ghost?: boolean;\n  withTransition?: boolean;\n}> = (props) => {\n  return (\n    <svg\n      class={styles.ThumbnailMark}\n      classList={{\n        [styles.ghost]: props.ghost,\n        [styles.visible]: props.visible,\n        [styles.withTransition]: props.withTransition\n      }}\n      style={{\n        '--position': props.position\n      }}\n      width=\"20\"\n      height=\"25\"\n      viewBox=\"0 0 20 25\"\n      fill=\"none\"\n      xmlns=\"http://www.w3.org/2000/svg\"\n    >\n      <path d=\"M0 10V10.9952C0 14.8798 2.58024 18.2044 5.87746 20.2583C7.46104 21.2448 8.92659 22.4551 9.61717 23.8212C9.70992 24.0047 10.2901 24.0047 10.3828 23.8212C11.0734 22.4551 12.539 21.2448 14.1225 20.2583C17.4198 18.2044 20 14.8798 20 10.9952V10C20 4.47715 15.5228 0 10 0C4.47715 0 0 4.47715 0 10Z\" fill=\"white\"/>\n      <path fill-rule=\"evenodd\" clip-rule=\"evenodd\" d=\"M8.45844 4.4165H8.48341H11.5167H11.5417C12.1739 4.4165 12.6838 4.41649 13.0968 4.45023C13.522 4.48497 13.8954 4.55836 14.2409 4.7344C14.7897 5.01403 15.2359 5.46023 15.5155 6.00903C15.6915 6.35454 15.7649 6.72798 15.7997 7.15314C15.8334 7.56605 15.8334 8.07595 15.8334 8.70813V8.73317V11.7665V11.7915C15.8334 12.4237 15.8334 12.9336 15.7997 13.3465C15.7649 13.7717 15.6915 14.1452 15.5155 14.4907C15.2359 15.0395 14.7897 15.4857 14.2409 15.7653C13.8954 15.9413 13.522 16.0147 13.0968 16.0495C12.6839 16.0832 12.174 16.0832 11.5418 16.0832H11.5167H8.48341H8.45843C7.82626 16.0832 7.3163 16.0832 6.90339 16.0495C6.47822 16.0147 6.10478 15.9413 5.75928 15.7653C5.21047 15.4857 4.76427 15.0395 4.48465 14.4907C4.3086 14.1452 4.23521 13.7717 4.20048 13.3465C4.16674 12.9336 4.16674 12.4237 4.16675 11.7915V11.7665V8.73317V8.7082C4.16674 8.07599 4.16674 7.56607 4.20048 7.15314C4.23521 6.72798 4.3086 6.35454 4.48465 6.00903C4.76427 5.46023 5.21047 5.01403 5.75928 4.7344C6.10478 4.55836 6.47822 4.48497 6.90339 4.45023C7.31631 4.41649 7.82624 4.4165 8.45844 4.4165ZM6.99839 5.61303C6.64537 5.64187 6.44255 5.69563 6.28893 5.77391C5.95965 5.94169 5.69193 6.2094 5.52415 6.53869C5.44588 6.69231 5.39211 6.89513 5.36327 7.24814C5.33387 7.60797 5.33341 8.07015 5.33341 8.73317V11.7665C5.33341 12.4295 5.33387 12.8917 5.36327 13.2516C5.36613 13.2866 5.36925 13.3203 5.37261 13.3525L6.26742 11.8925L6.28131 11.8699C6.46683 11.5672 6.62664 11.3064 6.77319 11.11C6.92275 10.9096 7.11058 10.7022 7.37928 10.5859C7.74882 10.4259 8.16801 10.4259 8.53755 10.5859C8.80625 10.7022 8.99406 10.9096 9.14363 11.11C9.26806 11.2767 9.40199 11.4898 9.55313 11.7356L10.3508 10.4342L10.3647 10.4115C10.5502 10.1088 10.7099 9.84804 10.8565 9.65169C11.0061 9.45131 11.1939 9.24382 11.4626 9.12756C11.8322 8.96764 12.2513 8.96764 12.6209 9.12756C12.8896 9.24382 13.0774 9.45131 13.227 9.65169C13.3736 9.84804 13.5333 10.1088 13.7188 10.4115L13.7327 10.4342L14.6667 11.958L14.6667 11.7665V8.73317C14.6667 8.07015 14.6663 7.60797 14.6369 7.24814C14.6081 6.89513 14.5543 6.69231 14.476 6.53869C14.3082 6.2094 14.0405 5.94169 13.7112 5.77391C13.5576 5.69563 13.3548 5.64187 13.0018 5.61303C12.6419 5.58363 12.1798 5.58317 11.5167 5.58317H8.48341C7.82039 5.58317 7.35821 5.58363 6.99839 5.61303ZM10.2374 12.8518L11.5028 14.9165H11.5167C12.1798 14.9165 12.6419 14.916 13.0018 14.8866C13.3548 14.8578 13.5576 14.804 13.7112 14.7258C14.0405 14.558 14.3082 14.2903 14.476 13.961C14.4835 13.9462 14.4908 13.931 14.4979 13.9152L12.738 11.0439C12.5347 10.7121 12.4027 10.4978 12.292 10.3495C12.2036 10.231 12.1614 10.2013 12.1553 10.1973C12.0827 10.1666 12.0008 10.1666 11.9282 10.1973C11.922 10.2013 11.8799 10.231 11.7915 10.3495C11.6808 10.4978 11.5488 10.7121 11.3455 11.0439L10.2374 12.8518ZM10.1344 14.9165L8.6547 12.5022C8.45134 12.1704 8.31936 11.9561 8.20867 11.8079C8.12021 11.6893 8.07814 11.6596 8.07199 11.6556C7.99939 11.6249 7.91744 11.6249 7.84484 11.6556C7.83869 11.6596 7.79662 11.6893 7.70816 11.8079C7.59747 11.9561 7.46548 12.1704 7.26212 12.5022L6.00854 14.5475C6.09569 14.6153 6.1895 14.6751 6.28893 14.7258C6.44255 14.804 6.64537 14.8578 6.99839 14.8866C7.35821 14.916 7.82039 14.9165 8.48341 14.9165H10.1344Z\" fill=\"#212121\"/>\n    </svg>\n  );\n}\n\nconst TimeStick = (props: {swipe: SwipeDirectiveArgs}) => {\n  return (\n    <svg class={styles.TimeStick} use:swipe={props.swipe} width=\"6\" height=\"60\" viewBox=\"0 0 6 60\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n      <path d=\"M4 0.75C4.69036 0.75 5.25 1.30964 5.25 2V3.29297C5.24998 3.812 5.04377 4.30975 4.67676 4.67676C4.40352 4.95 4.25002 5.32061 4.25 5.70703V54.293C4.25002 54.6794 4.40352 55.05 4.67676 55.3232C5.04377 55.6903 5.24998 56.188 5.25 56.707V58C5.25 58.6904 4.69036 59.25 4 59.25H2C1.30964 59.25 0.75 58.6904 0.75 58V56.707C0.75002 56.188 0.956231 55.6903 1.32324 55.3232C1.59648 55.05 1.74998 54.6794 1.75 54.293V5.70703C1.74998 5.32061 1.59648 4.95 1.32324 4.67676C0.956231 4.30975 0.75002 3.812 0.75 3.29297V2C0.75 1.30964 1.30964 0.75 2 0.75H4Z\" fill=\"white\" stroke=\"#212121\" stroke-width=\"0.5\"/>\n    </svg>\n  )\n};\n\nexport const PausePlay: Component<{\n  paused: boolean;\n}> = (props) => {\n  return (\n    <svg\n      class={styles.PausePlaySvg}\n      classList={{\n        [styles.paused]: props.paused\n      }}\n      width=\"24\"\n      height=\"24\"\n      viewBox=\"0 0 24 24\"\n      fill=\"none\"\n      xmlns=\"http://www.w3.org/2000/svg\"\n    >\n      <clipPath id=\"playSymbolClipPath\">\n        <path class={styles.PausePlaySvgPlay} d=\"M5 19.9138V4.0862C5 2.83455 6.44254 2.13342 7.42673 2.90672L17.4988 10.8205C18.2632 11.4211 18.2632 12.5789 17.4988 13.1795L7.42673 21.0933C6.44254 21.8666 5 21.1655 5 19.9138Z\" fill=\"black\" /* transform=\"translate(8, 12) scale(1.4) translate(-8, -12)\" */ />\n      </clipPath>\n\n      <g class={styles.PausePlaySvgPause} id=\"pauseSymbol\" clip-path='url(#playSymbolClipPath)'>\n        <path class={styles.PausePlaySvgPauseLeft} d=\"M8.5 3H5C4.44772 3 4 3.44772 4 4V20C4 20.5523 4.44772 21 5 21H8.5C9.05228 21 9.5 20.5523 9.5 20V4C9.5 3.44772 9.05228 3 8.5 3Z\" fill=\"white\" />\n        <path class={styles.PausePlaySvgPauseRight} d=\"M19 3H15.5C14.9477 3 14.5 3.44772 14.5 4V20C14.5 20.5523 14.9477 21 15.5 21H19C19.5523 21 20 20.5523 20 20V4C20 3.44772 19.5523 3 19 3Z\" fill=\"white\" />\n      </g>\n    </svg>\n  );\n};\n\nfunction getPositionInCropper(e: PointerEvent | MouseEvent | TouchEvent, cropper: HTMLDivElement) {\n  const clientX = e instanceof TouchEvent ? e.changedTouches[0].clientX : e.clientX;\n\n  const bcr = cropper.getBoundingClientRect();\n  const x = clientX - bcr.left - HANDLE_WIDTH_PX;\n  const pos = x / (bcr.width - 2 * HANDLE_WIDTH_PX);\n\n  return clamp(pos, 0, 1);\n}\n\nexport default VideoControls;\n","import {onCleanup, onMount, Show, JSX} from 'solid-js';\nimport {Transition} from 'solid-transition-group';\n\nimport {useMediaEditorContext} from '@components/mediaEditor/context';\n\nimport BrushCanvas from '@components/mediaEditor/canvas/brushCanvas';\nimport CropHandles from '@components/mediaEditor/canvas/cropHandles';\nimport ImageCanvas from '@components/mediaEditor/canvas/imageCanvas';\nimport PreviewBrushSize from '@components/mediaEditor/canvas/previewBrushSize';\nimport ResizableLayers from '@components/mediaEditor/canvas/resizableLayers';\nimport RotationWheel from '@components/mediaEditor/canvas/rotationWheel';\nimport useFinalTransform from '@components/mediaEditor/canvas/useFinalTransform';\nimport VideoControls from '@components/mediaEditor/canvas/videoControls';\n\n\nexport default function MainCanvas() {\n  let container: HTMLDivElement;\n  const {editorState, mediaType} = useMediaEditorContext();\n\n  useFinalTransform();\n\n  onMount(() => {\n    const listener = () => {\n      const bcr = container.getBoundingClientRect();\n      editorState.canvasSize = [bcr.width, bcr.height];\n    };\n    listener();\n    window.addEventListener('resize', listener);\n    onCleanup(() => {\n      window.removeEventListener('resize', listener);\n    });\n  });\n\n  return (\n    <div ref={container} class=\"media-editor__main-canvas\">\n      <Show when={editorState.canvasSize}>\n        <ImageCanvas />\n        <Show when={editorState.isReady}>\n          <BrushCanvas />\n          <ResizableLayers />\n          <PreviewBrushSize />\n          {/* WTF ref causes infinite loop when passed without callback */}\n          <div ref={(el) => void (editorState.resizeHandlesContainer = el)} class=\"media-editor__resize-handles-overlay\" />\n          <CropHandles />\n          <RotationWheel />\n          <Show when={mediaType === 'video' && !!editorState.renderingPayload}>\n            <VideoControls />\n          </Show>\n        </Show>\n      </Show>\n    </div>\n  );\n}\n","import {snapToViewport} from '@components/mediaEditor/utils';\nimport {defaultCodec, highResCodec} from '@components/mediaEditor/finalRender/calcCodecAndBitrate';\n\nconst SIDE_MAX = 2560;\nconst SIDE_MIN = 240;\n\n\ntype Args = {\n  videoType: 'video' | 'gif';\n  imageWidth: number;\n  imageRatio: number;\n  cropOffset: { width: number; height: number; };\n  newRatio: number;\n  scale: number;\n  quality?: number;\n};\n\nexport default function getResultSize({imageWidth, cropOffset, imageRatio, newRatio, scale, videoType, quality}: Args) {\n  const [w] = snapToViewport(imageRatio, cropOffset.width, cropOffset.height);\n  const [cw] = snapToViewport(newRatio, cropOffset.width, cropOffset.height);\n\n  let scaledWidth = cw / (w * scale) * imageWidth,\n    scaledHeight = scaledWidth / newRatio;\n\n  const willResultInVideo = !!videoType;\n\n  if(Math.max(scaledWidth, scaledHeight) < SIDE_MIN) {\n    [scaledWidth, scaledHeight] = snapToViewport(newRatio, SIDE_MIN, SIDE_MIN);\n  }\n  if(videoType === 'gif' && (scaledWidth > defaultCodec.width || scaledHeight > defaultCodec.height)) {\n    [scaledWidth, scaledHeight] = snapToViewport(newRatio, defaultCodec.width, defaultCodec.height);\n  }\n  if(videoType === 'video' && (scaledWidth > highResCodec.width || scaledHeight > highResCodec.height)) {\n    [scaledWidth, scaledHeight] = snapToViewport(newRatio, highResCodec.width, highResCodec.height);\n  }\n  if(!willResultInVideo && Math.max(scaledWidth, scaledHeight) > SIDE_MAX) {\n    [scaledWidth, scaledHeight] = snapToViewport(newRatio, SIDE_MAX, SIDE_MAX);\n  }\n\n  if(quality) {\n    scaledHeight = quality;\n    scaledWidth = quality * newRatio;\n  }\n\n  scaledWidth = Math.floor(scaledWidth);\n  scaledHeight = Math.floor(scaledHeight);\n  scaledWidth = scaledWidth % 2 == 0 ? scaledWidth : scaledWidth - 1;\n  scaledHeight = scaledHeight % 2 == 0 ? scaledHeight : scaledHeight - 1;\n\n  return [scaledWidth, scaledHeight];\n}\n","import {FinalTransform} from '@components/mediaEditor/canvas/useFinalTransform';\nimport {useCropOffset} from '@components/mediaEditor/canvas/useCropOffset';\nimport {MediaEditorContextValue} from '@components/mediaEditor/context';\nimport {getSnappedViewportsScale} from '@components/mediaEditor/utils';\n\nexport type GetResultTransformArgs = {\n  context: MediaEditorContextValue;\n  scaledWidth: number;\n  scaledHeight: number;\n  imageWidth: number;\n  imageHeight: number;\n  cropOffset: ReturnType<typeof useCropOffset>;\n};\n\nexport default function getResultTransform({\n  context,\n  scaledWidth,\n  scaledHeight,\n  imageWidth,\n  imageHeight,\n  cropOffset\n}: GetResultTransformArgs): FinalTransform {\n  const {\n    editorState: {canvasSize},\n    mediaState: {scale, translation, rotation, flip, currentImageRatio}\n  } = context;\n\n  const initialCanvasWidth = canvasSize[0];\n  const initialCanvasHeight = canvasSize[1];\n\n  const imageRatio = imageWidth / imageHeight;\n\n  const canvasRatio = initialCanvasWidth / initialCanvasHeight;\n  let snappedCanvasWidth = scaledWidth,\n    snappedCanvasHeight = scaledHeight;\n  if(scaledWidth / canvasRatio < scaledHeight) snappedCanvasWidth = scaledHeight * canvasRatio;\n  else snappedCanvasHeight = scaledWidth / canvasRatio;\n\n  let toCropScale = getSnappedViewportsScale(\n    imageRatio,\n    cropOffset().width,\n    cropOffset().height,\n    snappedCanvasWidth,\n    snappedCanvasHeight\n  );\n  const fromCroppedScale =\n    1 /\n    getSnappedViewportsScale(\n      currentImageRatio,\n      cropOffset().width,\n      cropOffset().height,\n      snappedCanvasWidth,\n      snappedCanvasHeight\n    );\n\n  toCropScale *= fromCroppedScale;\n\n  const snappedImageScale = Math.min(snappedCanvasWidth / imageWidth, snappedCanvasHeight / imageHeight);\n\n  const cropTranslation = translation.map((x) => x * fromCroppedScale - x);\n\n  return {\n    flip: flip,\n    rotation: rotation,\n    scale: scale * snappedImageScale * toCropScale,\n    translation: [cropTranslation[0] + translation[0], cropTranslation[1] + translation[1]]\n  };\n}\n","import {unwrap} from 'solid-js/store';\n\nimport {FinalTransform} from '@components/mediaEditor/canvas/useFinalTransform';\nimport {MediaEditorContextValue} from '@components/mediaEditor/context';\nimport {NumberPair} from '@components/mediaEditor/types';\n\nexport type ScaledLayersAndLines = ReturnType<typeof getScaledLayersAndLines>;\n\nexport default function getScaledLayersAndLines(\n  context: MediaEditorContextValue,\n  finalTransform: FinalTransform,\n  width: number,\n  height: number\n) {\n  const {mediaState: {resizableLayers, brushDrawnLines}, editorState: {pixelRatio}} = context;\n\n  function processPoint(point: NumberPair) {\n    const r = [Math.sin(-finalTransform.rotation), Math.cos(-finalTransform.rotation)];\n    point = [point[0] * r[1] + point[1] * r[0], point[1] * r[1] - point[0] * r[0]];\n    point = [\n      point[0] * finalTransform.scale + width / 2 + finalTransform.translation[0],\n      point[1] * finalTransform.scale + height / 2 + finalTransform.translation[1]\n    ];\n    return point;\n  }\n\n  const scaledLines = brushDrawnLines.map(({size, points, ...line}) => ({\n    ...line,\n    size: size * finalTransform.scale,\n    points: points.map(processPoint)\n  }));\n  const scaledLayers = resizableLayers.map((layerStore) => {\n    const layer = {...unwrap(layerStore)};\n\n    layer.position = processPoint(layer.position);\n    layer.rotation += finalTransform.rotation;\n    layer.scale *= finalTransform.scale;\n\n    if(layer.textInfo) {\n      layer.textInfo = {...layer.textInfo};\n      layer.textInfo.size *= layer.scale * pixelRatio;\n    }\n    return layer;\n  });\n\n  return {scaledLines, scaledLayers};\n}\n","export const FRAMES_PER_SECOND = 60;\nexport const STICKER_SIZE = 200;\n","import {MediaEditorContextValue} from '@components/mediaEditor/context';\nimport {snapToViewport} from '@components/mediaEditor/utils';\nimport {ResizableLayer} from '@components/mediaEditor/types';\n\nimport {STICKER_SIZE} from '@components/mediaEditor/finalRender/constants';\n\nexport default function drawStickerLayer(\n  context: MediaEditorContextValue,\n  ctx: CanvasRenderingContext2D,\n  layer: ResizableLayer,\n  source: CanvasImageSource,\n  ratio: number,\n  densityAware = true\n) {\n  const {editorState: {stickersLayersInfo, pixelRatio}} = context;\n\n  const {container} = stickersLayersInfo[layer.id];\n  const stickerChild = container?.lastElementChild;\n  if(!stickerChild) return;\n\n  const size = STICKER_SIZE * layer.scale * (densityAware ? pixelRatio : 1);\n\n  ctx.save();\n  ctx.translate(layer.position[0], layer.position[1]);\n  ctx.rotate(layer.rotation);\n\n  const [w, h] = snapToViewport(ratio, size, size);\n\n  ctx.drawImage(source, -size / 2 + (size - w) / 2, -size / 2 + (size - h) / 2, w, h);\n\n  ctx.restore();\n}\n","import {MediaEditorContextValue} from '@components/mediaEditor/context';\nimport {fontInfoMap, getContrastColor} from '@components/mediaEditor/utils';\nimport {ResizableLayer} from '@components/mediaEditor/types';\n\nexport default function drawTextLayer(\n  context: MediaEditorContextValue,\n  ctx: CanvasRenderingContext2D,\n  layer: ResizableLayer,\n  densityAware = true\n) {\n  if(layer.type !== 'text') return;\n\n  const {editorState: {pixelRatio}} = context;\n\n  const renderingInfo = {...layer.textRenderingInfo};\n  const scale = layer.scale * (densityAware ? pixelRatio : 1);\n  renderingInfo.height *= scale;\n  renderingInfo.width *= scale;\n  renderingInfo.lines = renderingInfo.lines.map((line) => ({\n    ...line,\n    height: line.height * scale,\n    left: line.left * scale,\n    right: line.right * scale\n  }));\n\n  if(renderingInfo.path) {\n    const newPath = [...renderingInfo.path];\n    function multiply(i: number) {\n      newPath[i] = (newPath[i] as number) * scale;\n    }\n    newPath.forEach((part, i) => {\n      if(part === 'M' || part === 'L') {\n        multiply(i + 1);\n        multiply(i + 2);\n      } else if(part === 'A') {\n        multiply(i + 1);\n        multiply(i + 2);\n        multiply(i + 6);\n        multiply(i + 7);\n      }\n    });\n    renderingInfo.path = newPath;\n  }\n\n  ctx.save();\n  ctx.translate(layer.position[0], layer.position[1]);\n  ctx.rotate(layer.rotation);\n\n  let prevY = -renderingInfo.height / 2;\n  const boxLeft = -renderingInfo.width / 2;\n  const fontInfo = fontInfoMap[layer.textInfo.font];\n\n  if(layer.textInfo.style === 'background') {\n    ctx.translate(boxLeft, prevY);\n\n    ctx.fillStyle = layer.textInfo.color;\n    const path = new Path2D(renderingInfo.path.join(' '));\n\n    ctx.fill(path);\n    ctx.translate(-boxLeft, -prevY);\n  }\n\n  renderingInfo.lines.forEach((line) => {\n    const yOffset = line.height * fontInfo.baseline;\n    let xOffset = 0.2 * layer.textInfo.size;\n    if(layer.textInfo.style === 'background') xOffset = 0.3 * layer.textInfo.size;\n\n    ctx.font = `${fontInfo.fontWeight} ${layer.textInfo.size}px ${fontInfo.fontFamily}`;\n\n    const x = boxLeft + xOffset + line.left,\n      y = prevY + yOffset;\n\n    if(layer.textInfo.style === 'outline') {\n      ctx.lineWidth = layer.textInfo.size * 0.15;\n      ctx.strokeStyle = layer.textInfo.color;\n      ctx.strokeText(line.content, x, y);\n      ctx.fillStyle = getContrastColor(layer.textInfo.color);\n      ctx.fillText(line.content, x, y);\n    } else if(layer.textInfo.style === 'background') {\n      ctx.fillStyle = getContrastColor(layer.textInfo.color);\n      ctx.fillText(line.content, x, y);\n    } else {\n      ctx.fillStyle = layer.textInfo.color;\n      ctx.fillText(line.content, x, y);\n    }\n    prevY += line.height;\n  });\n\n  ctx.restore();\n}\n","import {unwrap} from 'solid-js/store';\nimport {useCropOffset} from '@components/mediaEditor/canvas/useCropOffset';\nimport useProcessPoint from '@components/mediaEditor/canvas/useProcessPoint';\nimport {useMediaEditorContext} from '@components/mediaEditor/context';\nimport {snapToViewport} from '@components/mediaEditor/utils';\nimport drawStickerLayer from '@components/mediaEditor/finalRender/drawStickerLayer';\nimport drawTextLayer from '@components/mediaEditor/finalRender/drawTextLayer';\n\n\ntype Args = {\n  scaledWidth: number;\n  scaledHeight: number;\n};\n\nexport async function generateVideoPreview({scaledWidth, scaledHeight}: Args) {\n  const context = useMediaEditorContext();\n\n  const {\n    editorState: {\n      canvasSize: [cw, ch], imageCanvas, brushCanvas, currentTab, stickersLayersInfo, finalTransform: {scale}\n    },\n    mediaState: {\n      resizableLayers, rotation\n    }\n  } = context;\n\n  const processPoint = useProcessPoint(false);\n  const cropOffset = useCropOffset();\n\n  const isCropping = currentTab === 'crop';\n\n  const ratio = scaledWidth / scaledHeight;\n\n  const [previewWidth, previewHeight] = snapToViewport(ratio, isCropping ? cropOffset().width : cw, isCropping ? cropOffset().height : ch);\n\n  const mirrorCanvas = document.createElement('canvas');\n  [mirrorCanvas.width, mirrorCanvas.height] = [cw, ch];\n\n  const previewCanvas = document.createElement('canvas');\n  [previewCanvas.width, previewCanvas.height] = [previewWidth, previewHeight];\n\n\n  const previewCtx = previewCanvas.getContext('2d');\n  const mirrorCtx = mirrorCanvas.getContext('2d');\n\n  mirrorCtx.drawImage(imageCanvas, 0, 0, cw, ch);\n  mirrorCtx.drawImage(brushCanvas, 0, 0, cw, ch);\n\n  const processedLayers = unwrap(resizableLayers).map(layer => ({\n    ...layer,\n    position: processPoint(layer.position),\n    rotation: layer.rotation + rotation,\n    scale: layer.scale * scale,\n    textInfo: layer.textInfo ? {\n      ...layer.textInfo,\n      size: layer.textInfo.size * layer.scale * scale\n    } : undefined\n  }));\n\n  processedLayers.forEach((layer) => {\n    if(layer.type === 'text') drawTextLayer(context, mirrorCtx, layer, false);\n\n    if(layer.type === 'sticker') {\n      const {container} = stickersLayersInfo[layer.id];\n      const stickerChild = container?.lastElementChild;\n\n      let ratio: number;\n\n      if(stickerChild instanceof HTMLImageElement)\n        ratio = stickerChild.naturalWidth / stickerChild.naturalHeight;\n      else if(stickerChild instanceof HTMLCanvasElement)\n        ratio = 1;\n      else if(stickerChild instanceof HTMLVideoElement)\n        ratio = stickerChild.videoWidth / stickerChild.videoHeight;\n      else return;\n\n      drawStickerLayer(context, mirrorCtx, layer, stickerChild, ratio, false);\n    }\n  });\n\n  if(isCropping) {\n    previewCtx.drawImage(\n      mirrorCanvas,\n      cropOffset().left + (cropOffset().width - previewWidth) / 2, cropOffset().top + (cropOffset().height - previewHeight) / 2, previewWidth, previewHeight,\n      0, 0, previewWidth, previewHeight\n    );\n  } else {\n    previewCtx.drawImage(\n      mirrorCanvas,\n      (cw - previewWidth) / 2, (ch - previewHeight) / 2, previewWidth, previewHeight,\n      0, 0, previewWidth, previewHeight\n    );\n  }\n\n  const previewBlob = await new Promise<Blob>((resolve) => previewCanvas.toBlob(resolve));\n\n  return previewBlob;\n}\n","import deferredPromise, {CancellablePromise} from '@helpers/cancellablePromise';\nimport appDownloadManager from '@lib/appDownloadManager';\nimport {Document} from '@layer';\n\nimport {StickerFrameByFrameRenderer} from '@components/mediaEditor/finalRender/types';\n\nexport default class ImageStickerFrameByFrameRenderer implements StickerFrameByFrameRenderer {\n  private image: HTMLImageElement;\n\n  async init(doc: Document.document) {\n    const blob = await appDownloadManager.downloadMedia({\n      media: doc\n    });\n\n    const image = (this.image = new Image());\n    image.src = URL.createObjectURL(blob);\n\n    const deferred = deferredPromise<void>();\n\n    image.addEventListener('load', () => {\n      deferred.resolve();\n    });\n\n    await deferred;\n  }\n\n  getTotalFrames() {\n    return 1;\n  }\n\n  getRatio() {\n    return this.image.naturalWidth / this.image.naturalHeight;\n  }\n\n  async renderFrame() {}\n\n  getRenderedFrame() {\n    return this.image;\n  }\n\n  destroy() {\n    this.image = null;\n  }\n}\n","import deferredPromise, {CancellablePromise} from '@helpers/cancellablePromise';\nimport RLottiePlayer from '@lib/rlottie/rlottiePlayer';\nimport appDownloadManager from '@lib/appDownloadManager';\nimport lottieLoader from '@lib/rlottie/lottieLoader';\nimport {Document} from '@layer';\n\nimport {StickerFrameByFrameRenderer} from '@components/mediaEditor/finalRender/types';\n\nexport default class LottieStickerFrameByFrameRenderer implements StickerFrameByFrameRenderer {\n  private frameCount: number = 0;\n  private currentDeferredFrame: CancellablePromise<void>;\n  private container: HTMLDivElement;\n  private animation: RLottiePlayer;\n\n  async init(doc: Document.document, size: number) {\n    const blob = await appDownloadManager.downloadMedia({\n      media: doc\n    });\n    const container = (this.container = document.createElement('div'));\n    container.style.width = size + 'px';\n    container.style.height = size + 'px';\n    container.style.position = 'absolute';\n    container.style.opacity = '0';\n    container.style.pointerEvents = 'none';\n\n    document.body.append(container);\n    const animation = (this.animation = await lottieLoader.loadAnimationWorker({\n      container: container,\n      autoplay: false,\n      animationData: blob,\n      width: size,\n      height: size,\n      name: 'doc' + doc.id\n    }));\n\n    const deferred = deferredPromise<void>();\n\n    animation.addEventListener('ready', () => {\n      this.frameCount = animation.maxFrame + 1;\n      deferred.resolve();\n    });\n\n    animation.addEventListener('enterFrame', () => {\n      this.currentDeferredFrame?.resolve();\n    });\n\n    await deferred;\n  }\n\n  getTotalFrames() {\n    return this.frameCount;\n  }\n\n  getRatio() {\n    return 1 / 1;\n  }\n\n  async renderFrame(frame: number) {\n    this.currentDeferredFrame = deferredPromise<void>();\n    this.animation.requestFrame(frame);\n    await this.currentDeferredFrame;\n  }\n\n  getRenderedFrame() {\n    return this.animation.canvas[0];\n  }\n\n  destroy() {\n    this.container.remove();\n    this.animation.remove();\n  }\n}\n","import deferredPromise, {CancellablePromise} from '@helpers/cancellablePromise';\nimport appDownloadManager from '@lib/appDownloadManager';\nimport {getMiddleware} from '@helpers/middleware';\nimport {Document} from '@layer';\nimport createVideo from '@helpers/dom/createVideo';\nimport onMediaLoad from '@helpers/onMediaLoad';\nimport apiManagerProxy from '@lib/apiManagerProxy';\nimport handleVideoLeak from '@helpers/dom/handleVideoLeak';\nimport {IS_FIREFOX} from '@environment/userAgent';\n\nimport {delay} from '@components/mediaEditor/utils';\n\nimport {StickerFrameByFrameRenderer} from '@components/mediaEditor/finalRender/types';\nimport {FRAMES_PER_SECOND} from '@components/mediaEditor/finalRender/constants';\n\nexport default class VideoStickerFrameByFrameRenderer implements StickerFrameByFrameRenderer {\n  private duration: number = 0;\n  private currentDeferredFrame: CancellablePromise<void>;\n  private video: HTMLVideoElement;\n\n  private middleware = getMiddleware();\n\n  async init(doc: Document.document) {\n    const blob = await appDownloadManager.downloadMedia({\n      media: doc\n    });\n\n    const video = (this.video = createVideo({middleware: this.middleware.get()}));\n    video.src = await apiManagerProxy.invoke('createObjectURL', blob);\n    // video.autoplay = true;\n    video.controls = false;\n    video.muted = true;\n    // video.loop = true;\n    video.preload = 'auto';\n\n    const promise = onMediaLoad(video as HTMLMediaElement);\n    await handleVideoLeak(video, promise);\n    await delay(100); // Necessary\n    this.duration = video.duration;\n\n    video.addEventListener('seeked', () => {\n      this.currentDeferredFrame?.resolve();\n    });\n  }\n\n  getTotalFrames() {\n    return IS_FIREFOX ? 1 : Math.floor(this.duration * FRAMES_PER_SECOND);\n  }\n\n  async renderFrame(frame: number) {\n    if(IS_FIREFOX) return;\n    this.currentDeferredFrame = deferredPromise<void>();\n    this.video.currentTime = (1 / FRAMES_PER_SECOND) * frame;\n    await this.currentDeferredFrame;\n  }\n\n  getRatio() {\n    return this.video.videoWidth / this.video.videoHeight;\n  }\n\n  getRenderedFrame() {\n    return this.video;\n  }\n\n  destroy() {\n    this.middleware.destroy();\n    this.video = null;\n  }\n}\n","import {createRoot, createSignal, getOwner, runWithOwner} from 'solid-js';\nimport {animate} from '@helpers/animation';\nimport deferredPromise, {CancellablePromise} from '@helpers/cancellablePromise';\nimport ListenerSetter from '@helpers/listenerSetter';\nimport {MediaSize} from '@helpers/mediaSize';\nimport noop from '@helpers/noop';\nimport clamp from '@helpers/number/clamp';\nimport {logger} from '@lib/logger';\nimport {useMediaEditorContext} from '@components/mediaEditor/context';\nimport {supportsAudioEncoding} from '@components/mediaEditor/support';\nimport {delay, snapToViewport} from '@components/mediaEditor/utils';\nimport {RenderingPayload} from '@components/mediaEditor/webgl/initWebGL';\nimport calcCodecAndBitrate, {BITRATE_TARGET_FPS} from '@components/mediaEditor/finalRender/calcCodecAndBitrate';\nimport {FRAMES_PER_SECOND, STICKER_SIZE} from '@components/mediaEditor/finalRender/constants';\nimport {MediaEditorFinalResultPayload} from '@components/mediaEditor/finalRender/createFinalResult';\nimport drawStickerLayer from '@components/mediaEditor/finalRender/drawStickerLayer';\nimport drawTextLayer from '@components/mediaEditor/finalRender/drawTextLayer';\nimport {generateVideoPreview} from '@components/mediaEditor/finalRender/generateVideoPreview';\nimport {ScaledLayersAndLines} from '@components/mediaEditor/finalRender/getScaledLayersAndLines';\nimport ImageStickerFrameByFrameRenderer from '@components/mediaEditor/finalRender/imageStickerFrameByFrameRenderer';\nimport LottieStickerFrameByFrameRenderer from '@components/mediaEditor/finalRender/lottieStickerFrameByFrameRenderer';\nimport {StickerFrameByFrameRenderer} from '@components/mediaEditor/finalRender/types';\nimport VideoStickerFrameByFrameRenderer from '@components/mediaEditor/finalRender/videoStickerFrameByFrameRenderer';\nimport StickerType from '@config/stickerType';\n\n\ntype Args = {\n  renderingPayload: RenderingPayload;\n  hasAnimatedStickers: boolean;\n  scaledLayers: ScaledLayersAndLines['scaledLayers'];\n  scaledWidth: number;\n  scaledHeight: number;\n  ctx: CanvasRenderingContext2D;\n  imageCanvasGL: WebGLRenderingContext;\n  imageCanvas: HTMLCanvasElement;\n  drawToImageCanvas: () => void;\n  brushCanvas: HTMLCanvasElement;\n  resultCanvas: HTMLCanvasElement;\n};\n\nconst EXPECTED_FPS = 30;\nconst VIDEO_COMPARISON_ERROR = 0.0001;\n\nconst THUMBNAIL_MAX_SIZE = 720;\n\nconst log = logger('MediaEditor.createFinalResult.renderToActualVideo');\n\nexport default async function renderToActualVideo({\n  renderingPayload,\n  hasAnimatedStickers,\n  scaledWidth,\n  scaledHeight,\n  scaledLayers,\n  ctx,\n  imageCanvasGL: gl,\n  imageCanvas,\n  drawToImageCanvas,\n  brushCanvas,\n  resultCanvas\n}: Args) {\n  const context = useMediaEditorContext();\n\n  const {\n    editorState: {pixelRatio},\n    mediaState: {videoCropStart, videoCropLength, videoMuted, videoThumbnailPosition},\n    getMediaBlob\n  } = context;\n\n  const {media: {video}} = renderingPayload;\n\n  const owner = getOwner();\n\n  video.muted = true;\n  const startTime = video.duration * videoCropStart;\n  const endTime = video.duration * (videoCropStart + videoCropLength);\n\n  const creationProgress = createRoot(dispose => {\n    const signal = createSignal(0);\n    return {signal, dispose};\n  });\n\n  const [progress, setProgress] = creationProgress.signal;\n\n  const renderers = new Map<number, StickerFrameByFrameRenderer>();\n\n  const thumbnailCanvas = document.createElement('canvas');\n  [thumbnailCanvas.width, thumbnailCanvas.height] = snapToViewport(scaledWidth / scaledHeight, Math.min(scaledWidth, THUMBNAIL_MAX_SIZE), Math.min(scaledHeight, THUMBNAIL_MAX_SIZE));\n  const thumbnailCtx = thumbnailCanvas.getContext('2d');\n\n  const thumbnailTime = videoThumbnailPosition * video.duration;\n\n  let\n    currentVideoFrameDeferred: CancellablePromise<number>,\n    encodingPausedDeferred: CancellablePromise<void>,\n    lastTime = 0,\n    frameCallbackId: number,\n    drewThumbnail = false,\n    canceled = false,\n    progressRAF = 0\n  ;\n\n  const listenerSetter = new ListenerSetter;\n\n  listenerSetter.add(window)('focus', () => {\n    log('window focus changed', 'focused');\n    encodingPausedDeferred?.resolve?.();\n    encodingPausedDeferred = undefined;\n  });\n\n  listenerSetter.add(window)('blur', () => {\n    log('window focus changed', 'blurred');\n    encodingPausedDeferred = deferredPromise();\n    currentVideoFrameDeferred?.reject(ThrowReason.EncodingPaused);\n  });\n\n  async function initMuxerAndEncoder() {\n    const {Muxer, ArrayBufferTarget} = await import('mp4-muxer');\n\n    let audioBuffer: AudioBuffer, mediaBlob: Blob;\n\n    if(!videoMuted && await supportsAudioEncoding() && (mediaBlob = await getMediaBlob())) try {\n      audioBuffer = await extractAudioFragment(mediaBlob, startTime, endTime);\n    } catch{}\n\n    const muxer = new Muxer({\n      target: new ArrayBufferTarget(),\n      video: {\n        codec: 'avc',\n        width: scaledWidth,\n        height: scaledHeight\n      },\n      audio: audioBuffer ? {\n        codec: 'opus',\n        sampleRate: audioBuffer.sampleRate,\n        numberOfChannels: audioBuffer.numberOfChannels\n      } : undefined,\n      fastStart: 'in-memory'\n    });\n\n    const encoder = new VideoEncoder({\n      output: (chunk, meta) => muxer.addVideoChunk(chunk, meta),\n      error: (e) => console.error(e)\n    });\n\n    encoder.configure({\n      width: scaledWidth,\n      height: scaledHeight,\n      ...calcCodecAndBitrate(scaledWidth, scaledHeight, BITRATE_TARGET_FPS)\n    });\n\n    return {muxer, encoder, audioBuffer};\n  }\n\n  function drawToTexture() {\n    gl.bindTexture(gl.TEXTURE_2D, renderingPayload.texture);\n    gl.texSubImage2D(gl.TEXTURE_2D, 0, 0, 0, gl.RGBA, gl.UNSIGNED_BYTE, video);\n  }\n\n  async function initStickerRenderers() {\n    await Promise.all(\n      scaledLayers.map(async(layer) => {\n        if(!layer.sticker) return;\n\n        const stickerType = layer.sticker?.sticker;\n        let renderer: StickerFrameByFrameRenderer;\n\n        if(stickerType === StickerType.Static) renderer = new ImageStickerFrameByFrameRenderer();\n        if(stickerType === StickerType.Lottie) renderer = new LottieStickerFrameByFrameRenderer();\n        if(stickerType === StickerType.WebM) renderer = new VideoStickerFrameByFrameRenderer();\n        if(!renderer) return;\n\n        renderers.set(layer.id, renderer);\n        await renderer.init(layer.sticker!, STICKER_SIZE * layer.scale * pixelRatio);\n      })\n    );\n  }\n\n  enum ThrowReason {\n    EncodingPaused,\n    TimeLoopback\n  };\n\n  async function prepareAndRenderFrame(encoder: VideoEncoder, frameNo: number) {\n    currentVideoFrameDeferred = deferredPromise();\n\n    const callback = (mediaTime: number) => {\n      drawToTexture();\n      video.pause();\n\n      currentVideoFrameDeferred.resolve(mediaTime);\n    };\n\n    if(frameNo === 0) callback(0);\n    else {\n      frameCallbackId = video.requestVideoFrameCallback((_, {mediaTime}) => void callback(mediaTime));\n      if(video.paused) await video.play();\n    }\n\n    let mediaTime: number;\n    try {\n      mediaTime = await currentVideoFrameDeferred;\n    } catch(e: unknown) {\n      video.pause();\n      if(e === ThrowReason.EncodingPaused && encodingPausedDeferred) {\n        await encodingPausedDeferred;\n        log('paused case was playing', lastTime + startTime);\n        const deferred = deferredPromise<void>();\n\n        listenerSetter.add(video)('seeked', () => {\n          deferred.resolve();\n        }, {once: true});\n\n        video.currentTime = lastTime + startTime;\n\n        await deferred;\n      }\n      throw e;\n    }\n\n    const currentTime = frameNo === 0 ? 0 : mediaTime - startTime;\n    if(currentTime < lastTime) throw ThrowReason.TimeLoopback;\n\n    // Fill static frame with stickers frames\n    if(hasAnimatedStickers) {\n      const untilFrame = Math.round(currentTime * EXPECTED_FPS);\n      for(let frame = Math.round(lastTime * EXPECTED_FPS) + 1; frame < untilFrame; frame++) {\n        await renderFrame({\n          frameNo: frame / EXPECTED_FPS * FRAMES_PER_SECOND | 0,\n          timestamp: frame / EXPECTED_FPS * 1e6 | 0,\n          appendToMuxer: true,\n          encoder\n        });\n      }\n    }\n\n    lastTime = currentTime;\n\n    await renderFrame({\n      frameNo: currentTime * FRAMES_PER_SECOND | 0,\n      timestamp: currentTime * 1e6 | 0,\n      appendToMuxer: true,\n      encoder\n    });\n\n    // Save the thumbnail if it's more or less in the same frame as the current time\n    if(!drewThumbnail && thumbnailTime - 0.5 / EXPECTED_FPS <= currentTime && currentTime <= thumbnailTime + 0.5 / EXPECTED_FPS) {\n      drewThumbnail = true;\n      thumbnailCtx.drawImage(resultCanvas, 0, 0, thumbnailCanvas.width, thumbnailCanvas.height);\n    }\n  }\n\n  type RenderFrameArgs = {\n    frameNo: number;\n    timestamp: number;\n    appendToMuxer: boolean;\n    encoder: VideoEncoder;\n  };\n\n  async function renderFrame({frameNo, timestamp, appendToMuxer, encoder}: RenderFrameArgs) {\n    const promises = Array.from(renderers.values()).map((renderer) =>\n      renderer.renderFrame(frameNo % (renderer.getTotalFrames()))\n    );\n\n    await Promise.all(promises);\n\n    drawToImageCanvas();\n\n    ctx.clearRect(0, 0, scaledWidth, scaledHeight);\n    ctx.drawImage(imageCanvas, 0, 0);\n    ctx.drawImage(brushCanvas, 0, 0);\n\n    scaledLayers.forEach((layer) => {\n      if(layer.type === 'text') drawTextLayer(context, ctx, layer);\n      if(layer.type === 'sticker' && renderers.has(layer.id)) {\n        const renderer = renderers.get(layer.id);\n        drawStickerLayer(context, ctx, layer, renderer.getRenderedFrame(), renderer.getRatio());\n      }\n    });\n\n    if(!appendToMuxer) return;\n\n    const videoFrame = new VideoFrame(resultCanvas, {timestamp});\n\n    encoder.encode(videoFrame);\n    videoFrame.close();\n  }\n\n  function updateProgress(targetProgress: number) {\n    const speed = 0.05;\n    const currentProgress = progress();\n\n    const delta = targetProgress - currentProgress;\n\n    if(delta < 0.0025) { // fourth of a percent\n      setProgress(targetProgress);\n      return;\n    }\n\n    setProgress(currentProgress + delta * speed);\n\n    progressRAF = requestAnimationFrame(() => updateProgress(targetProgress));\n  }\n\n  function cleanup(encoder: VideoEncoder) {\n    encoder.close();\n    Array.from(renderers.values()).forEach((renderer) => renderer.destroy());\n    listenerSetter.removeAll();\n    cancelAnimationFrame(progressRAF);\n    video.src = '';\n    video.load();\n  }\n\n  setProgress(0);\n\n  const preview = await runWithOwner(owner, () => generateVideoPreview({scaledWidth, scaledHeight}));\n\n  const resultPromise = new Promise<MediaEditorFinalResultPayload>(async(resolve, reject) => {\n    const firstFrameSeekDeferred = deferredPromise<void>();\n    video.currentTime = video.duration * videoCropStart;\n    video.addEventListener('seeked', () => void firstFrameSeekDeferred.resolve(), {once: true});\n\n    const [{muxer, encoder, audioBuffer}] = await Promise.all([\n      initMuxerAndEncoder(),\n      delay(200),\n      firstFrameSeekDeferred,\n      initStickerRenderers()\n    ]);\n\n    let frameNo = 0;\n\n    let done = false;\n\n    animate(() => {\n      if(encodingPausedDeferred) return true;\n\n      if(video.currentTime >= endTime - VIDEO_COMPARISON_ERROR) {\n        done = true;\n        currentVideoFrameDeferred.resolve(endTime);\n      }\n      return !done;\n    });\n\n    // let avg = 0, cnt = 0;\n\n    // const startrendering = performance.now();\n\n    while(video.currentTime < endTime - VIDEO_COMPARISON_ERROR) {\n      if(canceled) {\n        reject();\n\n        done = true;\n        video.pause();\n\n        cleanup(encoder);\n        return;\n      }\n\n      try {\n        // const start = performance.now();\n        log('prepareAndRenderFrame', frameNo);\n        if(encodingPausedDeferred) {\n          log('paused case was paused', lastTime + startTime);\n          await encodingPausedDeferred;\n        }\n        await prepareAndRenderFrame(encoder, frameNo);\n        // const end = performance.now();\n        // const time = end - start;\n        // cnt++;\n        // avg += (time - avg) / cnt;\n      } catch(e: unknown) {\n        if(typeof e !== 'number') break;\n\n        if(e === ThrowReason.EncodingPaused) await encodingPausedDeferred;\n        else if(e === ThrowReason.TimeLoopback) break;\n      }\n\n      updateProgress(clamp((video.currentTime - startTime) / (endTime - startTime), 0, 1));\n      frameNo++;\n    }\n\n    done = true;\n    video.cancelVideoFrameCallback(frameCallbackId);\n    video.pause();\n\n    // const endrendering = performance.now();\n\n    if(!drewThumbnail) {\n      const deferred = deferredPromise<void>();\n\n      video.addEventListener('seeked', () => {\n        deferred.resolve();\n      }, {once: true});\n      video.currentTime = thumbnailTime;\n\n      await Promise.race([deferred, delay(2_000)]); // just in case you know\n\n      drawToTexture();\n      await renderFrame({frameNo: 0, timestamp: 0, appendToMuxer: false, encoder});\n\n      thumbnailCtx.drawImage(resultCanvas, 0, 0, thumbnailCanvas.width, thumbnailCanvas.height);\n    }\n\n    if(audioBuffer) await encodeAndMuxAudio(audioBuffer, (chunk) => muxer.addAudioChunk(chunk));\n\n    await encoder.flush();\n\n    muxer.finalize();\n\n    cleanup(encoder);\n\n    const {buffer} = muxer.target;\n\n    setProgress(1);\n\n    const thumbBlob = await new Promise<Blob>(resolve => thumbnailCanvas.toBlob(resolve));\n\n    resolve({\n      blob: new Blob([buffer], {type: 'video/mp4'}),\n      hasSound: !!audioBuffer,\n      thumb: {\n        blob: thumbBlob,\n        size: new MediaSize(thumbnailCanvas.width, thumbnailCanvas.height)\n      }\n    });\n\n    // alert(JSON.stringify({\n    //   avg,\n    //   total: endrendering - startrendering,\n    //   frameNo,\n    //   duration: video.duration\n    // }, null, 2));\n  });\n\n  let result: MediaEditorFinalResultPayload;\n\n  resultPromise.then((value) => (result = value)).catch(noop);\n\n  return {\n    preview,\n    isVideo: true,\n    getResult: () => {\n      return result ?? resultPromise;\n    },\n    cancel: () => {\n      canceled = true;\n    },\n    creationProgress\n  };\n\n  // const div = document.createElement('div')\n  // div.style.position = 'fixed';\n  // div.style.zIndex = '1000';\n  // div.style.top = '50%';\n  // div.style.left = '50%';\n  // div.style.transform = 'translate(-50%, -50%)';\n  // const img = document.createElement('video')\n  // img.src = URL.createObjectURL(blob)\n  // img.controls = true\n  // img.autoplay = true\n  // img.loop = true\n  // img.style.maxWidth = '450px'\n  // div.append(img)\n  // document.body.append(div)\n}\n\nasync function extractAudioFragment(blob: Blob, startTime: number, endTime: number) {\n  const audioContext: AudioContext = new (window.AudioContext || (window as any).webkitAudioContext)();\n  const arrayBuffer = await blob.arrayBuffer();\n  const fullAudioBuffer = await audioContext.decodeAudioData(arrayBuffer);\n\n  const sampleRate = fullAudioBuffer.sampleRate;\n  const startSample = Math.floor(startTime * sampleRate);\n  const endSample = Math.floor(endTime * sampleRate);\n  const frameCount = endSample - startSample;\n\n  const numChannels = fullAudioBuffer.numberOfChannels;\n\n  const fragmentBuffer = audioContext.createBuffer(numChannels, frameCount, sampleRate);\n\n  for(let ch = 0; ch < numChannels; ch++) {\n    const fullData = fullAudioBuffer.getChannelData(ch);\n    fragmentBuffer.copyToChannel(fullData.subarray(startSample, endSample), ch);\n  }\n\n  return fragmentBuffer;\n}\n\nasync function encodeAndMuxAudio(audioBuffer: AudioBuffer, onChunk: (ch: EncodedAudioChunk) => void) {\n  const sampleRate = audioBuffer.sampleRate;\n  const numChannels = audioBuffer.numberOfChannels;\n  const totalFrames = audioBuffer.length;\n\n\n  // Interleave audio for WebCodecs\n  const interleaved = new Float32Array(totalFrames * numChannels);\n  for(let ch = 0; ch < numChannels; ch++) {\n    const channelData = audioBuffer.getChannelData(ch);\n    for(let i = 0; i < totalFrames; i++) {\n      interleaved[i * numChannels + ch] = channelData[i];\n    }\n  }\n\n  const encoder = new AudioEncoder({\n    output: onChunk,\n    error: (e) => console.error('AudioEncoder error:', e)\n  });\n\n  encoder.configure({\n    codec: 'opus',\n    sampleRate,\n    numberOfChannels: audioBuffer.numberOfChannels,\n    bitrate: 128000\n  });\n\n  const audioData = new AudioData({\n    format: 'f32',\n    sampleRate,\n    numberOfFrames: audioBuffer.duration * audioBuffer.sampleRate,\n    numberOfChannels: audioBuffer.numberOfChannels,\n    timestamp: 0,\n    data: interleaved\n  });\n\n  encoder.encode(audioData);\n  audioData.close();\n\n  await encoder.flush();\n  encoder.close();\n}\n","import StickerType from '@config/stickerType';\nimport {MediaEditorContextValue} from '@components/mediaEditor/context';\nimport {MediaEditorFinalResultPayload} from '@components/mediaEditor/finalRender/createFinalResult';\n\nimport drawStickerLayer from '@components/mediaEditor/finalRender/drawStickerLayer';\nimport drawTextLayer from '@components/mediaEditor/finalRender/drawTextLayer';\nimport {ScaledLayersAndLines} from '@components/mediaEditor/finalRender/getScaledLayersAndLines';\n\nexport type RenderToImageArgs = {\n  context: MediaEditorContextValue;\n  scaledLayers: ScaledLayersAndLines['scaledLayers'];\n  ctx: CanvasRenderingContext2D;\n  imageCanvas: HTMLCanvasElement;\n  brushCanvas: HTMLCanvasElement;\n  resultCanvas: HTMLCanvasElement;\n};\n\nexport default async function renderToImage({\n  context,\n  scaledLayers,\n  ctx,\n  imageCanvas,\n  brushCanvas,\n  resultCanvas\n}: RenderToImageArgs) {\n  const {editorState: {stickersLayersInfo}, canImageResultInGIF} = context;\n\n  ctx.drawImage(imageCanvas, 0, 0);\n  ctx.drawImage(brushCanvas, 0, 0);\n\n  scaledLayers.forEach((layer) => {\n    if(layer.type === 'text') drawTextLayer(context, ctx, layer);\n    if(layer.type === 'sticker' && (!canImageResultInGIF || layer.sticker?.sticker === StickerType.Static)) {\n      const {container} = stickersLayersInfo[layer.id];\n      const stickerChild = container?.lastElementChild;\n\n      let ratio: number;\n      if(stickerChild instanceof HTMLImageElement) {\n        ratio = stickerChild.naturalWidth / stickerChild.naturalHeight;\n      } else if(stickerChild instanceof HTMLVideoElement) {\n        ratio = stickerChild.videoWidth / stickerChild.videoHeight;\n      } else if(stickerChild instanceof HTMLCanvasElement) {\n        ratio = stickerChild.width / stickerChild.height;\n      } else {\n        return;\n      }\n\n      drawStickerLayer(context, ctx, layer, stickerChild, ratio);\n    }\n  });\n\n  const result = await new Promise<MediaEditorFinalResultPayload>((resolve) =>\n    resultCanvas.toBlob(blob => resolve({\n      blob,\n      hasSound: false\n    }))\n  );\n\n  return {\n    preview: result.blob,\n    isVideo: false,\n    getResult: () => result\n  };\n}\n","import {createRoot, createSignal, getOwner, runWithOwner} from 'solid-js';\n\nimport noop from '@helpers/noop';\n\nimport {useMediaEditorContext} from '@components/mediaEditor/context';\nimport {delay} from '@components/mediaEditor/utils';\n\nimport {FRAMES_PER_SECOND, STICKER_SIZE} from '@components/mediaEditor/finalRender/constants';\nimport {MediaEditorFinalResultPayload} from '@components/mediaEditor/finalRender/createFinalResult';\nimport drawStickerLayer from '@components/mediaEditor/finalRender/drawStickerLayer';\nimport drawTextLayer from '@components/mediaEditor/finalRender/drawTextLayer';\nimport {generateVideoPreview} from '@components/mediaEditor/finalRender/generateVideoPreview';\nimport {ScaledLayersAndLines} from '@components/mediaEditor/finalRender/getScaledLayersAndLines';\nimport ImageStickerFrameByFrameRenderer from '@components/mediaEditor/finalRender/imageStickerFrameByFrameRenderer';\nimport LottieStickerFrameByFrameRenderer from '@components/mediaEditor/finalRender/lottieStickerFrameByFrameRenderer';\nimport {StickerFrameByFrameRenderer} from '@components/mediaEditor/finalRender/types';\nimport VideoStickerFrameByFrameRenderer from '@components/mediaEditor/finalRender/videoStickerFrameByFrameRenderer';\nimport calcCodecAndBitrate, {BITRATE_TARGET_FPS} from '@components/mediaEditor/finalRender/calcCodecAndBitrate';\nimport StickerType from '@config/stickerType';\n\ntype Args = {\n  scaledLayers: ScaledLayersAndLines['scaledLayers'];\n  scaledWidth: number;\n  scaledHeight: number;\n  ctx: CanvasRenderingContext2D;\n  imageCanvas: HTMLCanvasElement;\n  brushCanvas: HTMLCanvasElement;\n  resultCanvas: HTMLCanvasElement;\n};\n\nexport default async function renderToVideoGIF({\n  scaledWidth,\n  scaledHeight,\n  scaledLayers,\n  ctx,\n  imageCanvas,\n  brushCanvas,\n  resultCanvas\n}: Args) {\n  const owner = getOwner();\n  const context = useMediaEditorContext();\n\n  const {editorState: {pixelRatio}} = context;\n\n  const creationProgress = createRoot(dispose => {\n    const signal = createSignal(0);\n    return {signal, dispose};\n  });\n\n  const [, setProgress] = creationProgress.signal;\n\n  const renderers = new Map<number, StickerFrameByFrameRenderer>();\n\n  let canceled = false;\n\n  async function renderFrame(encoder: VideoEncoder, frameNo: number) {\n    const promises = Array.from(renderers.values()).map((renderer) =>\n      renderer.renderFrame(frameNo % (renderer.getTotalFrames() + 1))\n    );\n    await Promise.all(promises);\n\n    ctx.clearRect(0, 0, scaledWidth, scaledHeight);\n    ctx.drawImage(imageCanvas, 0, 0);\n    ctx.drawImage(brushCanvas, 0, 0);\n\n    scaledLayers.forEach((layer) => {\n      if(layer.type === 'text') drawTextLayer(context, ctx, layer);\n      if(layer.type === 'sticker' && renderers.has(layer.id)) {\n        const renderer = renderers.get(layer.id);\n        drawStickerLayer(context, ctx, layer, renderer.getRenderedFrame(), renderer.getRatio());\n      }\n    });\n\n    const videoFrame = new VideoFrame(resultCanvas, {\n      timestamp: (frameNo * 1e6) / FRAMES_PER_SECOND,\n      duration: 1e6 / FRAMES_PER_SECOND\n    });\n    encoder.encode(videoFrame);\n    videoFrame.close();\n  }\n\n  function cleanup(encoder: VideoEncoder) {\n    encoder.close();\n    Array.from(renderers.values()).forEach((renderer) => renderer.destroy());\n  }\n\n  const resultPromise = new Promise<MediaEditorFinalResultPayload>(async(resolve, reject) => {\n    let maxFrames = 0;\n\n    const [{ArrayBufferTarget, Muxer}] = await Promise.all([\n      import('mp4-muxer'),\n      ...scaledLayers.map(async(layer) => {\n        if(!layer.sticker) return;\n\n        const stickerType = layer.sticker?.sticker;\n        let renderer: StickerFrameByFrameRenderer;\n\n        if(stickerType === StickerType.Static) renderer = new ImageStickerFrameByFrameRenderer();\n        if(stickerType === StickerType.Lottie) renderer = new LottieStickerFrameByFrameRenderer();\n        if(stickerType === StickerType.WebM) renderer = new VideoStickerFrameByFrameRenderer();\n        if(!renderer) return;\n\n        renderers.set(layer.id, renderer);\n        await renderer.init(layer.sticker!, STICKER_SIZE * layer.scale * pixelRatio);\n        maxFrames = Math.max(maxFrames, renderer.getTotalFrames());\n      }),\n      delay(200)\n    ]);\n\n    const muxer = new Muxer({\n      target: new ArrayBufferTarget(),\n      video: {\n        codec: 'avc',\n        width: scaledWidth,\n        height: scaledHeight,\n        frameRate: FRAMES_PER_SECOND\n      },\n      fastStart: 'in-memory'\n    });\n\n    const encoder = new VideoEncoder({\n      output: (chunk, meta) => muxer.addVideoChunk(chunk, meta),\n      error: (e) => console.error(e)\n    });\n\n    encoder.configure({\n      width: scaledWidth,\n      height: scaledHeight,\n      ...calcCodecAndBitrate(scaledWidth, scaledHeight, BITRATE_TARGET_FPS)\n    });\n\n    for(let frameNo = 0; frameNo <= maxFrames; frameNo++) {\n      if(canceled) {\n        reject();\n        cleanup(encoder);\n      }\n\n      await renderFrame(encoder, frameNo);\n      setProgress(frameNo / maxFrames);\n    }\n\n    await encoder.flush();\n    muxer.finalize();\n\n    cleanup(encoder);\n\n    const {buffer} = muxer.target;\n    resolve({\n      blob: new Blob([buffer], {type: 'video/mp4'}),\n      hasSound: false\n    });\n  });\n\n  let result: MediaEditorFinalResultPayload;\n\n  resultPromise.then((value) => (result = value)).catch(noop);\n\n  return {\n    preview: await runWithOwner(owner, () => generateVideoPreview({scaledWidth, scaledHeight})),\n    isVideo: true,\n    getResult: () => {\n      return result ?? resultPromise;\n    },\n    cancel: () => {\n      canceled = true;\n    },\n    creationProgress\n  };\n\n  // const div = document.createElement('div')\n  // div.style.position = 'fixed';\n  // div.style.zIndex = '1000';\n  // div.style.top = '50%';\n  // div.style.left = '50%';\n  // div.style.transform = 'translate(-50%, -50%)';\n  // const img = document.createElement('video')\n  // img.src = URL.createObjectURL(blob)\n  // img.controls = true\n  // img.autoplay = true\n  // img.loop = true\n  // img.style.maxWidth = '450px'\n  // div.append(img)\n  // document.body.append(div)\n}\n","import apiManagerProxy from '@lib/apiManagerProxy';\nimport deferredPromise from '@helpers/cancellablePromise';\n\nimport {MediaEditorContextValue} from '@components/mediaEditor/context';\nimport {useCropOffset} from '@components/mediaEditor/canvas/useCropOffset';\nimport {delay, snapToViewport} from '@components/mediaEditor/utils';\n\n\ntype SpawnAnimatedPreviewOptions = {\n  context: MediaEditorContextValue;\n  cropOffset: ReturnType<typeof useCropOffset>;\n  scaledWidth: number;\n  scaledHeight: number;\n  previewBlob: Blob;\n}\n\nexport default async function spawnAnimatedPreview({\n  context,\n  cropOffset,\n  scaledWidth,\n  scaledHeight,\n  previewBlob\n}: SpawnAnimatedPreviewOptions) {\n  const {editorState: {currentTab, imageCanvas}} = context;\n\n  const isCropping = currentTab === 'crop';\n\n  const bcr = imageCanvas.getBoundingClientRect();\n  const animatedImg = new Image();\n  animatedImg.src = await apiManagerProxy.invoke('createObjectURL', previewBlob);\n  animatedImg.style.position = 'fixed';\n  const left = bcr.left + (isCropping ? cropOffset().left + cropOffset().width / 2 : bcr.width / 2),\n    top = bcr.top + (isCropping ? cropOffset().top + cropOffset().height / 2 : bcr.height / 2);\n\n  const [width, height] = snapToViewport(\n    scaledWidth / scaledHeight,\n    isCropping ? cropOffset().width : bcr.width,\n    isCropping ? cropOffset().height : bcr.height\n  );\n  animatedImg.style.left = left + 'px';\n  animatedImg.style.top = top + 'px';\n  animatedImg.style.width = width + 'px';\n  animatedImg.style.height = height + 'px';\n  animatedImg.style.transform = 'translate(-50%, -50%)';\n  animatedImg.style.objectFit = 'cover';\n  animatedImg.style.zIndex = '1000';\n\n  document.body.append(animatedImg);\n\n  const deferred = deferredPromise<void>();\n\n  animatedImg.addEventListener('load', () => deferred.resolve())\n\n  await Promise.race([delay(500), deferred]);\n\n  return animatedImg;\n}\n","import {getOwner, runWithOwner} from 'solid-js';\nimport {unwrap} from 'solid-js/store';\nimport {MediaSize} from '@helpers/mediaSize';\nimport noop from '@helpers/noop';\nimport {logger} from '@lib/logger';\nimport {adjustmentsConfig, AdjustmentsConfig} from '@components/mediaEditor/adjustments';\nimport BrushPainter from '@components/mediaEditor/canvas/brushPainter';\nimport {useCropOffset} from '@components/mediaEditor/canvas/useCropOffset';\nimport {EditingMediaState, useMediaEditorContext} from '@components/mediaEditor/context';\nimport {NumberPair, StandaloneSignal} from '@components/mediaEditor/types';\nimport {checkIfHasAnimatedStickers, cleanupWebGl, snapToAvailableQuality} from '@components/mediaEditor/utils';\nimport {draw} from '@components/mediaEditor/webgl/draw';\nimport {initWebGL} from '@components/mediaEditor/webgl/initWebGL';\nimport getResultSize from '@components/mediaEditor/finalRender/getResultSize';\nimport getResultTransform from '@components/mediaEditor/finalRender/getResultTransform';\nimport getScaledLayersAndLines from '@components/mediaEditor/finalRender/getScaledLayersAndLines';\nimport renderToActualVideo from '@components/mediaEditor/finalRender/renderToActualVideo';\nimport renderToImage from '@components/mediaEditor/finalRender/renderToImage';\nimport renderToVideoGIF from '@components/mediaEditor/finalRender/renderToVideoGIF';\nimport spawnAnimatedPreview from '@components/mediaEditor/finalRender/spawnAnimatedPreview';\n\n\nexport type MediaEditorFinalResultPayload = {\n  blob: Blob;\n  hasSound: boolean;\n  thumb?: {\n    blob: Blob;\n    size: MediaSize;\n  }\n};\n\nexport type MediaEditorFinalResult = {\n  preview: Blob;\n  getResult: () => MediaEditorFinalResultPayload | Promise<MediaEditorFinalResultPayload>;\n  cancel?: () => void;\n  isVideo: boolean;\n  width: number;\n  height: number;\n  originalSrc: string;\n  originalSize?: NumberPair;\n  editingMediaState: EditingMediaState;\n  animatedPreview?: HTMLImageElement;\n  creationProgress?: StandaloneSignal<number>;\n};\n\nconst log = logger('MediaEditor.createFinalResult');\n\nexport async function createFinalResult(): Promise<MediaEditorFinalResult> {\n  const context = useMediaEditorContext();\n  const {editorState, mediaState, mediaSrc, mediaType, canImageResultInGIF} = context;\n  const {resizableLayers, adjustments} = mediaState;\n\n  const owner = getOwner();\n\n  const cropOffset = useCropOffset();\n\n  const hasAnimatedStickers = checkIfHasAnimatedStickers(resizableLayers) && canImageResultInGIF;\n\n  const willResultInVideo = hasAnimatedStickers || mediaType === 'video';\n\n  const videoType = mediaType === 'video' ? 'video' : hasAnimatedStickers ? 'gif' : undefined;\n\n  const [, maxHeight] = getResultSize({\n    imageWidth: editorState.renderingPayload?.media.width,\n    newRatio: mediaState.currentImageRatio,\n    scale: mediaState.scale,\n    videoType,\n    imageRatio: editorState.mediaRatio,\n    cropOffset: cropOffset()\n  });\n\n  const maxQuality = snapToAvailableQuality(maxHeight);\n\n  const [scaledWidth, scaledHeight] = getResultSize({\n    imageWidth: editorState.renderingPayload?.media.width,\n    newRatio: mediaState.currentImageRatio,\n    scale: mediaState.scale,\n    videoType,\n    imageRatio: editorState.mediaRatio,\n    cropOffset: cropOffset(),\n    quality: willResultInVideo ? Math.min(maxQuality, mediaState.videoQuality) : undefined\n  });\n\n  const imageCanvas = document.createElement('canvas');\n  imageCanvas.width = scaledWidth;\n  imageCanvas.height = scaledHeight;\n\n  const gl = imageCanvas.getContext('webgl', {\n    preserveDrawingBuffer: true\n  });\n\n  const payload = await initWebGL({gl, mediaSrc, mediaType, videoTime: mediaState.videoCropStart, waitToSeek: false});\n\n  const finalTransform = getResultTransform({\n    context,\n    scaledWidth,\n    scaledHeight,\n    imageWidth: payload.media.width,\n    imageHeight: payload.media.height,\n    cropOffset\n  });\n\n  const drawToImageCanvas = () => {\n    draw(gl, payload, {\n      ...finalTransform,\n      imageSize: [payload.media.width, payload.media.height],\n      ...(Object.fromEntries(\n        adjustmentsConfig.map(({key, to100}) => {\n          const value = adjustments[key];\n          return [key, value / (to100 ? 100 : 50)];\n        })\n      ) as Record<AdjustmentsConfig[number]['key'], number>)\n    });\n  };\n\n  if(mediaType === 'image') drawToImageCanvas();\n\n  const {scaledLayers, scaledLines} = getScaledLayersAndLines(context, finalTransform, scaledWidth, scaledHeight);\n\n  const brushCanvas = document.createElement('canvas');\n  brushCanvas.width = scaledWidth;\n  brushCanvas.height = scaledHeight;\n\n  const brushPainter = new BrushPainter({targetCanvas: brushCanvas, imageCanvas});\n  brushPainter.saveLastLine();\n  scaledLines.forEach((line) => brushPainter.drawLine(line));\n\n  const resultCanvas = document.createElement('canvas');\n  resultCanvas.width = scaledWidth;\n  resultCanvas.height = scaledHeight;\n  const ctx = resultCanvas.getContext('2d', {willReadFrequently: true});\n\n  const renderPromise = (() => {\n    if(mediaType === 'video')\n      return runWithOwner(owner, () => renderToActualVideo({\n        renderingPayload: payload,\n        hasAnimatedStickers,\n        scaledWidth,\n        scaledHeight,\n        scaledLayers,\n        imageCanvasGL: gl,\n        imageCanvas,\n        drawToImageCanvas,\n        resultCanvas,\n        brushCanvas,\n        ctx\n      }));\n\n    if(hasAnimatedStickers)\n      return runWithOwner(owner, () => renderToVideoGIF({\n        scaledWidth,\n        scaledHeight,\n        scaledLayers,\n        imageCanvas,\n        resultCanvas,\n        brushCanvas,\n        ctx\n      }));\n\n    return renderToImage({\n      context,\n      scaledLayers,\n      imageCanvas,\n      resultCanvas,\n      brushCanvas,\n      ctx\n    });\n  })();\n\n  const renderResult = await renderPromise;\n\n  const animatedPreview = await spawnAnimatedPreview({\n    context,\n    cropOffset,\n    scaledWidth,\n    scaledHeight,\n    previewBlob: renderResult.preview\n  });\n\n  Promise.resolve(renderResult.getResult())?.catch(noop)?.finally(() => {\n    cleanupWebGl(gl);\n    log('cleaning up webgl')\n  });\n\n  return {\n    ...renderResult,\n    animatedPreview,\n    width: scaledWidth,\n    height: scaledHeight,\n    originalSrc: context.mediaSrc,\n    originalSize: [payload.media.width, payload.media.height],\n    editingMediaState: structuredClone(unwrap(mediaState))\n  };\n}\n","import {onMount} from 'solid-js';\n\nimport ripple from '@components/ripple';\n\nimport {useMediaEditorContext} from '@components/mediaEditor/context';\n\n\nexport default function FinishButton(props: {onClick: () => void}) {\n  let container: HTMLDivElement;\n  const {hasModifications} = useMediaEditorContext();\n\n  onMount(() => {\n    ripple(container);\n  });\n\n  return (\n    <div\n      ref={container}\n      onClick={props.onClick}\n      class=\"media-editor__finish-button\"\n      classList={{\n        'media-editor__finish-button--hidden': !hasModifications()\n      }}\n    >\n      <svg width=\"18\" height=\"16\" viewBox=\"0 0 18 16\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n        <path d=\"M2 9L6.5 14L16 2\" stroke=\"white\" stroke-width=\"2.66\" stroke-linecap=\"round\" stroke-linejoin=\"round\" />\n      </svg>\n    </div>\n  );\n}\n","import {createMemo, JSX} from 'solid-js';\n\nimport clamp from '@helpers/number/clamp';\nimport {hexaToHsla} from '@helpers/color';\nimport nMap from '@helpers/number/nMap';\n\nexport default function RangeInput(props: {\n  ref?: (el: HTMLDivElement) => void;\n  style?: JSX.CSSProperties;\n  label: JSX.Element;\n  value: number;\n  min: number;\n  max: number;\n  onChange: (value: number) => void;\n  onChangeFinish?: (prevValue: number, currentValue: number) => void;\n  passiveLabel?: boolean;\n  color?: string;\n}) {\n  const normalizedValue = () => nMap(props.value, props.min, props.max, 0, 1);\n  const mappedCenter = createMemo(() => nMap(0, props.min, props.max, 0, 100));\n\n  const brightShadow = () => props.color && hexaToHsla(props.color).l < 32;\n\n  let prevValue: number | null = null;\n\n  return (\n    <div\n      ref={props.ref}\n      class=\"media-editor__range-input\"\n      classList={{\n        'media-editor__range-input--passive': props.passiveLabel,\n        'media-editor__range-input--has-value': !props.passiveLabel && !!props.value,\n        'media-editor__range-input--bright-shadow': brightShadow()\n      }}\n      style={{\n        '--color': props.color,\n        '--normalized': normalizedValue(),\n        '--w': (Math.abs(props.value - Math.max(0, props.min)) / (props.max - props.min)) * 100 + '%',\n        '--bar-left': props.value >= 0 ? Math.max(0, mappedCenter()) + '%' : undefined,\n        '--bar-right': props.value < 0 ? mappedCenter() + '%' : undefined,\n        ...props.style\n      }}\n    >\n      <div class=\"media-editor__range-input-row\">\n        <div class=\"media-editor__range-input-label\">{props.label}</div>\n        <div class=\"media-editor__range-input-value\">{props.value}</div>\n      </div>\n      <div class=\"media-editor__range-input-wrapper\">\n        <input\n          type=\"range\"\n          min={props.min}\n          max={props.max}\n          step=\"1\"\n          value={props.value}\n          onInput={(e) => {\n            if(prevValue === null) prevValue = props.value;\n            const newValue = clamp(e.currentTarget.valueAsNumber, props.min, props.max);\n            props.onChange(newValue);\n          }}\n          onChange={() => {\n            props.onChangeFinish?.(prevValue, props.value);\n            prevValue = null;\n          }}\n        />\n        <div class=\"media-editor__range-input-thumb media-editor__range-input-thumb--shadow\" />\n        <div class=\"media-editor__range-input-progress media-editor__range-input-progress--shadow\" />\n        <div class=\"media-editor__range-input-progress-background\" />\n        <div class=\"media-editor__range-input-thumb\" />\n        <div class=\"media-editor__range-input-progress\" />\n      </div>\n    </div>\n  );\n}\n","import {createMemo, createSelector, For, JSX} from 'solid-js';\nimport clamp from '@helpers/number/clamp';\n\n\nexport type StepInputStep<T = any> = {\n  value: T;\n  label: JSX.Element;\n};\n\nexport default function StepInput<T = any>(props: {\n  label: JSX.Element;\n  value: T;\n  steps: StepInputStep[];\n  onChange: (value: T) => void;\n}) {\n  const stepIndex = createMemo(() => props.steps.findIndex(step => step.value === props.value));\n  const step = createMemo(() => props.steps[stepIndex()]);\n\n  const isActive = createSelector(stepIndex, (a, b) => a <= b);\n  const isSelected = createSelector(stepIndex, (a, b) => a === b);\n\n  return (\n    <div\n      class=\"media-editor__step-input\"\n    >\n      <div class=\"media-editor__range-input-row\">\n        <div class=\"media-editor__range-input-label\">{props.label}</div>\n        <div class=\"media-editor__range-input-value\">{step().label}</div>\n      </div>\n\n      <div class=\"media-editor__step-input-wrapper\">\n        <input\n          type=\"range\"\n          min={0}\n          max={props.steps.length - 1}\n          step=\"1\"\n          value={stepIndex()}\n          onInput={(e) => {\n            const newValue = Math.round(clamp(e.currentTarget.valueAsNumber, 0, props.steps.length - 1)); // just in case\n            props.onChange(props.steps[newValue].value);\n          }}\n        />\n        <For each={props.steps}>\n          {(_, index) => <>\n            {index() && <div\n              class=\"media-editor__step-input-separator\"\n              classList={{\n                'media-editor__step-input-separator--active': isActive(index())\n              }}\n            />}\n            <div\n              class=\"media-editor__step-input-dot\"\n              classList={{\n                'media-editor__step-input-dot--active': isActive(index()),\n                'media-editor__step-input-dot--selected': isSelected(index())\n              }}\n            />\n          </>}\n        </For>\n      </div>\n    </div>\n  );\n}\n","import {adjustmentsConfig} from '@components/mediaEditor/adjustments';\nimport {useCropOffset} from '@components/mediaEditor/canvas/useCropOffset';\nimport {useMediaEditorContext} from '@components/mediaEditor/context';\nimport getResultSize from '@components/mediaEditor/finalRender/getResultSize';\nimport RangeInput from '@components/mediaEditor/rangeInput';\nimport StepInput, {StepInputStep} from '@components/mediaEditor/stepInput';\nimport useIsMobile from '@components/mediaEditor/useIsMobile';\nimport {availableQualityHeights, checkIfHasAnimatedStickers, snapToAvailableQuality} from '@components/mediaEditor/utils';\nimport {HeightTransition} from '@components/sidebarRight/tabs/adminRecentActions/heightTransition';\nimport Space from '@components/space';\nimport {i18n} from '@lib/langPack';\nimport {createEffect, createMemo, createSignal, on, onCleanup, Show} from 'solid-js';\n\n\nconst ADJUST_TIMEOUT = 800;\n\nexport default function AdjustmentsTab() {\n  const {editorState, mediaState, actions, mediaType} = useMediaEditorContext();\n\n  const isMobile = useIsMobile();\n  const cropOffset = useCropOffset();\n\n  let timeoutId = 0;\n  function removeIsAdjusting() {\n    window.clearTimeout(timeoutId);\n    timeoutId = window.setTimeout(() => {\n      editorState.isAdjusting = false;\n    }, ADJUST_TIMEOUT);\n  }\n\n  const resultingSize = createMemo(() => editorState.mediaSize ?\n    getResultSize({\n      imageWidth: editorState.mediaSize[0],\n      scale: mediaState.scale,\n      newRatio: mediaState.currentImageRatio || editorState.mediaRatio,\n      videoType: mediaType === 'video' ? 'video' : 'gif',\n      imageRatio: editorState.mediaRatio,\n      cropOffset: !cropOffset().width ? {width: 1, height: 1} : cropOffset()\n    }) : [0, 0]\n  );\n\n  createEffect(() => {\n    resultingSize();\n    (window as any).debugResultingSize && console.log('resultingSize', resultingSize());\n  });\n\n  const maxVideoQuality = createMemo(() => snapToAvailableQuality(resultingSize()[1]));\n\n  const steps = createMemo((): StepInputStep[] =>\n    availableQualityHeights\n    .filter(height => height <= maxVideoQuality())\n    .map(height => ({value: height, label: height + 'p'}))\n  );\n\n  const canShowQualityInput = createMemo(() => (mediaType === 'video' || checkIfHasAnimatedStickers(mediaState.resizableLayers)) && steps().length > 1);\n\n  return (\n    <>\n      <Space amount=\"16px\" />\n\n      <HeightTransition>\n        <Show when={canShowQualityInput()}>\n          <div>\n            <StepInput\n              label={i18n('Quality')}\n              steps={steps()}\n              value={Math.min(maxVideoQuality(), mediaState.videoQuality)}\n              onChange={(value) => void(mediaState.videoQuality = value)}\n            />\n\n            <Space amount=\"32px\" />\n          </div>\n        </Show>\n      </HeightTransition>\n\n\n      {adjustmentsConfig.map((item) => {\n        const [container, setContainer] = createSignal<HTMLDivElement>();\n\n        const [showGhost, setShowGhost] = createSignal(false);\n\n        const value = () => mediaState.adjustments[item.key];\n        const setValue = (v: number): void => void (mediaState.adjustments[item.key] = v);\n\n        createEffect(\n          on(showGhost, () => {\n            if(!container() || !isMobile() || !showGhost()) return;\n            const bcr = container().getBoundingClientRect();\n            const div = (\n              <div\n                class=\"night media-editor__inherit-color\"\n                style={{\n                  'position': 'fixed',\n                  'left': bcr.left + 'px',\n                  'top': bcr.top + 'px',\n                  'width': bcr.width + 'px',\n                  'height': bcr.height + 'px',\n                  'z-index': 100\n                }}\n              >\n                <RangeInput\n                  value={value()}\n                  onChange={() => {}}\n                  label={item.label()}\n                  min={item.to100 ? 0 : -50}\n                  max={item.to100 ? 100 : 50}\n                />\n              </div>\n            ) as HTMLDivElement;\n            document.body.append(div);\n\n            onCleanup(() => {\n              setTimeout(() => {\n                div.remove();\n              }, 200);\n            });\n          })\n        );\n\n        let timeoutId = 0;\n        const removeGhost = () => {\n          window.clearTimeout(timeoutId);\n          timeoutId = window.setTimeout(() => {\n            setShowGhost(false);\n          }, ADJUST_TIMEOUT);\n        };\n\n        return (\n          <>\n            <RangeInput\n              ref={setContainer}\n              value={value()}\n              onChange={(v) => {\n                setValue(v);\n                setShowGhost(true);\n                editorState.isAdjusting = true;\n                removeGhost();\n                removeIsAdjusting();\n              }}\n              label={item.label()}\n              onChangeFinish={(prevValue, currentValue) => {\n                setShowGhost(false);\n                editorState.isAdjusting = false;\n\n                actions.pushToHistory({\n                  path: ['adjustments', item.key],\n                  newValue: currentValue,\n                  oldValue: prevValue\n                });\n              }}\n              min={item.to100 ? 0 : -50}\n              max={item.to100 ? 100 : 50}\n            />\n            <Space amount=\"32px\" />\n          </>\n        );\n      })}\n    </>\n  );\n}\n","export function PenBrush() {\n  return (\n    <svg width=\"120\" height=\"48\" viewBox=\"0 0 120 48\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n      <g clip-path=\"url(#clip0_6102_2542)\">\n        <g filter=\"url(#filter0_iiii_6102_2542)\">\n          <path\n            d=\"M0 15H80L110.2 22.4465C112.048 22.9021 112.971 23.1299 113.185 23.4931C113.369 23.806 113.369 24.194 113.185 24.5069C112.971 24.8701 112.048 25.0979 110.2 25.5535L80 33H0V15Z\"\n            fill=\"#3E3F3F\"\n          />\n        </g>\n        <path\n          d=\"M112.564 24.9709L103.474 27.2132C103.21 27.2782 102.944 27.121 102.883 26.8566C102.736 26.2146 102.5 25.0296 102.5 24C102.5 22.9705 102.736 21.7855 102.883 21.1434C102.944 20.8791 103.21 20.7219 103.474 20.7868L112.564 23.0291C113.578 23.2792 113.578 24.7208 112.564 24.9709Z\"\n          fill=\"currentColor\"\n        />\n        <rect x=\"76\" y=\"15\" width=\"4\" height=\"18\" rx=\"0.5\" fill=\"currentColor\" />\n      </g>\n      <defs>\n        <filter\n          id=\"filter0_iiii_6102_2542\"\n          x=\"0\"\n          y=\"10\"\n          width=\"116.323\"\n          height=\"28\"\n          filterUnits=\"userSpaceOnUse\"\n          color-interpolation-filters=\"sRGB\"\n        >\n          <feFlood flood-opacity=\"0\" result=\"BackgroundImageFix\" />\n          <feBlend mode=\"normal\" in=\"SourceGraphic\" in2=\"BackgroundImageFix\" result=\"shape\" />\n          <feColorMatrix\n            in=\"SourceAlpha\"\n            type=\"matrix\"\n            values=\"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0\"\n            result=\"hardAlpha\"\n          />\n          <feOffset dx=\"1\" dy=\"5\" />\n          <feGaussianBlur stdDeviation=\"3\" />\n          <feComposite in2=\"hardAlpha\" operator=\"arithmetic\" k2=\"-1\" k3=\"1\" />\n          <feColorMatrix type=\"matrix\" values=\"0 0 0 0 0.137255 0 0 0 0 0.145098 0 0 0 0 0.14902 0 0 0 1 0\" />\n          <feBlend mode=\"normal\" in2=\"shape\" result=\"effect1_innerShadow_6102_2542\" />\n          <feColorMatrix\n            in=\"SourceAlpha\"\n            type=\"matrix\"\n            values=\"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0\"\n            result=\"hardAlpha\"\n          />\n          <feOffset dx=\"3\" dy=\"-5\" />\n          <feGaussianBlur stdDeviation=\"3\" />\n          <feComposite in2=\"hardAlpha\" operator=\"arithmetic\" k2=\"-1\" k3=\"1\" />\n          <feColorMatrix type=\"matrix\" values=\"0 0 0 0 0.137255 0 0 0 0 0.145098 0 0 0 0 0.14902 0 0 0 1 0\" />\n          <feBlend mode=\"normal\" in2=\"effect1_innerShadow_6102_2542\" result=\"effect2_innerShadow_6102_2542\" />\n          <feColorMatrix\n            in=\"SourceAlpha\"\n            type=\"matrix\"\n            values=\"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0\"\n            result=\"hardAlpha\"\n          />\n          <feOffset dx=\"1\" dy=\"-1\" />\n          <feGaussianBlur stdDeviation=\"0.5\" />\n          <feComposite in2=\"hardAlpha\" operator=\"arithmetic\" k2=\"-1\" k3=\"1\" />\n          <feColorMatrix type=\"matrix\" values=\"0 0 0 0 0.242217 0 0 0 0 0.247242 0 0 0 0 0.247101 0 0 0 1 0\" />\n          <feBlend mode=\"normal\" in2=\"effect2_innerShadow_6102_2542\" result=\"effect3_innerShadow_6102_2542\" />\n          <feColorMatrix\n            in=\"SourceAlpha\"\n            type=\"matrix\"\n            values=\"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0\"\n            result=\"hardAlpha\"\n          />\n          <feOffset dx=\"1\" dy=\"1\" />\n          <feGaussianBlur stdDeviation=\"0.5\" />\n          <feComposite in2=\"hardAlpha\" operator=\"arithmetic\" k2=\"-1\" k3=\"1\" />\n          <feColorMatrix type=\"matrix\" values=\"0 0 0 0 0.242217 0 0 0 0 0.247242 0 0 0 0 0.247101 0 0 0 1 0\" />\n          <feBlend mode=\"normal\" in2=\"effect3_innerShadow_6102_2542\" result=\"effect4_innerShadow_6102_2542\" />\n        </filter>\n        <clipPath id=\"clip0_6102_2542\">\n          <rect width=\"20\" height=\"120\" fill=\"white\" transform=\"matrix(0 1 -1 0 120 14)\" />\n        </clipPath>\n      </defs>\n    </svg>\n  );\n}\n\nexport function ArrowBrush() {\n  return (\n    <svg width=\"120\" height=\"48\" viewBox=\"0 0 120 48\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n      <g clip-path=\"url(#clip0_6102_2543)\">\n        <path\n          d=\"M94 24H110M110 24L104 18M110 24L104 30\"\n          stroke=\"url(#paint0_linear_6102_2543)\"\n          stroke-width=\"3\"\n          stroke-linecap=\"round\"\n          stroke-linejoin=\"round\"\n        />\n        <g filter=\"url(#filter0_iiii_6102_2543)\">\n          <path d=\"M0 15H92C94.2091 15 96 16.7909 96 19V29C96 31.2091 94.2091 33 92 33H0V15Z\" fill=\"#3E3F3F\" />\n        </g>\n        <path d=\"M92 15V15C94.2091 15 96 16.7909 96 19V29C96 31.2091 94.2091 33 92 33V33V15Z\" fill=\"currentColor\" />\n      </g>\n      <defs>\n        <filter\n          id=\"filter0_iiii_6102_2543\"\n          x=\"0\"\n          y=\"10\"\n          width=\"99\"\n          height=\"28\"\n          filterUnits=\"userSpaceOnUse\"\n          color-interpolation-filters=\"sRGB\"\n        >\n          <feFlood flood-opacity=\"0\" result=\"BackgroundImageFix\" />\n          <feBlend mode=\"normal\" in=\"SourceGraphic\" in2=\"BackgroundImageFix\" result=\"shape\" />\n          <feColorMatrix\n            in=\"SourceAlpha\"\n            type=\"matrix\"\n            values=\"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0\"\n            result=\"hardAlpha\"\n          />\n          <feOffset dx=\"1\" dy=\"5\" />\n          <feGaussianBlur stdDeviation=\"3\" />\n          <feComposite in2=\"hardAlpha\" operator=\"arithmetic\" k2=\"-1\" k3=\"1\" />\n          <feColorMatrix type=\"matrix\" values=\"0 0 0 0 0.137255 0 0 0 0 0.145098 0 0 0 0 0.14902 0 0 0 1 0\" />\n          <feBlend mode=\"normal\" in2=\"shape\" result=\"effect1_innerShadow_6102_2543\" />\n          <feColorMatrix\n            in=\"SourceAlpha\"\n            type=\"matrix\"\n            values=\"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0\"\n            result=\"hardAlpha\"\n          />\n          <feOffset dx=\"3\" dy=\"-5\" />\n          <feGaussianBlur stdDeviation=\"3\" />\n          <feComposite in2=\"hardAlpha\" operator=\"arithmetic\" k2=\"-1\" k3=\"1\" />\n          <feColorMatrix type=\"matrix\" values=\"0 0 0 0 0.137255 0 0 0 0 0.145098 0 0 0 0 0.14902 0 0 0 1 0\" />\n          <feBlend mode=\"normal\" in2=\"effect1_innerShadow_6102_2543\" result=\"effect2_innerShadow_6102_2543\" />\n          <feColorMatrix\n            in=\"SourceAlpha\"\n            type=\"matrix\"\n            values=\"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0\"\n            result=\"hardAlpha\"\n          />\n          <feOffset dx=\"1\" dy=\"-1\" />\n          <feGaussianBlur stdDeviation=\"0.5\" />\n          <feComposite in2=\"hardAlpha\" operator=\"arithmetic\" k2=\"-1\" k3=\"1\" />\n          <feColorMatrix type=\"matrix\" values=\"0 0 0 0 0.242217 0 0 0 0 0.247242 0 0 0 0 0.247101 0 0 0 1 0\" />\n          <feBlend mode=\"normal\" in2=\"effect2_innerShadow_6102_2543\" result=\"effect3_innerShadow_6102_2543\" />\n          <feColorMatrix\n            in=\"SourceAlpha\"\n            type=\"matrix\"\n            values=\"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0\"\n            result=\"hardAlpha\"\n          />\n          <feOffset dx=\"1\" dy=\"1\" />\n          <feGaussianBlur stdDeviation=\"0.5\" />\n          <feComposite in2=\"hardAlpha\" operator=\"arithmetic\" k2=\"-1\" k3=\"1\" />\n          <feColorMatrix type=\"matrix\" values=\"0 0 0 0 0.242217 0 0 0 0 0.247242 0 0 0 0 0.247101 0 0 0 1 0\" />\n          <feBlend mode=\"normal\" in2=\"effect3_innerShadow_6102_2543\" result=\"effect4_innerShadow_6102_2543\" />\n        </filter>\n        <linearGradient id=\"paint0_linear_6102_2543\" x1=\"110\" y1=\"24\" x2=\"94\" y2=\"24\" gradientUnits=\"userSpaceOnUse\">\n          <stop offset=\"0.755\" stop-color=\"currentColor\" />\n          <stop offset=\"1\" stop-color=\"currentColor\" stop-opacity=\"0\" />\n        </linearGradient>\n        <clipPath id=\"clip0_6102_2543\">\n          <rect width=\"20\" height=\"120\" fill=\"white\" transform=\"matrix(0 1 -1 0 120 14)\" />\n        </clipPath>\n      </defs>\n    </svg>\n  );\n}\n\nexport function MarkerBrush() {\n  return (\n    <svg width=\"120\" height=\"48\" viewBox=\"0 0 120 48\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n      <g clip-path=\"url(#clip0_6102_2546)\">\n        <g filter=\"url(#filter0_iiii_6102_2546)\">\n          <path\n            d=\"M0 15H82.3579C83.4414 15 84.5135 15.2201 85.5093 15.6468L91 18H101C101.552 18 102 18.4477 102 19V29C102 29.5523 101.552 30 101 30H91L85.5093 32.3532C84.5135 32.7799 83.4414 33 82.3579 33H0V15Z\"\n            fill=\"#3E3F3F\"\n          />\n        </g>\n        <rect x=\"76\" y=\"15\" width=\"4\" height=\"18\" rx=\"0.5\" fill=\"currentColor\" />\n        <path\n          d=\"M102 19H106.434C106.785 19 107.111 19.1843 107.291 19.4855L112.091 27.4855C112.491 28.152 112.011 29 111.234 29H102V19Z\"\n          fill=\"currentColor\"\n        />\n      </g>\n      <defs>\n        <filter\n          id=\"filter0_iiii_6102_2546\"\n          x=\"0\"\n          y=\"10\"\n          width=\"105\"\n          height=\"28\"\n          filterUnits=\"userSpaceOnUse\"\n          color-interpolation-filters=\"sRGB\"\n        >\n          <feFlood flood-opacity=\"0\" result=\"BackgroundImageFix\" />\n          <feBlend mode=\"normal\" in=\"SourceGraphic\" in2=\"BackgroundImageFix\" result=\"shape\" />\n          <feColorMatrix\n            in=\"SourceAlpha\"\n            type=\"matrix\"\n            values=\"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0\"\n            result=\"hardAlpha\"\n          />\n          <feOffset dx=\"1\" dy=\"5\" />\n          <feGaussianBlur stdDeviation=\"3\" />\n          <feComposite in2=\"hardAlpha\" operator=\"arithmetic\" k2=\"-1\" k3=\"1\" />\n          <feColorMatrix type=\"matrix\" values=\"0 0 0 0 0.137255 0 0 0 0 0.145098 0 0 0 0 0.14902 0 0 0 1 0\" />\n          <feBlend mode=\"normal\" in2=\"shape\" result=\"effect1_innerShadow_6102_2546\" />\n          <feColorMatrix\n            in=\"SourceAlpha\"\n            type=\"matrix\"\n            values=\"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0\"\n            result=\"hardAlpha\"\n          />\n          <feOffset dx=\"3\" dy=\"-5\" />\n          <feGaussianBlur stdDeviation=\"3\" />\n          <feComposite in2=\"hardAlpha\" operator=\"arithmetic\" k2=\"-1\" k3=\"1\" />\n          <feColorMatrix type=\"matrix\" values=\"0 0 0 0 0.137255 0 0 0 0 0.145098 0 0 0 0 0.14902 0 0 0 1 0\" />\n          <feBlend mode=\"normal\" in2=\"effect1_innerShadow_6102_2546\" result=\"effect2_innerShadow_6102_2546\" />\n          <feColorMatrix\n            in=\"SourceAlpha\"\n            type=\"matrix\"\n            values=\"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0\"\n            result=\"hardAlpha\"\n          />\n          <feOffset dx=\"1\" dy=\"-1\" />\n          <feGaussianBlur stdDeviation=\"0.5\" />\n          <feComposite in2=\"hardAlpha\" operator=\"arithmetic\" k2=\"-1\" k3=\"1\" />\n          <feColorMatrix type=\"matrix\" values=\"0 0 0 0 0.242217 0 0 0 0 0.247242 0 0 0 0 0.247101 0 0 0 1 0\" />\n          <feBlend mode=\"normal\" in2=\"effect2_innerShadow_6102_2546\" result=\"effect3_innerShadow_6102_2546\" />\n          <feColorMatrix\n            in=\"SourceAlpha\"\n            type=\"matrix\"\n            values=\"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0\"\n            result=\"hardAlpha\"\n          />\n          <feOffset dx=\"1\" dy=\"1\" />\n          <feGaussianBlur stdDeviation=\"0.5\" />\n          <feComposite in2=\"hardAlpha\" operator=\"arithmetic\" k2=\"-1\" k3=\"1\" />\n          <feColorMatrix type=\"matrix\" values=\"0 0 0 0 0.242217 0 0 0 0 0.247242 0 0 0 0 0.247101 0 0 0 1 0\" />\n          <feBlend mode=\"normal\" in2=\"effect3_innerShadow_6102_2546\" result=\"effect4_innerShadow_6102_2546\" />\n        </filter>\n        <clipPath id=\"clip0_6102_2546\">\n          <rect width=\"20\" height=\"120\" fill=\"white\" transform=\"matrix(0 1 -1 0 120 14)\" />\n        </clipPath>\n      </defs>\n    </svg>\n  );\n}\n\nexport function NeonBrush() {\n  return (\n    <svg width=\"120\" height=\"48\" viewBox=\"0 0 120 48\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n      <g clip-path=\"url(#clip0_6102_2547)\">\n        <g filter=\"url(#filter0_f_6102_2547)\">\n          <path\n            d=\"M102 19H107.146C108.282 19 109.323 19.6487 109.601 20.7506C109.813 21.593 110 22.703 110 24C110 25.297 109.813 26.407 109.601 27.2494C109.323 28.3513 108.282 29 107.146 29H102V19Z\"\n            fill=\"currentColor\"\n          />\n        </g>\n        <g filter=\"url(#filter1_f_6102_2547)\">\n          <path\n            d=\"M102 19H107.146C108.282 19 109.323 19.6487 109.601 20.7506C109.813 21.593 110 22.703 110 24C110 25.297 109.813 26.407 109.601 27.2494C109.323 28.3513 108.282 29 107.146 29H102V19Z\"\n            fill=\"currentColor\"\n          />\n        </g>\n        <g filter=\"url(#filter2_f_6102_2547)\">\n          <path\n            d=\"M102 19H107.146C108.282 19 109.323 19.6487 109.601 20.7506C109.813 21.593 110 22.703 110 24C110 25.297 109.813 26.407 109.601 27.2494C109.323 28.3513 108.282 29 107.146 29H102V19Z\"\n            fill=\"currentColor\"\n          />\n        </g>\n        <g filter=\"url(#filter3_iiii_6102_2547)\">\n          <path\n            d=\"M0 15H82.3579C83.4414 15 84.5135 15.2201 85.5093 15.6468L91 18H101C101.552 18 102 18.4477 102 19V29C102 29.5523 101.552 30 101 30H91L85.5093 32.3532C84.5135 32.7799 83.4414 33 82.3579 33H0V15Z\"\n            fill=\"#3E3F3F\"\n          />\n        </g>\n        <rect x=\"76\" y=\"15\" width=\"4\" height=\"18\" rx=\"0.5\" fill=\"currentCOlor\" />\n        <path\n          d=\"M102 19H107.146C108.282 19 109.323 19.6487 109.601 20.7506C109.813 21.593 110 22.703 110 24C110 25.297 109.813 26.407 109.601 27.2494C109.323 28.3513 108.282 29 107.146 29H102V19Z\"\n          fill=\"currentCOlor\"\n        />\n      </g>\n      <defs>\n        <filter\n          id=\"filter0_f_6102_2547\"\n          x=\"96\"\n          y=\"13\"\n          width=\"20\"\n          height=\"22\"\n          filterUnits=\"userSpaceOnUse\"\n          color-interpolation-filters=\"sRGB\"\n        >\n          <feFlood flood-opacity=\"0\" result=\"BackgroundImageFix\" />\n          <feBlend mode=\"normal\" in=\"SourceGraphic\" in2=\"BackgroundImageFix\" result=\"shape\" />\n          <feGaussianBlur stdDeviation=\"3\" result=\"effect1_foregroundBlur_6102_2547\" />\n        </filter>\n        <filter\n          id=\"filter1_f_6102_2547\"\n          x=\"96\"\n          y=\"13\"\n          width=\"20\"\n          height=\"22\"\n          filterUnits=\"userSpaceOnUse\"\n          color-interpolation-filters=\"sRGB\"\n        >\n          <feFlood flood-opacity=\"0\" result=\"BackgroundImageFix\" />\n          <feBlend mode=\"normal\" in=\"SourceGraphic\" in2=\"BackgroundImageFix\" result=\"shape\" />\n          <feGaussianBlur stdDeviation=\"3\" result=\"effect1_foregroundBlur_6102_2547\" />\n        </filter>\n        <filter\n          id=\"filter2_f_6102_2547\"\n          x=\"96\"\n          y=\"13\"\n          width=\"20\"\n          height=\"22\"\n          filterUnits=\"userSpaceOnUse\"\n          color-interpolation-filters=\"sRGB\"\n        >\n          <feFlood flood-opacity=\"0\" result=\"BackgroundImageFix\" />\n          <feBlend mode=\"normal\" in=\"SourceGraphic\" in2=\"BackgroundImageFix\" result=\"shape\" />\n          <feGaussianBlur stdDeviation=\"3\" result=\"effect1_foregroundBlur_6102_2547\" />\n        </filter>\n        <filter\n          id=\"filter3_iiii_6102_2547\"\n          x=\"0\"\n          y=\"10\"\n          width=\"105\"\n          height=\"28\"\n          filterUnits=\"userSpaceOnUse\"\n          color-interpolation-filters=\"sRGB\"\n        >\n          <feFlood flood-opacity=\"0\" result=\"BackgroundImageFix\" />\n          <feBlend mode=\"normal\" in=\"SourceGraphic\" in2=\"BackgroundImageFix\" result=\"shape\" />\n          <feColorMatrix\n            in=\"SourceAlpha\"\n            type=\"matrix\"\n            values=\"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0\"\n            result=\"hardAlpha\"\n          />\n          <feOffset dx=\"1\" dy=\"5\" />\n          <feGaussianBlur stdDeviation=\"3\" />\n          <feComposite in2=\"hardAlpha\" operator=\"arithmetic\" k2=\"-1\" k3=\"1\" />\n          <feColorMatrix type=\"matrix\" values=\"0 0 0 0 0.137255 0 0 0 0 0.145098 0 0 0 0 0.14902 0 0 0 1 0\" />\n          <feBlend mode=\"normal\" in2=\"shape\" result=\"effect1_innerShadow_6102_2547\" />\n          <feColorMatrix\n            in=\"SourceAlpha\"\n            type=\"matrix\"\n            values=\"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0\"\n            result=\"hardAlpha\"\n          />\n          <feOffset dx=\"3\" dy=\"-5\" />\n          <feGaussianBlur stdDeviation=\"3\" />\n          <feComposite in2=\"hardAlpha\" operator=\"arithmetic\" k2=\"-1\" k3=\"1\" />\n          <feColorMatrix type=\"matrix\" values=\"0 0 0 0 0.137255 0 0 0 0 0.145098 0 0 0 0 0.14902 0 0 0 1 0\" />\n          <feBlend mode=\"normal\" in2=\"effect1_innerShadow_6102_2547\" result=\"effect2_innerShadow_6102_2547\" />\n          <feColorMatrix\n            in=\"SourceAlpha\"\n            type=\"matrix\"\n            values=\"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0\"\n            result=\"hardAlpha\"\n          />\n          <feOffset dx=\"1\" dy=\"-1\" />\n          <feGaussianBlur stdDeviation=\"0.5\" />\n          <feComposite in2=\"hardAlpha\" operator=\"arithmetic\" k2=\"-1\" k3=\"1\" />\n          <feColorMatrix type=\"matrix\" values=\"0 0 0 0 0.242217 0 0 0 0 0.247242 0 0 0 0 0.247101 0 0 0 1 0\" />\n          <feBlend mode=\"normal\" in2=\"effect2_innerShadow_6102_2547\" result=\"effect3_innerShadow_6102_2547\" />\n          <feColorMatrix\n            in=\"SourceAlpha\"\n            type=\"matrix\"\n            values=\"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0\"\n            result=\"hardAlpha\"\n          />\n          <feOffset dx=\"1\" dy=\"1\" />\n          <feGaussianBlur stdDeviation=\"0.5\" />\n          <feComposite in2=\"hardAlpha\" operator=\"arithmetic\" k2=\"-1\" k3=\"1\" />\n          <feColorMatrix type=\"matrix\" values=\"0 0 0 0 0.242217 0 0 0 0 0.247242 0 0 0 0 0.247101 0 0 0 1 0\" />\n          <feBlend mode=\"normal\" in2=\"effect3_innerShadow_6102_2547\" result=\"effect4_innerShadow_6102_2547\" />\n        </filter>\n        <clipPath id=\"clip0_6102_2547\">\n          <rect width=\"20\" height=\"120\" fill=\"white\" transform=\"matrix(0 1 -1 0 120 14)\" />\n        </clipPath>\n      </defs>\n    </svg>\n  );\n}\n\nexport function EraserBrush() {\n  return (\n    <svg width=\"120\" height=\"48\" viewBox=\"0 0 120 48\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n      <g clip-path=\"url(#clip0_6102_2544)\">\n        <g filter=\"url(#filter0_i_6102_2544)\">\n          <path d=\"M95 15H108C110.209 15 112 16.7909 112 19V29C112 31.2091 110.209 33 108 33H95V15Z\" fill=\"#D9D9D9\" />\n          <path d=\"M95 15H108C110.209 15 112 16.7909 112 19V29C112 31.2091 110.209 33 108 33H95V15Z\" fill=\"#F09B99\" />\n        </g>\n        <g filter=\"url(#filter1_iiii_6102_2544)\">\n          <path\n            d=\"M0 15H77.6464C77.8728 15 78.0899 14.9101 78.25 14.75V14.75C78.4101 14.5899 78.6272 14.5 78.8536 14.5H96C97.1046 14.5 98 15.3954 98 16.5V31.5C98 32.6046 97.1046 33.5 96 33.5H78.8536C78.6272 33.5 78.4101 33.4101 78.25 33.25V33.25C78.0899 33.0899 77.8728 33 77.6464 33H0V15Z\"\n            fill=\"#3E3F3F\"\n          />\n        </g>\n        <path d=\"M79 33.5V14.5H78V33.5H79Z\" fill=\"black\" fill-opacity=\"0.33\" />\n      </g>\n      <defs>\n        <filter\n          id=\"filter0_i_6102_2544\"\n          x=\"95\"\n          y=\"13\"\n          width=\"19\"\n          height=\"20\"\n          filterUnits=\"userSpaceOnUse\"\n          color-interpolation-filters=\"sRGB\"\n        >\n          <feFlood flood-opacity=\"0\" result=\"BackgroundImageFix\" />\n          <feBlend mode=\"normal\" in=\"SourceGraphic\" in2=\"BackgroundImageFix\" result=\"shape\" />\n          <feColorMatrix\n            in=\"SourceAlpha\"\n            type=\"matrix\"\n            values=\"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0\"\n            result=\"hardAlpha\"\n          />\n          <feOffset dx=\"2\" dy=\"-2\" />\n          <feGaussianBlur stdDeviation=\"2\" />\n          <feComposite in2=\"hardAlpha\" operator=\"arithmetic\" k2=\"-1\" k3=\"1\" />\n          <feColorMatrix type=\"matrix\" values=\"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.33 0\" />\n          <feBlend mode=\"normal\" in2=\"shape\" result=\"effect1_innerShadow_6102_2544\" />\n        </filter>\n        <filter\n          id=\"filter1_iiii_6102_2544\"\n          x=\"0\"\n          y=\"9.5\"\n          width=\"101\"\n          height=\"29\"\n          filterUnits=\"userSpaceOnUse\"\n          color-interpolation-filters=\"sRGB\"\n        >\n          <feFlood flood-opacity=\"0\" result=\"BackgroundImageFix\" />\n          <feBlend mode=\"normal\" in=\"SourceGraphic\" in2=\"BackgroundImageFix\" result=\"shape\" />\n          <feColorMatrix\n            in=\"SourceAlpha\"\n            type=\"matrix\"\n            values=\"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0\"\n            result=\"hardAlpha\"\n          />\n          <feOffset dx=\"1\" dy=\"5\" />\n          <feGaussianBlur stdDeviation=\"3\" />\n          <feComposite in2=\"hardAlpha\" operator=\"arithmetic\" k2=\"-1\" k3=\"1\" />\n          <feColorMatrix type=\"matrix\" values=\"0 0 0 0 0.137255 0 0 0 0 0.145098 0 0 0 0 0.14902 0 0 0 1 0\" />\n          <feBlend mode=\"normal\" in2=\"shape\" result=\"effect1_innerShadow_6102_2544\" />\n          <feColorMatrix\n            in=\"SourceAlpha\"\n            type=\"matrix\"\n            values=\"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0\"\n            result=\"hardAlpha\"\n          />\n          <feOffset dx=\"3\" dy=\"-5\" />\n          <feGaussianBlur stdDeviation=\"3\" />\n          <feComposite in2=\"hardAlpha\" operator=\"arithmetic\" k2=\"-1\" k3=\"1\" />\n          <feColorMatrix type=\"matrix\" values=\"0 0 0 0 0.137255 0 0 0 0 0.145098 0 0 0 0 0.14902 0 0 0 1 0\" />\n          <feBlend mode=\"normal\" in2=\"effect1_innerShadow_6102_2544\" result=\"effect2_innerShadow_6102_2544\" />\n          <feColorMatrix\n            in=\"SourceAlpha\"\n            type=\"matrix\"\n            values=\"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0\"\n            result=\"hardAlpha\"\n          />\n          <feOffset dx=\"1\" dy=\"-1\" />\n          <feGaussianBlur stdDeviation=\"0.5\" />\n          <feComposite in2=\"hardAlpha\" operator=\"arithmetic\" k2=\"-1\" k3=\"1\" />\n          <feColorMatrix type=\"matrix\" values=\"0 0 0 0 0.242217 0 0 0 0 0.247242 0 0 0 0 0.247101 0 0 0 1 0\" />\n          <feBlend mode=\"normal\" in2=\"effect2_innerShadow_6102_2544\" result=\"effect3_innerShadow_6102_2544\" />\n          <feColorMatrix\n            in=\"SourceAlpha\"\n            type=\"matrix\"\n            values=\"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0\"\n            result=\"hardAlpha\"\n          />\n          <feOffset dx=\"1\" dy=\"1\" />\n          <feGaussianBlur stdDeviation=\"0.5\" />\n          <feComposite in2=\"hardAlpha\" operator=\"arithmetic\" k2=\"-1\" k3=\"1\" />\n          <feColorMatrix type=\"matrix\" values=\"0 0 0 0 0.242217 0 0 0 0 0.247242 0 0 0 0 0.247101 0 0 0 1 0\" />\n          <feBlend mode=\"normal\" in2=\"effect3_innerShadow_6102_2544\" result=\"effect4_innerShadow_6102_2544\" />\n        </filter>\n        <clipPath id=\"clip0_6102_2544\">\n          <rect width=\"20\" height=\"120\" fill=\"white\" transform=\"matrix(0 1 -1 0 120 14)\" />\n        </clipPath>\n      </defs>\n    </svg>\n  );\n}\n\nexport function BlurBrush() {\n  return (\n    <svg width=\"120\" height=\"48\" viewBox=\"0 0 120 48\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n      <g clip-path=\"url(#clip0_6102_2545)\">\n        <image href=\"assets/img/media-editor-blurred-color-wheel.png\" x=\"91\" y=\"12\" width=\"26\" height=\"24\" />\n        <image href=\"assets/img/media-editor-blurred-color-wheel.png\" x=\"91\" y=\"12\" width=\"26\" height=\"24\" />\n        <g filter=\"url(#filter3_iiii_6102_2545)\">\n          <path\n            d=\"M-2 15H75.441C75.7836 15 76.0968 15.1936 76.25 15.5V15.5C76.4032 15.8064 76.7164 16 77.059 16H92.941C93.2836 16 93.5968 15.8064 93.75 15.5V15.5C93.9032 15.1936 94.2164 15 94.559 15H98C99.1046 15 100 15.8954 100 17V31C100 32.1046 99.1046 33 98 33H94.559C94.2164 33 93.9032 32.8064 93.75 32.5V32.5C93.5968 32.1936 93.2836 32 92.941 32H77.059C76.7164 32 76.4032 32.1936 76.25 32.5V32.5C76.0968 32.8064 75.7836 33 75.441 33H-2V15Z\"\n            fill=\"#3E3F3F\"\n          />\n        </g>\n        <mask\n          id=\"mask0_6102_2545\"\n          style=\"mask-type:alpha\"\n          maskUnits=\"userSpaceOnUse\"\n          x=\"0\"\n          y=\"15\"\n          width=\"100\"\n          height=\"18\"\n        >\n          <path\n            d=\"M0 15H75.441C75.7836 15 76.0968 15.1936 76.25 15.5V15.5C76.4032 15.8064 76.7164 16 77.059 16H92.941C93.2836 16 93.5968 15.8064 93.75 15.5V15.5C93.9032 15.1936 94.2164 15 94.559 15H98C99.1046 15 100 15.8954 100 17V31C100 32.1046 99.1046 33 98 33H94.559C94.2164 33 93.9032 32.8064 93.75 32.5V32.5C93.5968 32.1936 93.2836 32 92.941 32H77.059C76.7164 32 76.4032 32.1936 76.25 32.5V32.5C76.0968 32.8064 75.7836 33 75.441 33H0V15Z\"\n            fill=\"#3E3F3F\"\n          />\n        </mask>\n        <image\n          opacity=\"1\"\n          href=\"assets/img/media-editor-blurred-color-wheel.png\"\n          x=\"91\"\n          y=\"12\"\n          width=\"26\"\n          height=\"24\"\n        />\n      </g>\n      <defs>\n        <filter\n          id=\"filter3_iiii_6102_2545\"\n          x=\"-2\"\n          y=\"10\"\n          width=\"105\"\n          height=\"28\"\n          filterUnits=\"userSpaceOnUse\"\n          color-interpolation-filters=\"sRGB\"\n        >\n          <feFlood flood-opacity=\"0\" result=\"BackgroundImageFix\" />\n          <feBlend mode=\"normal\" in=\"SourceGraphic\" in2=\"BackgroundImageFix\" result=\"shape\" />\n          <feColorMatrix\n            in=\"SourceAlpha\"\n            type=\"matrix\"\n            values=\"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0\"\n            result=\"hardAlpha\"\n          />\n          <feOffset dx=\"1\" dy=\"5\" />\n          <feGaussianBlur stdDeviation=\"3\" />\n          <feComposite in2=\"hardAlpha\" operator=\"arithmetic\" k2=\"-1\" k3=\"1\" />\n          <feColorMatrix type=\"matrix\" values=\"0 0 0 0 0.137255 0 0 0 0 0.145098 0 0 0 0 0.14902 0 0 0 1 0\" />\n          <feBlend mode=\"normal\" in2=\"shape\" result=\"effect1_innerShadow_6102_2545\" />\n          <feColorMatrix\n            in=\"SourceAlpha\"\n            type=\"matrix\"\n            values=\"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0\"\n            result=\"hardAlpha\"\n          />\n          <feOffset dx=\"3\" dy=\"-5\" />\n          <feGaussianBlur stdDeviation=\"3\" />\n          <feComposite in2=\"hardAlpha\" operator=\"arithmetic\" k2=\"-1\" k3=\"1\" />\n          <feColorMatrix type=\"matrix\" values=\"0 0 0 0 0.137255 0 0 0 0 0.145098 0 0 0 0 0.14902 0 0 0 1 0\" />\n          <feBlend mode=\"normal\" in2=\"effect1_innerShadow_6102_2545\" result=\"effect2_innerShadow_6102_2545\" />\n          <feColorMatrix\n            in=\"SourceAlpha\"\n            type=\"matrix\"\n            values=\"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0\"\n            result=\"hardAlpha\"\n          />\n          <feOffset dx=\"1\" dy=\"-1\" />\n          <feGaussianBlur stdDeviation=\"0.5\" />\n          <feComposite in2=\"hardAlpha\" operator=\"arithmetic\" k2=\"-1\" k3=\"1\" />\n          <feColorMatrix type=\"matrix\" values=\"0 0 0 0 0.242217 0 0 0 0 0.247242 0 0 0 0 0.247101 0 0 0 1 0\" />\n          <feBlend mode=\"normal\" in2=\"effect2_innerShadow_6102_2545\" result=\"effect3_innerShadow_6102_2545\" />\n          <feColorMatrix\n            in=\"SourceAlpha\"\n            type=\"matrix\"\n            values=\"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0\"\n            result=\"hardAlpha\"\n          />\n          <feOffset dx=\"1\" dy=\"1\" />\n          <feGaussianBlur stdDeviation=\"0.5\" />\n          <feComposite in2=\"hardAlpha\" operator=\"arithmetic\" k2=\"-1\" k3=\"1\" />\n          <feColorMatrix type=\"matrix\" values=\"0 0 0 0 0.242217 0 0 0 0 0.247242 0 0 0 0 0.247101 0 0 0 1 0\" />\n          <feBlend mode=\"normal\" in2=\"effect3_innerShadow_6102_2545\" result=\"effect4_innerShadow_6102_2545\" />\n        </filter>\n        <clipPath id=\"clip0_6102_2545\">\n          <rect width=\"120\" height=\"48\" fill=\"white\" />\n        </clipPath>\n      </defs>\n    </svg>\n  );\n}\n","import {createEffect, createMemo, createSignal, on, onCleanup, onMount} from 'solid-js';\n\nimport {doubleRaf} from '@helpers/schedulers';\nimport {hexToRgb} from '@helpers/color';\nimport _ColorPicker from '@components/colorPicker';\nimport ripple from '@components/ripple';\n\nimport {useMediaEditorContext} from '@components/mediaEditor/context';\nimport {delay} from '@components/mediaEditor/utils';\n\n\nexport const colorPickerSwatches = [\n  '#ffffff',\n  '#fe4438',\n  '#ff8901',\n  '#ffd60a',\n  '#33c759',\n  '#62e5e0',\n  '#0a84ff',\n  '#bd5cf3'\n];\n\nconst PICKER_WIDTH_PX = 200;\nconst PICKER_HEIGHT_PX = 120;\nconst SLIDER_WIDTH_PX = 304;\nconst DEFAULT_SIZE_PX = 384;\n\n\nexport default function ColorPicker(props: {\n  value: string;\n  onChange: (value: string) => void;\n  colorKey?: string; // Just for reaction, not used to access anything\n  previousColor?: string;\n}) {\n  const {actions} = useMediaEditorContext();\n\n  const [collapsed, setCollapsed] = createSignal(colorPickerSwatches.includes(props.value));\n  const [collapsing, setCollapsing] = createSignal(false);\n\n  const [containerSize, setContainerSize] = createSignal(DEFAULT_SIZE_PX);\n\n  let sizeContainer: HTMLDivElement;\n\n  const swatch = (hexColor: string, i: number) => (\n    <div\n      class=\"media-editor__color-picker-swatch\"\n      classList={{'media-editor__color-picker-swatch--active': props.value === hexColor && collapsed()}}\n      style={{\n        '--color-rgb': hexToRgb(hexColor).join(' '),\n        '--i': i\n      }}\n      onClick={() => props.onChange(hexColor)}\n    >\n      <div class=\"media-editor__color-picker-swatch-color\" />\n    </div>\n  );\n\n  const onCollapseToggle = async() => {\n    setCollapsed((prev) => !prev);\n    if(collapsed()) {\n      setCollapsing(true);\n      props.onChange(props.previousColor || colorPickerSwatches[0]);\n      await delay(200);\n      setCollapsing(false);\n    }\n  };\n\n  // let colorPicker: _ColorPicker;\n\n  const colorPicker = createMemo(\n    on(containerSize, () => {\n      const colorPicker = new _ColorPicker({\n        buildLayout: (parts) => {\n          return (\n            <div\n              class=\"media-editor__color-picker\"\n              classList={{'media-editor__color-picker--collapsed': collapsed()}}\n              style={{'--picker-height': PICKER_HEIGHT_PX + 'px'}}\n            >\n              <div class=\"media-editor__color-picker-swatches\">\n                {colorPickerSwatches.map(swatch)}\n                <div\n                  class=\"media-editor__color-picker-swatch media-editor__color-picker-swatch--gradient\"\n                  classList={{'media-editor__color-picker-swatch--active': !collapsed()}}\n                  onClick={onCollapseToggle}\n                >\n                  <div class=\"media-editor__color-picker-swatch-color\" />\n                </div>\n\n                <div class=\"media-editor__color-picker-slider\">{parts.slider}</div>\n              </div>\n\n              <div class=\"media-editor__color-picker-layout-wrapper\">\n                <div class=\"media-editor__color-picker-layout\">\n                  <div class=\"media-editor__color-picker-box\">{parts.pickerBox}</div>\n                  <div class=\"media-editor__color-picker-inputs\">\n                    {parts.hexInput}\n                    {parts.rgbInput}\n                  </div>\n                </div>\n              </div>\n            </div>\n          ) as HTMLDivElement;\n        },\n        pickerBoxWidth: PICKER_WIDTH_PX + containerSize() - DEFAULT_SIZE_PX,\n        pickerBoxHeight: PICKER_HEIGHT_PX,\n        sliderWidth: SLIDER_WIDTH_PX + containerSize() - DEFAULT_SIZE_PX,\n        thickSlider: true\n      });\n      colorPicker.onChange = (color) => {\n        if(color.hex !== props.value) props.onChange(color.hex);\n        actions.abortDrawerSlide();\n      };\n      colorPicker.container.querySelectorAll('.media-editor__color-picker-swatch').forEach((element) => {\n        ripple(element as HTMLElement);\n      });\n\n      return colorPicker;\n    })\n  );\n\n  onMount(() => {\n    setContainerSize(sizeContainer.clientWidth);\n\n    const observer = new ResizeObserver(() => {\n      setContainerSize(sizeContainer.clientWidth);\n    });\n\n    observer.observe(sizeContainer);\n\n    onCleanup(() => {\n      observer.disconnect();\n    });\n  });\n\n  createEffect(\n    on(\n      () => props.colorKey,\n      async() => {\n        await delay(0);\n        const newCollapsed = colorPickerSwatches.includes(props.value);\n        if(newCollapsed !== collapsed()) {\n          setCollapsed(newCollapsed);\n          if(newCollapsed) {\n            setCollapsing(true);\n            delay(200).then(() => setCollapsing(false));\n          }\n        }\n      }\n    )\n  );\n\n  createEffect(\n    on(\n      () => [collapsing(), colorPicker(), props.value],\n      async() => {\n        await doubleRaf();\n        if(!collapsing() && props.value !== colorPicker().getCurrentColor().hex) {\n          colorPicker().setColor(props.value);\n        }\n      }\n    )\n  );\n\n  return <div ref={sizeContainer}>{colorPicker().container}</div>;\n}\n","import {createSignal} from 'solid-js';\n\nimport {colorPickerSwatches} from '@components/mediaEditor/colorPicker';\n\nexport function createStoredColor(key: string, defaultColor: string) {\n  // (1 - use swatch, 2 - use picker color), (color from swatch), (color from picker)\n  type SavedColor = [1 | 2, string, string];\n\n  const [savedColor, setSavedColor] = createSignal<SavedColor>(\n    (() => {\n      const fallback = () => {\n        const value = [colorPickerSwatches.includes(defaultColor) ? 1 : 2, defaultColor, defaultColor] as SavedColor;\n        localStorage.setItem(key, JSON.stringify(value));\n        return value;\n      };\n      try {\n        const value: SavedColor = JSON.parse(localStorage.getItem(key));\n        if(\n          !(value instanceof Array) ||\n          typeof value[0] !== 'number' ||\n          typeof value[1] !== 'string' ||\n          typeof value[2] !== 'string'\n        ) {\n          return fallback();\n        }\n        return value;\n      } catch{}\n      return fallback();\n    })()\n  );\n\n  function setColor(color: string) {\n    let value: SavedColor;\n    if(colorPickerSwatches.includes(color)) {\n      value = [1, color, color];\n    } else {\n      value = [2, savedColor()[1], color];\n    }\n    setSavedColor(value);\n    localStorage.setItem(key, JSON.stringify(value));\n  }\n\n  return [\n    () => ({\n      value: savedColor()[savedColor()[0]],\n      previous: savedColor()[1]\n    }),\n    setColor\n  ] as const;\n}\n","import {JSX, onMount} from 'solid-js';\n\nimport ripple from '@components/ripple';\n\nexport type MediaEditorLargeButtonProps = JSX.HTMLAttributes<HTMLDivElement> & {\n  active?: boolean;\n};\n\nexport default function LargeButton(props: MediaEditorLargeButtonProps) {\n  let element: HTMLDivElement;\n\n  onMount(() => {\n    ripple(element);\n  });\n\n  return (\n    <div\n      {...props}\n      ref={element}\n      class=\"media-editor__large-button\"\n      classList={{\n        'media-editor__large-button--active': props.active,\n        [props.class]: !!props.class\n      }}\n    />\n  );\n}\n","import {createEffect, JSX} from 'solid-js';\n\nimport {i18n} from '@lib/langPack';\n\nimport Space from '@components/space';\n\nimport {ArrowBrush, BlurBrush, EraserBrush, MarkerBrush, NeonBrush, PenBrush} from '@components/mediaEditor/brushesSvg';\nimport {createStoredColor} from '@components/mediaEditor/createStoredColor';\nimport {useMediaEditorContext} from '@components/mediaEditor/context';\nimport ColorPicker from '@components/mediaEditor/colorPicker';\nimport LargeButton from '@components/mediaEditor/largeButton';\nimport RangeInput from '@components/mediaEditor/rangeInput';\n\nexport default function BrushTab() {\n  const {editorState, mediaType} = useMediaEditorContext();\n\n  const savedBrushColors = {\n    pen: createStoredColor('media-editor-pen-color', '#fe4438'),\n    arrow: createStoredColor('media-editor-arrow-color', '#ffd60a'),\n    brush: createStoredColor('media-editor-brush-color', '#ff8901'),\n    neon: createStoredColor('media-editor-neon-color', '#62e5e0')\n  };\n\n  function savedBrushSignal(brush: string) {\n    return savedBrushColors[brush as keyof typeof savedBrushColors];\n  }\n\n  function updateCurrentBrush() {\n    const [savedColor] = savedBrushSignal(editorState.currentBrush.brush) || [];\n    if(!savedColor || editorState.currentBrush.color === savedColor().value) return;\n\n    editorState.currentBrush.color = savedColor().value;\n  }\n\n  updateCurrentBrush(); // Change the brush before the ColorPicker is rendered\n  createEffect(() => {\n    updateCurrentBrush();\n  });\n\n  function setColor(color: string) {\n    const brush = editorState.currentBrush.brush;\n    const [, setSavedColor] = savedBrushSignal(brush) || [];\n    setSavedColor?.(color);\n  }\n\n  const brushButton = (text: JSX.Element, brushSvg: JSX.Element, brush: string) => (\n    <LargeButton\n      active={editorState.currentBrush.brush === brush}\n      onClick={() => void (editorState.currentBrush.brush = brush)}\n      class={`media-editor__brush-button`}\n    >\n      <div\n        class=\"media-editor__brush-button-svg-wrapper\"\n        style={{\n          color: savedBrushSignal(brush)?.[0]().value\n        }}\n      >\n        {brushSvg}\n      </div>\n      {text}\n    </LargeButton>\n  );\n\n  const hasColor = () => editorState.currentBrush.brush in savedBrushColors;\n\n  let timeoutId = 0;\n  function removeSizePreview() {\n    window.clearTimeout(timeoutId);\n    timeoutId = window.setTimeout(() => {\n      editorState.previewBrushSize = undefined;\n    }, 1000);\n  }\n\n  return (\n    <>\n      <div\n        style={{\n          transition: 'opacity .2s',\n          ...(!hasColor() ?\n            {\n              'opacity': 0.25,\n              'pointer-events': 'none'\n            } :\n            undefined\n          )\n        }\n        }\n      >\n        <ColorPicker\n          value={editorState.currentBrush.color}\n          onChange={setColor}\n          colorKey={editorState.currentBrush.brush}\n          previousColor={savedBrushSignal(editorState.currentBrush.brush)?.[0]().previous}\n        />\n      </div>\n      <Space amount=\"16px\" />\n      <RangeInput\n        label={i18n('MediaEditor.Size')}\n        min={2}\n        max={32}\n        value={editorState.currentBrush.size}\n        onChange={(size) => {\n          editorState.currentBrush.size = size;\n          editorState.previewBrushSize = size;\n          removeSizePreview();\n        }}\n        onChangeFinish={() => {\n          editorState.previewBrushSize = undefined;\n        }}\n        passiveLabel\n        color={hasColor() ? editorState.currentBrush.color : undefined}\n      />\n      <Space amount=\"16px\" />\n      <div class=\"media-editor__label\">{i18n('MediaEditor.Tool')}</div>\n      {brushButton(i18n('MediaEditor.Brushes.Pen'), <PenBrush />, 'pen')}\n      {brushButton(i18n('MediaEditor.Brushes.Arrow'), <ArrowBrush />, 'arrow')}\n      {brushButton(i18n('MediaEditor.Brushes.Brush'), <MarkerBrush />, 'brush')}\n      {brushButton(i18n('MediaEditor.Brushes.Neon'), <NeonBrush />, 'neon')}\n      {mediaType === 'image' && brushButton(i18n('MediaEditor.Brushes.Blur'), <BlurBrush />, 'blur')}\n      {brushButton(i18n('MediaEditor.Brushes.Eraser'), <EraserBrush />, 'eraser')}\n    </>\n  );\n}\n","import {JSX, splitProps} from 'solid-js';\n\nimport {i18n} from '@lib/langPack';\nimport {IconTsx} from '@components/iconTsx';\n\nimport {animateToNewRotationOrRatio} from '@components/mediaEditor/canvas/animateToNewRotationOrRatio';\nimport LargeButton, {MediaEditorLargeButtonProps} from '@components/mediaEditor/largeButton';\nimport {useMediaEditorContext} from '@components/mediaEditor/context';\nimport {withCurrentOwner} from '@components/mediaEditor/utils';\n\nconst ratioRects = {\n  '1x1': () => <rect x=\"4\" y=\"4\" width=\"16\" height=\"16\" rx=\"2\" stroke=\"white\" stroke-width=\"1.66\" />,\n  '3x2': () => <rect x=\"3\" y=\"6\" width=\"18\" height=\"12\" rx=\"2\" stroke=\"white\" stroke-width=\"1.66\" />,\n  '4x3': () => <rect x=\"3\" y=\"5\" width=\"18\" height=\"14\" rx=\"2\" stroke=\"white\" stroke-width=\"1.66\" />,\n  '5x4': () => <rect x=\"3\" y=\"4.5\" width=\"18\" height=\"15\" rx=\"2\" stroke=\"white\" stroke-width=\"1.66\" />,\n  '7x5': () => <rect x=\"3\" y=\"4\" width=\"18\" height=\"16\" rx=\"2\" stroke=\"white\" stroke-width=\"1.66\" />,\n  '16x9': () => <rect x=\"2.5\" y=\"6.5\" width=\"19\" height=\"11\" rx=\"2\" stroke=\"white\" stroke-width=\"1.66\" />\n};\n\nconst ratioIcon = (ratio: keyof typeof ratioRects, rotated?: boolean) => (\n  <svg\n    classList={{'media-editor__crop-item-icon--rotated': rotated}}\n    width=\"24\"\n    height=\"24\"\n    viewBox=\"0 0 24 24\"\n    fill=\"none\"\n    xmlns=\"http://www.w3.org/2000/svg\"\n  >\n    {ratioRects[ratio]()}\n  </svg>\n);\n\nfunction Item(\n  inProps: MediaEditorLargeButtonProps & {\n    icon: JSX.Element;\n    text: JSX.Element;\n  }\n) {\n  const [props, buttonProps] = splitProps(inProps, ['icon', 'text']);\n\n  return (\n    <LargeButton {...buttonProps} class=\"media-editor__crop-item\">\n      {props.icon}\n      {props.text}\n    </LargeButton>\n  );\n}\n\nexport default function CropTab() {\n  const {editorState, mediaState, actions} = useMediaEditorContext();\n\n  const isActive = (what?: string) => editorState.fixedImageRatioKey === what;\n\n  const onRatioClick = withCurrentOwner((ratio?: string) => {\n    editorState.fixedImageRatioKey = ratio;\n    animateToNewRotationOrRatio(mediaState.rotation);\n    actions.resetRotationWheel();\n  });\n\n  return (\n    <>\n      <div class=\"media-editor__label\">{i18n('MediaEditor.AspectRatio')}</div>\n\n      <Item\n        icon={<IconTsx icon=\"free_transform\" />}\n        text={i18n('MediaEditor.Free')}\n        active={isActive()}\n        onClick={() => onRatioClick()}\n      />\n      <Item\n        icon={<IconTsx icon=\"image_original\" />}\n        text={i18n('MediaEditor.Original')}\n        active={isActive('original')}\n        onClick={() => onRatioClick('original')}\n      />\n      <Item\n        icon={ratioIcon('1x1')}\n        text={i18n('MediaEditor.Square')}\n        active={isActive('1x1')}\n        onClick={() => onRatioClick('1x1')}\n      />\n\n      <div class=\"media-editor__crop-grid\">\n        <Item icon={ratioIcon('3x2')} text=\"3:2\" active={isActive('3x2')} onClick={() => onRatioClick('3x2')} />\n        <Item icon={ratioIcon('3x2', true)} text=\"2:3\" active={isActive('2x3')} onClick={() => onRatioClick('2x3')} />\n\n        <Item icon={ratioIcon('4x3')} text=\"4:3\" active={isActive('4x3')} onClick={() => onRatioClick('4x3')} />\n        <Item icon={ratioIcon('4x3', true)} text=\"3:4\" active={isActive('3x4')} onClick={() => onRatioClick('3x4')} />\n\n        <Item icon={ratioIcon('5x4')} text=\"5:4\" active={isActive('5x4')} onClick={() => onRatioClick('5x4')} />\n        <Item icon={ratioIcon('5x4', true)} text=\"4:5\" active={isActive('4x5')} onClick={() => onRatioClick('4x5')} />\n\n        <Item icon={ratioIcon('7x5')} text=\"7:5\" active={isActive('7x5')} onClick={() => onRatioClick('7x5')} />\n        <Item icon={ratioIcon('7x5', true)} text=\"5:7\" active={isActive('5x7')} onClick={() => onRatioClick('5x7')} />\n\n        <Item icon={ratioIcon('16x9')} text=\"16:9\" active={isActive('16x9')} onClick={() => onRatioClick('16x9')} />\n        <Item\n          icon={ratioIcon('16x9', true)}\n          text=\"9:16\"\n          active={isActive('9x16')}\n          onClick={() => onRatioClick('9x16')}\n        />\n      </div>\n    </>\n  );\n}\n","import {ButtonIconTsx} from '@components/buttonIconTsx';\n\nimport {useMediaEditorContext} from '@components/mediaEditor/context';\n\ntype ConfigItem = {\n  icon: Icon;\n  key: string;\n};\n\nconst config: ConfigItem[] = [\n  {icon: 'equalizer', key: 'adjustments'},\n  {icon: 'crop', key: 'crop'},\n  {icon: 'text', key: 'text'},\n  {icon: 'brush', key: 'brush'},\n  {icon: 'smile', key: 'stickers'}\n];\n\nexport const mediaEditorTabsOrder = config.map((item) => item.key);\n\nexport default function Tabs() {\n  const {editorState} = useMediaEditorContext();\n\n  let container: HTMLDivElement;\n  let underline: HTMLDivElement;\n\n  const tabs = config.map((item) => ({\n    ...item,\n    element: (\n      <div class=\"media-editor__tabs-item\" classList={{'media-editor__tabs-item--active': editorState.currentTab === item.key}}>\n        <ButtonIconTsx icon={item.icon} onClick={() => onTabClick(item.key)} />\n      </div>\n    ) as HTMLElement\n  }));\n\n  function onTabClick(key: string) {\n    const target = tabs.find((tab) => tab.key === key).element;\n    const containerBR = container.getBoundingClientRect();\n    const targetBR = target.getBoundingClientRect();\n\n    underline.style.setProperty('--left', targetBR.left + targetBR.width / 2 - containerBR.left + 'px');\n\n    editorState.currentTab = key;\n  }\n\n  return (\n    <div ref={container} class=\"media-editor__tabs\">\n      {tabs.map((tab) => tab.element)}\n      <div ref={underline} class=\"media-editor__tabs-underline\" />\n    </div>\n  );\n}\n","import {Accessor, createContext, createEffect, createSignal, JSX, onCleanup, onMount} from 'solid-js';\n\nimport {doubleRaf} from '@helpers/schedulers';\nimport Scrollable from '@components/scrollable';\n\nimport {useMediaEditorContext} from '@components/mediaEditor/context';\nimport {delay} from '@components/mediaEditor/utils';\n\nimport {mediaEditorTabsOrder} from '@components/mediaEditor/tabs/tabs';\n\ntype TabContentContextValue = {\n  container: Accessor<HTMLDivElement>;\n  scrollAmount: Accessor<number>;\n};\nexport const TabContentContext = createContext<TabContentContextValue>();\n\nexport default function TabContent(props: {\n  tabs: Record<string, () => JSX.Element>;\n  onContainer: (el: HTMLDivElement) => void;\n  onScroll: () => void;\n}) {\n  const {editorState} = useMediaEditorContext();\n\n  const [container, setContainer] = createSignal<HTMLDivElement>();\n  const [scrollAmount, setScrollAmount] = createSignal(0);\n  let prevElement: HTMLDivElement;\n  let prevTab = editorState.currentTab;\n  let scrollable: Scrollable;\n\n  createEffect(async() => {\n    if(prevTab === editorState.currentTab) return;\n\n    const toRight = mediaEditorTabsOrder.indexOf(editorState.currentTab) > mediaEditorTabsOrder.indexOf(prevTab);\n    prevTab = editorState.currentTab;\n\n    scrollable.destroy();\n    const newElement = (\n      <div>\n        <div class=\"media-editor__tab-content-scrollable-content\">\n          <TabContentContext.Provider value={{container, scrollAmount}}>\n            {props.tabs[editorState.currentTab]()}\n          </TabContentContext.Provider>\n        </div>\n      </div>\n    ) as HTMLDivElement;\n    setScrollable(newElement);\n\n    const cls = (element: HTMLElement, action: 'add' | 'remove', modifier: string) =>\n      element.classList[action]('media-editor__tab-content--' + modifier);\n\n    cls(prevElement, 'add', 'exit');\n\n    if(toRight) {\n      cls(newElement, 'add', 'go-right');\n      container().append(newElement);\n      await doubleRaf();\n      cls(prevElement, 'add', 'go-left');\n      cls(newElement, 'remove', 'go-right');\n    } else {\n      cls(newElement, 'add', 'go-left');\n      container().append(newElement);\n      await doubleRaf();\n      cls(prevElement, 'add', 'go-right');\n      cls(newElement, 'remove', 'go-left');\n    }\n\n    await delay(200);\n    prevElement.remove();\n\n    prevElement = newElement;\n  });\n\n  const initialTab = props.tabs[editorState.currentTab]();\n\n  function setScrollable(element: HTMLElement) {\n    // TODO: Scrollable thumb not showing\n    scrollable = new Scrollable(element);\n    scrollable.setListeners();\n    scrollable.container.addEventListener('scroll', () => {\n      props.onScroll();\n      setScrollAmount(scrollable.container.scrollTop);\n    });\n  }\n\n  onMount(() => {\n    setScrollable(prevElement);\n  });\n\n  onCleanup(() => {\n    scrollable.destroy();\n  });\n\n  return (\n    <div\n      ref={(el) => {\n        setContainer(el);\n        props.onContainer(el);\n      }}\n      class=\"media-editor__tab-content\"\n    >\n      <div ref={prevElement}>\n        <div class=\"media-editor__tab-content-scrollable-content\">\n          <TabContentContext.Provider value={{container, scrollAmount}}>{initialTab}</TabContentContext.Provider>\n        </div>\n      </div>\n    </div>\n  );\n}\n","import {batch, createEffect, createResource, createSignal, For, onCleanup, onMount, Show, useContext} from 'solid-js';\n\nimport wrapEmojiText from '@lib/richTextProcessor/wrapEmojiText';\nimport {useHotReloadGuard} from '@lib/solidjs/hotReloadGuard';\nimport {Document, EmojiGroup, StickerSet} from '@layer';\nimport {i18n} from '@lib/langPack';\n\nimport SuperStickerRenderer from '@components/emoticonsDropdown/tabs/SuperStickerRenderer';\nimport createMiddleware from '@helpers/solid/createMiddleware';\nimport LazyLoadQueue from '@components/lazyLoadQueue';\nimport {ScrollableX} from '@components/scrollable';\nimport {IconTsx} from '@components/iconTsx';\nimport Space from '@components/space';\n\nimport useNormalizePoint from '@components/mediaEditor/canvas/useNormalizePoint';\nimport {HistoryItem, useMediaEditorContext} from '@components/mediaEditor/context';\nimport {ResizableLayer} from '@components/mediaEditor/types';\nimport {delay} from '@components/mediaEditor/utils';\n\nimport {TabContentContext} from '@components/mediaEditor/tabs/tabContent';\nimport {getStickerSetInputById} from '@lib/appManagers/utils/stickers/getStickerSetInput';\n\nexport default function StickersTab() {\n  const {wrapStickerSetThumb, EmoticonsSearch} = useHotReloadGuard();\n  const context = useMediaEditorContext();\n  const {container, scrollAmount} = useContext(TabContentContext);\n\n  const {managers, editorState, mediaState, actions} = context;\n\n  const normalizePoint = useNormalizePoint();\n\n  const [recentStickers] = createResource(() => managers.appStickersManager.getRecentStickersStickers());\n  const [stickerSets] = createResource(() => managers.appStickersManager.getAllStickers());\n  const [filteredStickers, setFilteredStickers] = createSignal<Document.document[]>();\n\n  const [search, setSearch] = createSignal('');\n  const [group, setGroup] = createSignal<EmojiGroup>();\n  const [activeSet, setActiveSet] = createSignal('recent');\n  const [scrolling, setScrolling] = createSignal(false);\n\n  const [intersectionObserver, setIntersectionObserver] = createSignal<IntersectionObserver>();\n  const [recentLabel, setRecentLabel] = createSignal<HTMLDivElement>();\n\n  const lazyLoadQueue = new LazyLoadQueue();\n  const stickerRenderer = new SuperStickerRenderer({\n    regularLazyLoadQueue: lazyLoadQueue,\n    group: 'none',\n    managers,\n    intersectionObserverInit: {root: container()},\n    withLock: false\n  });\n\n  onCleanup(() => {\n    stickerRenderer.destroy();\n    lazyLoadQueue.clear();\n  });\n\n  async function onStickerSetThumbClick(id: string) {\n    setActiveSet(String(id));\n    setScrolling(true);\n    container()?.querySelector(`[data-set-id=\"${id}\"]`)?.scrollIntoView({\n      behavior: 'smooth',\n      block: 'start'\n    });\n    await delay(1000);\n    setScrolling(false);\n  }\n\n  function StickerSetThumb(props: {set: StickerSet.stickerSet}) {\n    let renderContainer: HTMLDivElement;\n\n\n    onMount(() => {\n      const middleware = createMiddleware();\n\n      wrapStickerSetThumb({\n        container: renderContainer,\n        group: 'none',\n        autoplay: true,\n        width: 30,\n        height: 30,\n        lazyLoadQueue,\n        middleware: middleware.get(),\n        set: props.set,\n        managers,\n        textColor: 'white'\n      });\n    });\n\n    const isActive = () => String(props.set.id) === activeSet();\n\n    return (\n      <div\n        ref={renderContainer}\n        class=\"media-editor__stickers-set-thumb\"\n        classList={{\n          'media-editor__stickers-set-thumb--active': isActive()\n        }}\n        onClick={() => onStickerSetThumbClick(String(props.set.id))}\n      />\n    );\n  }\n\n  function Sticker(props: {doc: Document.document}) {\n    let container: HTMLDivElement;\n\n    onMount(() => {\n      stickerRenderer.renderSticker(props.doc, container);\n      stickerRenderer.observeAnimated(container);\n    });\n\n    function onClick() {\n      const id = context.resizableLayersSeed++;\n      const transform = editorState.finalTransform;\n      const newLayer = {\n        id,\n        position: normalizePoint([editorState.canvasSize[0] / 2, editorState.canvasSize[1] / 2]),\n        rotation: -transform.rotation,\n        scale: 1 / transform.scale,\n        type: 'sticker',\n        sticker: props.doc\n      } as ResizableLayer;\n\n      batch(() => {\n        mediaState.resizableLayers.push(newLayer);\n        editorState.selectedResizableLayer = id;\n\n        actions.pushToHistory({\n          path: ['resizableLayers', mediaState.resizableLayers.length - 1],\n          newValue: newLayer,\n          oldValue: HistoryItem.RemoveArrayItem,\n          findBy: {\n            id: newLayer.id\n          }\n        })\n      });\n    }\n\n    return <div ref={container} class=\"media-editor__stickers-grid-item\" onClick={onClick} />;\n  }\n\n  function StickerSetLabel(props: {set: StickerSet.stickerSet}) {\n    let label: HTMLDivElement;\n\n    createEffect(() => {\n      if(intersectionObserver()) {\n        intersectionObserver().observe(label);\n        onCleanup(() => {\n          intersectionObserver()?.unobserve(label);\n        });\n      }\n    });\n\n    return (\n      <div ref={label} data-set-id={props.set.id} class=\"media-editor__label\">\n        {wrapEmojiText(props.set.title)}\n      </div>\n    );\n  }\n\n  function StickerSetSection(props: {set: StickerSet.stickerSet}) {\n    const [stickers] = createResource(() => managers.appStickersManager.getStickerSet(getStickerSetInputById(props.set)));\n\n    return (\n      <Show when={stickers()}>\n        <Space amount=\"16px\" />\n        <StickerSetLabel set={props.set} />\n        <div class=\"media-editor__stickers-grid\">\n          <For each={stickers().documents}>{(doc) => <Sticker doc={doc as Document.document} />}</For>\n        </div>\n      </Show>\n    );\n  }\n\n  function ThumbList() {\n    let thumbsListScrollable: HTMLDivElement;\n\n    onMount(() => {\n      document.querySelector('.media-editor__tabs')?.append(thumbsListScrollable);\n      new ScrollableX(thumbsListScrollable);\n    });\n    onCleanup(() => {\n      thumbsListScrollable.remove();\n    });\n\n    const visible = () => stickerSets() && !filteredStickers();\n    <div\n      class=\"media-editor__stickers-thumb-list-scrollable\"\n      classList={{\n        'media-editor__stickers-thumb-list-scrollable--hidden': !visible(),\n        'media-editor__stickers-thumb-list-scrollable--has-scroll': scrollAmount() > 8\n      }}\n      ref={thumbsListScrollable}\n    >\n      <div class=\"media-editor__stickers-thumb-list\">\n        <Show when={recentStickers()?.length}>\n          <div\n            class=\"media-editor__stickers-recent-button\"\n            classList={{\n              'media-editor__stickers-recent-button--active': activeSet() === 'recent'\n            }}\n            onClick={() => onStickerSetThumbClick('recent')}\n          >\n            <IconTsx icon=\"recent\" />\n          </div>\n        </Show>\n        <For each={stickerSets()?.sets}>{(set) => <StickerSetThumb set={set} />}</For>\n      </div>\n    </div>;\n    return <></>;\n  }\n\n  createEffect(() => {\n    setIntersectionObserver(\n      new IntersectionObserver(\n        (entries) => {\n          entries.forEach((entry) => {\n            if(!scrolling() && entry.isIntersecting) {\n              const id = (entry.target as HTMLDivElement).dataset.setId;\n              if(id) setActiveSet(id);\n            }\n          });\n        },\n        {\n          root: container(),\n          rootMargin: `0px 0px -${container().clientHeight - 100}px 0px`\n        }\n      )\n    );\n\n    onCleanup(() => {\n      intersectionObserver()?.disconnect();\n    });\n  });\n\n  createEffect(() => {\n    if(intersectionObserver() && recentLabel()) {\n      intersectionObserver().observe(recentLabel());\n      onCleanup(() => {\n        intersectionObserver()?.unobserve(recentLabel());\n      });\n    }\n  });\n\n  createEffect(async() => {\n    if(search()) {\n      setFilteredStickers(await managers.appStickersManager.searchStickers(search()));\n      return;\n    }\n    if(group()) {\n      const g = group();\n      if(g._ === 'emojiGroupPremium') {\n        setFilteredStickers(await managers.appStickersManager.getPremiumStickers());\n        return;\n      }\n      setFilteredStickers(\n        await managers.appStickersManager.getStickersByEmoticon({\n          emoticon: g.emoticons,\n          includeServerStickers: true\n        })\n      );\n\n      return;\n    }\n    if(!group() && !search()) {\n      setFilteredStickers();\n    }\n  });\n\n  return (\n    <>\n      <ThumbList />\n\n      <Space amount={filteredStickers() ? '0px' : '48px'} />\n      <Space amount=\"8px\" />\n\n      <div class=\"media-editor__sticker-search\">\n        <EmoticonsSearch\n          type=\"stickers\"\n          onValue={(value) => {\n            setSearch(value);\n          }}\n          onGroup={(group) => {\n            setGroup(group);\n          }}\n          categoryColor=\"white\"\n          animatedItemGroup=\"none\"\n        />\n      </div>\n\n      {/* TODO: Favorties */}\n      <Space amount=\"16px\" />\n\n      <Show when={recentStickers()?.length > 0 && !filteredStickers()}>\n        <div ref={setRecentLabel} class=\"media-editor__label\" data-set-id=\"recent\">\n          {i18n('MediaEditor.RecentlyUsed')}\n        </div>\n\n        <div class=\"media-editor__stickers-grid\">\n          <For each={recentStickers()}>{(doc) => <Sticker doc={doc} />}</For>\n        </div>\n      </Show>\n\n      <Show when={filteredStickers()}>\n        <div class=\"media-editor__stickers-grid\">\n          <For each={filteredStickers()}>{(doc) => <Sticker doc={doc} />}</For>\n        </div>\n      </Show>\n\n      <Show when={stickerSets() && !filteredStickers()}>\n        <For each={stickerSets().sets}>{(set) => <StickerSetSection set={set} />}</For>\n      </Show>\n    </>\n  );\n}\n","import {onMount, Accessor, JSX, createEffect, untrack} from 'solid-js';\n\nimport {i18n} from '@lib/langPack';\n\nimport ripple from '@components/ripple';\nimport {IconTsx} from '@components/iconTsx';\nimport Space from '@components/space';\n\nimport {createStoredColor} from '@components/mediaEditor/createStoredColor';\nimport {useMediaEditorContext} from '@components/mediaEditor/context';\nimport ColorPicker from '@components/mediaEditor/colorPicker';\nimport LargeButton from '@components/mediaEditor/largeButton';\nimport RangeInput from '@components/mediaEditor/rangeInput';\nimport {fontInfoMap} from '@components/mediaEditor/utils';\nimport {FontKey} from '@components/mediaEditor/types';\n\nexport default function TextTab() {\n  const {editorState} = useMediaEditorContext();\n\n  const [savedColor, setSavedColor] = createStoredColor('media-editor-text-color', '#ffffff');\n\n  editorState.currentTextLayerInfo.color = savedColor().value;\n  createEffect(() => {\n    untrack(() => editorState.currentTextLayerInfo).color = savedColor().value;\n  });\n\n\n  function setSize(value: number) {\n    editorState.currentTextLayerInfo.size = value;\n  }\n  function setAlignment(value: string) {\n    editorState.currentTextLayerInfo.alignment = value;\n  }\n  function setStyle(value: string) {\n    editorState.currentTextLayerInfo.style = value;\n  }\n\n  const toggleButton = (\n    icon: Icon,\n    value: string,\n    currentValue: Accessor<string>,\n    setValue: (value: string) => void\n  ) => (\n    <div\n      class=\"media-editor__toggle-button\"\n      classList={{'media-editor__toggle-button--active': value === currentValue()}}\n      onClick={() => setValue(value)}\n    >\n      <IconTsx icon={icon} />\n    </div>\n  );\n\n  onMount(() => {\n    document.querySelectorAll('.media-editor__toggle-button').forEach((element) => {\n      ripple(element as HTMLElement);\n    });\n  });\n\n  const fontButton = (text: JSX.Element, textFont: FontKey) => (\n    <LargeButton\n      active={editorState.currentTextLayerInfo.font === textFont}\n      onClick={() => void (editorState.currentTextLayerInfo.font = textFont)}\n      style={{\n        'font-family': fontInfoMap[textFont].fontFamily,\n        'font-weight': fontInfoMap[textFont].fontWeight\n      }}\n    >\n      {text}\n    </LargeButton>\n  );\n\n  return (\n    <>\n      <ColorPicker\n        value={editorState.currentTextLayerInfo.color}\n        onChange={setSavedColor}\n        previousColor={savedColor().previous}\n        colorKey={(editorState.selectedResizableLayer ?? '') + ''}\n      />\n\n      <div class=\"media-editor__toggle-group-row\">\n        <div class=\"media-editor__toggle-group\">\n          {toggleButton('align_left', 'left', () => editorState.currentTextLayerInfo.alignment, setAlignment)}\n          {toggleButton('align_center', 'center', () => editorState.currentTextLayerInfo.alignment, setAlignment)}\n          {toggleButton('align_right', 'right', () => editorState.currentTextLayerInfo.alignment, setAlignment)}\n        </div>\n\n        <div class=\"media-editor__toggle-group\">\n          {toggleButton('fontframe', 'normal', () => editorState.currentTextLayerInfo.style, setStyle)}\n          {toggleButton('fontframe_outline', 'outline', () => editorState.currentTextLayerInfo.style, setStyle)}\n          {toggleButton('fontframe_bg', 'background', () => editorState.currentTextLayerInfo.style, setStyle)}\n        </div>\n      </div>\n\n      <RangeInput\n        label={i18n('MediaEditor.Size')}\n        min={16}\n        max={64}\n        value={editorState.currentTextLayerInfo.size}\n        onChange={setSize}\n        passiveLabel\n        color={editorState.currentTextLayerInfo.color}\n      />\n\n      <Space amount=\"16px\" />\n\n      <div class=\"media-editor__label\">{i18n('MediaEditor.Font')}</div>\n\n      {fontButton(i18n('MediaEditor.Fonts.Roboto'), 'roboto')}\n      {fontButton(i18n('MediaEditor.Fonts.SuezOne'), 'suez')}\n      {fontButton(i18n('MediaEditor.Fonts.FugazOne'), 'fugaz')}\n      {fontButton(i18n('MediaEditor.Fonts.CourierPrime'), 'courier')}\n      {fontButton(i18n('MediaEditor.Fonts.Chewy'), 'chewy')}\n      {fontButton(i18n('MediaEditor.Fonts.Sedan'), 'sedan')}\n      {fontButton(i18n('MediaEditor.Fonts.RubikBubbles'), 'bubbles')}\n      {fontButton(i18n('MediaEditor.Fonts.Playwrite'), 'playwrite')}\n    </>\n  );\n}\n","import {batch, onCleanup, onMount} from 'solid-js';\n\nimport {addShortcutListener} from '@helpers/shortcutListener';\nimport {i18n} from '@lib/langPack';\nimport {ButtonIconTsx} from '@components/buttonIconTsx';\nimport ripple from '@components/ripple';\n\nimport {HistoryItem, useMediaEditorContext} from '@components/mediaEditor/context';\nimport {processHistoryItem} from '@components/mediaEditor/utils';\n\nexport default function Topbar(props: {onClose: () => void; onFinish: () => void}) {\n  const {hasModifications, mediaState, editorState} = useMediaEditorContext();\n\n  let doneButton: HTMLDivElement;\n\n\n  function processHistory(history: HistoryItem[], otherHistory: HistoryItem[]) {\n    batch(() => {\n      const item = history.pop();\n      if(!item) return;\n\n      otherHistory.push({\n        ...item,\n        path: item.path,\n        newValue: item.oldValue,\n        oldValue: item.newValue\n      });\n\n      processHistoryItem(item, mediaState);\n\n      editorState.selectedResizableLayer = undefined;\n    });\n  }\n\n  function onUndo() {\n    processHistory(mediaState.history, mediaState.redoHistory);\n  }\n\n  function onRedo() {\n    processHistory(mediaState.redoHistory, mediaState.history);\n  }\n\n  onMount(() => {\n    ripple(doneButton);\n\n    const removeListener = addShortcutListener(['Ctrl+KeyZ', 'Ctrl+Shift+KeyZ', 'Ctrl+KeyY'], (combo) => {\n      if(combo === 'Ctrl+KeyZ') {\n        onUndo();\n      } else {\n        onRedo();\n      }\n    });\n\n    onCleanup(() => removeListener());\n  });\n\n  return (\n    <div class=\"media-editor__topbar\">\n      <ButtonIconTsx icon=\"cross\" onClick={props.onClose} />\n      <div class=\"media-editor__topbar-title\">{i18n('Edit')}</div>\n      <div class=\"media-editor__topbar-history-controls\">\n        <ButtonIconTsx disabled={!mediaState.history.length} onClick={onUndo} icon=\"undo\" />\n        <ButtonIconTsx disabled={!mediaState.redoHistory.length} onClick={onRedo} icon=\"redo\" />\n      </div>\n      <div\n        ref={doneButton}\n        class=\"media-editor__topbar-done\"\n        classList={{\n          'media-editor__topbar-done--disabled': !hasModifications()\n        }}\n        onClick={() => {\n          if(hasModifications()) props.onFinish();\n        }}\n      >\n        {i18n('Done')}\n      </div>\n    </div>\n  );\n}\n","import {batch, createEffect, createMemo, createSignal, JSX, on, onCleanup, onMount} from 'solid-js';\nimport {doubleRaf} from '@helpers/schedulers';\nimport {useMediaEditorContext} from '@components/mediaEditor/context';\nimport AdjustmentsTab from '@components/mediaEditor/tabs/adjustmentsTab';\nimport BrushTab from '@components/mediaEditor/tabs/brushTab';\nimport CropTab from '@components/mediaEditor/tabs/cropTab';\nimport StickersTab from '@components/mediaEditor/tabs/stickersTab';\nimport TabContent from '@components/mediaEditor/tabs/tabContent';\nimport Tabs from '@components/mediaEditor/tabs/tabs';\nimport TextTab from '@components/mediaEditor/tabs/textTab';\nimport Topbar from '@components/mediaEditor/topbar';\nimport useIsMobile from '@components/mediaEditor/useIsMobile';\nimport {delay} from '@components/mediaEditor/utils';\nimport {animateValue} from '@helpers/animateValue';\nimport {lerp} from '@helpers/lerp';\n\n\nexport default function Toolbar(props: {onFinish: () => void; onClose: () => void}) {\n  let toolbar: HTMLDivElement;\n\n  const {editorState, actions} = useMediaEditorContext();\n\n  const [move, setMove] = createSignal(0);\n  const [isCollapsed, setIsCollapsed] = createSignal(false);\n  const [container, setContainer] = createSignal<HTMLDivElement>();\n  const [containerHeight, setContainerHeight] = createSignal(0);\n  const [extraMove, setExtraMove] = createSignal(0);\n\n  const isMobile = useIsMobile();\n\n  const [shouldHide, setShouldHide] = createSignal(isMobile());\n\n  let startY = 0;\n  let isAborted = true;\n  let isResetting = false;\n  let canMove = false;\n\n  function resetMove() {\n    if(isResetting) return;\n    isResetting = true;\n\n    startY = 0;\n    isAborted = true;\n    animateValue(move(), 0, 200, setMove);\n    setTimeout(() => {\n      isResetting = false;\n    }, 200);\n  }\n  actions.abortDrawerSlide = () => resetMove();\n\n  onMount(() => {\n    function startDrag(y: number) {\n      if(!isMobile()) return;\n      startY = y;\n      isAborted = false;\n      canMove = false;\n      setTimeout(() => {\n        canMove = true;\n      }, 100); // wait for scroll to trigger first\n    }\n    function dragMove(y: number) {\n      if(!isMobile()) return;\n      if(isAborted) return;\n      if(!canMove) return;\n      const diff = y - startY;\n      if(isCollapsed()) setMove(Math.min(Math.max(-containerHeight(), diff), 0));\n      else setMove(Math.max(Math.min(containerHeight(), diff), 0));\n    }\n    function dragEnd() {\n      if(!isMobile()) return;\n      if(isAborted) return;\n      isAborted = true;\n      if(Math.abs(move()) > 100) {\n        setIsCollapsed((prev) => !prev);\n      } else {\n        resetMove();\n      }\n    }\n\n    container().addEventListener('input', () => {\n      resetMove();\n    });\n\n    toolbar.addEventListener('touchstart', (e) => {\n      startDrag(e.touches[0].clientY);\n    });\n    toolbar.addEventListener('touchmove', (e) => {\n      dragMove(e.touches[0].clientY);\n    });\n    toolbar.addEventListener('touchend', (e) => {\n      dragEnd();\n    });\n    toolbar.addEventListener('mousedown', (e) => {\n      startDrag(e.clientY);\n    });\n    toolbar.addEventListener('mousemove', (e) => {\n      dragMove(e.clientY);\n    });\n    toolbar.addEventListener('mouseup', (e) => {\n      dragEnd();\n    });\n    toolbar.addEventListener('mouseout', (e) => {\n      dragEnd();\n    });\n  });\n\n  createEffect(() => {\n    const observer = new ResizeObserver(() => {\n      setContainerHeight(container()?.clientHeight || 0);\n    });\n    observer.observe(container());\n    onCleanup(() => observer.disconnect());\n  });\n\n  createEffect(\n    on(isCollapsed, () => {\n      const initialMove = move();\n      const initialExtraMove = extraMove();\n      const targetExtraMove = isCollapsed() ? containerHeight() : 0;\n      animateValue(0, 1, 200, (progress) => {\n        batch(() => {\n          setMove(lerp(initialMove, 0, progress));\n          setExtraMove(lerp(initialExtraMove, targetExtraMove, progress));\n        });\n      });\n    })\n  );\n\n  createEffect(() => {\n    if(editorState.currentTab !== 'crop') setIsCollapsed(false);\n  });\n\n  createEffect(() => {\n    if(editorState.renderingPayload && shouldHide()) {\n      (async() => {\n        toolbar.style.transition = '.2s';\n        await doubleRaf();\n        setShouldHide(false);\n        await delay(200);\n        toolbar.style.removeProperty('transition');\n      })();\n    }\n  });\n\n  const totalMove = () => extraMove() + move();\n\n  const style = createMemo((): JSX.CSSProperties => {\n    if(isMobile()) return {\n      'opacity': editorState.isAdjusting ? 0 : 1,\n      'transform': shouldHide() ?\n        'translate(-50%, 100%)' :\n        `translate(-50%, ${totalMove()}px)`\n    };\n  });\n\n  return (\n    <div\n      ref={toolbar}\n      class=\"media-editor__toolbar\"\n      style={style()}\n    >\n      <div class=\"media-editor__toolbar-draggable\" />\n      <Topbar onClose={() => props.onClose()} onFinish={props.onFinish} />\n      <Tabs />\n      <TabContent\n        onContainer={setContainer}\n        onScroll={() => {\n          resetMove();\n        }}\n        tabs={{\n          adjustments: () => <AdjustmentsTab />,\n          crop: () => <CropTab />,\n          text: () => <TextTab />,\n          brush: () => <BrushTab />,\n          stickers: () => <StickersTab />\n        }}\n      />\n    </div>\n  );\n}\n","import {createEffect, onCleanup, onMount} from 'solid-js';\nimport {render} from 'solid-js/web';\n\nimport {doubleRaf} from '@helpers/schedulers';\nimport {AppManagers} from '@lib/managers';\nimport {i18n} from '@lib/langPack';\nimport type SolidJSHotReloadGuardProvider from '@lib/solidjs/hotReloadGuardProvider';\n\nimport appNavigationController, {NavigationItem} from '@components/appNavigationController';\nimport confirmationPopup from '@components/confirmationPopup';\n\nimport MainCanvas from '@components/mediaEditor/canvas/mainCanvas';\nimport MediaEditorContext, {createContextValue, EditingMediaState} from '@components/mediaEditor/context';\nimport {createFinalResult, MediaEditorFinalResult} from '@components/mediaEditor/finalRender/createFinalResult';\nimport FinishButton from '@components/mediaEditor/finishButton';\nimport Toolbar from '@components/mediaEditor/toolbar';\nimport {MediaType, NumberPair} from '@components/mediaEditor/types';\nimport {delay, withCurrentOwner} from '@components/mediaEditor/utils';\n\nimport '@components/mediaEditor/mediaEditor.scss';\nimport overlayCounter from '@helpers/overlayCounter';\n\n\nexport type MediaEditorProps = {\n  onClose: (hasGif: boolean) => void;\n  managers: AppManagers;\n  onEditFinish: (result: MediaEditorFinalResult) => void;\n  onCanvasReady: (canvas: HTMLCanvasElement) => Promise<void>;\n  onImageRendered: () => void;\n  mediaSrc: string;\n  mediaType: MediaType;\n  getMediaBlob: () => Promise<Blob | null>;\n  editingMediaState?: EditingMediaState;\n  canImageResultInGIF?: boolean;\n};\n\nexport function MediaEditor(props: MediaEditorProps) {\n  const contextValue = createContextValue(props);\n\n  const {editorState, hasModifications} = contextValue;\n\n  let overlay: HTMLDivElement;\n\n  let isOverlayCounterCleaned = false;\n\n  function cleanupOverlayCounter() {\n    if(isOverlayCounterCleaned) return;\n\n    overlayCounter.isDarkOverlayActive = false;\n    isOverlayCounterCleaned = true;\n  }\n\n  onMount(() => {\n    (async() => {\n      overlay.classList.add('media-editor__overlay--hidden');\n      await doubleRaf();\n      overlay.focus();\n      overlay.classList.remove('media-editor__overlay--hidden');\n    })();\n\n    const navigationItem: NavigationItem = {\n      type: 'popup',\n      onPop: () => handleClose()\n    };\n    appNavigationController.pushItem(navigationItem);\n    overlayCounter.isDarkOverlayActive = true;\n\n    onCleanup(() => {\n      cleanupOverlayCounter();\n      appNavigationController.removeItem(navigationItem);\n    });\n  });\n\n  createEffect(() => {\n    if(!editorState.imageCanvas) return;\n\n    (async() =>{\n      await props.onCanvasReady(editorState.imageCanvas);\n      editorState.isReady = true;\n    })();\n  });\n\n  createEffect(() => {\n    if(!editorState.renderingPayload) return;\n    props.onImageRendered();\n  });\n\n  async function performClose(hasGif = false) {\n    overlay.classList.add('media-editor__overlay--hidden');\n    await delay(200);\n    props.onClose(hasGif);\n  }\n\n  function handleClose(finished = false, hasGif = false) {\n    if(finished || !hasModifications()) {\n      performClose(hasGif);\n      return;\n    }\n\n    confirmationPopup({\n      title: i18n('MediaEditor.DiscardChanges'),\n      description: i18n('MediaEditor.DiscardWarning'),\n      button: {\n        text: i18n('Discard')\n      }\n    }).then(() => performClose(), () => {});\n\n    return false;\n  }\n\n  let isFinishing = false;\n\n  return (\n    <MediaEditorContext.Provider value={contextValue}>\n      <div ref={overlay} class=\"media-editor__overlay night\">\n        <div class=\"media-editor__container\">\n          {(() => {\n            // Need to be inside context\n            const handleFinish = withCurrentOwner(async() => {\n              if(isFinishing) return;\n              isFinishing = true;\n\n              const result = await createFinalResult()\n              .finally(() => { isFinishing = false; });\n\n              cleanupOverlayCounter();\n              props.onEditFinish(result);\n              handleClose(true, result.isVideo);\n            });\n\n            return (\n              <>\n                <MainCanvas />\n                <Toolbar onClose={handleClose} onFinish={handleFinish} />\n                <FinishButton onClick={handleFinish} />\n              </>\n            );\n          })()}\n        </div>\n      </div>\n    </MediaEditorContext.Provider>\n  );\n}\n\nexport function openMediaEditor(props: MediaEditorProps, HotReloadGuardProvider: typeof SolidJSHotReloadGuardProvider) {\n  const element = document.createElement('div');\n  document.body.append(element);\n\n  const dispose = render(() => (\n    <HotReloadGuardProvider>\n      <MediaEditor {...props} onClose={onClose} />\n    </HotReloadGuardProvider>\n  ), element);\n\n  function onClose(hasGif: boolean) {\n    props.onClose(hasGif);\n    dispose();\n    element.remove();\n  }\n}\n","import {MediaEditorProps, openMediaEditor} from '@components/mediaEditor/mediaEditor';\nimport {NumberPair} from '@components/mediaEditor/types';\nimport {snapToViewport} from '@components/mediaEditor/utils';\nimport SolidJSHotReloadGuardProvider from '@lib/solidjs/hotReloadGuardProvider';\n\n\ntype SpawnImageCanvasArgs = {\n  source: CanvasImageSource;\n  rect: LocalDOMRect;\n  animatedCanvasSize: NumberPair;\n};\n\ntype LocalDOMRect = {\n  left: number;\n  top: number;\n  width: number;\n  height: number;\n};\n\ntype OpenMediaEditorFromMediaArgs = Omit<MediaEditorProps, 'onCanvasReady' | 'onImageRendered'> & SpawnImageCanvasArgs;\ntype OpenMediaEditorFromMediaNoAnimationArgs = Omit<MediaEditorProps, 'onCanvasReady' | 'onImageRendered'> & Omit<SpawnImageCanvasArgs, 'rect'>;\n\nexport function openMediaEditorFromMedia({\n  source,\n  rect,\n  animatedCanvasSize: size,\n  ...rest\n}: OpenMediaEditorFromMediaArgs) {\n  const spawnedAnimatedImage = spawnAnimatedImage({\n    animatedCanvasSize: size,\n    rect,\n    source\n  });\n\n  openMediaEditor({\n    ...rest,\n    onCanvasReady: async(canvas) => {\n      const canvasBcr = canvas.getBoundingClientRect();\n\n      await spawnedAnimatedImage.animateToNewCenter(canvasBcr);\n    },\n    onImageRendered: async() => {\n      await removeWithFade(spawnedAnimatedImage.imageCanvas);\n    }\n  }, SolidJSHotReloadGuardProvider);\n}\n\nexport function openMediaEditorFromMediaNoAnimation({\n  source,\n  animatedCanvasSize: size,\n  ...rest\n}: OpenMediaEditorFromMediaNoAnimationArgs) {\n  let spawnedImageCanvas: SpanImageCanvasResult;\n\n  openMediaEditor({\n    ...rest,\n    onCanvasReady: async(canvas) => {\n      const canvasBcr = canvas.getBoundingClientRect();\n\n      spawnedImageCanvas = spawnImageCanvas({\n        rect: snapToRect(size, canvasBcr),\n        source,\n        animatedCanvasSize: size\n      });\n\n      await fadeIn(spawnedImageCanvas.imageCanvas);\n    },\n    onImageRendered: async() => {\n      if(spawnedImageCanvas) {\n        await removeWithFade(spawnedImageCanvas.imageCanvas);\n      }\n    }\n  }, SolidJSHotReloadGuardProvider);\n}\n\nfunction spawnAnimatedImage({rect, source, animatedCanvasSize: size}: SpawnImageCanvasArgs) {\n  const {imageCanvas, centerLeft, centerTop} = spawnImageCanvas({\n    rect,\n    source,\n    animatedCanvasSize: size\n  });\n\n  const [sourceWidth, sourceHeight] = size;\n\n  async function animateToNewCenter(rect: DOMRect) {\n    const canvasCenterLeft = rect.left + rect.width / 2;\n    const canvasCenterTop = rect.top + rect.height / 2;\n\n    const leftDiff = canvasCenterLeft - centerLeft;\n    const topDiff = canvasCenterTop - centerTop;\n    const [newWidth, newHeight] = snapToViewport(sourceWidth / sourceHeight, rect.width, rect.height);\n\n    await imageCanvas.animate({\n      transform: `translate(calc(-50% + ${leftDiff}px), calc(-50% + ${topDiff}px))`,\n      width: `${newWidth}px`,\n      height: `${newHeight}px`\n    }, {\n      duration: 200,\n      fill: 'forwards',\n      easing: 'ease-in-out'\n    }).finished;\n  }\n\n  return {\n    imageCanvas,\n    animateToNewCenter\n  };\n}\n\ntype SpanImageCanvasResult = ReturnType<typeof spawnImageCanvas>;\n\nfunction spawnImageCanvas({\n  source,\n  rect,\n  animatedCanvasSize: size\n}: SpawnImageCanvasArgs) {\n  const imageCanvas = document.createElement('canvas');\n  [imageCanvas.width, imageCanvas.height] = size;\n\n  const ctx = imageCanvas.getContext('2d');\n  ctx.drawImage(source, 0, 0, imageCanvas.width, imageCanvas.height);\n\n  imageCanvas.style.position = 'fixed';\n\n  const centerLeft = rect.left + rect.width / 2, centerTop = rect.top + rect.height / 2, width = rect.width, height = rect.height;\n\n  imageCanvas.style.left = centerLeft + 'px';\n  imageCanvas.style.top = centerTop + 'px';\n  imageCanvas.style.width = width + 'px';\n  imageCanvas.style.height = height + 'px';\n  imageCanvas.style.transform = 'translate(-50%, -50%)';\n  imageCanvas.style.objectFit = 'cover';\n  imageCanvas.style.zIndex = '1000';\n\n  document.body.append(imageCanvas);\n\n  return {\n    centerLeft,\n    centerTop,\n    imageCanvas\n  };\n}\n\nasync function fadeIn(imageCanvas: HTMLCanvasElement) {\n  await imageCanvas.animate({\n    opacity: [0, 1]\n  }, {\n    duration: 200,\n    fill: 'forwards',\n    easing: 'ease-in-out'\n  }).finished;\n}\n\nasync function removeWithFade(imageCanvas: HTMLCanvasElement) {\n  await imageCanvas.animate({\n    opacity: [1, 0]\n  }, {\n    duration: 400,\n    fill: 'forwards',\n    easing: 'ease-in'\n  }).finished;\n  imageCanvas.remove();\n}\n\nfunction snapToRect(size: NumberPair, rect: LocalDOMRect): LocalDOMRect {\n  const [sourceWidth, sourceHeight] = size;\n  const [snappedWidth, snappedHeight] = snapToViewport(sourceWidth / sourceHeight, rect.width, rect.height);\n\n  const left = rect.left + rect.width / 2 - snappedWidth / 2;\n  const top = rect.top + rect.height / 2 - snappedHeight / 2;\n\n  return {\n    left,\n    top,\n    width: snappedWidth,\n    height: snappedHeight\n  };\n}\n"],"file":"index-BSNsYExT.js"}