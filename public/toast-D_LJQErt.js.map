{"version":3,"file":"toast-D_LJQErt.js","sources":["../src/helpers/dom/anchorCallback.ts","../src/helpers/formatDuration.ts","../src/helpers/string/toHHMMSS.ts","../src/components/wrappers/wrapDuration.ts","../src/helpers/overlayClickHandler.ts","../src/components/toast.ts"],"sourcesContent":["import cancelEvent from './cancelEvent';\n\nexport default function anchorCallback(callback: (e: MouseEvent) => any, _cancelEvent = true) {\n  const a = document.createElement('a');\n  a.href = '#';\n  a.onclick = (e) => {\n    _cancelEvent && cancelEvent(e);\n    callback(e);\n  };\n  return a;\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nexport enum DurationType {\n  Seconds,\n  Minutes,\n  Hours,\n  Days,\n  Weeks,\n  Months,\n  Years\n}\n\nexport default function formatDuration(duration: number, showLast = 2) {\n  if(!duration) {\n    duration = 1;\n  }\n\n  const d: {duration: number, type: DurationType}[] = [];\n  const p = [\n    {m: 1, t: DurationType.Seconds},\n    {m: 60, t: DurationType.Minutes},\n    {m: 60, t: DurationType.Hours},\n    {m: 24, t: DurationType.Days},\n    {m: 7, t: DurationType.Weeks}\n  ] as Array<{m?: number, t: DurationType}>\n  const s = 1;\n  let t = s;\n  p.forEach((o, idx) => {\n    t = Math.round(t * o.m);\n\n    if(duration < t) {\n      return;\n    }\n\n    let dd = duration / t;\n    if(idx !== (p.length - 1)) {\n      const modulus = p[idx === (p.length - 1) ? idx : idx + 1].m;\n      dd %= modulus;\n    }\n\n    d.push({\n      duration: dd | 0,\n      type: o.t\n    });\n  });\n\n  const out = d.slice(-showLast).reverse();\n  for(let i = out.length - 1; i >= 0; --i) {\n    if(out[i].duration === 0) {\n      out.splice(i, 1);\n    }\n  }\n\n  return out;\n}\n","export default function toHHMMSS(str: string | number, leadZero = false) {\n  const sec_num = parseInt(str + '', 10);\n  let hours: any = Math.floor(sec_num / 3600);\n  let minutes: any = Math.floor((sec_num - (hours * 3600)) / 60);\n  let seconds: any = sec_num - (hours * 3600) - (minutes * 60);\n\n  if(hours && hours < 10 && leadZero) hours = '0' + hours;\n  if(minutes < 10 && (hours || leadZero)) minutes ='0' + minutes;\n  if(seconds < 10) seconds = '0' + seconds;\n  return (hours ? hours + ':' : '') + minutes + ':' + seconds;\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport I18n, {LangPackKey, i18n, join} from '../../lib/langPack';\nimport formatDuration, {DurationType} from '../../helpers/formatDuration';\nimport toHHMMSS from '../../helpers/string/toHHMMSS';\n\nexport const DURATION_LANG_KEYS: {[type in DurationType]: LangPackKey} = {\n  [DurationType.Seconds]: 'Seconds',\n  [DurationType.Minutes]: 'Minutes',\n  [DurationType.Hours]: 'Hours',\n  [DurationType.Days]: 'Days',\n  [DurationType.Weeks]: 'Weeks',\n  [DurationType.Months]: 'Months',\n  [DurationType.Years]: 'Years'\n};\n\nexport function wrapFormattedDuration(formatted: ReturnType<typeof formatDuration>, plain?: boolean) {\n  if(plain) {\n    const strings = formatted.map((d) => I18n.format(DURATION_LANG_KEYS[d.type], true, [d.duration]));\n    return join(strings, false, plain);\n  }\n\n  const elements = formatted.map((d) => i18n(DURATION_LANG_KEYS[d.type], [d.duration]));\n\n  const fragment = document.createElement('span');\n  fragment.append(...join(elements, false));\n\n  return fragment;\n}\n\nexport function wrapCallDuration(duration: number, plain?: boolean) {\n  return wrapFormattedDuration(formatDuration(duration, 2), plain);\n}\n\nexport function wrapLeftDuration(timeLeft: number) {\n  const formatted = formatDuration(timeLeft, 3);\n  if(formatted[0].type <= DurationType.Hours) {\n    return toHHMMSS(timeLeft, true);\n  } else {\n    formatted.splice(1, Infinity);\n    return wrapFormattedDuration(formatted);\n  }\n}\n\nexport function wrapSlowModeLeftDuration(timeLeft: number) {\n  const formatted = formatDuration(timeLeft, 3);\n  if(formatted[0].type === DurationType.Seconds) {\n    return wrapFormattedDuration(formatted);\n  } else {\n    return toHHMMSS(timeLeft, true);\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport appNavigationController, {NavigationItem} from '../components/appNavigationController';\nimport IS_TOUCH_SUPPORTED from '../environment/touchSupport';\nimport {IS_MOBILE_SAFARI} from '../environment/userAgent';\nimport cancelEvent from './dom/cancelEvent';\nimport {CLICK_EVENT_NAME, hasMouseMovedSinceDown} from './dom/clickEvent';\nimport findUpAsChild from './dom/findUpAsChild';\nimport EventListenerBase from './eventListenerBase';\n\nexport default class OverlayClickHandler extends EventListenerBase<{\n  toggle: (open: boolean) => void\n}> {\n  protected element: HTMLElement;\n  protected overlay: HTMLElement;\n  protected listenerOptions: AddEventListenerOptions;\n\n  constructor(\n    protected navigationType?: NavigationItem['type'],\n    protected withOverlay?: boolean\n  ) {\n    super(false);\n    this.listenerOptions = withOverlay ? {} : {capture: true};\n  }\n\n  protected onClick = (e: MouseEvent | TouchEvent) => {\n    if(hasMouseMovedSinceDown(e)) {\n      return;\n    }\n\n    if(this.element) {\n      const isRoot = this.element === document.body;\n      if(!isRoot && findUpAsChild(e.target as HTMLElement, this.element)) {\n        return;\n      }\n    }\n\n    if(this.listenerOptions?.capture) {\n      cancelEvent(e);\n    }\n\n    this.close();\n  };\n\n  public close() {\n    if(this.element) {\n      this.overlay?.remove();\n      this.element = undefined;\n      this.dispatchEvent('toggle', false);\n    }\n\n    if(!IS_TOUCH_SUPPORTED) {\n      // window.removeEventListener('keydown', onKeyDown, {capture: true});\n      window.removeEventListener('contextmenu', this.onClick, this.listenerOptions);\n    }\n\n    document.removeEventListener(CLICK_EVENT_NAME, this.onClick, this.listenerOptions);\n\n    if(!IS_MOBILE_SAFARI && this.navigationType) {\n      appNavigationController.removeByType(this.navigationType);\n    }\n  }\n\n  public open(element = document.body) {\n    this.close();\n\n    if(!IS_MOBILE_SAFARI && this.navigationType) {\n      appNavigationController.pushItem({\n        type: this.navigationType,\n        onPop: (canAnimate) => {\n          this.close();\n        }\n      });\n    }\n\n    this.element = element;\n\n    if(!this.overlay && this.withOverlay) {\n      this.overlay = document.createElement('div');\n      this.overlay.classList.add('btn-menu-overlay');\n\n      // ! because this event must be canceled, and can't cancel on menu click (below)\n      this.overlay.addEventListener(CLICK_EVENT_NAME, (e) => {\n        cancelEvent(e);\n        this.onClick(e);\n      });\n    }\n\n    const isRoot = this.element === document.body;\n    if(this.overlay) {\n      if(isRoot) {\n        this.element.append(this.overlay);\n      } else {\n        this.element.parentElement.insertBefore(this.overlay, this.element);\n      }\n    }\n\n    // document.body.classList.add('disable-hover');\n\n    if(!IS_TOUCH_SUPPORTED) {\n      // window.addEventListener('keydown', onKeyDown, {capture: true});\n      window.addEventListener('contextmenu', this.onClick, {...this.listenerOptions, once: true});\n    }\n\n    /* // ! because this event must be canceled, and can't cancel on menu click (below)\n    overlay.addEventListener(CLICK_EVENT_NAME, (e) => {\n      cancelEvent(e);\n      onClick(e);\n    }); */\n\n    // ! safari iOS doesn't handle window click event on overlay, idk why\n    document.addEventListener(CLICK_EVENT_NAME, this.onClick, this.listenerOptions);\n\n    this.dispatchEvent('toggle', true);\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport replaceContent from '../helpers/dom/replaceContent';\nimport OverlayClickHandler from '../helpers/overlayClickHandler';\nimport {FormatterArguments, i18n, LangPackKey} from '../lib/langPack';\n\nconst toastsContainer = document.createElement('div');\ntoastsContainer.classList.add('toasts-container');\n\nconst toastEl = document.createElement('div');\ntoastEl.classList.add('toast');\nlet timeout: number;\n\nconst x = new OverlayClickHandler('toast');\nx.addEventListener('toggle', (open) => {\n  if(!open) {\n    hideToast();\n  }\n});\n\nexport function hideToast() {\n  x.close();\n\n  toastEl.classList.remove('is-visible');\n  timeout && clearTimeout(+timeout);\n\n  timeout = window.setTimeout(() => {\n    toastEl.remove();\n    timeout = undefined;\n  }, 200);\n}\n\nexport function toast(content: string | Node, onClose?: () => void) {\n  x.close();\n\n  replaceContent(toastEl, content);\n\n  if(!toastEl.parentElement) {\n    if(!toastsContainer.parentNode) {\n      document.body.append(toastsContainer);\n    }\n\n    toastsContainer.append(toastEl);\n    void toastEl.offsetLeft; // reflow\n  }\n\n  toastEl.classList.add('is-visible');\n\n  timeout && clearTimeout(+timeout);\n  x.open(toastEl);\n\n  timeout = window.setTimeout(hideToast, 3000);\n\n  if(onClose) {\n    x.addEventListener('toggle', onClose, {once: true});\n  }\n}\n\nexport function toastNew(options: Partial<{\n  langPackKey: LangPackKey,\n  langPackArguments: FormatterArguments,\n  onClose: () => void\n}>) {\n  toast(i18n(options.langPackKey, options.langPackArguments), options.onClose);\n}\n"],"names":["anchorCallback","callback","_cancelEvent","a","e","cancelEvent","DurationType","DurationType2","formatDuration","duration","showLast","d","p","t","o","idx","dd","modulus","out","i","toHHMMSS","str","leadZero","sec_num","hours","minutes","seconds","DURATION_LANG_KEYS","wrapFormattedDuration","formatted","plain","strings","I18n","join","elements","i18n","fragment","wrapCallDuration","wrapLeftDuration","timeLeft","wrapSlowModeLeftDuration","OverlayClickHandler","EventListenerBase","navigationType","withOverlay","hasMouseMovedSinceDown","findUpAsChild","IS_TOUCH_SUPPORTED","CLICK_EVENT_NAME","IS_MOBILE_SAFARI","appNavigationController","element","canAnimate","isRoot","toastsContainer","toastEl","timeout","x","open","hideToast","toast","content","onClose","replaceContent","toastNew","options"],"mappings":"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"}